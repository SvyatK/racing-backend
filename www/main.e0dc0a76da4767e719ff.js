(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+HqX":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r("bY+x")),o=r("pQYt");var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.a=t,this.b=r,this.c=n,this.d=i,this.tx=o,this.ty=s,this.array=null}return e.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},e.prototype.set=function(e,t,r,n,i,o){return this.a=e,this.b=t,this.c=r,this.d=n,this.tx=i,this.ty=o,this},e.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},e.prototype.apply=function(e,t){t=t||new i.default;var r=e.x,n=e.y;return t.x=this.a*r+this.c*n+this.tx,t.y=this.b*r+this.d*n+this.ty,t},e.prototype.applyInverse=function(e,t){t=t||new i.default;var r=1/(this.a*this.d+this.c*-this.b),n=e.x,o=e.y;return t.x=this.d*r*n+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*o+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,t},e.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},e.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},e.prototype.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),n=this.a,i=this.c,o=this.tx;return this.a=n*t-this.b*r,this.b=n*r+this.b*t,this.c=i*t-this.d*r,this.d=i*r+this.d*t,this.tx=o*t-this.ty*r,this.ty=o*r+this.ty*t,this},e.prototype.append=function(e){var t=this.a,r=this.b,n=this.c,i=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*r+e.b*i,this.c=e.c*t+e.d*n,this.d=e.c*r+e.d*i,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*r+e.ty*i+this.ty,this},e.prototype.setTransform=function(e,t,r,n,i,o,s,a,l){return this.a=Math.cos(s+l)*i,this.b=Math.sin(s+l)*i,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=e-(r*this.a+n*this.c),this.ty=t-(r*this.b+n*this.d),this},e.prototype.prepend=function(e){var t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){var r=this.a,n=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},e.prototype.decompose=function(e){var t=this.a,r=this.b,n=this.c,i=this.d,s=-Math.atan2(-n,i),a=Math.atan2(r,t),l=Math.abs(s+a);return l<1e-5||Math.abs(o.PI_2-l)<1e-5?(e.rotation=a,t<0&&i>=0&&(e.rotation+=e.rotation<=0?Math.PI:-Math.PI),e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=s,e.skew.y=a),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(n*n+i*i),e.position.x=this.tx,e.position.y=this.ty,e},e.prototype.invert=function(){var e=this.a,t=this.b,r=this.c,n=this.d,i=this.tx,o=e*n-t*r;return this.a=n/o,this.b=-t/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(e*this.ty-t*i)/o,this},e.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},e.prototype.clone=function(){var t=new e;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},e.prototype.copy=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},n(e,null,[{key:"IDENTITY",get:function(){return new e}},{key:"TEMP_MATRIX",get:function(){return new e}}]),e}();t.default=s},"+SKG":function(e,t){e.exports=function(e){return r&&global.Buffer.isBuffer(e)||n&&(e instanceof global.ArrayBuffer||i(e))};var r="function"==typeof global.Buffer&&"function"==typeof global.Buffer.isBuffer,n="function"==typeof global.ArrayBuffer,i=n&&"function"==typeof global.ArrayBuffer.isView?global.ArrayBuffer.isView:function(e){return e.buffer instanceof global.ArrayBuffer}},"/HYg":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){var t=e.width,r=e.height,n=e.getContext("2d"),i=n.getImageData(0,0,t,r).data,o=i.length,s={top:null,left:null,right:null,bottom:null},a=void 0,l=void 0,c=void 0;for(a=0;a<o;a+=4)0!==i[a+3]&&(l=a/4%t,c=~~(a/4/t),null===s.top&&(s.top=c),null===s.left?s.left=l:l<s.left&&(s.left=l),null===s.right?s.right=l+1:s.right<l&&(s.right=l+1),null===s.bottom?s.bottom=c:s.bottom<c&&(s.bottom=c));t=s.right-s.left,r=s.bottom-s.top+1;var u=n.getImageData(s.left,s.top,t,r);return{height:r,width:t,data:u}}},"/UP7":function(e,t,r){"use strict";t.__esModule=!0;var n=r("qp2T");var i={getTintedTexture:function(e,t){var r=e._texture,n="#"+("00000"+(0|(t=i.roundColor(t))).toString(16)).substr(-6);r.tintCache=r.tintCache||{};var o=r.tintCache[n],s=void 0;if(o){if(o.tintId===r._updateID)return r.tintCache[n];s=r.tintCache[n]}else s=i.canvas||document.createElement("canvas");if(i.tintMethod(r,t,s),s.tintId=r._updateID,i.convertTintToImage){var a=new Image;a.src=s.toDataURL(),r.tintCache[n]=a}else r.tintCache[n]=s,i.canvas=null;return s},tintWithMultiply:function(e,t,r){var n=r.getContext("2d"),i=e._frame.clone(),o=e.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="multiply",n.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithOverlay:function(e,t,r){var n=r.getContext("2d"),i=e._frame.clone(),o=e.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithPerPixel:function(e,t,r){var i=r.getContext("2d"),o=e._frame.clone(),s=e.baseTexture.resolution;o.x*=s,o.y*=s,o.width*=s,o.height*=s,r.width=Math.ceil(o.width),r.height=Math.ceil(o.height),i.save(),i.globalCompositeOperation="copy",i.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),i.restore();for(var a=(0,n.hex2rgb)(t),l=a[0],c=a[1],u=a[2],h=i.getImageData(0,0,o.width,o.height),d=h.data,p=0;p<d.length;p+=4)d[p+0]*=l,d[p+1]*=c,d[p+2]*=u;i.putImageData(h,0,0)},roundColor:function(e){var t=i.cacheStepsPerColorChannel,r=(0,n.hex2rgb)(e);return r[0]=Math.min(255,r[0]/t*t),r[1]=Math.min(255,r[1]/t*t),r[2]=Math.min(255,r[2]/t*t),(0,n.rgb2hex)(r)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:(0,function(e){return e&&e.__esModule?e:{default:e}}(r("g57C")).default)(),tintMethod:0};i.tintMethod=i.canUseMultiply?i.tintWithMultiply:i.tintWithPerPixel,t.default=i},"/msk":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));var i=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.uploadHookHelper=n.renderer,n.registerFindHook(a),n.registerUploadHook(o),n.registerUploadHook(s),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){return e&&e.__esModule?e:{default:e}}(r("meNg")).default);function o(e,t){return t instanceof n.BaseTexture&&(t._glTextures[e.CONTEXT_UID]||e.textureManager.updateTexture(t),!0)}function s(e,t){return t instanceof n.Graphics&&((t.dirty||t.clearDirty||!t._webGL[e.plugins.graphics.CONTEXT_UID])&&e.plugins.graphics.updateGraphics(t),!0)}function a(e,t){return e instanceof n.Graphics&&(t.push(e),!0)}t.default=i,n.WebGLRenderer.registerPlugin("prepare",i)},"/zO6":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("+HqX"));var i=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],o=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],s=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],a=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],l=[],c=[];function u(e){return e<0?-1:e>0?1:0}!function(){for(var e=0;e<16;e++){var t=[];c.push(t);for(var r=0;r<16;r++)for(var h=u(i[e]*i[r]+s[e]*o[r]),d=u(o[e]*i[r]+a[e]*o[r]),p=u(i[e]*s[r]+s[e]*a[r]),f=u(o[e]*s[r]+a[e]*a[r]),m=0;m<16;m++)if(i[m]===h&&o[m]===d&&s[m]===p&&a[m]===f){t.push(m);break}}for(var v=0;v<16;v++){var g=new n.default;g.set(i[v],o[v],s[v],a[v],0,0),l.push(g)}}();var h={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(e){return i[e]},uY:function(e){return o[e]},vX:function(e){return s[e]},vY:function(e){return a[e]},inv:function(e){return 8&e?15&e:7&-e},add:function(e,t){return c[e][t]},sub:function(e,t){return c[e][h.inv(t)]},rotate180:function(e){return 4^e},isVertical:function(e){return 2==(3&e)},byDirection:function(e,t){return 2*Math.abs(e)<=Math.abs(t)?t>=0?h.S:h.N:2*Math.abs(t)<=Math.abs(e)?e>0?h.E:h.W:t>0?e>0?h.SE:h.SW:e>0?h.NE:h.NW},matrixAppendRotationInv:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=l[h.inv(t)];i.tx=r,i.ty=n,e.append(i)}};t.default=h},"0DWY":function(e,t){e.exports=function(e,t){return"precision"!==e.substring(0,9)?"precision "+t+" float;\n"+e:e}},"0HXk":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),i=a(r("9a93")),o=a(r("l8vz")),s=r("qp2T");function a(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return i.shader=null,i.indexBuffer=null,i.properties=null,i.tempMatrix=new n.Matrix,i.CONTEXT_UID=0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new i.default(e),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:!0,uploadFunction:this.uploadTint,offset:0}]},t.prototype.start=function(){this.renderer.bindShader(this.shader)},t.prototype.render=function(e){var t=e.children,r=e._maxSize,i=e._batchSize,o=this.renderer,s=t.length;if(0!==s){s>r&&(s=r);var a=e._glBuffers[o.CONTEXT_UID];a||(a=e._glBuffers[o.CONTEXT_UID]=this.generateBuffers(e));var l=t[0]._texture.baseTexture;this.renderer.setBlendMode(n.utils.correctBlendMode(e.blendMode,l.premultipliedAlpha));var c=o.gl,u=e.worldTransform.copy(this.tempMatrix);u.prepend(o._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=u.toArray(!0),this.shader.uniforms.uColor=n.utils.premultiplyRgba(e.tintRgb,e.worldAlpha,this.shader.uniforms.uColor,l.premultipliedAlpha),this.shader.uniforms.uSampler=o.bindTexture(l);for(var h=!1,d=0,p=0;d<s;d+=i,p+=1){var f=s-d;if(f>i&&(f=i),p>=a.length){if(!e.autoResize)break;a.push(this._generateOneMoreBuffer(e))}var m=a[p];m.uploadDynamic(t,d,f);var v=e._bufferUpdateIDs[d]||0;(h=h||m._updateID<v)&&(m._updateID=e._updateID,m.uploadStatic(t,d,f)),o.bindVao(m.vao),m.vao.draw(c.TRIANGLES,6*f)}}},t.prototype.generateBuffers=function(e){for(var t=this.renderer.gl,r=[],n=e._maxSize,i=e._batchSize,s=e._properties,a=0;a<n;a+=i)r.push(new o.default(t,this.properties,s,i));return r},t.prototype._generateOneMoreBuffer=function(e){var t=this.renderer.gl,r=e._batchSize,n=e._properties;return new o.default(t,this.properties,n,r)},t.prototype.uploadVertices=function(e,t,r,n,i,o){for(var s=0,a=0,l=0,c=0,u=0;u<r;++u){var h=e[t+u],d=h._texture,p=h.scale.x,f=h.scale.y,m=d.trim,v=d.orig;m?(s=(a=m.x-h.anchor.x*v.width)+m.width,l=(c=m.y-h.anchor.y*v.height)+m.height):(s=v.width*(1-h.anchor.x),a=v.width*-h.anchor.x,l=v.height*(1-h.anchor.y),c=v.height*-h.anchor.y),n[o]=a*p,n[o+1]=c*f,n[o+i]=s*p,n[o+i+1]=c*f,n[o+2*i]=s*p,n[o+2*i+1]=l*f,n[o+3*i]=a*p,n[o+3*i+1]=l*f,o+=4*i}},t.prototype.uploadPosition=function(e,t,r,n,i,o){for(var s=0;s<r;s++){var a=e[t+s].position;n[o]=a.x,n[o+1]=a.y,n[o+i]=a.x,n[o+i+1]=a.y,n[o+2*i]=a.x,n[o+2*i+1]=a.y,n[o+3*i]=a.x,n[o+3*i+1]=a.y,o+=4*i}},t.prototype.uploadRotation=function(e,t,r,n,i,o){for(var s=0;s<r;s++){var a=e[t+s].rotation;n[o]=a,n[o+i]=a,n[o+2*i]=a,n[o+3*i]=a,o+=4*i}},t.prototype.uploadUvs=function(e,t,r,n,i,o){for(var s=0;s<r;++s){var a=e[t+s]._texture._uvs;a?(n[o]=a.x0,n[o+1]=a.y0,n[o+i]=a.x1,n[o+i+1]=a.y1,n[o+2*i]=a.x2,n[o+2*i+1]=a.y2,n[o+3*i]=a.x3,n[o+3*i+1]=a.y3,o+=4*i):(n[o]=0,n[o+1]=0,n[o+i]=0,n[o+i+1]=0,n[o+2*i]=0,n[o+2*i+1]=0,n[o+3*i]=0,n[o+3*i+1]=0,o+=4*i)}},t.prototype.uploadTint=function(e,t,r,n,i,o){for(var a=0;a<r;++a){var l=e[t+a],c=l._texture.baseTexture.premultipliedAlpha,u=l.alpha,h=u<1&&c?(0,s.premultiplyTint)(l._tintRGB,u):l._tintRGB+(255*u<<24);n[o]=h,n[o+i]=h,n[o+2*i]=h,n[o+3*i]=h,o+=4*i}},t.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),e.prototype.destroy.call(this),this.shader.destroy(),this.indices=null,this.tempMatrix=null},t}(n.ObjectRenderer);t.default=l,n.WebGLRenderer.registerPlugin("particle",l)},"0QlW":function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=e.length;if(!(t>=i||0===r)){var o=i-(r=t+r>i?i-t:r);for(n=t;n<o;++n)e[n]=e[n+r];e.length=o}}},"0z79":function(e,t,r){var n=r("AdPF"),i=r("CUme"),o=r("cpc2"),s=r("Yvos"),a=r("NOtv")("engine.io-client:polling-xhr");function l(){}function c(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,global.location){var t="https:"===location.protocol,r=location.port;r||(r=t?443:80),this.xd=e.hostname!==global.location.hostname||r!==e.port,this.xs=e.secure!==t}}function u(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function h(){for(var e in u.requests)u.requests.hasOwnProperty(e)&&u.requests[e].abort()}e.exports=c,e.exports.Request=u,s(c,i),c.prototype.supportsBinary=!0,c.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new u(e)},c.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=n},c.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},o(u.prototype),u.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new n(e),r=this;try{a("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&t.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout(function(){r.onError(t.status)},0))},a("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}global.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},u.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},u.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=l:this.xhr.onreadystatechange=l,e)try{this.xhr.abort()}catch(e){}global.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},u.prototype.hasXDR=function(){return void 0!==global.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},u.requestsCount=0,u.requests={},global.document&&(global.attachEvent?global.attachEvent("onunload",h):global.addEventListener&&global.addEventListener("beforeunload",h,!1))},"14A5":function(e,t){var r=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),o=r&&r.prototype.append&&r.prototype.getBlob;function s(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=i.buffer}e[t]=n}}}function a(e,t){t=t||{};var n=new r;s(e);for(var i=0;i<e.length;i++)n.append(e[i]);return t.type?n.getBlob(t.type):n.getBlob()}function l(e,t){return s(e),new Blob(e,t||{})}e.exports=n?i?global.Blob:l:o?a:void 0},"1Ceu":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return i.points=n,i.vertices=new Float32Array(4*n.length),i.uvs=new Float32Array(4*n.length),i.colors=new Float32Array(2*n.length),i.indices=new Uint16Array(2*n.length),i.autoUpdate=!0,i.refresh(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._refresh=function(){var e=this.points;if(!(e.length<1)&&this._texture._uvs){this.vertices.length/4!==e.length&&(this.vertices=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length));var t=this.uvs,r=this.indices,n=this.colors;t[0]=0,t[1]=0,t[2]=0,t[3]=1,n[0]=1,n[1]=1,r[0]=0,r[1]=1;for(var i=e.length,o=1;o<i;o++){var s=4*o,a=o/(i-1);t[s]=a,t[s+1]=0,t[s+2]=a,t[s+3]=1,n[s=2*o]=1,n[s+1]=1,r[s=2*o]=s,r[s+1]=s+1}this.dirty++,this.indexDirty++,this.multiplyUvs(),this.refreshVertices()}},t.prototype.refreshVertices=function(){var e=this.points;if(!(e.length<1))for(var t=e[0],r=void 0,n=0,i=0,o=this.vertices,s=e.length,a=0;a<s;a++){var l=e[a],c=4*a;i=-((r=a<e.length-1?e[a+1]:l).x-t.x),n=r.y-t.y;var u=10*(1-a/(s-1));u>1&&(u=1);var h=Math.sqrt(n*n+i*i),d=this._texture.height/2;n/=h,i/=h,n*=d,i*=d,o[c]=l.x+n,o[c+1]=l.y+i,o[c+2]=l.x-n,o[c+3]=l.y-i,t=l}},t.prototype.updateTransform=function(){this.autoUpdate&&this.refreshVertices(),this.containerUpdateTransform()},t}(function(e){return e&&e.__esModule?e:{default:e}}(r("sBhT")).default);t.default=n},"1eSL":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t,r,n){void 0===r&&(r=!1),i(this,e),this._fn=t,this._once=r,this._thisArg=n,this._next=this._prev=this._owner=null}return n(e,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),e}();function s(e,t){return e._head?(e._tail._next=t,t._prev=e._tail,e._tail=t):(e._head=t,e._tail=t),t._owner=e,t}var a=function(){function e(){i(this,e),this._head=this._tail=void 0}return n(e,[{key:"handlers",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this._head;if(e)return!!t;for(var r=[];t;)r.push(t),t=t._next;return r}},{key:"has",value:function(e){if(!(e instanceof o))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return e._owner===this}},{key:"dispatch",value:function(){var e=this._head;if(!e)return!1;for(;e;)e._once&&this.detach(e),e._fn.apply(e._thisArg,arguments),e=e._next;return!0}},{key:"add",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof e)throw new Error("MiniSignal#add(): First arg must be a Function.");return s(this,new o(e,!1,t))}},{key:"once",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof e)throw new Error("MiniSignal#once(): First arg must be a Function.");return s(this,new o(e,!0,t))}},{key:"detach",value:function(e){if(!(e instanceof o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return e._owner!==this?this:(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,null===e._next&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null,this)}},{key:"detachAll",value:function(){var e=this._head;if(!e)return this;for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this}}]),e}();a.MiniSignalBinding=o,t.default=a,e.exports=t.default},"1gqn":function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},"1td8":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return e.prototype.stopPropagation=function(){this.stopped=!0},e.prototype.reset=function(){this.stopped=!1,this.currentTarget=null,this.target=null},e}();t.default=n},"26zZ":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));var i=new n.Rectangle,o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,t.extract=this}return e.prototype.image=function(e){var t=new Image;return t.src=this.base64(e),t},e.prototype.base64=function(e){return this.canvas(e).toDataURL()},e.prototype.canvas=function(e){var t=this.renderer,r=void 0,o=void 0,s=void 0,a=void 0;e&&(a=e instanceof n.RenderTexture?e:t.generateTexture(e)),a?(r=a.baseTexture._canvasRenderTarget.context,o=a.baseTexture._canvasRenderTarget.resolution,s=a.frame):(r=t.rootContext,(s=i).width=this.renderer.width,s.height=this.renderer.height);var l=s.width*o,c=s.height*o,u=new n.CanvasRenderTarget(l,c),h=r.getImageData(s.x*o,s.y*o,l,c);return u.context.putImageData(h,0,0),u.canvas},e.prototype.pixels=function(e){var t=this.renderer,r=void 0,o=void 0,s=void 0,a=void 0;return e&&(a=e instanceof n.RenderTexture?e:t.generateTexture(e)),a?(r=a.baseTexture._canvasRenderTarget.context,o=a.baseTexture._canvasRenderTarget.resolution,s=a.frame):(r=t.rootContext,(s=i).width=t.width,s.height=t.height),r.getImageData(0,0,s.width*o,s.height*o).data},e.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},e}();t.default=o,n.CanvasRenderer.registerPlugin("extract",o)},"2AE7":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),i=s(r("G9Ht")),o=s(r("bx0q"));function s(e){return e&&e.__esModule?e:{default:e}}n.utils.mixins.delayMixin(n.DisplayObject.prototype,o.default);var a=100,l=0,c=0,u=2,h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!i.default.tablet&&!i.default.phone||navigator.isCocoonJS||this.createTouchHook();var r=document.createElement("div");r.style.width=a+"px",r.style.height=a+"px",r.style.position="absolute",r.style.top=l+"px",r.style.left=c+"px",r.style.zIndex=u,this.div=r,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessabillity=!1,window.addEventListener("keydown",this._onKeyDown,!1)}return e.prototype.createTouchHook=function(){var e=this,t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2,t.style.backgroundColor="#FF0000",t.title="HOOK DIV",t.addEventListener("focus",function(){e.isMobileAccessabillity=!0,e.activate(),document.body.removeChild(t)}),document.body.appendChild(t)},e.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},e.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},e.prototype.updateAccessibleObjects=function(e){if(e.visible){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);for(var t=e.children,r=t.length-1;r>=0;r--)this.updateAccessibleObjects(t[r])}},e.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),t=e.width/this.renderer.width,r=e.height/this.renderer.height,i=this.div;i.style.left=e.left+"px",i.style.top=e.top+"px",i.style.width=this.renderer.width+"px",i.style.height=this.renderer.height+"px";for(var o=0;o<this.children.length;o++){var s=this.children[o];if(s.renderId!==this.renderId)s._accessibleActive=!1,n.utils.removeItems(this.children,o,1),this.div.removeChild(s._accessibleDiv),this.pool.push(s._accessibleDiv),s._accessibleDiv=null,o--,0===this.children.length&&this.deactivate();else{i=s._accessibleDiv;var a=s.hitArea,l=s.worldTransform;s.hitArea?(i.style.left=(l.tx+a.x*l.a)*t+"px",i.style.top=(l.ty+a.y*l.d)*r+"px",i.style.width=a.width*l.a*t+"px",i.style.height=a.height*l.d*r+"px"):(a=s.getBounds(),this.capHitArea(a),i.style.left=a.x*t+"px",i.style.top=a.y*r+"px",i.style.width=a.width*t+"px",i.style.height=a.height*r+"px")}}this.renderId++}},e.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.renderer.width&&(e.width=this.renderer.width-e.x),e.y+e.height>this.renderer.height&&(e.height=this.renderer.height-e.y)},e.prototype.addChild=function(e){var t=this.pool.pop();t||((t=document.createElement("button")).style.width=a+"px",t.style.height=a+"px",t.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=u,t.style.borderStyle="none",t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleTitle||e.accessibleHint||(t.title="displayObject "+this.tabIndex),e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},e.prototype._onClick=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"click",t.eventData)},e.prototype._onFocus=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseover",t.eventData)},e.prototype._onFocusOut=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseout",t.eventData)},e.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},e.prototype._onMouseMove=function(){this.deactivate()},e.prototype.destroy=function(){this.div=null;for(var e=0;e<this.children.length;e++)this.children[e].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},e}();t.default=h,n.WebGLRenderer.registerPlugin("accessibility",h),n.CanvasRenderer.registerPlugin("accessibility",h)},"2Dig":function(e,t){e.exports=function(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}},"2IYi":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=h(r("uhBA")),o=r("pQYt"),s=h(r("Yd/J")),a=h(r("gl4O")),l=h(r("YnQD")),c=h(r("sAjT")),u=r("d07J");function h(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this)),n=s.default.TRANSFORM_MODE===o.TRANSFORM_MODE.STATIC?a.default:l.default;return r.tempDisplayObjectParent=null,r.transform=new n,r.alpha=1,r.visible=!0,r.renderable=!0,r.parent=null,r.worldAlpha=1,r.filterArea=null,r._filters=null,r._enabledFilters=null,r._bounds=new c.default,r._boundsID=0,r._lastBoundsID=-1,r._boundsRect=null,r._localBoundsRect=null,r._mask=null,r._destroyed=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},t.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},t.prototype.getBounds=function(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),t||(this._boundsRect||(this._boundsRect=new u.Rectangle),t=this._boundsRect),this._bounds.getRectangle(t)},t.prototype.getLocalBounds=function(e){var t=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,e||(this._localBoundsRect||(this._localBoundsRect=new u.Rectangle),e=this._localBoundsRect);var n=this.getBounds(!1,e);return this.parent=r,this.transform=t,n},t.prototype.toGlobal=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)},t.prototype.toLocal=function(e,t,r,n){return t&&(e=t.toGlobal(e,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)},t.prototype.renderWebGL=function(e){},t.prototype.renderCanvas=function(e){},t.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},t.prototype.setTransform=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=n||1,this.rotation=i,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=l,this},t.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},n(t,[{key:"_tempDisplayObjectParent",get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new t),this.tempDisplayObjectParent}},{key:"x",get:function(){return this.position.x},set:function(e){this.transform.position.x=e}},{key:"y",get:function(){return this.position.y},set:function(e){this.transform.position.y=e}},{key:"worldTransform",get:function(){return this.transform.worldTransform}},{key:"localTransform",get:function(){return this.transform.localTransform}},{key:"position",get:function(){return this.transform.position},set:function(e){this.transform.position.copy(e)}},{key:"scale",get:function(){return this.transform.scale},set:function(e){this.transform.scale.copy(e)}},{key:"pivot",get:function(){return this.transform.pivot},set:function(e){this.transform.pivot.copy(e)}},{key:"skew",get:function(){return this.transform.skew},set:function(e){this.transform.skew.copy(e)}},{key:"rotation",get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e}},{key:"worldVisible",get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}},{key:"mask",get:function(){return this._mask},set:function(e){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)}},{key:"filters",get:function(){return this._filters&&this._filters.slice()},set:function(e){this._filters=e&&e.slice()}}]),t}(i.default);t.default=d,d.prototype.displayObjectUpdateTransform=d.prototype.updateTransform},"2U8Y":function(e,t,r){"use strict";var n="win32"===process.platform,i=r("MCLT");function o(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];i&&"."!==i&&(".."===i?r.length&&".."!==r[r.length-1]?r.pop():t&&r.push(".."):r.push(i))}return r}function s(e){for(var t=e.length-1,r=0;r<=t&&!e[r];r++);for(var n=t;n>=0&&!e[n];n--);return 0===r&&n===t?e:r>n?[]:e.slice(r,n+1)}var a=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,l=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,c={};function u(e){var t=a.exec(e),r=(t[1]||"")+(t[2]||""),n=t[3]||"",i=l.exec(n);return[r,i[1],i[2],i[3]]}function h(e){var t=a.exec(e),r=t[1]||"",n=!!r&&":"!==r[1];return{device:r,isUnc:n,isAbsolute:n||!!t[2],tail:t[3]}}function d(e){return"\\\\"+e.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}c.resolve=function(){for(var e="",t="",r=!1,n=arguments.length-1;n>=-1;n--){var s;if(n>=0?s=arguments[n]:e?(s=process.env["="+e])&&s.substr(0,3).toLowerCase()===e.toLowerCase()+"\\"||(s=e+"\\"):s=process.cwd(),!i.isString(s))throw new TypeError("Arguments to path.resolve must be strings");if(s){var a=h(s),l=a.device,c=a.isUnc,u=a.isAbsolute,p=a.tail;if((!l||!e||l.toLowerCase()===e.toLowerCase())&&(e||(e=l),r||(t=p+"\\"+t,r=u),e&&r))break}}return c&&(e=d(e)),t=o(t.split(/[\\\/]+/),!r).join("\\"),e+(r?"\\":"")+t||"."},c.normalize=function(e){var t=h(e),r=t.device,n=t.isUnc,i=t.isAbsolute,s=t.tail,a=/[\\\/]$/.test(s);return(s=o(s.split(/[\\\/]+/),!i).join("\\"))||i||(s="."),s&&a&&(s+="\\"),n&&(r=d(r)),r+(i?"\\":"")+s},c.isAbsolute=function(e){return h(e).isAbsolute},c.join=function(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(!i.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&e.push(r)}var n=e.join("\\");return/^[\\\/]{2}[^\\\/]/.test(e[0])||(n=n.replace(/^[\\\/]{2,}/,"\\")),c.normalize(n)},c.relative=function(e,t){e=c.resolve(e),t=c.resolve(t);for(var r=e.toLowerCase(),n=t.toLowerCase(),i=s(t.split("\\")),o=s(r.split("\\")),a=s(n.split("\\")),l=Math.min(o.length,a.length),u=l,h=0;h<l;h++)if(o[h]!==a[h]){u=h;break}if(0==u)return t;var d=[];for(h=u;h<o.length;h++)d.push("..");return(d=d.concat(i.slice(u))).join("\\")},c._makeLong=function(e){if(!i.isString(e))return e;if(!e)return"";var t=c.resolve(e);return/^[a-zA-Z]\:\\/.test(t)?"\\\\?\\"+t:/^\\\\[^?.]/.test(t)?"\\\\?\\UNC\\"+t.substring(2):e},c.dirname=function(e){var t=u(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},c.basename=function(e,t){var r=u(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},c.extname=function(e){return u(e)[3]},c.format=function(e){if(!i.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!i.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);var r=e.dir,n=e.base||"";return r?r[r.length-1]===c.sep?r+n:r+c.sep+n:n},c.parse=function(e){if(!i.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=u(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},c.sep="\\",c.delimiter=";";var p=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f={};function m(e){return p.exec(e).slice(1)}f.resolve=function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:process.cwd();if(!i.isString(n))throw new TypeError("Arguments to path.resolve must be strings");n&&(e=n+"/"+e,t="/"===n[0])}return e=o(e.split("/"),!t).join("/"),(t?"/":"")+e||"."},f.normalize=function(e){var t=f.isAbsolute(e),r=e&&"/"===e[e.length-1];return(e=o(e.split("/"),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},f.isAbsolute=function(e){return"/"===e.charAt(0)},f.join=function(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];if(!i.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&(e+=e?"/"+r:r)}return f.normalize(e)},f.relative=function(e,t){e=f.resolve(e).substr(1),t=f.resolve(t).substr(1);for(var r=s(e.split("/")),n=s(t.split("/")),i=Math.min(r.length,n.length),o=i,a=0;a<i;a++)if(r[a]!==n[a]){o=a;break}var l=[];for(a=o;a<r.length;a++)l.push("..");return(l=l.concat(n.slice(o))).join("/")},f._makeLong=function(e){return e},f.dirname=function(e){var t=m(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},f.basename=function(e,t){var r=m(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},f.extname=function(e){return m(e)[3]},f.format=function(e){if(!i.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!i.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);return(e.dir?e.dir+f.sep:"")+(e.base||"")},f.parse=function(e){if(!i.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=m(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return t[1]=t[1]||"",t[2]=t[2]||"",t[3]=t[3]||"",{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},f.sep="/",f.delimiter=":",e.exports=n?c:f,e.exports.posix=f,e.exports.win32=c},"2pII":function(e,t,r){var n=r("akSB"),i=r("cpc2"),o=r("NOtv")("engine.io-client:socket"),s=r("7jRU"),a=r("Wm4p"),l=r("Uxeu"),c=r("TypT");function u(e,t){if(!(this instanceof u))return new u(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=l(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=l(t.host).host),this.secure=null!=t.secure?t.secure:global.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(global.location?location.hostname:"localhost"),this.port=t.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var r="object"==typeof global&&global;r.global===r&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=u,u.priorWebsocketSuccess=!1,i(u.prototype),u.protocol=a.protocol,u.Socket=u,u.Transport=r("Gbct"),u.transports=r("akSB"),u.parser=r("Wm4p"),u.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new n[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0})},u.prototype.open=function(){var e;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},u.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},u.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;u.priorWebsocketSuccess="websocket"===t.name,o('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){r||"closed"!==n.readyState&&(o("changing transport and sending upgrade packet"),d(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())})}else{o('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,n.emit("upgradeError",s)}}))}function s(){r||(r=!0,d(),t.close(),t=null)}function a(r){var i=new Error("probe error: "+r);i.transport=t.name,s(),o('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",i)}function l(){a("transport closed")}function c(){a("socket closed")}function h(e){t&&e.name!==t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),s())}function d(){t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",l),n.removeListener("close",c),n.removeListener("upgrading",h)}u.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",a),t.once("close",l),this.once("close",c),this.once("upgrading",h),t.open()},u.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},u.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},u.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},u.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},u.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},u.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},u.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},u.prototype.onError=function(e){o("socket error %j",e),u.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},u.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){o('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},u.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~s(this.transports,e[r])&&t.push(e[r]);return t}},3:function(e,t){},"3AcN":function(e,t,r){"use strict";t.__esModule=!0,t.autoDetectRenderer=t.Application=t.Filter=t.SpriteMaskFilter=t.Quad=t.RenderTarget=t.ObjectRenderer=t.WebGLManager=t.Shader=t.CanvasRenderTarget=t.TextureUvs=t.VideoBaseTexture=t.BaseRenderTexture=t.RenderTexture=t.BaseTexture=t.TextureMatrix=t.Texture=t.Spritesheet=t.CanvasGraphicsRenderer=t.GraphicsRenderer=t.GraphicsData=t.Graphics=t.TextMetrics=t.TextStyle=t.Text=t.SpriteRenderer=t.CanvasTinter=t.CanvasSpriteRenderer=t.Sprite=t.TransformBase=t.TransformStatic=t.Transform=t.Container=t.DisplayObject=t.Bounds=t.glCore=t.WebGLRenderer=t.CanvasRenderer=t.ticker=t.utils=t.settings=void 0;var n=r("pQYt");Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r("d07J");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=r("yI/K");Object.defineProperty(t,"glCore",{enumerable:!0,get:function(){return q(o).default}});var s=r("sAjT");Object.defineProperty(t,"Bounds",{enumerable:!0,get:function(){return q(s).default}});var a=r("2IYi");Object.defineProperty(t,"DisplayObject",{enumerable:!0,get:function(){return q(a).default}});var l=r("a/Ns");Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return q(l).default}});var c=r("YnQD");Object.defineProperty(t,"Transform",{enumerable:!0,get:function(){return q(c).default}});var u=r("gl4O");Object.defineProperty(t,"TransformStatic",{enumerable:!0,get:function(){return q(u).default}});var h=r("KByU");Object.defineProperty(t,"TransformBase",{enumerable:!0,get:function(){return q(h).default}});var d=r("jQCb");Object.defineProperty(t,"Sprite",{enumerable:!0,get:function(){return q(d).default}});var p=r("LNIn");Object.defineProperty(t,"CanvasSpriteRenderer",{enumerable:!0,get:function(){return q(p).default}});var f=r("/UP7");Object.defineProperty(t,"CanvasTinter",{enumerable:!0,get:function(){return q(f).default}});var m=r("4o2V");Object.defineProperty(t,"SpriteRenderer",{enumerable:!0,get:function(){return q(m).default}});var v=r("Z0PJ");Object.defineProperty(t,"Text",{enumerable:!0,get:function(){return q(v).default}});var g=r("vUM4");Object.defineProperty(t,"TextStyle",{enumerable:!0,get:function(){return q(g).default}});var y=r("TR3/");Object.defineProperty(t,"TextMetrics",{enumerable:!0,get:function(){return q(y).default}});var x=r("5dPP");Object.defineProperty(t,"Graphics",{enumerable:!0,get:function(){return q(x).default}});var b=r("APSF");Object.defineProperty(t,"GraphicsData",{enumerable:!0,get:function(){return q(b).default}});var w=r("7JTu");Object.defineProperty(t,"GraphicsRenderer",{enumerable:!0,get:function(){return q(w).default}});var _=r("t/7c");Object.defineProperty(t,"CanvasGraphicsRenderer",{enumerable:!0,get:function(){return q(_).default}});var S=r("TF/P");Object.defineProperty(t,"Spritesheet",{enumerable:!0,get:function(){return q(S).default}});var T=r("xJsK");Object.defineProperty(t,"Texture",{enumerable:!0,get:function(){return q(T).default}});var M=r("4fju");Object.defineProperty(t,"TextureMatrix",{enumerable:!0,get:function(){return q(M).default}});var A=r("3Jm9");Object.defineProperty(t,"BaseTexture",{enumerable:!0,get:function(){return q(A).default}});var E=r("eIHw");Object.defineProperty(t,"RenderTexture",{enumerable:!0,get:function(){return q(E).default}});var C=r("WJwb");Object.defineProperty(t,"BaseRenderTexture",{enumerable:!0,get:function(){return q(C).default}});var P=r("s1PF");Object.defineProperty(t,"VideoBaseTexture",{enumerable:!0,get:function(){return q(P).default}});var O=r("963y");Object.defineProperty(t,"TextureUvs",{enumerable:!0,get:function(){return q(O).default}});var D=r("pDOs");Object.defineProperty(t,"CanvasRenderTarget",{enumerable:!0,get:function(){return q(D).default}});var N=r("N0WC");Object.defineProperty(t,"Shader",{enumerable:!0,get:function(){return q(N).default}});var L=r("Bjwz");Object.defineProperty(t,"WebGLManager",{enumerable:!0,get:function(){return q(L).default}});var I=r("4FaX");Object.defineProperty(t,"ObjectRenderer",{enumerable:!0,get:function(){return q(I).default}});var R=r("8WrO");Object.defineProperty(t,"RenderTarget",{enumerable:!0,get:function(){return q(R).default}});var F=r("PuCZ");Object.defineProperty(t,"Quad",{enumerable:!0,get:function(){return q(F).default}});var k=r("he9Y");Object.defineProperty(t,"SpriteMaskFilter",{enumerable:!0,get:function(){return q(k).default}});var U=r("Wr15");Object.defineProperty(t,"Filter",{enumerable:!0,get:function(){return q(U).default}});var B=r("zLIK");Object.defineProperty(t,"Application",{enumerable:!0,get:function(){return q(B).default}});var j=r("uc/I");Object.defineProperty(t,"autoDetectRenderer",{enumerable:!0,get:function(){return j.autoDetectRenderer}});var z=X(r("qp2T")),V=X(r("8g3p")),G=q(r("Yd/J")),H=q(r("pVcz")),W=q(r("pV5o"));function X(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function q(e){return e&&e.__esModule?e:{default:e}}t.settings=G.default,t.utils=z,t.ticker=V,t.CanvasRenderer=H.default,t.WebGLRenderer=W.default},"3Gzo":function(e,t,r){"use strict";t.__esModule=!0;var n=r("nWIE");Object.defineProperty(t,"ParticleContainer",{enumerable:!0,get:function(){return o(n).default}});var i=r("0HXk");function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"ParticleRenderer",{enumerable:!0,get:function(){return o(i).default}})},"3Jm9":function(e,t,r){"use strict";t.__esModule=!0;var n=r("qp2T"),i=l(r("Yd/J")),o=l(r("uhBA")),s=l(r("ad8U")),a=l(r("pIo5"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(r,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return a.uid=(0,n.uid)(),a.touched=0,a.resolution=s||i.default.RESOLUTION,a.width=100,a.height=100,a.realWidth=100,a.realHeight=100,a.scaleMode=void 0!==o?o:i.default.SCALE_MODE,a.hasLoaded=!1,a.isLoading=!1,a.source=null,a.origSource=null,a.imageType=null,a.sourceScale=1,a.premultipliedAlpha=!0,a.imageUrl=null,a.isPowerOfTwo=!1,a.mipmap=i.default.MIPMAP_TEXTURES,a.wrapMode=i.default.WRAP_MODE,a._glTextures={},a._enabled=0,a._virtalBoundId=-1,a._destroyed=!1,a.textureCacheIds=[],r&&a.loadSource(r),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.update=function(){"svg"!==this.imageType&&(this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height,this._updateDimensions()),this.emit("update",this)},t.prototype._updateDimensions=function(){this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=a.default.isPow2(this.realWidth)&&a.default.isPow2(this.realHeight)},t.prototype.loadSource=function(e){var t=this.isLoading;this.hasLoaded=!1,this.isLoading=!1,t&&this.source&&(this.source.onload=null,this.source.onerror=null);var r=!this.source;if(this.source=e,(e.src&&e.complete||e.getContext)&&e.width&&e.height)this._updateImageType(),"svg"===this.imageType?this._loadSvgSource():this._sourceLoaded(),r&&this.emit("loaded",this);else if(!e.getContext){this.isLoading=!0;var n=this;if(e.onload=function(){n._updateImageType(),e.onload=null,e.onerror=null,n.isLoading&&(n.isLoading=!1,n._sourceLoaded(),"svg"!==n.imageType?n.emit("loaded",n):n._loadSvgSource())},e.onerror=function(){e.onload=null,e.onerror=null,n.isLoading&&(n.isLoading=!1,n.emit("error",n))},e.complete&&e.src){if(e.onload=null,e.onerror=null,"svg"===n.imageType)return void n._loadSvgSource();this.isLoading=!1,e.width&&e.height?(this._sourceLoaded(),t&&this.emit("loaded",this)):t&&this.emit("error",this)}}},t.prototype._updateImageType=function(){if(this.imageUrl){var e=(0,n.decomposeDataUri)(this.imageUrl),t=void 0;if(e&&"image"===e.mediaType){var r=e.subType.split("+")[0];if(!(t=(0,n.getUrlFileExtension)("."+r)))throw new Error("Invalid image type in data URI.")}else(t=(0,n.getUrlFileExtension)(this.imageUrl))||(t="png");this.imageType=t}},t.prototype._loadSvgSource=function(){if("svg"===this.imageType){var e=(0,n.decomposeDataUri)(this.imageUrl);e?this._loadSvgSourceUsingDataUri(e):this._loadSvgSourceUsingXhr()}},t.prototype._loadSvgSourceUsingDataUri=function(e){var t=void 0;if("base64"===e.encoding){if(!atob)throw new Error("Your browser doesn't support base64 conversions.");t=atob(e.data)}else t=e.data;this._loadSvgSourceUsingString(t)},t.prototype._loadSvgSourceUsingXhr=function(){var e=this,t=new XMLHttpRequest;t.onload=function(){if(t.readyState!==t.DONE||200!==t.status)throw new Error("Failed to load SVG using XHR.");e._loadSvgSourceUsingString(t.response)},t.onerror=function(){return e.emit("error",e)},t.open("GET",this.imageUrl,!0),t.send()},t.prototype._loadSvgSourceUsingString=function(e){var r=(0,n.getSvgSize)(e),i=r.width,o=r.height;if(!i||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");this.realWidth=Math.round(i*this.sourceScale),this.realHeight=Math.round(o*this.sourceScale),this._updateDimensions();var s=document.createElement("canvas");s.width=this.realWidth,s.height=this.realHeight,s._pixiId="canvas_"+(0,n.uid)(),s.getContext("2d").drawImage(this.source,0,0,i,o,0,0,this.realWidth,this.realHeight),this.origSource=this.source,this.source=s,t.addToCache(this,s._pixiId),this.isLoading=!1,this._sourceLoaded(),this.emit("loaded",this)},t.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},t.prototype.destroy=function(){this.imageUrl&&(delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")),this.source=null,this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this._destroyed=!0},t.prototype.dispose=function(){this.emit("dispose",this)},t.prototype.updateSourceImage=function(e){this.source.src=e,this.loadSource(this.source)},t.fromImage=function(e,r,i,o){var a=n.BaseTextureCache[e];if(!a){var l=new Image;void 0===r&&0!==e.indexOf("data:")?l.crossOrigin=(0,s.default)(e):r&&(l.crossOrigin="string"==typeof r?r:"anonymous"),(a=new t(l,i)).imageUrl=e,o&&(a.sourceScale=o),a.resolution=(0,n.getResolutionOfUrl)(e),l.src=e,t.addToCache(a,e)}return a},t.fromCanvas=function(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas";e._pixiId||(e._pixiId=i+"_"+(0,n.uid)());var o=n.BaseTextureCache[e._pixiId];return o||(o=new t(e,r),t.addToCache(o,e._pixiId)),o},t.from=function(e,r,i){if("string"==typeof e)return t.fromImage(e,void 0,r,i);if(e instanceof HTMLImageElement){var o=e.src,s=n.BaseTextureCache[o];return s||((s=new t(e,r)).imageUrl=o,i&&(s.sourceScale=i),s.resolution=(0,n.getResolutionOfUrl)(o),t.addToCache(s,o)),s}return e instanceof HTMLCanvasElement?t.fromCanvas(e,r):e},t.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),n.BaseTextureCache[t]&&console.warn("BaseTexture added to the cache with an id ["+t+"] that already had an entry"),n.BaseTextureCache[t]=e)},t.removeFromCache=function(e){if("string"==typeof e){var t=n.BaseTextureCache[e];if(t){var r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete n.BaseTextureCache[e],t}}else if(e&&e.textureCacheIds){for(var i=0;i<e.textureCacheIds.length;++i)delete n.BaseTextureCache[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null},t}(o.default);t.default=c},"3LRy":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vertices=new ArrayBuffer(t),this.float32View=new Float32Array(this.vertices),this.uint32View=new Uint32Array(this.vertices)}return e.prototype.destroy=function(){this.vertices=null,this.positions=null,this.uvs=null,this.colors=null},e}();t.default=n},"3Ym4":function(e,t,r){"use strict";r("M0IJ"),r("sEJ7"),r("xnYG"),r("a7XB"),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array)},"3hGs":function(e,t,r){var n=r("Womt");e.exports=function(){var e,t,r,i,o,s,a,l,c,u=null,h=null,d=null,p={},f={},m={},v={},g={},y={},x={},b={},w={},_=n.SmoothShading,S={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},T=1,M="Y",A=null;function E(p,_,E){if(u=(new DOMParser).parseFromString(p,"text/xml"),_=_||d,void 0!==E){var P=E.split("/");P.pop(),a=(P.length<1?".":P.join("/"))+"/"}!function(){var e=u.querySelectorAll("asset")[0];if(e&&e.childNodes)for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"unit":var n=r.getAttribute("meter");n&&(T=parseFloat(n));break;case"up_axis":M=r.textContent.charAt(0)}}}(),function(){if(!0!==S.convertUpAxis||M===S.upAxis)A=null;else switch(M){case"X":A="Y"===S.upAxis?"XtoY":"XtoZ";break;case"Y":A="X"===S.upAxis?"YtoX":"YtoZ";break;case"Z":A="X"===S.upAxis?"ZtoX":"ZtoY"}}(),f=C("library_images image",U,"image"),y=C("library_materials material",ie,"material"),x=C("library_effects effect",ce,"effect"),g=C("library_geometries geometry",Y,"geometry"),b=C("library_cameras camera",me,"camera"),w=C("library_lights light",ge,"light"),v=C("library_controllers controller",B,"controller"),m=C("library_animations animation",he,"animation"),o=C("library_visual_scenes visual_scene",V,"visual_scene"),s=C("library_kinematics_models kinematics_model",xe,"kinematics_model"),l=[],c=[],e=function(){var e=u.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return o[t.length>0?t:"visual_scene0"]}return null}(),h=new n.Group;for(var O=0;O<e.nodes.length;O++)h.add(L(e.nodes[O]));h.scale.multiplyScalar(T),r=[],function t(n){var i=e.getChildById(n.colladaId,!0),o=null;if(i&&i.keys){o={fps:60,hierarchy:[{node:i,keys:i.keys,sids:i.sids}],node:n,name:"animation_"+n.name,length:0},r.push(o);for(var s=0,a=i.keys.length;s<a;s++)o.length=Math.max(o.length,i.keys[s].time)}else o={hierarchy:[{keys:[],sids:[]}]};for(var s=0,a=n.children.length;s<a;s++)for(var l=t(n.children[s]),c=0,u=l.hierarchy.length;c<u;c++)o.hierarchy.push({keys:[],sids:[]});return o}(h),t=function(){var e=u.querySelectorAll("instance_kinematics_model")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return s[t.length>0?t:"kinematics_model0"]}return null}(),function(){if(t&&0===t.joints.length)i=void 0;else{var r={},o=function(n,i){var o=i.getAttribute("id"),s=e.getChildById(o,!0),a=t.joints[n];h.traverse(function(e){e.colladaId==o&&(r[n]={node:e,transforms:s.transforms,joint:a,position:a.zeroPosition})})};i={joints:t&&t.joints,getJointValue:function(e){var t=r[e];if(t)return t.position;console.log("getJointValue: joint "+e+" doesn't exist")},setJointValue:function(e,t){var i=r[e];if(i){var o=i.joint;if(t>o.limits.max||t<o.limits.min)console.log("setJointValue: joint "+e+" value "+t+" outside of limits (min: "+o.limits.min+", max: "+o.limits.max+")");else if(o.static)console.log("setJointValue: joint "+e+" is static");else{var s=i.node,l=o.axis,c=i.transforms,u=new n.Matrix4;for(a=0;a<c.length;a++){var h=c[a];if(h.sid&&-1!==h.sid.indexOf("joint"+e))switch(o.type){case"revolute":u.multiply(d.makeRotationAxis(l,n.Math.degToRad(t)));break;case"prismatic":u.multiply(d.makeTranslation(l.x*t,l.y*t,l.z*t));break;default:console.warn("setJointValue: unknown joint type: "+o.type)}else{var d=new n.Matrix4;switch(h.type){case"matrix":u.multiply(h.obj);break;case"translate":u.multiply(d.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"rotate":u.multiply(d.makeRotationAxis(h.obj,h.angle))}}}var p=u.elements,f=Array.prototype.slice.call(p),m=[f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13],f[2],f[6],f[10],f[14],f[3],f[7],f[11],f[15]];s.matrix.set.apply(s.matrix,m),s.matrix.decompose(s.position,s.quaternion,s.scale)}}else console.log("setJointValue: joint "+e+" doesn't exist")}};var s=u.querySelector("scene instance_kinematics_scene");if(s)for(var a=0;a<s.childNodes.length;a++){var l=s.childNodes[a];if(1==l.nodeType)switch(l.nodeName){case"bind_joint_axis":var c=l.getAttribute("target").split("/").pop(),d=l.querySelector("axis param").textContent,p=parseInt(d.split("joint").pop().split(".")[0]),f=u.querySelector('[sid="'+c+'"]');if(f){var m=f.parentElement;o(p,m)}}}}}();var D={scene:h,morphs:l,skins:c,animations:r,kinematics:i,dae:{images:f,materials:y,cameras:b,lights:w,effects:x,geometries:g,controllers:v,animations:m,visualScenes:o,visualScene:e,scene:e,kinematicsModels:s,kinematicsModel:t}};return _&&_(D),D}function C(e,t,r){for(var n=u.querySelectorAll(e),i={},o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=(new t).parse(l);c.id&&0!==c.id.length||(c.id=r+o++),i[c.id]=c}return i}function P(e,t){var r=t instanceof W?v[t.url]:t;if(r&&r.morph){for(var n=r.morph,i=0;i<n.targets.length;i++){var o=n.targets[i],s=g[o];if(s.mesh&&s.mesh.primitives&&s.mesh.primitives.length){var a=s.mesh.primitives[0].geometry;a.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:a.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}else console.log("could not find morph controller!")}function O(e,t,r,i){if(e.world=e.world||new n.Matrix4,e.localworld=e.localworld||new n.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var o=e.channels[0].sampler.output[r];o instanceof n.Matrix4&&(e.world.copy(o),e.localworld.copy(o),0===r&&e.matrix.copy(o))}i&&e.world.multiplyMatrices(i,e.world),t.push(e);for(var s=0;s<e.nodes.length;s++)O(e.nodes[s],t,r,e.world)}function D(e,t){for(var r=0;r<e.length;r++){var i=e[r],o=-1;if("JOINT"==i.type){for(var s=0;s<t.joints.length;s++)if(i.sid===t.joints[s]){o=s;break}if(o>=0){var a=t.invBindMatrices[o];for(i.invBindMatrix=a,i.skinningMatrix=new n.Matrix4,i.skinningMatrix.multiplyMatrices(i.world,a),i.animatrix=new n.Matrix4,i.animatrix.copy(i.localworld),i.weights=[],s=0;s<t.weights.length;s++)for(var l=0;l<t.weights[s].length;l++){var c=t.weights[s][l];c.joint===o&&i.weights.push(c)}}else console.warn("ColladaLoader: Could not find joint '"+i.sid+"'."),i.skinningMatrix=new n.Matrix4,i.weights=[]}}}function N(t,r,i){var o=v[r.url];if(i=void 0!==i?i:40,o&&o.skin)if(r.skeleton&&r.skeleton.length){for(var s=function(){var e,t=1e6,r=-t,n=0;for(var i in m){var o=m[i];e=e||o.id;for(var s=0;s<o.sampler.length;s++){var a=o.sampler[s];a.create(),t=Math.min(t,a.startTime),r=Math.max(r,a.endTime),n=Math.max(n,a.input.length)}}return{start:t,end:r,frames:n,ID:e}}(),a=e.getChildById(r.skeleton[0],!0)||e.getChildBySid(r.skeleton[0],!0),l=function(e){var t=[],r=function(e,t,i){var o={};o.name=t.sid,o.parent=e,o.matrix=t.matrix;var s=[new n.Vector3,new n.Quaternion,new n.Vector3];for(var a in o.matrix.decompose(s[0],s[1],s[2]),o.pos=[s[0].x,s[0].y,s[0].z],o.scl=[s[2].x,s[2].y,s[2].z],o.rotq=[s[1].x,s[1].y,s[1].z,s[1].w],i.push(o),t.nodes)r(t.sid,t.nodes[a],i)};return r(-1,e,t),t}(a),c=o.skin.joints,u=[],h=0;h<c.length;h++)for(var d=0;d<l.length;d++)l[d].name===c[h]&&(u[h]=l[d]);for(var h=0;h<u.length;h++)for(var d=0;d<u.length;d++)u[h].parent===u[d].name&&(u[h].parent=d);for(new n.Vector3,h=0;h<t.vertices.length;h++)t.vertices[h].applyMatrix4(o.skin.bindShapeMatrix);var p=[],f=[],g=o.skin.weights;for(h=0;h<g.length;h++){var y=new n.Vector4(g[h][0]?g[h][0].joint:0,g[h][1]?g[h][1].joint:0,g[h][2]?g[h][2].joint:0,g[h][3]?g[h][3].joint:0),x=new n.Vector4(g[h][0]?g[h][0].weight:0,g[h][1]?g[h][1].weight:0,g[h][2]?g[h][2].weight:0,g[h][3]?g[h][3].weight:0);p.push(y),f.push(x)}t.skinIndices=p,t.skinWeights=f,t.bones=u;var b={name:s.ID,fps:30,length:s.frames/30,hierarchy:[]};for(d=0;d<u.length;d++)b.hierarchy.push({parent:u[d].parent,name:u[d].name,keys:[]});for(console.log("ColladaLoader:",s.ID+" has "+u.length+" bones."),function(e,t,r){var i=[];O(t,i,-1),D(i,r.skin);for(var o=new n.Vector3,s=[],a=0;a<e.vertices.length;a++)s.push(new n.Vector3);for(a=0;a<i.length;a++)if("JOINT"==i[a].type)for(var l=0;l<i[a].weights.length;l++){var c=i[a].weights[l],u=c.index,h=c.weight,d=e.vertices[u],p=s[u];o.x=d.x,o.y=d.y,o.z=d.z,o.applyMatrix4(i[a].skinningMatrix),p.x+=o.x*h,p.y+=o.y*h,p.z+=o.z*h}for(a=0;a<e.vertices.length;a++)e.vertices[a]=s[a]}(t,a,o),i=0;i<s.frames;i++){var w=[];for(O(a,w,i),D(w,o.skin),h=0;h<w.length;h++)for(d=0;d<b.hierarchy.length;d++)if(b.hierarchy[d].name===w[h].sid){var _={};_.time=i/30,_.matrix=w[h].animatrix,0===i&&(w[h].matrix=_.matrix);var S=[new n.Vector3,new n.Quaternion,new n.Vector3];_.matrix.decompose(S[0],S[1],S[2]),_.pos=[S[0].x,S[0].y,S[0].z],_.scl=[S[2].x,S[2].y,S[2].z],_.rot=S[1],b.hierarchy[d].keys.push(_)}t.animation=b}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function L(e,t){var r,i,o,s,a=new n.Object3D;for(o=0;o<e.controllers.length;o++){var u=v[e.controllers[o].url];switch(u.type){case"skin":if(g[u.skin.source])(d=new q).url=u.skin.source,d.instance_material=e.controllers[o].instance_material,e.geometries.push(d),r=e.controllers[o];else if(v[u.skin.source]){var h=v[u.skin.source];i=h,h.morph&&g[h.morph.source]&&((d=new q).url=h.morph.source,d.instance_material=e.controllers[o].instance_material,e.geometries.push(d))}break;case"morph":var d;g[u.morph.source]&&((d=new q).url=u.morph.source,d.instance_material=e.controllers[o].instance_material,e.geometries.push(d),i=e.controllers[o]),console.log("ColladaLoader: Morph-controller partially supported.")}}var p={};for(o=0;o<e.geometries.length;o++){var f,m=e.geometries[o],_=m.instance_material,T=g[m.url],M={},A=[],E=0;if(T){if(!T.mesh||!T.mesh.primitives)continue;if(0===a.name.length&&(a.name=T.id),_)for(s=0;s<_.length;s++){var C=_[s],O=y[C.target],D=O.instance_effect.url,I=x[D].shader.material;if(T.doubleSided){if(!(C.symbol in p)){var R=I.clone();R.side=n.DoubleSide,p[C.symbol]=R}I=p[C.symbol]}I.opacity=I.opacity?I.opacity:1,M[C.symbol]=E,A.push(I),(f=I).name=null===O.name||""===O.name?O.id:O.name,E++}var F,k=f||new n.MeshLambertMaterial({color:14540253,side:T.doubleSided?n.DoubleSide:n.FrontSide}),U=T.mesh.geometry3js;E>1&&(k=new n.MultiMaterial(A)),void 0!==r?(N(U,r),U.morphTargets.length>0?(k.morphTargets=!0,k.skinning=!1):(k.morphTargets=!1,k.skinning=!0),(F=new n.SkinnedMesh(U,k,!1)).name="skin_"+c.length,c.push(F)):void 0!==i?(P(U,i),k.morphTargets=!0,(F=new n.Mesh(U,k)).name="morph_"+l.length,l.push(F)):F=!0===U.isLineStrip?new n.Line(U):new n.Mesh(U,k),a.add(F)}}for(o=0;o<e.cameras.length;o++){var B=e.cameras[o],j=b[B.url],z=new n.PerspectiveCamera(j.yfov,parseFloat(j.aspect_ratio),parseFloat(j.znear),parseFloat(j.zfar));a.add(z)}for(o=0;o<e.lights.length;o++){var V=null,G=e.lights[o],H=w[G.url];if(H&&H.technique){var W=H.color.getHex(),X=H.intensity,Y=H.distance,J=H.falloff_angle;switch(H.technique){case"directional":(V=new n.DirectionalLight(W,X,Y)).position.set(0,0,1);break;case"point":V=new n.PointLight(W,X,Y);break;case"spot":(V=new n.SpotLight(W,X,Y,J)).position.set(0,0,1);break;case"ambient":V=new n.AmbientLight(W)}}V&&a.add(V)}if(a.name=e.name||e.id||"",a.colladaId=e.id||"",a.layer=e.layer||"",a.matrix=e.matrix,a.matrix.decompose(a.position,a.quaternion,a.scale),S.centerGeometry&&a.geometry){var Z=a.geometry.center();Z.multiply(a.scale),Z.applyQuaternion(a.quaternion),a.position.sub(Z)}for(o=0;o<e.nodes.length;o++)a.add(L(e.nodes[o]));return a}function I(e){for(var t=u.querySelectorAll("library_nodes node"),r=0;r<t.length;r++){var n=t[r].attributes.getNamedItem("id");if(n&&n.value===e)return t[r]}}function R(e,t){for(var r=null,n=0,i=e.length;n<i&&null===r;n++){var o=e[n];if(o.time===t)r=o;else if(o.time>t)break}return r}function F(e,t){for(var r=-1,n=0,i=e.length;n<i&&-1===r;n++)e[n].time>=t&&(r=n);return r}function k(e,t,r,n){var i=function(e,t,r){for(r=r>=0?r:r+e.length;r>=0;r--){var n=e[r];if(n.hasTarget(t))return n}return null}(e,n,r?r-1:0),o=function(e,t,r){for(;r<e.length;r++){var n=e[r];if(n.hasTarget(t))return n}return null}(e,n,r+1);if(i&&o){var s,a=(t.time-i.time)/(o.time-i.time),l=i.getTarget(n),c=o.getTarget(n).data,u=l.data;if("matrix"===l.type)s=u;else if(u.length){s=[];for(var h=0;h<u.length;++h)s[h]=u[h]+(c[h]-u[h])*a}else s=u+(c-u)*a;t.addTarget(n,l.transform,l.member,s)}}function U(){this.id="",this.init_from=""}function B(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function j(){this.method=null,this.source=null,this.targets=null,this.weights=null}function z(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function V(){this.id="",this.name="",this.nodes=[],this.scene=new n.Group}function G(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new n.Matrix4}function H(){this.sid="",this.type="",this.data=[],this.obj=null}function W(){this.url="",this.skeleton=[],this.instance_material=[]}function X(){this.symbol="",this.target=""}function q(){this.url="",this.instance_material=[]}function Y(){this.id="",this.mesh=null}function J(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function Z(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new n.Geometry}function Q(){Z.call(this),this.vcount=[]}function K(){Z.call(this),this.vcount=1}function $(){Z.call(this),this.vcount=3}function ee(){this.source="",this.count=0,this.stride=0,this.params=[]}function te(){this.input={}}function re(){this.semantic="",this.offset=0,this.source="",this.set=0}function ne(e){this.id=e,this.type=null}function ie(){this.id="",this.name="",this.instance_effect=null}function oe(){this.color=new n.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function se(e,t){this.type=e,this.effect=t,this.material=null}function ae(e){this.effect=e,this.init_from=null,this.format=null}function le(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function ce(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function ue(){this.url=""}function he(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function de(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function pe(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function fe(e){this.targets=[],this.time=e}function me(){this.id="",this.name="",this.technique=""}function ve(){this.url=""}function ge(){this.id="",this.name="",this.technique=""}function ye(){this.url=""}function xe(){this.id="",this.name="",this.joints=[],this.links=[]}function be(){this.sid="",this.name="",this.axis=new n.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function we(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function _e(){this.joint="",this.transforms=[],this.links=[]}function Se(e){var t=e.getAttribute("id");return void 0!=p[t]?p[t]:(p[t]=new ne(t).parse(e),p[t])}function Te(e){for(var t=Ee(e),r=[],n=0,i=t.length;n<i;n++)r.push("true"===t[n]||"1"===t[n]);return r}function Me(e){for(var t=Ee(e),r=[],n=0,i=t.length;n<i;n++)r.push(parseFloat(t[n]));return r}function Ae(e){for(var t=Ee(e),r=[],n=0,i=t.length;n<i;n++)r.push(parseInt(t[n],10));return r}function Ee(e){return e.length>0?function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}(e).split(/\s+/):[]}function Ce(e,t,r){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):r}function Pe(e,t){(new n.ImageLoader).load(t,function(t){e.image=t,e.needsUpdate=!0})}function Oe(e,t){e.doubleSided=!1;var r=t.querySelectorAll("extra double_sided")[0];r&&r&&1===parseInt(r.textContent,10)&&(e.doubleSided=!0)}function De(e,t){if(!0===S.convertUpAxis&&M!==S.upAxis)switch(A){case"XtoY":var r=e[0];e[0]=t*e[1],e[1]=r;break;case"XtoZ":r=e[2],e[2]=e[1],e[1]=e[0],e[0]=r;break;case"YtoX":r=e[0],e[0]=e[1],e[1]=t*r;break;case"YtoZ":r=e[1],e[1]=t*e[2],e[2]=r;break;case"ZtoX":r=e[0],e[0]=e[1],e[1]=e[2],e[2]=r;break;case"ZtoY":r=e[1],e[1]=e[2],e[2]=t*r}}function Ne(e,t){var r=[e[t],e[t+1],e[t+2]];return De(r,-1),new n.Vector3(r[0],r[1],r[2])}function Le(e){if(S.convertUpAxis){var t=[e[0],e[4],e[8]];De(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],De(t=[e[1],e[5],e[9]],-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],De(t=[e[2],e[6],e[10]],-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],De(t=[e[0],e[1],e[2]],-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],De(t=[e[4],e[5],e[6]],-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],De(t=[e[8],e[9],e[10]],-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],De(t=[e[3],e[7],e[11]],-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new n.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ie(e){return e>-1&&e<3&&(e={X:0,Y:1,Z:2}[e=Re(["X","Y","Z"][e])]),e}function Re(e){if(S.convertUpAxis)switch(e){case"X":switch(A){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(A){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(A){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}return U.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];"init_from"===r.nodeName&&(this.init_from=r.textContent)}return this},B.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"skin":this.skin=(new z).parse(r),this.type=r.nodeName;break;case"morph":this.morph=(new j).parse(r),this.type=r.nodeName}}return this},j.prototype.parse=function(e){var t,r={},n=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":r[(s=(new ne).parse(i)).id]=s;break;case"targets":n=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(t=0;t<n.length;t++){var o=n[t],s=r[o.source];switch(o.semantic){case"MORPH_TARGET":this.targets=s.read();break;case"MORPH_WEIGHT":this.weights=s.read()}}return this},j.prototype.parseInputs=function(e){for(var t=[],r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":t.push((new re).parse(n))}}return t},z.prototype.parse=function(e){var t,r,n={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<e.childNodes.length;i++){var o=e.childNodes[i];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var s=Me(o.textContent);this.bindShapeMatrix=Le(s);break;case"source":var a=(new ne).parse(o);n[a.id]=a;break;case"joints":t=o;break;case"vertex_weights":r=o;break;default:console.log(o.nodeName)}}return this.parseJoints(t,n),this.parseWeights(r,n),this},z.prototype.parseJoints=function(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":var i=(new re).parse(n),o=t[i.source];"JOINT"===i.semantic?this.joints=o.read():"INV_BIND_MATRIX"===i.semantic&&(this.invBindMatrices=o.read())}}},z.prototype.parseWeights=function(e,t){for(var r,n,i=[],o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1==s.nodeType)switch(s.nodeName){case"input":i.push((new re).parse(s));break;case"v":r=Ae(s.textContent);break;case"vcount":n=Ae(s.textContent)}}var a=0;for(o=0;o<n.length;o++){for(var l=n[o],c=[],u=0;u<l;u++){for(var h={},d=0;d<i.length;d++){var p=i[d],f=r[a+p.offset];switch(p.semantic){case"JOINT":h.joint=f;break;case"WEIGHT":h.weight=t[p.source].data[f]}}c.push(h),a+=i.length}for(u=0;u<c.length;u++)c[u].index=o;this.weights.push(c)}},V.prototype.getChildById=function(e,t){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(e,t);if(n)return n}return null},V.prototype.getChildBySid=function(e,t){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(e,t);if(n)return n}return null},V.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new G).parse(r))}}return this},G.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var r,n=this.channels[t],i=n.target.split("/"),o=(i.shift(),i.shift()),s=o.indexOf(".")>=0,a=o.indexOf("(")>=0;if(s)o=(i=o.split(".")).shift(),i.shift();else if(a){o=(r=o.split("(")).shift();for(var l=0;l<r.length;l++)r[l]=parseInt(r[l].replace(/\)/,""))}if(o===e)return n.info={sid:o,dotSyntax:s,arrSyntax:a,arrIndices:r},n}return null},G.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(e,t);if(n)return n}return null},G.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(e,t);if(n)return n}return null},G.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},G.prototype.parse=function(e){this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new n.Matrix4;for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new G).parse(r));break;case"instance_camera":this.cameras.push((new ve).parse(r));break;case"instance_controller":this.controllers.push((new W).parse(r));break;case"instance_geometry":this.geometries.push((new q).parse(r));break;case"instance_light":this.lights.push((new ye).parse(r));break;case"instance_node":var i=I(r.getAttribute("url").replace(/^#/,""));i&&this.nodes.push((new G).parse(i));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new H).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=function(e){var t=[],r=1e6,n=-1e6;for(var i in m)for(var o=m[i],s=0;s<o.channel.length;s++){var a=o.channel[s],l=o.sampler[s];(i=a.target.split("/")[0])==e.id&&(l.create(),a.sampler=l,r=Math.min(r,l.startTime),n=Math.max(n,l.endTime),t.push(a))}return t.length&&(e.startTime=r,e.endTime=n),t}(this),function(e){if(e.channels&&e.channels.length){for(var t=[],r=[],n=0,i=e.channels.length;n<i;n++){var o,s=e.channels[n],a=s.fullSid,l=s.sampler,c=l.input,u=e.getTransformBySid(s.sid);if(s.arrIndices){o=[];for(var h=0,d=s.arrIndices.length;h<d;h++)o[h]=Ie(s.arrIndices[h])}else o=Re(s.member);if(u)for(-1===r.indexOf(a)&&r.push(a),h=0,d=c.length;h<d;h++){var p=c[h],f=l.getData(u.type,h,o);if(!(g=R(t,p))){g=new fe(p);var m=F(t,p);t.splice(-1===m?t.length:m,0,g)}g.addTarget(a,u,o,f)}else console.log('Could not find transform "'+s.sid+'" in node '+e.id)}for(n=0;n<r.length;n++){var v=r[n];for(h=0;h<t.length;h++){var g;(g=t[h]).hasTarget(v)||k(t,g,h,v)}}e.keys=t,e.sids=r}}(this),this.updateMatrix(),this},G.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},H.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=Me(e.textContent),this.convert(),this},H.prototype.convert=function(){switch(this.type){case"matrix":this.obj=Le(this.data);break;case"rotate":this.angle=n.Math.degToRad(this.data[3]);case"translate":De(this.data,-1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":De(this.data,1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},H.prototype.apply=function(){var e=new n.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),H.prototype.update=function(e,t){var r=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var i="n"+(t[0]+1)+(t[1]+1);this.obj[i]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=r[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=r[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=n.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=n.Math.degToRad(e[3])}}},W.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1===r.nodeType)switch(r.nodeName){case"skeleton":this.skeleton.push(r.textContent.replace(/^#/,""));break;case"bind_material":for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new X).parse(o))}}}return this},X.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},q.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType&&"bind_material"===r.nodeName){for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new X).parse(o))}break}}return this},Y.prototype.parse=function(e){this.id=e.getAttribute("id"),Oe(this,e);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"mesh":this.mesh=new J(this).parse(r)}}return this},J.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"source":Se(r);break;case"vertices":this.vertices=(new te).parse(r);break;case"linestrips":this.primitives.push((new K).parse(r));break;case"triangles":this.primitives.push((new $).parse(r));break;case"polygons":this.primitives.push((new Z).parse(r));break;case"polylist":this.primitives.push((new Q).parse(r))}}if(this.geometry3js=new n.Geometry,null===this.vertices)return this;var i=p[this.vertices.input.POSITION.source].data;for(t=0;t<i.length;t+=3)this.geometry3js.vertices.push(Ne(i,t).clone());for(t=0;t<this.primitives.length;t++){var o=this.primitives[t];o.setVertices(this.vertices),this.handlePrimitive(o,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},J.prototype.handlePrimitive=function(e,t){if(e instanceof K)t.isLineStrip=!0;else{var r,i,o,s,a,l,c,u=e.p,h=e.inputs,d=0,f=3,m=0,v=[];for(r=0;r<h.length;r++){var g=(o=h[r]).offset+1;switch(m=m<g?g:m,o.semantic){case"TEXCOORD":v.push(o.set)}}for(var y=0;y<u.length;++y)for(var x=u[y],b=0;b<x.length;){var w=[],_=[],T=null,M=[];for(f=e.vcount?e.vcount.length?e.vcount[d++]:e.vcount:x.length/m,r=0;r<f;r++)for(i=0;i<h.length;i++)switch(o=h[i],l=p[o.source],a=(s=x[b+r*m+o.offset])*(c=l.accessor.params.length),o.semantic){case"VERTEX":w.push(s);break;case"NORMAL":_.push(Ne(l.data,a));break;case"TEXCOORD":void 0===(T=T||{})[o.set]&&(T[o.set]=[]),T[o.set].push(new n.Vector2(l.data[a],l.data[a+1]));break;case"COLOR":M.push((new n.Color).setRGB(l.data[a],l.data[a+1],l.data[a+2]))}if(0===_.length)if(o=this.vertices.input.NORMAL){c=(l=p[o.source]).accessor.params.length;for(var A=0,E=w.length;A<E;A++)_.push(Ne(l.data,w[A]*c))}else t.calcNormals=!0;if(!T&&(T={},o=this.vertices.input.TEXCOORD))for(v.push(o.set),c=(l=p[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)a=w[A]*c,void 0===T[o.set]&&(T[o.set]=[]),T[o.set].push(new n.Vector2(l.data[a],1-l.data[a+1]));if(0===M.length&&(o=this.vertices.input.COLOR))for(c=(l=p[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)a=w[A]*c,M.push((new n.Color).setRGB(l.data[a],l.data[a+1],l.data[a+2]));var C,P,O=null,D=[];if(3===f)D.push(new n.Face3(w[0],w[1],w[2],_,M.length?M:new n.Color));else if(4===f)D.push(new n.Face3(w[0],w[1],w[3],_.length?[_[0].clone(),_[1].clone(),_[3].clone()]:[],M.length?[M[0],M[1],M[3]]:new n.Color)),D.push(new n.Face3(w[1],w[2],w[3],_.length?[_[1].clone(),_[2].clone(),_[3].clone()]:[],M.length?[M[1],M[2],M[3]]:new n.Color));else if(f>4&&S.subdivideFaces){var N=M.length?M:new n.Color;for(i=1;i<f-1;)D.push(new n.Face3(w[0],w[i],w[i+1],_.length?[_[0].clone(),_[i++].clone(),_[i].clone()]:[],N))}if(D.length)for(A=0,E=D.length;A<E;A++)for((O=D[A]).daeMaterial=e.material,t.faces.push(O),i=0;i<v.length;i++)C=T[v[i]],P=f>4?[C[0],C[A+1],C[A+2]]:4===f?0===A?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],void 0===t.faceVertexUvs[i]&&(t.faceVertexUvs[i]=[]),t.faceVertexUvs[i].push(P);else console.log("dropped face with vcount "+f+" for geometry with id: "+t.id);b+=m*f}}},Z.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input.POSITION.source)},Z.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=Ce(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"input":this.inputs.push((new re).parse(e.childNodes[t]));break;case"vcount":this.vcount=Ae(r.textContent);break;case"p":this.p.push(Ae(r.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},Q.prototype=Object.create(Z.prototype),Q.prototype.constructor=Q,K.prototype=Object.create(Z.prototype),K.prototype.constructor=K,$.prototype=Object.create(Z.prototype),$.prototype.constructor=$,ee.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=Ce(e,"count",0),this.stride=Ce(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if("param"===r.nodeName){var n={};n.name=r.getAttribute("name"),n.type=r.getAttribute("type"),this.params.push(n)}}return this},te.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"===e.childNodes[t].nodeName){var r=(new re).parse(e.childNodes[t]);this.input[r.semantic]=r}return this},re.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=Ce(e,"set",-1),this.offset=Ce(e,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},ne.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"bool_array":this.data=Te(r.textContent),this.type=r.nodeName;break;case"float_array":this.data=Me(r.textContent),this.type=r.nodeName;break;case"int_array":this.data=Ae(r.textContent),this.type=r.nodeName;break;case"IDREF_array":case"Name_array":this.data=Ee(r.textContent),this.type=r.nodeName;break;case"technique_common":for(var n=0;n<r.childNodes.length;n++)if("accessor"===r.childNodes[n].nodeName){this.accessor=(new ee).parse(r.childNodes[n]);break}}}return this},ne.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var r=0;r<this.data.length;r+=16){var n=Le(this.data.slice(r,r+16));e.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},ie.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"===e.childNodes[t].nodeName){this.instance_effect=(new ue).parse(e.childNodes[t]);break}return this},oe.prototype.isColor=function(){return null===this.texture},oe.prototype.isTexture=function(){return null!=this.texture},oe.prototype.parse=function(e){"transparent"===e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"color":var i=Me(r.textContent);this.color=new n.Color,this.color.setRGB(i[0],i[1],i[2]),this.color.a=i[3];break;case"texture":this.texture=r.getAttribute("texture"),this.texcoord=r.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(r)}}return this},oe.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1]).childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?this.texOpts[r.nodeName]=1:this.texOpts[r.nodeName]=parseInt(r.textContent);break;default:this.texOpts[r.nodeName]=r.textContent}}return this},se.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[r.nodeName]=(new oe).parse(r);break;case"bump":var n=r.getAttribute("bumptype");n?"heightfield"===n.toLowerCase()?this.bump=(new oe).parse(r):"normalmap"===n.toLowerCase()?this.normal=(new oe).parse(r):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+n+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new oe).parse(r)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new oe).parse(r));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var i=r.querySelectorAll("float");i.length>0&&(this[r.nodeName]=parseFloat(i[0].textContent))}}return this.create(),this},se.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){this.transparent;var r=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;r>0&&(t=!0,e.transparent=!0,e.opacity=1-r)}var i={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var o in this)switch(o){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var s=this[o];if(s instanceof oe)if(s.isTexture()){var l=s.texture,c=this.effect.sampler[l];if(void 0!==c&&void 0!==c.source){var u=this.effect.surface[c.source];if(void 0!==u){var h=f[u.init_from];if(h){var d,p=a+h.init_from,m=n.Loader.Handlers.get(p);null!==m?d=m.load(p):Pe(d=new n.Texture,p),d.wrapS=s.texOpts.wrapU?n.RepeatWrapping:n.ClampToEdgeWrapping,d.wrapT=s.texOpts.wrapV?n.RepeatWrapping:n.ClampToEdgeWrapping,d.offset.x=s.texOpts.offsetU,d.offset.y=s.texOpts.offsetV,d.repeat.x=s.texOpts.repeatU,d.repeat.y=s.texOpts.repeatV,e[i[o]]=d,"emission"===o&&(e.emissive=16777215)}}}}else"diffuse"!==o&&t||("emission"===o?e.emissive=s.color.getHex():e[o]=s.color.getHex());break;case"shininess":e[o]=this[o];break;case"reflectivity":e[o]=this[o],e[o]>0&&(e.envMap=S.defaultEnvMap),e.combine=n.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[o],1!==this[o]&&(e.envMap=S.defaultEnvMap)}switch(e.shading=_,e.side=this.effect.doubleSided?n.DoubleSide:n.FrontSide,void 0!==e.diffuse&&(e.color=e.diffuse,delete e.diffuse),this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new n.MeshBasicMaterial(e);break;case"phong":case"blinn":this.material=new n.MeshPhongMaterial(e);break;case"lambert":default:this.material=new n.MeshLambertMaterial(e)}return this.material},ae.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"init_from":this.init_from=r.textContent;break;case"format":this.format=r.textContent;break;default:console.log("unhandled Surface prop: "+r.nodeName)}}return this},le.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"source":this.source=r.textContent;break;case"minfilter":this.minfilter=r.textContent;break;case"magfilter":this.magfilter=r.textContent;break;case"mipfilter":this.mipfilter=r.textContent;break;case"wrap_s":this.wrap_s=r.textContent;break;case"wrap_t":this.wrap_t=r.textContent;break;default:console.log("unhandled Sampler2D prop: "+r.nodeName)}}return this},ce.prototype.create=function(){if(null===this.shader)return null},ce.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),Oe(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(r))}}return this},ce.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"surface":this.surface[t]=new ae(this).parse(n);break;case"sampler2D":this.sampler[t]=new le(this).parse(n);break;case"extra":break;default:console.log(n.nodeName)}}},ce.prototype.parseProfileCOMMON=function(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseProfileCOMMON(n);break;case"technique":t=n;break;case"newparam":this.parseNewparam(n);break;case"image":var i=(new U).parse(n);f[i.id]=i;break;case"extra":break;default:console.log(n.nodeName)}}return t},ce.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new se(r.nodeName,this).parse(r);break;case"extra":this.parseExtra(r)}}},ce.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique":this.parseExtraTechnique(r)}}},ce.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"bump":this.shader.parse(e)}}},ue.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},he.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"animation":var n=(new he).parse(r);for(var i in n.source)this.source[i]=n.source[i];for(var o=0;o<n.channel.length;o++)this.channel.push(n.channel[o]),this.sampler.push(n.sampler[o]);break;case"source":i=(new ne).parse(r),this.source[i.id]=i;break;case"sampler":this.sampler.push(new pe(this).parse(r));break;case"channel":this.channel.push(new de(this).parse(r))}}return this},de.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),r=(t.shift(),t.shift()),n=r.indexOf(".")>=0,i=r.indexOf("(")>=0;if(n)t=r.split("."),this.sid=t.shift(),this.member=t.shift();else if(i){var o=r.split("(");this.sid=o.shift();for(var s=0;s<o.length;s++)o[s]=parseInt(o[s].replace(/\)/,""));this.arrIndices=o}else this.sid=r;return this.fullSid=r,this.dotSyntax=n,this.arrSyntax=i,this},pe.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"input":this.inputs.push((new re).parse(r))}}return this},pe.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],r=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=r.read();break;case"OUTPUT":this.output=r.read(),this.strideOut=r.accessor.stride;break;case"INTERPOLATION":this.interpolation=r.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){for(this.startTime=1e8,this.endTime=-1e8,e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},pe.prototype.getData=function(e,t,r){var n;if("matrix"===e&&16===this.strideOut)n=this.output[t];else if(this.strideOut>1){n=[],t*=this.strideOut;for(var i=0;i<this.strideOut;++i)n[i]=this.output[t+i];if(3===this.strideOut)switch(e){case"rotate":case"translate":De(n,-1);break;case"scale":De(n,1)}else 4===this.strideOut&&"matrix"===e&&De(n,-1)}else n=this.output[t],r&&"translate"===e&&(n=function(e,t){if(!0!==S.convertUpAxis||M===S.upAxis)return t;switch(e){case"X":t="XtoY"===A?-1*t:t;break;case"Y":t="YtoZ"===A||"YtoX"===A?-1*t:t;break;case"Z":t="ZtoY"===A?-1*t:t}return t}(r,n));return n},fe.prototype.addTarget=function(e,t,r,n){this.targets.push({sid:e,member:r,transform:t,data:n})},fe.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var r=this.targets[t];e&&r.sid!==e||r.transform.update(r.data,r.member)}},fe.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},fe.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},fe.prototype.interpolate=function(e,t){for(var r=0,n=this.targets.length;r<n;r++){var i,o=this.targets[r],s=e.getTarget(o.sid);if("matrix"!==o.transform.type&&s){var a=(t-this.time)/(e.time-this.time),l=s.data,c=o.data;if(a<0&&(a=0),a>1&&(a=1),c.length){i=[];for(var u=0;u<c.length;++u)i[u]=c[u]+(l[u]-c[u])*a}else i=c+(l-c)*a}else i=o.data;o.transform.update(i,o.member)}},me.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"optics":this.parseOptics(r)}}return this},me.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"===e.childNodes[t].nodeName)for(var r=e.childNodes[t],n=0;n<r.childNodes.length;n++)if(this.technique=r.childNodes[n].nodeName,"perspective"===this.technique)for(var i=r.childNodes[n],o=0;o<i.childNodes.length;o++)switch((a=i.childNodes[o]).nodeName){case"yfov":this.yfov=a.textContent;break;case"xfov":this.xfov=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}else if("orthographic"===this.technique){var s=r.childNodes[n];for(o=0;o<s.childNodes.length;o++){var a;switch((a=s.childNodes[o]).nodeName){case"xmag":this.xmag=a.textContent;break;case"ymag":this.ymag=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}}return this},ve.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ge.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r);break;case"technique":this.parseTechnique(r)}}return this},ge.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var r=e.childNodes[t],i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];switch(o.nodeName){case"color":var s=Me(o.textContent);this.color=new n.Color(0),this.color.setRGB(s[0],s[1],s[2]),this.color.a=s[3];break;case"falloff_angle":this.falloff_angle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);this.distance=a?Math.sqrt(1/a):0}}}return this},ge.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"intensity":this.intensity=parseFloat(r.textContent)}}return this},ye.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},xe.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r)}}return this},xe.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(e.childNodes[t].nodeName){case"joint":this.joints.push((new be).parse(r));break;case"link":this.links.push((new we).parse(r))}}return this},be.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.axis=new n.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var t=Me(e.querySelector("axis").textContent);this.axis=Ne(t,0);var r=e.querySelector("limits min")?parseFloat(e.querySelector("limits min").textContent):-360,i=e.querySelector("limits max")?parseFloat(e.querySelector("limits max").textContent):360;this.limits={min:r,max:i};for(var o=["prismatic","revolute"],s=0;s<o.length;s++){var a=o[s];e.querySelector(a)&&(this.type=a)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},we.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"attachment_full":this.attachments.push((new _e).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new H).parse(r))}}return this},_e.prototype.parse=function(e){this.joint=e.getAttribute("joint").split("/").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"link":this.links.push((new we).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new H).parse(r))}}return this},{load:function(e,t,r,n){var i=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState?0!==o.status&&200!==o.status||(o.response?(d=t,E(o.response,void 0,e)):n?n():console.error("ColladaLoader: Empty or non-existing file ("+e+")")):3===o.readyState&&r&&(0===i&&(i=o.getResponseHeader("Content-Length")),r({total:i,loaded:o.responseText.length}))},o.open("GET",e,!0),o.send(null)}else alert("Don't know how to parse XML!")},parse:E,setPreferredShading:function(e){_=e},applySkin:N,geometries:g,options:S}}},"3r+V":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));var o=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r[0]instanceof i.Texture?r[0]:r[0].texture));return o._textures=null,o._durations=null,o.textures=r,o._autoUpdate=!1!==n,o.animationSpeed=1,o.loop=!0,o.onComplete=null,o.onFrameChange=null,o.onLoop=null,o._currentTime=0,o.playing=!1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&i.ticker.shared.remove(this.update,this))},t.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.HIGH))},t.prototype.gotoAndStop=function(e){this.stop();var t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()},t.prototype.gotoAndPlay=function(e){var t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture(),this.play()},t.prototype.update=function(e){var t=this.animationSpeed*e,r=this.currentFrame;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=t/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r?this.onLoop():this.animationSpeed<0&&this.currentFrame>r&&this.onLoop()),this.updateTexture())},t.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this.cachedTint=16777215,this.onFrameChange&&this.onFrameChange(this.currentFrame)},t.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},t.fromFrames=function(e){for(var r=[],n=0;n<e.length;++n)r.push(i.Texture.fromFrame(e[n]));return new t(r)},t.fromImages=function(e){for(var r=[],n=0;n<e.length;++n)r.push(i.Texture.fromImage(e[n]));return new t(r)},n(t,[{key:"totalFrames",get:function(){return this._textures.length}},{key:"textures",get:function(){return this._textures},set:function(e){if(e[0]instanceof i.Texture)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(var t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}this.gotoAndStop(0),this.updateTexture()}},{key:"currentFrame",get:function(){var e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}}]),t}(i.Sprite);t.default=o},4:function(e,t,r){e.exports=r("zUnb")},"45ci":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.global=new i.Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return e.prototype.getLocalPosition=function(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)},e.prototype.copyEvent=function(e){e.isPrimary&&(this.isPrimary=!0),this.button=e.button,this.buttons=Number.isInteger(e.buttons)?e.buttons:e.which,this.width=e.width,this.height=e.height,this.tiltX=e.tiltX,this.tiltY=e.tiltY,this.pointerType=e.pointerType,this.pressure=e.pressure,this.rotationAngle=e.rotationAngle,this.twist=e.twist||0,this.tangentialPressure=e.tangentialPressure||0},e.prototype.reset=function(){this.isPrimary=!1},n(e,[{key:"pointerId",get:function(){return this.identifier}}]),e}();t.default=o},"49sm":function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},"4FaX":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.flush=function(){},t.prototype.render=function(e){},t}(function(e){return e&&e.__esModule?e:{default:e}}(r("Bjwz")).default);t.default=n},"4I2B":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),i=function(e){return e&&e.__esModule?e:{default:e}}(r("sBhT"));var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t}return e.prototype.render=function(e){var t=this.renderer,r=t.context,n=e.worldTransform,o=t.resolution;t.roundPixels?r.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o|0,n.ty*o|0):r.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o,n.ty*o),t.context.globalAlpha=e.worldAlpha,t.setBlendMode(e.blendMode),e.drawMode===i.default.DRAW_MODES.TRIANGLE_MESH?this._renderTriangleMesh(e):this._renderTriangles(e)},e.prototype._renderTriangleMesh=function(e){for(var t=e.vertices.length/2,r=0;r<t-2;r++){var n=2*r;this._renderDrawTriangle(e,n,n+2,n+4)}},e.prototype._renderTriangles=function(e){for(var t=e.indices,r=t.length,n=0;n<r;n+=3){var i=2*t[n],o=2*t[n+1],s=2*t[n+2];this._renderDrawTriangle(e,i,o,s)}},e.prototype._renderDrawTriangle=function(e,t,r,n){var i=this.renderer.context,o=e.uvs,s=e.vertices,a=e._texture;if(a.valid){var l=a.baseTexture,c=l.source,u=l.width,h=l.height,d=void 0,p=void 0,f=void 0,m=void 0,v=void 0,g=void 0;if(e.uploadUvTransform){var y=e._uvTransform.mapCoord;d=(o[t]*y.a+o[t+1]*y.c+y.tx)*l.width,p=(o[r]*y.a+o[r+1]*y.c+y.tx)*l.width,f=(o[n]*y.a+o[n+1]*y.c+y.tx)*l.width,m=(o[t]*y.b+o[t+1]*y.d+y.ty)*l.height,v=(o[r]*y.b+o[r+1]*y.d+y.ty)*l.height,g=(o[n]*y.b+o[n+1]*y.d+y.ty)*l.height}else d=o[t]*l.width,p=o[r]*l.width,f=o[n]*l.width,m=o[t+1]*l.height,v=o[r+1]*l.height,g=o[n+1]*l.height;var x=s[t],b=s[r],w=s[n],_=s[t+1],S=s[r+1],T=s[n+1],M=e.canvasPadding/this.renderer.resolution;if(M>0){var A=M/Math.abs(e.worldTransform.a),E=M/Math.abs(e.worldTransform.d),C=(x+b+w)/3,P=(_+S+T)/3,O=x-C,D=_-P,N=Math.sqrt(O*O+D*D);x=C+O/N*(N+A),_=P+D/N*(N+E),D=S-P,b=C+(O=b-C)/(N=Math.sqrt(O*O+D*D))*(N+A),S=P+D/N*(N+E),D=T-P,w=C+(O=w-C)/(N=Math.sqrt(O*O+D*D))*(N+A),T=P+D/N*(N+E)}i.save(),i.beginPath(),i.moveTo(x,_),i.lineTo(b,S),i.lineTo(w,T),i.closePath(),i.clip();var L=d*v+m*f+p*g-v*f-m*p-d*g,I=x*v+m*w+b*g-v*w-m*b-x*g,R=d*b+x*f+p*w-b*f-x*p-d*w,F=d*v*w+m*b*f+x*p*g-x*v*f-m*p*w-d*b*g,k=_*v+m*T+S*g-v*T-m*S-_*g,U=d*S+_*f+p*T-S*f-_*p-d*T,B=d*v*T+m*S*f+_*p*g-_*v*f-m*p*T-d*S*g;i.transform(I/L,k/L,R/L,U/L,F/L,B/L),i.drawImage(c,0,0,u*l.resolution,h*l.resolution,0,0,u,h),i.restore(),this.renderer.invalidateBlendMode()}},e.prototype.renderMeshFlat=function(e){var t=this.renderer.context,r=e.vertices,n=r.length/2;t.beginPath();for(var i=1;i<n-2;++i){var o=2*i,s=r[o],a=r[o+1],l=r[o+2],c=r[o+3],u=r[o+4],h=r[o+5];t.moveTo(s,a),t.lineTo(l,c),t.lineTo(u,h)}t.fillStyle="#FF0000",t.fill(),t.closePath()},e.prototype.destroy=function(){this.renderer=null},e}();t.default=o,n.CanvasRenderer.registerPlugin("mesh",o)},"4fju":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r("+HqX"));var o=new i.default,s=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._texture=t,this.mapCoord=new i.default,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._lastTextureID=-1,this.clampOffset=0,this.clampMargin=void 0===r?.5:r}return e.prototype.multiplyUvs=function(e,t){void 0===t&&(t=e);for(var r=this.mapCoord,n=0;n<e.length;n+=2){var i=e[n],o=e[n+1];t[n]=i*r.a+o*r.c+r.tx,t[n+1]=i*r.b+o*r.d+r.ty}return t},e.prototype.update=function(e){var t=this._texture;if(!t||!t.valid)return!1;if(!e&&this._lastTextureID===t._updateID)return!1;this._lastTextureID=t._updateID;var r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=t.orig,i=t.trim;i&&(o.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(o));var s=t.baseTexture,a=this.uClampFrame,l=this.clampMargin/s.resolution,c=this.clampOffset;return a[0]=(t._frame.x+l+c)/s.width,a[1]=(t._frame.y+l+c)/s.height,a[2]=(t._frame.x+t._frame.width-l+c)/s.width,a[3]=(t._frame.y+t._frame.height-l+c)/s.height,this.uClampOffset[0]=c/s.realWidth,this.uClampOffset[1]=c/s.realHeight,!0},n(e,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture=e,this._lastTextureID=-1}}]),e}();t.default=s},"4miC":function(e,t,r){"use strict";t.__esModule=!0,t.default={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(e){e?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0}},"4o2V":function(e,t,r){"use strict";t.__esModule=!0;var n=p(r("4FaX")),i=p(r("pV5o")),o=p(r("TyRm")),s=p(r("xD7H")),a=p(r("TRZq")),l=p(r("3LRy")),c=p(r("Yd/J")),u=r("qp2T"),h=p(r("yI/K")),d=p(r("pIo5"));function p(e){return e&&e.__esModule?e:{default:e}}var f=0,m=0,v=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));n.vertSize=5,n.vertByteSize=4*n.vertSize,n.size=c.default.SPRITE_BATCH_SIZE,n.buffers=[];for(var i=1;i<=d.default.nextPow2(n.size);i*=2)n.buffers.push(new l.default(4*i*n.vertByteSize));n.indices=(0,o.default)(n.size),n.shader=null,n.currentIndex=0,n.groups=[];for(var s=0;s<n.size;s++)n.groups[s]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};return n.sprites=[],n.vertexBuffers=[],n.vaos=[],n.vaoMax=2,n.vertexCount=0,n.renderer.on("prerender",n.onPrerender,n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.renderer.legacy?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c.default.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=(0,a.default)(this.MAX_TEXTURES,e)),this.shader=(0,s.default)(e,this.MAX_TEXTURES),this.indexBuffer=h.default.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.renderer.bindVao(null);for(var t=this.shader.attributes,r=0;r<this.vaoMax;r++){var n=this.vertexBuffers[r]=h.default.GLBuffer.createVertexBuffer(e,null,e.STREAM_DRAW),i=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(n,t.aVertexPosition,e.FLOAT,!1,this.vertByteSize,0).addAttribute(n,t.aTextureCoord,e.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(n,t.aColor,e.UNSIGNED_BYTE,!0,this.vertByteSize,12);t.aTextureId&&i.addAttribute(n,t.aTextureId,e.FLOAT,!1,this.vertByteSize,16),this.vaos[r]=i}this.vao=this.vaos[0],this.currentBlendMode=99999,this.boundTextures=new Array(this.MAX_TEXTURES)},t.prototype.onPrerender=function(){this.vertexCount=0},t.prototype.render=function(e){this.currentIndex>=this.size&&this.flush(),e._texture._uvs&&(this.sprites[this.currentIndex++]=e)},t.prototype.flush=function(){if(0!==this.currentIndex){var e=this.renderer.gl,t=this.MAX_TEXTURES,r=d.default.nextPow2(this.currentIndex),n=d.default.log2(r),i=this.buffers[n],o=this.sprites,s=this.groups,a=i.float32View,l=i.uint32View,p=this.boundTextures,v=this.renderer.boundTextures,g=this.renderer.textureGC.count,y=0,x=void 0,b=void 0,w=1,_=0,S=s[0],T=void 0,M=void 0,A=u.premultiplyBlendMode[o[0]._texture.baseTexture.premultipliedAlpha?1:0][o[0].blendMode];S.textureCount=0,S.start=0,S.blend=A,f++;var E=void 0;for(E=0;E<t;++E){var C=v[E];C._enabled!==f?(p[E]=C,C._virtalBoundId=E,C._enabled=f):p[E]=this.renderer.emptyTextures[E]}for(f++,E=0;E<this.currentIndex;++E){var P=o[E];x=P._texture.baseTexture;var O=u.premultiplyBlendMode[Number(x.premultipliedAlpha)][P.blendMode];if(A!==O&&(A=O,b=null,_=t,f++),b!==x&&(b=x,x._enabled!==f)){if(_===t&&(f++,S.size=E-S.start,_=0,(S=s[w++]).blend=A,S.textureCount=0,S.start=E),x.touched=g,-1===x._virtalBoundId)for(var D=0;D<t;++D){var N=(D+m)%t,L=p[N];if(L._enabled!==f){m++,L._virtalBoundId=-1,x._virtalBoundId=N,p[N]=x;break}}x._enabled=f,S.textureCount++,S.ids[_]=x._virtalBoundId,S.textures[_++]=x}if(T=P.vertexData,M=P._texture._uvs.uvsUint32,this.renderer.roundPixels){var I=this.renderer.resolution;a[y]=(T[0]*I|0)/I,a[y+1]=(T[1]*I|0)/I,a[y+5]=(T[2]*I|0)/I,a[y+6]=(T[3]*I|0)/I,a[y+10]=(T[4]*I|0)/I,a[y+11]=(T[5]*I|0)/I,a[y+15]=(T[6]*I|0)/I,a[y+16]=(T[7]*I|0)/I}else a[y]=T[0],a[y+1]=T[1],a[y+5]=T[2],a[y+6]=T[3],a[y+10]=T[4],a[y+11]=T[5],a[y+15]=T[6],a[y+16]=T[7];l[y+2]=M[0],l[y+7]=M[1],l[y+12]=M[2],l[y+17]=M[3];var R=Math.min(P.worldAlpha,1),F=R<1&&x.premultipliedAlpha?(0,u.premultiplyTint)(P._tintRGB,R):P._tintRGB+(255*R<<24);l[y+3]=l[y+8]=l[y+13]=l[y+18]=F,a[y+4]=a[y+9]=a[y+14]=a[y+19]=x._virtalBoundId,y+=20}if(S.size=E-S.start,c.default.CAN_UPLOAD_SAME_BUFFER)this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!0);else{if(this.vaoMax<=this.vertexCount){this.vaoMax++;var k=this.shader.attributes,U=this.vertexBuffers[this.vertexCount]=h.default.GLBuffer.createVertexBuffer(e,null,e.STREAM_DRAW),B=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(U,k.aVertexPosition,e.FLOAT,!1,this.vertByteSize,0).addAttribute(U,k.aTextureCoord,e.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(U,k.aColor,e.UNSIGNED_BYTE,!0,this.vertByteSize,12);k.aTextureId&&B.addAttribute(U,k.aTextureId,e.FLOAT,!1,this.vertByteSize,16),this.vaos[this.vertexCount]=B}this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!1),this.vertexCount++}for(E=0;E<t;++E)v[E]._virtalBoundId=-1;for(E=0;E<w;++E){for(var j=s[E],z=j.textureCount,V=0;V<z;V++)b=j.textures[V],v[j.ids[V]]!==b&&this.renderer.bindTexture(b,j.ids[V],!0),b._virtalBoundId=-1;this.renderer.state.setBlendMode(j.blend),e.drawElements(e.TRIANGLES,6*j.size,e.UNSIGNED_SHORT,6*j.start*2)}this.currentIndex=0}},t.prototype.start=function(){this.renderer.bindShader(this.shader),c.default.CAN_UPLOAD_SAME_BUFFER&&(this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].bind())},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var t=0;t<this.vaoMax;t++)this.vertexBuffers[t]&&this.vertexBuffers[t].destroy(),this.vaos[t]&&this.vaos[t].destroy();this.indexBuffer&&this.indexBuffer.destroy(),this.renderer.off("prerender",this.onPrerender,this),e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null;for(var r=0;r<this.buffers.length;++r)this.buffers[r].destroy()},t}(n.default);t.default=v,i.default.registerPlugin("sprite",v)},"5OzF":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t,r){e.nativeLines?function(e,t){var r=0,n=e.points;if(0===n.length)return;var o=t.points,s=n.length/2,a=(0,i.hex2rgb)(e.lineColor),l=e.lineAlpha,c=a[0]*l,u=a[1]*l,h=a[2]*l;for(r=1;r<s;r++){var d=n[2*(r-1)],p=n[2*(r-1)+1],f=n[2*r],m=n[2*r+1];o.push(d,p),o.push(c,u,h,l),o.push(f,m),o.push(c,u,h,l)}}(e,r):function(e,t){var r=e.points;if(0===r.length)return;var o=new n.Point(r[0],r[1]),s=new n.Point(r[r.length-2],r[r.length-1]);if(o.x===s.x&&o.y===s.y){(r=r.slice()).pop(),r.pop();var a=(s=new n.Point(r[r.length-2],r[r.length-1])).x+.5*(o.x-s.x),l=s.y+.5*(o.y-s.y);r.unshift(a,l),r.push(a,l)}var c=t.points,u=t.indices,h=r.length/2,d=r.length,p=c.length/6,f=e.lineWidth/2,m=(0,i.hex2rgb)(e.lineColor),v=e.lineAlpha,g=m[0]*v,y=m[1]*v,x=m[2]*v,b=r[0],w=r[1],_=r[2],S=r[3],T=0,M=0,A=-(w-S),E=b-_,C=0,P=0,O=0,D=0,N=Math.sqrt(A*A+E*E);A/=N,E/=N,A*=f,E*=f,c.push(b-A,w-E,g,y,x,v),c.push(b+A,w+E,g,y,x,v);for(var L=1;L<h-1;++L){b=r[2*(L-1)],w=r[2*(L-1)+1],_=r[2*L],S=r[2*L+1],T=r[2*(L+1)],M=r[2*(L+1)+1],A=-(w-S),E=b-_,N=Math.sqrt(A*A+E*E),A/=N,E/=N,A*=f,E*=f,C=-(S-M),P=_-T,N=Math.sqrt(C*C+P*P),C/=N,P/=N;var I=-E+w-(-E+S),R=-A+_-(-A+b),F=(-A+b)*(-E+S)-(-A+_)*(-E+w),k=-(P*=f)+M-(-P+S),U=-(C*=f)+_-(-C+T),B=(-C+T)*(-P+S)-(-C+_)*(-P+M),j=I*U-k*R;if(Math.abs(j)<.1)j+=10.1,c.push(_-A,S-E,g,y,x,v),c.push(_+A,S+E,g,y,x,v);else{var z=(R*B-U*F)/j,V=(k*F-I*B)/j,G=(z-_)*(z-_)+(V-S)*(V-S);G>196*f*f?(O=A-C,D=E-P,N=Math.sqrt(O*O+D*D),O/=N,D/=N,O*=f,D*=f,c.push(_-O,S-D),c.push(g,y,x,v),c.push(_+O,S+D),c.push(g,y,x,v),c.push(_-O,S-D),c.push(g,y,x,v),d++):(c.push(z,V),c.push(g,y,x,v),c.push(_-(z-_),S-(V-S)),c.push(g,y,x,v))}}b=r[2*(h-2)],w=r[2*(h-2)+1],_=r[2*(h-1)],S=r[2*(h-1)+1],A=-(w-S),E=b-_,N=Math.sqrt(A*A+E*E),A/=N,E/=N,A*=f,E*=f,c.push(_-A,S-E),c.push(g,y,x,v),c.push(_+A,S+E),c.push(g,y,x,v),u.push(p);for(var H=0;H<d;++H)u.push(p++);u.push(p-1)}(e,t)};var n=r("d07J"),i=r("qp2T")},"5dPP":function(e,t,r){"use strict";t.__esModule=!0;var n=f(r("a/Ns")),i=f(r("eIHw")),o=f(r("xJsK")),s=f(r("APSF")),a=f(r("jQCb")),l=r("d07J"),c=r("qp2T"),u=r("pQYt"),h=f(r("sAjT")),d=f(r("jE0j")),p=f(r("pVcz"));function f(e){return e&&e.__esModule?e:{default:e}}var m=void 0,v=new l.Matrix,g=new l.Point,y=new Float32Array(4),x=new Float32Array(4),b=function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return n.fillAlpha=1,n.lineWidth=0,n.nativeLines=r,n.lineColor=0,n.graphicsData=[],n.tint=16777215,n._prevTint=16777215,n.blendMode=u.BLEND_MODES.NORMAL,n.currentPath=null,n._webGL={},n.isMask=!1,n.boundsPadding=0,n._localBounds=new h.default,n.dirty=0,n.fastRectDirty=-1,n.clearDirty=0,n.boundsDirty=-1,n.cachedSpriteDirty=!1,n._spriteRect=null,n._fastRect=!1,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.clone=function(){var e=new t;e.renderable=this.renderable,e.fillAlpha=this.fillAlpha,e.lineWidth=this.lineWidth,e.lineColor=this.lineColor,e.tint=this.tint,e.blendMode=this.blendMode,e.isMask=this.isMask,e.boundsPadding=this.boundsPadding,e.dirty=0,e.cachedSpriteDirty=this.cachedSpriteDirty;for(var r=0;r<this.graphicsData.length;++r)e.graphicsData.push(this.graphicsData[r].clone());return e.currentPath=e.graphicsData[e.graphicsData.length-1],e.updateLocalBounds(),e},t.prototype.lineStyle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.lineWidth=e,this.lineColor=t,this.lineAlpha=r,this.currentPath)if(this.currentPath.shape.points.length){var n=new l.Polygon(this.currentPath.shape.points.slice(-2));n.closed=!1,this.drawShape(n)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},t.prototype.moveTo=function(e,t){var r=new l.Polygon([e,t]);return r.closed=!1,this.drawShape(r),this},t.prototype.lineTo=function(e,t){return this.currentPath.shape.points.push(e,t),this.dirty++,this},t.prototype.quadraticCurveTo=function(e,t,r,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var i=this.currentPath.shape.points,o=0,s=0;0===i.length&&this.moveTo(0,0);for(var a=i[i.length-2],l=i[i.length-1],c=1;c<=20;++c){var u=c/20;o=a+(e-a)*u,s=l+(t-l)*u,i.push(o+(e+(r-e)*u-o)*u,s+(t+(n-t)*u-s)*u)}return this.dirty++,this},t.prototype.bezierCurveTo=function(e,t,r,n,i,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s=this.currentPath.shape.points,a=s[s.length-2],l=s[s.length-1];return s.length-=2,(0,d.default)(a,l,e,t,r,n,i,o,s),this.dirty++,this},t.prototype.arcTo=function(e,t,r,n,i){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(e,t):this.moveTo(e,t);var o=this.currentPath.shape.points,s=o[o.length-2],a=o[o.length-1]-t,l=s-e,c=n-t,u=r-e,h=Math.abs(a*u-l*c);if(h<1e-8||0===i)o[o.length-2]===e&&o[o.length-1]===t||o.push(e,t);else{var d=a*a+l*l,p=c*c+u*u,f=a*c+l*u,m=i*Math.sqrt(d)/h,v=i*Math.sqrt(p)/h,g=m*f/d,y=v*f/p,x=m*u+v*l,b=m*c+v*a,w=l*(v+g),_=a*(v+g),S=u*(m+y),T=c*(m+y),M=Math.atan2(_-b,w-x),A=Math.atan2(T-b,S-x);this.arc(x+e,b+t,i,M,A,l*c>u*a)}return this.dirty++,this},t.prototype.arc=function(e,t,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(n===i)return this;!o&&i<=n?i+=u.PI_2:o&&n<=i&&(n+=u.PI_2);var s=i-n,a=40*Math.ceil(Math.abs(s)/u.PI_2);if(0===s)return this;var l=e+Math.cos(n)*r,c=t+Math.sin(n)*r,h=this.currentPath?this.currentPath.shape.points:null;h?h[h.length-2]===l&&h[h.length-1]===c||h.push(l,c):(this.moveTo(l,c),h=this.currentPath.shape.points);for(var d=s/(2*a),p=2*d,f=Math.cos(d),m=Math.sin(d),v=a-1,g=v%1/v,y=0;y<=v;++y){var x=d+n+p*(y+g*y),b=Math.cos(x),w=-Math.sin(x);h.push((f*b+m*w)*r+e,(f*-w+m*b)*r+t)}return this.dirty++,this},t.prototype.beginFill=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.filling=!0,this.fillColor=e,this.fillAlpha=t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},t.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.prototype.drawRect=function(e,t,r,n){return this.drawShape(new l.Rectangle(e,t,r,n)),this},t.prototype.drawRoundedRect=function(e,t,r,n,i){return this.drawShape(new l.RoundedRectangle(e,t,r,n,i)),this},t.prototype.drawCircle=function(e,t,r){return this.drawShape(new l.Circle(e,t,r)),this},t.prototype.drawEllipse=function(e,t,r,n){return this.drawShape(new l.Ellipse(e,t,r,n)),this},t.prototype.drawPolygon=function(e){var t=e,r=!0;if(t instanceof l.Polygon&&(r=t.closed,t=t.points),!Array.isArray(t)){t=new Array(arguments.length);for(var n=0;n<t.length;++n)t[n]=arguments[n]}var i=new l.Polygon(t);return i.closed=r,this.drawShape(i),this},t.prototype.drawStar=function(e,t,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;i=i||n/2;for(var s=-1*Math.PI/2+o,a=2*r,l=u.PI_2/a,c=[],h=0;h<a;h++){var d=h%2?i:n,p=h*l+s;c.push(e+d*Math.cos(p),t+d*Math.sin(p))}return this.drawPolygon(c)},t.prototype.clear=function(){return(this.lineWidth||this.filling||this.graphicsData.length>0)&&(this.lineWidth=0,this.filling=!1,this.boundsDirty=-1,this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this._spriteRect=null,this},t.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===u.SHAPES.RECT&&!this.graphicsData[0].lineWidth},t.prototype._renderWebGL=function(e){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect()),this._fastRect?this._renderSpriteRect(e):(e.setObjectRenderer(e.plugins.graphics),e.plugins.graphics.render(this))},t.prototype._renderSpriteRect=function(e){var t=this.graphicsData[0].shape;this._spriteRect||(this._spriteRect=new a.default(new o.default(o.default.WHITE)));var r=this._spriteRect;if(16777215===this.tint)r.tint=this.graphicsData[0].fillColor;else{var n=y,i=x;(0,c.hex2rgb)(this.graphicsData[0].fillColor,n),(0,c.hex2rgb)(this.tint,i),n[0]*=i[0],n[1]*=i[1],n[2]*=i[2],r.tint=(0,c.rgb2hex)(n)}r.alpha=this.graphicsData[0].fillAlpha,r.worldAlpha=this.worldAlpha*r.alpha,r.blendMode=this.blendMode,r._texture._frame.width=t.width,r._texture._frame.height=t.height,r.transform.worldTransform=this.transform.worldTransform,r.anchor.set(-t.x/t.width,-t.y/t.height),r._onAnchorUpdate(),r._renderWebGL(e)},t.prototype._renderCanvas=function(e){!0!==this.isMask&&e.plugins.graphics.render(this)},t.prototype._calculateBounds=function(){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.cachedSpriteDirty=!0);var e=this._localBounds;this._bounds.addFrame(this.transform,e.minX,e.minY,e.maxX,e.maxY)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,g);for(var t=this.graphicsData,r=0;r<t.length;++r){var n=t[r];if(n.fill&&(n.shape&&n.shape.contains(g.x,g.y))){if(n.holes)for(var i=0;i<n.holes.length;i++){if(n.holes[i].contains(g.x,g.y))return!1}return!0}}return!1},t.prototype.updateLocalBounds=function(){var e=1/0,t=-1/0,r=1/0,n=-1/0;if(this.graphicsData.length)for(var i=0,o=0,s=0,a=0,l=0,c=0;c<this.graphicsData.length;c++){var h=this.graphicsData[c],d=h.type,p=h.lineWidth;if(i=h.shape,d===u.SHAPES.RECT||d===u.SHAPES.RREC)o=i.x-p/2,s=i.y-p/2,a=i.width+p,l=i.height+p,e=o<e?o:e,t=o+a>t?o+a:t,r=s<r?s:r,n=s+l>n?s+l:n;else if(d===u.SHAPES.CIRC)o=i.x,s=i.y,a=i.radius+p/2,l=i.radius+p/2,e=o-a<e?o-a:e,t=o+a>t?o+a:t,r=s-l<r?s-l:r,n=s+l>n?s+l:n;else if(d===u.SHAPES.ELIP)o=i.x,s=i.y,a=i.width+p/2,l=i.height+p/2,e=o-a<e?o-a:e,t=o+a>t?o+a:t,r=s-l<r?s-l:r,n=s+l>n?s+l:n;else for(var f=i.points,m=0,v=0,g=0,y=0,x=0,b=0,w=0,_=0,S=0;S+2<f.length;S+=2)o=f[S],s=f[S+1],m=f[S+2],v=f[S+3],g=Math.abs(m-o),y=Math.abs(v-s),l=p,(a=Math.sqrt(g*g+y*y))<1e-9||(b=(l/a*g+y)/2,_=(v+s)/2,e=(w=(m+o)/2)-(x=(l/a*y+g)/2)<e?w-x:e,t=w+x>t?w+x:t,r=_-b<r?_-b:r,n=_+b>n?_+b:n)}else e=0,t=0,r=0,n=0;var T=this.boundsPadding;this._localBounds.minX=e-T,this._localBounds.maxX=t+T,this._localBounds.minY=r-T,this._localBounds.maxY=n+T},t.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var t=new s.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,e);return this.graphicsData.push(t),t.type===u.SHAPES.POLY&&(t.shape.closed=t.shape.closed||this.filling,this.currentPath=t),this.dirty++,t},t.prototype.generateCanvasTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=this.getLocalBounds(),n=i.default.create(r.width,r.height,e,t);m||(m=new p.default),this.transform.updateLocalTransform(),this.transform.localTransform.copy(v),v.invert(),v.tx-=r.x,v.ty-=r.y,m.render(this,n,!0,v);var s=o.default.fromCanvas(n.baseTexture._canvasRenderTarget.canvas,e,"graphics");return s.baseTexture.resolution=t,s.baseTexture.update(),s},t.prototype.closePath=function(){var e=this.currentPath;return e&&e.shape&&e.shape.close(),this},t.prototype.addHole=function(){var e=this.graphicsData.pop();return this.currentPath=this.graphicsData[this.graphicsData.length-1],this.currentPath.addHole(e.shape),this.currentPath=null,this},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t);for(var r=0;r<this.graphicsData.length;++r)this.graphicsData[r].destroy();for(var n in this._webgl)for(var i=0;i<this._webgl[n].data.length;++i)this._webgl[n].data[i].destroy();this._spriteRect&&this._spriteRect.destroy(),this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null},t}(n.default);t.default=b,b._SPRITE_TEXTURE=null},"5ekA":function(e,t,r){"use strict";t.__esModule=!0;var n=r("Tt2x");Object.defineProperty(t,"webgl",{enumerable:!0,get:function(){return o(n).default}});var i=r("26zZ");function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"canvas",{enumerable:!0,get:function(){return o(i).default}})},"6MUB":function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,i){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(i){var o=encodeURIComponent(n(i))+r;return Array.isArray(e[i])?e[i].map(function(e){return o+encodeURIComponent(n(e))}).join(t):o+encodeURIComponent(n(e[i]))}).join(t):i?encodeURIComponent(n(i))+r+encodeURIComponent(n(e)):""}},"7AYe":function(e,t,r){var n=r("koBt"),i=r("ujOt"),o=function(e,t,r,n){gl.vertexAttribPointer(this.location,this.size,e||gl.FLOAT,t||!1,r||0,n||0)};e.exports=function(e,t){for(var r={},s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<s;a++){var l=e.getActiveAttrib(t,a),c=n(e,l.type);r[l.name]={type:c,size:i(c),location:e.getAttribLocation(t,l.name),pointer:o}}return r}},"7JTu":function(e,t,r){"use strict";t.__esModule=!0;var n=r("qp2T"),i=r("pQYt"),o=p(r("4FaX")),s=p(r("pV5o")),a=p(r("fOGm")),l=p(r("DuEz")),c=p(r("KvbZ")),u=p(r("MjLO")),h=p(r("yY4z")),d=p(r("aq8N"));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.graphicsDataPool=[],n.primitiveShader=null,n.gl=r.gl,n.CONTEXT_UID=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onContextChange=function(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.primitiveShader=new l.default(this.gl)},t.prototype.destroy=function(){o.default.prototype.destroy.call(this);for(var e=0;e<this.graphicsDataPool.length;++e)this.graphicsDataPool[e].destroy();this.graphicsDataPool=null},t.prototype.render=function(e){var t=this.renderer,r=t.gl,i=void 0,o=e._webGL[this.CONTEXT_UID];o&&e.dirty===o.dirty||(this.updateGraphics(e),o=e._webGL[this.CONTEXT_UID]);var s=this.primitiveShader;t.bindShader(s),t.state.setBlendMode(e.blendMode);for(var a=0,l=o.data.length;a<l;a++){var c=(i=o.data[a]).shader;t.bindShader(c),c.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),c.uniforms.tint=(0,n.hex2rgb)(e.tint),c.uniforms.alpha=e.worldAlpha,t.bindVao(i.vao),i.nativeLines?r.drawArrays(r.LINES,0,i.points.length/6):i.vao.draw(r.TRIANGLE_STRIP,i.indices.length)}},t.prototype.updateGraphics=function(e){var t=this.renderer.gl,r=e._webGL[this.CONTEXT_UID];if(r||(r=e._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:t,clearDirty:-1,dirty:-1}),r.dirty=e.dirty,e.clearDirty!==r.clearDirty){r.clearDirty=e.clearDirty;for(var n=0;n<r.data.length;n++)this.graphicsDataPool.push(r.data[n]);r.data.length=0,r.lastIndex=0}for(var o=void 0,s=void 0,a=r.lastIndex;a<e.graphicsData.length;a++){var l=e.graphicsData[a];o=this.getWebGLData(r,0),l.nativeLines&&l.lineWidth&&(s=this.getWebGLData(r,0,!0),r.lastIndex++),l.type===i.SHAPES.POLY&&(0,c.default)(l,o,s),l.type===i.SHAPES.RECT?(0,u.default)(l,o,s):l.type===i.SHAPES.CIRC||l.type===i.SHAPES.ELIP?(0,d.default)(l,o,s):l.type===i.SHAPES.RREC&&(0,h.default)(l,o,s),r.lastIndex++}this.renderer.bindVao(null);for(var p=0;p<r.data.length;p++)(o=r.data[p]).dirty&&o.upload()},t.prototype.getWebGLData=function(e,t,r){var n=e.data[e.data.length-1];return(!n||n.nativeLines!==r||n.points.length>32e4)&&((n=this.graphicsDataPool.pop()||new a.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState)).nativeLines=r,n.reset(t),e.data.push(n)),n.dirty=!0,n},t}(o.default);t.default=f,s.default.registerPlugin("graphics",f)},"7jRU":function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},"8WrO":function(e,t,r){"use strict";t.__esModule=!0;var n=r("d07J"),i=r("pQYt"),o=function(e){return e&&e.__esModule?e:{default:e}}(r("Yd/J")),s=r("yI/K");var a=function(){function e(t,r,a,l,c,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.frameBuffer=null,this.texture=null,this.clearColor=[0,0,0,0],this.size=new n.Rectangle(0,0,1,1),this.resolution=c||o.default.RESOLUTION,this.projectionMatrix=new n.Matrix,this.transform=null,this.frame=null,this.defaultFrame=new n.Rectangle,this.destinationFrame=null,this.sourceFrame=null,this.stencilBuffer=null,this.stencilMaskStack=[],this.filterData=null,this.scaleMode=void 0!==l?l:o.default.SCALE_MODE,this.root=u,this.root?(this.frameBuffer=new s.GLFramebuffer(t,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=s.GLFramebuffer.createRGBA(t,100,100),this.scaleMode===i.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture),this.setFrame(),this.resize(r,a)}return e.prototype.clear=function(e){var t=e||this.clearColor;this.frameBuffer.clear(t[0],t[1],t[2],t[3])},e.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()},e.prototype.setFrame=function(e,t){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||this.destinationFrame},e.prototype.activate=function(){var e=this.gl;this.frameBuffer.bind(),this.calculateProjection(this.destinationFrame,this.sourceFrame),this.transform&&this.projectionMatrix.append(this.transform),this.destinationFrame!==this.sourceFrame?(e.enable(e.SCISSOR_TEST),e.scissor(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):e.disable(e.SCISSOR_TEST),e.viewport(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)},e.prototype.calculateProjection=function(e,t){var r=this.projectionMatrix;t=t||e,r.identity(),this.root?(r.a=1/e.width*2,r.d=-1/e.height*2,r.tx=-1-t.x*r.a,r.ty=1-t.y*r.d):(r.a=1/e.width*2,r.d=1/e.height*2,r.tx=-1-t.x*r.a,r.ty=-1-t.y*r.d)},e.prototype.resize=function(e,t){if(e|=0,t|=0,this.size.width!==e||this.size.height!==t){this.size.width=e,this.size.height=t,this.defaultFrame.width=e,this.defaultFrame.height=t,this.frameBuffer.resize(e*this.resolution,t*this.resolution);var r=this.frame||this.size;this.calculateProjection(r)}},e.prototype.destroy=function(){this.frameBuffer.destroy(),this.frameBuffer=null,this.texture=null},e}();t.default=a},"8eTQ":function(e,t,r){"use strict";var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));n.DisplayObject.prototype.getGlobalPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n.Point,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e}},"8g3p":function(e,t,r){"use strict";t.__esModule=!0,t.Ticker=t.shared=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("NO7c"));var i=new n.default;i.autoStart=!0,i.destroy=function(){},t.shared=i,t.Ticker=n.default},"963y":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("/zO6"));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsUint32=new Uint32Array(4)}return e.prototype.set=function(e,t,r){var i=t.width,o=t.height;if(r){var s=e.width/2/i,a=e.height/2/o,l=e.x/i+s,c=e.y/o+a;r=n.default.add(r,n.default.NW),this.x0=l+s*n.default.uX(r),this.y0=c+a*n.default.uY(r),r=n.default.add(r,2),this.x1=l+s*n.default.uX(r),this.y1=c+a*n.default.uY(r),r=n.default.add(r,2),this.x2=l+s*n.default.uX(r),this.y2=c+a*n.default.uY(r),r=n.default.add(r,2),this.x3=l+s*n.default.uX(r),this.y3=c+a*n.default.uY(r)}else this.x0=e.x/i,this.y0=e.y/o,this.x1=(e.x+e.width)/i,this.y1=e.y/o,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/o,this.x3=e.x/i,this.y3=(e.y+e.height)/o;this.uvsUint32[0]=(65535*this.y0&65535)<<16|65535*this.x0&65535,this.uvsUint32[1]=(65535*this.y1&65535)<<16|65535*this.x1&65535,this.uvsUint32[2]=(65535*this.y2&65535)<<16|65535*this.x2&65535,this.uvsUint32[3]=(65535*this.y3&65535)<<16|65535*this.x3&65535},e}();t.default=i},"984s":function(e,t,r){var n=r("koBt"),i=r("rI9z");e.exports=function(e,t){for(var r={},o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),s=0;s<o;s++){var a=e.getActiveUniform(t,s),l=a.name.replace(/\[.*?\]/,""),c=n(e,a.type);r[l]={type:c,size:a.size,location:e.getUniformLocation(t,l),value:i(c,a.size)}}return r}},"9I6j":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){e.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}},"9PbN":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("Bjwz"));var i=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.stencilMaskStack=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.setMaskStack=function(e){this.stencilMaskStack=e;var t=this.renderer.gl;0===e.length?t.disable(t.STENCIL_TEST):t.enable(t.STENCIL_TEST)},t.prototype.pushStencil=function(e){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.renderer._activeRenderTarget.attachStencilBuffer();var t=this.renderer.gl,r=this.stencilMaskStack.length;0===r&&t.enable(t.STENCIL_TEST),this.stencilMaskStack.push(e),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.EQUAL,r,this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.INCR),this.renderer.plugins.graphics.render(e),this._useCurrent()},t.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var e=this.renderer.gl,t=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),this.renderer.plugins.graphics.render(t),this._useCurrent())},t.prototype._useCurrent=function(){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},t.prototype.destroy=function(){n.default.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},t}(n.default);t.default=i},"9a93":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){function t(r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   vec2 v = vec2(x, y);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  gl_FragColor = color;","}"].join("\n")))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){return e&&e.__esModule?e:{default:e}}(r("N0WC")).default);t.default=n},APSF:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t,r,n,i,o,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lineWidth=t,this.nativeLines=a,this.lineColor=r,this.lineAlpha=n,this._lineTint=r,this.fillColor=i,this.fillAlpha=o,this._fillTint=i,this.fill=s,this.holes=[],this.shape=l,this.type=l.type}return e.prototype.clone=function(){return new e(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape)},e.prototype.addHole=function(e){this.holes.push(e)},e.prototype.destroy=function(){this.shape=null,this.holes=null},e}();t.default=n},ASAs:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=l(r("c/UO")),s=l(r("p6KW")),a=l(r("FLfE"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(r,n,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l=l||5;var c=(0,o.default)(l,!1),u=(0,s.default)(l),h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,c,u));return h.resolution=a||i.settings.RESOLUTION,h._quality=0,h.quality=n||4,h.strength=r||8,h.firstRun=!0,h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.apply=function(e,t,r,n){if(this.firstRun){var i=e.renderer.gl,l=(0,a.default)(i);this.vertexSrc=(0,o.default)(l,!1),this.fragmentSrc=(0,s.default)(l),this.firstRun=!1}if(this.uniforms.strength=1/r.size.height*(r.size.height/t.size.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,r,n);else{for(var c=e.getRenderTarget(!0),u=t,h=c,d=0;d<this.passes-1;d++){e.applyFilter(this,u,h,!0);var p=h;h=u,u=p}e.applyFilter(this,u,r,n),e.returnRenderTarget(c)}},n(t,[{key:"blur",get:function(){return this.strength},set:function(e){this.padding=2*Math.abs(e),this.strength=e}},{key:"quality",get:function(){return this._quality},set:function(e){this._quality=e,this.passes=e}}]),t}(i.Filter);t.default=c},AdPF:function(e,t,r){var n=r("yeub");e.exports=function(e){var t=e.xdomain,r=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(e){}if(!t)try{return new(global[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},Aplp:function(e,t,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},a=0,l=0;function c(e){var t="";do{t=i[e%o]+t,e=Math.floor(e/o)}while(e>0);return t}function u(){var e=c(+new Date);return e!==n?(a=0,n=e):e+"."+c(a++)}for(;l<o;l++)s[i[l]]=l;u.encode=c,u.decode=function(e){var t=0;for(l=0;l<e.length;l++)t=t*o+s[e.charAt(l)];return t},e.exports=u},B7f1:function(e,t){var r=function(e,t,r,n,i){this.gl=e,this.texture=e.createTexture(),this.mipmap=!1,this.premultiplyAlpha=!1,this.width=t||-1,this.height=r||-1,this.format=n||e.RGBA,this.type=i||e.UNSIGNED_BYTE};r.prototype.upload=function(e){this.bind();var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var r=e.videoWidth||e.width,n=e.videoHeight||e.height;n!==this.height||r!==this.width?t.texImage2D(t.TEXTURE_2D,0,this.format,this.format,this.type,e):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.format,this.type,e),this.width=r,this.height=n};var n=!1;r.prototype.uploadData=function(e,t,r){this.bind();var i=this.gl;if(e instanceof Float32Array){if(!n){if(!i.getExtension("OES_texture_float"))throw new Error("floating point textures not available");n=!0}this.type=i.FLOAT}else this.type=this.type||i.UNSIGNED_BYTE;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t!==this.width||r!==this.height?i.texImage2D(i.TEXTURE_2D,0,this.format,t,r,0,this.format,this.type,e||null):i.texSubImage2D(i.TEXTURE_2D,0,0,0,t,r,this.format,this.type,e||null),this.width=t,this.height=r},r.prototype.bind=function(e){var t=this.gl;void 0!==e&&t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)},r.prototype.unbind=function(){var e=this.gl;e.bindTexture(e.TEXTURE_2D,null)},r.prototype.minFilter=function(e){var t=this.gl;this.bind(),this.mipmap?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e?t.LINEAR:t.NEAREST)},r.prototype.magFilter=function(e){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e?t.LINEAR:t.NEAREST)},r.prototype.enableMipmap=function(){var e=this.gl;this.bind(),this.mipmap=!0,e.generateMipmap(e.TEXTURE_2D)},r.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},r.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},r.prototype.enableWrapClamp=function(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)},r.prototype.enableWrapRepeat=function(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)},r.prototype.enableWrapMirrorRepeat=function(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)},r.prototype.destroy=function(){this.gl.deleteTexture(this.texture)},r.fromSource=function(e,t,n){var i=new r(e);return i.premultiplyAlpha=n||!1,i.upload(t),i},r.fromData=function(e,t,n,i){var o=new r(e);return o.uploadData(t,n,i),o},e.exports=r},Bjwz:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.renderer.on("context",this.onContextChange,this)}return e.prototype.onContextChange=function(){},e.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null},e}();t.default=n},BzvT:function(e,t,r){"use strict";t.__esModule=!0;var n=r("yI/K"),i=r("pQYt"),o=function(e){return e&&e.__esModule?e:{default:e}}(r("8WrO")),s=r("qp2T");var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.gl=t.gl,this._managedTextures=[]}return e.prototype.bindTexture=function(){},e.prototype.getTexture=function(){},e.prototype.updateTexture=function(e,t){var r=this.gl,s=!!e._glRenderTargets;if(!e.hasLoaded)return null;var a=this.renderer.boundTextures;if(void 0===t){t=0;for(var l=0;l<a.length;++l)if(a[l]===e){t=l;break}}a[t]=e,r.activeTexture(r.TEXTURE0+t);var c=e._glTextures[this.renderer.CONTEXT_UID];if(c)s?e._glRenderTargets[this.renderer.CONTEXT_UID].resize(e.width,e.height):c.upload(e.source);else{if(s){var u=new o.default(this.gl,e.width,e.height,e.scaleMode,e.resolution);u.resize(e.width,e.height),e._glRenderTargets[this.renderer.CONTEXT_UID]=u,c=u.texture}else(c=new n.GLTexture(this.gl,null,null,null,null)).bind(t),c.premultiplyAlpha=!0,c.upload(e.source);e._glTextures[this.renderer.CONTEXT_UID]=c,e.on("update",this.updateTexture,this),e.on("dispose",this.destroyTexture,this),this._managedTextures.push(e),e.isPowerOfTwo?(e.mipmap&&c.enableMipmap(),e.wrapMode===i.WRAP_MODES.CLAMP?c.enableWrapClamp():e.wrapMode===i.WRAP_MODES.REPEAT?c.enableWrapRepeat():c.enableWrapMirrorRepeat()):c.enableWrapClamp(),e.scaleMode===i.SCALE_MODES.NEAREST?c.enableNearestScaling():c.enableLinearScaling()}return c},e.prototype.destroyTexture=function(e,t){if((e=e.baseTexture||e).hasLoaded){var r=this.renderer.CONTEXT_UID,n=e._glTextures,i=e._glRenderTargets;if(n[r]&&(this.renderer.unbindTexture(e),n[r].destroy(),e.off("update",this.updateTexture,this),e.off("dispose",this.destroyTexture,this),delete n[r],!t)){var o=this._managedTextures.indexOf(e);-1!==o&&(0,s.removeItems)(this._managedTextures,o,1)}i&&i[r]&&(i[r].destroy(),delete i[r])}},e.prototype.removeAll=function(){for(var e=0;e<this._managedTextures.length;++e){var t=this._managedTextures[e];t._glTextures[this.renderer.CONTEXT_UID]&&delete t._glTextures[this.renderer.CONTEXT_UID]}},e.prototype.destroy=function(){for(var e=0;e<this._managedTextures.length;++e){var t=this._managedTextures[e];this.destroyTexture(t,!0),t.off("update",this.updateTexture,this),t.off("dispose",this.destroyTexture,this)}this._managedTextures=null},e}();t.default=a},C2QD:function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},CIKq:function(e,t,r){var n,i=r("Gbct"),o=r("Wm4p"),s=r("TypT"),a=r("Yvos"),l=r("Aplp"),c=r("NOtv")("engine.io-client:websocket"),u=global.WebSocket||global.MozWebSocket;if("undefined"==typeof window)try{n=r(3)}catch(e){}var h=u;function d(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=u&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(h=n),i.call(this,e)}h||"undefined"!=typeof window||(h=n),e.exports=d,a(d,i),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new h(e,t):new h(e):new h(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},d.prototype.write=function(e){var t=this;this.writable=!1;for(var r=e.length,n=0,i=r;n<i;n++)!function(e){o.encodePacket(e,t.supportsBinary,function(n){if(!t.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),t.perMessageDeflate)("string"==typeof n?global.Buffer.byteLength(n):n.length)<t.perMessageDeflate.threshold&&(i.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(n):t.ws.send(n,i)}catch(e){c("websocket closed before onclose event")}--r||s()})}(e[n]);function s(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},d.prototype.onClose=function(){i.prototype.onClose.call(this)},d.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},d.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=l()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},d.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===d.prototype.name)}},CUme:function(e,t,r){var n=r("Gbct"),i=r("TypT"),o=r("Wm4p"),s=r("Yvos"),a=r("Aplp"),l=r("NOtv")("engine.io-client:polling");e.exports=u;var c=null!=new(r("AdPF"))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;c&&!t||(this.supportsBinary=!1),n.call(this,e)}s(u,n),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function r(){l("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(l("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){l("pre-pause polling complete"),--n||r()})),this.writable||(l("we are currently writing - waiting to pause"),n++,this.once("drain",function(){l("pre-pause writing complete"),--n||r()}))}else r()},u.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;l("polling got data %s",e);o.decodePayload(e,this.socket.binaryType,function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){l("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(l("transport open - closing"),t()):(l("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},Cl5A:function(e,t,r){var n=r("CUme"),i=r("Yvos");e.exports=c;var o,s=/\n/g,a=/\\n/g;function l(){}function c(e){n.call(this,e),this.query=this.query||{},o||(global.___eio||(global.___eio=[]),o=global.___eio),this.index=o.length;var t=this;o.push(function(e){t.onData(e)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=l)},!1)}i(c,n),c.prototype.supportsBinary=!1,c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},c.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},c.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement("form"),o=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=l,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function c(){u(),t()}function u(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),u(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&c()}:this.iframe.onload=c}},CxY0:function(e,t,r){"use strict";var n=r("rWzI"),i=r("Nehr");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=x,t.resolve=function(e,t){return x(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?x(e,!1,!0).resolveObject(t):t},t.format=function(e){i.isString(e)&&(e=x(e));return e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=r("r8II");function x(e,t,r){if(e&&i.isObject(e)&&e instanceof o)return e;var n=new o;return n.parse(e,t,r),n}o.prototype.parse=function(e,t,r){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var x=e=c.join(a);if(x=x.trim(),!r&&1===e.split("#").length){var b=l.exec(x);if(b)return this.path=x,this.href=x,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=s.exec(x);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,x=x.substr(w.length)}if(r||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===x.substr(0,2);!S||w&&v[w]||(x=x.substr(2),this.slashes=!0)}if(!v[w]&&(S||w&&!g[w])){for(var T,M,A=-1,E=0;E<d.length;E++){-1!==(C=x.indexOf(d[E]))&&(-1===A||C<A)&&(A=C)}-1!==(M=-1===A?x.lastIndexOf("@"):x.lastIndexOf("@",A))&&(T=x.slice(0,M),x=x.slice(M+1),this.auth=decodeURIComponent(T)),A=-1;for(E=0;E<h.length;E++){var C;-1!==(C=x.indexOf(h[E]))&&(-1===A||C<A)&&(A=C)}-1===A&&(A=x.length),this.host=x.slice(0,A),x=x.slice(A),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var O=this.hostname.split(/\./),D=(E=0,O.length);E<D;E++){var N=O[E];if(N&&!N.match(p)){for(var L="",I=0,R=N.length;I<R;I++)N.charCodeAt(I)>127?L+="x":L+=N[I];if(!L.match(p)){var F=O.slice(0,E),k=O.slice(E+1),U=N.match(f);U&&(F.push(U[1]),k.unshift(U[2])),k.length&&(x="/"+k.join(".")+x),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+B,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==x[0]&&(x="/"+x))}if(!m[_])for(E=0,D=u.length;E<D;E++){var z=u[E];if(-1!==x.indexOf(z)){var V=encodeURIComponent(z);V===z&&(V=escape(z)),x=x.split(z).join(V)}}var G=x.indexOf("#");-1!==G&&(this.hash=x.substr(G),x=x.slice(0,G));var H=x.indexOf("?");if(-1!==H?(this.search=x.substr(H),this.query=x.substr(H+1),t&&(this.query=y.parse(this.query)),x=x.slice(0,H)):t&&(this.search="",this.query={}),x&&(this.pathname=x),g[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var W=this.search||"";this.path=B+W}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=y.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||g[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(e){return this.resolveObject(x(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var r=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(r[u]=e[u])}return g[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!g[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||v[e.protocol])r.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",y=r.search||"";r.path=m+y}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var x=r.pathname&&"/"===r.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=b||x||r.host&&e.pathname,_=w,S=r.pathname&&r.pathname.split("/")||[],T=(f=e.pathname&&e.pathname.split("/")||[],r.protocol&&!g[r.protocol]);if(T&&(r.hostname="",r.port=null,r.host&&(""===S[0]?S[0]=r.host:S.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),w=w&&(""===f[0]||""===S[0])),b)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=f;else if(f.length)S||(S=[]),S.pop(),S=S.concat(f),r.search=e.search,r.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(T)r.hostname=r.host=S.shift(),(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift());return r.search=e.search,r.query=e.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var M=S.slice(-1)[0],A=(r.host||e.host||S.length>1)&&("."===M||".."===M)||""===M,E=0,C=S.length;C>=0;C--)"."===(M=S[C])?S.splice(C,1):".."===M?(S.splice(C,1),E++):E&&(S.splice(C,1),E--);if(!w&&!_)for(;E--;E)S.unshift("..");!w||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),A&&"/"!==S.join("/").substr(-1)&&S.push("");var P,O=""===S[0]||S[0]&&"/"===S[0].charAt(0);T&&(r.hostname=r.host=O?"":S.length?S.shift():"",(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift()));return(w=w||r.host&&S.length)&&!O&&S.unshift(""),S.length?r.pathname=S.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},Cxr2:function(e,t){var r=function(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.log(e.getShaderInfoLog(n)),null)};e.exports=function(e,t,n,i){var o=r(e,e.VERTEX_SHADER,t),s=r(e,e.FRAGMENT_SHADER,n),a=e.createProgram();if(e.attachShader(a,o),e.attachShader(a,s),i)for(var l in i)e.bindAttribLocation(a,i[l],l);return e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",e.getProgramParameter(a,e.VALIDATE_STATUS)),console.error("gl.getError()",e.getError()),""!==e.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(a)),e.deleteProgram(a),a=null),e.deleteShader(o),e.deleteShader(s),a}},"D+IV":function(e,t,r){"use strict";t.__esModule=!0;var n=u(r("Bjwz")),i=u(r("8WrO")),o=u(r("PuCZ")),s=r("d07J"),a=u(r("N0WC")),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("rUHO")),c=u(r("pIo5"));function u(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var d=function e(){h(this,e),this.renderTarget=null,this.sourceFrame=new s.Rectangle,this.destinationFrame=new s.Rectangle,this.filters=[],this.target=null,this.resolution=1},p=function(e){function t(r){h(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.gl=n.renderer.gl,n.quad=new o.default(n.gl,r.state.attribState),n.shaderCache={},n.pool={},n.filterData=null,n.managedFilters=[],n.renderer.on("prerender",n.onPrerender,n),n._screenWidth=r.view.width,n._screenHeight=r.view.height,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.pushFilter=function(e,t){var r=this.renderer,n=this.filterData;if(!n){n=this.renderer._activeRenderTarget.filterStack;var i=new d;i.sourceFrame=i.destinationFrame=this.renderer._activeRenderTarget.size,i.renderTarget=r._activeRenderTarget,this.renderer._activeRenderTarget.filterData=n={index:0,stack:[i]},this.filterData=n}var o=n.stack[++n.index],s=n.stack[0].destinationFrame;o||(o=n.stack[n.index]=new d);var a=e.filterArea&&0===e.filterArea.x&&0===e.filterArea.y&&e.filterArea.width===r.screen.width&&e.filterArea.height===r.screen.height,l=t[0].resolution,c=0|t[0].padding,u=a?r.screen:e.filterArea||e.getBounds(!0),h=o.sourceFrame,p=o.destinationFrame;h.x=(u.x*l|0)/l,h.y=(u.y*l|0)/l,h.width=(u.width*l|0)/l,h.height=(u.height*l|0)/l,a||(n.stack[0].renderTarget.transform||t[0].autoFit&&h.fit(s),h.pad(c)),p.width=h.width,p.height=h.height;var f=this.getPotRenderTarget(r.gl,h.width,h.height,l);o.target=e,o.filters=t,o.resolution=l,o.renderTarget=f,f.setFrame(p,h),r.bindRenderTarget(f),f.clear()},t.prototype.popFilter=function(){var e=this.filterData,t=e.stack[e.index-1],r=e.stack[e.index];this.quad.map(r.renderTarget.size,r.sourceFrame).upload();var n=r.filters;if(1===n.length)n[0].apply(this,r.renderTarget,t.renderTarget,!1,r),this.freePotRenderTarget(r.renderTarget);else{var i=r.renderTarget,o=this.getPotRenderTarget(this.renderer.gl,r.sourceFrame.width,r.sourceFrame.height,r.resolution);o.setFrame(r.destinationFrame,r.sourceFrame),o.clear();var s=0;for(s=0;s<n.length-1;++s){n[s].apply(this,i,o,!0,r);var a=i;i=o,o=a}n[s].apply(this,i,t.renderTarget,!1,r),this.freePotRenderTarget(i),this.freePotRenderTarget(o)}e.index--,0===e.index&&(this.filterData=null)},t.prototype.applyFilter=function(e,t,r,n){var i=this.renderer,o=i.gl,s=e.glShaders[i.CONTEXT_UID];s||(e.glShaderKey?(s=this.shaderCache[e.glShaderKey])||(s=new a.default(this.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[i.CONTEXT_UID]=this.shaderCache[e.glShaderKey]=s,this.managedFilters.push(e)):(s=e.glShaders[i.CONTEXT_UID]=new a.default(this.gl,e.vertexSrc,e.fragmentSrc),this.managedFilters.push(e)),i.bindVao(null),this.quad.initVao(s)),i.bindVao(this.quad.vao),i.bindRenderTarget(r),n&&(o.disable(o.SCISSOR_TEST),i.clear(),o.enable(o.SCISSOR_TEST)),r===i.maskManager.scissorRenderTarget&&i.maskManager.pushScissorMask(null,i.maskManager.scissorData),i.bindShader(s);var l=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=l,this.syncUniforms(s,e),i.state.setBlendMode(e.blendMode),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t.texture.texture),this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0),o.bindTexture(o.TEXTURE_2D,l._glTextures[this.renderer.CONTEXT_UID].texture)},t.prototype.syncUniforms=function(e,t){var r=t.uniformData,n=t.uniforms,i=1,o=void 0;if(e.uniforms.filterArea){o=this.filterData.stack[this.filterData.index];var s=e.uniforms.filterArea;s[0]=o.renderTarget.size.width,s[1]=o.renderTarget.size.height,s[2]=o.sourceFrame.x,s[3]=o.sourceFrame.y,e.uniforms.filterArea=s}if(e.uniforms.filterClamp){o=o||this.filterData.stack[this.filterData.index];var a=e.uniforms.filterClamp;a[0]=0,a[1]=0,a[2]=(o.sourceFrame.width-1)/o.renderTarget.size.width,a[3]=(o.sourceFrame.height-1)/o.renderTarget.size.height,e.uniforms.filterClamp=a}for(var l in r){var c=r[l].type;if("sampler2d"===c&&0!==n[l]){if(n[l].baseTexture)e.uniforms[l]=this.renderer.bindTexture(n[l].baseTexture,i);else{e.uniforms[l]=i;var u=this.renderer.gl;this.renderer.boundTextures[i]=this.renderer.emptyTextures[i],u.activeTexture(u.TEXTURE0+i),n[l].texture.bind()}i++}else if("mat3"===c)void 0!==n[l].a?e.uniforms[l]=n[l].toArray(!0):e.uniforms[l]=n[l];else if("vec2"===c)if(void 0!==n[l].x){var h=e.uniforms[l]||new Float32Array(2);h[0]=n[l].x,h[1]=n[l].y,e.uniforms[l]=h}else e.uniforms[l]=n[l];else"float"===c?e.uniforms.data[l].value!==r[l]&&(e.uniforms[l]=n[l]):e.uniforms[l]=n[l]}},t.prototype.getRenderTarget=function(e,t){var r=this.filterData.stack[this.filterData.index],n=this.getPotRenderTarget(this.renderer.gl,r.sourceFrame.width,r.sourceFrame.height,t||r.resolution);return n.setFrame(r.destinationFrame,r.sourceFrame),n},t.prototype.returnRenderTarget=function(e){this.freePotRenderTarget(e)},t.prototype.calculateScreenSpaceMatrix=function(e){var t=this.filterData.stack[this.filterData.index];return l.calculateScreenSpaceMatrix(e,t.sourceFrame,t.renderTarget.size)},t.prototype.calculateNormalizedScreenSpaceMatrix=function(e){var t=this.filterData.stack[this.filterData.index];return l.calculateNormalizedScreenSpaceMatrix(e,t.sourceFrame,t.renderTarget.size,t.destinationFrame)},t.prototype.calculateSpriteMatrix=function(e,t){var r=this.filterData.stack[this.filterData.index];return l.calculateSpriteMatrix(e,r.sourceFrame,r.renderTarget.size,t)},t.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.renderer,r=this.managedFilters;t.off("prerender",this.onPrerender,this);for(var n=0;n<r.length;n++)e||r[n].glShaders[t.CONTEXT_UID].destroy(),delete r[n].glShaders[t.CONTEXT_UID];this.shaderCache={},e?this.pool={}:this.emptyPool()},t.prototype.getPotRenderTarget=function(e,t,r,n){var o="screen";r*=n,(t*=n)===this._screenWidth&&r===this._screenHeight||(o=(65535&(t=c.default.nextPow2(t)))<<16|65535&(r=c.default.nextPow2(r))),this.pool[o]||(this.pool[o]=[]);var s=this.pool[o].pop();if(!s){var a=this.renderer.boundTextures[0];e.activeTexture(e.TEXTURE0),s=new i.default(e,t,r,null,1),e.bindTexture(e.TEXTURE_2D,a._glTextures[this.renderer.CONTEXT_UID].texture)}return s.resolution=n,s.defaultFrame.width=s.size.width=t/n,s.defaultFrame.height=s.size.height=r/n,s},t.prototype.emptyPool=function(){for(var e in this.pool){var t=this.pool[e];if(t)for(var r=0;r<t.length;r++)t[r].destroy(!0)}this.pool={}},t.prototype.freePotRenderTarget=function(e){var t=e.size.width*e.resolution,r=e.size.height*e.resolution,n="screen";t===this._screenWidth&&r===this._screenHeight||(n=(65535&t)<<16|65535&r),this.pool[n].push(e)},t.prototype.onPrerender=function(){if(this._screenWidth!==this.renderer.view.width||this._screenHeight!==this.renderer.view.height){this._screenWidth=this.renderer.view.width,this._screenHeight=this.renderer.view.height;var e=this.pool.screen;if(e)for(var t=0;t<e.length;t++)e[t].destroy(!0);this.pool.screen=[]}},t}(n.default);t.default=p},"Dn+6":function(e,t,r){"use strict";t.__esModule=!0;var n=r("sBhT");Object.defineProperty(t,"Mesh",{enumerable:!0,get:function(){return c(n).default}});var i=r("p85+");Object.defineProperty(t,"MeshRenderer",{enumerable:!0,get:function(){return c(i).default}});var o=r("4I2B");Object.defineProperty(t,"CanvasMeshRenderer",{enumerable:!0,get:function(){return c(o).default}});var s=r("Eu4P");Object.defineProperty(t,"Plane",{enumerable:!0,get:function(){return c(s).default}});var a=r("SJFq");Object.defineProperty(t,"NineSlicePlane",{enumerable:!0,get:function(){return c(a).default}});var l=r("1Ceu");function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"Rope",{enumerable:!0,get:function(){return c(l).default}})},DuEz:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){function t(r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){return e&&e.__esModule?e:{default:e}}(r("N0WC")).default);t.default=n},Eu4P:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("sBhT"));var i=function(e){function t(r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return s._ready=!0,s.verticesX=i||10,s.verticesY=o||10,s.drawMode=n.default.DRAW_MODES.TRIANGLES,s.refresh(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._refresh=function(){for(var e=this._texture,t=this.verticesX*this.verticesY,r=[],n=[],i=[],o=this.verticesX-1,s=this.verticesY-1,a=e.width/o,l=e.height/s,c=0;c<t;c++){var u=c%this.verticesX,h=c/this.verticesX|0;r.push(u*a,h*l),n.push(u/o,h/s)}for(var d=o*s,p=0;p<d;p++){var f=p%o,m=p/o|0,v=m*this.verticesX+f,g=m*this.verticesX+f+1,y=(m+1)*this.verticesX+f,x=(m+1)*this.verticesX+f+1;i.push(v,g,y),i.push(g,x,y)}this.vertices=new Float32Array(r),this.uvs=new Float32Array(n),this.colors=new Float32Array([]),this.indices=new Uint16Array(i),this.dirty++,this.indexDirty++,this.multiplyUvs()},t.prototype._onTextureUpdate=function(){n.default.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},t}(n.default);t.default=i},FGiv:function(e,t){var r=1e3,n=60*r,i=60*n,o=24*i,s=365.25*o;function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===l&&!1===isNaN(e))return t.long?function(e){return a(e,o,"day")||a(e,i,"hour")||a(e,n,"minute")||a(e,r,"second")||e+" ms"}(e):function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=n)return Math.round(e/n)+"m";if(e>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},"FI+O":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("qp2T"),o=r("d07J"),s=r("pQYt"),a=h(r("Yd/J")),l=h(r("a/Ns")),c=h(r("eIHw")),u=h(r("uhBA"));function h(e){return e&&e.__esModule?e:{default:e}}var d=new o.Matrix,p=function(e){function t(r,n,c,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return(0,i.sayHello)(r),"number"==typeof n&&(n=Object.assign({width:n,height:c||a.default.RENDER_OPTIONS.height},u)),n=Object.assign({},a.default.RENDER_OPTIONS,n),h.options=n,h.type=s.RENDERER_TYPE.UNKNOWN,h.screen=new o.Rectangle(0,0,n.width,n.height),h.view=n.view||document.createElement("canvas"),h.resolution=n.resolution||a.default.RESOLUTION,h.transparent=n.transparent,h.autoResize=n.autoResize||!1,h.blendModes=null,h.preserveDrawingBuffer=n.preserveDrawingBuffer,h.clearBeforeRender=n.clearBeforeRender,h.roundPixels=n.roundPixels,h._backgroundColor=0,h._backgroundColorRgba=[0,0,0,0],h._backgroundColorString="#000000",h.backgroundColor=n.backgroundColor||h._backgroundColor,h._tempDisplayObjectParent=new l.default,h._lastObjectRendered=h._tempDisplayObjectParent,h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.resize=function(e,t){this.screen.width=e,this.screen.height=t,this.view.width=e*this.resolution,this.view.height=t*this.resolution,this.autoResize&&(this.view.style.width=e+"px",this.view.style.height=t+"px")},t.prototype.generateTexture=function(e,t,r,n){n=n||e.getLocalBounds();var i=c.default.create(0|n.width,0|n.height,t,r);return d.tx=-n.x,d.ty=-n.y,this.render(e,i,!1,d,!0),i},t.prototype.destroy=function(e){e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=s.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},n(t,[{key:"width",get:function(){return this.view.width}},{key:"height",get:function(){return this.view.height}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=(0,i.hex2string)(e),(0,i.hex2rgb)(e,this._backgroundColorRgba)}}]),t}(u.default);t.default=p},FLfE:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){var t=e.getParameter(e.MAX_VARYING_VECTORS),r=15;for(;r>t;)r-=2;return r}},FNZ9:function(e,t,r){var n=r("B7f1"),i=function(e,t,r){this.gl=e,this.framebuffer=e.createFramebuffer(),this.stencil=null,this.texture=null,this.width=t||100,this.height=r||100};i.prototype.enableTexture=function(e){var t=this.gl;this.texture=e||new n(t),this.texture.bind(),this.bind(),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture.texture,0)},i.prototype.enableStencil=function(){if(!this.stencil){var e=this.gl;this.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencil),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height)}},i.prototype.clear=function(e,t,r,n){this.bind();var i=this.gl;i.clearColor(e,t,r,n),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},i.prototype.bind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer)},i.prototype.unbind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},i.prototype.resize=function(e,t){var r=this.gl;this.width=e,this.height=t,this.texture&&this.texture.uploadData(null,e,t),this.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,this.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e,t))},i.prototype.destroy=function(){var e=this.gl;this.texture&&this.texture.destroy(),e.deleteFramebuffer(this.framebuffer),this.gl=null,this.stencil=null,this.texture=null},i.createRGBA=function(e,t,r,o){var s=n.fromData(e,null,t,r);s.enableNearestScaling(),s.enableWrapClamp();var a=new i(e,t,r);return a.enableTexture(s),a.unbind(),a},i.createFloat32=function(e,t,r,o){var s=new n.fromData(e,o,t,r);s.enableNearestScaling(),s.enableWrapClamp();var a=new i(e,t,r);return a.enableTexture(s),a.unbind(),a},e.exports=i},G9Ht:function(e,t,r){var n,i,o;!function(r){var s=/iPhone/i,a=/iPod/i,l=/iPad/i,c=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,u=/Android/i,h=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,d=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,p=/Windows Phone/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,m=/BlackBerry/i,v=/BB10/i,g=/Opera Mini/i,y=/(CriOS|Chrome)(?=.*\bMobile\b)/i,x=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,b=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),w=function(e,t){return e.test(t)},_=function(e){var t=e||navigator.userAgent,r=t.split("[FBAN");if(void 0!==r[1]&&(t=r[0]),void 0!==(r=t.split("Twitter"))[1]&&(t=r[0]),this.apple={phone:w(s,t),ipod:w(a,t),tablet:!w(s,t)&&w(l,t),device:w(s,t)||w(a,t)||w(l,t)},this.amazon={phone:w(h,t),tablet:!w(h,t)&&w(d,t),device:w(h,t)||w(d,t)},this.android={phone:w(h,t)||w(c,t),tablet:!w(h,t)&&!w(c,t)&&(w(d,t)||w(u,t)),device:w(h,t)||w(d,t)||w(c,t)||w(u,t)},this.windows={phone:w(p,t),tablet:w(f,t),device:w(p,t)||w(f,t)},this.other={blackberry:w(m,t),blackberry10:w(v,t),opera:w(g,t),firefox:w(x,t),chrome:w(y,t),device:w(m,t)||w(v,t)||w(g,t)||w(x,t)||w(y,t)},this.seven_inch=w(b,t),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},S=function(){var e=new _;return e.Class=_,e};void 0!==e&&e.exports&&"undefined"==typeof window?e.exports=_:void 0!==e&&e.exports&&"undefined"!=typeof window?e.exports=S():(i=[],n=r.isMobile=S(),void 0===(o="function"==typeof n?n.apply(t,i):n)||(e.exports=o))}(this)},Gbct:function(e,t,r){var n=r("Wm4p"),i=r("cpc2");function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=o,i(o.prototype),o.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},H9sp:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));var i=16,o=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.uploadHookHelper=n,n.canvas=document.createElement("canvas"),n.canvas.width=i,n.canvas.height=i,n.ctx=n.canvas.getContext("2d"),n.registerUploadHook(s),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.ctx=null,this.canvas=null},t}(function(e){return e&&e.__esModule?e:{default:e}}(r("meNg")).default);function s(e,t){if(t instanceof n.BaseTexture){var r=t.source,i=0===r.width?e.canvas.width:Math.min(e.canvas.width,r.width),o=0===r.height?e.canvas.height:Math.min(e.canvas.height,r.height);return e.ctx.drawImage(r,0,0,i,o,0,0,e.canvas.width,e.canvas.height),!0}return!1}t.default=o,n.CanvasRenderer.registerPlugin("prepare",o)},HNzc:function(e,t){var r=new ArrayBuffer(0),n=function(e,t,n,i){this.gl=e,this.buffer=e.createBuffer(),this.type=t||e.ARRAY_BUFFER,this.drawType=i||e.STATIC_DRAW,this.data=r,n&&this.upload(n),this._updateID=0};n.prototype.upload=function(e,t,r){r||this.bind();var n=this.gl;e=e||this.data,t=t||0,this.data.byteLength>=e.byteLength?n.bufferSubData(this.type,t,e):n.bufferData(this.type,e,this.drawType),this.data=e},n.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},n.createVertexBuffer=function(e,t,r){return new n(e,e.ARRAY_BUFFER,t,r)},n.createIndexBuffer=function(e,t,r){return new n(e,e.ELEMENT_ARRAY_BUFFER,t,r)},n.create=function(e,t,r,i){return new n(e,t,r,i)},n.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},e.exports=n},HP7h:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._x=n,this._y=i,this.cb=t,this.scope=r}return e.prototype.set=function(e,t){var r=e||0,n=t||(0!==t?r:0);this._x===r&&this._y===n||(this._x=r,this._y=n,this.cb.call(this.scope))},e.prototype.copy=function(e){this._x===e.x&&this._y===e.y||(this._x=e.x,this._y=e.y,this.cb.call(this.scope))},n(e,[{key:"x",get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}},{key:"y",get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}]),e}();t.default=i},I42F:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=l(r("c/UO")),s=l(r("p6KW")),a=l(r("FLfE"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(r,n,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l=l||5;var c=(0,o.default)(l,!0),u=(0,s.default)(l),h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,c,u));return h.resolution=a||i.settings.RESOLUTION,h._quality=0,h.quality=n||4,h.strength=r||8,h.firstRun=!0,h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.apply=function(e,t,r,n){if(this.firstRun){var i=e.renderer.gl,l=(0,a.default)(i);this.vertexSrc=(0,o.default)(l,!0),this.fragmentSrc=(0,s.default)(l),this.firstRun=!1}if(this.uniforms.strength=1/r.size.width*(r.size.width/t.size.width),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,r,n);else{for(var c=e.getRenderTarget(!0),u=t,h=c,d=0;d<this.passes-1;d++){e.applyFilter(this,u,h,!0);var p=h;h=u,u=p}e.applyFilter(this,u,r,n),e.returnRenderTarget(c)}},n(t,[{key:"blur",get:function(){return this.strength},set:function(e){this.padding=2*Math.abs(e),this.strength=e}},{key:"quality",get:function(){return this._quality},set:function(e){this._quality=e,this.passes=e}}]),t}(i.Filter);t.default=c},Is4P:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));r("2U8Y");var o=function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));return i.noise=r,i.seed=n,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"noise",get:function(){return this.uniforms.uNoise},set:function(e){this.uniforms.uNoise=e}},{key:"seed",get:function(){return this.uniforms.uSeed},set:function(e){this.uniforms.uSeed=e}}]),t}(i.Filter);t.default=o},JLJ9:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){return!(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))}},JUUD:function(e,t){e.exports=function(e,t,r){var n;if(r){var i=r.tempAttribState,o=r.attribState;for(n=0;n<i.length;n++)i[n]=!1;for(n=0;n<t.length;n++)i[t[n].attribute.location]=!0;for(n=0;n<o.length;n++)o[n]!==i[n]&&(o[n]=i[n],r.attribState[n]?e.enableVertexAttribArray(n):e.disableVertexAttribArray(n))}else for(n=0;n<t.length;n++){var s=t[n];e.enableVertexAttribArray(s.attribute.location)}}},JehY:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));r("2U8Y");var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.Filter);t.default=i},JkEu:function(e,t,r){"use strict";t.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=c(r("1eSL")),s=c(r("u62O")),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("UdPh")),l=c(r("Xwh9"));function c(e){return e&&e.__esModule?e:{default:e}}var u=/(#[\w-]+)?$/,h=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=r,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(e,r){return t._loadResource(e,r)},this._queue=a.queue(this._boundLoadResource,n),this._queue.pause(),this.resources={},this.onProgress=new o.default,this.onError=new o.default,this.onLoad=new o.default,this.onStart=new o.default,this.onComplete=new o.default}return e.prototype.add=function(e,t,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;++o)this.add(e[o]);return this}if("object"===(void 0===e?"undefined":n(e))&&(i=t||e.callback||e.onComplete,r=e,t=e.url,e=e.name||e.key||e.url),"string"!=typeof t&&(i=r,r=t,t=e),"string"!=typeof t)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(i=r,r=null),this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(t=this._prepareUrl(t),this.resources[e]=new l.default(e,t,r),"function"==typeof i&&this.resources[e].onAfterMiddleware.once(i),this.loading){for(var s=r.parentResource,a=[],c=0;c<s.children.length;++c)s.children[c].isComplete||a.push(s.children[c]);var u=s.progressChunk*(a.length+1)/(a.length+2);s.children.push(this.resources[e]),s.progressChunk=u;for(var h=0;h<a.length;++h)a[h].progressChunk=u;this.resources[e].progressChunk=u}return this._queue.push(this.resources[e]),this},e.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},e.prototype.use=function(e){return this._afterMiddleware.push(e),this},e.prototype.reset=function(){for(var e in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var t=this.resources[e];t._onLoadBinding&&t._onLoadBinding.detach(),t.isLoading&&t.abort()}return this.resources={},this},e.prototype.load=function(e){if("function"==typeof e&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var t=100/this._queue._tasks.length,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=t;this._onStart(),this._queue.resume()}return this},e.prototype._prepareUrl=function(e){var t=(0,s.default)(e,{strictMode:!0}),r=void 0;if(r=t.protocol||!t.path||0===e.indexOf("//")?e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==e.charAt(0)?this.baseUrl+"/"+e:this.baseUrl+e,this.defaultQueryString){var n=u.exec(r)[0];-1!==(r=r.substr(0,r.length-n.length)).indexOf("?")?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=n}return r},e.prototype._loadResource=function(e,t){var r=this;e._dequeue=t,a.eachSeries(this._beforeMiddleware,function(t,n){t.call(r,e,function(){n(e.isComplete?{}:null)})},function(){e.isComplete?r._onLoad(e):(e._onLoadBinding=e.onComplete.once(r._onLoad,r),e.load())},!0)},e.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e.prototype._onLoad=function(e){var t=this;e._onLoadBinding=null,this._resourcesParsing.push(e),e._dequeue(),a.eachSeries(this._afterMiddleware,function(r,n){r.call(t,e,n)},function(){e.onAfterMiddleware.dispatch(e),t.progress+=e.progressChunk,t.onProgress.dispatch(t,e),e.error?t.onError.dispatch(e.error,t,e):t.onLoad.dispatch(t,e),t._resourcesParsing.splice(t._resourcesParsing.indexOf(e),1),t._queue.idle()&&0===t._resourcesParsing.length&&t._onComplete()},!0)},i(e,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e}}]),e}();t.default=h},K9TQ:function(e,t){e.exports=function(e,t){var r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);if(!r)throw new Error("This browser does not support webGL. Try using the canvas renderer");return r}},KByU:function(e,t,r){"use strict";t.__esModule=!0;var n=r("d07J");var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.worldTransform=new n.Matrix,this.localTransform=new n.Matrix,this._worldID=0,this._parentID=0}return e.prototype.updateLocalTransform=function(){},e.prototype.updateTransform=function(e){var t=e.worldTransform,r=this.worldTransform,n=this.localTransform;r.a=n.a*t.a+n.b*t.c,r.b=n.a*t.b+n.b*t.d,r.c=n.c*t.a+n.d*t.c,r.d=n.c*t.b+n.d*t.d,r.tx=n.tx*t.a+n.ty*t.c+t.tx,r.ty=n.tx*t.b+n.ty*t.d+t.ty,this._worldID++},e}();t.default=i,i.prototype.updateWorldTransform=i.prototype.updateTransform,i.IDENTITY=new i},KFGy:function(e,t,r){var n=r("Vo14"),i=r("cpc2"),o=r("kSER"),s=r("2Dig"),a=r("QN7Q"),l=r("NOtv")("socket.io-client:socket"),c=r("TypT"),u=r("WLGk");e.exports=p;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=i.prototype.emit;function p(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",a(this,"onopen")),s(e,"packet",a(this,"onpacket")),s(e,"close",a(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var e=o(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(h.hasOwnProperty(e))return d.apply(this,arguments),this;var t=o(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:u(t))?n.BINARY_EVENT:n.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?c.encode(this.query):this.query;l("sending connect packet with query %s",e),this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},p.prototype.onclose=function(e){l("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},p.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},p.prototype.onevent=function(e){var t=e.data||[];l("emitting event %j",t),null!=e.id&&(l("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?d.apply(this,t):this.receiveBuffer.push(t)},p.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=o(arguments);l("sending ack %j",i),t.packet({type:u(i)?n.BINARY_ACK:n.ACK,id:e,data:i})}}},p.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(l("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):l("bad ack %s",e.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)d.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(e){return this.flags.compress=e,this},p.prototype.binary=function(e){return this.flags.binary=e,this}},KKCa:function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},KvbZ:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t,r){e.points=e.shape.points.slice();var s=e.points;if(e.fill&&s.length>=6){for(var a=[],l=e.holes,c=0;c<l.length;c++){var u=l[c];a.push(s.length/2),s=s.concat(u.points)}var h=t.points,d=t.indices,p=s.length/2,f=(0,i.hex2rgb)(e.fillColor),m=e.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,x=(0,o.default)(s,a,2);if(!x)return;for(var b=h.length/6,w=0;w<x.length;w+=3)d.push(x[w]+b),d.push(x[w]+b),d.push(x[w+1]+b),d.push(x[w+2]+b),d.push(x[w+2]+b);for(var _=0;_<p;_++)h.push(s[2*_],s[2*_+1],v,g,y,m)}e.lineWidth>0&&(0,n.default)(e,t,r)};var n=s(r("5OzF")),i=r("qp2T"),o=s(r("VmRL"));function s(e){return e&&e.__esModule?e:{default:e}}},LNIn:function(e,t,r){"use strict";t.__esModule=!0;var n=a(r("pVcz")),i=r("pQYt"),o=r("d07J"),s=a(r("/UP7"));function a(e){return e&&e.__esModule?e:{default:e}}var l=new o.Matrix,c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t}return e.prototype.render=function(e){var t=e._texture,r=this.renderer,n=t._frame.width,a=t._frame.height,c=e.transform.worldTransform,u=0,h=0;if(!(t.orig.width<=0||t.orig.height<=0)&&t.baseTexture.source&&(r.setBlendMode(e.blendMode),t.valid)){r.context.globalAlpha=e.worldAlpha;var d=t.baseTexture.scaleMode===i.SCALE_MODES.LINEAR;r.smoothProperty&&r.context[r.smoothProperty]!==d&&(r.context[r.smoothProperty]=d),t.trim?(u=t.trim.width/2+t.trim.x-e.anchor.x*t.orig.width,h=t.trim.height/2+t.trim.y-e.anchor.y*t.orig.height):(u=(.5-e.anchor.x)*t.orig.width,h=(.5-e.anchor.y)*t.orig.height),t.rotate&&(c.copy(l),c=l,o.GroupD8.matrixAppendRotationInv(c,t.rotate,u,h),u=0,h=0),u-=n/2,h-=a/2,r.roundPixels?(r.context.setTransform(c.a,c.b,c.c,c.d,c.tx*r.resolution|0,c.ty*r.resolution|0),u|=0,h|=0):r.context.setTransform(c.a,c.b,c.c,c.d,c.tx*r.resolution,c.ty*r.resolution);var p=t.baseTexture.resolution;16777215!==e.tint?(e.cachedTint===e.tint&&e.tintedTexture.tintId===e._texture._updateID||(e.cachedTint=e.tint,e.tintedTexture=s.default.getTintedTexture(e,e.tint)),r.context.drawImage(e.tintedTexture,0,0,n*p,a*p,u*r.resolution,h*r.resolution,n*r.resolution,a*r.resolution)):r.context.drawImage(t.baseTexture.source,t._frame.x*p,t._frame.y*p,n*p,a*p,u*r.resolution,h*r.resolution,n*r.resolution,a*r.resolution)}},e.prototype.destroy=function(){this.renderer=null},e}();t.default=c,n.default.registerPlugin("sprite",c)},M0IJ:function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r("MgzW"));Object.assign||(Object.assign=n.default)},M6Jp:function(e,t,r){"use strict";t.__esModule=!0;var n=r("/msk");Object.defineProperty(t,"webgl",{enumerable:!0,get:function(){return l(n).default}});var i=r("H9sp");Object.defineProperty(t,"canvas",{enumerable:!0,get:function(){return l(i).default}});var o=r("meNg");Object.defineProperty(t,"BasePrepare",{enumerable:!0,get:function(){return l(o).default}});var s=r("QNV1");Object.defineProperty(t,"CountLimiter",{enumerable:!0,get:function(){return l(s).default}});var a=r("fsTW");function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"TimeLimiter",{enumerable:!0,get:function(){return l(a).default}})},MCLT:function(e,t,r){var n=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var i=arguments,o=i.length,a=String(e).replace(n,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return e}}),l=i[r];r<o;l=i[++r])f(l)||!x(l)?a+=" "+l:a+=" "+s(l);return a},t.deprecate=function(e,r){if(g(global.process))return function(){return t.deprecate(e,r).apply(this,arguments)};if(!0===process.noDeprecation)return e;var n=!1;return function(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}};var i,o={};function s(e,r){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=a),c(n,e,n.depth)}function a(e,t){var r=s.styles[t];return r?"\x1b["+s.colors[r][0]+"m"+e+"\x1b["+s.colors[r][1]+"m":e}function l(e,t){return e}function c(e,r,n){if(e.customInspect&&r&&_(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return v(i)||(i=c(e,i,n)),i}var o=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(m(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(f(t))return e.stylize("null","null")}(e,r);if(o)return o;var s=Object.keys(r),a=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),w(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return u(r);if(0===s.length){if(_(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(y(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(b(r))return e.stylize(Date.prototype.toString.call(r),"date");if(w(r))return u(r)}var x,S="",T=!1,M=["{","}"];(d(r)&&(T=!0,M=["[","]"]),_(r))&&(S=" [Function"+(r.name?": "+r.name:"")+"]");return y(r)&&(S=" "+RegExp.prototype.toString.call(r)),b(r)&&(S=" "+Date.prototype.toUTCString.call(r)),w(r)&&(S=" "+u(r)),0!==s.length||T&&0!=r.length?n<0?y(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),x=T?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)A(t,String(s))?o.push(h(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(e,t,r,n,i,!0))}),o}(e,r,n,a,s):s.map(function(t){return h(e,r,n,a,t,T)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(x,S,M)):M[0]+S+M[1]}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,r,n,i,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),A(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(l.value)<0?(a=f(r)?c(e,l.value,null):c(e,l.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),g(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function f(e){return null===e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function g(e){return void 0===e}function y(e){return x(e)&&"[object RegExp]"===S(e)}function x(e){return"object"==typeof e&&null!==e}function b(e){return x(e)&&"[object Date]"===S(e)}function w(e){return x(e)&&("[object Error]"===S(e)||e instanceof Error)}function _(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(g(i)&&(i=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(i)){var r=process.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=f,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=g,t.isRegExp=y,t.isObject=x,t.isDate=b,t.isError=w,t.isFunction=_,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r("1gqn");var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",function(){var e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":");return[e.getDate(),M[e.getMonth()],t].join(" ")}(),t.format.apply(t,arguments))},t.inherits=r("KKCa"),t._extend=function(e,t){if(!t||!x(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}},MgzW:function(e,t,r){"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,s,a=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var c in r=Object(arguments[l]))i.call(r,c)&&(a[c]=r[c]);if(n){s=n(r);for(var u=0;u<s.length;u++)o.call(r,s[u])&&(a[s[u]]=r[s[u]])}}return a}},MjLO:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t,r){var o=e.shape,s=o.x,a=o.y,l=o.width,c=o.height;if(e.fill){var u=(0,i.hex2rgb)(e.fillColor),h=e.fillAlpha,d=u[0]*h,p=u[1]*h,f=u[2]*h,m=t.points,v=t.indices,g=m.length/6;m.push(s,a),m.push(d,p,f,h),m.push(s+l,a),m.push(d,p,f,h),m.push(s,a+c),m.push(d,p,f,h),m.push(s+l,a+c),m.push(d,p,f,h),v.push(g,g,g+1,g+2,g+3,g+3)}if(e.lineWidth){var y=e.points;e.points=[s,a,s+l,a,s+l,a+c,s,a+c,s,a],(0,n.default)(e,t,r),e.points=y}};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("5OzF")),i=r("qp2T")},N0WC:function(e,t,r){"use strict";t.__esModule=!0;var n=r("yI/K"),i=function(e){return e&&e.__esModule?e:{default:e}}(r("Yd/J"));function o(e,t){if(e instanceof Array){if("precision"!==e[0].substring(0,9)){var r=e.slice(0);return r.unshift("precision "+t+" float;"),r}}else if("precision"!==e.trim().substring(0,9))return"precision "+t+" float;\n"+e;return e}var s=function(e){function t(r,n,s,a,l){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,o(n,l||i.default.PRECISION_VERTEX),o(s,l||i.default.PRECISION_FRAGMENT),void 0,a))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.GLShader);t.default=s},NE8l:function(e,t,r){"use strict";t.__esModule=!0;var n=o(r("Bjwz")),i=o(r("he9Y"));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.scissor=!1,n.scissorData=null,n.scissorRenderTarget=null,n.enableScissor=!0,n.alphaMaskPool=[],n.alphaMaskIndex=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.pushMask=function(e,t){if(t.texture)this.pushSpriteMask(e,t);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&t.isFastRect()){var r=t.worldTransform,n=Math.atan2(r.b,r.a);(n=Math.round(n*(180/Math.PI)))%90?this.pushStencilMask(t):this.pushScissorMask(e,t)}else this.pushStencilMask(t)},t.prototype.popMask=function(e,t){t.texture?this.popSpriteMask(e,t):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(e,t):this.popStencilMask(e,t)},t.prototype.pushSpriteMask=function(e,t){var r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new i.default(t)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=t,e.filterArea=t.getBounds(!0),this.renderer.filterManager.pushFilter(e,r),this.alphaMaskIndex++},t.prototype.popSpriteMask=function(){this.renderer.filterManager.popFilter(),this.alphaMaskIndex--},t.prototype.pushStencilMask=function(e){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.pushStencil(e)},t.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.popStencil()},t.prototype.pushScissorMask=function(e,t){t.renderable=!0;var r=this.renderer._activeRenderTarget,n=t.getBounds();n.fit(r.size),t.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var i=this.renderer.resolution;this.renderer.gl.scissor(n.x*i,(r.root?r.size.height-n.y-n.height:n.y)*i,n.width*i,n.height*i),this.scissorRenderTarget=r,this.scissorData=t,this.scissor=!0},t.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var e=this.renderer.gl;e.disable(e.SCISSOR_TEST)},t}(n.default);t.default=s},NO7c:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=a(r("Yd/J")),o=r("pQYt"),s=a(r("xXZ/"));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._head=new s.default(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/i.default.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return e.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},e.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},e.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},e.prototype.add=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL;return this._addListener(new s.default(e,t,r))},e.prototype.addOnce=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL;return this._addListener(new s.default(e,t,r,!0))},e.prototype._addListener=function(e){var t=this._head.next,r=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}else e.connect(r);return this._startIfPossible(),this},e.prototype.remove=function(e,t){for(var r=this._head.next;r;)r=r.match(e,t)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},e.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},e.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},e.prototype.destroy=function(){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null},e.prototype.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),t=void 0;if(e>this.lastTime){(t=this.elapsedMS=e-this.lastTime)>this._maxElapsedMS&&(t=this._maxElapsedMS),this.deltaTime=t*i.default.TARGET_FPMS*this.speed;for(var r=this._head,n=r.next;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.elapsedMS=0;this.lastTime=e},n(e,[{key:"FPS",get:function(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function(){return 1e3/this._maxElapsedMS},set:function(e){var t=Math.min(Math.max(0,e)/1e3,i.default.TARGET_FPMS);this._maxElapsedMS=1/t}}]),e}();t.default=l},NOtv:function(e,t,r){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=r("lv48")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())},Nehr:function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},Nv7N:function(e,t,r){"use strict";t.__esModule=!0;var n=r("pQYt"),i=function(e){return e&&e.__esModule?e:{default:e}}(r("Yd/J"));var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=i.default.GC_MAX_IDLE,this.checkCountMax=i.default.GC_MAX_CHECK_COUNT,this.mode=i.default.GC_MODE}return e.prototype.update=function(){this.count++,this.mode!==n.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},e.prototype.run=function(){for(var e=this.renderer.textureManager,t=e._managedTextures,r=!1,n=0;n<t.length;n++){var i=t[n];!i._glRenderTargets&&this.count-i.touched>this.maxIdle&&(e.destroyTexture(i,!0),t[n]=null,r=!0)}if(r){for(var o=0,s=0;s<t.length;s++)null!==t[s]&&(t[o++]=t[s]);t.length=o}},e.prototype.unload=function(e){var t=this.renderer.textureManager;e._texture&&e._texture._glRenderTargets&&t.destroyTexture(e._texture,!0);for(var r=e.children.length-1;r>=0;r--)this.unload(e.children[r])},e}();t.default=o},Nx1p:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){return function(e,t){var r=e.name+"_image";if(e.data&&e.type===n.Resource.TYPE.JSON&&e.data.frames&&!this.resources[r]){var i={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},a=s(e,this.baseUrl);this.add(r,a,i,function(r){if(r.error)t(r.error);else{var n=new o.Spritesheet(r.texture.baseTexture,e.data,e.url);n.parse(function(){e.spritesheet=n,e.textures=n.textures,t()})}})}else t()}},t.getResourcePath=s;var n=r("z+eP"),i=function(e){return e&&e.__esModule?e:{default:e}}(r("CxY0")),o=r("3AcN");function s(e,t){return e.isDataUrl?e.data.meta.image:i.default.resolve(e.url.replace(t,""),e.data.meta.image)}},OKgQ:function(e,t,r){var n=r("Womt");Sky=function(){var e=Sky.SkyShader,t=new n.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:n.UniformsUtils.clone(e.uniforms),side:n.BackSide});n.Mesh.call(this,new n.SphereBufferGeometry(1,32,15),t)},Sky.prototype=Object.create(n.Mesh.prototype),Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new n.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},e.exports=Sky},P2LE:function(e,t,r){var n=r("Cxr2"),i=r("7AYe"),o=r("984s"),s=r("0DWY"),a=r("hy2w"),l=function(e,t,r,l,c){this.gl=e,l&&(t=s(t,l),r=s(r,l)),this.program=n(e,t,r,c),this.attributes=i(e,this.program),this.uniformData=o(e,this.program),this.uniforms=a(e,this.uniformData)};l.prototype.bind=function(){return this.gl.useProgram(this.program),this},l.prototype.destroy=function(){this.attributes=null,this.uniformData=null,this.uniforms=null,this.gl.deleteProgram(this.program)},e.exports=l},PuCZ:function(e,t,r){"use strict";t.__esModule=!0;var n=o(r("yI/K")),i=o(r("TyRm"));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.interleaved=new Float32Array(16);for(var o=0;o<4;o++)this.interleaved[4*o]=this.vertices[2*o],this.interleaved[4*o+1]=this.vertices[2*o+1],this.interleaved[4*o+2]=this.uvs[2*o],this.interleaved[4*o+3]=this.uvs[2*o+1];this.indices=(0,i.default)(1),this.vertexBuffer=n.default.GLBuffer.createVertexBuffer(t,this.interleaved,t.STATIC_DRAW),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.vao=new n.default.VertexArrayObject(t,r)}return e.prototype.initVao=function(e){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,e.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,e.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)},e.prototype.map=function(e,t){var r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+t.width/e.width,this.uvs[3]=n,this.uvs[4]=r+t.width/e.width,this.uvs[5]=n+t.height/e.height,this.uvs[6]=r,this.uvs[7]=n+t.height/e.height,r=t.x,n=t.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+t.width,this.vertices[3]=n,this.vertices[4]=r+t.width,this.vertices[5]=n+t.height,this.vertices[6]=r,this.vertices[7]=n+t.height,this},e.prototype.upload=function(){for(var e=0;e<4;e++)this.interleaved[4*e]=this.vertices[2*e],this.interleaved[4*e+1]=this.vertices[2*e+1],this.interleaved[4*e+2]=this.uvs[2*e],this.interleaved[4*e+3]=this.uvs[2*e+1];return this.vertexBuffer.upload(this.interleaved),this},e.prototype.destroy=function(){var e=this.gl;e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer)},e}();t.default=s},QLbY:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=l(r("HP7h")),s=r("qp2T"),a=l(r("Yd/J"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return i._textWidth=0,i._textHeight=0,i._glyphs=[],i._font={tint:void 0!==n.tint?n.tint:16777215,align:n.align||"left",name:null,size:0},i.font=n.font,i._text=r,i._maxWidth=0,i._maxLineHeight=0,i._anchor=new o.default(function(){i.dirty=!0},i,0,0),i.dirty=!1,i.updateText(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.updateText=function(){for(var e=t.fonts[this._font.name],r=this._font.size/e.size,n=new i.Point,o=[],s=[],a=null,l=0,c=0,u=0,h=-1,d=0,p=0,f=0,m=0;m<this.text.length;m++){var v=this.text.charCodeAt(m);if(/(\s)/.test(this.text.charAt(m))&&(h=m,d=l),/(?:\r\n|\r|\n)/.test(this.text.charAt(m)))s.push(l),c=Math.max(c,l),u++,n.x=0,n.y+=e.lineHeight,a=null;else if(-1!==h&&this._maxWidth>0&&n.x*r>this._maxWidth)i.utils.removeItems(o,h-p,m-h),m=h,h=-1,++p,s.push(d),c=Math.max(c,d),u++,n.x=0,n.y+=e.lineHeight,a=null;else{var g=e.chars[v];g&&(a&&g.kerning[a]&&(n.x+=g.kerning[a]),o.push({texture:g.texture,line:u,charCode:v,position:new i.Point(n.x+g.xOffset,n.y+g.yOffset)}),l=n.x+(g.texture.width+g.xOffset),n.x+=g.xAdvance,f=Math.max(f,g.yOffset+g.texture.height),a=v)}}s.push(l),c=Math.max(c,l);for(var y=[],x=0;x<=u;x++){var b=0;"right"===this._font.align?b=c-s[x]:"center"===this._font.align&&(b=(c-s[x])/2),y.push(b)}for(var w=o.length,_=this.tint,S=0;S<w;S++){var T=this._glyphs[S];T?T.texture=o[S].texture:(T=new i.Sprite(o[S].texture),this._glyphs.push(T)),T.position.x=(o[S].position.x+y[o[S].line])*r,T.position.y=o[S].position.y*r,T.scale.x=T.scale.y=r,T.tint=_,T.parent||this.addChild(T)}for(var M=w;M<this._glyphs.length;++M)this.removeChild(this._glyphs[M]);if(this._textWidth=c*r,this._textHeight=(n.y+e.lineHeight)*r,0!==this.anchor.x||0!==this.anchor.y)for(var A=0;A<w;A++)this._glyphs[A].x-=this._textWidth*this.anchor.x,this._glyphs[A].y-=this._textHeight*this.anchor.y;this._maxLineHeight=f*r},t.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},t.prototype.getLocalBounds=function(){return this.validate(),e.prototype.getLocalBounds.call(this)},t.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},t.registerFont=function(e,r){var n={},o=e.getElementsByTagName("info")[0],l=e.getElementsByTagName("common")[0],c=e.getElementsByTagName("page")[0].getAttribute("file"),u=(0,s.getResolutionOfUrl)(c,a.default.RESOLUTION);n.font=o.getAttribute("face"),n.size=parseInt(o.getAttribute("size"),10),n.lineHeight=parseInt(l.getAttribute("lineHeight"),10)/u,n.chars={};for(var h=e.getElementsByTagName("char"),d=0;d<h.length;d++){var p=h[d],f=parseInt(p.getAttribute("id"),10),m=new i.Rectangle(parseInt(p.getAttribute("x"),10)/u+r.frame.x/u,parseInt(p.getAttribute("y"),10)/u+r.frame.y/u,parseInt(p.getAttribute("width"),10)/u,parseInt(p.getAttribute("height"),10)/u);n.chars[f]={xOffset:parseInt(p.getAttribute("xoffset"),10)/u,yOffset:parseInt(p.getAttribute("yoffset"),10)/u,xAdvance:parseInt(p.getAttribute("xadvance"),10)/u,kerning:{},texture:new i.Texture(r.baseTexture,m)}}for(var v=e.getElementsByTagName("kerning"),g=0;g<v.length;g++){var y=v[g],x=parseInt(y.getAttribute("first"),10)/u,b=parseInt(y.getAttribute("second"),10)/u,w=parseInt(y.getAttribute("amount"),10)/u;n.chars[b]&&(n.chars[b].kerning[x]=w)}return t.fonts[n.font]=n,n},n(t,[{key:"tint",get:function(){return this._font.tint},set:function(e){this._font.tint="number"==typeof e&&e>=0?e:16777215,this.dirty=!0}},{key:"align",get:function(){return this._font.align},set:function(e){this._font.align=e||"left",this.dirty=!0}},{key:"anchor",get:function(){return this._anchor},set:function(e){"number"==typeof e?this._anchor.set(e):this._anchor.copy(e)}},{key:"font",get:function(){return this._font},set:function(e){e&&("string"==typeof e?(e=e.split(" "),this._font.name=1===e.length?e[0]:e.slice(1).join(" "),this._font.size=e.length>=2?parseInt(e[0],10):t.fonts[this._font.name].size):(this._font.name=e.name,this._font.size="number"==typeof e.size?e.size:parseInt(e.size,10)),this.dirty=!0)}},{key:"text",get:function(){return this._text},set:function(e){e=e.toString()||" ",this._text!==e&&(this._text=e,this.dirty=!0)}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}},{key:"maxLineHeight",get:function(){return this.validate(),this._maxLineHeight}},{key:"textWidth",get:function(){return this.validate(),this._textWidth}},{key:"textHeight",get:function(){return this.validate(),this._textHeight}}]),t}(i.Container);t.default=c,c.fonts={}},QN7Q:function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},QNV1:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.maxItemsPerFrame=t,this.itemsLeft=0}return e.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},e.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},e}();t.default=n},R2qm:function(e,t,r){"use strict";var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),i=a(r("xJsK")),o=a(r("3Jm9")),s=r("qp2T");function a(e){return e&&e.__esModule?e:{default:e}}var l=n.DisplayObject,c=new n.Matrix;l.prototype._cacheAsBitmap=!1,l.prototype._cacheData=!1;var u=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textureCacheId=null,this.originalRenderWebGL=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(l.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(e){if(this._cacheAsBitmap!==e){this._cacheAsBitmap=e;var t=void 0;e?(this._cacheData||(this._cacheData=new u),(t=this._cacheData).originalRenderWebGL=this.renderWebGL,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this._calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((t=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=t.originalRenderWebGL,this.renderCanvas=t.originalRenderCanvas,this._calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}}),l.prototype._renderCachedWebGL=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite._transformID=-1,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(e))},l.prototype._initCachedDisplayObject=function(e){if(!this._cacheData||!this._cacheData.sprite){var t=this.alpha;this.alpha=1,e.currentRenderer.flush();var r=this.getLocalBounds().clone();if(this._filters){var a=this._filters[0].padding;r.pad(a)}var l=e._activeRenderTarget,u=e.filterManager.filterStack,h=n.RenderTexture.create(0|r.width,0|r.height),d="cacheAsBitmap_"+(0,s.uid)();this._cacheData.textureCacheId=d,o.default.addToCache(h.baseTexture,d),i.default.addToCache(h,d);var p=c;p.tx=-r.x,p.ty=-r.y,this.transform.worldTransform.identity(),this.renderWebGL=this._cacheData.originalRenderWebGL,e.render(this,h,!0,p,!0),e.bindRenderTarget(l),e.filterManager.filterStack=u,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this._mask=null,this.filterArea=null;var f=new n.Sprite(h);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-r.x/r.width,f.anchor.y=-r.y/r.height,f.alpha=t,f._bounds=this._bounds,this._calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=f.containsPoint.bind(f)}},l.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite.renderCanvas(e))},l.prototype._initCachedDisplayObjectCanvas=function(e){if(!this._cacheData||!this._cacheData.sprite){var t=this.getLocalBounds(),r=this.alpha;this.alpha=1;var a=e.context,l=n.RenderTexture.create(0|t.width,0|t.height),u="cacheAsBitmap_"+(0,s.uid)();this._cacheData.textureCacheId=u,o.default.addToCache(l.baseTexture,u),i.default.addToCache(l,u);var h=c;this.transform.localTransform.copy(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,l,!0,h,!1),e.context=a,this.renderCanvas=this._renderCachedCanvas,this._calculateBounds=this._calculateCachedBounds,this._mask=null,this.filterArea=null;var d=new n.Sprite(l);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-t.x/t.width,d.anchor.y=-t.y/t.height,d._bounds=this._bounds,d.alpha=r,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.updateTransform=this.displayObjectUpdateTransform,this._cacheData.sprite=d,this.containsPoint=d.containsPoint.bind(d)}},l.prototype._calculateCachedBounds=function(){this._cacheData.sprite._calculateBounds()},l.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},l.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,o.default.removeFromCache(this._cacheData.textureCacheId),i.default.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},l.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)}},SJFq:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=10,o=function(e){function t(r,n,o,s,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,4,4));return l._origWidth=r.orig.width,l._origHeight=r.orig.height,l._width=l._origWidth,l._height=l._origHeight,l.leftWidth=void 0!==n?n:i,l.rightWidth=void 0!==s?s:i,l.topHeight=void 0!==o?o:i,l.bottomHeight=void 0!==a?a:i,l.refresh(!0),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.updateHorizontalVertices=function(){var e=this.vertices;e[9]=e[11]=e[13]=e[15]=this._topHeight,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight,e[25]=e[27]=e[29]=e[31]=this._height},t.prototype.updateVerticalVertices=function(){var e=this.vertices;e[2]=e[10]=e[18]=e[26]=this._leftWidth,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth,e[6]=e[14]=e[22]=e[30]=this._width},t.prototype._renderCanvas=function(e){var t=e.context;t.globalAlpha=this.worldAlpha,e.setBlendMode(this.blendMode);var r=this.worldTransform,n=e.resolution;e.roundPixels?t.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n|0,r.ty*n|0):t.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n,r.ty*n);var i=this._texture.baseTexture,o=i.source,s=i.width*i.resolution,a=i.height*i.resolution;this.drawSegment(t,o,s,a,0,1,10,11),this.drawSegment(t,o,s,a,2,3,12,13),this.drawSegment(t,o,s,a,4,5,14,15),this.drawSegment(t,o,s,a,8,9,18,19),this.drawSegment(t,o,s,a,10,11,20,21),this.drawSegment(t,o,s,a,12,13,22,23),this.drawSegment(t,o,s,a,16,17,26,27),this.drawSegment(t,o,s,a,18,19,28,29),this.drawSegment(t,o,s,a,20,21,30,31)},t.prototype.drawSegment=function(e,t,r,n,i,o,s,a){var l=this.uvs,c=this.vertices,u=(l[s]-l[i])*r,h=(l[a]-l[o])*n,d=c[s]-c[i],p=c[a]-c[o];u<1&&(u=1),h<1&&(h=1),d<1&&(d=1),p<1&&(p=1),e.drawImage(t,l[i]*r,l[o]*n,u,h,c[i],c[o],d,p)},t.prototype._refresh=function(){e.prototype._refresh.call(this);var t=this.uvs,r=this._texture;this._origWidth=r.orig.width,this._origHeight=r.orig.height;var n=1/this._origWidth,i=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=n*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-n*this._rightWidth,t[9]=t[11]=t[13]=t[15]=i*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.dirty++,this.multiplyUvs()},n(t,[{key:"width",get:function(){return this._width},set:function(e){this._width=e,this._refresh()}},{key:"height",get:function(){return this._height},set:function(e){this._height=e,this._refresh()}},{key:"leftWidth",get:function(){return this._leftWidth},set:function(e){this._leftWidth=e,this._refresh()}},{key:"rightWidth",get:function(){return this._rightWidth},set:function(e){this._rightWidth=e,this._refresh()}},{key:"topHeight",get:function(){return this._topHeight},set:function(e){this._topHeight=e,this._refresh()}},{key:"bottomHeight",get:function(){return this._bottomHeight},set:function(e){this._bottomHeight=e,this._refresh()}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(r("Eu4P")).default);t.default=o},SLIe:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){return function(e,t){e.data&&e.type===n.Resource.TYPE.IMAGE&&(e.texture=i.default.fromLoader(e.data,e.url,e.name)),t()}};var n=r("z+eP"),i=function(e){return e&&e.__esModule?e:{default:e}}(r("xJsK"))},"TF/P":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("3AcN"),o=r("qp2T");var s=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseTexture=t,this.textures={},this.data=r,this.resolution=this._updateResolution(n||this.baseTexture.imageUrl),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return n(e,null,[{key:"BATCH_SIZE",get:function(){return 1e3}}]),e.prototype._updateResolution=function(e){var t=this.data.meta.scale,r=(0,o.getResolutionOfUrl)(e,null);return null===r&&(r=void 0!==t?parseFloat(t):1),1!==r&&(this.baseTexture.resolution=r,this.baseTexture.update()),r},e.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._parseComplete()):this._nextBatch()},e.prototype._processFrames=function(t){for(var r=t,n=e.BATCH_SIZE,o=this.baseTexture.sourceScale;r-t<n&&r<this._frameKeys.length;){var s=this._frameKeys[r],a=this._frames[s],l=a.frame;if(l){var c=null,u=null,h=!1!==a.trimmed&&a.sourceSize?a.sourceSize:a.frame,d=new i.Rectangle(0,0,Math.floor(h.w*o)/this.resolution,Math.floor(h.h*o)/this.resolution);c=a.rotated?new i.Rectangle(Math.floor(l.x*o)/this.resolution,Math.floor(l.y*o)/this.resolution,Math.floor(l.h*o)/this.resolution,Math.floor(l.w*o)/this.resolution):new i.Rectangle(Math.floor(l.x*o)/this.resolution,Math.floor(l.y*o)/this.resolution,Math.floor(l.w*o)/this.resolution,Math.floor(l.h*o)/this.resolution),!1!==a.trimmed&&a.spriteSourceSize&&(u=new i.Rectangle(Math.floor(a.spriteSourceSize.x*o)/this.resolution,Math.floor(a.spriteSourceSize.y*o)/this.resolution,Math.floor(l.w*o)/this.resolution,Math.floor(l.h*o)/this.resolution)),this.textures[s]=new i.Texture(this.baseTexture,c,d,u,a.rotated?2:0),i.Texture.addToCache(this.textures[s],s)}r++}},e.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},e.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*e.BATCH_SIZE<t._frameKeys.length?t._nextBatch():t._parseComplete()},0)},e.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&this.baseTexture.destroy(),this.baseTexture=null},e}();t.default=s},"TR3/":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t,r,n,i,o,s,a,l,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.text=t,this.style=r,this.width=n,this.height=i,this.lines=o,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}return e.measureText=function(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e._canvas;n=n||r.wordWrap;var o=r.toFontString(),s=e.measureFont(o),a=i.getContext("2d");a.font=o;for(var l=(n?e.wordWrap(t,r,i):t).split(/(?:\r\n|\r|\n)/),c=new Array(l.length),u=0,h=0;h<l.length;h++){var d=a.measureText(l[h]).width+(l[h].length-1)*r.letterSpacing;c[h]=d,u=Math.max(u,d)}var p=u+r.strokeThickness;r.dropShadow&&(p+=r.dropShadowDistance);var f=r.lineHeight||s.fontSize+r.strokeThickness,m=Math.max(f,s.fontSize+r.strokeThickness)+(l.length-1)*(f+r.leading);return r.dropShadow&&(m+=r.dropShadowDistance),new e(t,r,p,m,l,c,f+r.leading,u,s)},e.wordWrap=function(t,r){for(var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:e._canvas).getContext("2d"),i="",o=0,s="",a={},l=r.letterSpacing,c=r.wordWrapWidth+r.letterSpacing,u=e.getFromCache(" ",l,a,n),h=t.split(" "),d=0;d<h.length;d++){var p=h[d],f=e.getFromCache(p,l,a,n);if(f>c)if(r.breakWords)for(var m=(i.length>0?" "+p:p).split(""),v=0;v<m.length;v++){var g=m[v],y=e.getFromCache(g,l,a,n);y+o>c&&(s+=e.addLine(i),i="",o=0),i+=g,o+=y}else i.length>0&&(s+=e.addLine(i),i="",o=0),s+=e.addLine(p),i="",o=0;else f+o>c&&(s+=e.addLine(i),i="",o=0),i.length>0?i+=" "+p:i+=p,o+=f+u}return s+=e.addLine(i,!1)},e.addLine=function(e){return e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e+"\n":e},e.getFromCache=function(e,t,r,n){var i=r[e];if(void 0===i){var o=e.length*t;i=n.measureText(e).width+o,r[e]=i}return i},e.measureFont=function(t){if(e._fonts[t])return e._fonts[t];var r={},n=e._canvas,i=e._context;i.font=t;var o=Math.ceil(i.measureText("|M\xc9q").width),s=Math.ceil(i.measureText("M").width),a=2*s;s=1.4*s|0,n.width=o,n.height=a,i.fillStyle="#f00",i.fillRect(0,0,o,a),i.font=t,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|M\xc9q",0,s);var l=i.getImageData(0,0,o,a).data,c=l.length,u=4*o,h=0,d=0,p=!1;for(h=0;h<s;++h){for(var f=0;f<u;f+=4)if(255!==l[d+f]){p=!0;break}if(p)break;d+=u}for(r.ascent=s-h,d=c-u,p=!1,h=a;h>s;--h){for(var m=0;m<u;m+=4)if(255!==l[d+m]){p=!0;break}if(p)break;d-=u}return r.descent=h-s,r.fontSize=r.ascent+r.descent,e._fonts[t]=r,r},e}();t.default=n;var i=document.createElement("canvas");i.width=i.height=10,n._canvas=i,n._context=i.getContext("2d"),n._fonts={}},TRZq:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t){var r=!t;if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");if(r){var s=document.createElement("canvas");s.width=1,s.height=1,t=n.default.createContext(s)}var a=t.createShader(t.FRAGMENT_SHADER);for(;;){var l=i.replace(/%forloop%/gi,o(e));if(t.shaderSource(a,l),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS))break;e=e/2|0}r&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext();return e};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("yI/K"));var i=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function o(e){for(var t="",r=0;r<e;++r)r>0&&(t+="\nelse "),r<e-1&&(t+="if(test == "+r+".0){}");return t}},TXE8:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("pQYt");var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=Number(t),this.y=Number(r),this.width=Number(n),this.height=Number(o),this.type=i.SHAPES.RECT}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},e.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height)},e.prototype.pad=function(e,t){e=e||0,t=t||(0!==t?e:0),this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t},e.prototype.fit=function(e){this.x<e.x&&(this.width+=this.x,this.width<0&&(this.width=0),this.x=e.x),this.y<e.y&&(this.height+=this.y,this.height<0&&(this.height=0),this.y=e.y),this.x+this.width>e.x+e.width&&(this.width=e.width-this.x,this.width<0&&(this.width=0)),this.y+this.height>e.y+e.height&&(this.height=e.height-this.y,this.height<0&&(this.height=0))},e.prototype.enlarge=function(e){var t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);this.x=t,this.width=r-t,this.y=n,this.height=i-n},n(e,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"EMPTY",get:function(){return new e(0,0,0,0)}}]),e}();t.default=o},Tt2x:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));var i=new n.Rectangle,o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,t.extract=this}return e.prototype.image=function(e){var t=new Image;return t.src=this.base64(e),t},e.prototype.base64=function(e){return this.canvas(e).toDataURL()},e.prototype.canvas=function(e){var t=this.renderer,r=void 0,o=void 0,s=void 0,a=!1,l=void 0,c=!1;e&&(e instanceof n.RenderTexture?l=e:(l=this.renderer.generateTexture(e),c=!0)),l?(o=(r=l.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,s=l.frame,a=!1):(o=(r=this.renderer.rootRenderTarget).resolution,a=!0,(s=i).width=r.size.width,s.height=r.size.height);var u=s.width*o,h=s.height*o,d=new n.CanvasRenderTarget(u,h);if(r){t.bindRenderTarget(r);var p=new Uint8Array(4*u*h),f=t.gl;f.readPixels(s.x*o,s.y*o,u,h,f.RGBA,f.UNSIGNED_BYTE,p);var m=d.context.getImageData(0,0,u,h);m.data.set(p),d.context.putImageData(m,0,0),a&&(d.context.scale(1,-1),d.context.drawImage(d.canvas,0,-h))}return c&&l.destroy(!0),d.canvas},e.prototype.pixels=function(e){var t=this.renderer,r=void 0,o=void 0,s=void 0,a=void 0,l=!1;e&&(e instanceof n.RenderTexture?a=e:(a=this.renderer.generateTexture(e),l=!0)),a?(o=(r=a.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,s=a.frame):(o=(r=this.renderer.rootRenderTarget).resolution,(s=i).width=r.size.width,s.height=r.size.height);var c=s.width*o,u=s.height*o,h=new Uint8Array(4*c*u);if(r){t.bindRenderTarget(r);var d=t.gl;d.readPixels(s.x*o,s.y*o,c,u,d.RGBA,d.UNSIGNED_BYTE,h)}return l&&a.destroy(!0),h},e.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},e}();t.default=o,n.WebGLRenderer.registerPlugin("extract",o)},TyRm:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){for(var t=6*e,r=new Uint16Array(t),n=0,i=0;n<t;n+=6,i+=4)r[n+0]=i+0,r[n+1]=i+1,r[n+2]=i+2,r[n+3]=i+0,r[n+4]=i+2,r[n+5]=i+3;return r}},TypT:function(e,t){t.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},t.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},UdPh:function(e,t,r){"use strict";function n(){}function i(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}t.__esModule=!0,t.eachSeries=function(e,t,r,n){var i=0,o=e.length;!function s(a){a||i===o?r&&r(a):n?setTimeout(function(){t(e[i++],s)},1):t(e[i++],s)}()},t.queue=function(e,t){if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var r=0,o={_tasks:[],concurrency:t,saturated:n,unsaturated:n,buffer:t/4,empty:n,drain:n,error:n,started:!1,paused:!1,push:function(e,t){s(e,!1,t)},kill:function(){r=0,o.drain=n,o.started=!1,o._tasks=[]},unshift:function(e,t){s(e,!0,t)},process:function(){for(;!o.paused&&r<o.concurrency&&o._tasks.length;){var t=o._tasks.shift();0===o._tasks.length&&o.empty(),(r+=1)===o.concurrency&&o.saturated(),e(t.data,i(a(t)))}},length:function(){return o._tasks.length},running:function(){return r},idle:function(){return o._tasks.length+r===0},pause:function(){!0!==o.paused&&(o.paused=!0)},resume:function(){if(!1!==o.paused){o.paused=!1;for(var e=1;e<=o.concurrency;e++)o.process()}}};function s(e,t,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(o.started=!0,null==e&&o.idle())setTimeout(function(){return o.drain()},1);else{var i={data:e,callback:"function"==typeof r?r:n};t?o._tasks.unshift(i):o._tasks.push(i),setTimeout(function(){return o.process()},1)}}function a(e){return function(){r-=1,e.callback.apply(e,arguments),null!=arguments[0]&&o.error(arguments[0],e.data),r<=o.concurrency-o.buffer&&o.unsaturated(),o.idle()&&o.drain(),o.process()}}return o}},Uxeu:function(e,t){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=r.exec(e||""),a={},l=14;l--;)a[n[l]]=s[l]||"";return-1!=i&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},VAGf:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("lsi7"));var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.activeState=new Uint8Array(16),this.defaultState=new Uint8Array(16),this.defaultState[0]=1,this.stackIndex=0,this.stack=[],this.gl=t,this.maxAttribs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)},this.blendModes=(0,n.default)(t),this.nativeVaoExtension=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object")}return e.prototype.push=function(){var e=this.stack[this.stackIndex];e||(e=this.stack[this.stackIndex]=new Uint8Array(16)),++this.stackIndex;for(var t=0;t<this.activeState.length;t++)e[t]=this.activeState[t]},e.prototype.pop=function(){var e=this.stack[--this.stackIndex];this.setState(e)},e.prototype.setState=function(e){this.setBlend(e[0]),this.setDepthTest(e[1]),this.setFrontFace(e[2]),this.setCullFace(e[3]),this.setBlendMode(e[4])},e.prototype.setBlend=function(e){e=e?1:0,this.activeState[0]!==e&&(this.activeState[0]=e,this.gl[e?"enable":"disable"](this.gl.BLEND))},e.prototype.setBlendMode=function(e){if(e!==this.activeState[4]){this.activeState[4]=e;var t=this.blendModes[e];2===t.length?this.gl.blendFunc(t[0],t[1]):this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3])}},e.prototype.setDepthTest=function(e){e=e?1:0,this.activeState[1]!==e&&(this.activeState[1]=e,this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST))},e.prototype.setCullFace=function(e){e=e?1:0,this.activeState[3]!==e&&(this.activeState[3]=e,this.gl[e?"enable":"disable"](this.gl.CULL_FACE))},e.prototype.setFrontFace=function(e){e=e?1:0,this.activeState[2]!==e&&(this.activeState[2]=e,this.gl.frontFace(this.gl[e?"CW":"CCW"]))},e.prototype.resetAttributes=function(){for(var e=0;e<this.attribState.tempAttribState.length;e++)this.attribState.tempAttribState[e]=0;for(var t=0;t<this.attribState.attribState.length;t++)this.attribState.attribState[t]=0;for(var r=1;r<this.maxAttribs;r++)this.gl.disableVertexAttribArray(r)},e.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null),this.resetAttributes();for(var e=0;e<this.activeState.length;++e)this.activeState[e]=32;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.setState(this.defaultState)},e}();t.default=i},VmRL:function(e,t,r){"use strict";function n(e,t,r){r=r||2;var n,a,l,c,u,p,m,v=t&&t.length,g=v?t[0]*r:e.length,y=i(e,0,g,r,!0),x=[];if(!y)return x;if(v&&(y=function(e,t,r,n){var s,a,l,c,u,p=[];for(s=0,a=t.length;s<a;s++)l=t[s]*n,c=s<a-1?t[s+1]*n:e.length,(u=i(e,l,c,n,!1))===u.next&&(u.steiner=!0),p.push(f(u));for(p.sort(h),s=0;s<p.length;s++)d(p[s],r),r=o(r,r.next);return r}(e,t,y,r)),e.length>80*r){n=l=e[0],a=c=e[1];for(var b=r;b<g;b+=r)u=e[b],p=e[b+1],u<n&&(n=u),p<a&&(a=p),u>l&&(l=u),p>c&&(c=p);m=0!==(m=Math.max(l-n,c-a))?1/m:0}return s(y,x,r,n,a,m),x}function i(e,t,r,n,i){var o,s;if(i===M(e,t,r,n)>0)for(o=t;o<r;o+=n)s=_(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=_(o,e[o],e[o+1],s);return s&&y(s,s.next)&&(S(s),s=s.next),s}function o(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!y(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(S(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function s(e,t,r,n,i,h,d){if(e){!d&&h&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=p(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,s,a,l,c=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(s>1)}(i)}(e,n,i,h);for(var f,m,v=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?l(e,n,i,h):a(e))t.push(f.i/r),t.push(e.i/r),t.push(m.i/r),S(e),e=m.next,v=m.next;else if((e=m)===v){d?1===d?s(e=c(e,t,r),t,r,n,i,h,2):2===d&&u(e,t,r,n,i,h):s(o(e),t,r,n,i,h,1);break}}}function a(e){var t=e.prev,r=e,n=e.next;if(g(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(m(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(e,t,r,n){var i=e.prev,o=e,s=e.next;if(g(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=p(a,l,t,r,n),d=p(c,u,t,r,n),f=e.prevZ,v=e.nextZ;f&&f.z>=h&&v&&v.z<=d;){if(f!==e.prev&&f!==e.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=d;){if(v!==e.prev&&v!==e.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function c(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!y(i,o)&&x(i,n,n.next,o)&&b(i,o)&&b(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),S(n),S(n.next),n=e=o),n=n.next}while(n!==e);return n}function u(e,t,r,n,i,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var u=w(l,c);return l=o(l,l.next),u=o(u,u.next),s(l,t,r,n,i,a),void s(u,t,r,n,i,a)}c=c.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function d(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;n=r.next;for(;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&m(o<h?i:s,o,u,h,o<h?s:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&b(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=w(t,e);o(r,r.next)}}function p(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,n,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&x(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&b(e,t)&&b(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,r,n){return!!(y(e,t)&&y(r,n)||y(e,n)&&y(r,t))||g(e,t,r)>0!=g(e,t,n)>0&&g(r,n,e)>0!=g(r,n,t)>0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var r=new T(e.i,e.x,e.y),n=new T(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function _(e,t,r,n){var i=new T(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,r,n){for(var i=0,o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}e.exports=n,e.exports.default=n,n.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,s=Math.abs(M(e,0,o,r));if(i)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,u=a<l-1?t[a+1]*r:e.length;s-=Math.abs(M(e,c,u,r))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*r,p=n[a+1]*r,f=n[a+2]*r;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},n.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[i][o][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}},Vo14:function(e,t,r){var n=r("NOtv")("socket.io-parser"),i=r("cpc2"),o=r("cD5x"),s=r("49sm"),a=r("+SKG");function l(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=l,t.Decoder=h;var c=t.ERROR+'"encode error"';function u(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var i=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===i)return c;r+=i}return n("encoded %j as %s",e,r),r}function h(){this.reconstructor=null}function d(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:t.ERROR,data:"parser error: "+e}}l.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){o.removeBlobs(e,function(e){var r=o.deconstructPacket(e),n=u(r.packet),i=r.buffers;i.unshift(n),t(i)})}(e,r):r([u(e)])},i(h.prototype),h.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,i={type:Number(e.charAt(0))};if(null==t.types[i.type])return p("unknown packet type "+i.type);if(t.BINARY_EVENT===i.type||t.BINARY_ACK===i.type){for(var o="";"-"!==e.charAt(++r)&&(o+=e.charAt(r),r!=e.length););if(o!=Number(o)||"-"!==e.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===e.charAt(r+1))for(i.nsp="";++r;){var a=e.charAt(r);if(","===a)break;if(i.nsp+=a,r===e.length)break}else i.nsp="/";var l=e.charAt(r+1);if(""!==l&&Number(l)==l){for(i.id="";++r;){var a=e.charAt(r);if(null==a||Number(a)!=a){--r;break}if(i.id+=e.charAt(r),r===e.length)break}i.id=Number(i.id)}if(e.charAt(++r)){var c=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r)),u=!1!==c&&(i.type===t.ERROR||s(c));if(!u)return p("invalid payload");i.data=c}return n("decoded %s as %j",e,i),i}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new d(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},W3bV:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("TXE8")),i=r("pQYt");var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=r,this.radius=n,this.type=i.SHAPES.CIRC}return e.prototype.clone=function(){return new e(this.x,this.y,this.radius)},e.prototype.contains=function(e,t){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-e,i=this.y-t;return(n*=n)+(i*=i)<=r},e.prototype.getBounds=function(){return new n.default(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},e}();t.default=o},WJwb:function(e,t,r){"use strict";t.__esModule=!0;var n=o(r("3Jm9")),i=o(r("Yd/J"));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments[2],s=arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,null,o));return a.resolution=s||i.default.RESOLUTION,a.width=Math.ceil(r),a.height=Math.ceil(n),a.realWidth=a.width*a.resolution,a.realHeight=a.height*a.resolution,a.scaleMode=void 0!==o?o:i.default.SCALE_MODE,a.hasLoaded=!0,a._glRenderTargets={},a._canvasRenderTarget=null,a.valid=!1,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.resize=function(e,t){e=Math.ceil(e),t=Math.ceil(t),e===this.width&&t===this.height||(this.valid=e>0&&t>0,this.width=e,this.height=t,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this))},t.prototype.destroy=function(){e.prototype.destroy.call(this,!0),this.renderer=null},t}(n.default);t.default=s},WLGk:function(e,t,r){var n=r("49sm"),i=Object.prototype.toString,o="function"==typeof global.Blob||"[object BlobConstructor]"===i.call(global.Blob),s="function"==typeof global.File||"[object FileConstructor]"===i.call(global.File);e.exports=function e(t){if(!t||"object"!=typeof t)return!1;if(n(t)){for(var r=0,i=t.length;r<i;r++)if(e(t[r]))return!0;return!1}if("function"==typeof global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(t)||"function"==typeof global.ArrayBuffer&&t instanceof ArrayBuffer||o&&t instanceof Blob||s&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&e(t[a]))return!0;return!1}},Wm4p:function(e,t,r){var n,i=r("dkv/"),o=r("WLGk"),s=r("ypnn"),a=r("zMFY"),l=r("oIG/");global&&global.ArrayBuffer&&(n=r("g5Dd"));var c="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),h=c||u;t.protocol=3;var d=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=i(d),f={type:"error",data:"parser error"},m=r("14A5");function v(e,t,r){for(var n=new Array(e.length),i=a(e.length,r),o=function(e,r,i){t(r,function(t,r){n[e]=r,i(t,n)})},s=0;s<e.length;s++)o(s,e[s],i)}t.encodePacket=function(e,r,n,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof n&&(i=n,n=null);var o=void 0===e.data?void 0:e.data.buffer||e.data;if(global.ArrayBuffer&&o instanceof ArrayBuffer)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=d[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return n(s.buffer)}(e,r,i);if(m&&o instanceof global.Blob)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(h)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,r,!0,n)},i.readAsArrayBuffer(e.data)}(e,r,n);var i=new Uint8Array(1);i[0]=d[e.type];var o=new m([i.buffer,e.data]);return n(o)}(e,r,i);if(o&&o.base64)return function(e,r){var n="b"+t.packets[e.type]+e.data.data;return r(n)}(e,i);var s=d[e.type];return void 0!==e.data&&(s+=n?l.encode(String(e.data),{strict:!1}):String(e.data)),i(""+s)},t.encodeBase64Packet=function(e,r){var n,i="b"+t.packets[e.type];if(m&&e.data instanceof global.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];r(i+e)},o.readAsDataURL(e.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),l=0;l<s.length;l++)a[l]=s[l];n=String.fromCharCode.apply(null,a)}return i+=global.btoa(n),r(i)},t.decodePacket=function(e,r,n){if(void 0===e)return f;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&!1===(e=function(e){try{e=l.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return f;var i=e.charAt(0);return Number(i)==i&&p[i]?e.length>1?{type:p[i],data:e.substring(1)}:{type:p[i]}:f}i=new Uint8Array(e)[0];var o=s(e,1);return m&&"blob"===r&&(o=new m([o])),{type:p[i],data:o}},t.decodeBase64Packet=function(e,t){var r=p[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=n.decode(e.substr(1));return"blob"===t&&m&&(i=new m([i])),{type:r,data:i}},t.encodePayload=function(e,r,n){"function"==typeof r&&(n=r,r=null);var i=o(e);if(r&&i)return m&&!h?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");v(e,function(e,n){t.encodePacket(e,!!i&&r,!1,function(e){n(null,function(e){return e.length+":"+e}(e))})},function(e,t){return n(t.join(""))})},t.decodePayload=function(e,r,n){if("string"!=typeof e)return t.decodePayloadAsBinary(e,r,n);var i;if("function"==typeof r&&(n=r,r=null),""===e)return n(f,0,1);for(var o,s,a="",l=0,c=e.length;l<c;l++){var u=e.charAt(l);if(":"===u){if(""===a||a!=(o=Number(a)))return n(f,0,1);if(a!=(s=e.substr(l+1,o)).length)return n(f,0,1);if(s.length){if(i=t.decodePacket(s,r,!1),f.type===i.type&&f.data===i.data)return n(f,0,1);if(!1===n(i,l+o,c))return}l+=o,a=""}else a+=u}return""!==a?n(f,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));v(e,function(e,r){t.encodePacket(e,!0,!0,function(e){return r(null,e)})},function(e,t){var n=t.reduce(function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2},0),i=new Uint8Array(n),o=0;return t.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);r=n.buffer}i[o++]=t?0:1;var a=r.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(n=new Uint8Array(r),s=0;s<n.length;s++)i[o++]=n[s]}),r(i.buffer)})},t.encodePayloadAsBlob=function(e,r){v(e,function(e,r){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,m){var a=new m([t.buffer,s.buffer,e]);r(null,a)}})},function(e,t){return r(new m(t))})},t.decodePayloadAsBinary=function(e,r,n){"function"==typeof r&&(n=r,r=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),l=0===a[0],c="",u=1;255!==a[u];u++){if(c.length>310)return n(f,0,1);c+=a[u]}i=s(i,2+c.length),c=parseInt(c);var h=s(i,0,c);if(l)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(e){var d=new Uint8Array(h);h="";for(u=0;u<d.length;u++)h+=String.fromCharCode(d[u])}o.push(h),i=s(i,c)}var p=o.length;o.forEach(function(e,i){n(t.decodePacket(e,r,!0),i,p)})}},Womt:function(e,t,r){"use strict";function n(){}r.r(t),r.d(t,"WebGLRenderTargetCube",function(){return Wt}),r.d(t,"WebGLRenderTarget",function(){return Ht}),r.d(t,"WebGLRenderer",function(){return ei}),r.d(t,"ShaderLib",function(){return rr}),r.d(t,"UniformsLib",function(){return tr}),r.d(t,"UniformsUtils",function(){return Kt}),r.d(t,"ShaderChunk",function(){return Qt}),r.d(t,"FogExp2",function(){return ti}),r.d(t,"Fog",function(){return ri}),r.d(t,"Scene",function(){return ni}),r.d(t,"Sprite",function(){return oi}),r.d(t,"LOD",function(){return si}),r.d(t,"SkinnedMesh",function(){return ci}),r.d(t,"Skeleton",function(){return ai}),r.d(t,"Bone",function(){return li}),r.d(t,"Mesh",function(){return Ur}),r.d(t,"LineSegments",function(){return di}),r.d(t,"LineLoop",function(){return pi}),r.d(t,"Line",function(){return hi}),r.d(t,"Points",function(){return mi}),r.d(t,"Group",function(){return vi}),r.d(t,"VideoTexture",function(){return gi}),r.d(t,"DataTexture",function(){return Xt}),r.d(t,"CompressedTexture",function(){return yi}),r.d(t,"CubeTexture",function(){return jr}),r.d(t,"CanvasTexture",function(){return qn}),r.d(t,"DepthTexture",function(){return xi}),r.d(t,"Texture",function(){return Vt}),r.d(t,"CompressedTextureLoader",function(){return qo}),r.d(t,"DataTextureLoader",function(){return Yo}),r.d(t,"CubeTextureLoader",function(){return Zo}),r.d(t,"TextureLoader",function(){return Qo}),r.d(t,"ObjectLoader",function(){return Qs}),r.d(t,"MaterialLoader",function(){return Ws}),r.d(t,"BufferGeometryLoader",function(){return Xs}),r.d(t,"DefaultLoadingManager",function(){return Ho}),r.d(t,"LoadingManager",function(){return Go}),r.d(t,"JSONLoader",function(){return Zs}),r.d(t,"ImageLoader",function(){return Jo}),r.d(t,"ImageBitmapLoader",function(){return ra}),r.d(t,"FontLoader",function(){return sa}),r.d(t,"FileLoader",function(){return Xo}),r.d(t,"Loader",function(){return Ys}),r.d(t,"LoaderUtils",function(){return Js}),r.d(t,"Cache",function(){return Vo}),r.d(t,"AudioLoader",function(){return la}),r.d(t,"SpotLightShadow",function(){return Ts}),r.d(t,"SpotLight",function(){return Ms}),r.d(t,"PointLight",function(){return As}),r.d(t,"RectAreaLight",function(){return Os}),r.d(t,"HemisphereLight",function(){return _s}),r.d(t,"DirectionalLightShadow",function(){return Es}),r.d(t,"DirectionalLight",function(){return Cs}),r.d(t,"AmbientLight",function(){return Ps}),r.d(t,"LightShadow",function(){return Ss}),r.d(t,"Light",function(){return ws}),r.d(t,"StereoCamera",function(){return ca}),r.d(t,"PerspectiveCamera",function(){return Qn}),r.d(t,"OrthographicCamera",function(){return cr}),r.d(t,"CubeCamera",function(){return ua}),r.d(t,"ArrayCamera",function(){return Kn}),r.d(t,"Camera",function(){return lr}),r.d(t,"AudioListener",function(){return ha}),r.d(t,"PositionalAudio",function(){return pa}),r.d(t,"AudioContext",function(){return aa}),r.d(t,"AudioAnalyser",function(){return fa}),r.d(t,"Audio",function(){return da}),r.d(t,"VectorKeyframeTrack",function(){return Gs}),r.d(t,"StringKeyframeTrack",function(){return Ds}),r.d(t,"QuaternionKeyframeTrack",function(){return Rs}),r.d(t,"NumberKeyframeTrack",function(){return ks}),r.d(t,"ColorKeyframeTrack",function(){return Fs}),r.d(t,"BooleanKeyframeTrack",function(){return Ns}),r.d(t,"PropertyMixer",function(){return ma}),r.d(t,"PropertyBinding",function(){return xa}),r.d(t,"KeyframeTrack",function(){return Vs}),r.d(t,"AnimationUtils",function(){return zs}),r.d(t,"AnimationObjectGroup",function(){return ba}),r.d(t,"AnimationMixer",function(){return _a}),r.d(t,"AnimationClip",function(){return Hs}),r.d(t,"Uniform",function(){return Sa}),r.d(t,"InstancedBufferGeometry",function(){return Ta}),r.d(t,"BufferGeometry",function(){return Ar}),r.d(t,"Geometry",function(){return dr}),r.d(t,"InterleavedBufferAttribute",function(){return Ma}),r.d(t,"InstancedInterleavedBuffer",function(){return Ea}),r.d(t,"InterleavedBuffer",function(){return Aa}),r.d(t,"InstancedBufferAttribute",function(){return Ca}),r.d(t,"Face3",function(){return ur}),r.d(t,"Object3D",function(){return ar}),r.d(t,"Raycaster",function(){return Pa}),r.d(t,"Layers",function(){return or}),r.d(t,"EventDispatcher",function(){return n}),r.d(t,"Clock",function(){return Na}),r.d(t,"QuaternionLinearInterpolant",function(){return Is}),r.d(t,"LinearInterpolant",function(){return Bs}),r.d(t,"DiscreteInterpolant",function(){return js}),r.d(t,"CubicInterpolant",function(){return Us}),r.d(t,"Interpolant",function(){return Ls}),r.d(t,"Triangle",function(){return kr}),r.d(t,"Math",function(){return Rt}),r.d(t,"Spherical",function(){return La}),r.d(t,"Cylindrical",function(){return Ia}),r.d(t,"Plane",function(){return Jt}),r.d(t,"Frustum",function(){return Zt}),r.d(t,"Sphere",function(){return Yt}),r.d(t,"Ray",function(){return Rr}),r.d(t,"Matrix4",function(){return kt}),r.d(t,"Matrix3",function(){return jt}),r.d(t,"Box3",function(){return qt}),r.d(t,"Box2",function(){return Ra}),r.d(t,"Line3",function(){return Fr}),r.d(t,"Euler",function(){return ir}),r.d(t,"Vector4",function(){return Gt}),r.d(t,"Vector3",function(){return Bt}),r.d(t,"Vector2",function(){return Ft}),r.d(t,"Quaternion",function(){return Ut}),r.d(t,"Color",function(){return er}),r.d(t,"ImmediateRenderObject",function(){return Fa}),r.d(t,"VertexNormalsHelper",function(){return ka}),r.d(t,"SpotLightHelper",function(){return Ua}),r.d(t,"SkeletonHelper",function(){return Ba}),r.d(t,"PointLightHelper",function(){return ja}),r.d(t,"RectAreaLightHelper",function(){return za}),r.d(t,"HemisphereLightHelper",function(){return Va}),r.d(t,"GridHelper",function(){return Ga}),r.d(t,"PolarGridHelper",function(){return Ha}),r.d(t,"FaceNormalsHelper",function(){return Wa}),r.d(t,"DirectionalLightHelper",function(){return Xa}),r.d(t,"CameraHelper",function(){return qa}),r.d(t,"BoxHelper",function(){return Ya}),r.d(t,"Box3Helper",function(){return Ja}),r.d(t,"PlaneHelper",function(){return Za}),r.d(t,"ArrowHelper",function(){return Qa}),r.d(t,"AxesHelper",function(){return Ka}),r.d(t,"Shape",function(){return bs}),r.d(t,"Path",function(){return xs}),r.d(t,"ShapePath",function(){return na}),r.d(t,"Font",function(){return ia}),r.d(t,"CurvePath",function(){return ys}),r.d(t,"Curve",function(){return Ko}),r.d(t,"ShapeUtils",function(){return ao}),r.d(t,"WebGLUtils",function(){return Zn}),r.d(t,"WireframeGeometry",function(){return bi}),r.d(t,"ParametricGeometry",function(){return wi}),r.d(t,"ParametricBufferGeometry",function(){return _i}),r.d(t,"TetrahedronGeometry",function(){return Mi}),r.d(t,"TetrahedronBufferGeometry",function(){return Ai}),r.d(t,"OctahedronGeometry",function(){return Ei}),r.d(t,"OctahedronBufferGeometry",function(){return Ci}),r.d(t,"IcosahedronGeometry",function(){return Pi}),r.d(t,"IcosahedronBufferGeometry",function(){return Oi}),r.d(t,"DodecahedronGeometry",function(){return Di}),r.d(t,"DodecahedronBufferGeometry",function(){return Ni}),r.d(t,"PolyhedronGeometry",function(){return Si}),r.d(t,"PolyhedronBufferGeometry",function(){return Ti}),r.d(t,"TubeGeometry",function(){return Li}),r.d(t,"TubeBufferGeometry",function(){return Ii}),r.d(t,"TorusKnotGeometry",function(){return Ri}),r.d(t,"TorusKnotBufferGeometry",function(){return Fi}),r.d(t,"TorusGeometry",function(){return ki}),r.d(t,"TorusBufferGeometry",function(){return Ui}),r.d(t,"TextGeometry",function(){return po}),r.d(t,"TextBufferGeometry",function(){return fo}),r.d(t,"SphereGeometry",function(){return mo}),r.d(t,"SphereBufferGeometry",function(){return vo}),r.d(t,"RingGeometry",function(){return go}),r.d(t,"RingBufferGeometry",function(){return yo}),r.d(t,"PlaneGeometry",function(){return Pr}),r.d(t,"PlaneBufferGeometry",function(){return Or}),r.d(t,"LatheGeometry",function(){return xo}),r.d(t,"LatheBufferGeometry",function(){return bo}),r.d(t,"ShapeGeometry",function(){return wo}),r.d(t,"ShapeBufferGeometry",function(){return _o}),r.d(t,"ExtrudeGeometry",function(){return uo}),r.d(t,"ExtrudeBufferGeometry",function(){return ho}),r.d(t,"EdgesGeometry",function(){return To}),r.d(t,"ConeGeometry",function(){return Eo}),r.d(t,"ConeBufferGeometry",function(){return Co}),r.d(t,"CylinderGeometry",function(){return Mo}),r.d(t,"CylinderBufferGeometry",function(){return Ao}),r.d(t,"CircleGeometry",function(){return Po}),r.d(t,"CircleBufferGeometry",function(){return Oo}),r.d(t,"BoxGeometry",function(){return Er}),r.d(t,"BoxBufferGeometry",function(){return Cr}),r.d(t,"ShadowMaterial",function(){return No}),r.d(t,"SpriteMaterial",function(){return ii}),r.d(t,"RawShaderMaterial",function(){return Lo}),r.d(t,"ShaderMaterial",function(){return Ir}),r.d(t,"PointsMaterial",function(){return fi}),r.d(t,"MeshPhysicalMaterial",function(){return Ro}),r.d(t,"MeshStandardMaterial",function(){return Io}),r.d(t,"MeshPhongMaterial",function(){return Fo}),r.d(t,"MeshToonMaterial",function(){return ko}),r.d(t,"MeshNormalMaterial",function(){return Uo}),r.d(t,"MeshLambertMaterial",function(){return Bo}),r.d(t,"MeshDepthMaterial",function(){return Hn}),r.d(t,"MeshDistanceMaterial",function(){return Wn}),r.d(t,"MeshBasicMaterial",function(){return Lr}),r.d(t,"LineDashedMaterial",function(){return jo}),r.d(t,"LineBasicMaterial",function(){return ui}),r.d(t,"Material",function(){return Nr}),r.d(t,"Float64BufferAttribute",function(){return _r}),r.d(t,"Float32BufferAttribute",function(){return wr}),r.d(t,"Uint32BufferAttribute",function(){return br}),r.d(t,"Int32BufferAttribute",function(){return xr}),r.d(t,"Uint16BufferAttribute",function(){return yr}),r.d(t,"Int16BufferAttribute",function(){return gr}),r.d(t,"Uint8ClampedBufferAttribute",function(){return vr}),r.d(t,"Uint8BufferAttribute",function(){return mr}),r.d(t,"Int8BufferAttribute",function(){return fr}),r.d(t,"BufferAttribute",function(){return pr}),r.d(t,"ArcCurve",function(){return es}),r.d(t,"CatmullRomCurve3",function(){return ss}),r.d(t,"CubicBezierCurve",function(){return us}),r.d(t,"CubicBezierCurve3",function(){return hs}),r.d(t,"EllipseCurve",function(){return $o}),r.d(t,"LineCurve",function(){return ds}),r.d(t,"LineCurve3",function(){return ps}),r.d(t,"QuadraticBezierCurve",function(){return fs}),r.d(t,"QuadraticBezierCurve3",function(){return ms}),r.d(t,"SplineCurve",function(){return vs}),r.d(t,"REVISION",function(){return i}),r.d(t,"MOUSE",function(){return o}),r.d(t,"CullFaceNone",function(){return s}),r.d(t,"CullFaceBack",function(){return a}),r.d(t,"CullFaceFront",function(){return l}),r.d(t,"CullFaceFrontBack",function(){return c}),r.d(t,"FrontFaceDirectionCW",function(){return u}),r.d(t,"FrontFaceDirectionCCW",function(){return h}),r.d(t,"BasicShadowMap",function(){return d}),r.d(t,"PCFShadowMap",function(){return p}),r.d(t,"PCFSoftShadowMap",function(){return f}),r.d(t,"FrontSide",function(){return m}),r.d(t,"BackSide",function(){return v}),r.d(t,"DoubleSide",function(){return g}),r.d(t,"FlatShading",function(){return y}),r.d(t,"SmoothShading",function(){return x}),r.d(t,"NoColors",function(){return b}),r.d(t,"FaceColors",function(){return w}),r.d(t,"VertexColors",function(){return _}),r.d(t,"NoBlending",function(){return S}),r.d(t,"NormalBlending",function(){return T}),r.d(t,"AdditiveBlending",function(){return M}),r.d(t,"SubtractiveBlending",function(){return A}),r.d(t,"MultiplyBlending",function(){return E}),r.d(t,"CustomBlending",function(){return C}),r.d(t,"AddEquation",function(){return P}),r.d(t,"SubtractEquation",function(){return O}),r.d(t,"ReverseSubtractEquation",function(){return D}),r.d(t,"MinEquation",function(){return N}),r.d(t,"MaxEquation",function(){return L}),r.d(t,"ZeroFactor",function(){return I}),r.d(t,"OneFactor",function(){return R}),r.d(t,"SrcColorFactor",function(){return F}),r.d(t,"OneMinusSrcColorFactor",function(){return k}),r.d(t,"SrcAlphaFactor",function(){return U}),r.d(t,"OneMinusSrcAlphaFactor",function(){return B}),r.d(t,"DstAlphaFactor",function(){return j}),r.d(t,"OneMinusDstAlphaFactor",function(){return z}),r.d(t,"DstColorFactor",function(){return V}),r.d(t,"OneMinusDstColorFactor",function(){return G}),r.d(t,"SrcAlphaSaturateFactor",function(){return H}),r.d(t,"NeverDepth",function(){return W}),r.d(t,"AlwaysDepth",function(){return X}),r.d(t,"LessDepth",function(){return q}),r.d(t,"LessEqualDepth",function(){return Y}),r.d(t,"EqualDepth",function(){return J}),r.d(t,"GreaterEqualDepth",function(){return Z}),r.d(t,"GreaterDepth",function(){return Q}),r.d(t,"NotEqualDepth",function(){return K}),r.d(t,"MultiplyOperation",function(){return $}),r.d(t,"MixOperation",function(){return ee}),r.d(t,"AddOperation",function(){return te}),r.d(t,"NoToneMapping",function(){return re}),r.d(t,"LinearToneMapping",function(){return ne}),r.d(t,"ReinhardToneMapping",function(){return ie}),r.d(t,"Uncharted2ToneMapping",function(){return oe}),r.d(t,"CineonToneMapping",function(){return se}),r.d(t,"UVMapping",function(){return ae}),r.d(t,"CubeReflectionMapping",function(){return le}),r.d(t,"CubeRefractionMapping",function(){return ce}),r.d(t,"EquirectangularReflectionMapping",function(){return ue}),r.d(t,"EquirectangularRefractionMapping",function(){return he}),r.d(t,"SphericalReflectionMapping",function(){return de}),r.d(t,"CubeUVReflectionMapping",function(){return pe}),r.d(t,"CubeUVRefractionMapping",function(){return fe}),r.d(t,"RepeatWrapping",function(){return me}),r.d(t,"ClampToEdgeWrapping",function(){return ve}),r.d(t,"MirroredRepeatWrapping",function(){return ge}),r.d(t,"NearestFilter",function(){return ye}),r.d(t,"NearestMipMapNearestFilter",function(){return xe}),r.d(t,"NearestMipMapLinearFilter",function(){return be}),r.d(t,"LinearFilter",function(){return we}),r.d(t,"LinearMipMapNearestFilter",function(){return _e}),r.d(t,"LinearMipMapLinearFilter",function(){return Se}),r.d(t,"UnsignedByteType",function(){return Te}),r.d(t,"ByteType",function(){return Me}),r.d(t,"ShortType",function(){return Ae}),r.d(t,"UnsignedShortType",function(){return Ee}),r.d(t,"IntType",function(){return Ce}),r.d(t,"UnsignedIntType",function(){return Pe}),r.d(t,"FloatType",function(){return Oe}),r.d(t,"HalfFloatType",function(){return De}),r.d(t,"UnsignedShort4444Type",function(){return Ne}),r.d(t,"UnsignedShort5551Type",function(){return Le}),r.d(t,"UnsignedShort565Type",function(){return Ie}),r.d(t,"UnsignedInt248Type",function(){return Re}),r.d(t,"AlphaFormat",function(){return Fe}),r.d(t,"RGBFormat",function(){return ke}),r.d(t,"RGBAFormat",function(){return Ue}),r.d(t,"LuminanceFormat",function(){return Be}),r.d(t,"LuminanceAlphaFormat",function(){return je}),r.d(t,"RGBEFormat",function(){return ze}),r.d(t,"DepthFormat",function(){return Ve}),r.d(t,"DepthStencilFormat",function(){return Ge}),r.d(t,"RGB_S3TC_DXT1_Format",function(){return He}),r.d(t,"RGBA_S3TC_DXT1_Format",function(){return We}),r.d(t,"RGBA_S3TC_DXT3_Format",function(){return Xe}),r.d(t,"RGBA_S3TC_DXT5_Format",function(){return qe}),r.d(t,"RGB_PVRTC_4BPPV1_Format",function(){return Ye}),r.d(t,"RGB_PVRTC_2BPPV1_Format",function(){return Je}),r.d(t,"RGBA_PVRTC_4BPPV1_Format",function(){return Ze}),r.d(t,"RGBA_PVRTC_2BPPV1_Format",function(){return Qe}),r.d(t,"RGB_ETC1_Format",function(){return Ke}),r.d(t,"RGBA_ASTC_4x4_Format",function(){return $e}),r.d(t,"RGBA_ASTC_5x4_Format",function(){return et}),r.d(t,"RGBA_ASTC_5x5_Format",function(){return tt}),r.d(t,"RGBA_ASTC_6x5_Format",function(){return rt}),r.d(t,"RGBA_ASTC_6x6_Format",function(){return nt}),r.d(t,"RGBA_ASTC_8x5_Format",function(){return it}),r.d(t,"RGBA_ASTC_8x6_Format",function(){return ot}),r.d(t,"RGBA_ASTC_8x8_Format",function(){return st}),r.d(t,"RGBA_ASTC_10x5_Format",function(){return at}),r.d(t,"RGBA_ASTC_10x6_Format",function(){return lt}),r.d(t,"RGBA_ASTC_10x8_Format",function(){return ct}),r.d(t,"RGBA_ASTC_10x10_Format",function(){return ut}),r.d(t,"RGBA_ASTC_12x10_Format",function(){return ht}),r.d(t,"RGBA_ASTC_12x12_Format",function(){return dt}),r.d(t,"LoopOnce",function(){return pt}),r.d(t,"LoopRepeat",function(){return ft}),r.d(t,"LoopPingPong",function(){return mt}),r.d(t,"InterpolateDiscrete",function(){return vt}),r.d(t,"InterpolateLinear",function(){return gt}),r.d(t,"InterpolateSmooth",function(){return yt}),r.d(t,"ZeroCurvatureEnding",function(){return xt}),r.d(t,"ZeroSlopeEnding",function(){return bt}),r.d(t,"WrapAroundEnding",function(){return wt}),r.d(t,"TrianglesDrawMode",function(){return _t}),r.d(t,"TriangleStripDrawMode",function(){return St}),r.d(t,"TriangleFanDrawMode",function(){return Tt}),r.d(t,"LinearEncoding",function(){return Mt}),r.d(t,"sRGBEncoding",function(){return At}),r.d(t,"GammaEncoding",function(){return Et}),r.d(t,"RGBEEncoding",function(){return Ct}),r.d(t,"LogLuvEncoding",function(){return Pt}),r.d(t,"RGBM7Encoding",function(){return Ot}),r.d(t,"RGBM16Encoding",function(){return Dt}),r.d(t,"RGBDEncoding",function(){return Nt}),r.d(t,"BasicDepthPacking",function(){return Lt}),r.d(t,"RGBADepthPacking",function(){return It}),r.d(t,"CubeGeometry",function(){return Er}),r.d(t,"Face4",function(){return $a}),r.d(t,"LineStrip",function(){return el}),r.d(t,"LinePieces",function(){return tl}),r.d(t,"MeshFaceMaterial",function(){return rl}),r.d(t,"MultiMaterial",function(){return nl}),r.d(t,"PointCloud",function(){return il}),r.d(t,"Particle",function(){return ol}),r.d(t,"ParticleSystem",function(){return sl}),r.d(t,"PointCloudMaterial",function(){return al}),r.d(t,"ParticleBasicMaterial",function(){return ll}),r.d(t,"ParticleSystemMaterial",function(){return cl}),r.d(t,"Vertex",function(){return ul}),r.d(t,"DynamicBufferAttribute",function(){return hl}),r.d(t,"Int8Attribute",function(){return dl}),r.d(t,"Uint8Attribute",function(){return pl}),r.d(t,"Uint8ClampedAttribute",function(){return fl}),r.d(t,"Int16Attribute",function(){return ml}),r.d(t,"Uint16Attribute",function(){return vl}),r.d(t,"Int32Attribute",function(){return gl}),r.d(t,"Uint32Attribute",function(){return yl}),r.d(t,"Float32Attribute",function(){return xl}),r.d(t,"Float64Attribute",function(){return bl}),r.d(t,"ClosedSplineCurve3",function(){return wl}),r.d(t,"SplineCurve3",function(){return _l}),r.d(t,"Spline",function(){return Sl}),r.d(t,"AxisHelper",function(){return Tl}),r.d(t,"BoundingBoxHelper",function(){return Ml}),r.d(t,"EdgesHelper",function(){return Al}),r.d(t,"WireframeHelper",function(){return El}),r.d(t,"XHRLoader",function(){return Cl}),r.d(t,"BinaryTextureLoader",function(){return Pl}),r.d(t,"GeometryUtils",function(){return Ol}),r.d(t,"ImageUtils",function(){return Dl}),r.d(t,"Projector",function(){return Nl}),r.d(t,"CanvasRenderer",function(){return Ll}),r.d(t,"SceneUtils",function(){return Il}),r.d(t,"LensFlare",function(){return Rl}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),Object.assign(n.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}});var i="91",o={LEFT:0,MIDDLE:1,RIGHT:2},s=0,a=1,l=2,c=3,u=0,h=1,d=0,p=1,f=2,m=0,v=1,g=2,y=1,x=2,b=0,w=1,_=2,S=0,T=1,M=2,A=3,E=4,C=5,P=100,O=101,D=102,N=103,L=104,I=200,R=201,F=202,k=203,U=204,B=205,j=206,z=207,V=208,G=209,H=210,W=0,X=1,q=2,Y=3,J=4,Z=5,Q=6,K=7,$=0,ee=1,te=2,re=0,ne=1,ie=2,oe=3,se=4,ae=300,le=301,ce=302,ue=303,he=304,de=305,pe=306,fe=307,me=1e3,ve=1001,ge=1002,ye=1003,xe=1004,be=1005,we=1006,_e=1007,Se=1008,Te=1009,Me=1010,Ae=1011,Ee=1012,Ce=1013,Pe=1014,Oe=1015,De=1016,Ne=1017,Le=1018,Ie=1019,Re=1020,Fe=1021,ke=1022,Ue=1023,Be=1024,je=1025,ze=Ue,Ve=1026,Ge=1027,He=33776,We=33777,Xe=33778,qe=33779,Ye=35840,Je=35841,Ze=35842,Qe=35843,Ke=36196,$e=37808,et=37809,tt=37810,rt=37811,nt=37812,it=37813,ot=37814,st=37815,at=37816,lt=37817,ct=37818,ut=37819,ht=37820,dt=37821,pt=2200,ft=2201,mt=2202,vt=2300,gt=2301,yt=2302,xt=2400,bt=2401,wt=2402,_t=0,St=1,Tt=2,Mt=3e3,At=3001,Et=3007,Ct=3002,Pt=3003,Ot=3004,Dt=3005,Nt=3006,Lt=3200,It=3201,Rt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16).toUpperCase();return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Rt.DEG2RAD},radToDeg:function(e){return e*Rt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Ft(e,t){this.x=e||0,this.y=t||0}function kt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Ut(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}function Bt(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function jt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Ft.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Ft.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new Ft,t=new Ft;return function(r,n){return e.set(r,r),t.set(n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*r-o*n+e.x,this.y=i*n+o*r+e.y,this}}),Object.assign(kt.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,o,s,a,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=s,v[13]=a,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new kt).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new Bt;return function(t){var r=this.elements,n=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*s,r[9]=n[9]*s,r[10]=n[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r),s=Math.sin(r),a=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var h=o*c,d=o*u,p=s*c,f=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=p+d*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*c,v=a*u,g=l*c,y=l*u;t[0]=m+y*s,t[4]=g*s-v,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=v*s-g,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*c,v=a*u,g=l*c,y=l*u;t[0]=m-y*s,t[4]=-o*u,t[8]=g+v*s,t[1]=v+g*s,t[5]=o*c,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){h=o*c,d=o*u,p=s*c,f=s*u;t[0]=a*c,t[4]=p*l-d,t[8]=h*l+f,t[1]=a*u,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var x=o*a,b=o*l,w=s*a,_=s*l;t[0]=a*c,t[4]=_-x*u,t[8]=w*u+b,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=b*u+w,t[10]=x-_*u}else if("XZY"===e.order){x=o*a,b=o*l,w=s*a,_=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=x*u+_,t[5]=o*c,t[9]=b*u-w,t[2]=w*u-b,t[6]=s*c,t[10]=_*u+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,r=e._x,n=e._y,i=e._z,o=e._w,s=r+r,a=n+n,l=i+i,c=r*s,u=r*a,h=r*l,d=n*a,p=n*l,f=i*l,m=o*s,v=o*a,g=o*l;return t[0]=1-(d+f),t[4]=u-g,t[8]=h+v,t[1]=u+g,t[5]=1-(c+f),t[9]=p-m,t[2]=h-v,t[6]=p+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new Bt,t=new Bt,r=new Bt;return function(n,i,o){var s=this.elements;return r.subVectors(n,i),0===r.lengthSq()&&(r.z=1),r.normalize(),e.crossVectors(o,r),0===e.lengthSq()&&(1===Math.abs(o.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),e.crossVectors(o,r)),e.normalize(),t.crossVectors(r,e),s[0]=e.x,s[4]=t.x,s[8]=r.x,s[1]=e.y,s[5]=t.y,s[9]=r.y,s[2]=e.z,s[6]=t.z,s[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],s=r[4],a=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=n[0],_=n[4],S=n[8],T=n[12],M=n[1],A=n[5],E=n[9],C=n[13],P=n[2],O=n[6],D=n[10],N=n[14],L=n[3],I=n[7],R=n[11],F=n[15];return i[0]=o*w+s*M+a*P+l*L,i[4]=o*_+s*A+a*O+l*I,i[8]=o*S+s*E+a*D+l*R,i[12]=o*T+s*C+a*N+l*F,i[1]=c*w+u*M+h*P+d*L,i[5]=c*_+u*A+h*O+d*I,i[9]=c*S+u*E+h*D+d*R,i[13]=c*T+u*C+h*N+d*F,i[2]=p*w+f*M+m*P+v*L,i[6]=p*_+f*A+m*O+v*I,i[10]=p*S+f*E+m*D+v*R,i[14]=p*T+f*C+m*N+v*F,i[3]=g*w+y*M+x*P+b*L,i[7]=g*_+y*A+x*O+b*I,i[11]=g*S+y*E+x*D+b*R,i[15]=g*T+y*C+x*N+b*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Bt;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*a*u-n*l*u-i*s*h+r*l*h+n*s*d-r*a*d)+e[7]*(+t*a*d-t*l*h+i*o*h-n*o*d+n*l*c-i*a*c)+e[11]*(+t*l*u-t*s*d-i*o*u+r*o*d+i*s*c-r*l*c)+e[15]*(-n*s*c-t*a*u+t*s*h+n*o*u-r*o*h+r*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],b=p*y*h-g*f*h+g*u*m-c*y*m-p*u*x+c*f*x,w=v*f*h-d*y*h-v*u*m+l*y*m+d*u*x-l*f*x,_=d*g*h-v*p*h+v*c*m-l*g*m-d*c*x+l*p*x,S=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,T=i*b+o*w+s*_+a*S;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return r[0]=b*A,r[1]=(g*f*a-p*y*a-g*s*m+o*y*m+p*s*x-o*f*x)*A,r[2]=(c*y*a-g*u*a+g*s*h-o*y*h-c*s*x+o*u*x)*A,r[3]=(p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m)*A,r[4]=w*A,r[5]=(d*y*a-v*f*a+v*s*m-i*y*m-d*s*x+i*f*x)*A,r[6]=(v*u*a-l*y*a-v*s*h+i*y*h+l*s*x-i*u*x)*A,r[7]=(l*f*a-d*u*a+d*s*h-i*f*h-l*s*m+i*u*m)*A,r[8]=_*A,r[9]=(v*p*a-d*g*a-v*o*m+i*g*m+d*o*x-i*p*x)*A,r[10]=(l*g*a-v*c*a+v*o*h-i*g*h-l*o*x+i*c*x)*A,r[11]=(d*c*a-l*p*a-d*o*h+i*p*h+l*o*m-i*c*m)*A,r[12]=S*A,r[13]=(d*g*s-v*p*s+v*o*f-i*g*f-d*o*y+i*p*y)*A,r[14]=(v*c*s-l*g*s-v*o*u+i*g*u+l*o*y-i*c*y)*A,r[15]=(l*p*s-d*c*s+d*o*u-i*p*u-l*o*f+i*c*f)*A,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,s=e.y,a=e.z,l=i*o,c=i*s;return this.set(l*o+r,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+r,c*a-n*o,0,l*a-n*s,c*a+n*o,i*a*a+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new Bt,t=new kt;return function(r,n,i){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),r.x=o[12],r.y=o[13],r.z=o[14],t.copy(this);var c=1/s,u=1/a,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,n.setFromRotationMatrix(t),i.x=s,i.y=a,i.z=l,this}}(),makePerspective:function(e,t,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*i/(t-e),l=2*i/(r-n),c=(t+e)/(t-e),u=(r+n)/(r-n),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,r,n,i,o){var s=this.elements,a=1/(t-e),l=1/(r-n),c=1/(o-i),u=(t+e)*a,h=(r+n)*l,d=(o+i)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(Ut,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,o,s){var a=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||l!==d||c!==p){var m=1-s,v=a*h+l*d+c*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,s=Math.sin(s*b)/x}var w=s*g;if(a=a*m+h*w,l=l*m+d*w,c=c*m+p*w,u=u*m+f*w,m===1-s){var _=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=_,l*=_,c*=_,u*=_}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Ut.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Ut.prototype,{set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(r/2),c=s(n/2),u=s(i/2),h=a(r/2),d=a(n/2),p=a(i/2);return"XYZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===o&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],s=r[1],a=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+a+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(s-i)*t):n>a&&n>h?(t=2*Math.sqrt(1+n-a-h),this._w=(u-l)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(o+c)/t):a>h?(t=2*Math.sqrt(1+a-n-h),this._w=(o-c)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-n-a),this._w=(s-i)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new Bt;return function(r,n){return void 0===t&&(t=new Bt),(e=r.dot(n)+1)<1e-6?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=r*c+o*s+n*l-i*a,this._y=n*c+o*a+i*s-r*l,this._z=i*c+o*l+r*a-n*s,this._w=o*c-r*s-n*a-i*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,s=o*e._w+r*e._x+n*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var l=Math.atan2(a,s),c=Math.sin((1-t)*l)/a,u=Math.sin(t*l)/a;return this._w=o*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Bt.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new Ut;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new Ut;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*n-s*r,c=a*r+s*t-i*n,u=a*n+i*r-o*t,h=-i*t-o*r-s*n;return this.x=l*a+h*-i+c*-s-u*-o,this.y=c*a+h*-o+u*-i-l*-s,this.z=u*a+h*-s+l*-o-c*-i,this},project:function(){var e=new kt;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new kt;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new Bt,t=new Bt;return function(r,n){return e.set(r,r,r),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-i*s,this.y=i*o-r*a,this.z=r*s-n*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Bt;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new Bt;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Rt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(jt.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,o,s,a,l){var c=this.elements;return c[0]=e,c[1]=n,c[2]=s,c[3]=t,c[4]=i,c[5]=a,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Bt;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],s=r[3],a=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return i[0]=o*f+s*g+a*b,i[3]=o*m+s*y+a*w,i[6]=o*v+s*x+a*_,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*w,i[7]=l*v+c*x+u*_,i[2]=h*f+d*g+p*b,i[5]=h*m+d*y+p*w,i[8]=h*v+d*x+p*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-r*i*c+r*s*a+n*i*l-n*o*a},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*a,m=h*a-l*u,v=i*p+o*f+s*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(s*h-d*o)*y,n[2]=(c*o-s*l)*y,n[3]=f*y,n[4]=(d*i-s*u)*y,n[5]=(s*a-c*i)*y,n[6]=m*y,n[7]=(o*u-h*i)*y,n[8]=(l*i-o*a)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,o,s){var a=Math.cos(i),l=Math.sin(i);this.set(r*a,r*l,-r*(a*o+l*s)+o+e,-n*l,n*a,-n*(-l*o+a*s)+s+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],o=n[3],s=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*i+r*a,n[3]=t*o+r*l,n[6]=t*s+r*c,n[1]=-r*i+t*a,n[4]=-r*o+t*l,n[7]=-r*s+t*c,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var zt=0;function Vt(e,t,r,n,i,o,s,a,l,c){Object.defineProperty(this,"id",{value:zt++}),this.uuid=Rt.generateUUID(),this.name="",this.image=void 0!==e?e:Vt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Vt.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:ve,this.wrapT=void 0!==n?n:ve,this.magFilter=void 0!==i?i:we,this.minFilter=void 0!==o?o:Se,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:Ue,this.type=void 0!==a?a:Te,this.offset=new Ft(0,0),this.repeat=new Ft(1,1),this.center=new Ft(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new jt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Mt,this.version=0,this.onUpdate=null}function Gt(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function Ht(e,t,r){this.width=e,this.height=t,this.scissor=new Gt(0,0,e,t),this.scissorTest=!1,this.viewport=new Gt(0,0,e,t),void 0===(r=r||{}).minFilter&&(r.minFilter=we),this.texture=new Vt(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function Wt(e,t,r){Ht.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0}function Xt(e,t,r,n,i,o,s,a,l,c,u,h){Vt.call(this,null,o,s,a,l,c,n,i,u,h),this.image={data:e,width:t,height:r},this.magFilter=void 0!==l?l:ye,this.minFilter=void 0!==c?c:ye,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function qt(e,t){this.min=void 0!==e?e:new Bt(1/0,1/0,1/0),this.max=void 0!==t?t:new Bt(-1/0,-1/0,-1/0)}function Yt(e,t){this.center=void 0!==e?e:new Bt,this.radius=void 0!==t?t:0}function Jt(e,t){this.normal=void 0!==e?e:new Bt(1,0,0),this.constant=void 0!==t?t:0}function Zt(e,t,r,n,i,o){this.planes=[void 0!==e?e:new Jt,void 0!==t?t:new Jt,void 0!==r?r:new Jt,void 0!==n?n:new Jt,void 0!==i?i:new Jt,void 0!==o?o:new Jt]}Vt.DEFAULT_IMAGE=void 0,Vt.DEFAULT_MAPPING=ae,Vt.prototype=Object.assign(Object.create(n.prototype),{constructor:Vt,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=Rt.generateUUID()),t||void 0!==e.images[n.uuid]||(e.images[n.uuid]={uuid:n.uuid,url:function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height;var r=t.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(n)}),r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===ae){if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case me:e.x=e.x-Math.floor(e.x);break;case ve:e.x=e.x<0?0:1;break;case ge:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case me:e.y=e.y-Math.floor(e.y);break;case ve:e.y=e.y<0?0:1;break;case ge:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(Vt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Gt.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,o=e.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(s+1)/2,v=(u+1)/2,g=(f+1)/2,y=(a+c)/4,x=(l+d)/4,b=(h+p)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=x/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(g)),n=b/i),this.set(r,n,i,t),this}var w=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-d)/w,this.z=(c-a)/w,this.w=Math.acos((s+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new Gt,t=new Gt),e.set(r,r,r,r),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Ht.prototype=Object.assign(Object.create(n.prototype),{constructor:Ht,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Wt.prototype=Object.create(Ht.prototype),Wt.prototype.constructor=Wt,Wt.prototype.isWebGLRenderTargetCube=!0,Xt.prototype=Object.create(Vt.prototype),Xt.prototype.constructor=Xt,Xt.prototype.isDataTexture=!0,Object.assign(qt.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var c=e[a],u=e[a+1],h=e[a+2];c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(t,r,n),this.max.set(i,o,s),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var c=e.getX(a),u=e.getY(a),h=e.getZ(a);c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(t,r,n),this.max.set(i,o,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Bt;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Bt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Bt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,r,n=new Bt;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(t=0,r=s.length;t<r;t++)n.copy(s[t]),n.applyMatrix4(i.matrixWorld),e.expandByPoint(n)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(t=0,r=a.count;t<r;t++)n.fromBufferAttribute(a,t).applyMatrix4(i.matrixWorld),e.expandByPoint(n)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(i),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Bt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new Bt;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},intersectsTriangle:function(){var e=new Bt,t=new Bt,r=new Bt,n=new Bt,i=new Bt,o=new Bt,s=new Bt,a=new Bt,l=new Bt,c=new Bt;function u(n){var i,o;for(i=0,o=n.length-3;i<=o;i+=3){s.fromArray(n,i);var a=l.x*Math.abs(s.x)+l.y*Math.abs(s.y)+l.z*Math.abs(s.z),c=e.dot(s),u=t.dot(s),h=r.dot(s);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>a)return!1}return!0}return function(s){if(this.isEmpty())return!1;this.getCenter(a),l.subVectors(this.max,a),e.subVectors(s.a,a),t.subVectors(s.b,a),r.subVectors(s.c,a),n.subVectors(t,e),i.subVectors(r,t),o.subVectors(e,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-o.z,o.y,n.z,0,-n.x,i.z,0,-i.x,o.z,0,-o.x,-n.y,n.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!u(h)&&(!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(n,i),u(h=[c.x,c.y,c.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Bt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Bt;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Bt;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Yt),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Yt.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new qt;return function(t,r){var n=this.center;void 0!==r?n.copy(r):e.setFromPoints(t).getCenter(n);for(var i=0,o=0,s=t.length;o<s;o++)i=Math.max(i,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Bt),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new qt),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(Jt.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Bt,t=new Bt;return function(r,n,i){var o=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Bt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Bt;return function(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Bt);var n=t.delta(e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:r.copy(n).multiplyScalar(o).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Bt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Bt,t=new jt;return function(r,n){var i=n||t.getNormalMatrix(r),o=this.coplanarPoint(e).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(s),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Zt.prototype,{set:function(e,t,r,n,i,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(s-n,u-a,f-h,y-m).normalize(),t[1].setComponents(s+n,u+a,f+h,y+m).normalize(),t[2].setComponents(s+i,u+l,f+d,y+v).normalize(),t[3].setComponents(s-i,u-l,f-d,y-v).normalize(),t[4].setComponents(s-o,u-c,f-p,y-g).normalize(),t[5].setComponents(s+o,u+c,f+p,y+g).normalize(),this},intersectsObject:function(){var e=new Yt;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Yt;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(r)<n)return!1}return!0},intersectsBox:function(){var e=new Bt,t=new Bt;return function(r){for(var n=this.planes,i=0;i<6;i++){var o=n[i];e.x=o.normal.x>0?r.min.x:r.max.x,t.x=o.normal.x>0?r.max.x:r.min.x,e.y=o.normal.y>0?r.min.y:r.max.y,t.y=o.normal.y>0?r.max.y:r.min.y,e.z=o.normal.z>0?r.min.z:r.max.z,t.z=o.normal.z>0?r.max.z:r.min.z;var s=o.distanceToPoint(e),a=o.distanceToPoint(t);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var Qt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},Kt={merge:function(e){for(var t={},r=0;r<e.length;r++){var n=this.clone(e[r]);for(var i in n)t[i]=n[i]}return t},clone:function(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}},$t={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function er(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}Object.assign(er.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(t,r,n){if(t=Rt.euclideanModulo(t,1),r=Rt.clamp(r,0,1),n=Rt.clamp(n,0,1),0===r)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+r):n+r-n*r,o=2*n-i;this.r=e(o,i,t+1/3),this.g=e(o,i,t),this.b=e(o,i,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(n[1])/360,a=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(s,a,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c,u=(c=r[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(c=$t[e])?this.setHex(c):console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,o=this.b,s=Math.max(n,i,o),a=Math.min(n,i,o),l=(a+s)/2;if(a===s)t=0,r=0;else{var c=s-a;switch(r=l<=.5?c/(s+a):c/(2-s-a),s){case n:t=(i-o)/c+(i<o?6:0);break;case i:t=(o-n)/c+2;break;case o:t=(n-i)/c+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,r,n){return this.getHSL(e),e.h+=t,e.s+=r,e.l+=n,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var tr={common:{diffuse:{value:new er(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new jt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ft(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new er(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new er(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new jt}}},rr={basic:{uniforms:Kt.merge([tr.common,tr.specularmap,tr.envmap,tr.aomap,tr.lightmap,tr.fog]),vertexShader:Qt.meshbasic_vert,fragmentShader:Qt.meshbasic_frag},lambert:{uniforms:Kt.merge([tr.common,tr.specularmap,tr.envmap,tr.aomap,tr.lightmap,tr.emissivemap,tr.fog,tr.lights,{emissive:{value:new er(0)}}]),vertexShader:Qt.meshlambert_vert,fragmentShader:Qt.meshlambert_frag},phong:{uniforms:Kt.merge([tr.common,tr.specularmap,tr.envmap,tr.aomap,tr.lightmap,tr.emissivemap,tr.bumpmap,tr.normalmap,tr.displacementmap,tr.gradientmap,tr.fog,tr.lights,{emissive:{value:new er(0)},specular:{value:new er(1118481)},shininess:{value:30}}]),vertexShader:Qt.meshphong_vert,fragmentShader:Qt.meshphong_frag},standard:{uniforms:Kt.merge([tr.common,tr.envmap,tr.aomap,tr.lightmap,tr.emissivemap,tr.bumpmap,tr.normalmap,tr.displacementmap,tr.roughnessmap,tr.metalnessmap,tr.fog,tr.lights,{emissive:{value:new er(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag},points:{uniforms:Kt.merge([tr.points,tr.fog]),vertexShader:Qt.points_vert,fragmentShader:Qt.points_frag},dashed:{uniforms:Kt.merge([tr.common,tr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qt.linedashed_vert,fragmentShader:Qt.linedashed_frag},depth:{uniforms:Kt.merge([tr.common,tr.displacementmap]),vertexShader:Qt.depth_vert,fragmentShader:Qt.depth_frag},normal:{uniforms:Kt.merge([tr.common,tr.bumpmap,tr.normalmap,tr.displacementmap,{opacity:{value:1}}]),vertexShader:Qt.normal_vert,fragmentShader:Qt.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Qt.cube_vert,fragmentShader:Qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qt.equirect_vert,fragmentShader:Qt.equirect_frag},distanceRGBA:{uniforms:Kt.merge([tr.common,tr.displacementmap,{referencePosition:{value:new Bt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qt.distanceRGBA_vert,fragmentShader:Qt.distanceRGBA_frag},shadow:{uniforms:Kt.merge([tr.lights,tr.fog,{color:{value:new er(0)},opacity:{value:1}}]),vertexShader:Qt.shadow_vert,fragmentShader:Qt.shadow_frag}};function nr(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=t.get(r);n&&(e.deleteBuffer(n.buffer),t.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);void 0===i?t.set(r,function(t,r){var n=t.array,i=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,n,i),t.onUploadCallback();var s=e.FLOAT;return n instanceof Float32Array?s=e.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?s=e.UNSIGNED_SHORT:n instanceof Int16Array?s=e.SHORT:n instanceof Uint32Array?s=e.UNSIGNED_INT:n instanceof Int32Array?s=e.INT:n instanceof Int8Array?s=e.BYTE:n instanceof Uint8Array&&(s=e.UNSIGNED_BYTE),{buffer:o,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(r,n)):i.version<r.version&&(function(t,r,n){var i=r.array,o=r.updateRange;e.bindBuffer(n,t),!1===r.dynamic?e.bufferData(n,i,e.STATIC_DRAW):-1===o.count?e.bufferSubData(n,0,i):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(i.buffer,r,n),i.version=r.version)}}}function ir(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||ir.DefaultOrder}function or(){this.mask=1}rr.physical={uniforms:Kt.merge([rr.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag},ir.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ir.DefaultOrder="XYZ",Object.defineProperties(ir.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(ir.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=Rt.clamp,i=e.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new kt;return function(t,r,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new Ut;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Bt(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(or.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var sr=0;function ar(){Object.defineProperty(this,"id",{value:sr++}),this.uuid=Rt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ar.DefaultUp.clone();var e=new Bt,t=new ir,r=new Ut,n=new Bt(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new kt},normalMatrix:{value:new jt}}),this.matrix=new kt,this.matrixWorld=new kt,this.matrixAutoUpdate=ar.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new or,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function lr(){ar.call(this),this.type="Camera",this.matrixWorldInverse=new kt,this.projectionMatrix=new kt}function cr(e,t,r,n,i,o){lr.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function ur(e,t,r,n,i,o){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new Bt,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new er,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}ar.DefaultUp=new Bt(0,1,0),ar.DefaultMatrixAutoUpdate=!0,ar.prototype=Object.assign(Object.create(n.prototype),{constructor:ar,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new Ut;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new Ut;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Bt(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Bt(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Bt(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Bt;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new Bt(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Bt(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Bt(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new kt;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new kt,t=new Bt;return function(r,n,i){r.isVector3?t.copy(r):t.set(r,n,i),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Bt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new Bt,t=new Bt;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),r=new Ut),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldScale:function(){var e=new Bt,t=new Ut;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Bt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new Ut;return function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Bt),this.getWorldQuaternion(e),t.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var s=o.shapes;if(Array.isArray(s))for(var a=0,l=s.length;a<l;a++){var c=s[a];i(e.shapes,c)}else i(e.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(a=0,l=this.material.length;a<l;a++)u.push(i(e.materials,this.material[a]));n.material=u}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(t){var h=m(e.geometries),d=m(e.materials),p=m(e.textures),f=m(e.images);s=m(e.shapes);h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),p.length>0&&(r.textures=p),f.length>0&&(r.images=f),s.length>0&&(r.shapes=s)}return r.object=n,r;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}}),lr.prototype=Object.assign(Object.create(ar.prototype),{constructor:lr,isCamera:!0,copy:function(e,t){return ar.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new Ut;return function(t){return void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Bt),this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){ar.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),cr.prototype=Object.assign(Object.create(lr.prototype),{constructor:cr,isOrthographicCamera:!0,copy:function(e,t){return lr.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,o=r+e,s=n+t,a=n-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=u*(this.view.offsetX/l))+u*(this.view.width/l),a=(s-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far)},toJSON:function(e){var t=ar.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Object.assign(ur.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var hr=0;function dr(){Object.defineProperty(this,"id",{value:hr+=2}),this.uuid=Rt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function pr(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function fr(e,t,r){pr.call(this,new Int8Array(e),t,r)}function mr(e,t,r){pr.call(this,new Uint8Array(e),t,r)}function vr(e,t,r){pr.call(this,new Uint8ClampedArray(e),t,r)}function gr(e,t,r){pr.call(this,new Int16Array(e),t,r)}function yr(e,t,r){pr.call(this,new Uint16Array(e),t,r)}function xr(e,t,r){pr.call(this,new Int32Array(e),t,r)}function br(e,t,r){pr.call(this,new Uint32Array(e),t,r)}function wr(e,t,r){pr.call(this,new Float32Array(e),t,r)}function _r(e,t,r){pr.call(this,new Float64Array(e),t,r)}function Sr(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Tr(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}dr.prototype=Object.assign(Object.create(n.prototype),{constructor:dr,isGeometry:!0,applyMatrix:function(e){for(var t=(new jt).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){this.vertices[r].applyMatrix4(e)}for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(t).normalize();for(var o=0,s=i.vertexNormals.length;o<s;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new kt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new kt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new kt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new kt;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new kt;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new ar;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,a=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)t.vertices.push(new Bt(i[d],i[d+1],i[d+2])),void 0!==o&&c.push(new Bt(o[d],o[d+1],o[d+2])),void 0!==s&&t.colors.push(new er(s[d],s[d+1],s[d+2])),void 0!==a&&u.push(new Ft(a[p],a[p+1])),void 0!==l&&h.push(new Ft(l[p],l[p+1]));function f(e,r,n,i){var d=new ur(e,r,n,void 0!==o?[c[e].clone(),c[r].clone(),c[n].clone()]:[],void 0!==s?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[],i);t.faces.push(d),void 0!==a&&t.faceVertexUvs[0].push([u[e].clone(),u[r].clone(),u[n].clone()]),void 0!==l&&t.faceVertexUvs[1].push([h[e].clone(),h[r].clone(),h[n].clone()])}var m=e.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==r?f(r[p],r[p+1],r[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==r)for(d=0;d<r.length;d+=3)f(r[d],r[d+1],r[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new Bt;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new kt;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new Bt,t=new Bt,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,o,s;for(void 0===e&&(e=!0),s=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)s[t]=new Bt;if(e){var a,l,c,u=new Bt,h=new Bt;for(n=0,i=this.faces.length;n<i;n++)o=this.faces[n],a=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(a,l),u.cross(h),s[o.a].add(u),s[o.b].add(u),s[o.c].add(u)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)s[(o=this.faces[n]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)s[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var d=(o=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(s[o.a]),d[1].copy(s[o.b]),d[2].copy(s[o.c])):(d[0]=s[o.a].clone(),d[1]=s[o.b].clone(),d[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new dr;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Bt,c={a:new Bt,b:new Bt,c:new Bt},s.push(l),a.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Yt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new jt).getNormalMatrix(t));for(var p=0,f=s.length;p<f;p++){var m=s[p].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,g,y,x=l[p],b=x.vertexNormals,w=x.vertexColors;(v=new ur(x.a+i,x.b+i,x.c+i)).normal.copy(x.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var _=0,S=b.length;_<S;_++)g=b[_].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);v.color.copy(x.color);for(_=0,S=w.length;_<S;_++)y=w[_],v.vertexColors.push(y.clone());v.materialIndex=x.materialIndex+r,a.push(v)}for(p=0,f=u.length;p<f;p++){var T=u[p],M=[];if(void 0!==T){for(_=0,S=T.length;_<S;_++)M.push(T[_].clone());c.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,o,s,a,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new Bt(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===t&&(n=[]),s&&s.length===t&&(i=[]);for(r=0;r<t;r++){var a=e[r]._id;n&&n.push(o[a]),i&&i.push(s[a])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var s=[],a=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),s.push(x),s.push(p.a,p.b,p.c),s.push(p.materialIndex),f){var b=this.faceVertexUvs[0][i];s.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&s.push(T(p.normal)),v){var w=p.vertexNormals;s.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&s.push(M(p.color)),y){var _=p.vertexColors;s.push(M(_[0]),M(_[1]),M(_[2]))}}function S(e,t,r){return r?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=a.length/3,a.push(e.x,e.y,e.z),l[t])}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function A(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=n,e.data.normals=a,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=s,e},clone:function(){return(new dr).copy(this)},copy:function(e){var t,r,n,i,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var a=e.vertices;for(t=0,r=a.length;t<r;t++)this.vertices.push(a[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,r=c.length;t<r;t++)this.faces.push(c[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(o=0,s=h.length;o<s;o++){var p=h[o];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}var f=e.morphTargets;for(t=0,r=f.length;t<r;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],n=0,i=f[t].vertices.length;n<i;n++)m.vertices.push(f[t].vertices[n].clone());if(void 0!==f[t].normals)for(m.normals=[],n=0,i=f[t].normals.length;n<i;n++)m.normals.push(f[t].normals[n].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,r=v.length;t<r;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],n=0,i=v[t].vertexNormals.length;n<i;n++){var y=v[t].vertexNormals[n],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),g.vertexNormals.push(x)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],n=0,i=v[t].faceNormals.length;n<i;n++)g.faceNormals.push(v[t].faceNormals[n].clone());this.morphNormals.push(g)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var w=e.skinIndices;for(t=0,r=w.length;t<r;t++)this.skinIndices.push(w[t].clone());var _=e.lineDistances;for(t=0,r=_.length;t<r;t++)this.lineDistances.push(_[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(pr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(pr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new er),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Ft),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new Bt),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Gt),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),fr.prototype=Object.create(pr.prototype),fr.prototype.constructor=fr,mr.prototype=Object.create(pr.prototype),mr.prototype.constructor=mr,vr.prototype=Object.create(pr.prototype),vr.prototype.constructor=vr,gr.prototype=Object.create(pr.prototype),gr.prototype.constructor=gr,yr.prototype=Object.create(pr.prototype),yr.prototype.constructor=yr,xr.prototype=Object.create(pr.prototype),xr.prototype.constructor=xr,br.prototype=Object.create(pr.prototype),br.prototype.constructor=br,wr.prototype=Object.create(pr.prototype),wr.prototype.constructor=wr,_r.prototype=Object.create(pr.prototype),_r.prototype.constructor=_r,Object.assign(Sr.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,o=0;o<i.length;o++){var s=i[o];s.materialIndex!==n&&(n=s.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:n})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=e.morphTargets,l=a.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]=[];this.morphTargets.position=t}var u,h=e.morphNormals,d=h.length;if(d>0){u=[];for(c=0;c<d;c++)u[c]=[];this.morphTargets.normal=u}var p=e.skinIndices,f=e.skinWeights,m=p.length===n.length,v=f.length===n.length;for(c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}if(!0===o)void 0!==(b=i[0][c])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Ft,new Ft,new Ft));if(!0===s)void 0!==(b=i[1][c])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Ft,new Ft,new Ft));for(var S=0;S<l;S++){var T=a[S].vertices;t[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[c];u[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Mr=1;function Ar(){Object.defineProperty(this,"id",{value:Mr+=2}),this.uuid=Rt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Er(e,t,r,n,i,o){dr.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Cr(e,t,r,n,i,o)),this.mergeVertices()}function Cr(e,t,r,n,i,o){Ar.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var s=this;e=e||1,t=t||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var a=[],l=[],c=[],u=[],h=0,d=0;function p(e,t,r,n,i,o,p,f,m,v,g){var y,x,b=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new Bt;for(x=0;x<A;x++){var O=x*w-S;for(y=0;y<M;y++){var D=y*b-_;P[e]=D*n,P[t]=O*i,P[r]=T,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[r]=f>0?1:-1,c.push(P.x,P.y,P.z),u.push(y/m),u.push(1-x/v),E+=1}}for(x=0;x<v;x++)for(y=0;y<m;y++){var N=h+y+M*x,L=h+y+M*(x+1),I=h+(y+1)+M*(x+1),R=h+(y+1)+M*x;a.push(N,L,R),a.push(L,I,R),C+=6}s.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,r,t,e,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,r,t,-e,o,i,1),p("x","z","y",1,1,e,r,t,n,o,2),p("x","z","y",1,-1,e,r,-t,n,o,3),p("x","y","z",1,-1,e,t,r,n,i,4),p("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(a),this.addAttribute("position",new wr(l,3)),this.addAttribute("normal",new wr(c,3)),this.addAttribute("uv",new wr(u,2))}function Pr(e,t,r,n){dr.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Or(e,t,r,n)),this.mergeVertices()}function Or(e,t,r,n){Ar.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,o,s=(e=e||1)/2,a=(t=t||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=e/l,p=t/c,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-a;for(i=0;i<u;i++){var x=i*d-s;m.push(x,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/c)}}for(o=0;o<c;o++)for(i=0;i<l;i++){var b=i+u*o,w=i+u*(o+1),_=i+1+u*(o+1),S=i+1+u*o;f.push(b,w,S),f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new wr(m,3)),this.addAttribute("normal",new wr(v,3)),this.addAttribute("uv",new wr(g,2))}Ar.prototype=Object.assign(Object.create(n.prototype),{constructor:Ar,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Tr(e)>65535?br:yr)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new pr(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new jt).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new kt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new kt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new kt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new kt;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new kt;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new ar;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Bt;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new wr(3*t.vertices.length,3),n=new wr(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new wr(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new wr(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Sr).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new pr(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new pr(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new pr(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new pr(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new pr(o,2).copyVector2sArray(e.uvs2))}for(var s in this.groups=e.groups,e.morphTargets){for(var a=[],l=e.morphTargets[s],c=0,u=l.length;c<u;c++){var h=l[c],d=new wr(3*h.length,3);a.push(d.copyVector3sArray(h))}this.morphAttributes[s]=a}if(e.skinIndices.length>0){var p=new wr(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new wr(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qt);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new qt,t=new Bt;return function(){null===this.boundingSphere&&(this.boundingSphere=new Yt);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;e.setFromBufferAttribute(r),e.getCenter(n);for(var i=0,o=0,s=r.count;o<s;o++)t.x=r.getX(o),t.y=r.getY(o),t.z=r.getZ(o),i=Math.max(i,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new pr(new Float32Array(n.length),3));else for(var i=t.normal.array,o=0,s=i.length;o<s;o++)i[o]=0;var a,l,c,u=t.normal.array,h=new Bt,d=new Bt,p=new Bt,f=new Bt,m=new Bt;if(e){var v=e.array;0===r.length&&this.addGroup(0,v.length);for(var g=0,y=r.length;g<y;++g){var x=r[g],b=x.start;for(o=b,s=b+x.count;o<s;o+=3)a=3*v[o+0],l=3*v[o+1],c=3*v[o+2],h.fromArray(n,a),d.fromArray(n,l),p.fromArray(n,c),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[a]+=f.x,u[a+1]+=f.y,u[a+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z}}else for(o=0,s=n.length;o<s;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n].array,o=e.attributes[n],s=o.array,a=0,l=o.itemSize*t;a<s.length;a++,l++)i[l]=s[a];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new Bt;return function(){for(var t=this.attributes.normal,r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Ar,t=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],o=i.array,s=i.itemSize,a=new o.constructor(t.length*s),l=0,c=0,u=0,h=t.length;u<h;u++){l=t[u]*s;for(var d=0;d<s;d++)a[c++]=o[l++]}e.addAttribute(n,new pr(a,s))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];e.addGroup(f.start,f.count,f.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var s=o[r];i=Array.prototype.slice.call(s.array);e.data.attributes[r]={itemSize:s.itemSize,type:s.array.constructor.name,array:i,normalized:s.normalized}}var a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new Ar).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var s=o[t];this.addAttribute(t,s.clone())}var a=e.morphAttributes;for(t in a){var l=[],c=a[t];for(r=0,n=c.length;r<n;r++)l.push(c[r].clone());this.morphAttributes[t]=l}var u=e.groups;for(r=0,n=u.length;r<n;r++){var h=u[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Er.prototype=Object.create(dr.prototype),Er.prototype.constructor=Er,Cr.prototype=Object.create(Ar.prototype),Cr.prototype.constructor=Cr,Pr.prototype=Object.create(dr.prototype),Pr.prototype.constructor=Pr,Or.prototype=Object.create(Ar.prototype),Or.prototype.constructor=Or;var Dr=0;function Nr(){Object.defineProperty(this,"id",{value:Dr++}),this.uuid=Rt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=T,this.side=m,this.flatShading=!1,this.vertexColors=b,this.opacity=1,this.transparent=!1,this.blendSrc=U,this.blendDst=B,this.blendEquation=P,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Y,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Lr(e){Nr.call(this),this.type="MeshBasicMaterial",this.color=new er(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Ir(e){Nr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Rr(e,t){this.origin=void 0!==e?e:new Bt,this.direction=void 0!==t?t:new Bt}function Fr(e,t){this.start=void 0!==e?e:new Bt,this.end=void 0!==t?t:new Bt}function kr(e,t,r){this.a=void 0!==e?e:new Bt,this.b=void 0!==t?t:new Bt,this.c=void 0!==r?r:new Bt}function Ur(e,t){ar.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ar,this.material=void 0!==t?t:new Lr({color:16777215*Math.random()}),this.drawMode=_t,this.updateMorphTargets()}function Br(e,t){return Math.abs(t[1])-Math.abs(e[1])}function jr(e,t,r,n,i,o,s,a,l,c){e=void 0!==e?e:[],t=void 0!==t?t:le,Vt.call(this,e,t,r,n,i,o,s,a,l,c),this.flipY=!1}Nr.prototype=Object.assign(Object.create(n.prototype),{constructor:Nr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]="overdraw"===t?Number(r):r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===y;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==T&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==m&&(r.side=this.side),this.vertexColors!==b&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),o=n(e.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Lr.prototype=Object.create(Nr.prototype),Lr.prototype.constructor=Lr,Lr.prototype.isMeshBasicMaterial=!0,Lr.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Ir.prototype=Object.create(Nr.prototype),Ir.prototype.constructor=Ir,Ir.prototype.isShaderMaterial=!0,Ir.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Kt.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Ir.prototype.toJSON=function(e){var t=Nr.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Rr.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Bt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Bt;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Bt),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Bt;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new Bt,t=new Bt,r=new Bt;return function(n,i,o,s){e.copy(n).add(i).multiplyScalar(.5),t.copy(i).sub(n).normalize(),r.copy(this.origin).sub(e);var a,l,c,u,h=.5*n.distanceTo(i),d=-this.direction.dot(t),p=r.dot(this.direction),f=-r.dot(t),m=r.lengthSq(),v=Math.abs(1-d*d);if(v>0)if(l=d*p-f,u=h*v,(a=d*f-p)>=0)if(l>=-u)if(l<=u){var g=1/v;c=(a*=g)*(a+d*(l*=g)+2*p)+l*(d*a+l+2*f)+m}else l=h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l=-h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l<=-u?c=-(a=Math.max(0,-(-d*h+p)))*a+(l=a>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(a=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(a=Math.max(0,-(d*h+p)))*a+(l=a>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=d>0?-h:h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new Bt;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,o=t.radius*t.radius;if(i>o)return null;var s=Math.sqrt(o-i),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,r):this.at(a,r)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,n,i,o,s,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),r>a||s>n?null:((s>r||r!=r)&&(r=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:function(){var e=new Bt;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new Bt,t=new Bt,r=new Bt,n=new Bt;return function(i,o,s,a,l){t.subVectors(o,i),r.subVectors(s,i),n.crossVectors(t,r);var c,u=this.direction.dot(n);if(u>0){if(a)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,i);var h=c*this.direction.dot(r.crossVectors(e,r));if(h<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>u)return null;var p=-c*e.dot(n);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Fr.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Bt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Bt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Bt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new Bt,t=new Bt;return function(r,n){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),o=t.dot(e)/i;return n&&(o=Rt.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Bt),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(kr,{getNormal:function(){var e=new Bt;return function(t,r,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Bt),i.subVectors(n,r),e.subVectors(t,r),i.cross(e);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}}(),getBarycoord:function(){var e=new Bt,t=new Bt,r=new Bt;return function(n,i,o,s,a){e.subVectors(s,i),t.subVectors(o,i),r.subVectors(n,i);var l=e.dot(e),c=e.dot(t),u=e.dot(r),h=t.dot(t),d=t.dot(r),p=l*h-c*c;if(void 0===a&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),a=new Bt),0===p)return a.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,v=(l*d-c*u)*f;return a.set(1-m-v,v,m)}}(),containsPoint:function(){var e=new Bt;return function(t,r,n,i){return kr.getBarycoord(t,r,n,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}()}),Object.assign(kr.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Bt,t=new Bt;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Bt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return kr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Bt),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return kr.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return kr.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new Jt,t=[new Fr,new Fr,new Fr],r=new Bt,n=new Bt;return function(i,o){void 0===o&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new Bt);var s=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(i,r),!0===this.containsPoint(r))o.copy(r);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var a=0;a<t.length;a++){t[a].closestPointToPoint(r,!0,n);var l=r.distanceToSquared(n);l<s&&(s=l,o.copy(n))}}return o}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Ur.prototype=Object.assign(Object.create(ar.prototype),{constructor:Ur,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return ar.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var s=i[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)r=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var a=n.morphTargets;if(void 0!==a&&a.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},raycast:function(){var e=new kt,t=new Rr,r=new Yt,n=new Bt,i=new Bt,o=new Bt,s=new Bt,a=new Bt,l=new Bt,c=new Ft,u=new Ft,h=new Ft,d=new Bt,p=new Bt,f=new Bt;function m(e,t,r,n,i,o,s){return kr.getBarycoord(e,t,r,n,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),s.multiplyScalar(d.z),i.add(o).add(s),i.clone()}function y(e,t,r,n,i,o,s,a){if(null===(t.side===v?n.intersectTriangle(s,o,i,!0,a):n.intersectTriangle(i,o,s,t.side!==g,a)))return null;f.copy(a),f.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(f);return l<r.near||l>r.far?null:{distance:l,point:f.clone(),object:e}}function x(e,t,r,s,a,l,d,f){n.fromBufferAttribute(s,l),i.fromBufferAttribute(s,d),o.fromBufferAttribute(s,f);var v=y(e,e.material,t,r,n,i,o,p);if(v){a&&(c.fromBufferAttribute(a,l),u.fromBufferAttribute(a,d),h.fromBufferAttribute(a,f),v.uv=m(p,n,i,o,c,u,h));var g=new ur(l,d,f);kr.getNormal(n,i,o,g.normal),v.face=g,v.faceIndex=l}return v}return function(d,f){var v,g=this.geometry,b=this.material,w=this.matrixWorld;if(void 0!==b&&(null===g.boundingSphere&&g.computeBoundingSphere(),r.copy(g.boundingSphere),r.applyMatrix4(w),!1!==d.ray.intersectsSphere(r)&&(e.getInverse(w),t.copy(d.ray).applyMatrix4(e),null===g.boundingBox||!1!==t.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var _,S,T,M,A,E=g.index,C=g.attributes.position,P=g.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(v=x(this,d,t,C,P,_,S,T))&&(v.faceIndex=Math.floor(M/3),f.push(v));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(v=x(this,d,t,C,P,_=M,S=M+1,T=M+2))&&(v.index=_,f.push(v))}else if(g.isGeometry){var O,D,N,L,I=Array.isArray(b),R=g.vertices,F=g.faces,k=g.faceVertexUvs[0];k.length>0&&(L=k);for(var U=0,B=F.length;U<B;U++){var j=F[U],z=I?b[j.materialIndex]:b;if(void 0!==z){if(O=R[j.a],D=R[j.b],N=R[j.c],!0===z.morphTargets){var V=g.morphTargets,G=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var q=V[H].vertices;n.addScaledVector(s.subVectors(q[j.a],O),X),i.addScaledVector(a.subVectors(q[j.b],D),X),o.addScaledVector(l.subVectors(q[j.c],N),X)}}n.add(O),i.add(D),o.add(N),O=n,D=i,N=o}if(v=y(this,z,d,t,O,D,N,p)){if(L&&L[U]){var Y=L[U];c.copy(Y[0]),u.copy(Y[1]),h.copy(Y[2]),v.uv=m(p,O,D,N,c,u,h)}v.face=j,v.faceIndex=U,f.push(v)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),jr.prototype=Object.create(Vt.prototype),jr.prototype.constructor=jr,jr.prototype.isCubeTexture=!0,Object.defineProperty(jr.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var zr=new Vt,Vr=new jr;function Gr(){this.seq=[],this.map={}}var Hr=[],Wr=[],Xr=new Float32Array(16),qr=new Float32Array(9);function Yr(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,o=Hr[i];if(void 0===o&&(o=new Float32Array(i),Hr[i]=o),0!==t){n.toArray(o,0);for(var s=1,a=0;s!==t;++s)a+=r,e[s].toArray(o,a)}return o}function Jr(e,t){var r=Wr[t];void 0===r&&(r=new Int32Array(t),Wr[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocTextureUnit();return r}function Zr(e,t){e.uniform1f(this.addr,t)}function Qr(e,t){e.uniform1i(this.addr,t)}function Kr(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function $r(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function en(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function tn(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function rn(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(qr.set(t.elements),e.uniformMatrix3fv(this.addr,!1,qr))}function nn(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(Xr.set(t.elements),e.uniformMatrix4fv(this.addr,!1,Xr))}function on(e,t,r){var n=r.allocTextureUnit();e.uniform1i(this.addr,n),r.setTexture2D(t||zr,n)}function sn(e,t,r){var n=r.allocTextureUnit();e.uniform1i(this.addr,n),r.setTextureCube(t||Vr,n)}function an(e,t){e.uniform2iv(this.addr,t)}function ln(e,t){e.uniform3iv(this.addr,t)}function cn(e,t){e.uniform4iv(this.addr,t)}function un(e,t){e.uniform1fv(this.addr,t)}function hn(e,t){e.uniform1iv(this.addr,t)}function dn(e,t){e.uniform2fv(this.addr,Yr(t,this.size,2))}function pn(e,t){e.uniform3fv(this.addr,Yr(t,this.size,3))}function fn(e,t){e.uniform4fv(this.addr,Yr(t,this.size,4))}function mn(e,t){e.uniformMatrix2fv(this.addr,!1,Yr(t,this.size,4))}function vn(e,t){e.uniformMatrix3fv(this.addr,!1,Yr(t,this.size,9))}function gn(e,t){e.uniformMatrix4fv(this.addr,!1,Yr(t,this.size,16))}function yn(e,t,r){var n=t.length,i=Jr(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTexture2D(t[o]||zr,i[o])}function xn(e,t,r){var n=t.length,i=Jr(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTextureCube(t[o]||Vr,i[o])}function bn(e,t,r){this.id=e,this.addr=r,this.setValue=function(e){switch(e){case 5126:return Zr;case 35664:return Kr;case 35665:return $r;case 35666:return en;case 35674:return tn;case 35675:return rn;case 35676:return nn;case 35678:case 36198:return on;case 35680:return sn;case 5124:case 35670:return Qr;case 35667:case 35671:return an;case 35668:case 35672:return ln;case 35669:case 35673:return cn}}(t.type)}function wn(e,t,r){this.id=e,this.addr=r,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return un;case 35664:return dn;case 35665:return pn;case 35666:return fn;case 35674:return mn;case 35675:return vn;case 35676:return gn;case 35678:return yn;case 35680:return xn;case 5124:case 35670:return hn;case 35667:case 35671:return an;case 35668:case 35672:return ln;case 35669:case 35673:return cn}}(t.type)}function _n(e){this.id=e,Gr.call(this)}_n.prototype.setValue=function(e,t){for(var r=this.seq,n=0,i=r.length;n!==i;++n){var o=r[n];o.setValue(e,t[o.id])}};var Sn=/([\w\d_]+)(\])?(\[|\.)?/g;function Tn(e,t){e.seq.push(t),e.map[t.id]=t}function Mn(e,t,r){var n=e.name,i=n.length;for(Sn.lastIndex=0;;){var o=Sn.exec(n),s=Sn.lastIndex,a=o[1],l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===i){Tn(r,void 0===c?new bn(a,e,t):new wn(a,e,t));break}var u=r.map[a];void 0===u&&Tn(r,u=new _n(a)),r=u}}function An(e,t,r){Gr.call(this),this.renderer=r;for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;++i){var o=e.getActiveUniform(t,i),s=o.name;Mn(o,e.getUniformLocation(t,s),this)}}function En(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(n),function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(r)),n}An.prototype.setValue=function(e,t,r){var n=this.map[t];void 0!==n&&n.setValue(e,r,this.renderer)},An.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},An.upload=function(e,t,r,n){for(var i=0,o=t.length;i!==o;++i){var s=t[i],a=r[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}},An.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var o=e[n];o.id in t&&r.push(o)}return r};var Cn=0;function Pn(e){switch(e){case Mt:return["Linear","( value )"];case At:return["sRGB","( value )"];case Ct:return["RGBE","( value )"];case Ot:return["RGBM","( value, 7.0 )"];case Dt:return["RGBM","( value, 16.0 )"];case Nt:return["RGBD","( value, 256.0 )"];case Et:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function On(e,t){var r=Pn(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Dn(e){return""!==e}function Nn(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Ln(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function In(e){return e.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(e,t){var r=Qt[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return In(r)})}function Rn(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,n){for(var i="",o=parseInt(t);o<parseInt(r);o++)i+=n.replace(/\[ i \]/g,"[ "+o+" ]");return i})}function Fn(e,t,r,n,i,o){var s=e.context,a=n.defines,l=i.vertexShader,c=i.fragmentShader,u="SHADOWMAP_TYPE_BASIC";o.shadowMapType===p?u="SHADOWMAP_TYPE_PCF":o.shadowMapType===f&&(u="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case le:case ce:h="ENVMAP_TYPE_CUBE";break;case pe:case fe:h="ENVMAP_TYPE_CUBE_UV";break;case ue:case he:h="ENVMAP_TYPE_EQUIREC";break;case de:h="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case ce:case he:d="ENVMAP_MODE_REFRACTION"}switch(n.combine){case $:m="ENVMAP_BLENDING_MULTIPLY";break;case ee:m="ENVMAP_BLENDING_MIX";break;case te:m="ENVMAP_BLENDING_ADD"}}var v,g,y=e.gammaFactor>0?e.gammaFactor:1,x=function(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Dn).join("\n")}(n.extensions,o,t),b=function(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(a),w=s.createProgram();n.isRawShaderMaterial?((v=[b].filter(Dn).join("\n")).length>0&&(v+="\n"),(g=[x,b].filter(Dn).join("\n")).length>0&&(g+="\n")):(v=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+u:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Dn).join("\n"),g=[x,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+y,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+h:"",o.envMap?"#define "+d:"",o.envMap?"#define "+m:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+u:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==re?"#define TONE_MAPPING":"",o.toneMapping!==re?Qt.tonemapping_pars_fragment:"",o.toneMapping!==re?function(e,t){var r;switch(t){case ne:r="Linear";break;case ie:r="Reinhard";break;case oe:r="Uncharted2";break;case se:r="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?Qt.encodings_pars_fragment:"",o.mapEncoding?On("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?On("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?On("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function(e,t){var r=Pn(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Dn).join("\n")),l=Ln(l=Nn(l=In(l),o),o),c=Ln(c=Nn(c=In(c),o),o);var _=v+(l=Rn(l)),S=g+(c=Rn(c)),T=En(s,s.VERTEX_SHADER,_),M=En(s,s.FRAGMENT_SHADER,S);s.attachShader(w,T),s.attachShader(w,M),void 0!==n.index0AttributeName?s.bindAttribLocation(w,0,n.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(w,0,"position"),s.linkProgram(w);var A,E,C=s.getProgramInfoLog(w).trim(),P=s.getShaderInfoLog(T).trim(),O=s.getShaderInfoLog(M).trim(),D=!0,N=!0;return!1===s.getProgramParameter(w,s.LINK_STATUS)?(D=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(w,s.VALIDATE_STATUS),"gl.getProgramInfoLog",C,P,O)):""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==P&&""!==O||(N=!1),N&&(this.diagnostics={runnable:D,material:n,programLog:C,vertexShader:{log:P,prefix:v},fragmentShader:{log:O,prefix:g}}),s.deleteShader(T),s.deleteShader(M),this.getUniforms=function(){return void 0===A&&(A=new An(s,w,e)),A},this.getAttributes=function(){return void 0===E&&(E=function(e,t){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var o=e.getActiveAttrib(t,i).name;r[o]=e.getAttribLocation(t,o)}return r}(s,w)),E},this.destroy=function(){s.deleteProgram(w),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=Cn++,this.code=r,this.usedTimes=1,this.program=w,this.vertexShader=T,this.fragmentShader=M,this}function kn(e,t,r){var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=Mt,r===Mt&&t&&(r=Et),r}this.getParameters=function(t,n,o,a,l,c,u){var h=i[t.type],d=u.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(r.floatVertexTextures)return 1024;var n=r.maxVertexUniforms,i=Math.floor((n-20)/4),o=Math.min(i,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(u):0,p=r.precision;null!==t.precision&&(p=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",p,"instead.");var f=e.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:r.vertexTextures,outputEncoding:s(f?f.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:s(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:s(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===pe||t.envMap.mapping===fe),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:s(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!a,useFog:t.fog,fogExp:a&&a.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&d>0,maxBones:d,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&o.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===g,flipSided:t.side===v,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(var s=0;s<o.length;s++)n.push(r[o[s]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.join()},this.acquireProgram=function(r,i,o,s){for(var a,l=0,c=n.length;l<c;l++){var u=n[l];if(u.code===s){++(a=u).usedTimes;break}}return void 0===a&&(a=new Fn(e,t,s,r,i,o),n.push(a)),a},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function Un(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Bn(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function jn(){var e={};return{get:function(t,r){var n=t.id+","+r.id,i=e[n];return void 0===i&&(i=new function(){var e=[],t=0,r=[],n=[];return{opaque:r,transparent:n,init:function(){t=0,r.length=0,n.length=0},push:function(i,o,s,a,l){var c=e[t];void 0===c?(c={id:i.id,object:i,geometry:o,material:s,program:s.program,renderOrder:i.renderOrder,z:a,group:l},e[t]=c):(c.id=i.id,c.object=i,c.geometry=o,c.material=s,c.program=s.program,c.renderOrder=i.renderOrder,c.z=a,c.group=l),(!0===s.transparent?n:r).push(c),t++},sort:function(){r.length>1&&r.sort(Un),n.length>1&&n.sort(Bn)}}},e[n]=i),i},dispose:function(){e={}}}}var zn=0;function Vn(){var e=new function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new Bt,color:new er,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ft};break;case"SpotLight":r={position:new Bt,direction:new Bt,color:new er,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ft};break;case"PointLight":r={position:new Bt,color:new er,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ft,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Bt,skyColor:new er,groundColor:new er};break;case"RectAreaLight":r={color:new er,position:new Bt,halfWidth:new Bt,halfHeight:new Bt}}return e[t.id]=r,r}}},t={id:zn++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new Bt,n=new kt,i=new kt;return{setup:function(o,s,a){for(var l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,v=a.matrixWorldInverse,g=0,y=o.length;g<y;g++){var x=o[g],b=x.color,w=x.intensity,_=x.distance,S=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)l+=b.r*w,c+=b.g*w,u+=b.b*w;else if(x.isDirectionalLight){if((M=e.get(x)).color.copy(x.color).multiplyScalar(x.intensity),M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(v),M.shadow=x.castShadow,x.castShadow){var T=x.shadow;M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize}t.directionalShadowMap[h]=S,t.directionalShadowMatrix[h]=x.shadow.matrix,t.directional[h]=M,h++}else if(x.isSpotLight)(M=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),M.color.copy(b).multiplyScalar(w),M.distance=_,M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(v),M.coneCos=Math.cos(x.angle),M.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),M.decay=0===x.distance?0:x.decay,M.shadow=x.castShadow,x.castShadow&&(T=x.shadow,M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),t.spotShadowMap[p]=S,t.spotShadowMatrix[p]=x.shadow.matrix,t.spot[p]=M,p++;else if(x.isRectAreaLight)(M=e.get(x)).color.copy(b).multiplyScalar(w),M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),i.identity(),n.copy(x.matrixWorld),n.premultiply(v),i.extractRotation(n),M.halfWidth.set(.5*x.width,0,0),M.halfHeight.set(0,.5*x.height,0),M.halfWidth.applyMatrix4(i),M.halfHeight.applyMatrix4(i),t.rectArea[f]=M,f++;else if(x.isPointLight)(M=e.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),M.color.copy(x.color).multiplyScalar(x.intensity),M.distance=x.distance,M.decay=0===x.distance?0:x.decay,M.shadow=x.castShadow,x.castShadow&&(T=x.shadow,M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize,M.shadowCameraNear=T.camera.near,M.shadowCameraFar=T.camera.far),t.pointShadowMap[d]=S,t.pointShadowMatrix[d]=x.shadow.matrix,t.point[d]=M,d++;else if(x.isHemisphereLight){var M;(M=e.get(x)).direction.setFromMatrixPosition(x.matrixWorld),M.direction.transformDirection(v),M.direction.normalize(),M.skyColor.copy(x.color).multiplyScalar(w),M.groundColor.copy(x.groundColor).multiplyScalar(w),t.hemi[m]=M,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=h,t.spot.length=p,t.rectArea.length=f,t.point.length=d,t.hemi.length=m,t.hash=t.id+","+h+","+d+","+p+","+f+","+m+","+s.length},state:t}}function Gn(){var e={};return{get:function(t,r){var n=t.id+","+r.id,i=e[n];return void 0===i&&(i=new function(){var e=new Vn,t=[],r=[],n=[];return{init:function(){t.length=0,r.length=0,n.length=0},state:{lightsArray:t,shadowsArray:r,spritesArray:n,lights:e},setupLights:function(n){e.setup(t,r,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)},pushSprite:function(e){n.push(e)}}},e[n]=i),i},dispose:function(){e={}}}}function Hn(e){Nr.call(this),this.type="MeshDepthMaterial",this.depthPacking=Lt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Wn(e){Nr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Bt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Xn(e,t,r){for(var n=new Zt,i=new kt,o=new Ft,s=new Ft(r,r),a=new Bt,l=new Bt,c=1,u=2,h=1+(c|u),d=new Array(h),f=new Array(h),y={},x={0:v,1:m,2:g},b=[new Bt(1,0,0),new Bt(-1,0,0),new Bt(0,0,1),new Bt(0,0,-1),new Bt(0,1,0),new Bt(0,-1,0)],w=[new Bt(0,1,0),new Bt(0,1,0),new Bt(0,1,0),new Bt(0,1,0),new Bt(0,0,1),new Bt(0,0,-1)],_=[new Gt,new Gt,new Gt,new Gt,new Gt,new Gt],S=0;S!==h;++S){var T=0!=(S&c),M=0!=(S&u),A=new Hn({depthPacking:It,morphTargets:T,skinning:M});d[S]=A;var E=new Wn({morphTargets:T,skinning:M});f[S]=E}var C=this;function P(t,r,n,i,o,s){var a=t.geometry,l=null,h=d,p=t.customDepthMaterial;if(n&&(h=f,p=t.customDistanceMaterial),p)l=p;else{var m=!1;r.morphTargets&&(a&&a.isBufferGeometry?m=a.morphAttributes&&a.morphAttributes.position&&a.morphAttributes.position.length>0:a&&a.isGeometry&&(m=a.morphTargets&&a.morphTargets.length>0)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var v=t.isSkinnedMesh&&r.skinning,g=0;m&&(g|=c),v&&(g|=u),l=h[g]}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var b=l.uuid,w=r.uuid,_=y[b];void 0===_&&(_={},y[b]=_);var S=_[w];void 0===S&&(S=l.clone(),_[w]=S),l=S}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:x[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=o,l.farDistance=s),l}function O(r,i,o,s){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);var a=t.update(r),c=r.material;if(Array.isArray(c))for(var u=a.groups,h=0,d=u.length;h<d;h++){var p=u[h],f=c[p.materialIndex];if(f&&f.visible){var m=P(r,f,s,l,o.near,o.far);e.renderBufferDirect(o,null,a,m,r,p)}}else if(c.visible){m=P(r,c,s,l,o.near,o.far);e.renderBufferDirect(o,null,a,m,r,null)}}for(var v=r.children,g=0,y=v.length;g<y;g++)O(v[g],i,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=p,this.render=function(t,r,c){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==t.length){var u,h=e.context,d=e.state;d.disable(h.BLEND),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=t.length;p<f;p++){var m=t[p],v=m.shadow,g=m&&m.isPointLight;if(void 0!==v){var y=v.camera;if(o.copy(v.mapSize),o.min(s),g){var x=o.x,S=o.y;_[0].set(2*x,S,x,S),_[1].set(0,S,x,S),_[2].set(3*x,S,x,S),_[3].set(x,S,x,S),_[4].set(3*x,0,x,S),_[5].set(x,0,x,S),o.x*=4,o.y*=2}if(null===v.map){var T={minFilter:ye,magFilter:ye,format:Ue};v.map=new Ht(o.x,o.y,T),v.map.texture.name=m.name+".shadowMap",y.updateProjectionMatrix()}v.isSpotLightShadow&&v.update(m);var M=v.map,A=v.matrix;l.setFromMatrixPosition(m.matrixWorld),y.position.copy(l),g?(u=6,A.makeTranslation(-l.x,-l.y,-l.z)):(u=1,a.setFromMatrixPosition(m.target.matrixWorld),y.lookAt(a),y.updateMatrixWorld(),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(y.projectionMatrix),A.multiply(y.matrixWorldInverse)),e.setRenderTarget(M),e.clear();for(var E=0;E<u;E++){if(g){a.copy(y.position),a.add(b[E]),y.up.copy(w[E]),y.lookAt(a),y.updateMatrixWorld();var P=_[E];d.viewport(P)}i.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),n.setFromMatrix(i),O(r,c,y,g)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}C.needsUpdate=!1}}}function qn(e,t,r,n,i,o,s,a,l){Vt.call(this,e,t,r,n,i,o,s,a,l),this.needsUpdate=!0}function Yn(e,t,r,n,i){var o,s,a,l,c,u,h=new Bt,d=new Ut,p=new Bt;function f(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),r=new Uint16Array([0,1,2,0,2,3]);o=t.createBuffer(),s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),a=function(){var e=t.createProgram(),r=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(r,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),t.shaderSource(n,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),t.compileShader(r),t.compileShader(n),t.attachShader(e,r),t.attachShader(e,n),t.linkProgram(e),e}(),l={position:t.getAttribLocation(a,"position"),uv:t.getAttribLocation(a,"uv")},c={uvOffset:t.getUniformLocation(a,"uvOffset"),uvScale:t.getUniformLocation(a,"uvScale"),rotation:t.getUniformLocation(a,"rotation"),center:t.getUniformLocation(a,"center"),scale:t.getUniformLocation(a,"scale"),color:t.getUniformLocation(a,"color"),map:t.getUniformLocation(a,"map"),opacity:t.getUniformLocation(a,"opacity"),modelViewMatrix:t.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(a,"projectionMatrix"),fogType:t.getUniformLocation(a,"fogType"),fogDensity:t.getUniformLocation(a,"fogDensity"),fogNear:t.getUniformLocation(a,"fogNear"),fogFar:t.getUniformLocation(a,"fogFar"),fogColor:t.getUniformLocation(a,"fogColor"),fogDepth:t.getUniformLocation(a,"fogDepth"),alphaTest:t.getUniformLocation(a,"alphaTest")};var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=8,n.height=8;var h=n.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),u=new qn(n)}function m(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(i,v,g){if(0!==i.length){void 0===a&&f(),r.useProgram(a),r.initAttributes(),r.enableAttribute(l.position),r.enableAttribute(l.uv),r.disableUnusedAttributes(),r.disable(t.CULL_FACE),r.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(l.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(l.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.uniformMatrix4fv(c.projectionMatrix,!1,g.projectionMatrix.elements),r.activeTexture(t.TEXTURE0),t.uniform1i(c.map,0);var y=0,x=0,b=v.fog;b?(t.uniform3f(c.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(t.uniform1f(c.fogNear,b.near),t.uniform1f(c.fogFar,b.far),t.uniform1i(c.fogType,1),y=1,x=1):b.isFogExp2&&(t.uniform1f(c.fogDensity,b.density),t.uniform1i(c.fogType,2),y=2,x=2)):(t.uniform1i(c.fogType,0),y=0,x=0);for(var w=0,_=i.length;w<_;w++){(M=i[w]).modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,M.matrixWorld),M.z=-M.modelViewMatrix.elements[14]}i.sort(m);var S=[],T=[];for(w=0,_=i.length;w<_;w++){var M,A=(M=i[w]).material;if(!1!==A.visible){M.onBeforeRender(e,v,g,void 0,A,void 0),t.uniform1f(c.alphaTest,A.alphaTest),t.uniformMatrix4fv(c.modelViewMatrix,!1,M.modelViewMatrix.elements),M.matrixWorld.decompose(h,d,p),S[0]=p.x,S[1]=p.y,T[0]=M.center.x-.5,T[1]=M.center.y-.5;var E=0;v.fog&&A.fog&&(E=x),y!==E&&(t.uniform1i(c.fogType,E),y=E),null!==A.map?(t.uniform2f(c.uvOffset,A.map.offset.x,A.map.offset.y),t.uniform2f(c.uvScale,A.map.repeat.x,A.map.repeat.y)):(t.uniform2f(c.uvOffset,0,0),t.uniform2f(c.uvScale,1,1)),t.uniform1f(c.opacity,A.opacity),t.uniform3f(c.color,A.color.r,A.color.g,A.color.b),t.uniform1f(c.rotation,A.rotation),t.uniform2fv(c.center,T),t.uniform2fv(c.scale,S),r.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst,A.blendEquationAlpha,A.blendSrcAlpha,A.blendDstAlpha,A.premultipliedAlpha),r.buffers.depth.setTest(A.depthTest),r.buffers.depth.setMask(A.depthWrite),r.buffers.color.setMask(A.colorWrite),n.setTexture2D(A.map||u,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),M.onAfterRender(e,v,g,void 0,A,void 0)}}r.enable(t.CULL_FACE),r.reset()}}}function Jn(e,t,r,n,i,o,s){var a,l="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,c={};function u(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");var r=t/Math.max(e.width,e.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(e.width*r),n.height=Math.floor(e.height*r),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function h(e){return Rt.isPowerOfTwo(e.width)&&Rt.isPowerOfTwo(e.height)}function d(e,t){return e.generateMipmaps&&t&&e.minFilter!==ye&&e.minFilter!==we}function p(t,r,i,o){e.generateMipmap(t),n.get(r).__maxMipLevel=Math.log2(Math.max(i,o))}function f(t){return t===ye||t===xe||t===be?e.NEAREST:e.LINEAR}function m(t){var r=t.target;r.removeEventListener("dispose",m),function(t){var r=n.get(t);if(t.image&&r.__image__webglTextureCube)e.deleteTexture(r.__image__webglTextureCube);else{if(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture)}n.remove(t)}(r),r.isVideoTexture&&delete c[r.id],s.memory.textures--}function v(t){var r=t.target;r.removeEventListener("dispose",v),function(t){var r=n.get(t),i=n.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[o]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}(r),s.memory.textures--}function g(t,f){var v=n.get(t);if(t.isVideoTexture&&function(e){var t=e.id,r=s.render.frame;c[t]!==r&&(c[t]=r,e.update())}(t),t.version>0&&v.__version!==t.version){var g=t.image;if(void 0===g)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==g.complete)return void function(t,n,c){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",m),t.__webglTexture=e.createTexture(),s.memory.textures++);r.activeTexture(e.TEXTURE0+c),r.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment);var f=u(n.image,i.maxTextureSize);(function(e){return e.wrapS!==ve||e.wrapT!==ve||e.minFilter!==ye&&e.minFilter!==we})(n)&&!1===h(f)&&(f=function(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(void 0===a&&(a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),a.width=Rt.floorPowerOfTwo(e.width),a.height=Rt.floorPowerOfTwo(e.height),a.getContext("2d").drawImage(e,0,0,a.width,a.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+a.width+"x"+a.height,e),a):e}(f));var v=h(f),g=o.convert(n.format),x=o.convert(n.type);y(e.TEXTURE_2D,n,v);var b,w=n.mipmaps;if(n.isDepthTexture){var _=e.DEPTH_COMPONENT;if(n.type===Oe){if(!l)throw new Error("Float Depth Texture only supported in WebGL2.0");_=e.DEPTH_COMPONENT32F}else l&&(_=e.DEPTH_COMPONENT16);n.format===Ve&&_===e.DEPTH_COMPONENT&&n.type!==Ee&&n.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ee,x=o.convert(n.type)),n.format===Ge&&(_=e.DEPTH_STENCIL,n.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Re,x=o.convert(n.type))),r.texImage2D(e.TEXTURE_2D,0,_,f.width,f.height,0,g,x,null)}else if(n.isDataTexture)if(w.length>0&&v){for(var S=0,T=w.length;S<T;S++)b=w[S],r.texImage2D(e.TEXTURE_2D,S,g,b.width,b.height,0,g,x,b.data);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else r.texImage2D(e.TEXTURE_2D,0,g,f.width,f.height,0,g,x,f.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(var S=0,T=w.length;S<T;S++)b=w[S],n.format!==Ue&&n.format!==ke?r.getCompressedTextureFormats().indexOf(g)>-1?r.compressedTexImage2D(e.TEXTURE_2D,S,g,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(e.TEXTURE_2D,S,g,b.width,b.height,0,g,x,b.data);t.__maxMipLevel=w.length-1}else if(w.length>0&&v){for(var S=0,T=w.length;S<T;S++)b=w[S],r.texImage2D(e.TEXTURE_2D,S,g,g,x,b);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else r.texImage2D(e.TEXTURE_2D,0,g,g,x,f),t.__maxMipLevel=0;d(n,v)&&p(e.TEXTURE_2D,n,f.width,f.height);t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(v,t,f);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}r.activeTexture(e.TEXTURE0+f),r.bindTexture(e.TEXTURE_2D,v.__webglTexture)}function y(r,s,a){var l;if(a?(e.texParameteri(r,e.TEXTURE_WRAP_S,o.convert(s.wrapS)),e.texParameteri(r,e.TEXTURE_WRAP_T,o.convert(s.wrapT)),e.texParameteri(r,e.TEXTURE_MAG_FILTER,o.convert(s.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o.convert(s.minFilter))):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s.wrapS===ve&&s.wrapT===ve||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),e.texParameteri(r,e.TEXTURE_MAG_FILTER,f(s.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,f(s.minFilter)),s.minFilter!==ye&&s.minFilter!==we&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),l=t.get("EXT_texture_filter_anisotropic")){if(s.type===Oe&&null===t.get("OES_texture_float_linear"))return;if(s.type===De&&null===t.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function x(t,i,s,a){var l=o.convert(i.texture.format),c=o.convert(i.texture.type);r.texImage2D(a,0,l,i.width,i.height,0,l,c,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,s,a,n.get(i.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function b(t,r){e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):r.depthBuffer&&r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,r.width,r.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function w(t){var r=n.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),g(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Ve)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0);else{if(r.depthTexture.format!==Ge)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0)}}(r.__webglFramebuffer,t)}else if(i){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),b(r.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),b(r.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}this.setTexture2D=g,this.setTextureCube=function(t,a){var l=n.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",m),l.__image__webglTextureCube=e.createTexture(),s.memory.textures++),r.activeTexture(e.TEXTURE0+a),r.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var c=t&&t.isCompressedTexture,f=t.image[0]&&t.image[0].isDataTexture,v=[],g=0;g<6;g++)v[g]=c||f?f?t.image[g].image:t.image[g]:u(t.image[g],i.maxCubemapSize);var x=v[0],b=h(x),w=o.convert(t.format),_=o.convert(t.type);for(y(e.TEXTURE_CUBE_MAP,t,b),g=0;g<6;g++)if(c)for(var S,T=v[g].mipmaps,M=0,A=T.length;M<A;M++)S=T[M],t.format!==Ue&&t.format!==ke?r.getCompressedTextureFormats().indexOf(w)>-1?r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,w,_,S.data);else f?r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,v[g].width,v[g].height,0,w,_,v[g].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,w,_,v[g]);l.__maxMipLevel=c?T.length-1:0,d(t,b)&&p(e.TEXTURE_CUBE_MAP,t,x.width,x.height),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(e.TEXTURE0+a),r.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,i){r.activeTexture(e.TEXTURE0+i),r.bindTexture(e.TEXTURE_CUBE_MAP,n.get(t).__webglTexture)},this.setupRenderTarget=function(t){var i=n.get(t),o=n.get(t.texture);t.addEventListener("dispose",v),o.__webglTexture=e.createTexture(),s.memory.textures++;var a=!0===t.isWebGLRenderTargetCube,l=h(t);if(a){i.__webglFramebuffer=[];for(var c=0;c<6;c++)i.__webglFramebuffer[c]=e.createFramebuffer()}else i.__webglFramebuffer=e.createFramebuffer();if(a){for(r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),y(e.TEXTURE_CUBE_MAP,t.texture,l),c=0;c<6;c++)x(i.__webglFramebuffer[c],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c);d(t.texture,l)&&p(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_CUBE_MAP,null)}else r.bindTexture(e.TEXTURE_2D,o.__webglTexture),y(e.TEXTURE_2D,t.texture,l),x(i.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),d(t.texture,l)&&p(e.TEXTURE_2D,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&w(t)},this.updateRenderTargetMipmap=function(t){var i=t.texture;if(d(i,h(t))){var o=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=n.get(i).__webglTexture;r.bindTexture(o,s),p(o,i,t.width,t.height),r.bindTexture(o,null)}}}function Zn(e,t){return{convert:function(r){var n;if(r===me)return e.REPEAT;if(r===ve)return e.CLAMP_TO_EDGE;if(r===ge)return e.MIRRORED_REPEAT;if(r===ye)return e.NEAREST;if(r===xe)return e.NEAREST_MIPMAP_NEAREST;if(r===be)return e.NEAREST_MIPMAP_LINEAR;if(r===we)return e.LINEAR;if(r===_e)return e.LINEAR_MIPMAP_NEAREST;if(r===Se)return e.LINEAR_MIPMAP_LINEAR;if(r===Te)return e.UNSIGNED_BYTE;if(r===Ne)return e.UNSIGNED_SHORT_4_4_4_4;if(r===Le)return e.UNSIGNED_SHORT_5_5_5_1;if(r===Ie)return e.UNSIGNED_SHORT_5_6_5;if(r===Me)return e.BYTE;if(r===Ae)return e.SHORT;if(r===Ee)return e.UNSIGNED_SHORT;if(r===Ce)return e.INT;if(r===Pe)return e.UNSIGNED_INT;if(r===Oe)return e.FLOAT;if(r===De&&null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES;if(r===Fe)return e.ALPHA;if(r===ke)return e.RGB;if(r===Ue)return e.RGBA;if(r===Be)return e.LUMINANCE;if(r===je)return e.LUMINANCE_ALPHA;if(r===Ve)return e.DEPTH_COMPONENT;if(r===Ge)return e.DEPTH_STENCIL;if(r===P)return e.FUNC_ADD;if(r===O)return e.FUNC_SUBTRACT;if(r===D)return e.FUNC_REVERSE_SUBTRACT;if(r===I)return e.ZERO;if(r===R)return e.ONE;if(r===F)return e.SRC_COLOR;if(r===k)return e.ONE_MINUS_SRC_COLOR;if(r===U)return e.SRC_ALPHA;if(r===B)return e.ONE_MINUS_SRC_ALPHA;if(r===j)return e.DST_ALPHA;if(r===z)return e.ONE_MINUS_DST_ALPHA;if(r===V)return e.DST_COLOR;if(r===G)return e.ONE_MINUS_DST_COLOR;if(r===H)return e.SRC_ALPHA_SATURATE;if((r===He||r===We||r===Xe||r===qe)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(r===He)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===We)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Xe)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===qe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===Ye||r===Je||r===Ze||r===Qe)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(r===Ye)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Je)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Ze)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Qe)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===Ke&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((r===$e||r===et||r===tt||r===rt||r===nt||r===it||r===ot||r===st||r===at||r===lt||r===ct||r===ut||r===ht||r===dt)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return r;if((r===N||r===L)&&null!==(n=t.get("EXT_blend_minmax"))){if(r===N)return n.MIN_EXT;if(r===L)return n.MAX_EXT}return r===Re&&null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:0}}}function Qn(e,t,r,n){lr.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Kn(e){Qn.call(this),this.cameras=e||[]}function $n(e){var t=this,r=null,n=null,i=null,o=new kt,s=new kt;"undefined"!=typeof window&&"VRFrameData"in window&&(n=new window.VRFrameData);var a=new kt,l=new Ut,c=new Bt,u=new Qn;u.bounds=new Gt(0,0,.5,1),u.layers.enable(1);var h=new Qn;h.bounds=new Gt(.5,0,.5,1),h.layers.enable(2);var d,p,f=new Kn([u,h]);function m(){if(null!==r&&r.isPresenting){var n=r.getEyeParameters("left"),i=n.renderWidth,o=n.renderHeight;p=e.getPixelRatio(),d=e.getSize(),e.setDrawingBufferSize(2*i,o,1)}else t.enabled&&e.setDrawingBufferSize(d.width,d.height,p)}f.layers.enable(1),f.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",m,!1),this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e)},this.setPoseTarget=function(e){void 0!==e&&(i=e)},this.getCamera=function(e){if(null===r)return e;r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(n);var d=r.stageParameters;d?o.fromArray(d.sittingToStandingTransform):o.makeTranslation(0,t.userHeight,0);var p=n.pose,m=null!==i?i:e;if(m.matrix.copy(o),m.matrix.decompose(m.position,m.quaternion,m.scale),null!==p.orientation&&(l.fromArray(p.orientation),m.quaternion.multiply(l)),null!==p.position&&(l.setFromRotationMatrix(o),c.fromArray(p.position),c.applyQuaternion(l),m.position.add(c)),m.updateMatrixWorld(),!1===r.isPresenting)return e;u.near=e.near,h.near=e.near,u.far=e.far,h.far=e.far,f.matrixWorld.copy(e.matrixWorld),f.matrixWorldInverse.copy(e.matrixWorldInverse),u.matrixWorldInverse.fromArray(n.leftViewMatrix),h.matrixWorldInverse.fromArray(n.rightViewMatrix),s.getInverse(o),u.matrixWorldInverse.multiply(s),h.matrixWorldInverse.multiply(s);var v=m.parent;null!==v&&(a.getInverse(v.matrixWorld),u.matrixWorldInverse.multiply(a),h.matrixWorldInverse.multiply(a)),u.matrixWorld.getInverse(u.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),u.projectionMatrix.fromArray(n.leftProjectionMatrix),h.projectionMatrix.fromArray(n.rightProjectionMatrix),f.projectionMatrix.copy(u.projectionMatrix);var g=r.getLayers();if(g.length){var y=g[0];null!==y.leftBounds&&4===y.leftBounds.length&&u.bounds.fromArray(y.leftBounds),null!==y.rightBounds&&4===y.rightBounds.length&&h.bounds.fromArray(y.rightBounds)}return f},this.getStandingMatrix=function(){return o},this.submitFrame=function(){r&&r.isPresenting&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",m)}}function ei(e){console.log("THREE.WebGLRenderer",i);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,o=void 0===e.depth||e.depth,c=void 0===e.stencil||e.stencil,u=void 0!==e.antialias&&e.antialias,h=void 0===e.premultipliedAlpha||e.premultipliedAlpha,d=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,p=void 0!==e.powerPreference?e.powerPreference:"default",f=null,m=null;this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=ne,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var y,x,w,_,P,O,D,N,L,I,R,F,k,U,B,j,z,V,G,H=this,$=!1,ee=null,te=null,re=-1,ie="",oe=null,se=null,ae=new Gt,le=new Gt,ce=null,ue=0,he=t.width,de=t.height,pe=1,fe=new Gt(0,0,he,de),me=new Gt(0,0,he,de),ve=!1,ge=new Zt,ye=new function(){var e=this,t=null,r=0,n=!1,i=!1,o=new Jt,s=new jt,a={value:null,needsUpdate:!1};function l(){a.value!==t&&(a.value=t,a.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(t,r,n,i){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=a.value,!0!==i||null===c){var u=n+4*l,h=r.matrixWorldInverse;s.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,p=n;d!==l;++d,p+=4)o.copy(t[d]).applyMatrix4(h,s),o.normal.toArray(c,p),c[p+3]=o.constant}a.value=c,a.needsUpdate=!0}return e.numPlanes=l,c}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,o){var s=0!==e.length||i||0!==r||n;return n=i,t=c(e,o,0),r=e.length,s},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,o,s,u,h,d){if(!n||null===e||0===e.length||i&&!s)i?c(null):l();else{var p=i?0:r,f=4*p,m=h.clippingState||null;a.value=m,m=c(e,u,f,d);for(var v=0;v!==f;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}},xe=!1,be=!1,we=new kt,_e=new Bt;function Se(){return null===ee?pe:1}try{var Me={alpha:n,depth:o,stencil:c,antialias:u,premultipliedAlpha:h,preserveDrawingBuffer:d,powerPreference:p};if(t.addEventListener("webglcontextlost",Pe,!1),t.addEventListener("webglcontextrestored",Ne,!1),null===(y=r||t.getContext("webgl",Me)||t.getContext("experimental-webgl",Me)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===y.getShaderPrecisionFormat&&(y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function Ae(){(x=new function(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=e.getExtension("WEBGL_compressed_texture_etc1");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}(y)).get("WEBGL_depth_texture"),x.get("OES_texture_float"),x.get("OES_texture_float_linear"),x.get("OES_texture_half_float"),x.get("OES_texture_half_float_linear"),x.get("OES_standard_derivatives"),x.get("OES_element_index_uint"),x.get("ANGLE_instanced_arrays"),G=new Zn(y,x),w=new function(e,t,r){var n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var a=!0===r.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_TEXTURE_SIZE),h=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),d=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=c>0,g=!!t.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:a,maxTextures:l,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:h,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:g,floatVertexTextures:v&&g}}(y,x,e),(_=new function(e,t,r){var n=new function(){var t=!1,r=new Gt,n=null,i=new Gt(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,o,s,a){!0===a&&(t*=s,n*=s,o*=s),r.set(t,n,o,s),!1===i.equals(r)&&(e.clearColor(t,n,o,s),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},i=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(t){t?te(e.DEPTH_TEST):re(e.DEPTH_TEST)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case W:e.depthFunc(e.NEVER);break;case X:e.depthFunc(e.ALWAYS);break;case q:e.depthFunc(e.LESS);break;case Y:e.depthFunc(e.LEQUAL);break;case J:e.depthFunc(e.EQUAL);break;case Z:e.depthFunc(e.GEQUAL);break;case Q:e.depthFunc(e.GREATER);break;case K:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},o=new function(){var t=!1,r=null,n=null,i=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(t){t?te(e.STENCIL_TEST):re(e.STENCIL_TEST)},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,s){n===t&&i===r&&o===s||(e.stencilFunc(t,r,s),n=t,i=r,o=s)},setOp:function(t,r,n){s===t&&a===r&&l===n||(e.stencilOp(t,r,n),s=t,a=r,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,r=null,n=null,i=null,o=null,s=null,a=null,l=null,c=null}}},c=e.getParameter(e.MAX_VERTEX_ATTRIBS),u=new Uint8Array(c),h=new Uint8Array(c),d=new Uint8Array(c),p={},f=null,m=null,y=null,x=null,b=null,w=null,_=null,P=null,O=null,D=!1,N=null,L=null,I=null,R=null,F=null,k=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),U=!1,B=0,j=e.getParameter(e.VERSION);-1!==j.indexOf("WebGL")?(B=parseFloat(/^WebGL\ ([0-9])/.exec(j)[1]),U=B>=1):-1!==j.indexOf("OpenGL ES")&&(B=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(j)[1]),U=B>=2);var z=null,V={},G=new Gt,H=new Gt;function $(t,r,n){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<n;s++)e.texImage2D(r+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return o}var ee={};function te(t){!0!==p[t]&&(e.enable(t),p[t]=!0)}function re(t){!1!==p[t]&&(e.disable(t),p[t]=!1)}function ne(t,n,i,o,s,a,l,c){if(t!==S?te(e.BLEND):re(e.BLEND),t!==C){if(t!==y||c!==D)switch(t){case M:c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE));break;case A:c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR));break;case E:c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR));break;default:c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))}x=null,b=null,w=null,_=null,P=null,O=null}else s=s||n,a=a||i,l=l||o,n===x&&s===_||(e.blendEquationSeparate(r.convert(n),r.convert(s)),x=n,_=s),i===b&&o===w&&a===P&&l===O||(e.blendFuncSeparate(r.convert(i),r.convert(o),r.convert(a),r.convert(l)),b=i,w=o,P=a,O=l);y=t,D=c}function ie(t){N!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),N=t)}function oe(t){t!==s?(te(e.CULL_FACE),t!==L&&(t===a?e.cullFace(e.BACK):t===l?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):re(e.CULL_FACE),L=t}function se(t,r,n){t?(te(e.POLYGON_OFFSET_FILL),R===r&&F===n||(e.polygonOffset(r,n),R=r,F=n)):re(e.POLYGON_OFFSET_FILL)}function ae(t){void 0===t&&(t=e.TEXTURE0+k-1),z!==t&&(e.activeTexture(t),z=t)}return ee[e.TEXTURE_2D]=$(e.TEXTURE_2D,e.TEXTURE_2D,1),ee[e.TEXTURE_CUBE_MAP]=$(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),i.setClear(1),o.setClear(0),te(e.DEPTH_TEST),i.setFunc(Y),ie(!1),oe(a),te(e.CULL_FACE),te(e.BLEND),ne(T),{buffers:{color:n,depth:i,stencil:o},initAttributes:function(){for(var e=0,t=u.length;e<t;e++)u[e]=0},enableAttribute:function(r){u[r]=1,0===h[r]&&(e.enableVertexAttribArray(r),h[r]=1),0!==d[r]&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,0),d[r]=0)},enableAttributeAndDivisor:function(r,n){u[r]=1,0===h[r]&&(e.enableVertexAttribArray(r),h[r]=1),d[r]!==n&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,n),d[r]=n)},disableUnusedAttributes:function(){for(var t=0,r=h.length;t!==r;++t)h[t]!==u[t]&&(e.disableVertexAttribArray(t),h[t]=0)},enable:te,disable:re,getCompressedTextureFormats:function(){if(null===f&&(f=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),n=0;n<r.length;n++)f.push(r[n]);return f},useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:ne,setMaterial:function(t,r){t.side===g?re(e.CULL_FACE):te(e.CULL_FACE);var o=t.side===v;r&&(o=!o),ie(o),!0===t.transparent?ne(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):ne(S),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),n.setMask(t.colorWrite),se(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:ie,setCullFace:oe,setLineWidth:function(t){t!==I&&(U&&e.lineWidth(t),I=t)},setPolygonOffset:se,setScissorTest:function(t){t?te(e.SCISSOR_TEST):re(e.SCISSOR_TEST)},activeTexture:ae,bindTexture:function(t,r){null===z&&ae();var n=V[z];void 0===n&&(n={type:void 0,texture:void 0},V[z]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||ee[t]),n.type=t,n.texture=r)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===G.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),G.copy(t))},viewport:function(t){!1===H.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),H.copy(t))},reset:function(){for(var t=0;t<h.length;t++)1===h[t]&&(e.disableVertexAttribArray(t),h[t]=0);p={},f=null,z=null,V={},m=null,y=null,N=null,L=null,n.reset(),i.reset(),o.reset()}}}(y,x,G)).scissor(le.copy(me).multiplyScalar(pe)),_.viewport(ae.copy(fe).multiplyScalar(pe)),P=new function(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,n,i){switch(i=i||1,t.calls++,n){case e.TRIANGLES:t.triangles+=i*(r/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=i*(r-2);break;case e.LINES:t.lines+=i*(r/2);break;case e.LINE_STRIP:t.lines+=i*(r-1);break;case e.LINE_LOOP:t.lines+=i*r;break;case e.POINTS:t.points+=i*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}(y),O=new function(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}},D=new Jn(y,x,_,O,w,G,P),N=new nr(y),L=new function(e,t,r){var n={},i={};function o(e){var s=e.target,a=n[s.id];for(var l in null!==a.index&&t.remove(a.index),a.attributes)t.remove(a.attributes[l]);s.removeEventListener("dispose",o),delete n[s.id];var c=i[s.id];c&&(t.remove(c),delete i[s.id]),(c=i[a.id])&&(t.remove(c),delete i[a.id]),r.memory.geometries--}return{get:function(e,t){var i=n[t.id];return i||(t.addEventListener("dispose",o),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ar).setFromObject(e)),i=t._bufferGeometry),n[t.id]=i,r.memory.geometries++,i)},update:function(r){var n=r.index,i=r.attributes;for(var o in null!==n&&t.update(n,e.ELEMENT_ARRAY_BUFFER),i)t.update(i[o],e.ARRAY_BUFFER);var s=r.morphAttributes;for(var o in s)for(var a=s[o],l=0,c=a.length;l<c;l++)t.update(a[l],e.ARRAY_BUFFER)},getWireframeAttribute:function(r){var n=i[r.id];if(n)return n;var o,s=[],a=r.index,l=r.attributes;if(null!==a)for(var c=0,u=(o=a.array).length;c<u;c+=3){var h=o[c+0],d=o[c+1],p=o[c+2];s.push(h,d,d,p,p,h)}else for(c=0,u=(o=l.position.array).length/3-1;c<u;c+=3)h=c+0,d=c+1,p=c+2,s.push(h,d,d,p,p,h);return n=new(Tr(s)>65535?br:yr)(s,1),t.update(n,e.ELEMENT_ARRAY_BUFFER),i[r.id]=n,n}}}(y,N,P),I=new function(e,t){var r={};return{update:function(n){var i=t.render.frame,o=n.geometry,s=e.get(n,o);return r[s.id]!==i&&(o.isGeometry&&s.updateFromObject(n),e.update(s),r[s.id]=i),s},dispose:function(){r={}}}}(L,P),B=new function(e){var t={},r=new Float32Array(8);return{update:function(n,i,o,s){var a=n.morphTargetInfluences,l=a.length,c=t[i.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[i.id]=c}var h=o.morphTargets&&i.morphAttributes.position,d=o.morphNormals&&i.morphAttributes.normal;for(u=0;u<l;u++)0!==(p=c[u])[1]&&(h&&i.removeAttribute("morphTarget"+u),d&&i.removeAttribute("morphNormal"+u));for(u=0;u<l;u++)(p=c[u])[0]=u,p[1]=a[u];for(c.sort(Br),u=0;u<8;u++){var p;if(p=c[u]){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+u,h[f]),d&&i.addAttribute("morphNormal"+u,d[f]),r[u]=m;continue}}r[u]=0}s.getUniforms().setValue(e,"morphTargetInfluences",r)}}}(y),R=new kn(H,x,w),F=new jn,k=new Gn,U=new function(e,t,r,n){var i,o,s,a=new er(0),l=0;function c(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),c(a,l=void 0!==t?t:1)},getClearAlpha:function(){return l},setClearAlpha:function(e){c(a,l=e)},render:function(t,n,u,h){var d=n.background;null===d?c(a,l):d&&d.isColor&&(c(d,1),h=!0),(e.autoClear||h)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&d.isCubeTexture?(void 0===s&&((s=new Ur(new Cr(1,1,1),new Ir({uniforms:rr.cube.uniforms,vertexShader:rr.cube.vertexShader,fragmentShader:rr.cube.fragmentShader,side:v,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},r.update(s.geometry)),s.material.uniforms.tCube.value=d,t.push(s,s.geometry,s.material,0,null)):d&&d.isTexture&&(void 0===i&&(i=new cr(-1,1,1,-1,0,1),o=new Ur(new Or(2,2),new Lr({depthTest:!1,depthWrite:!1,fog:!1})),r.update(o.geometry)),o.material.map=d,e.renderBufferDirect(i,null,o.geometry,o.material,o,null))}}}(H,_,L,h),j=new function(e,t,r){var n;this.setMode=function(e){n=e},this.render=function(t,i){e.drawArrays(n,t,i),r.update(i,n)},this.renderInstances=function(e,i,o){var s=t.get("ANGLE_instanced_arrays");if(null!==s){var a=e.attributes.position;a.isInterleavedBufferAttribute?(o=a.data.count,s.drawArraysInstancedANGLE(n,0,o,e.maxInstancedCount)):s.drawArraysInstancedANGLE(n,i,o,e.maxInstancedCount),r.update(o,n,e.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(y,x,P),z=new function(e,t,r){var n,i,o;this.setMode=function(e){n=e},this.setIndex=function(e){i=e.type,o=e.bytesPerElement},this.render=function(t,s){e.drawElements(n,s,i,t*o),r.update(s,n)},this.renderInstances=function(e,s,a){var l=t.get("ANGLE_instanced_arrays");null!==l?(l.drawElementsInstancedANGLE(n,a,i,s*o,e.maxInstancedCount),r.update(a,n,e.maxInstancedCount)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(y,x,P),V=new Yn(H,y,_,D,w),P.programs=R.programs,H.context=y,H.capabilities=w,H.extensions=x,H.properties=O,H.renderLists=F,H.state=_,H.info=P}Ae();var Ee=new $n(H);this.vr=Ee;var Ce=new Xn(H,I,w.maxTextureSize);function Pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),$=!0}function Ne(){console.log("THREE.WebGLRenderer: Context Restored."),$=!1,Ae()}function Le(e){var t=e.target;t.removeEventListener("dispose",Le),function(e){Ie(e),O.remove(e)}(t)}function Ie(e){var t=O.get(e).program;e.program=void 0,void 0!==t&&R.releaseProgram(t)}this.shadowMap=Ce,this.getContext=function(){return y},this.getContextAttributes=function(){return y.getContextAttributes()},this.forceContextLoss=function(){var e=x.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=x.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return pe},this.setPixelRatio=function(e){void 0!==e&&(pe=e,this.setSize(he,de,!1))},this.getSize=function(){return{width:he,height:de}},this.setSize=function(e,r,n){var i=Ee.getDevice();i&&i.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(he=e,de=r,t.width=e*pe,t.height=r*pe,!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(){return{width:he*pe,height:de*pe}},this.setDrawingBufferSize=function(e,r,n){he=e,de=r,pe=n,t.width=e*n,t.height=r*n,this.setViewport(0,0,e,r)},this.getCurrentViewport=function(){return ae},this.setViewport=function(e,t,r,n){fe.set(e,de-t-n,r,n),_.viewport(ae.copy(fe).multiplyScalar(pe))},this.setScissor=function(e,t,r,n){me.set(e,de-t-n,r,n),_.scissor(le.copy(me).multiplyScalar(pe))},this.setScissorTest=function(e){_.setScissorTest(ve=e)},this.getClearColor=function(){return U.getClearColor()},this.setClearColor=function(){U.setClearColor.apply(U,arguments)},this.getClearAlpha=function(){return U.getClearAlpha()},this.setClearAlpha=function(){U.setClearAlpha.apply(U,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=y.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=y.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=y.STENCIL_BUFFER_BIT),y.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,r,n){this.setRenderTarget(e),this.clear(t,r,n)},this.dispose=function(){t.removeEventListener("webglcontextlost",Pe,!1),t.removeEventListener("webglcontextrestored",Ne,!1),F.dispose(),k.dispose(),O.dispose(),I.dispose(),Ee.dispose(),ke()},this.renderBufferImmediate=function(e,t,r){_.initAttributes();var n=O.get(e);e.hasPositions&&!n.position&&(n.position=y.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=y.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=y.createBuffer()),e.hasColors&&!n.color&&(n.color=y.createBuffer());var i=t.getAttributes();if(e.hasPositions&&(y.bindBuffer(y.ARRAY_BUFFER,n.position),y.bufferData(y.ARRAY_BUFFER,e.positionArray,y.DYNAMIC_DRAW),_.enableAttribute(i.position),y.vertexAttribPointer(i.position,3,y.FLOAT,!1,0,0)),e.hasNormals){if(y.bindBuffer(y.ARRAY_BUFFER,n.normal),!r.isMeshPhongMaterial&&!r.isMeshStandardMaterial&&!r.isMeshNormalMaterial&&!0===r.flatShading)for(var o=0,s=3*e.count;o<s;o+=9){var a=e.normalArray,l=(a[o+0]+a[o+3]+a[o+6])/3,c=(a[o+1]+a[o+4]+a[o+7])/3,u=(a[o+2]+a[o+5]+a[o+8])/3;a[o+0]=l,a[o+1]=c,a[o+2]=u,a[o+3]=l,a[o+4]=c,a[o+5]=u,a[o+6]=l,a[o+7]=c,a[o+8]=u}y.bufferData(y.ARRAY_BUFFER,e.normalArray,y.DYNAMIC_DRAW),_.enableAttribute(i.normal),y.vertexAttribPointer(i.normal,3,y.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(y.bindBuffer(y.ARRAY_BUFFER,n.uv),y.bufferData(y.ARRAY_BUFFER,e.uvArray,y.DYNAMIC_DRAW),_.enableAttribute(i.uv),y.vertexAttribPointer(i.uv,2,y.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==b&&(y.bindBuffer(y.ARRAY_BUFFER,n.color),y.bufferData(y.ARRAY_BUFFER,e.colorArray,y.DYNAMIC_DRAW),_.enableAttribute(i.color),y.vertexAttribPointer(i.color,3,y.FLOAT,!1,0,0)),_.disableUnusedAttributes(),y.drawArrays(y.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,o){var s=i.isMesh&&i.matrixWorld.determinant()<0;_.setMaterial(n,s);var a=He(e,t,n,i),l=r.id+"_"+a.id+"_"+(!0===n.wireframe),c=!1;l!==ie&&(ie=l,c=!0),i.morphTargetInfluences&&(B.update(i,r,n,a),c=!0);var u,h=r.index,d=r.attributes.position,p=1;!0===n.wireframe&&(h=L.getWireframeAttribute(r),p=2);var f=j;null!==h&&(u=N.get(h),(f=z).setIndex(u)),c&&(!function(e,t,r,n){if(r&&r.isInstancedBufferGeometry&&null===x.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===n&&(n=0);_.initAttributes();var i=r.attributes,o=t.getAttributes(),s=e.defaultAttributeValues;for(var a in o){var l=o[a];if(l>=0){var c=i[a];if(void 0!==c){var u=c.normalized,h=c.itemSize,d=N.get(c);if(void 0===d)continue;var p=d.buffer,f=d.type,m=d.bytesPerElement;if(c.isInterleavedBufferAttribute){var v=c.data,g=v.stride,b=c.offset;v&&v.isInstancedInterleavedBuffer?(_.enableAttributeAndDivisor(l,v.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=v.meshPerAttribute*v.count)):_.enableAttribute(l),y.bindBuffer(y.ARRAY_BUFFER,p),y.vertexAttribPointer(l,h,f,u,g*m,(n*g+b)*m)}else c.isInstancedBufferAttribute?(_.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=c.meshPerAttribute*c.count)):_.enableAttribute(l),y.bindBuffer(y.ARRAY_BUFFER,p),y.vertexAttribPointer(l,h,f,u,0,n*h*m)}else if(void 0!==s){var w=s[a];if(void 0!==w)switch(w.length){case 2:y.vertexAttrib2fv(l,w);break;case 3:y.vertexAttrib3fv(l,w);break;case 4:y.vertexAttrib4fv(l,w);break;default:y.vertexAttrib1fv(l,w)}}}}_.disableUnusedAttributes()}(n,a,r),null!==h&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,u.buffer));var m=1/0;null!==h?m=h.count:void 0!==d&&(m=d.count);var v=r.drawRange.start*p,g=r.drawRange.count*p,b=null!==o?o.start*p:0,w=null!==o?o.count*p:1/0,S=Math.max(v,b),T=Math.min(m,v+g,b+w)-1,M=Math.max(0,T-S+1);if(0!==M){if(i.isMesh)if(!0===n.wireframe)_.setLineWidth(n.wireframeLinewidth*Se()),f.setMode(y.LINES);else switch(i.drawMode){case _t:f.setMode(y.TRIANGLES);break;case St:f.setMode(y.TRIANGLE_STRIP);break;case Tt:f.setMode(y.TRIANGLE_FAN)}else if(i.isLine){var A=n.linewidth;void 0===A&&(A=1),_.setLineWidth(A*Se()),i.isLineSegments?f.setMode(y.LINES):i.isLineLoop?f.setMode(y.LINE_LOOP):f.setMode(y.LINE_STRIP)}else i.isPoints&&f.setMode(y.POINTS);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&f.renderInstances(r,S,M):f.render(S,M)}},this.compile=function(e,t){(m=k.get(e,t)).init(),e.traverse(function(e){e.isLight&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),m.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)Ge(t.material[r],e.fog,t);else Ge(t.material,e.fog,t)})};var Re=!1,Fe=null;function ke(){Re=!1}function Be(){var e=Ee.getDevice();e&&e.isPresenting?e.requestAnimationFrame(je):window.requestAnimationFrame(je)}function je(e){!1!==Re&&(Fe(e),Be())}function ze(e,t,r,n){for(var i=0,o=e.length;i<o;i++){var s=e[i],a=s.object,l=s.geometry,c=void 0===n?s.material:n,u=s.group;if(r.isArrayCamera){se=r;for(var h=r.cameras,d=0,p=h.length;d<p;d++){var f=h[d];if(a.layers.test(f.layers)){var m=f.bounds,v=m.x*he,g=m.y*de,y=m.z*he,x=m.w*de;_.viewport(ae.set(v,g,y,x).multiplyScalar(pe)),Ve(a,t,f,l,c,u)}}}else se=null,Ve(a,t,r,l,c,u)}}function Ve(e,t,r,n,i,o){if(e.onBeforeRender(H,t,r,n,i,o),m=k.get(t,se||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var s=e.isMesh&&e.matrixWorld.determinant()<0;_.setMaterial(i,s);var a=He(r,t.fog,i,e);ie="",function(e,t,r){e.render(function(e){H.renderBufferImmediate(e,t,r)})}(e,a,i)}else H.renderBufferDirect(r,t.fog,n,i,e,o);e.onAfterRender(H,t,r,n,i,o),m=k.get(t,se||r)}function Ge(e,t,r){var n=O.get(e),i=m.state.lights,o=m.state.shadowsArray,s=R.getParameters(e,i.state,o,t,ye.numPlanes,ye.numIntersection,r),a=R.getProgramCode(e,s),l=n.program,c=!0;if(void 0===l)e.addEventListener("dispose",Le);else if(l.code!==a)Ie(e);else if(n.lightsHash!==i.state.hash)O.update(e,"lightsHash",i.state.hash),c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var u=rr[s.shaderID];n.shader={name:e.type,uniforms:Kt.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader,H),l=R.acquireProgram(e,n.shader,s,a),n.program=l,e.program=l}var h=l.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var d=0;d<H.maxMorphTargets;d++)h["morphTarget"+d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(d=0;d<H.maxMorphNormals;d++)h["morphNormal"+d]>=0&&e.numSupportedMorphNormals++}var p=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=ye.numPlanes,n.numIntersection=ye.numIntersection,p.clippingPlanes=ye.uniform),n.fog=t,n.lightsHash=i.state.hash,e.lights&&(p.ambientLightColor.value=i.state.ambient,p.directionalLights.value=i.state.directional,p.spotLights.value=i.state.spot,p.rectAreaLights.value=i.state.rectArea,p.pointLights.value=i.state.point,p.hemisphereLights.value=i.state.hemi,p.directionalShadowMap.value=i.state.directionalShadowMap,p.directionalShadowMatrix.value=i.state.directionalShadowMatrix,p.spotShadowMap.value=i.state.spotShadowMap,p.spotShadowMatrix.value=i.state.spotShadowMatrix,p.pointShadowMap.value=i.state.pointShadowMap,p.pointShadowMatrix.value=i.state.pointShadowMatrix);var f=n.program.getUniforms(),v=An.seqWithValue(f.seq,p);n.uniformsList=v}function He(e,t,r,n){ue=0;var i=O.get(r),o=m.state.lights;if(xe&&(be||e!==oe)){var s=e===oe&&r.id===re;ye.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,s)}!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:r.lights&&i.lightsHash!==o.state.hash?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===ye.numPlanes&&i.numIntersection===ye.numIntersection||(r.needsUpdate=!0)),r.needsUpdate&&(Ge(r,t,n),r.needsUpdate=!1);var a=!1,l=!1,c=!1,u=i.program,h=u.getUniforms(),d=i.shader.uniforms;if(_.useProgram(u.program)&&(a=!0,l=!0,c=!0),r.id!==re&&(re=r.id,l=!0),a||e!==oe){if(h.setValue(y,"projectionMatrix",e.projectionMatrix),w.logarithmicDepthBuffer&&h.setValue(y,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),oe!==(se||e)&&(oe=se||e,l=!0,c=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var p=h.map.cameraPosition;void 0!==p&&p.setValue(y,_e.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&h.setValue(y,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){h.setOptional(y,n,"bindMatrix"),h.setOptional(y,n,"bindMatrixInverse");var f=n.skeleton;if(f){var v=f.bones;if(w.floatVertexTextures){if(void 0===f.boneTexture){var g=Math.sqrt(4*v.length);g=Rt.ceilPowerOfTwo(g),g=Math.max(g,4);var x=new Float32Array(g*g*4);x.set(f.boneMatrices);var b=new Xt(x,g,g,Ue,Oe);b.needsUpdate=!0,f.boneMatrices=x,f.boneTexture=b,f.boneTextureSize=g}h.setValue(y,"boneTexture",f.boneTexture),h.setValue(y,"boneTextureSize",f.boneTextureSize)}else h.setOptional(y,f,"boneMatrices")}}return l&&(h.setValue(y,"toneMappingExposure",H.toneMappingExposure),h.setValue(y,"toneMappingWhitePoint",H.toneMappingWhitePoint),r.lights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(d,c),t&&r.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(d,t),r.isMeshBasicMaterial?We(d,r):r.isMeshLambertMaterial?(We(d,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(d,r)):r.isMeshPhongMaterial?(We(d,r),r.isMeshToonMaterial?function(e,t){Xe(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(d,r):Xe(d,r)):r.isMeshStandardMaterial?(We(d,r),r.isMeshPhysicalMaterial?function(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,qe(e,t)}(d,r):qe(d,r)):r.isMeshDepthMaterial?(We(d,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(d,r)):r.isMeshDistanceMaterial?(We(d,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(d,r)):r.isMeshNormalMaterial?(We(d,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(d,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(d,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(d,r)):r.isPointsMaterial?function(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*pe,e.scale.value=.5*de,e.map.value=t.map,null!==t.map){if(!0===t.map.matrixAutoUpdate){var r=t.map.offset,n=t.map.repeat,i=t.map.rotation,o=t.map.center;t.map.matrix.setUvTransform(r.x,r.y,n.x,n.y,i,o.x,o.y)}e.uvTransform.value.copy(t.map.matrix)}}(d,r):r.isShadowMaterial&&(d.color.value=r.color,d.opacity.value=r.opacity),void 0!==d.ltc_1&&(d.ltc_1.value=tr.LTC_1),void 0!==d.ltc_2&&(d.ltc_2.value=tr.LTC_2),An.upload(y,i.uniformsList,d,H)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(An.upload(y,i.uniformsList,d,H),r.uniformsNeedUpdate=!1),h.setValue(y,"modelViewMatrix",n.modelViewMatrix),h.setValue(y,"normalMatrix",n.normalMatrix),h.setValue(y,"modelMatrix",n.matrixWorld),u}function We(e,t){var r;if(e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=O.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r){if(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate){var n=r.offset,i=r.repeat,o=r.rotation,s=r.center;r.matrix.setUvTransform(n.x,n.y,i.x,i.y,o,s.x,s.y)}e.uvTransform.value.copy(r.matrix)}}function Xe(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function qe(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}this.animate=function(e){null!==(Fe=e)?Re||(Be(),Re=!0):ke()},this.render=function(e,t,r,n){if(t&&t.isCamera){if(!$){ie="",re=-1,oe=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Ee.enabled&&(t=Ee.getCamera(t)),(m=k.get(e,t)).init(),e.onBeforeRender(H,e,t,r),we.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ge.setFromMatrix(we),be=this.localClippingEnabled,xe=ye.init(this.clippingPlanes,be,t),(f=F.get(e,t)).init(),function e(t,r,n){if(!1===t.visible)return;var i=t.layers.test(r.layers);if(i)if(t.isLight)m.pushLight(t),t.castShadow&&m.pushShadow(t);else if(t.isSprite)t.frustumCulled&&!ge.intersectsSprite(t)||m.pushSprite(t);else if(t.isImmediateRenderObject)n&&_e.setFromMatrixPosition(t.matrixWorld).applyMatrix4(we),f.push(t,null,t.material,_e.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||ge.intersectsObject(t))){n&&_e.setFromMatrixPosition(t.matrixWorld).applyMatrix4(we);var o=I.update(t),s=t.material;if(Array.isArray(s))for(var a=o.groups,l=0,c=a.length;l<c;l++){var u=a[l],h=s[u.materialIndex];h&&h.visible&&f.push(t,o,h,_e.z,u)}else s.visible&&f.push(t,o,s,_e.z,null)}var d=t.children;for(var l=0,c=d.length;l<c;l++)e(d[l],r,n)}(e,t,H.sortObjects),!0===H.sortObjects&&f.sort(),xe&&ye.beginShadows();var i=m.state.shadowsArray;Ce.render(i,e,t),m.setupLights(t),xe&&ye.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),U.render(f,e,t,n);var o=f.opaque,s=f.transparent;if(e.overrideMaterial){var a=e.overrideMaterial;o.length&&ze(o,e,t,a),s.length&&ze(s,e,t,a)}else o.length&&ze(o,e,t),s.length&&ze(s,e,t);var l=m.state.spritesArray;V.render(l,e,t),r&&D.updateRenderTargetMipmap(r),_.buffers.depth.setTest(!0),_.buffers.depth.setMask(!0),_.buffers.color.setMask(!0),_.setPolygonOffset(!1),e.onAfterRender(H,e,t),Ee.enabled&&Ee.submitFrame(),f=null,m=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=ue;return e>=w.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+w.maxTextures),ue+=1,e},this.setTexture2D=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),D.setTexture2D(t,r)}}(),this.setTexture=function(){var e=!1;return function(t,r){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),D.setTexture2D(t,r)}}(),this.setTextureCube=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?D.setTextureCube(t,r):D.setTextureCubeDynamic(t,r)}}(),this.getRenderTarget=function(){return ee},this.setRenderTarget=function(e){ee=e,e&&void 0===O.get(e).__webglFramebuffer&&D.setupRenderTarget(e);var t=null,r=!1;if(e){var n=O.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=n[e.activeCubeFace],r=!0):t=n,ae.copy(e.viewport),le.copy(e.scissor),ce=e.scissorTest}else ae.copy(fe).multiplyScalar(pe),le.copy(me).multiplyScalar(pe),ce=ve;if(te!==t&&(y.bindFramebuffer(y.FRAMEBUFFER,t),te=t),_.viewport(ae),_.scissor(le),_.setScissorTest(ce),r){var i=O.get(e.texture);y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,r,n,i,o){if(e&&e.isWebGLRenderTarget){var s=O.get(e).__webglFramebuffer;if(s){var a=!1;s!==te&&(y.bindFramebuffer(y.FRAMEBUFFER,s),a=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==Ue&&G.convert(c)!==y.getParameter(y.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===Te||G.convert(u)===y.getParameter(y.IMPLEMENTATION_COLOR_READ_TYPE)||u===Oe&&(x.get("OES_texture_float")||x.get("WEBGL_color_buffer_float"))||u===De&&x.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");y.checkFramebufferStatus(y.FRAMEBUFFER)===y.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&y.readPixels(t,r,n,i,G.convert(c),G.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&y.bindFramebuffer(y.FRAMEBUFFER,te)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var n=t.image.width,i=t.image.height,o=G.convert(t.format);this.setTexture2D(t,0),y.copyTexImage2D(y.TEXTURE_2D,r||0,o,e.x,e.y,n,i,0)},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,o=t.image.height,s=G.convert(r.format),a=G.convert(r.type),l=t.isDataTexture?t.image.data:t.image;this.setTexture2D(r,0),y.texSubImage2D(y.TEXTURE_2D,n||0,e.x,e.y,i,o,s,a,l)}}function ti(e,t){this.name="",this.color=new er(e),this.density=void 0!==t?t:25e-5}function ri(e,t,r){this.name="",this.color=new er(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function ni(){ar.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function ii(e){Nr.call(this),this.type="SpriteMaterial",this.color=new er(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function oi(e){ar.call(this),this.type="Sprite",this.material=void 0!==e?e:new ii,this.center=new Ft(.5,.5)}function si(){ar.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function ai(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new kt)}}function li(){ar.call(this),this.type="Bone"}function ci(e,t){Ur.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new kt,this.bindMatrixInverse=new kt;var r=new ai(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}function ui(e){Nr.call(this),this.type="LineBasicMaterial",this.color=new er(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function hi(e,t,r){if(1===r)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new di(e,t);ar.call(this),this.type="Line",this.geometry=void 0!==e?e:new Ar,this.material=void 0!==t?t:new ui({color:16777215*Math.random()})}function di(e,t){hi.call(this,e,t),this.type="LineSegments"}function pi(e,t){hi.call(this,e,t),this.type="LineLoop"}function fi(e){Nr.call(this),this.type="PointsMaterial",this.color=new er(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function mi(e,t){ar.call(this),this.type="Points",this.geometry=void 0!==e?e:new Ar,this.material=void 0!==t?t:new fi({color:16777215*Math.random()})}function vi(){ar.call(this),this.type="Group"}function gi(e,t,r,n,i,o,s,a,l){Vt.call(this,e,t,r,n,i,o,s,a,l),this.generateMipmaps=!1}function yi(e,t,r,n,i,o,s,a,l,c,u,h){Vt.call(this,null,o,s,a,l,c,n,i,u,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function xi(e,t,r,n,i,o,s,a,l,c){if((c=void 0!==c?c:Ve)!==Ve&&c!==Ge)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===Ve&&(r=Ee),void 0===r&&c===Ge&&(r=Re),Vt.call(this,null,n,i,o,s,a,c,r,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:ye,this.minFilter=void 0!==a?a:ye,this.flipY=!1,this.generateMipmaps=!1}function bi(e){Ar.call(this),this.type="WireframeGeometry";var t,r,n,i,o,s,a,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var v=m[t];for(r=0;r<3;r++)a=v[f[r]],l=v[f[(r+1)%3]],d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)s=p[c],u=e.vertices[s.index1],h.push(u.x,u.y,u.z),u=e.vertices[s.index2],h.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var g,y,x,b,w,_,S;if(u=new Bt,null!==e.index){for(g=e.attributes.position,y=e.index,0===(x=e.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(t=w=(b=x[i]).start,n=w+b.count;t<n;t+=3)for(r=0;r<3;r++)a=y.getX(t+r),l=y.getX(t+(r+1)%3),d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)s=p[c],u.fromBufferAttribute(g,s.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,s.index2),h.push(u.x,u.y,u.z)}else for(t=0,n=(g=e.attributes.position).count/3;t<n;t++)for(r=0;r<3;r++)_=3*t+r,u.fromBufferAttribute(g,_),h.push(u.x,u.y,u.z),S=3*t+(r+1)%3,u.fromBufferAttribute(g,S),h.push(u.x,u.y,u.z)}this.addAttribute("position",new wr(h,3))}function wi(e,t,r){dr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new _i(e,t,r)),this.mergeVertices()}function _i(e,t,r){Ar.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,o=[],s=[],a=[],l=[],c=new Bt,u=new Bt,h=new Bt,d=new Bt,p=new Bt,f=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var v=i/t;e(v,m,u),s.push(u.x,u.y,u.z),v-1e-5>=0?(e(v-1e-5,m,h),d.subVectors(u,h)):(e(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(e(v,m-1e-5,h),p.subVectors(u,h)):(e(v,m+1e-5,h),p.subVectors(h,u)),c.crossVectors(d,p).normalize(),a.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var g=n*f+i,y=n*f+i+1,x=(n+1)*f+i+1,b=(n+1)*f+i;o.push(g,y,b),o.push(y,x,b)}this.setIndex(o),this.addAttribute("position",new wr(s,3)),this.addAttribute("normal",new wr(a,3)),this.addAttribute("uv",new wr(l,2))}function Si(e,t,r,n){dr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new Ti(e,t,r,n)),this.mergeVertices()}function Ti(e,t,r,n){Ar.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],o=[];function s(e,t,r,n){var i,o,s=Math.pow(2,n),l=[];for(i=0;i<=s;i++){l[i]=[];var c=e.clone().lerp(r,i/s),u=t.clone().lerp(r,i/s),h=s-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===s?c:c.clone().lerp(u,o/h)}for(i=0;i<s;i++)for(o=0;o<2*(s-i)-1;o++){var d=Math.floor(o/2);o%2==0?(a(l[i][d+1]),a(l[i+1][d]),a(l[i][d])):(a(l[i][d+1]),a(l[i+1][d+1]),a(l[i+1][d]))}}function a(e){i.push(e.x,e.y,e.z)}function l(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function c(e,t,r,n){n<0&&1===e.x&&(o[t]=e.x-1),0===r.x&&0===r.z&&(o[t]=n/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){for(var r=new Bt,n=new Bt,i=new Bt,o=0;o<t.length;o+=3)l(t[o+0],r),l(t[o+1],n),l(t[o+2],i),s(r,n,i,e)}(n=n||0),function(e){for(var t=new Bt,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){for(var e=new Bt,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=u(e)/2/Math.PI+.5,n=h(e)/Math.PI+.5;o.push(r,1-n)}(function(){for(var e=new Bt,t=new Bt,r=new Bt,n=new Bt,s=new Ft,a=new Ft,l=new Ft,h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),n.copy(e).add(t).add(r).divideScalar(3);var p=u(n);c(s,d+0,e,p),c(a,d+2,t,p),c(l,d+4,r,p)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],r=o[e+2],n=o[e+4],i=Math.max(t,r,n),s=Math.min(t,r,n);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),r<.2&&(o[e+2]+=1),n<.2&&(o[e+4]+=1))}}()}(),this.addAttribute("position",new wr(i,3)),this.addAttribute("normal",new wr(i.slice(),3)),this.addAttribute("uv",new wr(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Mi(e,t){dr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ai(e,t)),this.mergeVertices()}function Ai(e,t){Ti.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ei(e,t){dr.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ci(e,t)),this.mergeVertices()}function Ci(e,t){Ti.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Pi(e,t){dr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Oi(e,t)),this.mergeVertices()}function Oi(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Ti.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Di(e,t){dr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ni(e,t)),this.mergeVertices()}function Ni(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];Ti.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Li(e,t,r,n,i,o){dr.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new Ii(e,t,r,n,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Ii(e,t,r,n,i){Ar.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var s,a,l=new Bt,c=new Bt,u=new Ft,h=new Bt,d=[],p=[],f=[],m=[];function v(i){h=e.getPointAt(i/t,h);var s=o.normals[i],u=o.binormals[i];for(a=0;a<=n;a++){var f=a/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*s.x+m*u.x,c.y=v*s.y+m*u.y,c.z=v*s.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(s=0;s<t;s++)v(s);v(!1===i?t:0),function(){for(s=0;s<=t;s++)for(a=0;a<=n;a++)u.x=s/t,u.y=a/n,f.push(u.x,u.y)}(),function(){for(a=1;a<=t;a++)for(s=1;s<=n;s++){var e=(n+1)*(a-1)+(s-1),r=(n+1)*a+(s-1),i=(n+1)*a+s,o=(n+1)*(a-1)+s;m.push(e,r,o),m.push(r,i,o)}}()}(),this.setIndex(m),this.addAttribute("position",new wr(d,3)),this.addAttribute("normal",new wr(p,3)),this.addAttribute("uv",new wr(f,2))}function Ri(e,t,r,n,i,o,s){dr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Fi(e,t,r,n,i,o)),this.mergeVertices()}function Fi(e,t,r,n,i,o){Ar.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var s,a,l=[],c=[],u=[],h=[],d=new Bt,p=new Bt,f=new Bt,m=new Bt,v=new Bt,g=new Bt,y=new Bt;for(s=0;s<=r;++s){var x=s/r*i*Math.PI*2;for(E(x,i,o,e,f),E(x+.01,i,o,e,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),a=0;a<=n;++a){var b=a/n*Math.PI*2,w=-t*Math.cos(b),_=t*Math.sin(b);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(s/r),h.push(a/n)}}for(a=1;a<=r;a++)for(s=1;s<=n;s++){var S=(n+1)*(a-1)+(s-1),T=(n+1)*a+(s-1),M=(n+1)*a+s,A=(n+1)*(a-1)+s;l.push(S,T,A),l.push(T,M,A)}function E(e,t,r,n,i){var o=Math.cos(e),s=Math.sin(e),a=r/t*e,l=Math.cos(a);i.x=n*(2+l)*.5*o,i.y=n*(2+l)*s*.5,i.z=n*Math.sin(a)*.5}this.setIndex(l),this.addAttribute("position",new wr(c,3)),this.addAttribute("normal",new wr(u,3)),this.addAttribute("uv",new wr(h,2))}function ki(e,t,r,n,i){dr.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new Ui(e,t,r,n,i)),this.mergeVertices()}function Ui(e,t,r,n,i){Ar.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,s,a=[],l=[],c=[],u=[],h=new Bt,d=new Bt,p=new Bt;for(o=0;o<=r;o++)for(s=0;s<=n;s++){var f=s/n*i,m=o/r*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(f),d.y=(e+t*Math.cos(m))*Math.sin(f),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(s/n),u.push(o/r)}for(o=1;o<=r;o++)for(s=1;s<=n;s++){var v=(n+1)*o+s-1,g=(n+1)*(o-1)+s-1,y=(n+1)*(o-1)+s,x=(n+1)*o+s;a.push(v,g,x),a.push(g,y,x)}this.setIndex(a),this.addAttribute("position",new wr(l,3)),this.addAttribute("normal",new wr(c,3)),this.addAttribute("uv",new wr(u,2))}Hn.prototype=Object.create(Nr.prototype),Hn.prototype.constructor=Hn,Hn.prototype.isMeshDepthMaterial=!0,Hn.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Wn.prototype=Object.create(Nr.prototype),Wn.prototype.constructor=Wn,Wn.prototype.isMeshDistanceMaterial=!0,Wn.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},qn.prototype=Object.create(Vt.prototype),qn.prototype.constructor=qn,Qn.prototype=Object.assign(Object.create(lr.prototype),{constructor:Qn,isPerspectiveCamera:!0,copy:function(e,t){return lr.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Rt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Rt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Rt.RAD2DEG*Math.atan(Math.tan(.5*Rt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Rt.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,a=o.fullHeight;i+=o.offsetX*n/s,t-=o.offsetY*r/a,n*=o.width/s,r*=o.height/a}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far)},toJSON:function(e){var t=ar.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Kn.prototype=Object.assign(Object.create(Qn.prototype),{constructor:Kn,isArrayCamera:!0}),ti.prototype.isFogExp2=!0,ti.prototype.clone=function(){return new ti(this.color.getHex(),this.density)},ti.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},ri.prototype.isFog=!0,ri.prototype.clone=function(){return new ri(this.color.getHex(),this.near,this.far)},ri.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},ni.prototype=Object.assign(Object.create(ar.prototype),{constructor:ni,copy:function(e,t){return ar.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=ar.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),ii.prototype=Object.create(Nr.prototype),ii.prototype.constructor=ii,ii.prototype.isSpriteMaterial=!0,ii.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},oi.prototype=Object.assign(Object.create(ar.prototype),{constructor:oi,isSprite:!0,raycast:function(){var e=new Bt,t=new Bt,r=new Bt;return function(n,i){t.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(t,e),r.setFromMatrixScale(this.matrixWorld);var o=r.x*r.y/4;if(!(t.distanceToSquared(e)>o)){var s=n.ray.origin.distanceTo(e);s<n.near||s>n.far||i.push({distance:s,point:e.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return ar.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),si.prototype=Object.assign(Object.create(ar.prototype),{constructor:si,copy:function(e){ar.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);r.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new Bt;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,r)}}(),update:function(){var e=new Bt,t=new Bt;return function(r){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);n[0].object.visible=!0;for(var o=1,s=n.length;o<s&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<s;o++)n[o].object.visible=!1}}}(),toJSON:function(e){var t=ar.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Object.assign(ai.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new kt;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new kt,t=new kt;return function(){for(var r=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture,s=0,a=r.length;s<a;s++){var l=r[s]?r[s].matrixWorld:t;e.multiplyMatrices(l,n[s]),e.toArray(i,16*s)}void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new ai(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),li.prototype=Object.assign(Object.create(ar.prototype),{constructor:li,isBone:!0}),ci.prototype=Object.assign(Object.create(Ur.prototype),{constructor:ci,isSkinnedMesh:!0,initBones:function(){var e,t,r,n,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(r=0,n=this.geometry.bones.length;r<n;r++)t=this.geometry.bones[r],e=new li,i.push(e),e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);for(r=0,n=this.geometry.bones.length;r<n;r++)-1!==(t=this.geometry.bones[r]).parent&&null!==t.parent&&void 0!==i[t.parent]?i[t.parent].add(i[r]):this.add(i[r])}return this.updateMatrixWorld(!0),i},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var r=this.geometry.skinWeights[t];(e=1/r.manhattanLength())!==1/0?r.multiplyScalar(e):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new Gt,i=this.geometry.attributes.skinWeight;for(t=0;t<i.count;t++)n.x=i.getX(t),n.y=i.getY(t),n.z=i.getZ(t),n.w=i.getW(t),(e=1/n.manhattanLength())!==1/0?n.multiplyScalar(e):n.set(1,0,0,0),i.setXYZW(t,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(e){Ur.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ui.prototype=Object.create(Nr.prototype),ui.prototype.constructor=ui,ui.prototype.isLineBasicMaterial=!0,ui.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},hi.prototype=Object.assign(Object.create(ar.prototype),{constructor:hi,isLine:!0,computeLineDistances:function(){var e=new Bt,t=new Bt;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[0],o=1,s=n.count;o<s;o++)e.fromBufferAttribute(n,o-1),t.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=e.distanceTo(t);r.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;(i=r.lineDistances)[0]=0;for(o=1,s=a.length;o<s;o++)i[o]=i[o-1],i[o]+=a[o-1].distanceTo(a[o])}return this}}(),raycast:function(){var e=new kt,t=new Rr,r=new Yt;return function(n,i){var o=n.linePrecision,s=o*o,a=this.geometry,l=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)){e.getInverse(l),t.copy(n.ray).applyMatrix4(e);var c=new Bt,u=new Bt,h=new Bt,d=new Bt,p=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var f=a.index,m=a.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=p){var x=v[g],b=v[g+1];if(c.fromArray(m,3*x),u.fromArray(m,3*b),!(t.distanceSqToSegment(c,u,d,h)>s))d.applyMatrix4(this.matrixWorld),(S=n.ray.origin.distanceTo(d))<n.near||S>n.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}else for(g=0,y=m.length/3-1;g<y;g+=p){if(c.fromArray(m,3*g),u.fromArray(m,3*g+3),!(t.distanceSqToSegment(c,u,d,h)>s))d.applyMatrix4(this.matrixWorld),(S=n.ray.origin.distanceTo(d))<n.near||S>n.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}else if(a.isGeometry){var w=a.vertices,_=w.length;for(g=0;g<_-1;g+=p){var S;if(!(t.distanceSqToSegment(w[g],w[g+1],d,h)>s))d.applyMatrix4(this.matrixWorld),(S=n.ray.origin.distanceTo(d))<n.near||S>n.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),di.prototype=Object.assign(Object.create(hi.prototype),{constructor:di,isLineSegments:!0,computeLineDistances:function(){var e=new Bt,t=new Bt;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],o=0,s=n.count;o<s;o+=2)e.fromBufferAttribute(n,o),t.fromBufferAttribute(n,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t);r.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;for(i=r.lineDistances,o=0,s=a.length;o<s;o+=2)e.copy(a[o]),t.copy(a[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t)}return this}}()}),pi.prototype=Object.assign(Object.create(hi.prototype),{constructor:pi,isLineLoop:!0}),fi.prototype=Object.create(Nr.prototype),fi.prototype.constructor=fi,fi.prototype.isPointsMaterial=!0,fi.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},mi.prototype=Object.assign(Object.create(ar.prototype),{constructor:mi,isPoints:!0,raycast:function(){var e=new kt,t=new Rr,r=new Yt;return function(n,i){var o=this,s=this.geometry,a=this.matrixWorld,l=n.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(a),r.radius+=l,!1!==n.ray.intersectsSphere(r)){e.getInverse(a),t.copy(n.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Bt,d=new Bt;if(s.isBufferGeometry){var p=s.index,f=s.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var x=f.length/3;v<x;v++)h.fromArray(f,3*v),w(h,v)}}else{var b=s.vertices;for(v=0,x=b.length;v<x;v++)w(b[v],v)}}function w(e,r){var s=t.distanceSqToPoint(e);if(s<u){t.closestPointToPoint(e,d),d.applyMatrix4(a);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(s),point:d.clone(),index:r,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),vi.prototype=Object.assign(Object.create(ar.prototype),{constructor:vi,isGroup:!0}),gi.prototype=Object.assign(Object.create(Vt.prototype),{constructor:gi,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),yi.prototype=Object.create(Vt.prototype),yi.prototype.constructor=yi,yi.prototype.isCompressedTexture=!0,xi.prototype=Object.create(Vt.prototype),xi.prototype.constructor=xi,xi.prototype.isDepthTexture=!0,bi.prototype=Object.create(Ar.prototype),bi.prototype.constructor=bi,wi.prototype=Object.create(dr.prototype),wi.prototype.constructor=wi,_i.prototype=Object.create(Ar.prototype),_i.prototype.constructor=_i,Si.prototype=Object.create(dr.prototype),Si.prototype.constructor=Si,Ti.prototype=Object.create(Ar.prototype),Ti.prototype.constructor=Ti,Mi.prototype=Object.create(dr.prototype),Mi.prototype.constructor=Mi,Ai.prototype=Object.create(Ti.prototype),Ai.prototype.constructor=Ai,Ei.prototype=Object.create(dr.prototype),Ei.prototype.constructor=Ei,Ci.prototype=Object.create(Ti.prototype),Ci.prototype.constructor=Ci,Pi.prototype=Object.create(dr.prototype),Pi.prototype.constructor=Pi,Oi.prototype=Object.create(Ti.prototype),Oi.prototype.constructor=Oi,Di.prototype=Object.create(dr.prototype),Di.prototype.constructor=Di,Ni.prototype=Object.create(Ti.prototype),Ni.prototype.constructor=Ni,Li.prototype=Object.create(dr.prototype),Li.prototype.constructor=Li,Ii.prototype=Object.create(Ar.prototype),Ii.prototype.constructor=Ii,Ri.prototype=Object.create(dr.prototype),Ri.prototype.constructor=Ri,Fi.prototype=Object.create(Ar.prototype),Fi.prototype.constructor=Fi,ki.prototype=Object.create(dr.prototype),ki.prototype.constructor=ki,Ui.prototype=Object.create(Ar.prototype),Ui.prototype.constructor=Ui;var Bi=function(e,t,r){r=r||2;var n,i,o,s,a,l,c,u=t&&t.length,h=u?t[0]*r:e.length,d=ji(e,0,h,r,!0),p=[];if(!d)return p;if(u&&(d=function(e,t,r,n){var i,o,s,a,l,c=[];for(i=0,o=t.length;i<o;i++)s=t[i]*n,a=i<o-1?t[i+1]*n:e.length,(l=ji(e,s,a,n,!1))===l.next&&(l.steiner=!0),c.push(Zi(l));for(c.sort(qi),i=0;i<c.length;i++)Yi(c[i],r),r=zi(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=o=e[0],i=s=e[1];for(var f=r;f<h;f+=r)a=e[f],l=e[f+1],a<n&&(n=a),l<i&&(i=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-i))?1/c:0}return Vi(d,p,r,n,i,c),p};function ji(e,t,r,n,i){var o,s;if(i===function(e,t,r,n){for(var i=0,o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,r,n)>0)for(o=t;o<r;o+=n)s=io(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=io(o,e[o],e[o+1],s);return s&&eo(s,s.next)&&(oo(s),s=s.next),s}function zi(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!eo(n,n.next)&&0!==$i(n.prev,n,n.next))n=n.next;else{if(oo(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function Vi(e,t,r,n,i,o,s){if(e){!s&&o&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=Ji(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,s,a,l,c=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(s>1)}(i)}(e,n,i,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Hi(e,n,i,o):Gi(e))t.push(a.i/r),t.push(e.i/r),t.push(l.i/r),oo(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Vi(e=Wi(e,t,r),t,r,n,i,o,2):2===s&&Xi(e,t,r,n,i,o):Vi(zi(e),t,r,n,i,o,1);break}}}function Gi(e){var t=e.prev,r=e,n=e.next;if($i(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Qi(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&$i(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Hi(e,t,r,n){var i=e.prev,o=e,s=e.next;if($i(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=Ji(a,l,t,r,n),d=Ji(c,u,t,r,n),p=e.nextZ;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&Qi(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&$i(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=e.prevZ;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Qi(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&$i(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function Wi(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!eo(i,o)&&to(i,n,n.next,o)&&ro(i,o)&&ro(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),oo(n),oo(n.next),n=e=o),n=n.next}while(n!==e);return n}function Xi(e,t,r,n,i,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Ki(s,a)){var l=no(s,a);return s=zi(s,s.next),l=zi(l,l.next),Vi(s,t,r,n,i,o),void Vi(l,t,r,n,i,o)}a=a.next}s=s.next}while(s!==e)}function qi(e,t){return e.x-t.x}function Yi(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;n=r.next;for(;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&Qi(o<h?i:s,o,u,h,o<h?s:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&ro(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=no(t,e);zi(r,r.next)}}function Ji(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Zi(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function Qi(e,t,r,n,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function Ki(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&to(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&ro(e,t)&&ro(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function $i(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function eo(e,t){return e.x===t.x&&e.y===t.y}function to(e,t,r,n){return!!(eo(e,t)&&eo(r,n)||eo(e,n)&&eo(r,t))||$i(e,t,r)>0!=$i(e,t,n)>0&&$i(r,n,e)>0!=$i(r,n,t)>0}function ro(e,t){return $i(e.prev,e,e.next)<0?$i(e,t,e.next)>=0&&$i(e,e.prev,t)>=0:$i(e,t,e.prev)<0||$i(e,e.next,t)<0}function no(e,t){var r=new so(e.i,e.x,e.y),n=new so(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function io(e,t,r,n){var i=new so(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function oo(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function so(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ao={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return ao.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];lo(e),co(r,e);var o=e.length;t.forEach(lo);for(var s=0;s<t.length;s++)n.push(o),o+=t[s].length,co(r,t[s]);var a=Bi(r,n);for(s=0;s<a.length;s+=3)i.push(a.slice(s,s+3));return i}};function lo(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function co(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function uo(e,t){dr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ho(e,t)),this.mergeVertices()}function ho(e,t){void 0!==e&&(Ar.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function po(e,t){dr.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new fo(e,t)),this.mergeVertices()}function fo(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new dr;var n=r.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ho.call(this,n,t),this.type="TextBufferGeometry"}function mo(e,t,r,n,i,o,s){dr.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new vo(e,t,r,n,i,o,s)),this.mergeVertices()}function vo(e,t,r,n,i,o,s){Ar.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var a,l,c=(o=void 0!==o?o:0)+(s=void 0!==s?s:Math.PI),u=0,h=[],d=new Bt,p=new Bt,f=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],x=l/r;for(a=0;a<=t;a++){var b=a/t;d.x=-e*Math.cos(n+b*i)*Math.sin(o+x*s),d.y=e*Math.cos(o+x*s),d.z=e*Math.sin(n+b*i)*Math.sin(o+x*s),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(b,1-x),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(a=0;a<t;a++){var w=h[l][a+1],_=h[l][a],S=h[l+1][a],T=h[l+1][a+1];(0!==l||o>0)&&f.push(w,_,T),(l!==r-1||c<Math.PI)&&f.push(_,S,T)}this.setIndex(f),this.addAttribute("position",new wr(m,3)),this.addAttribute("normal",new wr(v,3)),this.addAttribute("uv",new wr(g,2))}function go(e,t,r,n,i,o){dr.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new yo(e,t,r,n,i,o)),this.mergeVertices()}function yo(e,t,r,n,i,o){Ar.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var s,a,l,c=[],u=[],h=[],d=[],p=e,f=(t-e)/(n=void 0!==n?Math.max(1,n):1),m=new Bt,v=new Ft;for(a=0;a<=n;a++){for(l=0;l<=r;l++)s=i+l/r*o,m.x=p*Math.cos(s),m.y=p*Math.sin(s),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);p+=f}for(a=0;a<n;a++){var g=a*(r+1);for(l=0;l<r;l++){var y=s=l+g,x=s+r+1,b=s+r+2,w=s+1;c.push(y,x,w),c.push(x,b,w)}}this.setIndex(c),this.addAttribute("position",new wr(u,3)),this.addAttribute("normal",new wr(h,3)),this.addAttribute("uv",new wr(d,2))}function xo(e,t,r,n){dr.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new bo(e,t,r,n)),this.mergeVertices()}function bo(e,t,r,n){Ar.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=Rt.clamp(n,0,2*Math.PI);var i,o,s,a=[],l=[],c=[],u=1/t,h=new Bt,d=new Ft;for(o=0;o<=t;o++){var p=r+o*u*n,f=Math.sin(p),m=Math.cos(p);for(s=0;s<=e.length-1;s++)h.x=e[s].x*f,h.y=e[s].y,h.z=e[s].x*m,l.push(h.x,h.y,h.z),d.x=o/t,d.y=s/(e.length-1),c.push(d.x,d.y)}for(o=0;o<t;o++)for(s=0;s<e.length-1;s++){var v=i=s+o*e.length,g=i+e.length,y=i+e.length+1,x=i+1;a.push(v,g,x),a.push(g,y,x)}if(this.setIndex(a),this.addAttribute("position",new wr(l,3)),this.addAttribute("uv",new wr(c,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,w=new Bt,_=new Bt,S=new Bt;for(i=t*e.length*3,o=0,s=0;o<e.length;o++,s+=3)w.x=b[s+0],w.y=b[s+1],w.z=b[s+2],_.x=b[i+s+0],_.y=b[i+s+1],_.z=b[i+s+2],S.addVectors(w,_).normalize(),b[s+0]=b[i+s+0]=S.x,b[s+1]=b[i+s+1]=S.y,b[s+2]=b[i+s+2]=S.z}}function wo(e,t){dr.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new _o(e,t)),this.mergeVertices()}function _o(e,t){Ar.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],o=[],s=0,a=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),this.addGroup(s,a,l),s+=a,a=0;function c(e){var s,l,c,u=n.length/3,h=e.extractPoints(t),d=h.shape,p=h.holes;if(!1===ao.isClockWise(d))for(d=d.reverse(),s=0,l=p.length;s<l;s++)c=p[s],!0===ao.isClockWise(c)&&(p[s]=c.reverse());var f=ao.triangulateShape(d,p);for(s=0,l=p.length;s<l;s++)c=p[s],d=d.concat(c);for(s=0,l=d.length;s<l;s++){var m=d[s];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(s=0,l=f.length;s<l;s++){var v=f[s],g=v[0]+u,y=v[1]+u,x=v[2]+u;r.push(g,y,x),a+=3}}this.setIndex(r),this.addAttribute("position",new wr(n,3)),this.addAttribute("normal",new wr(i,3)),this.addAttribute("uv",new wr(o,2))}function So(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function To(e,t){Ar.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,o,s=[],a=Math.cos(Rt.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(o=new dr).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=a){var y=h[g.index1];s.push(y.x,y.y,y.z),y=h[g.index2],s.push(y.x,y.y,y.z)}}this.addAttribute("position",new wr(s,3))}function Mo(e,t,r,n,i,o,s,a){dr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new Ao(e,t,r,n,i,o,s,a)),this.mergeVertices()}function Ao(e,t,r,n,i,o,s,a){Ar.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var c=[],u=[],h=[],d=[],p=0,f=[],m=r/2,v=0;function g(r){var i,o,f,g=new Ft,y=new Bt,x=0,b=!0===r?e:t,w=!0===r?1:-1;for(o=p,i=1;i<=n;i++)u.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=n;i++){var _=i/n*a+s,S=Math.cos(_),T=Math.sin(_);y.x=b*T,y.y=m*w,y.z=b*S,u.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<n;i++){var M=o+i,A=f+i;!0===r?c.push(A,A+1,M):c.push(A+1,A,M),x+=3}l.addGroup(v,x,!0===r?1:2),v+=x}!function(){var o,g,y=new Bt,x=new Bt,b=0,w=(t-e)/r;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(t-e)+e;for(o=0;o<=n;o++){var M=o/n,A=M*a+s,E=Math.sin(A),C=Math.cos(A);x.x=T*E,x.y=-S*r+m,x.z=T*C,u.push(x.x,x.y,x.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<n;o++)for(g=0;g<i;g++){var P=f[g][o],O=f[g+1][o],D=f[g+1][o+1],N=f[g][o+1];c.push(P,O,N),c.push(O,D,N),b+=6}l.addGroup(v,b,0),v+=b}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.addAttribute("position",new wr(u,3)),this.addAttribute("normal",new wr(h,3)),this.addAttribute("uv",new wr(d,2))}function Eo(e,t,r,n,i,o,s){Mo.call(this,0,e,t,r,n,i,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function Co(e,t,r,n,i,o,s){Ao.call(this,0,e,t,r,n,i,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function Po(e,t,r,n){dr.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new Oo(e,t,r,n)),this.mergeVertices()}function Oo(e,t,r,n){Ar.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,s=[],a=[],l=[],c=[],u=new Bt,h=new Ft;for(a.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var d=r+o/t*n;u.x=e*Math.cos(d),u.y=e*Math.sin(d),a.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(a[i]/e+1)/2,h.y=(a[i+1]/e+1)/2,c.push(h.x,h.y)}for(i=1;i<=t;i++)s.push(i,i+1,0);this.setIndex(s),this.addAttribute("position",new wr(a,3)),this.addAttribute("normal",new wr(l,3)),this.addAttribute("uv",new wr(c,2))}uo.prototype=Object.create(dr.prototype),uo.prototype.constructor=uo,ho.prototype=Object.create(Ar.prototype),ho.prototype.constructor=ho,ho.prototype.getArrays=function(){var e=this.getAttribute("position"),t=e?Array.prototype.slice.call(e.array):[],r=this.getAttribute("uv"),n=r?Array.prototype.slice.call(r.array):[],i=this.index;return{position:t,uv:n,index:i?Array.prototype.slice.call(i.array):[]}},ho.prototype.addShapeList=function(e,t){var r=e.length;t.arrays=this.getArrays();for(var n=0;n<r;n++){var i=e[n];this.addShape(i,t)}this.setIndex(t.arrays.index),this.addAttribute("position",new wr(t.arrays.position,3)),this.addAttribute("uv",new wr(t.arrays.uv,2))},ho.prototype.addShape=function(e,t){var r,n,i,o,s,a,l,c,u=t.arrays?t.arrays:this.getArrays(),h=u.position,d=u.index,p=u.uv,f=[],m=void 0!==t.amount?t.amount:100,v=void 0!==t.bevelThickness?t.bevelThickness:6,g=void 0!==t.bevelSize?t.bevelSize:v-2,y=void 0!==t.bevelSegments?t.bevelSegments:3,x=void 0===t.bevelEnabled||t.bevelEnabled,b=void 0!==t.curveSegments?t.curveSegments:12,w=void 0!==t.steps?t.steps:1,_=t.extrudePath,S=!1,T=void 0!==t.UVGenerator?t.UVGenerator:uo.WorldUVGenerator;_&&(r=_.getSpacedPoints(w),S=!0,x=!1,n=void 0!==t.frames?t.frames:_.computeFrenetFrames(w,!1),i=new Bt,o=new Bt,s=new Bt),x||(y=0,v=0,g=0);var M=this,A=e.extractPoints(b),E=A.shape,C=A.holes;if(!ao.isClockWise(E))for(E=E.reverse(),l=0,c=C.length;l<c;l++)a=C[l],ao.isClockWise(a)&&(C[l]=a.reverse());var P=ao.triangulateShape(E,C),O=E;for(l=0,c=C.length;l<c;l++)a=C[l],E=E.concat(a);function D(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var N,L,I,R,F,k,U=E.length,B=P.length;function j(e,t,r){var n,i,o,s=e.x-t.x,a=e.y-t.y,l=r.x-e.x,c=r.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(u),p=Math.sqrt(l*l+c*c),f=t.x-a/d,m=t.y+s/d,v=((r.x-c/p-f)*c-(r.y+l/p-m)*l)/(s*c-a*l),g=(n=f+s*v-e.x)*n+(i=m+a*v-e.y)*i;if(g<=2)return new Ft(n,i);o=Math.sqrt(g/2)}else{var y=!1;s>Number.EPSILON?l>Number.EPSILON&&(y=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(a)===Math.sign(c)&&(y=!0),y?(n=-a,i=s,o=Math.sqrt(u)):(n=s,i=a,o=Math.sqrt(u/2))}return new Ft(n/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=j(O[V],O[H],O[W]);var X,q,Y=[],J=z.concat();for(l=0,c=C.length;l<c;l++){for(a=C[l],X=[],V=0,H=(G=a.length)-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=j(a[V],a[H],a[W]);Y.push(X),J=J.concat(X)}for(N=0;N<y;N++){for(I=N/y,R=v*Math.cos(I*Math.PI/2),L=g*Math.sin(I*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=D(O[V],z[V],L)).x,F.y,-R);for(l=0,c=C.length;l<c;l++)for(a=C[l],X=Y[l],V=0,G=a.length;V<G;V++)Q((F=D(a[V],X[V],L)).x,F.y,-R)}for(L=g,V=0;V<U;V++)F=x?D(E[V],J[V],L):E[V],S?(o.copy(n.normals[0]).multiplyScalar(F.x),i.copy(n.binormals[0]).multiplyScalar(F.y),s.copy(r[0]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,0);for(q=1;q<=w;q++)for(V=0;V<U;V++)F=x?D(E[V],J[V],L):E[V],S?(o.copy(n.normals[q]).multiplyScalar(F.x),i.copy(n.binormals[q]).multiplyScalar(F.y),s.copy(r[q]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,m/w*q);for(N=y-1;N>=0;N--){for(I=N/y,R=v*Math.cos(I*Math.PI/2),L=g*Math.sin(I*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=D(O[V],z[V],L)).x,F.y,m+R);for(l=0,c=C.length;l<c;l++)for(a=C[l],X=Y[l],V=0,G=a.length;V<G;V++)F=D(a[V],X[V],L),S?Q(F.x,F.y+r[w-1].y,r[w-1].x+R):Q(F.x,F.y,m+R)}function Z(e,t){var r,n;for(V=e.length;--V>=0;){r=V,(n=V-1)<0&&(n=e.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var s=U*i,a=U*(i+1);$(t+r+s,t+n+s,t+n+a,t+r+a)}}}function Q(e,t,r){f.push(e),f.push(t),f.push(r)}function K(e,t,r){ee(e),ee(t),ee(r);var n=h.length/3,i=T.generateTopUV(M,h,n-3,n-2,n-1);te(i[0]),te(i[1]),te(i[2])}function $(e,t,r,n){ee(e),ee(t),ee(n),ee(t),ee(r),ee(n);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);te(o[0]),te(o[1]),te(o[3]),te(o[1]),te(o[2]),te(o[3])}function ee(e){d.push(h.length/3),h.push(f[3*e+0]),h.push(f[3*e+1]),h.push(f[3*e+2])}function te(e){p.push(e.x),p.push(e.y)}!function(){var e=h.length/3;if(x){var t=0,r=U*t;for(V=0;V<B;V++)K((k=P[V])[2]+r,k[1]+r,k[0]+r);for(r=U*(t=w+2*y),V=0;V<B;V++)K((k=P[V])[0]+r,k[1]+r,k[2]+r)}else{for(V=0;V<B;V++)K((k=P[V])[2],k[1],k[0]);for(V=0;V<B;V++)K((k=P[V])[0]+U*w,k[1]+U*w,k[2]+U*w)}M.addGroup(e,h.length/3-e,0)}(),function(){var e=h.length/3,t=0;for(Z(O,t),t+=O.length,l=0,c=C.length;l<c;l++)Z(a=C[l],t),t+=a.length;M.addGroup(e,h.length/3-e,1)}(),t.arrays||(this.setIndex(d),this.addAttribute("position",new wr(h,3)),this.addAttribute("uv",new wr(p,2)))},uo.WorldUVGenerator={generateTopUV:function(e,t,r,n,i){var o=t[3*r],s=t[3*r+1],a=t[3*n],l=t[3*n+1],c=t[3*i],u=t[3*i+1];return[new Ft(o,s),new Ft(a,l),new Ft(c,u)]},generateSideWallUV:function(e,t,r,n,i,o){var s=t[3*r],a=t[3*r+1],l=t[3*r+2],c=t[3*n],u=t[3*n+1],h=t[3*n+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(a-u)<.01?[new Ft(s,1-l),new Ft(c,1-h),new Ft(d,1-f),new Ft(m,1-g)]:[new Ft(a,1-l),new Ft(u,1-h),new Ft(p,1-f),new Ft(v,1-g)]}},po.prototype=Object.create(dr.prototype),po.prototype.constructor=po,fo.prototype=Object.create(ho.prototype),fo.prototype.constructor=fo,mo.prototype=Object.create(dr.prototype),mo.prototype.constructor=mo,vo.prototype=Object.create(Ar.prototype),vo.prototype.constructor=vo,go.prototype=Object.create(dr.prototype),go.prototype.constructor=go,yo.prototype=Object.create(Ar.prototype),yo.prototype.constructor=yo,xo.prototype=Object.create(dr.prototype),xo.prototype.constructor=xo,bo.prototype=Object.create(Ar.prototype),bo.prototype.constructor=bo,wo.prototype=Object.create(dr.prototype),wo.prototype.constructor=wo,wo.prototype.toJSON=function(){var e=dr.prototype.toJSON.call(this);return So(this.parameters.shapes,e)},_o.prototype=Object.create(Ar.prototype),_o.prototype.constructor=_o,_o.prototype.toJSON=function(){var e=Ar.prototype.toJSON.call(this);return So(this.parameters.shapes,e)},To.prototype=Object.create(Ar.prototype),To.prototype.constructor=To,Mo.prototype=Object.create(dr.prototype),Mo.prototype.constructor=Mo,Ao.prototype=Object.create(Ar.prototype),Ao.prototype.constructor=Ao,Eo.prototype=Object.create(Mo.prototype),Eo.prototype.constructor=Eo,Co.prototype=Object.create(Ao.prototype),Co.prototype.constructor=Co,Po.prototype=Object.create(dr.prototype),Po.prototype.constructor=Po,Oo.prototype=Object.create(Ar.prototype),Oo.prototype.constructor=Oo;var Do=Object.freeze({WireframeGeometry:bi,ParametricGeometry:wi,ParametricBufferGeometry:_i,TetrahedronGeometry:Mi,TetrahedronBufferGeometry:Ai,OctahedronGeometry:Ei,OctahedronBufferGeometry:Ci,IcosahedronGeometry:Pi,IcosahedronBufferGeometry:Oi,DodecahedronGeometry:Di,DodecahedronBufferGeometry:Ni,PolyhedronGeometry:Si,PolyhedronBufferGeometry:Ti,TubeGeometry:Li,TubeBufferGeometry:Ii,TorusKnotGeometry:Ri,TorusKnotBufferGeometry:Fi,TorusGeometry:ki,TorusBufferGeometry:Ui,TextGeometry:po,TextBufferGeometry:fo,SphereGeometry:mo,SphereBufferGeometry:vo,RingGeometry:go,RingBufferGeometry:yo,PlaneGeometry:Pr,PlaneBufferGeometry:Or,LatheGeometry:xo,LatheBufferGeometry:bo,ShapeGeometry:wo,ShapeBufferGeometry:_o,ExtrudeGeometry:uo,ExtrudeBufferGeometry:ho,EdgesGeometry:To,ConeGeometry:Eo,ConeBufferGeometry:Co,CylinderGeometry:Mo,CylinderBufferGeometry:Ao,CircleGeometry:Po,CircleBufferGeometry:Oo,BoxGeometry:Er,BoxBufferGeometry:Cr});function No(e){Nr.call(this),this.type="ShadowMaterial",this.color=new er(0),this.transparent=!0,this.setValues(e)}function Lo(e){Ir.call(this,e),this.type="RawShaderMaterial"}function Io(e){Nr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new er(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new er(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ro(e){Io.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Fo(e){Nr.call(this),this.type="MeshPhongMaterial",this.color=new er(16777215),this.specular=new er(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new er(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ko(e){Fo.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Uo(e){Nr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Bo(e){Nr.call(this),this.type="MeshLambertMaterial",this.color=new er(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new er(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function jo(e){ui.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}No.prototype=Object.create(Nr.prototype),No.prototype.constructor=No,No.prototype.isShadowMaterial=!0,No.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.color.copy(e.color),this},Lo.prototype=Object.create(Ir.prototype),Lo.prototype.constructor=Lo,Lo.prototype.isRawShaderMaterial=!0,Io.prototype=Object.create(Nr.prototype),Io.prototype.constructor=Io,Io.prototype.isMeshStandardMaterial=!0,Io.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ro.prototype=Object.create(Io.prototype),Ro.prototype.constructor=Ro,Ro.prototype.isMeshPhysicalMaterial=!0,Ro.prototype.copy=function(e){return Io.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Fo.prototype=Object.create(Nr.prototype),Fo.prototype.constructor=Fo,Fo.prototype.isMeshPhongMaterial=!0,Fo.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ko.prototype=Object.create(Fo.prototype),ko.prototype.constructor=ko,ko.prototype.isMeshToonMaterial=!0,ko.prototype.copy=function(e){return Fo.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Uo.prototype=Object.create(Nr.prototype),Uo.prototype.constructor=Uo,Uo.prototype.isMeshNormalMaterial=!0,Uo.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Bo.prototype=Object.create(Nr.prototype),Bo.prototype.constructor=Bo,Bo.prototype.isMeshLambertMaterial=!0,Bo.prototype.copy=function(e){return Nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},jo.prototype=Object.create(ui.prototype),jo.prototype.constructor=jo,jo.prototype.isLineDashedMaterial=!0,jo.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var zo=Object.freeze({ShadowMaterial:No,SpriteMaterial:ii,RawShaderMaterial:Lo,ShaderMaterial:Ir,PointsMaterial:fi,MeshPhysicalMaterial:Ro,MeshStandardMaterial:Io,MeshPhongMaterial:Fo,MeshToonMaterial:ko,MeshNormalMaterial:Uo,MeshLambertMaterial:Bo,MeshDepthMaterial:Hn,MeshDistanceMaterial:Wn,MeshBasicMaterial:Lr,LineDashedMaterial:jo,LineBasicMaterial:ui,Material:Nr}),Vo={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Go(e,t,r){var n=this,i=!1,o=0,s=0,a=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){s++,!1===i&&void 0!==n.onStart&&n.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,s),o===s&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this}}var Ho=new Go,Wo={};function Xo(e){this.manager=void 0!==e?e:Ho}function qo(e){this.manager=void 0!==e?e:Ho,this._parser=null}function Yo(e){this.manager=void 0!==e?e:Ho,this._parser=null}function Jo(e){this.manager=void 0!==e?e:Ho}function Zo(e){this.manager=void 0!==e?e:Ho}function Qo(e){this.manager=void 0!==e?e:Ho}function Ko(){this.type="Curve",this.arcLengthDivisions=200}function $o(e,t,r,n,i,o,s,a){Ko.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function es(e,t,r,n,i,o){$o.call(this,e,t,r,r,n,i,o),this.type="ArcCurve"}function ts(){var e=0,t=0,r=0,n=0;function i(i,o,s,a){e=i,t=s,r=-3*i+3*o-2*s-a,n=2*i-2*o+s+a}return{initCatmullRom:function(e,t,r,n,o){i(t,r,o*(r-e),o*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,o,s,a){var l=(t-e)/o-(r-e)/(o+s)+(r-t)/s,c=(r-t)/s-(n-t)/(s+a)+(n-r)/a;i(t,r,l*=s,c*=s)},calc:function(i){var o=i*i;return e+t*i+r*o+n*(o*i)}}}Object.assign(Xo.prototype,{load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Vo.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;if(void 0===Wo[e]){var s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var a=s[1],l=!!s[2],c=s[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:a}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,a);break;case"json":u=JSON.parse(c);break;default:u=c}window.setTimeout(function(){t&&t(u),i.manager.itemEnd(e)},0)}catch(t){window.setTimeout(function(){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)},0)}}else{Wo[e]=[],Wo[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;Vo.add(e,r);var n=Wo[e];if(delete Wo[e],200===this.status){for(var o=0,s=n.length;o<s;o++){(a=n[o]).onLoad&&a.onLoad(r)}i.manager.itemEnd(e)}else if(0===this.status){console.warn("THREE.FileLoader: HTTP Status 0 received.");for(o=0,s=n.length;o<s;o++){(a=n[o]).onLoad&&a.onLoad(r)}i.manager.itemEnd(e)}else{for(o=0,s=n.length;o<s;o++){var a;(a=n[o]).onError&&a.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)}},!1),m.addEventListener("progress",function(t){for(var r=Wo[e],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=Wo[e];delete Wo[e];for(var n=0,o=r.length;n<o;n++){var s=r[n];s.onError&&s.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}Wo[e].push({onLoad:t,onProgress:r,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(qo.prototype,{load:function(e,t,r,n){var i=this,o=[],s=new yi;s.image=o;var a=new Xo(this.manager);function l(l){a.load(e[l],function(e){var r=i._parser(e,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(s.minFilter=we),s.format=r.format,s.needsUpdate=!0,t&&t(s))},r,n)}if(a.setPath(this.path),a.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)l(u);else a.load(e,function(e){var r=i._parser(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,a=0;a<n;a++){o[a]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[a].mipmaps.push(r.mipmaps[a*r.mipmapCount+l]),o[a].format=r.format,o[a].width=r.width,o[a].height=r.height}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=we),s.format=r.format,s.needsUpdate=!0,t&&t(s)},r,n);return s},setPath:function(e){return this.path=e,this}}),Object.assign(Yo.prototype,{load:function(e,t,r,n){var i=this,o=new Xt,s=new Xo(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){var r=i._parser(e);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:ve,o.wrapT=void 0!==r.wrapT?r.wrapT:ve,o.magFilter=void 0!==r.magFilter?r.magFilter:we,o.minFilter=void 0!==r.minFilter?r.minFilter:Se,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=we),o.needsUpdate=!0,t&&t(o,r))},r,n),o}}),Object.assign(Jo.prototype,{crossOrigin:"Anonymous",load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Vo.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",function(){Vo.add(e,this),t&&t(this),i.manager.itemEnd(e)},!1),s.addEventListener("error",function(t){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)},!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Zo.prototype,{crossOrigin:"Anonymous",load:function(e,t,r,n){var i=new jr,o=new Jo(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function a(r){o.load(e[r],function(e){i.images[r]=e,6===++s&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(var l=0;l<e.length;++l)a(l);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Qo.prototype,{crossOrigin:"Anonymous",load:function(e,t,r,n){var i=new Vt,o=new Jo(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(r){i.image=r;var n=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?ke:Ue,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Ko.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t||e*n[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=n[i=Math.floor(a+(l-a)/2)]-r)<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(o-1);var c=n[i];return(i+(r-c)/(n[i+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,o=new Bt,s=[],a=[],l=[],c=new Bt,u=new kt;for(r=0;r<=e;r++)n=r/e,s[r]=this.getTangentAt(n),s[r].normalize();a[0]=new Bt,l[0]=new Bt;var h=Number.MAX_VALUE,d=Math.abs(s[0].x),p=Math.abs(s[0].y),f=Math.abs(s[0].z);for(d<=h&&(h=d,o.set(1,0,0)),p<=h&&(h=p,o.set(0,1,0)),f<=h&&o.set(0,0,1),c.crossVectors(s[0],o).normalize(),a[0].crossVectors(s[0],c),l[0].crossVectors(s[0],a[0]),r=1;r<=e;r++)a[r]=a[r-1].clone(),l[r]=l[r-1].clone(),c.crossVectors(s[r-1],s[r]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(Rt.clamp(s[r-1].dot(s[r]),-1,1)),a[r].applyMatrix4(u.makeRotationAxis(c,i))),l[r].crossVectors(s[r],a[r]);if(!0===t)for(i=Math.acos(Rt.clamp(a[0].dot(a[e]),-1,1)),i/=e,s[0].dot(c.crossVectors(a[0],a[e]))>0&&(i=-i),r=1;r<=e;r++)a[r].applyMatrix4(u.makeRotationAxis(s[r],i*r)),l[r].crossVectors(s[r],a[r]);return{tangents:s,normals:a,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),$o.prototype=Object.create(Ko.prototype),$o.prototype.constructor=$o,$o.prototype.isEllipseCurve=!0,$o.prototype.getPoint=function(e,t){for(var r=t||new Ft,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var s=this.aStartAngle+e*i,a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=a-this.aX,d=l-this.aY;a=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(a,l)},$o.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},$o.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},$o.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},es.prototype=Object.create($o.prototype),es.prototype.constructor=es,es.prototype.isArcCurve=!0;var rs=new Bt,ns=new ts,is=new ts,os=new ts;function ss(e,t,r,n){Ko.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function as(e,t,r,n,i){var o=.5*(n-t),s=.5*(i-r),a=e*e;return(2*r-2*n+o+s)*(e*a)+(-3*r+3*n-2*o-s)*a+o*e+r}function ls(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function cs(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}function us(e,t,r,n){Ko.call(this),this.type="CubicBezierCurve",this.v0=e||new Ft,this.v1=t||new Ft,this.v2=r||new Ft,this.v3=n||new Ft}function hs(e,t,r,n){Ko.call(this),this.type="CubicBezierCurve3",this.v0=e||new Bt,this.v1=t||new Bt,this.v2=r||new Bt,this.v3=n||new Bt}function ds(e,t){Ko.call(this),this.type="LineCurve",this.v1=e||new Ft,this.v2=t||new Ft}function ps(e,t){Ko.call(this),this.type="LineCurve3",this.v1=e||new Bt,this.v2=t||new Bt}function fs(e,t,r){Ko.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ft,this.v1=t||new Ft,this.v2=r||new Ft}function ms(e,t,r){Ko.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Bt,this.v1=t||new Bt,this.v2=r||new Bt}function vs(e){Ko.call(this),this.type="SplineCurve",this.points=e||[]}ss.prototype=Object.create(Ko.prototype),ss.prototype.constructor=ss,ss.prototype.isCatmullRomCurve3=!0,ss.prototype.getPoint=function(e,t){var r,n,i,o,s=t||new Bt,a=this.points,l=a.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/a.length)+1)*a.length:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=a[(u-1)%l]:(rs.subVectors(a[0],a[1]).add(a[0]),r=rs),n=a[u%l],i=a[(u+1)%l],this.closed||u+2<l?o=a[(u+2)%l]:(rs.subVectors(a[l-1],a[l-2]).add(a[l-1]),o=rs),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),ns.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,p,f,m),is.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,p,f,m),os.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(ns.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),is.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),os.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return s.set(ns.calc(h),is.calc(h),os.calc(h)),s},ss.prototype.copy=function(e){Ko.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ss.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},ss.prototype.fromJSON=function(e){Ko.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Bt).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},us.prototype=Object.create(Ko.prototype),us.prototype.constructor=us,us.prototype.isCubicBezierCurve=!0,us.prototype.getPoint=function(e,t){var r=t||new Ft,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(cs(e,n.x,i.x,o.x,s.x),cs(e,n.y,i.y,o.y,s.y)),r},us.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},us.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},us.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},hs.prototype=Object.create(Ko.prototype),hs.prototype.constructor=hs,hs.prototype.isCubicBezierCurve3=!0,hs.prototype.getPoint=function(e,t){var r=t||new Bt,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(cs(e,n.x,i.x,o.x,s.x),cs(e,n.y,i.y,o.y,s.y),cs(e,n.z,i.z,o.z,s.z)),r},hs.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},hs.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},hs.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},ds.prototype=Object.create(Ko.prototype),ds.prototype.constructor=ds,ds.prototype.isLineCurve=!0,ds.prototype.getPoint=function(e,t){var r=t||new Ft;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},ds.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ds.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},ds.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ds.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ds.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ps.prototype=Object.create(Ko.prototype),ps.prototype.constructor=ps,ps.prototype.isLineCurve3=!0,ps.prototype.getPoint=function(e,t){var r=t||new Bt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},ps.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ps.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ps.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ps.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},fs.prototype=Object.create(Ko.prototype),fs.prototype.constructor=fs,fs.prototype.isQuadraticBezierCurve=!0,fs.prototype.getPoint=function(e,t){var r=t||new Ft,n=this.v0,i=this.v1,o=this.v2;return r.set(ls(e,n.x,i.x,o.x),ls(e,n.y,i.y,o.y)),r},fs.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},fs.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},fs.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ms.prototype=Object.create(Ko.prototype),ms.prototype.constructor=ms,ms.prototype.isQuadraticBezierCurve3=!0,ms.prototype.getPoint=function(e,t){var r=t||new Bt,n=this.v0,i=this.v1,o=this.v2;return r.set(ls(e,n.x,i.x,o.x),ls(e,n.y,i.y,o.y),ls(e,n.z,i.z,o.z)),r},ms.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ms.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ms.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},vs.prototype=Object.create(Ko.prototype),vs.prototype.constructor=vs,vs.prototype.isSplineCurve=!0,vs.prototype.getPoint=function(e,t){var r=t||new Ft,n=this.points,i=(n.length-1)*e,o=Math.floor(i),s=i-o,a=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set(as(s,a.x,l.x,c.x,u.x),as(s,a.y,l.y,c.y,u.y)),r},vs.prototype.copy=function(e){Ko.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},vs.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},vs.prototype.fromJSON=function(e){Ko.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Ft).fromArray(n))}return this};var gs=Object.freeze({ArcCurve:es,CatmullRomCurve3:ss,CubicBezierCurve:us,CubicBezierCurve3:hs,EllipseCurve:$o,LineCurve:ds,LineCurve3:ps,QuadraticBezierCurve:fs,QuadraticBezierCurve3:ms,SplineCurve:vs});function ys(){Ko.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function xs(e){ys.call(this),this.type="Path",this.currentPoint=new Ft,e&&this.setFromPoints(e)}function bs(e){xs.call(this,e),this.uuid=Rt.generateUUID(),this.type="Shape",this.holes=[]}function ws(e,t){ar.call(this),this.type="Light",this.color=new er(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function _s(e,t,r){ws.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ar.DefaultUp),this.updateMatrix(),this.groundColor=new er(t)}function Ss(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Ft(512,512),this.map=null,this.matrix=new kt}function Ts(){Ss.call(this,new Qn(50,1,.5,500))}function Ms(e,t,r,n,i,o){ws.call(this,e,t),this.type="SpotLight",this.position.copy(ar.DefaultUp),this.updateMatrix(),this.target=new ar,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Ts}function As(e,t,r,n){ws.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new Ss(new Qn(90,1,.5,500))}function Es(){Ss.call(this,new cr(-5,5,5,-5,.5,500))}function Cs(e,t){ws.call(this,e,t),this.type="DirectionalLight",this.position.copy(ar.DefaultUp),this.updateMatrix(),this.target=new ar,this.shadow=new Es}function Ps(e,t){ws.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Os(e,t,r,n){ws.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function Ds(e,t,r,n){Vs.call(this,e,t,r,n)}function Ns(e,t,r){Vs.call(this,e,t,r)}function Ls(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function Is(e,t,r,n){Ls.call(this,e,t,r,n)}function Rs(e,t,r,n){Vs.call(this,e,t,r,n)}function Fs(e,t,r,n){Vs.call(this,e,t,r,n)}function ks(e,t,r,n){Vs.call(this,e,t,r,n)}function Us(e,t,r,n){Ls.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Bs(e,t,r,n){Ls.call(this,e,t,r,n)}function js(e,t,r,n){Ls.call(this,e,t,r,n)}ys.prototype=Object.assign(Object.create(Ko.prototype),{constructor:ys,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ds(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,o=this.curves[n],s=o.getLength(),a=0===s?0:1-i/s;return o.getPointAt(a)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],s=o&&o.isEllipseCurve?2*e:o&&o.isLineCurve?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s),l=0;l<a.length;l++){var c=a[l];t&&t.equals(c)||(r.push(c),t=c)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){Ko.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Ko.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Ko.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new gs[n.type]).fromJSON(n))}return this}}),xs.prototype=Object.assign(Object.create(ys.prototype),{constructor:xs,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new ds(this.currentPoint.clone(),new Ft(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){var i=new fs(this.currentPoint.clone(),new Ft(e,t),new Ft(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(e,t,r,n,i,o){var s=new us(this.currentPoint.clone(),new Ft(e,t),new Ft(r,n),new Ft(i,o));this.curves.push(s),this.currentPoint.set(i,o)},splineThru:function(e){var t=new vs([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,n,i,o){var s=this.currentPoint.x,a=this.currentPoint.y;this.absarc(e+s,t+a,r,n,i,o)},absarc:function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},ellipse:function(e,t,r,n,i,o,s,a){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,r,n,i,o,s,a)},absellipse:function(e,t,r,n,i,o,s,a){var l=new $o(e,t,r,n,i,o,s,a);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return ys.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=ys.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return ys.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),bs.prototype=Object.assign(Object.create(xs.prototype),{constructor:bs,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){xs.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=xs.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){xs.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new xs).fromJSON(n))}return this}}),ws.prototype=Object.assign(Object.create(ar.prototype),{constructor:ws,isLight:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=ar.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),_s.prototype=Object.assign(Object.create(ws.prototype),{constructor:_s,isHemisphereLight:!0,copy:function(e){return ws.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Ss.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Ts.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Ts,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*Rt.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix())}}),Ms.prototype=Object.assign(Object.create(ws.prototype),{constructor:Ms,isSpotLight:!0,copy:function(e){return ws.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),As.prototype=Object.assign(Object.create(ws.prototype),{constructor:As,isPointLight:!0,copy:function(e){return ws.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Es.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Es}),Cs.prototype=Object.assign(Object.create(ws.prototype),{constructor:Cs,isDirectionalLight:!0,copy:function(e){return ws.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ps.prototype=Object.assign(Object.create(ws.prototype),{constructor:Ps,isAmbientLight:!0}),Os.prototype=Object.assign(Object.create(ws.prototype),{constructor:Os,isRectAreaLight:!0,copy:function(e){return ws.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=ws.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Ds.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Ds,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:vt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ns.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Ns,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:vt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(Ls.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var o;r:{n:if(!(e<n)){for(var s=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===s)break;if(i=n,e<(n=t[++r]))break t}o=t.length;break r}if(e>=i)break e;var a=t[1];e<a&&(r=2,i=a);for(s=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===s)break;if(n=i,e>=(i=t[--r-1]))break t}o=r,r=0}for(;r<o;){var l=r+o>>>1;e<t[l]?o=l:r=l+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,o=0;o!==n;++o)t[o]=r[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ls.prototype,{beforeStart_:Ls.prototype.copySampleValue_,afterEnd_:Ls.prototype.copySampleValue_}),Is.prototype=Object.assign(Object.create(Ls.prototype),{constructor:Is,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=(r-t)/(n-t),c=a+s;a!==c;a+=4)Ut.slerpFlat(i,0,o,a-s,o,a,l);return i}}),Rs.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Rs,ValueTypeName:"quaternion",DefaultInterpolation:gt,InterpolantFactoryMethodLinear:function(e){return new Is(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Fs.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Fs,ValueTypeName:"color"}),ks.prototype=Object.assign(Object.create(Vs.prototype),{constructor:ks,ValueTypeName:"number"}),Us.prototype=Object.assign(Object.create(Ls.prototype),{constructor:Us,DefaultSettings_:{endingStart:xt,endingEnd:xt},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,o=e+1,s=n[i],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case bt:i=e,s=2*t-r;break;case wt:s=t+n[i=n.length-2]-n[i+1];break;default:i=e,s=r}if(void 0===a)switch(this.getSettings_().endingEnd){case bt:o=e,a=2*r-t;break;case wt:o=1,a=r+n[1]-n[0];break;default:o=e-1,a=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-t)/(n-t),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==s;++b)i[b]=v*o[c+b]+g*o[l+b]+y*o[a+b]+x*o[u+b];return i}}),Bs.prototype=Object.assign(Object.create(Ls.prototype),{constructor:Bs,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(r-t)/(n-t),u=1-c,h=0;h!==s;++h)i[h]=o[l+h]*u+o[a+h]*c;return i}}),js.prototype=Object.assign(Object.create(Ls.prototype),{constructor:js,interpolate_:function(e){return this.copySampleValue_(e-1)}});var zs={arraySlice:function(e,t,r){return zs.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),o=0,s=0;s!==n;++o)for(var a=r[o]*t,l=0;l!==t;++l)i[s++]=e[a+l];return i},flattenJSON:function(e,t,r,n){for(var i=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[i++];if(void 0!==o){var s=o[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[n])&&(t.push(o.time),r.push.apply(r,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[n])&&(t.push(o.time),s.toArray(r,r.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(s=o[n])&&(t.push(o.time),r.push(s)),o=e[i++]}while(void 0!==o)}}};function Vs(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=zs.convertArray(t,this.TimeBufferType),this.values=zs.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function Gs(e,t,r,n){Vs.call(this,e,t,r,n)}function Hs(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=Rt.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Ws(e){this.manager=void 0!==e?e:Ho,this.textures={}}function Xs(e){this.manager=void 0!==e?e:Ho}Object.assign(Vs,{parse:function(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=Vs._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var r=[],n=[];zs.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:zs.convertArray(e.times,Array),values:zs.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ks;case"vector":case"vector2":case"vector3":case"vector4":return Gs;case"color":return Fs;case"quaternion":return Rs;case"bool":case"boolean":return Ns;case"string":return Ds}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}}),Object.assign(Vs.prototype,{constructor:Vs,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:gt,InterpolantFactoryMethodDiscrete:function(e){return new js(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Bs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Us(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case vt:t=this.InterpolantFactoryMethodDiscrete;break;case gt:t=this.InterpolantFactoryMethodLinear;break;case yt:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)this.createInterpolant=t;else{var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",r)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return vt;case this.InterpolantFactoryMethodLinear:return gt;case this.InterpolantFactoryMethodSmooth:return yt}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<e;)++i;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var s=this.getValueSize();this.times=zs.arraySlice(r,i,o),this.values=zs.arraySlice(this.values,i*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,s=0;s!==i;s++){var a=r[s];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),e=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),e=!1;break}o=a}if(void 0!==n&&zs.isTypedArray(n)){s=0;for(var l=n.length;s!==l;++s){var c=n[s];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,c),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=this.getInterpolation()===yt,i=1,o=e.length-1,s=1;s<o;++s){var a=!1,l=e[s];if(l!==e[s+1]&&(1!==s||l!==l[0]))if(n)a=!0;else for(var c=s*r,u=c-r,h=c+r,d=0;d!==r;++d){var p=t[c+d];if(p!==t[u+d]||p!==t[h+d]){a=!0;break}}if(a){if(s!==i){e[i]=e[s];var f=s*r,m=i*r;for(d=0;d!==r;++d)t[m+d]=t[f+d]}++i}}if(o>0){e[i]=e[o];for(f=o*r,m=i*r,d=0;d!==r;++d)t[m+d]=t[f+d];++i}return i!==e.length&&(this.times=zs.arraySlice(e,0,i),this.values=zs.arraySlice(t,0,i*r)),this}}),Gs.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Gs,ValueTypeName:"vector"}),Object.assign(Hs,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,o=r.length;i!==o;++i)t.push(Vs.parse(r[i]).scale(n));return new Hs(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t},i=0,o=r.length;i!==o;++i)t.push(Vs.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,o=[],s=0;s<i;s++){var a=[],l=[];a.push((s+i-1)%i,s,(s+1)%i),l.push(0,1,0);var c=zs.getKeyframeOrder(a);a=zs.sortedArray(a,1,c),l=zs.sortedArray(l,1,c),n||0!==a[0]||(a.push(i),l.push(l[0])),o.push(new ks(".morphTargetInfluences["+t[s].name+"]",a,l).scale(1/r))}return new Hs(e,-1,o)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var a=e[o],l=a.name.match(i);if(l&&l.length>1){var c=n[h=l[1]];c||(n[h]=c=[]),c.push(a)}}var u=[];for(var h in n)u.push(Hs.CreateFromMorphTargetSequence(h,n[h],t,r));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var o=[],s=[];zs.flattenJSON(r,o,s,n),0!==o.length&&i.push(new e(t,o,s))}},n=[],i=e.name||"default",o=e.length||-1,s=e.fps||30,a=e.hierarchy||[],l=0;l<a.length;l++){var c=a[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var v=c[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new ks(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(s||1)}else{var g=".bones["+t[l].name+"]";r(Gs,g+".position",c,"pos",n),r(Rs,g+".quaternion",c,"rot",n),r(Gs,g+".scale",c,"scl",n)}}return 0===n.length?null:new Hs(i,o,n)}}),Object.assign(Hs.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}this.duration=e},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(Ws.prototype,{load:function(e,t,r,n){var i=this;new Xo(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setTextures:function(e){this.textures=e},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new zo[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearCoat&&(n.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(n.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(n.uniforms=e.uniforms),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalScale){var i=e.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new Ft).fromArray(i)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),n}}),Object.assign(Xs.prototype,{load:function(e,t,r,n){var i=this;new Xo(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=new Ar,r=e.data.index;if(void 0!==r){var n=new qs[r.type](r.array);t.setIndex(new pr(n,1))}var i=e.data.attributes;for(var o in i){var s=i[o];n=new qs[s.type](s.array);t.addAttribute(o,new pr(n,s.itemSize,s.normalized))}var a=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==a)for(var l=0,c=a.length;l!==c;++l){var u=a[l];t.addGroup(u.start,u.count,u.materialIndex)}var h=e.data.boundingSphere;if(void 0!==h){var d=new Bt;void 0!==h.center&&d.fromArray(h.center),t.boundingSphere=new Yt(d,h.radius)}return t}});var qs={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ys(){}Ys.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r],o=t[r+1];if(i.test(e))return o}return null}},Object.assign(Ys.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:function(){var e={NoBlending:S,NormalBlending:T,AdditiveBlending:M,SubtractiveBlending:A,MultiplyBlending:E,CustomBlending:C},t=new er,r=new Qo,n=new Ws;return function(i,o,s){var a={};function l(e,t,n,i,l){var c,u=o+e,h=Ys.Handlers.get(u);null!==h?c=h.load(u):(r.setCrossOrigin(s),c=r.load(u)),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=me),1!==t[1]&&(c.wrapT=me)),void 0!==n&&c.offset.fromArray(n),void 0!==i&&("repeat"===i[0]&&(c.wrapS=me),"mirror"===i[0]&&(c.wrapS=ge),"repeat"===i[1]&&(c.wrapT=me),"mirror"===i[1]&&(c.wrapT=ge)),void 0!==l&&(c.anisotropy=l);var d=Rt.generateUUID();return a[d]=c,d}var c={uuid:Rt.generateUUID(),type:"MeshLambertMaterial"};for(var u in i){var h=i[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(h).getHex();break;case"colorSpecular":c.specular=t.fromArray(h).getHex();break;case"colorEmissive":c.emissive=t.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(h,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(h,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(h,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(h,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(h,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(h,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(h,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(h,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(h,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(h,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=v;break;case"doubleSided":c.side=g;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=_),"face"===h&&(c.vertexColors=w);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(a),n.parse(c)}}()});var Js={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")}};function Zs(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Ho,this.withCredentials=!1}function Qs(e){this.manager=void 0!==e?e:Ho,this.texturePath=""}Object.assign(Zs.prototype,{load:function(e,t,r,n){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Js.extractUrlBase(e),s=new Xo(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,function(r){var n=JSON.parse(r),s=n.metadata;if(void 0!==s){var a=s.type;if(void 0!==a&&"object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(n,o);t(l.geometry,l.materials)},r,n)},setTexturePath:function(e){this.texturePath=e},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new dr;return function(e,t){function r(e,t){return e&1<<t}var n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C=e.faces,P=e.vertices,O=e.normals,D=e.colors,N=e.scale,L=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&L++;for(n=0;n<L;n++)t.faceVertexUvs[n]=[]}for(s=0,a=P.length;s<a;)(b=new Bt).x=P[s++]*N,b.y=P[s++]*N,b.z=P[s++]*N,t.vertices.push(b);for(s=0,a=C.length;s<a;)if(p=r(d=C[s++],0),f=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),x=r(d,7),p){if((_=new ur).a=C[s],_.b=C[s+1],_.c=C[s+3],(S=new ur).a=C[s+1],S.b=C[s+2],S.c=C[s+3],s+=4,f&&(h=C[s++],_.materialIndex=h,S.materialIndex=h),o=t.faces.length,m)for(n=0;n<L;n++)for(A=e.uvs[n],t.faceVertexUvs[n][o]=[],t.faceVertexUvs[n][o+1]=[],i=0;i<4;i++)E=new Ft(A[2*(u=C[s++])],A[2*u+1]),2!==i&&t.faceVertexUvs[n][o].push(E),0!==i&&t.faceVertexUvs[n][o+1].push(E);if(v&&(c=3*C[s++],_.normal.set(O[c++],O[c++],O[c]),S.normal.copy(_.normal)),g)for(n=0;n<4;n++)c=3*C[s++],M=new Bt(O[c++],O[c++],O[c]),2!==n&&_.vertexNormals.push(M),0!==n&&S.vertexNormals.push(M);if(y&&(T=D[l=C[s++]],_.color.setHex(T),S.color.setHex(T)),x)for(n=0;n<4;n++)T=D[l=C[s++]],2!==n&&_.vertexColors.push(new er(T)),0!==n&&S.vertexColors.push(new er(T));t.faces.push(_),t.faces.push(S)}else{if((w=new ur).a=C[s++],w.b=C[s++],w.c=C[s++],f&&(h=C[s++],w.materialIndex=h),o=t.faces.length,m)for(n=0;n<L;n++)for(A=e.uvs[n],t.faceVertexUvs[n][o]=[],i=0;i<3;i++)E=new Ft(A[2*(u=C[s++])],A[2*u+1]),t.faceVertexUvs[n][o].push(E);if(v&&(c=3*C[s++],w.normal.set(O[c++],O[c++],O[c])),g)for(n=0;n<3;n++)c=3*C[s++],M=new Bt(O[c++],O[c++],O[c]),w.vertexNormals.push(M);if(y&&(l=C[s++],w.color.setHex(D[l])),x)for(n=0;n<3;n++)l=C[s++],w.vertexColors.push(new er(D[l]));t.faces.push(w)}}(e,r),function(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=r){var o=e.skinWeights[n],s=r>1?e.skinWeights[n+1]:0,a=r>2?e.skinWeights[n+2]:0,l=r>3?e.skinWeights[n+3]:0;t.skinWeights.push(new Gt(o,s,a,l))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=r){var c=e.skinIndices[n],u=r>1?e.skinIndices[n+1]:0,h=r>2?e.skinIndices[n+2]:0,d=r>3?e.skinIndices[n+3]:0;t.skinIndices.push(new Gt(c,u,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;n<i;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var o=t.morphTargets[n].vertices,s=e.morphTargets[n].vertices,a=0,l=s.length;a<l;a+=3){var c=new Bt;c.x=s[a]*r,c.y=s[a+1]*r,c.z=s[a+2]*r,o.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=t.faces,h=e.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(e,r),function(e,t){var r=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var o=Hs.parseAnimation(n[i],t.bones);o&&r.push(o)}if(t.morphTargets){var s=Hs.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(s)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:Ys.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}()}),Object.assign(Qs.prototype,{load:function(e,t,r,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this;new Xo(i.manager).load(e,function(r){var o=null;try{o=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.")},r,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(a)}),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,n,s);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new bs).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new Zs,i=new Xs,o=0,s=e.length;o<s;o++){var a,l=e[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Do[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Do[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Do[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Do[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Do[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Do[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Do[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Do[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Do[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Do[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Do[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Do[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var c=[];for(o=0,s=l.shapes.length;o<s;o++){var u=t[l.shapes[o]];c.push(u)}a=new Do[l.type](c,l.curveSegments);break;case"BufferGeometry":a=i.parse(l);break;case"Geometry":a=n.parse(l,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),r[l.uuid]=a}return r},parseMaterials:function(e,t){var r={};if(void 0!==e){var n=new Ws;n.setTextures(t);for(var i=0,o=e.length;i<o;i++){var s=e[i];if("MultiMaterial"===s.type){for(var a=[],l=0;l<s.materials.length;l++)a.push(n.parse(s.materials[l]));r[s.uuid]=a}else r[s.uuid]=n.parse(s)}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=Hs.parse(e[r]);t.push(n)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),o.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemEnd(e),r.manager.itemError(e)})}if(void 0!==e&&e.length>0){var o=new Jo(new Go(t));o.setCrossOrigin(this.crossOrigin);for(var s=0,a=e.length;s<a;s++){var l=e[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=i(c)}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var a=new Vt(t[s.image]);a.needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,$s)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],ea),a.wrapT=r(s.wrap[1],ea)),void 0!==s.format&&(a.format=s.format),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,ta)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,ta)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),n[s.uuid]=a}return n},parseObject:function(e,t,r){var n;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var o=e[n];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(r[o])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new ni,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new er(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new ri(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new ti(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new Qn(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new cr(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new Ps(e.color,e.intensity);break;case"DirectionalLight":n=new Cs(e.color,e.intensity);break;case"PointLight":n=new As(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new Os(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new Ms(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new _s(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=i(e.geometry),a=o(e.material);n=s.bones&&s.bones.length>0?new ci(s,a):new Ur(s,a);break;case"LOD":n=new si;break;case"Line":n=new hi(i(e.geometry),o(e.material),e.mode);break;case"LineLoop":n=new pi(i(e.geometry),o(e.material));break;case"LineSegments":n=new di(i(e.geometry),o(e.material));break;case"PointCloud":case"Points":n=new mi(i(e.geometry),o(e.material));break;case"Sprite":n=new oi(o(e.material));break;case"Group":n=new vi;break;default:n=new ar}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],t,r));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var d=u[h],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}return n}});var Ks,$s={UVMapping:ae,CubeReflectionMapping:le,CubeRefractionMapping:ce,EquirectangularReflectionMapping:ue,EquirectangularRefractionMapping:he,SphericalReflectionMapping:de,CubeUVReflectionMapping:pe,CubeUVRefractionMapping:fe},ea={RepeatWrapping:me,ClampToEdgeWrapping:ve,MirroredRepeatWrapping:ge},ta={NearestFilter:ye,NearestMipMapNearestFilter:xe,NearestMipMapLinearFilter:be,LinearFilter:we,LinearMipMapNearestFilter:_e,LinearMipMapLinearFilter:Se};function ra(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Ho,this.options=void 0}function na(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function ia(e){this.type="Font",this.data=e}function oa(e,t,r,n,i,o){var s=o.glyphs[e]||o.glyphs["?"];if(s){var a,l,c,u,h,d,p,f,m=new na;if(s.o)for(var v=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),g=0,y=v.length;g<y;){switch(v[g++]){case"m":a=v[g++]*r+n,l=v[g++]*r+i,m.moveTo(a,l);break;case"l":a=v[g++]*r+n,l=v[g++]*r+i,m.lineTo(a,l);break;case"q":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,m.quadraticCurveTo(h,d,c,u);break;case"b":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,p=v[g++]*r+n,f=v[g++]*r+i,m.bezierCurveTo(h,d,p,f,c,u)}}return{offsetX:s.ha*r,path:m}}}function sa(e){this.manager=void 0!==e?e:Ho}ra.prototype={constructor:ra,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var i=this,o=Vo.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(r){Vo.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(na.prototype,{moveTo:function(e,t){this.currentPath=new xs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function(e,t,r,n,i,o){this.currentPath.bezierCurveTo(e,t,r,n,i,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],o=new bs;o.curves=i.curves,t.push(o)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,o=0;o<r;i=o++){var s=t[i],a=t[o],l=a.x-s.x,c=a.y-s.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(s=t[o],l=-l,a=t[i],c=-c),e.y<s.y||e.y>a.y)continue;if(e.y===s.y){if(e.x===s.x)return!0}else{var u=c*(e.x-s.x)-l*(e.y-s.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(e.y!==s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return n}var i=ao.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return r(o);var s,a,l,c=[];if(1===o.length)return a=o[0],(l=new bs).curves=a.curves,c.push(l),c;var u=!i(o[0].getPoints());u=e?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)s=i(h=(a=o[g]).getPoints()),(s=e?!s:s)?(!u&&f[v]&&v++,f[v]={s:new bs,p:h},f[v].s.curves=a.curves,u&&v++,m[v]=[]):m[v].push({h:a,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var x=!1,b=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)n(M.p,f[E].p)&&(w!==E&&b.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):x=!0);A&&p[w].push(M)}b.length>0&&(x||(m=p))}g=0;for(var C=f.length;g<C;g++){l=f[g].s,c.push(l);for(var P=0,O=(d=m[g]).length;P<O;P++)l.holes.push(d[P].h)}return c}}),Object.assign(ia.prototype,{isFont:!0,generateShapes:function(e,t,r){void 0===t&&(t=100),void 0===r&&(r=4);for(var n=[],i=function(e,t,r,n){for(var i=String(e).split(""),o=t/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=[],l=0,c=0,u=0;u<i.length;u++){var h=i[u];if("\n"===h)l=0,c-=s;else{var d=oa(h,r,o,l,c,n);l+=d.offsetX,a.push(d.path)}}return a}(e,t,r,this.data),o=0,s=i.length;o<s;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}),Object.assign(sa.prototype,{load:function(e,t,r,n){var i=this,o=new Xo(this.manager);o.setPath(this.path),o.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)},r,n)},parse:function(e){return new ia(e)},setPath:function(e){return this.path=e,this}});var aa={getContext:function(){return void 0===Ks&&(Ks=new(window.AudioContext||window.webkitAudioContext)),Ks},setContext:function(e){Ks=e}};function la(e){this.manager=void 0!==e?e:Ho}function ca(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Qn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Qn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function ua(e,t,r){ar.call(this),this.type="CubeCamera";var n=new Qn(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Bt(1,0,0)),this.add(n);var i=new Qn(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Bt(-1,0,0)),this.add(i);var o=new Qn(90,1,e,t);o.up.set(0,0,1),o.lookAt(new Bt(0,1,0)),this.add(o);var s=new Qn(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new Bt(0,-1,0)),this.add(s);var a=new Qn(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new Bt(0,0,1)),this.add(a);var l=new Qn(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Bt(0,0,-1)),this.add(l);var c={format:ke,magFilter:we,minFilter:we};this.renderTarget=new Wt(r,r,c),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,i,r),r.activeCubeFace=2,e.render(t,o,r),r.activeCubeFace=3,e.render(t,s,r),r.activeCubeFace=4,e.render(t,a,r),r.texture.generateMipmaps=c,r.activeCubeFace=5,e.render(t,l,r),e.setRenderTarget(null)},this.clear=function(e,t,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,e.setRenderTarget(i),e.clear(t,r,n);e.setRenderTarget(null)}}function ha(){ar.call(this),this.type="AudioListener",this.context=aa.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function da(e){ar.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function pa(e){da.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function fa(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function ma(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(la.prototype,{load:function(e,t,r,n){var i=new Xo(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){aa.getContext().decodeAudioData(e,function(e){t(e)})},r,n)}}),Object.assign(ca.prototype,{update:function(){var e,t,r,n,i,o,s,a,l=new kt,c=new kt;return function(u){if(e!==this||t!==u.focus||r!==u.fov||n!==u.aspect*this.aspect||i!==u.near||o!==u.far||s!==u.zoom||a!==this.eyeSep){e=this,t=u.focus,r=u.fov,n=u.aspect*this.aspect,i=u.near,o=u.far,s=u.zoom;var h,d,p=u.projectionMatrix.clone(),f=(a=this.eyeSep/2)*i/t,m=i*Math.tan(Rt.DEG2RAD*r*.5)/s;c.elements[12]=-a,l.elements[12]=a,h=-m*n+f,d=m*n+f,p.elements[0]=2*i/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),h=-m*n-f,d=m*n-f,p.elements[0]=2*i/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()}),ua.prototype=Object.create(ar.prototype),ua.prototype.constructor=ua,ha.prototype=Object.assign(Object.create(ar.prototype),{constructor:ha,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new Bt,t=new Ut,r=new Bt,n=new Bt;return function(i){ar.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z))}}()}),da.prototype=Object.assign(Object.create(ar.prototype),{constructor:da,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),pa.prototype=Object.assign(Object.create(da.prototype),{constructor:pa,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new Bt;return function(t){ar.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(fa.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(ma.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==n;++s)r[i+s]=r[s];o=t}else{var a=t/(o+=t);this._mixBufferRegion(r,i,0,a,n)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var s=3*t;this._mixBufferRegion(r,n,s,1-i,t)}for(var a=t,l=t+t;a!==l;++a)if(r[a]!==r[a+t]){o.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,o=n;i!==o;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)e[t+o]=e[r+o]},_slerp:function(e,t,r,n){Ut.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var o=1-n,s=0;s!==i;++s){var a=t+s;e[a]=e[a]*o+e[r+s]*n}}});var va,ga;function ya(e,t,r){var n=r||xa.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function xa(e,t,r){this.path=t,this.parsedPath=r||xa.parseTrackName(t),this.node=xa.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function ba(){this.uuid=Rt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function wa(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,o=new Array(i),s={endingStart:xt,endingEnd:xt},a=0;a!==i;++a){var l=n[a].createInterpolant(null);o[a]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ft,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function _a(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Sa(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Ta(){Ar.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Ma(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function Aa(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Ea(e,t,r){Aa.call(this,e,t),this.meshPerAttribute=r||1}function Ca(e,t,r){pr.call(this,e,t),this.meshPerAttribute=r||1}function Pa(e,t,r,n){this.ray=new Rr(e,t),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Oa(e,t){return e.distance-t.distance}function Da(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var i=e.children,o=0,s=i.length;o<s;o++)Da(i[o],t,r,!0)}function Na(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function La(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function Ia(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}function Ra(e,t){this.min=void 0!==e?e:new Ft(1/0,1/0),this.max=void 0!==t?t:new Ft(-1/0,-1/0)}function Fa(e){ar.call(this),this.material=e,this.render=function(){}}function ka(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=3*a.faces.length:a&&a.isBufferGeometry&&(s=a.attributes.normal.count);var l=new Ar,c=new wr(2*s*3,3);l.addAttribute("position",c),di.call(this,l,new ui({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Ua(e,t){ar.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new Ar,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var s=i/32*Math.PI*2,a=o/32*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(a),Math.sin(a),1)}r.addAttribute("position",new wr(n,3));var l=new ui({fog:!1});this.cone=new di(r,l),this.add(this.cone),this.update()}function Ba(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new Ar,n=[],i=[],o=new er(0,0,1),s=new er(0,1,0),a=0;a<t.length;a++){var l=t[a];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}r.addAttribute("position",new wr(n,3)),r.addAttribute("color",new wr(i,3));var c=new ui({vertexColors:_,depthTest:!1,depthWrite:!1,transparent:!0});di.call(this,r,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function ja(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new vo(t,4,2),i=new Lr({wireframe:!0,fog:!1});Ur.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function za(e,t){ar.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var r=new ui({fog:!1}),n=new Ar;n.addAttribute("position",new pr(new Float32Array(15),3)),this.line=new hi(n,r),this.add(this.line),this.update()}function Va(e,t,r){ar.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Ci(t);n.rotateY(.5*Math.PI),this.material=new Lr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=_);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new pr(o,3)),this.add(new Ur(n,this.material)),this.update()}function Ga(e,t,r,n){e=e||10,t=t||10,r=new er(void 0!==r?r:4473924),n=new er(void 0!==n?n:8947848);for(var i=t/2,o=e/t,s=e/2,a=[],l=[],c=0,u=0,h=-s;c<=t;c++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);var d=c===i?r:n;d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3}var p=new Ar;p.addAttribute("position",new wr(a,3)),p.addAttribute("color",new wr(l,3));var f=new ui({vertexColors:_});di.call(this,p,f)}function Ha(e,t,r,n,i,o){e=e||10,t=t||16,r=r||8,n=n||64,i=new er(void 0!==i?i:4473924),o=new er(void 0!==o?o:8947848);var s,a,l,c,u,h,d,p=[],f=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),s=Math.sin(l)*e,a=Math.cos(l)*e,p.push(0,0,0),p.push(s,0,a),d=1&c?i:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:o,h=e-e/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b);var m=new Ar;m.addAttribute("position",new wr(p,3)),m.addAttribute("color",new wr(f,3));var v=new ui({vertexColors:_});di.call(this,m,v)}function Wa(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=a.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Ar,c=new wr(2*s*3,3);l.addAttribute("position",c),di.call(this,l,new ui({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Xa(e,t,r){ar.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new Ar;n.addAttribute("position",new wr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new ui({fog:!1});this.lightPlane=new hi(n,i),this.add(this.lightPlane),(n=new Ar).addAttribute("position",new wr([0,0,0,0,0,1],3)),this.targetLine=new hi(n,i),this.add(this.targetLine),this.update()}function qa(e){var t=new Ar,r=new ui({color:16777215,vertexColors:w}),n=[],i=[],o={},s=new er(16755200),a=new er(16711680),l=new er(43775),c=new er(16777215),u=new er(3355443);function h(e,t,r){d(e,r),d(t,r)}function d(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.addAttribute("position",new wr(n,3)),t.addAttribute("color",new wr(i,3)),di.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Ya(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new Ar;i.setIndex(new pr(r,1)),i.addAttribute("position",new pr(n,3)),di.call(this,i,new ui({color:t})),this.matrixAutoUpdate=!1,this.update()}function Ja(e,t){this.type="Box3Helper",this.box=e;var r=void 0!==t?t:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Ar;i.setIndex(new pr(n,1)),i.addAttribute("position",new wr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),di.call(this,i,new ui({color:r})),this.geometry.computeBoundingSphere()}function Za(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new Ar;i.addAttribute("position",new wr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),hi.call(this,i,new ui({color:n}));var o=new Ar;o.addAttribute("position",new wr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Ur(o,new Lr({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Qa(e,t,r,n,i,o){ar.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===va&&((va=new Ar).addAttribute("position",new wr([0,0,0,0,1,0],3)),(ga=new Ao(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new hi(va,new ui({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ur(ga,new Lr({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,o)}function Ka(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Ar;r.addAttribute("position",new wr(t,3)),r.addAttribute("color",new wr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new ui({vertexColors:_});di.call(this,r,n)}function $a(e,t,r,n,i,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new ur(e,t,r,i,o,s)}Object.assign(ya.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(xa,{Composite:ya,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new xa.Composite(e,t,r):new xa(e,t,r)},sanitizeNodeName:function(){var e=new RegExp("[\\[\\]\\.:\\/]","g");return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^\\[\\]\\.:\\/]",t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",e),n=/(WCOD+)?/.source.replace("WCOD",t),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e),s=new RegExp("^"+r+n+i+o+"$"),a=["material","materials","bones"];return function(e){var t=s.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==a.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var o=n(i.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(xa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=xa.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var a=e[n];if(void 0!==a){var l=this.Versioning.None;void 0!==e.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(e.geometry.morphAttributes.position[s].name===i){i=s;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===i){i=s;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(xa.prototype,{_getValue_unbound:xa.prototype.getValue,_setValue_unbound:xa.prototype.setValue}),Object.assign(ba.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,s=this._bindings,a=s.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=n[d];if(void 0===p){p=t++,n[d]=p,e.push(h);for(var f=0,m=a;f!==m;++f)s[f].push(new xa(h,i[f],o[f]))}else if(p<r){l=e[p];var v=--r,g=e[v];n[g.uuid]=p,e[p]=g,n[d]=v,e[v]=h;for(f=0,m=a;f!==m;++f){var y=s[f],x=y[v],b=y[p];y[p]=x,void 0===b&&(b=new xa(h,i[f],o[f])),y[v]=b}}else e[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,s=arguments.length;o!==s;++o){var a=arguments[o],l=a.uuid,c=r[l];if(void 0!==c&&c>=t){var u=t++,h=e[u];r[h.uuid]=c,e[c]=h,r[l]=u,e[u]=a;for(var d=0,p=i;d!==p;++d){var f=n[d],m=f[u],v=f[c];f[c]=m,f[u]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,s=0,a=arguments.length;s!==a;++s){var l=arguments[s].uuid,c=n[l];if(void 0!==c)if(delete n[l],c<r){var u=--r,h=e[u],d=e[g=--t];n[h.uuid]=c,e[c]=h,n[d.uuid]=u,e[u]=d,e.pop();for(var p=0,f=o;p!==f;++p){var m=(y=i[p])[u],v=y[g];y[c]=m,y[u]=v,y.pop()}}else{var g;n[(d=e[g=--t]).uuid]=c,e[c]=d,e.pop();for(p=0,f=o;p!==f;++p){var y;(y=i[p])[c]=y[g],y.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);n=i.length,r[e]=n,o.push(e),s.push(t),i.push(u);for(var h=c,d=a.length;h!==d;++h){var p=a[h];u[h]=new xa(p,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=r,o[r]=a,o.pop(),i[r]=i[s],i.pop(),n[r]=n[s],n.pop()}}}),Object.assign(wa.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,o=i/n,s=n/i;e.warp(1,o,t),this.warp(s,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+r,l[0]=e/s,l[1]=t/s,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*r;if(o<0||0===r)return;this._startTime=null,t=r*o}t*=this._updateTimeScale(e);var s=this._updateTime(t),a=this._updateWeight(e);if(a>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(s),c[u].accumulate(n,a)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var r=this._clip.duration,n=this.loop,i=this._loopCount;if(n===pt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=n===mt;if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=r||t<0){var s=Math.floor(t/r);t-=r*s,i+=Math.abs(s);var a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1==(1&i))return this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=bt,n.endingEnd=bt):(n.endingStart=e?this.zeroSlopeAtStart?bt:xt:wt,n.endingEnd=t?this.zeroSlopeAtEnd?bt:xt:wt)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=r,this}}),_a.prototype=Object.assign(Object.create(n.prototype),{constructor:_a,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,o=e._propertyBindings,s=e._interpolants,a=r.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(c={},l[a]=c);for(var u=0;u!==i;++u){var h=n[u],d=h.name,p=c[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(p=new ma(xa.create(r,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,a,d),o[u]=p}s[u].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,o=0,s=i.length;o!==s;++o){var a=i[o];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],o=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,s=o[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[i];e:{for(var c in s)break e;delete o[n]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new Bs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Hs.findByName(r,e):e,o=null!==i?i.uuid:e,s=this._actionsByClip[o],a=null;if(void 0!==s){var l=s.actionByRoot[n];if(void 0!==l)return l;a=s.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var c=new wa(this,i,t);return this._bindAction(c,a),this._addInactiveAction(c,o,n),c},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Hs.findByName(r,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,s=0;s!==r;++s){t[s]._update(n,e,i,o)}var a=this._bindings,l=this._nActiveBindings;for(s=0;s!==l;++s)a[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,s=0,a=o.length;s!==a;++s){var l=o[s];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var s in o){var a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Sa.prototype.clone=function(){return new Sa(void 0===this.value.clone?this.value:this.value.clone())},Ta.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Ta,isInstancedBufferGeometry:!0,copy:function(e){return Ar.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(Ma.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ma.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),Object.defineProperty(Aa.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Aa.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Ea.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Ea,isInstancedInterleavedBuffer:!0,copy:function(e){return Aa.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Ca.prototype=Object.assign(Object.create(pr.prototype),{constructor:Ca,isInstancedBufferAttribute:!0,copy:function(e){return pr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Pa.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return Da(e,this,n,t),n.sort(Oa),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=e.length;i<o;i++)Da(e[i],this,n,t);return n.sort(Oa),n}}),Object.assign(Na.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(La.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Rt.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(Ia.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),Object.assign(Ra.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Ft;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Ft),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Ft),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Ft),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Ft),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Ft;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Fa.prototype=Object.create(ar.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isImmediateRenderObject=!0,ka.prototype=Object.create(di.prototype),ka.prototype.constructor=ka,ka.prototype.update=function(){var e=new Bt,t=new Bt,r=new jt;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,l=s.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=a[d[n[p]]],v=d.vertexNormals[p];e.copy(m).applyMatrix4(i),t.copy(v).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}else if(s&&s.isBufferGeometry){var g=s.attributes.position,y=s.attributes.normal;for(c=0,p=0,f=g.count;p<f;p++)e.set(g.getX(p),g.getY(p),g.getZ(p)).applyMatrix4(i),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}o.needsUpdate=!0}}(),Ua.prototype=Object.create(ar.prototype),Ua.prototype.constructor=Ua,Ua.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ua.prototype.update=function(){var e=new Bt,t=new Bt;return function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),Ba.prototype=Object.create(di.prototype),Ba.prototype.constructor=Ba,Ba.prototype.updateMatrixWorld=function(){var e=new Bt,t=new kt,r=new kt;return function(n){var i=this.bones,o=this.geometry,s=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var a=0,l=0;a<i.length;a++){var c=i[a];c.parent&&c.parent.isBone&&(t.multiplyMatrices(r,c.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(r,c.parent.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute("position").needsUpdate=!0,ar.prototype.updateMatrixWorld.call(this,n)}}(),ja.prototype=Object.create(Ur.prototype),ja.prototype.constructor=ja,ja.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ja.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},za.prototype=Object.create(ar.prototype),za.prototype.constructor=za,za.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},za.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=e,n[1]=-t,n[2]=0,n[3]=e,n[4]=t,n[5]=0,n[6]=-e,n[7]=t,n[8]=0,n[9]=-e,n[10]=-t,n[11]=0,n[12]=e,n[13]=-t,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},Va.prototype=Object.create(ar.prototype),Va.prototype.constructor=Va,Va.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Va.prototype.update=function(){var e=new Bt,t=new er,r=new er;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,s=i.count;o<s;o++){var a=o<s/2?t:r;i.setXYZ(o,a.r,a.g,a.b)}i.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Ga.prototype=Object.create(di.prototype),Ga.prototype.constructor=Ga,Ha.prototype=Object.create(di.prototype),Ha.prototype.constructor=Ha,Wa.prototype=Object.create(di.prototype),Wa.prototype.constructor=Wa,Wa.prototype.update=function(){var e=new Bt,t=new Bt,r=new jt;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,l=0,c=0,u=a.length;c<u;c++){var h=a[c],d=h.normal;e.copy(s[h.a]).add(s[h.b]).add(s[h.c]).divideScalar(3).applyMatrix4(n),t.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),i.setXYZ(l,e.x,e.y,e.z),l+=1,i.setXYZ(l,t.x,t.y,t.z),l+=1}i.needsUpdate=!0}}(),Xa.prototype=Object.create(ar.prototype),Xa.prototype.constructor=Xa,Xa.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Xa.prototype.update=function(){var e=new Bt,t=new Bt,r=new Bt;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),qa.prototype=Object.create(di.prototype),qa.prototype.constructor=qa,qa.prototype.update=function(){var e,t,r=new Bt,n=new lr;function i(i,o,s,a){r.set(o,s,a).unproject(n);var l=t[i];if(void 0!==l)for(var c=e.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],r.x,r.y,r.z)}return function(){e=this.geometry,t=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),Ya.prototype=Object.create(di.prototype),Ya.prototype.constructor=Ya,Ya.prototype.update=function(){var e=new qt;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,n=e.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Ya.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Ja.prototype=Object.create(di.prototype),Ja.prototype.constructor=Ja,Ja.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),ar.prototype.updateMatrixWorld.call(this,e))},Za.prototype=Object.create(hi.prototype),Za.prototype.constructor=Za,Za.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),ar.prototype.updateMatrixWorld.call(this,e)},Qa.prototype=Object.create(ar.prototype),Qa.prototype.constructor=Qa,Qa.prototype.setDirection=function(){var e,t=new Bt;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),Qa.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Qa.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Ka.prototype=Object.create(di.prototype),Ka.prototype.constructor=Ka;var el=0,tl=1;function rl(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function nl(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function il(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new mi(e,t)}function ol(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new oi(e)}function sl(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new mi(e,t)}function al(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new fi(e)}function ll(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new fi(e)}function cl(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new fi(e)}function ul(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Bt(e,t,r)}function hl(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new pr(e,t).setDynamic(!0)}function dl(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new fr(e,t)}function pl(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new mr(e,t)}function fl(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new vr(e,t)}function ml(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new gr(e,t)}function vl(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new yr(e,t)}function gl(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new xr(e,t)}function yl(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new br(e,t)}function xl(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new wr(e,t)}function bl(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new _r(e,t)}function wl(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ss.call(this,e),this.type="catmullrom",this.closed=!0}function _l(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ss.call(this,e),this.type="catmullrom"}function Sl(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ss.call(this,e),this.type="catmullrom"}function Tl(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Ka(e)}function Ml(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ya(e,t)}function Al(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new di(new To(e.geometry),new ui({color:void 0!==t?t:16777215}))}function El(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new di(new bi(e.geometry),new ui({color:void 0!==t?t:16777215}))}function Cl(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Xo(e)}function Pl(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Yo(e)}Ko.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ko.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(ys.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new dr,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new Bt(i.x,i.y,i.z||0))}return t}}),Object.assign(xs.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),wl.prototype=Object.create(ss.prototype),_l.prototype=Object.create(ss.prototype),Sl.prototype=Object.create(ss.prototype),Object.assign(Sl.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ga.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ba.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ys.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Js.extractUrlBase(e)}}),Object.assign(Ra.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(qt.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Fr.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Rt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Rt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Rt.ceilPowerOfTwo(e)}}),Object.assign(jt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(kt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new Bt),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,o)}}),Jt.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Ut.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Rr.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(kr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(kr,{barycoordFromPoint:function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),kr.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),kr.getNormal(e,t,r,n)}}),Object.assign(bs.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new uo(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new wo(this,e)}}),Object.assign(Ft.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Bt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Gt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(dr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(ar.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(ar.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(si.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ai.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Ko.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Qn.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ws.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(pr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Ar.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Ar.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Sa.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Nr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new er}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===y}}}),Object.defineProperties(Fo.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ir.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(ei.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(ei.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Xn.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ht.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties($n.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),da.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new la).load(e,function(e){t.setBuffer(e)}),this},fa.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ua.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Ol={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},Dl={crossOrigin:void 0,loadTexture:function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Qo;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,r,void 0,n);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Zo;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,r,void 0,n);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};function Nl(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function Ll(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}var Il={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function Rl(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}},Wr15:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=l(r("Yu7f")),o=r("qp2T"),s=r("pQYt"),a=l(r("Yd/J"));function l(e){return e&&e.__esModule?e:{default:e}}var c={},u=function(){function e(t,r,n){for(var l in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=r||e.defaultFragmentSrc,this._blendMode=s.BLEND_MODES.NORMAL,this.uniformData=n||(0,i.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler"),this.uniforms={},this.uniformData)this.uniforms[l]=this.uniformData[l].value,this.uniformData[l].type&&(this.uniformData[l].type=this.uniformData[l].type.toLowerCase());this.glShaders={},c[this.vertexSrc+this.fragmentSrc]||(c[this.vertexSrc+this.fragmentSrc]=(0,o.uid)()),this.glShaderKey=c[this.vertexSrc+this.fragmentSrc],this.padding=4,this.resolution=a.default.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0}return e.prototype.apply=function(e,t,r,n,i){e.applyFilter(this,t,r,n)},n(e,[{key:"blendMode",get:function(){return this._blendMode},set:function(e){this._blendMode=e}}],[{key:"defaultVertexSrc",get:function(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]),e}();t.default=u},Xwh9:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r("u62O")),o=s(r("1eSL"));function s(e){return e&&e.__esModule?e:{default:e}}var a=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),l=null;function c(){}var u=function(){function e(t,r,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof t||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");n=n||{},this._flags=0,this._setFlag(e.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=t,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===n.crossOrigin?"anonymous":n.crossOrigin,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=e.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=c,this._onLoadBinding=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this),this.onStart=new o.default,this.onProgress=new o.default,this.onComplete=new o.default,this.onAfterMiddleware=new o.default}return e.setExtensionLoadType=function(t,r){h(e._loadTypeMap,t,r)},e.setExtensionXhrType=function(t,r){h(e._xhrTypeMap,t,r)},e.prototype.complete=function(){if(this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(e.STATUS_FLAGS.COMPLETE,!0),this._setFlag(e.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e.prototype.abort=function(t){if(!this.error){if(this.error=new Error(t),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=e.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}},e.prototype.load=function(t){var r=this;if(!this.isLoading)if(this.isComplete)t&&setTimeout(function(){return t(r)},1);else switch(t&&this.onComplete.once(t),this._setFlag(e.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case e.LOAD_TYPE.IMAGE:this.type=e.TYPE.IMAGE,this._loadElement("image");break;case e.LOAD_TYPE.AUDIO:this.type=e.TYPE.AUDIO,this._loadSourceElement("audio");break;case e.LOAD_TYPE.VIDEO:this.type=e.TYPE.VIDEO,this._loadSourceElement("video");break;case e.LOAD_TYPE.XHR:default:a&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e.prototype._hasFlag=function(e){return!!(this._flags&e)},e.prototype._setFlag=function(e,t){this._flags=t?this._flags|e:this._flags&~e},e.prototype._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===e&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},e.prototype._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===e&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(e),null!==this.data){if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var t=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(e,this.url[r],Array.isArray(t)?t[r]:t));else{var n=this.metadata.mimeType;this.data.appendChild(this._createSource(e,this.url,Array.isArray(n)?n[0]:n))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()}else this.abort("Unsupported element: "+e)},e.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),this.xhrType===e.XHR_RESPONSE_TYPE.JSON||this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=e.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},e.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XDomainRequest;e.timeout=5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXdrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){return e.send()},1)},e.prototype._createSource=function(e,t,r){r||(r=e+"/"+this._getExtension(t));var n=document.createElement("source");return n.src=t,n.type=r,n},e.prototype._onError=function(e){this.abort("Failed to load element using: "+e.target.nodeName)},e.prototype._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(this,e.loaded/e.total)},e.prototype._xhrOnError=function(){var e=this.xhr;this.abort(d(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},e.prototype._xhrOnAbort=function(){this.abort(d(this.xhr)+" Request was aborted by the user.")},e.prototype._xdrOnTimeout=function(){this.abort(d(this.xhr)+" Request timed out.")},e.prototype._xhrOnLoad=function(){var t=this.xhr,r="",n=void 0===t.status?200:t.status;if(""!==t.responseType&&"text"!==t.responseType&&void 0!==t.responseType||(r=t.responseText),0===n&&(r.length>0||t.responseType===e.XHR_RESPONSE_TYPE.BUFFER)?n=200:1223===n&&(n=204),2===(n/100|0)){if(this.xhrType===e.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=e.TYPE.TEXT;else if(this.xhrType===e.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=e.TYPE.JSON}catch(e){return void this.abort("Error trying to parse loaded json: "+e)}else if(this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(r,"text/xml")}else{var o=document.createElement("div");o.innerHTML=r,this.data=o}this.type=e.TYPE.XML}catch(e){return void this.abort("Error trying to parse loaded xml: "+e)}else this.data=t.response||r;this.complete()}else this.abort("["+t.status+"] "+t.statusText+": "+t.responseURL)},e.prototype._determineCrossOrigin=function(e,t){if(0===e.indexOf("data:"))return"";t=t||window.location,l||(l=document.createElement("a")),l.href=e;var r=!(e=(0,i.default)(l.href,{strictMode:!0})).port&&""===t.port||e.port===t.port,n=e.protocol?e.protocol+":":"";return e.host===t.hostname&&r&&n===t.protocol?"":"anonymous"},e.prototype._determineXhrType=function(){return e._xhrTypeMap[this.extension]||e.XHR_RESPONSE_TYPE.TEXT},e.prototype._determineLoadType=function(){return e._loadTypeMap[this.extension]||e.LOAD_TYPE.XHR},e.prototype._getExtension=function(){var e=this.url,t="";if(this.isDataUrl){var r=e.indexOf("/");t=e.substring(r+1,e.indexOf(";",r))}else{var n=e.indexOf("?"),i=e.indexOf("#"),o=Math.min(n>-1?n:e.length,i>-1?i:e.length);t=(e=e.substring(0,o)).substring(e.lastIndexOf(".")+1)}return t.toLowerCase()},e.prototype._getMimeFromXhrType=function(t){switch(t){case e.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case e.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case e.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case e.XHR_RESPONSE_TYPE.JSON:return"application/json";case e.XHR_RESPONSE_TYPE.DEFAULT:case e.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},n(e,[{key:"isDataUrl",get:function(){return this._hasFlag(e.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(e.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(e.STATUS_FLAGS.LOADING)}}]),e}();function h(e,t,r){t&&0===t.indexOf(".")&&(t=t.substring(1)),t&&(e[t]=r)}function d(e){return e.toString().replace("object ","")}t.default=u,u.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},u.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},u.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},u.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},u._loadTypeMap={gif:u.LOAD_TYPE.IMAGE,png:u.LOAD_TYPE.IMAGE,bmp:u.LOAD_TYPE.IMAGE,jpg:u.LOAD_TYPE.IMAGE,jpeg:u.LOAD_TYPE.IMAGE,tif:u.LOAD_TYPE.IMAGE,tiff:u.LOAD_TYPE.IMAGE,webp:u.LOAD_TYPE.IMAGE,tga:u.LOAD_TYPE.IMAGE,svg:u.LOAD_TYPE.IMAGE,"svg+xml":u.LOAD_TYPE.IMAGE,mp3:u.LOAD_TYPE.AUDIO,ogg:u.LOAD_TYPE.AUDIO,wav:u.LOAD_TYPE.AUDIO,mp4:u.LOAD_TYPE.VIDEO,webm:u.LOAD_TYPE.VIDEO},u._xhrTypeMap={xhtml:u.XHR_RESPONSE_TYPE.DOCUMENT,html:u.XHR_RESPONSE_TYPE.DOCUMENT,htm:u.XHR_RESPONSE_TYPE.DOCUMENT,xml:u.XHR_RESPONSE_TYPE.DOCUMENT,tmx:u.XHR_RESPONSE_TYPE.DOCUMENT,svg:u.XHR_RESPONSE_TYPE.DOCUMENT,tsx:u.XHR_RESPONSE_TYPE.DOCUMENT,gif:u.XHR_RESPONSE_TYPE.BLOB,png:u.XHR_RESPONSE_TYPE.BLOB,bmp:u.XHR_RESPONSE_TYPE.BLOB,jpg:u.XHR_RESPONSE_TYPE.BLOB,jpeg:u.XHR_RESPONSE_TYPE.BLOB,tif:u.XHR_RESPONSE_TYPE.BLOB,tiff:u.XHR_RESPONSE_TYPE.BLOB,webp:u.XHR_RESPONSE_TYPE.BLOB,tga:u.XHR_RESPONSE_TYPE.BLOB,json:u.XHR_RESPONSE_TYPE.JSON,text:u.XHR_RESPONSE_TYPE.TEXT,txt:u.XHR_RESPONSE_TYPE.TEXT,ttf:u.XHR_RESPONSE_TYPE.BUFFER,otf:u.XHR_RESPONSE_TYPE.BUFFER},u.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},XypG:function(e,t){},Y12R:function(e,t,r){"use strict";t.__esModule=!0,t.BitmapText=t.TilingSpriteRenderer=t.TilingSprite=t.AnimatedSprite=void 0;var n=r("3r+V");Object.defineProperty(t,"AnimatedSprite",{enumerable:!0,get:function(){return a(n).default}});var i=r("h4Yq");Object.defineProperty(t,"TilingSprite",{enumerable:!0,get:function(){return a(i).default}});var o=r("pEa2");Object.defineProperty(t,"TilingSpriteRenderer",{enumerable:!0,get:function(){return a(o).default}});var s=r("QLbY");function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"BitmapText",{enumerable:!0,get:function(){return a(s).default}}),r("R2qm"),r("rvTR"),r("8eTQ")},Y8mV:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));r("2U8Y");var o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));return r.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],r.alpha=1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._loadMatrix=function(e){var t=e;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this._multiply(t,this.uniforms.m,e),t=this._colorMatrix(t)),this.uniforms.m=t},t.prototype._multiply=function(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e},t.prototype._colorMatrix=function(e){var t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t},t.prototype.brightness=function(e,t){var r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.greyscale=function(e,t){var r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.blackAndWhite=function(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)},t.prototype.hue=function(e,t){e=(e||0)/180*Math.PI;var r=Math.cos(e),n=Math.sin(e),i=1/3,o=(0,Math.sqrt)(i),s=[r+(1-r)*i,i*(1-r)-o*n,i*(1-r)+o*n,0,0,i*(1-r)+o*n,r+i*(1-r),i*(1-r)-o*n,0,0,i*(1-r)-o*n,i*(1-r)+o*n,r+i*(1-r),0,0,0,0,0,1,0];this._loadMatrix(s,t)},t.prototype.contrast=function(e,t){var r=(e||0)+1,n=-.5*(r-1),i=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(i,t)},t.prototype.saturate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1],r=2*e/3+1,n=-.5*(r-1),i=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(i,t)},t.prototype.desaturate=function(){this.saturate(-1)},t.prototype.negative=function(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)},t.prototype.sepia=function(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)},t.prototype.technicolor=function(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)},t.prototype.polaroid=function(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)},t.prototype.toBGR=function(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)},t.prototype.kodachrome=function(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)},t.prototype.browni=function(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)},t.prototype.vintage=function(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)},t.prototype.colorTone=function(e,t,r,n,i){e=e||.2,t=t||.15;var o=((r=r||16770432)>>16&255)/255,s=(r>>8&255)/255,a=(255&r)/255,l=((n=n||3375104)>>16&255)/255,c=(n>>8&255)/255,u=(255&n)/255,h=[.3,.59,.11,0,0,o,s,a,e,0,l,c,u,t,0,o-l,s-c,a-u,0,0];this._loadMatrix(h,i)},t.prototype.night=function(e,t){var r=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.predator=function(e,t){var r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.lsd=function(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)},t.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},n(t,[{key:"matrix",get:function(){return this.uniforms.m},set:function(e){this.uniforms.m=e}},{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e}}]),t}(i.Filter);t.default=o,o.prototype.grayscale=o.prototype.greyscale},YcCt:function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,i){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var c=0;c<l;++c){var u,h,d,p,f=e[c].replace(s,"%20"),m=f.indexOf(r);m>=0?(u=f.substr(0,m),h=f.substr(m+1)):(u=f,h=""),d=decodeURIComponent(u),p=decodeURIComponent(h),n(o,d)?Array.isArray(o[d])?o[d].push(p):o[d]=[o[d],p]:o[d]=p}return o}},"Yd/J":function(e,t,r){"use strict";t.__esModule=!0;var n=o(r("xqnD")),i=o(r("JLJ9"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,n.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1,width:800,height:600,legacy:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,i.default)(),MESH_CANVAS_PADDING:0}},Yiwd:function(e,t,r){"use strict";t.__esModule=!0;var n=r("bx0q");Object.defineProperty(t,"accessibleTarget",{enumerable:!0,get:function(){return o(n).default}});var i=r("2AE7");function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"AccessibilityManager",{enumerable:!0,get:function(){return o(i).default}})},YnQD:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("d07J");var o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return r.position=new i.Point(0,0),r.scale=new i.Point(1,1),r.skew=new i.ObservablePoint(r.updateSkew,r,0,0),r.pivot=new i.Point(0,0),r._rotation=0,r._cx=1,r._sx=0,r._cy=0,r._sy=1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x)},t.prototype.updateLocalTransform=function(){var e=this.localTransform;e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d)},t.prototype.updateTransform=function(e){var t=this.localTransform;t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d);var r=e.worldTransform,n=this.worldTransform;n.a=t.a*r.a+t.b*r.c,n.b=t.a*r.b+t.b*r.d,n.c=t.c*r.a+t.d*r.c,n.d=t.c*r.b+t.d*r.d,n.tx=t.tx*r.a+t.ty*r.c+r.tx,n.ty=t.tx*r.b+t.ty*r.d+r.ty,this._worldID++},t.prototype.setFromMatrix=function(e){e.decompose(this)},n(t,[{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation=e,this.updateSkew()}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(r("KByU")).default);t.default=o},Yu7f:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t,r){var n=i(e),o=i(t);return Object.assign(n,o)};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("yI/K")).default.shader.defaultValue;function i(e){for(var t=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"),r={},i=void 0,o=e.replace(/\s+/g," ").split(/\s*;\s*/),s=0;s<o.length;s++){var a=o[s].trim();if(a.indexOf("uniform")>-1){var l=a.split(" "),c=l[1],u=l[2],h=1;u.indexOf("[")>-1&&(u=(i=u.split(/\[|]/))[0],h*=Number(i[1])),u.match(t)||(r[u]={value:n(c,h),name:u,type:c})}}return r}},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},Yvos:function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},Z0PJ:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=p(r("jQCb")),o=p(r("xJsK")),s=r("d07J"),a=r("qp2T"),l=r("pQYt"),c=p(r("Yd/J")),u=p(r("vUM4")),h=p(r("TR3/")),d=p(r("/HYg"));function p(e){return e&&e.__esModule?e:{default:e}}var f={texture:!0,children:!1,baseTexture:!0},m=function(e){function t(r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=i||document.createElement("canvas")).width=3,i.height=3;var a=o.default.fromCanvas(i,c.default.SCALE_MODE,"text");a.orig=new s.Rectangle,a.trim=new s.Rectangle;var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,a));return o.default.addToCache(l._texture,l._texture.baseTexture.textureCacheIds[0]),l.canvas=i,l.context=l.canvas.getContext("2d"),l.resolution=c.default.RESOLUTION,l._text=null,l._style=null,l._styleListener=null,l._font="",l.text=r,l.style=n,l.localStyleID=-1,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.updateText=function(e){var t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),this.dirty||!e){this._font=this._style.toFontString();var r=this.context,n=h.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas),i=n.width,o=n.height,s=n.lines,a=n.lineHeight,l=n.lineWidths,c=n.maxLineWidth,u=n.fontProperties;this.canvas.width=Math.ceil((Math.max(1,i)+2*t.padding)*this.resolution),this.canvas.height=Math.ceil((Math.max(1,o)+2*t.padding)*this.resolution),r.scale(this.resolution,this.resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.strokeStyle=t.stroke,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;var d=void 0,p=void 0;if(t.dropShadow){r.fillStyle=t.dropShadowColor,r.globalAlpha=t.dropShadowAlpha,r.shadowBlur=t.dropShadowBlur,t.dropShadowBlur>0&&(r.shadowColor=t.dropShadowColor);for(var f=Math.cos(t.dropShadowAngle)*t.dropShadowDistance,m=Math.sin(t.dropShadowAngle)*t.dropShadowDistance,v=0;v<s.length;v++)d=t.strokeThickness/2,p=t.strokeThickness/2+v*a+u.ascent,"right"===t.align?d+=c-l[v]:"center"===t.align&&(d+=(c-l[v])/2),t.fill&&(this.drawLetterSpacing(s[v],d+f+t.padding,p+m+t.padding),t.stroke&&t.strokeThickness&&(r.strokeStyle=t.dropShadowColor,this.drawLetterSpacing(s[v],d+f+t.padding,p+m+t.padding,!0),r.strokeStyle=t.stroke))}r.shadowBlur=0,r.globalAlpha=1,r.fillStyle=this._generateFillStyle(t,s);for(var g=0;g<s.length;g++)d=t.strokeThickness/2,p=t.strokeThickness/2+g*a+u.ascent,"right"===t.align?d+=c-l[g]:"center"===t.align&&(d+=(c-l[g])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(s[g],d+t.padding,p+t.padding,!0),t.fill&&this.drawLetterSpacing(s[g],d+t.padding,p+t.padding);this.updateTexture()}},t.prototype.drawLetterSpacing=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this._style.letterSpacing;if(0!==i)for(var o=String.prototype.split.call(e,""),s=t,a=0,l="";a<e.length;)l=o[a++],n?this.context.strokeText(l,s,r):this.context.fillText(l,s,r),s+=this.context.measureText(l).width+i;else n?this.context.strokeText(e,t,r):this.context.fillText(e,t,r)},t.prototype.updateTexture=function(){var e=this.canvas;if(this._style.trim){var t=(0,d.default)(e);e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0)}var r=this._texture,n=this._style,i=n.trim?0:n.padding,o=r.baseTexture;o.hasLoaded=!0,o.resolution=this.resolution,o.realWidth=e.width,o.realHeight=e.height,o.width=e.width/this.resolution,o.height=e.height/this.resolution,r.trim.width=r._frame.width=e.width/this.resolution,r.trim.height=r._frame.height=e.height/this.resolution,r.trim.x=-i,r.trim.y=-i,r.orig.width=r._frame.width-2*i,r.orig.height=r._frame.height-2*i,this._onTextureUpdate(),o.emit("update",o),this.dirty=!1},t.prototype.renderWebGL=function(t){this.resolution!==t.resolution&&(this.resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype.renderWebGL.call(this,t)},t.prototype._renderCanvas=function(t){this.resolution!==t.resolution&&(this.resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype._renderCanvas.call(this,t)},t.prototype.getLocalBounds=function(t){return this.updateText(!0),e.prototype.getLocalBounds.call(this,t)},t.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},t.prototype._onStyleChange=function(){this.dirty=!0},t.prototype._generateFillStyle=function(e,t){if(!Array.isArray(e.fill))return e.fill;if(navigator.isCocoonJS)return e.fill[0];var r=void 0,n=void 0,i=void 0,o=void 0,s=this.canvas.width/this.resolution,a=this.canvas.height/this.resolution,c=e.fill.slice(),u=e.fillGradientStops.slice();if(!u.length)for(var h=c.length+1,d=1;d<h;++d)u.push(d/h);if(c.unshift(e.fill[0]),u.unshift(0),c.push(e.fill[e.fill.length-1]),u.push(1),e.fillGradientType===l.TEXT_GRADIENT.LINEAR_VERTICAL){r=this.context.createLinearGradient(s/2,0,s/2,a),n=(c.length+1)*t.length,i=0;for(var p=0;p<t.length;p++){i+=1;for(var f=0;f<c.length;f++)o="number"==typeof u[f]?u[f]/t.length+p/t.length:i/n,r.addColorStop(o,c[f]),i++}}else{r=this.context.createLinearGradient(0,a/2,s,a/2),n=c.length+1,i=1;for(var m=0;m<c.length;m++)o="number"==typeof u[m]?u[m]:i/n,r.addColorStop(o,c[m]),i++}return r},t.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},f,t),e.prototype.destroy.call(this,t),this.context=null,this.canvas=null,this._style=null},n(t,[{key:"width",get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){this.updateText(!0);var t=(0,a.sign)(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}},{key:"height",get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){this.updateText(!0);var t=(0,a.sign)(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}},{key:"style",get:function(){return this._style},set:function(e){(e=e||{})instanceof u.default?this._style=e:this._style=new u.default(e),this.localStyleID=-1,this.dirty=!0}},{key:"text",get:function(){return this._text},set:function(e){e=String(""===e||null===e||void 0===e?" ":e),this._text!==e&&(this._text=e,this.dirty=!0)}}]),t}(i.default);t.default=m},"a/Ns":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("qp2T");var o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return r.children=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onChildrenChange=function(){},t.prototype.addChild=function(e){var t=arguments.length;if(t>1)for(var r=0;r<t;r++)this.addChild(arguments[r]);else e.parent&&e.parent.removeChild(e),e.parent=this,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),e.emit("added",this);return e},t.prototype.addChildAt=function(e,t){if(t<0||t>this.children.length)throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),e.parent=this,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),e},t.prototype.swapChildren=function(e,t){if(e!==t){var r=this.getChildIndex(e),n=this.getChildIndex(t);this.children[r]=t,this.children[n]=e,this.onChildrenChange(r<n?r:n)}},t.prototype.getChildIndex=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},t.prototype.setChildIndex=function(e,t){if(t<0||t>=this.children.length)throw new Error("The index "+t+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(e);(0,i.removeItems)(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)},t.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},t.prototype.removeChild=function(e){var t=arguments.length;if(t>1)for(var r=0;r<t;r++)this.removeChild(arguments[r]);else{var n=this.children.indexOf(e);if(-1===n)return null;e.parent=null,e.transform._parentID=-1,(0,i.removeItems)(this.children,n,1),this._boundsID++,this.onChildrenChange(n),e.emit("removed",this)}return e},t.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,(0,i.removeItems)(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),t},t.prototype.removeChildren=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1],r=e,n="number"==typeof t?t:this.children.length,i=n-r,o=void 0;if(i>0&&i<=n){o=this.children.splice(r,i);for(var s=0;s<o.length;++s)o[s].parent=null,o[s].transform&&(o[s].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(var a=0;a<o.length;++a)o[a].emit("removed",this);return o}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},t.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,t=this.children.length;e<t;++e){var r=this.children[e];r.visible&&r.updateTransform()}},t.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var t=this.children[e];t.visible&&t.renderable&&(t.calculateBounds(),t._mask?(t._mask.calculateBounds(),this._bounds.addBoundsMask(t._bounds,t._mask._bounds)):t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds))}this._lastBoundsID=this._boundsID},t.prototype._calculateBounds=function(){},t.prototype.renderWebGL=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(e);else{this._renderWebGL(e);for(var t=0,r=this.children.length;t<r;++t)this.children[t].renderWebGL(e)}},t.prototype.renderAdvancedWebGL=function(e){e.flush();var t=this._filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var n=0;n<t.length;n++)t[n].enabled&&this._enabledFilters.push(t[n]);this._enabledFilters.length&&e.filterManager.pushFilter(this,this._enabledFilters)}r&&e.maskManager.pushMask(this,this._mask),this._renderWebGL(e);for(var i=0,o=this.children.length;i<o;i++)this.children[i].renderWebGL(e);e.flush(),r&&e.maskManager.popMask(this,this._mask),t&&this._enabledFilters&&this._enabledFilters.length&&e.filterManager.popFilter()},t.prototype._renderWebGL=function(e){},t.prototype._renderCanvas=function(e){},t.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&e.maskManager.pushMask(this._mask),this._renderCanvas(e);for(var t=0,r=this.children.length;t<r;++t)this.children[t].renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.prototype.destroy=function(t){e.prototype.destroy.call(this);var r="boolean"==typeof t?t:t&&t.children,n=this.removeChildren(0,this.children.length);if(r)for(var i=0;i<n.length;++i)n[i].destroy(t)},n(t,[{key:"width",get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}},{key:"height",get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(r("2IYi")).default);t.default=o,o.prototype.containerUpdateTransform=o.prototype.updateTransform},a7XB:function(e,t,r){"use strict";Number.isInteger||(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e})},ad8U:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location;if(0===e.indexOf("data:"))return"";t=t||window.location,i||(i=document.createElement("a"));i.href=e;var r=!(e=n.default.parse(i.href)).port&&""===t.port||e.port===t.port;if(e.hostname!==t.hostname||!r||e.protocol!==t.protocol)return"anonymous";return""};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("CxY0"));var i=void 0},akSB:function(e,t,r){var n=r("AdPF"),i=r("0z79"),o=r("Cl5A"),s=r("CIKq");t.polling=function(e){var t=!1,r=!1,s=!1!==e.jsonp;if(global.location){var a="https:"===location.protocol,l=location.port;l||(l=a?443:80),t=e.hostname!==location.hostname||l!==e.port,r=e.secure!==a}if(e.xdomain=t,e.xscheme=r,"open"in new n(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new o(e)},t.websocket=s},aq8N:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t,r){var s=e.shape,a=s.x,l=s.y,c=void 0,u=void 0;e.type===i.SHAPES.CIRC?(c=s.radius,u=s.radius):(c=s.width,u=s.height);if(0===c||0===u)return;var h=Math.floor(30*Math.sqrt(s.radius))||Math.floor(15*Math.sqrt(s.width+s.height)),d=2*Math.PI/h;if(e.fill){var p=(0,o.hex2rgb)(e.fillColor),f=e.fillAlpha,m=p[0]*f,v=p[1]*f,g=p[2]*f,y=t.points,x=t.indices,b=y.length/6;x.push(b);for(var w=0;w<h+1;w++)y.push(a,l,m,v,g,f),y.push(a+Math.sin(d*w)*c,l+Math.cos(d*w)*u,m,v,g,f),x.push(b++,b++);x.push(b-1)}if(e.lineWidth){var _=e.points;e.points=[];for(var S=0;S<h+1;S++)e.points.push(a+Math.sin(d*S)*c,l+Math.cos(d*S)*u);(0,n.default)(e,t,r),e.points=_}};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("5OzF")),i=r("pQYt"),o=r("qp2T")},"bY+x":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=r}return e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copy=function(e){this.set(e.x,e.y)},e.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},e.prototype.set=function(e,t){this.x=e||0,this.y=t||(0!==t?this.x:0)},e}();t.default=n},bwp9:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("bY+x")),i=r("pQYt");var o=function(){function e(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Array.isArray(r[0])&&(r=r[0]),r[0]instanceof n.default){for(var s=[],a=0,l=r.length;a<l;a++)s.push(r[a].x,r[a].y);r=s}this.closed=!0,this.points=r,this.type=i.SHAPES.POLY}return e.prototype.clone=function(){return new e(this.points.slice())},e.prototype.close=function(){var e=this.points;e[0]===e[e.length-2]&&e[1]===e[e.length-1]||e.push(e[0],e[1])},e.prototype.contains=function(e,t){for(var r=!1,n=this.points.length/2,i=0,o=n-1;i<n;o=i++){var s=this.points[2*i],a=this.points[2*i+1],l=this.points[2*o],c=this.points[2*o+1];a>t!=c>t&&e<(t-a)/(c-a)*(l-s)+s&&(r=!r)}return r},e}();t.default=o},bx0q:function(e,t,r){"use strict";t.__esModule=!0,t.default={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},"c/UO":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t){var r=Math.ceil(e/2),i=n,o="",s=void 0;s=t?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<e;a++){var l=s.replace("%index%",a);l=l.replace("%sampleIndex%",a-(r-1)+".0"),o+=l,o+="\n"}return i=(i=i.replace("%blur%",o)).replace("%size%",e)};var n=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n")},cD5x:function(e,t,r){var n=r("49sm"),i=r("+SKG"),o=Object.prototype.toString,s="function"==typeof global.Blob||"[object BlobConstructor]"===o.call(global.Blob),a="function"==typeof global.File||"[object FileConstructor]"===o.call(global.File);t.deconstructPacket=function(e){var t=[],r=e.data,o=e;return o.data=function e(t,r){if(!t)return t;if(i(t)){var o={_placeholder:!0,num:r.length};return r.push(t),o}if(n(t)){for(var s=new Array(t.length),a=0;a<t.length;a++)s[a]=e(t[a],r);return s}if("object"==typeof t&&!(t instanceof Date)){var s={};for(var l in t)s[l]=e(t[l],r);return s}return t}(r,t),o.attachments=t.length,{packet:o,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,r){if(!t)return t;if(t&&t._placeholder)return r[t.num];if(n(t))for(var i=0;i<t.length;i++)t[i]=e(t[i],r);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],r);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var r=0,o=e;!function e(l,c,u){if(!l)return l;if(s&&l instanceof Blob||a&&l instanceof File){r++;var h=new FileReader;h.onload=function(){u?u[c]=this.result:o=this.result,--r||t(o)},h.readAsArrayBuffer(l)}else if(n(l))for(var d=0;d<l.length;d++)e(l[d],d,l);else if("object"==typeof l&&!i(l))for(var p in l)e(l[p],p,l)}(o),r||t(o)}},cQc6:function(e,t){e.exports=function(e,t){for(var r=e[0],n=e[1],i=!1,o=0,s=t.length-1;o<t.length;s=o++){var a=t[o][0],l=t[o][1],c=t[s][0],u=t[s][1];l>n!=u>n&&r<(c-a)*(n-l)/(u-l)+a&&(i=!i)}return i}},cpc2:function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},crnd:function(e,t){function r(e){return Promise.resolve().then(function(){var t=new Error('Cannot find module "'+e+'".');throw t.code="MODULE_NOT_FOUND",t})}r.keys=function(){return[]},r.resolve=r,e.exports=r,r.id="crnd"},cva9:function(e,t,r){"use strict";t.__esModule=!0;var n=r("pQYt");var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t}return e.prototype.pushMask=function(e){var t=this.renderer;t.context.save();var r=e.alpha,n=e.transform.worldTransform,i=t.resolution;t.context.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*i,n.ty*i),e._texture||(this.renderGraphicsShape(e),t.context.clip()),e.worldAlpha=r},e.prototype.renderGraphicsShape=function(e){var t=this.renderer.context,r=e.graphicsData.length;if(0!==r){t.beginPath();for(var i=0;i<r;i++){var o=e.graphicsData[i],s=o.shape;if(o.type===n.SHAPES.POLY){var a=s.points;t.moveTo(a[0],a[1]);for(var l=1;l<a.length/2;l++)t.lineTo(a[2*l],a[2*l+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&t.closePath()}else if(o.type===n.SHAPES.RECT)t.rect(s.x,s.y,s.width,s.height),t.closePath();else if(o.type===n.SHAPES.CIRC)t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath();else if(o.type===n.SHAPES.ELIP){var c=2*s.width,u=2*s.height,h=s.x-c/2,d=s.y-u/2,p=c/2*.5522848,f=u/2*.5522848,m=h+c,v=d+u,g=h+c/2,y=d+u/2;t.moveTo(h,y),t.bezierCurveTo(h,y-f,g-p,d,g,d),t.bezierCurveTo(g+p,d,m,y-f,m,y),t.bezierCurveTo(m,y+f,g+p,v,g,v),t.bezierCurveTo(g-p,v,h,y+f,h,y),t.closePath()}else if(o.type===n.SHAPES.RREC){var x=s.x,b=s.y,w=s.width,_=s.height,S=s.radius,T=Math.min(w,_)/2|0;S=S>T?T:S,t.moveTo(x,b+S),t.lineTo(x,b+_-S),t.quadraticCurveTo(x,b+_,x+S,b+_),t.lineTo(x+w-S,b+_),t.quadraticCurveTo(x+w,b+_,x+w,b+_-S),t.lineTo(x+w,b+S),t.quadraticCurveTo(x+w,b,x+w-S,b),t.lineTo(x+S,b),t.quadraticCurveTo(x,b,x,b+S),t.closePath()}}}},e.prototype.popMask=function(e){e.context.restore(),e.invalidateBlendMode()},e.prototype.destroy=function(){},e}();t.default=i},d07J:function(e,t,r){"use strict";t.__esModule=!0;var n=r("bY+x");Object.defineProperty(t,"Point",{enumerable:!0,get:function(){return d(n).default}});var i=r("HP7h");Object.defineProperty(t,"ObservablePoint",{enumerable:!0,get:function(){return d(i).default}});var o=r("+HqX");Object.defineProperty(t,"Matrix",{enumerable:!0,get:function(){return d(o).default}});var s=r("/zO6");Object.defineProperty(t,"GroupD8",{enumerable:!0,get:function(){return d(s).default}});var a=r("W3bV");Object.defineProperty(t,"Circle",{enumerable:!0,get:function(){return d(a).default}});var l=r("qEO2");Object.defineProperty(t,"Ellipse",{enumerable:!0,get:function(){return d(l).default}});var c=r("bwp9");Object.defineProperty(t,"Polygon",{enumerable:!0,get:function(){return d(c).default}});var u=r("TXE8");Object.defineProperty(t,"Rectangle",{enumerable:!0,get:function(){return d(u).default}});var h=r("iEUh");function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"RoundedRectangle",{enumerable:!0,get:function(){return d(h).default}})},d6Os:function(e,t,r){"use strict";t.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.blobMiddlewareFactory=function(){return function(e,t){if(e.data){if(e.xhr&&e.xhrType===i.default.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof e.data){if(0===e.data.type.indexOf("image")){var r=function(){var r=a.createObjectURL(e.data);return e.blob=e.data,e.data=new Image,e.data.src=r,e.type=i.default.TYPE.IMAGE,e.data.onload=function(){a.revokeObjectURL(r),e.data.onload=null,t()},{v:void 0}}();if("object"===(void 0===r?"undefined":n(r)))return r.v}}else{var s=e.xhr.getResponseHeader("content-type");if(s&&0===s.indexOf("image"))return e.data=new Image,e.data.src="data:"+s+";base64,"+o.default.encodeBinary(e.xhr.responseText),e.type=i.default.TYPE.IMAGE,void(e.data.onload=function(){e.data.onload=null,t()})}t()}else t()}};var i=s(r("Xwh9")),o=s(r("s1jd"));function s(e){return e&&e.__esModule?e:{default:e}}var a=window.URL||window.webkitURL},dGcs:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){for(var e=[],t=[],r=0;r<32;r++)e[r]=r,t[r]=r;e[n.BLEND_MODES.NORMAL_NPM]=n.BLEND_MODES.NORMAL,e[n.BLEND_MODES.ADD_NPM]=n.BLEND_MODES.ADD,e[n.BLEND_MODES.SCREEN_NPM]=n.BLEND_MODES.SCREEN,t[n.BLEND_MODES.NORMAL]=n.BLEND_MODES.NORMAL_NPM,t[n.BLEND_MODES.ADD]=n.BLEND_MODES.ADD_NPM,t[n.BLEND_MODES.SCREEN]=n.BLEND_MODES.SCREEN_NPM;var i=[];return i.push(t),i.push(e),i};var n=r("pQYt")},"dkv/":function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},dyai:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=a(r("I42F")),s=a(r("ASAs"));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(r,n,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return c.blurXFilter=new o.default(r,n,a,l),c.blurYFilter=new s.default(r,n,a,l),c.padding=0,c.resolution=a||i.settings.RESOLUTION,c.quality=n||4,c.blur=r||8,c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.apply=function(e,t,r){var n=e.getRenderTarget(!0);this.blurXFilter.apply(e,t,n,!0),this.blurYFilter.apply(e,n,r,!1),e.returnRenderTarget(n)},n(t,[{key:"blur",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"quality",get:function(){return this.blurXFilter.quality},set:function(e){this.blurXFilter.quality=this.blurYFilter.quality=e}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blendMode",get:function(){return this.blurYFilter._blendMode},set:function(e){this.blurYFilter._blendMode=e}}]),t}(i.Filter);t.default=l},e8hs:function(e,t,r){"use strict";t.__esModule=!0;var n=c(r("z+eP")),i=r("d6Os"),o=c(r("uhBA")),s=c(r("SLIe")),a=c(r("Nx1p")),l=c(r("oXL5"));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,n));o.default.call(i);for(var s=0;s<t._pixiMiddleware.length;++s)i.use(t._pixiMiddleware[s]());return i.onStart.add(function(e){return i.emit("start",e)}),i.onProgress.add(function(e,t){return i.emit("progress",e,t)}),i.onError.add(function(e,t,r){return i.emit("error",e,t,r)}),i.onLoad.add(function(e,t){return i.emit("load",e,t)}),i.onComplete.add(function(e,t){return i.emit("complete",e,t)}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.addPixiMiddleware=function(e){t._pixiMiddleware.push(e)},t.prototype.destroy=function(){this.removeAllListeners(),this.reset()},t}(n.default);for(var h in t.default=u,o.default.prototype)u.prototype[h]=o.default.prototype[h];u._pixiMiddleware=[i.blobMiddlewareFactory,s.default,a.default,l.default];var d=n.default.Resource;d.setExtensionXhrType("fnt",d.XHR_RESPONSE_TYPE.DOCUMENT)},eIHw:function(e,t,r){"use strict";t.__esModule=!0;var n=i(r("WJwb"));function i(e){return e&&e.__esModule?e:{default:e}}var o=function(e){function t(r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=null;if(!(r instanceof n.default)){var s=arguments[1],a=arguments[2],l=arguments[3],c=arguments[4];console.warn("Please use RenderTexture.create("+s+", "+a+") instead of the ctor directly."),o=arguments[0],i=null,r=new n.default(s,a,l,c)}var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,i));return u.legacyRenderer=o,u.valid=!0,u._updateUvs(),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.resize=function(e,t,r){e=Math.ceil(e),t=Math.ceil(t),this.valid=e>0&&t>0,this._frame.width=this.orig.width=e,this._frame.height=this.orig.height=t,r||this.baseTexture.resize(e,t),this._updateUvs()},t.create=function(e,r,i,o){return new t(new n.default(e,r,i,o))},t}(i(r("xJsK")).default);t.default=o},eOtv:function(e,t,r){var n=r("lKxJ"),i=r("KFGy"),o=r("cpc2"),s=r("Vo14"),a=r("2Dig"),l=r("QN7Q"),c=r("NOtv")("socket.io-client:manager"),u=r("7jRU"),h=r("C2QD"),d=Object.prototype.hasOwnProperty;function p(e,t){if(!(this instanceof p))return new p(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||s;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=p,p.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)d.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},p.prototype.updateSocketIds=function(){for(var e in this.nsps)d.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},p.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},o(p.prototype),p.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},p.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},p.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(e,t){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=a(r,"open",function(){i.onopen(),e&&e()}),s=a(r,"error",function(t){if(c("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;c("connect attempt will timeout after %d",l);var u=setTimeout(function(){c("connect attempt timed out after %d",l),o.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(o),this.subs.push(s),this},p.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",l(this,"ondata"))),this.subs.push(a(e,"ping",l(this,"onping"))),this.subs.push(a(e,"pong",l(this,"onpong"))),this.subs.push(a(e,"error",l(this,"onerror"))),this.subs.push(a(e,"close",l(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",l(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(e){this.decoder.add(e)},p.prototype.ondecoded=function(e){this.emit("packet",e)},p.prototype.onerror=function(e){c("error",e),this.emitAll("error",e)},p.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new i(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",o),r.on("connect",function(){r.id=n.generateId(e)}),this.autoConnect&&o()}function o(){~u(n.connecting,r)||n.connecting.push(r)}return r},p.prototype.destroy=function(e){var t=u(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},p.prototype.packet=function(e){c("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},p.prototype.cleanup=function(){c("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(e){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();c("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){e.skipReconnect||(c("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(c("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(c("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},p.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},"ew+k":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t[n.DRAW_MODES.POINTS]=e.POINTS,t[n.DRAW_MODES.LINES]=e.LINES,t[n.DRAW_MODES.LINE_LOOP]=e.LINE_LOOP,t[n.DRAW_MODES.LINE_STRIP]=e.LINE_STRIP,t[n.DRAW_MODES.TRIANGLES]=e.TRIANGLES,t[n.DRAW_MODES.TRIANGLE_STRIP]=e.TRIANGLE_STRIP,t[n.DRAW_MODES.TRIANGLE_FAN]=e.TRIANGLE_FAN,t};var n=r("pQYt")},fOGm:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("yI/K"));var i=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=n.default.GLBuffer.createVertexBuffer(t),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(t),this.dirty=!0,this.nativeLines=!1,this.glPoints=null,this.glIndices=null,this.shader=r,this.vao=new n.default.VertexArrayObject(t,i).addIndex(this.indexBuffer).addAttribute(this.buffer,r.attributes.aVertexPosition,t.FLOAT,!1,24,0).addAttribute(this.buffer,r.attributes.aColor,t.FLOAT,!1,24,8)}return e.prototype.reset=function(){this.points.length=0,this.indices.length=0},e.prototype.upload=function(){this.glPoints=new Float32Array(this.points),this.buffer.upload(this.glPoints),this.glIndices=new Uint16Array(this.indices),this.indexBuffer.upload(this.glIndices),this.dirty=!1},e.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.vao.destroy(),this.buffer.destroy(),this.indexBuffer.destroy(),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null},e}();t.default=i},fS4Z:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));r("2U8Y");var o=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=new i.Matrix;r.renderable=!1;var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));return s.maskSprite=r,s.maskMatrix=o,s.uniforms.mapSampler=r._texture,s.uniforms.filterMatrix=o,s.uniforms.scale={x:1,y:1},null!==n&&void 0!==n||(n=20),s.scale=new i.Point(n,n),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.apply=function(e,t,r){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y,e.applyFilter(this,t,r)},n(t,[{key:"map",get:function(){return this.uniforms.mapSampler},set:function(e){this.uniforms.mapSampler=e}}]),t}(i.Filter);t.default=o},fsTW:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.maxMilliseconds=t,this.frameStart=0}return e.prototype.beginFrame=function(){this.frameStart=Date.now()},e.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},e}();t.default=n},fvlo:function(e,t,r){"use strict";t.__esModule=!0;var n=r("45ci");Object.defineProperty(t,"InteractionData",{enumerable:!0,get:function(){return l(n).default}});var i=r("leuX");Object.defineProperty(t,"InteractionManager",{enumerable:!0,get:function(){return l(i).default}});var o=r("4miC");Object.defineProperty(t,"interactiveTarget",{enumerable:!0,get:function(){return l(o).default}});var s=r("inOm");Object.defineProperty(t,"InteractionTrackingData",{enumerable:!0,get:function(){return l(s).default}});var a=r("1td8");function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"InteractionEvent",{enumerable:!0,get:function(){return l(a).default}})},g57C:function(e,t,r){"use strict";function n(e){var t=document.createElement("canvas");t.width=6,t.height=1;var r=t.getContext("2d");return r.fillStyle=e,r.fillRect(0,0,6,1),t}t.__esModule=!0,t.default=function(){if("undefined"==typeof document)return!1;var e=n("#ff00ff"),t=n("#ffff00"),r=document.createElement("canvas");r.width=6,r.height=1;var i=r.getContext("2d");i.globalCompositeOperation="multiply",i.drawImage(e,0,0),i.drawImage(t,2,0);var o=i.getImageData(2,0,1,1);if(!o)return!1;var s=o.data;return 255===s[0]&&0===s[1]&&0===s[2]}},g5Dd:function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),i=n.length,o="";for(r=0;r<i;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,i,o,s,a=.75*e.length,l=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(t=0;t<l;t+=4)n=r[e.charCodeAt(t)],i=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],s=r[e.charCodeAt(t+3)],h[c++]=n<<2|i>>4,h[c++]=(15&i)<<4|o>>2,h[c++]=(3&o)<<6|63&s;return u}}()},gFX4:function(e,t,r){var n=r("zJ60"),i=r("Vo14"),o=r("eOtv"),s=r("NOtv")("socket.io-client");e.exports=t=l;var a=t.managers={};function l(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,i=n(e),l=i.source,c=i.id,u=i.path,h=a[c]&&u in a[c].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||h?(s("ignoring socket cache for %s",l),r=o(l,t)):(a[c]||(s("new io instance for %s",l),a[c]=o(l,t)),r=a[c]),i.query&&!t.query&&(t.query=i.query),r.socket(i.path,t)}t.protocol=i.protocol,t.connect=l,t.Manager=r("eOtv"),t.Socket=r("KFGy")},gl4O:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("d07J");var o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return r.position=new i.ObservablePoint(r.onChange,r,0,0),r.scale=new i.ObservablePoint(r.onChange,r,1,1),r.pivot=new i.ObservablePoint(r.onChange,r,0,0),r.skew=new i.ObservablePoint(r.updateSkew,r,0,0),r._rotation=0,r._cx=1,r._sx=0,r._cy=0,r._sy=1,r._localID=0,r._currentLocalID=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},t.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale._x,e.b=this._sx*this.scale._x,e.c=this._cy*this.scale._y,e.d=this._sy*this.scale._y,e.tx=this.position._x-(this.pivot._x*e.a+this.pivot._y*e.c),e.ty=this.position._y-(this.pivot._x*e.b+this.pivot._y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale._x,t.b=this._sx*this.scale._x,t.c=this._cy*this.scale._y,t.d=this._sy*this.scale._y,t.tx=this.position._x-(this.pivot._x*t.a+this.pivot._y*t.c),t.ty=this.position._y-(this.pivot._x*t.b+this.pivot._y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var r=e.worldTransform,n=this.worldTransform;n.a=t.a*r.a+t.b*r.c,n.b=t.a*r.b+t.b*r.d,n.c=t.c*r.a+t.d*r.c,n.d=t.c*r.b+t.d*r.d,n.tx=t.tx*r.a+t.ty*r.c+r.tx,n.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}},t.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},n(t,[{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation=e,this.updateSkew()}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(r("KByU")).default);t.default=o},h4Yq:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=function(e){return e&&e.__esModule?e:{default:e}}(r("/UP7"));var s=new i.Point,a=function(e){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return s.tileTransform=new i.TransformStatic,s._width=n,s._height=o,s._canvasPattern=null,s.uvTransform=r.transform||new i.TextureMatrix(r),s.pluginName="tilingSprite",s.uvRespectAnchor=!1,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._onTextureUpdate=function(){this.uvTransform&&(this.uvTransform.texture=this._texture),this.cachedTint=16777215},t.prototype._renderWebGL=function(e){var t=this._texture;t&&t.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),e.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))},t.prototype._renderCanvas=function(e){var t=this._texture;if(t.baseTexture.hasLoaded){var r=e.context,n=this.worldTransform,s=e.resolution,a=t.baseTexture,l=a.resolution,c=this.tilePosition.x/this.tileScale.x%t._frame.width*l,u=this.tilePosition.y/this.tileScale.y%t._frame.height*l;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var h=new i.CanvasRenderTarget(t._frame.width,t._frame.height,l);16777215!==this.tint?(this.tintedTexture=o.default.getTintedTexture(this,this.tint),h.context.drawImage(this.tintedTexture,0,0)):h.context.drawImage(a.source,-t._frame.x*l,-t._frame.y*l),this.cachedTint=this.tint,this._canvasPattern=h.context.createPattern(h.canvas,"repeat")}r.globalAlpha=this.worldAlpha,r.setTransform(n.a*s,n.b*s,n.c*s,n.d*s,n.tx*s,n.ty*s),e.setBlendMode(this.blendMode),r.fillStyle=this._canvasPattern,r.scale(this.tileScale.x/l,this.tileScale.y/l);var d=this.anchor.x*-this._width,p=this.anchor.y*-this._height;this.uvRespectAnchor?(r.translate(c,u),r.fillRect(-c+d,-u+p,this._width/this.tileScale.x*l,this._height/this.tileScale.y*l)):(r.translate(c+d,u+p),r.fillRect(-c,-u,this._width/this.tileScale.x*l,this._height/this.tileScale.y*l))}},t.prototype._calculateBounds=function(){var e=this._width*-this._anchor._x,t=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,r,n)},t.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._x),t||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,s);var t=this._width,r=this._height,n=-t*this.anchor._x;if(s.x>=n&&s.x<n+t){var i=-r*this.anchor._y;if(s.y>=i&&s.y<i+r)return!0}return!1},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.tileTransform=null,this.uvTransform=null},t.from=function(e,r,n){return new t(i.Texture.from(e),r,n)},t.fromFrame=function(e,r,n){var o=i.utils.TextureCache[e];if(!o)throw new Error('The frameId "'+e+'" does not exist in the texture cache '+this);return new t(o,r,n)},t.fromImage=function(e,r,n,o,s){return new t(i.Texture.fromImage(e,o,s),r,n)},n(t,[{key:"clampMargin",get:function(){return this.uvTransform.clampMargin},set:function(e){this.uvTransform.clampMargin=e,this.uvTransform.update(!0)}},{key:"tileScale",get:function(){return this.tileTransform.scale},set:function(e){this.tileTransform.scale.copy(e)}},{key:"tilePosition",get:function(){return this.tileTransform.position},set:function(e){this.tileTransform.position.copy(e)}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}}]),t}(i.Sprite);t.default=a},"hN+0":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,i.default)()?(e[n.BLEND_MODES.NORMAL]="source-over",e[n.BLEND_MODES.ADD]="lighter",e[n.BLEND_MODES.MULTIPLY]="multiply",e[n.BLEND_MODES.SCREEN]="screen",e[n.BLEND_MODES.OVERLAY]="overlay",e[n.BLEND_MODES.DARKEN]="darken",e[n.BLEND_MODES.LIGHTEN]="lighten",e[n.BLEND_MODES.COLOR_DODGE]="color-dodge",e[n.BLEND_MODES.COLOR_BURN]="color-burn",e[n.BLEND_MODES.HARD_LIGHT]="hard-light",e[n.BLEND_MODES.SOFT_LIGHT]="soft-light",e[n.BLEND_MODES.DIFFERENCE]="difference",e[n.BLEND_MODES.EXCLUSION]="exclusion",e[n.BLEND_MODES.HUE]="hue",e[n.BLEND_MODES.SATURATION]="saturate",e[n.BLEND_MODES.COLOR]="color",e[n.BLEND_MODES.LUMINOSITY]="luminosity"):(e[n.BLEND_MODES.NORMAL]="source-over",e[n.BLEND_MODES.ADD]="lighter",e[n.BLEND_MODES.MULTIPLY]="source-over",e[n.BLEND_MODES.SCREEN]="source-over",e[n.BLEND_MODES.OVERLAY]="source-over",e[n.BLEND_MODES.DARKEN]="source-over",e[n.BLEND_MODES.LIGHTEN]="source-over",e[n.BLEND_MODES.COLOR_DODGE]="source-over",e[n.BLEND_MODES.COLOR_BURN]="source-over",e[n.BLEND_MODES.HARD_LIGHT]="source-over",e[n.BLEND_MODES.SOFT_LIGHT]="source-over",e[n.BLEND_MODES.DIFFERENCE]="source-over",e[n.BLEND_MODES.EXCLUSION]="source-over",e[n.BLEND_MODES.HUE]="source-over",e[n.BLEND_MODES.SATURATION]="source-over",e[n.BLEND_MODES.COLOR]="source-over",e[n.BLEND_MODES.LUMINOSITY]="source-over");return e[n.BLEND_MODES.NORMAL_NPM]=e[n.BLEND_MODES.NORMAL],e[n.BLEND_MODES.ADD_NPM]=e[n.BLEND_MODES.ADD],e[n.BLEND_MODES.SCREEN_NPM]=e[n.BLEND_MODES.SCREEN],e};var n=r("pQYt"),i=function(e){return e&&e.__esModule?e:{default:e}}(r("g57C"))},he9Y:function(e,t,r){"use strict";t.__esModule=!0;var n=s(r("Wr15")),i=r("d07J"),o=(r("2U8Y"),s(r("4fju")));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=new i.Matrix,o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));return r.renderable=!1,o.maskSprite=r,o.maskMatrix=n,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.apply=function(e,t,r){var n=this.maskSprite,i=this.maskSprite.texture;i.valid&&(i.transform||(i.transform=new o.default(i,0)),i.transform.update(),this.uniforms.mask=i,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(i.transform.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=i.transform.uClampFrame,e.applyFilter(this,t,r))},t}(n.default);t.default=a},hy2w:function(e,t){var r=function(e){return function(){return this.data[e].value}},n={float:function(e,t,r){e.uniform1f(t,r)},vec2:function(e,t,r){e.uniform2f(t,r[0],r[1])},vec3:function(e,t,r){e.uniform3f(t,r[0],r[1],r[2])},vec4:function(e,t,r){e.uniform4f(t,r[0],r[1],r[2],r[3])},int:function(e,t,r){e.uniform1i(t,r)},ivec2:function(e,t,r){e.uniform2i(t,r[0],r[1])},ivec3:function(e,t,r){e.uniform3i(t,r[0],r[1],r[2])},ivec4:function(e,t,r){e.uniform4i(t,r[0],r[1],r[2],r[3])},bool:function(e,t,r){e.uniform1i(t,r)},bvec2:function(e,t,r){e.uniform2i(t,r[0],r[1])},bvec3:function(e,t,r){e.uniform3i(t,r[0],r[1],r[2])},bvec4:function(e,t,r){e.uniform4i(t,r[0],r[1],r[2],r[3])},mat2:function(e,t,r){e.uniformMatrix2fv(t,!1,r)},mat3:function(e,t,r){e.uniformMatrix3fv(t,!1,r)},mat4:function(e,t,r){e.uniformMatrix4fv(t,!1,r)},sampler2D:function(e,t,r){e.uniform1i(t,r)}},i={float:function(e,t,r){e.uniform1fv(t,r)},vec2:function(e,t,r){e.uniform2fv(t,r)},vec3:function(e,t,r){e.uniform3fv(t,r)},vec4:function(e,t,r){e.uniform4fv(t,r)},int:function(e,t,r){e.uniform1iv(t,r)},ivec2:function(e,t,r){e.uniform2iv(t,r)},ivec3:function(e,t,r){e.uniform3iv(t,r)},ivec4:function(e,t,r){e.uniform4iv(t,r)},bool:function(e,t,r){e.uniform1iv(t,r)},bvec2:function(e,t,r){e.uniform2iv(t,r)},bvec3:function(e,t,r){e.uniform3iv(t,r)},bvec4:function(e,t,r){e.uniform4iv(t,r)},sampler2D:function(e,t,r){e.uniform1iv(t,r)}};function o(e,t){return function(r){this.data[e].value=r;var o=this.data[e].location;1===t.size?n[t.type](this.gl,o,r):i[t.type](this.gl,o,r)}}function s(e,t){for(var r=t,n=0;n<e.length-1;n++){var i=r[e[n]]||{data:{}};r[e[n]]=i,r=i}return r}e.exports=function(e,t){var n={data:{}};n.gl=e;for(var i=Object.keys(t),a=0;a<i.length;a++){var l=i[a],c=l.split("."),u=c[c.length-1],h=s(c,n),d=t[l];h.data[u]=d,h.gl=e,Object.defineProperty(h,u,{get:r(u),set:o(u,d)})}return n}},iEUh:function(e,t,r){"use strict";t.__esModule=!0;var n=r("pQYt");var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=r,this.width=i,this.height=o,this.radius=s,this.type=n.SHAPES.RREC}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height,this.radius)},e.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){if(t>=this.y+this.radius&&t<=this.y+this.height-this.radius||e>=this.x+this.radius&&e<=this.x+this.width-this.radius)return!0;var r=e-(this.x+this.radius),n=t-(this.y+this.radius),i=this.radius*this.radius;if(r*r+n*n<=i)return!0;if((r=e-(this.x+this.width-this.radius))*r+n*n<=i)return!0;if(r*r+(n=t-(this.y+this.height-this.radius))*n<=i)return!0;if((r=e-(this.x+this.radius))*r+n*n<=i)return!0}return!1},e}();t.default=i},inOm:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._pointerId=t,this._flags=e.FLAGS.NONE}return e.prototype._doSet=function(e,t){this._flags=t?this._flags|e:this._flags&~e},n(e,[{key:"pointerId",get:function(){return this._pointerId}},{key:"flags",get:function(){return this._flags},set:function(e){this._flags=e}},{key:"none",get:function(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},set:function(e){this._doSet(this.constructor.FLAGS.OVER,e)}},{key:"rightDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,e)}},{key:"leftDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(this.constructor.FLAGS.LEFT_DOWN,e)}}]),e}();t.default=i,i.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4})},jE0j:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t,r,n,i,o,s,a){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],c=0,u=0,h=0,d=0,p=0;l.push(e,t);for(var f=1,m=0;f<=20;++f)h=(u=(c=1-(m=f/20))*c)*c,p=(d=m*m)*m,l.push(h*e+3*u*m*r+3*c*d*i+p*s,h*t+3*u*m*n+3*c*d*o+p*a);return l}},jK9F:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));r("2U8Y");var o=function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));return n.alpha=r,n.glShaderKey="alpha",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e}}]),t}(i.Filter);t.default=o},jQCb:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("d07J"),o=r("qp2T"),s=r("pQYt"),a=c(r("xJsK")),l=c(r("a/Ns"));function c(e){return e&&e.__esModule?e:{default:e}}var u=new i.Point,h=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return n._anchor=new i.ObservablePoint(n._onAnchorUpdate,n),n._texture=null,n._width=0,n._height=0,n._tint=null,n._tintRGB=null,n.tint=16777215,n.blendMode=s.BLEND_MODES.NORMAL,n.shader=null,n.cachedTint=16777215,n.texture=r||a.default.EMPTY,n.vertexData=new Float32Array(8),n.vertexTrimmedData=null,n._transformID=-1,n._textureID=-1,n._transformTrimmedID=-1,n._textureTrimmedID=-1,n.pluginName="sprite",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this.cachedTint=16777215,this._width&&(this.scale.x=(0,o.sign)(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=(0,o.sign)(this.scale.y)*this._height/this._texture.orig.height)},t.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},t.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID,this._textureID=this._texture._updateID;var e=this._texture,t=this.transform.worldTransform,r=t.a,n=t.b,i=t.c,o=t.d,s=t.tx,a=t.ty,l=this.vertexData,c=e.trim,u=e.orig,h=this._anchor,d=0,p=0,f=0,m=0;c?(d=(p=c.x-h._x*u.width)+c.width,f=(m=c.y-h._y*u.height)+c.height):(d=(p=-h._x*u.width)+u.width,f=(m=-h._y*u.height)+u.height),l[0]=r*p+i*m+s,l[1]=o*m+n*p+a,l[2]=r*d+i*m+s,l[3]=o*m+n*d+a,l[4]=r*d+i*f+s,l[5]=o*f+n*d+a,l[6]=r*p+i*f+s,l[7]=o*f+n*p+a}},t.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var e=this._texture,t=this.vertexTrimmedData,r=e.orig,n=this._anchor,i=this.transform.worldTransform,o=i.a,s=i.b,a=i.c,l=i.d,c=i.tx,u=i.ty,h=-n._x*r.width,d=h+r.width,p=-n._y*r.height,f=p+r.height;t[0]=o*h+a*p+c,t[1]=l*p+s*h+u,t[2]=o*d+a*p+c,t[3]=l*p+s*d+u,t[4]=o*d+a*f+c,t[5]=l*f+s*d+u,t[6]=o*h+a*f+c,t[7]=l*f+s*h+u},t.prototype._renderWebGL=function(e){this.calculateVertices(),e.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)},t.prototype._renderCanvas=function(e){e.plugins[this.pluginName].render(this)},t.prototype._calculateBounds=function(){var e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},t.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,u);var t=this._texture.orig.width,r=this._texture.orig.height,n=-t*this.anchor.x,i=0;return u.x>=n&&u.x<n+t&&(i=-r*this.anchor.y,u.y>=i&&u.y<i+r)},t.prototype.destroy=function(t){if(e.prototype.destroy.call(this,t),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var r="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!r)}this._texture=null,this.shader=null},t.from=function(e){return new t(a.default.from(e))},t.fromFrame=function(e){var r=o.TextureCache[e];if(!r)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return new t(r)},t.fromImage=function(e,r,n){return new t(a.default.fromImage(e,r,n))},n(t,[{key:"width",get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){var t=(0,o.sign)(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}},{key:"height",get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){var t=(0,o.sign)(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}},{key:"anchor",get:function(){return this._anchor},set:function(e){this._anchor.copy(e)}},{key:"tint",get:function(){return this._tint},set:function(e){this._tint=e,this._tintRGB=(e>>16)+(65280&e)+((255&e)<<16)}},{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this.cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.hasLoaded?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}]),t}(l.default);t.default=h},kSER:function(e,t){e.exports=function(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}},kSzJ:function(e,t,r){"use strict";t.__esModule=!0,t.loader=t.prepare=t.particles=t.mesh=t.loaders=t.interaction=t.filters=t.extras=t.extract=t.accessibility=void 0;var n=r("3Ym4");Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r("3AcN");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=function(e){return e&&e.__esModule?e:{default:e}}(r("mTg2")),s=m(r("Yiwd")),a=m(r("5ekA")),l=m(r("Y12R")),c=m(r("y/pH")),u=m(r("fvlo")),h=m(r("qllB")),d=m(r("Dn+6")),p=m(r("3Gzo")),f=m(r("M6Jp"));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}i.utils.mixins.performMixins();var v=h.shared||null;t.accessibility=s,t.extract=a,t.extras=l,t.filters=c,t.interaction=u,t.loaders=h,t.mesh=d,t.particles=p,t.prepare=f,t.loader=v,"function"==typeof o.default&&(0,o.default)(t),global.PIXI=t},koBt:function(e,t){var r=null,n={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};e.exports=function(e,t){if(!r){var i=Object.keys(n);r={};for(var o=0;o<i.length;++o){var s=i[o];r[e[s]]=n[s]}}return r[t]}},l0yf:function(e,t,r){e.exports={compileProgram:r("Cxr2"),defaultValue:r("rI9z"),extractAttributes:r("7AYe"),extractUniforms:r("984s"),generateUniformAccessObject:r("hy2w"),setPrecision:r("0DWY"),mapSize:r("ujOt"),mapType:r("koBt")}},l8vz:function(e,t,r){"use strict";t.__esModule=!0;var n=o(r("yI/K")),i=o(r("TyRm"));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var o=0;o<r.length;++o){var s=r[o];s={attribute:s.attribute,size:s.size,uploadFunction:s.uploadFunction,unsignedByte:s.unsignedByte,offset:s.offset},n[o]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return e.prototype.initBuffers=function(){var e=this.gl,t=0;this.indices=(0,i.default)(this.size),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var o=this.dynamicProperties[r];o.offset=t,t+=o.size,this.dynamicStride+=o.size}var s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=n.default.GLBuffer.createVertexBuffer(e,s,e.STREAM_DRAW);var a=0;this.staticStride=0;for(var l=0;l<this.staticProperties.length;++l){var c=this.staticProperties[l];c.offset=a,a+=c.size,this.staticStride+=c.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=n.default.GLBuffer.createVertexBuffer(e,u,e.STATIC_DRAW),this.vao=new n.default.VertexArrayObject(e).addIndex(this.indexBuffer);for(var h=0;h<this.dynamicProperties.length;++h){var d=this.dynamicProperties[h];d.unsignedByte?this.vao.addAttribute(this.dynamicBuffer,d.attribute,e.UNSIGNED_BYTE,!0,4*this.dynamicStride,4*d.offset):this.vao.addAttribute(this.dynamicBuffer,d.attribute,e.FLOAT,!1,4*this.dynamicStride,4*d.offset)}for(var p=0;p<this.staticProperties.length;++p){var f=this.staticProperties[p];f.unsignedByte?this.vao.addAttribute(this.staticBuffer,f.attribute,e.UNSIGNED_BYTE,!0,4*this.staticStride,4*f.offset):this.vao.addAttribute(this.staticBuffer,f.attribute,e.FLOAT,!1,4*this.staticStride,4*f.offset)}},e.prototype.uploadDynamic=function(e,t,r){for(var n=0;n<this.dynamicProperties.length;n++){var i=this.dynamicProperties[n];i.uploadFunction(e,t,r,i.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer.upload()},e.prototype.uploadStatic=function(e,t,r){for(var n=0;n<this.staticProperties.length;n++){var i=this.staticProperties[n];i.uploadFunction(e,t,r,i.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer.upload()},e.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicBuffer.destroy(),this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer.destroy(),this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null},e}();t.default=s},lKxJ:function(e,t,r){e.exports=r("2pII"),e.exports.parser=r("Wm4p")},lYZj:function(e,t,r){"use strict";var n=r(null),i=r(null),o=r(null);class s{constructor(e,t=Number.POSITIVE_INFINITY){this.subscribedFrame=e,this.unsubscribedFrame=t}}class a{constructor(){this.subscriptions=[]}logSubscribedFrame(){return this.subscriptions.push(new s(this.scheduler.now())),this.subscriptions.length-1}logUnsubscribedFrame(e){const t=this.subscriptions,r=t[e];t[e]=new s(r.subscribedFrame,this.scheduler.now())}}function l(e,t){for(let r=0,n=t.length;r<n;r++){const n=t[r],i=Object.getOwnPropertyNames(n.prototype);for(let t=0,r=i.length;t<r;t++){const r=i[t];e.prototype[r]=n.prototype[r]}}}class c extends n.a{constructor(e,t){super(function(e){const t=this,r=t.logSubscribedFrame();return e.add(new o.a(()=>{t.logUnsubscribedFrame(r)})),t.scheduleMessages(e),e}),this.messages=e,this.subscriptions=[],this.scheduler=t}scheduleMessages(e){const t=this.messages.length;for(let r=0;r<t;r++){const t=this.messages[r];e.add(this.scheduler.schedule(({message:e,subscriber:t})=>{e.notification.observe(t)},t.frame,{message:t,subscriber:e}))}}}l(c,[a]);var u=r(null);class h extends u.a{constructor(e,t){super(),this.messages=e,this.subscriptions=[],this.scheduler=t}_subscribe(e){const t=this,r=t.logSubscribedFrame();return e.add(new o.a(()=>{t.logUnsubscribedFrame(r)})),super._subscribe(e)}setup(){const e=this,t=e.messages.length;for(var r=0;r<t;r++)(()=>{var t=e.messages[r];e.scheduler.schedule(()=>{t.notification.observe(e)},t.frame)})()}}l(h,[a]);var d=r(null),p=r(null);class f extends p.a{constructor(e=m,t=Number.POSITIVE_INFINITY){super(e,()=>this.frame),this.maxFrames=t,this.frame=0,this.index=-1}flush(){const{actions:e,maxFrames:t}=this;let r,n;for(;(n=e.shift())&&(this.frame=n.delay)<=t&&!(r=n.execute(n.state,n.delay)););if(r){for(;n=e.shift();)n.unsubscribe();throw r}}}f.frameTimeFactor=10;class m extends d.a{constructor(e,t,r=(e.index+=1)){super(e,t),this.scheduler=e,this.work=t,this.index=r,this.active=!0,this.index=e.index=r}schedule(e,t=0){if(!this.id)return super.schedule(e,t);this.active=!1;const r=new m(this.scheduler,this.work);return this.add(r),r.schedule(e,t)}requestAsyncId(e,t,r=0){this.delay=e.frame+r;const{actions:n}=e;return n.push(this),n.sort(m.sortActions),!0}recycleAsyncId(e,t,r=0){}_execute(e,t){if(!0===this.active)return super._execute(e,t)}static sortActions(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1}}const v=750;class g extends f{constructor(e){super(m,v),this.assertDeepEqual=e,this.hotObservables=[],this.coldObservables=[],this.flushTests=[],this.runMode=!1}createTime(e){const t=e.indexOf("|");if(-1===t)throw new Error('marble diagram for time should have a completion marker "|"');return t*g.frameTimeFactor}createColdObservable(e,t,r){if(-1!==e.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==e.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');const n=g.parseMarbles(e,t,r,void 0,this.runMode),i=new c(n,this);return this.coldObservables.push(i),i}createHotObservable(e,t,r){if(-1!==e.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');const n=g.parseMarbles(e,t,r,void 0,this.runMode),i=new h(n,this);return this.hotObservables.push(i),i}materializeInnerObservable(e,t){const r=[];return e.subscribe(e=>{r.push({frame:this.frame-t,notification:i.a.createNext(e)})},e=>{r.push({frame:this.frame-t,notification:i.a.createError(e)})},()=>{r.push({frame:this.frame-t,notification:i.a.createComplete()})}),r}expectObservable(e,t=null){const r=[],o={actual:r,ready:!1},s=g.parseMarblesAsSubscriptions(t,this.runMode).unsubscribedFrame;let a;this.schedule(()=>{a=e.subscribe(e=>{let t=e;e instanceof n.a&&(t=this.materializeInnerObservable(t,this.frame)),r.push({frame:this.frame,notification:i.a.createNext(t)})},e=>{r.push({frame:this.frame,notification:i.a.createError(e)})},()=>{r.push({frame:this.frame,notification:i.a.createComplete()})})},0),s!==Number.POSITIVE_INFINITY&&this.schedule(()=>a.unsubscribe(),s),this.flushTests.push(o);const{runMode:l}=this;return{toBe(e,t,r){o.ready=!0,o.expected=g.parseMarbles(e,t,r,!0,l)}}}expectSubscriptions(e){const t={actual:e,ready:!1};this.flushTests.push(t);const{runMode:r}=this;return{toBe(e){const n="string"==typeof e?[e]:e;t.ready=!0,t.expected=n.map(e=>g.parseMarblesAsSubscriptions(e,r))}}}flush(){const e=this.hotObservables;for(;e.length>0;)e.shift().setup();super.flush();const{flushTests:t}=this,r=t.slice();for(let n=0,i=t.length;n<i;n++){const e=r[n];e.ready&&(t.splice(n,1),this.assertDeepEqual(e.actual,e.expected))}}static parseMarblesAsSubscriptions(e,t=!1){if("string"!=typeof e)return new s(Number.POSITIVE_INFINITY);const r=e.length;let n=-1,i=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=0;for(let s=0;s<r;s++){let r=a;const l=e=>{r+=e*this.frameTimeFactor},c=e[s];switch(c){case" ":t||l(1);break;case"-":l(1);break;case"(":n=a,l(1);break;case")":n=-1,l(1);break;case"^":if(i!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");i=n>-1?n:a,l(1);break;case"!":if(o!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");o=n>-1?n:a;break;default:if(t&&c.match(/^[0-9]$/)&&(0===s||" "===e[s-1])){const t=e.slice(s).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(t){s+=t[0].length-1;const e=parseFloat(t[1]);let r;switch(t[2]){case"ms":r=e;break;case"s":r=1e3*e;break;case"m":r=1e3*e*60}l(r/this.frameTimeFactor);break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+c+"'.")}a=r}return o<0?new s(i):new s(i,o)}static parseMarbles(e,t,r,n=!1,o=!1){if(-1!==e.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');const s=e.length,a=[],l=o?e.replace(/^[ ]+/,"").indexOf("^"):e.indexOf("^");let u=-1===l?0:l*-this.frameTimeFactor;const h="object"!=typeof t?e=>e:e=>n&&t[e]instanceof c?t[e].messages:t[e];let d=-1;for(let c=0;c<s;c++){let t=u;const n=e=>{t+=e*this.frameTimeFactor};let s;const l=e[c];switch(l){case" ":o||n(1);break;case"-":n(1);break;case"(":d=u,n(1);break;case")":d=-1,n(1);break;case"|":s=i.a.createComplete(),n(1);break;case"^":n(1);break;case"#":s=i.a.createError(r||"error"),n(1);break;default:if(o&&l.match(/^[0-9]$/)&&(0===c||" "===e[c-1])){const t=e.slice(c).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(t){c+=t[0].length-1;const e=parseFloat(t[1]);let r;switch(t[2]){case"ms":r=e;break;case"s":r=1e3*e;break;case"m":r=1e3*e*60}n(r/this.frameTimeFactor);break}}s=i.a.createNext(h(l)),n(1)}s&&a.push({frame:d>-1?d:u,notification:s}),u=t}return a}run(e){const t=g.frameTimeFactor,r=this.maxFrames;g.frameTimeFactor=1,this.maxFrames=Number.POSITIVE_INFINITY,this.runMode=!0,p.a.delegate=this;const n=e({cold:this.createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this)});return this.flush(),g.frameTimeFactor=t,this.maxFrames=r,this.runMode=!1,p.a.delegate=void 0,n}}r.d(t,"TestScheduler",function(){return g})},laIk:function(e,t,r){"use strict";r.r(t);var n=r(null);r.d(t,"ajax",function(){return n.a});r(null);r.d(t,"AjaxResponse",function(){return _internal_observable_dom_AjaxObservable__WEBPACK_IMPORTED_MODULE_1__false}),r.d(t,"AjaxError",function(){return _internal_observable_dom_AjaxObservable__WEBPACK_IMPORTED_MODULE_1__false}),r.d(t,"AjaxTimeoutError",function(){return _internal_observable_dom_AjaxObservable__WEBPACK_IMPORTED_MODULE_1__false})},leuX:function(e,t,r){"use strict";t.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=u(r("45ci")),s=u(r("1td8")),a=u(r("inOm")),l=u(r("uhBA")),c=u(r("4miC"));function u(e){return e&&e.__esModule?e:{default:e}}i.utils.mixins.delayMixin(i.DisplayObject.prototype,c.default);var h=1,d={target:null,data:{global:null}},p=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return n=n||{},a.renderer=r,a.autoPreventDefault=void 0===n.autoPreventDefault||n.autoPreventDefault,a.interactionFrequency=n.interactionFrequency||10,a.mouse=new o.default,a.mouse.identifier=h,a.mouse.global.set(-999999),a.activeInteractionData={},a.activeInteractionData[h]=a.mouse,a.interactionDataPool=[],a.eventData=new s.default,a.interactionDOMElement=null,a.moveWhenInside=!1,a.eventsAdded=!1,a.mouseOverRenderer=!1,a.supportsTouchEvents="ontouchstart"in window,a.supportsPointerEvents=!!window.PointerEvent,a.onPointerUp=a.onPointerUp.bind(a),a.processPointerUp=a.processPointerUp.bind(a),a.onPointerCancel=a.onPointerCancel.bind(a),a.processPointerCancel=a.processPointerCancel.bind(a),a.onPointerDown=a.onPointerDown.bind(a),a.processPointerDown=a.processPointerDown.bind(a),a.onPointerMove=a.onPointerMove.bind(a),a.processPointerMove=a.processPointerMove.bind(a),a.onPointerOut=a.onPointerOut.bind(a),a.processPointerOverOut=a.processPointerOverOut.bind(a),a.onPointerOver=a.onPointerOver.bind(a),a.cursorStyles={default:"inherit",pointer:"pointer"},a.currentCursorMode=null,a.cursor=null,a._tempPoint=new i.Point,a.resolution=1,a.setTargetElement(a.renderer.view,a.renderer.resolution),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.hitTest=function(e,t){return d.target=null,d.data.global=e,t||(t=this.renderer._lastObjectRendered),this.processInteractive(d,t,null,!0),d.target},t.prototype.setTargetElement=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.removeEvents(),this.interactionDOMElement=e,this.resolution=t,this.addEvents()},t.prototype.addEvents=function(){this.interactionDOMElement&&(i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},t.prototype.removeEvents=function(){this.interactionDOMElement&&(i.ticker.shared.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},t.prototype.update=function(e){if(this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var r=this.activeInteractionData[t];if(r.originalEvent&&"touch"!==r.pointerType){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},t.prototype.setCursorMode=function(e){if(e=e||"default",this.currentCursorMode!==e){this.currentCursorMode=e;var t=this.cursorStyles[e];if(t)switch(void 0===t?"undefined":n(t)){case"string":this.interactionDOMElement.style.cursor=t;break;case"function":t(e);break;case"object":Object.assign(this.interactionDOMElement.style,t)}else"string"!=typeof e||Object.prototype.hasOwnProperty.call(this.cursorStyles,e)||(this.interactionDOMElement.style.cursor=e)}},t.prototype.dispatchEvent=function(e,t,r){r.stopped||(r.currentTarget=e,r.type=t,e.emit(t,r),e[t]&&e[t](r))},t.prototype.mapPositionToPoint=function(e,t,r){var n=void 0;n=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=navigator.isCocoonJS?this.resolution:1/this.resolution;e.x=(t-n.left)*(this.interactionDOMElement.width/n.width)*i,e.y=(r-n.top)*(this.interactionDOMElement.height/n.height)*i},t.prototype.processInteractive=function(e,t,r,n,i){if(!t||!t.visible)return!1;var o=e.data.global,s=!1,a=i=t.interactive||i,l=!0;if(t.hitArea?(n&&(t.worldTransform.applyInverse(o,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(n=!1,l=!1)),a=!1):t._mask&&n&&(t._mask.containsPoint(o)||(n=!1,l=!1)),l&&t.interactiveChildren&&t.children)for(var c=t.children,u=c.length-1;u>=0;u--){var h=c[u],d=this.processInteractive(e,h,r,n,a);if(d){if(!h.parent)continue;a=!1,d&&(e.target&&(n=!1),s=!0)}}return i&&(n&&!e.target&&!t.hitArea&&t.containsPoint&&t.containsPoint(o)&&(s=!0),t.interactive&&(s&&!e.target&&(e.target=t),r&&r(e,t,!!s))),s},t.prototype.onPointerDown=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&e.preventDefault();for(var r=t.length,n=0;n<r;n++){var i=t[n],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);if(s.data.originalEvent=e,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===i.pointerType)this.emit("touchstart",s);else if("mouse"===i.pointerType||"pen"===i.pointerType){var a=2===i.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},t.prototype.processPointerDown=function(e,t,r){var n=e.data,i=e.data.identifier;if(r)if(t.trackedPointers[i]||(t.trackedPointers[i]=new a.default(i)),this.dispatchEvent(t,"pointerdown",e),"touch"===n.pointerType)this.dispatchEvent(t,"touchstart",e);else if("mouse"===n.pointerType||"pen"===n.pointerType){var o=2===n.button;o?t.trackedPointers[i].rightDown=!0:t.trackedPointers[i].leftDown=!0,this.dispatchEvent(t,o?"rightdown":"mousedown",e)}},t.prototype.onPointerComplete=function(e,t,r){for(var n=this.normalizeToPointerData(e),i=n.length,o=e.target!==this.interactionDOMElement?"outside":"",s=0;s<i;s++){var a=n[s],l=this.getInteractionDataForPointerId(a),c=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(c.data.originalEvent=e,this.processInteractive(c,this.renderer._lastObjectRendered,r,t||!o),this.emit(t?"pointercancel":"pointerup"+o,c),"mouse"===a.pointerType||"pen"===a.pointerType){var u=2===a.button;this.emit(u?"rightup"+o:"mouseup"+o,c)}else"touch"===a.pointerType&&(this.emit(t?"touchcancel":"touchend"+o,c),this.releaseInteractionDataForPointerId(a.pointerId,l))}},t.prototype.onPointerCancel=function(e){this.supportsTouchEvents&&"touch"===e.pointerType||this.onPointerComplete(e,!0,this.processPointerCancel)},t.prototype.processPointerCancel=function(e,t){var r=e.data,n=e.data.identifier;void 0!==t.trackedPointers[n]&&(delete t.trackedPointers[n],this.dispatchEvent(t,"pointercancel",e),"touch"===r.pointerType&&this.dispatchEvent(t,"touchcancel",e))},t.prototype.onPointerUp=function(e){this.supportsTouchEvents&&"touch"===e.pointerType||this.onPointerComplete(e,!1,this.processPointerUp)},t.prototype.processPointerUp=function(e,t,r){var n=e.data,i=e.data.identifier,o=t.trackedPointers[i],s="touch"===n.pointerType;if("mouse"===n.pointerType||"pen"===n.pointerType){var l=2===n.button,c=a.default.FLAGS,u=l?c.RIGHT_DOWN:c.LEFT_DOWN,h=void 0!==o&&o.flags&u;r?(this.dispatchEvent(t,l?"rightup":"mouseup",e),h&&this.dispatchEvent(t,l?"rightclick":"click",e)):h&&this.dispatchEvent(t,l?"rightupoutside":"mouseupoutside",e),o&&(l?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(t,"pointerup",e),s&&this.dispatchEvent(t,"touchend",e),o&&(this.dispatchEvent(t,"pointertap",e),s&&(this.dispatchEvent(t,"tap",e),o.over=!1))):o&&(this.dispatchEvent(t,"pointerupoutside",e),s&&this.dispatchEvent(t,"touchendoutside",e)),o&&o.none&&delete t.trackedPointers[i]},t.prototype.onPointerMove=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e);"mouse"!==t[0].pointerType&&"pen"!==t[0].pointerType||(this.didMove=!0,this.cursor=null);for(var r=t.length,n=0;n<r;n++){var i=t[n],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);s.data.originalEvent=e;var a="touch"!==i.pointerType||this.moveWhenInside;this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerMove,a),this.emit("pointermove",s),"touch"===i.pointerType&&this.emit("touchmove",s),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",s)}"mouse"===t[0].pointerType&&this.setCursorMode(this.cursor)}},t.prototype.processPointerMove=function(e,t,r){var n=e.data,i="touch"===n.pointerType,o="mouse"===n.pointerType||"pen"===n.pointerType;o&&this.processPointerOverOut(e,t,r),this.moveWhenInside&&!r||(this.dispatchEvent(t,"pointermove",e),i&&this.dispatchEvent(t,"touchmove",e),o&&this.dispatchEvent(t,"mousemove",e))},t.prototype.onPointerOut=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e)[0];"mouse"===t.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(t),n=this.configureInteractionEventForDOMEvent(this.eventData,t,r);n.data.originalEvent=t,this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",n),"mouse"===t.pointerType||"pen"===t.pointerType?this.emit("mouseout",n):this.releaseInteractionDataForPointerId(r.identifier)}},t.prototype.processPointerOverOut=function(e,t,r){var n=e.data,i=e.data.identifier,o="mouse"===n.pointerType||"pen"===n.pointerType,s=t.trackedPointers[i];r&&!s&&(s=t.trackedPointers[i]=new a.default(i)),void 0!==s&&(r&&this.mouseOverRenderer?(s.over||(s.over=!0,this.dispatchEvent(t,"pointerover",e),o&&this.dispatchEvent(t,"mouseover",e)),o&&null===this.cursor&&(this.cursor=t.cursor)):s.over&&(s.over=!1,this.dispatchEvent(t,"pointerout",this.eventData),o&&this.dispatchEvent(t,"mouseout",e),s.none&&delete t.trackedPointers[i]))},t.prototype.onPointerOver=function(e){var t=this.normalizeToPointerData(e)[0],r=this.getInteractionDataForPointerId(t),n=this.configureInteractionEventForDOMEvent(this.eventData,t,r);n.data.originalEvent=t,"mouse"===t.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",n),"mouse"!==t.pointerType&&"pen"!==t.pointerType||this.emit("mouseover",n)},t.prototype.getInteractionDataForPointerId=function(e){var t=e.pointerId,r=void 0;return t===h||"mouse"===e.pointerType?r=this.mouse:this.activeInteractionData[t]?r=this.activeInteractionData[t]:((r=this.interactionDataPool.pop()||new o.default).identifier=t,this.activeInteractionData[t]=r),r.copyEvent(e),r},t.prototype.releaseInteractionDataForPointerId=function(e){var t=this.activeInteractionData[e];t&&(delete this.activeInteractionData[e],t.reset(),this.interactionDataPool.push(t))},t.prototype.configureInteractionEventForDOMEvent=function(e,t,r){return e.data=r,this.mapPositionToPoint(r.global,t.clientX,t.clientY),navigator.isCocoonJS&&"touch"===t.pointerType&&(r.global.x=r.global.x/this.resolution,r.global.y=r.global.y/this.resolution),"touch"===t.pointerType&&(t.globalX=r.global.x,t.globalY=r.global.y),r.originalEvent=t,e.reset(),e},t.prototype.normalizeToPointerData=function(e){var t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(var r=0,n=e.changedTouches.length;r<n;r++){var i=e.changedTouches[r];void 0===i.button&&(i.button=e.touches.length?1:0),void 0===i.buttons&&(i.buttons=e.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),i.twist=0,i.tangentialPressure=0,void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,t.push(i)}else!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof window.PointerEvent?t.push(e):(void 0===e.isPrimary&&(e.isPrimary=!0),void 0===e.width&&(e.width=1),void 0===e.height&&(e.height=1),void 0===e.tiltX&&(e.tiltX=0),void 0===e.tiltY&&(e.tiltY=0),void 0===e.pointerType&&(e.pointerType="mouse"),void 0===e.pointerId&&(e.pointerId=h),void 0===e.pressure&&(e.pressure=.5),e.twist=0,e.tangentialPressure=0,e.isNormalized=!0,t.push(e));return t},t.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},t}(l.default);t.default=p,i.WebGLRenderer.registerPlugin("interaction",p),i.CanvasRenderer.registerPlugin("interaction",p)},lsi7:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t[n.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.ADD]=[e.ONE,e.DST_ALPHA],t[n.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR],t[n.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[n.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.DST_ALPHA,e.ONE,e.DST_ALPHA],t[n.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_COLOR],t};var n=r("pQYt")},lv48:function(e,t,r){function n(e){var r;function n(){if(n.enabled){var e=n,i=+new Date,o=i-(r||i);e.diff=o,e.prev=r,e.curr=i,r=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var l=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;l++;var i=t.formatters[n];if("function"==typeof i){var o=s[l];r=i.call(e,o),s.splice(l,1),l--}return r}),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),n.destroy=i,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var o=t.instances[r];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r("FGiv"),t.instances=[],t.names=[],t.skips=[],t.formatters={}},mTg2:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){var t=e.mesh,r=e.particles,n=e.extras,o=e.filters,s=e.prepare,a=e.loaders,l=e.interaction;Object.defineProperties(e,{SpriteBatch:{get:function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")}},AssetLoader:{get:function(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.")}},Stage:{get:function(){return i("You do not need to use a PIXI Stage any more, you can simply render any container."),e.Container}},DisplayObjectContainer:{get:function(){return i("DisplayObjectContainer has been shortened to Container, please use Container from now on."),e.Container}},Strip:{get:function(){return i("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),t.Mesh}},Rope:{get:function(){return i("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),t.Rope}},ParticleContainer:{get:function(){return i("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."),r.ParticleContainer}},MovieClip:{get:function(){return i("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."),n.AnimatedSprite}},TilingSprite:{get:function(){return i("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),n.TilingSprite}},BitmapText:{get:function(){return i("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),n.BitmapText}},blendModes:{get:function(){return i("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),e.BLEND_MODES}},scaleModes:{get:function(){return i("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),e.SCALE_MODES}},BaseTextureCache:{get:function(){return i("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),e.utils.BaseTextureCache}},TextureCache:{get:function(){return i("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),e.utils.TextureCache}},math:{get:function(){return i("The math namespace is deprecated, please access members already accessible on PIXI."),e}},AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),e.Filter}},TransformManual:{get:function(){return i("TransformManual has been renamed to TransformBase, please update your pixi-spine"),e.TransformBase}},TARGET_FPMS:{get:function(){return i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),e.settings.TARGET_FPMS},set:function(t){i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),e.settings.TARGET_FPMS=t}},FILTER_RESOLUTION:{get:function(){return i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),e.settings.FILTER_RESOLUTION},set:function(t){i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),e.settings.FILTER_RESOLUTION=t}},RESOLUTION:{get:function(){return i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),e.settings.RESOLUTION},set:function(t){i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),e.settings.RESOLUTION=t}},MIPMAP_TEXTURES:{get:function(){return i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),e.settings.MIPMAP_TEXTURES},set:function(t){i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),e.settings.MIPMAP_TEXTURES=t}},SPRITE_BATCH_SIZE:{get:function(){return i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),e.settings.SPRITE_BATCH_SIZE},set:function(t){i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),e.settings.SPRITE_BATCH_SIZE=t}},SPRITE_MAX_TEXTURES:{get:function(){return i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),e.settings.SPRITE_MAX_TEXTURES},set:function(t){i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),e.settings.SPRITE_MAX_TEXTURES=t}},RETINA_PREFIX:{get:function(){return i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),e.settings.RETINA_PREFIX},set:function(t){i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),e.settings.RETINA_PREFIX=t}},DEFAULT_RENDER_OPTIONS:{get:function(){return i("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"),e.settings.RENDER_OPTIONS}}});for(var c=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}],u=function(t){var r=c[t];Object.defineProperty(e[r.parent],"DEFAULT",{get:function(){return i("PIXI."+r.parent+".DEFAULT has been deprecated, please use PIXI.settings."+r.target),e.settings[r.target]},set:function(t){i("PIXI."+r.parent+".DEFAULT has been deprecated, please use PIXI.settings."+r.target),e.settings[r.target]=t}})},h=0;h<c.length;h++)u(h);Object.defineProperties(e.settings,{PRECISION:{get:function(){return i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),e.settings.PRECISION_FRAGMENT},set:function(t){i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),e.settings.PRECISION_FRAGMENT=t}}}),n.AnimatedSprite&&Object.defineProperties(n,{MovieClip:{get:function(){return i("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."),n.AnimatedSprite}}});n&&Object.defineProperties(n,{TextureTransform:{get:function(){return i("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."),e.TextureMatrix}}});e.DisplayObject.prototype.generateTexture=function(e,t,r){return i("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"),e.generateTexture(this,t,r)},e.Graphics.prototype.generateTexture=function(e,t){return i("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"),this.generateCanvasTexture(e,t)},e.GroupD8.isSwapWidthHeight=function(t){return i("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"),e.GroupD8.isVertical(t)},e.RenderTexture.prototype.render=function(e,t,r,n){this.legacyRenderer.render(e,this,r,t,!n),i("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")},e.RenderTexture.prototype.getImage=function(e){return i("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"),this.legacyRenderer.extract.image(e)},e.RenderTexture.prototype.getBase64=function(e){return i("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"),this.legacyRenderer.extract.base64(e)},e.RenderTexture.prototype.getCanvas=function(e){return i("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"),this.legacyRenderer.extract.canvas(e)},e.RenderTexture.prototype.getPixels=function(e){return i("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"),this.legacyRenderer.pixels(e)},e.Sprite.prototype.setTexture=function(e){this.texture=e,i("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},n.BitmapText&&(n.BitmapText.prototype.setText=function(e){this.text=e,i("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")});e.Text.prototype.setText=function(e){this.text=e,i("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},e.Text.calculateFontProperties=function(t){return i("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"),e.TextMetrics.measureFont(t)},Object.defineProperties(e.Text,{fontPropertiesCache:{get:function(){return i("Text.fontPropertiesCache is deprecated"),e.TextMetrics._fonts}},fontPropertiesCanvas:{get:function(){return i("Text.fontPropertiesCanvas is deprecated"),e.TextMetrics._canvas}},fontPropertiesContext:{get:function(){return i("Text.fontPropertiesContext is deprecated"),e.TextMetrics._context}}}),e.Text.prototype.setStyle=function(e){this.style=e,i("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},e.Text.prototype.determineFontProperties=function(t){return i("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"),e.TextMetrics.measureFont(t)},e.Text.getFontStyle=function(t){return i("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"),(t=t||{})instanceof e.TextStyle||(t=new e.TextStyle(t)),t.toFontString()},Object.defineProperties(e.TextStyle.prototype,{font:{get:function(){i("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on");var e="number"==typeof this._fontSize?this._fontSize+"px":this._fontSize;return this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+e+" "+this._fontFamily},set:function(e){i("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"),e.indexOf("italic")>1?this._fontStyle="italic":e.indexOf("oblique")>-1?this._fontStyle="oblique":this._fontStyle="normal",e.indexOf("small-caps")>-1?this._fontVariant="small-caps":this._fontVariant="normal";var t=e.split(" "),r=-1;this._fontSize=26;for(var n=0;n<t.length;++n)if(t[n].match(/(px|pt|em|%)/)){r=n,this._fontSize=t[n];break}this._fontWeight="normal";for(var o=0;o<r;++o)if(t[o].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=t[o];break}if(r>-1&&r<t.length-1){this._fontFamily="";for(var s=r+1;s<t.length;++s)this._fontFamily+=t[s]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}}),e.Texture.prototype.setFrame=function(e){this.frame=e,i("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")},e.Texture.addTextureToCache=function(t,r){e.Texture.addToCache(t,r),i("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")},e.Texture.removeTextureFromCache=function(t){return i("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"),e.BaseTexture.removeFromCache(t),e.Texture.removeFromCache(t)},Object.defineProperties(o,{AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),e.AbstractFilter}},SpriteMaskFilter:{get:function(){return i("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),e.SpriteMaskFilter}},VoidFilter:{get:function(){return i("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"),o.AlphaFilter}}}),e.utils.uuid=function(){return i("utils.uuid() is deprecated, please use utils.uid() from now on."),e.utils.uid()},e.utils.canUseNewCanvasBlendModes=function(){return i("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"),e.CanvasTinter.canUseMultiply};var d=!0;Object.defineProperty(e.utils,"_saidHello",{set:function(e){e&&(i("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"),this.skipHello()),d=e},get:function(){return d}}),s.BasePrepare&&(s.BasePrepare.prototype.register=function(e,t){return i("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"),e&&this.registerFindHook(e),t&&this.registerUploadHook(t),this});s.canvas&&Object.defineProperty(s.canvas,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}});s.webgl&&Object.defineProperty(s.webgl,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}});if(a.Loader){var p=a.Resource,f=a.Loader;Object.defineProperties(p.prototype,{isJson:{get:function(){return i("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."),this.type===p.TYPE.JSON}},isXml:{get:function(){return i("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."),this.type===p.TYPE.XML}},isImage:{get:function(){return i("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."),this.type===p.TYPE.IMAGE}},isAudio:{get:function(){return i("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."),this.type===p.TYPE.AUDIO}},isVideo:{get:function(){return i("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."),this.type===p.TYPE.VIDEO}}}),Object.defineProperties(f.prototype,{before:{get:function(){return i("The before() method is deprecated, please use pre()."),this.pre}},after:{get:function(){return i("The after() method is deprecated, please use use()."),this.use}}})}l.interactiveTarget&&Object.defineProperty(l.interactiveTarget,"defaultCursor",{set:function(e){i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor=e},get:function(){return i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor}});l.InteractionManager&&(Object.defineProperty(l.InteractionManager,"defaultCursorStyle",{set:function(e){i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default=e},get:function(){return i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default}}),Object.defineProperty(l.InteractionManager,"currentCursorStyle",{set:function(e){i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode=e},get:function(){return i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode}}))};var n={};function i(e){if(!n[e]){var t=(new Error).stack;void 0===t?console.warn("Deprecation Warning: ",e):(t=t.split("\n").splice(3).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e),console.warn(t),console.groupEnd()):(console.warn("Deprecation Warning: ",e),console.warn(t))),n[e]=!0}}},meNg:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),i=function(e){return e&&e.__esModule?e:{default:e}}(r("QNV1"));var o=n.ticker.shared;n.settings.UPLOADS_PER_FRAME=4;var s=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.limiter=new i.default(n.settings.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){r.queue&&r.prepareItems()},this.registerFindHook(d),this.registerFindHook(p),this.registerFindHook(a),this.registerFindHook(l),this.registerFindHook(c),this.registerUploadHook(u),this.registerUploadHook(h)}return e.prototype.upload=function(e,t){"function"==typeof e&&(t=e,e=null),e&&this.add(e),this.queue.length?(t&&this.completes.push(t),this.ticking||(this.ticking=!0,o.addOnce(this.tick,this,n.UPDATE_PRIORITY.UTILITY))):t&&t()},e.prototype.tick=function(){setTimeout(this.delayedTick,0)},e.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],t=!1;if(e&&!e._destroyed)for(var r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)o.addOnce(this.tick,this,n.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var s=this.completes.slice(0);this.completes.length=0;for(var a=0,l=s.length;a<l;a++)s[a]()}},e.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},e.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},e.prototype.add=function(e){for(var t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof n.Container)for(var i=e.children.length-1;i>=0;i--)this.add(e.children[i]);return this},e.prototype.destroy=function(){this.ticking&&o.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},e}();function a(e,t){var r=!1;if(e&&e._textures&&e._textures.length)for(var i=0;i<e._textures.length;i++)if(e._textures[i]instanceof n.Texture){var o=e._textures[i].baseTexture;-1===t.indexOf(o)&&(t.push(o),r=!0)}return r}function l(e,t){return e instanceof n.BaseTexture&&(-1===t.indexOf(e)&&t.push(e),!0)}function c(e,t){if(e._texture&&e._texture instanceof n.Texture){var r=e._texture.baseTexture;return-1===t.indexOf(r)&&t.push(r),!0}return!1}function u(e,t){return t instanceof n.Text&&(t.updateText(!0),!0)}function h(e,t){if(t instanceof n.TextStyle){var r=t.toFontString();return n.TextMetrics.measureFont(r),!0}return!1}function d(e,t){if(e instanceof n.Text){-1===t.indexOf(e.style)&&t.push(e.style),-1===t.indexOf(e)&&t.push(e);var r=e._texture.baseTexture;return-1===t.indexOf(r)&&t.push(r),!0}return!1}function p(e,t){return e instanceof n.TextStyle&&(-1===t.indexOf(e)&&t.push(e),!0)}t.default=s},ms1K:function(e,t,r){"use strict";t.__esModule=!0,t.default={mixin:function(e){!function(e){e.__plugins={},e.registerPlugin=function(t,r){e.__plugins[t]=r},e.prototype.initPlugins=function(){for(var t in this.plugins=this.plugins||{},e.__plugins)this.plugins[t]=new e.__plugins[t](this)},e.prototype.destroyPlugins=function(){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;this.plugins=null}}(e)}}},nWIE:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=r("qp2T");var s=function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,n=arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16384,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return o>16384&&(o=16384),o>r&&(o=r),a._properties=[!1,!0,!1,!1,!1],a._maxSize=r,a._batchSize=o,a._glBuffers={},a._bufferUpdateIDs=[],a._updateID=0,a.interactiveChildren=!1,a.blendMode=i.BLEND_MODES.NORMAL,a.autoResize=s,a.roundPixels=!0,a.baseTexture=null,a.setProperties(n),a._tint=0,a.tintRgb=new Float32Array(4),a.tint=16777215,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.setProperties=function(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])},t.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},t.prototype.renderWebGL=function(e){var t=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.hasLoaded||this.baseTexture.once("update",function(){return t.onChildrenChange(0)})),e.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))},t.prototype.onChildrenChange=function(e){for(var t=Math.floor(e/this._batchSize);this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID},t.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var t=e.context,r=this.worldTransform,n=!0,i=0,o=0,s=0,a=0;e.setBlendMode(this.blendMode),t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var c=this.children[l];if(c.visible){var u=c._texture.frame;if(t.globalAlpha=this.worldAlpha*c.alpha,c.rotation%(2*Math.PI)==0)n&&(t.setTransform(r.a,r.b,r.c,r.d,r.tx*e.resolution,r.ty*e.resolution),n=!1),i=c.anchor.x*(-u.width*c.scale.x)+c.position.x+.5,o=c.anchor.y*(-u.height*c.scale.y)+c.position.y+.5,s=u.width*c.scale.x,a=u.height*c.scale.y;else{n||(n=!0),c.displayObjectUpdateTransform();var h=c.worldTransform;e.roundPixels?t.setTransform(h.a,h.b,h.c,h.d,h.tx*e.resolution|0,h.ty*e.resolution|0):t.setTransform(h.a,h.b,h.c,h.d,h.tx*e.resolution,h.ty*e.resolution),i=c.anchor.x*-u.width+.5,o=c.anchor.y*-u.height+.5,s=u.width,a=u.height}var d=c._texture.baseTexture.resolution;t.drawImage(c._texture.baseTexture.source,u.x*d,u.y*d,u.width*d,u.height*d,i*e.resolution,o*e.resolution,s*e.resolution,a*e.resolution)}}}},t.prototype.destroy=function(t){if(e.prototype.destroy.call(this,t),this._buffers)for(var r=0;r<this._buffers.length;++r)this._buffers[r].destroy();this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},n(t,[{key:"tint",get:function(){return this._tint},set:function(e){this._tint=e,(0,o.hex2rgb)(e,this.tintRgb)}}]),t}(i.Container);t.default=s},nd3L:function(e,t,r){var n=r("JUUD");function i(e,t){if(this.nativeVaoExtension=null,i.FORCE_NATIVE||(this.nativeVaoExtension=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object")),this.nativeState=t,this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var r=e.getParameter(e.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(r),attribState:new Array(r)}}this.gl=e,this.attributes=[],this.indexBuffer=null,this.dirty=!1}i.prototype.constructor=i,e.exports=i,i.FORCE_NATIVE=!1,i.prototype.bind=function(){if(this.nativeVao){if(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty)return this.dirty=!1,this.activate(),this;this.indexBuffer&&this.indexBuffer.bind()}else this.activate();return this},i.prototype.unbind=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null),this},i.prototype.activate=function(){for(var e=this.gl,t=null,r=0;r<this.attributes.length;r++){var i=this.attributes[r];t!==i.buffer&&(i.buffer.bind(),t=i.buffer),e.vertexAttribPointer(i.attribute.location,i.attribute.size,i.type||e.FLOAT,i.normalized||!1,i.stride||0,i.start||0)}return n(e,this.attributes,this.nativeState),this.indexBuffer&&this.indexBuffer.bind(),this},i.prototype.addAttribute=function(e,t,r,n,i,o){return this.attributes.push({buffer:e,attribute:t,location:t.location,type:r||this.gl.FLOAT,normalized:n||!1,stride:i||0,start:o||0}),this.dirty=!0,this},i.prototype.addIndex=function(e){return this.indexBuffer=e,this.dirty=!0,this},i.prototype.clear=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.attributes.length=0,this.indexBuffer=null,this},i.prototype.draw=function(e,t,r){var n=this.gl;return this.indexBuffer?n.drawElements(e,t||this.indexBuffer.data.length,n.UNSIGNED_SHORT,2*(r||0)):n.drawArrays(e,r,t||this.getSize()),this},i.prototype.destroy=function(){this.gl=null,this.indexBuffer=null,this.attributes=null,this.nativeState=null,this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao),this.nativeVaoExtension=null,this.nativeVao=null},i.prototype.getSize=function(){var e=this.attributes[0];return e.buffer.data.length/(e.stride/4||e.attribute.size)}},"oIG/":function(e,t,r){(function(e){var n;!function(i){var o="object"==typeof t&&t,s=("object"==typeof e&&e&&e.exports,"object"==typeof global&&global);s.global!==s&&s.window;var a,l,c,u=String.fromCharCode;function h(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function d(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function p(e,t){return u(e>>t&63|128)}function f(e,t){if(0==(4294967168&e))return u(e);var r="";return 0==(4294965248&e)?r=u(e>>6&31|192):0==(4294901760&e)?(d(e,t)||(e=65533),r=u(e>>12&15|224),r+=p(e,6)):0==(4292870144&e)&&(r=u(e>>18&7|240),r+=p(e,12),r+=p(e,6)),r+=u(63&e|128)}function m(){if(c>=l)throw Error("Invalid byte index");var e=255&a[c];if(c++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function v(e){var t,r;if(c>l)throw Error("Invalid byte index");if(c==l)return!1;if(t=255&a[c],c++,0==(128&t))return t;if(192==(224&t)){if((r=(31&t)<<6|m())>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&t)){if((r=(15&t)<<12|m()<<6|m())>=2048)return d(r,e)?r:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(r=(7&t)<<18|m()<<12|m()<<6|m())>=65536&&r<=1114111)return r;throw Error("Invalid UTF-8 detected")}var g={version:"2.1.2",encode:function(e,t){for(var r=!1!==(t=t||{}).strict,n=h(e),i=n.length,o=-1,s="";++o<i;)s+=f(n[o],r);return s},decode:function(e,t){var r=!1!==(t=t||{}).strict;a=h(e),l=a.length,c=0;for(var n,i=[];!1!==(n=v(r));)i.push(n);return function(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=u((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=u(t);return i}(i)}};void 0===(n=(function(){return g}).call(t,r,t,e))||(e.exports=n)}()}).call(this,r("YuTi")(e))},oXL5:function(e,t,r){"use strict";t.__esModule=!0,t.parse=a,t.default=function(){return function(e,t){if(e.data&&e.type===o.Resource.TYPE.XML)if(0!==e.data.getElementsByTagName("page").length&&0!==e.data.getElementsByTagName("info").length&&null!==e.data.getElementsByTagName("info")[0].getAttribute("face")){var r=e.isDataUrl?"":n.dirname(e.url);e.isDataUrl&&("."===r&&(r=""),this.baseUrl&&r&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(r+="/")),(r=r.replace(this.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/");var s=r+e.data.getElementsByTagName("page")[0].getAttribute("file");if(i.utils.TextureCache[s])a(e,i.utils.TextureCache[s]),t();else{var l={crossOrigin:e.crossOrigin,loadType:o.Resource.LOAD_TYPE.IMAGE,metadata:e.metadata.imageMetadata,parentResource:e};this.add(e.name+"_image",s,l,function(r){a(e,r.texture),t()})}}else t();else t()}};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("2U8Y")),i=r("3AcN"),o=r("z+eP"),s=r("Y12R");function a(e,t){e.bitmapFont=s.BitmapText.registerFont(e.data,t)}},p6KW:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){for(var t=n[e],r=t.length,o=i,s="",a=void 0,l=0;l<e;l++){var c="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",l);a=l,l>=r&&(a=e-l-1),c=c.replace("%value%",t[a]),s+=c,s+="\n"}return o=(o=o.replace("%blur%",s)).replace("%size%",e)};var n={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},i=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n")},"p85+":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),i=s(r("yI/K")),o=s(r("sBhT"));r("2U8Y");function s(e){return e&&e.__esModule?e:{default:e}}var a=n.Matrix.IDENTITY,l=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.shader=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=new n.Shader(e,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")},t.prototype.render=function(e){var t=this.renderer,r=t.gl,s=e._texture;if(s.valid){var l=e._glDatas[t.CONTEXT_UID];l||(t.bindVao(null),(l={shader:this.shader,vertexBuffer:i.default.GLBuffer.createVertexBuffer(r,e.vertices,r.STREAM_DRAW),uvBuffer:i.default.GLBuffer.createVertexBuffer(r,e.uvs,r.STREAM_DRAW),indexBuffer:i.default.GLBuffer.createIndexBuffer(r,e.indices,r.STATIC_DRAW),vao:null,dirty:e.dirty,indexDirty:e.indexDirty}).vao=new i.default.VertexArrayObject(r).addIndex(l.indexBuffer).addAttribute(l.vertexBuffer,l.shader.attributes.aVertexPosition,r.FLOAT,!1,8,0).addAttribute(l.uvBuffer,l.shader.attributes.aTextureCoord,r.FLOAT,!1,8,0),e._glDatas[t.CONTEXT_UID]=l),t.bindVao(l.vao),e.dirty!==l.dirty&&(l.dirty=e.dirty,l.uvBuffer.upload(e.uvs)),e.indexDirty!==l.indexDirty&&(l.indexDirty=e.indexDirty,l.indexBuffer.upload(e.indices)),l.vertexBuffer.upload(e.vertices),t.bindShader(l.shader),l.shader.uniforms.uSampler=t.bindTexture(s),t.state.setBlendMode(n.utils.correctBlendMode(e.blendMode,s.baseTexture.premultipliedAlpha)),l.shader.uniforms.uTransform&&(e.uploadUvTransform?l.shader.uniforms.uTransform=e._uvTransform.mapCoord.toArray(!0):l.shader.uniforms.uTransform=a.toArray(!0)),l.shader.uniforms.translationMatrix=e.worldTransform.toArray(!0),l.shader.uniforms.uColor=n.utils.premultiplyRgba(e.tintRgb,e.worldAlpha,l.shader.uniforms.uColor,s.baseTexture.premultipliedAlpha);var c=e.drawMode===o.default.DRAW_MODES.TRIANGLE_MESH?r.TRIANGLE_STRIP:r.TRIANGLES;l.vao.draw(c,e.indices.length,0)}},t}(n.ObjectRenderer);t.default=l,n.WebGLRenderer.registerPlugin("mesh",l)},pDOs:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r("Yd/J"));var o=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||i.default.RESOLUTION,this.resize(t,r)}return e.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.resize=function(e,t){this.canvas.width=e*this.resolution,this.canvas.height=t*this.resolution},e.prototype.destroy=function(){this.context=null,this.canvas=null},n(e,[{key:"width",get:function(){return this.canvas.width},set:function(e){this.canvas.width=e}},{key:"height",get:function(){return this.canvas.height},set:function(e){this.canvas.height=e}}]),e}();t.default=o},pEa2:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),i=r("pQYt");r("2U8Y");var o=new n.Matrix,s=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return n.shader=null,n.simpleShader=null,n.quad=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=new n.Shader(e,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"),this.simpleShader=new n.Shader(e,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"),this.renderer.bindVao(null),this.quad=new n.Quad(e,this.renderer.state.attribState),this.quad.initVao(this.shader)},t.prototype.render=function(e){var t=this.renderer,r=this.quad;t.bindVao(r.vao);var s=r.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y),e.uvRespectAnchor&&((s=r.uvs)[0]=s[6]=-e.anchor.x,s[1]=s[3]=-e.anchor.y,s[2]=s[4]=1-e.anchor.x,s[5]=s[7]=1-e.anchor.y),r.upload();var a=e._texture,l=a.baseTexture,c=e.tileTransform.localTransform,u=e.uvTransform,h=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;h&&(l._glTextures[t.CONTEXT_UID]?h=l.wrapMode!==i.WRAP_MODES.CLAMP:l.wrapMode===i.WRAP_MODES.CLAMP&&(l.wrapMode=i.WRAP_MODES.REPEAT));var d=h?this.simpleShader:this.shader;t.bindShader(d);var p=a.width,f=a.height,m=e._width,v=e._height;o.set(c.a*p/m,c.b*p/v,c.c*f/m,c.d*f/v,c.tx/m,c.ty/v),o.invert(),h?o.prepend(u.mapCoord):(d.uniforms.uMapCoord=u.mapCoord.toArray(!0),d.uniforms.uClampFrame=u.uClampFrame,d.uniforms.uClampOffset=u.uClampOffset),d.uniforms.uTransform=o.toArray(!0),d.uniforms.uColor=n.utils.premultiplyTintToRgba(e.tint,e.worldAlpha,d.uniforms.uColor,l.premultipliedAlpha),d.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),d.uniforms.uSampler=t.bindTexture(a),t.setBlendMode(n.utils.correctBlendMode(e.blendMode,l.premultipliedAlpha)),r.vao.draw(this.renderer.gl.TRIANGLES,6,0)},t}(n.ObjectRenderer);t.default=s,n.WebGLRenderer.registerPlugin("tilingSprite",s)},pIo5:function(e,t,r){"use strict";"use restrict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1||!e)},t.log2=function(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=n,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var i=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(i),t.reverse=function(e){return i[255&e]<<24|i[e>>>8&255]<<16|i[e>>>16&255]<<8|i[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,r){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},pQYt:function(e,t,r){"use strict";t.__esModule=!0;t.VERSION="4.7.3",t.PI_2=2*Math.PI,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2},t.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19},t.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},t.SCALE_MODES={LINEAR:0,NEAREST:1},t.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},t.GC_MODES={AUTO:0,MANUAL:1},t.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i,t.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;(charset=[\w-]+|base64))?,(.*)/i,t.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,t.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},t.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},t.TRANSFORM_MODE={STATIC:0,DYNAMIC:1},t.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},t.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50}},pV5o:function(e,t,r){"use strict";t.__esModule=!0;var n=y(r("FI+O")),i=y(r("NE8l")),o=y(r("9PbN")),s=y(r("D+IV")),a=y(r("8WrO")),l=y(r("4FaX")),c=y(r("BzvT")),u=y(r("3Jm9")),h=y(r("Nv7N")),d=y(r("VAGf")),p=y(r("ew+k")),f=y(r("9I6j")),m=r("qp2T"),v=y(r("yI/K")),g=r("pQYt");function y(e){return e&&e.__esModule?e:{default:e}}var x=0,b=function(e){function t(r,n,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"WebGL",r,n,s));return a.legacy=a.options.legacy,a.legacy&&(v.default.VertexArrayObject.FORCE_NATIVE=!0),a.type=g.RENDERER_TYPE.WEBGL,a.handleContextLost=a.handleContextLost.bind(a),a.handleContextRestored=a.handleContextRestored.bind(a),a.view.addEventListener("webglcontextlost",a.handleContextLost,!1),a.view.addEventListener("webglcontextrestored",a.handleContextRestored,!1),a._contextOptions={alpha:a.transparent,antialias:a.options.antialias,premultipliedAlpha:a.transparent&&"notMultiplied"!==a.transparent,stencil:!0,preserveDrawingBuffer:a.options.preserveDrawingBuffer,powerPreference:a.options.powerPreference},a._backgroundColorRgba[3]=a.transparent?0:1,a.maskManager=new i.default(a),a.stencilManager=new o.default(a),a.emptyRenderer=new l.default(a),a.currentRenderer=a.emptyRenderer,a.textureManager=null,a.filterManager=null,a.initPlugins(),a.options.context&&(0,f.default)(a.options.context),a.gl=a.options.context||v.default.createContext(a.view,a._contextOptions),a.CONTEXT_UID=x++,a.state=new d.default(a.gl),a.renderingToScreen=!0,a.boundTextures=null,a._activeShader=null,a._activeVao=null,a._activeRenderTarget=null,a._initContext(),a.drawModes=(0,p.default)(a.gl),a._nextTextureLocation=0,a.setBlendMode(0),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._initContext=function(){var e=this.gl;e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext();var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null,this._activeVao=null,this.boundTextures=new Array(t),this.emptyTextures=new Array(t),this.textureManager=new c.default(this),this.filterManager=new s.default(this),this.textureGC=new h.default(this),this.state.resetToDefault(),this.rootRenderTarget=new a.default(e,this.width,this.height,null,this.resolution,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget);var r=new v.default.GLTexture.fromData(e,null,1,1),n={_glTextures:{}};n._glTextures[this.CONTEXT_UID]={};for(var i=0;i<t;i++){var o=new u.default;o._glTextures[this.CONTEXT_UID]=r,this.boundTextures[i]=n,this.emptyTextures[i]=o,this.bindTexture(null,i)}this.emit("context",e),this.resize(this.screen.width,this.screen.height)},t.prototype.render=function(e,t,r,n,i){if(this.renderingToScreen=!t,this.emit("prerender"),this.gl&&!this.gl.isContextLost()){if(this._nextTextureLocation=0,t||(this._lastObjectRendered=e),!i){var o=e.parent;e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=o}this.bindRenderTexture(t,n),this.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this._activeRenderTarget.clear(),e.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender")}},t.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.resize=function(e,t){n.default.prototype.resize.call(this,e,t),this.rootRenderTarget.resize(e,t),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},t.prototype.setBlendMode=function(e){this.state.setBlendMode(e)},t.prototype.clear=function(e){this._activeRenderTarget.clear(e)},t.prototype.setTransform=function(e){this._activeRenderTarget.transform=e},t.prototype.clearRenderTexture=function(e,t){var r=e.baseTexture._glRenderTargets[this.CONTEXT_UID];return r&&r.clear(t),this},t.prototype.bindRenderTexture=function(e,t){var r=void 0;if(e){var n=e.baseTexture;n._glRenderTargets[this.CONTEXT_UID]||this.textureManager.updateTexture(n,0),this.unbindTexture(n),(r=n._glRenderTargets[this.CONTEXT_UID]).setFrame(e.frame)}else r=this.rootRenderTarget;return r.transform=t,this.bindRenderTarget(r),this},t.prototype.bindRenderTarget=function(e){return e!==this._activeRenderTarget&&(this._activeRenderTarget=e,e.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=e.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(e.stencilMaskStack)),this},t.prototype.bindShader=function(e,t){return this._activeShader!==e&&(this._activeShader=e,e.bind(),!1!==t&&(e.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0))),this},t.prototype.bindTexture=function(e,t,r){if((e=(e=e||this.emptyTextures[t]).baseTexture||e).touched=this.textureGC.count,r)t=t||0;else{for(var n=0;n<this.boundTextures.length;n++)if(this.boundTextures[n]===e)return n;void 0===t&&(this._nextTextureLocation++,this._nextTextureLocation%=this.boundTextures.length,t=this.boundTextures.length-this._nextTextureLocation-1)}var i=this.gl,o=e._glTextures[this.CONTEXT_UID];return o?(this.boundTextures[t]=e,i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,o.texture)):this.textureManager.updateTexture(e,t),t},t.prototype.unbindTexture=function(e){var t=this.gl;e=e.baseTexture||e;for(var r=0;r<this.boundTextures.length;r++)this.boundTextures[r]===e&&(this.boundTextures[r]=this.emptyTextures[r],t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,this.emptyTextures[r]._glTextures[this.CONTEXT_UID].texture));return this},t.prototype.createVao=function(){return new v.default.VertexArrayObject(this.gl,this.state.attribState)},t.prototype.bindVao=function(e){return this._activeVao===e?this:(e?e.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=e,this)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer),this.bindVao(null),this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.emptyTextures[e];return this.rootRenderTarget.activate(),this.state.resetToDefault(),this},t.prototype.handleContextLost=function(e){e.preventDefault()},t.prototype.handleContextRestored=function(){this.textureManager.removeAll(),this.filterManager.destroy(!0),this._initContext()},t.prototype.destroy=function(t){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.textureManager.destroy(),e.prototype.destroy.call(this,t),this.uid=0,this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.maskManager=null,this.filterManager=null,this.textureManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null},t}(n.default);t.default=b,m.pluginTarget.mixin(b)},pVcz:function(e,t,r){"use strict";t.__esModule=!0;var n=u(r("FI+O")),i=u(r("cva9")),o=u(r("pDOs")),s=u(r("hN+0")),a=r("qp2T"),l=r("pQYt"),c=u(r("Yd/J"));function u(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(r,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,"Canvas",r,n,o));return a.type=l.RENDERER_TYPE.CANVAS,a.rootContext=a.view.getContext("2d",{alpha:a.transparent}),a.context=a.rootContext,a.refresh=!0,a.maskManager=new i.default(a),a.smoothProperty="imageSmoothingEnabled",a.rootContext.imageSmoothingEnabled||(a.rootContext.webkitImageSmoothingEnabled?a.smoothProperty="webkitImageSmoothingEnabled":a.rootContext.mozImageSmoothingEnabled?a.smoothProperty="mozImageSmoothingEnabled":a.rootContext.oImageSmoothingEnabled?a.smoothProperty="oImageSmoothingEnabled":a.rootContext.msImageSmoothingEnabled&&(a.smoothProperty="msImageSmoothingEnabled")),a.initPlugins(),a.blendModes=(0,s.default)(),a._activeBlendMode=null,a.renderingToScreen=!1,a.resize(a.options.width,a.options.height),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(e,t,r,n,i){if(this.view){this.renderingToScreen=!t,this.emit("prerender");var s=this.resolution;t?((t=t.baseTexture||t)._canvasRenderTarget||(t._canvasRenderTarget=new o.default(t.width,t.height,t.resolution),t.source=t._canvasRenderTarget.canvas,t.valid=!0),this.context=t._canvasRenderTarget.context,this.resolution=t._canvasRenderTarget.resolution):this.context=this.rootContext;var a=this.context;if(t||(this._lastObjectRendered=e),!i){var c=e.parent,u=this._tempDisplayObjectParent.transform.worldTransform;n?(n.copy(u),this._tempDisplayObjectParent.transform._worldID=-1):u.identity(),e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=c}a.save(),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this._activeBlendMode=l.BLEND_MODES.NORMAL,a.globalCompositeOperation=this.blendModes[l.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(a.fillStyle="black",a.clear()),(void 0!==r?r:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?a.clearRect(0,0,this.width,this.height):(a.fillStyle=this._backgroundColorString,a.fillRect(0,0,this.width,this.height)));var h=this.context;this.context=a,e.renderCanvas(this),this.context=h,a.restore(),this.resolution=s,this.emit("postrender")}},t.prototype.clear=function(e){var t=this.context;e=e||this._backgroundColorString,!this.transparent&&e?(t.fillStyle=e,t.fillRect(0,0,this.width,this.height)):t.clearRect(0,0,this.width,this.height)},t.prototype.setBlendMode=function(e){this._activeBlendMode!==e&&(this._activeBlendMode=e,this.context.globalCompositeOperation=this.blendModes[e])},t.prototype.destroy=function(t){this.destroyPlugins(),e.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},t.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this.smoothProperty&&(this.rootContext[this.smoothProperty]=c.default.SCALE_MODE===l.SCALE_MODES.LINEAR)},t.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},t}(n.default);t.default=h,a.pluginTarget.mixin(h)},qCKp:function(e,t,r){"use strict";var n=r(null),i=(r(null),r(null),r(null)),o=r(null),s=r(null),a=r(null),l=r(null),c=r(null),u=r(null),h=r(null),d=r(null),p=r(null),f=r(null);class m extends f.a{constructor(e=v,t=Number.POSITIVE_INFINITY){super(e,()=>this.frame),this.maxFrames=t,this.frame=0,this.index=-1}flush(){const{actions:e,maxFrames:t}=this;let r,n;for(;(n=e.shift())&&(this.frame=n.delay)<=t&&!(r=n.execute(n.state,n.delay)););if(r){for(;n=e.shift();)n.unsubscribe();throw r}}}m.frameTimeFactor=10;class v extends p.a{constructor(e,t,r=(e.index+=1)){super(e,t),this.scheduler=e,this.work=t,this.index=r,this.active=!0,this.index=e.index=r}schedule(e,t=0){if(!this.id)return super.schedule(e,t);this.active=!1;const r=new v(this.scheduler,this.work);return this.add(r),r.schedule(e,t)}requestAsyncId(e,t,r=0){this.delay=e.frame+r;const{actions:n}=e;return n.push(this),n.sort(v.sortActions),!0}recycleAsyncId(e,t,r=0){}_execute(e,t){if(!0===this.active)return super._execute(e,t)}static sortActions(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1}}var g=r(null),y=r(null),x=r(null),b=r(null),w=r(null),_=r(null),S=r(null);function T(e){return e&&e instanceof n.a||"function"==typeof e.lift&&"function"==typeof e.subscribe}var M=r(null),A=r(null),E=r(null),C=r(null),P=r(null),O=r(null),D=r(null),N=r(null),L=r(null),I=r(null),R=r(null),F=r(null),k=r(null),U=r(null),B=r(null),j=r(null),z=r(null),V=r(null),G=r(null),H=r(null),W=r(null),X=r(null),q=r(null),Y=r(null),J=r(null),Z=r(null),Q=r(null),K=r(null),$=r(null),ee=r(null);r.d(t,"Observable",function(){return n.a}),r.d(t,"ConnectableObservable",function(){}),r.d(t,"GroupedObservable",function(){}),r.d(t,"observable",function(){return i.a}),r.d(t,"Subject",function(){return o.a}),r.d(t,"BehaviorSubject",function(){return s.a}),r.d(t,"ReplaySubject",function(){return a.a}),r.d(t,"AsyncSubject",function(){return l.a}),r.d(t,"asapScheduler",function(){return c.a}),r.d(t,"asyncScheduler",function(){return u.a}),r.d(t,"queueScheduler",function(){return h.a}),r.d(t,"animationFrameScheduler",function(){return d.a}),r.d(t,"VirtualTimeScheduler",function(){return m}),r.d(t,"VirtualAction",function(){return v}),r.d(t,"Scheduler",function(){return g.a}),r.d(t,"Subscription",function(){return y.a}),r.d(t,"Subscriber",function(){return x.a}),r.d(t,"Notification",function(){return b.a}),r.d(t,"pipe",function(){return w.b}),r.d(t,"noop",function(){return _.a}),r.d(t,"identity",function(){return S.a}),r.d(t,"isObservable",function(){return T}),r.d(t,"ArgumentOutOfRangeError",function(){return M.a}),r.d(t,"EmptyError",function(){return A.a}),r.d(t,"ObjectUnsubscribedError",function(){return E.a}),r.d(t,"UnsubscriptionError",function(){return C.a}),r.d(t,"TimeoutError",function(){return P.a}),r.d(t,"bindCallback",function(){return O.a}),r.d(t,"bindNodeCallback",function(){return D.a}),r.d(t,"combineLatest",function(){return N.b}),r.d(t,"concat",function(){return L.a}),r.d(t,"defer",function(){return I.a}),r.d(t,"empty",function(){return R.a}),r.d(t,"forkJoin",function(){return F.a}),r.d(t,"from",function(){return k.a}),r.d(t,"fromEvent",function(){return U.a}),r.d(t,"fromEventPattern",function(){return B.a}),r.d(t,"generate",function(){return j.a}),r.d(t,"iif",function(){return z.a}),r.d(t,"interval",function(){return V.a}),r.d(t,"merge",function(){return G.a}),r.d(t,"never",function(){}),r.d(t,"of",function(){return W.a}),r.d(t,"onErrorResumeNext",function(){return X.a}),r.d(t,"pairs",function(){return q.a}),r.d(t,"race",function(){return Y.a}),r.d(t,"range",function(){return J.a}),r.d(t,"throwError",function(){return Z.a}),r.d(t,"timer",function(){return Q.a}),r.d(t,"using",function(){return K.a}),r.d(t,"zip",function(){return $.b}),r.d(t,"EMPTY",function(){return R.b}),r.d(t,"NEVER",function(){return H.a}),r.d(t,"config",function(){return ee.a})},qEO2:function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("TXE8")),i=r("pQYt");var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=r,this.width=n,this.height=o,this.type=i.SHAPES.ELIP}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var r=(e-this.x)/this.width,n=(t-this.y)/this.height;return(r*=r)+(n*=n)<=1},e.prototype.getBounds=function(){return new n.default(this.x-this.width,this.y-this.height,this.width,this.height)},e}();t.default=o},qllB:function(e,t,r){"use strict";t.__esModule=!0,t.shared=t.Resource=t.textureParser=t.getResourcePath=t.spritesheetParser=t.parseBitmapFontData=t.bitmapFontParser=t.Loader=void 0;var n=r("oXL5");Object.defineProperty(t,"bitmapFontParser",{enumerable:!0,get:function(){return c(n).default}}),Object.defineProperty(t,"parseBitmapFontData",{enumerable:!0,get:function(){return n.parse}});var i=r("Nx1p");Object.defineProperty(t,"spritesheetParser",{enumerable:!0,get:function(){return c(i).default}}),Object.defineProperty(t,"getResourcePath",{enumerable:!0,get:function(){return i.getResourcePath}});var o=r("SLIe");Object.defineProperty(t,"textureParser",{enumerable:!0,get:function(){return c(o).default}});var s=r("z+eP");Object.defineProperty(t,"Resource",{enumerable:!0,get:function(){return s.Resource}});var a=c(r("zLIK")),l=c(r("e8hs"));function c(e){return e&&e.__esModule?e:{default:e}}t.Loader=l.default;var u=new l.default;u.destroy=function(){},t.shared=u;var h=a.default.prototype;h._loader=null,Object.defineProperty(h,"loader",{get:function(){if(!this._loader){var e=this._options.sharedLoader;this._loader=e?u:new l.default}return this._loader}}),h._parentDestroy=h.destroy,h.destroy=function(e){this._loader&&(this._loader.destroy(),this._loader=null),this._parentDestroy(e)}},qp2T:function(e,t,r){"use strict";t.__esModule=!0,t.premultiplyBlendMode=t.BaseTextureCache=t.TextureCache=t.earcut=t.mixins=t.pluginTarget=t.EventEmitter=t.removeItems=t.isMobile=void 0,t.uid=function(){return++f},t.hex2rgb=function(e,t){return(t=t||[])[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t},t.hex2string=function(e){return e=e.toString(16),"#"+(e="000000".substr(0,6-e.length)+e)},t.rgb2hex=function(e){return(255*e[0]<<16)+(255*e[1]<<8)+(255*e[2]|0)},t.getResolutionOfUrl=function(e,t){var r=i.default.RETINA_PREFIX.exec(e);if(r)return parseFloat(r[1]);return void 0!==t?t:1},t.decomposeDataUri=function(e){var t=n.DATA_URI.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,encoding:t[3]?t[3].toLowerCase():void 0,data:t[4]};return},t.getUrlFileExtension=function(e){var t=n.URL_FILE_EXTENSION.exec(e);if(t)return t[1].toLowerCase();return},t.getSvgSize=function(e){var t=n.SVG_SIZE.exec(e),r={};t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7])));return r},t.skipHello=function(){m=!0},t.sayHello=function(e){if(m)return;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var t=["\n %c %c %c PixiJS "+n.VERSION+" - \u2730 "+e+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,t)}else window.console&&window.console.log("PixiJS "+n.VERSION+" - "+e+" - http://www.pixijs.com/");m=!0},t.isWebGLSupported=function(){var e={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var t=document.createElement("canvas"),r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),n=!(!r||!r.getContextAttributes().stencil);if(r){var i=r.getExtension("WEBGL_lose_context");i&&i.loseContext()}return r=null,n}catch(e){return!1}},t.sign=function(e){return 0===e?0:e<0?-1:1},t.destroyTextureCache=function(){var e=void 0;for(e in v)v[e].destroy();for(e in g)g[e].destroy()},t.clearTextureCache=function(){var e=void 0;for(e in v)delete v[e];for(e in g)delete g[e]},t.correctBlendMode=function(e,t){return y[t?1:0][e]},t.premultiplyTint=function(e,t){if(1===t)return(255*t<<24)+e;if(0===t)return 0;var r=e>>16&255,n=e>>8&255,i=255&e;return(255*t<<24)+((r=r*t+.5|0)<<16)+((n=n*t+.5|0)<<8)+(i=i*t+.5|0)},t.premultiplyRgba=function(e,t,r,n){r=r||new Float32Array(4),n||void 0===n?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t):(r[0]=e[0],r[1]=e[1],r[2]=e[2]);return r[3]=t,r},t.premultiplyTintToRgba=function(e,t,r,n){(r=r||new Float32Array(4))[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,(n||void 0===n)&&(r[0]*=t,r[1]*=t,r[2]*=t);return r[3]=t,r};var n=r("pQYt"),i=p(r("Yd/J")),o=p(r("uhBA")),s=p(r("ms1K")),a=d(r("uQ0E")),l=d(r("G9Ht")),c=p(r("0QlW")),u=p(r("dGcs")),h=p(r("VmRL"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}var f=0,m=!1;t.isMobile=l,t.removeItems=c.default,t.EventEmitter=o.default,t.pluginTarget=s.default,t.mixins=a,t.earcut=h.default;var v=t.TextureCache=Object.create(null),g=t.BaseTextureCache=Object.create(null);var y=t.premultiplyBlendMode=(0,u.default)()},r8II:function(e,t,r){"use strict";t.decode=t.parse=r("YcCt"),t.encode=t.stringify=r("6MUB")},rI9z:function(e,t){var r=function(e){for(var t=new Array(e),r=0;r<t.length;r++)t[r]=!1;return t};e.exports=function(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"bool":return!1;case"bvec2":return r(2*t);case"bvec3":return r(3*t);case"bvec4":return r(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}},rUHO:function(e,t,r){"use strict";t.__esModule=!0,t.calculateScreenSpaceMatrix=function(e,t,r){var n=e.identity();return n.translate(t.x/r.width,t.y/r.height),n.scale(r.width,r.height),n},t.calculateNormalizedScreenSpaceMatrix=function(e,t,r){var n=e.identity();n.translate(t.x/r.width,t.y/r.height);var i=r.width/t.width,o=r.height/t.height;return n.scale(i,o),n},t.calculateSpriteMatrix=function(e,t,r,i){var o=i._texture.orig,s=e.set(r.width,0,0,r.height,t.x,t.y),a=i.worldTransform.copy(n.Matrix.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(i.anchor.x,i.anchor.y),s};var n=r("d07J")},rWzI:function(e,t,r){(function(e){var n;!function(i){"object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType;var o="object"==typeof global&&global;o.global!==o&&o.window!==o&&o.self;var s,a=2147483647,l=36,c=1,u=26,h=38,d=700,p=72,f=128,m="-",v=/^xn--/,g=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=l-c,w=Math.floor,_=String.fromCharCode;function S(e){throw RangeError(x[e])}function T(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function M(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+T((e=e.replace(y,".")).split("."),t).join(".")}function A(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function E(e){return T(e,function(e){var t="";return e>65535&&(t+=_((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=_(e)}).join("")}function C(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:l}function P(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function O(e,t,r){var n=0;for(e=r?w(e/d):e>>1,e+=w(e/t);e>b*u>>1;n+=l)e=w(e/b);return w(n+(b+1)*e/(e+h))}function D(e){var t,r,n,i,o,s,h,d,v,g,y=[],x=e.length,b=0,_=f,T=p;for((r=e.lastIndexOf(m))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&S("not-basic"),y.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<x;){for(o=b,s=1,h=l;i>=x&&S("invalid-input"),((d=C(e.charCodeAt(i++)))>=l||d>w((a-b)/s))&&S("overflow"),b+=d*s,!(d<(v=h<=T?c:h>=T+u?u:h-T));h+=l)s>w(a/(g=l-v))&&S("overflow"),s*=g;T=O(b-o,t=y.length+1,0==o),w(b/t)>a-_&&S("overflow"),_+=w(b/t),b%=t,y.splice(b++,0,_)}return E(y)}function N(e){var t,r,n,i,o,s,h,d,v,g,y,x,b,T,M,E=[];for(x=(e=A(e)).length,t=f,r=0,o=p,s=0;s<x;++s)(y=e[s])<128&&E.push(_(y));for(n=i=E.length,i&&E.push(m);n<x;){for(h=a,s=0;s<x;++s)(y=e[s])>=t&&y<h&&(h=y);for(h-t>w((a-r)/(b=n+1))&&S("overflow"),r+=(h-t)*b,t=h,s=0;s<x;++s)if((y=e[s])<t&&++r>a&&S("overflow"),y==t){for(d=r,v=l;!(d<(g=v<=o?c:v>=o+u?u:v-o));v+=l)M=d-g,T=l-g,E.push(_(P(g+M%T,0))),d=w(M/T);E.push(_(P(d,0))),o=O(r,b,n==i),r=0,++n}++r,++t}return E.join("")}s={version:"1.3.2",ucs2:{decode:A,encode:E},decode:D,encode:N,toASCII:function(e){return M(e,function(e){return g.test(e)?"xn--"+N(e):e})},toUnicode:function(e){return M(e,function(e){return v.test(e)?D(e.slice(4).toLowerCase()):e})}},void 0===(n=(function(){return s}).call(t,r,t,e))||(e.exports=n)}()}).call(this,r("YuTi")(e))},rvTR:function(e,t,r){"use strict";var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN"));n.DisplayObject.prototype.name=null,n.Container.prototype.getChildByName=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t];return null}},s1PF:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=c(r("3Jm9")),o=r("qp2T"),s=r("8g3p"),a=r("pQYt"),l=c(r("ad8U"));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(r,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!r)throw new Error("No video source element specified.");(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,n));return i.width=r.videoWidth,i.height=r.videoHeight,i._autoUpdate=!0,i._isAutoUpdating=!1,i.autoPlay=!0,i.update=i.update.bind(i),i._onCanPlay=i._onCanPlay.bind(i),r.addEventListener("play",i._onPlayStart.bind(i)),r.addEventListener("pause",i._onPlayStop.bind(i)),i.hasLoaded=!1,i.__loaded=!1,i._isSourceReady()?i._onCanPlay():(r.addEventListener("canplay",i._onCanPlay),r.addEventListener("canplaythrough",i._onCanPlay)),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._isSourcePlaying=function(){var e=this.source;return e.currentTime>0&&!1===e.paused&&!1===e.ended&&e.readyState>2},t.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},t.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(s.shared.add(this.update,this,a.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0)},t.prototype._onPlayStop=function(){this._isAutoUpdating&&(s.shared.remove(this.update,this),this._isAutoUpdating=!1)},t.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.emit("loaded",this)),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.source.play())},t.prototype.destroy=function(){this._isAutoUpdating&&s.shared.remove(this.update,this),this.source&&this.source._pixiId&&(i.default.removeFromCache(this.source._pixiId),delete this.source._pixiId,this.source.pause(),this.source.src="",this.source.load()),e.prototype.destroy.call(this)},t.fromVideo=function(e,r){e._pixiId||(e._pixiId="video_"+(0,o.uid)());var n=o.BaseTextureCache[e._pixiId];return n||(n=new t(e,r),i.default.addToCache(n,e._pixiId)),n},t.fromUrl=function(e,r,n){var i=document.createElement("video");i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","");var o=Array.isArray(e)?e[0].src||e[0]:e.src||e;if(void 0===n&&0!==o.indexOf("data:")?i.crossOrigin=(0,l.default)(o):n&&(i.crossOrigin="string"==typeof n?n:"anonymous"),Array.isArray(e))for(var s=0;s<e.length;++s)i.appendChild(h(e[s].src||e[s],e[s].mime));else i.appendChild(h(o,e.mime));return i.load(),t.fromVideo(i,r)},n(t,[{key:"autoUpdate",get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isAutoUpdating?(s.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(s.shared.add(this.update,this,a.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0))}}]),t}(i.default);function h(e,t){t||(t="video/"+e.substr(e.lastIndexOf(".")+1));var r=document.createElement("source");return r.src=e,r.type=t,r}t.default=u,u.fromUrls=u.fromUrl},s1jd:function(e,t,r){"use strict";t.__esModule=!0,t.encodeBinary=function(e){var t="",r=0;for(;r<e.length;){for(var i=[0,0,0],o=[0,0,0,0],s=0;s<i.length;++s)r<e.length?i[s]=255&e.charCodeAt(r++):i[s]=0;o[0]=i[0]>>2,o[1]=(3&i[0])<<4|i[1]>>4,o[2]=(15&i[1])<<2|i[2]>>6,o[3]=63&i[2];var a=r-(e.length-1);switch(a){case 2:o[3]=64,o[2]=64;break;case 1:o[3]=64}for(var l=0;l<o.length;++l)t+=n.charAt(o[l])}return t};var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},sAjT:function(e,t,r){"use strict";t.__esModule=!0;var n=r("d07J");var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null}return e.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},e.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},e.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?n.Rectangle.EMPTY:((e=e||new n.Rectangle(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},e.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},e.prototype.addQuad=function(e){var t=this.minX,r=this.minY,n=this.maxX,i=this.maxY,o=e[0],s=e[1];t=o<t?o:t,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,o=e[2],s=e[3],t=o<t?o:t,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,o=e[4],s=e[5],t=o<t?o:t,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,o=e[6],s=e[7],t=o<t?o:t,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,this.minX=t,this.minY=r,this.maxX=n,this.maxY=i},e.prototype.addFrame=function(e,t,r,n,i){var o=e.worldTransform,s=o.a,a=o.b,l=o.c,c=o.d,u=o.tx,h=o.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,v=s*t+l*r+u,g=a*t+c*r+h;d=v<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=a*n+c*r+h,d=(v=s*n+l*r+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=a*t+c*i+h,d=(v=s*t+l*i+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=a*n+c*i+h,d=(v=s*n+l*i+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},e.prototype.addVertices=function(e,t,r,n){for(var i=e.worldTransform,o=i.a,s=i.b,a=i.c,l=i.d,c=i.tx,u=i.ty,h=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=r;m<n;m+=2){var v=t[m],g=t[m+1],y=o*v+a*g+c,x=l*g+s*v+u;h=y<h?y:h,d=x<d?x:d,p=y>p?y:p,f=x>f?x:f}this.minX=h,this.minY=d,this.maxX=p,this.maxY=f},e.prototype.addBounds=function(e){var t=this.minX,r=this.minY,n=this.maxX,i=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>i?e.maxY:i},e.prototype.addBoundsMask=function(e,t){var r=e.minX>t.minX?e.minX:t.minX,n=e.minY>t.minY?e.minY:t.minY,i=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=i&&n<=o){var s=this.minX,a=this.minY,l=this.maxX,c=this.maxY;this.minX=r<s?r:s,this.minY=n<a?n:a,this.maxX=i>l?i:l,this.maxY=o>c?o:c}},e.prototype.addBoundsArea=function(e,t){var r=e.minX>t.x?e.minX:t.x,n=e.minY>t.y?e.minY:t.y,i=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=i&&n<=o){var s=this.minX,a=this.minY,l=this.maxX,c=this.maxY;this.minX=r<s?r:s,this.minY=n<a?n:a,this.maxX=i>l?i:l,this.maxY=o>c?o:c}},e}();t.default=i},sBhT:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("3AcN")),o=function(e){return e&&e.__esModule?e:{default:e}}(r("xJsK"));var s=new i.Point,a=new i.Polygon,l=function(e){function t(r,n,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return c._texture=r||o.default.EMPTY,c.uvs=s||new Float32Array([0,0,1,0,1,1,0,1]),c.vertices=n||new Float32Array([0,0,100,0,100,100,0,100]),c.indices=a||new Uint16Array([0,1,3,2]),c.dirty=0,c.indexDirty=0,c.blendMode=i.BLEND_MODES.NORMAL,c.canvasPadding=i.settings.MESH_CANVAS_PADDING,c.drawMode=l||t.DRAW_MODES.TRIANGLE_MESH,c.shader=null,c.tintRgb=new Float32Array([1,1,1]),c._glDatas={},c._uvTransform=new i.TextureMatrix(c._texture),c.uploadUvTransform=!1,c.pluginName="mesh",c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._renderWebGL=function(e){this.refresh(),e.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)},t.prototype._renderCanvas=function(e){this.refresh(),e.plugins[this.pluginName].render(this)},t.prototype._onTextureUpdate=function(){this._uvTransform.texture=this._texture,this.refresh()},t.prototype.multiplyUvs=function(){this.uploadUvTransform||this._uvTransform.multiplyUvs(this.uvs)},t.prototype.refresh=function(e){this._uvTransform.update(e)&&this._refresh()},t.prototype._refresh=function(){},t.prototype._calculateBounds=function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)},t.prototype.containsPoint=function(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,s);for(var r=this.vertices,n=a.points,i=this.indices,o=this.indices.length,l=this.drawMode===t.DRAW_MODES.TRIANGLES?3:1,c=0;c+2<o;c+=l){var u=2*i[c],h=2*i[c+1],d=2*i[c+2];if(n[0]=r[u],n[1]=r[u+1],n[2]=r[h],n[3]=r[h+1],n[4]=r[d],n[5]=r[d+1],a.contains(s.x,s.y))return!0}return!1},n(t,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,e&&(e.baseTexture.hasLoaded?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}},{key:"tint",get:function(){return i.utils.rgb2hex(this.tintRgb)},set:function(e){this.tintRgb=i.utils.hex2rgb(e,this.tintRgb)}}]),t}(i.Container);t.default=l,l.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},sEJ7:function(e,t,r){"use strict";if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!global.performance||!global.performance.now){var n=Date.now();global.performance||(global.performance={}),global.performance.now=function(){return Date.now()-n}}for(var i=Date.now(),o=["ms","moz","webkit","o"],s=0;s<o.length&&!global.requestAnimationFrame;++s){var a=o[s];global.requestAnimationFrame=global[a+"RequestAnimationFrame"],global.cancelAnimationFrame=global[a+"CancelAnimationFrame"]||global[a+"CancelRequestAnimationFrame"]}global.requestAnimationFrame||(global.requestAnimationFrame=function(e){if("function"!=typeof e)throw new TypeError(e+"is not a function");var t=Date.now(),r=16+i-t;return r<0&&(r=0),i=t,setTimeout(function(){i=Date.now(),e(performance.now())},r)}),global.cancelAnimationFrame||(global.cancelAnimationFrame=function(e){return clearTimeout(e)})},"t/7c":function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r("pVcz")),i=r("pQYt");var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t}return e.prototype.render=function(e){var t=this.renderer,r=t.context,n=e.worldAlpha,o=e.transform.worldTransform,s=t.resolution;this._prevTint!==this.tint&&(this.dirty=!0),r.setTransform(o.a*s,o.b*s,o.c*s,o.d*s,o.tx*s,o.ty*s),e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1),t.setBlendMode(e.blendMode);for(var a=0;a<e.graphicsData.length;a++){var l=e.graphicsData[a],c=l.shape,u=l._fillTint,h=l._lineTint;if(r.lineWidth=l.lineWidth,l.type===i.SHAPES.POLY){r.beginPath(),this.renderPolygon(c.points,c.closed,r);for(var d=0;d<l.holes.length;d++)this.renderPolygon(l.holes[d].points,!0,r);l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}else if(l.type===i.SHAPES.RECT)(l.fillColor||0===l.fillColor)&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fillRect(c.x,c.y,c.width,c.height)),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.strokeRect(c.x,c.y,c.width,c.height));else if(l.type===i.SHAPES.CIRC)r.beginPath(),r.arc(c.x,c.y,c.radius,0,2*Math.PI),r.closePath(),l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke());else if(l.type===i.SHAPES.ELIP){var p=2*c.width,f=2*c.height,m=c.x-p/2,v=c.y-f/2;r.beginPath();var g=p/2*.5522848,y=f/2*.5522848,x=m+p,b=v+f,w=m+p/2,_=v+f/2;r.moveTo(m,_),r.bezierCurveTo(m,_-y,w-g,v,w,v),r.bezierCurveTo(w+g,v,x,_-y,x,_),r.bezierCurveTo(x,_+y,w+g,b,w,b),r.bezierCurveTo(w-g,b,m,_+y,m,_),r.closePath(),l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}else if(l.type===i.SHAPES.RREC){var S=c.x,T=c.y,M=c.width,A=c.height,E=c.radius,C=Math.min(M,A)/2|0;E=E>C?C:E,r.beginPath(),r.moveTo(S,T+E),r.lineTo(S,T+A-E),r.quadraticCurveTo(S,T+A,S+E,T+A),r.lineTo(S+M-E,T+A),r.quadraticCurveTo(S+M,T+A,S+M,T+A-E),r.lineTo(S+M,T+E),r.quadraticCurveTo(S+M,T,S+M-E,T),r.lineTo(S+E,T),r.quadraticCurveTo(S,T,S,T+E),r.closePath(),(l.fillColor||0===l.fillColor)&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}}},e.prototype.updateGraphicsTint=function(e){e._prevTint=e.tint;for(var t=(e.tint>>16&255)/255,r=(e.tint>>8&255)/255,n=(255&e.tint)/255,i=0;i<e.graphicsData.length;++i){var o=e.graphicsData[i],s=0|o.fillColor,a=0|o.lineColor;o._fillTint=((s>>16&255)/255*t*255<<16)+((s>>8&255)/255*r*255<<8)+(255&s)/255*n*255,o._lineTint=((a>>16&255)/255*t*255<<16)+((a>>8&255)/255*r*255<<8)+(255&a)/255*n*255}},e.prototype.renderPolygon=function(e,t,r){r.moveTo(e[0],e[1]);for(var n=1;n<e.length/2;++n)r.lineTo(e[2*n],e[2*n+1]);t&&r.closePath()},e.prototype.destroy=function(){this.renderer=null},e}();t.default=o,n.default.registerPlugin("graphics",o)},u62O:function(e,t,r){"use strict";e.exports=function(e,t){t=t||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[t.strictMode?"strict":"loose"].exec(e),i={},o=14;o--;)i[r.key[o]]=n[o]||"";return i[r.q.name]={},i[r.key[12]].replace(r.q.parser,function(e,t,n){t&&(i[r.q.name][t]=n)}),i}},uQ0E:function(e,t,r){"use strict";function n(e,t){if(e&&t)for(var r=Object.keys(t),n=0;n<r.length;++n){var i=r[n];Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}}t.__esModule=!0,t.mixin=n,t.delayMixin=function(e,t){i.push(e,t)},t.performMixins=function(){for(var e=0;e<i.length;e+=2)n(i[e],i[e+1]);i.length=0};var i=[]},"uc/I":function(e,t,r){"use strict";t.__esModule=!0,t.autoDetectRenderer=function(e,t,r,s){var a=e&&e.forceCanvas;void 0!==s&&(a=s);if(!a&&n.isWebGLSupported())return new o.default(e,t,r);return new i.default(e,t,r)};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("qp2T")),i=s(r("pVcz")),o=s(r("pV5o"));function s(e){return e&&e.__esModule?e:{default:e}}},uhBA:function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function o(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e,t){var r=i?i+e:e,n=this._events[r];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,a=new Array(s);o<s;o++)a[o]=n[o].fn;return a},a.prototype.emit=function(e,t,r,n,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,o),!0;case 6:return u.fn.call(u.context,t,r,n,o,s),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,n);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,r){var n=new s(t,r||this),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},a.prototype.once=function(e,t,r){var n=new s(t,r||this,!0),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},a.prototype.removeListener=function(e,t,r,n){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return 0==--this._eventsCount?this._events=new o:delete this._events[s],this;var a=this._events[s];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||(0==--this._eventsCount?this._events=new o:delete this._events[s]);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||n&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[s]=1===c.length?c[0]:c:0==--this._eventsCount?this._events=new o:delete this._events[s]}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new o:delete this._events[t])):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=i,a.EventEmitter=a,e.exports=a},ujOt:function(e,t){var r={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};e.exports=function(e){return r[e]}},vUM4:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("pQYt"),o=r("qp2T");var s={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:i.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,wordWrap:!1,wordWrapWidth:100,leading:0},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.styleID=0,this.reset(),u(this,t,t)}return e.prototype.clone=function(){var t={};return u(t,this,s),new e(t)},e.prototype.reset=function(){u(this,s,s)},e.prototype.toFontString=function(){var e="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(var r=t.length-1;r>=0;r--){var n=t[r].trim();/([\"\'])[^\'\"]+\1/.test(n)||(n='"'+n+'"'),t[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+t.join(",")},n(e,[{key:"align",get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.styleID++)}},{key:"breakWords",get:function(){return this._breakWords},set:function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}},{key:"dropShadow",get:function(){return this._dropShadow},set:function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}},{key:"dropShadowAlpha",get:function(){return this._dropShadowAlpha},set:function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}},{key:"dropShadowAngle",get:function(){return this._dropShadowAngle},set:function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}},{key:"dropShadowBlur",get:function(){return this._dropShadowBlur},set:function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}},{key:"dropShadowColor",get:function(){return this._dropShadowColor},set:function(e){var t=c(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}},{key:"dropShadowDistance",get:function(){return this._dropShadowDistance},set:function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}},{key:"fill",get:function(){return this._fill},set:function(e){var t=c(e);this._fill!==t&&(this._fill=t,this.styleID++)}},{key:"fillGradientType",get:function(){return this._fillGradientType},set:function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}},{key:"fillGradientStops",get:function(){return this._fillGradientStops},set:function(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}},{key:"fontVariant",get:function(){return this._fontVariant},set:function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}},{key:"leading",get:function(){return this._leading},set:function(e){this._leading!==e&&(this._leading=e,this.styleID++)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding!==e&&(this._padding=e,this.styleID++)}},{key:"stroke",get:function(){return this._stroke},set:function(e){var t=c(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}},{key:"strokeThickness",get:function(){return this._strokeThickness},set:function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}},{key:"textBaseline",get:function(){return this._textBaseline},set:function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}},{key:"trim",get:function(){return this._trim},set:function(e){this._trim!==e&&(this._trim=e,this.styleID++)}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}},{key:"wordWrapWidth",get:function(){return this._wordWrapWidth},set:function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}}]),e}();function l(e){return"number"==typeof e?(0,o.hex2string)(e):("string"==typeof e&&0===e.indexOf("0x")&&(e=e.replace("0x","#")),e)}function c(e){if(Array.isArray(e)){for(var t=0;t<e.length;++t)e[t]=l(e[t]);return e}return l(e)}function u(e,t,r){for(var n in r)Array.isArray(t[n])?e[n]=t[n].slice():e[n]=t[n]}t.default=a},"w0v+":function(e,t,r){"use strict";var n=r(null),i=r(null),o=r(null),s=r(null),a=r(null),l=r(null),c=r(null),u=r(null),h=r(null),d=r(null),p=r(null),f=r(null),m=r(null),v=r(null),g=(r(null),r(null)),y=(r(null),r(null),r(null),r(null)),x=r(null),b=r(null),w=r(null),_=r(null),S=r(null),T=r(null),M=r(null),A=r(null),E=r(null);function C(e,t){for(let r=0,n=t.length;r<n;r++){const n=t[r],i=Object.getOwnPropertyNames(n.prototype);for(let t=0,r=i.length;t<r;t++){const r=i[t];e.prototype[r]=n.prototype[r]}}}var P=r(null),O=r(null),D=r(null),N=r(null),L=r(null),I=r(null),R=r(null),F=r(null),k=r(null),U=r(null),B=r(null),j=r(null),z=r(null),V=r(null),G=r(null),H=r(null),W=r(null),X=r(null),q=r(null),Y=r(null),J=r(null),Z=r(null),Q=r(null),K=r(null),$=r(null);r.d(t,"config",function(){return n.a}),r.d(t,"InnerSubscriber",function(){return i.a}),r.d(t,"OuterSubscriber",function(){return o.a}),r.d(t,"Scheduler",function(){return s.a}),r.d(t,"AnonymousSubject",function(){return a.c}),r.d(t,"SubjectSubscription",function(){return l.a}),r.d(t,"Subscriber",function(){return c.a}),r.d(t,"fromPromise",function(){return u.a}),r.d(t,"fromIterable",function(){return h.a}),r.d(t,"ajax",function(){return d.a}),r.d(t,"webSocket",function(){return p.a}),r.d(t,"ajaxGet",function(){}),r.d(t,"ajaxPost",function(){}),r.d(t,"ajaxDelete",function(){}),r.d(t,"ajaxPut",function(){}),r.d(t,"ajaxPatch",function(){}),r.d(t,"ajaxGetJSON",function(){}),r.d(t,"AjaxObservable",function(){return f.a}),r.d(t,"AjaxSubscriber",function(){}),r.d(t,"AjaxResponse",function(){}),r.d(t,"AjaxError",function(){}),r.d(t,"AjaxTimeoutError",function(){}),r.d(t,"WebSocketSubject",function(){return m.a}),r.d(t,"CombineLatestOperator",function(){return v.a}),r.d(t,"dispatch",function(){}),r.d(t,"SubscribeOnObservable",function(){return g.a}),r.d(t,"Timestamp",function(){}),r.d(t,"TimeInterval",function(){}),r.d(t,"GroupedObservable",function(){}),r.d(t,"defaultThrottleConfig",function(){return y.b}),r.d(t,"rxSubscriber",function(){return x.a}),r.d(t,"iterator",function(){return b.a}),r.d(t,"observable",function(){return w.a}),r.d(t,"ArgumentOutOfRangeError",function(){return _.a}),r.d(t,"EmptyError",function(){return S.a}),r.d(t,"Immediate",function(){return T.a}),r.d(t,"ObjectUnsubscribedError",function(){return M.a}),r.d(t,"TimeoutError",function(){return A.a}),r.d(t,"UnsubscriptionError",function(){return E.a}),r.d(t,"applyMixins",function(){return C}),r.d(t,"errorObject",function(){return P.a}),r.d(t,"hostReportError",function(){return O.a}),r.d(t,"identity",function(){return D.a}),r.d(t,"isArray",function(){return N.a}),r.d(t,"isArrayLike",function(){return L.a}),r.d(t,"isDate",function(){return I.a}),r.d(t,"isFunction",function(){return R.a}),r.d(t,"isIterable",function(){return F.a}),r.d(t,"isNumeric",function(){return k.a}),r.d(t,"isObject",function(){return U.a}),r.d(t,"isObservable",function(){return B.a}),r.d(t,"isPromise",function(){return j.a}),r.d(t,"isScheduler",function(){return z.a}),r.d(t,"noop",function(){return V.a}),r.d(t,"not",function(){return G.a}),r.d(t,"pipe",function(){return H.b}),r.d(t,"root",function(){return W.a}),r.d(t,"subscribeTo",function(){return X.a}),r.d(t,"subscribeToArray",function(){return q.a}),r.d(t,"subscribeToIterable",function(){return Y.a}),r.d(t,"subscribeToObservable",function(){return J.a}),r.d(t,"subscribeToPromise",function(){return Z.a}),r.d(t,"subscribeToResult",function(){return Q.a}),r.d(t,"toSubscriber",function(){return K.a}),r.d(t,"tryCatch",function(){return $.a})},xD7H:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t){var r=i;r=(r=r.replace(/%count%/gi,t)).replace(/%forloop%/gi,function(e){var t="";t+="\n",t+="\n";for(var r=0;r<e;r++)r>0&&(t+="\nelse "),r<e-1&&(t+="if(textureId == "+r+".0)"),t+="\n{",t+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",t+="\n}";return t+="\n",t+="\n"}(t));for(var o=new n.default(e,"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n",r),s=[],a=0;a<t;a++)s[a]=a;return o.bind(),o.uniforms.uSamplers=s,o};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("N0WC"));r("2U8Y");var i=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","float textureId = floor(vTextureId+0.5);","%forloop%","gl_FragColor = color * vColor;","}"].join("\n")},xJsK:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=h(r("3Jm9")),o=h(r("s1PF")),s=h(r("963y")),a=h(r("uhBA")),l=r("d07J"),c=r("qp2T"),u=h(r("Yd/J"));function h(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(r,n,i,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));if(a.noFrame=!1,n||(a.noFrame=!0,n=new l.Rectangle(0,0,1,1)),r instanceof t&&(r=r.baseTexture),a.baseTexture=r,a._frame=n,a.trim=o,a.valid=!1,a.requiresUpdate=!1,a._uvs=null,a.orig=i||n,a._rotate=Number(s||0),!0===s)a._rotate=2;else if(a._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return r.hasLoaded?(a.noFrame&&(n=new l.Rectangle(0,0,r.width,r.height),r.on("update",a.onBaseTextureUpdated,a)),a.frame=n):r.once("loaded",a.onBaseTextureLoaded,a),a._updateID=0,a.transform=null,a.textureCacheIds=[],a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.update=function(){this.baseTexture.update()},t.prototype.onBaseTextureLoaded=function(e){this._updateID++,this.noFrame?this.frame=new l.Rectangle(0,0,e.width,e.height):this.frame=this._frame,this.baseTexture.on("update",this.onBaseTextureUpdated,this),this.emit("update",this)},t.prototype.onBaseTextureUpdated=function(e){this._updateID++,this._frame.width=e.width,this._frame.height=e.height,this.emit("update",this)},t.prototype.destroy=function(e){this.baseTexture&&(e&&(c.TextureCache[this.baseTexture.imageUrl]&&t.removeFromCache(this.baseTexture.imageUrl),this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null},t.prototype.clone=function(){return new t(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)},t.prototype._updateUvs=function(){this._uvs||(this._uvs=new s.default),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},t.fromImage=function(e,r,n,o){var s=c.TextureCache[e];return s||(s=new t(i.default.fromImage(e,r,n,o)),t.addToCache(s,e)),s},t.fromFrame=function(e){var t=c.TextureCache[e];if(!t)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return t},t.fromCanvas=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas";return new t(i.default.fromCanvas(e,r,n))},t.fromVideo=function(e,r){return"string"==typeof e?t.fromVideoUrl(e,r):new t(o.default.fromVideo(e,r))},t.fromVideoUrl=function(e,r){return new t(o.default.fromUrl(e,r))},t.from=function(e){if("string"==typeof e){var r=c.TextureCache[e];return r||(null!==e.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?t.fromVideoUrl(e):t.fromImage(e))}return e instanceof HTMLImageElement?new t(i.default.from(e)):e instanceof HTMLCanvasElement?t.fromCanvas(e,u.default.SCALE_MODE,"HTMLCanvasElement"):e instanceof HTMLVideoElement?t.fromVideo(e):e instanceof i.default?new t(e):e},t.fromLoader=function(e,r,n){var o=new i.default(e,void 0,(0,c.getResolutionOfUrl)(r)),s=new t(o);return o.imageUrl=r,n||(n=r),i.default.addToCache(s.baseTexture,n),t.addToCache(s,n),n!==r&&(i.default.addToCache(s.baseTexture,r),t.addToCache(s,r)),s},t.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),c.TextureCache[t]&&console.warn("Texture added to the cache with an id ["+t+"] that already had an entry"),c.TextureCache[t]=e)},t.removeFromCache=function(e){if("string"==typeof e){var t=c.TextureCache[e];if(t){var r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete c.TextureCache[e],t}}else if(e&&e.textureCacheIds){for(var n=0;n<e.textureCacheIds.length;++n)c.TextureCache[e.textureCacheIds[n]]===e&&delete c.TextureCache[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null},n(t,[{key:"frame",get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var t=e.x,r=e.y,n=e.width,i=e.height,o=t+n>this.baseTexture.width,s=r+i>this.baseTexture.height;if(o||s){var a=o&&s?"and":"or",l="X: "+t+" + "+n+" = "+(t+n)+" > "+this.baseTexture.width,c="Y: "+r+" + "+i+" = "+(r+i)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+l+" "+a+" "+c)}this.valid=n&&i&&this.baseTexture.hasLoaded,this.trim||this.rotate||(this.orig=e),this.valid&&this._updateUvs()}},{key:"rotate",get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this._updateUvs()}},{key:"width",get:function(){return this.orig.width}},{key:"height",get:function(){return this.orig.height}}]),t}(a.default);function p(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}t.default=d,d.EMPTY=new d(new i.default),p(d.EMPTY),p(d.EMPTY.baseTexture),d.WHITE=function(){var e=document.createElement("canvas");e.width=10,e.height=10;var t=e.getContext("2d");return t.fillStyle="white",t.fillRect(0,0,10,10),new d(new i.default(e))}(),p(d.WHITE),p(d.WHITE.baseTexture)},"xXZ/":function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fn=t,this.context=r,this.priority=n,this.once=i,this.next=null,this.previous=null,this._destroyed=!1}return e.prototype.match=function(e,t){return t=t||null,this.fn===e&&this.context===t},e.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t},e.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},e.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var t=this.previous;return this.next=e?null:t,this.previous=null,t},e}();t.default=n},xnYG:function(e,t,r){"use strict";Math.sign||(Math.sign=function(e){return 0===(e=Number(e))||isNaN(e)?e:e>0?1:-1})},xqnD:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){if(n.default.tablet||n.default.phone)return 4;return e};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("G9Ht"))},"y/pH":function(e,t,r){"use strict";t.__esModule=!0;var n=r("JehY");Object.defineProperty(t,"FXAAFilter",{enumerable:!0,get:function(){return h(n).default}});var i=r("Is4P");Object.defineProperty(t,"NoiseFilter",{enumerable:!0,get:function(){return h(i).default}});var o=r("fS4Z");Object.defineProperty(t,"DisplacementFilter",{enumerable:!0,get:function(){return h(o).default}});var s=r("dyai");Object.defineProperty(t,"BlurFilter",{enumerable:!0,get:function(){return h(s).default}});var a=r("I42F");Object.defineProperty(t,"BlurXFilter",{enumerable:!0,get:function(){return h(a).default}});var l=r("ASAs");Object.defineProperty(t,"BlurYFilter",{enumerable:!0,get:function(){return h(l).default}});var c=r("Y8mV");Object.defineProperty(t,"ColorMatrixFilter",{enumerable:!0,get:function(){return h(c).default}});var u=r("jK9F");function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"AlphaFilter",{enumerable:!0,get:function(){return h(u).default}})},"yI/K":function(e,t,r){var n={createContext:r("K9TQ"),setVertexAttribArrays:r("JUUD"),GLBuffer:r("HNzc"),GLFramebuffer:r("FNZ9"),GLShader:r("P2LE"),GLTexture:r("B7f1"),VertexArrayObject:r("nd3L"),shader:r("l0yf")};void 0!==e&&e.exports&&(e.exports=n),"undefined"!=typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=n)},yY4z:function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t,r){var s=e.shape,a=s.x,c=s.y,u=s.width,h=s.height,d=s.radius,p=[];if(p.push(a,c+d),l(a,c+h-d,a,c+h,a+d,c+h,p),l(a+u-d,c+h,a+u,c+h,a+u,c+h-d,p),l(a+u,c+d,a+u,c,a+u-d,c,p),l(a+d,c,a,c,a,c+d+1e-10,p),e.fill){for(var f=(0,o.hex2rgb)(e.fillColor),m=e.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,x=t.points,b=t.indices,w=x.length/6,_=(0,n.default)(p,null,2),S=0,T=_.length;S<T;S+=3)b.push(_[S]+w),b.push(_[S]+w),b.push(_[S+1]+w),b.push(_[S+2]+w),b.push(_[S+2]+w);for(var M=0,A=p.length;M<A;M++)x.push(p[M],p[++M],v,g,y,m)}if(e.lineWidth){var E=e.points;e.points=p,(0,i.default)(e,t,r),e.points=E}};var n=s(r("VmRL")),i=s(r("5OzF")),o=r("qp2T");function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r){return e+(t-e)*r}function l(e,t,r,n,i,o){for(var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0;f<=20;++f)l=a(e,r,m=f/20),c=a(t,n,m),u=a(r,i,m),h=a(n,o,m),d=a(l,u,m),p=a(c,h,m),s.push(d,p);return s}},yeub:function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},ypnn:function(e,t){e.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(r-t),s=t,a=0;s<r;s++,a++)o[a]=i[s];return o.buffer}},"z+eP":function(e,t,r){"use strict";var n=r("JkEu").default,i=r("Xwh9").default,o=r("UdPh"),s=r("s1jd");n.Resource=i,n.async=o,n.base64=s,e.exports=n,e.exports.default=n},zJ60:function(e,t,r){var n=r("Uxeu"),i=r("NOtv")("socket.io-client:url");e.exports=function(e,t){var r=e;t=t||global.location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),r=n(e));r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443"));r.path=r.path||"/";var o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port,r.href=r.protocol+"://"+o+(t&&t.port===r.port?"":":"+r.port),r}},zLIK:function(e,t,r){"use strict";t.__esModule=!0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r("uc/I"),o=c(r("a/Ns")),s=r("8g3p"),a=c(r("Yd/J")),l=r("pQYt");function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,r,n,l,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"number"==typeof t&&(t=Object.assign({width:t,height:r||a.default.RENDER_OPTIONS.height,forceCanvas:!!l,sharedTicker:!!c},n)),this._options=t=Object.assign({autoStart:!0,sharedTicker:!1,forceCanvas:!1,sharedLoader:!1},t),this.renderer=(0,i.autoDetectRenderer)(t),this.stage=new o.default,this._ticker=null,this.ticker=t.sharedTicker?s.shared:new s.Ticker,t.autoStart&&this.start()}return e.prototype.render=function(){this.renderer.render(this.stage)},e.prototype.stop=function(){this._ticker.stop()},e.prototype.start=function(){this._ticker.start()},e.prototype.destroy=function(e){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}this.stage.destroy(),this.stage=null,this.renderer.destroy(e),this.renderer=null,this._options=null},n(e,[{key:"ticker",set:function(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,l.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}},{key:"view",get:function(){return this.renderer.view}},{key:"screen",get:function(){return this.renderer.screen}}]),e}();t.default=u},zMFY:function(e,t){function r(){}e.exports=function(e,t,n){var i=!1;return n=n||r,o.count=e,0===e?t():o;function o(e,r){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,t(e),t=n):0!==o.count||i||t(null,r)}}},zUnb:function(e,t,r){"use strict";r.r(t);var n={};function i(e){return"function"==typeof e}r.d(n,"audit",function(){return NI}),r.d(n,"auditTime",function(){return RI}),r.d(n,"buffer",function(){return rL}),r.d(n,"bufferCount",function(){return oL}),r.d(n,"bufferTime",function(){return cL}),r.d(n,"bufferToggle",function(){return vL}),r.d(n,"bufferWhen",function(){return xL}),r.d(n,"catchError",function(){return oc}),r.d(n,"combineAll",function(){return SL}),r.d(n,"combineLatest",function(){return nk}),r.d(n,"concat",function(){return ik}),r.d(n,"concatAll",function(){return hp}),r.d(n,"concatMap",function(){return mc}),r.d(n,"concatMapTo",function(){return TL}),r.d(n,"count",function(){return ML}),r.d(n,"debounce",function(){return DL}),r.d(n,"debounceTime",function(){return IL}),r.d(n,"defaultIfEmpty",function(){return $d}),r.d(n,"delay",function(){return BL}),r.d(n,"delayWhen",function(){return GL}),r.d(n,"dematerialize",function(){return CL}),r.d(n,"distinct",function(){return YL}),r.d(n,"distinctUntilChanged",function(){return QL}),r.d(n,"distinctUntilKeyChanged",function(){return eI}),r.d(n,"elementAt",function(){return hI}),r.d(n,"every",function(){return Vd}),r.d(n,"exhaust",function(){return rI}),r.d(n,"exhaustMap",function(){return oI}),r.d(n,"expand",function(){return lI}),r.d(n,"filter",function(){return dc}),r.d(n,"finalize",function(){return dI}),r.d(n,"find",function(){return vI}),r.d(n,"findIndex",function(){return xI}),r.d(n,"first",function(){return sp}),r.d(n,"groupBy",function(){return bI}),r.d(n,"ignoreElements",function(){return AI}),r.d(n,"isEmpty",function(){return PI}),r.d(n,"last",function(){return rp}),r.d(n,"map",function(){return H}),r.d(n,"mapTo",function(){return kI}),r.d(n,"materialize",function(){return jI}),r.d(n,"max",function(){return GI}),r.d(n,"merge",function(){return ok}),r.d(n,"mergeAll",function(){return $}),r.d(n,"mergeMap",function(){return J}),r.d(n,"flatMap",function(){return J}),r.d(n,"mergeMapTo",function(){return WI}),r.d(n,"mergeScan",function(){return qI}),r.d(n,"min",function(){return ZI}),r.d(n,"multicast",function(){return le}),r.d(n,"observeOn",function(){return qN}),r.d(n,"onErrorResumeNext",function(){return QI}),r.d(n,"pairwise",function(){return eR}),r.d(n,"partition",function(){return nR}),r.d(n,"pluck",function(){return iR}),r.d(n,"publish",function(){return oR}),r.d(n,"publishBehavior",function(){return sR}),r.d(n,"publishLast",function(){return lR}),r.d(n,"publishReplay",function(){return aR}),r.d(n,"race",function(){return cR}),r.d(n,"reduce",function(){return up}),r.d(n,"repeat",function(){return uR}),r.d(n,"repeatWhen",function(){return pR}),r.d(n,"retry",function(){return vR}),r.d(n,"retryWhen",function(){return xR}),r.d(n,"refCount",function(){return te}),r.d(n,"sample",function(){return _R}),r.d(n,"sampleTime",function(){return MR}),r.d(n,"scan",function(){return ap}),r.d(n,"sequenceEqual",function(){return PR}),r.d(n,"share",function(){return he}),r.d(n,"shareReplay",function(){return LR}),r.d(n,"single",function(){return IR}),r.d(n,"skip",function(){return kR}),r.d(n,"skipLast",function(){return jR}),r.d(n,"skipUntil",function(){return GR}),r.d(n,"skipWhile",function(){return XR}),r.d(n,"startWith",function(){return JR}),r.d(n,"subscribeOn",function(){return tF}),r.d(n,"switchAll",function(){return sF}),r.d(n,"switchMap",function(){return nF}),r.d(n,"switchMapTo",function(){return lF}),r.d(n,"take",function(){return np}),r.d(n,"takeLast",function(){return Xd}),r.d(n,"takeUntil",function(){return cF}),r.d(n,"takeWhile",function(){return dF}),r.d(n,"tap",function(){return Jd}),r.d(n,"throttle",function(){return vF}),r.d(n,"throttleTime",function(){return xF}),r.d(n,"throwIfEmpty",function(){return Kd}),r.d(n,"timeInterval",function(){return SF}),r.d(n,"timeout",function(){return PF}),r.d(n,"timeoutWith",function(){return AF}),r.d(n,"timestamp",function(){return OF}),r.d(n,"toArray",function(){return LF}),r.d(n,"window",function(){return IF}),r.d(n,"windowCount",function(){return kF}),r.d(n,"windowTime",function(){return jF}),r.d(n,"windowToggle",function(){return qF}),r.d(n,"windowWhen",function(){return ZF}),r.d(n,"withLatestFrom",function(){return $F}),r.d(n,"zip",function(){return sk}),r.d(n,"zipAll",function(){return rk});let o=!1;const s={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else o&&console.log("RxJS: Back to a better error behavior. Thank you. <3");o=e},get useDeprecatedSynchronousErrorHandling(){return o}};function a(e){setTimeout(()=>{throw e})}const l={closed:!0,next(e){},error(e){if(s.useDeprecatedSynchronousErrorHandling)throw e;a(e)},complete(){}},c=Array.isArray||(e=>e&&"number"==typeof e.length);function u(e){return null!=e&&"object"==typeof e}const h={e:{}};let d;function p(){try{return d.apply(this,arguments)}catch(e){return h.e=e,h}}function f(e){return d=e,p}class m extends Error{constructor(e){super(e?`${e.length} errors occurred during unsubscription:\n  ${e.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:""),this.errors=e,this.name="UnsubscriptionError",Object.setPrototypeOf(this,m.prototype)}}class v{constructor(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}unsubscribe(){let e,t=!1;if(this.closed)return;let{_parent:r,_parents:n,_unsubscribe:o,_subscriptions:s}=this;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;let a=-1,l=n?n.length:0;for(;r;)r.remove(this),r=++a<l&&n[a]||null;if(i(o)){f(o).call(this)===h&&(t=!0,e=e||(h.e instanceof m?g(h.e.errors):[h.e]))}if(c(s))for(a=-1,l=s.length;++a<l;){const r=s[a];if(u(r)){if(f(r.unsubscribe).call(r)===h){t=!0,e=e||[];let r=h.e;r instanceof m?e=e.concat(g(r.errors)):e.push(r)}}}if(t)throw new m(e)}add(e){if(!e||e===v.EMPTY)return v.EMPTY;if(e===this)return this;let t=e;switch(typeof e){case"function":t=new v(e);case"object":if(t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if("function"!=typeof t._addParent){const e=t;(t=new v)._subscriptions=[e]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(t),t._addParent(this),t}remove(e){const t=this._subscriptions;if(t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}_addParent(e){let{_parent:t,_parents:r}=this;t&&t!==e?r?-1===r.indexOf(e)&&r.push(e):this._parents=[e]:this._parent=e}}function g(e){return e.reduce((e,t)=>e.concat(t instanceof m?t.errors:t),[])}v.EMPTY=function(e){return e.closed=!0,e}(new v);const y="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("rxSubscriber"):"@@rxSubscriber";class x extends v{constructor(e,t,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=l;break;case 1:if(!e){this.destination=l;break}if("object"==typeof e){if(function(e){return e instanceof x||"syncErrorThrowable"in e&&e[y]}(e)){const t=e[y]();this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)}else this.syncErrorThrowable=!0,this.destination=new b(this,e);break}default:this.syncErrorThrowable=!0,this.destination=new b(this,e,t,r)}}[y](){return this}static create(e,t,r){const n=new x(e,t,r);return n.syncErrorThrowable=!1,n}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parent:e,_parents:t}=this;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this}}class b extends x{constructor(e,t,r,n){let o;super(),this._parentSubscriber=e;let s=this;i(t)?o=t:t&&(o=t.next,r=t.error,n=t.complete,t!==l&&(i((s=Object.create(t)).unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=o,this._error=r,this._complete=n}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:r}=s;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):a(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;a(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);s.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),s.useDeprecatedSynchronousErrorHandling)throw e;a(e)}}__tryOrSetError(e,t,r){if(!s.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(t){return s.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(a(t),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const w="function"==typeof Symbol&&Symbol.observable||"@@observable";function _(){}function S(...e){return T(e)}function T(e){return e?1===e.length?e[0]:function(t){return e.reduce((e,t)=>t(e),t)}:_}class M{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(e){const t=new M;return t.source=this,t.operator=e,t}subscribe(e,t,r){const{operator:n}=this,i=function(e,t,r){if(e){if(e instanceof x)return e;if(e[y])return e[y]()}return e||t||r?new x(e,t,r):new x(l)}(e,t,r);if(n?n.call(i,this.source):i.add(this.source||!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),s.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){s.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),e.error(t)}}forEach(e,t){return new(t=A(t))((t,r)=>{let n;n=this.subscribe(t=>{try{e(t)}catch(e){r(e),n&&n.unsubscribe()}},r,t)})}_subscribe(e){const{source:t}=this;return t&&t.subscribe(e)}[w](){return this}pipe(...e){return 0===e.length?this:T(e)(this)}toPromise(e){return new(e=A(e))((e,t)=>{let r;this.subscribe(e=>r=e,e=>t(e),()=>e(r))})}}function A(e){if(e||(e=s.Promise||Promise),!e)throw new Error("no Promise impl found");return e}M.create=(e=>new M(e));class E extends Error{constructor(){super("object unsubscribed"),this.name="ObjectUnsubscribedError",Object.setPrototypeOf(this,E.prototype)}}class C extends v{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}class P extends x{constructor(e){super(e),this.destination=e}}class O extends M{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[y](){return new P(this)}lift(e){const t=new D(this,this);return t.operator=e,t}next(e){if(this.closed)throw new E;if(!this.isStopped){const{observers:t}=this,r=t.length,n=t.slice();for(let i=0;i<r;i++)n[i].next(e)}}error(e){if(this.closed)throw new E;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:t}=this,r=t.length,n=t.slice();for(let i=0;i<r;i++)n[i].error(e);this.observers.length=0}complete(){if(this.closed)throw new E;this.isStopped=!0;const{observers:e}=this,t=e.length,r=e.slice();for(let n=0;n<t;n++)r[n].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new E;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new E;return this.hasError?(e.error(this.thrownError),v.EMPTY):this.isStopped?(e.complete(),v.EMPTY):(this.observers.push(e),new C(this,e))}asObservable(){const e=new M;return e.source=this,e}}O.create=((e,t)=>new D(e,t));class D extends O{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):v.EMPTY}}function N(e){return e&&"function"==typeof e.schedule}class L extends x{constructor(e,t,r){super(),this.parent=e,this.outerValue=t,this.outerIndex=r,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}const I=e=>t=>{for(let r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.closed||t.complete()},R=e=>t=>(e.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,a),t);const F="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",k=e=>t=>{const r=e[F]();for(;;){const e=r.next();if(e.done){t.complete();break}if(t.next(e.value),t.closed)break}return"function"==typeof r.return&&t.add(()=>{r.return&&r.return()}),t},U=e=>t=>{const r=e[w]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)},B=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function j(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}const z=e=>{if(e instanceof M)return t=>e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t);if(B(e))return I(e);if(j(e))return R(e);if(e&&"function"==typeof e[F])return k(e);if(e&&"function"==typeof e[w])return U(e);{const t=`You provided ${u(e)?"an invalid object":`'${e}'`} where a stream was expected.`+" You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(t)}};function V(e,t,r,n){const i=new L(e,r,n);return z(t)(i)}class G extends x{notifyNext(e,t,r,n,i){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}function H(e,t){return function(r){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new W(e,t))}}class W{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new X(e,this.project,this.thisArg))}}class X extends x{constructor(e,t,r){super(e),this.project=t,this.count=0,this.thisArg=r||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)}}function q(e,t){return new M(t?r=>{const n=new v;let i=0;return n.add(t.schedule(function(){i!==e.length?(r.next(e[i++]),r.closed||n.add(this.schedule())):r.complete()})),n}:I(e))}function Y(e,t){if(!t)return e instanceof M?e:new M(z(e));if(null!=e){if(function(e){return e&&"function"==typeof e[w]}(e))return function(e,t){return new M(t?r=>{const n=new v;return n.add(t.schedule(()=>{const i=e[w]();n.add(i.subscribe({next(e){n.add(t.schedule(()=>r.next(e)))},error(e){n.add(t.schedule(()=>r.error(e)))},complete(){n.add(t.schedule(()=>r.complete()))}}))})),n}:U(e))}(e,t);if(j(e))return function(e,t){return new M(t?r=>{const n=new v;return n.add(t.schedule(()=>e.then(e=>{n.add(t.schedule(()=>{r.next(e),n.add(t.schedule(()=>r.complete()))}))},e=>{n.add(t.schedule(()=>r.error(e)))}))),n}:R(e))}(e,t);if(B(e))return q(e,t);if(function(e){return e&&"function"==typeof e[F]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new M(t?r=>{const n=new v;let i;return n.add(()=>{i&&"function"==typeof i.return&&i.return()}),n.add(t.schedule(()=>{i=e[F](),n.add(t.schedule(function(){if(r.closed)return;let e,t;try{const n=i.next();e=n.value,t=n.done}catch(e){return void r.error(e)}t?r.complete():(r.next(e),this.schedule())}))})),n}:k(e))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function J(e,t,r=Number.POSITIVE_INFINITY){return"function"==typeof t?n=>n.pipe(J((r,n)=>Y(e(r,n)).pipe(H((e,i)=>t(r,e,n,i))),r)):("number"==typeof t&&(r=t),t=>t.lift(new Z(e,r)))}class Z{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new Q(e,this.project,this.concurrent))}}class Q extends G{constructor(e,t,r=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,r)}_innerSub(e,t,r){this.add(V(this,e,t,r))}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()}notifyNext(e,t,r,n,i){this.destination.next(t)}notifyComplete(e){const t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function K(e){return e}function $(e=Number.POSITIVE_INFINITY){return J(K,e)}function ee(...e){let t=Number.POSITIVE_INFINITY,r=null,n=e[e.length-1];return N(n)?(r=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof n&&(t=e.pop()),null===r&&1===e.length&&e[0]instanceof M?e[0]:$(t)(q(e,r))}function te(){return function(e){return e.lift(new re(e))}}class re{constructor(e){this.connectable=e}call(e,t){const{connectable:r}=this;r._refCount++;const n=new ne(e,r),i=t.subscribe(n);return n.closed||(n.connection=r.connect()),i}}class ne extends x{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:r}=this,n=e._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}const ie=class extends M{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new v).add(this.source.subscribe(new ae(this.getSubject(),this))),e.closed?(this._connection=null,e=v.EMPTY):this._connection=e),e}refCount(){return te()(this)}}.prototype,se={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:ie._subscribe},_isComplete:{value:ie._isComplete,writable:!0},getSubject:{value:ie.getSubject},connect:{value:ie.connect},refCount:{value:ie.refCount}};class ae extends P{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function le(e,t){return function(r){let n;if(n="function"==typeof e?e:function(){return e},"function"==typeof t)return r.lift(new ce(n,t));const i=Object.create(r,se);return i.source=r,i.subjectFactory=n,i}}class ce{constructor(e,t){this.subjectFactory=e,this.selector=t}call(e,t){const{selector:r}=this,n=this.subjectFactory(),i=r(n).subscribe(e);return i.add(t.subscribe(n)),i}}function ue(){return new O}function he(){return e=>te()(le(ue)(e))}function de(e){return{providedIn:e.providedIn||null,factory:e.factory,value:void 0}}class pe{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0!==t?de({providedIn:t.providedIn||"root",factory:t.factory}):void 0}toString(){return`InjectionToken ${this._desc}`}}const fe="__annotations__",me="__parameters__",ve="__prop__metadata__";function ge(e,t,r,n,i){const o=ye(t);function s(...e){if(this instanceof s)return o.call(this,...e),this;const t=new s(...e),r=function(r){return i&&i(r,...e),(r.hasOwnProperty(fe)?r[fe]:Object.defineProperty(r,fe,{value:[]})[fe]).push(t),r};return n&&n(r),r}return r&&(s.prototype=Object.create(r.prototype)),s.prototype.ngMetadataName=e,s.annotationCls=s,s}function ye(e){return function(...t){if(e){const r=e(...t);for(const e in r)this[e]=r[e]}}}function xe(e,t,r){const n=ye(t);function i(...e){if(this instanceof i)return n.apply(this,e),this;const t=new i(...e);return r.annotation=t,r;function r(e,r,n){const i=e.hasOwnProperty(me)?e[me]:Object.defineProperty(e,me,{value:[]})[me];for(;i.length<=n;)i.push(null);return(i[n]=i[n]||[]).push(t),e}}return r&&(i.prototype=Object.create(r.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i}function be(e,t,r){const n=ye(t);function i(...e){if(this instanceof i)return n.apply(this,e),this;const t=new i(...e);return function(e,r){const n=e.constructor,i=n.hasOwnProperty(ve)?n[ve]:Object.defineProperty(n,ve,{value:{}})[ve];i[r]=i.hasOwnProperty(r)&&i[r]||[],i[r].unshift(t)}}return r&&(i.prototype=Object.create(r.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i}const we=new pe("AnalyzeForEntryComponents"),_e=xe("Attribute",e=>({attributeName:e}));class Se{}const Te=be("ContentChildren",(e,t={})=>Object.assign({selector:e,first:!1,isViewQuery:!1,descendants:!1},t),Se),Me=(be("ContentChild",(e,t={})=>Object.assign({selector:e,first:!0,isViewQuery:!1,descendants:!0},t),Se),be("ViewChildren",(e,t={})=>Object.assign({selector:e,first:!1,isViewQuery:!0,descendants:!0},t),Se),be("ViewChild",(e,t)=>Object.assign({selector:e,first:!0,isViewQuery:!0,descendants:!0},t),Se),{OnPush:0,Default:1});Me[Me.OnPush]="OnPush",Me[Me.Default]="Default";const Ae={CheckOnce:0,Checked:1,CheckAlways:2,Detached:3,Errored:4,Destroyed:5};Ae[Ae.CheckOnce]="CheckOnce",Ae[Ae.Checked]="Checked",Ae[Ae.CheckAlways]="CheckAlways",Ae[Ae.Detached]="Detached",Ae[Ae.Errored]="Errored",Ae[Ae.Destroyed]="Destroyed";const Ee=ge("Directive",(e={})=>e),Ce=ge("Component",(e={})=>Object.assign({changeDetection:Me.Default},e),Ee),Pe=ge("Pipe",e=>Object.assign({pure:!0},e)),Oe=be("Input",e=>({bindingPropertyName:e})),De=be("Output",e=>({bindingPropertyName:e})),Ne=be("HostBinding",e=>({hostPropertyName:e})),Le=be("HostListener",(e,t)=>({eventName:e,args:t})),Ie=Function;function Re(e){return"function"==typeof e}const Fe="undefined"!=typeof window&&window,ke="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ue="undefined"!=typeof global&&global,Be=Fe||Ue||ke,je=Promise.resolve(0);let ze=null;function Ve(){if(!ze){const e=Be.Symbol;if(e&&e.iterator)ze=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(ze=r)}}}return ze}function Ge(e){"undefined"==typeof Zone?je.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}function He(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function We(e){if("string"==typeof e)return e;if(e instanceof Array)return"["+e.map(We).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}const Xe=/^function\s+\S+\(\)\s*{[\s\S]+\.apply\(this,\s*arguments\)/,qe=/^class\s+[A-Za-z\d$_]*\s*extends\s+[A-Za-z\d$_]+\s*{/,Ye=/^class\s+[A-Za-z\d$_]*\s*extends\s+[A-Za-z\d$_]+\s*{[\s\S]*constructor\s*\(/;class Je{constructor(e){this._reflect=e||Be.Reflect}isReflectionEnabled(){return!0}factory(e){return(...t)=>new e(...t)}_zipTypesAndAnnotations(e,t){let r;r=void 0===e?new Array(t.length):new Array(e.length);for(let n=0;n<r.length;n++)void 0===e?r[n]=[]:e[n]!=Object?r[n]=[e[n]]:r[n]=[],t&&null!=t[n]&&(r[n]=r[n].concat(t[n]));return r}_ownParameters(e,t){const r=e.toString();if(Xe.exec(r)||qe.exec(r)&&!Ye.exec(r))return null;if(e.parameters&&e.parameters!==t.parameters)return e.parameters;const n=e.ctorParameters;if(n&&n!==t.ctorParameters){const e="function"==typeof n?n():n,t=e.map(e=>e&&e.type),r=e.map(e=>e&&Ze(e.decorators));return this._zipTypesAndAnnotations(t,r)}const i=e.hasOwnProperty(me)&&e[me],o=this._reflect&&this._reflect.getOwnMetadata&&this._reflect.getOwnMetadata("design:paramtypes",e);return o||i?this._zipTypesAndAnnotations(o,i):new Array(e.length).fill(void 0)}parameters(e){if(!Re(e))return[];const t=Qe(e);let r=this._ownParameters(e,t);return r||t===Object||(r=this.parameters(t)),r||[]}_ownAnnotations(e,t){if(e.annotations&&e.annotations!==t.annotations){let t=e.annotations;return"function"==typeof t&&t.annotations&&(t=t.annotations),t}return e.decorators&&e.decorators!==t.decorators?Ze(e.decorators):e.hasOwnProperty(fe)?e[fe]:null}annotations(e){if(!Re(e))return[];const t=Qe(e),r=this._ownAnnotations(e,t)||[];return(t!==Object?this.annotations(t):[]).concat(r)}_ownPropMetadata(e,t){if(e.propMetadata&&e.propMetadata!==t.propMetadata){let t=e.propMetadata;return"function"==typeof t&&t.propMetadata&&(t=t.propMetadata),t}if(e.propDecorators&&e.propDecorators!==t.propDecorators){const t=e.propDecorators,r={};return Object.keys(t).forEach(e=>{r[e]=Ze(t[e])}),r}return e.hasOwnProperty(ve)?e[ve]:null}propMetadata(e){if(!Re(e))return{};const t=Qe(e),r={};if(t!==Object){const e=this.propMetadata(t);Object.keys(e).forEach(t=>{r[t]=e[t]})}const n=this._ownPropMetadata(e,t);return n&&Object.keys(n).forEach(e=>{const t=[];r.hasOwnProperty(e)&&t.push(...r[e]),t.push(...n[e]),r[e]=t}),r}hasLifecycleHook(e,t){return e instanceof Ie&&t in e.prototype}guards(e){return{}}getter(e){return new Function("o","return o."+e+";")}setter(e){return new Function("o","v","return o."+e+" = v;")}method(e){const t=`if (!o.${e}) throw new Error('"${e}" is undefined');\n        return o.${e}.apply(o, args);`;return new Function("o","args",t)}importUri(e){return"object"==typeof e&&e.filePath?e.filePath:`./${We(e)}`}resourceUri(e){return`./${We(e)}`}resolveIdentifier(e,t,r,n){return n}resolveEnum(e,t){return e[t]}}function Ze(e){return e?e.map(e=>{return new(0,e.type.annotationCls)(...e.args?e.args:[])}):[]}function Qe(e){const t=e.prototype?Object.getPrototypeOf(e.prototype):null;return(t?t.constructor:null)||Object}function Ke(e){return e.__forward_ref__=Ke,e.toString=function(){return We(this())},e}function $e(e){return"function"==typeof e&&e.hasOwnProperty("__forward_ref__")&&e.__forward_ref__===Ke?e():e}const et=xe("Inject",e=>({token:e})),tt=xe("Optional"),rt=xe("Self"),nt=xe("SkipSelf"),it=xe("Host"),ot="__source",st=new Object,at=st,lt=new pe("INJECTOR");class ct{get(e,t=st){if(t===st)throw new Error(`NullInjectorError: No provider for ${We(e)}!`);return t}}class ut{static create(e,t){return Array.isArray(e)?new _t(e,t):new _t(e.providers,e.parent,e.name||null)}}ut.THROW_IF_NOT_FOUND=st,ut.NULL=new ct,ut.ngInjectableDef=de({providedIn:"any",factory:()=>Pt(lt)});const ht=function(e){return e},dt=[],pt=ht,ft=function(){return Array.prototype.slice.call(arguments)},mt={},vt=function(e){for(let t in e)if(e[t]===mt)return t;throw Error("!prop")}({provide:String,useValue:mt}),gt="ngTokenPath",yt="ngTempTokenPath",xt=ut.NULL,bt=/\n/gm,wt="\u0275";class _t{constructor(e,t=xt,r=null){this.parent=t,this.source=r;const n=this._records=new Map;n.set(ut,{token:ut,fn:ht,deps:dt,value:this,useNew:!1}),n.set(lt,{token:lt,fn:ht,deps:dt,value:this,useNew:!1}),function e(t,r){if(r)if((r=$e(r))instanceof Array)for(let n=0;n<r.length;n++)e(t,r[n]);else{if("function"==typeof r)throw At("Function/Class not supported",r);if(!r||"object"!=typeof r||!r.provide)throw At("Unexpected provider",r);{let e=$e(r.provide);const n=function(e){const t=function(e){let t=dt;const r=e.deps;if(r&&r.length){t=[];for(let e=0;e<r.length;e++){let n=6,i=$e(r[e]);if(i instanceof Array)for(let e=0,t=i;e<t.length;e++){const r=t[e];r instanceof tt||r==tt?n|=1:r instanceof nt||r==nt?n&=-3:r instanceof rt||r==rt?n&=-5:i=r instanceof et?r.token:$e(r)}t.push({token:i,options:n})}}else if(e.useExisting){const r=$e(e.useExisting);t=[{token:r,options:6}]}else if(!(r||vt in e))throw At("'deps' required",e);return t}(e);let r=ht,n=dt,i=!1,o=$e(e.provide);if(vt in e)n=e.useValue;else if(e.useFactory)r=e.useFactory;else if(e.useExisting);else if(e.useClass)i=!0,r=$e(e.useClass);else{if("function"!=typeof o)throw At("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",e);i=!0,r=o}return{deps:t,fn:r,useNew:i,value:n}}(r);if(!0===r.multi){let n=t.get(e);if(n){if(n.fn!==ft)throw St(e)}else t.set(e,n={token:r.provide,deps:[],useNew:!1,fn:ft,value:dt});e=r,n.deps.push({token:e,options:6})}const i=t.get(e);if(i&&i.fn==ft)throw St(e);t.set(e,n)}}}(n,e)}get(e,t,r=0){const n=this._records.get(e);try{return Tt(e,n,this._records,this.parent,t,r)}catch(t){const r=t[yt];throw e[ot]&&r.unshift(e[ot]),t.message=Mt("\n"+t.message,r,this.source),t[gt]=r,t[yt]=null,t}}toString(){const e=[];return this._records.forEach((t,r)=>e.push(We(r))),`StaticInjector[${e.join(", ")}]`}}function St(e){return At("Cannot mix multi providers and regular providers",e)}function Tt(e,t,r,n,i,o){try{return function(e,t,r,n,i,o){let s;if(!t||4&o)2&o||(s=n.get(e,i,0));else{if((s=t.value)==pt)throw Error(wt+"Circular dependency");if(s===dt){t.value=pt;let e=void 0,i=t.useNew,o=t.fn,a=t.deps,l=dt;if(a.length){l=[];for(let e=0;e<a.length;e++){const t=a[e],i=t.options,o=2&i?r.get(t.token):void 0;l.push(Tt(t.token,o,r,o||4&i?n:xt,1&i?null:ut.THROW_IF_NOT_FOUND,0))}}t.value=s=i?new o(...l):o.apply(e,l)}}return s}(e,t,r,n,i,o)}catch(r){throw r instanceof Error||(r=new Error(r)),(r[yt]=r[yt]||[]).unshift(e),t&&t.value==pt&&(t.value=dt),r}}function Mt(e,t,r=null){e=e&&"\n"===e.charAt(0)&&e.charAt(1)==wt?e.substr(2):e;let n=We(t);if(t instanceof Array)n=t.map(We).join(" -> ");else if("object"==typeof t){let e=[];for(let r in t)if(t.hasOwnProperty(r)){let n=t[r];e.push(r+":"+("string"==typeof n?JSON.stringify(n):We(n)))}n=`{${e.join(", ")}}`}return`StaticInjectorError${r?"("+r+")":""}[${n}]: ${e.replace(bt,"\n  ")}`}function At(e,t){return new Error(Mt(e,t))}let Et=void 0;function Ct(e){const t=Et;return Et=e,t}function Pt(e,t=0){if(void 0===Et)throw new Error("inject() must be called from an injection context");if(null===Et){const t=e.ngInjectableDef;if(t&&"root"==t.providedIn)return void 0===t.value?t.value=t.factory():t.value;throw new Error(`Injector: NOT_FOUND [${We(e)}]`)}return Et.get(e,8&t?null:void 0,t)}function Ot(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(Array.isArray(n)){if(0===n.length)throw new Error("Arguments array must have arguments.");let e=void 0,r=0;for(let t=0;t<n.length;t++){const i=n[t];i instanceof tt||"Optional"===i.__proto__.ngMetadataName?r|=8:i instanceof nt||"SkipSelf"===i.__proto__.ngMetadataName?r|=4:i instanceof rt||"Self"===i.__proto__.ngMetadataName?r|=2:e=i instanceof et?i.token:i}t.push(Pt(e,r))}else t.push(Pt(n))}return t}const Dt={},Nt=function(e,t){for(let r in e)if(e[r]===t)return r;throw Error("Could not find renamed property on target object.")}({provide:String,useValue:Dt},Dt),Lt=[];function It(e,t){if(!t){const t=(new Je).parameters(e);return()=>new e(...Ot(t))}if(Nt in t){const e=t;return()=>e.useValue}if(t.useExisting){const e=t;return()=>Pt(e.useExisting)}if(t.useFactory){const e=t;return()=>e.useFactory(...Ot(e.deps||Lt))}if(t.useClass){const r=t;let n=t.deps;if(!n){const t=new Je;n=t.parameters(e)}return()=>new r.useClass(...Ot(n))}{let r=t.deps;if(!r){const t=new Je;r=t.parameters(e)}return()=>new e(...Ot(r))}}const Rt=ge("Injectable",void 0,void 0,void 0,(e,t)=>{t&&void 0!==t.providedIn&&void 0===e.ngInjectableDef&&(e.ngInjectableDef=de({providedIn:t.providedIn,factory:It(e,t)}))}),Ft=ge("NgModule",e=>e,void 0,void 0,(e,t)=>{let r=t&&t.imports||[];t&&t.exports&&(r=[...r,t.exports]),e.ngInjectorDef=function(e){return{factory:e.factory,providers:e.providers||[],imports:e.imports||[]}}({factory:It(e,{useClass:e}),providers:t&&t.providers,imports:r})}),kt={Emulated:0,Native:1,None:2};kt[kt.Emulated]="Emulated",kt[kt.Native]="Native",kt[kt.None]="None";class Ut{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const Bt=new Ut("6.0.0"),jt="ngDebugContext",zt="ngOriginalError",Vt="ngErrorLogger";function Gt(e){return e[jt]}function Ht(e){return e[zt]}function Wt(e,...t){e.error(...t)}class Xt{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=this._findContext(e),n=function(e){return e[Vt]||Wt}(e);n(this._console,"ERROR",e),t&&n(this._console,"ORIGINAL ERROR",t),r&&n(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?Gt(e)?Gt(e):this._findContext(Ht(e)):null}_findOriginalError(e){let t=Ht(e);for(;t&&Ht(t);)t=Ht(t);return t}}function qt(e){if(e.length>1){return" ("+function(e){const t=[];for(let r=0;r<e.length;++r){if(t.indexOf(e[r])>-1)return t.push(e[r]),t;t.push(e[r])}return t}(e.slice().reverse()).map(e=>We(e.token)).join(" -> ")+")"}return""}function Yt(e,t,r,n){const i=[t],o=r(i),s=n?function(e,t){const r=`${e} caused by: ${t instanceof Error?t.message:t}`,n=Error(r);return n[zt]=t,n}(o,n):Error(o);return s.addKey=Jt,s.keys=i,s.injectors=[e],s.constructResolvingMessage=r,s[zt]=n,s}function Jt(e,t){this.injectors.push(e),this.keys.push(t),this.message=this.constructResolvingMessage(this.keys)}function Zt(e,t){const r=[];for(let n=0,i=t.length;n<i;n++){const e=t[n];e&&0!=e.length?r.push(e.map(We).join(" ")):r.push("?")}return Error("Cannot resolve all parameters for '"+We(e)+"'("+r.join(", ")+"). Make sure that all the parameters are decorated with Inject or have valid type annotations and that '"+We(e)+"' is decorated with Injectable.")}function Qt(e,t){return Error(`Cannot mix multi providers and regular providers, got: ${e} ${t}`)}class Kt{constructor(e,t){if(this.token=e,this.id=t,!e)throw new Error("Token must be defined!");this.displayName=We(this.token)}static get(e){return $t.get($e(e))}static get numberOfKeys(){return $t.numberOfKeys}}const $t=new class{constructor(){this._allKeys=new Map}get(e){if(e instanceof Kt)return e;if(this._allKeys.has(e))return this._allKeys.get(e);const t=new Kt(e,Kt.numberOfKeys);return this._allKeys.set(e,t),t}get numberOfKeys(){return this._allKeys.size}};const er=new class{constructor(e){this.reflectionCapabilities=e}updateCapabilities(e){this.reflectionCapabilities=e}factory(e){return this.reflectionCapabilities.factory(e)}parameters(e){return this.reflectionCapabilities.parameters(e)}annotations(e){return this.reflectionCapabilities.annotations(e)}propMetadata(e){return this.reflectionCapabilities.propMetadata(e)}hasLifecycleHook(e,t){return this.reflectionCapabilities.hasLifecycleHook(e,t)}getter(e){return this.reflectionCapabilities.getter(e)}setter(e){return this.reflectionCapabilities.setter(e)}method(e){return this.reflectionCapabilities.method(e)}importUri(e){return this.reflectionCapabilities.importUri(e)}resourceUri(e){return this.reflectionCapabilities.resourceUri(e)}resolveIdentifier(e,t,r,n){return this.reflectionCapabilities.resolveIdentifier(e,t,r,n)}resolveEnum(e,t){return this.reflectionCapabilities.resolveEnum(e,t)}}(new Je);class tr{constructor(e,t,r){this.key=e,this.optional=t,this.visibility=r}static fromKey(e){return new tr(e,!1,null)}}const rr=[];class nr{constructor(e,t,r){this.key=e,this.resolvedFactories=t,this.multiProvider=r,this.resolvedFactory=this.resolvedFactories[0]}}class ir{constructor(e,t){this.factory=e,this.dependencies=t}}function or(e){let t,r;if(e.useClass){const n=$e(e.useClass);t=er.factory(n),r=lr(n)}else e.useExisting?(t=(e=>e),r=[tr.fromKey(Kt.get(e.useExisting))]):e.useFactory?(t=e.useFactory,r=function(e,t){if(t){const r=t.map(e=>[e]);return t.map(t=>cr(e,t,r))}return lr(e)}(e.useFactory,e.deps)):(t=(()=>e.useValue),r=rr);return new ir(t,r)}function sr(e){return new nr(Kt.get(e.provide),[or(e)],e.multi||!1)}function ar(e){const t=function(e,t){for(let r=0;r<e.length;r++){const n=e[r],i=t.get(n.key.id);if(i){if(n.multiProvider!==i.multiProvider)throw Qt(i,n);if(n.multiProvider)for(let e=0;e<n.resolvedFactories.length;e++)i.resolvedFactories.push(n.resolvedFactories[e]);else t.set(n.key.id,n)}else{let e;e=n.multiProvider?new nr(n.key,n.resolvedFactories.slice(),n.multiProvider):n,t.set(n.key.id,e)}}return t}(function e(t,r){t.forEach(t=>{if(t instanceof Ie)r.push({provide:t,useClass:t});else if(t&&"object"==typeof t&&void 0!==t.provide)r.push(t);else{if(!(t instanceof Array))throw function(e){return Error(`Invalid provider - only instances of Provider and Type are allowed, got: ${e}`)}(t);e(t,r)}});return r}(e,[]).map(sr),new Map);return Array.from(t.values())}function lr(e){const t=er.parameters(e);if(!t)return[];if(t.some(e=>null==e))throw Zt(e,t);return t.map(r=>cr(e,r,t))}function cr(e,t,r){let n=null,i=!1;if(!Array.isArray(t))return ur(t instanceof et?t.token:t,i,null);let o=null;for(let s=0;s<t.length;++s){const e=t[s];e instanceof Ie?n=e:e instanceof et?n=e.token:e instanceof tt?i=!0:e instanceof rt||e instanceof nt?o=e:e instanceof pe&&(n=e)}if(null!=(n=$e(n)))return ur(n,i,o);throw Zt(e,r)}function ur(e,t,r){return new tr(Kt.get(e),t,r)}const hr=new Object;class dr{static resolve(e){return ar(e)}static resolveAndCreate(e,t){const r=dr.resolve(e);return dr.fromResolvedProviders(r,t)}static fromResolvedProviders(e,t){return new pr(e,t)}}class pr{constructor(e,t){this._constructionCounter=0,this._providers=e,this.parent=t||null;const r=e.length;this.keyIds=new Array(r),this.objs=new Array(r);for(let n=0;n<r;n++)this.keyIds[n]=e[n].key.id,this.objs[n]=hr}get(e,t=at){return this._getByKey(Kt.get(e),null,t)}resolveAndCreateChild(e){const t=dr.resolve(e);return this.createChildFromResolved(t)}createChildFromResolved(e){const t=new pr(e);return t.parent=this,t}resolveAndInstantiate(e){return this.instantiateResolved(dr.resolve([e])[0])}instantiateResolved(e){return this._instantiateProvider(e)}getProviderAtIndex(e){if(e<0||e>=this._providers.length)throw function(e){return Error(`Index ${e} is out-of-bounds.`)}(e);return this._providers[e]}_new(e){if(this._constructionCounter++>this._getMaxNumberOfObjects())throw function(e,t){return Yt(e,t,function(e){return`Cannot instantiate cyclic dependency!${qt(e)}`})}(this,e.key);return this._instantiateProvider(e)}_getMaxNumberOfObjects(){return this.objs.length}_instantiateProvider(e){if(e.multiProvider){const t=new Array(e.resolvedFactories.length);for(let r=0;r<e.resolvedFactories.length;++r)t[r]=this._instantiate(e,e.resolvedFactories[r]);return t}return this._instantiate(e,e.resolvedFactories[0])}_instantiate(e,t){const r=t.factory;let n,i;try{n=t.dependencies.map(e=>this._getByReflectiveDependency(e))}catch(t){throw t.addKey&&t.addKey(this,e.key),t}try{i=r(...n)}catch(t){throw function(e,t,r,n){return Yt(e,n,function(e){const r=We(e[0].token);return`${t.message}: Error during instantiation of ${r}!${qt(e)}.`},t)}(this,t,t.stack,e.key)}return i}_getByReflectiveDependency(e){return this._getByKey(e.key,e.visibility,e.optional?null:at)}_getByKey(e,t,r){return e===pr.INJECTOR_KEY?this:t instanceof rt?this._getByKeySelf(e,r):this._getByKeyDefault(e,r,t)}_getObjByKeyId(e){for(let t=0;t<this.keyIds.length;t++)if(this.keyIds[t]===e)return this.objs[t]===hr&&(this.objs[t]=this._new(this._providers[t])),this.objs[t];return hr}_throwOrNull(e,t){if(t!==at)return t;throw function(e,t){return Yt(e,t,function(e){return`No provider for ${We(e[0].token)}!${qt(e)}`})}(this,e)}_getByKeySelf(e,t){const r=this._getObjByKeyId(e.id);return r!==hr?r:this._throwOrNull(e,t)}_getByKeyDefault(e,t,r){let n;for(n=r instanceof nt?this.parent:this;n instanceof pr;){const t=n,r=t._getObjByKeyId(e.id);if(r!==hr)return r;n=t.parent}return null!==n?n.get(e.token,t):this._throwOrNull(e,t)}get displayName(){return`ReflectiveInjector(providers: [${function(e,t){const r=new Array(e._providers.length);for(let n=0;n<e._providers.length;++n)r[n]=t(e.getProviderAtIndex(n));return r}(this,e=>' "'+e.key.displayName+'" ').join(", ")}])`}toString(){return this.displayName}}pr.INJECTOR_KEY=Kt.get(ut);const fr=new pe("The presence of this token marks an injector as being the root injector.");function mr(e){return!!e&&"function"==typeof e.then}function vr(e){return!!e&&"function"==typeof e.subscribe}const gr=new pe("Application Initializer");class yr{constructor(e){this.appInits=e,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const t=this.appInits[r]();mr(t)&&e.push(t)}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}yr.decorators=[{type:Rt}],yr.ctorParameters=(()=>[{type:Array,decorators:[{type:et,args:[gr]},{type:tt}]}]);const xr=new pe("AppId");function br(){return`${_r()}${_r()}${_r()}`}const wr={provide:xr,useFactory:br,deps:[]};function _r(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Sr=new pe("Platform Initializer"),Tr=new pe("Platform ID"),Mr=new pe("appBootstrapListener");new pe("Application Packages Root URL");class Ar{log(e){console.log(e)}warn(e){console.warn(e)}}Ar.decorators=[{type:Rt}],Ar.ctorParameters=(()=>[]);function Er(){throw new Error("Runtime compiler is not loaded")}class Cr{compileModuleSync(e){throw Er()}compileModuleAsync(e){throw Er()}compileModuleAndAllComponentsSync(e){throw Er()}compileModuleAndAllComponentsAsync(e){throw Er()}clearCache(){}clearCacheFor(e){}}Cr.decorators=[{type:Rt}],Cr.ctorParameters=(()=>[]);new pe("compilerOptions");class Pr{}class Or{}class Dr{}function Nr(e){const t=Error(`No component factory found for ${We(e)}. Did you add it to @NgModule.entryComponents?`);return t[Lr]=e,t}const Lr="ngComponent";class Ir{}Ir.NULL=new class{resolveComponentFactory(e){throw Nr(e)}};class Rr{constructor(e,t,r){this._parent=t,this._ngModule=r,this._factories=new Map;for(let n=0;n<e.length;n++){const t=e[n];this._factories.set(t.componentType,t)}}resolveComponentFactory(e){let t=this._factories.get(e);if(!t&&this._parent&&(t=this._parent.resolveComponentFactory(e)),!t)throw Nr(e);return new Fr(t,this._ngModule)}}class Fr extends Dr{constructor(e,t){super(),this.factory=e,this.ngModule=t,this.selector=e.selector,this.componentType=e.componentType,this.ngContentSelectors=e.ngContentSelectors,this.inputs=e.inputs,this.outputs=e.outputs}create(e,t,r,n){return this.factory.create(e,t,r,n||this.ngModule)}}class kr{}class Ur{}let Br,jr;const zr=function(){const e=Be.wtf;return!(!e||!(Br=e.trace)||(jr=Br.events,0))}();const Vr=zr?function(e,t=null){return jr.createScope(e,t)}:(e,t)=>(function(e,t){return null}),Gr=zr?function(e,t){return Br.leaveScope(e,t),t}:(e,t)=>t;class Hr extends O{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){let n,i=e=>null,o=()=>null;e&&"object"==typeof e?(n=this.__isAsync?t=>{setTimeout(()=>e.next(t))}:t=>{e.next(t)},e.error&&(i=this.__isAsync?t=>{setTimeout(()=>e.error(t))}:t=>{e.error(t)}),e.complete&&(o=this.__isAsync?()=>{setTimeout(()=>e.complete())}:()=>{e.complete()})):(n=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)},t&&(i=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)}),r&&(o=this.__isAsync?()=>{setTimeout(()=>r())}:()=>{r()}));const s=super.subscribe(n,i,o);return e instanceof v&&e.add(s),s}}class Wr{constructor({enableLongStackTrace:e=!1}){if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Hr(!1),this.onMicrotaskEmpty=new Hr(!1),this.onStable=new Hr(!1),this.onError=new Hr(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const t=this;t._nesting=0,t._outer=t._inner=Zone.current,Zone.wtfZoneSpec&&(t._inner=t._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(t._inner=t._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(t._inner=t._inner.fork(Zone.longStackTraceZoneSpec)),function(e){e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,n,i,o,s)=>{try{return Jr(e),t.invokeTask(n,i,o,s)}finally{Zr(e)}},onInvoke:(t,r,n,i,o,s,a)=>{try{return Jr(e),t.invoke(n,i,o,s,a)}finally{Zr(e)}},onHasTask:(t,r,n,i)=>{t.hasTask(n,i),r===n&&("microTask"==i.change?(e.hasPendingMicrotasks=i.microTask,Yr(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,r,n,i)=>(t.handleError(n,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(t)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Wr.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Wr.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,n){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+n,e,qr,Xr,Xr);try{return i.runTask(o,t,r)}finally{i.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}function Xr(){}const qr={};function Yr(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Jr(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Zr(e){e._nesting--,Yr(e)}class Qr{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Hr,this.onMicrotaskEmpty=new Hr,this.onStable=new Hr,this.onError=new Hr}run(e){return e()}runGuarded(e){return e()}runOutsideAngular(e){return e()}runTask(e){return e()}}class Kr{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Wr.assertNotInAngularZone(),Ge(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ge(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,isPeriodic:e.data.isPeriodic,delay:e.data.delay,creationLocation:e.creationLocation,xhr:e.data.target})):[]}addCallback(e,t,r){let n=-1;t&&t>0&&(n=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==n),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:n,updateCb:r})}whenStable(e,t,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,r){return[]}}Kr.decorators=[{type:Rt}],Kr.ctorParameters=(()=>[{type:Wr}]);class $r{constructor(){this._applications=new Map,tn.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return tn.findTestabilityInTree(this,e,t)}}$r.decorators=[{type:Rt}],$r.ctorParameters=(()=>[]);let en,tn=new class{addToWindow(e){}findTestabilityInTree(e,t,r){return null}},rn=!0,nn=!1;const on=new pe("AllowMultipleToken");function sn(){return nn=!0,rn}class an{constructor(e,t){this.name=e,this.token=t}}function ln(e,t,r=[]){const n=`Platform: ${t}`,i=new pe(n);return(t=[])=>{let o=cn();if(!o||o.injector.get(on,!1))if(e)e(r.concat(t).concat({provide:i,useValue:!0}));else{const e=r.concat(t).concat({provide:i,useValue:!0});!function(e){if(en&&!en.destroyed&&!en.injector.get(on,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");en=e.get(un);const t=e.get(Sr,null);t&&t.forEach(e=>e())}(ut.create({providers:e,name:n}))}return function(e){const t=cn();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function cn(){return en&&!en.destroyed?en:null}class un{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const r=function(e){let t;t="noop"===e?new Qr:("zone.js"===e?void 0:e)||new Wr({enableLongStackTrace:sn()});return t}(t?t.ngZone:void 0),n=[{provide:Wr,useValue:r}];return r.run(()=>{const t=ut.create({providers:n,parent:this.injector,name:e.moduleType.name}),i=e.create(t),o=i.injector.get(Xt,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.onDestroy(()=>pn(this._modules,i)),r.runOutsideAngular(()=>r.onError.subscribe({next:e=>{o.handleError(e)}})),function(e,t,r){try{const n=r();return mr(n)?n.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):n}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(o,r,()=>{const e=i.injector.get(yr);return e.runInitializers(),e.donePromise.then(()=>(this._moduleDoBootstrap(i),i))})})}bootstrapModule(e,t=[]){const r=this.injector.get(Pr),n=hn({},t);return r.createCompiler([n]).compileModuleAsync(e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(dn);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${We(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. `+"Please define one of these.");e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}function hn(e,t){return e=Array.isArray(t)?t.reduce(hn,e):Object.assign({},e,t)}un.decorators=[{type:Rt}],un.ctorParameters=(()=>[{type:ut}]);class dn{constructor(e,t,r,n,i,o){this._zone=e,this._console=t,this._injector=r,this._exceptionHandler=n,this._componentFactoryResolver=i,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=sn(),this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new M(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),a=new M(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{Wr.assertNotInAngularZone(),Ge(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,e.next(!0))})})});const r=this._zone.onUnstable.subscribe(()=>{Wr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),r.unsubscribe()}});this.isStable=ee(s,a.pipe(he()))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let r;r=e instanceof Dr?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(r.componentType);const n=r instanceof Fr?null:this._injector.get(kr),i=t||r.selector,o=r.create(ut.NULL,[],i,n);o.onDestroy(()=>{this._unloadComponent(o)});const s=o.injector.get(Kr,null);return s&&o.injector.get($r).registerApplication(o.location.nativeElement,s),this._loadComponent(o),sn()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),o}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");const e=dn._tickScope();try{this._runningTick=!0,this._views.forEach(e=>e.detectChanges()),this._enforceNoNewChanges&&this._views.forEach(e=>e.checkNoChanges())}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1,Gr(e)}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;pn(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Mr,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}_unloadComponent(e){this.detachView(e.hostView),pn(this.components,e)}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy())}get viewCount(){return this._views.length}}function pn(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}dn._tickScope=Vr("ApplicationRef#tick()"),dn.decorators=[{type:Rt}],dn.ctorParameters=(()=>[{type:Wr},{type:Ar},{type:ut},{type:Xt},{type:Ir},{type:yr}]);class fn{}new pe("Renderer2Interceptor");class mn{}const vn={Important:1,DashCase:2};vn[vn.Important]="Important",vn[vn.DashCase]="DashCase";class gn{}class yn{constructor(e){this.nativeElement=e}}class xn{}new Map;class bn{constructor(){this.dirty=!0,this._results=[],this.changes=new Hr,this.length=0}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}[Ve()](){return this._results[Ve()]()}toString(){return this._results.toString()}reset(e){this._results=function e(t){return t.reduce((t,r)=>{const n=Array.isArray(r)?e(r):r;return t.concat(n)},[])}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}notifyOnChanges(){this.changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}const wn="#",_n="NgFactory";class Sn{}const Tn={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};class Mn{constructor(e,t){this._compiler=e,this._config=t||Tn}load(e){return this._compiler instanceof Cr?this.loadFactory(e):this.loadAndCompile(e)}loadAndCompile(e){let[t,n]=e.split(wn);return void 0===n&&(n="default"),r("crnd")(t).then(e=>e[n]).then(e=>An(e,t,n)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,n]=e.split(wn),i=_n;return void 0===n&&(n="default",i=""),r("crnd")(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[n+i]).then(e=>An(e,t,n))}}function An(e,t,r){if(!e)throw new Error(`Cannot find '${r}' in '${t}'`);return e}Mn.decorators=[{type:Rt}],Mn.ctorParameters=(()=>[{type:Cr},{type:Sn,decorators:[{type:tt}]}]);class En{}class Cn{}class Pn{}class On{constructor(e,t){this.name=e,this.callback=t}}class Dn{constructor(e,t,r){this._debugContext=r,this.nativeNode=e,t&&t instanceof Nn?t.addChild(this):this.parent=null,this.listeners=[]}get injector(){return this._debugContext.injector}get componentInstance(){return this._debugContext.component}get context(){return this._debugContext.context}get references(){return this._debugContext.references}get providerTokens(){return this._debugContext.providerTokens}}class Nn extends Dn{constructor(e,t,r){super(e,t,r),this.properties={},this.attributes={},this.classes={},this.styles={},this.childNodes=[],this.nativeElement=e}addChild(e){e&&(this.childNodes.push(e),e.parent=this)}removeChild(e){const t=this.childNodes.indexOf(e);-1!==t&&(e.parent=null,this.childNodes.splice(t,1))}insertChildrenAfter(e,t){const r=this.childNodes.indexOf(e);-1!==r&&(this.childNodes.splice(r+1,0,...t),t.forEach(e=>{e.parent&&e.parent.removeChild(e),e.parent=this}))}insertBefore(e,t){const r=this.childNodes.indexOf(e);-1===r?this.addChild(t):(t.parent&&t.parent.removeChild(t),t.parent=this,this.childNodes.splice(r,0,t))}query(e){return this.queryAll(e)[0]||null}queryAll(e){const t=[];return function e(t,r,n){t.childNodes.forEach(t=>{t instanceof Nn&&(r(t)&&n.push(t),e(t,r,n))})}(this,e,t),t}queryAllNodes(e){const t=[];return function e(t,r,n){t instanceof Nn&&t.childNodes.forEach(t=>{r(t)&&n.push(t),t instanceof Nn&&e(t,r,n)})}(this,e,t),t}get children(){return this.childNodes.filter(e=>e instanceof Nn)}triggerEventHandler(e,t){this.listeners.forEach(r=>{r.name==e&&r.callback(t)})}}const Ln=new Map;function In(e){return Ln.get(e)||null}function Rn(e){Ln.set(e.nativeNode,e)}function Fn(e,t){const r=Bn(e),n=Bn(t);if(r&&n)return function(e,t,r){const n=e[Ve()](),i=t[Ve()]();for(;;){const e=n.next(),t=i.next();if(e.done&&t.done)return!0;if(e.done||t.done)return!1;if(!r(e.value,t.value))return!1}}(e,t,Fn);return!(r||!(e&&("object"==typeof e||"function"==typeof e))||n||!(t&&("object"==typeof t||"function"==typeof t)))||He(e,t)}class kn{constructor(e){this.wrapped=e}static wrap(e){return new kn(e)}static unwrap(e){return kn.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof kn}}class Un{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Bn(e){return!!jn(e)&&(Array.isArray(e)||!(e instanceof Map)&&Ve()in e)}function jn(e){return null!==e&&("function"==typeof e||"object"==typeof e)}class zn{constructor(){}supports(e){return Bn(e)}create(e){return new Gn(e)}}const Vn=(e,t)=>t;class Gn{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||Vn}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,n=0,i=null;for(;t||r;){const o=!r||t&&t.currentIndex<qn(r,n,i)?t:r,s=qn(o,n,i),a=o.currentIndex;if(o===r)n--,r=r._nextRemoved;else if(t=t._next,null==o.previousIndex)n++;else{i||(i=[]);const e=s-n,t=a-n;if(e!=t){for(let r=0;r<e;r++){const n=r<i.length?i[r]:i[r]=0,o=n+r;t<=o&&o<e&&(i[r]=n+1)}i[o.previousIndex]=t-e}}s!==a&&e(o,s,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Bn(e))throw new Error(`Error trying to diff '${We(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,r,n,i=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)r=e[t],n=this._trackByFn(t,r),null!==i&&He(i.trackById,n)?(o&&(i=this._verifyReinsertion(i,r,n,t)),He(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,n,t),o=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++)t(e[r]);else{const r=e[Ve()]();let n;for(;!(n=r.next()).done;)t(n.value)}}(e,e=>{n=this._trackByFn(t,e),null!==i&&He(i.trackById,n)?(o&&(i=this._verifyReinsertion(i,e,n,t)),He(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,n,t),o=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e,t;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,n){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,n))?(He(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,n)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(He(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,n)):e=this._addAfter(new Hn(t,r),i,n),e}_verifyReinsertion(e,t,r,n){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?e=this._reinsertAfter(i,e._prev,n):e.currentIndex!=n&&(e.currentIndex=n,this._addToMoves(e,n)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const n=e._prevRemoved,i=e._nextRemoved;return null===n?this._removalsHead=i:n._nextRemoved=i,null===i?this._removalsTail=n:i._prevRemoved=n,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),null===this._additionsTail?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const n=null===t?this._itHead:t._next;return e._next=n,e._prev=t,null===n?this._itTail=e:n._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Xn),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t?e:(null===this._movesTail?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e,e)}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Xn),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,null===this._identityChangesTail?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}}class Hn{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Wn{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&He(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class Xn{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new Wn,this.map.set(t,r)),r.add(e)}get(e,t){const r=e,n=this.map.get(r);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function qn(e,t,r){const n=e.previousIndex;if(null===n)return n;let i=0;return r&&n<r.length&&(i=r[n]),n+t+i}class Yn{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||jn(e)))throw new Error(`Error trying to diff '${We(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,r)=>{if(t&&t.key===r)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const n=this._getOrCreateRecordForKey(r,e);t=this._insertBeforeOrAppend(t,n)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const r=this._records.get(e);this._maybeAddToChanges(r,t);const n=r._prev,i=r._next;return n&&(n._next=i),i&&(i._prev=n),r._next=null,r._prev=null,r}const r=new Jn(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){He(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class Jn{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}class Zn{constructor(e){this.factories=e}static create(e,t){if(null!=t){const r=t.factories.slice();e=e.concat(r)}return new Zn(e)}static extend(e){return{provide:Zn,useFactory:t=>{if(!t)throw new Error("Cannot extend IterableDiffers without a parent injector");return Zn.create(e,t)},deps:[[Zn,new nt,new tt]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'`)}}Zn.ngInjectableDef=de({providedIn:"root",factory:()=>new Zn([new zn])});class Qn{constructor(e){this.factories=e}static create(e,t){if(t){const r=t.factories.slice();e=e.concat(r)}return new Qn(e)}static extend(e){return{provide:Qn,useFactory:t=>{if(!t)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return Qn.create(e,t)},deps:[[Qn,new nt,new tt]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}const Kn=[new class{constructor(){}supports(e){return e instanceof Map||jn(e)}create(){return new Yn}}],$n=[new zn],ei=new Zn($n),ti=new Qn(Kn),ri=ln(null,"core",[{provide:Tr,useValue:"unknown"},{provide:un,deps:[ut]},{provide:$r,deps:[]},{provide:Ar,deps:[]}]),ni=new pe("LocaleId"),ii=(new pe("Translations"),new pe("TranslationsFormat"),{Error:0,Warning:1,Ignore:2});function oi(){return ei}function si(){return ti}function ai(e){return e||"en-US"}ii[ii.Error]="Error",ii[ii.Warning]="Warning",ii[ii.Ignore]="Ignore";class li{constructor(e){}}li.decorators=[{type:Ft,args:[{providers:[dn,yr,Cr,wr,{provide:Zn,useFactory:oi},{provide:Qn,useFactory:si},{provide:ni,useFactory:ai,deps:[[new et(ni),new tt,new nt]]}]}]}],li.ctorParameters=(()=>[{type:dn}]);class ci{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e),this.inertBodyElement=this.inertDocument.createElement("body"),e.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(e){return!1}}()?this.getInertBodyElement=this.getInertBodyElement_DOMParser:this.getInertBodyElement=this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}getInertBodyElement_XHR(e){e="<body><remove></remove>"+e+"</body>";try{e=encodeURI(e)}catch(e){return null}const t=new XMLHttpRequest;t.responseType="document",t.open("GET","data:text/html;charset=utf-8,"+e,!1),t.send(null);const r=t.response.body;return r.removeChild(r.firstChild),r}getInertBodyElement_DOMParser(e){e="<body><remove></remove>"+e+"</body>";try{const t=(new window.DOMParser).parseFromString(e,"text/html").body;return t.removeChild(t.firstChild),t}catch(e){return null}}getInertBodyElement_InertDocument(e){const t=this.inertDocument.createElement("template");return"content"in t?(t.innerHTML=e,t):(this.inertBodyElement.innerHTML=e,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}stripCustomNsAttrs(e){const t=e.attributes;for(let n=t.length-1;0<n;n--){const r=t.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||e.removeAttribute(r)}let r=e.firstChild;for(;r;)r.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(r),r=r.nextSibling}}const ui=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,hi=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function di(e){return(e=String(e)).match(ui)||e.match(hi)?e:(sn()&&console.warn(`WARNING: sanitizing unsafe URL value ${e} (see http://g.co/ng/security#xss)`),"unsafe:"+e)}function pi(e){return(e=String(e)).split(",").map(e=>di(e.trim())).join(", ")}function fi(e){const t={};for(const r of e.split(","))t[r]=!0;return t}function mi(...e){const t={};for(const r of e)for(const e in r)r.hasOwnProperty(e)&&(t[e]=!0);return t}const vi=fi("area,br,col,hr,img,wbr"),gi=fi("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),yi=fi("rp,rt"),xi=mi(yi,gi),bi=mi(gi,fi("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),wi=mi(yi,fi("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),_i=mi(vi,bi,wi,xi),Si=fi("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Ti=fi("srcset"),Mi=fi("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Ai=mi(Si,Ti,Mi);class Ei{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let e=this.checkClobberedElement(t,t.nextSibling);if(e){t=e;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!_i.hasOwnProperty(t))return void(this.sanitizedSomething=!0);this.buf.push("<"),this.buf.push(t);const r=e.attributes;for(let n=0;n<r.length;n++){const e=r.item(n),t=e.name,i=t.toLowerCase();if(!Ai.hasOwnProperty(i)){this.sanitizedSomething=!0;continue}let o=e.value;Si[i]&&(o=di(o)),Ti[i]&&(o=pi(o)),this.buf.push(" ",t,'="',Oi(o),'"')}this.buf.push(">")}endElement(e){const t=e.nodeName.toLowerCase();_i.hasOwnProperty(t)&&!vi.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(Oi(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const Ci=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Pi=/([^\#-~ |!])/g;function Oi(e){return e.replace(/&/g,"&amp;").replace(Ci,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(Pi,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Di;function Ni(e,t){let r=null;try{Di=Di||new ci(e);let n=t?String(t):"";r=Di.getInertBodyElement(n);let i=5,o=n;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,n=o,o=r.innerHTML,r=Di.getInertBodyElement(n)}while(n!==o);const s=new Ei,a=s.sanitizeChildren(Li(r)||r);return sn()&&s.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss)."),a}finally{if(r){const e=Li(r)||r;for(;e.firstChild;)e.removeChild(e.firstChild)}}}function Li(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}const Ii=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Ri=/^url\(([^)]+)\)$/;function Fi(e){if(!(e=String(e).trim()))return"";const t=e.match(Ri);return t&&di(t[1])===t[1]||e.match(Ii)&&function(e){let t=!0,r=!0;for(let n=0;n<e.length;n++){const i=e.charAt(n);"'"===i&&r?t=!t:'"'===i&&t&&(r=!r)}return t&&r}(e)?e:(sn()&&console.warn(`WARNING: sanitizing unsafe style value ${e} (see http://g.co/ng/security#xss).`),"unsafe")}const ki={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};ki[ki.NONE]="NONE",ki[ki.HTML]="HTML",ki[ki.STYLE]="STYLE",ki[ki.SCRIPT]="SCRIPT",ki[ki.URL]="URL",ki[ki.RESOURCE_URL]="RESOURCE_URL";class Ui{}function Bi(e,t,r){const n=e.state,i=1792&n;return i===t?(e.state=-1793&n|r,e.initIndex=-1,!0):i===r}function ji(e,t,r){return(1792&e.state)===t&&e.initIndex<=r&&(e.initIndex=r+1,!0)}function zi(e,t){return e.nodes[t]}function Vi(e,t){return e.nodes[t]}function Gi(e,t){return e.nodes[t]}function Hi(e,t){return e.nodes[t]}function Wi(e,t){return e.nodes[t]}const Xi={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0};function qi(e,t,r,n){let i=`ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '${t}'. Current value: '${r}'.`;return n&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(e,t){const r=new Error(e);return Yi(r,t),r}(i,e)}function Yi(e,t){e[jt]=t,e[Vt]=t.logError.bind(t)}function Ji(e){return new Error(`ViewDestroyedError: Attempt to use a destroyed view: ${e}`)}const Zi=()=>{},Qi=new Map;function Ki(e){let t=Qi.get(e);return t||(t=We(e)+"_"+Qi.size,Qi.set(e,t)),t}const $i="$$undefined",eo="$$empty";function to(e){return{id:$i,styles:e.styles,encapsulation:e.encapsulation,data:e.data}}let ro=0;function no(e){if(e&&e.id===$i){const t=null!=e.encapsulation&&e.encapsulation!==kt.None||e.styles.length||Object.keys(e.data).length;e.id=t?`c${ro++}`:eo}return e&&e.id===eo&&(e=null),e||null}function io(e,t,r,n){const i=e.oldValues;return!(!(2&e.state)&&He(i[t.bindingIndex+r],n))}function oo(e,t,r,n){return!!io(e,t,r,n)&&(e.oldValues[t.bindingIndex+r]=n,!0)}function so(e,t,r,n){const i=e.oldValues[t.bindingIndex+r];if(1&e.state||!Fn(i,n)){const o=t.bindings[r].name;throw qi(Xi.createDebugContext(e,t.nodeIndex),`${o}: ${i}`,`${o}: ${n}`,0!=(1&e.state))}}function ao(e){let t=e;for(;t;)2&t.def.flags&&(t.state|=8),t=t.viewContainerParent||t.parent}function lo(e,t){let r=e;for(;r&&r!==t;)r.state|=64,r=r.viewContainerParent||r.parent}function co(e,t,r,n){try{return ao(33554432&e.def.nodes[t].flags?Vi(e,t).componentView:e),Xi.handleEvent(e,t,r,n)}catch(t){e.root.errorHandler.handleError(t)}}function uo(e){if(e.parent){return Vi(e.parent,e.parentNodeDef.nodeIndex)}return null}function ho(e){return e.parent?e.parentNodeDef.parent:null}function po(e,t){switch(201347067&t.flags){case 1:return Vi(e,t.nodeIndex).renderElement;case 2:return zi(e,t.nodeIndex).renderText}}function fo(e,t){return e?`${e}:${t}`:t}function mo(e){return!!e.parent&&!!(32768&e.parentNodeDef.flags)}function vo(e){return!(!e.parent||32768&e.parentNodeDef.flags)}function go(e){return 1<<e%32}function yo(e){const t={};let r=0;const n={};return e&&e.forEach(([e,i])=>{"number"==typeof e?(t[e]=i,r|=go(e)):n[e]=i}),{matchedQueries:t,references:n,matchedQueryIds:r}}function xo(e,t){return e.map(e=>{let r,n;return Array.isArray(e)?[n,r]=e:(n=0,r=e),r&&("function"==typeof r||"object"==typeof r)&&t&&Object.defineProperty(r,ot,{value:t,configurable:!0}),{flags:n,token:r,tokenKey:Ki(r)}})}function bo(e,t,r){let n=r.renderParent;return n?0==(1&n.flags)||0==(33554432&n.flags)||n.element.componentRendererType&&n.element.componentRendererType.encapsulation===kt.Native?Vi(e,r.renderParent.nodeIndex).renderElement:void 0:t}const wo=new WeakMap;function _o(e){let t=wo.get(e);return t||((t=e(()=>Zi)).factory=e,wo.set(e,t)),t}function So(e,t,r,n,i){3===t&&(r=e.renderer.parentNode(po(e,e.def.lastRenderRootNode))),To(e,t,0,e.def.nodes.length-1,r,n,i)}function To(e,t,r,n,i,o,s){for(let a=r;a<=n;a++){const r=e.def.nodes[a];11&r.flags&&Ao(e,r,t,i,o,s),a+=r.childCount}}function Mo(e,t,r,n,i,o){let s=e;for(;s&&!mo(s);)s=s.parent;const a=s.parent,l=ho(s),c=l.nodeIndex+1,u=l.nodeIndex+l.childCount;for(let h=c;h<=u;h++){const e=a.def.nodes[h];e.ngContentIndex===t&&Ao(a,e,r,n,i,o),h+=e.childCount}if(!a.parent){const s=e.root.projectableNodes[t];if(s)for(let t=0;t<s.length;t++)Eo(e,s[t],r,n,i,o)}}function Ao(e,t,r,n,i,o){if(8&t.flags)Mo(e,t.ngContent.index,r,n,i,o);else{const s=po(e,t);if(3===r&&33554432&t.flags&&48&t.bindingFlags){if(16&t.bindingFlags&&Eo(e,s,r,n,i,o),32&t.bindingFlags){Eo(Vi(e,t.nodeIndex).componentView,s,r,n,i,o)}}else Eo(e,s,r,n,i,o);if(16777216&t.flags){const s=Vi(e,t.nodeIndex).viewContainer._embeddedViews;for(let e=0;e<s.length;e++)So(s[e],r,n,i,o)}1&t.flags&&!t.element.name&&To(e,r,t.nodeIndex+1,t.nodeIndex+t.childCount,n,i,o)}}function Eo(e,t,r,n,i,o){const s=e.renderer;switch(r){case 1:s.appendChild(n,t);break;case 2:s.insertBefore(n,t,i);break;case 3:s.removeChild(n,t);break;case 0:o.push(t)}}const Co=/^:([^:]+):(.+)$/;function Po(e){if(":"===e[0]){const t=e.match(Co);return[t[1],t[2]]}return["",e]}function Oo(e){let t=0;for(let r=0;r<e.length;r++)t|=e[r].flags;return t}function Do(e){return null!=e?e.toString():""}function No(e,t,r,n,i,o){e|=1;const{matchedQueries:s,references:a,matchedQueryIds:l}=yo(t);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:e,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:s,matchedQueryIds:l,references:a,ngContentIndex:r,childCount:n,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?_o(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||Zi},provider:null,text:null,query:null,ngContent:null}}function Lo(e,t,r,n,i,o,s=[],a,l,c,u,h){c||(c=Zi);const{matchedQueries:d,references:p,matchedQueryIds:f}=yo(r);let m=null,v=null;o&&([m,v]=Po(o)),a=a||[];const g=new Array(a.length);for(let b=0;b<a.length;b++){const[e,t,r]=a[b],[n,i]=Po(t);let o=void 0,s=void 0;switch(15&e){case 4:s=r;break;case 1:case 8:o=r}g[b]={flags:e,ns:n,name:i,nonMinifiedName:i,securityContext:o,suffix:s}}l=l||[];const y=new Array(l.length);for(let b=0;b<l.length;b++){const[e,t]=l[b];y[b]={type:0,target:e,eventName:t,propName:null}}const x=(s=s||[]).map(([e,t])=>{const[r,n]=Po(e);return[r,n,t]});return h=no(h),u&&(t|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:d,matchedQueryIds:f,references:p,ngContentIndex:n,childCount:i,bindings:g,bindingFlags:Oo(g),outputs:y,element:{ns:m,name:v,attrs:x,template:null,componentProvider:null,componentView:u||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:c||Zi},provider:null,text:null,query:null,ngContent:null}}function Io(e,t,r){const n=r.element,i=e.root.selectorOrNode,o=e.renderer;let s;if(e.parent||!i){s=n.name?o.createElement(n.name,n.ns):o.createComment("");const i=bo(e,t,r);i&&o.appendChild(i,s)}else s=o.selectRootElement(i);if(n.attrs)for(let a=0;a<n.attrs.length;a++){const[e,t,r]=n.attrs[a];o.setAttribute(s,t,r,e)}return s}function Ro(e,t,r,n){for(let i=0;i<r.outputs.length;i++){const o=r.outputs[i],s=Fo(e,r.nodeIndex,fo(o.target,o.eventName));let a=o.target,l=e;"component"===o.target&&(a=null,l=t);const c=l.renderer.listen(a||n,o.eventName,s);e.disposables[r.outputIndex+i]=c}}function Fo(e,t,r){return n=>co(e,t,r,n)}function ko(e,t,r,n){if(!oo(e,t,r,n))return!1;const i=t.bindings[r],o=Vi(e,t.nodeIndex),s=o.renderElement,a=i.name;switch(15&i.flags){case 1:!function(e,t,r,n,i,o){const s=t.securityContext;let a=s?e.root.sanitizer.sanitize(s,o):o;a=null!=a?a.toString():null;const l=e.renderer;null!=o?l.setAttribute(r,i,a,n):l.removeAttribute(r,i,n)}(e,i,s,i.ns,a,n);break;case 2:!function(e,t,r,n){const i=e.renderer;n?i.addClass(t,r):i.removeClass(t,r)}(e,s,a,n);break;case 4:!function(e,t,r,n,i){let o=e.root.sanitizer.sanitize(ki.STYLE,i);if(null!=o){o=o.toString();const e=t.suffix;null!=e&&(o+=e)}else o=null;const s=e.renderer;null!=o?s.setStyle(r,n,o):s.removeStyle(r,n)}(e,i,s,a,n);break;case 8:!function(e,t,r,n,i){const o=t.securityContext;let s=o?e.root.sanitizer.sanitize(o,i):i;e.renderer.setProperty(r,n,s)}(33554432&t.flags&&32&i.flags?o.componentView:e,i,s,a,n)}return!0}const Uo=new Object,Bo=Ki(ut),jo=Ki(lt),zo=Ki(kr);function Vo(e,t,r,n){return r=$e(r),{index:-1,deps:xo(n,We(t)),flags:e,token:t,value:r}}function Go(e,t,r=ut.THROW_IF_NOT_FOUND){const n=Ct(e);try{if(8&t.flags)return t.token;if(2&t.flags&&(r=null),1&t.flags)return e._parent.get(t.token,r);const i=t.tokenKey;switch(i){case Bo:case jo:case zo:return e}const o=e._def.providersByKey[i];if(o){let t=e._providers[o.index];return void 0===t&&(t=e._providers[o.index]=Ho(e,o)),t===Uo?void 0:t}if(t.token.ngInjectableDef&&function(e,t){return null!=t.providedIn&&(function(e,t){return e._def.modules.indexOf(t)>-1}(e,t.providedIn)||"root"===t.providedIn&&e._def.isRoot)}(e,t.token.ngInjectableDef)){const r=t.token.ngInjectableDef,n=e._providers.length;return e._def.providersByKey[t.tokenKey]={flags:5120,value:r.factory,deps:[],index:n,token:t.token},e._providers[n]=Uo,e._providers[n]=Ho(e,e._def.providersByKey[t.tokenKey])}return e._parent.get(t.token,r)}finally{Ct(n)}}function Ho(e,t){let r;switch(201347067&t.flags){case 512:r=function(e,t,r){const n=r.length;switch(n){case 0:return new t;case 1:return new t(Go(e,r[0]));case 2:return new t(Go(e,r[0]),Go(e,r[1]));case 3:return new t(Go(e,r[0]),Go(e,r[1]),Go(e,r[2]));default:const i=new Array(n);for(let t=0;t<n;t++)i[t]=Go(e,r[t]);return new t(...i)}}(e,t.value,t.deps);break;case 1024:r=function(e,t,r){const n=r.length;switch(n){case 0:return t();case 1:return t(Go(e,r[0]));case 2:return t(Go(e,r[0]),Go(e,r[1]));case 3:return t(Go(e,r[0]),Go(e,r[1]),Go(e,r[2]));default:const i=Array(n);for(let t=0;t<n;t++)i[t]=Go(e,r[t]);return t(...i)}}(e,t.value,t.deps);break;case 2048:r=Go(e,t.deps[0]);break;case 256:r=t.value}return void 0===r?Uo:r}function Wo(e,t,r,n){let i=t.viewContainer._embeddedViews;null!==r&&void 0!==r||(r=i.length),n.viewContainerParent=e,Jo(i,r,n),function(e,t){const r=uo(t);if(!r||r===e||16&t.state)return;t.state|=16;let n=r.template._projectedViews;n||(n=r.template._projectedViews=[]);n.push(t),function(e,t){if(4&t.flags)return;e.nodeFlags|=4,t.flags|=4;let r=t.parent;for(;r;)r.childFlags|=4,r=r.parent}(t.parent.def,t.parentNodeDef)}(t,n),Xi.dirtyParentQueries(n),qo(t,r>0?i[r-1]:null,n)}function Xo(e,t){const r=e.viewContainer._embeddedViews;if((null==t||t>=r.length)&&(t=r.length-1),t<0)return null;const n=r[t];return n.viewContainerParent=null,Zo(r,t),Xi.dirtyParentQueries(n),Yo(n),n}function qo(e,t,r){const n=t?po(t,t.def.lastRenderRootNode):e.renderElement;So(r,2,r.renderer.parentNode(n),r.renderer.nextSibling(n),void 0)}function Yo(e){So(e,3,null,null,void 0)}function Jo(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function Zo(e,t){t>=e.length-1?e.pop():e.splice(t,1)}const Qo=new Object;function Ko(e,t,r,n,i,o){return new $o(e,t,r,n,i,o)}class $o extends Dr{constructor(e,t,r,n,i,o){super(),this.selector=e,this.componentType=t,this._inputs=n,this._outputs=i,this.ngContentSelectors=o,this.viewDefFactory=r}get inputs(){const e=[],t=this._inputs;for(let r in t){const n=t[r];e.push({propName:r,templateName:n})}return e}get outputs(){const e=[];for(let t in this._outputs){const r=this._outputs[t];e.push({propName:t,templateName:r})}return e}create(e,t,r,n){if(!n)throw new Error("ngModule should be provided");const i=_o(this.viewDefFactory),o=i.nodes[0].element.componentProvider.nodeIndex,s=Xi.createRootView(e,t||[],r,i,n,Qo),a=Gi(s,o).instance;return r&&s.renderer.setAttribute(Vi(s,0).renderElement,"ng-version",Bt.full),new es(s,new is(s),a)}}class es extends Or{constructor(e,t,r){super(),this._view=e,this._viewRef=t,this._component=r,this._elDef=this._view.def.nodes[0],this.hostView=t,this.changeDetectorRef=t,this.instance=r}get location(){return new yn(Vi(this._view,this._elDef.nodeIndex).renderElement)}get injector(){return new ls(this._view,this._elDef)}get componentType(){return this._component.constructor}destroy(){this._viewRef.destroy()}onDestroy(e){this._viewRef.onDestroy(e)}}function ts(e,t,r){return new rs(e,t,r)}class rs{constructor(e,t,r){this._view=e,this._elDef=t,this._data=r,this._embeddedViews=[]}get element(){return new yn(this._data.renderElement)}get injector(){return new ls(this._view,this._elDef)}get parentInjector(){let e=this._view,t=this._elDef.parent;for(;!t&&e;)t=ho(e),e=e.parent;return e?new ls(e,t):new ls(this._view,null)}clear(){for(let e=this._embeddedViews.length-1;e>=0;e--){const t=Xo(this._data,e);Xi.destroyView(t)}}get(e){const t=this._embeddedViews[e];if(t){const e=new is(t);return e.attachToViewContainerRef(this),e}return null}get length(){return this._embeddedViews.length}createEmbeddedView(e,t,r){const n=e.createEmbeddedView(t||{});return this.insert(n,r),n}createComponent(e,t,r,n,i){const o=r||this.parentInjector;i||e instanceof Fr||(i=o.get(kr));const s=e.create(o,n,void 0,i);return this.insert(s.hostView,t),s}insert(e,t){if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");const r=e,n=r._view;return Wo(this._view,this._data,t,n),r.attachToViewContainerRef(this),e}move(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");const r=this._embeddedViews.indexOf(e._view);return function(e,t,r){const n=e.viewContainer._embeddedViews,i=n[t];Zo(n,t),null==r&&(r=n.length),Jo(n,r,i),Xi.dirtyParentQueries(i),Yo(i),qo(e,r>0?n[r-1]:null,i)}(this._data,r,t),e}indexOf(e){return this._embeddedViews.indexOf(e._view)}remove(e){const t=Xo(this._data,e);t&&Xi.destroyView(t)}detach(e){const t=Xo(this._data,e);return t?new is(t):null}}function ns(e){return new is(e)}class is{constructor(e){this._view=e,this._viewContainerRef=null,this._appRef=null}get rootNodes(){return function(e){const t=[];return So(e,0,void 0,void 0,t),t}(this._view)}get context(){return this._view.context}get destroyed(){return 0!=(128&this._view.state)}markForCheck(){ao(this._view)}detach(){this._view.state&=-5}detectChanges(){const e=this._view.root.rendererFactory;e.begin&&e.begin();try{Xi.checkAndUpdateView(this._view)}finally{e.end&&e.end()}}checkNoChanges(){Xi.checkNoChangesView(this._view)}reattach(){this._view.state|=4}onDestroy(e){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(e)}destroy(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),Xi.destroyView(this._view)}detachFromAppRef(){this._appRef=null,Yo(this._view),Xi.dirtyParentQueries(this._view)}attachToAppRef(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}attachToViewContainerRef(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}}function os(e,t){return new ss(e,t)}class ss extends En{constructor(e,t){super(),this._parentView=e,this._def=t}createEmbeddedView(e){return new is(Xi.createEmbeddedView(this._parentView,this._def,this._def.element.template,e))}get elementRef(){return new yn(Vi(this._parentView,this._def.nodeIndex).renderElement)}}function as(e,t){return new ls(e,t)}class ls{constructor(e,t){this.view=e,this.elDef=t}get(e,t=ut.THROW_IF_NOT_FOUND){const r=!!this.elDef&&0!=(33554432&this.elDef.flags);return Xi.resolveDep(this.view,this.elDef,r,{flags:0,token:e,tokenKey:Ki(e)},t)}}function cs(e,t){const r=e.def.nodes[t];if(1&r.flags){const t=Vi(e,r.nodeIndex);return r.element.template?t.template:t.renderElement}if(2&r.flags)return zi(e,r.nodeIndex).renderText;if(20240&r.flags)return Gi(e,r.nodeIndex).instance;throw new Error(`Illegal state: read nodeValue for node index ${t}`)}function us(e){return new hs(e.renderer)}class hs{constructor(e){this.delegate=e}selectRootElement(e){return this.delegate.selectRootElement(e)}createElement(e,t){const[r,n]=Po(t),i=this.delegate.createElement(n,r);return e&&this.delegate.appendChild(e,i),i}createViewRoot(e){return e}createTemplateAnchor(e){const t=this.delegate.createComment("");return e&&this.delegate.appendChild(e,t),t}createText(e,t){const r=this.delegate.createText(t);return e&&this.delegate.appendChild(e,r),r}projectNodes(e,t){for(let r=0;r<t.length;r++)this.delegate.appendChild(e,t[r])}attachViewAfter(e,t){const r=this.delegate.parentNode(e),n=this.delegate.nextSibling(e);for(let i=0;i<t.length;i++)this.delegate.insertBefore(r,t[i],n)}detachView(e){for(let t=0;t<e.length;t++){const r=e[t],n=this.delegate.parentNode(r);this.delegate.removeChild(n,r)}}destroyView(e,t){for(let r=0;r<t.length;r++)this.delegate.destroyNode(t[r])}listen(e,t,r){return this.delegate.listen(e,t,r)}listenGlobal(e,t,r){return this.delegate.listen(e,t,r)}setElementProperty(e,t,r){this.delegate.setProperty(e,t,r)}setElementAttribute(e,t,r){const[n,i]=Po(t);null!=r?this.delegate.setAttribute(e,i,r,n):this.delegate.removeAttribute(e,i,n)}setBindingDebugInfo(e,t,r){}setElementClass(e,t,r){r?this.delegate.addClass(e,t):this.delegate.removeClass(e,t)}setElementStyle(e,t,r){null!=r?this.delegate.setStyle(e,t,r):this.delegate.removeStyle(e,t)}invokeElementMethod(e,t,r){e[t].apply(e,r)}setText(e,t){this.delegate.setValue(e,t)}animate(){throw new Error("Renderer.animate is no longer supported!")}}function ds(e,t,r,n){return new ps(e,t,r,n)}class ps{constructor(e,t,r,n){this._moduleType=e,this._parent=t,this._bootstrapComponents=r,this._def=n,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(e){const t=e._def,r=e._providers=new Array(t.providers.length);for(let n=0;n<t.providers.length;n++){const i=t.providers[n];4096&i.flags||void 0===r[n]&&(r[n]=Ho(e,i))}}(this)}get(e,t=ut.THROW_IF_NOT_FOUND,r=0){let n=0;return 4&r?n|=1:2&r&&(n|=4),Go(this,{token:e,tokenKey:Ki(e),flags:n},t)}get instance(){return this.get(this._moduleType)}get componentFactoryResolver(){return this.get(Ir)}destroy(){if(this._destroyed)throw new Error(`The ng module ${We(this.instance.constructor)} has already been destroyed.`);this._destroyed=!0,function(e,t){const r=e._def;for(let n=0;n<r.providers.length;n++)if(131072&r.providers[n].flags){const t=e._providers[n];t&&t!==Uo&&t.ngOnDestroy()}}(this),this._destroyListeners.forEach(e=>e())}onDestroy(e){this._destroyListeners.push(e)}}const fs=Ki(fn),ms=Ki(gn),vs=Ki(yn),gs=Ki(Cn),ys=Ki(En),xs=Ki(Pn),bs=Ki(ut),ws=Ki(lt);function _s(e,t,r,n,i,o,s,a){const l=[];if(s)for(let u in s){const[e,t]=s[u];l[e]={flags:8,name:u,nonMinifiedName:t,ns:null,securityContext:null,suffix:null}}const c=[];if(a)for(let u in a)c.push({type:1,propName:u,target:null,eventName:a[u]});return Ss(e,t|=16384,r,n,i,i,o,l,c)}function Ss(e,t,r,n,i,o,s,a,l){const{matchedQueries:c,references:u,matchedQueryIds:h}=yo(r);l||(l=[]),a||(a=[]),o=$e(o);const d=xo(s,We(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:h,references:u,ngContentIndex:-1,childCount:n,bindings:a,bindingFlags:Oo(a),outputs:l,element:null,provider:{token:i,value:o,deps:d},text:null,query:null,ngContent:null}}function Ts(e,t){return Cs(e,t)}function Ms(e,t){let r=e;for(;r.parent&&!mo(r);)r=r.parent;return Ps(r.parent,ho(r),!0,t.provider.value,t.provider.deps)}function As(e,t){const r=(32768&t.flags)>0,n=Ps(e,t.parent,r,t.provider.value,t.provider.deps);if(t.outputs.length)for(let i=0;i<t.outputs.length;i++){const r=t.outputs[i],o=n[r.propName].subscribe(Es(e,t.parent.nodeIndex,r.eventName));e.disposables[t.outputIndex+i]=o.unsubscribe.bind(o)}return n}function Es(e,t,r){return n=>co(e,t,r,n)}function Cs(e,t){const r=(8192&t.flags)>0,n=t.provider;switch(201347067&t.flags){case 512:return Ps(e,t.parent,r,n.value,n.deps);case 1024:return function(e,t,r,n,i){const o=i.length;switch(o){case 0:return n();case 1:return n(Ds(e,t,r,i[0]));case 2:return n(Ds(e,t,r,i[0]),Ds(e,t,r,i[1]));case 3:return n(Ds(e,t,r,i[0]),Ds(e,t,r,i[1]),Ds(e,t,r,i[2]));default:const s=Array(o);for(let n=0;n<o;n++)s[n]=Ds(e,t,r,i[n]);return n(...s)}}(e,t.parent,r,n.value,n.deps);case 2048:return Ds(e,t.parent,r,n.deps[0]);case 256:return n.value}}function Ps(e,t,r,n,i){const o=i.length;switch(o){case 0:return new n;case 1:return new n(Ds(e,t,r,i[0]));case 2:return new n(Ds(e,t,r,i[0]),Ds(e,t,r,i[1]));case 3:return new n(Ds(e,t,r,i[0]),Ds(e,t,r,i[1]),Ds(e,t,r,i[2]));default:const s=new Array(o);for(let n=0;n<o;n++)s[n]=Ds(e,t,r,i[n]);return new n(...s)}}const Os={};function Ds(e,t,r,n,i=ut.THROW_IF_NOT_FOUND){if(8&n.flags)return n.token;const o=e;2&n.flags&&(i=null);const s=n.tokenKey;s===xs&&(r=!(!t||!t.element.componentView)),t&&1&n.flags&&(r=!1,t=t.parent);let a=e;for(;a;){if(t)switch(s){case fs:return us(Ns(a,t,r));case ms:return Ns(a,t,r).renderer;case vs:return new yn(Vi(a,t.nodeIndex).renderElement);case gs:return Vi(a,t.nodeIndex).viewContainer;case ys:if(t.element.template)return Vi(a,t.nodeIndex).template;break;case xs:return ns(Ns(a,t,r));case bs:case ws:return as(a,t);default:const e=(r?t.element.allProviders:t.element.publicProviders)[s];if(e){let t=Gi(a,e.nodeIndex);return t||(t={instance:Cs(a,e)},a.nodes[e.nodeIndex]=t),t.instance}}r=mo(a),t=ho(a),a=a.parent,4&n.flags&&(a=null)}const l=o.root.injector.get(n.token,Os);return l!==Os||i===Os?l:o.root.ngModule.injector.get(n.token,i)}function Ns(e,t,r){let n;if(r)n=Vi(e,t.nodeIndex).componentView;else for(n=e;n.parent&&!mo(n);)n=n.parent;return n}function Ls(e,t,r,n,i,o){if(32768&r.flags){const t=Vi(e,r.parent.nodeIndex).componentView;2&t.def.flags&&(t.state|=8)}const s=r.bindings[n].name;if(t.instance[s]=i,524288&r.flags){o=o||{};const t=kn.unwrap(e.oldValues[r.bindingIndex+n]);o[r.bindings[n].nonMinifiedName]=new Un(t,i,0!=(2&e.state))}return e.oldValues[r.bindingIndex+n]=i,o}function Is(e,t){if(!(e.def.nodeFlags&t))return;const r=e.def.nodes;let n=0;for(let i=0;i<r.length;i++){const o=r[i];let s=o.parent;for(!s&&o.flags&t&&Fs(e,i,o.flags&t,n++),0==(o.childFlags&t)&&(i+=o.childCount);s&&1&s.flags&&i===s.nodeIndex+s.childCount;)s.directChildFlags&t&&(n=Rs(e,s,t,n)),s=s.parent}}function Rs(e,t,r,n){for(let i=t.nodeIndex+1;i<=t.nodeIndex+t.childCount;i++){const t=e.def.nodes[i];t.flags&r&&Fs(e,i,t.flags&r,n++),i+=t.childCount}return n}function Fs(e,t,r,n){const i=Gi(e,t);if(!i)return;const o=i.instance;o&&(Xi.setCurrentNode(e,t),1048576&r&&ji(e,512,n)&&o.ngAfterContentInit(),2097152&r&&o.ngAfterContentChecked(),4194304&r&&ji(e,768,n)&&o.ngAfterViewInit(),8388608&r&&o.ngAfterViewChecked(),131072&r&&o.ngOnDestroy())}function ks(e,t,r){let n=[];for(let i in r){const e=r[i];n.push({propName:i,bindingType:e})}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:t,filterId:go(t),bindings:n},ngContent:null}}function Us(e){const t=e.def.nodeMatchedQueries;for(;e.parent&&vo(e);){let r=e.parentNodeDef;e=e.parent;const n=r.nodeIndex+r.childCount;for(let i=0;i<=n;i++){const n=e.def.nodes[i];67108864&n.flags&&536870912&n.flags&&(n.query.filterId&t)===n.query.filterId&&Wi(e,i).setDirty(),!(1&n.flags&&i+n.childCount<r.nodeIndex)&&67108864&n.childFlags&&536870912&n.childFlags||(i+=n.childCount)}}if(134217728&e.def.nodeFlags)for(let r=0;r<e.def.nodes.length;r++){const t=e.def.nodes[r];134217728&t.flags&&536870912&t.flags&&Wi(e,r).setDirty(),r+=t.childCount}}function Bs(e,t){const r=Wi(e,t.nodeIndex);if(!r.dirty)return;let n,i=void 0;if(67108864&t.flags){const r=t.parent.parent;i=js(e,r.nodeIndex,r.nodeIndex+r.childCount,t.query,[]),n=Gi(e,t.parent.nodeIndex).instance}else 134217728&t.flags&&(i=js(e,0,e.def.nodes.length-1,t.query,[]),n=e.component);r.reset(i);const o=t.query.bindings;let s=!1;for(let a=0;a<o.length;a++){const e=o[a];let t;switch(e.bindingType){case 0:t=r.first;break;case 1:t=r,s=!0}n[e.propName]=t}s&&r.notifyOnChanges()}function js(e,t,r,n,i){for(let o=t;o<=r;o++){const t=e.def.nodes[o],r=t.matchedQueries[n.id];if(null!=r&&i.push(zs(e,t,r)),1&t.flags&&t.element.template&&(t.element.template.nodeMatchedQueries&n.filterId)===n.filterId){const r=Vi(e,o);if((t.childMatchedQueries&n.filterId)===n.filterId&&(js(e,o+1,o+t.childCount,n,i),o+=t.childCount),16777216&t.flags){const e=r.viewContainer._embeddedViews;for(let t=0;t<e.length;t++){const o=e[t],s=uo(o);s&&s===r&&js(o,0,o.def.nodes.length-1,n,i)}}const s=r.template._projectedViews;if(s)for(let e=0;e<s.length;e++){const t=s[e];js(t,0,t.def.nodes.length-1,n,i)}}(t.childMatchedQueries&n.filterId)!==n.filterId&&(o+=t.childCount)}return i}function zs(e,t,r){if(null!=r)switch(r){case 1:return Vi(e,t.nodeIndex).renderElement;case 0:return new yn(Vi(e,t.nodeIndex).renderElement);case 2:return Vi(e,t.nodeIndex).template;case 3:return Vi(e,t.nodeIndex).viewContainer;case 4:return Gi(e,t.nodeIndex).instance}}function Vs(e,t,r){const n=bo(e,t,r);n&&Mo(e,r.ngContent.index,1,n,null,void 0)}function Gs(e,t,r){const n=new Array(r.length);for(let i=0;i<r.length;i++){const e=r[i];n[i]={flags:8,name:e,ns:null,nonMinifiedName:e,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:n,bindingFlags:Oo(n),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}function Hs(e,t,r){const n=new Array(r.length-1);for(let i=1;i<r.length;i++)n[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:r[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:t,childCount:0,bindings:n,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:r[0]},query:null,ngContent:null}}function Ws(e,t,r){let n;const i=e.renderer;n=i.createText(r.text.prefix);const o=bo(e,t,r);return o&&i.appendChild(o,n),{renderText:n}}function Xs(e,t){return(null!=e?e.toString():"")+t.suffix}function qs(e,t,r,n){let i=0,o=0,s=0,a=0,l=0,c=null,u=null,h=!1,d=!1,p=null;for(let f=0;f<t.length;f++){const e=t[f];if(e.nodeIndex=f,e.parent=c,e.bindingIndex=i,e.outputIndex=o,e.renderParent=u,s|=e.flags,l|=e.matchedQueryIds,e.element){const t=e.element;t.publicProviders=c?c.element.publicProviders:Object.create(null),t.allProviders=t.publicProviders,h=!1,d=!1,e.element.template&&(l|=e.element.template.nodeMatchedQueries)}if(Js(c,e,t.length),i+=e.bindings.length,o+=e.outputs.length,!u&&3&e.flags&&(p=e),20224&e.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);const t=0!=(8192&e.flags),r=0!=(32768&e.flags);!t||r?c.element.publicProviders[Ki(e.provider.token)]=e:(d||(d=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[Ki(e.provider.token)]=e),r&&(c.element.componentProvider=e)}if(c?(c.childFlags|=e.flags,c.directChildFlags|=e.flags,c.childMatchedQueries|=e.matchedQueryIds,e.element&&e.element.template&&(c.childMatchedQueries|=e.element.template.nodeMatchedQueries)):a|=e.flags,e.childCount>0)c=e,Ys(e)||(u=e);else for(;c&&f===c.nodeIndex+c.childCount;){const e=c.parent;e&&(e.childFlags|=c.childFlags,e.childMatchedQueries|=c.childMatchedQueries),u=(c=e)&&Ys(c)?c.renderParent:c}}return{factory:null,nodeFlags:s,rootNodeFlags:a,nodeMatchedQueries:l,flags:e,nodes:t,updateDirectives:r||Zi,updateRenderer:n||Zi,handleEvent:(e,r,n,i)=>t[r].element.handleEvent(e,n,i),bindingCount:i,outputCount:o,lastRenderRootNode:p}}function Ys(e){return 0!=(1&e.flags)&&null===e.element.name}function Js(e,t,r){const n=t.element&&t.element.template;if(n){if(!n.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(n.lastRenderRootNode&&16777216&n.lastRenderRootNode.flags)throw new Error(`Illegal State: Last root node of a template can't have embedded views, at index ${t.nodeIndex}!`)}if(20224&t.flags){if(0==(1&(e?e.flags:0)))throw new Error(`Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ${t.nodeIndex}!`)}if(t.query){if(67108864&t.flags&&(!e||0==(16384&e.flags)))throw new Error(`Illegal State: Content Query nodes need to be children of directives, at index ${t.nodeIndex}!`);if(134217728&t.flags&&e)throw new Error(`Illegal State: View Query nodes have to be top level nodes, at index ${t.nodeIndex}!`)}if(t.childCount){const n=e?e.nodeIndex+e.childCount:r-1;if(t.nodeIndex<=n&&t.nodeIndex+t.childCount>n)throw new Error(`Illegal State: childCount of node leads outside of parent, at index ${t.nodeIndex}!`)}}function Zs(e,t,r,n){const i=$s(e.root,e.renderer,e,t,r);return ea(i,e.component,n),ta(i),i}function Qs(e,t,r){const n=$s(e,e.renderer,null,null,t);return ea(n,r,r),ta(n),n}function Ks(e,t,r,n){const i=t.element.componentRendererType;let o;return o=i?e.root.rendererFactory.createRenderer(n,i):e.root.renderer,$s(e.root,o,e,t.element.componentProvider,r)}function $s(e,t,r,n,i){const o=new Array(i.nodes.length),s=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:r,viewContainerParent:null,parentNodeDef:n,context:null,component:null,nodes:o,state:13,root:e,renderer:t,oldValues:new Array(i.bindingCount),disposables:s,initIndex:-1}}function ea(e,t,r){e.component=t,e.context=r}function ta(e){let t;if(mo(e)){const r=e.parentNodeDef;t=Vi(e.parent,r.parent.nodeIndex).renderElement}const r=e.def,n=e.nodes;for(let i=0;i<r.nodes.length;i++){const o=r.nodes[i];let s;switch(Xi.setCurrentNode(e,i),201347067&o.flags){case 1:const r=Io(e,t,o);let a=void 0;if(33554432&o.flags){const t=_o(o.element.componentView);a=Xi.createComponentView(e,o,t,r)}Ro(e,a,o,r),s={renderElement:r,componentView:a,viewContainer:null,template:o.element.template?os(e,o):void 0},16777216&o.flags&&(s.viewContainer=ts(e,o,s));break;case 2:s=Ws(e,t,o);break;case 512:case 1024:case 2048:case 256:if(!((s=n[i])||4096&o.flags)){s={instance:Ts(e,o)}}break;case 16:s={instance:Ms(e,o)};break;case 16384:if(!(s=n[i])){s={instance:As(e,o)}}if(32768&o.flags){ea(Vi(e,o.parent.nodeIndex).componentView,s.instance,s.instance)}break;case 32:case 64:case 128:s={value:void 0};break;case 67108864:case 134217728:s=new bn;break;case 8:Vs(e,t,o),s=void 0}n[i]=s}ua(e,ca.CreateViewNodes),fa(e,201326592,268435456,0)}function ra(e){oa(e),Xi.updateDirectives(e,1),ha(e,ca.CheckNoChanges),Xi.updateRenderer(e,1),ua(e,ca.CheckNoChanges),e.state&=-97}function na(e){1&e.state?(e.state&=-2,e.state|=2):e.state&=-3,Bi(e,0,256),oa(e),Xi.updateDirectives(e,0),ha(e,ca.CheckAndUpdate),fa(e,67108864,536870912,0);let t=Bi(e,256,512);Is(e,2097152|(t?1048576:0)),Xi.updateRenderer(e,0),ua(e,ca.CheckAndUpdate),fa(e,134217728,536870912,0),Is(e,8388608|((t=Bi(e,512,768))?4194304:0)),2&e.def.flags&&(e.state&=-9),e.state&=-97,Bi(e,768,1024)}function ia(e,t,r,n,i,o,s,a,l,c,u,h,d){return 0===r?function(e,t,r,n,i,o,s,a,l,c,u,h){switch(201347067&t.flags){case 1:return function(e,t,r,n,i,o,s,a,l,c,u,h){const d=t.bindings.length;let p=!1;return d>0&&ko(e,t,0,r)&&(p=!0),d>1&&ko(e,t,1,n)&&(p=!0),d>2&&ko(e,t,2,i)&&(p=!0),d>3&&ko(e,t,3,o)&&(p=!0),d>4&&ko(e,t,4,s)&&(p=!0),d>5&&ko(e,t,5,a)&&(p=!0),d>6&&ko(e,t,6,l)&&(p=!0),d>7&&ko(e,t,7,c)&&(p=!0),d>8&&ko(e,t,8,u)&&(p=!0),d>9&&ko(e,t,9,h)&&(p=!0),p}(e,t,r,n,i,o,s,a,l,c,u,h);case 2:return function(e,t,r,n,i,o,s,a,l,c,u,h){let d=!1;const p=t.bindings,f=p.length;if(f>0&&oo(e,t,0,r)&&(d=!0),f>1&&oo(e,t,1,n)&&(d=!0),f>2&&oo(e,t,2,i)&&(d=!0),f>3&&oo(e,t,3,o)&&(d=!0),f>4&&oo(e,t,4,s)&&(d=!0),f>5&&oo(e,t,5,a)&&(d=!0),f>6&&oo(e,t,6,l)&&(d=!0),f>7&&oo(e,t,7,c)&&(d=!0),f>8&&oo(e,t,8,u)&&(d=!0),f>9&&oo(e,t,9,h)&&(d=!0),d){let d=t.text.prefix;f>0&&(d+=Xs(r,p[0])),f>1&&(d+=Xs(n,p[1])),f>2&&(d+=Xs(i,p[2])),f>3&&(d+=Xs(o,p[3])),f>4&&(d+=Xs(s,p[4])),f>5&&(d+=Xs(a,p[5])),f>6&&(d+=Xs(l,p[6])),f>7&&(d+=Xs(c,p[7])),f>8&&(d+=Xs(u,p[8])),f>9&&(d+=Xs(h,p[9]));const m=zi(e,t.nodeIndex).renderText;e.renderer.setValue(m,d)}return d}(e,t,r,n,i,o,s,a,l,c,u,h);case 16384:return function(e,t,r,n,i,o,s,a,l,c,u,h){const d=Gi(e,t.nodeIndex),p=d.instance;let f=!1,m=void 0;const v=t.bindings.length;return v>0&&io(e,t,0,r)&&(f=!0,m=Ls(e,d,t,0,r,m)),v>1&&io(e,t,1,n)&&(f=!0,m=Ls(e,d,t,1,n,m)),v>2&&io(e,t,2,i)&&(f=!0,m=Ls(e,d,t,2,i,m)),v>3&&io(e,t,3,o)&&(f=!0,m=Ls(e,d,t,3,o,m)),v>4&&io(e,t,4,s)&&(f=!0,m=Ls(e,d,t,4,s,m)),v>5&&io(e,t,5,a)&&(f=!0,m=Ls(e,d,t,5,a,m)),v>6&&io(e,t,6,l)&&(f=!0,m=Ls(e,d,t,6,l,m)),v>7&&io(e,t,7,c)&&(f=!0,m=Ls(e,d,t,7,c,m)),v>8&&io(e,t,8,u)&&(f=!0,m=Ls(e,d,t,8,u,m)),v>9&&io(e,t,9,h)&&(f=!0,m=Ls(e,d,t,9,h,m)),m&&p.ngOnChanges(m),65536&t.flags&&ji(e,256,t.nodeIndex)&&p.ngOnInit(),262144&t.flags&&p.ngDoCheck(),f}(e,t,r,n,i,o,s,a,l,c,u,h);case 32:case 64:case 128:return function(e,t,r,n,i,o,s,a,l,c,u,h){const d=t.bindings;let p=!1;const f=d.length;if(f>0&&oo(e,t,0,r)&&(p=!0),f>1&&oo(e,t,1,n)&&(p=!0),f>2&&oo(e,t,2,i)&&(p=!0),f>3&&oo(e,t,3,o)&&(p=!0),f>4&&oo(e,t,4,s)&&(p=!0),f>5&&oo(e,t,5,a)&&(p=!0),f>6&&oo(e,t,6,l)&&(p=!0),f>7&&oo(e,t,7,c)&&(p=!0),f>8&&oo(e,t,8,u)&&(p=!0),f>9&&oo(e,t,9,h)&&(p=!0),p){const p=Hi(e,t.nodeIndex);let m;switch(201347067&t.flags){case 32:m=new Array(d.length),f>0&&(m[0]=r),f>1&&(m[1]=n),f>2&&(m[2]=i),f>3&&(m[3]=o),f>4&&(m[4]=s),f>5&&(m[5]=a),f>6&&(m[6]=l),f>7&&(m[7]=c),f>8&&(m[8]=u),f>9&&(m[9]=h);break;case 64:m={},f>0&&(m[d[0].name]=r),f>1&&(m[d[1].name]=n),f>2&&(m[d[2].name]=i),f>3&&(m[d[3].name]=o),f>4&&(m[d[4].name]=s),f>5&&(m[d[5].name]=a),f>6&&(m[d[6].name]=l),f>7&&(m[d[7].name]=c),f>8&&(m[d[8].name]=u),f>9&&(m[d[9].name]=h);break;case 128:const e=r;switch(f){case 1:m=e.transform(r);break;case 2:m=e.transform(n);break;case 3:m=e.transform(n,i);break;case 4:m=e.transform(n,i,o);break;case 5:m=e.transform(n,i,o,s);break;case 6:m=e.transform(n,i,o,s,a);break;case 7:m=e.transform(n,i,o,s,a,l);break;case 8:m=e.transform(n,i,o,s,a,l,c);break;case 9:m=e.transform(n,i,o,s,a,l,c,u);break;case 10:m=e.transform(n,i,o,s,a,l,c,u,h)}}p.value=m}return p}(e,t,r,n,i,o,s,a,l,c,u,h);default:throw"unreachable"}}(e,t,n,i,o,s,a,l,c,u,h,d):function(e,t,r){switch(201347067&t.flags){case 1:return function(e,t,r){let n=!1;for(let i=0;i<r.length;i++)ko(e,t,i,r[i])&&(n=!0);return n}(e,t,r);case 2:return function(e,t,r){const n=t.bindings;let i=!1;for(let o=0;o<r.length;o++)oo(e,t,o,r[o])&&(i=!0);if(i){let i="";for(let e=0;e<r.length;e++)i+=Xs(r[e],n[e]);i=t.text.prefix+i;const o=zi(e,t.nodeIndex).renderText;e.renderer.setValue(o,i)}return i}(e,t,r);case 16384:return function(e,t,r){const n=Gi(e,t.nodeIndex),i=n.instance;let o=!1,s=void 0;for(let a=0;a<r.length;a++)io(e,t,a,r[a])&&(o=!0,s=Ls(e,n,t,a,r[a],s));return s&&i.ngOnChanges(s),65536&t.flags&&ji(e,256,t.nodeIndex)&&i.ngOnInit(),262144&t.flags&&i.ngDoCheck(),o}(e,t,r);case 32:case 64:case 128:return function(e,t,r){const n=t.bindings;let i=!1;for(let o=0;o<r.length;o++)oo(e,t,o,r[o])&&(i=!0);if(i){const i=Hi(e,t.nodeIndex);let o;switch(201347067&t.flags){case 32:o=r;break;case 64:o={};for(let t=0;t<r.length;t++)o[n[t].name]=r[t];break;case 128:const e=r[0],i=r.slice(1);o=e.transform(...i)}i.value=o}return i}(e,t,r);default:throw"unreachable"}}(e,t,n)}function oa(e){const t=e.def;if(4&t.nodeFlags)for(let r=0;r<t.nodes.length;r++){const n=t.nodes[r];if(4&n.flags){const t=Vi(e,r).template._projectedViews;if(t)for(let r=0;r<t.length;r++){const n=t[r];n.state|=32,lo(n,e)}}else 0==(4&n.childFlags)&&(r+=n.childCount)}}function sa(e,t,r,n,i,o,s,a,l,c,u,h,d){return 0===r?function(e,t,r,n,i,o,s,a,l,c,u,h){const d=t.bindings.length;d>0&&so(e,t,0,r);d>1&&so(e,t,1,n);d>2&&so(e,t,2,i);d>3&&so(e,t,3,o);d>4&&so(e,t,4,s);d>5&&so(e,t,5,a);d>6&&so(e,t,6,l);d>7&&so(e,t,7,c);d>8&&so(e,t,8,u);d>9&&so(e,t,9,h)}(e,t,n,i,o,s,a,l,c,u,h,d):function(e,t,r){for(let n=0;n<r.length;n++)so(e,t,n,r[n])}(e,t,n),!1}function aa(e,t){if(Wi(e,t.nodeIndex).dirty)throw qi(Xi.createDebugContext(e,t.nodeIndex),`Query ${t.query.id} not dirty`,`Query ${t.query.id} dirty`,0!=(1&e.state))}function la(e){if(!(128&e.state)){if(ha(e,ca.Destroy),ua(e,ca.Destroy),Is(e,131072),e.disposables)for(let t=0;t<e.disposables.length;t++)e.disposables[t]();!function(e){if(!(16&e.state))return;const t=uo(e);if(t){const r=t.template._projectedViews;r&&(Zo(r,r.indexOf(e)),Xi.dirtyParentQueries(e))}}(e),e.renderer.destroyNode&&function(e){const t=e.def.nodes.length;for(let r=0;r<t;r++){const t=e.def.nodes[r];1&t.flags?e.renderer.destroyNode(Vi(e,r).renderElement):2&t.flags?e.renderer.destroyNode(zi(e,r).renderText):(67108864&t.flags||134217728&t.flags)&&Wi(e,r).destroy()}}(e),mo(e)&&e.renderer.destroy(),e.state|=128}}const ca={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};function ua(e,t){const r=e.def;if(33554432&r.nodeFlags)for(let n=0;n<r.nodes.length;n++){const i=r.nodes[n];33554432&i.flags?da(Vi(e,n).componentView,t):0==(33554432&i.childFlags)&&(n+=i.childCount)}}function ha(e,t){const r=e.def;if(16777216&r.nodeFlags)for(let n=0;n<r.nodes.length;n++){const i=r.nodes[n];if(16777216&i.flags){const r=Vi(e,n).viewContainer._embeddedViews;for(let e=0;e<r.length;e++)da(r[e],t)}else 0==(16777216&i.childFlags)&&(n+=i.childCount)}}function da(e,t){const r=e.state;switch(t){case ca.CheckNoChanges:0==(128&r)&&(12==(12&r)?ra(e):64&r&&pa(e,ca.CheckNoChangesProjectedViews));break;case ca.CheckNoChangesProjectedViews:0==(128&r)&&(32&r?ra(e):64&r&&pa(e,t));break;case ca.CheckAndUpdate:0==(128&r)&&(12==(12&r)?na(e):64&r&&pa(e,ca.CheckAndUpdateProjectedViews));break;case ca.CheckAndUpdateProjectedViews:0==(128&r)&&(32&r?na(e):64&r&&pa(e,t));break;case ca.Destroy:la(e);break;case ca.CreateViewNodes:ta(e)}}function pa(e,t){ha(e,t),ua(e,t)}function fa(e,t,r,n){if(!(e.def.nodeFlags&t&&e.def.nodeFlags&r))return;const i=e.def.nodes.length;for(let o=0;o<i;o++){const i=e.def.nodes[o];if(i.flags&t&&i.flags&r)switch(Xi.setCurrentNode(e,i.nodeIndex),n){case 0:Bs(e,i);break;case 1:aa(e,i)}i.childFlags&t&&i.childFlags&r||(o+=i.childCount)}}ca[ca.CreateViewNodes]="CreateViewNodes",ca[ca.CheckNoChanges]="CheckNoChanges",ca[ca.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",ca[ca.CheckAndUpdate]="CheckAndUpdate",ca[ca.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",ca[ca.Destroy]="Destroy";let ma=!1;function va(){if(ma)return;ma=!0;const e=sn()?{setCurrentNode:Ba,createRootView:ya,createEmbeddedView:ba,createComponentView:wa,createNgModuleRef:_a,overrideProvider:Aa,overrideComponentView:Ea,clearOverrides:Ca,checkAndUpdateView:Na,checkNoChangesView:La,destroyView:Ia,createDebugContext:(e,t)=>new Za(e,t),handleEvent:ja,updateDirectives:za,updateRenderer:Va}:{setCurrentNode:()=>{},createRootView:ga,createEmbeddedView:Zs,createComponentView:Ks,createNgModuleRef:ds,overrideProvider:Zi,overrideComponentView:Zi,clearOverrides:Zi,checkAndUpdateView:na,checkNoChangesView:ra,destroyView:la,createDebugContext:(e,t)=>new Za(e,t),handleEvent:(e,t,r,n)=>e.def.handleEvent(e,t,r,n),updateDirectives:(e,t)=>e.def.updateDirectives(0===t?Oa:Da,e),updateRenderer:(e,t)=>e.def.updateRenderer(0===t?Oa:Da,e)};Xi.setCurrentNode=e.setCurrentNode,Xi.createRootView=e.createRootView,Xi.createEmbeddedView=e.createEmbeddedView,Xi.createComponentView=e.createComponentView,Xi.createNgModuleRef=e.createNgModuleRef,Xi.overrideProvider=e.overrideProvider,Xi.overrideComponentView=e.overrideComponentView,Xi.clearOverrides=e.clearOverrides,Xi.checkAndUpdateView=e.checkAndUpdateView,Xi.checkNoChangesView=e.checkNoChangesView,Xi.destroyView=e.destroyView,Xi.resolveDep=Ds,Xi.createDebugContext=e.createDebugContext,Xi.handleEvent=e.handleEvent,Xi.updateDirectives=e.updateDirectives,Xi.updateRenderer=e.updateRenderer,Xi.dirtyParentQueries=Us}function ga(e,t,r,n,i,o){return Qs(xa(e,i,i.injector.get(mn),t,r),n,o)}function ya(e,t,r,n,i,o){const s=i.injector.get(mn),a=xa(e,i,new el(s),t,r),l=Pa(n);return Ka(Ra.create,Qs,null,[a,l,o])}function xa(e,t,r,n,i){const o=t.injector.get(Ui),s=t.injector.get(Xt);return{ngModule:t,injector:e,projectableNodes:n,selectorOrNode:i,sanitizer:o,rendererFactory:r,renderer:r.createRenderer(null,null),errorHandler:s}}function ba(e,t,r,n){const i=Pa(r);return Ka(Ra.create,Zs,null,[e,t,i,n])}function wa(e,t,r,n){const i=Ma.get(t.element.componentProvider.provider.token);return r=i||Pa(r),Ka(Ra.create,Ks,null,[e,t,r,n])}function _a(e,t,r,n){return ds(e,t,r,function(e){const{hasOverrides:t,hasDeprecatedOverrides:r}=function(e){let t=!1,r=!1;if(0===Sa.size)return{hasOverrides:t,hasDeprecatedOverrides:r};return e.providers.forEach(e=>{const n=Sa.get(e.token);3840&e.flags&&n&&(t=!0,r=r||n.deprecatedBehavior)}),e.modules.forEach(e=>{Ta.forEach((n,i)=>{i.ngInjectableDef.providedIn===e&&(t=!0,r=r||n.deprecatedBehavior)})}),{hasOverrides:t,hasDeprecatedOverrides:r}}(e);if(!t)return e;return function(e){for(let t=0;t<e.providers.length;t++){const n=e.providers[t];r&&(n.flags|=4096);const i=Sa.get(n.token);i&&(n.flags=-3841&n.flags|i.flags,n.deps=xo(i.deps),n.value=i.value)}if(Ta.size>0){let t=new Set(e.modules);Ta.forEach((n,i)=>{if(t.has(i.ngInjectableDef.providedIn)){let t={token:i,flags:n.flags|(r?4096:0),deps:xo(n.deps),value:n.value,index:e.providers.length};e.providers.push(t),e.providersByKey[Ki(i)]=t}})}}(e=e.factory(()=>Zi)),e}(n))}const Sa=new Map,Ta=new Map,Ma=new Map;function Aa(e){Sa.set(e.token,e),"function"==typeof e.token&&e.token.ngInjectableDef&&"function"==typeof e.token.ngInjectableDef.providedIn&&Ta.set(e.token,e)}function Ea(e,t){const r=_o(_o(function(e){return e.viewDefFactory}(t)).nodes[0].element.componentView);Ma.set(e,r)}function Ca(){Sa.clear(),Ta.clear(),Ma.clear()}function Pa(e){if(0===Sa.size)return e;const t=function(e){const t=[];let r=null;for(let n=0;n<e.nodes.length;n++){const i=e.nodes[n];1&i.flags&&(r=i),r&&3840&i.flags&&Sa.has(i.provider.token)&&(t.push(r.nodeIndex),r=null)}return t}(e);if(0===t.length)return e;e=e.factory(()=>Zi);for(let n=0;n<t.length;n++)r(e,t[n]);return e;function r(e,t){for(let r=t+1;r<e.nodes.length;r++){const t=e.nodes[r];if(1&t.flags)return;if(3840&t.flags){const e=t.provider,r=Sa.get(e.token);r&&(t.flags=-3841&t.flags|r.flags,e.deps=xo(r.deps),e.value=r.value)}}}}function Oa(e,t,r,n,i,o,s,a,l,c,u,h,d){const p=e.def.nodes[t];return ia(e,p,r,n,i,o,s,a,l,c,u,h,d),224&p.flags?Hi(e,t).value:void 0}function Da(e,t,r,n,i,o,s,a,l,c,u,h,d){const p=e.def.nodes[t];return sa(e,p,r,n,i,o,s,a,l,c,u,h,d),224&p.flags?Hi(e,t).value:void 0}function Na(e){return Ka(Ra.detectChanges,na,null,[e])}function La(e){return Ka(Ra.checkNoChanges,ra,null,[e])}function Ia(e){return Ka(Ra.destroy,la,null,[e])}const Ra={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};let Fa,ka,Ua;function Ba(e,t){ka=e,Ua=t}function ja(e,t,r,n){return Ba(e,t),Ka(Ra.handleEvent,e.def.handleEvent,null,[e,t,r,n])}function za(e,t){if(128&e.state)throw Ji(Ra[Fa]);return Ba(e,Ya(e,0)),e.def.updateDirectives(function(e,r,n,...i){const o=e.def.nodes[r];0===t?Ga(e,o,n,i):Ha(e,o,n,i);16384&o.flags&&Ba(e,Ya(e,r));return 224&o.flags?Hi(e,o.nodeIndex).value:void 0},e)}function Va(e,t){if(128&e.state)throw Ji(Ra[Fa]);return Ba(e,Ja(e,0)),e.def.updateRenderer(function(e,r,n,...i){const o=e.def.nodes[r];0===t?Ga(e,o,n,i):Ha(e,o,n,i);3&o.flags&&Ba(e,Ja(e,r));return 224&o.flags?Hi(e,o.nodeIndex).value:void 0},e)}function Ga(e,t,r,n){if(ia(e,t,r,...n)){const i=1===r?n[0]:n;if(16384&t.flags){const r={};for(let e=0;e<t.bindings.length;e++){const n=t.bindings[e],o=i[e];8&n.flags&&(r[Wa(n.nonMinifiedName)]=qa(o))}const n=t.parent,o=Vi(e,n.nodeIndex).renderElement;if(n.element.name)for(let t in r){const n=r[t];null!=n?e.renderer.setAttribute(o,t,n):e.renderer.removeAttribute(o,t)}else e.renderer.setValue(o,`bindings=${JSON.stringify(r,null,2)}`)}}}function Ha(e,t,r,n){sa(e,t,r,...n)}function Wa(e){return`ng-reflect-${e=function(e){return e.replace(Xa,(...e)=>"-"+e[1].toLowerCase())}(e.replace(/[$@]/g,"_"))}`}Ra[Ra.create]="create",Ra[Ra.detectChanges]="detectChanges",Ra[Ra.checkNoChanges]="checkNoChanges",Ra[Ra.destroy]="destroy",Ra[Ra.handleEvent]="handleEvent";const Xa=/([A-Z])/g;function qa(e){try{return null!=e?e.toString().slice(0,30):e}catch(e){return"[ERROR] Exception while trying to serialize the value"}}function Ya(e,t){for(let r=t;r<e.def.nodes.length;r++){const t=e.def.nodes[r];if(16384&t.flags&&t.bindings&&t.bindings.length)return r}return null}function Ja(e,t){for(let r=t;r<e.def.nodes.length;r++){const t=e.def.nodes[r];if(3&t.flags&&t.bindings&&t.bindings.length)return r}return null}class Za{constructor(e,t){this.view=e,this.nodeIndex=t,null==t&&(this.nodeIndex=t=0),this.nodeDef=e.def.nodes[t];let r=this.nodeDef,n=e;for(;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&n;)r=ho(n),n=n.parent;this.elDef=r,this.elView=n}get elOrCompView(){return Vi(this.elView,this.elDef.nodeIndex).componentView||this.view}get injector(){return as(this.elView,this.elDef)}get component(){return this.elOrCompView.component}get context(){return this.elOrCompView.context}get providerTokens(){const e=[];if(this.elDef)for(let t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){const r=this.elView.def.nodes[t];20224&r.flags&&e.push(r.provider.token),t+=r.childCount}return e}get references(){const e={};if(this.elDef){Qa(this.elView,this.elDef,e);for(let t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){const r=this.elView.def.nodes[t];20224&r.flags&&Qa(this.elView,r,e),t+=r.childCount}}return e}get componentRenderElement(){const e=function(e){for(;e&&!mo(e);)e=e.parent;if(e.parent)return Vi(e.parent,ho(e).nodeIndex);return null}(this.elOrCompView);return e?e.renderElement:void 0}get renderNode(){return 2&this.nodeDef.flags?po(this.view,this.nodeDef):po(this.elView,this.elDef)}logError(e,...t){let r,n;2&this.nodeDef.flags?(r=this.view.def,n=this.nodeDef.nodeIndex):(r=this.elView.def,n=this.elDef.nodeIndex);const i=function(e,t){let r=-1;for(let n=0;n<=t;n++){const t=e.nodes[n];3&t.flags&&r++}return r}(r,n);let o=-1;r.factory(()=>++o===i?e.error.bind(e,...t):Zi),o<i&&(e.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),e.error(...t))}}function Qa(e,t,r){for(let n in t.references)r[n]=zs(e,t,t.references[n])}function Ka(e,t,r,n){const i=Fa,o=ka,s=Ua;try{Fa=e;const a=t.apply(r,n);return ka=o,Ua=s,Fa=i,a}catch(e){if(function(e){return!!Gt(e)}(e)||!ka)throw e;throw function(e,t){return e instanceof Error||(e=new Error(e.toString())),Yi(e,t),e}(e,$a())}}function $a(){return ka?new Za(ka,Ua):null}class el{constructor(e){this.delegate=e}createRenderer(e,t){return new tl(this.delegate.createRenderer(e,t))}begin(){this.delegate.begin&&this.delegate.begin()}end(){this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}class tl{constructor(e){this.delegate=e,this.data=this.delegate.data}destroyNode(e){!function(e){Ln.delete(e.nativeNode)}(In(e)),this.delegate.destroyNode&&this.delegate.destroyNode(e)}destroy(){this.delegate.destroy()}createElement(e,t){const r=this.delegate.createElement(e,t),n=$a();if(n){const t=new Nn(r,null,n);t.name=e,Rn(t)}return r}createComment(e){const t=this.delegate.createComment(e),r=$a();return r&&Rn(new Dn(t,null,r)),t}createText(e){const t=this.delegate.createText(e),r=$a();return r&&Rn(new Dn(t,null,r)),t}appendChild(e,t){const r=In(e),n=In(t);r&&n&&r instanceof Nn&&r.addChild(n),this.delegate.appendChild(e,t)}insertBefore(e,t,r){const n=In(e),i=In(t),o=In(r);n&&i&&n instanceof Nn&&n.insertBefore(o,i),this.delegate.insertBefore(e,t,r)}removeChild(e,t){const r=In(e),n=In(t);r&&n&&r instanceof Nn&&r.removeChild(n),this.delegate.removeChild(e,t)}selectRootElement(e){const t=this.delegate.selectRootElement(e),r=$a();return r&&Rn(new Nn(t,null,r)),t}setAttribute(e,t,r,n){const i=In(e);if(i&&i instanceof Nn){const e=n?n+":"+t:t;i.attributes[e]=r}this.delegate.setAttribute(e,t,r,n)}removeAttribute(e,t,r){const n=In(e);if(n&&n instanceof Nn){const e=r?r+":"+t:t;n.attributes[e]=null}this.delegate.removeAttribute(e,t,r)}addClass(e,t){const r=In(e);r&&r instanceof Nn&&(r.classes[t]=!0),this.delegate.addClass(e,t)}removeClass(e,t){const r=In(e);r&&r instanceof Nn&&(r.classes[t]=!1),this.delegate.removeClass(e,t)}setStyle(e,t,r,n){const i=In(e);i&&i instanceof Nn&&(i.styles[t]=r),this.delegate.setStyle(e,t,r,n)}removeStyle(e,t,r){const n=In(e);n&&n instanceof Nn&&(n.styles[t]=null),this.delegate.removeStyle(e,t,r)}setProperty(e,t,r){const n=In(e);n&&n instanceof Nn&&(n.properties[t]=r),this.delegate.setProperty(e,t,r)}listen(e,t,r){if("string"!=typeof e){const n=In(e);n&&n.listeners.push(new On(t,r))}return this.delegate.listen(e,t,r)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setValue(e,t){return this.delegate.setValue(e,t)}}class rl extends Ur{constructor(e,t,r){super(),this.moduleType=e,this._bootstrapComponents=t,this._ngModuleDefFactory=r}create(e){va();const t=_o(this._ngModuleDefFactory);return Xi.createNgModuleRef(this.moduleType,e||ut.NULL,this._bootstrapComponents,t)}}"undefined"==typeof ngDevMode&&("undefined"!=typeof window&&(window.ngDevMode=!0),"undefined"!=typeof self&&(self.ngDevMode=!0),"undefined"!=typeof global&&(global.ngDevMode=!0));const nl={Important:1,DashCase:2};nl[nl.Important]="Important",nl[nl.DashCase]="DashCase";Promise.resolve(null);class il{}function ol(e,t){var r=function(e){return"data-"+e.toString().replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()};Object.defineProperty(e,t,{set:function(e){e=e.toString(),this.setAttribute(r(t),e)},get:function(){return this.getAttribute(r(t))},enumerable:!0})}function sl(e,t){return{enumerable:!0,value:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this._instance?this._instance[t].apply(this._instance,e):(console.warn("ng2-facebook-sdk: tried calling instance method before component is ready."),null)}}}var al=function(){function e(e,t,r){this.el=e,this.rnd=t,this.fbClass=r,this.nativeElement=this.el.nativeElement,this.rnd.setElementClass(this.nativeElement,this.fbClass,!0)}return e.prototype.setAttribute=function(e,t){e&&t&&this.rnd.setElementAttribute(this.nativeElement,e,t)},e.prototype.getAttribute=function(e){if(e)return this.nativeElement.getAttribute(e)},e}(),ll=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),cl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},ul=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},hl=function(e){function t(t,r){return e.call(this,t,r,"fb-comment-embed")||this}return ll(t,e),t}(al);hl.decorators=[{type:Ce,args:[{selector:"fb-comment-embed",template:""}]}],hl.ctorParameters=function(){return[{type:yn},{type:fn}]},hl.propDecorators={href:[{type:Oe}],width:[{type:Oe}],includeParent:[{type:Oe}]},cl([ol,ul("design:type",String)],hl.prototype,"href",void 0),cl([ol,ul("design:type",String)],hl.prototype,"width",void 0),cl([ol,ul("design:type",Boolean)],hl.prototype,"includeParent",void 0);var dl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},fl=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ml=function(e){function t(t,r){var n=e.call(this,t,r,"fb-comments")||this;return n.href=window.location.href,n}return dl(t,e),t}(al);ml.decorators=[{type:Ce,args:[{selector:"fb-comments",template:""}]}],ml.ctorParameters=function(){return[{type:yn},{type:fn}]},ml.propDecorators={colorscheme:[{type:Oe}],href:[{type:Oe}],mobile:[{type:Oe}],numposts:[{type:Oe}],orderBy:[{type:Oe}],width:[{type:Oe}]},pl([ol,fl("design:type",String)],ml.prototype,"colorscheme",void 0),pl([ol,fl("design:type",String)],ml.prototype,"href",void 0),pl([ol,fl("design:type",Boolean)],ml.prototype,"mobile",void 0),pl([ol,fl("design:type",Number)],ml.prototype,"numposts",void 0),pl([ol,fl("design:type",String)],ml.prototype,"orderBy",void 0),pl([ol,fl("design:type",String)],ml.prototype,"width",void 0);var vl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},yl=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},xl=function(e){function t(t,r){return e.call(this,t,r,"fb-follow")||this}return vl(t,e),t}(al);xl.decorators=[{type:Ce,args:[{selector:"fb-follow",template:""}]}],xl.ctorParameters=function(){return[{type:yn},{type:fn}]},xl.propDecorators={colorScheme:[{type:Oe}],href:[{type:Oe}],kidDirectedSite:[{type:Oe}],layout:[{type:Oe}],showFaces:[{type:Oe}],size:[{type:Oe}],width:[{type:Oe}]},gl([ol,yl("design:type",String)],xl.prototype,"colorScheme",void 0),gl([ol,yl("design:type",String)],xl.prototype,"href",void 0),gl([ol,yl("design:type",Boolean)],xl.prototype,"kidDirectedSite",void 0),gl([ol,yl("design:type",String)],xl.prototype,"layout",void 0),gl([ol,yl("design:type",String)],xl.prototype,"showFaces",void 0),gl([ol,yl("design:type",String)],xl.prototype,"size",void 0),gl([ol,yl("design:type",String)],xl.prototype,"width",void 0);var bl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},_l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Sl=function(e){function t(t,r){var n=e.call(this,t,r,"fb-like")||this;return n.href=window.location.href,n}return bl(t,e),t}(al);Sl.decorators=[{type:Ce,args:[{selector:"fb-like",template:""}]}],Sl.ctorParameters=function(){return[{type:yn},{type:fn}]},Sl.propDecorators={action:[{type:Oe}],colorScheme:[{type:Oe}],href:[{type:Oe}],kidDirectedSite:[{type:Oe}],layout:[{type:Oe}],ref:[{type:Oe}],share:[{type:Oe}],showFaces:[{type:Oe}],size:[{type:Oe}],width:[{type:Oe}]},wl([ol,_l("design:type",String)],Sl.prototype,"action",void 0),wl([ol,_l("design:type",String)],Sl.prototype,"colorScheme",void 0),wl([ol,_l("design:type",String)],Sl.prototype,"href",void 0),wl([ol,_l("design:type",Boolean)],Sl.prototype,"kidDirectedSite",void 0),wl([ol,_l("design:type",String)],Sl.prototype,"layout",void 0),wl([ol,_l("design:type",String)],Sl.prototype,"ref",void 0),wl([ol,_l("design:type",Boolean)],Sl.prototype,"share",void 0),wl([ol,_l("design:type",Boolean)],Sl.prototype,"showFaces",void 0),wl([ol,_l("design:type",String)],Sl.prototype,"size",void 0),wl([ol,_l("design:type",String)],Sl.prototype,"width",void 0);var Tl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ml=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},Al=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},El=function(e){function t(t,r){return e.call(this,t,r,"fb-page")||this}return Tl(t,e),t}(al);El.decorators=[{type:Ce,args:[{selector:"fb-page",template:""}]}],El.ctorParameters=function(){return[{type:yn},{type:fn}]},El.propDecorators={href:[{type:Oe}],width:[{type:Oe}],height:[{type:Oe}],tabs:[{type:Oe}],hideCover:[{type:Oe}],showFacepile:[{type:Oe}],hideCTA:[{type:Oe}],smallHeader:[{type:Oe}],adaptContainerWidth:[{type:Oe}]},Ml([ol,Al("design:type",String)],El.prototype,"href",void 0),Ml([ol,Al("design:type",Number)],El.prototype,"width",void 0),Ml([ol,Al("design:type",Number)],El.prototype,"height",void 0),Ml([ol,Al("design:type",String)],El.prototype,"tabs",void 0),Ml([ol,Al("design:type",Boolean)],El.prototype,"hideCover",void 0),Ml([ol,Al("design:type",Boolean)],El.prototype,"showFacepile",void 0),Ml([ol,Al("design:type",Boolean)],El.prototype,"hideCTA",void 0),Ml([ol,Al("design:type",Boolean)],El.prototype,"smallHeader",void 0),Ml([ol,Al("design:type",Boolean)],El.prototype,"adaptContainerWidth",void 0);var Cl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},Ol=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Dl=function(e){function t(t,r){return e.call(this,t,r,"fb-post")||this}return Cl(t,e),t}(al);Dl.decorators=[{type:Ce,args:[{selector:"fb-post",template:""}]}],Dl.ctorParameters=function(){return[{type:yn},{type:fn}]},Dl.propDecorators={href:[{type:Oe}],width:[{type:Oe}],showText:[{type:Oe}]},Pl([ol,Ol("design:type",String)],Dl.prototype,"href",void 0),Pl([ol,Ol("design:type",String)],Dl.prototype,"width",void 0),Pl([ol,Ol("design:type",Boolean)],Dl.prototype,"showText",void 0);var Nl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ll=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},Il=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Rl=function(e){function t(t,r){return e.call(this,t,r,"fb-quote")||this}return Nl(t,e),t}(al);Rl.decorators=[{type:Ce,args:[{selector:"fb-quote",template:""}]}],Rl.ctorParameters=function(){return[{type:yn},{type:fn}]},Rl.propDecorators={href:[{type:Oe}],layout:[{type:Oe}]},Ll([ol,Il("design:type",String)],Rl.prototype,"href",void 0),Ll([ol,Il("design:type",String)],Rl.prototype,"layout",void 0);var Fl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),kl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},Ul=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Bl=function(e){function t(t,r){var n=e.call(this,t,r,"fb-save")||this;return n.uri=window.location.href,n}return Fl(t,e),t}(al);Bl.decorators=[{type:Ce,args:[{selector:"fb-save",template:""}]}],Bl.ctorParameters=function(){return[{type:yn},{type:fn}]},Bl.propDecorators={uri:[{type:Oe}]},kl([ol,Ul("design:type",String)],Bl.prototype,"uri",void 0);var jl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),zl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},Vl=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Gl=function(e){function t(t,r){var n=e.call(this,t,r,"fb-send")||this;return n.href=window.location.href,n}return jl(t,e),t}(al);Gl.decorators=[{type:Ce,args:[{selector:"fb-send",template:""}]}],Gl.ctorParameters=function(){return[{type:yn},{type:fn}]},Gl.propDecorators={colorScheme:[{type:Oe}],href:[{type:Oe}],kidDirectedSite:[{type:Oe}],ref:[{type:Oe}],size:[{type:Oe}]},zl([ol,Vl("design:type",String)],Gl.prototype,"colorScheme",void 0),zl([ol,Vl("design:type",String)],Gl.prototype,"href",void 0),zl([ol,Vl("design:type",Boolean)],Gl.prototype,"kidDirectedSite",void 0),zl([ol,Vl("design:type",String)],Gl.prototype,"ref",void 0),zl([ol,Vl("design:type",String)],Gl.prototype,"size",void 0);var Hl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},Xl=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ql=function(e){function t(t,r){return e.call(this,t,r,"fb-share-button")||this}return Hl(t,e),t}(al);ql.decorators=[{type:Ce,args:[{selector:"fb-share",template:""}]}],ql.ctorParameters=function(){return[{type:yn},{type:fn}]},ql.propDecorators={href:[{type:Oe}],layout:[{type:Oe}],mobileIframe:[{type:Oe}],size:[{type:Oe}]},Wl([ol,Xl("design:type",String)],ql.prototype,"href",void 0),Wl([ol,Xl("design:type",String)],ql.prototype,"layout",void 0),Wl([ol,Xl("design:type",Boolean)],ql.prototype,"mobileIframe",void 0),Wl([ol,Xl("design:type",String)],ql.prototype,"size",void 0);var Yl=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jl=function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},Zl=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ql=function(e){function t(t,r){var n=e.call(this,t,r,"fb-video")||this;return n.startedPlaying=new Hr,n.paused=new Hr,n.finishedPlaying=new Hr,n.startedBuffering=new Hr,n.finishedBuffering=new Hr,n.error=new Hr,n._listeners=[],n.nativeElement.id=n._id="video-"+String(Math.floor(1e4*Math.random()+1)),n}return Yl(t,e),t.prototype.ngOnInit=function(){var e=this;FB.Event.subscribe("xfbml.ready",function(t){"video"===t.type&&t.id===e._id&&(e._instance=t.instance,e._listeners.push(e._instance.subscribe("startedPlaying",function(t){return e.startedPlaying.emit(t)}),e._instance.subscribe("paused",function(t){return e.paused.emit(t)}),e._instance.subscribe("finishedPlaying",function(t){return e.finishedPlaying.emit(t)}),e._instance.subscribe("startedBuffering",function(t){return e.startedBuffering.emit(t)}),e._instance.subscribe("finishedBuffering",function(t){return e.finishedBuffering.emit(t)}),e._instance.subscribe("error",function(t){return e.error.emit(t)})))})},t.prototype.ngOnDestroy=function(){this._listeners.forEach(function(e){"function"==typeof e.release&&e.release()})},t.prototype.play=function(){},t.prototype.pause=function(){},t.prototype.seek=function(e){},t.prototype.mute=function(){},t.prototype.unmute=function(){},t.prototype.isMuted=function(){},t.prototype.setVolume=function(e){},t.prototype.getVolume=function(){},t.prototype.getCurrentPosition=function(){},t.prototype.getDuration=function(){},t}(al);Ql.decorators=[{type:Ce,args:[{selector:"fb-video",template:""}]}],Ql.ctorParameters=function(){return[{type:yn},{type:fn}]},Ql.propDecorators={href:[{type:Oe}],allowfullscreen:[{type:Oe}],autoplay:[{type:Oe}],width:[{type:Oe}],showText:[{type:Oe}],showCaptions:[{type:Oe}],startedPlaying:[{type:De}],paused:[{type:De}],finishedPlaying:[{type:De}],startedBuffering:[{type:De}],finishedBuffering:[{type:De}],error:[{type:De}]},Jl([ol,Zl("design:type",String)],Ql.prototype,"href",void 0),Jl([ol,Zl("design:type",Boolean)],Ql.prototype,"allowfullscreen",void 0),Jl([ol,Zl("design:type",Boolean)],Ql.prototype,"autoplay",void 0),Jl([ol,Zl("design:type",String)],Ql.prototype,"width",void 0),Jl([ol,Zl("design:type",Boolean)],Ql.prototype,"showText",void 0),Jl([ol,Zl("design:type",Boolean)],Ql.prototype,"showCaptions",void 0),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",void 0)],Ql.prototype,"play",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",void 0)],Ql.prototype,"pause",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[Number]),Zl("design:returntype",void 0)],Ql.prototype,"seek",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",void 0)],Ql.prototype,"mute",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",void 0)],Ql.prototype,"unmute",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",Boolean)],Ql.prototype,"isMuted",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[Number]),Zl("design:returntype",void 0)],Ql.prototype,"setVolume",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",Number)],Ql.prototype,"getVolume",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",void 0)],Ql.prototype,"getCurrentPosition",null),Jl([sl,Zl("design:type",Function),Zl("design:paramtypes",[]),Zl("design:returntype",void 0)],Ql.prototype,"getDuration",null);var Kl=function(){function e(){}return e.prototype.init=function(e){try{return Promise.resolve(FB.init(e))}catch(e){return Promise.reject(e)}},e.prototype.api=function(e,t,r){return void 0===t&&(t="get"),void 0===r&&(r={}),new Promise(function(n,i){try{FB.api(e,t,r,function(e){e?e.error?i(e.error):n(e):i()})}catch(e){i(e)}})},e.prototype.ui=function(e){return new Promise(function(t,r){try{FB.ui(e,function(e){e?e.error?r(e.error):t(e):r()})}catch(e){r(e)}})},e.prototype.getLoginStatus=function(){return new Promise(function(e,t){try{FB.getLoginStatus(function(r){r?e(r):t()})}catch(e){t(e)}})},e.prototype.login=function(e){return new Promise(function(t,r){try{FB.login(function(e){e.authResponse?t(e):r()},e)}catch(e){r(e)}})},e.prototype.logout=function(){return new Promise(function(e,t){try{FB.logout(function(t){e(t)})}catch(e){t(e)}})},e.prototype.getAuthResponse=function(){try{return FB.getAuthResponse()}catch(e){console.error("ng2-facebook-sdk: ",e)}},e}();Kl.decorators=[{type:Rt}],Kl.ctorParameters=function(){return[]};var $l=[hl,ml,xl,Sl,El,Dl,Rl,Bl,Gl,ql,Ql];function ec(){return $l}var tc=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[Kl]}},e}();tc.decorators=[{type:Ft,args:[{declarations:ec(),exports:ec()}]}],tc.ctorParameters=function(){return[]};class rc{constructor(e){this.fb=e;e.init({appId:"396487237479561",xfbml:!0,version:"v2.8"})}}function nc(e,t){return new M(t?r=>t.schedule(ic,0,{error:e,subscriber:r}):t=>t.error(e))}function ic({error:e,subscriber:t}){t.error(e)}function oc(e){return function(t){const r=new sc(e),n=t.lift(r);return r.caught=n}}class sc{constructor(e){this.selector=e}call(e,t){return t.subscribe(new ac(e,this.selector,this.caught))}}class ac extends G{constructor(e,t,r){super(e),this.selector=t,this.caught=r}error(e){if(!this.isStopped){let t;try{t=this.selector(e,this.caught)}catch(e){return void super.error(e)}this._unsubscribeAndRecycle(),this.add(V(this,t))}}}const lc=new M(e=>e.complete());function cc(e){return e?function(e){return new M(t=>e.schedule(()=>t.complete()))}(e):lc}function uc(e){const t=new M(t=>{t.next(e),t.complete()});return t._isScalar=!0,t.value=e,t}function hc(...e){let t=e[e.length-1];switch(N(t)?e.pop():t=void 0,e.length){case 0:return cc(t);case 1:return t?q(e,t):uc(e[0]);default:return q(e,t)}}function dc(e,t){return function(r){return r.lift(new pc(e,t))}}class pc{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new fc(e,this.predicate,this.thisArg))}}class fc extends x{constructor(e,t,r){super(e),this.predicate=t,this.thisArg=r,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)}}function mc(e,t){return J(e,t,1)}class vc{}const gc=new pe("Location Initialized");class yc{}const xc=new pe("appBaseHref");class bc{constructor(e){this._subject=new Hr,this._platformStrategy=e;const t=this._platformStrategy.getBaseHref();this._baseHref=bc.stripTrailingSlash(wc(t)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+bc.normalizeQueryParams(t))}normalize(e){return bc.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,wc(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",r=null){this._platformStrategy.pushState(r,"",e,t)}replaceState(e,t="",r=null){this._platformStrategy.replaceState(r,"",e,t)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}subscribe(e,t,r){return this._subject.subscribe({next:e,error:t,complete:r})}static normalizeQueryParams(e){return e&&"?"!==e[0]?"?"+e:e}static joinWithSlash(e,t){if(0==e.length)return t;if(0==t.length)return e;let r=0;return e.endsWith("/")&&r++,t.startsWith("/")&&r++,2==r?e+t.substring(1):1==r?e+t:e+"/"+t}static stripTrailingSlash(e){const t=e.match(/#|\?|$/),r=t&&t.index||e.length,n=r-("/"===e[r-1]?1:0);return e.slice(0,n)+e.slice(r)}}function wc(e){return e.replace(/\/index.html$/,"")}bc.decorators=[{type:Rt}],bc.ctorParameters=(()=>[{type:yc}]);class _c extends yc{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",null!=t&&(this._baseHref=t)}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=bc.joinWithSlash(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,r,n){let i=this.prepareExternalUrl(r+bc.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,r,n){let i=this.prepareExternalUrl(r+bc.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}_c.decorators=[{type:Rt}],_c.ctorParameters=(()=>[{type:vc},{type:void 0,decorators:[{type:tt},{type:et,args:[xc]}]}]);class Sc extends yc{constructor(e,t){if(super(),this._platformLocation=e,null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return bc.joinWithSlash(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+bc.normalizeQueryParams(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${t}${r}`:t}pushState(e,t,r,n){const i=this.prepareExternalUrl(r+bc.normalizeQueryParams(n));this._platformLocation.pushState(e,t,i)}replaceState(e,t,r,n){const i=this.prepareExternalUrl(r+bc.normalizeQueryParams(n));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}Sc.decorators=[{type:Rt}],Sc.ctorParameters=(()=>[{type:vc},{type:void 0,decorators:[{type:tt},{type:et,args:[xc]}]}]);const Tc=void 0;var Mc=["en",[["a","p"],["AM","PM"],Tc],[["AM","PM"],Tc,Tc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Tc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Tc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Tc,"{1} 'at' {0}",Tc],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(e){let t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}];const Ac={};const Ec={ADP:[void 0,void 0,0],AFN:[void 0,void 0,0],ALL:[void 0,void 0,0],AMD:[void 0,void 0,0],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09f3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,"\u0440.",2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xa5","\xa5"],COP:[void 0,"$",0],CRC:[void 0,"\u20a1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010d",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xa3"],ESP:[void 0,"\u20a7",0],EUR:["\u20ac"],FJD:[void 0,"$"],FKP:[void 0,"\xa3"],GBP:["\xa3"],GEL:[void 0,"\u20be"],GIP:[void 0,"\xa3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",0],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",0],ILS:["\u20aa"],INR:["\u20b9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xa5",void 0,0],KHR:[void 0,"\u17db"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20a9",0],KRW:["\u20a9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20b8"],LAK:[void 0,"\u20ad",0],LBP:[void 0,"L\xa3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20ae",0],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",0],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20a6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:[void 0,"\u20b1"],PKR:[void 0,"Rs",0],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20b2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20bd"],RUR:[void 0,"\u0440."],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xa3"],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xa3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xa3",0],THB:[void 0,"\u0e3f"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20ba"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,0],UAH:[void 0,"\u20b4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UZS:[void 0,void 0,0],VEF:[void 0,"Bs"],VND:["\u20ab",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["CFA",void 0,0],XPF:["CFPF",void 0,0],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]},Cc={Decimal:0,Percent:1,Currency:2,Scientific:3};Cc[Cc.Decimal]="Decimal",Cc[Cc.Percent]="Percent",Cc[Cc.Currency]="Currency",Cc[Cc.Scientific]="Scientific";const Pc={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};Pc[Pc.Zero]="Zero",Pc[Pc.One]="One",Pc[Pc.Two]="Two",Pc[Pc.Few]="Few",Pc[Pc.Many]="Many",Pc[Pc.Other]="Other";const Oc={Format:0,Standalone:1};Oc[Oc.Format]="Format",Oc[Oc.Standalone]="Standalone";const Dc={Narrow:0,Abbreviated:1,Wide:2,Short:3};Dc[Dc.Narrow]="Narrow",Dc[Dc.Abbreviated]="Abbreviated",Dc[Dc.Wide]="Wide",Dc[Dc.Short]="Short";const Nc={Short:0,Medium:1,Long:2,Full:3};Nc[Nc.Short]="Short",Nc[Nc.Medium]="Medium",Nc[Nc.Long]="Long",Nc[Nc.Full]="Full";const Lc={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};Lc[Lc.Decimal]="Decimal",Lc[Lc.Group]="Group",Lc[Lc.List]="List",Lc[Lc.PercentSign]="PercentSign",Lc[Lc.PlusSign]="PlusSign",Lc[Lc.MinusSign]="MinusSign",Lc[Lc.Exponential]="Exponential",Lc[Lc.SuperscriptingExponent]="SuperscriptingExponent",Lc[Lc.PerMille]="PerMille",Lc[Lc.Infinity]="Infinity",Lc[Lc.NaN]="NaN",Lc[Lc.TimeSeparator]="TimeSeparator",Lc[Lc.CurrencyDecimal]="CurrencyDecimal",Lc[Lc.CurrencyGroup]="CurrencyGroup";const Ic={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};function Rc(e,t){return zc(Gc(e)[10],t)}function Fc(e,t){return zc(Gc(e)[11],t)}function kc(e,t){return zc(Gc(e)[12],t)}function Uc(e,t){const r=Gc(e),n=r[13][t];if(void 0===n){if(t===Lc.CurrencyDecimal)return r[13][Lc.Decimal];if(t===Lc.CurrencyGroup)return r[13][Lc.Group]}return n}function Bc(e,t){return Gc(e)[14][t]}function jc(e){if(!e[19])throw new Error(`Missing extra locale data for the locale "${e[0]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function zc(e,t){for(let r=t;r>-1;r--)if(void 0!==e[r])return e[r];throw new Error("Locale data API: locale data undefined")}function Vc(e){const[t,r]=e.split(":");return{hours:+t,minutes:+r}}function Gc(e){const t=e.toLowerCase().replace(/_/g,"-");let r=Ac[t];if(r)return r;const n=t.split("-")[0];if(r=Ac[n])return r;if("en"===n)return Mc;throw new Error(`Missing locale data for the locale "${e}".`)}function Hc(e,t,r="en"){const n=function(e){return Gc(e)[17]}(r)[e]||Ec[e]||[],i=n[1];return"narrow"===t&&"string"==typeof i?i:n[0]||e}Ic[Ic.Sunday]="Sunday",Ic[Ic.Monday]="Monday",Ic[Ic.Tuesday]="Tuesday",Ic[Ic.Wednesday]="Wednesday",Ic[Ic.Thursday]="Thursday",Ic[Ic.Friday]="Friday",Ic[Ic.Saturday]="Saturday";const Wc=2;const Xc=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,qc={},Yc=/((?:[^GyMLwWdEabBhHmsSzZO']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/,Jc={Short:0,ShortGMT:1,Long:2,Extended:3};Jc[Jc.Short]="Short",Jc[Jc.ShortGMT]="ShortGMT",Jc[Jc.Long]="Long",Jc[Jc.Extended]="Extended";const Zc={FullYear:0,Month:1,Date:2,Hours:3,Minutes:4,Seconds:5,Milliseconds:6,Day:7};Zc[Zc.FullYear]="FullYear",Zc[Zc.Month]="Month",Zc[Zc.Date]="Date",Zc[Zc.Hours]="Hours",Zc[Zc.Minutes]="Minutes",Zc[Zc.Seconds]="Seconds",Zc[Zc.Milliseconds]="Milliseconds",Zc[Zc.Day]="Day";const Qc={DayPeriods:0,Days:1,Months:2,Eras:3};function Kc(e,t,r,n){let i=function(e){if(uu(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){e=e.trim();const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);if(/^(\d{4}-\d{1,2}-\d{1,2})$/.test(e)){const[t,r,n]=e.split("-").map(e=>+e);return new Date(t,r-1,n)}let r;if(r=e.match(Xc))return cu(r)}const t=new Date(e);if(!uu(t))throw new Error(`Unable to convert "${e}" into a date`);return t}(e);t=function e(t,r){const n=function(e){return Gc(e)[0]}(t);qc[n]=qc[n]||{};if(qc[n][r])return qc[n][r];let i="";switch(r){case"shortDate":i=Rc(t,Nc.Short);break;case"mediumDate":i=Rc(t,Nc.Medium);break;case"longDate":i=Rc(t,Nc.Long);break;case"fullDate":i=Rc(t,Nc.Full);break;case"shortTime":i=Fc(t,Nc.Short);break;case"mediumTime":i=Fc(t,Nc.Medium);break;case"longTime":i=Fc(t,Nc.Long);break;case"fullTime":i=Fc(t,Nc.Full);break;case"short":const n=e(t,"shortTime"),o=e(t,"shortDate");i=$c(kc(t,Nc.Short),[n,o]);break;case"medium":const s=e(t,"mediumTime"),a=e(t,"mediumDate");i=$c(kc(t,Nc.Medium),[s,a]);break;case"long":const l=e(t,"longTime"),c=e(t,"longDate");i=$c(kc(t,Nc.Long),[l,c]);break;case"full":const u=e(t,"fullTime"),h=e(t,"fullDate");i=$c(kc(t,Nc.Full),[u,h])}i&&(qc[n][r]=i);return i}(r,t)||t;let o,s=[];for(;t;){if(!(o=Yc.exec(t))){s.push(t);break}{const e=(s=s.concat(o.slice(1))).pop();if(!e)break;t=e}}let a=i.getTimezoneOffset();n&&(a=lu(n,a),i=function(e,t,r){const n=r?-1:1,i=e.getTimezoneOffset(),o=lu(t,i);return function(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,n*(o-i))}(i,n,!0));let l="";return s.forEach(e=>{const t=function(e){if(au[e])return au[e];let t;switch(e){case"G":case"GG":case"GGG":t=ru(Qc.Eras,Dc.Abbreviated);break;case"GGGG":t=ru(Qc.Eras,Dc.Wide);break;case"GGGGG":t=ru(Qc.Eras,Dc.Narrow);break;case"y":t=tu(Zc.FullYear,1,0,!1,!0);break;case"yy":t=tu(Zc.FullYear,2,0,!0,!0);break;case"yyy":t=tu(Zc.FullYear,3,0,!1,!0);break;case"yyyy":t=tu(Zc.FullYear,4,0,!1,!0);break;case"M":case"L":t=tu(Zc.Month,1,1);break;case"MM":case"LL":t=tu(Zc.Month,2,1);break;case"MMM":t=ru(Qc.Months,Dc.Abbreviated);break;case"MMMM":t=ru(Qc.Months,Dc.Wide);break;case"MMMMM":t=ru(Qc.Months,Dc.Narrow);break;case"LLL":t=ru(Qc.Months,Dc.Abbreviated,Oc.Standalone);break;case"LLLL":t=ru(Qc.Months,Dc.Wide,Oc.Standalone);break;case"LLLLL":t=ru(Qc.Months,Dc.Narrow,Oc.Standalone);break;case"w":t=su(1);break;case"ww":t=su(2);break;case"W":t=su(1,!0);break;case"d":t=tu(Zc.Date,1);break;case"dd":t=tu(Zc.Date,2);break;case"E":case"EE":case"EEE":t=ru(Qc.Days,Dc.Abbreviated);break;case"EEEE":t=ru(Qc.Days,Dc.Wide);break;case"EEEEE":t=ru(Qc.Days,Dc.Narrow);break;case"EEEEEE":t=ru(Qc.Days,Dc.Short);break;case"a":case"aa":case"aaa":t=ru(Qc.DayPeriods,Dc.Abbreviated);break;case"aaaa":t=ru(Qc.DayPeriods,Dc.Wide);break;case"aaaaa":t=ru(Qc.DayPeriods,Dc.Narrow);break;case"b":case"bb":case"bbb":t=ru(Qc.DayPeriods,Dc.Abbreviated,Oc.Standalone,!0);break;case"bbbb":t=ru(Qc.DayPeriods,Dc.Wide,Oc.Standalone,!0);break;case"bbbbb":t=ru(Qc.DayPeriods,Dc.Narrow,Oc.Standalone,!0);break;case"B":case"BB":case"BBB":t=ru(Qc.DayPeriods,Dc.Abbreviated,Oc.Format,!0);break;case"BBBB":t=ru(Qc.DayPeriods,Dc.Wide,Oc.Format,!0);break;case"BBBBB":t=ru(Qc.DayPeriods,Dc.Narrow,Oc.Format,!0);break;case"h":t=tu(Zc.Hours,1,-12);break;case"hh":t=tu(Zc.Hours,2,-12);break;case"H":t=tu(Zc.Hours,1);break;case"HH":t=tu(Zc.Hours,2);break;case"m":t=tu(Zc.Minutes,1);break;case"mm":t=tu(Zc.Minutes,2);break;case"s":t=tu(Zc.Seconds,1);break;case"ss":t=tu(Zc.Seconds,2);break;case"S":t=tu(Zc.Milliseconds,1);break;case"SS":t=tu(Zc.Milliseconds,2);break;case"SSS":t=tu(Zc.Milliseconds,3);break;case"Z":case"ZZ":case"ZZZ":t=nu(Jc.Short);break;case"ZZZZZ":t=nu(Jc.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=nu(Jc.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=nu(Jc.Long);break;default:return null}return au[e]=t,t}(e);l+=t?t(i,r,a):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function $c(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(e,r){return null!=t&&r in t?t[r]:e})),e}function eu(e,t,r="-",n,i){let o="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,o=r));let s=String(e);for(;s.length<t;)s="0"+s;return n&&(s=s.substr(s.length-t)),o+s}function tu(e,t,r=0,n=!1,i=!1){return function(o,s){let a=function(e,t,r){switch(e){case Zc.FullYear:return t.getFullYear();case Zc.Month:return t.getMonth();case Zc.Date:return t.getDate();case Zc.Hours:return t.getHours();case Zc.Minutes:return t.getMinutes();case Zc.Seconds:return t.getSeconds();case Zc.Milliseconds:const n=1===r?100:2===r?10:1;return Math.round(t.getMilliseconds()/n);case Zc.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,o,t);return(r>0||a>-r)&&(a+=r),e===Zc.Hours&&0===a&&-12===r&&(a=12),eu(a,t,Uc(s,Lc.MinusSign),n,i)}}function ru(e,t,r=Oc.Format,n=!1){return function(i,o){return function(e,t,r,n,i,o){switch(r){case Qc.Months:return function(e,t,r){const n=Gc(e);return zc(zc([n[5],n[6]],t),r)}(t,i,n)[e.getMonth()];case Qc.Days:return function(e,t,r){const n=Gc(e);return zc(zc([n[3],n[4]],t),r)}(t,i,n)[e.getDay()];case Qc.DayPeriods:const s=e.getHours(),a=e.getMinutes();if(o){const e=function(e){const t=Gc(e);return jc(t),(t[19][2]||[]).map(e=>"string"==typeof e?Vc(e):[Vc(e[0]),Vc(e[1])])}(t),r=function(e,t,r){const n=Gc(e);return jc(n),zc(zc([n[19][0],n[19][1]],t)||[],r)||[]}(t,i,n);let o;if(e.forEach((e,t)=>{if(Array.isArray(e)){const{hours:n,minutes:i}=e[0],{hours:l,minutes:c}=e[1];s>=n&&a>=i&&(s<l||s===l&&a<c)&&(o=r[t])}else{const{hours:n,minutes:i}=e;n===s&&i===a&&(o=r[t])}}),o)return o}return function(e,t,r){const n=Gc(e);return zc(zc([n[1],n[2]],t),r)}(t,i,n)[s<12?0:1];case Qc.Eras:return function(e,t){return zc(Gc(e)[7],t)}(t,n)[e.getFullYear()<=0?0:1];default:const l=r;throw new Error(`unexpected translation type ${l}`)}}(i,o,e,t,r,n)}}function nu(e){return function(t,r,n){const i=-1*n,o=Uc(r,Lc.MinusSign),s=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case Jc.Short:return(i>=0?"+":"")+eu(s,2,o)+eu(Math.abs(i%60),2,o);case Jc.ShortGMT:return"GMT"+(i>=0?"+":"")+eu(s,1,o);case Jc.Long:return"GMT"+(i>=0?"+":"")+eu(s,2,o)+":"+eu(Math.abs(i%60),2,o);case Jc.Extended:return 0===n?"Z":(i>=0?"+":"")+eu(s,2,o)+":"+eu(Math.abs(i%60),2,o);default:throw new Error(`Unknown zone width "${e}"`)}}}Qc[Qc.DayPeriods]="DayPeriods",Qc[Qc.Days]="Days",Qc[Qc.Months]="Months",Qc[Qc.Eras]="Eras";const iu=0,ou=4;function su(e,t=!1){return function(r,n){let i;if(t){const e=new Date(r.getFullYear(),r.getMonth(),1).getDay()-1,t=r.getDate();i=1+Math.floor((t+e)/7)}else{const e=function(e){const t=new Date(e,iu,1).getDay();return new Date(e,0,1+(t<=ou?ou:ou+7)-t)}(r.getFullYear()),t=function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+(ou-e.getDay()))}(r).getTime()-e.getTime();i=1+Math.round(t/6048e5)}return eu(i,e,Uc(n,Lc.MinusSign))}}const au={};function lu(e,t){e=e.replace(/:/g,"");const r=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(r)?t:r}function cu(e){const t=new Date(0);let r=0,n=0;const i=e[8]?t.setUTCFullYear:t.setFullYear,o=e[8]?t.setUTCHours:t.setHours;e[9]&&(r=Number(e[9]+e[10]),n=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));const s=Number(e[4]||0)-r,a=Number(e[5]||0)-n,l=Number(e[6]||0),c=Math.round(1e3*parseFloat("0."+(e[7]||0)));return o.call(t,s,a,l,c),t}function uu(e){return e instanceof Date&&!isNaN(e.valueOf())}const hu=/^(\d+)?\.((\d+)(-(\d+))?)?$/,du=22,pu=".",fu="0",mu=";",vu=",",gu="#",yu="\xa4",xu="%";function bu(e,t,r,n,i,o,s=!1){let a="",l=!1;if(isFinite(e)){let c=function(e){let t,r,n,i,o,s=Math.abs(e)+"",a=0;(r=s.indexOf(pu))>-1&&(s=s.replace(pu,""));(n=s.search(/e/i))>0?(r<0&&(r=n),r+=+s.slice(n+1),s=s.substring(0,n)):r<0&&(r=s.length);for(n=0;s.charAt(n)===fu;n++);if(n===(o=s.length))t=[0],r=1;else{for(o--;s.charAt(o)===fu;)o--;for(r-=n,t=[],i=0;n<=o;n++,i++)t[i]=Number(s.charAt(n))}r>du&&(t=t.splice(0,du-1),a=r-1,r=1);return{digits:t,exponent:a,integerLen:r}}(e);s&&(c=function(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2);return e}(c));let u=t.minInt,h=t.minFrac,d=t.maxFrac;if(o){const e=o.match(hu);if(null===e)throw new Error(`${o} is not a valid digit info`);const t=e[1],r=e[3],n=e[5];null!=t&&(u=Su(t)),null!=r&&(h=Su(r)),null!=n?d=Su(n):null!=r&&h>d&&(d=h)}!function(e,t,r){if(t>r)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${r}).`);let n=e.digits,i=n.length-e.integerLen;const o=Math.min(Math.max(t,i),r);let s=o+e.integerLen,a=n[s];if(s>0){n.splice(Math.max(e.integerLen,s));for(let e=s;e<n.length;e++)n[e]=0}else{i=Math.max(0,i),e.integerLen=1,n.length=Math.max(1,s=o+1),n[0]=0;for(let e=1;e<s;e++)n[e]=0}if(a>=5)if(s-1<0){for(let t=0;t>s;t--)n.unshift(0),e.integerLen++;n.unshift(1),e.integerLen++}else n[s-1]++;for(;i<Math.max(0,o);i++)n.push(0);let l=0!==o;const c=t+e.integerLen,u=n.reduceRight(function(e,t,r,n){return t+=e,n[r]=t<10?t:t-10,l&&(0===n[r]&&r>=c?n.pop():l=!1),t>=10?1:0},0);u&&(n.unshift(u),e.integerLen++)}(c,h,d);let p=c.digits,f=c.integerLen;const m=c.exponent;let v=[];for(l=p.every(e=>!e);f<u;f++)p.unshift(0);for(;f<0;f++)p.unshift(0);f>0?v=p.splice(f,p.length):(v=p,p=[0]);const g=[];for(p.length>=t.lgSize&&g.unshift(p.splice(-t.lgSize,p.length).join(""));p.length>t.gSize;)g.unshift(p.splice(-t.gSize,p.length).join(""));p.length&&g.unshift(p.join("")),a=g.join(Uc(r,n)),v.length&&(a+=Uc(r,i)+v.join("")),m&&(a+=Uc(r,Lc.Exponential)+"+"+m)}else a=Uc(r,Lc.Infinity);return a=e<0&&!l?t.negPre+a+t.negSuf:t.posPre+a+t.posSuf}function wu(e,t,r,n,i){const o=_u(Bc(t,Cc.Currency),Uc(t,Lc.MinusSign));return o.minFrac=function(e){let t;const r=Ec[e];return r&&(t=r[2]),"number"==typeof t?t:Wc}(n),o.maxFrac=o.minFrac,bu(e,o,t,Lc.CurrencyGroup,Lc.CurrencyDecimal,i).replace(yu,r).replace(yu,"")}function _u(e,t="-"){const r={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},n=e.split(mu),i=n[0],o=n[1],s=-1!==i.indexOf(pu)?i.split(pu):[i.substring(0,i.lastIndexOf(fu)+1),i.substring(i.lastIndexOf(fu)+1)],a=s[0],l=s[1]||"";r.posPre=a.substr(0,a.indexOf(gu));for(let u=0;u<l.length;u++){const e=l.charAt(u);e===fu?r.minFrac=r.maxFrac=u+1:e===gu?r.maxFrac=u+1:r.posSuf+=e}const c=a.split(vu);if(r.gSize=c[1]?c[1].length:0,r.lgSize=c[2]||c[1]?(c[2]||c[1]).length:0,o){const e=i.length-r.posPre.length-r.posSuf.length,t=o.indexOf(gu);r.negPre=o.substr(0,t).replace(/'/g,""),r.negSuf=o.substr(t+e).replace(/'/g,"")}else r.negPre=t+r.posPre,r.negSuf=r.posSuf;return r}function Su(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}const Tu=new pe("UseV4Plurals");class Mu{}function Au(e,t,r,n){let i=`=${e}`;if(t.indexOf(i)>-1)return i;if(i=r.getPluralCategory(e,n),t.indexOf(i)>-1)return i;if(t.indexOf("other")>-1)return"other";throw new Error(`No plural message found for value "${e}"`)}class Eu extends Mu{constructor(e,t){super(),this.locale=e,this.deprecatedPluralFn=t}getPluralCategory(e,t){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(t||this.locale,e):function(e){return Gc(e)[18]}(t||this.locale)(e)){case Pc.Zero:return"zero";case Pc.One:return"one";case Pc.Two:return"two";case Pc.Few:return"few";case Pc.Many:return"many";default:return"other"}}}function Cu(e,t){t=encodeURIComponent(t);for(const r of e.split(";")){const e=r.indexOf("="),[n,i]=-1==e?[r,""]:[r.slice(0,e),r.slice(e+1)];if(n.trim()===t)return decodeURIComponent(i)}return null}Eu.decorators=[{type:Rt}],Eu.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]},{type:void 0,decorators:[{type:tt},{type:et,args:[Tu]}]}]);class Pu{constructor(e,t,r,n){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=r,this._renderer=n,this._initialClasses=[]}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Bn(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${We(e.item)}`);this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}Pu.decorators=[{type:Ee,args:[{selector:"[ngClass]"}]}],Pu.ctorParameters=(()=>[{type:Zn},{type:Qn},{type:yn},{type:gn}]),Pu.propDecorators={klass:[{type:Oe,args:["class"]}],ngClass:[{type:Oe}]};class Ou{constructor(e){this._viewContainerRef=e,this._componentRef=null,this._moduleRef=null}ngOnChanges(e){if(this._viewContainerRef.clear(),this._componentRef=null,this.ngComponentOutlet){const t=this.ngComponentOutletInjector||this._viewContainerRef.parentInjector;if(e.ngComponentOutletNgModuleFactory)if(this._moduleRef&&this._moduleRef.destroy(),this.ngComponentOutletNgModuleFactory){const e=t.get(kr);this._moduleRef=this.ngComponentOutletNgModuleFactory.create(e.injector)}else this._moduleRef=null;const r=(this._moduleRef?this._moduleRef.componentFactoryResolver:t.get(Ir)).resolveComponentFactory(this.ngComponentOutlet);this._componentRef=this._viewContainerRef.createComponent(r,this._viewContainerRef.length,t,this.ngComponentOutletContent)}}ngOnDestroy(){this._moduleRef&&this._moduleRef.destroy()}}Ou.decorators=[{type:Ee,args:[{selector:"[ngComponentOutlet]"}]}],Ou.ctorParameters=(()=>[{type:Cn}]),Ou.propDecorators={ngComponentOutlet:[{type:Oe}],ngComponentOutletInjector:[{type:Oe}],ngComponentOutletContent:[{type:Oe}],ngComponentOutletNgModuleFactory:[{type:Oe}]};class Du{constructor(e,t,r,n){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=n}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}class Nu{constructor(e,t,r){this._viewContainer=e,this._template=t,this._differs=r,this._differ=null}set ngForTrackBy(e){sn()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn(`trackBy must be a function, but received ${JSON.stringify(e)}. `+"See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngOnChanges(e){if("ngForOf"in e){const t=e.ngForOf.currentValue;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(e){throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(e){return e.name||typeof e}(t)}'. NgFor only supports binding to Iterables such as Arrays.`)}}}ngDoCheck(){if(this._differ){const e=this._differ.diff(this.ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,r,n)=>{if(null==e.previousIndex){const r=this._viewContainer.createEmbeddedView(this._template,new Du(null,this.ngForOf,-1,-1),n),i=new Lu(e,r);t.push(i)}else if(null==n)this._viewContainer.remove(r);else{const i=this._viewContainer.get(r);this._viewContainer.move(i,n);const o=new Lu(e,i);t.push(o)}});for(let r=0;r<t.length;r++)this._perViewChange(t[r].view,t[r].record);for(let r=0,n=this._viewContainer.length;r<n;r++){const e=this._viewContainer.get(r);e.context.index=r,e.context.count=n}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}}Nu.decorators=[{type:Ee,args:[{selector:"[ngFor][ngForOf]"}]}],Nu.ctorParameters=(()=>[{type:Cn},{type:En},{type:Zn}]),Nu.propDecorators={ngForOf:[{type:Oe}],ngForTrackBy:[{type:Oe}],ngForTemplate:[{type:Oe}]};class Lu{constructor(e,t){this.record=e,this.view=t}}class Iu{constructor(e,t){this._viewContainer=e,this._context=new Ru,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Fu("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Fu("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}}Iu.decorators=[{type:Ee,args:[{selector:"[ngIf]"}]}],Iu.ctorParameters=(()=>[{type:Cn},{type:En}]),Iu.propDecorators={ngIf:[{type:Oe}],ngIfThen:[{type:Oe}],ngIfElse:[{type:Oe}]};class Ru{constructor(){this.$implicit=null,this.ngIf=null}}function Fu(e,t){if(!!(t&&!t.createEmbeddedView))throw new Error(`${e} must be a TemplateRef, but received '${We(t)}'.`)}class ku{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}class Uu{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const t=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||t,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),t}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let t=0;t<this._defaultViews.length;t++){this._defaultViews[t].enforceState(e)}}}}Uu.decorators=[{type:Ee,args:[{selector:"[ngSwitch]"}]}],Uu.ctorParameters=(()=>[]),Uu.propDecorators={ngSwitch:[{type:Oe}]};class Bu{constructor(e,t,r){this.ngSwitch=r,r._addCase(),this._view=new ku(e,t)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}Bu.decorators=[{type:Ee,args:[{selector:"[ngSwitchCase]"}]}],Bu.ctorParameters=(()=>[{type:Cn},{type:En},{type:Uu,decorators:[{type:it}]}]),Bu.propDecorators={ngSwitchCase:[{type:Oe}]};class ju{constructor(e,t,r){r._addDefault(new ku(e,t))}}ju.decorators=[{type:Ee,args:[{selector:"[ngSwitchDefault]"}]}],ju.ctorParameters=(()=>[{type:Cn},{type:En},{type:Uu,decorators:[{type:it}]}]);class zu{constructor(e){this._localization=e,this._caseViews={}}set ngPlural(e){this._switchValue=e,this._updateView()}addCase(e,t){this._caseViews[e]=t}_updateView(){this._clearViews();const e=Object.keys(this._caseViews),t=Au(this._switchValue,e,this._localization);this._activateView(this._caseViews[t])}_clearViews(){this._activeView&&this._activeView.destroy()}_activateView(e){e&&(this._activeView=e,this._activeView.create())}}zu.decorators=[{type:Ee,args:[{selector:"[ngPlural]"}]}],zu.ctorParameters=(()=>[{type:Mu}]),zu.propDecorators={ngPlural:[{type:Oe}]};class Vu{constructor(e,t,r,n){this.value=e;const i=!isNaN(Number(e));n.addCase(i?`=${e}`:e,new ku(r,t))}}Vu.decorators=[{type:Ee,args:[{selector:"[ngPluralCase]"}]}],Vu.ctorParameters=(()=>[{type:void 0,decorators:[{type:_e,args:["ngPluralCase"]}]},{type:En},{type:Cn},{type:zu,decorators:[{type:it}]}]);class Gu{constructor(e,t,r){this._differs=e,this._ngEl=t,this._renderer=r}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_applyChanges(e){e.forEachRemovedItem(e=>this._setStyle(e.key,null)),e.forEachAddedItem(e=>this._setStyle(e.key,e.currentValue)),e.forEachChangedItem(e=>this._setStyle(e.key,e.currentValue))}_setStyle(e,t){const[r,n]=e.split(".");null!=(t=null!=t&&n?`${t}${n}`:t)?this._renderer.setStyle(this._ngEl.nativeElement,r,t):this._renderer.removeStyle(this._ngEl.nativeElement,r)}}Gu.decorators=[{type:Ee,args:[{selector:"[ngStyle]"}]}],Gu.ctorParameters=(()=>[{type:Qn},{type:yn},{type:gn}]),Gu.propDecorators={ngStyle:[{type:Oe}]};class Hu{constructor(e){this._viewContainerRef=e}ngOnChanges(e){this._shouldRecreateView(e)?(this._viewRef&&this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._viewRef)),this.ngTemplateOutlet&&(this._viewRef=this._viewContainerRef.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext))):this._viewRef&&this.ngTemplateOutletContext&&this._updateExistingContext(this.ngTemplateOutletContext)}_shouldRecreateView(e){const t=e.ngTemplateOutletContext;return!!e.ngTemplateOutlet||t&&this._hasContextShapeChanged(t)}_hasContextShapeChanged(e){const t=Object.keys(e.previousValue||{}),r=Object.keys(e.currentValue||{});if(t.length===r.length){for(let e of r)if(-1===t.indexOf(e))return!0;return!1}return!0}_updateExistingContext(e){for(let t of Object.keys(e))this._viewRef.context[t]=this.ngTemplateOutletContext[t]}}Hu.decorators=[{type:Ee,args:[{selector:"[ngTemplateOutlet]"}]}],Hu.ctorParameters=(()=>[{type:Cn}]),Hu.propDecorators={ngTemplateOutletContext:[{type:Oe}],ngTemplateOutlet:[{type:Oe}]};const Wu=[Pu,Ou,Nu,Iu,Hu,Gu,Uu,Bu,ju,zu,Vu];function Xu(e,t){return Error(`InvalidPipeArgument: '${t}' for pipe '${We(e)}'`)}class qu{static format(e,t,r,n={}){const{minimumIntegerDigits:i,minimumFractionDigits:o,maximumFractionDigits:s,currency:a,currencyAsSymbol:l=!1}=n,c={minimumIntegerDigits:i,minimumFractionDigits:o,maximumFractionDigits:s,style:Cc[r].toLowerCase()};return r==Cc.Currency&&(c.currency="string"==typeof a?a:void 0,c.currencyDisplay=l?"symbol":"code"),new Intl.NumberFormat(t,c).format(e)}}const Yu=/((?:[^yMLdHhmsazZEwGjJ']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|J+|j+|m+|s+|a|z|Z|G+|w+))(.*)/,Ju={yMMMdjms:oh(ih([rh("year",1),nh("month",3),rh("day",1),rh("hour",1),rh("minute",1),rh("second",1)])),yMdjm:oh(ih([rh("year",1),rh("month",1),rh("day",1),rh("hour",1),rh("minute",1)])),yMMMMEEEEd:oh(ih([rh("year",1),nh("month",4),nh("weekday",4),rh("day",1)])),yMMMMd:oh(ih([rh("year",1),nh("month",4),rh("day",1)])),yMMMd:oh(ih([rh("year",1),nh("month",3),rh("day",1)])),yMd:oh(ih([rh("year",1),rh("month",1),rh("day",1)])),jms:oh(ih([rh("hour",1),rh("second",1),rh("minute",1)])),jm:oh(ih([rh("hour",1),rh("minute",1)]))},Zu={yyyy:oh(rh("year",4)),yy:oh(rh("year",2)),y:oh(rh("year",1)),MMMM:oh(nh("month",4)),MMM:oh(nh("month",3)),MM:oh(rh("month",2)),M:oh(rh("month",1)),LLLL:oh(nh("month",4)),L:oh(nh("month",1)),dd:oh(rh("day",2)),d:oh(rh("day",1)),HH:Qu(Ku(oh(th(rh("hour",2),!1)))),H:Ku(oh(th(rh("hour",1),!1))),hh:Qu(Ku(oh(th(rh("hour",2),!0)))),h:Ku(oh(th(rh("hour",1),!0))),jj:oh(rh("hour",2)),j:oh(rh("hour",1)),mm:Qu(oh(rh("minute",2))),m:oh(rh("minute",1)),ss:Qu(oh(rh("second",2))),s:oh(rh("second",1)),sss:oh(rh("second",3)),EEEE:oh(nh("weekday",4)),EEE:oh(nh("weekday",3)),EE:oh(nh("weekday",2)),E:oh(nh("weekday",1)),a:function(e){return function(t,r){return e(t,r).split(" ")[1]}}(oh(th(rh("hour",1),!0))),Z:eh("short"),z:eh("long"),ww:oh({}),w:oh({}),G:oh(nh("era",1)),GG:oh(nh("era",2)),GGG:oh(nh("era",3)),GGGG:oh(nh("era",4))};function Qu(e){return function(t,r){const n=e(t,r);return 1==n.length?"0"+n:n}}function Ku(e){return function(t,r){return e(t,r).split(" ")[0]}}function $u(e,t,r){return new Intl.DateTimeFormat(t,r).format(e).replace(/[\u200e\u200f]/g,"")}function eh(e){const t={hour:"2-digit",hour12:!1,timeZoneName:e};return function(e,r){const n=$u(e,r,t);return n?n.substring(3):""}}function th(e,t){return e.hour12=t,e}function rh(e,t){const r={};return r[e]=2===t?"2-digit":"numeric",r}function nh(e,t){const r={};return r[e]=t<4?t>1?"short":"narrow":"long",r}function ih(e){return e.reduce((e,t)=>Object.assign({},e,t),{})}function oh(e){return(t,r)=>$u(t,r,e)}const sh=new Map;class ah{static format(e,t,r){return function(e,t,r){const n=Ju[e];if(n)return n(t,r);const i=e;let o=sh.get(i);if(!o){let t;o=[],Yu.exec(e);let r=e;for(;r;)(t=Yu.exec(r))?r=(o=o.concat(t.slice(1))).pop():(o.push(r),r=null);sh.set(i,o)}return o.reduce((e,n)=>{const i=Zu[n];return e+(i?i(t,r):function(e){return"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}(n))},"")}(r,e,t)}}class lh{constructor(e){this._locale=e}transform(e,t="mediumDate"){if(null==e||""===e||e!=e)return null;let r;if("string"==typeof e&&(e=e.trim()),ch(e))r=e;else if(isNaN(e-parseFloat(e)))if("string"==typeof e&&/^(\d{4}-\d{1,2}-\d{1,2})$/.test(e)){const[t,n,i]=e.split("-").map(e=>parseInt(e,10));r=new Date(t,n-1,i)}else r=new Date(e);else r=new Date(parseFloat(e));if(!ch(r)){let t;if("string"!=typeof e||!(t=e.match(Xc)))throw Xu(lh,e);r=cu(t)}return ah.format(r,this._locale,lh._ALIASES[t]||t)}}function ch(e){return e instanceof Date&&!isNaN(e.valueOf())}function uh(e,t,r,n,i,o=null,s=!1){if(null==r)return null;if("number"!=typeof(r="string"!=typeof r||isNaN(+r-parseFloat(r))?r:+r))throw Xu(e,r);let a,l,c;if(n!==Cc.Currency&&(a=1,l=0,c=3),i){const e=i.match(hu);if(null===e)throw new Error(`${i} is not a valid digit info for number pipes`);null!=e[1]&&(a=Su(e[1])),null!=e[3]&&(l=Su(e[3])),null!=e[5]&&(c=Su(e[5]))}return qu.format(r,t,n,{minimumIntegerDigits:a,minimumFractionDigits:l,maximumFractionDigits:c,currency:o,currencyAsSymbol:s})}lh._ALIASES={medium:"yMMMdjms",short:"yMdjm",fullDate:"yMMMMEEEEd",longDate:"yMMMMd",mediumDate:"yMMMd",shortDate:"yMd",mediumTime:"jms",shortTime:"jm"},lh.decorators=[{type:Pe,args:[{name:"date",pure:!0}]}],lh.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);class hh{constructor(e){this._locale=e}transform(e,t){return uh(hh,this._locale,e,Cc.Decimal,t)}}hh.decorators=[{type:Pe,args:[{name:"number"}]}],hh.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);class dh{constructor(e){this._locale=e}transform(e,t){return uh(dh,this._locale,e,Cc.Percent,t)}}dh.decorators=[{type:Pe,args:[{name:"percent"}]}],dh.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);class ph{constructor(e){this._locale=e}transform(e,t="USD",r=!1,n){return uh(ph,this._locale,e,Cc.Currency,n,t,r)}}ph.decorators=[{type:Pe,args:[{name:"currency"}]}],ph.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);const fh=[hh,dh,ph,lh];const mh=new class{createSubscription(e,t){return e.then(t,e=>{throw e})}dispose(e){}onDestroy(e){}},vh=new class{createSubscription(e,t){return e.subscribe({next:t,error:e=>{throw e}})}dispose(e){e.unsubscribe()}onDestroy(e){e.unsubscribe()}};class gh{constructor(e){this._ref=e,this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue===this._latestReturnedValue?this._latestReturnedValue:(this._latestReturnedValue=this._latestValue,kn.wrap(this._latestValue)):(e&&this._subscribe(e),this._latestReturnedValue=this._latestValue,this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,t=>this._updateLatestValue(e,t))}_selectStrategy(e){if(mr(e))return mh;if(vr(e))return vh;throw Xu(gh,e)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,t){e===this._obj&&(this._latestValue=t,this._ref.markForCheck())}}gh.decorators=[{type:Pe,args:[{name:"async",pure:!1}]}],gh.ctorParameters=(()=>[{type:Pn}]);class yh{transform(e){if(!e)return e;if("string"!=typeof e)throw Xu(yh,e);return e.toLowerCase()}}yh.decorators=[{type:Pe,args:[{name:"lowercase"}]}],yh.ctorParameters=(()=>[]);const xh=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])\S*/g;class bh{transform(e){if(!e)return e;if("string"!=typeof e)throw Xu(bh,e);return e.replace(xh,e=>e[0].toUpperCase()+e.substr(1).toLowerCase())}}bh.decorators=[{type:Pe,args:[{name:"titlecase"}]}],bh.ctorParameters=(()=>[]);class wh{transform(e){if(!e)return e;if("string"!=typeof e)throw Xu(wh,e);return e.toUpperCase()}}wh.decorators=[{type:Pe,args:[{name:"uppercase"}]}],wh.ctorParameters=(()=>[]);class _h{constructor(e){this.locale=e}transform(e,t="mediumDate",r,n){if(null==e||""===e||e!=e)return null;try{return Kc(e,t,n||this.locale,r)}catch(e){throw Xu(_h,e.message)}}}_h.decorators=[{type:Pe,args:[{name:"date",pure:!0}]}],_h.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);const Sh=/#/g;class Th{constructor(e){this._localization=e}transform(e,t,r){if(null==e)return"";if("object"!=typeof t||null===t)throw Xu(Th,t);return t[Au(e,Object.keys(t),this._localization,r)].replace(Sh,e.toString())}}Th.decorators=[{type:Pe,args:[{name:"i18nPlural",pure:!0}]}],Th.ctorParameters=(()=>[{type:Mu}]);class Mh{transform(e,t){if(null==e)return"";if("object"!=typeof t||"string"!=typeof e)throw Xu(Mh,t);return t.hasOwnProperty(e)?t[e]:t.hasOwnProperty("other")?t.other:""}}Mh.decorators=[{type:Pe,args:[{name:"i18nSelect",pure:!0}]}],Mh.ctorParameters=(()=>[]);class Ah{transform(e){return JSON.stringify(e,null,2)}}Ah.decorators=[{type:Pe,args:[{name:"json",pure:!1}]}],Ah.ctorParameters=(()=>[]);class Eh{constructor(e){this._locale=e}transform(e,t,r){if(Oh(e))return null;r=r||this._locale;try{return function(e,t,r){return bu(e,_u(Bc(t,Cc.Decimal),Uc(t,Lc.MinusSign)),t,Lc.Group,Lc.Decimal,r)}(Dh(e),r,t)}catch(e){throw Xu(Eh,e.message)}}}Eh.decorators=[{type:Pe,args:[{name:"number"}]}],Eh.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);class Ch{constructor(e){this._locale=e}transform(e,t,r){if(Oh(e))return null;r=r||this._locale;try{return function(e,t,r){return bu(e,_u(Bc(t,Cc.Percent),Uc(t,Lc.MinusSign)),t,Lc.Group,Lc.Decimal,r,!0).replace(new RegExp(xu,"g"),Uc(t,Lc.PercentSign))}(Dh(e),r,t)}catch(e){throw Xu(Ch,e.message)}}}Ch.decorators=[{type:Pe,args:[{name:"percent"}]}],Ch.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);class Ph{constructor(e){this._locale=e}transform(e,t,r="symbol",n,i){if(Oh(e))return null;i=i||this._locale,"boolean"==typeof r&&(console&&console.warn&&console.warn('Warning: the currency pipe has been changed in Angular v5. The symbolDisplay option (third parameter) is now a string instead of a boolean. The accepted values are "code", "symbol" or "symbol-narrow".'),r=r?"symbol":"code");let o=t||"USD";"code"!==r&&(o="symbol"===r||"symbol-narrow"===r?Hc(o,"symbol"===r?"wide":"narrow",i):r);try{return wu(Dh(e),i,o,t,n)}catch(e){throw Xu(Ph,e.message)}}}function Oh(e){return null==e||""===e||e!=e}function Dh(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}Ph.decorators=[{type:Pe,args:[{name:"currency"}]}],Ph.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[ni]}]}]);class Nh{transform(e,t,r){if(null==e)return e;if(!this.supports(e))throw Xu(Nh,e);return e.slice(t,r)}supports(e){return"string"==typeof e||Array.isArray(e)}}Nh.decorators=[{type:Pe,args:[{name:"slice",pure:!1}]}],Nh.ctorParameters=(()=>[]);const Lh=[gh,wh,yh,Ah,Nh,Eh,Ch,bh,Ph,_h,Th,Mh];class Ih{}Ih.decorators=[{type:Ft,args:[{declarations:[Wu,Lh],exports:[Wu,Lh],providers:[{provide:Mu,useClass:Eu}]}]}],Ih.ctorParameters=(()=>[]);const Rh=function(e,t){"string"==typeof t&&(t=parseInt(t,10));const r=t,n=r.toString().replace(/^[^.]*\.?/,""),i=Math.floor(Math.abs(r)),o=n.length,s=parseInt(n,10),a=parseInt(r.toString().replace(/^[^.]*\.?|0+$/g,""),10)||0;switch(e.split("-")[0].toLowerCase()){case"af":case"asa":case"az":case"bem":case"bez":case"bg":case"brx":case"ce":case"cgg":case"chr":case"ckb":case"ee":case"el":case"eo":case"es":case"eu":case"fo":case"fur":case"gsw":case"ha":case"haw":case"hu":case"jgo":case"jmc":case"ka":case"kk":case"kkj":case"kl":case"ks":case"ksb":case"ky":case"lb":case"lg":case"mas":case"mgo":case"ml":case"mn":case"nb":case"nd":case"ne":case"nn":case"nnh":case"nyn":case"om":case"or":case"os":case"ps":case"rm":case"rof":case"rwk":case"saq":case"seh":case"sn":case"so":case"sq":case"ta":case"te":case"teo":case"tk":case"tr":case"ug":case"uz":case"vo":case"vun":case"wae":case"xog":return 1===r?Pc.One:Pc.Other;case"ak":case"ln":case"mg":case"pa":case"ti":return r===Math.floor(r)&&r>=0&&r<=1?Pc.One:Pc.Other;case"am":case"as":case"bn":case"fa":case"gu":case"hi":case"kn":case"mr":case"zu":return 0===i||1===r?Pc.One:Pc.Other;case"ar":return 0===r?Pc.Zero:1===r?Pc.One:2===r?Pc.Two:r%100===Math.floor(r%100)&&r%100>=3&&r%100<=10?Pc.Few:r%100===Math.floor(r%100)&&r%100>=11&&r%100<=99?Pc.Many:Pc.Other;case"ast":case"ca":case"de":case"en":case"et":case"fi":case"fy":case"gl":case"it":case"nl":case"sv":case"sw":case"ur":case"yi":return 1===i&&0===o?Pc.One:Pc.Other;case"be":return r%10==1&&r%100!=11?Pc.One:r%10===Math.floor(r%10)&&r%10>=2&&r%10<=4&&!(r%100>=12&&r%100<=14)?Pc.Few:r%10==0||r%10===Math.floor(r%10)&&r%10>=5&&r%10<=9||r%100===Math.floor(r%100)&&r%100>=11&&r%100<=14?Pc.Many:Pc.Other;case"br":return r%10==1&&r%100!=11&&r%100!=71&&r%100!=91?Pc.One:r%10==2&&r%100!=12&&r%100!=72&&r%100!=92?Pc.Two:r%10===Math.floor(r%10)&&(r%10>=3&&r%10<=4||r%10==9)&&!(r%100>=10&&r%100<=19||r%100>=70&&r%100<=79||r%100>=90&&r%100<=99)?Pc.Few:0!==r&&r%1e6==0?Pc.Many:Pc.Other;case"bs":case"hr":case"sr":return 0===o&&i%10==1&&i%100!=11||s%10==1&&s%100!=11?Pc.One:0===o&&i%10===Math.floor(i%10)&&i%10>=2&&i%10<=4&&!(i%100>=12&&i%100<=14)||s%10===Math.floor(s%10)&&s%10>=2&&s%10<=4&&!(s%100>=12&&s%100<=14)?Pc.Few:Pc.Other;case"cs":case"sk":return 1===i&&0===o?Pc.One:i===Math.floor(i)&&i>=2&&i<=4&&0===o?Pc.Few:0!==o?Pc.Many:Pc.Other;case"cy":return 0===r?Pc.Zero:1===r?Pc.One:2===r?Pc.Two:3===r?Pc.Few:6===r?Pc.Many:Pc.Other;case"da":return 1===r||0!==a&&(0===i||1===i)?Pc.One:Pc.Other;case"dsb":case"hsb":return 0===o&&i%100==1||s%100==1?Pc.One:0===o&&i%100==2||s%100==2?Pc.Two:0===o&&i%100===Math.floor(i%100)&&i%100>=3&&i%100<=4||s%100===Math.floor(s%100)&&s%100>=3&&s%100<=4?Pc.Few:Pc.Other;case"ff":case"fr":case"hy":case"kab":return 0===i||1===i?Pc.One:Pc.Other;case"fil":return 0===o&&(1===i||2===i||3===i)||0===o&&i%10!=4&&i%10!=6&&i%10!=9||0!==o&&s%10!=4&&s%10!=6&&s%10!=9?Pc.One:Pc.Other;case"ga":return 1===r?Pc.One:2===r?Pc.Two:r===Math.floor(r)&&r>=3&&r<=6?Pc.Few:r===Math.floor(r)&&r>=7&&r<=10?Pc.Many:Pc.Other;case"gd":return 1===r||11===r?Pc.One:2===r||12===r?Pc.Two:r===Math.floor(r)&&(r>=3&&r<=10||r>=13&&r<=19)?Pc.Few:Pc.Other;case"gv":return 0===o&&i%10==1?Pc.One:0===o&&i%10==2?Pc.Two:0!==o||i%100!=0&&i%100!=20&&i%100!=40&&i%100!=60&&i%100!=80?0!==o?Pc.Many:Pc.Other:Pc.Few;case"he":return 1===i&&0===o?Pc.One:2===i&&0===o?Pc.Two:0!==o||r>=0&&r<=10||r%10!=0?Pc.Other:Pc.Many;case"is":return 0===a&&i%10==1&&i%100!=11||0!==a?Pc.One:Pc.Other;case"ksh":return 0===r?Pc.Zero:1===r?Pc.One:Pc.Other;case"kw":case"naq":case"se":case"smn":return 1===r?Pc.One:2===r?Pc.Two:Pc.Other;case"lag":return 0===r?Pc.Zero:0!==i&&1!==i||0===r?Pc.Other:Pc.One;case"lt":return r%10!=1||r%100>=11&&r%100<=19?r%10===Math.floor(r%10)&&r%10>=2&&r%10<=9&&!(r%100>=11&&r%100<=19)?Pc.Few:0!==s?Pc.Many:Pc.Other:Pc.One;case"lv":case"prg":return r%10==0||r%100===Math.floor(r%100)&&r%100>=11&&r%100<=19||2===o&&s%100===Math.floor(s%100)&&s%100>=11&&s%100<=19?Pc.Zero:r%10==1&&r%100!=11||2===o&&s%10==1&&s%100!=11||2!==o&&s%10==1?Pc.One:Pc.Other;case"mk":return 0===o&&i%10==1||s%10==1?Pc.One:Pc.Other;case"mt":return 1===r?Pc.One:0===r||r%100===Math.floor(r%100)&&r%100>=2&&r%100<=10?Pc.Few:r%100===Math.floor(r%100)&&r%100>=11&&r%100<=19?Pc.Many:Pc.Other;case"pl":return 1===i&&0===o?Pc.One:0===o&&i%10===Math.floor(i%10)&&i%10>=2&&i%10<=4&&!(i%100>=12&&i%100<=14)?Pc.Few:0===o&&1!==i&&i%10===Math.floor(i%10)&&i%10>=0&&i%10<=1||0===o&&i%10===Math.floor(i%10)&&i%10>=5&&i%10<=9||0===o&&i%100===Math.floor(i%100)&&i%100>=12&&i%100<=14?Pc.Many:Pc.Other;case"pt":return r===Math.floor(r)&&r>=0&&r<=2&&2!==r?Pc.One:Pc.Other;case"ro":return 1===i&&0===o?Pc.One:0!==o||0===r||1!==r&&r%100===Math.floor(r%100)&&r%100>=1&&r%100<=19?Pc.Few:Pc.Other;case"ru":case"uk":return 0===o&&i%10==1&&i%100!=11?Pc.One:0===o&&i%10===Math.floor(i%10)&&i%10>=2&&i%10<=4&&!(i%100>=12&&i%100<=14)?Pc.Few:0===o&&i%10==0||0===o&&i%10===Math.floor(i%10)&&i%10>=5&&i%10<=9||0===o&&i%100===Math.floor(i%100)&&i%100>=11&&i%100<=14?Pc.Many:Pc.Other;case"shi":return 0===i||1===r?Pc.One:r===Math.floor(r)&&r>=2&&r<=10?Pc.Few:Pc.Other;case"si":return 0===r||1===r||0===i&&1===s?Pc.One:Pc.Other;case"sl":return 0===o&&i%100==1?Pc.One:0===o&&i%100==2?Pc.Two:0===o&&i%100===Math.floor(i%100)&&i%100>=3&&i%100<=4||0!==o?Pc.Few:Pc.Other;case"tzm":return r===Math.floor(r)&&r>=0&&r<=1||r===Math.floor(r)&&r>=11&&r<=99?Pc.One:Pc.Other;default:return Pc.Other}};class Fh{}Fh.decorators=[{type:Ft,args:[{declarations:[fh],exports:[fh],providers:[{provide:Tu,useValue:Rh}]}]}],Fh.ctorParameters=(()=>[]);const kh=new pe("DocumentToken"),Uh="browser";new Ut("6.0.0");class Bh{}class jh{}class zh{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const r=e.slice(0,t),n=r.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(r,n),this.headers.has(n)?this.headers.get(n).push(i):this.headers.set(n,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let r=e[t];const n=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(n,r),this.maybeSetNormalizedName(t,n))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof zh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new zh;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof zh?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const n=("a"===e.op?this.headers.get(t):void 0)||[];n.push(...r),this.headers.set(t,n);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;0===(e=e.filter(e=>-1===i.indexOf(e))).length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class Vh{encodeKey(e){return Gh(e)}encodeValue(e){return Gh(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}function Gh(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}class Hh{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Vh,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const r=new Map;e.length>0&&e.split("&").forEach(e=>{const n=e.indexOf("="),[i,o]=-1==n?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,n)),t.decodeValue(e.slice(n+1))],s=r.get(i)||[];s.push(o),r.set(i,s)});return r}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const r=e.fromObject[t];this.map.set(t,Array.isArray(r)?r:[r])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).join("&")}clone(e){const t=new Hh({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat([e]),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(e.value),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const r=t.indexOf(e.value);-1!==r&&t.splice(r,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=null)}}function Wh(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Xh(e){return"undefined"!=typeof Blob&&e instanceof Blob}function qh(e){return"undefined"!=typeof FormData&&e instanceof FormData}class Yh{constructor(e,t,r,n){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||n?(this.body=void 0!==r?r:null,i=n):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new zh),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const r=t.indexOf("?"),n=-1===r?"?":r<t.length-1?"&":"";this.urlWithParams=t+n+e}}else this.params=new Hh,this.urlWithParams=t}serializeBody(){return null===this.body?null:Wh(this.body)||Xh(this.body)||qh(this.body)||"string"==typeof this.body?this.body:this.body instanceof Hh?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body?null:qh(this.body)?null:Xh(this.body)?this.body.type||null:Wh(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Hh?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}clone(e={}){const t=e.method||this.method,r=e.url||this.url,n=e.responseType||this.responseType,i=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,s=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let a=e.headers||this.headers,l=e.params||this.params;return void 0!==e.setHeaders&&(a=Object.keys(e.setHeaders).reduce((t,r)=>t.set(r,e.setHeaders[r]),a)),e.setParams&&(l=Object.keys(e.setParams).reduce((t,r)=>t.set(r,e.setParams[r]),l)),new Yh(t,r,i,{params:l,headers:a,reportProgress:s,responseType:n,withCredentials:o})}}const Jh={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};Jh[Jh.Sent]="Sent",Jh[Jh.UploadProgress]="UploadProgress",Jh[Jh.ResponseHeader]="ResponseHeader",Jh[Jh.DownloadProgress]="DownloadProgress",Jh[Jh.Response]="Response",Jh[Jh.User]="User";class Zh{constructor(e,t=200,r="OK"){this.headers=e.headers||new zh,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Qh extends Zh{constructor(e={}){super(e),this.type=Jh.ResponseHeader}clone(e={}){return new Qh({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Kh extends Zh{constructor(e={}){super(e),this.type=Jh.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new Kh({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class $h extends Zh{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function ed(e,t){return{body:t,headers:e.headers,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}class td{constructor(e){this.handler=e}request(e,t,r={}){let n;if(e instanceof Yh)n=e;else{let i=void 0;i=r.headers instanceof zh?r.headers:new zh(r.headers);let o=void 0;r.params&&(o=r.params instanceof Hh?r.params:new Hh({fromObject:r.params})),n=new Yh(e,t,void 0!==r.body?r.body:null,{headers:i,params:o,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const i=hc(n).pipe(mc(e=>this.handler.handle(e)));if(e instanceof Yh||"events"===r.observe)return i;const o=i.pipe(dc(e=>e instanceof Kh));switch(r.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return o.pipe(H(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return o.pipe(H(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return o.pipe(H(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return o.pipe(H(e=>e.body))}case"response":return o;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new Hh).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,r={}){return this.request("PATCH",e,ed(r,t))}post(e,t,r={}){return this.request("POST",e,ed(r,t))}put(e,t,r={}){return this.request("PUT",e,ed(r,t))}}td.decorators=[{type:Rt}],td.ctorParameters=(()=>[{type:Bh}]);class rd{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const nd=new pe("HTTP_INTERCEPTORS");class id{intercept(e,t){return t.handle(e)}}id.decorators=[{type:Rt}],id.ctorParameters=(()=>[]);let od=0;const sd="JSONP injected script did not invoke callback.",ad="JSONP requests must use JSONP request method.",ld="JSONP requests must use Json response type.";class cd{}class ud{constructor(e,t){this.callbackMap=e,this.document=t}nextCallback(){return`ng_jsonp_callback_${od++}`}handle(e){if("JSONP"!==e.method)throw new Error(ad);if("json"!==e.responseType)throw new Error(ld);return new M(t=>{const r=this.nextCallback(),n=e.urlWithParams.replace(/=JSONP_CALLBACK(&|$)/,`=${r}$1`),i=this.document.createElement("script");i.src=n;let o=null,s=!1,a=!1;this.callbackMap[r]=(e=>{delete this.callbackMap[r],a||(o=e,s=!0)});const l=()=>{i.parentNode&&i.parentNode.removeChild(i),delete this.callbackMap[r]},c=e=>{a||(l(),s?(t.next(new Kh({body:o,status:200,statusText:"OK",url:n})),t.complete()):t.error(new $h({url:n,status:0,statusText:"JSONP Error",error:new Error(sd)})))},u=e=>{a||(l(),t.error(new $h({error:e,status:0,statusText:"JSONP Error",url:n})))};return i.addEventListener("load",c),i.addEventListener("error",u),this.document.body.appendChild(i),t.next({type:Jh.Sent}),()=>{a=!0,i.removeEventListener("load",c),i.removeEventListener("error",u),l()}})}}ud.decorators=[{type:Rt}],ud.ctorParameters=(()=>[{type:cd},{type:void 0,decorators:[{type:et,args:[kh]}]}]);class hd{constructor(e){this.jsonp=e}intercept(e,t){return"JSONP"===e.method?this.jsonp.handle(e):t.handle(e)}}hd.decorators=[{type:Rt}],hd.ctorParameters=(()=>[{type:ud}]);const dd=/^\)\]\}',?\n/;class pd{}class fd{constructor(){}build(){return new XMLHttpRequest}}fd.decorators=[{type:Rt}],fd.ctorParameters=(()=>[]);class md{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without JsonpClientModule installed.");return new M(t=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((e,t)=>r.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&r.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();r.responseType="json"!==t?t:"text"}const n=e.serializeBody();let i=null;const o=()=>{if(null!==i)return i;const t=1223===r.status?204:r.status,n=r.statusText||"OK",o=new zh(r.getAllResponseHeaders()),s=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(r)||e.url;return i=new Qh({headers:o,status:t,statusText:n,url:s})},s=()=>{let{headers:n,status:i,statusText:s,url:a}=o(),l=null;204!==i&&(l=void 0===r.response?r.responseText:r.response),0===i&&(i=l?200:0);let c=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof l){const e=l;l=l.replace(dd,"");try{l=""!==l?JSON.parse(l):null}catch(t){l=e,c&&(c=!1,l={error:t,text:l})}}c?(t.next(new Kh({body:l,headers:n,status:i,statusText:s,url:a||void 0})),t.complete()):t.error(new $h({error:l,headers:n,status:i,statusText:s,url:a||void 0}))},a=e=>{const n=new $h({error:e,status:r.status||0,statusText:r.statusText||"Unknown Error"});t.error(n)};let l=!1;const c=n=>{l||(t.next(o()),l=!0);let i={type:Jh.DownloadProgress,loaded:n.loaded};n.lengthComputable&&(i.total=n.total),"text"===e.responseType&&r.responseText&&(i.partialText=r.responseText),t.next(i)},u=e=>{let r={type:Jh.UploadProgress,loaded:e.loaded};e.lengthComputable&&(r.total=e.total),t.next(r)};return r.addEventListener("load",s),r.addEventListener("error",a),e.reportProgress&&(r.addEventListener("progress",c),null!==n&&r.upload&&r.upload.addEventListener("progress",u)),r.send(n),t.next({type:Jh.Sent}),()=>{r.removeEventListener("error",a),r.removeEventListener("load",s),e.reportProgress&&(r.removeEventListener("progress",c),null!==n&&r.upload&&r.upload.removeEventListener("progress",u)),r.abort()}})}}md.decorators=[{type:Rt}],md.ctorParameters=(()=>[{type:pd}]);const vd=new pe("XSRF_COOKIE_NAME"),gd=new pe("XSRF_HEADER_NAME");class yd{}class xd{constructor(e,t,r){this.doc=e,this.platform=t,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Cu(e,this.cookieName),this.lastCookieString=e),this.lastToken}}xd.decorators=[{type:Rt}],xd.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[kh]}]},{type:void 0,decorators:[{type:et,args:[Tr]}]},{type:void 0,decorators:[{type:et,args:[vd]}]}]);class bd{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return t.handle(e);const n=this.tokenService.getToken();return null===n||e.headers.has(this.headerName)||(e=e.clone({headers:e.headers.set(this.headerName,n)})),t.handle(e)}}bd.decorators=[{type:Rt}],bd.ctorParameters=(()=>[{type:yd},{type:void 0,decorators:[{type:et,args:[gd]}]}]);class wd{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(nd,[]);this.chain=e.reduceRight((e,t)=>new rd(e,t),this.backend)}return this.chain.handle(e)}}wd.decorators=[{type:Rt}],wd.ctorParameters=(()=>[{type:jh},{type:ut}]);class _d{static disable(){return{ngModule:_d,providers:[{provide:bd,useClass:id}]}}static withOptions(e={}){return{ngModule:_d,providers:[e.cookieName?{provide:vd,useValue:e.cookieName}:[],e.headerName?{provide:gd,useValue:e.headerName}:[]]}}}_d.decorators=[{type:Ft,args:[{providers:[bd,{provide:nd,useExisting:bd,multi:!0},{provide:yd,useClass:xd},{provide:vd,useValue:"XSRF-TOKEN"},{provide:gd,useValue:"X-XSRF-TOKEN"}]}]}],_d.ctorParameters=(()=>[]);class Sd{}Sd.decorators=[{type:Ft,args:[{imports:[_d.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})],providers:[td,{provide:Bh,useClass:wd},md,{provide:jh,useExisting:md},fd,{provide:pd,useExisting:fd}]}]}],Sd.ctorParameters=(()=>[]);class Td{}Td.decorators=[{type:Ft,args:[{providers:[ud,{provide:cd,useFactory:function(){return"object"==typeof window?window:{}}},{provide:nd,useClass:hd,multi:!0}]}]}],Td.ctorParameters=(()=>[]);class Md{}Md.BACKEND_URL="https://racing-demo-dev.pp.ua",Md.FPS=60,Md.MOVE_TIMEOUT=7e3;class Ad{constructor(e,t){this.http=e,this.router=t,this.apiUrl=Md.BACKEND_URL,this.apiHeaders=new zh({"Content-type":"application/json"})}apiGet(e,t=null){return this.apiCall(Ed.Get,e,t)}apiPost(e,t){return this.apiCall(Ed.Post,e,t)}apiCall(e,t,r=null){let n=this.apiUrl;switch(t&&t.length>0&&(n+="/"+t),e){case Ed.Get:case Ed.Post:return this.http.request(e,n,{body:r&&JSON.stringify(r),headers:this.apiHeaders||new zh,responseType:"json",withCredentials:!0,reportProgress:!0,observe:"body"}).pipe(oc(e=>{switch(e.status){case Cd.Unauthorized:this.router.navigate(["login"]);break;default:console.log(`No specific handler for error with status = ${e.status}`)}return nc(e.error)}));default:return nc("Method "+Ed[e]+"is not supported! See api-http service")}}}var Ed,Cd;!function(e){e.Get="get",e.Head="head",e.Post="post",e.Put="put",e.Patch="patch",e.Delete="delete",e.Connect="connect",e.Options="options",e.Trace="trace"}(Ed||(Ed={})),function(e){e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized"}(Cd||(Cd={}));class Pd{constructor(e){this.apiHttpService=e}login(e){return this.apiHttpService.apiPost("auth/login/",e)}register(e){return this.apiHttpService.apiPost("auth/register/",e)}}class Od{constructor(e,t){this.authDelegate=e,this.router=t,this.currentUser=this.setUserFromLocalStorage()}setUserFromLocalStorage(){try{return JSON.parse(localStorage.getItem("currentUser"))}catch(e){console.warn("LocalStorage unavailable")}}login(e,t){return this.authDelegate.login({login:e,password:t}).pipe(H(e=>{try{localStorage.setItem("currentUser",JSON.stringify(e))}catch(e){console.warn("LocalStorage unavailable")}return this.currentUser=e}))}logout(){this.currentUser=null;try{localStorage.removeItem("currentUser"),this.router.navigate(["login"])}catch(e){console.warn("LocalStorage unavailable")}}createUser(e,t){return this.authDelegate.register({login:e,password:t}).pipe(H(e=>this.currentUser=e))}}class Dd{constructor(e){this.apiHttpService=e}createLobby(e){return this.apiHttpService.apiPost("lobby/createLobby",{playersCount:e})}getLobbies(){return this.apiHttpService.apiGet("lobby/getLobbies")}quickStart(){return this.apiHttpService.apiPost("lobby/quickStart")}}class Nd{constructor(e){this.lobbyDelegate=e}createPracticeLobby(e=1){return this.lobbyDelegate.createLobby(e)}createLobby(e=2){return this.lobbyDelegate.createLobby(e)}getLobbies(){return this.lobbyDelegate.getLobbies()}quickStart(){return this.lobbyDelegate.quickStart()}}var Ld=r("gFX4"),Id=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Rd{static sleep(e){return Id(this,void 0,void 0,function*(){return new Promise(t=>{setTimeout(()=>{t()},e)})})}static wait(e,t=!0){return Id(this,void 0,void 0,function*(){return new Promise((r,n)=>{setTimeout(()=>{t?r():n("Rejected by timeout")},e)})})}static doWithFailTimeout(e,t){return Id(this,void 0,void 0,function*(){return Promise.race([e,Rd.wait(t,!1)])})}}var Fd=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})};class kd{constructor(){this.stepSubject=new O,this.finishSubject=new O}connectToLobby(e){return Fd(this,void 0,void 0,function*(){if(e.startsWith("::")){const t=+e.substr(2);let r=Md.BACKEND_URL;r.match(/:\d+\/?$/)&&(r=r.substr(0,r.lastIndexOf(":"))),e=`${r}:${t}`}try{return yield Rd.doWithFailTimeout(new Promise((t,r)=>{const n=(...e)=>{console.log("$%%%%% conn "+this.socket.id)},i=(...e)=>{s(),r("disconnected")},o=(...e)=>{console.log("$%%%%% lobbydata "+JSON.stringify(e)),s(),t()},s=()=>{this.socket.off("connect",n),this.socket.off("disconnect",i),this.socket.off("addedToLobby",o)};console.log(`Connecting to lobby ${e}...`),this.socket=this.initSocket(e),(()=>{this.socket.on("connect",n),this.socket.on("disconnect",i),this.socket.on("addedToLobby",o)})(),this.socket.connect()}),1e4)}catch(e){if(this.socket)return this.socket.disconnect(),Promise.reject(e)}})}socketAvailable(){return!!this.socket}disconnect(){this.socket.disconnect(),this.socket=null}readyToStart(e){this.carId=e.id,this.socket.emit("readyToStart",e)}nextStep(e){this.socket.emit("nextStep",e)}finished(e){console.log("emitting finished",{id:this.carId,stepsCount:e}),this.socket.emit("finished",{id:this.carId,stepsCount:e})}onStepComplete(e){this.stepSubject.next(e)}onRaceFinished(e){console.log("raceComplete. winner?",e===this.carId),this.finishSubject.next(e===this.carId),this.disconnect()}initSocket(e){const t=Ld(e);return t.on("connect",()=>{console.log("socket connected")}),t.on("disconnect",()=>{console.log("socket disconnected")}),t.on("error",e=>{console.log("ERROR: ",e)}),t.on("stepComplete",e=>this.onStepComplete(e)),t.on("raceFinished",e=>this.onRaceFinished(e)),t}}var Ud=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Bd{constructor(e,t,r,n){this.loginService=e,this.lobbyService=t,this.socketService=r,this.router=n}onPracticeClick(){this.lobbyService.createPracticeLobby().subscribe(e=>Ud(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(e.serverUrl),this.router.navigate(["/selectCars"])}catch(e){console.log("Can't connect to lobby"),console.error(e)}}))}onCreateLobby(e){+e<2?console.log("not creating lobby for 1 or less player"):this.lobbyService.createPracticeLobby(+e).subscribe(e=>Ud(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(e.serverUrl),this.router.navigate(["/selectCars"])}catch(e){console.log("Can't connect to lobby"),console.error(e)}}))}onPlayClick(){this.lobbyService.quickStart().subscribe(e=>Ud(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(e.serverUrl),this.router.navigate(["/selectCars"])}catch(e){console.log("Can't connect to lobby"),console.error(e)}}))}onSettingsClick(){}onExitClick(){this.loginService.logout()}}class jd extends O{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new E;return this._value}next(e){super.next(this._value=e)}}class zd extends Error{constructor(){super("no elements in sequence"),this.name="EmptyError",Object.setPrototypeOf(this,zd.prototype)}}function Vd(e,t){return r=>r.lift(new Gd(e,t,r))}class Gd{constructor(e,t,r){this.predicate=e,this.thisArg=t,this.source=r}call(e,t){return t.subscribe(new Hd(e,this.predicate,this.thisArg,this.source))}}class Hd extends x{constructor(e,t,r,n){super(e),this.predicate=t,this.thisArg=r,this.source=n,this.index=0,this.thisArg=r||this}notifyComplete(e){this.destination.next(e),this.destination.complete()}_next(e){let t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)}_complete(){this.notifyComplete(!0)}}class Wd extends Error{constructor(){super("argument out of range"),this.name="ArgumentOutOfRangeError",Object.setPrototypeOf(this,Wd.prototype)}}function Xd(e){return function(t){return 0===e?cc():t.lift(new qd(e))}}class qd{constructor(e){if(this.total=e,this.total<0)throw new Wd}call(e,t){return t.subscribe(new Yd(e,this.total))}}class Yd extends x{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,r=this.total,n=this.count++;if(t.length<r)t.push(e);else{t[n%r]=e}}_complete(){const e=this.destination;let t=this.count;if(t>0){const r=this.count>=this.total?this.total:this.count,n=this.ring;for(let i=0;i<r;i++){const i=t++%r;e.next(n[i])}}e.complete()}}function Jd(e,t,r){return function(n){return n.lift(new Zd(e,t,r))}}class Zd{constructor(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}call(e,t){return t.subscribe(new Qd(e,this.nextOrObserver,this.error,this.complete))}}class Qd extends x{constructor(e,t,r,n){super(e),this._tapNext=_,this._tapError=_,this._tapComplete=_,this._tapError=r||_,this._tapComplete=n||_,i(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||_,this._tapError=t.error||_,this._tapComplete=t.complete||_)}_next(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}const Kd=(e=function(){return new zd})=>Jd({hasValue:!1,next(){this.hasValue=!0},complete(){if(!this.hasValue)throw e()}});function $d(e=null){return t=>t.lift(new ep(e))}class ep{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new tp(e,this.defaultValue))}}class tp extends x{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function rp(e,t){const r=arguments.length>=2;return n=>n.pipe(e?dc((t,r)=>e(t,r,n)):K,Xd(1),r?$d(t):Kd(()=>new zd))}function np(e){return t=>0===e?cc():t.lift(new ip(e))}class ip{constructor(e){if(this.total=e,this.total<0)throw new Wd}call(e,t){return t.subscribe(new op(e,this.total))}}class op extends x{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,r=++this.count;r<=t&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))}}function sp(e,t){const r=arguments.length>=2;return n=>n.pipe(e?dc((t,r)=>e(t,r,n)):K,np(1),r?$d(t):Kd(()=>new zd))}function ap(e,t){let r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new lp(e,t,r))}}class lp{constructor(e,t,r=!1){this.accumulator=e,this.seed=t,this.hasSeed=r}call(e,t){return t.subscribe(new cp(e,this.accumulator,this.seed,this.hasSeed))}}class cp extends x{constructor(e,t,r,n){super(e),this.accumulator=t,this._seed=r,this.hasSeed=n,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let r;try{r=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=r,this.destination.next(r)}}function up(e,t){return arguments.length>=2?function(r){return S(ap(e,t),Xd(1),$d(t))(r)}:function(t){return S(ap((t,r,n)=>e(t,r,n+1)),Xd(1))(t)}}function hp(){return $(1)}let dp=null;function pp(){return dp}class fp{constructor(){this.resourceLoaderType=null}get attrToPropMap(){return this._attrToPropMap}set attrToPropMap(e){this._attrToPropMap=e}}class mp extends fp{constructor(){super(),this._animationPrefix=null,this._transitionEnd=null;try{const e=this.createElement("div",document);if(null!=this.getStyle(e,"animationName"))this._animationPrefix="";else{const t=["Webkit","Moz","O","ms"];for(let r=0;r<t.length;r++)if(null!=this.getStyle(e,t[r]+"AnimationName")){this._animationPrefix="-"+t[r].toLowerCase()+"-";break}}const t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(t).forEach(r=>{null!=this.getStyle(e,r)&&(this._transitionEnd=t[r])})}catch(e){this._animationPrefix=null,this._transitionEnd=null}}getDistributedNodes(e){return e.getDistributedNodes()}resolveAndSetHref(e,t,r){e.href=null==r?t:t+"/../"+r}supportsDOMEvents(){return!0}supportsNativeShadowDOM(){return"function"==typeof document.body.createShadowRoot}getAnimationPrefix(){return this._animationPrefix?this._animationPrefix:""}getTransitionEnd(){return this._transitionEnd?this._transitionEnd:""}supportsAnimation(){return null!=this._animationPrefix&&null!=this._transitionEnd}}const vp={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},gp=3,yp={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xp={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};let bp;Be.Node&&(bp=Be.Node.prototype.contains||function(e){return!!(16&this.compareDocumentPosition(e))});class wp extends mp{parse(e){throw new Error("parse not implemented")}static makeCurrent(){!function(e){dp||(dp=e)}(new wp)}hasProperty(e,t){return t in e}setProperty(e,t,r){e[t]=r}getProperty(e,t){return e[t]}invoke(e,t,r){e[t](...r)}logError(e){window.console&&(console.error?console.error(e):console.log(e))}log(e){window.console&&window.console.log&&window.console.log(e)}logGroup(e){window.console&&window.console.group&&window.console.group(e)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}get attrToPropMap(){return vp}contains(e,t){return bp.call(e,t)}querySelector(e,t){return e.querySelector(t)}querySelectorAll(e,t){return e.querySelectorAll(t)}on(e,t,r){e.addEventListener(t,r,!1)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}createMouseEvent(e){const t=this.getDefaultDocument().createEvent("MouseEvent");return t.initEvent(e,!0,!0),t}createEvent(e){const t=this.getDefaultDocument().createEvent("Event");return t.initEvent(e,!0,!0),t}preventDefault(e){e.preventDefault(),e.returnValue=!1}isPrevented(e){return e.defaultPrevented||null!=e.returnValue&&!e.returnValue}getInnerHTML(e){return e.innerHTML}getTemplateContent(e){return"content"in e&&this.isTemplateElement(e)?e.content:null}getOuterHTML(e){return e.outerHTML}nodeName(e){return e.nodeName}nodeValue(e){return e.nodeValue}type(e){return e.type}content(e){return this.hasProperty(e,"content")?e.content:e}firstChild(e){return e.firstChild}nextSibling(e){return e.nextSibling}parentElement(e){return e.parentNode}childNodes(e){return e.childNodes}childNodesAsList(e){const t=e.childNodes,r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=t[n];return r}clearNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}appendChild(e,t){e.appendChild(t)}removeChild(e,t){e.removeChild(t)}replaceChild(e,t,r){e.replaceChild(t,r)}remove(e){return e.parentNode&&e.parentNode.removeChild(e),e}insertBefore(e,t,r){e.insertBefore(r,t)}insertAllBefore(e,t,r){r.forEach(r=>e.insertBefore(r,t))}insertAfter(e,t,r){e.insertBefore(r,t.nextSibling)}setInnerHTML(e,t){e.innerHTML=t}getText(e){return e.textContent}setText(e,t){e.textContent=t}getValue(e){return e.value}setValue(e,t){e.value=t}getChecked(e){return e.checked}setChecked(e,t){e.checked=t}createComment(e){return this.getDefaultDocument().createComment(e)}createTemplate(e){const t=this.getDefaultDocument().createElement("template");return t.innerHTML=e,t}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createElementNS(e,t,r){return(r=r||this.getDefaultDocument()).createElementNS(e,t)}createTextNode(e,t){return(t=t||this.getDefaultDocument()).createTextNode(e)}createScriptTag(e,t,r){const n=(r=r||this.getDefaultDocument()).createElement("SCRIPT");return n.setAttribute(e,t),n}createStyleElement(e,t){const r=(t=t||this.getDefaultDocument()).createElement("style");return this.appendChild(r,this.createTextNode(e,t)),r}createShadowRoot(e){return e.createShadowRoot()}getShadowRoot(e){return e.shadowRoot}getHost(e){return e.host}clone(e){return e.cloneNode(!0)}getElementsByClassName(e,t){return e.getElementsByClassName(t)}getElementsByTagName(e,t){return e.getElementsByTagName(t)}classList(e){return Array.prototype.slice.call(e.classList,0)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}hasClass(e,t){return e.classList.contains(t)}setStyle(e,t,r){e.style[t]=r}removeStyle(e,t){e.style[t]=""}getStyle(e,t){return e.style[t]}hasStyle(e,t,r){const n=this.getStyle(e,t)||"";return r?n==r:n.length>0}tagName(e){return e.tagName}attributeMap(e){const t=new Map,r=e.attributes;for(let n=0;n<r.length;n++){const e=r.item(n);t.set(e.name,e.value)}return t}hasAttribute(e,t){return e.hasAttribute(t)}hasAttributeNS(e,t,r){return e.hasAttributeNS(t,r)}getAttribute(e,t){return e.getAttribute(t)}getAttributeNS(e,t,r){return e.getAttributeNS(t,r)}setAttribute(e,t,r){e.setAttribute(t,r)}setAttributeNS(e,t,r,n){e.setAttributeNS(t,r,n)}removeAttribute(e,t){e.removeAttribute(t)}removeAttributeNS(e,t,r){e.removeAttributeNS(t,r)}templateAwareRoot(e){return this.isTemplateElement(e)?this.content(e):e}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}getBoundingClientRect(e){try{return e.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}getTitle(e){return e.title}setTitle(e,t){e.title=t||""}elementMatches(e,t){return!!this.isElementNode(e)&&(e.matches&&e.matches(t)||e.msMatchesSelector&&e.msMatchesSelector(t)||e.webkitMatchesSelector&&e.webkitMatchesSelector(t))}isTemplateElement(e){return this.isElementNode(e)&&"TEMPLATE"===e.nodeName}isTextNode(e){return e.nodeType===Node.TEXT_NODE}isCommentNode(e){return e.nodeType===Node.COMMENT_NODE}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}hasShadowRoot(e){return null!=e.shadowRoot&&e instanceof HTMLElement}isShadowRoot(e){return e instanceof DocumentFragment}importIntoDoc(e){return document.importNode(this.templateAwareRoot(e),!0)}adoptNode(e){return document.adoptNode(e)}getHref(e){return e.getAttribute("href")}getEventKey(e){let t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),e.location===gp&&xp.hasOwnProperty(t)&&(t=xp[t]))}return yp[t]||t}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(e){const t=function(){if(!Sp&&!(Sp=document.querySelector("base")))return null;return Sp.getAttribute("href")}();return null==t?null:function(e){_p||(_p=document.createElement("a"));return _p.setAttribute("href",e),"/"===_p.pathname.charAt(0)?_p.pathname:"/"+_p.pathname}(t)}resetBaseElement(){Sp=null}getUserAgent(){return window.navigator.userAgent}setData(e,t,r){this.setAttribute(e,"data-"+t,r)}getData(e,t){return this.getAttribute(e,"data-"+t)}getComputedStyle(e){return getComputedStyle(e)}supportsWebAnimation(){return"function"==typeof Element.prototype.animate}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(e){return Cu(document.cookie,e)}setCookie(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)}}let _p,Sp=null;const Tp=kh;function Mp(){return!!window.history.pushState}class Ap extends vc{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=pp().getLocation(),this._history=pp().getHistory()}getBaseHrefFromDOM(){return pp().getBaseHref(this._doc)}onPopState(e){pp().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}onHashChange(e){pp().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,r){Mp()?this._history.pushState(e,t,r):this.location.hash=r}replaceState(e,t,r){Mp()?this._history.replaceState(e,t,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}}Ap.decorators=[{type:Rt}],Ap.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]}]);class Ep{constructor(e){this._doc=e,this._dom=pp()}addTag(e,t=!1){return e?this._getOrCreateElement(e,t):null}addTags(e,t=!1){return e?e.reduce((e,r)=>(r&&e.push(this._getOrCreateElement(r,t)),e),[]):[]}getTag(e){return e&&this._dom.querySelector(this._doc,`meta[${e}]`)||null}getTags(e){if(!e)return[];const t=this._dom.querySelectorAll(this._doc,`meta[${e}]`);return t?[].slice.call(t):[]}updateTag(e,t){if(!e)return null;t=t||this._parseSelector(e);const r=this.getTag(t);return r?this._setMetaElementAttributes(e,r):this._getOrCreateElement(e,!0)}removeTag(e){this.removeTagElement(this.getTag(e))}removeTagElement(e){e&&this._dom.remove(e)}_getOrCreateElement(e,t=!1){if(!t){const t=this._parseSelector(e),r=this.getTag(t);if(r&&this._containsAttributes(e,r))return r}const r=this._dom.createElement("meta");this._setMetaElementAttributes(e,r);const n=this._dom.getElementsByTagName(this._doc,"head")[0];return this._dom.appendChild(n,r),r}_setMetaElementAttributes(e,t){return Object.keys(e).forEach(r=>this._dom.setAttribute(t,r,e[r])),t}_parseSelector(e){const t=e.name?"name":"property";return`${t}="${e[t]}"`}_containsAttributes(e,t){return Object.keys(e).every(r=>this._dom.getAttribute(t,r)===e[r])}}Ep.decorators=[{type:Rt}],Ep.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]}]);const Cp=new pe("TRANSITION_ID");const Pp=[{provide:gr,useFactory:function(e,t,r){return()=>{r.get(yr).donePromise.then(()=>{const r=pp();Array.prototype.slice.apply(r.querySelectorAll(t,"style[ng-transition]")).filter(t=>r.getAttribute(t,"ng-transition")===e).forEach(e=>r.remove(e))})}},deps:[Cp,Tp,ut],multi:!0}];class Op{static init(){!function(e){tn=e}(new Op)}addToWindow(e){Be.getAngularTestability=((t,r=!0)=>{const n=e.findTestabilityInTree(t,r);if(null==n)throw new Error("Could not find testability for element.");return n}),Be.getAllAngularTestabilities=(()=>e.getAllTestabilities()),Be.getAllAngularRootElements=(()=>e.getAllRootElements());Be.frameworkStabilizers||(Be.frameworkStabilizers=[]),Be.frameworkStabilizers.push(e=>{const t=Be.getAllAngularTestabilities();let r=t.length,n=!1;const i=function(t){n=n||t,0==--r&&e(n)};t.forEach(function(e){e.whenStable(i)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const n=e.getTestability(t);return null!=n?n:r?pp().isShadowRoot(t)?this.findTestabilityInTree(e,pp().getHost(t),!0):this.findTestabilityInTree(e,pp().parentElement(t),!0):null}}class Dp{constructor(e){this._doc=e}getTitle(){return pp().getTitle(this._doc)}setTitle(e){pp().setTitle(this._doc,e)}}function Np(e,t){if("undefined"==typeof COMPILED||!COMPILED){(Be.ng=Be.ng||{})[e]=t}}Dp.decorators=[{type:Rt}],Dp.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]}]);const Lp={ApplicationRef:dn,NgZone:Wr},Ip="probe",Rp="coreTokens";function Fp(e){return In(e)}function kp(e){return Np(Ip,Fp),Np(Rp,Object.assign({},Lp,function(e){return e.reduce((e,t)=>(e[t.name]=t.token,e),{})}(e||[]))),()=>Fp}const Up=[{provide:gr,useFactory:kp,deps:[[an,new tt]],multi:!0}],Bp=new pe("EventManagerPlugins");class jp{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,r){return this._findPluginFor(t).addEventListener(e,t,r)}addGlobalEventListener(e,t,r){return this._findPluginFor(t).addGlobalEventListener(e,t,r)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const r=this._plugins;for(let n=0;n<r.length;n++){const t=r[n];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}jp.decorators=[{type:Rt}],jp.ctorParameters=(()=>[{type:Array,decorators:[{type:et,args:[Bp]}]},{type:Wr}]);class zp{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const n=pp().getGlobalEventTarget(this._doc,e);if(!n)throw new Error(`Unsupported event target ${n} for event ${t}`);return this.addEventListener(n,t,r)}}class Vp{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}Vp.decorators=[{type:Rt}],Vp.ctorParameters=(()=>[]);class Gp extends Vp{constructor(e){super(),this._doc=e,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(e.head)}_addStylesToHost(e,t){e.forEach(e=>{const r=this._doc.createElement("style");r.textContent=e,this._styleNodes.add(t.appendChild(r))})}addHost(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}removeHost(e){this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach(t=>this._addStylesToHost(e,t))}ngOnDestroy(){this._styleNodes.forEach(e=>pp().remove(e))}}Gp.decorators=[{type:Rt}],Gp.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]}]);const Hp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Wp=/%COMP%/g,Xp="_nghost-%COMP%",qp="_ngcontent-%COMP%";function Yp(e,t,r){for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)?Yp(e,i,r):(i=i.replace(Wp,e),r.push(i))}return r}function Jp(e){return t=>{!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}class Zp{constructor(e,t){this.eventManager=e,this.sharedStylesHost=t,this.rendererByCompId=new Map,this.defaultRenderer=new Qp(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case kt.Emulated:{let r=this.rendererByCompId.get(t.id);return r||(r=new ef(this.eventManager,this.sharedStylesHost,t),this.rendererByCompId.set(t.id,r)),r.applyToHost(e),r}case kt.Native:return new tf(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=Yp(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}Zp.decorators=[{type:Rt}],Zp.ctorParameters=(()=>[{type:jp},{type:Gp}]);class Qp{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(Hp[t],e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e){let t="string"==typeof e?document.querySelector(e):e;if(!t)throw new Error(`The selector "${e}" did not match any elements`);return t.textContent="",t}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,n){if(n){t=`${n}:${t}`;const i=Hp[n];i?e.setAttributeNS(i,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const n=Hp[r];n?e.removeAttributeNS(n,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,n){n&vn.DashCase?e.style.setProperty(t,r,n&vn.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&vn.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){$p(t,"property"),e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return $p(t,"listener"),"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Jp(r)):this.eventManager.addEventListener(e,t,Jp(r))}}const Kp="@".charCodeAt(0);function $p(e,t){if(e.charCodeAt(0)===Kp)throw new Error(`Found the synthetic ${t} ${e}. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.`)}class ef extends Qp{constructor(e,t,r){super(e),this.component=r;const n=Yp(r.id,r.styles,[]);t.addStyles(n),this.contentAttr=function(e){return qp.replace(Wp,e)}(r.id),this.hostAttr=function(e){return Xp.replace(Wp,e)}(r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class tf extends Qp{constructor(e,t,r,n){super(e),this.sharedStylesHost=t,this.hostEl=r,this.component=n,this.shadowRoot=r.createShadowRoot(),this.sharedStylesHost.addHost(this.shadowRoot);const i=Yp(n.id,n.styles,[]);for(let o=0;o<i.length;o++){const e=document.createElement("style");e.textContent=i[o],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}const rf="undefined"!=typeof Zone&&Zone.__symbol__||function(e){return"__zone_symbol__"+e},nf=rf("addEventListener"),of=rf("removeEventListener"),sf={},af="FALSE",lf="ANGULAR",cf="addEventListener",uf="removeEventListener",hf="__zone_symbol__propagationStopped",df="__zone_symbol__stopImmediatePropagation",pf="undefined"!=typeof Zone&&Zone[rf("BLACK_LISTED_EVENTS")];let ff;pf&&(ff={},pf.forEach(e=>{ff[e]=e}));const mf=function(e){return!!ff&&ff.hasOwnProperty(e)},vf=function(e){const t=sf[e.type];if(!t)return;const r=this[t];if(!r)return;const n=[e];if(1===r.length){const e=r[0];return e.zone!==Zone.current?e.zone.run(e.handler,this,n):e.handler.apply(this,n)}{const t=r.slice();for(let r=0;r<t.length&&!0!==e[hf];r++){const e=t[r];e.zone!==Zone.current?e.zone.run(e.handler,this,n):e.handler.apply(this,n)}}};class gf extends zp{constructor(e,t){super(e),this.ngZone=t,this.patchEvent()}patchEvent(){if(!Event||!Event.prototype)return;if(Event.prototype[df])return;const e=Event.prototype[df]=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[hf]=!0),e&&e.apply(this,arguments)}}supports(e){return!0}addEventListener(e,t,r){let n=r;if(!e[nf]||Wr.isInAngularZone()&&!mf(t))e[cf](t,n,!1);else{let r=sf[t];r||(r=sf[t]=rf(lf+t+af));let i=e[r];const o=i&&i.length>0;i||(i=e[r]=[]);const s=mf(t)?Zone.root:Zone.current;if(0===i.length)i.push({zone:s,handler:n});else{let e=!1;for(let t=0;t<i.length;t++)if(i[t].handler===n){e=!0;break}e||i.push({zone:s,handler:n})}o||e[nf](t,vf,!1)}return()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,r){let n=e[of];if(!n)return e[uf].apply(e,[t,r,!1]);let i=sf[t],o=i&&e[i];if(!o)return e[uf].apply(e,[t,r,!1]);let s=!1;for(let a=0;a<o.length;a++)if(o[a].handler===r){s=!0,o.splice(a,1);break}s?0===o.length&&n.apply(e,[t,vf,!1]):e[uf].apply(e,[t,r,!1])}}gf.decorators=[{type:Rt}],gf.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]},{type:Wr}]);const yf={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},xf=new pe("HammerGestureConfig");class bf{constructor(){this.events=[],this.overrides={}}buildHammer(e){const t=new Hammer(e,this.options);t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0});for(const r in this.overrides)t.get(r).set(this.overrides[r]);return t}}bf.decorators=[{type:Rt}],bf.ctorParameters=(()=>[]);class wf extends zp{constructor(e,t,r){super(e),this._config=t,this.console=r}supports(e){return!(!yf.hasOwnProperty(e.toLowerCase())&&!this.isCustomEvent(e))&&(!!window.Hammer||(this.console.warn(`Hammer.js is not loaded, can not bind '${e}' event.`),!1))}addEventListener(e,t,r){const n=this.manager.getZone();return t=t.toLowerCase(),n.runOutsideAngular(()=>{const i=this._config.buildHammer(e),o=function(e){n.runGuarded(function(){r(e)})};return i.on(t,o),()=>i.off(t,o)})}isCustomEvent(e){return this._config.events.indexOf(e)>-1}}wf.decorators=[{type:Rt}],wf.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]},{type:bf,decorators:[{type:et,args:[xf]}]},{type:Ar}]);const _f=["alt","control","meta","shift"],Sf={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};class Tf extends zp{constructor(e){super(e)}supports(e){return null!=Tf.parseEventName(e)}addEventListener(e,t,r){const n=Tf.parseEventName(t),i=Tf.eventCallback(n.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>pp().onAndCancel(e,n.domEventName,i))}static parseEventName(e){const t=e.toLowerCase().split("."),r=t.shift();if(0===t.length||"keydown"!==r&&"keyup"!==r)return null;const n=Tf._normalizeKey(t.pop());let i="";if(_f.forEach(e=>{const r=t.indexOf(e);r>-1&&(t.splice(r,1),i+=e+".")}),i+=n,0!=t.length||0===n.length)return null;const o={};return o.domEventName=r,o.fullKey=i,o}static getEventFullKey(e){let t="",r=pp().getEventKey(e);return" "===(r=r.toLowerCase())?r="space":"."===r&&(r="dot"),_f.forEach(n=>{if(n!=r){(0,Sf[n])(e)&&(t+=n+".")}}),t+=r}static eventCallback(e,t,r){return n=>{Tf.getEventFullKey(n)===e&&r.runGuarded(()=>t(n))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}Tf.decorators=[{type:Rt}],Tf.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]}]);class Mf{}class Af extends Mf{constructor(e){super(),this._doc=e}sanitize(e,t){if(null==t)return null;switch(e){case ki.NONE:return t;case ki.HTML:return t instanceof Cf?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"HTML"),Ni(this._doc,String(t)));case ki.STYLE:return t instanceof Pf?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"Style"),Fi(t));case ki.SCRIPT:if(t instanceof Of)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"Script"),new Error("unsafe value used in a script context");case ki.URL:return t instanceof Nf||t instanceof Df?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"URL"),di(String(t)));case ki.RESOURCE_URL:if(t instanceof Nf)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see http://g.co/ng/security#xss)`)}}checkNotSafeValue(e,t){if(e instanceof Ef)throw new Error(`Required a safe ${t}, got a ${e.getTypeName()} `+"(see http://g.co/ng/security#xss)")}bypassSecurityTrustHtml(e){return new Cf(e)}bypassSecurityTrustStyle(e){return new Pf(e)}bypassSecurityTrustScript(e){return new Of(e)}bypassSecurityTrustUrl(e){return new Df(e)}bypassSecurityTrustResourceUrl(e){return new Nf(e)}}Af.decorators=[{type:Rt}],Af.ctorParameters=(()=>[{type:void 0,decorators:[{type:et,args:[Tp]}]}]);class Ef{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity}`+" (see http://g.co/ng/security#xss)"}}class Cf extends Ef{getTypeName(){return"HTML"}}class Pf extends Ef{getTypeName(){return"Style"}}class Of extends Ef{getTypeName(){return"Script"}}class Df extends Ef{getTypeName(){return"URL"}}class Nf extends Ef{getTypeName(){return"ResourceURL"}}const Lf=[{provide:Ui,useExisting:Mf},{provide:Mf,useClass:Af,deps:[Tp]}],If=ln(ri,"browser",[{provide:Tr,useValue:Uh},{provide:Sr,useValue:function(){wp.makeCurrent(),Op.init()},multi:!0},{provide:vc,useClass:Ap,deps:[Tp]},{provide:Tp,useFactory:function(){return document},deps:[]}]);function Rf(){return new Xt}class Ff{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:Ff,providers:[{provide:xr,useValue:e.appId},{provide:Cp,useExisting:xr},Pp]}}}Ff.decorators=[{type:Ft,args:[{providers:[Lf,{provide:fr,useValue:!0},{provide:Xt,useFactory:Rf,deps:[]},{provide:Bp,useClass:gf,multi:!0},{provide:Bp,useClass:Tf,multi:!0},{provide:Bp,useClass:wf,multi:!0},{provide:xf,useClass:bf},Zp,{provide:mn,useExisting:Zp},{provide:Vp,useExisting:Gp},Gp,Kr,jp,Up,Ep,Dp],exports:[Ih,li]}]}],Ff.ctorParameters=(()=>[{type:Ff,decorators:[{type:tt},{type:nt}]}]);"undefined"!=typeof window&&window;class kf{constructor(){this.store={},this.onSerializeCallbacks={}}static init(e){const t=new kf;return t.store=e,t}get(e,t){return void 0!==this.store[e]?this.store[e]:t}set(e,t){this.store[e]=t}remove(e){delete this.store[e]}hasKey(e){return this.store.hasOwnProperty(e)}onSerialize(e,t){this.onSerializeCallbacks[e]=t}toJson(){for(const e in this.onSerializeCallbacks)if(this.onSerializeCallbacks.hasOwnProperty(e))try{this.store[e]=this.onSerializeCallbacks[e]()}catch(e){console.warn("Exception in onSerialize callback: ",e)}return JSON.stringify(this.store)}}kf.decorators=[{type:Rt}],kf.ctorParameters=(()=>[]);class Uf{}Uf.decorators=[{type:Ft,args:[{providers:[{provide:kf,useFactory:function(e,t){const r=e.getElementById(t+"-state");let n={};if(r&&r.textContent)try{n=JSON.parse(function(e){const t={"&a;":"&","&q;":'"',"&s;":"'","&l;":"<","&g;":">"};return e.replace(/&[^;]+;/g,e=>t[e])}(r.textContent))}catch(e){console.warn("Exception while restoring TransferState for app "+t,e)}return kf.init(n)},deps:[Tp,xr]}]}]}],Uf.ctorParameters=(()=>[]);new Ut("6.0.0");class Bf{constructor(e,t){this.id=e,this.url=t}}class jf extends Bf{constructor(e,t,r="imperative",n=null){super(e,t),this.navigationTrigger=r,this.restoredState=n}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class zf extends Bf{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Vf extends Bf{constructor(e,t,r){super(e,t),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Gf extends Bf{constructor(e,t,r){super(e,t),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Hf extends Bf{constructor(e,t,r,n){super(e,t),this.urlAfterRedirects=r,this.state=n}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Wf extends Bf{constructor(e,t,r,n){super(e,t),this.urlAfterRedirects=r,this.state=n}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Xf extends Bf{constructor(e,t,r,n,i){super(e,t),this.urlAfterRedirects=r,this.state=n,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class qf extends Bf{constructor(e,t,r,n){super(e,t),this.urlAfterRedirects=r,this.state=n}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Yf extends Bf{constructor(e,t,r,n){super(e,t),this.urlAfterRedirects=r,this.state=n}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Jf{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Zf{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Qf{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Kf{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $f{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class em{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}const tm="primary";class rm{constructor(e){this.params=e||{}}has(e){return this.params.hasOwnProperty(e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function nm(e){return new rm(e)}const im="ngNavigationCancelingError";function om(e,t,r){const n=r.path.split("/");if(n.length>e.length)return null;if("full"===r.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const i={};for(let o=0;o<n.length;o++){const t=n[o],r=e[o];if(t.startsWith(":"))i[t.substring(1)]=r;else if(t!==r.path)return null}return{consumed:e.slice(0,n.length),posParams:i}}class sm{constructor(e,t){this.routes=e,this.module=t}}function am(e,t=""){for(let r=0;r<e.length;r++){const n=e[r];lm(n,cm(t,n))}}function lm(e,t){if(!e)throw new Error(`\n      Invalid configuration of route '${t}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(e))throw new Error(`Invalid configuration of route '${t}': Array cannot be specified`);if(!e.component&&e.outlet&&e.outlet!==tm)throw new Error(`Invalid configuration of route '${t}': a componentless route cannot have a named outlet set`);if(e.redirectTo&&e.children)throw new Error(`Invalid configuration of route '${t}': redirectTo and children cannot be used together`);if(e.redirectTo&&e.loadChildren)throw new Error(`Invalid configuration of route '${t}': redirectTo and loadChildren cannot be used together`);if(e.children&&e.loadChildren)throw new Error(`Invalid configuration of route '${t}': children and loadChildren cannot be used together`);if(e.redirectTo&&e.component)throw new Error(`Invalid configuration of route '${t}': redirectTo and component cannot be used together`);if(e.path&&e.matcher)throw new Error(`Invalid configuration of route '${t}': path and matcher cannot be used together`);if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error(`Invalid configuration of route '${t}'. One of the following must be provided: component, redirectTo, children or loadChildren`);if(void 0===e.path&&void 0===e.matcher)throw new Error(`Invalid configuration of route '${t}': routes must have either a path or a matcher specified`);if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error(`Invalid configuration of route '${t}': path cannot start with a slash`);if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch){const r="The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.";throw new Error(`Invalid configuration of route '{path: "${t}", redirectTo: "${e.redirectTo}"}': please provide 'pathMatch'. ${r}`)}if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error(`Invalid configuration of route '${t}': pathMatch can only be set to 'prefix' or 'full'`);e.children&&am(e.children,t)}function cm(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function um(e){const t=e.children&&e.children.map(um);return t?Object.assign({},e,{children:t}):Object.assign({},e)}function hm(e,t){const r=Object.keys(e),n=Object.keys(t);if(r.length!=n.length)return!1;let i;for(let o=0;o<r.length;o++)if(e[i=r[o]]!==t[i])return!1;return!0}function dm(e){return Array.prototype.concat.apply([],e)}function pm(e){return e.length>0?e[e.length-1]:null}function fm(e,t){for(const r in e)e.hasOwnProperty(r)&&t(e[r],r)}function mm(e){return e.pipe($(),Vd(e=>!0===e))}function vm(e){return vr(e)?e:mr(e)?Y(Promise.resolve(e)):hc(e)}function gm(e,t,r){return r?function(e,t){return hm(e,t)}(e.queryParams,t.queryParams)&&function e(t,r){if(!_m(t.segments,r.segments))return!1;if(t.numberOfChildren!==r.numberOfChildren)return!1;for(const n in r.children){if(!t.children[n])return!1;if(!e(t.children[n],r.children[n]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(r=>t[r]===e[r])}(e.queryParams,t.queryParams)&&ym(e.root,t.root)}function ym(e,t){return function e(t,r,n){if(t.segments.length>n.length){const e=t.segments.slice(0,n.length);return!!_m(e,n)&&!r.hasChildren()}if(t.segments.length===n.length){if(!_m(t.segments,n))return!1;for(const e in r.children){if(!t.children[e])return!1;if(!ym(t.children[e],r.children[e]))return!1}return!0}{const i=n.slice(0,t.segments.length),o=n.slice(t.segments.length);return!!_m(t.segments,i)&&(!!t.children[tm]&&e(t.children[tm],r,o))}}(e,t,t.segments)}class xm{constructor(e,t,r){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=nm(this.queryParams)),this._queryParamMap}toString(){return Am.serialize(this)}}class bm{constructor(e,t){this.segments=e,this.children=t,this.parent=null,fm(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Em(this)}}class wm{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=nm(this.parameters)),this._parameterMap}toString(){return Lm(this)}}function _m(e,t){return e.length===t.length&&e.every((e,r)=>e.path===t[r].path)}function Sm(e,t){let r=[];return fm(e.children,(e,n)=>{n===tm&&(r=r.concat(t(e,n)))}),fm(e.children,(e,n)=>{n!==tm&&(r=r.concat(t(e,n)))}),r}class Tm{}class Mm{parse(e){const t=new Um(e);return new xm(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){return`${`/${function e(t,r){if(!t.hasChildren())return Em(t);if(r){const r=t.children[tm]?e(t.children[tm],!1):"",n=[];return fm(t.children,(t,r)=>{r!==tm&&n.push(`${r}:${e(t,!1)}`)}),n.length>0?`${r}(${n.join("//")})`:r}{const r=Sm(t,(r,n)=>n===tm?[e(t.children[tm],!1)]:[`${n}:${e(r,!1)}`]);return`${Em(t)}/(${r.join("//")})`}}(e.root,!0)}`}${function(e){const t=Object.keys(e).map(t=>{const r=e[t];return Array.isArray(r)?r.map(e=>`${Pm(t)}=${Pm(e)}`).join("&"):`${Pm(t)}=${Pm(r)}`});return t.length?`?${t.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${function(e){return encodeURI(e)}(e.fragment)}`:""}`}}const Am=new Mm;function Em(e){return e.segments.map(e=>Lm(e)).join("/")}function Cm(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Pm(e){return Cm(e).replace(/%3B/gi,";")}function Om(e){return Cm(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Dm(e){return decodeURIComponent(e)}function Nm(e){return Dm(e.replace(/\+/g,"%20"))}function Lm(e){return`${Om(e.path)}${function(e){return Object.keys(e).map(t=>`;${Om(t)}=${Om(e[t])}`).join("")}(e.parameters)}`}const Im=/^[^\/()?;=&#]+/;function Rm(e){const t=e.match(Im);return t?t[0]:""}const Fm=/^[^=?&#]+/;const km=/^[^?&#]+/;class Um{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new bm([],{}):new bm([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[tm]=new bm(e,t)),r}parseSegment(){const e=Rm(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new wm(Dm(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Rm(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const e=Rm(this.remaining);e&&(r=e,this.capture(r))}e[Dm(t)]=Dm(r)}parseQueryParam(e){const t=function(e){const t=e.match(Fm);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(km);return t?t[0]:""}(this.remaining);e&&(r=e,this.capture(r))}const n=Nm(t),i=Nm(r);if(e.hasOwnProperty(n)){let t=e[n];Array.isArray(t)||(t=[t],e[n]=t),t.push(i)}else e[n]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Rm(this.remaining),n=this.remaining[r.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;r.indexOf(":")>-1?(i=r.substr(0,r.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=tm);const o=this.parseChildren();t[i]=1===Object.keys(o).length?o[tm]:new bm([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class Bm{constructor(e){this.segmentGroup=e||null}}class jm{constructor(e){this.urlTree=e}}function zm(e){return new M(t=>t.error(new Bm(e)))}function Vm(e){return new M(t=>t.error(new jm(e)))}function Gm(e){return new M(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}function Hm(e){return new M(t=>t.error(function(e){const t=Error("NavigationCancelingError: "+e);return t[im]=!0,t}(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}class Wm{constructor(e,t,r,n,i){this.configLoader=t,this.urlSerializer=r,this.urlTree=n,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(kr)}apply(){return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,tm).pipe(H(e=>this.createUrlTree(e,this.urlTree.queryParams,this.urlTree.fragment))).pipe(oc(e=>{if(e instanceof jm)return this.allowRedirects=!1,this.match(e.urlTree);if(e instanceof Bm)throw this.noMatchError(e);throw e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,tm).pipe(H(t=>this.createUrlTree(t,e.queryParams,e.fragment))).pipe(oc(e=>{if(e instanceof Bm)throw this.noMatchError(e);throw e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,r){const n=e.segments.length>0?new bm([],{[tm]:e}):e;return new xm(n,t,r)}expandSegmentGroup(e,t,r,n){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe(H(e=>new bm([],e))):this.expandSegment(e,r,t,r.segments,n,!0)}expandChildren(e,t,r){return function(e,t){if(0===Object.keys(e).length)return hc({});const r=[],n=[],i={};return fm(e,(e,o)=>{const s=t(o,e).pipe(H(e=>i[o]=e));o===tm?r.push(s):n.push(s)}),hc.apply(null,r.concat(n)).pipe(hp(),rp(),H(()=>i))}(r.children,(r,n)=>this.expandSegmentGroup(e,t,n,r))}expandSegment(e,t,r,n,i,o){return hc(...r).pipe(H(s=>{return this.expandSegmentAgainstRoute(e,t,r,s,n,i,o).pipe(oc(e=>{if(e instanceof Bm)return hc(null);throw e}))}),hp(),sp(e=>!!e),oc((e,r)=>{if(e instanceof zd||"EmptyError"===e.name){if(this.noLeftoversInUrl(t,n,i))return hc(new bm([],{}));throw new Bm(t)}throw e}))}noLeftoversInUrl(e,t,r){return 0===t.length&&!e.children[r]}expandSegmentAgainstRoute(e,t,r,n,i,o,s){return Jm(n)!==o?zm(t):void 0===n.redirectTo?this.matchSegmentAgainstRoute(e,t,n,i):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,n,i,o):zm(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,n,i,o){return"**"===n.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,n,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,n,i,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,n){const i=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?Vm(i):this.lineralizeSegments(r,i).pipe(J(r=>{const i=new bm(r,{});return this.expandSegment(e,i,t,r,n,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,n,i,o){const{matched:s,consumedSegments:a,lastChild:l,positionalParamSegments:c}=Xm(t,n,i);if(!s)return zm(t);const u=this.applyRedirectCommands(a,n.redirectTo,c);return n.redirectTo.startsWith("/")?Vm(u):this.lineralizeSegments(n,u).pipe(J(n=>this.expandSegment(e,t,r,n.concat(i.slice(l)),o,!1)))}matchSegmentAgainstRoute(e,t,r,n){if("**"===r.path)return r.loadChildren?this.configLoader.load(e.injector,r).pipe(H(e=>(r._loadedConfig=e,new bm(n,{})))):hc(new bm(n,{}));const{matched:i,consumedSegments:o,lastChild:s}=Xm(t,r,n);if(!i)return zm(t);const a=n.slice(s);return this.getChildConfig(e,r).pipe(J(e=>{const r=e.module,n=e.routes,{segmentGroup:i,slicedSegments:s}=function(e,t,r,n){if(r.length>0&&function(e,t,r){return r.some(r=>Ym(e,t,r)&&Jm(r)!==tm)}(e,r,n)){const i=new bm(t,function(e,t){const r={};r[tm]=t;for(const n of e)""===n.path&&Jm(n)!==tm&&(r[Jm(n)]=new bm([],{}));return r}(n,new bm(r,e.children)));return{segmentGroup:qm(i),slicedSegments:[]}}if(0===r.length&&function(e,t,r){return r.some(r=>Ym(e,t,r))}(e,r,n)){const t=new bm(e.segments,function(e,t,r,n){const i={};for(const o of r)Ym(e,t,o)&&!n[Jm(o)]&&(i[Jm(o)]=new bm([],{}));return Object.assign({},n,i)}(e,r,n,e.children));return{segmentGroup:qm(t),slicedSegments:r}}return{segmentGroup:e,slicedSegments:r}}(t,o,a,n);if(0===s.length&&i.hasChildren()){return this.expandChildren(r,n,i).pipe(H(e=>new bm(o,e)))}return 0===n.length&&0===s.length?hc(new bm(o,{})):this.expandSegment(r,i,n,s,tm,!0).pipe(H(e=>new bm(o.concat(e.segments),e.children)))}))}getChildConfig(e,t){return t.children?hc(new sm(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?hc(t._loadedConfig):function(e,t){const r=t.canLoad;return r&&0!==r.length?mm(Y(r).pipe(H(r=>{const n=e.get(r);return vm(n.canLoad?n.canLoad(t):n(t))}))):hc(!0)}(e.injector,t).pipe(J(r=>r?this.configLoader.load(e.injector,t).pipe(H(e=>(t._loadedConfig=e,e))):Hm(t))):hc(new sm([],e))}lineralizeSegments(e,t){let r=[],n=t.root;for(;;){if(r=r.concat(n.segments),0===n.numberOfChildren)return hc(r);if(n.numberOfChildren>1||!n.children[tm])return Gm(e.redirectTo);n=n.children[tm]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreatreUrlTree(e,t,r,n){const i=this.createSegmentGroup(e,t.root,r,n);return new xm(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return fm(e,(e,n)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);r[n]=t[i]}else r[n]=e}),r}createSegmentGroup(e,t,r,n){const i=this.createSegments(e,t.segments,r,n);let o={};return fm(t.children,(t,i)=>{o[i]=this.createSegmentGroup(e,t,r,n)}),new bm(i,o)}createSegments(e,t,r,n){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,n):this.findOrReturn(t,r))}findPosParam(e,t,r){const n=r[t.path.substring(1)];if(!n)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return n}findOrReturn(e,t){let r=0;for(const n of t){if(n.path===e.path)return t.splice(r),n;r++}return e}}function Xm(e,t,r){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||r.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};const n=(t.matcher||om)(r,e,t);return n?{matched:!0,consumedSegments:n.consumed,lastChild:n.consumed.length,positionalParamSegments:n.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function qm(e){if(1===e.numberOfChildren&&e.children[tm]){const t=e.children[tm];return new bm(e.segments.concat(t.segments),t.children)}return e}function Ym(e,t,r){return(!(e.hasChildren()||t.length>0)||"full"!==r.pathMatch)&&(""===r.path&&void 0!==r.redirectTo)}function Jm(e){return e.outlet||tm}class Zm{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Qm(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=Qm(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=Km(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return Km(e,this._root).map(e=>e.value)}}function Qm(e,t){if(e===t.value)return t;for(const r of t.children){const t=Qm(e,r);if(t)return t}return null}function Km(e,t){if(e===t.value)return[t];for(const r of t.children){const n=Km(e,r);if(n.length)return n.unshift(t),n}return[]}class $m{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ev(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class tv extends Zm{constructor(e,t){super(e),this.snapshot=t,av(this,e)}toString(){return this.snapshot.toString()}}function rv(e,t){const r=function(e,t){const r=new ov([],{},{},"",{},tm,t,null,e.root,-1,{});return new sv("",new $m(r,[]))}(e,t),n=new jd([new wm("",{})]),i=new jd({}),o=new jd({}),s=new jd({}),a=new jd(""),l=new nv(n,i,s,a,o,tm,t,r.root);return l.snapshot=r.root,new tv(new $m(l,[]),r)}class nv{constructor(e,t,r,n,i,o,s,a){this.url=e,this.params=t,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(H(e=>nm(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(H(e=>nm(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function iv(e,t="emptyOnly"){const r=e.pathFromRoot;let n=0;if("always"!==t)for(n=r.length-1;n>=1;){const e=r[n],t=r[n-1];if(e.routeConfig&&""===e.routeConfig.path)n--;else{if(t.component)break;n--}}return function(e){return e.reduce((e,t)=>{const r=Object.assign({},e.params,t.params),n=Object.assign({},e.data,t.data),i=Object.assign({},e.resolve,t._resolvedData);return{params:r,data:n,resolve:i}},{params:{},data:{},resolve:{}})}(r.slice(n))}class ov{constructor(e,t,r,n,i,o,s,a,l,c,u){this.url=e,this.params=t,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=s,this.routeConfig=a,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=nm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=nm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class sv extends Zm{constructor(e,t){super(t),this.url=e,av(this,t)}toString(){return lv(this._root)}}function av(e,t){t.value._routerState=e,t.children.forEach(t=>av(e,t))}function lv(e){const t=e.children.length>0?` { ${e.children.map(lv).join(", ")} } `:"";return`${e.value}${t}`}function cv(e){if(e.snapshot){const t=e.snapshot,r=e._futureSnapshot;e.snapshot=r,hm(t.queryParams,r.queryParams)||e.queryParams.next(r.queryParams),t.fragment!==r.fragment&&e.fragment.next(r.fragment),hm(t.params,r.params)||e.params.next(r.params),function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!hm(e[r],t[r]))return!1;return!0}(t.url,r.url)||e.url.next(r.url),hm(t.data,r.data)||e.data.next(r.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function uv(e,t){const r=hm(e.params,t.params)&&function(e,t){return _m(e,t)&&e.every((e,r)=>hm(e.parameters,t[r].parameters))}(e.url,t.url),n=!e.parent!=!t.parent;return r&&!n&&(!e.parent||uv(e.parent,t.parent))}function hv(e,t,r){if(r&&e.shouldReuseRoute(t.value,r.value.snapshot)){const n=r.value;n._futureSnapshot=t.value;const i=function(e,t,r){return t.children.map(t=>{for(const n of r.children)if(e.shouldReuseRoute(n.value.snapshot,t.value))return hv(e,t,n);return hv(e,t)})}(e,t,r);return new $m(n,i)}{const r=e.retrieve(t.value);if(r){const e=r.route;return function e(t,r){if(t.value.routeConfig!==r.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==r.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");r.value._futureSnapshot=t.value;for(let n=0;n<t.children.length;++n)e(t.children[n],r.children[n])}(t,e),e}{const r=function(e){return new nv(new jd(e.url),new jd(e.params),new jd(e.queryParams),new jd(e.fragment),new jd(e.data),e.outlet,e.component,e)}(t.value),n=t.children.map(t=>hv(e,t));return new $m(r,n)}}}function dv(e,t,r,n,i){if(0===r.length)return fv(t.root,t.root,t,n,i);const o=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new mv(!0,0,e);let t=0,r=!1;const n=e.reduce((e,n,i)=>{if("object"==typeof n&&null!=n){if(n.outlets){const t={};return fm(n.outlets,(e,r)=>{t[r]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(n.segmentPath)return[...e,n.segmentPath]}return"string"!=typeof n?[...e,n]:0===i?(n.split("/").forEach((n,i)=>{0==i&&"."===n||(0==i&&""===n?r=!0:".."===n?t++:""!=n&&e.push(n))}),e):[...e,n]},[]);return new mv(r,t,n)}(r);if(o.toRoot())return fv(t.root,new bm([],{}),t,n,i);const s=function(e,t,r){if(e.isAbsolute)return new vv(t.root,!0,0);if(-1===r.snapshot._lastPathIndex)return new vv(r.snapshot._urlSegment,!0,0);const n=pv(e.commands[0])?0:1,i=r.snapshot._lastPathIndex+n;return function(e,t,r){let n=e,i=t,o=r;for(;o>i;){if(o-=i,!(n=n.parent))throw new Error("Invalid number of '../'");i=n.segments.length}return new vv(n,!1,i-o)}(r.snapshot._urlSegment,i,e.numberOfDoubleDots)}(o,t,e),a=s.processChildren?xv(s.segmentGroup,s.index,o.commands):yv(s.segmentGroup,s.index,o.commands);return fv(s.segmentGroup,a,t,n,i)}function pv(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function fv(e,t,r,n,i){let o={};return n&&fm(n,(e,t)=>{o[t]=Array.isArray(e)?e.map(e=>`${e}`):`${e}`}),r.root===e?new xm(t,o,i):new xm(function e(t,r,n){const i={};fm(t.children,(t,o)=>{i[o]=t===r?n:e(t,r,n)});return new bm(t.segments,i)}(r.root,e,t),o,i)}class mv{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&pv(r[0]))throw new Error("Root segment cannot have matrix parameters");const n=r.find(e=>"object"==typeof e&&null!=e&&e.outlets);if(n&&n!==pm(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class vv{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function gv(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets[tm]:`${e}`}function yv(e,t,r){if(e||(e=new bm([],{})),0===e.segments.length&&e.hasChildren())return xv(e,t,r);const n=function(e,t,r){let n=0,i=t;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(n>=r.length)return o;const t=e.segments[i],s=gv(r[n]),a=n<r.length-1?r[n+1]:null;if(i>0&&void 0===s)break;if(s&&a&&"object"==typeof a&&void 0===a.outlets){if(!Sv(s,a,t))return o;n+=2}else{if(!Sv(s,{},t))return o;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(e,t,r),i=r.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const t=new bm(e.segments.slice(0,n.pathIndex),{});return t.children[tm]=new bm(e.segments.slice(n.pathIndex),e.children),xv(t,0,i)}return n.match&&0===i.length?new bm(e.segments,{}):n.match&&!e.hasChildren()?bv(e,t,r):n.match?xv(e,0,i):bv(e,t,r)}function xv(e,t,r){if(0===r.length)return new bm(e.segments,{});{const n=function(e){return"object"!=typeof e[0]?{[tm]:e}:void 0===e[0].outlets?{[tm]:e}:e[0].outlets}(r),i={};return fm(n,(r,n)=>{null!==r&&(i[n]=yv(e.children[n],t,r))}),fm(e.children,(e,t)=>{void 0===n[t]&&(i[t]=e)}),new bm(e.segments,i)}}function bv(e,t,r){const n=e.segments.slice(0,t);let i=0;for(;i<r.length;){if("object"==typeof r[i]&&void 0!==r[i].outlets){const e=wv(r[i].outlets);return new bm(n,e)}if(0===i&&pv(r[0])){const o=e.segments[t];n.push(new wm(o.path,r[0])),i++;continue}const o=gv(r[i]),s=i<r.length-1?r[i+1]:null;o&&s&&pv(s)?(n.push(new wm(o,_v(s))),i+=2):(n.push(new wm(o,{})),i++)}return new bm(n,{})}function wv(e){const t={};return fm(e,(e,r)=>{null!==e&&(t[r]=bv(new bm([],{}),0,e))}),t}function _v(e){const t={};return fm(e,(e,r)=>t[r]=`${e}`),t}function Sv(e,t,r){return e==r.path&&hm(t,r.parameters)}class Tv{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Mv{constructor(e,t){this.component=e,this.route=t}}class Av{constructor(e,t,r,n){this.future=e,this.curr=t,this.moduleInjector=r,this.forwardEvent=n,this.canActivateChecks=[],this.canDeactivateChecks=[]}initialize(e){const t=this.future._root,r=this.curr?this.curr._root:null;this.setupChildRouteGuards(t,r,e,[t.value])}checkGuards(){if(!this.isDeactivating()&&!this.isActivating())return hc(!0);return this.runCanDeactivateChecks().pipe(J(e=>e?this.runCanActivateChecks():hc(!1)))}resolveData(e){return this.isActivating()?Y(this.canActivateChecks).pipe(mc(t=>this.runResolve(t.route,e)),up((e,t)=>e)):hc(null)}isDeactivating(){return 0!==this.canDeactivateChecks.length}isActivating(){return 0!==this.canActivateChecks.length}setupChildRouteGuards(e,t,r,n){const i=ev(t);e.children.forEach(e=>{this.setupRouteGuards(e,i[e.value.outlet],r,n.concat([e.value])),delete i[e.value.outlet]}),fm(i,(e,t)=>this.deactivateRouteAndItsChildren(e,r.getContext(t)))}setupRouteGuards(e,t,r,n){const i=e.value,o=t?t.value:null,s=r?r.getContext(e.value.outlet):null;if(o&&i.routeConfig===o.routeConfig){const a=this.shouldRunGuardsAndResolvers(o,i,i.routeConfig.runGuardsAndResolvers);if(a?this.canActivateChecks.push(new Tv(n)):(i.data=o.data,i._resolvedData=o._resolvedData),i.component?this.setupChildRouteGuards(e,t,s?s.children:null,n):this.setupChildRouteGuards(e,t,r,n),a){const e=s.outlet;this.canDeactivateChecks.push(new Mv(e.component,o))}}else o&&this.deactivateRouteAndItsChildren(t,s),this.canActivateChecks.push(new Tv(n)),i.component?this.setupChildRouteGuards(e,null,s?s.children:null,n):this.setupChildRouteGuards(e,null,r,n)}shouldRunGuardsAndResolvers(e,t,r){switch(r){case"always":return!0;case"paramsOrQueryParamsChange":return!uv(e,t)||!hm(e.queryParams,t.queryParams);case"paramsChange":default:return!uv(e,t)}}deactivateRouteAndItsChildren(e,t){const r=ev(e),n=e.value;fm(r,(e,r)=>{n.component?t?this.deactivateRouteAndItsChildren(e,t.children.getContext(r)):this.deactivateRouteAndItsChildren(e,null):this.deactivateRouteAndItsChildren(e,t)}),n.component&&t&&t.outlet&&t.outlet.isActivated?this.canDeactivateChecks.push(new Mv(t.outlet.component,n)):this.canDeactivateChecks.push(new Mv(null,n))}runCanDeactivateChecks(){return Y(this.canDeactivateChecks).pipe(J(e=>this.runCanDeactivate(e.component,e.route)),Vd(e=>!0===e))}runCanActivateChecks(){return Y(this.canActivateChecks).pipe(mc(e=>mm(Y([this.fireChildActivationStart(e.route.parent),this.fireActivationStart(e.route),this.runCanActivateChild(e.path),this.runCanActivate(e.route)]))),Vd(e=>!0===e))}fireActivationStart(e){return null!==e&&this.forwardEvent&&this.forwardEvent(new $f(e)),hc(!0)}fireChildActivationStart(e){return null!==e&&this.forwardEvent&&this.forwardEvent(new Qf(e)),hc(!0)}runCanActivate(e){const t=e.routeConfig?e.routeConfig.canActivate:null;return t&&0!==t.length?mm(Y(t).pipe(H(t=>{const r=this.getToken(t,e);let n;return(n=r.canActivate?vm(r.canActivate(e,this.future)):vm(r(e,this.future))).pipe(sp())}))):hc(!0)}runCanActivateChild(e){const t=e[e.length-1];return mm(Y(e.slice(0,e.length-1).reverse().map(e=>this.extractCanActivateChild(e)).filter(e=>null!==e)).pipe(H(e=>{return mm(Y(e.guards).pipe(H(r=>{const n=this.getToken(r,e.node);let i;return(i=n.canActivateChild?vm(n.canActivateChild(t,this.future)):vm(n(t,this.future))).pipe(sp())})))})))}extractCanActivateChild(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}runCanDeactivate(e,t){const r=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return r&&0!==r.length?Y(r).pipe(J(r=>{const n=this.getToken(r,t);let i;return(i=n.canDeactivate?vm(n.canDeactivate(e,t,this.curr,this.future)):vm(n(e,t,this.curr,this.future))).pipe(sp())})).pipe(Vd(e=>!0===e)):hc(!0)}runResolve(e,t){const r=e._resolve;return this.resolveNode(r,e).pipe(H(r=>(e._resolvedData=r,e.data=Object.assign({},e.data,iv(e,t).resolve),null)))}resolveNode(e,t){const r=Object.keys(e);if(0===r.length)return hc({});if(1===r.length){const n=r[0];return this.getResolver(e[n],t).pipe(H(e=>({[n]:e})))}const n={};return Y(r).pipe(J(r=>this.getResolver(e[r],t).pipe(H(e=>(n[r]=e,e))))).pipe(rp(),H(()=>n))}getResolver(e,t){const r=this.getToken(e,t);return r.resolve?vm(r.resolve(t,this.future)):vm(r(t,this.future))}getToken(e,t){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:this.moduleInjector).get(e)}}class Ev{}class Cv{constructor(e,t,r,n,i){this.rootComponentType=e,this.config=t,this.urlTree=r,this.url=n,this.paramsInheritanceStrategy=i}recognize(){try{const e=Dv(this.urlTree.root,[],[],this.config).segmentGroup,t=this.processSegmentGroup(this.config,e,tm),r=new ov([],Object.freeze({}),Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,{},tm,this.rootComponentType,null,this.urlTree.root,-1,{}),n=new $m(r,t),i=new sv(this.url,n);return this.inheritParamsAndData(i._root),hc(i)}catch(e){return new M(t=>t.error(e))}}inheritParamsAndData(e){const t=e.value,r=iv(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,r){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,r)}processChildren(e,t){const r=Sm(t,(t,r)=>this.processSegmentGroup(e,t,r));return function(e){const t={};e.forEach(e=>{const r=t[e.value.outlet];if(r){const t=r.url.map(e=>e.toString()).join("/"),n=e.value.url.map(e=>e.toString()).join("/");throw new Error(`Two segments cannot have the same outlet name: '${t}' and '${n}'.`)}t[e.value.outlet]=e.value})}(r),function(e){e.sort((e,t)=>e.value.outlet===tm?-1:t.value.outlet===tm?1:e.value.outlet.localeCompare(t.value.outlet))}(r),r}processSegment(e,t,r,n){for(const i of e)try{return this.processSegmentAgainstRoute(i,t,r,n)}catch(e){if(!(e instanceof Ev))throw e}if(this.noLeftoversInUrl(t,r,n))return[];throw new Ev}noLeftoversInUrl(e,t,r){return 0===t.length&&!e.children[r]}processSegmentAgainstRoute(e,t,r,n){if(e.redirectTo)throw new Ev;if((e.outlet||tm)!==n)throw new Ev;let i,o=[],s=[];if("**"===e.path){const o=r.length>0?pm(r).parameters:{};i=new ov(r,o,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,Iv(e),n,e.component,e,Pv(t),Ov(t)+r.length,Rv(e))}else{const a=function(e,t,r){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||r.length>0))throw new Ev;return{consumedSegments:[],lastChild:0,parameters:{}}}const n=(t.matcher||om)(r,e,t);if(!n)throw new Ev;const i={};fm(n.posParams,(e,t)=>{i[t]=e.path});const o=n.consumed.length>0?Object.assign({},i,n.consumed[n.consumed.length-1].parameters):i;return{consumedSegments:n.consumed,lastChild:n.consumed.length,parameters:o}}(t,e,r);o=a.consumedSegments,s=r.slice(a.lastChild),i=new ov(o,a.parameters,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,Iv(e),n,e.component,e,Pv(t),Ov(t)+o.length,Rv(e))}const a=function(e){if(e.children)return e.children;if(e.loadChildren)return e._loadedConfig.routes;return[]}(e),{segmentGroup:l,slicedSegments:c}=Dv(t,o,s,a);if(0===c.length&&l.hasChildren()){const e=this.processChildren(a,l);return[new $m(i,e)]}if(0===a.length&&0===c.length)return[new $m(i,[])];const u=this.processSegment(a,l,c,tm);return[new $m(i,u)]}}function Pv(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function Ov(e){let t=e,r=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)r+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return r-1}function Dv(e,t,r,n){if(r.length>0&&function(e,t,r){return r.some(r=>Nv(e,t,r)&&Lv(r)!==tm)}(e,r,n)){const i=new bm(t,function(e,t,r,n){const i={};i[tm]=n,n._sourceSegment=e,n._segmentIndexShift=t.length;for(const o of r)if(""===o.path&&Lv(o)!==tm){const r=new bm([],{});r._sourceSegment=e,r._segmentIndexShift=t.length,i[Lv(o)]=r}return i}(e,t,n,new bm(r,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===r.length&&function(e,t,r){return r.some(r=>Nv(e,t,r))}(e,r,n)){const i=new bm(e.segments,function(e,t,r,n){const i={};for(const o of r)if(Nv(e,t,o)&&!n[Lv(o)]){const t=new bm([],{});t._sourceSegment=e,t._segmentIndexShift=e.segments.length,i[Lv(o)]=t}return Object.assign({},n,i)}(e,r,n,e.children));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:r}}const i=new bm(e.segments,e.children);return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:r}}function Nv(e,t,r){return(!(e.hasChildren()||t.length>0)||"full"!==r.pathMatch)&&(""===r.path&&void 0===r.redirectTo)}function Lv(e){return e.outlet||tm}function Iv(e){return e.data||{}}function Rv(e){return e.resolve||{}}class Fv{}class kv{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}const Uv=new pe("ROUTES");class Bv{constructor(e,t,r,n){this.loader=e,this.compiler=t,this.onLoadStartListener=r,this.onLoadEndListener=n}load(e,t){return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(H(r=>{this.onLoadEndListener&&this.onLoadEndListener(t);const n=r.create(e);return new sm(dm(n.injector.get(Uv)).map(um),n)}))}loadModuleFactory(e){return"string"==typeof e?Y(this.loader.load(e)):vm(e()).pipe(J(e=>e instanceof Ur?hc(e):Y(this.compiler.compileModuleAsync(e))))}}class jv{}class zv{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function Vv(e){throw e}function Gv(e){return hc(null)}class Hv{constructor(e,t,r,n,i,o,s,a){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=r,this.location=n,this.config=a,this.navigations=new jd(null),this.navigationId=0,this.events=new O,this.errorHandler=Vv,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Gv,afterPreactivation:Gv},this.urlHandlingStrategy=new zv,this.routeReuseStrategy=new kv,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly";this.ngModule=i.get(kr),this.resetConfig(a),this.currentUrlTree=new xm(new bm([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.configLoader=new Bv(o,s,e=>this.triggerEvent(new Jf(e)),e=>this.triggerEvent(new Zf(e))),this.routerState=rv(this.currentUrlTree,this.rootComponentType),this.processNavigations()}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.urlSerializer.parse(e.url),r="popstate"===e.type?"popstate":"hashchange",n=e.state&&e.state.navigationId?{navigationId:e.state.navigationId}:null;setTimeout(()=>{this.scheduleNavigation(t,r,n,{replaceUrl:!0})},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}triggerEvent(e){this.events.next(e)}resetConfig(e){am(e),this.config=e.map(um),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}createUrlTree(e,t={}){const{relativeTo:r,queryParams:n,fragment:i,preserveQueryParams:o,queryParamsHandling:s,preserveFragment:a}=t;sn()&&o&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");const l=r||this.routerState.root,c=a?this.currentUrlTree.fragment:i;let u=null;if(s)switch(s){case"merge":u=Object.assign({},this.currentUrlTree.queryParams,n);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=n||null}else u=o?this.currentUrlTree.queryParams:n||null;return null!==u&&(u=this.removeEmptyProps(u)),dv(l,this.currentUrlTree,e,u,c)}navigateByUrl(e,t={skipLocationChange:!1}){const r=e instanceof xm?e:this.parseUrl(e),n=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(n,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const r=e[t];if(null==r)throw new Error(`The requested path contains ${r} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){return this.urlSerializer.parse(e)}isActive(e,t){if(e instanceof xm)return gm(this.currentUrlTree,e,t);const r=this.urlSerializer.parse(e);return gm(this.currentUrlTree,r,t)}removeEmptyProps(e){return Object.keys(e).reduce((t,r)=>{const n=e[r];return null!==n&&void 0!==n&&(t[r]=n),t},{})}processNavigations(){this.navigations.pipe(mc(e=>e?(this.executeScheduledNavigation(e),e.promise.catch(()=>{})):hc(null))).subscribe(()=>{})}scheduleNavigation(e,t,r,n){const i=this.navigations.value;if(i&&"imperative"!==t&&"imperative"===i.source&&i.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(i&&"hashchange"==t&&"popstate"===i.source&&i.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(i&&"popstate"==t&&"hashchange"===i.source&&i.rawUrl.toString()===e.toString())return Promise.resolve(!0);let o=null,s=null;const a=new Promise((e,t)=>{o=e,s=t}),l=++this.navigationId;return this.navigations.next({id:l,source:t,state:r,rawUrl:e,extras:n,resolve:o,reject:s,promise:a}),a.catch(e=>Promise.reject(e))}executeScheduledNavigation({id:e,rawUrl:t,extras:r,resolve:n,reject:i,source:o,state:s}){const a=this.urlHandlingStrategy.extract(t),l=!this.navigated||a.toString()!==this.currentUrlTree.toString();("reload"===this.onSameUrlNavigation||l)&&this.urlHandlingStrategy.shouldProcessUrl(t)?(this.events.next(new jf(e,this.serializeUrl(a),o,s)),Promise.resolve().then(n=>this.runNavigate(a,t,!!r.skipLocationChange,!!r.replaceUrl,e,null)).then(n,i)):l&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)?(this.events.next(new jf(e,this.serializeUrl(a),o,s)),Promise.resolve().then(r=>this.runNavigate(a,t,!1,!1,e,rv(a,this.rootComponentType).snapshot)).then(n,i)):(this.rawUrlTree=t,n(null))}runNavigate(e,t,r,n,i,o){return i!==this.navigationId?(this.events.next(new Vf(i,this.serializeUrl(e),`Navigation ID ${i} is not equal to the current navigation id ${this.navigationId}`)),Promise.resolve(!1)):new Promise((s,a)=>{let l;if(o)l=hc({appliedUrl:e,snapshot:o});else{l=function(e,t,r,n,i){return new Wm(e,t,r,n,i).apply()}(this.ngModule.injector,this.configLoader,this.urlSerializer,e,this.config).pipe(J(t=>(function(e,t,r,n,i="emptyOnly"){return new Cv(e,t,r,n,i).recognize()})(this.rootComponentType,this.config,t,this.serializeUrl(t),this.paramsInheritanceStrategy).pipe(H(r=>(this.events.next(new Hf(i,this.serializeUrl(e),this.serializeUrl(t),r)),{appliedUrl:t,snapshot:r})))))}let c;const u=l.pipe(J(e=>"boolean"==typeof e?hc(e):this.hooks.beforePreactivation(e.snapshot).pipe(H(()=>e)))).pipe(H(e=>{if("boolean"==typeof e)return e;const{appliedUrl:t,snapshot:r}=e,n=this.ngModule.injector;return(c=new Av(r,this.routerState.snapshot,n,e=>this.triggerEvent(e))).initialize(this.rootContexts),{appliedUrl:t,snapshot:r}})).pipe(J(t=>{if("boolean"==typeof t||this.navigationId!==i)return hc(!1);const{appliedUrl:r,snapshot:n}=t;return this.triggerEvent(new Wf(i,this.serializeUrl(e),this.serializeUrl(r),n)),c.checkGuards().pipe(H(t=>(this.triggerEvent(new Xf(i,this.serializeUrl(e),this.serializeUrl(r),n,t)),{appliedUrl:r,snapshot:n,shouldActivate:t})))})).pipe(J(t=>"boolean"==typeof t||this.navigationId!==i?hc(!1):t.shouldActivate&&c.isActivating()?(this.triggerEvent(new qf(i,this.serializeUrl(e),this.serializeUrl(t.appliedUrl),t.snapshot)),c.resolveData(this.paramsInheritanceStrategy).pipe(H(()=>(this.triggerEvent(new Yf(i,this.serializeUrl(e),this.serializeUrl(t.appliedUrl),t.snapshot)),t)))):hc(t))).pipe(J(e=>"boolean"==typeof e||this.navigationId!==i?hc(!1):this.hooks.afterPreactivation(e.snapshot).pipe(H(()=>e)))).pipe(H(e=>{if("boolean"==typeof e||this.navigationId!==i)return!1;const{appliedUrl:t,snapshot:r,shouldActivate:n}=e;if(n){return{appliedUrl:t,state:function(e,t,r){const n=hv(e,t._root,r?r._root:void 0);return new tv(n,t)}(this.routeReuseStrategy,r,this.routerState),shouldActivate:n}}return{appliedUrl:t,state:null,shouldActivate:n}}));this.activateRoutes(u,this.routerState,this.currentUrlTree,i,e,t,r,n,s,a)})}activateRoutes(e,t,r,n,i,o,s,a,l,c){let u;e.forEach(e=>{if("boolean"==typeof e||!e.shouldActivate||n!==this.navigationId||!e.state)return void(u=!1);const{appliedUrl:r,state:i}=e;if(this.currentUrlTree=r,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,o),this.routerState=i,!s){const e=this.urlSerializer.serialize(this.rawUrlTree);this.location.isCurrentPathEqualTo(e)||a?this.location.replaceState(e,"",{navigationId:n}):this.location.go(e,"",{navigationId:n})}new Wv(this.routeReuseStrategy,i,t,e=>this.triggerEvent(e)).activate(this.rootContexts),u=!0}).then(()=>{u?(this.navigated=!0,this.lastSuccessfulId=n,this.events.next(new zf(n,this.serializeUrl(i),this.serializeUrl(this.currentUrlTree))),l(!0)):(this.resetUrlToCurrentUrlTree(),this.events.next(new Vf(n,this.serializeUrl(i),"")),l(!1))},e=>{if(function(e){return e&&e[im]}(e))this.navigated=!0,this.resetStateAndUrl(t,r,o),this.events.next(new Vf(n,this.serializeUrl(i),e.message)),l(!1);else{this.resetStateAndUrl(t,r,o),this.events.next(new Gf(n,this.serializeUrl(i),e));try{l(this.errorHandler(e))}catch(e){c(e)}}})}resetStateAndUrl(e,t,r){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}}class Wv{constructor(e,t,r,n){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=n}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),cv(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const n=ev(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,n[t],r),delete n[t]}),fm(n,(e,t)=>{this.deactivateRouteAndItsChildren(e,r)})}deactivateRoutes(e,t,r){const n=e.value,i=t?t.value:null;if(n===i)if(n.component){const i=r.getContext(n.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,r);else i&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet);if(r&&r.outlet){const t=r.outlet.detach(),n=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:n})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet);if(r){const n=ev(e),i=e.value.component?r.children:t;fm(n,(e,t)=>this.deactivateRouteAndItsChildren(e,i)),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}}activateChildRoutes(e,t,r){const n=ev(t);e.children.forEach(e=>{this.activateRoutes(e,n[e.value.outlet],r),this.forwardEvent(new em(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Kf(e.value.snapshot))}activateRoutes(e,t,r){const n=e.value,i=t?t.value:null;if(cv(n),n===i)if(n.component){const i=r.getOrCreateContext(n.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,r);else if(n.component){const t=r.getOrCreateContext(n.outlet);if(this.routeReuseStrategy.shouldAttach(n.snapshot)){const e=this.routeReuseStrategy.retrieve(n.snapshot);this.routeReuseStrategy.store(n.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),Xv(e.route)}else{const r=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(n.snapshot),i=r?r.module.componentFactoryResolver:null;t.route=n,t.resolver=i,t.outlet&&t.outlet.activateWith(n,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,r)}}function Xv(e){cv(e.value),e.children.forEach(Xv)}class qv{constructor(e,t,r,n,i){this.router=e,this.route=t,this.commands=[],null==r&&n.setAttribute(i.nativeElement,"tabindex","0")}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}set preserveQueryParams(e){sn()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated!, use queryParamsHandling instead."),this.preserve=e}onClick(){const e={skipLocationChange:Jv(this.skipLocationChange),replaceUrl:Jv(this.replaceUrl)};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:Jv(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:Jv(this.preserveFragment)})}}qv.decorators=[{type:Ee,args:[{selector:":not(a)[routerLink]"}]}],qv.ctorParameters=(()=>[{type:Hv},{type:nv},{type:void 0,decorators:[{type:_e,args:["tabindex"]}]},{type:gn},{type:yn}]),qv.propDecorators={queryParams:[{type:Oe}],fragment:[{type:Oe}],queryParamsHandling:[{type:Oe}],preserveFragment:[{type:Oe}],skipLocationChange:[{type:Oe}],replaceUrl:[{type:Oe}],routerLink:[{type:Oe}],preserveQueryParams:[{type:Oe}],onClick:[{type:Le,args:["click"]}]};class Yv{constructor(e,t,r){this.router=e,this.route=t,this.locationStrategy=r,this.commands=[],this.subscription=e.events.subscribe(e=>{e instanceof zf&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}set preserveQueryParams(e){sn()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead."),this.preserve=e}ngOnChanges(e){this.updateTargetUrlAndHref()}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,t,r,n){if(0!==e||t||r||n)return!0;if("string"==typeof this.target&&"_self"!=this.target)return!0;const i={skipLocationChange:Jv(this.skipLocationChange),replaceUrl:Jv(this.replaceUrl)};return this.router.navigateByUrl(this.urlTree,i),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:Jv(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:Jv(this.preserveFragment)})}}function Jv(e){return""===e||!!e}Yv.decorators=[{type:Ee,args:[{selector:"a[routerLink]"}]}],Yv.ctorParameters=(()=>[{type:Hv},{type:nv},{type:yc}]),Yv.propDecorators={target:[{type:Ne,args:["attr.target"]},{type:Oe}],queryParams:[{type:Oe}],fragment:[{type:Oe}],queryParamsHandling:[{type:Oe}],preserveFragment:[{type:Oe}],skipLocationChange:[{type:Oe}],replaceUrl:[{type:Oe}],href:[{type:Ne}],routerLink:[{type:Oe}],preserveQueryParams:[{type:Oe}],onClick:[{type:Le,args:["click",["$event.button","$event.ctrlKey","$event.metaKey","$event.shiftKey"]]}]};class Zv{constructor(e,t,r,n){this.router=e,this.element=t,this.renderer=r,this.cdr=n,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.subscription=e.events.subscribe(e=>{e instanceof zf&&this.update()})}ngAfterContentInit(){this.links.changes.subscribe(e=>this.update()),this.linksWithHrefs.changes.subscribe(e=>this.update()),this.update()}set routerLinkActive(e){const t=Array.isArray(e)?e:e.split(" ");this.classes=t.filter(e=>!!e)}ngOnChanges(e){this.update()}ngOnDestroy(){this.subscription.unsubscribe()}update(){this.links&&this.linksWithHrefs&&this.router.navigated&&Promise.resolve().then(()=>{const e=this.hasActiveLinks();this.isActive!==e&&(this.isActive=e,this.classes.forEach(t=>{e?this.renderer.addClass(this.element.nativeElement,t):this.renderer.removeClass(this.element.nativeElement,t)}))})}isLinkActive(e){return t=>e.isActive(t.urlTree,this.routerLinkActiveOptions.exact)}hasActiveLinks(){return this.links.some(this.isLinkActive(this.router))||this.linksWithHrefs.some(this.isLinkActive(this.router))}}Zv.decorators=[{type:Ee,args:[{selector:"[routerLinkActive]",exportAs:"routerLinkActive"}]}],Zv.ctorParameters=(()=>[{type:Hv},{type:yn},{type:gn},{type:Pn}]),Zv.propDecorators={links:[{type:Te,args:[qv,{descendants:!0}]}],linksWithHrefs:[{type:Te,args:[Yv,{descendants:!0}]}],routerLinkActiveOptions:[{type:Oe}],routerLinkActive:[{type:Oe}]};class Qv{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Kv,this.attachRef=null}}class Kv{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const r=this.getOrCreateContext(e);r.outlet=t,this.contexts.set(e,r)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new Qv,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class $v{constructor(e,t,r,n,i){this.parentContexts=e,this.location=t,this.resolver=r,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new Hr,this.deactivateEvents=new Hr,this.name=n||tm,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const r=e._futureSnapshot.routeConfig.component,n=(t=t||this.resolver).resolveComponentFactory(r),i=this.parentContexts.getOrCreateContext(this.name).children,o=new eg(e,i,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,o),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}$v.decorators=[{type:Ee,args:[{selector:"router-outlet",exportAs:"outlet"}]}],$v.ctorParameters=(()=>[{type:Kv},{type:Cn},{type:Ir},{type:void 0,decorators:[{type:_e,args:["name"]}]},{type:Pn}]),$v.propDecorators={activateEvents:[{type:De,args:["activate"]}],deactivateEvents:[{type:De,args:["deactivate"]}]};class eg{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===nv?this.route:e===Kv?this.childContexts:this.parent.get(e,t)}}class tg{}class rg{preload(e,t){return t().pipe(oc(()=>hc(null)))}}class ng{preload(e,t){return hc(null)}}class ig{constructor(e,t,r,n,i){this.router=e,this.injector=n,this.preloadingStrategy=i;this.loader=new Bv(t,r,t=>e.triggerEvent(new Jf(t)),t=>e.triggerEvent(new Zf(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(dc(e=>e instanceof zf),mc(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(kr);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription.unsubscribe()}processRoutes(e,t){const r=[];for(const n of t)if(n.loadChildren&&!n.canLoad&&n._loadedConfig){const e=n._loadedConfig;r.push(this.processRoutes(e.module,e.routes))}else n.loadChildren&&!n.canLoad?r.push(this.preloadConfig(e,n)):n.children&&r.push(this.processRoutes(e,n.children));return Y(r).pipe($(),H(e=>void 0))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>{return this.loader.load(e.injector,t).pipe(J(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes))))})}}ig.decorators=[{type:Rt}],ig.ctorParameters=(()=>[{type:Hv},{type:xn},{type:Cr},{type:ut},{type:tg}]);const og=[$v,qv,Yv,Zv],sg=new pe("ROUTER_CONFIGURATION"),ag=new pe("ROUTER_FORROOT_GUARD"),lg=[bc,{provide:Tm,useClass:Mm},{provide:Hv,useFactory:fg,deps:[dn,Tm,Kv,bc,ut,xn,Cr,Uv,sg,[jv,new tt],[Fv,new tt]]},Kv,{provide:nv,useFactory:mg,deps:[Hv]},{provide:xn,useClass:Mn},ig,ng,rg,{provide:sg,useValue:{enableTracing:!1}}];function cg(){return new an("Router",Hv)}class ug{constructor(e,t){}static forRoot(e,t){return{ngModule:ug,providers:[lg,pg(e),{provide:ag,useFactory:dg,deps:[[Hv,new tt,new nt]]},{provide:sg,useValue:t||{}},{provide:yc,useFactory:hg,deps:[vc,[new et(xc),new tt],sg]},{provide:tg,useExisting:t&&t.preloadingStrategy?t.preloadingStrategy:ng},{provide:an,multi:!0,useFactory:cg},[vg,{provide:gr,multi:!0,useFactory:gg,deps:[vg]},{provide:xg,useFactory:yg,deps:[vg]},{provide:Mr,multi:!0,useExisting:xg}]]}}static forChild(e){return{ngModule:ug,providers:[pg(e)]}}}function hg(e,t,r={}){return r.useHash?new _c(e,t):new Sc(e,t)}function dg(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function pg(e){return[{provide:we,multi:!0,useValue:e},{provide:Uv,multi:!0,useValue:e}]}function fg(e,t,r,n,i,o,s,a,l={},c,u){const h=new Hv(null,t,r,n,i,o,s,dm(a));if(c&&(h.urlHandlingStrategy=c),u&&(h.routeReuseStrategy=u),l.errorHandler&&(h.errorHandler=l.errorHandler),l.enableTracing){const e=pp();h.events.subscribe(t=>{e.logGroup(`Router Event: ${t.constructor.name}`),e.log(t.toString()),e.log(t),e.logGroupEnd()})}return l.onSameUrlNavigation&&(h.onSameUrlNavigation=l.onSameUrlNavigation),l.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=l.paramsInheritanceStrategy),h}function mg(e){return e.routerState.root}ug.decorators=[{type:Ft,args:[{declarations:og,exports:og}]}],ug.ctorParameters=(()=>[{type:void 0,decorators:[{type:tt},{type:et,args:[ag]}]},{type:Hv,decorators:[{type:tt}]}]);class vg{constructor(e){this.injector=e,this.initNavigation=!1,this.resultOfPreactivationDone=new O}appInitializer(){return this.injector.get(gc,Promise.resolve(null)).then(()=>{let e=null;const t=new Promise(t=>e=t),r=this.injector.get(Hv),n=this.injector.get(sg);if(this.isLegacyDisabled(n)||this.isLegacyEnabled(n))e(!0);else if("disabled"===n.initialNavigation)r.setUpLocationChangeListener(),e(!0);else{if("enabled"!==n.initialNavigation)throw new Error(`Invalid initialNavigation options: '${n.initialNavigation}'`);r.hooks.afterPreactivation=(()=>this.initNavigation?hc(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone)),r.initialNavigation()}return t})}bootstrapListener(e){const t=this.injector.get(sg),r=this.injector.get(ig),n=this.injector.get(Hv),i=this.injector.get(dn);e===i.components[0]&&(this.isLegacyEnabled(t)?n.initialNavigation():this.isLegacyDisabled(t)&&n.setUpLocationChangeListener(),r.setUpPreloading(),n.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}isLegacyEnabled(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation}isLegacyDisabled(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation}}function gg(e){return e.appInitializer.bind(e)}function yg(e){return e.bootstrapListener.bind(e)}vg.decorators=[{type:Rt}],vg.ctorParameters=(()=>[{type:ut}]);const xg=new pe("Router Initializer");new Ut("6.0.0");var bg=to({encapsulation:0,styles:[[".menu[_ngcontent-%COMP%]{height:100%;margin:0 auto;display:flex;justify-content:center;align-items:center;flex-direction:row}.btn-group[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;width:100%}.btn-group[_ngcontent-%COMP%]   #numberOfPlayers[_ngcontent-%COMP%]{width:-webkit-min-content;width:-moz-min-content;width:min-content;text-align:center}.menu-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.menu-list[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;width:350px;height:45px;background-color:#fff;border:2px solid #467daf;color:#467daf;border-radius:3px;font-size:large}.menu-list[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:0}"]],data:{}});function wg(e){return qs(0,[(e()(),Lo(0,0,null,null,15,"div",[["class","menu"]],null,null,null,null,null)),(e()(),Lo(1,0,null,null,14,"div",[["class","menu-list"]],null,null,null,null,null)),(e()(),Lo(2,0,null,null,5,"div",[["class","btn-group"]],null,null,null,null,null)),(e()(),Lo(3,0,null,null,1,"label",[["for","numberOfPlayers"]],null,null,null,null,null)),(e()(),Hs(-1,null,["Enter number of players"])),(e()(),Lo(5,0,[["numberOfPlayers",1]],null,0,"input",[["id","numberOfPlayers"],["max","4"],["min","2"],["name","numberOfPlayers"],["step","1"],["type","number"],["value","2"]],null,null,null,null,null)),(e()(),Lo(6,0,null,null,1,"button",[["class","button-login"]],[[8,"disabled",0]],[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onCreateLobby(cs(e,5).value)&&n);return n},null,null)),(e()(),Hs(-1,null,["Create Lobby"])),(e()(),Lo(8,0,null,null,1,"button",[],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onPlayClick()&&n);return n},null,null)),(e()(),Hs(-1,null,["Quick Start"])),(e()(),Lo(10,0,null,null,1,"button",[],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onPracticeClick()&&n);return n},null,null)),(e()(),Hs(-1,null,["Practice"])),(e()(),Lo(12,0,null,null,1,"button",[],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onSettingsClick()&&n);return n},null,null)),(e()(),Hs(-1,null,["Settings"])),(e()(),Lo(14,0,null,null,1,"button",[],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onExitClick()&&n);return n},null,null)),(e()(),Hs(-1,null,["Exit"]))],null,function(e,t){e(t,6,0,cs(t,5).value<2)})}var _g=Ko("page-menu",Bd,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"page-menu",[],null,null,null,wg,bg)),_s(1,49152,null,0,Bd,[Od,Nd,kd,Hv],null,null)],null,null)},{},{},[]);class Sg{constructor(e){this.apiHttpService=e}getAllCars(){return this.apiHttpService.apiGet("car/")}}class Tg{constructor(e){this.carDelegate=e}loadCars(){return this.carDelegate.getAllCars()}}class Mg{constructor(e,t){this.carService=e,this.router=t,this.selectedCar=0,this.carsList=[]}ngOnInit(){this.getCars()}getCars(){this.carService.loadCars().subscribe(e=>{this.carService.cars=e,this.carsList=this.carService.cars},e=>{console.error(e)})}setSelectedCar(e){this.carService.selectedCar=e,this.router.navigate(["/game"])}}var Ag=to({encapsulation:0,styles:[["#canvasContainer[_ngcontent-%COMP%]{width:100%;height:100%}.container[_ngcontent-%COMP%]{display:flex;align-items:center}.car-container[_ngcontent-%COMP%]   .car-image[_ngcontent-%COMP%]{margin-left:1em;height:8em;width:auto}.selected-car[_ngcontent-%COMP%]{opacity:.7}span[_ngcontent-%COMP%]{font-size:.8em}.car-info-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}"]],data:{}});function Eg(e){return qs(0,[(e()(),Lo(0,0,null,null,3,"div",[["class","image-container"]],null,null,null,null,null)),(e()(),Lo(1,0,null,null,2,"button",[],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.setSelectedCar(e.context.$implicit)&&n);return n},null,null)),(e()(),Lo(2,0,null,null,0,"img",[["height","99"],["width","150"]],[[8,"src",4]],null,null,null,null)),(e()(),Hs(3,null,[" "," "]))],null,function(e,t){e(t,2,0,function(e,t,r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x){switch(e){case 1:return t+Do(r)+n;case 2:return t+Do(r)+n+Do(i)+o;case 3:return t+Do(r)+n+Do(i)+o+Do(s)+a;case 4:return t+Do(r)+n+Do(i)+o+Do(s)+a+Do(l)+c;case 5:return t+Do(r)+n+Do(i)+o+Do(s)+a+Do(l)+c+Do(u)+h;case 6:return t+Do(r)+n+Do(i)+o+Do(s)+a+Do(l)+c+Do(u)+h+Do(d)+p;case 7:return t+Do(r)+n+Do(i)+o+Do(s)+a+Do(l)+c+Do(u)+h+Do(d)+p+Do(f)+m;case 8:return t+Do(r)+n+Do(i)+o+Do(s)+a+Do(l)+c+Do(u)+h+Do(d)+p+Do(f)+m+Do(v)+g;case 9:return t+Do(r)+n+Do(i)+o+Do(s)+a+Do(l)+c+Do(u)+h+Do(d)+p+Do(f)+m+Do(v)+g+Do(y)+x;default:throw new Error("Does not support more than 9 expressions")}}(1,"",t.context.$implicit.image,"")),e(t,3,0,t.context.$implicit.name)})}function Cg(e){return qs(0,[(e()(),Lo(0,0,null,null,2,"div",[],null,null,null,null,null)),(e()(),No(16777216,null,null,1,null,Eg)),_s(2,802816,null,0,Nu,[Cn,En,Zn],{ngForOf:[0,"ngForOf"]},null)],function(e,t){e(t,2,0,t.component.carsList)},null)}var Pg=Ko("page-car-selection",Mg,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"page-car-selection",[],null,null,null,Cg,Ag)),_s(1,114688,null,0,Mg,[Tg,Hv],null,null)],function(e,t){e(t,1,0)},null)},{},{},[]),Og=r("Womt"),Dg=r("OKgQ"),Ng=r("kSzJ");class Lg{static isInRange(e,t,r,n=!0){return e>t&&e<r||n&&[t,r].indexOf(e)>-1}static toRange(e,t,r){return Math.min(Math.max(e,t),r)}static toNearestPowerOfTwo(e){return Math.pow(2,Math.round(Math.log2(e)))}}var Ig=r("cQc6"),Rg=Ng.Point;class Fg{static getAngleBetweenPoints(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static getDistanceBetweenPoints(e,t){return Math.hypot(t.y-e.y,t.x-e.x)}static getMiddlePoint(e,t){return new Rg((e.x+t.x)/2,(e.y+t.y)/2)}static isPointInsidePolygon(e,t){return Ig([e.x,e.y],t)}}class kg{constructor(e,t){this.r=e,this.theta=t}get cartesianPoint(){return new Rg(this.r*Math.cos(this.theta),this.r*Math.sin(this.theta))}static fromCartesian(e,t){const r=e.clone();return t&&(r.x-=t.x,r.y-=t.y),new kg(Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),Math.atan2(r.y,r.x))}}var Ug=PIXI.Graphics;class Bg extends Ug{constructor(e=1,t=.2){super(),this.strokeColor=4357620,this.areaFillColor=4301812,this.areaFillColorAlpha=.3,this._pixelsInUnit=e,this.areaWidth=Bg.BASE_TEXTURE_WIDTH,this.areaHeight=Bg.BASE_TEXTURE_HEIGHT,this.relativeCarOffset=t,this.carOffset=Bg.BASE_TEXTURE_WIDTH*t,this.outerStrokeWeight=Math.round(Bg.BASE_OUTER_STROKE_WEIGHT),this.innerStrokeWeight=Math.round(Bg.BASE_INNER_STROKE_WEIGHT)}get pixelsInUnit(){return this._pixelsInUnit}set pixelsInUnit(e){this._pixelsInUnit!==e&&(this._pixelsInUnit=e,this.visible&&this.redraw())}redraw(){}}Bg.BASE_TEXTURE_WIDTH=1024,Bg.BASE_TEXTURE_HEIGHT=512,Bg.BASE_OUTER_STROKE_WEIGHT=3,Bg.BASE_INNER_STROKE_WEIGHT=1;var jg=PIXI.Point;class zg{constructor(e,t){this.l=e,this.c=t}get arcRadius(){return 1/Math.abs(this.c)}get arcCenter(){return new jg(0,this.c>0?this.arcRadius:-this.arcRadius)}get pointerRotation(){return this.l*this.c}get position(){return this.polarPosition.cartesianPoint}get polarPosition(){return new kg(0===this.c?this.l:2/this.c*Math.sin(this.l*this.c/2),this.l*this.c/2)}breakToSegments(e=Math.ceil(2*Math.abs(this.l))){if(0===this.l)return[new jg];const t=[],r=this.l/e;for(let n=1;n<=e;n++)t.push(new zg(n*r,this.c).position);return t}clone(){return new zg(this.l,this.c)}equals(e){return!!e&&e.l===this.l&&e.c===this.c}static fromPolarPosition(e){return(e.theta>Math.PI/2||e.theta<-Math.PI/2)&&(e.theta-=Math.PI*Math.sign(e.theta),e.r=-e.r),new zg(e.theta*e.r/Math.sin(e.theta),2*Math.sin(e.theta)/e.r)}static fromCartesianPosition(e){return zg.fromPolarPosition(kg.fromCartesian(e))}}var Vg=PIXI.Point;class Gg extends Bg{redraw(){super.redraw(),this.drawInner()}draw(e,t,r,n){this.currentData={minDistance:e,maxDistance:t,momentumDistance:r,maxCurvature:n},this.drawInner()}drawInner(){if(!this.currentData)return;let e=this.currentData.minDistance,t=this.currentData.maxDistance,r=this.currentData.momentumDistance,n=this.currentData.maxCurvature;e*=this.pixelsInUnit,t*=this.pixelsInUnit,r*=this.pixelsInUnit,n/=this.pixelsInUnit;const i=new zg(e,n).position,o=new zg(e,-n).position,s=new zg(t,n).position,a=new zg(t,-n).position;this.clear(),this.lineStyle(this.outerStrokeWeight,this.strokeColor,1),this.beginFill(this.areaFillColor,this.areaFillColorAlpha),this.moveTo(i.x+this.carOffset,i.y+this.areaHeight/2),i.equals(o)||this.drawCardioid(e,n,-n),this.arc(this.carOffset,-1/n+this.areaHeight/2,1/n,kg.fromCartesian(o,new Vg(0,-1/n)).theta,kg.fromCartesian(a,new Vg(0,-1/n)).theta,!0),this.drawCardioid(t,-n,n),this.arc(this.carOffset,1/n+this.areaHeight/2,1/n,kg.fromCartesian(s,new Vg(0,1/n)).theta,kg.fromCartesian(i,new Vg(0,1/n)).theta,!0),this.endFill(),this.lineStyle(this.innerStrokeWeight,this.strokeColor,1),this.drawCardioid(r,-n,n,!0)}drawCardioid(e,t,r,n=!1,i=new Vg(this.carOffset,this.areaHeight/2)){this.getCardiodPathPoints(e,t,r,16).forEach((e,t)=>{0!==t?this.lineTo(e.x+i.x,e.y+i.y):n&&this.moveTo(e.x+i.x,e.y+i.y)})}getCardiodPathPoints(e,t,r,n=32){const i=[],o=(r-t)/n;for(let s=0;s<=n;s++)i.push(t+s*o);return i.map(t=>new zg(e,t).position)}}class Hg{static getDistanceInUniformlyAcceleratedMotion(e,t,r){return r*(e+t*r/2)}static getAccelerationInUniformlyAcceleratedMotion(e,t,r){return 2/Math.pow(r,2)*(t-e*r)}static getSpeedInUniformlyAcceleratedMotion(e,t,r){return e+t*r}static getSpeedInUniformlyAcceleratedMotionByDistance(e,t,r){return Hg.getSpeedInUniformlyAcceleratedMotion(e,Hg.getAccelerationInUniformlyAcceleratedMotion(e,t,r),r)}static getAccelerationToAchieveSpeed(e,t,r){return(t-e)/r}}var Wg=PIXI.Point;class Xg extends Og.Mesh{constructor(e){const t=new Og.Geometry;for(;t.vertices.length<64;)t.vertices.push(new Og.Vector3(0,0,0));for(let n=0;n<=t.vertices.length-3;n+=2)t.faces.push(new Og.Face3(n,n+2,n+1)),t.faces.push(new Og.Face3(n+1,n+2,n+3));const r=new Og.MeshBasicMaterial({color:4357620});super(t,r),this.geometry=t,this.material=r,this.thickness=e}setTrajectory(e){const t=e.breakToSegments(31);t.unshift(new Wg(0,0));let r=-e.pointerRotation;t.forEach((n,i)=>{const o=i*(r/(t.length-1)),s=e.l>=0?2*i:2*i+1,a=e.l>=0?2*i+1:2*i;this.geometry.vertices[s].set(n.x-this.thickness*Math.sin(o)/2,n.y-this.thickness*Math.cos(o)/2,1),this.geometry.vertices[a].set(n.x+this.thickness*Math.sin(o)/2,n.y+this.thickness*Math.cos(o)/2,1)}),this.geometry.verticesNeedUpdate=!0}}var qg=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})},Yg=Ng.Point;class Jg{constructor(e){this.socketService=e,this.mousePosition=new Yg,this.currentStepMinDistance=0,this.currentStepMaxDistance=0,this.currentStepMomentumDistance=0,this.currentStepMaxCurvature=0,this.cameraDistance=64,this.cameraDistanceSubject=new O,this.trajectorySelectionSubject=new O,this.trajectorySelected=new O,this.isInSelectionState=!1,this.isUpdatingSelectionRightNow=!1,this.lastUpdateSelectionTimestamp=0,this.updateSelectionScheduled=!1,this.nextStepArea=new Gg(1024/this.controlPlaneLength),this.controlPlaneTextureRenderer=Ng.autoDetectRenderer(this.nextStepArea.areaWidth,this.nextStepArea.areaHeight,{antialias:!0,resolution:1,transparent:!0}),this.controlPlaneTextureStage=new Ng.Container,this.controlPlaneTextureStage.addChild(this.nextStepArea),this.controlPlaneTexture=new Og.Texture(this.controlPlaneTextureRenderer.view),this.controlPlane=new Og.Mesh(new Og.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),new Og.MeshBasicMaterial({map:this.controlPlaneTexture,side:Og.DoubleSide,transparent:!0,depthWrite:!1})),this.controlPlane.geometry.applyMatrix((new Og.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArea.relativeCarOffset),0,0)),this.controlSphere=new Og.Mesh(new Og.SphereGeometry(.5),new Og.MeshBasicMaterial({color:this.nextStepArea.strokeColor,side:Og.DoubleSide,transparent:!0,opacity:1})),this.controlSphere.visible=!1,this.controlTrajectoryHelper=new Xg(this.cameraDistance/350),this.controlTrajectoryHelper.visible=!1}get trajectorySelection(){return this._trajectorySelection}set trajectorySelection(e){(this._trajectorySelection||e)&&(this._trajectorySelection&&this._trajectorySelection.equals(e)||(this._trajectorySelection=e,this.trajectorySelectionSubject.next(this._trajectorySelection)))}get controlPlaneWidth(){return.6*this.cameraDistance}get controlPlaneLength(){return 1.2*this.cameraDistance}initControls(e,t){this.canvas=e.controlCanvas,this.stage3d=e,this.car=t,e.addControlElement(this.controlPlane),e.addControlElement(this.controlSphere),e.addControlElement(this.controlTrajectoryHelper),this.canvas.addEventListener("mousemove",e=>{this.onCanvasMouseMove(e)}),this.canvas.addEventListener("click",e=>{this.onCanvasMouseClick(e)}),this.updateTrajectorySelector(),this.updateCameraDistance()}adjustControlPositions(){this.car&&this.car.mesh&&this.controlPlane&&(this.controlPlane.position.set(this.car.mesh.position.x,this.car.mesh.position.y,this.car.mesh.position.z),this.controlPlane.rotation.set(this.car.mesh.rotation.x,this.car.mesh.rotation.y,this.car.mesh.rotation.z),this.controlTrajectoryHelper.position.set(this.car.mesh.position.x,this.car.mesh.position.y,this.car.mesh.position.z),this.controlTrajectoryHelper.rotation.set(this.car.mesh.rotation.x,this.car.mesh.rotation.y,this.car.mesh.rotation.z))}askForSelectedPosition(e,t,r,n){return new Promise(i=>qg(this,void 0,void 0,function*(){this.currentStepMinDistance=e,this.currentStepMaxDistance=t,this.currentStepMomentumDistance=r,this.currentStepMaxCurvature=n,yield this.stage3d.renderControlsOnceSync(),this.isInSelectionState=!0,this.showStepArea(),this.updateTrajectorySelector();const o=this.trajectorySelected.asObservable().subscribe(e=>{clearTimeout(s),o.unsubscribe(),this.isInSelectionState=!1,this.controlSphere.visible=!1,this.controlTrajectoryHelper.visible=!1,this.hideStepAreaAndCurve(),this.trajectorySelection=null,i(e)}),s=setTimeout(()=>{this.socketService.socketAvailable()?(o.unsubscribe(),this.isInSelectionState=!1,this.controlSphere.visible=!1,this.controlTrajectoryHelper.visible=!1,this.hideStepAreaAndCurve(),this.trajectorySelection=null,i(new zg(Math.max(e,0),0))):clearInterval(s)},Md.MOVE_TIMEOUT)}))}updateCameraDistance(){let e=Math.max(Hg.getDistanceInUniformlyAcceleratedMotion(0,this.car.characteristics.getMaxAcceleration(0),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/720),Hg.getDistanceInUniformlyAcceleratedMotion(Math.max(this.car.speed,0),this.car.characteristics.getMaxAcceleration(Math.max(this.car.speed,0)),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/360));e!==this.cameraDistance&&(this.cameraDistance=e,this.controlPlane.geometry=new Og.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),this.controlPlane.geometry.applyMatrix((new Og.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArea.relativeCarOffset),0,0)),this.nextStepArea.pixelsInUnit=1024/this.controlPlaneLength,this.nextStepArea.visible&&this.updateControlPlaneTexture(),this.controlTrajectoryHelper.thickness=this.cameraDistance/350,this.cameraDistanceSubject.next(this.cameraDistance))}onCanvasMouseMove(e){const t=this.canvas.getBoundingClientRect();this.mousePosition=new Yg(e.x-t.left,e.y-t.top),this.isInSelectionState&&this.updateTrajectorySelector()}onCanvasMouseClick(e){const t=this.canvas.getBoundingClientRect();if(this.mousePosition=new Yg(e.x-t.left,e.y-t.top),this.isInSelectionState){const e=this.updateTrajectorySelector();e&&this.trajectorySelected.next(e)}}updateTrajectorySelector(){const e=Date.now();if(this.isUpdatingSelectionRightNow||e-this.lastUpdateSelectionTimestamp<25)return void(this.updateSelectionScheduled=!0);this.isUpdatingSelectionRightNow=!0,this.lastUpdateSelectionTimestamp=e;const t=this.canvas.getBoundingClientRect(),r=new Og.Raycaster;r.setFromCamera({x:this.mousePosition.x/t.width*2-1,y:-this.mousePosition.y/t.height*2+1},this.stage3d.camera);const n=r.intersectObjects([this.controlPlane]);if(0===n.length)return this.controlSphere.visible=!1,this.hideStepCurve(),this.trajectorySelection=null,void(this.isUpdatingSelectionRightNow=!1);const i=this.getTrajectoryFromControlPlaneIntersection(n[0]);return Lg.isInRange(i.l,this.currentStepMinDistance,this.currentStepMaxDistance)&&Lg.isInRange(i.c,-this.currentStepMaxCurvature,this.currentStepMaxCurvature)?(this.controlSphere.position.set(n[0].point.x,n[0].point.y,n[0].point.z),this.controlSphere.visible=!0,this.controlTrajectoryHelper.visible=!0,this.showStepCurve(i),this.trajectorySelection=i,this.isUpdatingSelectionRightNow=!1,i):(this.controlSphere.visible=!1,this.hideStepCurve(),this.trajectorySelection=null,this.isUpdatingSelectionRightNow=!1,this.updateSelectionScheduled&&setTimeout(()=>{this.updateSelectionScheduled=!1,this.updateTrajectorySelector()},25),null)}getTrajectoryFromControlPlaneIntersection(e){return zg.fromCartesianPosition(this.uvToLocalWorld(e.uv))}showStepArea(){this.nextStepArea.visible=!0,this.nextStepArea.draw(this.currentStepMinDistance,this.currentStepMaxDistance,this.currentStepMomentumDistance,this.currentStepMaxCurvature),this.updateControlPlaneTexture()}showStepCurve(e){this.controlTrajectoryHelper.setTrajectory(e),this.controlTrajectoryHelper.visible=!0,this.stage3d.renderControlsOnce()}hideStepAreaAndCurve(){const e=this.nextStepArea.visible,t=this.controlTrajectoryHelper.visible;this.nextStepArea.visible=!1,this.controlTrajectoryHelper.visible=!1,e?this.updateControlPlaneTexture():t&&this.stage3d.renderControlsOnce()}hideStepCurve(){this.controlTrajectoryHelper.visible&&(this.controlTrajectoryHelper.visible=!1,this.stage3d.renderControlsOnce())}updateControlPlaneTexture(){this.controlPlaneTextureRenderer.render(this.controlPlaneTextureStage),this.controlPlaneTexture.needsUpdate=!0,this.stage3d.renderControlsOnce()}uvToLocalWorld(e){return new Yg((e.x-this.nextStepArea.relativeCarOffset)*this.controlPlaneLength,(e.y-.5)*this.controlPlaneWidth)}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){var t=arguments;if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=t[n];if(void 0!==i&&null!==i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}return r});var Zg={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16).toUpperCase();return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Zg.DEG2RAD},radToDeg:function(e){return e*Zg.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Qg(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Kg(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function $g(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}function ey(){}function ty(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||ty.DefaultOrder}function ry(){this.mask=1}function ny(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Qg.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,o,s,a,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=s,v[13]=a,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Qg).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new Kg;return function(t){var r=this.elements,n=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*s,r[9]=n[9]*s,r[10]=n[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r),s=Math.sin(r),a=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var h=o*c,d=o*u,p=s*c,f=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=p+d*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*c,v=a*u,g=l*c,y=l*u;t[0]=m+y*s,t[4]=g*s-v,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=v*s-g,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*c,v=a*u,g=l*c,y=l*u;t[0]=m-y*s,t[4]=-o*u,t[8]=g+v*s,t[1]=v+g*s,t[5]=o*c,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){h=o*c,d=o*u,p=s*c,f=s*u;t[0]=a*c,t[4]=p*l-d,t[8]=h*l+f,t[1]=a*u,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var x=o*a,b=o*l,w=s*a,_=s*l;t[0]=a*c,t[4]=_-x*u,t[8]=w*u+b,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=b*u+w,t[10]=x-_*u}else if("XZY"===e.order){x=o*a,b=o*l,w=s*a,_=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=x*u+_,t[5]=o*c,t[9]=b*u-w,t[2]=w*u-b,t[6]=s*c,t[10]=_*u+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,r=e._x,n=e._y,i=e._z,o=e._w,s=r+r,a=n+n,l=i+i,c=r*s,u=r*a,h=r*l,d=n*a,p=n*l,f=i*l,m=o*s,v=o*a,g=o*l;return t[0]=1-(d+f),t[4]=u-g,t[8]=h+v,t[1]=u+g,t[5]=1-(c+f),t[9]=p-m,t[2]=h-v,t[6]=p+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new Kg,t=new Kg,r=new Kg;return function(n,i,o){var s=this.elements;return r.subVectors(n,i),0===r.lengthSq()&&(r.z=1),r.normalize(),e.crossVectors(o,r),0===e.lengthSq()&&(1===Math.abs(o.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),e.crossVectors(o,r)),e.normalize(),t.crossVectors(r,e),s[0]=e.x,s[4]=t.x,s[8]=r.x,s[1]=e.y,s[5]=t.y,s[9]=r.y,s[2]=e.z,s[6]=t.z,s[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],s=r[4],a=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=n[0],_=n[4],S=n[8],T=n[12],M=n[1],A=n[5],E=n[9],C=n[13],P=n[2],O=n[6],D=n[10],N=n[14],L=n[3],I=n[7],R=n[11],F=n[15];return i[0]=o*w+s*M+a*P+l*L,i[4]=o*_+s*A+a*O+l*I,i[8]=o*S+s*E+a*D+l*R,i[12]=o*T+s*C+a*N+l*F,i[1]=c*w+u*M+h*P+d*L,i[5]=c*_+u*A+h*O+d*I,i[9]=c*S+u*E+h*D+d*R,i[13]=c*T+u*C+h*N+d*F,i[2]=p*w+f*M+m*P+v*L,i[6]=p*_+f*A+m*O+v*I,i[10]=p*S+f*E+m*D+v*R,i[14]=p*T+f*C+m*N+v*F,i[3]=g*w+y*M+x*P+b*L,i[7]=g*_+y*A+x*O+b*I,i[11]=g*S+y*E+x*D+b*R,i[15]=g*T+y*C+x*N+b*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Kg;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*a*u-n*l*u-i*s*h+r*l*h+n*s*d-r*a*d)+e[7]*(+t*a*d-t*l*h+i*o*h-n*o*d+n*l*c-i*a*c)+e[11]*(+t*l*u-t*s*d-i*o*u+r*o*d+i*s*c-r*l*c)+e[15]*(-n*s*c-t*a*u+t*s*h+n*o*u-r*o*h+r*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],b=p*y*h-g*f*h+g*u*m-c*y*m-p*u*x+c*f*x,w=v*f*h-d*y*h-v*u*m+l*y*m+d*u*x-l*f*x,_=d*g*h-v*p*h+v*c*m-l*g*m-d*c*x+l*p*x,S=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,T=i*b+o*w+s*_+a*S;if(0===T){var M="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return r[0]=b*A,r[1]=(g*f*a-p*y*a-g*s*m+o*y*m+p*s*x-o*f*x)*A,r[2]=(c*y*a-g*u*a+g*s*h-o*y*h-c*s*x+o*u*x)*A,r[3]=(p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m)*A,r[4]=w*A,r[5]=(d*y*a-v*f*a+v*s*m-i*y*m-d*s*x+i*f*x)*A,r[6]=(v*u*a-l*y*a-v*s*h+i*y*h+l*s*x-i*u*x)*A,r[7]=(l*f*a-d*u*a+d*s*h-i*f*h-l*s*m+i*u*m)*A,r[8]=_*A,r[9]=(v*p*a-d*g*a-v*o*m+i*g*m+d*o*x-i*p*x)*A,r[10]=(l*g*a-v*c*a+v*o*h-i*g*h-l*o*x+i*c*x)*A,r[11]=(d*c*a-l*p*a-d*o*h+i*p*h+l*o*m-i*c*m)*A,r[12]=S*A,r[13]=(d*g*s-v*p*s+v*o*f-i*g*f-d*o*y+i*p*y)*A,r[14]=(v*c*s-l*g*s-v*o*u+i*g*u+l*o*y-i*c*y)*A,r[15]=(l*p*s-d*c*s+d*o*u-i*p*u-l*o*f+i*c*f)*A,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,s=e.y,a=e.z,l=i*o,c=i*s;return this.set(l*o+r,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+r,c*a-n*o,0,l*a-n*s,c*a+n*o,i*a*a+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new Kg,t=new Qg;return function(r,n,i){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),r.x=o[12],r.y=o[13],r.z=o[14],t.copy(this);var c=1/s,u=1/a,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,n.setFromRotationMatrix(t),i.x=s,i.y=a,i.z=l,this}}(),makePerspective:function(e,t,r,n,i,o){void 0===o&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*i/(t-e),l=2*i/(r-n),c=(t+e)/(t-e),u=(r+n)/(r-n),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,r,n,i,o){var s=this.elements,a=1/(t-e),l=1/(r-n),c=1/(o-i),u=(t+e)*a,h=(r+n)*l,d=(o+i)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(Kg.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new $g;return function(t){return t&&t.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new $g;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*n-s*r,c=a*r+s*t-i*n,u=a*n+i*r-o*t,h=-i*t-o*r-s*n;return this.x=l*a+h*-i+c*-s-u*-o,this.y=c*a+h*-o+u*-i-l*-s,this.z=u*a+h*-s+l*-o-c*-i,this},project:function(){var e=new Qg;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new Qg;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new Kg,t=new Kg;return function(r,n){return e.set(r,r,r),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-i*s,this.y=i*o-r*a,this.z=r*s-n*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Kg;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new Kg;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Zg.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign($g,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,o,s){var a=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||l!==d||c!==p){var m=1-s,v=a*h+l*d+c*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,s=Math.sin(s*b)/x}var w=s*g;if(a=a*m+h*w,l=l*m+d*w,c=c*m+p*w,u=u*m+f*w,m===1-s){var _=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=_,l*=_,c*=_,u*=_}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties($g.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign($g.prototype,{set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(r/2),c=s(n/2),u=s(i/2),h=a(r/2),d=a(n/2),p=a(i/2);return"XYZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===o&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],s=r[1],a=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+a+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(s-i)*t):n>a&&n>h?(t=2*Math.sqrt(1+n-a-h),this._w=(u-l)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(o+c)/t):a>h?(t=2*Math.sqrt(1+a-n-h),this._w=(o-c)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-n-a),this._w=(s-i)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new Kg;return function(r,n){return void 0===t&&(t=new Kg),(e=r.dot(n)+1)<1e-6?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=r*c+o*s+n*l-i*a,this._y=n*c+o*a+i*s-r*l,this._z=i*c+o*l+r*a-n*s,this._w=o*c-r*s-n*a-i*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,s=o*e._w+r*e._x+n*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var l=Math.atan2(a,s),c=Math.sin((1-t)*l)/a,u=Math.sin(t*l)/a;return this._w=o*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(ey.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}}),ty.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ty.DefaultOrder="XYZ",Object.defineProperties(ty.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(ty.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=Zg.clamp,i=e.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Qg;return function(t,r,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new $g;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Kg(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(ry.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}}),Object.assign(ny.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,o,s,a,l){var c=this.elements;return c[0]=e,c[1]=n,c[2]=s,c[3]=t,c[4]=i,c[5]=a,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Kg;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],s=r[3],a=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return i[0]=o*f+s*g+a*b,i[3]=o*m+s*y+a*w,i[6]=o*v+s*x+a*_,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*w,i[7]=l*v+c*x+u*_,i[2]=h*f+d*g+p*b,i[5]=h*m+d*y+p*w,i[8]=h*v+d*x+p*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-r*i*c+r*s*a+n*i*l-n*o*a},getInverse:function(e,t){e&&e.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*a,m=h*a-l*u,v=i*p+o*f+s*m;if(0===v){var g="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(s*h-d*o)*y,n[2]=(c*o-s*l)*y,n[3]=f*y,n[4]=(d*i-s*u)*y,n[5]=(s*a-c*i)*y,n[6]=m*y,n[7]=(o*u-h*i)*y,n[8]=(l*i-o*a)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,o,s){var a=Math.cos(i),l=Math.sin(i);this.set(r*a,r*l,-r*(a*o+l*s)+o+e,-n*l,n*a,-n*(-l*o+a*s)+s+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],o=n[3],s=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*i+r*a,n[3]=t*o+r*l,n[6]=t*s+r*c,n[1]=-r*i+t*a,n[4]=-r*o+t*l,n[7]=-r*s+t*c,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var iy=0;function oy(){Object.defineProperty(this,"id",{value:iy++}),this.uuid=Zg.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=oy.DefaultUp.clone();var e=new Kg,t=new ty,r=new $g,n=new Kg(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new Qg},normalMatrix:{value:new ny}}),this.matrix=new Qg,this.matrixWorld=new Qg,this.matrixAutoUpdate=oy.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ry,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}oy.DefaultUp=new Kg(0,1,0),oy.DefaultMatrixAutoUpdate=!0,oy.prototype=Object.assign(Object.create(ey.prototype),{constructor:oy,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new $g;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new $g;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Kg(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Kg(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Kg(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Kg;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new Kg(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Kg(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Kg(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new Qg;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new Qg,t=new Kg;return function(r,n,i){r.isVector3?t.copy(r):t.set(r,n,i),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){var t=arguments;if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(t[r]);return this}return e===this?(console.error("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("Object3D.add: object not an instance of Object3D.",e),this)},remove:function(e){var t=arguments;if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.remove(t[r]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("Object3D: .getWorldPosition() target is now required"),e=new Kg),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new Kg,t=new Kg;return function(r){return void 0===r&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),r=new $g),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldScale:function(){var e=new Kg,t=new $g;return function(r){return void 0===r&&(console.warn("Object3D: .getWorldScale() target is now required"),r=new Kg),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new $g;return function(t){return void 0===t&&(console.warn("Object3D: .getWorldDirection() target is now required"),t=new Kg),this.getWorldQuaternion(e),t.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var s=o.shapes;if(Array.isArray(s))for(var a=0,l=s.length;a<l;a++){var c=s[a];i(e.shapes,c)}else i(e.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(a=0,l=this.material.length;a<l;a++)u.push(i(e.materials,this.material[a]));n.material=u}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(t){var h=m(e.geometries),d=m(e.materials),p=m(e.textures),f=m(e.images);s=m(e.shapes);h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),p.length>0&&(r.textures=p),f.length>0&&(r.images=f),s.length>0&&(r.shapes=s)}return r.object=n,r;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}});var sy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ay(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function ly(e,t,r,n,i,o){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new Kg,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new ay,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}function cy(e,t){this.min=void 0!==e?e:new Kg(1/0,1/0,1/0),this.max=void 0!==t?t:new Kg(-1/0,-1/0,-1/0)}function uy(e,t){this.center=void 0!==e?e:new Kg,this.radius=void 0!==t?t:0}function hy(e,t){this.x=e||0,this.y=t||0}Object.assign(ay.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(t,r,n){if(t=Zg.euclideanModulo(t,1),r=Zg.clamp(r,0,1),n=Zg.clamp(n,0,1),0===r)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+r):n+r-n*r,o=2*n-i;this.r=e(o,i,t+1/3),this.g=e(o,i,t),this.b=e(o,i,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(n[1])/360,a=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(s,a,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c,u=(c=r[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(c=sy[e])?this.setHex(c):console.warn("Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,o=this.b,s=Math.max(n,i,o),a=Math.min(n,i,o),l=(a+s)/2;if(a===s)t=0,r=0;else{var c=s-a;switch(r=l<=.5?c/(s+a):c/(2-s-a),s){case n:t=(i-o)/c+(i<o?6:0);break;case i:t=(o-n)/c+2;break;case o:t=(n-i)/c+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,r,n){return this.getHSL(e),e.h+=t,e.s+=r,e.l+=n,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(ly.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Object.assign(cy.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var c=e[a],u=e[a+1],h=e[a+2];c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(t,r,n),this.max.set(i,o,s),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var c=e.getX(a),u=e.getY(a),h=e.getZ(a);c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(t,r,n),this.max.set(i,o,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Kg;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("Box3: .getCenter() target is now required"),e=new Kg),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("Box3: .getSize() target is now required"),e=new Kg),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,r,n=new Kg;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(t=0,r=s.length;t<r;t++)n.copy(s[t]),n.applyMatrix4(i.matrixWorld),e.expandByPoint(n)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(t=0,r=a.count;t<r;t++)n.fromBufferAttribute(a,t).applyMatrix4(i.matrixWorld),e.expandByPoint(n)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(i),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("Box3: .getParameter() target is now required"),t=new Kg),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new Kg;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},intersectsTriangle:function(){var e=new Kg,t=new Kg,r=new Kg,n=new Kg,i=new Kg,o=new Kg,s=new Kg,a=new Kg,l=new Kg,c=new Kg;function u(n){var i,o;for(i=0,o=n.length-3;i<=o;i+=3){s.fromArray(n,i);var a=l.x*Math.abs(s.x)+l.y*Math.abs(s.y)+l.z*Math.abs(s.z),c=e.dot(s),u=t.dot(s),h=r.dot(s);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>a)return!1}return!0}return function(s){if(this.isEmpty())return!1;this.getCenter(a),l.subVectors(this.max,a),e.subVectors(s.a,a),t.subVectors(s.b,a),r.subVectors(s.c,a),n.subVectors(t,e),i.subVectors(r,t),o.subVectors(e,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-o.z,o.y,n.z,0,-n.x,i.z,0,-i.x,o.z,0,-o.x,-n.y,n.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!u(h)&&(!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(n,i),u(h=[c.x,c.y,c.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("Box3: .clampPoint() target is now required"),t=new Kg),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Kg;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Kg;return function(t){return void 0===t&&(console.warn("Box3: .getBoundingSphere() target is now required"),t=new uy),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new Kg,new Kg,new Kg,new Kg,new Kg,new Kg,new Kg,new Kg];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(uy.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new cy;return function(t,r){var n=this.center;void 0!==r?n.copy(r):e.setFromPoints(t).getCenter(n);for(var i=0,o=0,s=t.length;o<s;o++)i=Math.max(i,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("Sphere: .clampPoint() target is now required"),t=new Kg),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("Sphere: .getBoundingBox() target is now required"),e=new cy),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.defineProperties(hy.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(hy.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new hy,t=new hy;return function(r,n){return e.set(r,r),t.set(n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*r-o*n+e.x,this.y=i*n+o*r+e.y,this}});var dy=0;function py(){Object.defineProperty(this,"id",{value:dy+=2}),this.uuid=Zg.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function fy(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function my(e,t,r){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function vy(e,t,r){my.call(this,new Int8Array(e),t,r)}function gy(e,t,r){my.call(this,new Uint8Array(e),t,r)}function yy(e,t,r){my.call(this,new Uint8ClampedArray(e),t,r)}function xy(e,t,r){my.call(this,new Int16Array(e),t,r)}function by(e,t,r){my.call(this,new Uint16Array(e),t,r)}function wy(e,t,r){my.call(this,new Int32Array(e),t,r)}function _y(e,t,r){my.call(this,new Uint32Array(e),t,r)}function Sy(e,t,r){my.call(this,new Float32Array(e),t,r)}function Ty(e,t,r){my.call(this,new Float64Array(e),t,r)}function My(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ay(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}py.prototype=Object.assign(Object.create(ey.prototype),{constructor:py,isGeometry:!0,applyMatrix:function(e){for(var t=(new ny).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){this.vertices[r].applyMatrix4(e)}for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(t).normalize();for(var o=0,s=i.vertexNormals.length;o<s;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Qg;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Qg;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Qg;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Qg;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Qg;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new oy;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,a=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)t.vertices.push(new Kg(i[d],i[d+1],i[d+2])),void 0!==o&&c.push(new Kg(o[d],o[d+1],o[d+2])),void 0!==s&&t.colors.push(new ay(s[d],s[d+1],s[d+2])),void 0!==a&&u.push(new hy(a[p],a[p+1])),void 0!==l&&h.push(new hy(l[p],l[p+1]));function f(e,r,n,i){var d=new ly(e,r,n,void 0!==o?[c[e].clone(),c[r].clone(),c[n].clone()]:[],void 0!==s?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[],i);t.faces.push(d),void 0!==a&&t.faceVertexUvs[0].push([u[e].clone(),u[r].clone(),u[n].clone()]),void 0!==l&&t.faceVertexUvs[1].push([h[e].clone(),h[r].clone(),h[n].clone()])}var m=e.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==r?f(r[p],r[p+1],r[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==r)for(d=0;d<r.length;d+=3)f(r[d],r[d+1],r[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new Kg;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new Qg;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new Kg,t=new Kg,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,o,s;for(void 0===e&&(e=!0),s=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)s[t]=new Kg;if(e){var a,l,c,u=new Kg,h=new Kg;for(n=0,i=this.faces.length;n<i;n++)o=this.faces[n],a=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(a,l),u.cross(h),s[o.a].add(u),s[o.b].add(u),s[o.c].add(u)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)s[(o=this.faces[n]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)s[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var d=(o=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(s[o.a]),d[1].copy(s[o.b]),d[2].copy(s[o.c])):(d[0]=s[o.a].clone(),d[1]=s[o.b].clone(),d[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new py;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Kg,c={a:new Kg,b:new Kg,c:new Kg},s.push(l),a.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new cy),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new uy),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new ny).getNormalMatrix(t));for(var p=0,f=s.length;p<f;p++){var m=s[p].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,g,y,x=l[p],b=x.vertexNormals,w=x.vertexColors;(v=new ly(x.a+i,x.b+i,x.c+i)).normal.copy(x.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var _=0,S=b.length;_<S;_++)g=b[_].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);v.color.copy(x.color);for(_=0,S=w.length;_<S;_++)y=w[_],v.vertexColors.push(y.clone());v.materialIndex=x.materialIndex+r,a.push(v)}for(p=0,f=u.length;p<f;p++){var T=u[p],M=[];if(void 0!==T){for(_=0,S=T.length;_<S;_++)M.push(T[_].clone());c.push(M)}}}else console.error("Geometry.merge(): geometry not an instance of Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("Geometry.mergeMesh(): mesh not an instance of Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,o,s,a,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new Kg(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===t&&(n=[]),s&&s.length===t&&(i=[]);for(r=0;r<t;r++){var a=e[r]._id;n&&n.push(o[a]),i&&i.push(s[a])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var s=[],a=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),s.push(x),s.push(p.a,p.b,p.c),s.push(p.materialIndex),f){var b=this.faceVertexUvs[0][i];s.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&s.push(T(p.normal)),v){var w=p.vertexNormals;s.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&s.push(M(p.color)),y){var _=p.vertexColors;s.push(M(_[0]),M(_[1]),M(_[2]))}}function S(e,t,r){return r?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=a.length/3,a.push(e.x,e.y,e.z),l[t])}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function A(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=n,e.data.normals=a,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=s,e},clone:function(){return(new py).copy(this)},copy:function(e){var t,r,n,i,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var a=e.vertices;for(t=0,r=a.length;t<r;t++)this.vertices.push(a[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,r=c.length;t<r;t++)this.faces.push(c[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(o=0,s=h.length;o<s;o++){var p=h[o];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}var f=e.morphTargets;for(t=0,r=f.length;t<r;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],n=0,i=f[t].vertices.length;n<i;n++)m.vertices.push(f[t].vertices[n].clone());if(void 0!==f[t].normals)for(m.normals=[],n=0,i=f[t].normals.length;n<i;n++)m.normals.push(f[t].normals[n].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,r=v.length;t<r;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],n=0,i=v[t].vertexNormals.length;n<i;n++){var y=v[t].vertexNormals[n],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),g.vertexNormals.push(x)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],n=0,i=v[t].faceNormals.length;n<i;n++)g.faceNormals.push(v[t].faceNormals[n].clone());this.morphNormals.push(g)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var w=e.skinIndices;for(t=0,r=w.length;t<r;t++)this.skinIndices.push(w[t].clone());var _=e.lineDistances;for(t=0,r=_.length;t<r;t++)this.lineDistances.push(_[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(fy.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,o=e.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(s+1)/2,v=(u+1)/2,g=(f+1)/2,y=(a+c)/4,x=(l+d)/4,b=(h+p)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=x/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(g)),n=b/i),this.set(r,n,i,t),this}var w=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-d)/w,this.z=(c-a)/w,this.w=Math.acos((s+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new fy,t=new fy),e.set(r,r,r,r),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Object.defineProperty(my.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(my.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",n),o=new ay),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new hy),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new Kg),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new fy),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),vy.prototype=Object.create(my.prototype),vy.prototype.constructor=vy,gy.prototype=Object.create(my.prototype),gy.prototype.constructor=gy,yy.prototype=Object.create(my.prototype),yy.prototype.constructor=yy,xy.prototype=Object.create(my.prototype),xy.prototype.constructor=xy,by.prototype=Object.create(my.prototype),by.prototype.constructor=by,wy.prototype=Object.create(my.prototype),wy.prototype.constructor=wy,_y.prototype=Object.create(my.prototype),_y.prototype.constructor=_y,Sy.prototype=Object.create(my.prototype),Sy.prototype.constructor=Sy,Ty.prototype=Object.create(my.prototype),Ty.prototype.constructor=Ty,Object.assign(My.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,o=0;o<i.length;o++){var s=i[o];s.materialIndex!==n&&(n=s.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:n})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=e.morphTargets,l=a.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]=[];this.morphTargets.position=t}var u,h=e.morphNormals,d=h.length;if(d>0){u=[];for(c=0;c<d;c++)u[c]=[];this.morphTargets.normal=u}var p=e.skinIndices,f=e.skinWeights,m=p.length===n.length,v=f.length===n.length;for(c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}if(!0===o)void 0!==(b=i[0][c])?this.uvs.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new hy,new hy,new hy));if(!0===s)void 0!==(b=i[1][c])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new hy,new hy,new hy));for(var S=0;S<l;S++){var T=a[S].vertices;t[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[c];u[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Ey=1;function Cy(){Object.defineProperty(this,"id",{value:Ey+=2}),this.uuid=Zg.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Py(e,t,r,n,i,o,s){py.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Oy(e,t,r,n,i,o,s)),this.mergeVertices()}function Oy(e,t,r,n,i,o,s){Cy.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var a,l,c=(o=void 0!==o?o:0)+(s=void 0!==s?s:Math.PI),u=0,h=[],d=new Kg,p=new Kg,f=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],x=l/r;for(a=0;a<=t;a++){var b=a/t;d.x=-e*Math.cos(n+b*i)*Math.sin(o+x*s),d.y=e*Math.cos(o+x*s),d.z=e*Math.sin(n+b*i)*Math.sin(o+x*s),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(b,1-x),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(a=0;a<t;a++){var w=h[l][a+1],_=h[l][a],S=h[l+1][a],T=h[l+1][a+1];(0!==l||o>0)&&f.push(w,_,T),(l!==r-1||c<Math.PI)&&f.push(_,S,T)}this.setIndex(f),this.addAttribute("position",new Sy(m,3)),this.addAttribute("normal",new Sy(v,3)),this.addAttribute("uv",new Sy(g,2))}Cy.prototype=Object.assign(Object.create(ey.prototype),{constructor:Cy,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Ay(e)>65535?_y:by)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new my(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new ny).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Qg;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Qg;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Qg;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Qg;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Qg;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new oy;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Kg;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new Sy(3*t.vertices.length,3),n=new Sy(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Sy(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Sy(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new My).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new my(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new my(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new my(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new my(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new my(o,2).copyVector2sArray(e.uvs2))}for(var s in this.groups=e.groups,e.morphTargets){for(var a=[],l=e.morphTargets[s],c=0,u=l.length;c<u;c++){var h=l[c],d=new Sy(3*h.length,3);a.push(d.copyVector3sArray(h))}this.morphAttributes[s]=a}if(e.skinIndices.length>0){var p=new Sy(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Sy(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new cy);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new cy,t=new Kg;return function(){null===this.boundingSphere&&(this.boundingSphere=new uy);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;e.setFromBufferAttribute(r),e.getCenter(n);for(var i=0,o=0,s=r.count;o<s;o++)t.x=r.getX(o),t.y=r.getY(o),t.z=r.getZ(o),i=Math.max(i,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new my(new Float32Array(n.length),3));else for(var i=t.normal.array,o=0,s=i.length;o<s;o++)i[o]=0;var a,l,c,u=t.normal.array,h=new Kg,d=new Kg,p=new Kg,f=new Kg,m=new Kg;if(e){var v=e.array;0===r.length&&this.addGroup(0,v.length);for(var g=0,y=r.length;g<y;++g){var x=r[g],b=x.start;for(o=b,s=b+x.count;o<s;o+=3)a=3*v[o+0],l=3*v[o+1],c=3*v[o+2],h.fromArray(n,a),d.fromArray(n,l),p.fromArray(n,c),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[a]+=f.x,u[a+1]+=f.y,u[a+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z}}else for(o=0,s=n.length;o<s;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n].array,o=e.attributes[n],s=o.array,a=0,l=o.itemSize*t;a<s.length;a++,l++)i[l]=s[a];return this}console.error("BufferGeometry.merge(): geometry not an instance of BufferGeometry.",e)},normalizeNormals:function(){var e=new Kg;return function(){for(var t=this.attributes.normal,r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Cy,t=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],o=i.array,s=i.itemSize,a=new o.constructor(t.length*s),l=0,c=0,u=0,h=t.length;u<h;u++){l=t[u]*s;for(var d=0;d<s;d++)a[c++]=o[l++]}e.addAttribute(n,new my(a,s))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];e.addGroup(f.start,f.count,f.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var s=o[r];i=Array.prototype.slice.call(s.array);e.data.attributes[r]={itemSize:s.itemSize,type:s.array.constructor.name,array:i,normalized:s.normalized}}var a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new Cy).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var s=o[t];this.addAttribute(t,s.clone())}var a=e.morphAttributes;for(t in a){var l=[],c=a[t];for(r=0,n=c.length;r<n;r++)l.push(c[r].clone());this.morphAttributes[t]=l}var u=e.groups;for(r=0,n=u.length;r<n;r++){var h=u[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Py.prototype=Object.create(py.prototype),Py.prototype.constructor=Py,Oy.prototype=Object.create(Cy.prototype),Oy.prototype.constructor=Oy;var Dy="91",Ny=0,Ly=1,Iy=2,Ry=0,Fy=1,ky=2,Uy=0,By=1,jy=2,zy=0,Vy=1,Gy=2,Hy=3,Wy=4,Xy=5,qy=100,Yy=101,Jy=102,Zy=200,Qy=201,Ky=202,$y=203,ex=204,tx=205,rx=206,nx=207,ix=208,ox=209,sx=210,ax=0,lx=1,cx=2,ux=3,hx=4,dx=5,px=7,fx=0,mx=2,vx=1,gx=300,yx=301,xx=302,bx=303,wx=304,_x=305,Sx=306,Tx=307,Mx=1e3,Ax=1001,Ex=1002,Cx=1003,Px=1004,Ox=1005,Dx=1006,Nx=1007,Lx=1008,Ix=1009,Rx=1012,Fx=1015,kx=1016,Ux=1017,Bx=1018,jx=1019,zx=1020,Vx=1021,Gx=1022,Hx=1023,Wx=1024,Xx=1025,qx=Hx,Yx=1026,Jx=1027,Zx=33776,Qx=33778,Kx=33779,$x=35840,eb=35841,tb=35842,rb=35843,nb=36196,ib=2201,ob=2300,sb=2400,ab=0,lb=1,cb=2,ub=3e3,hb=3001,db=3007,pb=3002,fb=3005,mb=3200,vb=3201,gb=0;function yb(){Object.defineProperty(this,"id",{value:gb++}),this.uuid=Zg.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Vy,this.side=Ry,this.flatShading=!1,this.vertexColors=Uy,this.opacity=1,this.transparent=!1,this.blendSrc=ex,this.blendDst=tx,this.blendEquation=qy,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ux,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function xb(e){yb.call(this),this.type="MeshBasicMaterial",this.color=new ay(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function bb(e){yb.call(this),this.type="LineBasicMaterial",this.color=new ay(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function wb(e,t){this.origin=void 0!==e?e:new Kg,this.direction=void 0!==t?t:new Kg}function _b(e,t){this.start=void 0!==e?e:new Kg,this.end=void 0!==t?t:new Kg}function Sb(e,t){this.normal=void 0!==e?e:new Kg(1,0,0),this.constant=void 0!==t?t:0}function Tb(e,t,r){this.a=void 0!==e?e:new Kg,this.b=void 0!==t?t:new Kg,this.c=void 0!==r?r:new Kg}function Mb(e,t){oy.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Cy,this.material=void 0!==t?t:new xb({color:16777215*Math.random()}),this.drawMode=ab,this.updateMorphTargets()}function Ab(e,t,r){1===r&&console.error("Line: parameter LinePieces no longer supported. Created LineSegments instead."),oy.call(this),this.type="Line",this.geometry=void 0!==e?e:new Cy,this.material=void 0!==t?t:new bb({color:16777215*Math.random()})}yb.prototype=Object.assign(Object.create(ey.prototype),{constructor:yb,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]="overdraw"===t?Number(r):r:console.warn(this.type+": '"+t+"' is not a property of this material.")}else console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Vy&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==Ry&&(r.side=this.side),this.vertexColors!==Uy&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),o=n(e.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),xb.prototype=Object.create(yb.prototype),xb.prototype.constructor=xb,xb.prototype.isMeshBasicMaterial=!0,xb.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},bb.prototype=Object.create(yb.prototype),bb.prototype.constructor=bb,bb.prototype.isLineBasicMaterial=!0,bb.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Object.assign(wb.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("Ray: .at() target is now required"),t=new Kg),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Kg;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("Ray: .closestPointToPoint() target is now required"),t=new Kg),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Kg;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new Kg,t=new Kg,r=new Kg;return function(n,i,o,s){e.copy(n).add(i).multiplyScalar(.5),t.copy(i).sub(n).normalize(),r.copy(this.origin).sub(e);var a,l,c,u,h=.5*n.distanceTo(i),d=-this.direction.dot(t),p=r.dot(this.direction),f=-r.dot(t),m=r.lengthSq(),v=Math.abs(1-d*d);if(v>0)if(l=d*p-f,u=h*v,(a=d*f-p)>=0)if(l>=-u)if(l<=u){var g=1/v;c=(a*=g)*(a+d*(l*=g)+2*p)+l*(d*a+l+2*f)+m}else l=h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l=-h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l<=-u?c=-(a=Math.max(0,-(-d*h+p)))*a+(l=a>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(a=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(a=Math.max(0,-(d*h+p)))*a+(l=a>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=d>0?-h:h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new Kg;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,o=t.radius*t.radius;if(i>o)return null;var s=Math.sqrt(o-i),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,r):this.at(a,r)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,n,i,o,s,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),r>a||s>n?null:((s>r||r!=r)&&(r=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:function(){var e=new Kg;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new Kg,t=new Kg,r=new Kg,n=new Kg;return function(i,o,s,a,l){t.subVectors(o,i),r.subVectors(s,i),n.crossVectors(t,r);var c,u=this.direction.dot(n);if(u>0){if(a)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,i);var h=c*this.direction.dot(r.crossVectors(e,r));if(h<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>u)return null;var p=-c*e.dot(n);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(_b.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("Line3: .getCenter() target is now required"),e=new Kg),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("Line3: .delta() target is now required"),e=new Kg),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("Line3: .at() target is now required"),t=new Kg),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new Kg,t=new Kg;return function(r,n){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),o=t.dot(e)/i;return n&&(o=Zg.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("Line3: .closestPointToPoint() target is now required"),r=new Kg),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(Sb.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Kg,t=new Kg;return function(r,n,i){var o=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("Plane: .projectPoint() target is now required"),t=new Kg),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Kg;return function(t,r){void 0===r&&(console.warn("Plane: .intersectLine() target is now required"),r=new Kg);var n=t.delta(e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:r.copy(n).multiplyScalar(o).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("Plane: .coplanarPoint() target is now required"),e=new Kg),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Kg,t=new ny;return function(r,n){var i=n||t.getNormalMatrix(r),o=this.coplanarPoint(e).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(s),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Tb,{getNormal:function(){var e=new Kg;return function(t,r,n,i){void 0===i&&(console.warn("Triangle: .getNormal() target is now required"),i=new Kg),i.subVectors(n,r),e.subVectors(t,r),i.cross(e);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}}(),getBarycoord:function(){var e=new Kg,t=new Kg,r=new Kg;return function(n,i,o,s,a){e.subVectors(s,i),t.subVectors(o,i),r.subVectors(n,i);var l=e.dot(e),c=e.dot(t),u=e.dot(r),h=t.dot(t),d=t.dot(r),p=l*h-c*c;if(void 0===a&&(console.warn("Triangle: .getBarycoord() target is now required"),a=new Kg),0===p)return a.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,v=(l*d-c*u)*f;return a.set(1-m-v,v,m)}}(),containsPoint:function(){var e=new Kg;return function(t,r,n,i){return Tb.getBarycoord(t,r,n,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}()}),Object.assign(Tb.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Kg,t=new Kg;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("Triangle: .getMidpoint() target is now required"),e=new Kg),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Tb.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("Triangle: .getPlane() target is now required"),e=new Kg),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Tb.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Tb.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new Sb,t=[new _b,new _b,new _b],r=new Kg,n=new Kg;return function(i,o){void 0===o&&(console.warn("Triangle: .closestPointToPoint() target is now required"),o=new Kg);var s=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(i,r),!0===this.containsPoint(r))o.copy(r);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var a=0;a<t.length;a++){t[a].closestPointToPoint(r,!0,n);var l=r.distanceToSquared(n);l<s&&(s=l,o.copy(n))}}return o}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Mb.prototype=Object.assign(Object.create(oy.prototype),{constructor:Mb,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return oy.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var s=i[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)r=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var a=n.morphTargets;if(void 0!==a&&a.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},raycast:function(){var e=new Qg,t=new wb,r=new uy,n=new Kg,i=new Kg,o=new Kg,s=new Kg,a=new Kg,l=new Kg,c=new hy,u=new hy,h=new hy,d=new Kg,p=new Kg,f=new Kg;function m(e,t,r,n,i,o,s){return Tb.getBarycoord(e,t,r,n,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),s.multiplyScalar(d.z),i.add(o).add(s),i.clone()}function v(e,t,r,n,i,o,s,a){if(null===(t.side===Fy?n.intersectTriangle(s,o,i,!0,a):n.intersectTriangle(i,o,s,t.side!==ky,a)))return null;f.copy(a),f.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(f);return l<r.near||l>r.far?null:{distance:l,point:f.clone(),object:e}}function g(e,t,r,s,a,l,d,f){n.fromBufferAttribute(s,l),i.fromBufferAttribute(s,d),o.fromBufferAttribute(s,f);var g=v(e,e.material,t,r,n,i,o,p);if(g){a&&(c.fromBufferAttribute(a,l),u.fromBufferAttribute(a,d),h.fromBufferAttribute(a,f),g.uv=m(p,n,i,o,c,u,h));var y=new ly(l,d,f);Tb.getNormal(n,i,o,y.normal),g.face=y,g.faceIndex=l}return g}return function(d,f){var y,x=this.geometry,b=this.material,w=this.matrixWorld;if(void 0!==b&&(null===x.boundingSphere&&x.computeBoundingSphere(),r.copy(x.boundingSphere),r.applyMatrix4(w),!1!==d.ray.intersectsSphere(r)&&(e.getInverse(w),t.copy(d.ray).applyMatrix4(e),null===x.boundingBox||!1!==t.intersectsBox(x.boundingBox))))if(x.isBufferGeometry){var _,S,T,M,A,E=x.index,C=x.attributes.position,P=x.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(y=g(this,d,t,C,P,_,S,T))&&(y.faceIndex=Math.floor(M/3),f.push(y));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(y=g(this,d,t,C,P,_=M,S=M+1,T=M+2))&&(y.index=_,f.push(y))}else if(x.isGeometry){var O,D,N,L,I=Array.isArray(b),R=x.vertices,F=x.faces,k=x.faceVertexUvs[0];k.length>0&&(L=k);for(var U=0,B=F.length;U<B;U++){var j=F[U],z=I?b[j.materialIndex]:b;if(void 0!==z){if(O=R[j.a],D=R[j.b],N=R[j.c],!0===z.morphTargets){var V=x.morphTargets,G=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var q=V[H].vertices;n.addScaledVector(s.subVectors(q[j.a],O),X),i.addScaledVector(a.subVectors(q[j.b],D),X),o.addScaledVector(l.subVectors(q[j.c],N),X)}}n.add(O),i.add(D),o.add(N),O=n,D=i,N=o}if(y=v(this,z,d,t,O,D,N,p)){if(L&&L[U]){var Y=L[U];c.copy(Y[0]),u.copy(Y[1]),h.copy(Y[2]),y.uv=m(p,O,D,N,c,u,h)}y.face=j,y.faceIndex=U,f.push(y)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ab.prototype=Object.assign(Object.create(oy.prototype),{constructor:Ab,isLine:!0,computeLineDistances:function(){var e=new Kg,t=new Kg;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[0],o=1,s=n.count;o<s;o++)e.fromBufferAttribute(n,o-1),t.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=e.distanceTo(t);r.addAttribute("lineDistance",new Sy(i,1))}else console.error("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;(i=r.lineDistances)[0]=0;for(o=1,s=a.length;o<s;o++)i[o]=i[o-1],i[o]+=a[o-1].distanceTo(a[o])}return this}}(),raycast:function(){var e=new Qg,t=new wb,r=new uy;return function(n,i){var o=n.linePrecision,s=o*o,a=this.geometry,l=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)){e.getInverse(l),t.copy(n.ray).applyMatrix4(e);var c=new Kg,u=new Kg,h=new Kg,d=new Kg,p=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var f=a.index,m=a.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=p){var x=v[g],b=v[g+1];if(c.fromArray(m,3*x),u.fromArray(m,3*b),!(t.distanceSqToSegment(c,u,d,h)>s))d.applyMatrix4(this.matrixWorld),(S=n.ray.origin.distanceTo(d))<n.near||S>n.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}else for(g=0,y=m.length/3-1;g<y;g+=p){if(c.fromArray(m,3*g),u.fromArray(m,3*g+3),!(t.distanceSqToSegment(c,u,d,h)>s))d.applyMatrix4(this.matrixWorld),(S=n.ray.origin.distanceTo(d))<n.near||S>n.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}else if(a.isGeometry){var w=a.vertices,_=w.length;for(g=0;g<_-1;g+=p){var S;if(!(t.distanceSqToSegment(w[g],w[g+1],d,h)>s))d.applyMatrix4(this.matrixWorld),(S=n.ray.origin.distanceTo(d))<n.near||S>n.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Eb=function(e){this.mesh=e,this._valid()};Eb.prototype={constructor:Eb,_valid:function(){for(var e=this.mesh.geometry.iks,t=this.mesh.skeleton.bones,r=0,n=e.length;r<n;r++){var i,o,s=e[r],a=t[s.effector],l=s.links;i=a;for(var c=0,u=l.length;c<u;c++)o=t[l[c].index],i.parent!==o&&console.warn("CCDIKSolver: bone "+i.name+" is not the child of bone "+o.name),i=o}},_saveOriginalBonesInfo:function(){for(var e=this.mesh.skeleton.bones,t=0,r=e.length;t<r;t++){var n=e[t];void 0===n.userData.ik&&(n.userData.ik={}),n.userData.ik.originalMatrix=n.matrix.toArray()}},update:function(e){var t=new $g,r=new Kg,n=new Kg,i=new Kg,o=new Kg,s=new Kg,a=new $g,l=new Kg,c=new Kg,u=this.mesh.skeleton.bones,h=this.mesh.geometry.iks,d=(this.mesh.geometry.bones,Math);this.mesh.updateMatrixWorld(!0),!0===e&&this._saveOriginalBonesInfo();for(var p=0,f=h.length;p<f;p++){var m=h[p],v=u[m.effector],g=u[m.target];r.setFromMatrixPosition(g.matrixWorld);for(var y=m.links,x=void 0!==m.iteration?m.iteration:1,b=0;b<x;b++){for(var w=!1,_=0,S=y.length;_<S;_++){var T=u[y[_].index];if(!1===y[_].enabled)break;var M=y[_].limitation;T.matrixWorld.decompose(s,a,l),a.inverse(),i.setFromMatrixPosition(v.matrixWorld),o.subVectors(i,s),o.applyQuaternion(a),o.normalize(),n.subVectors(r,s),n.applyQuaternion(a),n.normalize();var A=n.dot(o);if(A>1?A=1:A<-1&&(A=-1),!((A=d.acos(A))<1e-5)){if(void 0!==m.minAngle&&A<m.minAngle&&(A=m.minAngle),void 0!==m.maxAngle&&A>m.maxAngle&&(A=m.maxAngle),c.crossVectors(o,n),c.normalize(),t.setFromAxisAngle(c,A),T.quaternion.multiply(t),void 0!==M){var E=T.quaternion.w;E>1&&(E=1);var C=d.sqrt(1-E*E);T.quaternion.set(M.x*C,M.y*C,M.z*C,E)}T.updateMatrixWorld(!0),w=!0}}if(!w)break}}this.mesh.updateMatrixWorld(!0)}};var Cb=function(e){if(void 0===e.geometry.iks||void 0===e.skeleton)throw"CCDIKHelper requires iks in mesh.geometry and skeleton in mesh.";oy.call(this),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.sphereGeometry=new Oy(.25,16,8),this.targetSphereMaterial=new xb({color:new ay(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new xb({color:new ay(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new xb({color:new ay(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new bb({color:new ay(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init(),this.update()};function Pb(){oy.call(this),this.type="Bone"}function Ob(e,t,r,n,i,o){py.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Db(e,t,r,n,i,o)),this.mergeVertices()}function Db(e,t,r,n,i,o){Cy.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var s=this;e=e||1,t=t||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var a=[],l=[],c=[],u=[],h=0,d=0;function p(e,t,r,n,i,o,p,f,m,v,g){var y,x,b=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new Kg;for(x=0;x<A;x++){var O=x*w-S;for(y=0;y<M;y++){var D=y*b-_;P[e]=D*n,P[t]=O*i,P[r]=T,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[r]=f>0?1:-1,c.push(P.x,P.y,P.z),u.push(y/m),u.push(1-x/v),E+=1}}for(x=0;x<v;x++)for(y=0;y<m;y++){var N=h+y+M*x,L=h+y+M*(x+1),I=h+(y+1)+M*(x+1),R=h+(y+1)+M*x;a.push(N,L,R),a.push(L,I,R),C+=6}s.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,r,t,e,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,r,t,-e,o,i,1),p("x","z","y",1,1,e,r,t,n,o,2),p("x","z","y",1,-1,e,r,-t,n,o,3),p("x","y","z",1,-1,e,t,r,n,i,4),p("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(a),this.addAttribute("position",new Sy(l,3)),this.addAttribute("normal",new Sy(c,3)),this.addAttribute("uv",new Sy(u,2))}function Nb(e,t,r,n,i,o,s,a){py.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new Lb(e,t,r,n,i,o,s,a)),this.mergeVertices()}function Lb(e,t,r,n,i,o,s,a){Cy.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var c=[],u=[],h=[],d=[],p=0,f=[],m=r/2,v=0;function g(r){var i,o,f,g=new hy,y=new Kg,x=0,b=!0===r?e:t,w=!0===r?1:-1;for(o=p,i=1;i<=n;i++)u.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=n;i++){var _=i/n*a+s,S=Math.cos(_),T=Math.sin(_);y.x=b*T,y.y=m*w,y.z=b*S,u.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<n;i++){var M=o+i,A=f+i;!0===r?c.push(A,A+1,M):c.push(A+1,A,M),x+=3}l.addGroup(v,x,!0===r?1:2),v+=x}!function(){var o,g,y=new Kg,x=new Kg,b=0,w=(t-e)/r;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(t-e)+e;for(o=0;o<=n;o++){var M=o/n,A=M*a+s,E=Math.sin(A),C=Math.cos(A);x.x=T*E,x.y=-S*r+m,x.z=T*C,u.push(x.x,x.y,x.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<n;o++)for(g=0;g<i;g++){var P=f[g][o],O=f[g+1][o],D=f[g+1][o+1],N=f[g][o+1];c.push(P,O,N),c.push(O,D,N),b+=6}l.addGroup(v,b,0),v+=b}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.addAttribute("position",new Sy(u,3)),this.addAttribute("normal",new Sy(h,3)),this.addAttribute("uv",new Sy(d,2))}Cb.prototype=Object.create(oy.prototype),Cb.prototype.constructor=Cb,Cb.prototype._init=function(){var e=this,t=this.root.geometry.iks;function r(t){return new Ab(function(e){var t=new Cy,r=new Float32Array(3*(2+e.links.length));return t.addAttribute("position",new my(r,3)),t}(t),e.lineMaterial)}for(var n=0,i=t.length;n<i;n++){var o=t[n];this.add(new Mb(e.sphereGeometry,e.targetSphereMaterial)),this.add(new Mb(e.sphereGeometry,e.effectorSphereMaterial));for(var s=0,a=o.links.length;s<a;s++)this.add(new Mb(e.sphereGeometry,e.linkSphereMaterial));this.add(r(o))}},Cb.prototype.update=function(){var e=0,t=this.root,r=t.geometry.iks,n=t.skeleton.bones,i=(new Qg).getInverse(t.matrixWorld),o=new Kg;function s(e){return o.setFromMatrixPosition(e.matrixWorld),o.applyMatrix4(i),o}function a(e,t,r){var n=s(r);e[3*t+0]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z}for(var l=0,c=r.length;l<c;l++){var u=r[l],h=n[u.target],d=n[u.effector],p=this.children[e++],f=this.children[e++];p.position.copy(s(h)),f.position.copy(s(d));for(var m=0,v=u.links.length;m<v;m++){var g=n[u.links[m].index];this.children[e++].position.copy(s(g))}var y=this.children[e++],x=y.geometry.attributes.position.array;a(x,0,h),a(x,1,d);for(m=0,v=u.links.length;m<v;m++){a(x,m+2,g=n[u.links[m].index])}y.geometry.attributes.position.needsUpdate=!0}},Pb.prototype=Object.assign(Object.create(oy.prototype),{constructor:Pb,isBone:!0}),Ob.prototype=Object.create(py.prototype),Ob.prototype.constructor=Ob,Db.prototype=Object.create(Cy.prototype),Db.prototype.constructor=Db,Nb.prototype=Object.create(py.prototype),Nb.prototype.constructor=Nb,Lb.prototype=Object.create(Cy.prototype),Lb.prototype.constructor=Lb;var Ib=function(e,t){void 0===t&&(t={}),this.mesh=e,this.helper=new Ib.ResourceHelper,this.unitStep=void 0!==t.unitStep?t.unitStep:1/65,this.maxStepNum=void 0!==t.maxStepNum?t.maxStepNum:3,this.world=void 0!==t.world?t.world:null,this.bodies=[],this.constraints=[],this.init(e)};Ib.prototype={constructor:Ib,init:function(e){var t=e.parent;null!==t&&t.remove(e);var r=this.helper,n=r.allocThreeVector3(),i=r.allocThreeEuler(),o=r.allocThreeVector3();n.copy(e.position),i.copy(e.rotation),o.copy(e.scale),e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrixWorld(!0),null===this.world&&this.initWorld(),this.initRigidBodies(),this.initConstraints(),null!==t&&t.add(e),e.position.copy(n),e.rotation.copy(i),e.scale.copy(o),e.updateMatrixWorld(!0),this.reset(),r.freeThreeVector3(n),r.freeThreeEuler(i),r.freeThreeVector3(o)},initWorld:function(){var e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver,i=new Ammo.btDiscreteDynamicsWorld(t,r,n,e);i.setGravity(new Ammo.btVector3(0,-98,0)),this.world=i},initRigidBodies:function(){for(var e=this.mesh.geometry.rigidBodies,t=0;t<e.length;t++){var r=new Ib.RigidBody(this.mesh,this.world,e[t],this.helper);this.bodies.push(r)}},initConstraints:function(){for(var e=this.mesh.geometry.constraints,t=0;t<e.length;t++){var r=e[t],n=this.bodies[r.rigidBodyIndex1],i=this.bodies[r.rigidBodyIndex2],o=new Ib.Constraint(this.mesh,this.world,n,i,r,this.helper);this.constraints.push(o)}},update:function(e){this.updateRigidBodies(),this.stepSimulation(e),this.updateBones()},stepSimulation:function(e){var t=this.unitStep,r=e,n=1+(e/t|0);r<t&&(r=t,n=1),n>this.maxStepNum&&(n=this.maxStepNum),this.world.stepSimulation(r,n,t)},updateRigidBodies:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].updateFromBone()},updateBones:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].updateBone()},reset:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].reset()},warmup:function(e){for(var t=0;t<e;t++)this.update(1/60)}},Ib.ResourceHelper=function(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]},Ib.ResourceHelper.prototype={allocThreeVector3:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new Kg},freeThreeVector3:function(e){this.threeVector3s.push(e)},allocThreeMatrix4:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new Qg},freeThreeMatrix4:function(e){this.threeMatrix4s.push(e)},allocThreeQuaternion:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new $g},freeThreeQuaternion:function(e){this.threeQuaternions.push(e)},allocThreeEuler:function(){return this.threeEulers.length>0?this.threeEulers.pop():new ty},freeThreeEuler:function(e){this.threeEulers.push(e)},allocTransform:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform},freeTransform:function(e){this.transforms.push(e)},allocQuaternion:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(e){this.quaternions.push(e)},allocVector3:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(e){this.vector3s.push(e)},setIdentity:function(e){e.setIdentity()},getBasis:function(e){var t=this.allocQuaternion();return e.getBasis().getRotation(t),t},getBasisAsMatrix3:function(e){var t=this.getBasis(e),r=this.quaternionToMatrix3(t);return this.freeQuaternion(t),r},getOrigin:function(e){return e.getOrigin()},setOrigin:function(e,t){e.getOrigin().setValue(t.x(),t.y(),t.z())},copyOrigin:function(e,t){var r=t.getOrigin();this.setOrigin(e,r)},setBasis:function(e,t){e.setRotation(t)},setBasisFromMatrix3:function(e,t){var r=this.matrix3ToQuaternion(t);this.setBasis(e,r),this.freeQuaternion(r)},setOriginFromArray3:function(e,t){e.getOrigin().setValue(t[0],t[1],t[2])},setOriginFromThreeVector3:function(e,t){e.getOrigin().setValue(t.x,t.y,t.z)},setBasisFromArray3:function(e,t){var r=this.allocThreeQuaternion(),n=this.allocThreeEuler();n.set(t[0],t[1],t[2]),this.setBasisFromThreeQuaternion(e,r.setFromEuler(n)),this.freeThreeEuler(n),this.freeThreeQuaternion(r)},setBasisFromThreeQuaternion:function(e,t){var r=this.allocQuaternion();r.setX(t.x),r.setY(t.y),r.setZ(t.z),r.setW(t.w),this.setBasis(e,r),this.freeQuaternion(r)},multiplyTransforms:function(e,t){var r=this.allocTransform();this.setIdentity(r);var n=this.getBasisAsMatrix3(e),i=this.getBasisAsMatrix3(t),o=this.getOrigin(e),s=this.getOrigin(t),a=this.multiplyMatrix3ByVector3(n,s),l=this.addVector3(a,o);this.setOrigin(r,l);var c=this.multiplyMatrices3(n,i);return this.setBasisFromMatrix3(r,c),this.freeVector3(a),this.freeVector3(l),r},inverseTransform:function(e){var t=this.allocTransform(),r=this.getBasisAsMatrix3(e),n=this.getOrigin(e),i=this.transposeMatrix3(r),o=this.negativeVector3(n),s=this.multiplyMatrix3ByVector3(i,o);return this.setOrigin(t,s),this.setBasisFromMatrix3(t,i),this.freeVector3(o),this.freeVector3(s),t},multiplyMatrices3:function(e,t){var r=[],n=this.rowOfMatrix3(e,0),i=this.rowOfMatrix3(e,1),o=this.rowOfMatrix3(e,2),s=this.columnOfMatrix3(t,0),a=this.columnOfMatrix3(t,1),l=this.columnOfMatrix3(t,2);return r[0]=this.dotVectors3(n,s),r[1]=this.dotVectors3(n,a),r[2]=this.dotVectors3(n,l),r[3]=this.dotVectors3(i,s),r[4]=this.dotVectors3(i,a),r[5]=this.dotVectors3(i,l),r[6]=this.dotVectors3(o,s),r[7]=this.dotVectors3(o,a),r[8]=this.dotVectors3(o,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),this.freeVector3(s),this.freeVector3(a),this.freeVector3(l),r},addVector3:function(e,t){var r=this.allocVector3();return r.setValue(e.x()+t.x(),e.y()+t.y(),e.z()+t.z()),r},dotVectors3:function(e,t){return e.x()*t.x()+e.y()*t.y()+e.z()*t.z()},rowOfMatrix3:function(e,t){var r=this.allocVector3();return r.setValue(e[3*t+0],e[3*t+1],e[3*t+2]),r},columnOfMatrix3:function(e,t){var r=this.allocVector3();return r.setValue(e[t+0],e[t+3],e[t+6]),r},negativeVector3:function(e){var t=this.allocVector3();return t.setValue(-e.x(),-e.y(),-e.z()),t},multiplyMatrix3ByVector3:function(e,t){var r=this.allocVector3(),n=this.rowOfMatrix3(e,0),i=this.rowOfMatrix3(e,1),o=this.rowOfMatrix3(e,2),s=this.dotVectors3(n,t),a=this.dotVectors3(i,t),l=this.dotVectors3(o,t);return r.setValue(s,a,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),r},transposeMatrix3:function(e){var t=[];return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},quaternionToMatrix3:function(e){var t=[],r=e.x(),n=e.y(),i=e.z(),o=e.w(),s=r*r,a=n*n,l=i*i,c=r*n,u=n*i,h=i*r,d=r*o,p=n*o,f=i*o;return t[0]=1-2*(a+l),t[1]=2*(c-f),t[2]=2*(h+p),t[3]=2*(c+f),t[4]=1-2*(l+s),t[5]=2*(u-d),t[6]=2*(h-p),t[7]=2*(u+d),t[8]=1-2*(s+a),t},matrix3ToQuaternion:function(e){var t,r,n,i,o,s=e[0]+e[4]+e[8];s>0?(o=.25*(t=2*Math.sqrt(s+1)),r=(e[7]-e[5])/t,n=(e[2]-e[6])/t,i=(e[3]-e[1])/t):e[0]>e[4]&&e[0]>e[8]?(t=2*Math.sqrt(1+e[0]-e[4]-e[8]),o=(e[7]-e[5])/t,r=.25*t,n=(e[1]+e[3])/t,i=(e[2]+e[6])/t):e[4]>e[8]?(t=2*Math.sqrt(1+e[4]-e[0]-e[8]),o=(e[2]-e[6])/t,r=(e[1]+e[3])/t,n=.25*t,i=(e[5]+e[7])/t):(t=2*Math.sqrt(1+e[8]-e[0]-e[4]),o=(e[3]-e[1])/t,r=(e[2]+e[6])/t,n=(e[5]+e[7])/t,i=.25*t);var a=this.allocQuaternion();return a.setX(r),a.setY(n),a.setZ(i),a.setW(o),a}},Ib.RigidBody=function(e,t,r,n){this.mesh=e,this.world=t,this.params=r,this.helper=n,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this.init()},Ib.RigidBody.prototype={constructor:Ib.RigidBody,init:function(){var e=this.helper,t=this.params,r=this.mesh.skeleton.bones,n=-1===t.boneIndex?new Pb:r[t.boneIndex],i=function(e){switch(e.shapeType){case 0:return new Ammo.btSphereShape(e.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(e.width,e.height,e.depth));case 2:return new Ammo.btCapsuleShape(e.width,e.height);default:throw"unknown shape type "+e.shapeType}}(t),o=0===t.type?0:t.weight,s=e.allocVector3();s.setValue(0,0,0),0!==o&&i.calculateLocalInertia(o,s);var a=e.allocTransform();e.setIdentity(a),e.setOriginFromArray3(a,t.position),e.setBasisFromArray3(a,t.rotation);var l=e.allocThreeVector3(),c=e.allocTransform();e.setIdentity(c),e.setOriginFromThreeVector3(c,n.getWorldPosition(l));var u=e.multiplyTransforms(c,a),h=new Ammo.btDefaultMotionState(u),d=new Ammo.btRigidBodyConstructionInfo(o,h,i,s);d.set_m_friction(t.friction),d.set_m_restitution(t.restitution);var p=new Ammo.btRigidBody(d);0===t.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(t.positionDamping,t.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<t.groupIndex,t.groupTarget),this.body=p,this.bone=n,this.boneOffsetForm=a,this.boneOffsetFormInverse=e.inverseTransform(a),e.freeVector3(s),e.freeTransform(u),e.freeTransform(c),e.freeThreeVector3(l)},reset:function(){this.setTransformFromBone()},updateFromBone:function(){-1!==this.params.boneIndex&&0===this.params.type&&this.setTransformFromBone()},updateBone:function(){0!==this.params.type&&-1!==this.params.boneIndex&&(this.updateBoneRotation(),1===this.params.type&&this.updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this.setPositionFromBone())},getBoneTransform:function(){var e=this.helper,t=e.allocThreeVector3(),r=e.allocThreeQuaternion();this.bone.getWorldPosition(t),this.bone.getWorldQuaternion(r);var n=e.allocTransform();e.setOriginFromThreeVector3(n,t),e.setBasisFromThreeQuaternion(n,r);var i=e.multiplyTransforms(n,this.boneOffsetForm);return e.freeTransform(n),e.freeThreeQuaternion(r),e.freeThreeVector3(t),i},getWorldTransformForBone:function(){var e=this.helper,t=e.allocTransform();this.body.getMotionState().getWorldTransform(t);var r=e.multiplyTransforms(t,this.boneOffsetFormInverse);return e.freeTransform(t),r},setTransformFromBone:function(){var e=this.helper,t=this.getBoneTransform();this.body.setCenterOfMassTransform(t),this.body.getMotionState().setWorldTransform(t),e.freeTransform(t)},setPositionFromBone:function(){var e=this.helper,t=this.getBoneTransform(),r=e.allocTransform();this.body.getMotionState().getWorldTransform(r),e.copyOrigin(r,t),this.body.setCenterOfMassTransform(r),this.body.getMotionState().setWorldTransform(r),e.freeTransform(r),e.freeTransform(t)},updateBoneRotation:function(){this.bone.updateMatrixWorld(!0);var e=this.helper,t=this.getWorldTransformForBone(),r=e.getBasis(t),n=e.allocThreeQuaternion(),i=e.allocThreeQuaternion(),o=e.allocThreeQuaternion();n.set(r.x(),r.y(),r.z(),r.w()),i.setFromRotationMatrix(this.bone.matrixWorld),i.conjugate(),i.multiply(n),o.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(i.multiply(o)),e.freeThreeQuaternion(n),e.freeThreeQuaternion(i),e.freeThreeQuaternion(o),e.freeQuaternion(r),e.freeTransform(t)},updateBonePosition:function(){var e=this.helper,t=this.getWorldTransformForBone(),r=e.allocThreeVector3(),n=e.getOrigin(t);r.set(n.x(),n.y(),n.z());var i=this.bone.worldToLocal(r);this.bone.position.add(i),e.freeThreeVector3(r),e.freeTransform(t)}},Ib.Constraint=function(e,t,r,n,i,o){this.mesh=e,this.world=t,this.bodyA=r,this.bodyB=n,this.params=i,this.helper=o,this.constraint=null,this.init()},Ib.Constraint.prototype={constructor:Ib.Constraint,init:function(){var e=this.helper,t=this.params,r=this.bodyA,n=this.bodyB,i=e.allocTransform();e.setIdentity(i),e.setOriginFromArray3(i,t.position),e.setBasisFromArray3(i,t.rotation);var o=e.allocTransform(),s=e.allocTransform();r.body.getMotionState().getWorldTransform(o),n.body.getMotionState().getWorldTransform(s);var a=e.inverseTransform(o),l=e.inverseTransform(s),c=e.multiplyTransforms(a,i),u=e.multiplyTransforms(l,i),h=new Ammo.btGeneric6DofSpringConstraint(r.body,n.body,c,u,!0),d=e.allocVector3(),p=e.allocVector3(),f=e.allocVector3(),m=e.allocVector3();d.setValue(t.translationLimitation1[0],t.translationLimitation1[1],t.translationLimitation1[2]),p.setValue(t.translationLimitation2[0],t.translationLimitation2[1],t.translationLimitation2[2]),f.setValue(t.rotationLimitation1[0],t.rotationLimitation1[1],t.rotationLimitation1[2]),m.setValue(t.rotationLimitation2[0],t.rotationLimitation2[1],t.rotationLimitation2[2]),h.setLinearLowerLimit(d),h.setLinearUpperLimit(p),h.setAngularLowerLimit(f),h.setAngularUpperLimit(m);for(var v=0;v<3;v++)0!==t.springPosition[v]&&(h.enableSpring(v,!0),h.setStiffness(v,t.springPosition[v]));for(v=0;v<3;v++)0!==t.springRotation[v]&&(h.enableSpring(v+3,!0),h.setStiffness(v+3,t.springRotation[v]));if(void 0!==h.setParam)for(v=0;v<6;v++)h.setParam(2,.475,v);this.world.addConstraint(h,!0),this.constraint=h,e.freeTransform(i),e.freeTransform(o),e.freeTransform(s),e.freeTransform(a),e.freeTransform(l),e.freeTransform(c),e.freeTransform(u),e.freeVector3(d),e.freeVector3(p),e.freeVector3(f),e.freeVector3(m)}};var Rb=function(e){if(void 0===e.physics||void 0===e.geometry.rigidBodies)throw"MMDPhysicsHelper requires physics in mesh and rigidBodies in mesh.geometry.";oy.call(this),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new xb({color:new ay(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new xb({color:new ay(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new xb({color:new ay(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init(),this.update()};function Fb(e,t,r,n){qb.call(this,e,t,r,n)}function kb(e,t,r){qb.call(this,e,t,r)}function Ub(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function Bb(e,t,r,n){Ub.call(this,e,t,r,n)}function jb(e,t,r,n){qb.call(this,e,t,r,n)}function zb(e,t,r,n){qb.call(this,e,t,r,n)}function Vb(e,t,r,n){qb.call(this,e,t,r,n)}function Gb(e,t,r,n){Ub.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Hb(e,t,r,n){Ub.call(this,e,t,r,n)}function Wb(e,t,r,n){Ub.call(this,e,t,r,n)}Rb.prototype=Object.create(oy.prototype),Rb.prototype.constructor=Rb,Rb.prototype._init=function(){var e=this.root.geometry.rigidBodies;function t(e){switch(e.shapeType){case 0:return new Oy(e.width,16,8);case 1:return new Db(2*e.width,2*e.height,2*e.depth,8,8,8);case 2:return new function(e,t,r,n){var i=new Lb(e,e,t,r,n,!0),o=new Mb(new Oy(e,r,n,0,2*Math.PI,0,Math.PI/2)),s=new Mb(new Oy(e,r,n,0,2*Math.PI,Math.PI/2,Math.PI/2));return o.position.set(0,t/2,0),s.position.set(0,-t/2,0),o.updateMatrix(),s.updateMatrix(),i.merge(o.geometry,o.matrix),i.merge(s.geometry,s.matrix),i}(e.width,e.height,16,8);default:return null}}for(var r=0,n=e.length;r<n;r++){var i=e[r];this.add(new Mb(t(i),this.materials[i.type]))}},Rb.prototype.update=function(){var e=(h=this.root).geometry.rigidBodies,t=h.physics.bodies,r=(new Qg).getInverse(h.matrixWorld),n=new Kg,i=new $g,o=new $g;function s(e){return n.set(e.x(),e.y(),e.z()),n.applyMatrix4(r),n}function a(e){return i.set(e.x(),e.y(),e.z(),e.w()),o.setFromRotationMatrix(r),o.multiply(i),o}for(var l=0,c=e.length;l<c;l++){var u=t[l].body,h=this.children[l],d=u.getCenterOfMassTransform();h.position.copy(s(d.getOrigin())),h.quaternion.copy(a(d.getRotation()))}},Fb.prototype=Object.assign(Object.create(qb.prototype),{constructor:Fb,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ob,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),kb.prototype=Object.assign(Object.create(qb.prototype),{constructor:kb,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ob,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(Ub.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var o;r:{n:if(!(e<n)){for(var s=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===s)break;if(i=n,e<(n=t[++r]))break t}o=t.length;break r}if(e>=i)break e;var a=t[1];e<a&&(r=2,i=a);for(s=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===s)break;if(n=i,e>=(i=t[--r-1]))break t}o=r,r=0}for(;r<o;){var l=r+o>>>1;e<t[l]?o=l:r=l+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,o=0;o!==n;++o)t[o]=r[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ub.prototype,{beforeStart_:Ub.prototype.copySampleValue_,afterEnd_:Ub.prototype.copySampleValue_}),Bb.prototype=Object.assign(Object.create(Ub.prototype),{constructor:Bb,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=(r-t)/(n-t),c=a+s;a!==c;a+=4)$g.slerpFlat(i,0,o,a-s,o,a,l);return i}}),jb.prototype=Object.assign(Object.create(qb.prototype),{constructor:jb,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Bb(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),zb.prototype=Object.assign(Object.create(qb.prototype),{constructor:zb,ValueTypeName:"color"}),Vb.prototype=Object.assign(Object.create(qb.prototype),{constructor:Vb,ValueTypeName:"vector"}),Gb.prototype=Object.assign(Object.create(Ub.prototype),{constructor:Gb,DefaultSettings_:{endingStart:sb,endingEnd:sb},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,o=e+1,s=n[i],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:i=e,s=2*t-r;break;case 2402:s=t+n[i=n.length-2]-n[i+1];break;default:i=e,s=r}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=e,a=2*r-t;break;case 2402:o=1,a=r+n[1]-n[0];break;default:o=e-1,a=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-t)/(n-t),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==s;++b)i[b]=v*o[c+b]+g*o[l+b]+y*o[a+b]+x*o[u+b];return i}}),Hb.prototype=Object.assign(Object.create(Ub.prototype),{constructor:Hb,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(r-t)/(n-t),u=1-c,h=0;h!==s;++h)i[h]=o[l+h]*u+o[a+h]*c;return i}}),Wb.prototype=Object.assign(Object.create(Ub.prototype),{constructor:Wb,interpolate_:function(e){return this.copySampleValue_(e-1)}});var Xb={arraySlice:function(e,t,r){return Xb.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),o=0,s=0;s!==n;++o)for(var a=r[o]*t,l=0;l!==t;++l)i[s++]=e[a+l];return i},flattenJSON:function(e,t,r,n){for(var i=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[i++];if(void 0!==o){var s=o[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[n])&&(t.push(o.time),r.push.apply(r,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[n])&&(t.push(o.time),s.toArray(r,r.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(s=o[n])&&(t.push(o.time),r.push(s)),o=e[i++]}while(void 0!==o)}}};function qb(e,t,r,n){if(void 0===e)throw new Error("KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Xb.convertArray(t,this.TimeBufferType),this.values=Xb.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function Yb(e,t,r,n){qb.call(this,e,t,r,n)}function Jb(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=Zg.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}Object.assign(qb,{parse:function(e){if(void 0===e.type)throw new Error("KeyframeTrack: track type undefined, can not parse");var t=qb._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var r=[],n=[];Xb.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:Xb.convertArray(e.times,Array),values:Xb.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Yb;case"vector":case"vector2":case"vector3":case"vector4":return Vb;case"color":return zb;case"quaternion":return jb;case"bool":case"boolean":return kb;case"string":return Fb}throw new Error("KeyframeTrack: Unsupported typeName: "+e)}}),Object.assign(qb.prototype,{constructor:qb,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Wb(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Hb(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Gb(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case ob:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)this.createInterpolant=t;else{var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("KeyframeTrack:",r)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ob;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<e;)++i;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var s=this.getValueSize();this.times=Xb.arraySlice(r,i,o),this.values=Xb.arraySlice(this.values,i*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,s=0;s!==i;s++){var a=r[s];if("number"==typeof a&&isNaN(a)){console.error("KeyframeTrack: Time is not a valid number.",this,s,a),e=!1;break}if(null!==o&&o>a){console.error("KeyframeTrack: Out of order keys.",this,s,a,o),e=!1;break}o=a}if(void 0!==n&&Xb.isTypedArray(n)){s=0;for(var l=n.length;s!==l;++s){var c=n[s];if(isNaN(c)){console.error("KeyframeTrack: Value is not a valid number.",this,s,c),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=e.length-1,s=1;s<o;++s){var a=!1,l=e[s];if(l!==e[s+1]&&(1!==s||l!==l[0]))if(n)a=!0;else for(var c=s*r,u=c-r,h=c+r,d=0;d!==r;++d){var p=t[c+d];if(p!==t[u+d]||p!==t[h+d]){a=!0;break}}if(a){if(s!==i){e[i]=e[s];var f=s*r,m=i*r;for(d=0;d!==r;++d)t[m+d]=t[f+d]}++i}}if(o>0){e[i]=e[o];for(f=o*r,m=i*r,d=0;d!==r;++d)t[m+d]=t[f+d];++i}return i!==e.length&&(this.times=Xb.arraySlice(e,0,i),this.values=Xb.arraySlice(t,0,i*r)),this}}),Yb.prototype=Object.assign(Object.create(qb.prototype),{constructor:Yb,ValueTypeName:"number"}),Object.assign(Jb,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,o=r.length;i!==o;++i)t.push(qb.parse(r[i]).scale(n));return new Jb(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t},i=0,o=r.length;i!==o;++i)t.push(qb.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,o=[],s=0;s<i;s++){var a=[],l=[];a.push((s+i-1)%i,s,(s+1)%i),l.push(0,1,0);var c=Xb.getKeyframeOrder(a);a=Xb.sortedArray(a,1,c),l=Xb.sortedArray(l,1,c),n||0!==a[0]||(a.push(i),l.push(l[0])),o.push(new Yb(".morphTargetInfluences["+t[s].name+"]",a,l).scale(1/r))}return new Jb(e,-1,o)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var a=e[o],l=a.name.match(i);if(l&&l.length>1){var c=n[h=l[1]];c||(n[h]=c=[]),c.push(a)}}var u=[];for(var h in n)u.push(Jb.CreateFromMorphTargetSequence(h,n[h],t,r));return u},parseAnimation:function(e,t){if(!e)return console.error("AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var o=[],s=[];Xb.flattenJSON(r,o,s,n),0!==o.length&&i.push(new e(t,o,s))}},n=[],i=e.name||"default",o=e.length||-1,s=e.fps||30,a=e.hierarchy||[],l=0;l<a.length;l++){var c=a[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var v=c[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new Yb(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(s||1)}else{var g=".bones["+t[l].name+"]";r(Vb,g+".position",c,"pos",n),r(jb,g+".quaternion",c,"rot",n),r(Vb,g+".scale",c,"scl",n)}}return 0===n.length?null:new Jb(i,o,n)}}),Object.assign(Jb.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}this.duration=e},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}});var Zb=function(){};Zb.CreateRotationAnimation=function(e,t){return new Jb(null,e,[new Yb(".rotation["+(t=t||"x")+"]",[0,e],[0,360])])},Zb.CreateScaleAxisAnimation=function(e,t){return new Jb(null,e,[new Yb(".scale["+(t=t||"x")+"]",[0,e],[0,1])])},Zb.CreateShakeAnimation=function(e,t){for(var r=[],n=[],i=new Kg,o=0;o<10*e;o++)r.push(o/10),i.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(t).toArray(n,n.length);return new Jb(null,e,[new Vb(".position",r,n)])},Zb.CreatePulsationAnimation=function(e,t){for(var r=[],n=[],i=new Kg,o=0;o<10*e;o++){r.push(o/10);var s=Math.random()*t;i.set(s,s,s).toArray(n,n.length)}return new Jb(null,e,[new Vb(".scale",r,n)])},Zb.CreateVisibilityAnimation=function(e){return new Jb(null,e,[new kb(".visible",[0,e/2,e],[!0,!1,!0])])},Zb.CreateMaterialColorAnimation=function(e,t){for(var r=[],n=[],i=e/t.length,o=0;o<=t.length;o++)r.push(o*i),n.push(t[o%t.length]);return new Jb(null,e,[new zb(".material[0].color",r,n)])};function Qb(){oy.call(this),this.type="Camera",this.matrixWorldInverse=new Qg,this.projectionMatrix=new Qg}function Kb(e,t,r,n){Qb.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function $b(e){yb.call(this),this.type="MeshDepthMaterial",this.depthPacking=mb,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function ew(){oy.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function tw(e,t,r,n,i,o){Qb.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}Qb.prototype=Object.assign(Object.create(oy.prototype),{constructor:Qb,isCamera:!0,copy:function(e,t){return oy.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new $g;return function(t){return void 0===t&&(console.warn("Camera: .getWorldDirection() target is now required"),t=new Kg),this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){oy.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Kb.prototype=Object.assign(Object.create(Qb.prototype),{constructor:Kb,isPerspectiveCamera:!0,copy:function(e,t){return Qb.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Zg.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Zg.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Zg.RAD2DEG*Math.atan(Math.tan(.5*Zg.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Zg.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,a=o.fullHeight;i+=o.offsetX*n/s,t-=o.offsetY*r/a,n*=o.width/s,r*=o.height/a}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far)},toJSON:function(e){var t=oy.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),$b.prototype=Object.create(yb.prototype),$b.prototype.constructor=$b,$b.prototype.isMeshDepthMaterial=!0,$b.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},ew.prototype=Object.assign(Object.create(oy.prototype),{constructor:ew,copy:function(e,t){return oy.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=oy.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),tw.prototype=Object.assign(Object.create(Qb.prototype),{constructor:tw,isOrthographicCamera:!0,copy:function(e,t){return Qb.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,o=r+e,s=n+t,a=n-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=u*(this.view.offsetX/l))+u*(this.view.width/l),a=(s-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far)},toJSON:function(e){var t=oy.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}});var rw=0;function nw(e,t,r,n,i,o,s,a,l,c){Object.defineProperty(this,"id",{value:rw++}),this.uuid=Zg.generateUUID(),this.name="",this.image=void 0!==e?e:nw.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:nw.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:Ax,this.wrapT=void 0!==n?n:Ax,this.magFilter=void 0!==i?i:Dx,this.minFilter=void 0!==o?o:Lx,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:Hx,this.type=void 0!==a?a:Ix,this.offset=new hy(0,0),this.repeat=new hy(1,1),this.center=new hy(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ny,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:ub,this.version=0,this.onUpdate=null}function iw(e,t,r){this.width=e,this.height=t,this.scissor=new fy(0,0,e,t),this.scissorTest=!1,this.viewport=new fy(0,0,e,t),void 0===(r=r||{}).minFilter&&(r.minFilter=Dx),this.texture=new nw(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}nw.DEFAULT_IMAGE=void 0,nw.DEFAULT_MAPPING=gx,nw.prototype=Object.assign(Object.create(ey.prototype),{constructor:nw,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=Zg.generateUUID()),t||void 0!==e.images[n.uuid]||(e.images[n.uuid]={uuid:n.uuid,url:function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height;var r=t.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(n)}),r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===gx){if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Mx:e.x=e.x-Math.floor(e.x);break;case Ax:e.x=e.x<0?0:1;break;case Ex:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Mx:e.y=e.y-Math.floor(e.y);break;case Ax:e.y=e.y<0?0:1;break;case Ex:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(nw.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),iw.prototype=Object.assign(Object.create(ey.prototype),{constructor:iw,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ow={merge:function(e){for(var t={},r=0;r<e.length;r++){var n=this.clone(e[r]);for(var i in n)t[i]=n[i]}return t},clone:function(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}};function sw(e){yb.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("ShaderMaterial: attributes should now be defined in BufferGeometry instead."),this.setValues(e))}function aw(e,t,r,n){py.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new lw(e,t,r,n)),this.mergeVertices()}function lw(e,t,r,n){Cy.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,o,s=(e=e||1)/2,a=(t=t||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=e/l,p=t/c,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-a;for(i=0;i<u;i++){var x=i*d-s;m.push(x,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/c)}}for(o=0;o<c;o++)for(i=0;i<l;i++){var b=i+u*o,w=i+u*(o+1),_=i+1+u*(o+1),S=i+1+u*o;f.push(b,w,S),f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new Sy(m,3)),this.addAttribute("normal",new Sy(v,3)),this.addAttribute("uv",new Sy(g,2))}sw.prototype=Object.create(yb.prototype),sw.prototype.constructor=sw,sw.prototype.isShaderMaterial=!0,sw.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ow.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},sw.prototype.toJSON=function(e){var t=yb.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},aw.prototype=Object.create(py.prototype),aw.prototype.constructor=aw,lw.prototype=Object.create(Cy.prototype),lw.prototype.constructor=lw;var cw={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","float viewZ = getViewZ( getDepth( vUv ) );","float factor = ( focus + viewZ );","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},uw=function(e,t,r,n){Kb.call(this,e,t,r,n),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4},this.material_depth=new $b,this.setLens(),this.initPostProcessing()};uw.prototype=Object.create(Kb.prototype),uw.prototype.constructor=uw,uw.prototype.setLens=function(e,t,r,n){void 0===e&&(e=35),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e),void 0===r&&(r=8),void 0===n&&(n=.019),this.fNumber=r,this.coc=n,this.aperture=e/this.fNumber,this.hyperFocal=e*e/(this.aperture*this.coc)},uw.prototype.linearize=function(e){var t=this.far,r=this.near;return-t*r/(e*(t-r)-t)},uw.prototype.smoothstep=function(e,t,r){var n=this.saturate((r-e)/(t-e));return n*n*(3-2*n)},uw.prototype.saturate=function(e){return Math.max(0,Math.min(1,e))},uw.prototype.focusAt=function(e){void 0===e&&(e=20);var t=this.getFocalLength();this.focus=e,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-t)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-t)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance},uw.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new ew,this.postprocessing.camera=new tw(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera);var e={minFilter:Dx,magFilter:Dx,format:Gx};this.postprocessing.rtTextureDepth=new iw(window.innerWidth,window.innerHeight,e),this.postprocessing.rtTextureColor=new iw(window.innerWidth,window.innerHeight,e);var t=cw;this.postprocessing.bokeh_uniforms=ow.clone(t.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new sw({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples}}),this.postprocessing.quad=new Mb(new lw(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)}},uw.prototype.renderCinematic=function(e,t){this.postprocessing.enabled&&(t.clear(),e.overrideMaterial=null,t.render(e,camera,this.postprocessing.rtTextureColor,!0),e.overrideMaterial=this.material_depth,t.render(e,camera,this.postprocessing.rtTextureDepth,!0),t.render(this.postprocessing.scene,this.postprocessing.camera))};var hw={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function dw(e,t,r){var n=this,i=!1,o=0,s=0,a=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){s++,!1===i&&void 0!==n.onStart&&n.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,s),o===s&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this}}var pw=new dw,fw={};function mw(e){this.manager=void 0!==e?e:pw}function vw(e){bb.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function gw(e){yb.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Kg,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function yw(e){yb.call(this),this.type="MeshLambertMaterial",this.color=new ay(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ay(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function xw(e){yb.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new hy(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function bw(e){yb.call(this),this.type="MeshPhongMaterial",this.color=new ay(16777215),this.specular=new ay(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ay(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new hy(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ww(e){yb.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ay(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ay(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new hy(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function _w(e){ww.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Sw(e){bw.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Tw(e){yb.call(this),this.type="PointsMaterial",this.color=new ay(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function Mw(e){sw.call(this,e),this.type="RawShaderMaterial"}function Aw(e){yb.call(this),this.type="ShadowMaterial",this.color=new ay(0),this.transparent=!0,this.setValues(e)}function Ew(e){yb.call(this),this.type="SpriteMaterial",this.color=new ay(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Cw(e){this.manager=void 0!==e?e:pw,this.textures={}}function Pw(e){this.manager=void 0!==e?e:pw}function Ow(e){this.manager=void 0!==e?e:pw}function Dw(){}Object.assign(mw.prototype,{load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=hw.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;if(void 0===fw[e]){var s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var a=s[1],l=!!s[2],c=s[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:a}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,a);break;case"json":u=JSON.parse(c);break;default:u=c}window.setTimeout(function(){t&&t(u),i.manager.itemEnd(e)},0)}catch(t){window.setTimeout(function(){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)},0)}}else{fw[e]=[],fw[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;hw.add(e,r);var n=fw[e];if(delete fw[e],200===this.status){for(var o=0,s=n.length;o<s;o++){(a=n[o]).onLoad&&a.onLoad(r)}i.manager.itemEnd(e)}else if(0===this.status){console.warn("FileLoader: HTTP Status 0 received.");for(o=0,s=n.length;o<s;o++){(a=n[o]).onLoad&&a.onLoad(r)}i.manager.itemEnd(e)}else{for(o=0,s=n.length;o<s;o++){var a;(a=n[o]).onError&&a.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)}},!1),m.addEventListener("progress",function(t){for(var r=fw[e],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=fw[e];delete fw[e];for(var n=0,o=r.length;n<o;n++){var s=r[n];s.onError&&s.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}fw[e].push({onLoad:t,onProgress:r,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),vw.prototype=Object.create(bb.prototype),vw.prototype.constructor=vw,vw.prototype.isLineDashedMaterial=!0,vw.prototype.copy=function(e){return bb.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this},gw.prototype=Object.create(yb.prototype),gw.prototype.constructor=gw,gw.prototype.isMeshDistanceMaterial=!0,gw.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},yw.prototype=Object.create(yb.prototype),yw.prototype.constructor=yw,yw.prototype.isMeshLambertMaterial=!0,yw.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},xw.prototype=Object.create(yb.prototype),xw.prototype.constructor=xw,xw.prototype.isMeshNormalMaterial=!0,xw.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},bw.prototype=Object.create(yb.prototype),bw.prototype.constructor=bw,bw.prototype.isMeshPhongMaterial=!0,bw.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ww.prototype=Object.create(yb.prototype),ww.prototype.constructor=ww,ww.prototype.isMeshStandardMaterial=!0,ww.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},_w.prototype=Object.create(ww.prototype),_w.prototype.constructor=_w,_w.prototype.isMeshPhysicalMaterial=!0,_w.prototype.copy=function(e){return ww.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Sw.prototype=Object.create(bw.prototype),Sw.prototype.constructor=Sw,Sw.prototype.isMeshToonMaterial=!0,Sw.prototype.copy=function(e){return bw.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Tw.prototype=Object.create(yb.prototype),Tw.prototype.constructor=Tw,Tw.prototype.isPointsMaterial=!0,Tw.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},Mw.prototype=Object.create(sw.prototype),Mw.prototype.constructor=Mw,Mw.prototype.isRawShaderMaterial=!0,Aw.prototype=Object.create(yb.prototype),Aw.prototype.constructor=Aw,Aw.prototype.isShadowMaterial=!0,Aw.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.color.copy(e.color),this},Ew.prototype=Object.create(yb.prototype),Ew.prototype.constructor=Ew,Ew.prototype.isSpriteMaterial=!0,Ew.prototype.copy=function(e){return yb.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},Object.assign(Cw.prototype,{load:function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setTextures:function(e){this.textures=e},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("MaterialLoader: Undefined texture",e),t[e]}var n=new{LineBasicMaterial:bb,LineDashedMaterial:vw,MeshBasicMaterial:xb,MeshDepthMaterial:$b,MeshDistanceMaterial:gw,MeshLambertMaterial:yw,MeshNormalMaterial:xw,MeshPhongMaterial:bw,MeshPhysicalMaterial:_w,MeshStandardMaterial:ww,MeshToonMaterial:Sw,PointsMaterial:Tw,RawShaderMaterial:Mw,ShaderMaterial:sw,ShadowMaterial:Aw,SpriteMaterial:Ew}[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearCoat&&(n.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(n.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(n.uniforms=e.uniforms),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalScale){var i=e.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new hy).fromArray(i)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),n}}),Object.assign(Pw.prototype,{crossOrigin:"Anonymous",load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=hw.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",function(){hw.add(e,this),t&&t(this),i.manager.itemEnd(e)},!1),s.addEventListener("error",function(t){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)},!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Ow.prototype,{crossOrigin:"Anonymous",load:function(e,t,r,n){var i=new nw,o=new Pw(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(r){i.image=r;var n=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?Gx:Hx,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Dw.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r],o=t[r+1];if(i.test(e))return o}return null}},Object.assign(Dw.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:function(){var e={NoBlending:zy,NormalBlending:Vy,AdditiveBlending:Gy,SubtractiveBlending:Hy,MultiplyBlending:Wy,CustomBlending:Xy},t=new ay,r=new Ow,n=new Cw;return function(i,o,s){var a={};function l(e,t,n,i,l){var c,u=o+e,h=Dw.Handlers.get(u);null!==h?c=h.load(u):(r.setCrossOrigin(s),c=r.load(u)),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=Mx),1!==t[1]&&(c.wrapT=Mx)),void 0!==n&&c.offset.fromArray(n),void 0!==i&&("repeat"===i[0]&&(c.wrapS=Mx),"mirror"===i[0]&&(c.wrapS=Ex),"repeat"===i[1]&&(c.wrapT=Mx),"mirror"===i[1]&&(c.wrapT=Ex)),void 0!==l&&(c.anisotropy=l);var d=Zg.generateUUID();return a[d]=c,d}var c={uuid:Zg.generateUUID(),type:"MeshLambertMaterial"};for(var u in i){var h=i[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(h).getHex();break;case"colorSpecular":c.specular=t.fromArray(h).getHex();break;case"colorEmissive":c.emissive=t.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(h,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(h,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(h,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(h,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(h,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(h,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(h,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(h,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(h,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(h,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=Fy;break;case"doubleSided":c.side=ky;break;case"transparency":console.warn("Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=jy),"face"===h&&(c.vertexColors=By);break;default:console.error("Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(a),n.parse(c)}}()});var Nw={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")}};function Lw(e){"boolean"==typeof e&&(console.warn("JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:pw,this.withCredentials=!1}Object.assign(Lw.prototype,{load:function(e,t,r,n){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Nw.extractUrlBase(e),s=new mw(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,function(r){var n=JSON.parse(r),s=n.metadata;if(void 0!==s){var a=s.type;if(void 0!==a&&"object"===a.toLowerCase())return void console.error("JSONLoader: "+e+" should be loaded with ObjectLoader instead.")}var l=i.parse(n,o);t(l.geometry,l.materials)},r,n)},setTexturePath:function(e){this.texturePath=e},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new py;return function(e,t){function r(e,t){return e&1<<t}var n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C=e.faces,P=e.vertices,O=e.normals,D=e.colors,N=e.scale,L=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&L++;for(n=0;n<L;n++)t.faceVertexUvs[n]=[]}for(s=0,a=P.length;s<a;)(b=new Kg).x=P[s++]*N,b.y=P[s++]*N,b.z=P[s++]*N,t.vertices.push(b);for(s=0,a=C.length;s<a;)if(p=r(d=C[s++],0),f=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),x=r(d,7),p){if((_=new ly).a=C[s],_.b=C[s+1],_.c=C[s+3],(S=new ly).a=C[s+1],S.b=C[s+2],S.c=C[s+3],s+=4,f&&(h=C[s++],_.materialIndex=h,S.materialIndex=h),o=t.faces.length,m)for(n=0;n<L;n++)for(A=e.uvs[n],t.faceVertexUvs[n][o]=[],t.faceVertexUvs[n][o+1]=[],i=0;i<4;i++)E=new hy(A[2*(u=C[s++])],A[2*u+1]),2!==i&&t.faceVertexUvs[n][o].push(E),0!==i&&t.faceVertexUvs[n][o+1].push(E);if(v&&(c=3*C[s++],_.normal.set(O[c++],O[c++],O[c]),S.normal.copy(_.normal)),g)for(n=0;n<4;n++)c=3*C[s++],M=new Kg(O[c++],O[c++],O[c]),2!==n&&_.vertexNormals.push(M),0!==n&&S.vertexNormals.push(M);if(y&&(T=D[l=C[s++]],_.color.setHex(T),S.color.setHex(T)),x)for(n=0;n<4;n++)T=D[l=C[s++]],2!==n&&_.vertexColors.push(new ay(T)),0!==n&&S.vertexColors.push(new ay(T));t.faces.push(_),t.faces.push(S)}else{if((w=new ly).a=C[s++],w.b=C[s++],w.c=C[s++],f&&(h=C[s++],w.materialIndex=h),o=t.faces.length,m)for(n=0;n<L;n++)for(A=e.uvs[n],t.faceVertexUvs[n][o]=[],i=0;i<3;i++)E=new hy(A[2*(u=C[s++])],A[2*u+1]),t.faceVertexUvs[n][o].push(E);if(v&&(c=3*C[s++],w.normal.set(O[c++],O[c++],O[c])),g)for(n=0;n<3;n++)c=3*C[s++],M=new Kg(O[c++],O[c++],O[c]),w.vertexNormals.push(M);if(y&&(l=C[s++],w.color.setHex(D[l])),x)for(n=0;n<3;n++)l=C[s++],w.vertexColors.push(new ay(D[l]));t.faces.push(w)}}(e,r),function(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=r){var o=e.skinWeights[n],s=r>1?e.skinWeights[n+1]:0,a=r>2?e.skinWeights[n+2]:0,l=r>3?e.skinWeights[n+3]:0;t.skinWeights.push(new fy(o,s,a,l))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=r){var c=e.skinIndices[n],u=r>1?e.skinIndices[n+1]:0,h=r>2?e.skinIndices[n+2]:0,d=r>3?e.skinIndices[n+3]:0;t.skinIndices.push(new fy(c,u,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;n<i;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var o=t.morphTargets[n].vertices,s=e.morphTargets[n].vertices,a=0,l=s.length;a<l;a+=3){var c=new Kg;c.x=s[a]*r,c.y=s[a+1]*r,c.z=s[a+2]*r,o.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=t.faces,h=e.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(e,r),function(e,t){var r=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var o=Jb.parseAnimation(n[i],t.bones);o&&r.push(o)}if(t.morphTargets){var s=Jb.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(s)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:Dw.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}()});var Iw=function(e){"boolean"==typeof e&&(console.warn("BinaryLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:pw};Iw.prototype={constructor:Iw,crossOrigin:"Anonymous",load:function(e,t,r,n){var i=this.texturePath||Nw.extractUrlBase(e),o=this.binaryPath||Nw.extractUrlBase(e),s=this;new mw(this.manager).load(e,function(e){var a=JSON.parse(e),l=o+a.buffers,c=new mw(s.manager);c.setResponseType("arraybuffer"),c.load(l,function(e){s.parse(e,t,i,a.materials)},r,n)},r,n)},setBinaryPath:function(e){this.binaryPath=e},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t,r,n){var i=function(){var t,r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x=this,b=0,w=[],_=[];function S(e){return e%4?4-e%4:0}function T(e,t){return new Uint8Array(e,t,1)[0]}function M(e,t){return new Uint32Array(e,t,1)[0]}function A(t,r){var n,i,o,s,a,l,c,u,h,d,p=new Uint32Array(e,r,3*t);for(n=0;n<t;n++)i=p[3*n],o=p[3*n+1],s=p[3*n+2],a=_[2*i],u=_[2*i+1],l=_[2*o],h=_[2*o+1],c=_[2*s],d=_[2*s+1],x.faceVertexUvs[0].push([new hy(a,u),new hy(l,h),new hy(c,d)])}function E(t,r){var n,i,o,s,a,l,c,u,h,d,p,f,m,v=new Uint32Array(e,r,4*t);for(n=0;n<t;n++)i=v[4*n],o=v[4*n+1],s=v[4*n+2],a=v[4*n+3],l=_[2*i],d=_[2*i+1],c=_[2*o],p=_[2*o+1],u=_[2*s],f=_[2*s+1],h=_[2*a],m=_[2*a+1],x.faceVertexUvs[0].push([new hy(l,d),new hy(c,p),new hy(h,m)]),x.faceVertexUvs[0].push([new hy(c,p),new hy(u,f),new hy(h,m)])}function C(t,r,n){var i,o,s,a,l,c=new Uint32Array(e,r,3*t),u=new Uint16Array(e,n,t);for(i=0;i<t;i++)o=c[3*i],s=c[3*i+1],a=c[3*i+2],l=u[i],x.faces.push(new ly(o,s,a,null,null,l))}function P(t,r,n){var i,o,s,a,l,c,u=new Uint32Array(e,r,4*t),h=new Uint16Array(e,n,t);for(i=0;i<t;i++)o=u[4*i],s=u[4*i+1],a=u[4*i+2],l=u[4*i+3],c=h[i],x.faces.push(new ly(o,s,l,null,null,c)),x.faces.push(new ly(s,a,l,null,null,c))}function O(t,r,n,i){var o,s,a,l,c,u,h,d,p=new Uint32Array(e,r,3*t),f=new Uint32Array(e,n,3*t),m=new Uint16Array(e,i,t);for(o=0;o<t;o++){s=p[3*o],a=p[3*o+1],l=p[3*o+2],u=f[3*o],h=f[3*o+1],d=f[3*o+2],c=m[o];var v=w[3*u],g=w[3*u+1],y=w[3*u+2],b=w[3*h],_=w[3*h+1],S=w[3*h+2],T=w[3*d],M=w[3*d+1],A=w[3*d+2];x.faces.push(new ly(s,a,l,[new Kg(v,g,y),new Kg(b,_,S),new Kg(T,M,A)],null,c))}}function D(t,r,n,i){var o,s,a,l,c,u,h,d,p,f,m=new Uint32Array(e,r,4*t),v=new Uint32Array(e,n,4*t),g=new Uint16Array(e,i,t);for(o=0;o<t;o++){s=m[4*o],a=m[4*o+1],l=m[4*o+2],c=m[4*o+3],h=v[4*o],d=v[4*o+1],p=v[4*o+2],f=v[4*o+3],u=g[o];var y=w[3*h],b=w[3*h+1],_=w[3*h+2],S=w[3*d],T=w[3*d+1],M=w[3*d+2],A=w[3*p],E=w[3*p+1],C=w[3*p+2],P=w[3*f],O=w[3*f+1],D=w[3*f+2];x.faces.push(new ly(s,a,c,[new Kg(y,b,_),new Kg(S,T,M),new Kg(P,O,D)],null,u)),x.faces.push(new ly(a,l,c,[new Kg(S,T,M),new Kg(A,E,C),new Kg(P,O,D)],null,u))}}py.call(this),b+=(t=function(e,t){return{signature:function(e,t,r){return Nw.decodeText(new Uint8Array(e,t,r))}(e,t,12),header_bytes:T(e,t+12),vertex_coordinate_bytes:T(e,t+13),normal_coordinate_bytes:T(e,t+14),uv_coordinate_bytes:T(e,t+15),vertex_index_bytes:T(e,t+16),normal_index_bytes:T(e,t+17),uv_index_bytes:T(e,t+18),material_index_bytes:T(e,t+19),nvertices:M(e,t+20),nnormals:M(e,t+20+4),nuvs:M(e,t+20+8),ntri_flat:M(e,t+20+12),ntri_smooth:M(e,t+20+16),ntri_flat_uv:M(e,t+20+20),ntri_smooth_uv:M(e,t+20+24),nquad_flat:M(e,t+20+28),nquad_smooth:M(e,t+20+32),nquad_flat_uv:M(e,t+20+36),nquad_smooth_uv:M(e,t+20+40)}}(e,b)).header_bytes,u=3*t.vertex_index_bytes+t.material_index_bytes,h=4*t.vertex_index_bytes+t.material_index_bytes,d=t.ntri_flat*u,p=t.ntri_smooth*(u+3*t.normal_index_bytes),f=t.ntri_flat_uv*(u+3*t.uv_index_bytes),m=t.ntri_smooth_uv*(u+3*t.normal_index_bytes+3*t.uv_index_bytes),v=t.nquad_flat*h,g=t.nquad_smooth*(h+4*t.normal_index_bytes),y=t.nquad_flat_uv*(h+4*t.uv_index_bytes),b+=function(r){var n,i,o,s,a=t.nvertices,l=new Float32Array(e,r,3*a);for(n=0;n<a;n++)i=l[3*n],o=l[3*n+1],s=l[3*n+2],x.vertices.push(new Kg(i,o,s));return 3*a*Float32Array.BYTES_PER_ELEMENT}(b),b+=function(r){var n=t.nnormals;if(n){var i,o,s,a,l=new Int8Array(e,r,3*n);for(i=0;i<n;i++)o=l[3*i],s=l[3*i+1],a=l[3*i+2],w.push(o/127,s/127,a/127)}return 3*n*Int8Array.BYTES_PER_ELEMENT}(b),b+=S(3*t.nnormals),c=(l=(a=(s=(o=(i=(n=(r=b+=function(r){var n=t.nuvs;if(n){var i,o,s,a=new Float32Array(e,r,2*n);for(i=0;i<n;i++)o=a[2*i],s=a[2*i+1],_.push(o,s)}return 2*n*Float32Array.BYTES_PER_ELEMENT}(b))+d+S(2*t.ntri_flat))+p+S(2*t.ntri_smooth))+f+S(2*t.ntri_flat_uv))+m+S(2*t.ntri_smooth_uv))+v+S(2*t.nquad_flat))+g+S(2*t.nquad_smooth))+y+S(2*t.nquad_flat_uv),function(e){var r=t.ntri_flat_uv;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*3,i=n+r*Uint32Array.BYTES_PER_ELEMENT*3;C(r,e,i),A(r,n)}}(i),function(e){var r=t.ntri_smooth_uv;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*3,i=n+r*Uint32Array.BYTES_PER_ELEMENT*3,o=i+r*Uint32Array.BYTES_PER_ELEMENT*3;O(r,e,n,o),A(r,i)}}(o),function(e){var r=t.nquad_flat_uv;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*4,i=n+r*Uint32Array.BYTES_PER_ELEMENT*4;P(r,e,i),E(r,n)}}(l),function(e){var r=t.nquad_smooth_uv;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*4,i=n+r*Uint32Array.BYTES_PER_ELEMENT*4,o=i+r*Uint32Array.BYTES_PER_ELEMENT*4;D(r,e,n,o),E(r,i)}}(c),function(e){var r=t.ntri_flat;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*3;C(r,e,n)}}(r),function(e){var r=t.ntri_smooth;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*3,i=n+r*Uint32Array.BYTES_PER_ELEMENT*3;O(r,e,n,i)}}(n),function(e){var r=t.nquad_flat;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*4;P(r,e,n)}}(s),function(e){var r=t.nquad_smooth;if(r){var n=e+r*Uint32Array.BYTES_PER_ELEMENT*4,i=n+r*Uint32Array.BYTES_PER_ELEMENT*4;D(r,e,n,i)}}(a),this.computeFaceNormals()};i.prototype=Object.create(py.prototype),i.prototype.constructor=i,t(new i,Dw.prototype.initMaterials(n,r,this.crossOrigin))}};function Rw(e,t,r,n){this.ray=new wb(e,t),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Fw(e,t){return e.distance-t.distance}function kw(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var i=e.children,o=0,s=i.length;o<s;o++)kw(i[o],t,r,!0)}Object.assign(Rw.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return kw(e,this,n,t),n.sort(Fw),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=e.length;i<o;i++)kw(e[i],this,n,t);return n.sort(Fw),n}});var Uw=function(e,t,r){if(e instanceof Qb){console.warn("DragControls: Constructor now expects ( objects, camera, domElement )");var n=e;e=t,t=n}var i=new Sb,o=new Rw,s=new hy,a=new Kg,l=new Kg,c=null,u=null,h=this;function d(){r.addEventListener("mousemove",f,!1),r.addEventListener("mousedown",m,!1),r.addEventListener("mouseup",v,!1),r.addEventListener("mouseleave",v,!1),r.addEventListener("touchmove",g,!1),r.addEventListener("touchstart",y,!1),r.addEventListener("touchend",x,!1)}function p(){r.removeEventListener("mousemove",f,!1),r.removeEventListener("mousedown",m,!1),r.removeEventListener("mouseup",v,!1),r.removeEventListener("mouseleave",v,!1),r.removeEventListener("touchmove",g,!1),r.removeEventListener("touchstart",y,!1),r.removeEventListener("touchend",x,!1)}function f(n){n.preventDefault();var d=r.getBoundingClientRect();if(s.x=(n.clientX-d.left)/d.width*2-1,s.y=-(n.clientY-d.top)/d.height*2+1,o.setFromCamera(s,t),c&&h.enabled)return o.ray.intersectPlane(i,l)&&c.position.copy(l.sub(a)),void h.dispatchEvent({type:"drag",object:c});o.setFromCamera(s,t);var p=o.intersectObjects(e);if(p.length>0){var f=p[0].object;i.setFromNormalAndCoplanarPoint(t.getWorldDirection(i.normal),f.position),u!==f&&(h.dispatchEvent({type:"hoveron",object:f}),r.style.cursor="pointer",u=f)}else null!==u&&(h.dispatchEvent({type:"hoveroff",object:u}),r.style.cursor="auto",u=null)}function m(n){n.preventDefault(),o.setFromCamera(s,t);var u=o.intersectObjects(e);u.length>0&&(c=u[0].object,o.ray.intersectPlane(i,l)&&a.copy(l).sub(c.position),r.style.cursor="move",h.dispatchEvent({type:"dragstart",object:c}))}function v(e){e.preventDefault(),c&&(h.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor="auto"}function g(e){e.preventDefault(),e=e.changedTouches[0];var n=r.getBoundingClientRect();if(s.x=(e.clientX-n.left)/n.width*2-1,s.y=-(e.clientY-n.top)/n.height*2+1,o.setFromCamera(s,t),c&&h.enabled)return o.ray.intersectPlane(i,l)&&c.position.copy(l.sub(a)),void h.dispatchEvent({type:"drag",object:c})}function y(n){n.preventDefault(),n=n.changedTouches[0];var u=r.getBoundingClientRect();s.x=(n.clientX-u.left)/u.width*2-1,s.y=-(n.clientY-u.top)/u.height*2+1,o.setFromCamera(s,t);var d=o.intersectObjects(e);d.length>0&&(c=d[0].object,i.setFromNormalAndCoplanarPoint(t.getWorldDirection(i.normal),c.position),o.ray.intersectPlane(i,l)&&a.copy(l).sub(c.position),r.style.cursor="move",h.dispatchEvent({type:"dragstart",object:c}))}function x(e){e.preventDefault(),c&&(h.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor="auto"}d(),this.enabled=!0,this.activate=d,this.deactivate=p,this.dispose=function(){p()},this.setObjects=function(){console.error("DragControls: setObjects() has been removed.")},this.on=function(e,t){console.warn("DragControls: on() has been deprecated. Use addEventListener() instead."),h.addEventListener(e,t)},this.off=function(e,t){console.warn("DragControls: off() has been deprecated. Use removeEventListener() instead."),h.removeEventListener(e,t)},this.notify=function(e){console.error("DragControls: notify() has been deprecated. Use dispatchEvent() instead."),h.dispatchEvent({type:e})}};function Bw(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}Uw.prototype=Object.create(ey.prototype),Uw.prototype.constructor=Uw,Object.assign(Bw.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Zg.clamp(e.y/this.radius,-1,1))),this}});var jw=function(e,t){t=void 0!==t?t:document,this.enabled=!0,this.center=new Kg,this.panSpeed=.001,this.zoomSpeed=.001,this.rotationSpeed=.005;var r=this,n=new Kg,i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},o=i.NONE,s=this.center,a=new ny,l=new hy,c=new hy,u=new Bw,h={type:"change"};function d(e){!1!==r.enabled&&(0===e.button?o=i.ROTATE:1===e.button?o=i.ZOOM:2===e.button&&(o=i.PAN),c.set(e.clientX,e.clientY),t.addEventListener("mousemove",p,!1),t.addEventListener("mouseup",f,!1),t.addEventListener("mouseout",f,!1),t.addEventListener("dblclick",f,!1))}function p(e){if(!1!==r.enabled){l.set(e.clientX,e.clientY);var t=l.x-c.x,n=l.y-c.y;o===i.ROTATE?r.rotate(new Kg(-t*r.rotationSpeed,-n*r.rotationSpeed,0)):o===i.ZOOM?r.zoom(new Kg(0,0,n)):o===i.PAN&&r.pan(new Kg(-t,n,0)),c.set(e.clientX,e.clientY)}}function f(e){t.removeEventListener("mousemove",p,!1),t.removeEventListener("mouseup",f,!1),t.removeEventListener("mouseout",f,!1),t.removeEventListener("dblclick",f,!1),o=i.NONE}function m(e){e.preventDefault(),r.zoom(new Kg(0,0,e.deltaY))}function v(e){e.preventDefault()}this.focus=function(t){var n,i=(new cy).setFromObject(t);!1===i.isEmpty()?(s.copy(i.getCenter()),n=i.getBoundingSphere().radius):(s.setFromMatrixPosition(t.matrixWorld),n=.1);var o=new Kg(0,0,1);o.applyQuaternion(e.quaternion),o.multiplyScalar(4*n),e.position.copy(s).add(o),r.dispatchEvent(h)},this.pan=function(t){var n=e.position.distanceTo(s);t.multiplyScalar(n*r.panSpeed),t.applyMatrix3(a.getNormalMatrix(e.matrix)),e.position.add(t),s.add(t),r.dispatchEvent(h)},this.zoom=function(t){var n=e.position.distanceTo(s);t.multiplyScalar(n*r.zoomSpeed),t.length()>n||(t.applyMatrix3(a.getNormalMatrix(e.matrix)),e.position.add(t),r.dispatchEvent(h))},this.rotate=function(t){n.copy(e.position).sub(s),u.setFromVector3(n),u.theta+=t.x,u.phi+=t.y,u.makeSafe(),n.setFromSpherical(u),e.position.copy(s).add(n),e.lookAt(s),r.dispatchEvent(h)},this.dispose=function(){t.removeEventListener("contextmenu",v,!1),t.removeEventListener("mousedown",d,!1),t.removeEventListener("wheel",m,!1),t.removeEventListener("mousemove",p,!1),t.removeEventListener("mouseup",f,!1),t.removeEventListener("mouseout",f,!1),t.removeEventListener("dblclick",f,!1),t.removeEventListener("touchstart",b,!1),t.removeEventListener("touchmove",w,!1)},t.addEventListener("contextmenu",v,!1),t.addEventListener("mousedown",d,!1),t.addEventListener("wheel",m,!1);var g=[new Kg,new Kg,new Kg],y=[new Kg,new Kg,new Kg],x=null;function b(e){if(!1!==r.enabled){switch(e.touches.length){case 1:g[0].set(e.touches[0].pageX,e.touches[0].pageY,0),g[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:g[0].set(e.touches[0].pageX,e.touches[0].pageY,0),g[1].set(e.touches[1].pageX,e.touches[1].pageY,0),x=g[0].distanceTo(g[1])}y[0].copy(g[0]),y[1].copy(g[1])}}function w(e){if(!1!==r.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:g[0].set(e.touches[0].pageX,e.touches[0].pageY,0),g[1].set(e.touches[0].pageX,e.touches[0].pageY,0),r.rotate(g[0].sub(o(g[0],y)).multiplyScalar(-r.rotationSpeed));break;case 2:g[0].set(e.touches[0].pageX,e.touches[0].pageY,0),g[1].set(e.touches[1].pageX,e.touches[1].pageY,0);var t=g[0].distanceTo(g[1]);r.zoom(new Kg(0,0,x-t)),x=t;var n=g[0].clone().sub(o(g[0],y)),i=g[1].clone().sub(o(g[1],y));n.x=-n.x,i.x=-i.x,r.pan(n.add(i).multiplyScalar(.5))}y[0].copy(g[0]),y[1].copy(g[1])}function o(e,t){var r=t[0];for(var n in t)r.distanceTo(e)>t[n].distanceTo(e)&&(r=t[n]);return r}}t.addEventListener("touchstart",b,!1),t.addEventListener("touchmove",w,!1)};jw.prototype=Object.create(ey.prototype),jw.prototype.constructor=jw;var zw=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Kg,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.panningMode=Vw,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:Ny,ZOOM:Ly,PAN:Iy},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),a=s.NONE},this.update=function(){var t=new Kg,i=(new $g).setFromUnitVectors(e.up,new Kg(0,1,0)),o=i.clone().inverse(),f=new Kg,m=new $g;return function(){var e=r.object.position;return t.copy(e).sub(r.target),t.applyQuaternion(i),c.setFromVector3(t),r.autoRotate&&a===s.NONE&&T(2*Math.PI/60/60*r.autoRotateSpeed),c.theta+=u.theta,c.phi+=u.phi,c.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(r.minDistance,Math.min(r.maxDistance,c.radius)),r.target.add(d),t.setFromSpherical(c),t.applyQuaternion(o),e.copy(r.target).add(t),r.object.lookAt(r.target),!0===r.enableDamping?(u.theta*=1-r.dampingFactor,u.phi*=1-r.dampingFactor,d.multiplyScalar(1-r.dampingFactor)):(u.set(0,0,0),d.set(0,0,0)),h=1,!!(p||f.distanceToSquared(r.object.position)>l||8*(1-m.dot(r.object.quaternion))>l)&&(r.dispatchEvent(n),f.copy(r.object.position),m.copy(r.object.quaternion),p=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",B,!1),r.domElement.removeEventListener("mousedown",D,!1),r.domElement.removeEventListener("wheel",I,!1),r.domElement.removeEventListener("touchstart",F,!1),r.domElement.removeEventListener("touchend",U,!1),r.domElement.removeEventListener("touchmove",k,!1),document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",L,!1),window.removeEventListener("keydown",R,!1)};var r=this,n={type:"change"},i={type:"start"},o={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},a=s.NONE,l=1e-6,c=new Bw,u=new Bw,h=1,d=new Kg,p=!1,f=new hy,m=new hy,v=new hy,g=new hy,y=new hy,x=new hy,b=new hy,w=new hy,_=new hy;function S(){return Math.pow(.95,r.zoomSpeed)}function T(e){u.theta-=e}function M(e){u.phi-=e}var A=function(){var e=new Kg;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),d.add(e)}}(),E=function(){var e=new Kg;return function(t,n){switch(r.panningMode){case Vw:e.setFromMatrixColumn(n,1);break;case Gw:e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)}e.multiplyScalar(t),d.add(e)}}(),C=function(){var e=new Kg;return function(t,n){var i=r.domElement===document?r.domElement.body:r.domElement;if(r.object.isPerspectiveCamera){var o=r.object.position;e.copy(o).sub(r.target);var s=e.length();s*=Math.tan(r.object.fov/2*Math.PI/180),A(2*t*s/i.clientHeight,r.object.matrix),E(2*n*s/i.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(A(t*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),E(n*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function P(e){r.object.isPerspectiveCamera?h/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(e){r.object.isPerspectiveCamera?h*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function D(e){if(!1!==r.enabled){switch(e.preventDefault(),e.button){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(e){f.set(e.clientX,e.clientY)}(e),a=s.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),a=s.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(e){g.set(e.clientX,e.clientY)}(e),a=s.PAN}a!==s.NONE&&(document.addEventListener("mousemove",N,!1),document.addEventListener("mouseup",L,!1),r.dispatchEvent(i))}}function N(e){if(!1!==r.enabled)switch(e.preventDefault(),a){case s.ROTATE:if(!1===r.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),v.subVectors(m,f).multiplyScalar(r.rotateSpeed);var t=r.domElement===document?r.domElement.body:r.domElement;T(2*Math.PI*v.x/t.clientWidth),M(2*Math.PI*v.y/t.clientHeight),f.copy(m),r.update()}(e);break;case s.DOLLY:if(!1===r.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),_.subVectors(w,b),_.y>0?P(S()):_.y<0&&O(S()),b.copy(w),r.update()}(e);break;case s.PAN:if(!1===r.enablePan)return;!function(e){y.set(e.clientX,e.clientY),x.subVectors(y,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(y),r.update()}(e)}}function L(e){!1!==r.enabled&&(document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",L,!1),r.dispatchEvent(o),a=s.NONE)}function I(e){!1===r.enabled||!1===r.enableZoom||a!==s.NONE&&a!==s.ROTATE||(e.preventDefault(),e.stopPropagation(),r.dispatchEvent(i),function(e){e.deltaY<0?O(S()):e.deltaY>0&&P(S()),r.update()}(e),r.dispatchEvent(o))}function R(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){switch(e.keyCode){case r.keys.UP:C(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:C(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:C(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:C(-r.keyPanSpeed,0),r.update()}}(e)}function F(e){if(!1!==r.enabled){switch(e.touches.length){case 1:if(!1===r.enableRotate)return;!function(e){f.set(e.touches[0].pageX,e.touches[0].pageY)}(e),a=s.TOUCH_ROTATE;break;case 2:if(!1===r.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);b.set(0,n)}(e),a=s.TOUCH_DOLLY;break;case 3:if(!1===r.enablePan)return;!function(e){g.set(e.touches[0].pageX,e.touches[0].pageY)}(e),a=s.TOUCH_PAN;break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(i)}}function k(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===r.enableRotate)return;if(a!==s.TOUCH_ROTATE)return;!function(e){m.set(e.touches[0].pageX,e.touches[0].pageY),v.subVectors(m,f).multiplyScalar(r.rotateSpeed);var t=r.domElement===document?r.domElement.body:r.domElement;T(2*Math.PI*v.x/t.clientWidth),M(2*Math.PI*v.y/t.clientHeight),f.copy(m),r.update()}(e);break;case 2:if(!1===r.enableZoom)return;if(a!==s.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);w.set(0,i),_.subVectors(w,b),_.y>0?O(S()):_.y<0&&P(S()),b.copy(w),r.update()}(e);break;case 3:if(!1===r.enablePan)return;if(a!==s.TOUCH_PAN)return;!function(e){y.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(y,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(y),r.update()}(e);break;default:a=s.NONE}}function U(e){!1!==r.enabled&&(r.dispatchEvent(o),a=s.NONE)}function B(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",B,!1),r.domElement.addEventListener("mousedown",D,!1),r.domElement.addEventListener("wheel",I,!1),r.domElement.addEventListener("touchstart",F,!1),r.domElement.addEventListener("touchend",U,!1),r.domElement.addEventListener("touchmove",k,!1),window.addEventListener("keydown",R,!1),this.update()};zw.prototype=Object.create(ey.prototype),zw.prototype.constructor=zw,Object.defineProperties(zw.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var Vw=0,Gw=1,Hw=function(e,t){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new Kg;var i=!0,o=n.NONE,s=n.NONE,a=new Kg,l=new Kg,c=new Kg,u=new hy,h=new hy,d=0,p=0,f=new hy,m=new hy;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var v={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var x=function(){var e=new hy;return function(t,n){return e.set((t-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),e}}(),b=function(){var e=new Kg,t=new Kg,n=new Kg;return function(i,o){n.set((i-.5*r.screen.width-r.screen.left)/r.radius,(.5*r.screen.height+r.screen.top-o)/r.radius,0);var s=n.length();return r.noRoll?s<Math.SQRT1_2?n.z=Math.sqrt(1-s*s):n.z=.5/s:s>1?n.normalize():n.z=Math.sqrt(1-s*s),a.copy(r.object.position).sub(r.target),e.copy(r.object.up).setLength(n.y),e.add(t.copy(r.object.up).cross(a).setLength(n.x)),e.add(a.setLength(n.z)),e}}();function w(e){!1!==r.enabled&&(window.removeEventListener("keydown",w),s=o,o===n.NONE&&(e.keyCode!==r.keys[n.ROTATE]||r.noRotate?e.keyCode!==r.keys[n.ZOOM]||r.noZoom?e.keyCode!==r.keys[n.PAN]||r.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE))}function _(e){!1!==r.enabled&&(o=s,window.addEventListener("keydown",w,!1))}function S(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o===n.NONE&&(o=e.button),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||(f.copy(x(e.pageX,e.pageY)),m.copy(f)):(u.copy(x(e.pageX,e.pageY)),h.copy(u)):(l.copy(b(e.pageX,e.pageY)),c.copy(l)),document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",M,!1),r.dispatchEvent(g))}function T(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||m.copy(x(e.pageX,e.pageY)):h.copy(x(e.pageX,e.pageY)):c.copy(b(e.pageX,e.pageY)))}function M(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",M),r.dispatchEvent(y))}function A(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),u.y+=.01*e.deltaY,r.dispatchEvent(g),r.dispatchEvent(y))}function E(e){if(!1!==r.enabled){switch(e.touches.length){case 1:o=n.TOUCH_ROTATE,l.copy(b(e.touches[0].pageX,e.touches[0].pageY)),c.copy(l);break;case 2:o=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;p=d=Math.sqrt(t*t+i*i);var s=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;f.copy(x(s,a)),m.copy(f);break;default:o=n.NONE}r.dispatchEvent(g)}}function C(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:c.copy(b(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;p=Math.sqrt(t*t+i*i);var s=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(x(s,a));break;default:o=n.NONE}}function P(e){if(!1!==r.enabled){switch(e.touches.length){case 1:c.copy(b(e.touches[0].pageX,e.touches[0].pageY)),l.copy(c);break;case 2:d=p=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(x(t,i)),f.copy(m)}o=n.NONE,r.dispatchEvent(y)}}function O(e){e.preventDefault()}this.rotateCamera=function(){var e=new Kg,t=new $g;return function(){var n=Math.acos(l.dot(c)/l.length()/c.length());n&&(e.crossVectors(l,c).normalize(),n*=r.rotateSpeed,t.setFromAxisAngle(e,-n),a.applyQuaternion(t),r.object.up.applyQuaternion(t),c.applyQuaternion(t),r.staticMoving?l.copy(c):(t.setFromAxisAngle(e,n*(r.dynamicDampingFactor-1)),l.applyQuaternion(t)),i=!0)}}(),this.zoomCamera=function(){if(o===n.TOUCH_ZOOM_PAN){var e=p/d;d=p,r.object.zoom*=e,i=!0}else{e=1+(h.y-u.y)*r.zoomSpeed;Math.abs(e-1)>1e-6&&e>0&&(r.object.zoom/=e,r.staticMoving?u.copy(h):u.y+=(h.y-u.y)*this.dynamicDampingFactor,i=!0)}},this.panCamera=function(){var e=new hy,t=new Kg,n=new Kg;return function(){if(e.copy(m).sub(f),e.lengthSq()){var o=(r.object.right-r.object.left)/r.object.zoom,s=(r.object.top-r.object.bottom)/r.object.zoom;e.x*=o,e.y*=s,n.copy(a).cross(r.object.up).setLength(e.x),n.add(t.copy(r.object.up).setLength(e.y)),r.object.position.add(n),r.target.add(n),r.staticMoving?f.copy(m):f.add(e.subVectors(m,f).multiplyScalar(r.dynamicDampingFactor)),i=!0}}}(),this.update=function(){a.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||(r.zoomCamera(),i&&r.object.updateProjectionMatrix()),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,a),r.object.lookAt(r.target),i&&(r.dispatchEvent(v),i=!1)},this.reset=function(){o=n.NONE,s=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),a.subVectors(r.object.position,r.target),r.object.left=r.left0,r.object.right=r.right0,r.object.top=r.top0,r.object.bottom=r.bottom0,r.object.lookAt(r.target),r.dispatchEvent(v),i=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",O,!1),this.domElement.removeEventListener("mousedown",S,!1),this.domElement.removeEventListener("wheel",A,!1),this.domElement.removeEventListener("touchstart",E,!1),this.domElement.removeEventListener("touchend",P,!1),this.domElement.removeEventListener("touchmove",C,!1),document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",M,!1),window.removeEventListener("keydown",w,!1),window.removeEventListener("keyup",_,!1)},this.domElement.addEventListener("contextmenu",O,!1),this.domElement.addEventListener("mousedown",S,!1),this.domElement.addEventListener("wheel",A,!1),this.domElement.addEventListener("touchstart",E,!1),this.domElement.addEventListener("touchend",P,!1),this.domElement.addEventListener("touchmove",C,!1),window.addEventListener("keydown",w,!1),window.addEventListener("keyup",_,!1),this.handleResize(),this.update()};Hw.prototype=Object.create(ey.prototype),Hw.prototype.constructor=Hw;var Ww=function(e,t){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new Kg;var i=new Kg,o=n.NONE,s=n.NONE,a=new Kg,l=new hy,c=new hy,u=new Kg,h=0,d=new hy,p=new hy,f=0,m=0,v=new hy,g=new hy;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},x={type:"start"},b={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var w=function(){var e=new hy;return function(t,n){return e.set((t-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),e}}(),_=function(){var e=new hy;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function S(e){!1!==r.enabled&&(window.removeEventListener("keydown",S),s=o,o===n.NONE&&(e.keyCode!==r.keys[n.ROTATE]||r.noRotate?e.keyCode!==r.keys[n.ZOOM]||r.noZoom?e.keyCode!==r.keys[n.PAN]||r.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE))}function T(e){!1!==r.enabled&&(o=s,window.addEventListener("keydown",S,!1))}function M(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o===n.NONE&&(o=e.button),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||(v.copy(w(e.pageX,e.pageY)),g.copy(v)):(d.copy(w(e.pageX,e.pageY)),p.copy(d)):(c.copy(_(e.pageX,e.pageY)),l.copy(c)),document.addEventListener("mousemove",A,!1),document.addEventListener("mouseup",E,!1),r.dispatchEvent(x))}function A(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||g.copy(w(e.pageX,e.pageY)):p.copy(w(e.pageX,e.pageY)):(l.copy(c),c.copy(_(e.pageX,e.pageY))))}function E(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",E),r.dispatchEvent(b))}function C(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:d.y-=.025*e.deltaY;break;case 1:d.y-=.01*e.deltaY;break;default:d.y-=25e-5*e.deltaY}r.dispatchEvent(x),r.dispatchEvent(b)}}function P(e){if(!1!==r.enabled){switch(e.touches.length){case 1:o=n.TOUCH_ROTATE,c.copy(_(e.touches[0].pageX,e.touches[0].pageY)),l.copy(c);break;default:o=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;m=f=Math.sqrt(t*t+i*i);var s=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(w(s,a)),g.copy(v)}r.dispatchEvent(x)}}function O(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:l.copy(c),c.copy(_(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;m=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(w(i,o))}}function D(e){if(!1!==r.enabled){switch(e.touches.length){case 0:o=n.NONE;break;case 1:o=n.TOUCH_ROTATE,c.copy(_(e.touches[0].pageX,e.touches[0].pageY)),l.copy(c)}r.dispatchEvent(b)}}function N(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=function(){var e,t=new Kg,n=new $g,i=new Kg,o=new Kg,s=new Kg,d=new Kg;return function(){d.set(c.x-l.x,c.y-l.y,0),(e=d.length())?(a.copy(r.object.position).sub(r.target),i.copy(a).normalize(),o.copy(r.object.up).normalize(),s.crossVectors(o,i).normalize(),o.setLength(c.y-l.y),s.setLength(c.x-l.x),d.copy(o.add(s)),t.crossVectors(d,a).normalize(),e*=r.rotateSpeed,n.setFromAxisAngle(t,e),a.applyQuaternion(n),r.object.up.applyQuaternion(n),u.copy(t),h=e):!r.staticMoving&&h&&(h*=Math.sqrt(1-r.dynamicDampingFactor),a.copy(r.object.position).sub(r.target),n.setFromAxisAngle(u,h),a.applyQuaternion(n),r.object.up.applyQuaternion(n)),l.copy(c)}}(),this.zoomCamera=function(){var e;o===n.TOUCH_ZOOM_PAN?(e=f/m,f=m,a.multiplyScalar(e)):(1!==(e=1+(p.y-d.y)*r.zoomSpeed)&&e>0&&a.multiplyScalar(e),r.staticMoving?d.copy(p):d.y+=(p.y-d.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=new hy,t=new Kg,n=new Kg;return function(){e.copy(g).sub(v),e.lengthSq()&&(e.multiplyScalar(a.length()*r.panSpeed),n.copy(a).cross(r.object.up).setLength(e.x),n.add(t.copy(r.object.up).setLength(e.y)),r.object.position.add(n),r.target.add(n),r.staticMoving?v.copy(g):v.add(e.subVectors(g,v).multiplyScalar(r.dynamicDampingFactor)))}}(),this.checkDistances=function(){r.noZoom&&r.noPan||(a.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,a.setLength(r.maxDistance)),d.copy(p)),a.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,a.setLength(r.minDistance)),d.copy(p)))},this.update=function(){a.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,a),r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(y),i.copy(r.object.position))},this.reset=function(){o=n.NONE,s=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),a.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(y),i.copy(r.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",N,!1),this.domElement.removeEventListener("mousedown",M,!1),this.domElement.removeEventListener("wheel",C,!1),this.domElement.removeEventListener("touchstart",P,!1),this.domElement.removeEventListener("touchend",D,!1),this.domElement.removeEventListener("touchmove",O,!1),document.removeEventListener("mousemove",A,!1),document.removeEventListener("mouseup",E,!1),window.removeEventListener("keydown",S,!1),window.removeEventListener("keyup",T,!1)},this.domElement.addEventListener("contextmenu",N,!1),this.domElement.addEventListener("mousedown",M,!1),this.domElement.addEventListener("wheel",C,!1),this.domElement.addEventListener("touchstart",P,!1),this.domElement.addEventListener("touchend",D,!1),this.domElement.addEventListener("touchmove",O,!1),window.addEventListener("keydown",S,!1),window.addEventListener("keyup",T,!1),this.handleResize(),this.update()};function Xw(e,t,r,n){py.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new qw(e,t,r,n)),this.mergeVertices()}function qw(e,t,r,n){Cy.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],o=[];function s(e,t,r,n){var i,o,s=Math.pow(2,n),l=[];for(i=0;i<=s;i++){l[i]=[];var c=e.clone().lerp(r,i/s),u=t.clone().lerp(r,i/s),h=s-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===s?c:c.clone().lerp(u,o/h)}for(i=0;i<s;i++)for(o=0;o<2*(s-i)-1;o++){var d=Math.floor(o/2);o%2==0?(a(l[i][d+1]),a(l[i+1][d]),a(l[i][d])):(a(l[i][d+1]),a(l[i+1][d+1]),a(l[i+1][d]))}}function a(e){i.push(e.x,e.y,e.z)}function l(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function c(e,t,r,n){n<0&&1===e.x&&(o[t]=e.x-1),0===r.x&&0===r.z&&(o[t]=n/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){for(var r=new Kg,n=new Kg,i=new Kg,o=0;o<t.length;o+=3)l(t[o+0],r),l(t[o+1],n),l(t[o+2],i),s(r,n,i,e)}(n=n||0),function(e){for(var t=new Kg,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){for(var e=new Kg,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=u(e)/2/Math.PI+.5,n=h(e)/Math.PI+.5;o.push(r,1-n)}(function(){for(var e=new Kg,t=new Kg,r=new Kg,n=new Kg,s=new hy,a=new hy,l=new hy,h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),n.copy(e).add(t).add(r).divideScalar(3);var p=u(n);c(s,d+0,e,p),c(a,d+2,t,p),c(l,d+4,r,p)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],r=o[e+2],n=o[e+4],i=Math.max(t,r,n),s=Math.min(t,r,n);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),r<.2&&(o[e+2]+=1),n<.2&&(o[e+4]+=1))}}()}(),this.addAttribute("position",new Sy(i,3)),this.addAttribute("normal",new Sy(i.slice(),3)),this.addAttribute("uv",new Sy(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Yw(e,t){py.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Jw(e,t)),this.mergeVertices()}function Jw(e,t){qw.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Zw(e,t,r,n,i){py.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new Qw(e,t,r,n,i)),this.mergeVertices()}function Qw(e,t,r,n,i){Cy.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,s,a=[],l=[],c=[],u=[],h=new Kg,d=new Kg,p=new Kg;for(o=0;o<=r;o++)for(s=0;s<=n;s++){var f=s/n*i,m=o/r*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(f),d.y=(e+t*Math.cos(m))*Math.sin(f),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(s/n),u.push(o/r)}for(o=1;o<=r;o++)for(s=1;s<=n;s++){var v=(n+1)*o+s-1,g=(n+1)*(o-1)+s-1,y=(n+1)*(o-1)+s,x=(n+1)*o+s;a.push(v,g,x),a.push(g,y,x)}this.setIndex(a),this.addAttribute("position",new Sy(l,3)),this.addAttribute("normal",new Sy(c,3)),this.addAttribute("uv",new Sy(u,2))}Ww.prototype=Object.create(ey.prototype),Ww.prototype.constructor=Ww,Xw.prototype=Object.create(py.prototype),Xw.prototype.constructor=Xw,qw.prototype=Object.create(Cy.prototype),qw.prototype.constructor=qw,Yw.prototype=Object.create(py.prototype),Yw.prototype.constructor=Yw,Jw.prototype=Object.create(qw.prototype),Jw.prototype.constructor=Jw,Zw.prototype=Object.create(py.prototype),Zw.prototype.constructor=Zw,Qw.prototype=Object.create(Cy.prototype),Qw.prototype.constructor=Qw;var Kw=function(e){xb.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=Ry,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};Kw.prototype=Object.create(xb.prototype),Kw.prototype.constructor=Kw;var $w=function(e){bb.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};$w.prototype=Object.create(bb.prototype),$w.prototype.constructor=$w;var e_=new Kw({visible:!1,transparent:!1}),t_=function(){this.init=function(){oy.call(this),this.handles=new oy,this.pickers=new oy,this.planes=new oy,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var e=new lw(50,50,2,2),t=new xb({visible:!1,side:ky}),r={XY:new Mb(e,t),YZ:new Mb(e,t),XZ:new Mb(e,t),XYZE:new Mb(e,t)};for(var n in this.activePlane=r.XYZE,r.YZ.rotation.set(0,Math.PI/2,0),r.XZ.rotation.set(-Math.PI/2,0,0),r)r[n].name=n,this.planes.add(r[n]),this.planes[n]=r[n];var i=function(e,t){for(var r in e)for(n=e[r].length;n--;){var i=e[r][n][0],o=e[r][n][1],s=e[r][n][2];i.name=r,i.renderOrder=1/0,o&&i.position.set(o[0],o[1],o[2]),s&&i.rotation.set(s[0],s[1],s[2]),t.add(i)}};i(this.handleGizmos,this.handles),i(this.pickerGizmos,this.pickers),this.traverse(function(e){if(e instanceof Mb){e.updateMatrix();var t=e.geometry.clone();t.applyMatrix(e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name===e?t.material.highlight(!0):t.material.highlight(!1))})}};t_.prototype=Object.create(oy.prototype),t_.prototype.constructor=t_,t_.prototype.update=function(e,t){var r=new Kg(0,0,0),n=new Kg(0,1,0),i=new Qg;this.traverse(function(o){-1!==o.name.search("E")?o.quaternion.setFromRotationMatrix(i.lookAt(t,r,n)):-1===o.name.search("X")&&-1===o.name.search("Y")&&-1===o.name.search("Z")||o.quaternion.setFromEuler(e)})};var r_=function(){t_.call(this);var e=new py,t=new Mb(new Nb(0,.05,.2,12,1,!1));t.position.y=.5,t.updateMatrix(),e.merge(t.geometry,t.matrix);var r=new Cy;r.addAttribute("position",new Sy([0,0,0,1,0,0],3));var n=new Cy;n.addAttribute("position",new Sy([0,0,0,0,1,0],3));var i=new Cy;i.addAttribute("position",new Sy([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new Mb(e,new Kw({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new Ab(r,new $w({color:16711680}))]],Y:[[new Mb(e,new Kw({color:65280})),[0,.5,0]],[new Ab(n,new $w({color:65280}))]],Z:[[new Mb(e,new Kw({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new Ab(i,new $w({color:255}))]],XYZ:[[new Mb(new Yw(.1,0),new Kw({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new Mb(new lw(.29,.29),new Kw({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new Mb(new lw(.29,.29),new Kw({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mb(new lw(.29,.29),new Kw({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new Mb(new Lb(.2,0,1,4,1,!1),e_),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Mb(new Lb(.2,0,1,4,1,!1),e_),[0,.6,0]]],Z:[[new Mb(new Lb(.2,0,1,4,1,!1),e_),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Mb(new Yw(.2,0),e_)]],XY:[[new Mb(new lw(.4,.4),e_),[.2,.2,0]]],YZ:[[new Mb(new lw(.4,.4),e_),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Mb(new lw(.4,.4),e_),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(e,t){var r=new Qg;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE),"XY"===e&&(this.activePlane=this.planes.XY),"YZ"===e&&(this.activePlane=this.planes.YZ),"XZ"===e&&(this.activePlane=this.planes.XZ)},this.init()};r_.prototype=Object.create(t_.prototype),r_.prototype.constructor=r_;var n_=function(){t_.call(this);var e=function(e,t,r){var n=new Cy,i=[];r=r||1;for(var o=0;o<=64*r;++o)"x"===t&&i.push(0,Math.cos(o/32*Math.PI)*e,Math.sin(o/32*Math.PI)*e),"y"===t&&i.push(Math.cos(o/32*Math.PI)*e,0,Math.sin(o/32*Math.PI)*e),"z"===t&&i.push(Math.sin(o/32*Math.PI)*e,Math.cos(o/32*Math.PI)*e,0);return n.addAttribute("position",new Sy(i,3)),n};this.handleGizmos={X:[[new Ab(new e(1,"x",.5),new $w({color:16711680}))]],Y:[[new Ab(new e(1,"y",.5),new $w({color:65280}))]],Z:[[new Ab(new e(1,"z",.5),new $w({color:255}))]],E:[[new Ab(new e(1.25,"z",1),new $w({color:13421568}))]],XYZE:[[new Ab(new e(1,"z",1),new $w({color:7895160}))]]},this.pickerGizmos={X:[[new Mb(new Qw(1,.12,4,12,Math.PI),e_),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mb(new Qw(1,.12,4,12,Math.PI),e_),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mb(new Qw(1,.12,4,12,Math.PI),e_),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mb(new Qw(1.25,.12,2,24),e_)]],XYZE:[[new Mb]]},this.setActivePlane=function(e){"E"===e&&(this.activePlane=this.planes.XYZE),"X"===e&&(this.activePlane=this.planes.YZ),"Y"===e&&(this.activePlane=this.planes.XZ),"Z"===e&&(this.activePlane=this.planes.XY)},this.update=function(e,t){t_.prototype.update.apply(this,arguments);var r=new Qg,n=new ty(0,0,1),i=new $g,o=new Kg(1,0,0),s=new Kg(0,1,0),a=new Kg(0,0,1),l=new $g,c=new $g,u=new $g,h=t.clone();n.copy(this.planes.XY.rotation),i.setFromEuler(n),r.makeRotationFromQuaternion(i).getInverse(r),h.applyMatrix4(r),this.traverse(function(e){i.setFromEuler(n),"X"===e.name&&(l.setFromAxisAngle(o,Math.atan2(-h.y,h.z)),i.multiplyQuaternions(i,l),e.quaternion.copy(i)),"Y"===e.name&&(c.setFromAxisAngle(s,Math.atan2(h.x,h.z)),i.multiplyQuaternions(i,c),e.quaternion.copy(i)),"Z"===e.name&&(u.setFromAxisAngle(a,Math.atan2(h.y,h.x)),i.multiplyQuaternions(i,u),e.quaternion.copy(i))})},this.init()};n_.prototype=Object.create(t_.prototype),n_.prototype.constructor=n_;var i_=function(){t_.call(this);var e=new py,t=new Mb(new Ob(.125,.125,.125));t.position.y=.5,t.updateMatrix(),e.merge(t.geometry,t.matrix);var r=new Cy;r.addAttribute("position",new Sy([0,0,0,1,0,0],3));var n=new Cy;n.addAttribute("position",new Sy([0,0,0,0,1,0],3));var i=new Cy;i.addAttribute("position",new Sy([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new Mb(e,new Kw({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new Ab(r,new $w({color:16711680}))]],Y:[[new Mb(e,new Kw({color:65280})),[0,.5,0]],[new Ab(n,new $w({color:65280}))]],Z:[[new Mb(e,new Kw({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new Ab(i,new $w({color:255}))]],XYZ:[[new Mb(new Db(.125,.125,.125),new Kw({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new Mb(new Lb(.2,0,1,4,1,!1),e_),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Mb(new Lb(.2,0,1,4,1,!1),e_),[0,.6,0]]],Z:[[new Mb(new Lb(.2,0,1,4,1,!1),e_),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Mb(new Db(.4,.4,.4),e_)]]},this.setActivePlane=function(e,t){var r=new Qg;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE)},this.init()};i_.prototype=Object.create(t_.prototype),i_.prototype.constructor=i_;var o_=function(e,t){oy.call(this),t=void 0!==t?t:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var r=this,n="translate",i=!1,o={translate:new r_,rotate:new n_,scale:new i_};for(var s in o){var a=o[s];a.visible=s===n,this.add(a)}var l={type:"change"},c={type:"mouseDown"},u={type:"mouseUp",mode:n},h={type:"objectChange"},d=new Rw,p=new hy,f=new Kg,m=new Kg,v=new Kg,g=new Kg,y=1,x=new Qg,b=new Kg,w=new Qg,_=new Kg,S=new $g,T=new Kg(1,0,0),M=new Kg(0,1,0),A=new Kg(0,0,1),E=new $g,C=new $g,P=new $g,O=new $g,D=new $g,N=new Kg,L=new Kg,I=new Qg,R=new Qg,F=new Kg,k=new Kg,U=new ty,B=new Qg,j=new Kg,z=new ty;function V(e){if(void 0!==r.object&&!0!==i&&(void 0===e.button||0===e.button)){var t=X(e.changedTouches?e.changedTouches[0]:e,o[n].pickers.children),s=null;t&&(s=t.object.name,e.preventDefault()),r.axis!==s&&(r.axis=s,r.update(),r.dispatchEvent(l))}}function G(e){if(void 0!==r.object&&!0!==i&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e;if(0===t.button||void 0===t.button){var s=X(t,o[n].pickers.children);if(s){e.preventDefault(),e.stopPropagation(),r.axis=s.object.name,r.dispatchEvent(c),r.update(),b.copy(j).sub(k).normalize(),o[n].setActivePlane(r.axis,b);var a=X(t,[o[n].activePlane]);a&&(N.copy(r.object.position),L.copy(r.object.scale),I.extractRotation(r.object.matrix),B.extractRotation(r.object.matrixWorld),R.extractRotation(r.object.parent.matrixWorld),F.setFromMatrixScale(w.getInverse(r.object.parent.matrixWorld)),m.copy(a.point))}}i=!0}}function H(e){if(void 0!==r.object&&null!==r.axis&&!1!==i&&(void 0===e.button||0===e.button)){var t=X(e.changedTouches?e.changedTouches[0]:e,[o[n].activePlane]);!1!==t&&(e.preventDefault(),e.stopPropagation(),f.copy(t.point),"translate"===n?(f.sub(m),f.multiply(F),"local"===r.space&&(f.applyMatrix4(w.getInverse(B)),-1===r.axis.search("X")&&(f.x=0),-1===r.axis.search("Y")&&(f.y=0),-1===r.axis.search("Z")&&(f.z=0),f.applyMatrix4(I),r.object.position.copy(N),r.object.position.add(f)),"world"!==r.space&&-1===r.axis.search("XYZ")||(-1===r.axis.search("X")&&(f.x=0),-1===r.axis.search("Y")&&(f.y=0),-1===r.axis.search("Z")&&(f.z=0),f.applyMatrix4(w.getInverse(R)),r.object.position.copy(N),r.object.position.add(f)),null!==r.translationSnap&&("local"===r.space&&r.object.position.applyMatrix4(w.getInverse(B)),-1!==r.axis.search("X")&&(r.object.position.x=Math.round(r.object.position.x/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Y")&&(r.object.position.y=Math.round(r.object.position.y/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Z")&&(r.object.position.z=Math.round(r.object.position.z/r.translationSnap)*r.translationSnap),"local"===r.space&&r.object.position.applyMatrix4(B))):"scale"===n?(f.sub(m),f.multiply(F),"local"===r.space&&("XYZ"===r.axis?(y=1+f.y/Math.max(L.x,L.y,L.z),r.object.scale.x=L.x*y,r.object.scale.y=L.y*y,r.object.scale.z=L.z*y):(f.applyMatrix4(w.getInverse(B)),"X"===r.axis&&(r.object.scale.x=L.x*(1+f.x/L.x)),"Y"===r.axis&&(r.object.scale.y=L.y*(1+f.y/L.y)),"Z"===r.axis&&(r.object.scale.z=L.z*(1+f.z/L.z))))):"rotate"===n&&(f.sub(k),f.multiply(F),_.copy(m).sub(k),_.multiply(F),"E"===r.axis?(f.applyMatrix4(w.getInverse(x)),_.applyMatrix4(w.getInverse(x)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(R)),D.setFromAxisAngle(b,v.z-g.z),E.setFromRotationMatrix(B),S.multiplyQuaternions(S,D),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S)):"XYZE"===r.axis?(D.setFromEuler(f.clone().cross(_).normalize()),S.setFromRotationMatrix(w.getInverse(R)),C.setFromAxisAngle(D,-f.clone().angleTo(_)),E.setFromRotationMatrix(B),S.multiplyQuaternions(S,C),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S)):"local"===r.space?(f.applyMatrix4(w.getInverse(B)),_.applyMatrix4(w.getInverse(B)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),E.setFromRotationMatrix(I),null!==r.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/r.rotationSnap)*r.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/r.rotationSnap)*r.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/r.rotationSnap)*r.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),"X"===r.axis&&E.multiplyQuaternions(E,C),"Y"===r.axis&&E.multiplyQuaternions(E,P),"Z"===r.axis&&E.multiplyQuaternions(E,O),r.object.quaternion.copy(E)):"world"===r.space&&(v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(R)),null!==r.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/r.rotationSnap)*r.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/r.rotationSnap)*r.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/r.rotationSnap)*r.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),E.setFromRotationMatrix(B),"X"===r.axis&&S.multiplyQuaternions(S,C),"Y"===r.axis&&S.multiplyQuaternions(S,P),"Z"===r.axis&&S.multiplyQuaternions(S,O),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S))),r.update(),r.dispatchEvent(l),r.dispatchEvent(h))}}function W(e){e.preventDefault(),void 0!==e.button&&0!==e.button||(i&&null!==r.axis&&(u.mode=n,r.dispatchEvent(u)),i=!1,"TouchEvent"in window&&e instanceof TouchEvent?(r.axis=null,r.update(),r.dispatchEvent(l)):V(e))}function X(r,n){var i=t.getBoundingClientRect(),o=(r.clientX-i.left)/i.width,s=(r.clientY-i.top)/i.height;p.set(2*o-1,-2*s+1),d.setFromCamera(p,e);var a=d.intersectObjects(n,!0);return!!a[0]&&a[0]}t.addEventListener("mousedown",G,!1),t.addEventListener("touchstart",G,!1),t.addEventListener("mousemove",V,!1),t.addEventListener("touchmove",V,!1),t.addEventListener("mousemove",H,!1),t.addEventListener("touchmove",H,!1),t.addEventListener("mouseup",W,!1),t.addEventListener("mouseout",W,!1),t.addEventListener("touchend",W,!1),t.addEventListener("touchcancel",W,!1),t.addEventListener("touchleave",W,!1),this.dispose=function(){t.removeEventListener("mousedown",G),t.removeEventListener("touchstart",G),t.removeEventListener("mousemove",V),t.removeEventListener("touchmove",V),t.removeEventListener("mousemove",H),t.removeEventListener("touchmove",H),t.removeEventListener("mouseup",W),t.removeEventListener("mouseout",W),t.removeEventListener("touchend",W),t.removeEventListener("touchcancel",W),t.removeEventListener("touchleave",W)},this.attach=function(e){this.object=e,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return n},this.setMode=function(e){for(var t in"scale"===(n=e||n)&&(r.space="local"),o)o[t].visible=t===n;this.update(),r.dispatchEvent(l)},this.setTranslationSnap=function(e){r.translationSnap=e},this.setRotationSnap=function(e){r.rotationSnap=e},this.setSize=function(e){r.size=e,this.update(),r.dispatchEvent(l)},this.setSpace=function(e){r.space=e,this.update(),r.dispatchEvent(l)},this.update=function(){void 0!==r.object&&(r.object.updateMatrixWorld(),k.setFromMatrixPosition(r.object.matrixWorld),U.setFromRotationMatrix(w.extractRotation(r.object.matrixWorld)),e.updateMatrixWorld(),j.setFromMatrixPosition(e.matrixWorld),z.setFromRotationMatrix(w.extractRotation(e.matrixWorld)),y=k.distanceTo(j)/6*r.size,this.position.copy(k),this.scale.set(y,y,y),e instanceof Kb?b.copy(j).sub(k).normalize():e instanceof tw&&b.copy(j).normalize(),"local"===r.space?o[n].update(U,b):"world"===r.space&&o[n].update(new ty,b),o[n].highlight(r.axis))}};o_.prototype=Object.create(oy.prototype),o_.prototype.constructor=o_;var s_=0;function a_(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new h_,this.unassigned=new h_,this.vertices=[]}function l_(){this.normal=new Kg,this.midpoint=new Kg,this.area=0,this.constant=0,this.outside=null,this.mark=s_,this.edge=null}function c_(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function u_(e){this.point=e,this.prev=null,this.next=null,this.face=null}function h_(){this.head=null,this.tail=null}function d_(e){py.call(this),this.fromBufferGeometry(new p_(e)),this.mergeVertices()}function p_(e){Cy.call(this);var t=[],r=[];void 0===a_&&console.error("ConvexBufferGeometry: ConvexBufferGeometry relies on QuickHull");for(var n=(new a_).setFromPoints(e).faces,i=0;i<n.length;i++){var o=n[i],s=o.edge;do{var a=s.head().point;t.push(a.x,a.y,a.z),r.push(o.normal.x,o.normal.y,o.normal.z),s=s.next}while(s!==o.edge)}this.addAttribute("position",new Sy(t,3)),this.addAttribute("normal",new Sy(r,3))}Object.assign(a_.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("QuickHull: Points parameter is not an array."),e.length<4&&console.error("QuickHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.vertices.push(new u_(e[t]));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse(function(e){var r,n,i,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)(i=s[r].clone()).applyMatrix4(e.matrixWorld),t.push(i)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)(i=new Kg).fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),t.push(i)}}),this.setFromPoints(t)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,r=e.outside;null!==r.next&&r.next.face===e;)r=r.next;return this.assigned.removeSubList(t,r),t.prev=r.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var r=this.removeAllVerticesFromFace(e);if(void 0!==r)if(void 0===t)this.unassigned.appendChain(r);else{var n=r;do{var i=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=i}while(null!==n)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var r=t.next,n=this.tolerance,i=null,o=0;o<e.length;o++){var s=e[o];if(s.mark===s_){var a=s.distanceToPoint(t.point);if(a>n&&(n=a,i=s),n>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(t,i),t=r}while(null!==t)}return this},computeExtremes:function(){var e,t,r,n=new Kg,i=new Kg,o=[],s=[];for(e=0;e<3;e++)o[e]=s[e]=this.vertices[0];for(n.copy(this.vertices[0].point),i.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var a=this.vertices[e],l=a.point;for(r=0;r<3;r++)l.getComponent(r)<n.getComponent(r)&&(n.setComponent(r,l.getComponent(r)),o[r]=a);for(r=0;r<3;r++)l.getComponent(r)>i.getComponent(r)&&(i.setComponent(r,l.getComponent(r)),s[r]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(i.x))+Math.max(Math.abs(n.y),Math.abs(i.y))+Math.max(Math.abs(n.z),Math.abs(i.z))),{min:o,max:s}},computeInitialHull:function(){var e,t,r;return function(){void 0===e&&(e=new _b,t=new Sb,r=new Kg);var n,i,o,s,a,l,c,u,h,d=this.vertices,p=this.computeExtremes(),f=p.min,m=p.max,v=0,g=0;for(l=0;l<3;l++)(h=m[l].point.getComponent(l)-f[l].point.getComponent(l))>v&&(v=h,g=l);for(i=f[g],o=m[g],v=0,e.set(i.point,o.point),l=0,c=this.vertices.length;l<c;l++)(n=d[l])!==i&&n!==o&&(e.closestPointToPoint(n.point,!0,r),(h=r.distanceToSquared(n.point))>v&&(v=h,s=n));for(v=-1,t.setFromCoplanarPoints(i.point,o.point,s.point),l=0,c=this.vertices.length;l<c;l++)(n=d[l])!==i&&n!==o&&n!==s&&(h=Math.abs(t.distanceToPoint(n.point)))>v&&(v=h,a=n);var y=[];if(t.distanceToPoint(a.point)<0)for(y.push(l_.create(i,o,s),l_.create(a,o,i),l_.create(a,s,o),l_.create(a,i,s)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge(u)),y[l+1].getEdge(1).setTwin(y[u+1].getEdge(0));else for(y.push(l_.create(i,s,o),l_.create(a,i,o),l_.create(a,o,s),l_.create(a,s,i)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge((3-l)%3)),y[l+1].getEdge(0).setTwin(y[u+1].getEdge(1));for(l=0;l<4;l++)this.faces.push(y[l]);for(l=0,c=d.length;l<c;l++)if((n=d[l])!==i&&n!==o&&n!==s&&n!==a){v=this.tolerance;var x=null;for(u=0;u<4;u++)(h=this.faces[u].distanceToPoint(n.point))>v&&(v=h,x=this.faces[u]);null!==x&&this.addVertexToFace(n,x)}return this}}(),reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var r=this.faces[t];r.mark===s_&&e.push(r)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,r=this.assigned.first().face,n=r.outside;do{var i=r.distanceToPoint(n.point);i>t&&(t=i,e=n),n=n.next}while(null!==n&&n.face===r);return e}},computeHorizon:function(e,t,r,n){var i;this.deleteFaceVertices(r),r.mark=1,i=null===t?t=r.getEdge(0):t.next;do{var o=i.twin,s=o.face;s.mark===s_&&(s.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,o,s,n):n.push(i)),i=i.next}while(i!==t);return this},addAdjoiningFace:function(e,t){var r=l_.create(e,t.tail(),t.head());return this.faces.push(r),r.getEdge(-1).setTwin(t.twin),r.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var r=null,n=null,i=0;i<t.length;i++){var o=t[i],s=this.addAdjoiningFace(e,o);null===r?r=s:s.next.setTwin(n),this.newFaces.push(s.face),n=s}return r.next.setTwin(n),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(l_,{create:function(e,t,r){var n=new l_,i=new c_(e,n),o=new c_(t,n),s=new c_(r,n);return i.next=s.prev=o,o.next=i.prev=s,s.next=o.prev=i,n.edge=i,n.compute()}}),Object.assign(l_.prototype,{getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){var e;return function(){void 0===e&&(e=new Tb);var t=this.edge.tail(),r=this.edge.head(),n=this.edge.next.head();return e.set(t.point,r.point,n.point),e.getNormal(this.normal),e.getMidpoint(this.midpoint),this.area=e.getArea(),this.constant=this.normal.dot(this.midpoint),this}}(),distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(c_.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(h_.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),d_.prototype=Object.create(py.prototype),d_.prototype.constructor=d_,p_.prototype=Object.create(Cy.prototype),p_.prototype.constructor=p_;var f_=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new _b,this.tempPlane1=new Sb,this.tempPlane2=new Sb,this.tempCM1=new Kg,this.tempCM2=new Kg,this.tempVector3=new Kg,this.tempVector3_2=new Kg,this.tempVector3_3=new Kg,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var r=0;r<900;r++)this.segments[r]=!1};function m_(){this.type="Curve",this.arcLengthDivisions=200}function v_(){m_.call(this)}function g_(e){m_.call(this),this.scale=void 0===e?5:e}function y_(e){m_.call(this),this.scale=void 0===e?70:e}function x_(){m_.call(this)}function b_(){m_.call(this)}function w_(e){m_.call(this),this.scale=void 0===e?10:e}function __(e){m_.call(this),this.scale=void 0===e?10:e}function S_(e){m_.call(this),this.scale=void 0===e?10:e}function T_(e){m_.call(this),this.scale=void 0===e?10:e}f_.prototype={constructor:f_,prepareBreakableObject:function(e,t,r,n,i){for(var o=e.geometry.vertices,s=0,a=o.length;s<a;s++)o[s].mark=0;var l=e.userData;l.mass=t,l.velocity=r.clone(),l.angularVelocity=n.clone(),l.breakable=i},subdivideByImpact:function(e,t,r,n,i,o){var s=[],a=this.tempPlane1,l=this.tempPlane2;this.tempVector3.addVectors(t,r),a.setFromCoplanarPoints(t,e.position,this.tempVector3);var c=i+n,u=this;return function i(o,h,d,p){if(Math.random()<.05*p||p>c)s.push(o);else{var f=Math.PI;0===p?(l.normal.copy(a.normal),l.constant=a.constant):p<=n?(f=(d-h)*(.2+.6*Math.random())+h,u.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(r,f).add(t),l.setFromCoplanarPoints(t,u.tempVector3,u.tempVector3_2)):(f=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(t).sub(o.position).applyAxisAngle(r,f).add(o.position),u.tempVector3_3.copy(r).add(o.position),l.setFromCoplanarPoints(o.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(o,l,u.tempResultObjects);var m=u.tempResultObjects.object1,v=u.tempResultObjects.object2;m&&i(m,h,f,p+1),v&&i(v,f,d,p+1)}}(e,0,2*Math.PI,0),s},cutByPlane:function(e,t,r){for(var n=e.geometry,i=n.vertices,o=n.faces,s=i.length,a=[],l=[],c=this.smallDelta,u=0;u<s;u++)i[u].mark=0;var h=s*s;for(u=0;u<h;u++)this.segments[u]=!1;u=0;for(var d=o.length-1;u<d;u++)for(var p=o[u],f=u+1,m=o.length;f<m;f++){var v=o[f];if(1-p.normal.dot(v.normal)<c){var g=p.a,y=p.b,x=p.c,b=v.a,w=v.b,_=v.c;g===b||g===w||g===_?y===b||y===w||y===_?(this.segments[g*s+y]=!0,this.segments[y*s+g]=!0):(this.segments[x*s+g]=!0,this.segments[g*s+x]=!0):y!==b&&y!==w&&y!==_||(this.segments[x*s+y]=!0,this.segments[y*s+x]=!0)}}var S=this.tempPlane1;e.updateMatrix(),f_.transformPlaneToLocalSpace(t,e.matrix,S);for(u=0,d=o.length;u<d;u++)for(var T=o[u],M=0;M<3;M++){var A=0===M?T.a:1===M?T.b:T.c,E=0===M?T.b:1===M?T.c:T.a;if(!this.segments[A*s+E]){this.segments[A*s+E]=!0,this.segments[E*s+A]=!0;var C,P=i[A],O=i[E];if(0===P.mark)if((C=S.distanceToPoint(P))>c)P.mark=2,l.push(P);else if(C<-c)P.mark=1,a.push(P);else{P.mark=3,a.push(P);var D=P.clone();D.mark=3,l.push(D)}if(0===O.mark)if((C=S.distanceToPoint(O))>c)O.mark=2,l.push(O);else if(C<-c)O.mark=1,a.push(O);else{O.mark=3,a.push(O);var N=O.clone();N.mark=3,l.push(N)}var L=P.mark,I=O.mark;if(1===L&&2===I||2===L&&1===I){this.tempLine1.start.copy(P),this.tempLine1.end.copy(O);var R=S.intersectLine(this.tempLine1);if(void 0===R)return console.error("Internal error: segment does not intersect plane."),r.segmentedObject1=null,r.segmentedObject2=null,0;R.mark=1,a.push(R);var F=R.clone();F.mark=2,l.push(F)}}}var k=.5*e.userData.mass;this.tempCM1.set(0,0,0);var U=0,B=a.length;if(B>0){for(u=0;u<B;u++)this.tempCM1.add(a[u]);this.tempCM1.divideScalar(B);for(u=0;u<B;u++){(V=a[u]).sub(this.tempCM1),U=Math.max(U,V.x,V.y,V.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var j=0,z=l.length;if(z>0){for(u=0;u<z;u++)this.tempCM2.add(l[u]);this.tempCM2.divideScalar(z);for(u=0;u<z;u++){var V;(V=l[u]).sub(this.tempCM2),j=Math.max(j,V.x,V.y,V.z)}this.tempCM2.add(e.position)}var G=null,H=null,W=0;return B>4&&((G=new Mb(new d_(a),e.material)).position.copy(this.tempCM1),G.quaternion.copy(e.quaternion),this.prepareBreakableObject(G,k,e.userData.velocity,e.userData.angularVelocity,2*U>this.minSizeForBreak),W++),z>4&&((H=new Mb(new d_(l),e.material)).position.copy(this.tempCM2),H.quaternion.copy(e.quaternion),this.prepareBreakableObject(H,k,e.userData.velocity,e.userData.angularVelocity,2*j>this.minSizeForBreak),W++),r.object1=G,r.object2=H,W}},f_.transformFreeVector=function(e,t){var r=e.x,n=e.y,i=e.z,o=t.elements;return e.x=o[0]*r+o[4]*n+o[8]*i,e.y=o[1]*r+o[5]*n+o[9]*i,e.z=o[2]*r+o[6]*n+o[10]*i,e},f_.transformFreeVectorInverse=function(e,t){var r=e.x,n=e.y,i=e.z,o=t.elements;return e.x=o[0]*r+o[1]*n+o[2]*i,e.y=o[4]*r+o[5]*n+o[6]*i,e.z=o[8]*r+o[9]*n+o[10]*i,e},f_.transformTiedVectorInverse=function(e,t){var r=e.x,n=e.y,i=e.z,o=t.elements;return e.x=o[0]*r+o[1]*n+o[2]*i-o[12],e.y=o[4]*r+o[5]*n+o[6]*i-o[13],e.z=o[8]*r+o[9]*n+o[10]*i-o[14],e},f_.transformPlaneToLocalSpace=function(){var e=new Kg;new ny;return function(t,r,n){n.normal.copy(t.normal),n.constant=t.constant;var i=f_.transformTiedVectorInverse(t.coplanarPoint(e),r);f_.transformFreeVectorInverse(n.normal,r),n.constant=-i.dot(n.normal)}}(),Object.assign(m_.prototype,{getPoint:function(){return console.warn("Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t||e*n[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=n[i=Math.floor(a+(l-a)/2)]-r)<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(o-1);var c=n[i];return(i+(r-c)/(n[i+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,o=new Kg,s=[],a=[],l=[],c=new Kg,u=new Qg;for(r=0;r<=e;r++)n=r/e,s[r]=this.getTangentAt(n),s[r].normalize();a[0]=new Kg,l[0]=new Kg;var h=Number.MAX_VALUE,d=Math.abs(s[0].x),p=Math.abs(s[0].y),f=Math.abs(s[0].z);for(d<=h&&(h=d,o.set(1,0,0)),p<=h&&(h=p,o.set(0,1,0)),f<=h&&o.set(0,0,1),c.crossVectors(s[0],o).normalize(),a[0].crossVectors(s[0],c),l[0].crossVectors(s[0],a[0]),r=1;r<=e;r++)a[r]=a[r-1].clone(),l[r]=l[r-1].clone(),c.crossVectors(s[r-1],s[r]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(Zg.clamp(s[r-1].dot(s[r]),-1,1)),a[r].applyMatrix4(u.makeRotationAxis(c,i))),l[r].crossVectors(s[r],a[r]);if(!0===t)for(i=Math.acos(Zg.clamp(a[0].dot(a[e]),-1,1)),i/=e,s[0].dot(c.crossVectors(a[0],a[e]))>0&&(i=-i),r=1;r<=e;r++)a[r].applyMatrix4(u.makeRotationAxis(s[r],i*r)),l[r].crossVectors(s[r],a[r]);return{tangents:s,normals:a,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),v_.prototype=Object.create(m_.prototype),v_.prototype.constructor=v_,v_.prototype.getPoint=function(e,t){var r=t||new Kg;e=2*Math.PI*e;var n=-.22*Math.cos(e)-1.28*Math.sin(e)-.44*Math.cos(3*e)-.78*Math.sin(3*e),i=-.1*Math.cos(2*e)-.27*Math.sin(2*e)+.38*Math.cos(4*e)+.46*Math.sin(4*e),o=.7*Math.cos(3*e)-.4*Math.sin(3*e);return r.set(n,i,o).multiplyScalar(20)},g_.prototype=Object.create(m_.prototype),g_.prototype.constructor=g_,g_.prototype.getPoint=function(e,t){var r=t||new Kg;e*=2*Math.PI;var n=16*Math.pow(Math.sin(e),3),i=13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e);return r.set(n,i,0).multiplyScalar(this.scale)},y_.prototype=Object.create(m_.prototype),y_.prototype.constructor=y_,y_.prototype.getPoint=function(e,t){var r=t||new Kg;e=4*e*Math.PI;var n=this.scale/2,i=n*(1+Math.cos(e)),o=n*Math.sin(e),s=2*n*Math.sin(e/2);return r.set(i,o,s)},x_.prototype=Object.create(m_.prototype),x_.prototype.constructor=x_,x_.prototype.getPoint=function(e,t){var r=t||new Kg;e*=2*Math.PI;var n=50*Math.sin(e),i=Math.cos(e)*(10+50*Math.cos(e)),o=Math.sin(e)*(10+50*Math.cos(e));return r.set(n,i,o)},b_.prototype=Object.create(m_.prototype),b_.prototype.constructor=b_,b_.prototype.getPoint=function(e,t){var r=t||new Kg,n=2*Math.PI*e*150/30,i=30*Math.cos(n),o=30*Math.sin(n),s=150*e;return r.set(i,o,s)},w_.prototype=Object.create(m_.prototype),w_.prototype.constructor=w_,w_.prototype.getPoint=function(e,t){var r=t||new Kg;e*=2*Math.PI;var n=(2+Math.cos(3*e))*Math.cos(2*e),i=(2+Math.cos(3*e))*Math.sin(2*e),o=Math.sin(3*e);return r.set(n,i,o).multiplyScalar(this.scale)},__.prototype=Object.create(m_.prototype),__.prototype.constructor=__,__.prototype.getPoint=function(e,t){var r=t||new Kg;e*=2*Math.PI;var n=(2+Math.cos(4*e))*Math.cos(3*e),i=(2+Math.cos(4*e))*Math.sin(3*e),o=Math.sin(4*e);return r.set(n,i,o).multiplyScalar(this.scale)},S_.prototype=Object.create(m_.prototype),S_.prototype.constructor=S_,S_.prototype.getPoint=function(e,t){var r=t||new Kg;e*=2*Math.PI;var n=(2+Math.cos(5*e))*Math.cos(2*e),i=(2+Math.cos(5*e))*Math.sin(2*e),o=Math.sin(5*e);return r.set(n,i,o).multiplyScalar(this.scale)},T_.prototype=Object.create(m_.prototype),T_.prototype.constructor=T_,T_.prototype.getPoint=function(e,t){var r=t||new Kg;e=4*e-2;var n=Math.pow(e,3)-3*e,i=Math.pow(e,4)-4*e*e,o=.2*Math.pow(e,5)-2*e;return r.set(n,i,o).multiplyScalar(this.scale)};function M_(e){m_.call(this),this.scale=void 0===e?1:e}function A_(e){m_.call(this),this.scale=void 0===e?40:e}function E_(e){m_.call(this),this.scale=void 0===e?40:e}function C_(e){m_.call(this),this.scale=void 0===e?40:e}function P_(e){m_.call(this),this.scale=void 0===e?40:e}M_.prototype=Object.create(m_.prototype),M_.prototype.constructor=M_,M_.prototype.getPoint=function(e,t){var r=t||new Kg,n=.4*(e=function(e,t,r){return r*(t-e)+e}(-4,4,e))*(e*e-7)*(e*e-10),i=Math.pow(e,4)-13*e*e,o=.1*e*(e*e-4)*(e*e-9)*(e*e-12);return r.set(n,i,o).multiplyScalar(this.scale)},A_.prototype=Object.create(m_.prototype),A_.prototype.constructor=A_,A_.prototype.getPoint=function(e,t){var r=t||new Kg;e*=2*Math.PI;var n=Math.cos(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),i=Math.sin(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),o=.35*Math.sin(5*e);return r.set(n,i,o).multiplyScalar(this.scale)},E_.prototype=Object.create(m_.prototype),E_.prototype.constructor=E_,E_.prototype.getPoint=function(e,t){var r=t||new Kg,n=e*Math.PI*2,i=Math.cos(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),o=Math.sin(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),s=.2*Math.sin(9*n);return r.set(i,o,s).multiplyScalar(this.scale)},C_.prototype=Object.create(m_.prototype),C_.prototype.constructor=C_,C_.prototype.getPoint=function(e,t){var r=t||new Kg,n=e*Math.PI*2,i=Math.cos(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),o=Math.sin(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),s=.2*Math.sin(20*n);return r.set(i,o,s).multiplyScalar(this.scale)},P_.prototype=Object.create(m_.prototype),P_.prototype.constructor=P_,P_.prototype.getPoint=function(e,t){var r=t||new Kg,n=e*Math.PI*2,i=Math.cos(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),o=Math.sin(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),s=.35*Math.sin(15*n);return r.set(i,o,s).multiplyScalar(this.scale)};var O_={findSpan:function(e,t,r){var n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;for(var i=e,o=n,s=Math.floor((i+o)/2);t<r[s]||t>=r[s+1];)t<r[s]?o=s:i=s,s=Math.floor((i+o)/2);return s},calcBasisFunctions:function(e,t,r,n){var i=[],o=[],s=[];i[0]=1;for(var a=1;a<=r;++a){o[a]=t-n[e+1-a],s[a]=n[e+a]-t;for(var l=0,c=0;c<a;++c){var u=s[c+1],h=o[a-c],d=i[c]/(u+h);i[c]=l+u*d,l=h*d}i[a]=l}return i},calcBSplinePoint:function(e,t,r,n){for(var i=this.findSpan(e,n,t),o=this.calcBasisFunctions(i,n,e,t),s=new fy(0,0,0,0),a=0;a<=e;++a){var l=r[i-e+a],c=o[a],u=l.w*c;s.x+=l.x*u,s.y+=l.y*u,s.z+=l.z*u,s.w+=l.w*c}return s},calcBasisFunctionDerivatives:function(e,t,r,n,i){for(var o=[],s=0;s<=r;++s)o[s]=0;var a=[];for(s=0;s<=n;++s)a[s]=o.slice(0);var l=[];for(s=0;s<=r;++s)l[s]=o.slice(0);l[0][0]=1;for(var c=o.slice(0),u=o.slice(0),h=1;h<=r;++h){c[h]=t-i[e+1-h],u[h]=i[e+h]-t;for(var d=0,p=0;p<h;++p){var f=u[p+1],m=c[h-p];l[h][p]=f+m;var v=l[p][h-1]/l[h][p];l[p][h]=d+f*v,d=m*v}l[h][h]=d}for(h=0;h<=r;++h)a[0][h]=l[h][r];for(p=0;p<=r;++p){var g=0,y=1,x=[];for(s=0;s<=r;++s)x[s]=o.slice(0);x[0][0]=1;for(var b=1;b<=n;++b){var w=0,_=p-b,S=r-b;p>=b&&(x[y][0]=x[g][0]/l[S+1][_],w=x[y][0]*l[_][S]);var T=p-1<=S?b-1:r-p;for(h=_>=-1?1:-_;h<=T;++h)x[y][h]=(x[g][h]-x[g][h-1])/l[S+1][_+h],w+=x[y][h]*l[_+h][S];p<=S&&(x[y][b]=-x[g][b-1]/l[S+1][p],w+=x[y][b]*l[p][S]),a[b][p]=w;h=g;g=y,y=h}}for(p=r,b=1;b<=n;++b){for(h=0;h<=r;++h)a[b][h]*=p;p*=r-b}return a},calcBSplineDerivatives:function(e,t,r,n,i){for(var o=i<e?i:e,s=[],a=this.findSpan(e,n,t),l=this.calcBasisFunctionDerivatives(a,n,e,o,t),c=[],u=0;u<r.length;++u){var h=(p=r[u].clone()).w;p.x*=h,p.y*=h,p.z*=h,c[u]=p}for(var d=0;d<=o;++d){for(var p=c[a-e].clone().multiplyScalar(l[d][0]),f=1;f<=e;++f)p.add(c[a-e+f].clone().multiplyScalar(l[d][f]));s[d]=p}for(d=o+1;d<=i+1;++d)s[d]=new fy(0,0,0);return s},calcKoverI:function(e,t){for(var r=1,n=2;n<=e;++n)r*=n;var i=1;for(n=2;n<=t;++n)i*=n;for(n=2;n<=e-t;++n)i*=n;return r/i},calcRationalCurveDerivatives:function(e){for(var t=e.length,r=[],n=[],i=0;i<t;++i){var o=e[i];r[i]=new Kg(o.x,o.y,o.z),n[i]=o.w}for(var s=[],a=0;a<t;++a){var l=r[a].clone();for(i=1;i<=a;++i)l.sub(s[a-i].clone().multiplyScalar(this.calcKoverI(a,i)*n[i]));s[a]=l.divideScalar(n[0])}return s},calcNURBSDerivatives:function(e,t,r,n,i){var o=this.calcBSplineDerivatives(e,t,r,n,i);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(e,t,r,n,i,o,s){for(var a=this.findSpan(e,o,r),l=this.findSpan(t,s,n),c=this.calcBasisFunctions(a,o,e,r),u=this.calcBasisFunctions(l,s,t,n),h=[],d=0;d<=t;++d){h[d]=new fy(0,0,0,0);for(var p=0;p<=e;++p){var f=i[a-e+p][l-t+d].clone(),m=f.w;f.x*=m,f.y*=m,f.z*=m,h[d].add(f.multiplyScalar(c[p]))}}var v=new fy(0,0,0,0);for(d=0;d<=t;++d)v.add(h[d].multiplyScalar(u[d]));return v.divideScalar(v.w),new Kg(v.x,v.y,v.z)}},D_=function(e,t,r,n,i){m_.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=i||this.knots.length-1;for(var o=0;o<r.length;++o){var s=r[o];this.controlPoints[o]=new fy(s.x,s.y,s.z,s.w)}};D_.prototype=Object.create(m_.prototype),D_.prototype.constructor=D_,D_.prototype.getPoint=function(e){var t=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=O_.calcBSplinePoint(this.degree,this.knots,this.controlPoints,t);return 1!=r.w&&r.divideScalar(r.w),new Kg(r.x,r.y,r.z)},D_.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=O_.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,t,1)[1].clone();return r.normalize(),r};var N_=function(e,t,r,n,i){this.degree1=e,this.degree2=t,this.knots1=r,this.knots2=n,this.controlPoints=[];for(var o=r.length-e-1,s=n.length-t-1,a=0;a<o;++a){this.controlPoints[a]=[];for(var l=0;l<s;++l){var c=i[a][l];this.controlPoints[a][l]=new fy(c.x,c.y,c.z,c.w)}}};N_.prototype={constructor:N_,getPoint:function(e,t){var r=this.knots1[0]+e*(this.knots1[this.knots1.length-1]-this.knots1[0]),n=this.knots2[0]+t*(this.knots2[this.knots2.length-1]-this.knots2[0]);return O_.calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,r,n)}};var L_={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,r,n;t=void 0!==(e=e||{}).parent?e.parent:document.body,r=void 0!==e.id?e.id:"oldie",(n=L_.getWebGLErrorMessage()).id=r,t.appendChild(n)}};function I_(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Kb,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Kb,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}Object.assign(I_.prototype,{update:function(){var e,t,r,n,i,o,s,a,l=new Qg,c=new Qg;return function(u){if(e!==this||t!==u.focus||r!==u.fov||n!==u.aspect*this.aspect||i!==u.near||o!==u.far||s!==u.zoom||a!==this.eyeSep){e=this,t=u.focus,r=u.fov,n=u.aspect*this.aspect,i=u.near,o=u.far,s=u.zoom;var h,d,p=u.projectionMatrix.clone(),f=(a=this.eyeSep/2)*i/t,m=i*Math.tan(Zg.DEG2RAD*r*.5)/s;c.elements[12]=-a,l.elements[12]=a,h=-m*n+f,d=m*n+f,p.elements[0]=2*i/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),h=-m*n-f,d=m*n-f,p.elements[0]=2*i/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()});var R_={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit(  ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit(  );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance(  const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance(  const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance(  geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance(  geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance(  geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},F_={common:{diffuse:{value:new ay(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new ny},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new hy(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ay(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ay(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new ny}}},k_={basic:{uniforms:ow.merge([F_.common,F_.specularmap,F_.envmap,F_.aomap,F_.lightmap,F_.fog]),vertexShader:R_.meshbasic_vert,fragmentShader:R_.meshbasic_frag},lambert:{uniforms:ow.merge([F_.common,F_.specularmap,F_.envmap,F_.aomap,F_.lightmap,F_.emissivemap,F_.fog,F_.lights,{emissive:{value:new ay(0)}}]),vertexShader:R_.meshlambert_vert,fragmentShader:R_.meshlambert_frag},phong:{uniforms:ow.merge([F_.common,F_.specularmap,F_.envmap,F_.aomap,F_.lightmap,F_.emissivemap,F_.bumpmap,F_.normalmap,F_.displacementmap,F_.gradientmap,F_.fog,F_.lights,{emissive:{value:new ay(0)},specular:{value:new ay(1118481)},shininess:{value:30}}]),vertexShader:R_.meshphong_vert,fragmentShader:R_.meshphong_frag},standard:{uniforms:ow.merge([F_.common,F_.envmap,F_.aomap,F_.lightmap,F_.emissivemap,F_.bumpmap,F_.normalmap,F_.displacementmap,F_.roughnessmap,F_.metalnessmap,F_.fog,F_.lights,{emissive:{value:new ay(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:R_.meshphysical_vert,fragmentShader:R_.meshphysical_frag},points:{uniforms:ow.merge([F_.points,F_.fog]),vertexShader:R_.points_vert,fragmentShader:R_.points_frag},dashed:{uniforms:ow.merge([F_.common,F_.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:R_.linedashed_vert,fragmentShader:R_.linedashed_frag},depth:{uniforms:ow.merge([F_.common,F_.displacementmap]),vertexShader:R_.depth_vert,fragmentShader:R_.depth_frag},normal:{uniforms:ow.merge([F_.common,F_.bumpmap,F_.normalmap,F_.displacementmap,{opacity:{value:1}}]),vertexShader:R_.normal_vert,fragmentShader:R_.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:R_.cube_vert,fragmentShader:R_.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:R_.equirect_vert,fragmentShader:R_.equirect_frag},distanceRGBA:{uniforms:ow.merge([F_.common,F_.displacementmap,{referencePosition:{value:new Kg},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:R_.distanceRGBA_vert,fragmentShader:R_.distanceRGBA_frag},shadow:{uniforms:ow.merge([F_.lights,F_.fog,{color:{value:new ay(0)},opacity:{value:1}}]),vertexShader:R_.shadow_vert,fragmentShader:R_.shadow_frag}};k_.physical={uniforms:ow.merge([k_.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:R_.meshphysical_vert,fragmentShader:R_.meshphysical_frag};function U_(e,t,r){var n=r||B_.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function B_(e,t,r){this.path=t,this.parsedPath=r||B_.parseTrackName(t),this.node=B_.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(U_.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(B_,{Composite:U_,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new B_.Composite(e,t,r):new B_(e,t,r)},sanitizeNodeName:function(){var e=new RegExp("[\\[\\]\\.:\\/]","g");return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^\\[\\]\\.:\\/]",t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",e),n=/(WCOD+)?/.source.replace("WCOD",t),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e),s=new RegExp("^"+r+n+i+o+"$"),a=["material","materials","bones"];return function(e){var t=s.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==a.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var o=n(i.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(B_.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=B_.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(void 0===e[r])return void console.error("PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==o){if(void 0===e[o])return void console.error("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var a=e[n];if(void 0!==a){var l=this.Versioning.None;void 0!==e.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(e.geometry.morphAttributes.position[s].name===i){i=s;break}}else{if(!e.geometry.morphTargets)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===i){i=s;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("PropertyBinding: Trying to update property for track: "+u+"."+n+" but it wasn't found.",e)}}else console.error("PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(B_.prototype,{_getValue_unbound:B_.prototype.getValue,_setValue_unbound:B_.prototype.setValue});var j_={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},z_={1003:j_.NEAREST,1004:j_.NEAREST_MIPMAP_NEAREST,1005:j_.NEAREST_MIPMAP_LINEAR,1006:j_.LINEAR,1007:j_.LINEAR_MIPMAP_NEAREST,1008:j_.LINEAR_MIPMAP_LINEAR},V_={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},G_=function(){};G_.prototype={constructor:G_,parse:function(e,t,r){(r=Object.assign({},{trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1},r)).animations.length>0&&(r.trs=!0);var n,i={asset:{version:"2.0",generator:"GLTFExporter"}},o=0,s=[],a=[],l=new Map,c=[],u={},h={materials:new Map,textures:new Map};function d(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function p(e){return 4*Math.ceil(e/4)}function f(e,t){t=t||0;var r=p(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}function m(e){return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}function v(e,t,n,s){i.accessors||(i.accessors=[]);var a;if(e.array.constructor===Float32Array)a=j_.FLOAT;else if(e.array.constructor===Uint32Array)a=j_.UNSIGNED_INT;else{if(e.array.constructor!==Uint16Array)throw new Error("GLTFExporter: Unsupported bufferAttribute component type.");a=j_.UNSIGNED_SHORT}if(void 0===n&&(n=0),void 0===s&&(s=e.count),r.truncateDrawRange&&void 0!==t&&null===t.index){var l=n+s,c=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),(s=Math.min(l,c)-n)<0&&(s=0)}var u,h=function(e,t,r){for(var n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+r;i++)for(var o=0;o<e.itemSize;o++){var s=e.array[i*e.itemSize+o];n.min[o]=Math.min(n.min[o],s),n.max[o]=Math.max(n.max[o],s)}return n}(e,n,s);void 0!==t&&(u=e===t.index?j_.ELEMENT_ARRAY_BUFFER:j_.ARRAY_BUFFER);var d=function(e,t,r,n,s){i.bufferViews||(i.bufferViews=[]);for(var a=t===j_.UNSIGNED_SHORT?2:4,l=p(n*e.itemSize*a),c=new DataView(new ArrayBuffer(l)),u=0,h=r;h<r+n;h++)for(var d=0;d<e.itemSize;d++){var f=e.array[h*e.itemSize+d];t===j_.FLOAT?c.setFloat32(u,f,!0):t===j_.UNSIGNED_INT?c.setUint32(u,f,!0):t===j_.UNSIGNED_SHORT&&c.setUint16(u,f,!0),u+=a}var v={buffer:m(c.buffer),byteOffset:o,byteLength:l};return void 0!==s&&(v.target=s),s===j_.ARRAY_BUFFER&&(v.byteStride=e.itemSize*a),o+=l,i.bufferViews.push(v),{id:i.bufferViews.length-1,byteLength:0}}(e,a,n,s,u),f={bufferView:d.id,byteOffset:d.byteOffset,componentType:a,count:s,max:h.max,min:h.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return i.accessors.push(f),i.accessors.length-1}function g(e){i.images||(i.images=[]);var t=e.format===Hx?"image/png":"image/jpeg",s={mimeType:t};if(r.embedImages){var l=n=n||document.createElement("canvas");l.width=e.image.width,l.height=e.image.height,r.forcePowerOfTwoTextures&&!function(e){return Zg.isPowerOfTwo(e.width)&&Zg.isPowerOfTwo(e.height)}(e.image)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e.image),l.width=Zg.floorPowerOfTwo(l.width),l.height=Zg.floorPowerOfTwo(l.height));var c=l.getContext("2d");!0===e.flipY&&(c.translate(0,l.height),c.scale(1,-1)),c.drawImage(e.image,0,0,l.width,l.height),!0===r.binary?a.push(new Promise(function(e){l.toBlob(function(t){(function(e){return i.bufferViews||(i.bufferViews=[]),new Promise(function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=f(r.result),n={buffer:m(e),byteOffset:o,byteLength:e.byteLength};o+=e.byteLength,i.bufferViews.push(n),t(i.bufferViews.length-1)}})})(t).then(function(t){s.bufferView=t,e()})},t)})):s.uri=l.toDataURL(t)}else s.uri=e.image.src;return i.images.push(s),i.images.length-1}function y(e){if(h.textures.has(e))return h.textures.get(e);i.textures||(i.textures=[]);var t={sampler:function(e){i.samplers||(i.samplers=[]);var t={magFilter:z_[e.magFilter],minFilter:z_[e.minFilter],wrapS:z_[e.wrapS],wrapT:z_[e.wrapT]};return i.samplers.push(t),i.samplers.length-1}(e),source:g(e)};i.textures.push(t);var r=i.textures.length-1;return h.textures.set(e,r),r}function x(e){if(h.materials.has(e))return h.materials.get(e);if(i.materials||(i.materials=[]),e.isShaderMaterial)return console.warn("GLTFExporter: ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},u.KHR_materials_unlit=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(d(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),(e.metalnessMap||e.roughnessMap)&&(e.metalnessMap===e.roughnessMap?t.pbrMetallicRoughness.metallicRoughnessTexture={index:y(e.metalnessMap)}:console.warn("GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.")),e.map&&(t.pbrMetallicRoughness.baseColorTexture={index:y(e.map)}),e.isMeshBasicMaterial||e.isLineBasicMaterial||e.isPointsMaterial);else{var n=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();d(n,[0,0,0])||(t.emissiveFactor=n),e.emissiveMap&&(t.emissiveTexture={index:y(e.emissiveMap)})}e.normalMap&&(t.normalTexture={index:y(e.normalMap)},-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),t.normalTexture.scale=e.normalScale.x)),e.aoMap&&(t.occlusionTexture={index:y(e.aoMap)},1!==e.aoMapIntensity&&(t.occlusionTexture.strength=e.aoMapIntensity)),(e.transparent||e.alphaTest>0)&&(t.alphaMode=e.opacity<1?"BLEND":"MASK",e.alphaTest>0&&.5!==e.alphaTest&&(t.alphaCutoff=e.alphaTest)),e.side===ky&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),i.materials.push(t);var o=i.materials.length-1;return h.materials.set(e,o),o}function b(e,t){i.animations||(i.animations=[]);for(var r=[],n=[],o=0;o<e.tracks.length;++o){var s=e.tracks[o],a=B_.parseTrackName(s.name),c=B_.findNode(t,a.nodeName),u=V_[a.propertyName];if("bones"===a.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(a.objectIndex):void 0),!c||!u)return console.warn('GLTFExporter: Could not export animation track "%s".',s.name),null;var h,d=s.values.length/s.times.length;u===V_.morphTargetInfluences&&(d/=c.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=s.getInterpolation()===ob?"STEP":"LINEAR",n.push({input:v(new my(s.times,1)),output:v(new my(s.values,d)),interpolation:h}),r.push({sampler:n.length-1,target:{node:l.get(c),path:u}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:n,channels:r}),i.animations.length-1}function w(e){var t=i.nodes[l.get(e)],r=e.skeleton,n=e.skeleton.bones[0];if(void 0===n)return null;for(var o=[],s=new Float32Array(16*r.bones.length),a=0;a<r.bones.length;++a)o.push(l.get(r.bones[a])),r.boneInverses[a].toArray(s,16*a);return void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:v(new my(s,16)),joints:o,skeleton:l.get(n)}),t.skin=i.skins.length-1}function _(e){if(e.isLight)return console.warn("GLTFExporter: Unsupported node type:",e.constructor.name),null;i.nodes||(i.nodes=[]);var t={};if(r.trs){var n=e.quaternion.toArray(),o=e.position.toArray(),s=e.scale.toArray();d(n,[0,0,0,1])||(t.rotation=n),d(o,[0,0,0])||(t.translation=o),d(s,[1,1,1])||(t.scale=s)}else e.updateMatrix(),d(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),e.userData&&Object.keys(e.userData).length>0)try{t.extras=JSON.parse(JSON.stringify(e.userData))}catch(e){throw new Error("GLTFExporter: userData can't be serialized")}if(e.isMesh||e.isLine||e.isPoints?t.mesh=function(e){i.meshes||(i.meshes=[]);var t,n=e.geometry;if(e.isLineSegments)t=j_.LINES;else if(e.isLineLoop)t=j_.LINE_LOOP;else if(e.isLine)t=j_.LINE_STRIP;else if(e.isPoints)t=j_.POINTS;else{if(!n.isBufferGeometry){var o=new Cy;o.fromGeometry(n),n=o}e.drawMode===cb?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),t=j_.TRIANGLE_FAN):t=e.drawMode===lb?e.material.wireframe?j_.LINE_STRIP:j_.TRIANGLE_STRIP:e.material.wireframe?j_.LINES:j_.TRIANGLES}var s={},a={},l=[],c=[],u={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"};for(var h in n.attributes){var d=n.attributes[h];"MORPH"!==(h=u[h]||h.toUpperCase()).substr(0,5)&&(a[h]=v(d,n))}if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var p=[],f=[],m={};if(void 0!==e.morphTargetDictionary)for(var g in e.morphTargetDictionary)m[e.morphTargetDictionary[g]]=g;for(var y=0;y<e.morphTargetInfluences.length;++y){var b={},w=!1;for(var h in n.morphAttributes)if("position"===h||"normal"===h){d=n.morphAttributes[h][y];for(var _=n.attributes[h],S=d.clone(),T=0,M=d.count;T<M;T++)S.setXYZ(T,d.getX(T)-_.getX(T),d.getY(T)-_.getY(T),d.getZ(T)-_.getZ(T));b[h.toUpperCase()]=v(S,n)}else w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);c.push(b),p.push(e.morphTargetInfluences[y]),void 0!==e.morphTargetDictionary&&f.push(m[y])}s.weights=p,f.length>0&&(s.extras={},s.extras.targetNames=f)}var A=r.forceIndices,E=Array.isArray(e.material);!A&&null===n.index&&E&&(console.warn("GLTFExporter: Creating index for non-indexed multi-material mesh."),A=!0);var C=!1;if(null===n.index&&A){for(var P=[],O=(y=0,n.attributes.position.count);y<O;y++)P[y]=y;n.setIndex(P),C=!0}var D=E?e.material:[e.material],N=E?e.geometry.groups:[{materialIndex:0,start:void 0,count:void 0}];for(y=0,O=N.length;y<O;y++){var L={mode:t,attributes:a};c.length>0&&(L.targets=c);var I=x(D[N[y].materialIndex]);null!==I&&(L.material=I),null!==n.index&&(L.indices=v(n.index,n,N[y].start,N[y].count)),l.push(L)}return C&&n.setIndex(null),s.primitives=l,i.meshes.push(s),i.meshes.length-1}(e):e.isCamera&&(t.camera=function(e){i.cameras||(i.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:Zg.degToRad(e.fov)/e.aspect,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),i.cameras.push(r),i.cameras.length-1}(e)),e.isSkinnedMesh&&c.push(e),e.children.length>0){for(var a=[],u=0,h=e.children.length;u<h;u++){var p=e.children[u];if(p.visible||!1===r.onlyVisible){var f=_(p);null!==f&&a.push(f)}}a.length>0&&(t.children=a)}i.nodes.push(t);var m=i.nodes.length-1;return l.set(e,m),m}function S(e){i.scenes||(i.scenes=[],i.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),i.scenes.push(t);for(var n=[],o=0,s=e.children.length;o<s;o++){var a=e.children[o];if(a.visible||!1===r.onlyVisible){var l=_(a);null!==l&&n.push(l)}}n.length>0&&(t.nodes=n)}!function(e){e=e instanceof Array?e:[e];for(var t=[],n=0;n<e.length;n++)e[n]instanceof ew?S(e[n]):t.push(e[n]);for(t.length>0&&function(e){var t=new ew;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);S(t)}(t),n=0;n<c.length;++n)w(c[n]);for(n=0;n<r.animations.length;++n)b(r.animations[n],e[0])}(e),Promise.all(a).then(function(){var e=new Blob(s,{type:"application/octet-stream"}),n=Object.keys(u);if(n.length>0&&(i.extensionsUsed=n),i.buffers&&i.buffers.length>0){i.buffers[0].byteLength=e.size;var o=new window.FileReader;if(!0===r.binary){o.readAsArrayBuffer(e),o.onloadend=function(){var e=f(o.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var n=f(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);t[r]=i>255?32:i}return t.buffer}(JSON.stringify(i)),32),s=new DataView(new ArrayBuffer(8));s.setUint32(0,n.byteLength,!0),s.setUint32(4,1313821514,!0);var a=new ArrayBuffer(12),l=new DataView(a);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);var c=12+s.byteLength+n.byteLength+r.byteLength+e.byteLength;l.setUint32(8,c,!0);var u=new Blob([a,s,n,r,e],{type:"application/octet-stream"}),h=new window.FileReader;h.readAsArrayBuffer(u),h.onloadend=function(){t(h.result)}}}else o.readAsDataURL(e),o.onloadend=function(){var e=o.result;i.buffers[0].uri=e,t(i)}}else t(i)})}};var H_=function(){};H_.prototype={constructor:H_,parse:function(e){var t,r,n,i,o,s="",a=0,l=0,c=0,u=new Kg,h=new Kg,d=new hy,p=[];return e.traverse(function(e){e instanceof Mb&&function(e){var n=0,f=0,m=0,v=e.geometry,g=new ny;if(v instanceof py&&(v=(new Cy).setFromObject(e)),v instanceof Cy){var y=v.getAttribute("position"),x=v.getAttribute("normal"),b=v.getAttribute("uv"),w=v.getIndex();if(s+="o "+e.name+"\n",e.material&&e.material.name&&(s+="usemtl "+e.material.name+"\n"),void 0!==y)for(t=0,i=y.count;t<i;t++,n++)u.x=y.getX(t),u.y=y.getY(t),u.z=y.getZ(t),u.applyMatrix4(e.matrixWorld),s+="v "+u.x+" "+u.y+" "+u.z+"\n";if(void 0!==b)for(t=0,i=b.count;t<i;t++,m++)d.x=b.getX(t),d.y=b.getY(t),s+="vt "+d.x+" "+d.y+"\n";if(void 0!==x)for(g.getNormalMatrix(e.matrixWorld),t=0,i=x.count;t<i;t++,f++)h.x=x.getX(t),h.y=x.getY(t),h.z=x.getZ(t),h.applyMatrix3(g),s+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==w)for(t=0,i=w.count;t<i;t+=3){for(o=0;o<3;o++)r=w.getX(t+o)+1,p[o]=a+r+(x||b?"/"+(b?l+r:"")+(x?"/"+(c+r):""):"");s+="f "+p.join(" ")+"\n"}else for(t=0,i=y.count;t<i;t+=3){for(o=0;o<3;o++)r=t+o+1,p[o]=a+r+(x||b?"/"+(b?l+r:"")+(x?"/"+(c+r):""):"");s+="f "+p.join(" ")+"\n"}}else console.warn("OBJExporter.parseMesh(): geometry type unsupported",v);a+=n,l+=m,c+=f}(e),e instanceof Ab&&function(e){var o=0,l=e.geometry,c=e.type;if(l instanceof py&&(l=(new Cy).setFromObject(e)),l instanceof Cy){var h=l.getAttribute("position");if(s+="o "+e.name+"\n",void 0!==h)for(t=0,i=h.count;t<i;t++,o++)u.x=h.getX(t),u.y=h.getY(t),u.z=h.getZ(t),u.applyMatrix4(e.matrixWorld),s+="v "+u.x+" "+u.y+" "+u.z+"\n";if("Line"===c){for(s+="l ",r=1,i=h.count;r<=i;r++)s+=a+r+" ";s+="\n"}if("LineSegments"===c)for(n=1+(r=1),i=h.count;r<i;n=(r+=2)+1)s+="l "+(a+r)+" "+(a+n)+"\n"}else console.warn("OBJExporter.parseLine(): geometry type unsupported",l);a+=o}(e)}),s}};var W_=function(){};W_.prototype={constructor:W_,parse:function(e,t){!0!==Array.isArray(t)&&(t=[]);var r=-1===t.indexOf("normal"),n=-1===t.indexOf("color"),i=-1===t.indexOf("uv"),o=0,s=0,a="",l="",c=new Kg,u=new ny;e.traverse(function(e){if(e instanceof Mb){var t=e,h=t.geometry;if(h instanceof py&&(h=(new Cy).setFromObject(t)),h instanceof Cy){var d=h.getAttribute("position"),p=h.getAttribute("normal"),f=h.getAttribute("uv"),m=h.getAttribute("color"),v=h.getIndex();if(u.getNormalMatrix(t.matrixWorld),void 0===d)return;for(y=0,x=d.count;y<x;y++){c.x=d.getX(y),c.y=d.getY(y),c.z=d.getZ(y),c.applyMatrix4(t.matrixWorld);var g=c.x+" "+c.y+" "+c.z;!0===r&&(void 0!==p?(c.x=p.getX(y),c.y=p.getY(y),c.z=p.getZ(y),c.applyMatrix3(u),g+=" "+c.x+" "+c.y+" "+c.z):g+=" 0 0 0"),!0===i&&(void 0!==f?g+=" "+f.getX(y)+" "+f.getY(y):!1!==i&&(g+=" 0 0")),!0===n&&(g+=void 0!==m?" "+Math.floor(m.getX(y))+" "+Math.floor(m.getY(y))+" "+Math.floor(m.getZ(y)):" 255 255 255"),a+=g+"\n"}if(null!==v)for(y=0,x=v.count;y<x;y+=3)l+="3 "+(v.getX(y+0)+o),l+=" "+(v.getX(y+1)+o),l+=" "+(v.getX(y+2)+o)+"\n";else for(var y=0,x=d.count;y<x;y+=3)l+="3 "+(o+y)+" "+(o+y+1)+" "+(o+y+2)+"\n";o+=d.count,s+=v?v.count/3:d.count/3}}});var h="ply\nformat ascii 1.0\nelement vertex "+o+"\nproperty float x\nproperty float y\nproperty float z\n";return!0===r&&(h+="property float nx\nproperty float ny\nproperty float nz\n"),!0===i&&(h+="property float s\nproperty float t\n"),!0===n&&(h+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),h+="element face "+s+"\nproperty list uchar int vertex_index\nend_header\n"+a+"\n"+l+"\n"}};var X_=function(){};X_.prototype={constructor:X_,parse:function(){var e=new Kg,t=new ny;return function(r){var n=[],i=0;r.traverse(function(e){if(e instanceof Mb){var t=e.geometry;t instanceof Cy&&(t=(new py).fromBufferGeometry(t)),t instanceof py&&(i+=t.faces.length,n.push({geometry:t,matrix:e.matrixWorld}))}});var o=80,s=new ArrayBuffer(2*i+3*i*4*4+80+4),a=new DataView(s);return a.setUint32(o,i,!0),o+=4,n.forEach(function(r){var n=r.geometry.vertices,i=r.geometry.faces;t.getNormalMatrix(r.matrix);for(var s=0,l=i.length;s<l;s++){var c=i[s];e.copy(c.normal).applyMatrix3(t).normalize(),a.setFloat32(o,e.x,!0),o+=4,a.setFloat32(o,e.y,!0),o+=4,a.setFloat32(o,e.z,!0),o+=4;for(var u=[c.a,c.b,c.c],h=0;h<3;h++)e.copy(n[u[h]]).applyMatrix4(r.matrix),a.setFloat32(o,e.x,!0),o+=4,a.setFloat32(o,e.y,!0),o+=4,a.setFloat32(o,e.z,!0),o+=4;a.setUint16(o,0,!0),o+=2}}),a}}()};var q_=function(){};q_.prototype={constructor:q_,parse:function(){var e=new Kg,t=new ny;return function(r){var n="";return n+="solid exported\n",r.traverse(function(r){if(r instanceof Mb){var i=r.geometry,o=r.matrixWorld;if(i instanceof Cy&&(i=(new py).fromBufferGeometry(i)),i instanceof py){var s=i.vertices,a=i.faces;t.getNormalMatrix(o);for(var l=0,c=a.length;l<c;l++){var u=a[l];e.copy(u.normal).applyMatrix3(t).normalize(),n+="\tfacet normal "+e.x+" "+e.y+" "+e.z+"\n",n+="\t\touter loop\n";for(var h=[u.a,u.b,u.c],d=0;d<3;d++)e.copy(s[h[d]]).applyMatrix4(o),n+="\t\t\tvertex "+e.x+" "+e.y+" "+e.z+"\n";n+="\t\tendloop\n",n+="\tendfacet\n"}}}}),n+="endsolid exported\n"}}()};var Y_=function(){};function J_(e,t,r,n){Cy.call(this);var i=[],o=[],s=[],a=new Kg,l=new Qg;l.makeRotationFromEuler(r),l.setPosition(t);var c=(new Qg).getInverse(l);function u(t,r,n){r.applyMatrix4(e.matrix),r.applyMatrix4(c),t.push(new Z_(r.clone(),n.clone()))}function h(e,t){for(var r=[],i=.5*Math.abs(n.dot(t)),o=0;o<e.length;o+=3){var s,a,l,c,u,h,p,f=e[o+0].position.dot(t)-i;switch(a=e[o+1].position.dot(t)-i>0,l=e[o+2].position.dot(t)-i>0,((s=f>0)?1:0)+(a?1:0)+(l?1:0)){case 0:r.push(e[o]),r.push(e[o+1]),r.push(e[o+2]);break;case 1:if(s&&(c=e[o+1],u=e[o+2],h=d(e[o],c,t,i),p=d(e[o],u,t,i)),a){c=e[o],u=e[o+2],h=d(e[o+1],c,t,i),p=d(e[o+1],u,t,i),r.push(h),r.push(u.clone()),r.push(c.clone()),r.push(u.clone()),r.push(h.clone()),r.push(p);break}l&&(c=e[o],u=e[o+1],h=d(e[o+2],c,t,i),p=d(e[o+2],u,t,i)),r.push(c.clone()),r.push(u.clone()),r.push(h),r.push(p),r.push(h.clone()),r.push(u.clone());break;case 2:s||(u=d(c=e[o].clone(),e[o+1],t,i),h=d(c,e[o+2],t,i),r.push(c),r.push(u),r.push(h)),a||(u=d(c=e[o+1].clone(),e[o+2],t,i),h=d(c,e[o],t,i),r.push(c),r.push(u),r.push(h)),l||(u=d(c=e[o+2].clone(),e[o],t,i),h=d(c,e[o+1],t,i),r.push(c),r.push(u),r.push(h))}}return r}function d(e,t,r,n){var i=e.position.dot(r)-n,o=i/(i-(t.position.dot(r)-n));return new Z_(new Kg(e.position.x+o*(t.position.x-e.position.x),e.position.y+o*(t.position.y-e.position.y),e.position.z+o*(t.position.z-e.position.z)),new Kg(e.normal.x+o*(t.normal.x-e.normal.x),e.normal.y+o*(t.normal.y-e.normal.y),e.normal.z+o*(t.normal.z-e.normal.z)))}!function(){var t,r=new Cy,c=[],d=new Kg,p=new Kg;e.geometry.isGeometry?r.fromGeometry(e.geometry):r.copy(e.geometry);var f=r.attributes.position,m=r.attributes.normal;if(null!==r.index){var v=r.index;for(t=0;t<v.count;t++)d.fromBufferAttribute(f,v.getX(t)),p.fromBufferAttribute(m,v.getX(t)),u(c,d,p)}else for(t=0;t<f.count;t++)d.fromBufferAttribute(f,t),p.fromBufferAttribute(m,t),u(c,d,p);for(c=h(c=h(c=h(c=h(c=h(c=h(c,a.set(1,0,0)),a.set(-1,0,0)),a.set(0,1,0)),a.set(0,-1,0)),a.set(0,0,1)),a.set(0,0,-1)),t=0;t<c.length;t++){var g=c[t];s.push(.5+g.position.x/n.x,.5+g.position.y/n.y),g.position.applyMatrix4(l),i.push(g.position.x,g.position.y,g.position.z),o.push(g.normal.x,g.normal.y,g.normal.z)}}(),this.addAttribute("position",new Sy(i,3)),this.addAttribute("normal",new Sy(o,3)),this.addAttribute("uv",new Sy(s,2))}function Z_(e,t){this.position=e,this.normal=t}Y_.prototype={constructor:Y_,parse:function(e){var t={metadata:{version:4,type:"TypedGeometry",generator:"TypedGeometryExporter"}},r=["vertices","normals","uvs"];for(var n in r){for(var i=r[n],o=e[i],s=[],a=0,l=o.length;a<l;a++)s[a]=o[a];t[i]=s}var c=e.boundingSphere;return null!==c&&(t.boundingSphere={center:c.center.toArray(),radius:c.radius}),t}},J_.prototype=Object.create(Cy.prototype),J_.prototype.constructor=J_,Z_.prototype.clone=function(){return new Z_(this.position.clone(),this.normal.clone())};var Q_=function(e,t,r,n,i,o,s){var a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],l=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];Cy.call(this),e=e||50,t=void 0!==t?Math.max(2,Math.floor(t)||10):10,r=void 0===r||r,n=void 0===n||n,i=void 0===i||i,o=void 0===o||o;var c=3.15*((s=void 0===s||s)?1:1.3)/2,u=e/c,h=r?(8*t-4)*t:0;h+=n?(16*t-4)*t:0,h+=i?40*t*t:0;var d=new Uint32Array(3*h),p=r?4:0;p+=n?8:0,p+=i?20:0,p*=(t+1)*(t+1);var f=new Float32Array(3*p),m=new Float32Array(3*p),v=new Float32Array(2*p),g=new Qg;g.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var y,x,b,w,_,S,T,M,A,E,C,P,O,D,N,L,I=[],R=[],F=[],k=[],U=[],B=[],j=[],z=[],V=[],G=new Kg,H=0,W=0,X=new Kg,q=new Qg,Y=new Qg,J=new fy,Z=new fy,Q=new fy,K=new fy,$=new Kg,ee=new Kg,te=g.clone();te.transpose();var re=function(e,t,r){return!(f[3*e]===f[3*t]&&f[3*e+1]===f[3*t+1]&&f[3*e+2]===f[3*t+2]||f[3*e]===f[3*r]&&f[3*e+1]===f[3*r+1]&&f[3*e+2]===f[3*r+2]||f[3*t]===f[3*r]&&f[3*t+1]===f[3*r+1]&&f[3*t+2]===f[3*r+2])};for(y=0;y<3;y++)B[y]=new Qg;var ne=r?32:28;T=t+1;for(var ie=0,oe=0,se=0,ae=0,le=0,ce=i?0:20;ce<ne;ce++)if(n||ce<20||ce>=28){for(y=0;y<3;y++){for(x=0;x<4;x++)for(b=0;b<4;b++)I[4*b+x]=l[3*a[16*ce+4*x+b]+y],o&&ce>=20&&ce<28&&2!==y&&(I[4*b+x]*=1.077),s||2!==y||(I[4*b+x]*=1.3);q.set(I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15]),Y.multiplyMatrices(q,g),B[y].multiplyMatrices(te,Y)}for(_=0;_<=t;_++)for(M=_/t,S=0;S<=t;S++){for(A=S/t,P=4,E=C=1;P--;)R[P]=E,F[P]=C,E*=M,C*=A,3===P?(k[P]=U[P]=0,H=W=1):(k[P]=H*(3-P),U[P]=W*(3-P),H*=M,W*=A);for(J.fromArray(R),Z.fromArray(F),Q.fromArray(k),K.fromArray(U),y=0;y<3;y++)(w=J.clone()).applyMatrix4(B[y]),j[y]=w.dot(Z),(w=Q.clone()).applyMatrix4(B[y]),z[y]=w.dot(Z),(w=J.clone()).applyMatrix4(B[y]),V[y]=w.dot(K);$.fromArray(z),ee.fromArray(V),G.crossVectors(ee,$),G.normalize(),0===j[0]&&0===j[1]?X.set(0,j[2]>c?1:-1,0):X.set(G.x,G.z,-G.y),f[oe++]=u*j[0],f[oe++]=u*(j[2]-c),f[oe++]=-u*j[1],m[se++]=X.x,m[se++]=X.y,m[se++]=X.z,v[ae++]=1-A,v[ae++]=1-M}for(_=0;_<t;_++)for(S=0;S<t;S++)L=(O=ie*T*T+_*T+S)+T,re(O,D=O+1,N=D+T)&&(d[le++]=O,d[le++]=D,d[le++]=N),re(O,N,L)&&(d[le++]=O,d[le++]=N,d[le++]=L);ie++}this.setIndex(new my(d,1)),this.addAttribute("position",new my(f,3)),this.addAttribute("normal",new my(m,3)),this.addAttribute("uv",new my(v,2)),this.computeBoundingSphere()};function K_(e,t,r,n,i,o,s,a,l,c,u,h){nw.call(this,null,o,s,a,l,c,n,i,u,h),this.image={data:e,width:t,height:r},this.magFilter=void 0!==l?l:Cx,this.minFilter=void 0!==c?c:Cx,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function $_(e,t){oy.call(this),this.type="Points",this.geometry=void 0!==e?e:new Cy,this.material=void 0!==t?t:new Tw({color:16777215*Math.random()})}Q_.prototype=Object.create(Cy.prototype),Q_.prototype.constructor=Q_,K_.prototype=Object.create(nw.prototype),K_.prototype.constructor=K_,K_.prototype.isDataTexture=!0,$_.prototype=Object.assign(Object.create(oy.prototype),{constructor:$_,isPoints:!0,raycast:function(){var e=new Qg,t=new wb,r=new uy;return function(n,i){var o=this,s=this.geometry,a=this.matrixWorld,l=n.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(a),r.radius+=l,!1!==n.ray.intersectsSphere(r)){e.getInverse(a),t.copy(n.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Kg,d=new Kg;if(s.isBufferGeometry){var p=s.index,f=s.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var x=f.length/3;v<x;v++)h.fromArray(f,3*v),w(h,v)}}else{var b=s.vertices;for(v=0,x=b.length;v<x;v++)w(b[v],v)}}function w(e,r){var s=t.distanceSqToPoint(e);if(s<u){t.closestPointToPoint(e,d),d.applyMatrix4(a);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(s),point:d.clone(),index:r,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var eS=function(e){oy.apply(this,arguments),e=e||{},this.PARTICLE_COUNT=e.maxParticles||1e6,this.PARTICLE_CONTAINERS=e.containerCount||1,this.PARTICLE_NOISE_TEXTURE=e.particleNoiseTex||null,this.PARTICLE_SPRITE_TEXTURE=e.particleSpriteTex||null,this.PARTICLES_PER_CONTAINER=Math.ceil(this.PARTICLE_COUNT/this.PARTICLE_CONTAINERS),this.PARTICLE_CURSOR=0,this.time=0,this.particleContainers=[],this.rand=[];var t,r={vertexShader:["uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec3 positionStart;","attribute float startTime;","attribute vec3 velocity;","attribute float turbulence;","attribute vec3 color;","attribute float size;","attribute float lifeTime;","varying vec4 vColor;","varying float lifeLeft;","void main() {","\tvColor = vec4( color, 1.0 );","\tvec3 newPosition;","\tvec3 v;","\tfloat timeElapsed = uTime - startTime;","\tlifeLeft = 1.0 - ( timeElapsed / lifeTime );","\tgl_PointSize = ( uScale * size ) * lifeLeft;","\tv.x = ( velocity.x - 0.5 ) * 3.0;","\tv.y = ( velocity.y - 0.5 ) * 3.0;","\tv.z = ( velocity.z - 0.5 ) * 3.0;","\tnewPosition = positionStart + ( v * 10.0 ) * timeElapsed;","\tvec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;","\tvec3 noiseVel = ( noise.rgb - 0.5 ) * 30.0;","\tnewPosition = mix( newPosition, newPosition + vec3( noiseVel * ( turbulence * 5.0 ) ), ( timeElapsed / lifeTime ) );","\tif( v.y > 0. && v.y < .05 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( v.x < - 1.45 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( timeElapsed > 0.0 ) {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","\t} else {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\t\tlifeLeft = 0.0;","\t\tgl_PointSize = 0.;","\t}","}"].join("\n"),fragmentShader:["float scaleLinear( float value, vec2 valueDomain ) {","\treturn ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );","}","float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {","\treturn mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","\tfloat alpha = 0.;","\tif( lifeLeft > 0.995 ) {","\t\talpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );","\t} else {","\t\talpha = lifeLeft * 0.75;","\t}","\tvec4 tex = texture2D( tSprite, gl_PointCoord );","\tgl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")};for(t=1e5;t>0;t--)this.rand.push(Math.random()-.5);this.random=function(){return++t>=this.rand.length?this.rand[t=1]:this.rand[t]};var n=new Ow;this.particleNoiseTex=this.PARTICLE_NOISE_TEXTURE||n.load("textures/perlin-512.png"),this.particleNoiseTex.wrapS=this.particleNoiseTex.wrapT=Mx,this.particleSpriteTex=this.PARTICLE_SPRITE_TEXTURE||n.load("textures/particle2.png"),this.particleSpriteTex.wrapS=this.particleSpriteTex.wrapT=Mx,this.particleShaderMat=new sw({transparent:!0,depthWrite:!1,uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:this.particleNoiseTex},tSprite:{value:this.particleSpriteTex}},blending:Gy,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.particleShaderMat.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0],this.particleShaderMat.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0],this.init=function(){for(var e=0;e<this.PARTICLE_CONTAINERS;e++){var t=new tS(this.PARTICLES_PER_CONTAINER,this);this.particleContainers.push(t),this.add(t)}},this.spawnParticle=function(e){this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=1),this.particleContainers[Math.floor(this.PARTICLE_CURSOR/this.PARTICLES_PER_CONTAINER)].spawnParticle(e)},this.update=function(e){for(var t=0;t<this.PARTICLE_CONTAINERS;t++)this.particleContainers[t].update(e)},this.dispose=function(){this.particleShaderMat.dispose(),this.particleNoiseTex.dispose(),this.particleSpriteTex.dispose();for(var e=0;e<this.PARTICLE_CONTAINERS;e++)this.particleContainers[e].dispose()},this.init()};eS.prototype=Object.create(oy.prototype),eS.prototype.constructor=eS;var tS=function(e,t){oy.apply(this,arguments),this.PARTICLE_COUNT=e||1e5,this.PARTICLE_CURSOR=0,this.time=0,this.offset=0,this.count=0,this.DPR=window.devicePixelRatio,this.GPUParticleSystem=t,this.particleUpdate=!1,this.particleShaderGeo=new Cy,this.particleShaderGeo.addAttribute("position",new my(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("positionStart",new my(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("startTime",new my(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("velocity",new my(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("turbulence",new my(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("color",new my(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("size",new my(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("lifeTime",new my(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderMat=this.GPUParticleSystem.particleShaderMat;var r=new Kg,n=new Kg,i=new ay;this.spawnParticle=function(e){var o=this.particleShaderGeo.getAttribute("positionStart"),s=this.particleShaderGeo.getAttribute("startTime"),a=this.particleShaderGeo.getAttribute("velocity"),l=this.particleShaderGeo.getAttribute("turbulence"),c=this.particleShaderGeo.getAttribute("color"),u=this.particleShaderGeo.getAttribute("size"),h=this.particleShaderGeo.getAttribute("lifeTime");r=void 0!==(e=e||{}).position?r.copy(e.position):r.set(0,0,0),n=void 0!==e.velocity?n.copy(e.velocity):n.set(0,0,0),i=void 0!==e.color?i.set(e.color):i.set(16777215);var d=void 0!==e.positionRandomness?e.positionRandomness:0,p=void 0!==e.velocityRandomness?e.velocityRandomness:0,f=void 0!==e.colorRandomness?e.colorRandomness:1,m=void 0!==e.turbulence?e.turbulence:1,v=void 0!==e.lifetime?e.lifetime:5,g=void 0!==e.size?e.size:10,y=void 0!==e.sizeRandomness?e.sizeRandomness:0,x=void 0!==e.smoothPosition&&e.smoothPosition;void 0!==this.DPR&&(g*=this.DPR);var b=this.PARTICLE_CURSOR;o.array[3*b+0]=r.x+t.random()*d,o.array[3*b+1]=r.y+t.random()*d,o.array[3*b+2]=r.z+t.random()*d,!0===x&&(o.array[3*b+0]+=-n.x*t.random(),o.array[3*b+1]+=-n.y*t.random(),o.array[3*b+2]+=-n.z*t.random());var w=n.x+t.random()*p,_=n.y+t.random()*p,S=n.z+t.random()*p;w=Zg.clamp((w- -2)/4,0,1),_=Zg.clamp((_- -2)/4,0,1),S=Zg.clamp((S- -2)/4,0,1),a.array[3*b+0]=w,a.array[3*b+1]=_,a.array[3*b+2]=S,i.r=Zg.clamp(i.r+t.random()*f,0,1),i.g=Zg.clamp(i.g+t.random()*f,0,1),i.b=Zg.clamp(i.b+t.random()*f,0,1),c.array[3*b+0]=i.r,c.array[3*b+1]=i.g,c.array[3*b+2]=i.b,l.array[b]=m,u.array[b]=g+t.random()*y,h.array[b]=v,s.array[b]=this.time+.02*t.random(),0===this.offset&&(this.offset=this.PARTICLE_CURSOR),this.count++,this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=0),this.particleUpdate=!0},this.init=function(){this.particleSystem=new $_(this.particleShaderGeo,this.particleShaderMat),this.particleSystem.frustumCulled=!1,this.add(this.particleSystem)},this.update=function(e){this.time=e,this.particleShaderMat.uniforms.uTime.value=e,this.geometryUpdate()},this.geometryUpdate=function(){if(!0===this.particleUpdate){this.particleUpdate=!1;var e=this.particleShaderGeo.getAttribute("positionStart"),t=this.particleShaderGeo.getAttribute("startTime"),r=this.particleShaderGeo.getAttribute("velocity"),n=this.particleShaderGeo.getAttribute("turbulence"),i=this.particleShaderGeo.getAttribute("color"),o=this.particleShaderGeo.getAttribute("size"),s=this.particleShaderGeo.getAttribute("lifeTime");this.offset+this.count<this.PARTICLE_COUNT?(e.updateRange.offset=this.offset*e.itemSize,t.updateRange.offset=this.offset*t.itemSize,r.updateRange.offset=this.offset*r.itemSize,n.updateRange.offset=this.offset*n.itemSize,i.updateRange.offset=this.offset*i.itemSize,o.updateRange.offset=this.offset*o.itemSize,s.updateRange.offset=this.offset*s.itemSize,e.updateRange.count=this.count*e.itemSize,t.updateRange.count=this.count*t.itemSize,r.updateRange.count=this.count*r.itemSize,n.updateRange.count=this.count*n.itemSize,i.updateRange.count=this.count*i.itemSize,o.updateRange.count=this.count*o.itemSize,s.updateRange.count=this.count*s.itemSize):(e.updateRange.offset=0,t.updateRange.offset=0,r.updateRange.offset=0,n.updateRange.offset=0,i.updateRange.offset=0,o.updateRange.offset=0,s.updateRange.offset=0,e.updateRange.count=-1,t.updateRange.count=-1,r.updateRange.count=-1,n.updateRange.count=-1,i.updateRange.count=-1,o.updateRange.count=-1,s.updateRange.count=-1),e.needsUpdate=!0,t.needsUpdate=!0,r.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0,o.needsUpdate=!0,s.needsUpdate=!0,this.offset=0,this.count=0}},this.dispose=function(){this.particleShaderGeo.dispose()},this.init()};tS.prototype=Object.create(oy.prototype),tS.prototype.constructor=tS;var rS=function(){oy.call(this)};rS.prototype=Object.create(oy.prototype),rS.prototype.constructor=rS,rS.prototype.updateMatrixWorld=function(){var e=new Kg,t=new $g,r=new Kg,n=new Kg,i=new $g,o=new Kg;return function(s){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||s)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(n,i,o),this.matrix.decompose(e,t,r),this.matrixWorld.compose(n,t,o)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);for(var a=0,l=this.children.length;a<l;a++)this.children[a].updateMatrixWorld(s)}}();function nS(){Cy.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function iS(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function oS(e,t,r){iS.call(this,e,t),this.meshPerAttribute=r||1}function sS(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function aS(e){Cy.call(this),this.type="WireframeGeometry";var t,r,n,i,o,s,a,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var v=m[t];for(r=0;r<3;r++)a=v[f[r]],l=v[f[(r+1)%3]],d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)s=p[c],u=e.vertices[s.index1],h.push(u.x,u.y,u.z),u=e.vertices[s.index2],h.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var g,y,x,b,w,_,S;if(u=new Kg,null!==e.index){for(g=e.attributes.position,y=e.index,0===(x=e.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(t=w=(b=x[i]).start,n=w+b.count;t<n;t+=3)for(r=0;r<3;r++)a=y.getX(t+r),l=y.getX(t+(r+1)%3),d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)s=p[c],u.fromBufferAttribute(g,s.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,s.index2),h.push(u.x,u.y,u.z)}else for(t=0,n=(g=e.attributes.position).count/3;t<n;t++)for(r=0;r<3;r++)_=3*t+r,u.fromBufferAttribute(g,_),h.push(u.x,u.y,u.z),S=3*t+(r+1)%3,u.fromBufferAttribute(g,S),h.push(u.x,u.y,u.z)}this.addAttribute("position",new Sy(h,3))}nS.prototype=Object.assign(Object.create(Cy.prototype),{constructor:nS,isInstancedBufferGeometry:!0,copy:function(e){return Cy.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperty(iS.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(iS.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),oS.prototype=Object.assign(Object.create(iS.prototype),{constructor:oS,isInstancedInterleavedBuffer:!0,copy:function(e){return iS.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.defineProperties(sS.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(sS.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),aS.prototype=Object.create(Cy.prototype),aS.prototype.constructor=aS;var lS=function(){nS.call(this),this.type="LineSegmentsGeometry";new Cy;this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.addAttribute("position",new Sy([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.addAttribute("uv",new Sy([0,1,1,1,0,.5,1,.5,0,.5,1,.5,0,0,1,0],2))};lS.prototype=Object.assign(Object.create(nS.prototype),{constructor:lS,isLineSegmentsGeometry:!0,applyMatrix:function(e){var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(e.applyToBufferAttribute(t),e.applyToBufferAttribute(r),t.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var r=new oS(t,6,1);return this.addAttribute("instanceStart",new sS(r,3,0)),this.addAttribute("instanceEnd",new sS(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var r=new oS(t,6,1);return this.addAttribute("instanceColorStart",new sS(r,3,0)),this.addAttribute("instanceColorEnd",new sS(r,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new aS(e.geometry)),this},fromLineSegements:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},computeBoundingBox:function(){var e=new cy;return function(){null===this.boundingBox&&(this.boundingBox=new cy);var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;void 0!==t&&void 0!==r&&(this.boundingBox.setFromBufferAttribute(t),e.setFromBufferAttribute(r),this.boundingBox.union(e))}}(),computeBoundingSphere:function(){var e=new Kg;return function(){null===this.boundingSphere&&(this.boundingSphere=new uy),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(void 0!==t&&void 0!==r){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var i=0,o=0,s=t.count;o<s;o++)e.fromBufferAttribute(t,o),i=Math.max(i,n.distanceToSquared(e)),e.fromBufferAttribute(r,o),i=Math.max(i,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},clone:function(){},copy:function(e){return this}}),F_.line={linewidth:{value:1},resolution:{value:new hy(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},k_.line={uniforms:ow.merge([F_.common,F_.fog,F_.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) {\n\n\t\t\t\tfloat a = vUv.x - 0.5;\n\t\t\t\tfloat b = vUv.y - 0.5;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 0.25 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var cS=function(e){sw.call(this,{type:"LineMaterial",uniforms:ow.clone(k_.line.uniforms),vertexShader:k_.line.vertexShader,fragmentShader:k_.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};cS.prototype=Object.create(sw.prototype),cS.prototype.constructor=cS,cS.prototype.isLineMaterial=!0,cS.prototype.copy=function(e){return sw.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.resolution=e.resolution,this};var uS=function(e,t){Mb.call(this),this.type="LineSegments2",this.geometry=void 0!==e?e:new lS,this.material=void 0!==t?t:new cS({color:16777215*Math.random()})};uS.prototype=Object.assign(Object.create(Mb.prototype),{constructor:uS,isLineSegments2:!0,computeLineDistances:function(){var e=new Kg,t=new Kg;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=new Float32Array(2*n.data.count),s=0,a=0,l=n.data.count;s<l;s++,a+=2)e.fromBufferAttribute(n,s),t.fromBufferAttribute(i,s),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+e.distanceTo(t);var c=new oS(o,2,1);return r.addAttribute("instanceDistanceStart",new sS(c,1,0)),r.addAttribute("instanceDistanceEnd",new sS(c,1,1)),this}}(),copy:function(e){return this}});var hS=function(){lS.call(this),this.type="LineGeometry"};hS.prototype=Object.assign(Object.create(lS.prototype),{constructor:hS,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,r=new Float32Array(2*t),n=0;n<t;n+=3)r[2*n]=e[n],r[2*n+1]=e[n+1],r[2*n+2]=e[n+2],r[2*n+3]=e[n+3],r[2*n+4]=e[n+4],r[2*n+5]=e[n+5];return lS.prototype.setPositions.call(this,r),this},setColors:function(e){for(var t=e.length-3,r=new Float32Array(2*t),n=0;n<t;n+=3)r[2*n]=e[n],r[2*n+1]=e[n+1],r[2*n+2]=e[n+2],r[2*n+3]=e[n+3],r[2*n+4]=e[n+4],r[2*n+5]=e[n+5];return lS.prototype.setColors.call(this,r),this},fromLine:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},copy:function(e){return this}});var dS=function(e,t){uS.call(this),this.type="Line2",this.geometry=void 0!==e?e:new hS,this.material=void 0!==t?t:new cS({color:16777215*Math.random()})};dS.prototype=Object.assign(Object.create(uS.prototype),{constructor:dS,isLine2:!0,copy:function(e){return this}});var pS=function(e,t){Mb.call(this),this.type="Wireframe",this.geometry=void 0!==e?e:new lS,this.material=void 0!==t?t:new cS({color:16777215*Math.random()})};pS.prototype=Object.assign(Object.create(Mb.prototype),{constructor:pS,isWireframe:!0,computeLineDistances:function(){var e=new Kg,t=new Kg;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=new Float32Array(2*n.data.count),s=0,a=0,l=n.data.count;s<l;s++,a+=2)e.fromBufferAttribute(n,s),t.fromBufferAttribute(i,s),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+e.distanceTo(t);var c=new oS(o,2,1);return r.addAttribute("instanceDistanceStart",new sS(c,1,0)),r.addAttribute("instanceDistanceEnd",new sS(c,1,1)),this}}(),copy:function(e){return this}});var fS=function(e){lS.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new aS(e))};function mS(){oy.call(this),this.type="Group"}fS.prototype=Object.assign(Object.create(lS.prototype),{constructor:fS,isWireframeGeometry2:!0,copy:function(e){return this}}),mS.prototype=Object.assign(Object.create(oy.prototype),{constructor:mS,isGroup:!0});var vS=function(e){this.manager=void 0!==e?e:pw,this.availableExtensions=[]};vS.prototype={constructor:vS,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t=this;function r(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var n=e.getAttribute("pid");n&&(t.pid=n);var i=e.getAttribute("pindex");i&&(t.pindex=i);var o=e.getAttribute("thumbnail");o&&(t.thumbnail=o);var s=e.getAttribute("partnumber");s&&(t.partnumber=s);var a=e.getAttribute("name");a&&(t.name=a);var l=e.querySelector("mesh");l&&(t.mesh=function(e,t){for(var r={},n=[],i=e.querySelectorAll("vertices vertex"),o=0;o<i.length;o++){var s=i[o],a=s.getAttribute("x"),l=s.getAttribute("y"),c=s.getAttribute("z");n.push(parseFloat(a),parseFloat(l),parseFloat(c))}for(r.vertices=new Float32Array(n.length),o=0;o<n.length;o++)r.vertices[o]=n[o];var u=[],h=[],d=e.querySelectorAll("triangles triangle");for(o=0;o<d.length;o++){var p=d[o],f=p.getAttribute("v1"),m=p.getAttribute("v2"),v=p.getAttribute("v3"),g=p.getAttribute("p1"),y=p.getAttribute("p2"),x=p.getAttribute("p3"),b=p.getAttribute("pid");h.push(parseInt(f,10),parseInt(m,10),parseInt(v,10));var w={};g&&(w.p1=parseInt(g,10)),y&&(w.p2=parseInt(y,10)),x&&(w.p3=parseInt(x,10)),b&&(w.pid=b),0<Object.keys(w).length&&u.push(w)}for(r.triangleProperties=u,r.triangles=new Uint32Array(h.length),o=0;o<h.length;o++)r.triangles[o]=h[o];return r}(l));var c=e.querySelector("components");return c&&(t.components=void 0),t}function n(e){var t={unit:e.getAttribute("unit")||"millimeter"},n=e.querySelectorAll("metadata");n&&(t.metadata=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=n.textContent)}return t}(n));var i=e.querySelector("resources");i&&(t.resources=function(e){var t={},n=e.querySelector("basematerials");n&&(t.basematerial=void 0),t.object={};for(var i=e.querySelectorAll("object"),o=0;o<i.length;o++){var s=r(i[o]);t.object[s.id]=s}return t}(i));var o=e.querySelector("build");return o&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),n=0;n<r.length;n++){var i=r[n],o={objectid:i.getAttribute("objectid")},s=i.getAttribute("transform");if(s){var a=[];s.split(" ").forEach(function(e){a.push(parseFloat(e))});var l=new Qg;o.transform=l.set(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1)}t.push(o)}return t}(o)),t}function i(e,t){var r=new Cy;r.setIndex(new my(e.triangles,1)),r.addAttribute("position",new my(e.vertices,3)),e.colors&&r.addAttribute("color",new my(e.colors,3)),r.computeBoundingSphere();var n={flatShading:!0};return e.colors&&0<e.colors.length?n.vertexColors=jy:n.color=11184895,new Mb(r,new bw(n))}function o(e,r,n,i){if(e){for(var o=[],s=Object.keys(e),a=0;a<s.length;a++)for(var l=s[a],c=0;c<t.availableExtensions.length;c++){(u=t.availableExtensions[c]).ns===l&&o.push(u)}for(a=0;a<o.length;a++){var u;(u=o[a]).apply(n,e[u.ns],r)}}}var s=function(e){var t,r,i=null,o=null,s=[],a=[],l={},c={};try{i=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.error("ThreeMFLoader: jszip missing and file is compressed."),null}for(o in i.files)o.match(/\.rels$/)?t=o:o.match(/^3D\/.*\.model$/)?s.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)||(o.match(/^3D\/Textures\/.*/)?a.push(o):o.match(/^3D\/Other\/.*/));var u=new Uint8Array(i.file(t).asArrayBuffer());r=function(e){var t=(new DOMParser).parseFromString(e,"application/xml").querySelector("Relationship"),r=t.getAttribute("Target"),n=t.getAttribute("Id"),i=t.getAttribute("Type");return{target:r,id:n,type:i}}(Nw.decodeText(u));for(var h=0;h<s.length;h++){var d=s[h],p=new Uint8Array(i.file(d).asArrayBuffer()),f=Nw.decodeText(p),m=(new DOMParser).parseFromString(f,"application/xml");"model"!==m.documentElement.nodeName.toLowerCase()&&console.error("ThreeMFLoader: Error loading 3MF - no 3MF document found: ",d);var v=m.querySelector("model"),g={};for(h=0;h<v.attributes.length;h++){var y=v.attributes[h];y.name.match(/^xmlns:(.+)$/)&&(g[y.value]=RegExp.$1)}var x=n(v);x.xml=v,0<Object.keys(g).length&&(x.extensions=g),l[d]=x}for(h=0;h<a.length;h++){var b=a[h];c[b]=i.file(b).asBinary()}return{rels:r,model:l,printTicket:{},texture:c,other:{}}}(e);return function(e,t,r){for(var n=new mS,i=r.model[t.target.substring(1)].build,o=0;o<i.length;o++){var s=i[o],a=e[s.objectid];s.transform&&a.geometry.applyMatrix(s.transform),n.add(a)}return n}(function(e){for(var t=e.model,r={},n=Object.keys(t),s=0;s<n.length;s++)for(var a=t[n[s]],l=a.xml,c=a.extensions,u=Object.keys(a.resources.object),h=0;h<u.length;h++){var d=u[h],p=a.resources.object[d].mesh;o(c,p,l),r[d]=i(p)}return r}(s),s.rels,s)},addExtension:function(e){this.availableExtensions.push(e)}};var gS=function(e){this.manager=void 0!==e?e:pw};gS.prototype={constructor:gS,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){function t(e){for(var t="AMF Material",n=e.attributes.id.textContent,i={r:1,g:1,b:1,a:1},o=null,s=0;s<e.childNodes.length;s++){var a=e.childNodes[s];"metadata"===a.nodeName&&void 0!==a.attributes.type?"name"===a.attributes.type.value&&(t=a.textContent):"color"===a.nodeName&&(i=r(a))}return o=new bw({flatShading:!0,color:new ay(i.r,i.g,i.b),name:t}),1!==i.a&&(o.transparent=!0,o.opacity=i.a),{id:n,material:o}}function r(e){for(var t={r:1,g:1,b:1,a:1},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function n(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,i=r.getElementsByTagName("v2")[0].textContent,o=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(n,i,o)}r=r.nextElementSibling}return t}function i(e){for(var t=[],r=[],n=e.firstElementChild;n;){if("vertex"===n.nodeName)for(var i=n.firstElementChild;i;){if("coordinates"===i.nodeName){var o=i.getElementsByTagName("x")[0].textContent,s=i.getElementsByTagName("y")[0].textContent,a=i.getElementsByTagName("z")[0].textContent;t.push(o,s,a)}else if("normal"===i.nodeName){var l=i.getElementsByTagName("nx")[0].textContent,c=i.getElementsByTagName("ny")[0].textContent,u=i.getElementsByTagName("nz")[0].textContent;r.push(l,c,u)}i=i.nextElementSibling}n=n.nextElementSibling}return{vertices:t,normals:r}}function o(e){for(var t=e.attributes.id.textContent,o={name:"amfobject",meshes:[]},s=null,a=e.firstElementChild;a;){if("metadata"===a.nodeName)void 0!==a.attributes.type&&"name"===a.attributes.type.value&&(o.name=a.textContent);else if("color"===a.nodeName)s=r(a);else if("mesh"===a.nodeName){for(var l=a.firstElementChild,c={vertices:[],normals:[],volumes:[],color:s};l;){if("vertices"===l.nodeName){var u=i(l);c.normals=c.normals.concat(u.normals),c.vertices=c.vertices.concat(u.vertices)}else"volume"===l.nodeName&&c.volumes.push(n(l));l=l.nextElementSibling}o.meshes.push(c)}a=a.nextElementSibling}return{id:t,obj:o}}var s,a,l=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var r=null,n=null;console.log("AMFLoader: Loading Zip");try{r=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.log("AMFLoader: jszip missing and file is compressed."),null}for(n in r.files)if(".amf"===n.toLowerCase().substr(-4))break;console.log("AMFLoader: Trying to load file asset: "+n),t=new DataView(r.file(n).asArrayBuffer())}var i=Nw.decodeText(t),o=(new DOMParser).parseFromString(i,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),c="",u="",h=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("AMFLoader: Unit scale: "+t),t}(l),d={},p={},f=l.documentElement.childNodes;for(s=0;s<f.length;s++){var m=f[s];if("metadata"===m.nodeName)void 0!==m.attributes.type&&("name"===m.attributes.type.value?c=m.textContent:"author"===m.attributes.type.value&&(u=m.textContent));else if("material"===m.nodeName){var v=t(m);d[v.id]=v.material}else if("object"===m.nodeName){var g=o(m);p[g.id]=g.obj}}var y=new mS,x=new bw({color:11184895,flatShading:!0});for(var b in y.name=c,y.userData.author=u,y.userData.loader="AMF",p){var w=p[b],_=w.meshes,S=new mS;for(S.name=w.name||"",s=0;s<_.length;s++){var T=x,M=_[s],A=new Sy(M.vertices,3),E=null;if(M.normals.length&&(E=new Sy(M.normals,3)),M.color){var C=M.color;(T=x.clone()).color=new ay(C.r,C.g,C.b),1!==C.a&&(T.transparent=!0,T.opacity=C.a)}var P=M.volumes;for(a=0;a<P.length;a++){var O=P[a],D=new Cy,N=T;D.setIndex(O.triangles),D.addAttribute("position",A.clone()),E&&D.addAttribute("normal",E.clone()),void 0!==d[O.materialId]&&(N=d[O.materialId]),D.scale(h,h,h),S.add(new Mb(D,N.clone()))}}y.add(S)}return y}};var yS=function(e){this.manager=void 0!==e?e:pw};function xS(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Qg)}}function bS(e,t){Mb.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Qg,this.bindMatrixInverse=new Qg;var r=new xS(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}yS.prototype={constructor:yS,crossOrigin:"Anonymous",load:function(e,t,r,n){var i=this,o=Nw.extractUrlBase(e);new mw(this.manager).load(e,function(e){var r=JSON.parse(e),s=r.__metadata__;if(void 0!==s){if("assimp2json"!==s.format)return void n("AssimpJSONLoader: Not an assimp2json scene.");if(s.version<100&&s.version>=200)return void n("AssimpJSONLoader: Unsupported assimp2json file format version.")}t(i.parse(r,o))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t){for(var r=new Array(e.length),n=0;n<e.length;++n)r[n]=t.call(this,e[n]);return r}var n=new Ow(this.manager);n.setPath(t).setCrossOrigin(this.crossOrigin);var i=r(e.meshes,function(e){var t,r,n,i=new Cy,o=[],s=e.vertices||[],a=e.normals||[],l=e.texturecoords||[],c=e.colors||[];for(l=l[0]||[],t=0,r=e.faces.length;t<r;t++)n=e.faces[t],o.push(n[0],n[1],n[2]);return i.setIndex(o),i.addAttribute("position",new Sy(s,3)),a.length>0&&i.addAttribute("normal",new Sy(a,3)),l.length>0&&i.addAttribute("uv",new Sy(l,2)),c.length>0&&i.addAttribute("color",new Sy(c,3)),i.computeBoundingSphere(),i}),o=r(e.materials,function(e){var t=new bw;for(var r in e.properties){var i=e.properties[r],o=i.key,s=i.value;switch(o){case"$tex.file":var a=i.semantic;if(1===a||2===a||5===a||6===a){var l;switch(a){case 1:l="map";break;case 2:l="specularMap";break;case 5:l="bumpMap";break;case 6:l="normalMap"}var c=n.load(s);c.wrapS=c.wrapT=Mx,t[l]=c}break;case"?mat.name":t.name=s;break;case"$clr.diffuse":t.color.fromArray(s);break;case"$clr.specular":t.specular.fromArray(s);break;case"$clr.emissive":t.emissive.fromArray(s);break;case"$mat.shininess":t.shininess=s;break;case"$mat.shadingm":t.flatShading=1===s;break;case"$mat.opacity":s<1&&(t.opacity=s,t.transparent=!0)}}return t});return function e(t,r,n,i){var o,s,a=new oy;for(a.name=r.name||"",a.matrix=(new Qg).fromArray(r.transformation).transpose(),a.matrix.decompose(a.position,a.quaternion,a.scale),o=0;r.meshes&&o<r.meshes.length;o++)s=r.meshes[o],a.add(new Mb(n[s],i[t.meshes[s].materialindex]));for(o=0;r.children&&o<r.children.length;o++)a.add(e(t,r.children[o],n,i));return a}(e,e.rootnode,i,o)}},Object.assign(xS.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Qg;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new Qg,t=new Qg;return function(){for(var r=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture,s=0,a=r.length;s<a;s++){var l=r[s]?r[s].matrixWorld:t;e.multiplyMatrices(l,n[s]),e.toArray(i,16*s)}void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new xS(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),bS.prototype=Object.assign(Object.create(Mb.prototype),{constructor:bS,isSkinnedMesh:!0,initBones:function(){var e,t,r,n,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(r=0,n=this.geometry.bones.length;r<n;r++)t=this.geometry.bones[r],e=new Pb,i.push(e),e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);for(r=0,n=this.geometry.bones.length;r<n;r++)-1!==(t=this.geometry.bones[r]).parent&&null!==t.parent&&void 0!==i[t.parent]?i[t.parent].add(i[r]):this.add(i[r])}return this.updateMatrixWorld(!0),i},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var r=this.geometry.skinWeights[t];(e=1/r.manhattanLength())!==1/0?r.multiplyScalar(e):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new fy,i=this.geometry.attributes.skinWeight;for(t=0;t<i.count;t++)n.x=i.getX(t),n.y=i.getY(t),n.z=i.getZ(t),n.w=i.getW(t),(e=1/n.manhattanLength())!==1/0?n.multiplyScalar(e):n.set(1,0,0,0),i.setXYZW(t,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(e){Mb.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var wS=function(e){this.manager=void 0!==e?e:pw};wS.prototype={constructor:wS,crossOrigin:"Anonymous",load:function(e,t,r,n){var i=this,o=Nw.extractUrlBase(e),s=new mw(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){t(i.parse(e,o))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=new Ow(this.manager);r.setPath(t).setCrossOrigin(this.crossOrigin);var n={KeyFrame:function(e,t){this.time=e,this.matrix=t.clone(),this.position=new Kg,this.quaternion=new $g,this.scale=new Kg(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new n.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){var r=(t-=this.time)/(e.time-this.time),i=1-r,o=this.position,s=this.quaternion,a=e.position,l=e.quaternion;return n.KeyFrame.tempAniPos.x=o.x*i+a.x*r,n.KeyFrame.tempAniPos.y=o.y*i+a.y*r,n.KeyFrame.tempAniPos.z=o.z*i+a.z*r,n.KeyFrame.tempAniQuat.set(s.x,s.y,s.z,s.w),n.KeyFrame.tempAniQuat.slerp(l,r),n.KeyFrame.tempAniMatrix.compose(n.KeyFrame.tempAniPos,n.KeyFrame.tempAniQuat,n.KeyFrame.tempAniScale)}}};n.KeyFrame.tempAniPos=new Kg,n.KeyFrame.tempAniQuat=new $g,n.KeyFrame.tempAniScale=new Kg(1,1,1),n.KeyFrame.tempAniMatrix=new Qg,n.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(var e=0;e<this.length*this.fps;e++)for(var t=0;t<this.keys.length;t++){if(this.keys[t].time==e){this._accelTable[e]=t;break}if(this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;for(var r=e.hierarchy[0].keys,i=0;i<r.length;i++)this.addKey(new n.KeyFrame(i/t||r[i].time,r[i].targets[0].data));this.init()},this.parseFromCollada=function(e){for(var t=e.keys,r=this.fps,i=0;i<t.length;i++)this.addKey(new n.KeyFrame(i/r||t[i].time,t[i].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new n.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(var t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=n.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);for(var t=null,r=null,n=this.keySearchAccel(e);n<this.keys.length;n++){if(this.keys[n].time==e){t=this.keys[n],r=this.keys[n];break}if(this.keys[n].time<e&&this.keys[n+1]&&this.keys[n+1].time>e){t=this.keys[n],r=this.keys[n+1];break}if(this.keys[n].time<e&&n==this.keys.length-1){t=this.keys[n],(r=this.keys[0].clone()).time+=this.length+.05;break}}return t&&r&&t!==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(r,e)),void(this.target.matrixWorldNeedsUpdate=!0)):t&&r&&t==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},n.TrackTargetNodeNameCompare=function(e,t){return function e(t,r){if(t.name==r)return t;for(var n=0;n<t.children.length;n++){var i=e(t.children[n],r);if(i)return i}return null}(e,t.name)},n.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(var t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=n.TrackTargetNodeNameCompare);var r=new n.Animation;r.target=e;for(var i=0;i<this.tracks.length;i++){var o=this.tracks[i].clone();o.reTarget(e,t),r.addTrack(o)}return r}};var i=4660,o=4661,s=4662,a=4663,l=4664,c=4665,u=4666,h=4667,d=4668,p=4669,f=4670,m=1,v=2,g=4,y=256,x=65536,b=1,w=4,_=1,S=3,T=1,M=6,A=8,E=10,C=4;function P(e){return y<<e}function O(e){return x<<e}function D(e,t){var r=new Pb;for(var n in r.matrix.copy(e.matrix),r.matrixWorld.copy(e.matrixWorld),r.position.copy(e.position),r.quaternion.copy(e.quaternion),r.scale.copy(e.scale),t.nodeCount++,r.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(r),e.children){var i=D(e.children[n],t);i&&r.add(i)}return r}function N(e,t){for(var r=[],n=0;n<e.length;n++)r.push({i:e[n],w:t[n]});for(r.sort(function(e,t){return t.w-e.w});r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);var i=0;for(n=0;n<4;n++)i+=r[n].w*r[n].w;i=Math.sqrt(i);for(n=0;n<4;n++)r[n].w=r[n].w/i,e[n]=r[n].i,t[n]=r[n].w}function L(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(var r in e.children){var n=L(e.children[r],t);if(n)return n}}function I(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e,t){if(0!=this.mBones.length){for(var r=[],n=[],i=e.findNode(this.mBones[0].mName);i.mParent&&i.mParent.isBone;)i=i.mParent;var o=D(l=i.toTHREE(e),e);this.threeNode.add(o);for(var s=0;s<this.mBones.length;s++){if(c=L(o,this.mBones[s].mName)){var a=c;r.push(a),n.push(this.mBones[s].mOffsetMatrix.toTHREE())}else{if(!(i=e.findNode(this.mBones[s].mName)))return;var l;(l=i.toTHREE(e)).parent,o=D(l,e);this.threeNode.add(o);var c;a=c=L(o,this.mBones[s].mName);r.push(a),n.push(this.mBones[s].mOffsetMatrix.toTHREE())}}var u=new xS(r,n);this.threeNode.bind(u,new Qg),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,r,n=new Cy;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new yw,n.setIndex(new my(new Uint32Array(this.mIndexArray),1)),n.addAttribute("position",new my(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&n.addAttribute("normal",new my(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&n.addAttribute("color",new my(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&n.addAttribute("uv",new my(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&n.addAttribute("uv1",new my(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&n.addAttribute("tangents",new my(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&n.addAttribute("bitangents",new my(this.mBitangentBuffer,3)),this.mBones.length>0){for(var i=[],o=[],s=0;s<this.mBones.length;s++)for(var a=0;a<this.mBones[s].mWeights.length;a++){var l=this.mBones[s].mWeights[a];l&&(i[l.mVertexId]||(i[l.mVertexId]=[]),o[l.mVertexId]||(o[l.mVertexId]=[]),i[l.mVertexId].push(l.mWeight),o[l.mVertexId].push(parseInt(s)))}for(var s in o)N(o[s],i[s]);var c=[],u=[];for(s=0;s<i.length;s++)for(a=0;a<4;a++)i[s]&&o[s]?(c.push(i[s][a]),u.push(o[s][a])):(c.push(0),u.push(0));n.addAttribute("skinWeight",new my(new Float32Array(c),C)),n.addAttribute("skinIndex",new my(new Float32Array(u),C))}return 0==this.mBones.length&&(r=new Mb(n,t)),this.mBones.length>0&&(r=new bS(n,t)),this.threeNode=r,r}}function R(){this.mNumIndices=0,this.mIndices=[]}function F(){this.data=[],this.toString=function(){var e="";return this.data.forEach(function(t){e+=String.fromCharCode(t)}),e.replace(/[^\x20-\x7E]+/g,"")}}function k(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new oy;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(var r=0;r<this.mChildren.length;r++)t.add(this.mChildren[r].toTHREE(e));for(r=0;r<this.mMeshes.length;r++)t.add(e.mMeshes[this.mMeshes[r]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}function U(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function B(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e);return new ay(t.getFloat32(0,!0),t.getFloat32(4,!0),t.getFloat32(8,!0))},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var e=new F;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new F;e.data=this.mData;var t=e.toString();return-1!=(t=t.replace(/\\/g,"/")).indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),r.load(t)}}var j={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},z={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function V(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(e){this.mProperties[0].dataAsString();for(var t=new bw,r=0;r<this.mProperties.length;r++)if("float"==z[this.mProperties[r].mKey]&&(t[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsFloat()),"color"==z[this.mProperties[r].mKey]&&(t[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsColor()),"bool"==z[this.mProperties[r].mKey]&&(t[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsBool()),"string"==z[this.mProperties[r].mKey]&&(t[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsString()),"map"==z[this.mProperties[r].mKey]){var n=this.mProperties[r];n.mSemantic==T&&(t.map=this.mProperties[r].dataAsMap()),n.mSemantic==M&&(t.normalMap=this.mProperties[r].dataAsMap()),n.mSemantic==E&&(t.lightMap=this.mProperties[r].dataAsMap()),n.mSemantic==A&&(t.alphaMap=this.mProperties[r].dataAsMap())}return t.ambient.r=.53,t.ambient.g=.53,t.ambient.b=.53,t.color.r=1,t.color.g=1,t.color.b=1,t}}function G(e,t,r){var n=new Kg,i=1-r;return n.x=e.x*r+t.x*i,n.y=e.y*r+t.y*i,n.z=e.z*r+t.z*i,n}function H(e,t,r){return e.clone().slerp(t,1-r)}function W(e,t,r,n){if(1==e.length)return e[0].mValue.toTHREE();for(var i=1/0,o=null,s=null,a=0;a<e.length;a++){var l=Math.abs(e[a].mTime-t);l<i&&e[a].mTime<=t&&(i=l,o=e[a],s=e[a+1])}if(o){if(s){var c=s.mTime-o.mTime,u=(o.mTime-t)/c;return n(o.mValue.toTHREE(),s.mValue.toTHREE(),u)}(s=e[0].clone()).mTime+=r;c=s.mTime-o.mTime,u=(o.mTime-t)/c;return n(o.mValue.toTHREE(),s.mValue.toTHREE(),u)}return null}function X(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(e){return e.mTime})))},this.toTHREE=function(e,t){this.sortKeys();for(var r=this.getLength(),i=new n.KeyFrameTrack,o=0;o<r;o+=.05){var s=new Qg,a=o,l=W(this.mPositionKeys,a,r,G),c=W(this.mScalingKeys,a,r,G),u=W(this.mRotationKeys,a,r,H);s.compose(l,u,c);var h=new n.KeyFrame(a,s);i.addKey(h)}i.target=e.findNode(this.mNodeName).toTHREE();var d=[i];if(e.nodeToBoneMap[this.mNodeName])for(o=0;o<e.nodeToBoneMap[this.mNodeName].length;o++){var p=i.clone();p.target=e.nodeToBoneMap[this.mNodeName][o],d.push(p)}return d}}function q(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new n.Animation;for(var r in this.mChannels){this.mChannels[r].init(this.mTicksPerSecond);var i=this.mChannels[r].toTHREE(e);for(var o in i)i[o].init(),t.addTrack(i[o])}return t.length=Math.max.apply(null,t.tracks.map(function(e){return e.length})),t}}function Y(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function J(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function Z(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}var Q=!0;function K(e){var t=e.getFloat32(e.readOffset,Q);return e.readOffset+=4,t}function $(e){var t=e.getFloat64(e.readOffset,Q);return e.readOffset+=8,t}function ee(e){var t=e.getUint8(e.readOffset);return e.readOffset+=1,t}function te(e){var t=e.getUint16(e.readOffset,Q);return e.readOffset+=2,t}function re(e){var t=e.getUint32(e.readOffset,Q);return e.readOffset+=4,t}function ne(e){var t=e.getUint32(e.readOffset,Q);return e.readOffset+=4,t}function ie(e){var t=new function(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new Kg(this.x,this.y,this.z)}};return t.x=K(e),t.y=K(e),t.z=K(e),t}function oe(e){var t=new function(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new ay(this.r,this.g,this.b,1)}};return t.r=K(e),t.g=K(e),t.b=K(e),t}function se(e){var t=new function(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new $g(this.x,this.y,this.z,this.w)}};return t.w=K(e),t.x=K(e),t.y=K(e),t.z=K(e),t}function ae(e){var t=new F,r=re(e);return e.ReadBytes(t.data,1,r),t.toString()}function le(e){var t=new function(){this.mVertexId=0,this.mWeight=0};return t.mVertexId=re(e),t.mWeight=K(e),t}function ce(e){for(var t=new function(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var e=new Qg,t=0;t<4;++t)for(var r=0;r<4;++r)e.elements[4*t+r]=this.elements[r][t];return e}},r=0;r<4;++r)for(var n=0;n<4;++n)t.elements[r][n]=K(e);return t}function ue(e){var t=new function(){this.mTime=0,this.mValue=null};return t.mTime=$(e),t.mValue=ie(e),t}function he(e){var t=new function(){this.mTime=0,this.mValue=null};return t.mTime=$(e),t.mValue=se(e),t}function de(e,t,r){for(var n=0;n<r;n++)t[n]=ue(e)}function pe(e,t,r){return e.Seek(sizeof(t)*r,Ee)}function fe(e){if(!e)throw"asset failed"}function me(e,t){return fe(ne(e)==u),ne(e),t.mName=ae(e),t.mNumWeights=re(e),t.mOffsetMatrix=ce(e),Me?pe(e,t.mWeights,t.mNumWeights):(t.mWeights=[],function(e,t,r){for(var n=0;n<r;n++)t[n]=le(e)}(e,t.mWeights,t.mNumWeights)),t}function ve(e,t){fe(ne(e)==a),ne(e),t.mPrimitiveTypes=re(e),t.mNumVertices=re(e),t.mNumFaces=re(e),t.mNumBones=re(e),t.mMaterialIndex=re(e),t.mNumUVComponents=[];var r=re(e);r&m&&(Me?pe(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ee))),r&v&&(Me?pe(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ee))),r&g&&(Me?(pe(e,t.mTangents,t.mNumVertices),pe(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ee),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ee)));for(var n=0;n<b&&r&O(n);++n)Me?pe(e,t.mColors[n],t.mNumVertices):(t.mColors[n]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,Ee));t.mTexCoordsBuffers=[];for(n=0;n<w&&r&P(n);++n)if(t.mNumUVComponents[n]=re(e),Me)pe(e,t.mTextureCoords[n],t.mNumVertices);else{t.mTextureCoords[n]=[],t.mTexCoordsBuffers[n]=[];for(var i=0;i<t.mNumVertices;i++)t.mTexCoordsBuffers[n].push(K(e)),t.mTexCoordsBuffers[n].push(K(e)),K(e)}if(Me)re(e);else{t.mFaces=[],t.mIndexArray=[];for(var o=0;o<t.mNumFaces;++o){var s=t.mFaces[o]=new R;s.mNumIndices=te(e),s.mIndices=[];for(var l=0;l<s.mNumIndices;++l)t.mNumVertices<65536?s.mIndices[l]=te(e):s.mIndices[l]=re(e);if(3===s.mNumIndices)t.mIndexArray.push(s.mIndices[0]),t.mIndexArray.push(s.mIndices[1]),t.mIndexArray.push(s.mIndices[2]);else{if(4!==s.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(s.mIndices[0]),t.mIndexArray.push(s.mIndices[1]),t.mIndexArray.push(s.mIndices[2]),t.mIndexArray.push(s.mIndices[2]),t.mIndexArray.push(s.mIndices[3]),t.mIndexArray.push(s.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(l=0;l<t.mNumBones;++l)t.mBones[l]=new U,me(e,t.mBones[l])}}function ge(e,t){fe(ne(e)==f),ne(e),t.mKey=ae(e),t.mSemantic=re(e),t.mIndex=re(e),t.mDataLength=re(e),t.mType=re(e),t.mData=[],e.ReadBytes(t.mData,1,t.mDataLength)}function ye(e,t){if(fe(ne(e)==p),ne(e),t.mNumAllocated=t.mNumProperties=re(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(var r=0;r<t.mNumProperties;++r)t.mProperties[r]=new B,ge(e,t.mProperties[r])}}function xe(e,t){fe(ne(e)==l),ne(e),t.mNodeName=ae(e),t.mNumPositionKeys=re(e),t.mNumRotationKeys=re(e),t.mNumScalingKeys=re(e),t.mPreState=re(e),t.mPostState=re(e),t.mNumPositionKeys&&(Me?pe(e,t.mPositionKeys,t.mNumPositionKeys):(t.mPositionKeys=[],de(e,t.mPositionKeys,t.mNumPositionKeys))),t.mNumRotationKeys&&(Me?pe(e,t.mRotationKeys,t.mNumRotationKeys):(t.mRotationKeys=[],function(e,t,r){for(var n=0;n<r;n++)t[n]=he(e)}(e,t.mRotationKeys,t.mNumRotationKeys))),t.mNumScalingKeys&&(Me?pe(e,t.mScalingKeys,t.mNumScalingKeys):(t.mScalingKeys=[],de(e,t.mScalingKeys,t.mNumScalingKeys)))}function be(e,t){if(fe(ne(e)==h),ne(e),t.mName=ae(e),t.mDuration=$(e),t.mTicksPerSecond=$(e),t.mNumChannels=re(e),t.mNumChannels){t.mChannels=[];for(var r=0;r<t.mNumChannels;++r)t.mChannels[r]=new X,xe(e,t.mChannels[r])}}function we(e,t){fe(ne(e)==s),ne(e),t.mWidth=re(e),t.mHeight=re(e),e.ReadBytes(t.achFormatHint,1,4),Me||(t.mHeight?(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth*t.mHeight*4)):(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth)))}function _e(e,t){fe(ne(e)==o),ne(e),t.mName=ae(e),t.mType=re(e),t.mType!=_&&(t.mAttenuationConstant=K(e),t.mAttenuationLinear=K(e),t.mAttenuationQuadratic=K(e)),t.mColorDiffuse=oe(e),t.mColorSpecular=oe(e),t.mColorAmbient=oe(e),t.mType==S&&(t.mAngleInnerCone=K(e),t.mAngleOuterCone=K(e))}function Se(e,t){fe(ne(e)==i),ne(e),t.mName=ae(e),t.mPosition=ie(e),t.mLookAt=ie(e),t.mUp=ie(e),t.mHorizontalFOV=K(e),t.mClipPlaneNear=K(e),t.mClipPlaneFar=K(e),t.mAspect=K(e)}function Te(e,t){if(fe(ne(e)==c),ne(e),t.mFlags=re(e),t.mNumMeshes=re(e),t.mNumMaterials=re(e),t.mNumAnimations=re(e),t.mNumTextures=re(e),t.mNumLights=re(e),t.mNumCameras=re(e),t.mRootNode=new k,t.mRootNode=function e(t,r,n){fe(ne(t)==d),ne(t);var i=new k;if(i.mParent=r,i.mDepth=n,i.mName=ae(t),i.mTransformation=ce(t),i.mNumChildren=re(t),i.mNumMeshes=re(t),i.mNumMeshes){i.mMeshes=[];for(var o=0;o<i.mNumMeshes;++o)i.mMeshes[o]=re(t)}if(i.mNumChildren)for(i.mChildren=[],o=0;o<i.mNumChildren;++o){var s=e(t,i,n++);i.mChildren[o]=s}return i}(e,null,0),t.mNumMeshes){t.mMeshes=[];for(var r=0;r<t.mNumMeshes;++r)t.mMeshes[r]=new I,ve(e,t.mMeshes[r])}if(t.mNumMaterials){t.mMaterials=[];for(r=0;r<t.mNumMaterials;++r)t.mMaterials[r]=new V,ye(e,t.mMaterials[r])}if(t.mNumAnimations){t.mAnimations=[];for(r=0;r<t.mNumAnimations;++r)t.mAnimations[r]=new q,be(e,t.mAnimations[r])}if(t.mNumTextures){t.mTextures=[];for(r=0;r<t.mNumTextures;++r)t.mTextures[r]=new Y,we(e,t.mTextures[r])}if(t.mNumLights){t.mLights=[];for(r=0;r<t.mNumLights;++r)t.mLights[r]=new J,_e(e,t.mLights[r])}if(t.mNumCameras){t.mCameras=[];for(r=0;r<t.mNumCameras;++r)t.mCameras[r]=new Z,Se(e,t.mCameras[r])}}var Me,Ae,Ee=0,Ce=1;return function(e){var t=new function(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(var r=0;r<t.mChildren.length;r++){var n=this.findNode(e,t.mChildren[r]);if(n)return n}return null},this.toTHREE=function(){this.nodeCount=0,function(e){for(var t in e.mMeshes){var r=e.mMeshes[t];for(var n in r.mBones){var i=e.findNode(r.mBones[n].mName);i&&(i.isBone=!0)}}}(this);var e=this.mRootNode.toTHREE(this);for(var t in this.mMeshes)this.mMeshes[t].hookupSkeletons(this,e);if(this.mAnimations.length>0)var r=this.mAnimations[0].toTHREE(this);return{object:e,animation:r}}},r=new DataView(e);if(function(e){e.readOffset=0,e.Seek=function(t,r){r==Ee&&(e.readOffset+=t),r==Ce&&(e.readOffset=t)},e.ReadBytes=function(e,t,r){for(var n=t*r,i=0;i<n;i++)e[i]=ee(this)},e.subArray32=function(e,t){var r=this.buffer.slice(e,t);return new Float32Array(r)},e.subArrayUint16=function(e,t){var r=this.buffer.slice(e,t);return new Uint16Array(r)},e.subArrayUint8=function(e,t){var r=this.buffer.slice(e,t);return new Uint8Array(r)},e.subArrayUint32=function(e,t){var r=this.buffer.slice(e,t);return new Uint32Array(r)}}(r),r.Seek(44,Ee),re(r),re(r),re(r),re(r),Me=te(r)>0,Ae=te(r)>0,Me)throw"Shortened binaries are not supported!";if(r.Seek(256,Ee),r.Seek(128,Ee),r.Seek(64,Ee),!Ae)return Te(r,t),t.toTHREE();var n=ne(r),i=r.FileSize()-r.Tell(),o=[];r.Read(o,1,i);var s=[];uncompress(s,n,o,i),Te(new ArrayBuffer(s),t)}(e)}};function _S(){this.id=0,this.data=null}function SS(){}SS.prototype={set:function(e,t){this[e]=t},get:function(e,t){return this.hasOwnProperty(e)?this[e]:t}};var TS=function(e){this.manager=void 0!==e?e:pw,this.trunk=new oy,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new _S],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1};function MS(e,t){oy.call(this),this.type="Light",this.color=new ay(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function AS(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new hy(512,512),this.map=null,this.matrix=new Qg}function ES(e,t,r,n){MS.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new AS(new Kb(90,1,.5,500))}function CS(){AS.call(this,new tw(-5,5,5,-5,.5,500))}function PS(e,t){MS.call(this,e,t),this.type="DirectionalLight",this.position.copy(oy.DefaultUp),this.updateMatrix(),this.target=new oy,this.shadow=new CS}function OS(){AS.call(this,new Kb(50,1,.5,500))}function DS(e,t,r,n,i,o){MS.call(this,e,t),this.type="SpotLight",this.position.copy(oy.DefaultUp),this.updateMatrix(),this.target=new oy,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new OS}function NS(e,t,r){MS.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(oy.DefaultUp),this.updateMatrix(),this.groundColor=new ay(t)}TS.prototype={constructor:TS,load:function(e,t,r,n){var i=this;this._url=e,this._baseDir=e.substr(0,e.lastIndexOf("/")+1);var o=new mw(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t=e.byteLength;for(this._ptr=0,this._data=new DataView(e),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==e.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,t-this._ptr);this._ptr<t;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var e,t,r=this.readU32(),n=(this.readU8(),this.readU8()),i=(this.readU8(),this.readU32());switch(n){case 1:e=this.parseMeshData(i);break;case 22:e=this.parseContainer(i);break;case 23:e=this.parseMeshInstance(i);break;case 81:e=this.parseMaterial(i);break;case 82:e=this.parseTexture(i);break;case 101:e=this.parseSkeleton(i);break;case 112:e=this.parseMeshPoseAnimation(i,!1);break;case 113:e=this.parseVertexAnimationSet(i);break;case 102:e=this.parseSkeletonPose(i);break;case 103:e=this.parseSkeletonAnimation(i);break;case 122:e=this.parseAnimatorSet(i);break;default:this._ptr+=i}this._blocks[r]=t=new _S,t.data=e,t.id=r},_parseHeader:function(){var e=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");e[0]=this.readU8(),e[1]=this.readU8();var t=this.readU16();this._streaming=1==(1&t),2===e[0]&&1===e[1]&&(this._accuracyMatrix=2==(2&t),this._accuracyGeo=4==(4&t),this._accuracyProps=8==(8&t)),this._geoNrType=this._accuracyGeo?8:7,this._matrixNrType=this._accuracyMatrix?8:7,this._propsNrType=this._accuracyProps?8:7,this._optimized_for_accuracy=2==(2&t),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(e){var t=new oy,r=this.readU32(),n=this.parseMatrix4();return t.name=this.readUTF(),t.applyMatrix(n),(this._blocks[r].data||this.trunk).add(t),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:4}),t.extra=this.parseUserAttributes(),t},parseMeshInstance:function(e){var t,r,n,i,o,s,a,l,c,u,h,d,p;for(s=this.readU32(),l=this.parseMatrix4(),t=this.readUTF(),a=this.readU32(),d=this.readU16(),n=this.getBlock(a),c=[],p=0;p<d;p++)h=this.readU32(),u=this.getBlock(h),c.push(u);if(o=[],(i=n.length)>1)for(r=new oy,p=0;p<i;p++){var f=new Mb(n[p]);o.push(f),r.add(f)}else r=new Mb(n[0]),o.push(r);r.applyMatrix(l),r.name=t,(this.getBlock(s)||this.trunk).add(r);var m=c.length,v=Math.max(i,m);for(p=0;p<v;p++)o[p%i].material=c[p%m];return this.parseProperties(null),r.extra=this.parseUserAttributes(),r},parseMaterial:function(e){var t,r,n,i,o,s;for(t=this.readUTF(),r=this.readU8(),s=this.readU8(),n=this.parseProperties({1:3,2:23,11:21,12:7,13:21}),0;0<s;){this.readU16();this.parseProperties(null),this.parseUserAttributes()}if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(i=this.materialFactory(t)))return i;if(i=new bw,1===r)i.color.setHex(n.get(1,13421772));else if(2===r){var a=n.get(2,0);i.map=this.getBlock(a)}return i.extra=o,i.alphaThreshold=n.get(12,0),i.repeat=n.get(13,!1),i},parseTexture:function(e){var t,r;this.readUTF();if(0===this.readU8()){r=this.readU32();var n=this.readUTFBytes(r);console.log(n),t=this.loadTexture(n)}return this.parseProperties(null),this.parseUserAttributes(),t},loadTexture:function(e){var t=new nw;return new Pw(this.manager).load(this._baseDir+e,function(e){t.image=e,t.needsUpdate=!0}),t},parseSkeleton:function(e){this.readUTF();var t=this.readU16(),r=[],n=0;for(this.parseProperties(null);n<t;){var i,o;this.readU16(),(i=new Pb).parent=this.readU16()-1,i.name=this.readUTF(),o=this.parseMatrix4(),i.skinMatrix=o,this.parseProperties(null),this.parseUserAttributes(),r.push(i),n++}return this.parseUserAttributes(),r},parseSkeletonPose:function(e){this.readUTF();var t=this.readU16();this.parseProperties(null);for(var r=[],n=0;n<t;){var i;i=1===this.readU8()?this.parseMatrix4():new Qg,r[n]=i,n++}return this.parseUserAttributes(),r},parseSkeletonAnimation:function(e){this.readUTF();var t,r,n,i=[],o=this.readU16();this.parseProperties(null);for(var s=0;s<o;)r=this.readU32(),t=this.readU16(),n=this._blocks[r].data,i.push({pose:n,duration:t}),s++;if(0!==i.length)return this.parseUserAttributes(),i},parseVertexAnimationSet:function(e){this.readUTF();for(var t,r=this.readU16(),n=(this.parseProperties({1:5}),0),i=[];n<r;)t=this.readU32(),i.push(this._blocks[t].data),n++;return this.parseUserAttributes(),i},parseAnimatorSet:function(e){this.readUTF();var t,r,n=this.readU16(),i=this.parseProperties({1:23});t=this.readU32();for(var o=this.readU16(),s=[],a=0;a<o;a++)s.push(this.readU32());this.readU16(),Boolean(this.readU8());this.parseUserAttributes(),this.parseUserAttributes();var l,c=[];for(a=0;a<s.length;a++)c.push(this._blocks[s[a]].data);for(r=this._blocks[t].data,1==n&&(l={animationSet:r,skeleton:this._blocks[i.get(1,0)].data}),a=0;a<c.length;a++)c[a].animator=l;return l},parseMeshData:function(e){var t,r,n=this.readUTF(),i=this.readU16(),o=0,s=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});o<i;){var a,l,c;for((t=new Cy).name=n,s.push(t),a=this.readU32(),l=this._ptr+a,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<l;){var u=0,h=this.readU8(),d=(this.readU8(),this.readU32()),p=d+this._ptr;if(1===h)for(c=new my(r=new Float32Array(d/12*3),3),t.addAttribute("position",c),u=0;this._ptr<p;)r[u]=-this.readF32(),r[u+1]=this.readF32(),r[u+2]=this.readF32(),u+=3;else if(2===h)for(c=new my(r=new Uint16Array(d/2),1),t.setIndex(c),u=0;this._ptr<p;)r[u+1]=this.readU16(),r[u]=this.readU16(),r[u+2]=this.readU16(),u+=3;else if(3===h)for(c=new my(r=new Float32Array(d/8*2),2),t.addAttribute("uv",c),u=0;this._ptr<p;)r[u]=this.readF32(),r[u+1]=1-this.readF32(),u+=2;else if(4===h)for(c=new my(r=new Float32Array(d/12*3),3),t.addAttribute("normal",c),u=0;this._ptr<p;)r[u]=-this.readF32(),r[u+1]=this.readF32(),r[u+2]=this.readF32(),u+=3;else this._ptr=p}this.parseUserAttributes(),t.computeBoundingSphere(),o++}return this.parseUserAttributes(),s},parseMeshPoseAnimation:function(e,t){var r,n,i,o,s,a,l,c,u,h=1,d=0,p={},f=[],m=(this.readUTF(),this.readU32()),v=this.getBlock(m);if(null!==v){for((a=v.geometry).morphTargets=[],t||(h=this.readU16()),r=this.readU16(),l=this.readU16(),c=0;c<l;)f.push(this.readU16()),c++;for(u=this.parseProperties({1:21,2:21}),p.looping=u.get(1,!0),p.stitchFinalFrame=u.get(2,!1),n=0;n<h;){for(this.readU16(),i=0;i<r;)for(c=0,o=this.readU32(),s=this._ptr+o;c<l;){if(1===f[c]){var g=new Float32Array(o/4);for(a.morphTargets.push({array:g}),d=0;this._ptr<s;)g[d]=this.readF32(),g[d+1]=this.readF32(),g[d+2]=this.readF32(),d+=3;i++}else this._ptr=s;c++}n++}return this.parseUserAttributes(),null}console.log("parseMeshPoseAnimation target mesh not found at:",m)},getBlock:function(e){return this._blocks[e].data},parseMatrix4:function(){var e=new Qg,t=e.elements;return t[0]=this.readF32(),t[1]=this.readF32(),t[2]=this.readF32(),t[3]=0,t[4]=this.readF32(),t[5]=this.readF32(),t[6]=this.readF32(),t[7]=0,t[8]=this.readF32(),t[9]=this.readF32(),t[10]=this.readF32(),t[11]=0,t[12]=-this.readF32(),t[13]=this.readF32(),t[14]=this.readF32(),t[15]=1,e},parseProperties:function(e){var t=this.readU32(),r=this._ptr+t,n=new SS;if(e)for(;this._ptr<r;){var i,o=this.readU16(),s=this.readU32();e.hasOwnProperty(o)?(i=e[o],n.set(o,this.parseAttrValue(i,s))):this._ptr+=s}return n},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(e,t){var r,n;switch(e){case 1:r=1,n=this.readI8;break;case 2:r=2,n=this.readI16;break;case 3:r=4,n=this.readI32;break;case 21:case 4:r=1,n=this.readU8;break;case 5:r=2,n=this.readU16;break;case 6:case 23:r=4,n=this.readU32;break;case 7:r=4,n=this.readF32;break;case 8:r=8,n=this.readF64;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:r=8,n=this.readF64}if(r<t){var i,o,s;for(i=[],o=0,s=t/r;o<s;)i.push(n.call(this)),o++;return i}return n.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var e=this._data.getUint16(this._ptr,!0);return this._ptr+=2,e},readI16:function(){var e=this._data.getInt16(this._ptr,!0);return this._ptr+=2,e},readU32:function(){var e=this._data.getUint32(this._ptr,!0);return this._ptr+=4,e},readI32:function(){var e=this._data.getInt32(this._ptr,!0);return this._ptr+=4,e},readF32:function(){var e=this._data.getFloat32(this._ptr,!0);return this._ptr+=4,e},readF64:function(){var e=this._data.getFloat64(this._ptr,!0);return this._ptr+=8,e},readUTF:function(){var e=this.readU16();return this.readUTFBytes(e)},readUTFBytes:function(e){for(var t=[],r=0;t.length<e;){var n=this._data.getUint8(this._ptr++,!0);if(n<128)t[r++]=String.fromCharCode(n);else if(n>191&&n<224){var i=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((31&n)<<6|63&i)}else{i=this._data.getUint8(this._ptr++,!0);var o=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&o)}}return t.join("")}},MS.prototype=Object.assign(Object.create(oy.prototype),{constructor:MS,isLight:!0,copy:function(e){return oy.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=oy.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Object.assign(AS.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),ES.prototype=Object.assign(Object.create(MS.prototype),{constructor:ES,isPointLight:!0,copy:function(e){return MS.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),CS.prototype=Object.assign(Object.create(AS.prototype),{constructor:CS}),PS.prototype=Object.assign(Object.create(MS.prototype),{constructor:PS,isDirectionalLight:!0,copy:function(e){return MS.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),OS.prototype=Object.assign(Object.create(AS.prototype),{constructor:OS,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*Zg.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix())}}),DS.prototype=Object.assign(Object.create(MS.prototype),{constructor:DS,isSpotLight:!0,copy:function(e){return MS.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),NS.prototype=Object.assign(Object.create(MS.prototype),{constructor:NS,isHemisphereLight:!0,copy:function(e){return MS.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}});var LS=function(e){this.manager=void 0!==e?e:pw};LS.prototype={constructor:LS,load:function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){function t(e){var t=new Cy,r=e.indices,n=e.positions,i=e.normals,o=e.uvs;t.setIndex(r);for(var s=2,a=n.length;s<a;s+=3)n[s]=-n[s];if(t.addAttribute("position",new Sy(n,3)),i){for(s=2,a=i.length;s<a;s+=3)i[s]=-i[s];t.addAttribute("normal",new Sy(i,3))}o&&t.addAttribute("uv",new Sy(o,2));var l=e.subMeshes;if(l)for(s=0,a=l.length;s<a;s++){var c=l[s];t.addGroup(c.indexStart,c.indexCount)}return t}return function(e,r){for(var n={},i=new ew,o=e.cameras,s=0,a=o.length;s<a;s++){var l=new Kb((d=o[s]).fov/Math.PI*180,1.33,d.minZ,d.maxZ);l.name=d.name,l.position.fromArray(d.position),d.rotation&&l.rotation.fromArray(d.rotation),n[d.id]=l}var c=e.lights;for(s=0,a=c.length;s<a;s++){var u;switch((d=c[s]).type){case 0:u=new ES;break;case 1:u=new PS;break;case 2:u=new DS;break;case 3:u=new NS}u.name=d.name,d.position&&u.position.set(d.position[0],d.position[1],-d.position[2]),u.color.fromArray(d.diffuse),d.groundColor&&u.groundColor.fromArray(d.groundColor),d.intensity&&(u.intensity=d.intensity),n[d.id]=u,i.add(u)}var h=e.meshes;for(s=0,a=h.length;s<a;s++){var d,p;(p=(d=h[s]).indices?new Mb(t(d),r[d.materialId]):new mS).name=d.name,p.position.set(d.position[0],d.position[1],-d.position[2]),p.rotation.fromArray(d.rotation),d.rotationQuaternion&&p.quaternion.fromArray(d.rotationQuaternion),p.scale.fromArray(d.scaling),d.parentId?n[d.parentId].add(p):i.add(p),n[d.id]=p}return i}(e,function(e){for(var t={},r=0,n=e.materials.length;r<n;r++){var i=e.materials[r],o=new bw;o.name=i.name,o.color.fromArray(i.diffuse),o.emissive.fromArray(i.emissive),o.specular.fromArray(i.specular),o.shininess=i.specularPower,o.opacity=i.alpha,t[i.id]=o}if(e.multiMaterials)for(r=0,n=e.multiMaterials.length;r<n;r++)i=e.multiMaterials[r],console.warn("BabylonLoader: Multi materials not yet supported."),t[i.id]=new bw;return t}(e))}};var IS=function(e){this.manager=void 0!==e?e:pw,this.animateBonePositions=!0,this.animateBoneRotations=!0};function RS(e,t){MS.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function FS(e,t){Ab.call(this,e,t),this.type="LineSegments"}IS.prototype={constructor:IS,load:function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){function t(e,r,n){if("ENDSITE"!==n.type){var i={time:r,position:new Kg,rotation:new $g};n.frames.push(i);for(var o=new $g,s=new Kg(1,0,0),a=new Kg(0,1,0),l=new Kg(0,0,1),c=0;c<n.channels.length;c++)switch(n.channels[c]){case"Xposition":i.position.x=parseFloat(e.shift().trim());break;case"Yposition":i.position.y=parseFloat(e.shift().trim());break;case"Zposition":i.position.z=parseFloat(e.shift().trim());break;case"Xrotation":o.setFromAxisAngle(s,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(a,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(l,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;default:console.warn("BVHLoader: Invalid channel type.")}for(c=0;c<n.children.length;c++)t(e,r,n.children[c])}}function r(e){for(var t;0===(t=e.shift().trim()).length;);return t}var n=this,i=function(e){"HIERARCHY"!==r(e)&&console.error("BVHLoader: HIERARCHY expected.");var n=[],i=function e(t,n,i){var o={name:"",type:"",frames:[]};i.push(o);var s=n.split(/[\s]+/);"END"===s[0].toUpperCase()&&"SITE"===s[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=s[1],o.type=s[0].toUpperCase()),"{"!==r(t)&&console.error("BVHLoader: Expected opening { after type & name"),"OFFSET"!==(s=r(t).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected OFFSET but got: "+s[0]),4!==s.length&&console.error("BVHLoader: Invalid number of values for OFFSET.");var a=new Kg(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));if((isNaN(a.x)||isNaN(a.y)||isNaN(a.z))&&console.error("BVHLoader: Invalid values of OFFSET."),o.offset=a,"ENDSITE"!==o.type){"CHANNELS"!==(s=r(t).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected CHANNELS definition.");var l=parseInt(s[1]);o.channels=s.splice(2,l),o.children=[]}for(;;){var c=r(t);if("}"===c)return o;o.children.push(e(t,c,i))}}(e,r(e),n);"MOTION"!==r(e)&&console.error("BVHLoader: MOTION expected.");var o=r(e).split(/[\s]+/),s=parseInt(o[1]);isNaN(s)&&console.error("BVHLoader: Failed to read number of frames."),o=r(e).split(/[\s]+/);var a=parseFloat(o[2]);isNaN(a)&&console.error("BVHLoader: Failed to read frame time.");for(var l=0;l<s;l++)t(o=r(e).split(/[\s]+/),l*a,i);return n}(e.split(/[\r\n]+/g)),o=[];!function e(t,r){var n=new Pb;if(r.push(n),n.position.add(t.offset),n.name=t.name,"ENDSITE"!==t.type)for(var i=0;i<t.children.length;i++)n.add(e(t.children[i],r));return n}(i[0],o);var s=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];if("ENDSITE"!==i.type){for(var o=[],s=[],a=[],l=0;l<i.frames.length;l++){var c=i.frames[l];o.push(c.time),s.push(c.position.x+i.offset.x),s.push(c.position.y+i.offset.y),s.push(c.position.z+i.offset.z),a.push(c.rotation.x),a.push(c.rotation.y),a.push(c.rotation.z),a.push(c.rotation.w)}n.animateBonePositions&&t.push(new Vb(".bones["+i.name+"].position",o,s)),n.animateBoneRotations&&t.push(new jb(".bones["+i.name+"].quaternion",o,a))}}return new Jb("animation",-1,t)}(i);return{skeleton:new xS(o),clip:s}}},RS.prototype=Object.assign(Object.create(MS.prototype),{constructor:RS,isAmbientLight:!0}),FS.prototype=Object.assign(Object.create(Ab.prototype),{constructor:FS,isLineSegments:!0,computeLineDistances:function(){var e=new Kg,t=new Kg;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],o=0,s=n.count;o<s;o+=2)e.fromBufferAttribute(n,o),t.fromBufferAttribute(n,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t);r.addAttribute("lineDistance",new Sy(i,1))}else console.warn("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;for(i=r.lineDistances,o=0,s=a.length;o<s;o+=2)e.copy(a[o]),t.copy(a[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t)}return this}}()});var kS=function(e){this.manager=void 0!==e?e:pw};function US(e,t,r,n,i,o,s,a,l,c,u,h){nw.call(this,null,o,s,a,l,c,n,i,u,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function BS(e){this.manager=void 0!==e?e:pw,this._parser=null}kS.prototype={constructor:kS,crossOrigin:"Anonymous",load:function(e,t,r,n){var i=this,o=void 0===i.path?Nw.extractUrlBase(e):i.path;new mw(i.manager).load(e,function(e){t(i.parse(e,o))},r,n)},setPath:function(e){this.path=e},options:{set convertUpAxis(e){console.warn("ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,o=n.length;i<o;i++){var s=n[i];s.nodeName===t&&r.push(s)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function s(e){return e.substring(1)}function a(e){return 0===Object.keys(e).length}function l(e,t,n,i){var o=r(e,t)[0];if(void 0!==o)for(var s=r(o,n),a=0;a<s.length;a++)i(s[a])}function c(e,t){for(var r in e){e[r].build=t(e[r])}}function u(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function h(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=s(i.getAttribute("source")),a=i.getAttribute("semantic");t.inputs[a]=o}}return t}function d(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),o=-1!==i.indexOf("("),a=-1!==i.indexOf(".");if(a)i=(r=i.split(".")).shift(),t.member=r.shift();else if(o){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=i,t.arraySyntax=o,t.memberSyntax=a,t.sampler=s(e.getAttribute("source")),t}function p(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var o in r)if(r.hasOwnProperty(o)){var s=r[o],a=n[s.sampler],l=a.inputs.INPUT,c=a.inputs.OUTPUT;x(m(s,i[l],i[c]),t)}return t}function f(e){return u(Ve.animations[e],p)}function m(e,t,r){var n,i,o,s,a,l,c=Ve.nodes[e.id],u=Oe(c.id),h=c.transforms[e.sid],d=c.matrix.clone().transpose(),p={};switch(h){case"matrix":for(o=0,s=t.array.length;o<s;o++)if(n=t.array[o],i=o*r.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){var f=r.array[i],m=e.indices[0]+4*e.indices[1];p[n][m]=f}else for(a=0,l=r.stride;a<l;a++)p[n][a]=r.array[i+a];break;case"translate":case"rotate":case"scale":console.warn('ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var v=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort(function(e,t){return e.time-t.time});for(var i=0;i<16;i++)b(r,i,t.elements[i]);return r}(p,d);return{name:u.uuid,keyframes:v}}var v=new Kg,g=new Kg,y=new $g;function x(e,t){for(var r=e.keyframes,n=e.name,i=[],o=[],s=[],a=[],l=0,c=r.length;l<c;l++){var u=r[l],h=u.time,d=u.value;be.fromArray(d).transpose(),be.decompose(v,y,g),i.push(h),o.push(v.x,v.y,v.z),s.push(y.x,y.y,y.z,y.w),a.push(g.x,g.y,g.z)}return o.length>0&&t.push(new Vb(n+".position",i,o)),s.length>0&&t.push(new jb(n+".quaternion",i,s)),a.length>0&&t.push(new Vb(n+".scale",i,a)),t}function b(e,t,r){var n,i,o,s=!0;for(i=0,o=e.length;i<o;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:s=!1;if(!0===s)for(i=0,o=e.length;i<o;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,o=e.length;i<o;i++){var s=e[i];if(null===s.value[t]){if(r=w(e,i,t),n=_(e,i,t),null===r){s.value[t]=n.value[t];continue}if(null===n){s.value[t]=r.value[t];continue}S(s,r,n,t)}}}(e,t)}function w(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function _(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function S(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function T(e){for(var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations,o=0,s=i.length;o<s;o++)for(var a=f(i[o]),l=0,c=a.length;l<c;l++)t.push(a[l]);return new Jb(r,n,t)}function M(e){return u(Ve.clips[e],T)}function A(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(o.textContent);break;case"source":var s=o.getAttribute("id");t.sources[s]=ne(o);break;case"joints":t.joints=E(o);break;case"vertex_weights":t.vertexWeights=C(o)}}return t}function E(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),a=s(i.getAttribute("source"));t.inputs[o]=a}}return t}function C(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),l=s(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));t.inputs[a]={id:l,offset:c};break;case"vcount":t.vcount=o(i.textContent);break;case"v":t.v=o(i.textContent)}}return t}function P(e){var t={id:e.id},r=Ve.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,s=e.vertexWeights,a=s.vcount,l=s.v,c=s.inputs.JOINT.offset,u=s.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[s.inputs.WEIGHT.id].array,f=0;for(t=0,n=a.length;t<n;t++){var m=a[t],v=[];for(r=0;r<m;r++){var g=l[f+c],y=l[f+u],x=p[y];v.push({index:g,weight:x}),f+=2}for(v.sort(S),r=0;r<4;r++){var b=v[r];void 0!==b?(i.indices.array.push(b.index),i.weights.array.push(b.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(i.bindMatrix=(new Qg).fromArray(e.bindShapeMatrix).transpose(),t=0,n=h.array.length;t<n;t++){var w=h.array[t],_=(new Qg).fromArray(d.array,t*d.stride).transpose();i.joints.push({name:w,boneInverse:_})}return i;function S(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function O(e){return u(Ve.controllers[e],P)}function D(e){return void 0!==e.build?e.build:e.init_from}function N(e){return u(Ve.images[e],D)}function L(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":I(i,t);break;case"technique":t.technique=k(i);break;case"extra":t.extra=G(i)}}return t}function I(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[r]=R(o);break;case"sampler2D":t.samplers[r]=F(o)}}}function R(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function F(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function k(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=U(i)}}return t}function U(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":t[i.nodeName]=B(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:B(i)}}}return t}function B(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=i(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:j(o)}}}return t}function j(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":z(i,t)}}return t}function z(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":V(i,t)}}}function V(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function G(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=H(i)}}return t}function H(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function W(e){return e}function X(e){var t,r=function(e){return u(Ve.effects[e],W)}(e.url),n=r.profile.technique,i=r.profile.extra;switch(n.type){case"phong":case"blinn":t=new bw;break;case"lambert":t=new yw;break;default:t=new xb}function o(e){var t,n=r.profile.samplers[e.id];void 0!==n?t=N(r.profile.surfaces[n.source].init_from):(console.warn("ColladaLoader: Undefined sampler. Access image directly (see #12530)."),t=N(e.id));if(void 0!==t){var i=Ue.load(t),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===a(o.technique)){var s=o.technique;i.wrapS=s.wrapU?Mx:Ax,i.wrapT=s.wrapV?Mx:Ax,i.offset.set(s.offsetU||0,s.offsetV||0),i.repeat.set(s.repeatU||1,s.repeatV||1)}else i.wrapS=Mx,i.wrapT=Mx;return i}return console.error("ColladaLoader: Unable to load texture with ID:",e.id),null}t.name=e.name;var s=n.parameters;for(var l in s){var c=s[l];switch(l){case"diffuse":c.color&&t.color.fromArray(c.color),c.texture&&(t.map=o(c.texture));break;case"specular":c.color&&t.specular&&t.specular.fromArray(c.color),c.texture&&(t.specularMap=o(c.texture));break;case"shininess":c.float&&t.shininess&&(t.shininess=c.float);break;case"emission":c.color&&t.emissive&&t.emissive.fromArray(c.color)}}var h=s.transparent,d=s.transparency;if(void 0===d&&h&&(d={float:1}),void 0===h&&d&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&d)if(h.data.texture)t.alphaMap=o(h.data.texture),t.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":t.opacity=p[3]*d.float;break;case"RGB_ZERO":t.opacity=1-p[0]*d.float;break;case"A_ZERO":t.opacity=1-p[3]*d.float;break;case"RGB_ONE":t.opacity=p[0]*d.float;break;default:console.warn('ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}t.opacity<1&&(t.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(t.side=ky),t}function q(e){return u(Ve.materials[e],X)}function Y(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return J(r)}}return{}}function J(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=Z(n)}}return t}function Z(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function Q(e){var t;switch(e.optics.technique){case"perspective":t=new Kb(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,t=new tw(-(n*=.5),n,r*=.5,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new Kb}return t.name=e.name,t}function K(e){var t=Ve.cameras[e];return void 0!==t?u(t,Q):(console.warn("ColladaLoader: Couldn't find camera with ID:",e),null)}function $(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=ee(i)}}return t}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":var s=i(o.textContent);t.color=(new ay).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);t.distance=a?Math.sqrt(1/a):0}}return t}function te(e){var t;switch(e.technique){case"directional":t=new PS;break;case"point":t=new ES;break;case"spot":t=new DS;break;case"ambient":t=new RS}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function re(e){var t=Ve.lights[e];return void 0!==t?u(t,te):(console.warn("ColladaLoader: Couldn't find light with ID:",e),null)}function ne(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=i(s.textContent);break;case"Name_array":t.array=n(s.textContent);break;case"technique_common":var a=r(s,"accessor")[0];void 0!==a&&(t.stride=parseInt(a.getAttribute("stride")))}}return t}function ie(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=s(n.getAttribute("source")))}return t}function oe(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=s(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset"));t.inputs[l]={id:a,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(i.textContent);break;case"p":t.p=o(i.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ae(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var o=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var s in o){var a=o[s];se(a),t[s]=le(a,r,n)}return t}function le(e,t,r){for(var n={},i={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},l=[],c=4,u=[],h=4,d=new Cy,p=[],f=0,m=0,v=0;v<e.length;v++){var g=e[v],y=g.inputs,x=1;for(var b in g.vcount&&4===g.vcount[0]&&(x=2),m="lines"===g.type||"linestrips"===g.type?2*g.count:3*g.count*x,d.addGroup(f,m,v),f+=m,g.material&&p.push(g.material),y){var w=y[b];switch(b){case"VERTEX":for(var _ in r){var S=r[_];switch(_){case"POSITION":var T=i.array.length;if(ce(g,t[S],w.offset,i.array),i.stride=t[S].stride,t.skinWeights&&t.skinIndices&&(ce(g,t.skinIndices,w.offset,l),ce(g,t.skinWeights,w.offset,u)),!1===g.hasUV&&!0===e.uvsNeedsFix){m=(i.array.length-T)/i.stride;for(var M=0;M<m;M++)s.array.push(0,0)}break;case"NORMAL":ce(g,t[S],w.offset,o.array),o.stride=t[S].stride;break;case"COLOR":ce(g,t[S],w.offset,a.array),a.stride=t[S].stride;break;case"TEXCOORD":ce(g,t[S],w.offset,s.array),s.stride=t[S].stride;break;default:console.warn('ColladaLoader: Semantic "%s" not handled in geometry build process.',_)}}break;case"NORMAL":ce(g,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"COLOR":ce(g,t[w.id],w.offset,a.array),a.stride=t[w.id].stride;break;case"TEXCOORD":ce(g,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return i.array.length>0&&d.addAttribute("position",new Sy(i.array,i.stride)),o.array.length>0&&d.addAttribute("normal",new Sy(o.array,o.stride)),a.array.length>0&&d.addAttribute("color",new Sy(a.array,a.stride)),s.array.length>0&&d.addAttribute("uv",new Sy(s.array,s.stride)),l.length>0&&d.addAttribute("skinIndex",new Sy(l,c)),u.length>0&&d.addAttribute("skinWeight",new Sy(u,h)),n.data=d,n.type=e[0].type,n.materialKeys=p,n}function ce(e,t,r,n){var i=e.p,o=e.stride,s=e.vcount;function a(e){for(var t=i[e+r]*u,o=t+u;t<o;t++)n.push(c[t])}var l=0,c=t.array,u=t.stride;if(void 0!==e.vcount){for(var h=0,d=0,p=s.length;d<p;d++){var f=s[d];if(4===f){var m=h+1*o,v=h+2*o,g=h+3*o;a(h+0*o),a(m),a(g),a(m),a(v),a(g)}else if(3===f){m=h+1*o,v=h+2*o;a(h+0*o),a(m),a(v)}else l=Math.max(l,f);h+=o*f}l>0&&console.log("ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(d=0,p=i.length;d<p;d+=o)a(d)}function ue(e){return u(Ve.geometries[e],ae)}function he(e){return void 0!==e.build?e.build:e}function de(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=pe(n);break;case"link":t.links.push(me(n))}}}function pe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=fe(n)}}return t}function fe(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new Kg,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=i(n.textContent);t.axis.fromArray(o);break;case"limits":var s=n.getElementsByTagName("max")[0],a=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(a.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function me(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ge(n))}}return t}function ve(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(me(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ge(n))}}return t}function ge(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new Qg,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new Kg,t.obj.fromArray(r);break;case"rotate":t.obj=new Kg,t.obj.fromArray(r),t.angle=Zg.degToRad(r[3])}return t}function ye(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function xe(e){return void 0!==e.build?e.build:e}var be=new Qg,we=new Kg;function _e(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Qg,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),_e(n);break;case"instance_camera":t.instanceCameras.push(s(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Se(n));break;case"instance_light":t.instanceLights.push(s(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Se(n));break;case"instance_node":t.instanceNodes.push(s(n.getAttribute("url")));break;case"matrix":var o=i(n.textContent);t.matrix.multiply(be.fromArray(o).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=i(n.textContent);we.fromArray(o),t.matrix.multiply(be.makeTranslation(we.x,we.y,we.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=i(n.textContent);var a=Zg.degToRad(o[3]);t.matrix.multiply(be.makeRotationAxis(we.fromArray(o),a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=i(n.textContent);t.matrix.scale(we.fromArray(o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Ve.nodes[t.id]=t,t}function Se(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var a=i[o],l=a.getAttribute("symbol"),c=a.getAttribute("target");t.materials[l]=s(c)}break;case"skeleton":t.skeletons.push(s(n.textContent))}}return t}function Te(e,t){var r,n,i=[],o=[];for(r=0;r<e.length;r++){var s=e[r];if(Pe(s))Me(Oe(s),t,i);else if(Ne(s))for(var a=Ve.visualScenes[s].children,l=0;l<a.length;l++){var c=a[l];if("JOINT"===c.type)Me(Oe(c.id),t,i)}else console.error("ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(l=0;l<i.length;l++)if((n=i[l]).bone.name===t[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<i.length;r++)!1===(n=i[r]).processed&&(o.push(n),n.processed=!0);var u=[],h=[];for(r=0;r<o.length;r++)n=o[r],u.push(n.bone),h.push(n.boneInverse);return new xS(u,h)}function Me(e,t,r){e.traverse(function(e){if(!0===e.isBone){for(var n,i=0;i<t.length;i++){var o=t[i];if(o.name===e.name){n=o.boneInverse;break}}void 0===n&&(n=new Qg),r.push({bone:e,boneInverse:n,processed:!1})}})}function Ae(e){for(var t=[],r=e.matrix,n=e.nodes,i=e.type,o=e.instanceCameras,s=e.instanceControllers,a=e.instanceLights,l=e.instanceGeometries,c=e.instanceNodes,u=0,h=n.length;u<h;u++)t.push(Oe(n[u]));for(u=0,h=o.length;u<h;u++){var d=K(o[u]);null!==d&&t.push(d.clone())}for(u=0,h=s.length;u<h;u++)for(var p=O((b=s[u]).id),f=Ce(ue(p.id),b.materials),m=Te(b.skeletons,p.skin.joints),v=0,g=f.length;v<g;v++){var y;(y=f[v]).isSkinnedMesh&&(y.bind(m,p.skin.bindMatrix),y.normalizeSkinWeights()),t.push(y)}for(u=0,h=a.length;u<h;u++){var x=re(a[u]);null!==x&&t.push(x.clone())}for(u=0,h=l.length;u<h;u++){var b;for(v=0,g=(f=Ce(ue((b=l[u]).id),b.materials)).length;v<g;v++)t.push(f[v])}for(u=0,h=c.length;u<h;u++)t.push(Oe(c[u]).clone());if(0===n.length&&1===t.length)y=t[0];else{y="JOINT"===i?new Pb:new mS;for(u=0;u<t.length;u++)y.add(t[u])}return""===y.name&&(y.name="JOINT"===i?e.sid:e.name),y.matrix.copy(r),y.matrix.decompose(y.position,y.quaternion,y.scale),y}function Ee(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var o=t[e[n]];r.push(q(o))}return r}function Ce(e,t){var r=[];for(var n in e){var i=e[n],o=Ee(i.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new bb):o.push(new bw));var s=void 0!==i.data.attributes.skinIndex;if(s)for(var a=0,l=o.length;a<l;a++)o[a].skinning=!0;var c,u=1===o.length?o[0]:o;switch(n){case"lines":c=new FS(i.data,u);break;case"linestrips":c=new Ab(i.data,u);break;case"triangles":case"polylist":c=s?new bS(i.data,u):new Mb(i.data,u)}r.push(c)}return r}function Pe(e){return void 0!==Ve.nodes[e]}function Oe(e){return u(Ve.nodes[e],Ae)}function De(e){var t=new mS;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var i=r[n];t.add(Oe(i.id))}return t}function Ne(e){return void 0!==Ve.visualScenes[e]}function Le(e){return u(Ve.visualScenes[e],De)}if(console.time("ColladaLoader"),0===e.length)return{scene:new ew};console.time("ColladaLoader: DOMParser");var Ie=(new DOMParser).parseFromString(e,"application/xml");console.timeEnd("ColladaLoader: DOMParser");var Re=r(Ie,"COLLADA")[0],Fe=Re.getAttribute("version");console.log("ColladaLoader: File version",Fe);var ke=function(e){return{unit:function(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}(r(e,"unit")[0]),upAxis:function(e){return void 0!==e?e.textContent:"Y_UP"}(r(e,"up_axis")[0])}}(r(Re,"asset")[0]),Ue=new Ow(this.manager);Ue.setPath(t).setCrossOrigin(this.crossOrigin);var Be=[],je={},ze=0,Ve={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("ColladaLoader: Parse"),l(Re,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var i,o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"source":i=o.getAttribute("id"),t.sources[i]=ne(o);break;case"sampler":i=o.getAttribute("id"),t.samplers[i]=h(o);break;case"channel":i=o.getAttribute("target"),t.channels[i]=d(o);break;default:console.log(o)}}Ve.animations[e.getAttribute("id")]=t}),l(Re,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(s(i.getAttribute("url")))}}Ve.clips[e.getAttribute("id")]=t}),l(Re,"library_controllers","controller",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=s(i.getAttribute("source")),t.skin=A(i);break;case"morph":t.id=s(i.getAttribute("source")),console.warn("ColladaLoader: Morph target animation not supported yet.")}}Ve.controllers[e.getAttribute("id")]=t}),l(Re,"library_images","image",function(e){var t={init_from:r(e,"init_from")[0].textContent};Ve.images[e.getAttribute("id")]=t}),l(Re,"library_effects","effect",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=L(i)}}Ve.effects[e.getAttribute("id")]=t}),l(Re,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=s(i.getAttribute("url"))}}Ve.materials[e.getAttribute("id")]=t}),l(Re,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=Y(i)}}Ve.cameras[e.getAttribute("id")]=t}),l(Re,"library_lights","light",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=$(i)}}Ve.lights[e.getAttribute("id")]=t}),l(Re,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(1===o.nodeType){var s=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[s]=ne(o);break;case"vertices":t.vertices=ie(o);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(o));break;default:console.log(o)}}}Ve.geometries[e.getAttribute("id")]=t}}),l(Re,"library_nodes","node",_e),l(Re,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+ze++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(_e(n[i]));Ve.visualScenes[e.getAttribute("id")]=t}),l(Re,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":de(n,t)}}Ve.kinematicsModels[e.getAttribute("id")]=t}),l(Re,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(ye(n))}}Ve.kinematicsScenes[s(e.getAttribute("url"))]=t}),console.timeEnd("ColladaLoader: Parse"),console.time("ColladaLoader: Build"),c(Ve.animations,p),c(Ve.clips,T),c(Ve.controllers,P),c(Ve.images,D),c(Ve.effects,W),c(Ve.materials,X),c(Ve.cameras,Q),c(Ve.lights,te),c(Ve.geometries,ae),c(Ve.visualScenes,De),console.timeEnd("ColladaLoader: Build"),function(){var e=Ve.clips;if(!0===a(e)){if(!1===a(Ve.animations)){var t=[];for(var r in Ve.animations)for(var n=f(r),i=0,o=n.length;i<o;i++)t.push(n[i]);Be.push(new Jb("default",-1,t))}}else for(var r in e)Be.push(M(r))}(),function(){var e=Object.keys(Ve.kinematicsModels)[0],t=Object.keys(Ve.kinematicsScenes)[0],r=Object.keys(Ve.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n=function(e){return u(Ve.kinematicsModels[e],he)}(e),o=function(e){return u(Ve.kinematicsScenes[e],xe)}(t),s=Le(r),a=o.bindJointAxis,l={},c=0,h=a.length;c<h;c++){var d=a[c],p=Re.querySelector('[sid="'+d.target+'"]');if(p){var f=p.parentElement;v(d.jointIndex,f)}}var m=new Qg;je={joints:n&&n.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("ColladaLoader: Joint "+e+" is static.");else{var i=r.object,o=n.axis,s=r.transforms;be.identity();for(var a=0;a<s.length;a++){var c=s[a];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":be.multiply(m.makeRotationAxis(o,Zg.degToRad(t)));break;case"prismatic":be.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":be.multiply(c.obj);break;case"translate":be.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":be.scale(c.obj);break;case"rotate":be.multiply(m.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(be),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var r=t.getAttribute("name"),o=n.joints[e];s.traverse(function(n){n.name===r&&(l[e]={object:n,transforms:function(e){for(var t=[],r=Re.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var o=r.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=i(o.textContent),a=(new Qg).fromArray(s).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"translate":case"scale":var s=i(o.textContent),l=(new Kg).fromArray(s);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":var s=i(o.textContent),l=(new Kg).fromArray(s),c=Zg.degToRad(s[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:c})}}return t}(t),joint:o,position:o.zeroPosition})})}}();var Ge=function(e){return Le(s(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Re,"scene")[0]);return"Z_UP"===ke.upAxis&&Ge.quaternion.setFromEuler(new ty(-Math.PI/2,0,0)),Ge.scale.multiplyScalar(ke.unit),console.timeEnd("ColladaLoader"),{animations:Be,kinematics:je,library:Ve,scene:Ge}}},US.prototype=Object.create(nw.prototype),US.prototype.constructor=US,US.prototype.isCompressedTexture=!0,Object.assign(BS.prototype,{load:function(e,t,r,n){var i=this,o=[],s=new US;s.image=o;var a=new mw(this.manager);function l(l){a.load(e[l],function(e){var r=i._parser(e,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(s.minFilter=Dx),s.format=r.format,s.needsUpdate=!0,t&&t(s))},r,n)}if(a.setPath(this.path),a.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)l(u);else a.load(e,function(e){var r=i._parser(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,a=0;a<n;a++){o[a]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[a].mipmaps.push(r.mipmaps[a*r.mipmapCount+l]),o[a].format=r.format,o[a].width=r.width,o[a].height=r.height}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=Dx),s.format=r.format,s.needsUpdate=!0,t&&t(s)},r,n);return s},setPath:function(e){return this.path=e,this}});var jS=function(){this._parser=jS.parse};function zS(e,t){Ab.call(this,e,t),this.type="LineLoop"}jS.prototype=Object.create(BS.prototype),jS.prototype.constructor=jS,jS.parse=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,r,n){for(var i=r*n*4,o=new Uint8Array(e,t,i),s=new Uint8Array(i),a=0,l=0,c=0;c<n;c++)for(var u=0;u<r;u++){var h=o[l],d=o[++l],p=o[++l],f=o[++l];l++,s[a]=p,s[++a]=d,s[++a]=h,s[++a]=f,a++}return s}var o,s=n("DXT1"),a=n("DXT3"),l=n("DXT5"),c=n("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!u[20])return console.error("DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var h=u[21],d=!1;switch(h){case s:o=8,r.format=Zx;break;case a:o=16,r.format=Qx;break;case l:o=16,r.format=Kx;break;case c:o=8,r.format=nb;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("DDSLoader.parse: Unsupported FourCC code ",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(h)),r;d=!0,o=64,r.format=Hx}r.mipmapCount=1,131072&u[2]&&!1!==t&&(r.mipmapCount=Math.max(1,u[7]));var p=u[28];if(r.isCubemap=!!(512&p),r.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("DDSLoader.parse: Incomplete cubemap faces"),r;r.width=u[4],r.height=u[3];for(var f=u[1]+4,m=r.isCubemap?6:1,v=0;v<m;v++)for(var g=r.width,y=r.height,x=0;x<r.mipmapCount;x++){if(d)var b=(w=i(e,f,g,y)).length;else{b=Math.max(4,g)/4*Math.max(4,y)/4*o;var w=new Uint8Array(e,f,b)}var _={data:w,width:g,height:y};r.mipmaps.push(_),f+=b,g=Math.max(g>>1,1),y=Math.max(y>>1,1)}return r},zS.prototype=Object.assign(Object.create(Ab.prototype),{constructor:zS,isLineLoop:!0});!function(){function e(e){this.manager=void 0!==e?e:pw}function t(e,t){var r={},n=e.material.uniforms;for(var i in n){var o=n[i];if(o.semantic){var s=o.node,a=e;s&&(a=t[s]),r[i]={semantic:o.semantic,sourceNode:a,targetNode:e,uniform:o}}}this.boundUniforms=r,this._m4=new Qg}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,t,r,n){var i=this,o=this.path&&"string"==typeof this.path?this.path:Nw.extractUrlBase(e),s=new mw(i.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){i.parse(e,o,t)},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e},parse:function(e,t,i){var s,a={};Nw.decodeText(new Uint8Array(e,0,4))===n.magic?(a[r.KHR_BINARY_GLTF]=new o(e),s=a[r.KHR_BINARY_GLTF].content):s=Nw.decodeText(new Uint8Array(e));var l=JSON.parse(s);l.extensionsUsed&&l.extensionsUsed.indexOf(r.KHR_MATERIALS_COMMON)>=0&&(a[r.KHR_MATERIALS_COMMON]=new function(e){this.name=r.KHR_MATERIALS_COMMON,this.lights={};var t=(e.extensions&&e.extensions[r.KHR_MATERIALS_COMMON]||{}).lights||{};for(var n in t){var i,o=t[n],s=o[o.type],a=(new ay).fromArray(s.color);switch(o.type){case"directional":(i=new PS(a)).position.set(0,0,1);break;case"point":i=new ES(a);break;case"spot":(i=new DS(a)).position.set(0,0,1);break;case"ambient":i=new RS(a)}i&&(this.lights[n]=i)}}(l)),console.time("LegacyGLTFLoader"),new T(l,a,{path:t||this.path,crossOrigin:this.crossOrigin}).parse(function(e,t,r,n){console.timeEnd("LegacyGLTFLoader"),i({scene:e,scenes:t,cameras:r,animations:n})})}},e.Shaders={update:function(){console.warn("LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},t.prototype.update=function(e,t){var r=this.boundUniforms;for(var n in r){var i=r[n];switch(i.semantic){case"MODELVIEW":i.uniform.value.multiplyMatrices(t.matrixWorldInverse,i.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var o=i.uniform.value;this._m4.multiplyMatrices(t.matrixWorldInverse,i.sourceNode.matrixWorld),o.getNormalMatrix(this._m4);break;case"PROJECTION":i.uniform.value.copy(t.projectionMatrix);break;case"JOINTMATRIX":for(var s=i.uniform.value,a=0;a<s.length;a++)s[a].getInverse(i.sourceNode.matrixWorld).multiply(i.targetNode.skeleton.bones[a].matrixWorld).multiply(i.targetNode.skeleton.boneInverses[a]).multiply(i.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+i.semantic)}}},e.Animations={update:function(){console.warn("LegacyGLTFLoader.Animation has been deprecated. Use AnimationMixer instead.")}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"};var n={magic:"glTF",version:1,contentFormat:0},i=20;function o(e){this.name=r.KHR_BINARY_GLTF;var t=new DataView(e,0,i),o={magic:Nw.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0),contentLength:t.getUint32(12,!0),contentFormat:t.getUint32(16,!0)};for(var s in n){var a=n[s];if(o[s]!==a)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',s,a)}var l=new Uint8Array(e,i,o.contentLength);this.header=o,this.content=Nw.decodeText(l),this.body=e.slice(i+o.contentLength,o.length)}o.prototype.loadShader=function(e,t){var n=t[e.extensions[r.KHR_BINARY_GLTF].bufferView],i=new Uint8Array(n);return Nw.decodeText(i)};var s={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},a={5126:Number,35675:ny,35676:Qg,35664:hy,35665:Kg,35666:fy,35678:nw},l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:Cx,9729:Dx,9984:Px,9985:Nx,9986:Ox,9987:Lx},u={33071:Ax,33648:Ex,10497:Mx},h={6406:Vx,6407:Gx,6408:Hx,6409:Wx,6410:Xx},d={5121:Ix,32819:Ux,32820:Bx,33635:jx},p={1028:Fy,1029:Ry},f={512:ax,513:cx,514:hx,515:ux,516:dx,517:px,518:dx,519:lx},m={32774:qy,32778:Yy,32779:Jy},v={0:Zy,1:Qy,768:Ky,769:$y,770:ex,771:tx,772:rx,773:nx,774:ix,775:ox,776:sx},g={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={scale:"scale",translation:"position",rotation:"quaternion"},x={LINEAR:2301,STEP:ob},b={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function w(e,t,r){var n;if(!e)return Promise.resolve();var i=[];if("[object Array]"===Object.prototype.toString.call(e)){n=[];for(var o=e.length,s=0;s<o;s++){(l=t.call(r||this,e[s],s))&&(i.push(l),l instanceof Promise?l.then((function(e,t){n[e]=t}).bind(this,s)):n[s]=l)}}else for(var a in n={},e){var l;if(e.hasOwnProperty(a))(l=t.call(r||this,e[a],a))&&(i.push(l),l instanceof Promise?l.then((function(e,t){n[e]=t}).bind(this,a)):n[a]=l)}return Promise.all(i).then(function(){return n})}function _(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:(t||"")+e}function S(e){this.isDeferredShaderMaterial=!0,this.params=e}function T(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}},update:function(t,r){for(var n in e){var i=e[n];i.update&&i.update(t,r)}}}}}S.prototype.create=function(){var e=ow.clone(this.params.uniforms);for(var t in this.params.uniforms){var r=this.params.uniforms[t];r.value instanceof nw&&(e[t].value=r.value,e[t].value.needsUpdate=!0),e[t].semantic=r.semantic,e[t].node=r.node}return this.params.uniforms=e,new Mw(this.params)},T.prototype._withDependencies=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i="load"+n.charAt(0).toUpperCase()+n.slice(1),o=this.cache.get(n);if(void 0!==o)t[n]=o;else if(this[i]){var s=this[i]();this.cache.add(n,s),t[n]=s}}return w(t,function(e){return e})},T.prototype.parse=function(e){var t=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(r){var n=[];for(var i in r.scenes)n.push(r.scenes[i]);var o=void 0!==t.scene?r.scenes[t.scene]:n[0],s=[];for(var i in r.cameras){var a=r.cameras[i];s.push(a)}var l=[];for(var i in r.animations)l.push(r.animations[i]);e(o,n,s,l)})},T.prototype.loadShaders=function(){var e=this.json,t=this.extensions,n=this.options;return this._withDependencies(["bufferViews"]).then(function(i){return w(e.shaders,function(e){return e.extensions&&e.extensions[r.KHR_BINARY_GLTF]?t[r.KHR_BINARY_GLTF].loadShader(e,i.bufferViews):new Promise(function(t){var r=new mw;r.setResponseType("text"),r.load(_(e.uri,n.path),function(e){t(e)})})})})},T.prototype.loadBuffers=function(){var e=this.json,t=this.extensions,n=this.options;return w(e.buffers,function(e,i){return"binary_glTF"===i?t[r.KHR_BINARY_GLTF].body:"arraybuffer"===e.type||void 0===e.type?new Promise(function(t){var r=new mw;r.setResponseType("arraybuffer"),r.load(_(e.uri,n.path),function(e){t(e)})}):void console.warn("LegacyGLTFLoader: "+e.type+" buffer type is not supported")})},T.prototype.loadBufferViews=function(){var e=this.json;return this._withDependencies(["buffers"]).then(function(t){return w(e.bufferViews,function(e){var r=t.buffers[e.buffer],n=void 0!==e.byteLength?e.byteLength:0;return r.slice(e.byteOffset,e.byteOffset+n)})})},T.prototype.loadAccessors=function(){var e=this.json;return this._withDependencies(["bufferViews"]).then(function(t){return w(e.accessors,function(e){var r=t.bufferViews[e.bufferView],n=g[e.type],i=l[e.componentType],o=i.BYTES_PER_ELEMENT,s=o*n;if(e.byteStride&&e.byteStride!==s){var a=new i(r);return new sS(new iS(a,e.byteStride/o),n,e.byteOffset/o)}return new my(a=new i(r,e.byteOffset,e.count*n),n)})})},T.prototype.loadTextures=function(){var e=this.json,t=(this.extensions,this.options);return this._withDependencies(["bufferViews"]).then(function(n){return w(e.textures,function(i){if(i.source)return new Promise(function(o){var s=e.images[i.source],a=s.uri,l=!1;if(s.extensions&&s.extensions[r.KHR_BINARY_GLTF]){var p=s.extensions[r.KHR_BINARY_GLTF],f=n.bufferViews[p.bufferView],m=new Blob([f],{type:p.mimeType});a=URL.createObjectURL(m),l=!0}var v=Dw.Handlers.get(a);null===v&&(v=new Ow),v.setCrossOrigin(t.crossOrigin),v.load(_(a,t.path),function(t){if(l&&URL.revokeObjectURL(a),t.flipY=!1,void 0!==i.name&&(t.name=i.name),t.format=void 0!==i.format?h[i.format]:Hx,void 0!==i.internalFormat&&t.format!==h[i.internalFormat]&&console.warn("LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==i.type?d[i.type]:Ix,i.sampler){var r=e.samplers[i.sampler];t.magFilter=c[r.magFilter]||Dx,t.minFilter=c[r.minFilter]||Ox,t.wrapS=u[r.wrapS]||Mx,t.wrapT=u[r.wrapT]||Mx}o(t)},void 0,function(){l&&URL.revokeObjectURL(a),o()})})})})},T.prototype.loadMaterials=function(){var e=this.json;return this._withDependencies(["shaders","textures"]).then(function(t){return w(e.materials,function(n){var i,o,l={},c={};if(n.extensions&&n.extensions[r.KHR_MATERIALS_COMMON]&&(o=n.extensions[r.KHR_MATERIALS_COMMON]),o){var u=["ambient","emission","transparent","transparency","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":i=bw,u.push("diffuse","specular","shininess");break;case"LAMBERT":i=yw,u.push("diffuse");break;case"CONSTANT":default:i=xb}u.forEach(function(e){void 0!==o.values[e]&&(l[e]=o.values[e])}),(o.doubleSided||l.doubleSided)&&(c.side=ky),(o.transparent||l.transparent)&&(c.transparent=!0,c.opacity=void 0!==l.transparency?l.transparency:1)}else if(void 0===n.technique)i=bw,Object.assign(l,n.values);else{i=S;var h=e.techniques[n.technique];c.uniforms={};var d=e.programs[h.program];if(d){c.fragmentShader=t.shaders[d.fragmentShader],c.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",d.fragmentShader),i=bw);var g=t.shaders[d.vertexShader];g||(console.warn("ERROR: Missing vertex shader definition:",d.vertexShader),i=bw),c.vertexShader=function(e,t){var r={};for(var n in t.attributes){var i=t.attributes[n],o=(h=t.parameters[i]).type,s=h.semantic;r[n]={type:o,semantic:s}}var a=t.parameters,l=t.attributes,c={};for(var n in r){var u=a[i=l[n]];(s=u.semantic)&&(c[n]=u)}for(var i in c){s=(h=c[i]).semantic;var h,d=new RegExp("\\b"+i+"\\b","g");switch(s){case"POSITION":e=e.replace(d,"position");break;case"NORMAL":e=e.replace(d,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":e=e.replace(d,"uv");break;case"TEXCOORD_1":e=e.replace(d,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":e=e.replace(d,"color");break;case"WEIGHT":e=e.replace(d,"skinWeight");break;case"JOINT":e=e.replace(d,"skinIndex")}}return e}(g,h);var y=h.uniforms;for(var x in y){var w=y[x],_=h.parameters[w],T=_.type;if(!a[T])throw new Error("Unknown shader uniform param type: "+T);var M,A=_.count;void 0!==n.values&&(M=n.values[w]);var E=new a[T],C=_.semantic,P=_.node;switch(T){case s.FLOAT:E=_.value,"transparency"==w&&(c.transparent=!0),void 0!==M&&(E=M);break;case s.FLOAT_VEC2:case s.FLOAT_VEC3:case s.FLOAT_VEC4:case s.FLOAT_MAT3:_&&_.value&&E.fromArray(_.value),M&&E.fromArray(M);break;case s.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case s.FLOAT_MAT4:if(A){E=new Array(A);for(var O=0;O<A;O++)E[O]=new a[T];if(_&&_.value){var D=_.value;E.fromArray(D)}M&&E.fromArray(M)}else{if(_&&_.value){var N=_.value;E.fromArray(N)}M&&E.fromArray(M)}break;case s.SAMPLER_2D:E=void 0!==M?t.textures[M]:void 0!==_.value?t.textures[_.value]:null}c.uniforms[x]={value:E,semantic:C,node:P}}for(var L=h.states||{},I=L.enable||[],R=L.functions||{},F=!1,k=!1,U=!1,B=0,j=I.length;B<j;B++){var z=I[B];switch(b[z]){case"CULL_FACE":F=!0;break;case"DEPTH_TEST":k=!0;break;case"BLEND":U=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+z)}}c.side=F?void 0!==R.cullFace?p[R.cullFace]:Ry:ky,c.depthTest=k,c.depthFunc=void 0!==R.depthFunc?f[R.depthFunc]:cx,c.depthWrite=void 0===R.depthMask||R.depthMask[0],c.blending=U?Xy:zy,c.transparent=U;var V=R.blendEquationSeparate;void 0!==V?(c.blendEquation=m[V[0]],c.blendEquationAlpha=m[V[1]]):(c.blendEquation=qy,c.blendEquationAlpha=qy);var G=R.blendFuncSeparate;void 0!==G?(c.blendSrc=v[G[0]],c.blendDst=v[G[1]],c.blendSrcAlpha=v[G[2]],c.blendDstAlpha=v[G[3]]):(c.blendSrc=Qy,c.blendDst=Zy,c.blendSrcAlpha=Qy,c.blendDstAlpha=Zy)}}Array.isArray(l.diffuse)?c.color=(new ay).fromArray(l.diffuse):"string"==typeof l.diffuse&&(c.map=t.textures[l.diffuse]),delete c.diffuse,"string"==typeof l.reflective&&(c.envMap=t.textures[l.reflective]),"string"==typeof l.bump&&(c.bumpMap=t.textures[l.bump]),Array.isArray(l.emission)?i===xb?c.color=(new ay).fromArray(l.emission):c.emissive=(new ay).fromArray(l.emission):"string"==typeof l.emission&&(i===xb?c.map=t.textures[l.emission]:c.emissiveMap=t.textures[l.emission]),Array.isArray(l.specular)?c.specular=(new ay).fromArray(l.specular):"string"==typeof l.specular&&(c.specularMap=t.textures[l.specular]),void 0!==l.shininess&&(c.shininess=l.shininess);var H=new i(c);return void 0!==n.name&&(H.name=n.name),H})})},T.prototype.loadMeshes=function(){var e=this.json;return this._withDependencies(["accessors","materials"]).then(function(t){return w(e.meshes,function(r){var n=new mS;void 0!==r.name&&(n.name=r.name),r.extras&&(n.userData=r.extras);var i=r.primitives||[];for(var o in i){var a=i[o];if(a.mode===s.TRIANGLES||void 0===a.mode){var l=new Cy,c=a.attributes;for(var u in c){if(!(f=c[u]))return;var h=t.accessors[f];switch(u){case"POSITION":l.addAttribute("position",h);break;case"NORMAL":l.addAttribute("normal",h);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":l.addAttribute("uv",h);break;case"TEXCOORD_1":l.addAttribute("uv2",h);break;case"COLOR_0":case"COLOR0":case"COLOR":l.addAttribute("color",h);break;case"WEIGHT":l.addAttribute("skinWeight",h);break;case"JOINT":l.addAttribute("skinIndex",h);break;default:if(!a.material)break;if(!(v=e.materials[a.material]).technique)break;var d=e.techniques[v.technique].parameters||{};for(var p in d)d[p].semantic===u&&l.addAttribute(p,h)}}a.indices&&l.setIndex(t.accessors[a.indices]),(m=new Mb(l,v=void 0!==t.materials?t.materials[a.material]:new bw({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:Ry}))).castShadow=!0,m.name="0"===o?n.name:n.name+o,a.extras&&(m.userData=a.extras),n.add(m)}else if(a.mode===s.LINES){l=new Cy,c=a.attributes;for(var u in c){var f;if(!(f=c[u]))return;h=t.accessors[f];switch(u){case"POSITION":l.addAttribute("position",h);break;case"COLOR_0":case"COLOR0":case"COLOR":l.addAttribute("color",h)}}var m,v=t.materials[a.material];a.indices?(l.setIndex(t.accessors[a.indices]),m=new FS(l,v)):m=new Ab(l,v),m.name="0"===o?n.name:n.name+o,a.extras&&(m.userData=a.extras),n.add(m)}else console.warn("Only triangular and line primitives are supported")}return n})})},T.prototype.loadCameras=function(){return w(this.json.cameras,function(e){if("perspective"==e.type&&e.perspective){var t=e.perspective.yfov,r=void 0!==e.perspective.aspectRatio?e.perspective.aspectRatio:1,n=t*r,i=new Kb(Zg.radToDeg(n),r,e.perspective.znear||1,e.perspective.zfar||2e6);return void 0!==e.name&&(i.name=e.name),e.extras&&(i.userData=e.extras),i}if("orthographic"==e.type&&e.orthographic){i=new tw(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar);return void 0!==e.name&&(i.name=e.name),e.extras&&(i.userData=e.extras),i}})},T.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then(function(t){return w(e.skins,function(e){var r=new Qg;return void 0!==e.bindShapeMatrix&&r.fromArray(e.bindShapeMatrix),{bindShapeMatrix:r,jointNames:e.jointNames,inverseBindMatrices:t.accessors[e.inverseBindMatrices]}})})},T.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then(function(t){return w(e.animations,function(e,r){var n=[];for(var i in e.channels){var o=e.channels[i],s=e.samplers[o.sampler];if(s){var a=o.target,l=a.id,c=void 0!==e.parameters?e.parameters[s.input]:s.input,u=void 0!==e.parameters?e.parameters[s.output]:s.output,h=t.accessors[c],d=t.accessors[u],p=t.nodes[l];if(p){p.updateMatrix(),p.matrixAutoUpdate=!0;var f=y[a.path]===y.rotation?jb:Vb,m=p.name?p.name:p.uuid,v=void 0!==s.interpolation?x[s.interpolation]:2301;n.push(new f(m+"."+y[a.path],Xb.arraySlice(h.array,0),Xb.arraySlice(d.array,0),v))}}}return new Jb(l=void 0!==e.name?e.name:"animation_"+r,void 0,n)})})},T.prototype.loadNodes=function(){var e=this.json,t=this.extensions,n=this;return w(e.nodes,function(e){var t,r=new Qg;return e.jointName?((t=new Pb).name=void 0!==e.name?e.name:e.jointName,t.jointName=e.jointName):(t=new oy,void 0!==e.name&&(t.name=e.name)),e.extras&&(t.userData=e.extras),void 0!==e.matrix?(r.fromArray(e.matrix),t.applyMatrix(r)):(void 0!==e.translation&&t.position.fromArray(e.translation),void 0!==e.rotation&&t.quaternion.fromArray(e.rotation),void 0!==e.scale&&t.scale.fromArray(e.scale)),t}).then(function(i){return n._withDependencies(["meshes","skins","cameras"]).then(function(n){return w(i,function(o,s){var a=e.nodes[s];if(void 0!==a.meshes)for(var l in a.meshes){var c=a.meshes[l],u=n.meshes[c];if(void 0!==u)for(var h in u.children){var d,p=u.children[h],f=p.material,m=p.geometry,v=p.userData,g=p.name;switch(f.isDeferredShaderMaterial?f=y=f.create():y=f,p.type){case"LineSegments":p=new FS(m,y);break;case"LineLoop":p=new zS(m,y);break;case"Line":p=new Ab(m,y);break;default:p=new Mb(m,y)}if(p.castShadow=!0,p.userData=v,p.name=g,a.skin&&(d=n.skins[a.skin]),d){var y,x=function(e){for(var t=Object.keys(i),r=0,n=t.length;r<n;r++){var o=i[t[r]];if(o.jointName===e)return o}return null},b=m;(y=f).skinning=!0,(p=new bS(b,y)).castShadow=!0,p.userData=v,p.name=g;for(var w=[],_=[],S=0,T=d.jointNames.length;S<T;S++){var M=d.jointNames[S],A=x(M);if(A){w.push(A);var E=d.inverseBindMatrices.array,C=(new Qg).fromArray(E,16*S);_.push(C)}else console.warn("WARNING: joint: '"+M+"' could not be found")}p.bind(new xS(w,_),d.bindShapeMatrix);var P=function(t,r,n){var o=t[n];if(void 0!==o)for(var s=0,a=o.length;s<a;s++){var l=o[s],c=i[l],u=e.nodes[l];void 0!==c&&!0===c.isBone&&void 0!==u&&(r.add(c),P(u,c,"children"))}};P(a,p,"skeletons")}o.add(p)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+c+'".')}if(void 0!==a.camera){var O=n.cameras[a.camera];o.add(O)}if(a.extensions&&a.extensions[r.KHR_MATERIALS_COMMON]&&a.extensions[r.KHR_MATERIALS_COMMON].light){var D=t[r.KHR_MATERIALS_COMMON].lights[a.extensions[r.KHR_MATERIALS_COMMON].light];o.add(D)}return o})})})},T.prototype.loadScenes=function(){var e=this.json;function r(t,n,i){var o=i[t];n.add(o);var s=e.nodes[t];if(s.children)for(var a=s.children,l=0,c=a.length;l<c;l++){r(a[l],o,i)}}return this._withDependencies(["nodes"]).then(function(n){return w(e.scenes,function(e){var i=new ew;void 0!==e.name&&(i.name=e.name),e.extras&&(i.userData=e.extras);for(var o=e.nodes||[],s=0,a=o.length;s<a;s++){r(o[s],i,n.nodes)}return i.traverse(function(e){e.material&&e.material.isRawShaderMaterial&&(e.gltfShader=new t(e,n.nodes),e.onBeforeRender=function(e,t,r){this.gltfShader.update(t,r)})}),i})})}}();var VS=function(e){this.timeLoaded=0,this.manager=e||pw,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=ab,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}};function GS(e){this.manager=void 0!==e?e:pw,this._parser=null}VS.prototype={constructor:VS,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.load(e,function(e){i.decodeDracoFile(e,t)},r,n)},setPath:function(e){this.path=e},setCrossOrigin:function(e){this.crossOrigin=e},setVerbosity:function(e){this.verbosity=e},setDrawMode:function(e){this.drawMode=e},setSkipDequantization:function(e,t){var r=!0;void 0!==t&&(r=t),this.getAttributeOptions(e).skipDequantization=r},decodeDracoFile:function(e,t,r){var n=this;VS.getDecoderModule().then(function(i){n.decodeDracoFileInternal(e,i.decoder,t,r||{})})},decodeDracoFileInternal:function(e,t,r,n){var i=new t.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength);var o=new t.Decoder,s=o.GetEncodedGeometryType(i);if(s==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(s!=t.POINT_CLOUD){var a="DRACOLoader: Unknown geometry type.";throw console.error(a),new Error(a)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(t,o,s,i,n))},addAttributeToGeometry:function(e,t,r,n,i,o,s){if(0===i.ptr){var a="DRACOLoader: No attribute "+n;throw console.error(a),new Error(a)}var l=i.num_components(),c=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(r,i,c);var u=r.num_points()*l;s[n]=new Float32Array(u);for(var h=0;h<u;h++)s[n][h]=c.GetValue(h);o.addAttribute(n,new Sy(s[n],l)),e.destroy(c)},convertDracoGeometryTo3JS:function(e,t,r,n,i){var o,s;!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var a=performance.now();if(r===e.TRIANGULAR_MESH?(o=new e.Mesh,s=t.DecodeBufferToMesh(n,o)):(o=new e.PointCloud,s=t.DecodeBufferToPointCloud(n,o)),!s.ok()||0==o.ptr){var l="DRACOLoader: Decoding failed: ";throw l+=s.error_msg(),console.error(l),e.destroy(t),e.destroy(o),new Error(l)}var c,u=performance.now();e.destroy(n),r==e.TRIANGULAR_MESH?(c=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+c.toString())):c=0;var h=o.num_points(),d=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+h.toString()),console.log("Number of attributes loaded: "+d.toString()));var p=t.GetAttributeId(o,e.POSITION);if(-1==p){l="DRACOLoader: No position attribute found.";throw console.error(l),e.destroy(t),e.destroy(o),new Error(l)}var f=t.GetAttribute(o,p),m={},v=new Cy;for(var g in this.nativeAttributeMap)if(void 0===i[g]){var y=t.GetAttributeId(o,e[this.nativeAttributeMap[g]]);if(-1!==y){this.verbosity>0&&console.log("Loaded "+g+" attribute.");var x=t.GetAttribute(o,y);this.addAttributeToGeometry(e,t,o,g,x,v,m)}}for(var g in i){var b=i[g];x=t.GetAttributeByUniqueId(o,b);this.addAttributeToGeometry(e,t,o,g,x,v,m)}if(r==e.TRIANGULAR_MESH)if(this.drawMode===lb){var w=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(o,w);m.indices=new Uint32Array(w.size());for(var _=0;_<w.size();++_)m.indices[_]=w.GetValue(_);e.destroy(w)}else{var S=3*c;m.indices=new Uint32Array(S);var T=new e.DracoInt32Array;for(_=0;_<c;++_){t.GetFaceFromMesh(o,_,T);var M=3*_;m.indices[M]=T.GetValue(0),m.indices[M+1]=T.GetValue(1),m.indices[M+2]=T.GetValue(2)}e.destroy(T)}v.drawMode=this.drawMode,r==e.TRIANGULAR_MESH&&v.setIndex(new(m.indices.length>65535?_y:by)(m.indices,1));var A=new e.AttributeQuantizationTransform;if(A.InitFromAttribute(f)){v.attributes.position.isQuantized=!0,v.attributes.position.maxRange=A.range(),v.attributes.position.numQuantizationBits=A.quantization_bits(),v.attributes.position.minValues=new Float32Array(3);for(_=0;_<3;++_)v.attributes.position.minValues[_]=A.min_value(_)}return e.destroy(A),e.destroy(t),e.destroy(o),this.decode_time=u-a,this.import_time=performance.now()-u,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),v},isVersionSupported:function(e,t){VS.getDecoderModule().then(function(r){t(r.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},VS.decoderPath="./",VS.decoderConfig={},VS.decoderModulePromise=null,VS.setDecoderPath=function(e){VS.decoderPath=e},VS.setDecoderConfig=function(e){var t=VS.decoderConfig.wasmBinary;VS.decoderConfig=e||{},VS.releaseDecoderModule(),t&&(VS.decoderConfig.wasmBinary=t)},VS.releaseDecoderModule=function(){VS.decoderModulePromise=null},VS.getDecoderModule=function(){var e=this,t=VS.decoderPath,r=VS.decoderConfig,n=VS.decoderModulePromise;return n||("undefined"!=typeof DracoDecoderModule?n=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?n=VS._loadScript(t+"draco_decoder.js"):(r.wasmBinaryFile=t+"draco_decoder.wasm",n=VS._loadScript(t+"draco_wasm_wrapper.js").then(function(){return VS._loadArrayBuffer(r.wasmBinaryFile)}).then(function(e){r.wasmBinary=e})),n=n.then(function(){return new Promise(function(t){r.onModuleLoaded=function(r){e.timeLoaded=performance.now(),t({decoder:r})},DracoDecoderModule(r)})}),VS.decoderModulePromise=n,n)},VS._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var r=document.getElementsByTagName("head")[0],n=document.createElement("script");return n.id="decoder_script",n.type="text/javascript",n.src=e,new Promise(function(e){n.onload=e,r.appendChild(n)})},VS._loadArrayBuffer=function(e){var t=new mw;return t.setResponseType("arraybuffer"),new Promise(function(r,n){t.load(e,r,void 0,n)})},Object.assign(GS.prototype,{load:function(e,t,r,n){var i=this,o=new K_,s=new mw(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){var r=i._parser(e);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:Ax,o.wrapT=void 0!==r.wrapT?r.wrapT:Ax,o.magFilter=void 0!==r.magFilter?r.magFilter:Dx,o.minFilter=void 0!==r.minFilter?r.minFilter:Lx,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=Dx),o.needsUpdate=!0,t&&t(o,r))},r,n),o}});var HS=function(e){this.manager=void 0!==e?e:pw};HS.prototype=Object.create(GS.prototype),HS.prototype._parser=function(e){var t=65536,r=t>>3,n=14,i=65537,o=1<<n,s=o-1,a=59,l=63,c=2+l-a,u=8,h=4,d=4,p=2,f=1;var m={l:0,c:0,lc:0};function v(e,t,r,n,i){for(;r<e;)t=t<<8|I(n,i),r+=8;r-=e,m.l=t>>r&(1<<e)-1,m.c=t,m.lc=r}var g=new Array(59);function y(e,t,r,n,o,s,u){for(var h=r,d=0,p=0;o<=s;o++){if(h.value-r.value>n)return!1;v(6,d,p,e,h);var f=m.l;if(d=m.c,p=m.lc,u[o]=f,f==l){if(h.value-r.value>n)throw"Something wrong with hufUnpackEncTable";v(8,d,p,e,h);var y=m.l+c;if(d=m.c,p=m.lc,o+y>s+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)u[o++]=0;o--}else if(f>=a){if(o+(y=f-a+2)>s+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)u[o++]=0;o--}}!function(e){for(var t=0;t<=58;++t)g[t]=0;for(t=0;t<i;++t)g[e[t]]+=1;var r=0;for(t=58;t>0;--t){var n=r+g[t]>>1;g[t]=r,r=n}for(t=0;t<i;++t){var o=e[t];o>0&&(e[t]=o|g[o]++<<6)}}(u)}function x(e){return 63&e}function b(e){return e>>6}var w={c:0,lc:0};function _(e,t,r,n){e=e<<8|I(r,n),t+=8,w.c=e,w.lc=t}var S={c:0,lc:0};function T(e,t,r,n,i,o,s,a,l,c){if(e==t){n<8&&(_(r,n,i,s),r=w.c,n=w.lc);var u=r>>(n-=8);if(out+u>oe)throw"Issue with getCode";for(var h=out[-1];u-- >0;)a[l.value++]=h}else{if(!(l.value<c))throw"Issue with getCode";a[l.value++]=e}S.c=r,S.lc=n}function M(e){var t=function(e){return 65535&e}(e);return t>32767?t-65536:t}var A={a:0,b:0};function E(e,t){var r=M(e),n=M(t),i=r+(1&n)+(n>>1),o=i,s=i-n;A.a=o,A.b=s}function C(e,t,r,n,i,o,s){for(var a,l=r>i?i:r,c=1;c<=l;)c<<=1;for(a=c>>=1,c>>=1;c>=1;){for(var u,h,d,p,f=0,m=f+o*(i-a),v=o*c,g=o*a,y=n*c,x=n*a;f<=m;f+=g){for(var b=f,w=f+n*(r-a);b<=w;b+=x){var _=b+y,S=(T=b+v)+y;E(t[b+e],t[T+e]),u=A.a,d=A.b,E(t[_+e],t[S+e]),h=A.a,p=A.b,E(u,h),t[b+e]=A.a,t[_+e]=A.b,E(d,p),t[T+e]=A.a,t[S+e]=A.b}if(r&c){var T=b+v;E(t[b+e],t[T+e]),u=A.a,t[T+e]=A.b,t[b+e]=u}}if(i&c)for(b=f,w=f+n*(r-a);b<=w;b+=x){_=b+y;E(t[b+e],t[_+e]),u=A.a,t[_+e]=A.b,t[b+e]=u}a=c,c>>=1}return f}function P(e,t,r,a,l,c,u){var h=r.value,d=L(t,r),p=L(t,r);r.value+=4;var f=L(t,r);if(r.value+=4,d<0||d>=i||p<0||p>=i)throw"Something wrong with HUF_ENCSIZE";var m=new Array(i),v=new Array(o);if(function(e){for(var t=0;t<o;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(v),y(e,0,r,a-(r.value-h),d,p,m),f>8*(a-(r.value-h)))throw"Something wrong with hufUncompress";!function(e,t,r,i){for(;t<=r;t++){var o=b(e[t]),s=x(e[t]);if(o>>s)throw"Invalid table entry";if(s>n){if((u=i[o>>s-n]).len)throw"Invalid table entry";if(u.lit++,u.p){var a=u.p;u.p=new Array(u.lit);for(var l=0;l<u.lit-1;++l)u.p[l]=a[l]}else u.p=new Array(1);u.p[u.lit-1]=t}else if(s){var c=0;for(l=1<<n-s;l>0;l--){var u;if((u=i[(o<<n-s)+c]).len||u.p)throw"Invalid table entry";u.len=s,u.lit=t,c++}}}}(m,d,p,v),function(e,t,r,i,o,a,l,c,u,h){for(var d=0,p=0,f=c,m=Math.trunc(o.value+(a+7)/8);o.value<m;)for(_(d,p,r,o),d=w.c,p=w.lc;p>=n;)if((M=t[d>>p-n&s]).len)p-=M.len,T(M.lit,l,d,p,r,0,o,u,h,f),d=S.c,p=S.lc;else{if(!M.p)throw"hufDecode issues";var v;for(v=0;v<M.lit;v++){for(var g=x(e[M.p[v]]);p<g&&o.value<m;)_(d,p,r,o),d=w.c,p=w.lc;if(p>=g&&b(e[M.p[v]])==(d>>p-g&(1<<g)-1)){p-=g,T(M.p[v],l,d,p,r,0,o,u,h,f),d=S.c,p=S.lc;break}}if(v==M.lit)throw"hufDecode issues"}var y=8-a&7;for(d>>=y,p-=y;p>0;){var M;if(!(M=t[d<<n-p&s]).len)throw"hufDecode issues";p-=M.len,T(M.lit,l,d,p,r,0,o,u,h,f),d=S.c,p=S.lc}}(m,v,e,0,r,f,p,u,l,c)}function O(e,n,i,o,s,a,l,c,u,h){var d=new Uint8Array(r),p=U(o,s),f=U(o,s);if(f>=r)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(p<=f)for(var m=0;m<f-p+1;m++)d[m+p]=R(o,s);var v=new Uint16Array(t);!function(e,r){for(var n=0,i=0;i<t;++i)(0==i||e[i>>3]&1<<(7&i))&&(r[n++]=i);for(var o=n-1;n<t;)r[n++]=0}(d,v);P(i,o,s,L(o,s),e,n,a);var g=new Array(l),y=0;for(m=0;m<l;m++){c[m];g[m]={},g[m].start=y,g[m].end=g[m].start,g[m].nx=u,g[m].ny=h,g[m].size=1,y+=g[m].nx*g[m].ny*g[m].size}var x=0;for(m=0;m<l;m++)for(var b=0;b<g[m].size;++b)x+=C(b+x,e,g[m].nx,g[m].size,g[m].ny,g[m].nx*g[m].size);return function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(v,e,y),!0}function D(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var i=(new TextDecoder).decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,i}function N(e,t){var r=e.getUint32(0,!0);return t.value=t.value+u,r}function L(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+d,r}function I(e,t){var r=e[t.value];return t.value=t.value+f,r}function R(e,t){var r=e.getUint8(t.value);return t.value=t.value+f,r}function F(e,t){var r=e.getFloat32(t.value,!0);return t.value+=h,r}function k(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function U(e,t){var r=e.getUint16(t.value,!0);return t.value+=p,r}function B(e,t){return k(U(e,t))}function j(e,t,r,n,i){if("string"==n||"iccProfile"==n)return function(e,t,r){var n=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,n}(t,r,i);if("chlist"==n)return function(e,t,r,n){for(var i=r.value,o=[];r.value<i+n-1;){var s=D(t,r),a=L(e,r),l=R(e,r);r.value+=3;var c=L(e,r),u=L(e,r);o.push({name:s,pixelType:a,pLinear:l,xSampling:c,ySampling:u})}return r.value+=1,o}(e,t,r,i);if("chromaticities"==n)return function(e,t){return{redX:F(e,t),redY:F(e,t),greenX:F(e,t),greenY:F(e,t),blueX:F(e,t),blueY:F(e,t),whiteX:F(e,t),whiteY:F(e,t)}}(t,r);if("compression"==n)return function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION"][R(e,t)]}(e,r);if("box2i"==n)return function(e,t){return{xMin:L(e,t),yMin:L(e,t),xMax:L(e,t),yMax:L(e,t)}}(e,r);if("lineOrder"==n)return function(e,t){return["INCREASING_Y"][R(e,t)]}(e,r);if("float"==n)return F(e,r);if("v2f"==n)return function(e,t){return[F(e,t),F(e,t)]}(e,r);throw"Cannot parse value for unsupported type: "+n}for(var z=new DataView(e),V=new Uint8Array(e),G={},H=(z.getUint32(0,!0),z.getUint8(4,!0),z.getUint8(5,!0),{value:8}),W=!0;W;){var X=D(e,H);if(0==X)W=!1;else{var q=j(z,e,H,D(e,H),L(z,H));G[X]=q}}var Y=G.dataWindow.yMax+1,J=1;"PIZ_COMPRESSION"==G.compression&&(J=32);for(var Z=Y/J,Q=0;Q<Z;Q++)N(z,H);var K=G.dataWindow.xMax-G.dataWindow.xMin+1,$=G.dataWindow.yMax-G.dataWindow.yMin+1,ee=G.channels.length,te=new Float32Array(K*$*ee),re={R:0,G:1,B:2,A:3};if("NO_COMPRESSION"==G.compression)for(var ne=0;ne<$;ne++)for(var ie=L(e,H),se=(L(e,H),0);se<G.channels.length;se++){var ae=re[G.channels[se].name];if(1!=G.channels[se].pixelType)throw"Only supported pixel format is HALF";for(var le=0;le<K;le++){var ce=B(e,H);te[$*ee*(K-ie)+le*ee+ae]=ce}}else{if("PIZ_COMPRESSION"!=G.compression)throw"Cannot decompress unsupported compression";for(var ue=0;ue<$/J;ue++){L(z,H),L(z,H);var he=K*J*(2*G.channels.length),de=new Uint16Array(he);O(de,{value:0},V,z,H,he,ee,G.channels,K,J);for(var pe=0;pe<J;pe++)for(se=0;se<G.channels.length;se++){ae=re[G.channels[se].name];if(1!=G.channels[se].pixelType)throw"Only supported pixel format is HALF";for(le=0;le<K;le++){ce=k(de[se*(J*K)+pe*K+le]);te[K*ee*($-(pe+ue*J))+le*ee+ae]=ce}}}}return{header:G,width:K,height:$,data:te,format:Gx,type:Fx}};function WS(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var o=new Uint8Array(r);return window.URL.createObjectURL(new Blob([o],{type:t}))}function XS(e,t,r,n){var i=function(e,t,r,n){var i,o=t.path,s=n.get(e.id).children;void 0!==s&&s.length>0&&void 0!==r[s[0].ID]&&(0!==(i=r[s[0].ID]).indexOf("blob:")&&0!==i.indexOf("data:")||t.setPath(void 0));var a=t.load(i);return t.setPath(o),a}(e,t,r,n);i.ID=e.id,i.name=e.attrName;var o=e.WrapModeU,s=e.WrapModeV,a=void 0!==o?o.value:0,l=void 0!==s?s.value:0;if(i.wrapS=0===a?Mx:Ax,i.wrapT=0===l?Mx:Ax,"Scaling"in e){var c=e.Scaling.value;i.repeat.x=c[0],i.repeat.y=c[1]}return i}function qS(e,t,r,n){var i=t.id,o=t.attrName,s=t.ShadingModel;if("object"==typeof s&&(s=s.value),!n.has(i))return null;var a,l=function(e,t,r,n,i){var o={};t.BumpFactor&&(o.bumpScale=t.BumpFactor.value);t.Diffuse?o.color=(new ay).fromArray(t.Diffuse.value):t.DiffuseColor&&"Color"===t.DiffuseColor.type&&(o.color=(new ay).fromArray(t.DiffuseColor.value));t.DisplacementFactor&&(o.displacementScale=t.DisplacementFactor.value);t.ReflectionFactor&&(o.reflectivity=t.ReflectionFactor.value);t.Specular?o.specular=(new ay).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(o.emissive=(new ay).fromArray(t.SpecularColor.value));t.Shininess&&(o.shininess=t.Shininess.value);t.Emissive?o.emissive=(new ay).fromArray(t.Emissive.value):t.EmissiveColor&&"Color"===t.EmissiveColor.type&&(o.emissive=(new ay).fromArray(t.EmissiveColor.value));t.EmissiveFactor&&(o.emissiveIntensity=parseFloat(t.EmissiveFactor.value));t.Opacity&&(o.opacity=parseFloat(t.Opacity.value));o.opacity<1&&(o.transparent=!0);return i.get(n).children.forEach(function(t){var n=t.relationship;switch(n){case"Bump":o.bumpMap=r.get(t.ID);break;case"DiffuseColor":o.map=YS(e,r,t.ID,i);break;case"DisplacementColor":o.displacementMap=YS(e,r,t.ID,i);break;case"EmissiveColor":o.emissiveMap=YS(e,r,t.ID,i);break;case"NormalMap":o.normalMap=YS(e,r,t.ID,i);break;case"ReflectionColor":o.envMap=YS(e,r,t.ID,i),o.envMap.mapping=bx;break;case"SpecularColor":o.specularMap=YS(e,r,t.ID,i);break;case"TransparentColor":o.alphaMap=YS(e,r,t.ID,i),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",n)}}),o}(e,t,r,i,n);switch(s.toLowerCase()){case"phong":a=new bw;break;case"lambert":a=new yw;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new bw({color:3342591})}return a.setValues(l),a.name=o,a}function YS(e,t,r,n){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=n.get(r).children[0].ID),t.get(r)}function JS(e,t){var r=[];return e.children.forEach(function(e){var n=t[e.ID];if("Cluster"===n.attrType){var i={ID:e.ID,indices:[],weights:[],transform:(new Qg).fromArray(n.Transform.a),transformLink:(new Qg).fromArray(n.TransformLink.a),linkMode:n.Mode};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}}),{rawBones:r,bones:[]}}function ZS(e,t,r,n){switch(r.attrType){case"Mesh":return function(e,t,r,n){var i=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0===i.length)return;var o=t.children.reduce(function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e},null),s=new Qg,a=i[0];if("GeometricRotation"in a){var l=a.GeometricRotation.value.map(Zg.degToRad);l[3]="ZYX",s.makeRotationFromEuler((new ty).fromArray(l))}"GeometricTranslation"in a&&s.setPosition((new Kg).fromArray(a.GeometricTranslation.value));"GeometricScaling"in a&&s.scale((new Kg).fromArray(a.GeometricScaling.value));return function(e,t,r,n,i){var o=r.Vertices.a,s=r.PolygonVertexIndex.a,a=[],l=[],c=[],u=[],h=[],d=[],p=[];if(r.LayerElementColor)var f=function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];"IndexToDirect"===r&&(i=e.ColorIndex.a);return{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}}(r.LayerElementColor[0]);if(r.LayerElementMaterial)var m=function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],o=0;o<n.length;++o)i.push(o);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}}(r.LayerElementMaterial[0]);if(r.LayerElementNormal)var v=function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a));return{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}}(r.LayerElementNormal[0]);if(r.LayerElementUV)for(var g=[],y=0;r.LayerElementUV[y];)g.push(QS(r.LayerElementUV[y])),y++;var x={};null!==n&&n.rawBones.forEach(function(e,t){e.indices.forEach(function(r,n){void 0===x[r]&&(x[r]=[]),x[r].push({id:t,weight:e.weights[n]})})});var b=0,w=0,_=!1,S=[],T=[],M=[],A=[],E=[],C=[];s.forEach(function(e,t){var r=!1;e<0&&(e^=-1,s[t]=e,r=!0);var i=[],y=[];if(S.push(3*e,3*e+1,3*e+2),f){var P=eT(t,b,e,f);M.push(P[0],P[1],P[2])}if(n){if(void 0!==x[e]&&x[e].forEach(function(e){y.push(e.weight),i.push(e.id)}),y.length>4){_||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),_=!0);var O=[0,0,0,0],D=[0,0,0,0];y.forEach(function(e,t){var r=e,n=i[t];D.forEach(function(e,t,i){if(r>e){i[t]=r,r=e;var o=O[t];O[t]=n,n=o}})}),i=O,y=D}for(;y.length<4;)y.push(0),i.push(0);for(var N=0;N<4;++N)E.push(y[N]),C.push(i[N])}if(v){var P=eT(t,b,e,v);T.push(P[0],P[1],P[2])}if(m&&"AllSame"!==m.mappingType)var L=eT(t,b,e,m)[0];if(g&&g.forEach(function(r,n){var i=eT(t,b,e,r);void 0===A[n]&&(A[n]=[]),A[n].push(i[0]),A[n].push(i[1])}),w++,r){for(var N=2;N<w;N++)a.push(o[S[0]]),a.push(o[S[1]]),a.push(o[S[2]]),a.push(o[S[3*(N-1)]]),a.push(o[S[3*(N-1)+1]]),a.push(o[S[3*(N-1)+2]]),a.push(o[S[3*N]]),a.push(o[S[3*N+1]]),a.push(o[S[3*N+2]]),n&&(d.push(E[0]),d.push(E[1]),d.push(E[2]),d.push(E[3]),d.push(E[4*(N-1)]),d.push(E[4*(N-1)+1]),d.push(E[4*(N-1)+2]),d.push(E[4*(N-1)+3]),d.push(E[4*N]),d.push(E[4*N+1]),d.push(E[4*N+2]),d.push(E[4*N+3]),p.push(C[0]),p.push(C[1]),p.push(C[2]),p.push(C[3]),p.push(C[4*(N-1)]),p.push(C[4*(N-1)+1]),p.push(C[4*(N-1)+2]),p.push(C[4*(N-1)+3]),p.push(C[4*N]),p.push(C[4*N+1]),p.push(C[4*N+2]),p.push(C[4*N+3])),f&&(c.push(M[0]),c.push(M[1]),c.push(M[2]),c.push(M[3*(N-1)]),c.push(M[3*(N-1)+1]),c.push(M[3*(N-1)+2]),c.push(M[3*N]),c.push(M[3*N+1]),c.push(M[3*N+2])),m&&"AllSame"!==m.mappingType&&(h.push(L),h.push(L),h.push(L)),v&&(l.push(T[0]),l.push(T[1]),l.push(T[2]),l.push(T[3*(N-1)]),l.push(T[3*(N-1)+1]),l.push(T[3*(N-1)+2]),l.push(T[3*N]),l.push(T[3*N+1]),l.push(T[3*N+2])),g&&g.forEach(function(e,t){void 0===u[t]&&(u[t]=[]),u[t].push(A[t][0]),u[t].push(A[t][1]),u[t].push(A[t][2*(N-1)]),u[t].push(A[t][2*(N-1)+1]),u[t].push(A[t][2*N]),u[t].push(A[t][2*N+1])});b++,w=0,S=[],T=[],M=[],A=[],E=[],C=[]}});var P=new Cy;P.name=r.name;var O=new Sy(a,3);i.applyToBufferAttribute(O),P.addAttribute("position",O),c.length>0&&P.addAttribute("color",new Sy(c,3));n&&(P.addAttribute("skinIndex",new Sy(p,4)),P.addAttribute("skinWeight",new Sy(d,4)),P.FBX_Deformer=n);if(l.length>0){var D=new Sy(l,3),N=(new ny).getNormalMatrix(i);N.applyToBufferAttribute(D),P.addAttribute("normal",D)}if(u.forEach(function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),P.addAttribute(r,new Sy(u[t],2))}),m&&"AllSame"!==m.mappingType){var L=h[0],I=0;if(h.forEach(function(e,t){e!==L&&(P.addGroup(I,t-I,L),L=e,I=t)}),P.groups.length>0){var R=P.groups[P.groups.length-1],F=R.start+R.count;F!==h.length&&P.addGroup(F,h.length-F,L)}0===P.groups.length&&P.addGroup(0,h.length,h[0])}return P}(0,0,r,o,s)}(e,t,r,n);case"NurbsCurve":return function(e){if(void 0===D_)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Cy;var t=parseInt(e.Order);if(isNaN(t))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Cy;for(var r,n,i=t-1,o=e.KnotVector.a,s=[],a=e.Points.a,l=0,c=a.length;l<c;l+=4)s.push((new fy).fromArray(a,l));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){r=i,n=o.length-1-r;for(var l=0;l<i;++l)s.push(s[l])}var u=new D_(i,o,s,r,n).getPoints(7*s.length),h=new Float32Array(3*u.length);u.forEach(function(e,t){e.toArray(h,3*t)});var d=new Cy;return d.addAttribute("position",new my(h,3)),d}(r)}}function QS(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}}Object.assign((function(e){this.manager=void 0!==e?e:pw}).prototype,{load:function(e,t,r,n){var i=this,o=Nw.extractUrlBase(e),s=new mw(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(r){try{var s=i.parse(r,o);t(s)}catch(t){window.setTimeout(function(){n&&n(t),i.manager.itemError(e)},0)}},r,n)},parse:function(e,t){var r;if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===yT(e,0,t.length)}(e))r=(new dT).parse(e);else{var n=yT(e);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(t){var n=e[t-1];return e=e.slice(r+t),r++,n}for(var i=0;i<t.length;++i){var o=n(1);if(o===t[i])return!1}return!0}(n))throw new Error("FBXLoader: Unknown format.");if(mT(n)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+mT(n));r=(new hT).parse(n)}var i=function(e){var t=new Map;if("Connections"in e){var r=e.Connections.connections;r.forEach(function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var o={ID:n,relationship:i};t.get(r).parents.push(o),t.has(n)||t.set(n,{parents:[],children:[]});var s={ID:r,relationship:i};t.get(n).children.push(s)})}return t}(r),o=function(e){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var o=n[i],s=parseInt(i);if(t[s]=o.Filename,"Content"in o){var a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,l="string"==typeof o.Content&&""!==o.Content;if(a||l){var c=WS(n[i]);r[o.Filename]=c}}}}for(var s in t){var u=t[s];void 0!==r[u]?t[s]=r[u]:t[s]=t[s].split("\\").pop()}return t}(r),s=function(e,t,r){var n=new Map;if("Material"in e.Objects){var i=e.Objects.Material;for(var o in i){var s=qS(e,i[o],t,r);null!==s&&n.set(parseInt(o),s)}}return n}(r,function(e,t,r,n){var i=new Map;if("Texture"in e.Objects){var o=e.Objects.Texture;for(var s in o){var a=XS(o[s],t,r,n);i.set(parseInt(s),a)}}return i}(r,new Ow(this.manager).setPath(t),o,i),i),a=function(e,t){var r={};if("Deformer"in e.Objects){var n=e.Objects.Deformer;for(var i in n){var o=n[i];if("Skin"===o.attrType){var s=t.get(parseInt(i)),a=JS(s,n);a.ID=i,s.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=s.parents[0].ID,r[i]=a}}}return r}(r,i);return function(e,t,r,n,i){var o=new mS,s=function(e,t,r,n,i){var o=new Map,s=e.Objects.Model;for(var a in s){var l=parseInt(a),c=s[a],u=i.get(l),h=tT(u,t,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=rT(e,u);break;case"Light":h=nT(e,u);break;case"Mesh":h=iT(e,u,r,n);break;case"NurbsCurve":h=oT(u,r);break;case"LimbNode":case"Null":default:h=new mS}h.name=B_.sanitizeNodeName(c.attrName),h.ID=l}sT(e,h,c),o.set(l,h)}return o}(e,r,n,i,t),a=e.Objects.Model;return s.forEach(function(r){var n=a[r.ID];!function(e,t,r,n,i){if("LookAtProperty"in r){var o=n.get(t.ID).children;o.forEach(function(r){if("LookAtProperty"===r.relationship){var n=e.Objects.Model[r.ID];if("Lcl_Translation"in n){var o=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(o),i.add(t.target)):t.lookAt((new Kg).fromArray(o))}}})}}(e,r,n,t,o),t.get(r.ID).parents.forEach(function(e){var t=s.get(e.ID);void 0!==t&&t.add(r)}),null===r.parent&&o.add(r)}),function(e,t,r,n,i){var o=function(e){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach(function(e){t[e.Node]=(new Qg).fromArray(e.Matrix.a)}):t[i.Node]=(new Qg).fromArray(i.Matrix.a)}}return t}(e);for(var s in t){var a=t[s],l=i.get(parseInt(a.ID)).parents;l.forEach(function(e){if(r.has(e.ID)){var t=e.ID,s=i.get(t);s.parents.forEach(function(e){if(n.has(e.ID)){var t=n.get(e.ID);t.bind(new xS(a.bones),o[e.ID])}})}})}}(e,r,n,s,t),function(e,t,r){r.animations=[];var n=function(e,t){if(void 0!==e.Objects.AnimationCurve){var r=function(e){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T/)){var o={id:i.id,attr:i.attrName,curves:{}};r.set(o.id,o)}}return r}(e);!function(e,t,r){var n=e.Objects.AnimationCurve;for(var i in n){var o={id:n[i].id,times:n[i].KeyTime.a.map(vT),values:n[i].KeyValueFloat.a},s=t.get(o.id);if(void 0!==s){var a=s.parents[0].ID,l=s.parents[0].relationship,c="";if(l.match(/X/))c="x";else if(l.match(/Y/))c="y";else{if(!l.match(/Z/))continue;c="z"}r.get(a).curves[c]=o}}}(e,t,r);var n=function(e,t,r){var n=e.Objects.AnimationLayer,i=new Map;for(var o in n){var s=[],a=t.get(parseInt(o));if(void 0!==a){var l=a.children;l.forEach(function(n,i){if(r.has(n.ID)){var o=r.get(n.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[i]){var a;t.get(n.ID).parents.forEach(function(e){void 0!==e.relationship&&(a=e.ID)});var l=e.Objects.Model[a.toString()],c={modelName:B_.sanitizeNodeName(l.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in l&&(c.initialPosition=l.Lcl_Translation.value),"Lcl_Rotation"in l&&(c.initialRotation=l.Lcl_Rotation.value),"Lcl_Scaling"in l&&(c.initialScale=l.Lcl_Scaling.value),"PreRotation"in l&&(c.preRotations=l.PreRotation.value),s[i]=c}s[i][o.attr]=o}}}),i.set(parseInt(o),s)}}return i}(e,t,r);return function(e,t,r){var n=e.Objects.AnimationStack,i={};for(var o in n){var s=t.get(parseInt(o)).children;s.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var a=r.get(s[0].ID);i[o]={name:n[o].attrName,layer:a}}return i}(e,t,n)}}(e,t);if(void 0!==n)for(var i in n){var o=n[i],s=aT(o);r.animations.push(s)}}(e,t,o),function(e,t){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var r=e.GlobalSettings.AmbientColor.value,n=r[0],i=r[1],o=r[2];if(0!==n||0!==i||0!==o){var s=new ay(n,i,o);t.add(new RS(s,1))}}}(e,o),o}(r,i,a,function(e,t,r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var o in i){var s=t.get(parseInt(o)),a=ZS(e,s,i[o],r);n.set(parseInt(o),a)}}return n}(r,i,a),s)}});var KS=[],$S={ByPolygonVertex:{Direct:function(e,t,r,n){var i=e*n.dataSize,o=e*n.dataSize+n.dataSize;return xT(KS,n.buffer,i,o)},IndexToDirect:function(e,t,r,n){var i=n.indices[e],o=i*n.dataSize,s=i*n.dataSize+n.dataSize;return xT(KS,n.buffer,o,s)}},ByPolygon:{Direct:function(e,t,r,n){var i=t*n.dataSize,o=t*n.dataSize+n.dataSize;return xT(KS,n.buffer,i,o)},IndexToDirect:function(e,t,r,n){var i=n.indices[t],o=i*n.dataSize,s=i*n.dataSize+n.dataSize;return xT(KS,n.buffer,o,s)}},ByVertice:{Direct:function(e,t,r,n){var i=r*n.dataSize,o=r*n.dataSize+n.dataSize;return xT(KS,n.buffer,i,o)}},AllSame:{IndexToDirect:function(e,t,r,n){var i=n.indices[0]*n.dataSize,o=n.indices[0]*n.dataSize+n.dataSize;return xT(KS,n.buffer,i,o)}}};function eT(e,t,r,n){return $S[n.mappingType][n.referenceType](e,t,r,n)}function tT(e,t,r,n){var i=null;return e.parents.forEach(function(e){for(var o in t){var s=t[o];s.rawBones.forEach(function(t,o){if(t.ID===e.ID){var a=i;(i=new Pb).matrixWorld.copy(t.transformLink),i.name=B_.sanitizeNodeName(n),i.ID=r,s.bones[o]=i,null!==a&&i.add(a)}})}}),i}function rT(e,t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new oy;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);var a=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(a=n.AspectWidth.value,l=n.AspectHeight.value);var c=a/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new Kb(u,c,o,s),null!==h&&r.setFocalLength(h);break;case 1:r=new tw(-a/2,a/2,l/2,-l/2,o,s);break;default:console.warn("FBXLoader: Unknown camera type "+i+"."),r=new oy}}return r}function nT(e,t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new oy;else{var i;i=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new ay).fromArray(n.Color.value));var s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);var a=0;void 0!==n.FarAttenuationEnd&&(a=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(i){case 0:r=new ES(o,s,a,1);break;case 1:r=new PS(o,s);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=Zg.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=Zg.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new DS(o,s,a,l,c,1);break;default:console.warn("FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new ES(o,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r}function iT(e,t,r,n){var i,o=null,s=null,a=[];return t.children.forEach(function(e){r.has(e.ID)&&(o=r.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))}),a.length>1?s=a:a.length>0?s=a[0]:(s=new bw({color:13421772}),a.push(s)),"color"in o.attributes&&a.forEach(function(e){e.vertexColors=jy}),o.FBX_Deformer?(a.forEach(function(e){e.skinning=!0}),i=new bS(o,s)):i=new Mb(o,s),i}function oT(e,t){return new Ab(e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),new bb({color:3342591,linewidth:1}))}function sT(e,t,r){if("RotationOrder"in r){var n=parseInt(r.RotationOrder.value,10);n>0&&n<6?console.warn("FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"][n]):6===n&&console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in r&&t.position.fromArray(r.Lcl_Translation.value),"Lcl_Rotation"in r){var i=r.Lcl_Rotation.value.map(Zg.degToRad);i.push("ZYX"),t.quaternion.setFromEuler((new ty).fromArray(i))}if("Lcl_Scaling"in r&&t.scale.fromArray(r.Lcl_Scaling.value),"PreRotation"in r){var o=r.PreRotation.value.map(Zg.degToRad);o[3]="ZYX";var s=(new ty).fromArray(o);s=(new $g).setFromEuler(s),t.quaternion.premultiply(s)}}function aT(e){var t=[];return e.layer.forEach(function(e){t=t.concat(function(e){var t=[];if(void 0!==e.T&&Object.keys(e.T.curves).length>0){var r=lT(e.modelName,e.T.curves,e.initialPosition,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var n=function(e,t,r,n){void 0!==t.x&&(t.x.values=t.x.values.map(Zg.degToRad));void 0!==t.y&&(t.y.values=t.y.values.map(Zg.degToRad));void 0!==t.z&&(t.z.values=t.z.values.map(Zg.degToRad));var i=uT(t),o=cT(i,t,r);void 0!==n&&((n=n.map(Zg.degToRad)).push("ZYX"),n=(new ty).fromArray(n),n=(new $g).setFromEuler(n));for(var s=new $g,a=new ty,l=[],c=0;c<o.length;c+=3)a.set(o[c],o[c+1],o[c+2],"ZYX"),s.setFromEuler(a),void 0!==n&&s.premultiply(n),s.toArray(l,c/3*4);return new jb(e+".quaternion",i,l)}(e.modelName,e.R.curves,e.initialRotation,e.preRotations);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var i=lT(e.modelName,e.S.curves,e.initialScale,"scale");void 0!==i&&t.push(i)}return t}(e))}),new Jb(e.name,-1,t)}function lT(e,t,r,n){var i=uT(t);return new Vb(e+"."+n,i,cT(i,t,r))}function cT(e,t,r){var n=r,i=[],o=-1,s=-1,a=-1;return e.forEach(function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==o){var r=t.x.values[o];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==s){var l=t.y.values[s];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==a){var c=t.z.values[a];i.push(c),n[2]=c}else i.push(n[2])}),i}function uT(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,r){return r.indexOf(e)==t})}function hT(){}function dT(){}function pT(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function fT(){}function mT(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function vT(e){return e/46186158e3}function gT(e){return e.split(",").map(function(e){return parseFloat(e)})}function yT(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),Nw.decodeText(new Uint8Array(e,t,r))}function xT(e,t,r,n){for(var i=r,o=0;i<n;i++,o++)e[o]=t[i];return e}Object.assign(hT.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new fT,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split("\n");return r.forEach(function(e,n){var i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!i&&!o){var s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):a?t.parseNodeProperty(e,a,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:r},o=this.parseNodeAttr(n),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in s?("PoseNode"===r?s.PoseNode.push(i):void 0!==s[r].id&&(s[r]={},s[r][s[r].id]=s[r]),""!==o.id&&(s[r][o.id]=i)):"number"==typeof o.id?(s[r]={},s[r][o.id]=i):"Properties70"!==r&&(s[r]="PoseNode"===r?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){var s=i.split(",").slice(1),a=parseInt(s[0]),l=parseInt(s[1]),c=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[a,l],c=c.map(function(e){return e.trim().replace(/^"/,"")})),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=i),n in o&&Array.isArray(o[n])?o[n].push(i):"a"!==n?o[n]=i:o.a=i,this.setCurrentProp(o,n),"a"===n&&","!==i.slice(-1)&&(o.a=gT(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=gT(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=n[0],o=n[1],s=n[2],a=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=gT(l)}this.getPrevNode()[i]={type:o,type2:s,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),i)}}),Object.assign(dT.prototype,{parse:function(e){var t=new pT(e);t.skip(23);var r=t.getUint32();console.log("FBXLoader: FBX binary version: "+r);for(var n=new fT;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),o=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),s=e.getString(o);if(0===n)return null;for(var a=[],l=0;l<i;l++)a.push(this.parseProperty(e));var c=a.length>0?a[0]:"",u=a.length>1?a[1]:"",h=a.length>2?a[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(s,r,d)}return r.propertyList=a,"number"==typeof c&&(r.id=c),""!==u&&(r.attrName=u),""!==h&&(r.attrType=h),""!==s&&(r.name=s),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach(function(e,t){0!==t&&i.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach(function(e){t[e]=r[e]})}else if("Properties70"===e&&"P"===r.name){var o,s=r.propertyList[0],a=r.propertyList[1],l=r.propertyList[2],c=r.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),o="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[s]={type:a,type2:l,flag:c,value:o}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}void 0===window.Zlib&&console.error("FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new pT(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(n);case"d":return s.getFloat64Array(n);case"f":return s.getFloat32Array(n);case"i":return s.getInt32Array(n);case"l":return s.getInt64Array(n)}default:throw new Error("FBXLoader: Unknown property type "+t)}}}),Object.assign(pT.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=new Uint8Array(e),r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),Nw.decodeText(t)}}),Object.assign(fT.prototype,{add:function(e,t){this[e]=t}});var bT=function(e){this.manager=void 0!==e?e:pw,this.splitLayer=!1};bT.prototype.load=function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(e))},r,n)},bT.prototype.parse=function(e){var t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},r=[],n=void 0,i=new bb({color:16711680});i.name="path";var o=new bb({color:65280});function s(e){n={vertex:[],pathVertex:[],z:e.z},r.push(n)}function a(e,t){void 0===n&&s(e),m.extruding?(n.vertex.push(e.x,e.y,e.z),n.vertex.push(t.x,t.y,t.z)):(n.pathVertex.push(e.x,e.y,e.z),n.pathVertex.push(t.x,t.y,t.z))}function l(e,r){return t.relative?r:r-e}function c(e,r){return t.relative?e+r:r}o.name="extruded";for(var u=e.replace(/;.+/g,"").split("\n"),h=0;h<u.length;h++){var d=u[h].split(" "),p=d[0].toUpperCase(),f={};if(d.splice(1).forEach(function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),r=parseFloat(e.substring(1));f[t]=r}}),"G0"===p||"G1"===p){var m={x:void 0!==f.x?c(t.x,f.x):t.x,y:void 0!==f.y?c(t.y,f.y):t.y,z:void 0!==f.z?c(t.z,f.z):t.z,e:void 0!==f.e?c(t.e,f.e):t.e,f:void 0!==f.f?c(t.f,f.f):t.f};l(t.e,m.e)>0&&(m.extruding=l(t.e,m.e)>0,void 0!=n&&m.z==n.z||s(m)),a(t,m),t=m}else if("G2"===p||"G3"===p)console.warn("GCodeLoader: Arc command not supported");else if("G90"===p)t.relative=!1;else if("G91"===p)t.relative=!0;else if("G92"===p){(m=t).x=void 0!==f.x?f.x:m.x,m.y=void 0!==f.y?f.y:m.y,m.z=void 0!==f.z?f.z:m.z,m.e=void 0!==f.e?f.e:m.e,t=m}else console.warn("GCodeLoader: Command not supported:"+p)}function v(e,t){var r=new Cy;r.addAttribute("position",new Sy(e,3));var n=new FS(r,t?o:i);n.name="layer"+h,g.add(n)}var g=new mS;if(g.name="gcode",this.splitLayer)for(h=0;h<r.length;h++){v((b=r[h]).vertex,!0),v(b.pathVertex,!1)}else{var y=[],x=[];for(h=0;h<r.length;h++){var b=r[h];y=y.concat(b.vertex),x=x.concat(b.pathVertex)}v(y,!0),v(x,!1)}return g.quaternion.setFromEuler(new ty(-Math.PI/2,0,0)),g};!function(){function e(e){this.manager=void 0!==e?e:pw,this.dracoLoader=null}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,t,r,n){var i=this,o=void 0!==this.path?this.path:Nw.extractUrlBase(e),s=new mw(i.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){try{i.parse(e,o,t,n)}catch(e){if(void 0===n)throw e;n(e)}},r,n)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,a,l,c){var u,h={};if("string"==typeof e)u=e;else if(Nw.decodeText(new Uint8Array(e,0,4))===n){try{h[t.KHR_BINARY_GLTF]=new function(e){this.name=t.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(e,0,i);if(this.header={magic:Nw.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==n)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");var s=new DataView(e,i),a=0;for(;a<s.byteLength;){var l=s.getUint32(a,!0);a+=4;var c=s.getUint32(a,!0);if(a+=4,c===o.JSON){var u=new Uint8Array(e,i+a,l);this.content=Nw.decodeText(u)}else if(c===o.BIN){var h=i+a;this.body=e.slice(h,h+l)}a+=l}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")}(e)}catch(e){return void(c&&c(e))}u=h[t.KHR_BINARY_GLTF].content}else u=Nw.decodeText(new Uint8Array(e));var d=JSON.parse(u);void 0===d.asset||d.asset.version[0]<2?c&&c(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")):(d.extensionsUsed&&(d.extensionsUsed.indexOf(t.KHR_LIGHTS)>=0&&(h[t.KHR_LIGHTS]=new function(e){this.name=t.KHR_LIGHTS,this.lights={};var r=(e.extensions&&e.extensions[t.KHR_LIGHTS]||{}).lights||{};for(var n in r){var i,o=r[n],s=(new ay).fromArray(o.color);switch(o.type){case"directional":(i=new PS(s)).position.set(0,0,1);break;case"point":i=new ES(s);break;case"spot":(i=new DS(s)).position.set(0,0,1);break;case"ambient":i=new RS(s)}i&&(void 0!==o.constantAttenuation&&(i.intensity=o.constantAttenuation),void 0!==o.linearAttenuation&&(i.distance=1/o.linearAttenuation),void 0!==o.quadraticAttenuation&&(i.decay=o.quadraticAttenuation),void 0!==o.fallOffAngle&&(i.angle=o.fallOffAngle),void 0!==o.fallOffExponent&&console.warn("GLTFLoader:: light.fallOffExponent not currently supported."),i.name=o.name||"light_"+n,this.lights[n]=i)}}(d)),d.extensionsUsed.indexOf(t.KHR_MATERIALS_UNLIT)>=0&&(h[t.KHR_MATERIALS_UNLIT]=new r(d)),d.extensionsUsed.indexOf(t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(h[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new function(){return{name:t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return sw},extendParams:function(e,t,r){var n=t.extensions[this.name],i=k_.standard,o=ow.clone(i.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=i.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new ay).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=h,e.uniforms=o,e.defines={STANDARD:""},e.color=new ay(1,1,1),e.opacity=1;var d=[];if(Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;e.color.fromArray(p),e.opacity=p[3]}if(void 0!==n.diffuseTexture&&d.push(r.assignTexture(e,"map",n.diffuseTexture.index)),e.emissive=new ay(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new ay(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var f=n.specularGlossinessTexture.index;d.push(r.assignTexture(e,"glossinessMap",f)),d.push(r.assignTexture(e,"specularMap",f))}return Promise.all(d)},createMaterial:function(e){var t=new sw({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,n=0,i=r.length;n<i;n++)t[r[n]]=e[r[n]];return t},refreshUniforms:function(e,t,r,n,i,o){if(!0===i.isGLTFSpecularGlossinessMaterial){var s,a,l,c=i.uniforms,u=i.defines;if(c.opacity.value=i.opacity,c.diffuse.value.copy(i.color),c.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),c.map.value=i.map,c.specularMap.value=i.specularMap,c.alphaMap.value=i.alphaMap,c.lightMap.value=i.lightMap,c.lightMapIntensity.value=i.lightMapIntensity,c.aoMap.value=i.aoMap,c.aoMapIntensity.value=i.aoMapIntensity,i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.glossinessMap?s=i.glossinessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap&&(s=i.emissiveMap),void 0!==s)if(s.isWebGLRenderTarget&&(s=s.texture),void 0!==s.matrix){if(!0===s.matrixAutoUpdate){a=s.offset,l=s.repeat;var h=s.rotation,d=s.center;s.matrix.setUvTransform(a.x,a.y,l.x,l.y,h,d.x,d.y)}c.uvTransform.value.copy(s.matrix)}else a=s.offset,l=s.repeat,c.offsetRepeat.value.set(a.x,a.y,l.x,l.y);c.envMap.value=i.envMap,c.envMapIntensity.value=i.envMapIntensity,c.flipEnvMap.value=i.envMap&&i.envMap.isCubeTexture?-1:1,c.refractionRatio.value=i.refractionRatio,c.specular.value.copy(i.specular),c.glossiness.value=i.glossiness,c.glossinessMap.value=i.glossinessMap,c.emissiveMap.value=i.emissiveMap,c.bumpMap.value=i.bumpMap,c.normalMap.value=i.normalMap,c.displacementMap.value=i.displacementMap,c.displacementScale.value=i.displacementScale,c.displacementBias.value=i.displacementBias,null!==c.glossinessMap.value&&void 0===u.USE_GLOSSINESSMAP&&(u.USE_GLOSSINESSMAP="",u.USE_ROUGHNESSMAP=""),null===c.glossinessMap.value&&void 0!==u.USE_GLOSSINESSMAP&&(delete u.USE_GLOSSINESSMAP,delete u.USE_ROUGHNESSMAP)}}}}),d.extensionsUsed.indexOf(t.KHR_DRACO_MESH_COMPRESSION)>=0&&(h[t.KHR_DRACO_MESH_COMPRESSION]=new s(this.dracoLoader))),console.time("GLTFLoader"),new N(d,h,{path:a||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(e,t,r,n,i){console.timeEnd("GLTFLoader"),l({scene:e,scenes:t,cameras:r,animations:n,asset:i})},c))}};var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit"};function r(e){this.name=t.KHR_MATERIALS_UNLIT}r.prototype.getMaterialType=function(e){return xb},r.prototype.extendParams=function(e,t,r){var n=[];e.color=new ay(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture.index))}return Promise.all(n)};var n="glTF",i=12,o={JSON:1313821514,BIN:5130562};function s(e){if(!e)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=t.KHR_DRACO_MESH_COMPRESSION,this.dracoLoader=e}function a(e,t,r,n){Ub.call(this,e,t,r,n)}s.prototype.decodePrimitive=function(e,t){var r=this.dracoLoader,n=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={};for(var s in i)s in w&&(o[w[s]]=i[s]);return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,t,o)})})},a.prototype=Object.create(Ub.prototype),a.prototype.constructor=a,a.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,l=3*s,c=n-t,u=(r-t)/c,h=u*u,d=h*u,p=e*l,f=p-l,m=2*d-3*h+1,v=d-2*h+u,g=-2*d+3*h,y=d-h,x=0;x!==s;x++){var b=o[f+x+s],w=o[f+x+a]*c,_=o[p+x+s],S=o[p+x]*c;i[x]=m*b+v*w+g*_+y*S}return i};var l=0,c=1,u=2,h=3,d=4,p=5,f=6,m={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},v={9728:Cx,9729:Dx,9984:Px,9985:Nx,9986:Ox,9987:Lx},g={33071:Ax,33648:Ex,10497:Mx},y={6406:Vx,6407:Gx,6408:Hx,6409:Wx,6410:Xx},x={5121:Ix,32819:Ux,32820:Bx,33635:jx},b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},w={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},_={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},S={CUBICSPLINE:2302,LINEAR:2301,STEP:ob},T="OPAQUE",M="MASK",A="BLEND";function E(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function C(e,t,r,n){var i=e.geometry,o=e.material,s=r.targets,a=i.morphAttributes;a.position=[],a.normal=[],o.morphTargets=!0;for(var l=0,c=s.length;l<c;l++){var u,h,d=s[l],p="morphTarget"+l;if(void 0!==d.POSITION){u=D(n[d.POSITION]);for(var f=i.attributes.position,m=0,v=u.count;m<v;m++)u.setXYZ(m,u.getX(m)+f.getX(m),u.getY(m)+f.getY(m),u.getZ(m)+f.getZ(m))}else i.attributes.position&&(u=D(i.attributes.position));if(void 0!==u&&(u.name=p,a.position.push(u)),void 0!==d.NORMAL){o.morphNormals=!0,h=D(n[d.NORMAL]);var g=i.attributes.normal;for(m=0,v=h.count;m<v;m++)h.setXYZ(m,h.getX(m)+g.getX(m),h.getY(m)+g.getY(m),h.getZ(m)+g.getZ(m))}else void 0!==i.attributes.normal&&(h=D(i.attributes.normal));void 0!==h&&(h.name=p,a.normal.push(h))}if(e.updateMorphTargets(),void 0!==t.weights)for(l=0,c=t.weights.length;l<c;l++)e.morphTargetInfluences[l]=t.weights[l];if(t.extras&&Array.isArray(t.extras.targetNames))for(l=0,c=t.extras.targetNames.length;l<c;l++)e.morphTargetDictionary[t.extras.targetNames[l]]=l}function P(e,t){if(e.indices!==t.indices)return!1;var r=e.attributes||{},n=t.attributes||{},i=Object.keys(r),o=Object.keys(n);if(i.length!==o.length)return!1;for(var s=0,a=i.length;s<a;s++){var l=i[s];if(r[l]!==n[l])return!1}return!0}function O(e,t){for(var r=0,n=e.length;r<n;r++){var i=e[r];if(P(i.primitive,t))return i.promise}return null}function D(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,n=e.array.slice(0,t*r),i=0;i<t;++i)n[i]=e.getX(i),r>=2&&(n[i+1]=e.getY(i)),r>=3&&(n[i+2]=e.getZ(i)),r>=4&&(n[i+3]=e.getW(i));return new my(n,r,e.normalized)}return e.clone()}function N(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}},this.primitiveCache=[],this.textureLoader=new Ow(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new mw(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function L(e,t,r){var n=t.attributes;for(var i in n){var o=w[i],s=r[n[i]];o&&(o in e.attributes||e.addAttribute(o,s))}void 0===t.indices||e.index||e.setIndex(r[t.indices])}N.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var n=t.scenes||[],i=n[r.scene||0],o=t.animations||[],s=r.asset,a=t.cameras||[];e(i,n,a,o,s)}).catch(t)},N.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n={},i={},o=0,s=t.length;o<s;o++)for(var a=t[o].joints,l=0,c=a.length;l<c;l++)e[a[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var d=e[u];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},N.prototype.getDependency=function(e,t){var r=e+":"+t,n=this.cache.get(r);n||(n=this["load"+e.charAt(0).toUpperCase()+e.slice(1)](t),this.cache.add(r,n));return n},N.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t},N.prototype.getMultiDependencies=function(e){for(var t={},r=[],n=0,i=e.length;n<i;n++){var o=e[n],s=this.getDependencies(o);s=s.then((function(e,r){t[e]=r}).bind(this,o+("mesh"===o?"es":"s"))),r.push(s)}return Promise.all(r).then(function(){return t})},N.prototype.loadBuffer=function(e){var r=this.json.buffers[e],n=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[t.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,t){n.load(E(r.uri,i.path),e,void 0,function(){t(new Error('GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})},N.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})},N.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return null;var i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,o=e[0],s=b[n.type],a=m[n.componentType],l=a.BYTES_PER_ELEMENT,c=l*s,u=n.byteOffset||0,h=r.bufferViews[n.bufferView].byteStride,d=!0===n.normalized;if(h&&h!==c){var p="InterleavedBuffer:"+n.bufferView+":"+n.componentType,f=t.cache.get(p);f||(f=new iS(new a(o),h/l),t.cache.add(p,f)),i=new sS(f,s,u/l,d)}else i=new my(null===o?new a(n.count*s):new a(o,u,n.count*s),s,d);if(void 0!==n.sparse){var v=b.SCALAR,g=m[n.sparse.indices.componentType],y=n.sparse.indices.byteOffset||0,x=n.sparse.values.byteOffset||0,w=new g(e[1],y,n.sparse.count*v),_=new a(e[2],x,n.sparse.count*s);null!==o&&i.setArray(i.array.slice());for(var S=0,T=w.length;S<T;S++){var M=w[S];if(i.setX(M,_[S*s]),s>=2&&i.setY(M,_[S*s+1]),s>=3&&i.setZ(M,_[S*s+2]),s>=4&&i.setW(M,_[S*s+3]),s>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},N.prototype.loadTexture=function(e){var t=this.json,r=this.options,n=this.textureLoader,i=window.URL||window.webkitURL,o=t.textures[e],s=t.images[o.source],a=s.uri,l=!1;return void 0!==s.bufferView&&(a=this.getDependency("bufferView",s.bufferView).then(function(e){l=!0;var t=new Blob([e],{type:s.mimeType});return a=i.createObjectURL(t)})),Promise.resolve(a).then(function(e){var t=Dw.Handlers.get(e)||n;return new Promise(function(n,i){t.load(E(e,r.path),n,void 0,i)})}).then(function(e){!0===l&&i.revokeObjectURL(a),e.flipY=!1,void 0!==o.name&&(e.name=o.name),e.format=void 0!==o.format?y[o.format]:Hx,void 0!==o.internalFormat&&e.format!==y[o.internalFormat]&&console.warn("GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==o.type?x[o.type]:Ix;var r=(t.samplers||{})[o.sampler]||{};return e.magFilter=v[r.magFilter]||Dx,e.minFilter=v[r.minFilter]||Lx,e.wrapS=g[r.wrapS]||Mx,e.wrapT=g[r.wrapT]||Mx,e})},N.prototype.assignTexture=function(e,t,r){return this.getDependency("texture",r).then(function(r){e[t]=r})},N.prototype.loadMaterial=function(e){this.json;var r,n=this.extensions,i=this.json.materials[e],o={},s=i.extensions||{},a=[];if(s[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=n[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=l.getMaterialType(i),a.push(l.extendParams(o,i,this))}else if(s[t.KHR_MATERIALS_UNLIT]){var c=n[t.KHR_MATERIALS_UNLIT];r=c.getMaterialType(i),a.push(c.extendParams(o,i,this))}else if(void 0!==i.pbrMetallicRoughness){r=ww;var u=i.pbrMetallicRoughness;if(o.color=new ay(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){var h=u.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}if(void 0!==u.baseColorTexture&&a.push(this.assignTexture(o,"map",u.baseColorTexture.index)),o.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,o.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture){var d=u.metallicRoughnessTexture.index;a.push(this.assignTexture(o,"metalnessMap",d)),a.push(this.assignTexture(o,"roughnessMap",d))}}else r=bw;!0===i.doubleSided&&(o.side=ky);var p=i.alphaMode||T;return p===A?o.transparent=!0:(o.transparent=!1,p===M&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&r!==xb&&(a.push(this.assignTexture(o,"normalMap",i.normalTexture.index)),o.normalScale=new hy(1,1),void 0!==i.normalTexture.scale&&o.normalScale.set(i.normalTexture.scale,i.normalTexture.scale)),void 0!==i.occlusionTexture&&r!==xb&&(a.push(this.assignTexture(o,"aoMap",i.occlusionTexture.index)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&r!==xb&&(o.emissive=(new ay).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&r!==xb&&a.push(this.assignTexture(o,"emissiveMap",i.emissiveTexture.index)),Promise.all(a).then(function(){var e;return e=r===sw?n[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),void 0!==i.name&&(e.name=i.name),e.normalScale&&(e.normalScale.x=-e.normalScale.x),e.map&&(e.map.encoding=hb),e.emissiveMap&&(e.emissiveMap.encoding=hb),i.extras&&(e.userData=i.extras),e})},N.prototype.loadGeometries=function(e){var r=this,n=this.extensions,i=this.primitiveCache;return this.getDependencies("accessor").then(function(o){for(var s=[],a=[],l=0,c=e.length;l<c;l++){var u,h=e[l],d=O(i,h);if(d)a.push(d.then(function(e){s.push(e)}));else if(h.extensions&&h.extensions[t.KHR_DRACO_MESH_COMPRESSION]){var p=n[t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(h,r).then(function(e){return L(e,h,o),s.push(e),e});i.push({primitive:h,promise:p}),a.push(p)}else L(u=new Cy,h,o),i.push({primitive:h,promise:Promise.resolve(u)}),s.push(u)}return Promise.all(a).then(function(){return s})})},N.prototype.loadMesh=function(e){var r=this,n=(this.json,this.extensions),i=this.json.meshes[e];return this.getMultiDependencies(["accessor","material"]).then(function(o){var s=new mS,a=i.primitives;return r.loadGeometries(a).then(function(m){for(var v=0,g=a.length;v<g;v++){var y=a[v],x=m[v],b=void 0===y.material?new ww({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ry}):o.materials[y.material];b.aoMap&&void 0===x.attributes.uv2&&void 0!==x.attributes.uv&&(console.log("GLTFLoader: Duplicating UVs to support aoMap."),x.addAttribute("uv2",new my(x.attributes.uv.array,2)));var w,_=void 0!==x.attributes.color,S=void 0===x.attributes.normal,T=!0===i.isSkinnedMesh,M=void 0!==y.targets;if(_||S||T||M)if(b.isGLTFSpecularGlossinessMaterial)b=n[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(b);else b=b.clone();if(_&&(b.vertexColors=jy,b.needsUpdate=!0),S&&(b.flatShading=!0),y.mode===d||y.mode===p||y.mode===f||void 0===y.mode)T?(w=new bS(x,b),b.skinning=!0):w=new Mb(x,b),y.mode===p?w.drawMode=lb:y.mode===f&&(w.drawMode=cb);else if(y.mode===c||y.mode===h||y.mode===u){var A="LineBasicMaterial:"+b.uuid,E=r.cache.get(A);E||(E=new bb,yb.prototype.copy.call(E,b),E.color.copy(b.color),E.lights=!1,r.cache.add(A,E)),b=E,w=y.mode===c?new FS(x,b):y.mode===h?new Ab(x,b):new zS(x,b)}else{if(y.mode!==l)throw new Error("GLTFLoader: Primitive mode unsupported: "+y.mode);A="PointsMaterial:"+b.uuid;var P=r.cache.get(A);P||(P=new Tw,yb.prototype.copy.call(P,b),P.color.copy(b.color),P.map=b.map,P.lights=!1,r.cache.add(A,P)),w=new $_(x,b=P)}if(w.name=i.name||"mesh_"+e,M&&C(w,i,y,o.accessors),void 0!==i.extras&&(w.userData=i.extras),void 0!==y.extras&&(w.geometry.userData=y.extras),!0===b.isGLTFSpecularGlossinessMaterial&&(w.onBeforeRender=n[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),!(a.length>1))return w;w.name+="_"+v,s.add(w)}return s})})},N.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n){if("perspective"===r.type){var i=n.aspectRatio||1,o=n.yfov*i;t=new Kb(Zg.radToDeg(o),i,n.znear||1,n.zfar||2e6)}else"orthographic"===r.type&&(t=new tw(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar));return void 0!==r.name&&(t.name=r.name),r.extras&&(t.userData=r.extras),Promise.resolve(t)}console.warn("GLTFLoader: Missing camera parameters.")},N.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},N.prototype.loadAnimation=function(e){this.json;var t=this.json.animations[e];return this.getMultiDependencies(["accessor","node"]).then(function(r){for(var n=[],i=0,o=t.channels.length;i<o;i++){var s=t.channels[i],l=t.samplers[s.sampler];if(l){var c=s.target,u=void 0!==c.node?c.node:c.id,h=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output,p=r.accessors[h],f=r.accessors[d],m=r.nodes[u];if(m){var v;switch(m.updateMatrix(),m.matrixAutoUpdate=!0,_[c.path]){case _.weights:v=Yb;break;case _.rotation:v=jb;break;case _.position:case _.scale:default:v=Vb}var g=m.name?m.name:m.uuid,y=void 0!==l.interpolation?S[l.interpolation]:2301,x=[];_[c.path]===_.weights?m.traverse(function(e){!0===e.isMesh&&!0===e.material.morphTargets&&x.push(e.name?e.name:e.uuid)}):x.push(g);for(var b=0,w=x.length;b<w;b++){var T=new v(x[b]+"."+_[c.path],Xb.arraySlice(p.array,0),Xb.arraySlice(f.array,0),y);"CUBICSPLINE"===l.interpolation&&(T.createInterpolant=function(e){return new a(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),n.push(T)}}}}return new Jb(u=void 0!==t.name?t.name:"animation_"+e,void 0,n)})},N.prototype.loadNode=function(e){this.json;var r=this.extensions,n=this.json.meshReferences,i=this.json.meshUses,o=this.json.nodes[e];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(e){var s;if(!0===o.isBone)s=new Pb;else if(void 0!==o.mesh){var a=e.meshes[o.mesh];if(s=a.clone(),!0===a.isGroup)for(var l=0,c=a.children.length;l<c;l++){var u=a.children[l];u.material&&!0===u.material.isGLTFSpecularGlossinessMaterial&&(s.children[l].onBeforeRender=u.onBeforeRender)}else a.material&&!0===a.material.isGLTFSpecularGlossinessMaterial&&(s.onBeforeRender=a.onBeforeRender);n[o.mesh]>1&&(s.name+="_instance_"+i[o.mesh]++)}else if(void 0!==o.camera)s=e.cameras[o.camera];else if(o.extensions&&o.extensions[t.KHR_LIGHTS]&&void 0!==o.extensions[t.KHR_LIGHTS].light){s=r[t.KHR_LIGHTS].lights[o.extensions[t.KHR_LIGHTS].light]}else s=new oy;if(void 0!==o.name&&(s.name=B_.sanitizeNodeName(o.name)),o.extras&&(s.userData=o.extras),void 0!==o.matrix){var h=new Qg;h.fromArray(o.matrix),s.applyMatrix(h)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return s})},N.prototype.loadScene=function(){function e(t,r,n,i,o){var s=i[t],a=n.nodes[t];if(void 0!==a.skin)for(var l=!0===s.isGroup?s.children:[s],c=0,u=l.length;c<u;c++){for(var h=l[c],d=o[a.skin],p=[],f=[],m=0,v=d.joints.length;m<v;m++){var g=d.joints[m],y=i[g];if(y){p.push(y);var x=new Qg;void 0!==d.inverseBindMatrices&&x.fromArray(d.inverseBindMatrices.array,16*m),f.push(x)}else console.warn('GLTFLoader: Joint "%s" could not be found.',g)}h.bind(new xS(p,f),h.matrixWorld)}if(r.add(s),a.children){var b=a.children;for(c=0,u=b.length;c<u;c++){e(b[c],s,n,i,o)}}}return function(r){var n=this.json,i=this.extensions,o=this.json.scenes[r];return this.getMultiDependencies(["node","skin"]).then(function(r){var s=new ew;void 0!==o.name&&(s.name=o.name),o.extras&&(s.userData=o.extras);for(var a=o.nodes||[],l=0,c=a.length;l<c;l++)e(a[l],s,n,r.nodes,r.skins);if(o.extensions&&o.extensions[t.KHR_LIGHTS]&&void 0!==o.extensions[t.KHR_LIGHTS].light){var u=i[t.KHR_LIGHTS].lights;s.add(u[o.extensions[t.KHR_LIGHTS].light])}return s})}}()}();var wT=function(e){this.manager=void 0!==e?e:pw};wT.prototype=Object.create(GS.prototype),wT.prototype._parser=function(e){var t=function(e,t){switch(e){case 1:console.error("RGBELoader Read Error: "+(t||""));break;case 2:console.error("RGBELoader Write Error: "+(t||""));break;case 3:console.error("RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var n=e.pos,i=-1,o=0,s="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));0>(i=a.indexOf("\n"))&&o<t&&n<e.byteLength;)s+=a,o+=a.length,n+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<i&&(!1!==r&&(e.pos+=o+i+1),s+a.slice(0,i))},n=new Uint8Array(e);n.pos=0;var i=function(e){var n,i,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=r(e)))return t(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(c.valid|=1,c.programtype=i[1],c.string+=n+"\n";!1!==(n=r(e));)if(c.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(o))&&(c.gamma=parseFloat(i[1],10)),(i=n.match(s))&&(c.exposure=parseFloat(i[1],10)),(i=n.match(a))&&(c.valid|=2,c.format=i[1]),(i=n.match(l))&&(c.valid|=4,c.height=parseInt(i[1],10),c.width=parseInt(i[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=n+"\n";return 2&c.valid?4&c.valid?c:t(3,"missing image size specifier"):t(3,"missing format specifier")}(n);if(-1!==i){var o=i.width,s=i.height,a=function(e,r,n){var i,o,s,a,l,c,u,h,d,p,f,m,v,g=r,y=n;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return t(4,"unable to allocate buffer space");for(o=0,s=0,h=4*g,v=new Uint8Array(4),c=new Uint8Array(h);y>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(v[0]=e[s++],v[1]=e[s++],v[2]=e[s++],v[3]=e[s++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return t(3,"bad rgbe scanline format");for(u=0;u<h&&s<e.byteLength;){if((m=(a=e[s++])>128)&&(a-=128),0===a||u+a>h)return t(3,"bad scanline data");if(m)for(l=e[s++],d=0;d<a;d++)c[u++]=l;else c.set(e.subarray(s,s+a),u),u+=a,s+=a}for(p=g,d=0;d<p;d++)f=0,i[o]=c[d+f],f+=g,i[o+1]=c[d+f],f+=g,i[o+2]=c[d+f],f+=g,i[o+3]=c[d+f],o+=4;y--}return i}(n.subarray(n.pos),o,s);if(-1!==a)return{width:o,height:s,data:a,header:i.string,gamma:i.gamma,exposure:i.exposure,format:qx,type:Ix}}return null};function _T(e,t,r,n,i,o,s,a,l,c){e=void 0!==e?e:[],t=void 0!==t?t:yx,nw.call(this,e,t,r,n,i,o,s,a,l,c),this.flipY=!1}_T.prototype=Object.create(nw.prototype),_T.prototype.constructor=_T,_T.prototype.isCubeTexture=!0,Object.defineProperty(_T.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});(function(e){this.manager=void 0!==e?e:pw,this.hdrLoader=new wT}).prototype.load=function(e,t,r,n,i){var o=function(e,t,r,n){var i=e[t+3],o=Math.pow(2,i-128)/255;r[n+0]=e[t+0]*o,r[n+1]=e[t+1]*o,r[n+2]=e[t+2]*o},s=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function r(r){e[0]=r;var n=t[0],i=n>>16&32768,o=n>>12&2047,s=n>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&n):s<113?i|=((o|=2048)>>114-s)+(o>>113-s&1):(i|=s-112<<10|o>>1,i+=1&o)}return function(e,t,n,i){var o=e[t+3],s=Math.pow(2,o-128)/255;n[i+0]=r(e[t+0]*s),n[i+1]=r(e[t+1]*s),n[i+2]=r(e[t+2]*s)}}(),a=new _T;a.type=e,a.encoding=e===Ix?pb:ub,a.format=e===Ix?Hx:Gx,a.minFilter=a.encoding===pb?Cx:Dx,a.magFilter=a.encoding===pb?Cx:Dx,a.generateMipmaps=a.encoding!==pb,a.anisotropy=0;var l=this.hdrLoader,c=0;function u(r,n,i,u){var h=new mw(this.manager);h.setResponseType("arraybuffer"),h.load(t[r],function(t){c++;var i=l._parser(t);if(i){if(e===Fx){for(var u=i.data.length/4*3,h=new Float32Array(u),d=0;d<u;d++)o(i.data,4*d,h,3*d);i.data=h}else if(e===kx){u=i.data.length/4*3;var p=new Uint16Array(u);for(d=0;d<u;d++)s(i.data,4*d,p,3*d);i.data=p}if(void 0!==i.image)a[r].images=i.image;else if(void 0!==i.data){var f=new K_(i.data,i.width,i.height);f.format=a.format,f.type=a.type,f.encoding=a.encoding,f.minFilter=a.minFilter,f.magFilter=a.magFilter,f.generateMipmaps=a.generateMipmaps,a.images[r]=f}6===c&&(a.needsUpdate=!0,n&&n(a))}},i,u)}for(var h=0;h<t.length;h++)u(h,r,n,i);return a};var ST=function(e){this.manager=void 0!==e?e:pw};ST.prototype={constructor:ST,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t=new JSZip(e);function r(e){var r=decodeURI(e.init_from);r=r.replace("../","");var n=new RegExp(r+"$"),i=t.file(n);if(i.length){var o=i[0],s=new Blob([o.asArrayBuffer()],{type:"application/octet-binary"});e.build.src=URL.createObjectURL(s)}}var n=t.file(/dae$/i);if(n.length){var i=n[0],o=(new kS).parse(i.asText()),s=o.library.images;for(var a in s)r(s[a]);return o}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new mS}}};var TT=function(){this._parser=TT.parse};TT.prototype=Object.create(BS.prototype),TT.prototype.constructor=TT,TT.parse=function(e,t){var r=new MT(e,1);return{mipmaps:r.mipmaps(t),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}};var MT=function(){function e(t,r,n,i){this.arrayBuffer=t;var o=new Uint8Array(this.arrayBuffer,0,12);if(171===o[0]&&75===o[1]&&84===o[2]&&88===o[3]&&32===o[4]&&49===o[5]&&49===o[6]&&187===o[7]&&13===o[8]&&10===o[9]&&26===o[10]&&10===o[11]){var s=new Int32Array(this.arrayBuffer,12,13),a=16909060===s[0];this.glType=a?this.switchEndainness(s[1]):s[1],this.glTypeSize=a?this.switchEndainness(s[2]):s[2],this.glFormat=a?this.switchEndainness(s[3]):s[3],this.glInternalFormat=a?this.switchEndainness(s[4]):s[4],this.glBaseInternalFormat=a?this.switchEndainness(s[5]):s[5],this.pixelWidth=a?this.switchEndainness(s[6]):s[6],this.pixelHeight=a?this.switchEndainness(s[7]):s[7],this.pixelDepth=a?this.switchEndainness(s[8]):s[8],this.numberOfArrayElements=a?this.switchEndainness(s[9]):s[9],this.numberOfFaces=a?this.switchEndainness(s[10]):s[10],this.numberOfMipmapLevels=a?this.switchEndainness(s[11]):s[11],this.bytesOfKeyValueData=a?this.switchEndainness(s[12]):s[12],0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===r?this.loadType=e.COMPRESSED_2D:console.warn("number of faces expected"+r+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}else console.error("texture missing KTX identifier")}return e.prototype.switchEndainness=function(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255},e.prototype.mipmaps=function(t){for(var r=[],n=e.HEADER_LEN+this.bytesOfKeyValueData,i=this.pixelWidth,o=this.pixelHeight,s=t?this.numberOfMipmapLevels:1,a=0;a<s;a++){for(var l=new Int32Array(this.arrayBuffer,n,1)[0],c=0;c<this.numberOfFaces;c++){var u=new Uint8Array(this.arrayBuffer,n+4,l);r.push({data:u,width:i,height:o}),n+=l+4,n+=3-(l+3)%4}i=Math.max(1,.5*i),o=Math.max(1,.5*o)}return r},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),AT={Validator:{isValid:function(e){return null!==e&&void 0!==e},verifyInput:function(e,t){return null===e||void 0===e?t:e}}};AT.Callbacks=function(){var e=AT.Validator;function t(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}return t.prototype.setCallbackOnProgress=function(t){this.onProgress=e.verifyInput(t,this.onProgress)},t.prototype.setCallbackOnMeshAlter=function(t){this.onMeshAlter=e.verifyInput(t,this.onMeshAlter)},t.prototype.setCallbackOnLoad=function(t){this.onLoad=e.verifyInput(t,this.onLoad)},t.prototype.setCallbackOnLoadMaterials=function(t){this.onLoadMaterials=e.verifyInput(t,this.onLoadMaterials)},t}(),AT.LoadedMeshUserOverride=function(){function e(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]}return e.prototype.addMesh=function(e){this.meshes.push(e),this.alteredMesh=!0},e.prototype.isDisregardMesh=function(){return this.disregardMesh},e.prototype.providesAlteredMeshes=function(){return this.alteredMesh},e}(),AT.ResourceDescriptor=function(){var e=AT.Validator;function t(t,r){var n=t.split("/");n.length<2?(this.path=null,this.name=t,this.url=t):(this.path=e.verifyInput(n.slice(0,n.length-1).join("/")+"/",null),this.name=e.verifyInput(n[n.length-1],null),this.url=t),this.extension=e.verifyInput(r,"default"),this.extension=this.extension.trim(),this.content=null}return t.prototype.setContent=function(t){this.content=e.verifyInput(t,null)},t}(),AT.PrepData=function(){var e=AT.Validator;function t(t){this.logging={enabled:!0,debug:!1},this.modelName=e.verifyInput(t,""),this.resources=[],this.callbacks=new AT.Callbacks}return t.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},t.prototype.getCallbacks=function(){return this.callbacks},t.prototype.addResource=function(e){this.resources.push(e)},t.prototype.clone=function(){var e,t,r=new AT.PrepData(this.modelName);for(e in r.logging.enabled=this.logging.enabled,r.logging.debug=this.logging.debug,r.resources=this.resources,r.callbacks=this.callbacks,this)t=this[e],r.hasOwnProperty(e)||"function"==typeof this[e]||(r[e]=t);return r},t.prototype.checkResourceDescriptorFiles=function(t,r){var n,i,o,s,a={};for(var l in t)if(n=t[l],s=!1,e.isValid(n.name))if(e.isValid(n.content)){for(o=0;o<r.length&&!s;o++)if(i=r[o],n.extension.toLowerCase()===i.ext.toLowerCase())if(i.ignore)s=!0;else if("ArrayBuffer"===i.type){if(!(n.content instanceof ArrayBuffer||n.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";a[i.ext]=n,s=!0}else if("String"===i.type){if(!("string"==typeof n.content||n.content instanceof String))throw"Provided  content is not of type String! Aborting...";a[i.ext]=n,s=!0}if(!s)throw'Unidentified resource "'+n.name+'": '+n.url}else{if(!("string"==typeof n.name||n.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(o=0;o<r.length&&!s;o++)i=r[o],n.extension.toLowerCase()===i.ext.toLowerCase()&&(i.ignore||(a[i.ext]=n),s=!0);if(!s)throw'Unidentified resource "'+n.name+'": '+n.url}return a},t}(),AT.MeshBuilder=function(){var e="1.2.0",t=AT.Validator;function r(){console.info("Using LoaderSupport.MeshBuilder version: "+e),this.logging={enabled:!0,debug:!1},this.callbacks=new AT.Callbacks,this.materials=[]}return r.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},r.prototype.init=function(){var e=new ww({color:14479871});e.name="defaultMaterial";var t=new ww({color:14479871});t.name="defaultVertexColorMaterial",t.vertexColors=jy;var r=new bb;r.name="defaultLineMaterial";var n=new Tw({size:1});n.name="defaultPointMaterial";var i={};i[e.name]=e,i[t.name]=t,i[r.name]=r,i[n.name]=n,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:i}})},r.prototype.setMaterials=function(e){var r={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:t.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(e):e}};this.updateMaterials(r)},r.prototype._setCallbacks=function(e){t.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),t.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),t.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),t.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials)},r.prototype.processPayload=function(e){return"meshData"===e.cmd?this.buildMeshes(e):"materialData"===e.cmd?(this.updateMaterials(e),null):void 0},r.prototype.buildMeshes=function(e){var r,n,i,o=e.params.meshName,s=new Cy;s.addAttribute("position",new my(new Float32Array(e.buffers.vertices),3)),t.isValid(e.buffers.indices)&&s.setIndex(new my(new Uint32Array(e.buffers.indices),1)),t.isValid(e.buffers.colors)&&s.addAttribute("color",new my(new Float32Array(e.buffers.colors),3)),t.isValid(e.buffers.normals)?s.addAttribute("normal",new my(new Float32Array(e.buffers.normals),3)):s.computeVertexNormals(),t.isValid(e.buffers.uvs)&&s.addAttribute("uv",new my(new Float32Array(e.buffers.uvs),2));var a=e.materials.materialNames,l=e.materials.multiMaterial,c=[];for(i in a)n=a[i],r=this.materials[n],l&&c.push(r);if(l){r=c;var u,h=e.materials.materialGroups;for(i in h)u=h[i],s.addGroup(u.start,u.count,u.index)}var d,p,f,m=[],v=this.callbacks.onMeshAlter,g=!0,y=t.verifyInput(e.geometryType,0);if(t.isValid(v)&&(p=v({detail:{meshName:o,bufferGeometry:s,material:r,geometryType:y}}),t.isValid(p))){if(!p.isDisregardMesh()&&p.providesAlteredMeshes())for(var x in p.meshes)m.push(p.meshes[x]);g=!1}if(g&&(e.computeBoundingSphere&&s.computeBoundingSphere(),(d=0===y?new Mb(s,r):1===y?new FS(s,r):new $_(s,r)).name=o,m.push(d)),t.isValid(m)&&m.length>0){var b=[];for(var x in m)d=m[x],b[x]=d.name;f="Adding mesh(es) ("+b.length+": "+b+") from input mesh: "+o,f+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)"}else f="Not adding mesh: "+o,f+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)";var w=this.callbacks.onProgress;t.isValid(w)&&w(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:e.params.meshName,text:f,numericalValue:e.progress.numericalValue}}));return m},r.prototype.updateMaterials=function(e){var r,n,i=e.materials.materialCloneInstructions;if(t.isValid(i)){var o=i.materialNameOrg,s=this.materials[o];if(t.isValid(o)){r=s.clone(),n=i.materialName,r.name=n;var a=i.materialProperties;for(var l in a)r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&(r[l]=a[l]);this.materials[n]=r}else console.warn('Requested material "'+o+'" is not available!')}var c=e.materials.serializedMaterials;if(t.isValid(c)&&Object.keys(c).length>0){var u,h=new Cw;for(n in c)u=c[n],t.isValid(u)&&(r=h.parse(u),this.logging.enabled&&console.info('De-serialized material with name "'+n+'" will be added.'),this.materials[n]=r)}if(c=e.materials.runtimeMaterials,t.isValid(c)&&Object.keys(c).length>0)for(n in c)r=c[n],this.logging.enabled&&console.info('Material with name "'+n+'" will be added.'),this.materials[n]=r},r.prototype.getMaterialsJSON=function(){var e,t={};for(var r in this.materials)e=this.materials[r],t[r]=e.toJSON();return t},r.prototype.getMaterials=function(){return this.materials},r}(),AT.WorkerRunnerRefImpl=function(){function e(){var e=this;self.addEventListener("message",function(t){e.processMessage(t.data)},!1)}return e.prototype.applyProperties=function(e,t){var r,n,i;for(r in t)n="set"+r.substring(0,1).toLocaleUpperCase()+r.substring(1),i=t[r],"function"==typeof e[n]?e[n](i):e.hasOwnProperty(r)&&(e[r]=i)},e.prototype.processMessage=function(e){if("run"===e.cmd){var t={callbackMeshBuilder:function(e){self.postMessage(e)},callbackProgress:function(t){e.logging.enabled&&e.logging.debug&&console.debug("WorkerRunner: progress: "+t)}},r=new Parser;"function"==typeof r.setLogging&&r.setLogging(e.logging.enabled,e.logging.debug),this.applyProperties(r,e.params),this.applyProperties(r,e.materials),this.applyProperties(r,t),r.workerScope=self,r.parse(e.data.input,e.data.options),e.logging.enabled&&console.log("WorkerRunner: Run complete!"),t.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)},e}(),AT.WorkerSupport=function(){var e="2.2.0",t=AT.Validator,r=function(){function e(){this._reset()}return e.prototype._reset=function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},e.prototype.setForceCopy=function(e){this.forceCopy=!0===e},e.prototype.initWorker=function(e,t){this.runnerImplName=t;var r=new Blob([e],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},e.prototype._receiveWorkerMessage=function(e){var t=e.data;switch(t.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(t);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+t.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+t.cmd)}},e.prototype.setCallbacks=function(e,r){this.callbacks.meshBuilder=t.verifyInput(e,this.callbacks.meshBuilder),this.callbacks.onLoad=t.verifyInput(r,this.callbacks.onLoad)},e.prototype.run=function(e){if(t.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=e,this.started=!0,!t.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!t.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==e.cmd&&(e.cmd="run"),t.isValid(e.logging)?(e.logging.enabled=!0===e.logging.enabled,e.logging.debug=!0===e.logging.debug):e.logging={enabled:!0,debug:!1},this._postMessage()}},e.prototype._postMessage=function(){var e;t.isValid(this.queuedMessage)&&t.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(e=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[e])):this.worker.postMessage(this.queuedMessage))},e.prototype.setTerminateRequested=function(e){this.terminateRequested=!0===e,this.terminateRequested&&t.isValid(this.worker)&&!t.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},e.prototype._terminate=function(){this.worker.terminate(),this._reset()},e}();function n(){if(console.info("Using LoaderSupport.WorkerSupport version: "+e),this.logging={enabled:!0,debug:!1},void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this.loaderWorker=new r}n.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},n.prototype.setForceWorkerDataCopy=function(e){this.loaderWorker.setForceCopy(e)},n.prototype.validate=function(e,r,n,s,a){if(!t.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),t.isValid(a)?this.logging.enabled&&console.info('WorkerSupport: Using "'+a.name+'" as Runner class for worker.'):(a=AT.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.'));var l=e(i,o);l+="var Parser = "+r+";\n\n",l+=o(a.name,a),l+="new "+a.name+"();\n\n";var c=this;if(t.isValid(n)&&n.length>0){var u="",h=function(e,t){if(0===t.length)c.loaderWorker.initWorker(u+l,a.name),c.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var r=new mw;r.setPath(e),r.setResponseType("text"),r.load(t[0],function(r){u+=r,h(e,t)}),t.shift()}};h(s,n)}else this.loaderWorker.initWorker(l,a.name),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},n.prototype.setCallbacks=function(e,t){this.loaderWorker.setCallbacks(e,t)},n.prototype.run=function(e){this.loaderWorker.run(e)},n.prototype.setTerminateRequested=function(e){this.loaderWorker.setTerminateRequested(e)};var i=function(e,t){var r,n=e+" = {\n";for(var i in t)"string"==typeof(r=t[i])||r instanceof String?n+="\t"+i+': "'+(r=(r=r.replace("\n","\\n")).replace("\r","\\r"))+'",\n':r instanceof Array?n+="\t"+i+": ["+r+"],\n":Number.isInteger(r)?n+="\t"+i+": "+r+",\n":"function"==typeof r&&(n+="\t"+i+": "+r+",\n");return n+="}\n\n"},o=function(e,r,n,i,o){var s,a,l="",c=t.isValid(n)?n:r.name;for(var u in o=t.verifyInput(o,[]),r.prototype)s=r.prototype[u],"constructor"===u?a="\tfunction "+c+s.toString().replace("function","")+";\n\n":"function"==typeof s&&o.indexOf(u)<0&&(l+="\t"+c+".prototype."+u+" = "+s.toString()+";\n\n");l+="\treturn "+c+";\n",l+="})();\n\n";var h="";return t.isValid(i)&&(h+="\n",h+=c+".prototype = Object.create( "+i+".prototype );\n",h+=c+".constructor = "+c+";\n",h+="\n"),t.isValid(a)?l=e+" = (function () {\n\n"+h+a+l:(a=e+" = (function () {\n\n",l=(a+=h+"\t"+r.prototype.constructor.toString()+"\n\n")+l),l};return n}(),AT.WorkerDirector=function(){var e="2.2.0",t=AT.Validator,r=16,n=8192;function i(i){if(console.info("Using LoaderSupport.WorkerDirector version: "+e),this.logging={enabled:!0,debug:!1},this.maxQueueSize=n,this.maxWebWorkers=r,this.crossOrigin=null,!t.isValid(i))throw"Provided invalid classDef: "+i;this.workerDescription={classDef:i,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}return i.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},i.prototype.getMaxQueueSize=function(){return this.maxQueueSize},i.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},i.prototype.setCrossOrigin=function(e){this.crossOrigin=e},i.prototype.setForceWorkerDataCopy=function(e){this.workerDescription.forceWorkerDataCopy=!0===e},i.prototype.prepareWorkers=function(e,i,o){t.isValid(e)&&(this.workerDescription.globalCallbacks=e),this.maxQueueSize=Math.min(i,n),this.maxWebWorkers=Math.min(o,r),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var s=0;s<this.maxWebWorkers;s++){var a=new AT.WorkerSupport;a.setLogging(this.logging.enabled,this.logging.debug),a.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[s]={instanceNo:s,inUse:!1,terminateRequested:!1,workerSupport:a,loader:null}}},i.prototype.enqueueForRun=function(e){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(e)},i.prototype.isRunning=function(){var e=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||e.length>0},i.prototype.processQueue=function(){var e,t;for(var r in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[r]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(e=this.instructionQueue[this.instructionQueuePointer],this._kickWorkerRun(e,t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},i.prototype._kickWorkerRun=function(e,r){r.inUse=!0,r.workerSupport.setTerminateRequested(r.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var n=this,i=e.getCallbacks(),o=this.workerDescription.globalCallbacks;r.loader=this._buildLoader(r.instanceNo);var s=new AT.Callbacks;s.setCallbackOnLoad(function(e){t.isValid(o.onLoad)&&o.onLoad(e),t.isValid(i.onLoad)&&i.onLoad(e),n.objectsCompleted++,r.inUse=!1,n.processQueue()}),s.setCallbackOnProgress(function(e){t.isValid(o.onProgress)&&o.onProgress(e),t.isValid(i.onProgress)&&i.onProgress(e)}),s.setCallbackOnMeshAlter(function(e){t.isValid(o.onMeshAlter)&&o.onMeshAlter(e),t.isValid(i.onMeshAlter)&&i.onMeshAlter(e)}),e.callbacks=s,r.loader.run(e,r.workerSupport)},i.prototype._buildLoader=function(e){var r=this.workerDescription.classDef,n=Object.create(r.prototype);if(r.call(n,pw),!n.hasOwnProperty("instanceNo"))throw r.name+' has no property "instanceNo".';if(n.instanceNo=e,!n.hasOwnProperty("workerSupport"))throw r.name+' has no property "workerSupport".';if("function"!=typeof n.run)throw r.name+' has no function "run".';return n.hasOwnProperty("callbacks")&&t.isValid(n.callbacks)||(console.warn(r.name+' has an invalid property "callbacks". Will change to "LoaderSupport.Callbacks"'),n.callbacks=new AT.Callbacks),n},i.prototype._deregister=function(e){if(t.isValid(e)){e.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+e.instanceNo+".");var r=e.loader.callbacks;t.isValid(r.onProgress)&&r.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[e.instanceNo]}},i.prototype.tearDown=function(e){for(var r in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=t.verifyInput(e,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[r].terminateRequested=!0},i}();var ET,CT=function(e){this.manager=void 0!==e?e:pw};CT.prototype={constructor:CT,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(){var e=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];return function(t){console.time("MD2Loader");for(var r=new DataView(t),n={},i=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],o=0;o<i.length;o++)n[i[o]]=r.getInt32(4*o,!0);if(844121161===n.ident&&8===n.version){if(n.offset_end===r.byteLength){for(var s=new py,a=[],l=n.offset_st,c=(o=0,n.num_st);o<c;o++){var u=r.getInt16(l+0,!0),h=r.getInt16(l+2,!0);a.push(new hy(u/n.skinwidth,1-h/n.skinheight)),l+=4}for(l=n.offset_tris,o=0,c=n.num_tris;o<c;o++){var d=r.getUint16(l+0,!0),p=r.getUint16(l+2,!0),f=r.getUint16(l+4,!0);s.faces.push(new ly(d,p,f)),s.faceVertexUvs[0].push([a[r.getUint16(l+6,!0)],a[r.getUint16(l+8,!0)],a[r.getUint16(l+10,!0)]]),l+=12}var m=new Kg,v=new Kg,g=[];for(l=n.offset_frames,o=0,c=n.num_frames;o<c;o++){v.set(r.getFloat32(l+0,!0),r.getFloat32(l+4,!0),r.getFloat32(l+8,!0)),m.set(r.getFloat32(l+12,!0),r.getFloat32(l+16,!0),r.getFloat32(l+20,!0)),l+=24;for(var y=0;y<16;y++){var x=r.getUint8(l+y,!0);if(0===x)break;g[y]=x}var b={name:String.fromCharCode.apply(null,g),vertices:[],normals:[]};l+=16;for(y=0;y<n.num_vertices;y++){var w=r.getUint8(l++,!0),_=r.getUint8(l++,!0),S=r.getUint8(l++,!0),T=e[r.getUint8(l++,!0)],M=new Kg(w*v.x+m.x,S*v.z+m.z,_*v.y+m.y),A=new Kg(T[0],T[2],T[1]);b.vertices.push(M),b.normals.push(A)}s.morphTargets.push(b)}s.vertices=s.morphTargets[0].vertices;for(var E=s.morphTargets[0],C=(y=0,s.faces.length);y<C;y++){(O=s.faces[y]).vertexNormals=[E.normals[O.a],E.normals[O.b],E.normals[O.c]]}for(o=0,c=s.morphTargets.length;o<c;o++){E=s.morphTargets[o];var P=[];for(y=0,C=s.faces.length;y<C;y++){var O=s.faces[y];P.push({a:E.normals[O.a],b:E.normals[O.b],c:E.normals[O.c]})}s.morphNormals.push({vertexNormals:P})}return s.animations=Jb.CreateClipsFromMorphTargetSequences(s.morphTargets,10),console.timeEnd("MD2Loader"),s}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")}}()};var PT={getContext:function(){return void 0===ET&&(ET=new(window.AudioContext||window.webkitAudioContext)),ET},setContext:function(e){ET=e}};function OT(){oy.call(this),this.type="AudioListener",this.context=PT.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function DT(e){oy.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function NT(e){this.manager=void 0!==e?e:pw}OT.prototype=Object.assign(Object.create(oy.prototype),{constructor:OT,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new Kg,t=new $g,r=new Kg,n=new Kg;return function(i){oy.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z))}}()}),DT.prototype=Object.assign(Object.create(oy.prototype),{constructor:DT,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("Audio: this Audio has no playback control.")}else console.warn("Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),Object.assign(NT.prototype,{load:function(e,t,r,n){var i=new mw(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){PT.getContext().decodeAudioData(e,function(e){t(e)})},r,n)}});var LT=function(e){this.manager=void 0!==e?e:pw};function IT(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,o=new Array(i),s={endingStart:sb,endingEnd:sb},a=0;a!==i;++a){var l=n[a].createInterpolant(null);o[a]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ib,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function RT(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function FT(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}LT.prototype={constructor:LT,load:function(e,t,r,n){var i=this,o=new nw,s=new mw(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){o.image=i.parse(e),o.needsUpdate=!0,void 0!==t&&t(o)},r,n),o},parse:function(e){var t=0,r=1,n=2,i=3,o=9,s=10,a=11,l=48,c=4,u=0,h=1,d=2,p=3;e.length<19&&console.error("TGALoader: Not enough data to contain header.");var f=new Uint8Array(e),m=0,v={id_length:f[m++],colormap_type:f[m++],image_type:f[m++],colormap_index:f[m++]|f[m++]<<8,colormap_length:f[m++]|f[m++]<<8,colormap_size:f[m++],origin:[f[m++]|f[m++]<<8,f[m++]|f[m++]<<8],width:f[m++]|f[m++]<<8,height:f[m++]|f[m++]<<8,pixel_size:f[m++],flags:f[m++]};!function(e){switch(e.image_type){case r:case o:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case n:case i:case s:case a:e.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',e.pixel_size)}(v),v.id_length+m>e.length&&console.error("TGALoader: No data."),m+=v.id_length;var g=!1,y=!1,x=!1;switch(v.image_type){case o:g=!0,y=!0;break;case r:y=!0;break;case s:g=!0;break;case n:break;case a:g=!0,x=!0;break;case i:x=!0}var b=document.createElement("canvas");b.width=v.width,b.height=v.height;var w=b.getContext("2d"),_=w.createImageData(v.width,v.height),S=function(e,t,r,n,i){var o,s,a,l;if(s=r.pixel_size>>3,a=r.width*r.height*s,t&&(l=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){var c,u,h;o=new Uint8Array(a);for(var d=0,p=new Uint8Array(s);d<a;)if(u=1+(127&(c=i[n++])),128&c){for(h=0;h<s;++h)p[h]=i[n++];for(h=0;h<u;++h)o.set(p,d+h*s);d+=s*u}else{for(u*=s,h=0;h<u;++h)o[d+h]=i[n++];d+=u}}else o=i.subarray(n,n+=t?r.width*r.height:a);return{pixel_data:o,palettes:l}}(g,y,v,m,f);!function(e,t,r,n,i){var o,s,a,f,m,g;switch((v.flags&l)>>c){default:case d:o=0,a=1,m=t,s=0,f=1,g=r;break;case u:o=0,a=1,m=t,s=r-1,f=-1,g=-1;break;case p:o=t-1,a=-1,m=-1,s=0,f=1,g=r;break;case h:o=t-1,a=-1,m=-1,s=r-1,f=-1,g=-1}if(x)switch(v.pixel_size){case 8:!function(e,t,r,n,i,o,s,a){var l,c,u,h=0,d=v.width;for(u=t;u!==n;u+=r)for(c=i;c!==s;c+=o,h++)l=a[h],e[4*(c+d*u)+0]=l,e[4*(c+d*u)+1]=l,e[4*(c+d*u)+2]=l,e[4*(c+d*u)+3]=255}(e,s,f,g,o,a,m,n);break;case 16:!function(e,t,r,n,i,o,s,a){var l,c,u=0,h=v.width;for(c=t;c!==n;c+=r)for(l=i;l!==s;l+=o,u+=2)e[4*(l+h*c)+0]=a[u+0],e[4*(l+h*c)+1]=a[u+0],e[4*(l+h*c)+2]=a[u+0],e[4*(l+h*c)+3]=a[u+1]}(e,s,f,g,o,a,m,n);break;default:console.error("TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,r,n,i,o,s,a,l){var c,u,h,d=l,p=0,f=v.width;for(h=t;h!==n;h+=r)for(u=i;u!==s;u+=o,p++)c=a[p],e[4*(u+f*h)+3]=255,e[4*(u+f*h)+2]=d[3*c+0],e[4*(u+f*h)+1]=d[3*c+1],e[4*(u+f*h)+0]=d[3*c+2]}(e,s,f,g,o,a,m,n,i);break;case 16:!function(e,t,r,n,i,o,s,a){var l,c,u,h=0,d=v.width;for(u=t;u!==n;u+=r)for(c=i;c!==s;c+=o,h+=2)l=a[h+0]+(a[h+1]<<8),e[4*(c+d*u)+0]=(31744&l)>>7,e[4*(c+d*u)+1]=(992&l)>>2,e[4*(c+d*u)+2]=(31&l)>>3,e[4*(c+d*u)+3]=32768&l?0:255}(e,s,f,g,o,a,m,n);break;case 24:!function(e,t,r,n,i,o,s,a){var l,c,u=0,h=v.width;for(c=t;c!==n;c+=r)for(l=i;l!==s;l+=o,u+=3)e[4*(l+h*c)+3]=255,e[4*(l+h*c)+2]=a[u+0],e[4*(l+h*c)+1]=a[u+1],e[4*(l+h*c)+0]=a[u+2]}(e,s,f,g,o,a,m,n);break;case 32:!function(e,t,r,n,i,o,s,a){var l,c,u=0,h=v.width;for(c=t;c!==n;c+=r)for(l=i;l!==s;l+=o,u+=4)e[4*(l+h*c)+2]=a[u+0],e[4*(l+h*c)+1]=a[u+1],e[4*(l+h*c)+0]=a[u+2],e[4*(l+h*c)+3]=a[u+3]}(e,s,f,g,o,a,m,n);break;default:console.error("TGALoader: Format not supported.")}}(_.data,v.width,v.height,S.pixel_data,S.palettes);return w.putImageData(_,0,0),b}},Object.assign(IT.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,o=i/n,s=n/i;e.warp(1,o,t),this.warp(s,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+r,l[0]=e/s,l[1]=t/s,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*r;if(o<0||0===r)return;this._startTime=null,t=r*o}t*=this._updateTimeScale(e);var s=this._updateTime(t),a=this._updateWeight(e);if(a>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(s),c[u].accumulate(n,a)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var r=this._clip.duration,n=this.loop,i=this._loopCount;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=2202===n;if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=r||t<0){var s=Math.floor(t/r);t-=r*s,i+=Math.abs(s);var a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1==(1&i))return this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:sb:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:sb:2402)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=r,this}}),Object.assign(RT.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==n;++s)r[i+s]=r[s];o=t}else{var a=t/(o+=t);this._mixBufferRegion(r,i,0,a,n)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var s=3*t;this._mixBufferRegion(r,n,s,1-i,t)}for(var a=t,l=t+t;a!==l;++a)if(r[a]!==r[a+t]){o.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,o=n;i!==o;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)e[t+o]=e[r+o]},_slerp:function(e,t,r,n){$g.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var o=1-n,s=0;s!==i;++s){var a=t+s;e[a]=e[a]*o+e[r+s]*n}}}),FT.prototype=Object.assign(Object.create(ey.prototype),{constructor:FT,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,o=e._propertyBindings,s=e._interpolants,a=r.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(c={},l[a]=c);for(var u=0;u!==i;++u){var h=n[u],d=h.name,p=c[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(p=new RT(B_.create(r,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,a,d),o[u]=p}s[u].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,o=0,s=i.length;o!==s;++o){var a=i[o];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],o=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,s=o[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[i];e:{for(var c in s)break e;delete o[n]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new Hb(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Jb.findByName(r,e):e,o=null!==i?i.uuid:e,s=this._actionsByClip[o],a=null;if(void 0!==s){var l=s.actionByRoot[n];if(void 0!==l)return l;a=s.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var c=new IT(this,i,t);return this._bindAction(c,a),this._addInactiveAction(c,o,n),c},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Jb.findByName(r,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,s=0;s!==r;++s){t[s]._update(n,e,i,o)}var a=this._bindings,l=this._nActiveBindings;for(s=0;s!==l;++s)a[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,s=0,a=o.length;s!==a;++s){var l=o[s];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var s in o){var a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}});var kT=function(e){Dw.call(this),this.manager=void 0!==e?e:pw,this.parser=new MMDParser.Parser,this.textureCrossOrigin=null};kT.prototype=Object.create(Dw.prototype),kT.prototype.constructor=kT,kT.prototype.defaultToonTextures=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],kT.prototype.setTextureCrossOrigin=function(e){this.textureCrossOrigin=e},kT.prototype.load=function(e,t,r,n,i){var o=this;this.loadModel(e,function(e){o.loadVmds(t,function(t){o.pourVmdIntoModel(e,t),r(e)},n,i)},n,i)},kT.prototype.loadModel=function(e,t,r,n){var i=this,o=Nw.extractUrlBase(e),s=this.extractExtension(e);this.loadFileAsBuffer(e,function(e){t(i.createModel(e,s,o,r,n))},r,n)},kT.prototype.createModel=function(e,t,r,n,i){return this.createMesh(this.parseModel(e,t),r,n,i)},kT.prototype.loadVmd=function(e,t,r,n){var i=this;this.loadFileAsBuffer(e,function(e){t(i.parseVmd(e))},r,n)},kT.prototype.loadVmds=function(e,t,r,n){var i=this,o=[];e=e.slice(),function s(){var a=e.shift();i.loadVmd(a,function(r){o.push(r),e.length>0?s():t(i.mergeVmds(o))},r,n)}()},kT.prototype.loadAudio=function(e,t,r,n){var i=new OT,o=new DT(i);new NT(this.manager).load(e,function(e){o.setBuffer(e),t(o,i)},r,n)},kT.prototype.loadVpd=function(e,t,r,n,i){var o=this;(i&&"unicode"===i.charcode?this.loadFileAsText:this.loadFileAsShiftJISText).bind(this)(e,function(e){t(o.parseVpd(e))},r,n)},kT.prototype.parseModel=function(e,t){switch(t.toLowerCase()){case"pmd":return this.parsePmd(e);case"pmx":return this.parsePmx(e);default:throw"extension "+t+" is not supported."}},kT.prototype.parsePmd=function(e){return this.parser.parsePmd(e,!0)},kT.prototype.parsePmx=function(e){return this.parser.parsePmx(e,!0)},kT.prototype.parseVmd=function(e){return this.parser.parseVmd(e,!0)},kT.prototype.parseVpd=function(e){return this.parser.parseVpd(e,!0)},kT.prototype.mergeVmds=function(e){return this.parser.mergeVmds(e)},kT.prototype.pourVmdIntoModel=function(e,t,r){this.createAnimation(e,t,r)},kT.prototype.pourVmdIntoCamera=function(e,t,r){var n=new kT.DataCreationHelper;!function(){for(var i=n.createOrderedMotionArray(t.cameras),o=[],s=[],a=[],l=[],c=[],u=[],h=[],d=[],p=[],f=new $g,m=new ty,v=new Kg,g=new Kg,y=function(e,t){e.push(t.x),e.push(t.y),e.push(t.z)},x=function(e,t){e.push(t.x),e.push(t.y),e.push(t.z),e.push(t.w)},b=function(e,t,r){e.push(t[4*r+0]/127),e.push(t[4*r+1]/127),e.push(t[4*r+2]/127),e.push(t[4*r+3]/127)},w=function(e,t,r,n,i){if(r.length>2){r=r.slice(),n=n.slice(),i=i.slice();for(var o=n.length/r.length,s=3===o?12:4,a=1,l=2,c=r.length;l<c;l++){for(var u=0;u<o;u++)if(n[a*o+u]!==n[(a-1)*o+u]||n[a*o+u]!==n[l*o+u]){a++;break}if(l>a){for(r[a]=r[l],u=0;u<o;u++)n[a*o+u]=n[l*o+u];for(u=0;u<s;u++)i[a*s+u]=i[l*s+u]}}r.length=a+1,n.length=(a+1)*o,i.length=(a+1)*s}return new kT[t](e,r,n,i)},_=0;_<i.length;_++){var S=i[_],T=S.frameNum/30,M=S.position,A=S.rotation,E=S.distance,C=S.fov,P=S.interpolation;v.set(0,0,-E),g.set(M[0],M[1],M[2]),m.set(-A[0],-A[1],-A[2]),f.setFromEuler(m),v.add(g),v.applyQuaternion(f),o.length>0&&T<o[o.length-1]+.05&&(o[o.length-1]=T-1e-13),o.push(T),y(s,g),x(a,f),y(l,v),c.push(C);for(var O=0;O<3;O++)b(u,P,O);for(b(h,P,3),O=0;O<3;O++)b(d,P,4);b(p,P,5)}if(0!==o.length){var D=[];D.push(w(".center","VectorKeyframeTrackEx",o,s,u)),D.push(w(".quaternion","QuaternionKeyframeTrackEx",o,a,h)),D.push(w(".position","VectorKeyframeTrackEx",o,l,d)),D.push(w(".fov","NumberKeyframeTrackEx",o,c,p));var N=new Jb(void 0===r?Zg.generateUUID():r,-1,D);void 0===e.center&&(e.center=new Kg(0,0,0)),void 0===e.animations&&(e.animations=[]),e.animations.push(N)}}()},kT.prototype.extractExtension=function(e){var t=e.lastIndexOf(".");return t<0?null:e.slice(t+1)},kT.prototype.loadFile=function(e,t,r,n,i,o){var s=new mw(this.manager);return void 0!==o&&s.setMimeType(o),s.setResponseType(i),s.load(e,function(e){t(e)},r,n)},kT.prototype.loadFileAsBuffer=function(e,t,r,n){this.loadFile(e,t,r,n,"arraybuffer")},kT.prototype.loadFileAsText=function(e,t,r,n){this.loadFile(e,t,r,n,"text")},kT.prototype.loadFileAsShiftJISText=function(e,t,r,n){this.loadFile(e,t,r,n,"text","text/plain; charset=shift_jis")},kT.prototype.createMesh=function(e,t,r,n){var i=this,o=new Cy,s=[],a={vertices:[],uvs:[],normals:[],skinIndices:[],skinWeights:[],indices:[]};return function(){for(var t=0;t<e.metadata.vertexCount;t++){for(var r=e.vertices[t],n=0,i=r.position.length;n<i;n++)a.vertices.push(r.position[n]);for(n=0,i=r.normal.length;n<i;n++)a.normals.push(r.normal[n]);for(n=0,i=r.uv.length;n<i;n++)a.uvs.push(r.uv[n]);for(n=0;n<4;n++)a.skinIndices.push(r.skinIndices.length-1>=n?r.skinIndices[n]:0);for(n=0;n<4;n++)a.skinWeights.push(r.skinWeights.length-1>=n?r.skinWeights[n]:0)}}(),function(){for(var t=0;t<e.metadata.faceCount;t++)for(var r=e.faces[t],n=0,i=r.indices.length;n<i;n++)a.indices.push(r.indices[n])}(),function(){for(var t=[],r=e.rigidBodies,n={},i=0,s=r.length;i<s;i++){var a=r[i],l=n[a.boneIndex];l=void 0===l?a.type:Math.max(a.type,l),n[a.boneIndex]=l}for(i=0;i<e.metadata.boneCount;i++){var c={},u=e.bones[i];c.parent=u.parentIndex,c.name=u.name,c.pos=[u.position[0],u.position[1],u.position[2]],c.rotq=[0,0,0,1],c.scl=[1,1,1],-1!==c.parent&&(c.pos[0]-=e.bones[c.parent].position[0],c.pos[1]-=e.bones[c.parent].position[1],c.pos[2]-=e.bones[c.parent].position[2]),c.rigidBodyType=void 0!==n[i]?n[i]:-1,t.push(c)}o.bones=t}(),function(){var t=[];if("pmd"===e.metadata.format)for(var r=0;r<e.metadata.ikCount;r++){var n=e.iks[r];(s={}).target=n.target,s.effector=n.effector,s.iteration=n.iteration,s.maxAngle=4*n.maxAngle,s.links=[];for(var i=0;i<n.links.length;i++)(a={}).index=n.links[i].index,e.bones[a.index].name.indexOf("\u3072\u3056")>=0&&(a.limitation=new Kg(1,0,0)),s.links.push(a);t.push(s)}else for(r=0;r<e.metadata.boneCount;r++)if(void 0!==(n=e.bones[r].ik)){var s;for((s={}).target=r,s.effector=n.effector,s.iteration=n.iteration,s.maxAngle=n.maxAngle,s.links=[],i=0;i<n.links.length;i++){var a;(a={}).index=n.links[i].index,a.enabled=!0,1===n.links[i].angleLimitation&&(a.limitation=new Kg(1,0,0)),s.links.push(a)}t.push(s)}o.iks=t}(),function(){if("pmd"!==e.metadata.format){for(var t=[],r=0;r<e.metadata.boneCount;r++){var n=e.bones[r],i=n.grant;if(void 0!==i){var s={};s.index=r,s.parentIndex=i.parentIndex,s.ratio=i.ratio,s.isLocal=i.isLocal,s.affectRotation=i.affectRotation,s.affectPosition=i.affectPosition,s.transformationClass=n.transformationClass,t.push(s)}}t.sort(function(e,t){return e.transformationClass-t.transformationClass}),o.grants=t}}(),function(){function t(e,t,r,n){e.array[3*t+0]+=r.position[0]*n,e.array[3*t+1]+=r.position[1]*n,e.array[3*t+2]+=r.position[2]*n}function r(r,n,i){for(var o=0;o<n.elementCount;o++){var s=n.elements[o];t(r,"pmd"===e.metadata.format?e.morphs[0].elements[s.index].index:s.index,s,i)}}for(var n=[],i=[],s=0;s<e.metadata.morphCount;s++){var l=e.morphs[s],c={name:l.name},u=new Sy(3*e.metadata.vertexCount,3);u.name=l.name;for(var h=0;h<3*e.metadata.vertexCount;h++)u.array[h]=a.vertices[h];if("pmd"===e.metadata.format)0!==s&&r(u,l,1);else if(0===l.type)for(h=0;h<l.elementCount;h++){var d=e.morphs[l.elements[h].index],p=l.elements[h].ratio;1===d.type&&r(u,d,p)}else 1===l.type?r(u,l,1):2===l.type||3===l.type||4===l.type||5===l.type||6===l.type||7===l.type||l.type;n.push(c),i.push(u)}o.morphTargets=n,o.morphAttributes.position=i}(),function(){var a={},l=new Ow(i.manager),c=new LT(i.manager),u=document.createElement("canvas"),h=u.getContext("2d"),d=0,p=[];function f(e,o){var s;if(void 0===o&&(o={}),!0===o.defaultTexturePath)try{s=i.defaultToonTextures[parseInt(e.match("toon([0-9]{2}).bmp$")[1])]}catch(t){console.warn("MMDLoader: "+e+" seems like not right default texture path. Using toon00.bmp instead."),s=i.defaultToonTextures[0]}else s=t+e;if(void 0!==a[s])return s;var d=Dw.Handlers.get(s);null===d&&(d=e.indexOf(".tga")>=0?c:l);var p=d.load(s,function(e){if(!0===o.isToonTexture){var t=e.image,r=t.width,n=t.height;u.width=r,u.height=n,h.clearRect(0,0,r,n),h.translate(r/2,n/2),h.rotate(.5*Math.PI),h.translate(-r/2,-n/2),h.drawImage(t,0,0),e.image=h.getImageData(0,0,r,n)}e.flipY=!1,e.wrapS=Mx,e.wrapT=Mx;for(var i=0;i<p.readyCallbacks.length;i++)p.readyCallbacks[i](p);delete p.readyCallbacks},r,n);return!0===o.sphericalReflectionMapping&&(p.mapping=_x),p.readyCallbacks=[],a[s]=p,s}function m(e,t){return void 0===t[e]&&console.warn("MMDLoader: Undefined texture",e),t[e]}null!==i.textureCrossOrigin&&l.setCrossOrigin(i.textureCrossOrigin);for(var v=0;v<e.metadata.materialCount;v++){var g=e.materials[v],y={};if(y.faceOffset=d,y.faceNum=g.faceCount,d+=g.faceCount,y.name=g.name,y.color=new ay(g.diffuse[0],g.diffuse[1],g.diffuse[2]),y.opacity=g.diffuse[3],y.specular=new ay(g.specular[0],g.specular[1],g.specular[2]),y.shininess=g.shininess,1===y.opacity?(y.side=Ry,y.transparent=!1):(y.side=ky,y.transparent=!0),"pmd"===e.metadata.format){if(g.fileName){var x=g.fileName,b=[],w=x.lastIndexOf("*");w>=0?(b.push(x.slice(0,w)),b.push(x.slice(w+1))):b.push(x);for(var _=0;_<b.length;_++)(S=b[_]).indexOf(".sph")>=0||S.indexOf(".spa")>=0?(y.envMap=f(S,{sphericalReflectionMapping:!0}),S.indexOf(".sph")>=0?y.envMapType=fx:y.envMapType=mx):y.map=f(S)}}else{if(-1!==g.textureIndex){var S=e.textures[g.textureIndex];y.map=f(S)}-1===g.envTextureIndex||1!==g.envFlag&&2!=g.envFlag||(S=e.textures[g.envTextureIndex],y.envMap=f(S,{sphericalReflectionMapping:!0}),1===g.envFlag?y.envMapType=fx:y.envMapType=mx)}var T=void 0===y.map?1:.2;y.emissive=new ay(g.ambient[0]*T,g.ambient[1]*T,g.ambient[2]*T),p.push(y)}for(v=0;v<p.length;v++){var M=p[v],A=e.materials[v];if(g=new Sw,o.addGroup(3*M.faceOffset,3*M.faceNum,v),void 0!==M.name&&(g.name=M.name),g.skinning=o.bones.length>0,g.morphTargets=o.morphTargets.length>0,g.lights=!0,g.side="pmx"===e.metadata.format&&1==(1&A.flag)?ky:M.side,g.transparent=M.transparent,g.fog=!0,g.blending=Xy,g.blendSrc=ex,g.blendDst=tx,g.blendSrcAlpha=ex,g.blendDstAlpha=rx,void 0!==M.map){function E(e){e.map.readyCallbacks.push(function(t){function r(e,t){var r=e.width,n=e.height,i=Math.round(t.x*r)%r,o=Math.round(t.y*n)%n;i<0&&(i+=r),o<0&&(o+=n);var s=o*r+i;return e.data[4*s+3]}var n=void 0!==t.image.data?t.image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,t.width,t.height)}(t.image),i=o.index.array.slice(3*e.faceOffset,3*e.faceOffset+3*e.faceNum);(function(e,t,n){var i=e.width,o=e.height;if(e.data.length/(i*o)!=4)return!1;for(var s=0;s<n.length;s+=3){for(var a={x:0,y:0},l=0;l<3;l++){var c=n[3*s+l],u={x:t[2*c+0],y:t[2*c+1]};if(r(e,u)<253)return!0;a.x+=u.x,a.y+=u.y}if(a.x/=3,a.y/=3,r(e,a)<253)return!0}return!1})(n,o.attributes.uv.array,i)&&(e.transparent=!0),delete e.faceOffset,delete e.faceNum})}g.faceOffset=M.faceOffset,g.faceNum=M.faceNum,g.map=m(M.map,a),E(g)}if(void 0!==M.envMap&&(g.envMap=m(M.envMap,a),g.combine=M.envMapType),g.opacity=M.opacity,g.color=M.color,void 0!==M.emissive&&(g.emissive=M.emissive),g.specular=M.specular,g.shininess=Math.max(M.shininess,1e-4),"pmd"===e.metadata.format){function C(e){return 10===e.length&&null!==e.match(/toon(10|0[0-9]).bmp/)}g.outlineParameters={thickness:1===A.edgeFlag?.003:0,color:new ay(0,0,0),alpha:1},0===g.outlineParameters.thickness&&(g.outlineParameters.visible=!1);var P=f(O=-1===A.toonIndex?"toon00.bmp":e.toonTextures[A.toonIndex].fileName,{isToonTexture:!0,defaultTexturePath:C(O)});g.gradientMap=m(P,a)}else{var O,D;if(g.outlineParameters={thickness:A.edgeSize/300,color:new ay(A.edgeColor[0],A.edgeColor[1],A.edgeColor[2]),alpha:A.edgeColor[3]},0!=(16&A.flag)&&0!==g.outlineParameters.thickness||(g.outlineParameters.visible=!1),-1===A.toonIndex||0!==A.toonFlag){var N=A.toonIndex+1;O="toon"+(N<10?"0"+N:N)+".bmp",D=!0}else O=e.textures[A.toonIndex],D=!1;P=f(O,{isToonTexture:!0,defaultTexturePath:D}),g.gradientMap=m(P,a)}s.push(g)}if("pmx"===e.metadata.format){function L(e,t){if(8===e.type)for(var r=0;r<t.length;r++){var n=t[r];if(-1!==n.index){var i=s[n.index];i.opacity!==n.diffuse[3]&&(i.transparent=!0)}}}for(v=0;v<e.morphs.length;v++){var I=e.morphs[v],R=I.elements;if(0===I.type)for(_=0;_<R.length;_++){var F=e.morphs[R[_].index];L(F,F.elements)}else L(I,R)}}}(),function(){for(var t=[],r=[],n=0;n<e.metadata.rigidBodyCount;n++){for(var i=e.rigidBodies[n],s=Object.keys(i),a={},l=0;l<s.length;l++)a[h=s[l]]=i[h];if("pmx"===e.metadata.format&&-1!==a.boneIndex){var c=e.bones[a.boneIndex];a.position[0]-=c.position[0],a.position[1]-=c.position[1],a.position[2]-=c.position[2]}t.push(a)}for(n=0;n<e.metadata.constraintCount;n++){var u=e.constraints[n];for(s=Object.keys(u),a={},l=0;l<s.length;l++){var h;a[h=s[l]]=u[h]}var d=t[a.rigidBodyIndex1],p=t[a.rigidBodyIndex2];0!==d.type&&2===p.type&&-1!==d.boneIndex&&-1!==p.boneIndex&&e.bones[p.boneIndex].parentIndex===d.boneIndex&&(p.type=1),r.push(a)}o.rigidBodies=t,o.constraints=r}(),o.setIndex(a.indices),o.addAttribute("position",new Sy(a.vertices,3)),o.addAttribute("normal",new Sy(a.normals,3)),o.addAttribute("uv",new Sy(a.uvs,2)),o.addAttribute("skinIndex",new by(a.skinIndices,4)),o.addAttribute("skinWeight",new Sy(a.skinWeights,4)),o.computeBoundingSphere(),o.mmdFormat=e.metadata.format,new bS(o,s)},kT.prototype.createAnimation=function(e,t,r){var n=new kT.DataCreationHelper;!function(){if(0!==t.metadata.motionCount){for(var i=e.geometry.bones,o=n.createOrderedMotionArrays(i,t.motions,"boneName"),s=[],a=function(e,t,r){e.push(t[r+0]/127),e.push(t[r+8]/127),e.push(t[r+4]/127),e.push(t[r+12]/127)},l=0;l<o.length;l++){for(var c=[],u=[],h=[],d=[],p=[],f=i[l],m=o[l],v=0;v<m.length;v++){var g=m[v].frameNum/30,y=m[v].position,x=m[v].rotation,b=m[v].interpolation;c.push(g);for(var w=0;w<3;w++)u.push(f.pos[w]+y[w]);for(w=0;w<4;w++)h.push(x[w]);for(w=0;w<3;w++)a(d,b,w);a(p,b,3)}if(0!==c.length){var _=".bones["+f.name+"]";s.push(new kT.VectorKeyframeTrackEx(_+".position",c,u,d)),s.push(new kT.QuaternionKeyframeTrackEx(_+".quaternion",c,h,p))}}var S=new Jb(void 0===r?Zg.generateUUID():r,-1,s);void 0===e.geometry.animations&&(e.geometry.animations=[]),e.geometry.animations.push(S)}}(),function(){if(0!==t.metadata.morphCount){for(var i=n.createOrderedMotionArrays(e.geometry.morphTargets,t.morphs,"morphName"),o=[],s=0;s<i.length;s++){for(var a=[],l=[],c=i[s],u=0;u<c.length;u++)a.push(c[u].frameNum/30),l.push(c[u].weight);0!==a.length&&o.push(new Yb(".morphTargetInfluences["+s+"]",a,l))}var h=new Jb(void 0===r?Zg.generateUUID():r+"Morph",-1,o);void 0===e.geometry.animations&&(e.geometry.animations=[]),e.geometry.animations.push(h)}}()},kT.DataCreationHelper=function(){},kT.DataCreationHelper.prototype={constructor:kT.DataCreationHelper,toCharcodeStrings:function(e){for(var t="",r=0;r<e.length;r++)t+="0x"+("0000"+e[r].charCodeAt().toString(16)).substr(-4);return t},createDictionary:function(e){for(var t={},r=0;r<e.length;r++)t[e[r].name]=r;return t},initializeMotionArrays:function(e){for(var t=[],r=0;r<e.length;r++)t[r]=[];return t},sortMotionArray:function(e){e.sort(function(e,t){return e.frameNum-t.frameNum})},sortMotionArrays:function(e){for(var t=0;t<e.length;t++)this.sortMotionArray(e[t])},createMotionArray:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t},createMotionArrays:function(e,t,r,n){for(var i=0;i<e.length;i++){var o=e[i],s=r[o[n]];void 0!==s&&t[s].push(o)}},createOrderedMotionArray:function(e){var t=this.createMotionArray(e);return this.sortMotionArray(t),t},createOrderedMotionArrays:function(e,t,r){var n=this.createDictionary(e),i=this.initializeMotionArrays(e);return this.createMotionArrays(t,i,n,r),this.sortMotionArrays(i),i}},kT.VectorKeyframeTrackEx=function(e,t,r,n){this.interpolationParameters=new Float32Array(n),Vb.call(this,e,t,r)},kT.VectorKeyframeTrackEx.prototype=Object.create(Vb.prototype),kT.VectorKeyframeTrackEx.prototype.constructor=kT.VectorKeyframeTrackEx,kT.VectorKeyframeTrackEx.prototype.TimeBufferType=Float64Array,kT.VectorKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new kT.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},kT.VectorKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},kT.QuaternionKeyframeTrackEx=function(e,t,r,n){this.interpolationParameters=new Float32Array(n),jb.call(this,e,t,r)},kT.QuaternionKeyframeTrackEx.prototype=Object.create(jb.prototype),kT.QuaternionKeyframeTrackEx.prototype.constructor=kT.QuaternionKeyframeTrackEx,kT.QuaternionKeyframeTrackEx.prototype.TimeBufferType=Float64Array,kT.QuaternionKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new kT.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},kT.QuaternionKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},kT.NumberKeyframeTrackEx=function(e,t,r,n){this.interpolationParameters=new Float32Array(n),Yb.call(this,e,t,r)},kT.NumberKeyframeTrackEx.prototype=Object.create(Yb.prototype),kT.NumberKeyframeTrackEx.prototype.constructor=kT.NumberKeyframeTrackEx,kT.NumberKeyframeTrackEx.prototype.TimeBufferType=Float64Array,kT.NumberKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new kT.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},kT.NumberKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},kT.CubicBezierInterpolation=function(e,t,r,n,i){Ub.call(this,e,t,r,n),this.params=i},kT.CubicBezierInterpolation.prototype=Object.create(Hb.prototype),kT.CubicBezierInterpolation.prototype.constructor=kT.CubicBezierInterpolation,kT.CubicBezierInterpolation.prototype.interpolate_=function(e,t,r,n){var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(r-t)/(n-t);if(4===s){var u=this.params[4*e+0],h=this.params[4*e+1],d=this.params[4*e+2],p=this.params[4*e+3],f=this._calculate(u,h,d,p,c);$g.slerpFlat(i,0,o,l,o,a,f)}else if(3===s)for(var m=0;m!==s;++m){u=this.params[12*e+4*m+0],h=this.params[12*e+4*m+1],d=this.params[12*e+4*m+2],p=this.params[12*e+4*m+3],f=this._calculate(u,h,d,p,c);i[m]=o[l+m]*(1-f)+o[a+m]*f}else{u=this.params[4*e+0],h=this.params[4*e+1],d=this.params[4*e+2],p=this.params[4*e+3],f=this._calculate(u,h,d,p,c);i[0]=o[l]*(1-f)+o[a]*f}return i},kT.CubicBezierInterpolation.prototype._calculate=function(e,t,r,n,i){for(var o,s,a,l=.5,c=l,u=1-c,h=Math,d=0;d<15;d++){var p=(o=3*u*u*c)*e+(s=3*u*c*c)*t+(a=c*c*c)-i;if(h.abs(p)<1e-5)break;l/=2,u=1-(c+=p<0?l:-l)}return o*r+s*n+a};var UT=function(e,t,r){var n=null===r||void 0===r?{}:r;this.audio=e,this.listener=t,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==n.delayTime?n.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime};UT.prototype={constructor:UT,control:function(e){this.elapsed+=e,this.currentTime+=e,this.checkIfStopAudio()&&this.audio.stop(),this.checkIfStartAudio()&&this.audio.play()},checkIfStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime)&&(this.audio.startTime=this.currentTime-this.delayTime,!0)},checkIfStopAudio:function(){return!!this.audio.isPlaying&&this.currentTime>=this.duration}};var BT=function(e){this.mesh=e};BT.prototype={constructor:BT,update:function(){var e=new $g;return function(){for(var t=0;t<this.mesh.geometry.grants.length;t++){var r=this.mesh.geometry.grants[t],n=this.mesh.skeleton.bones[r.index],i=this.mesh.skeleton.bones[r.parentIndex];r.isLocal?(r.affectPosition,r.affectRotation):(r.affectPosition,r.affectRotation&&(e.set(0,0,0,1),e.slerp(i.quaternion,r.ratio),n.quaternion.multiply(e)))}}}()};var jT=function(){this.meshes=[],this.doAnimation=!0,this.doIk=!0,this.doGrant=!0,this.doPhysics=!0,this.doCameraAnimation=!0,this.sharedPhysics=!1,this.masterPhysics=null,this.audioManager=null,this.camera=null};jT.prototype={constructor:jT,add:function(e){if(!(e instanceof bS))throw new Error("MMDHelper.add() accepts only SkinnedMesh instance.");void 0===e.mixer&&(e.mixer=null),void 0===e.ikSolver&&(e.ikSolver=null),void 0===e.grantSolver&&(e.grantSolver=null),void 0===e.physics&&(e.physics=null),void 0===e.looped&&(e.looped=!1),this.meshes.push(e),this.initBackupBones(e)},setAudio:function(e,t,r){this.audioManager=new UT(e,t,r)},setCamera:function(e){e.mixer=null,this.camera=e},setPhysicses:function(e){for(var t=0;t<this.meshes.length;t++)this.setPhysics(this.meshes[t],e)},setPhysics:function(e,t){if(void 0===(t=void 0===t?{}:Object.assign({},t)).world&&this.sharedPhysics){var r=this.getMasterPhysics();null!==r&&(t.world=r.world)}var n=void 0!==t.warmup?t.warmup:60,i=new Ib(e,t);null!==e.mixer&&void 0!==e.mixer&&!0!==t.preventAnimationWarmup&&(this.animateOneMesh(0,e),i.reset()),i.warmup(n),this.updateIKParametersDependingOnPhysicsEnabled(e,!0),e.physics=i},getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var e=0,t=this.meshes.length;e<t;e++){var r=this.meshes[e].physics;if(void 0!==r&&null!==r)return this.masterPhysics=r,this.masterPhysics}return null},enablePhysics:function(e){this.doPhysics=!0===e;for(var t=0,r=this.meshes.length;t<r;t++)this.updateIKParametersDependingOnPhysicsEnabled(this.meshes[t],e)},updateIKParametersDependingOnPhysicsEnabled:function(e,t){for(var r=e.geometry.iks,n=e.geometry.bones,i=0,o=r.length;i<o;i++)for(var s=r[i].links,a=0,l=s.length;a<l;a++){var c=s[a];c.enabled=!0!==t||!(n[c.index].rigidBodyType>0)}},setAnimations:function(){for(var e=0;e<this.meshes.length;e++)this.setAnimation(this.meshes[e])},setAnimation:function(e){if(void 0!==e.geometry.animations){e.mixer=new FT(e),e.mixer.addEventListener("loop",function(e){e.action._clip.tracks.length>0&&0!==e.action._clip.tracks[0].name.indexOf(".bones")||(e.target._root.looped=!0)});for(var t=!1,r=!1,n=0;n<e.geometry.animations.length;n++){var i=e.geometry.animations[n],o=e.mixer.clipAction(i);i.tracks.length>0&&0===i.tracks[0].name.indexOf(".morphTargetInfluences")?r||(o.play(),r=!0):t||(o.play(),t=!0)}t&&(e.ikSolver=new Eb(e),void 0!==e.geometry.grants&&(e.grantSolver=new BT(e)))}},setCameraAnimation:function(e){void 0!==e.animations&&(e.mixer=new FT(e),e.mixer.clipAction(e.animations[0]).play())},unifyAnimationDuration:function(e){e=void 0===e?{}:e;for(var t=0,r=this.camera,n=this.audioManager,i=0;i<this.meshes.length;i++){if(null!==(a=this.meshes[i].mixer))for(var o=0;o<a._actions.length;o++){var s=a._actions[o];t=Math.max(t,s._clip.duration)}}if(null!==r&&null!==r.mixer){var a=r.mixer;for(i=0;i<a._actions.length;i++){s=a._actions[i];t=Math.max(t,s._clip.duration)}}null!==n&&(t=Math.max(t,n.duration)),void 0!==e.afterglow&&(t+=e.afterglow);for(i=0;i<this.meshes.length;i++){if(null!==(a=this.meshes[i].mixer))for(o=0;o<a._actions.length;o++){(s=a._actions[o])._clip.duration=t}}if(null!==r&&null!==r.mixer)for(a=r.mixer,i=0;i<a._actions.length;i++){(s=a._actions[i])._clip.duration=t}null!==n&&(n.duration=t)},controlAudio:function(e){null!==this.audioManager&&this.audioManager.control(e)},animate:function(e){this.controlAudio(e);for(var t=0;t<this.meshes.length;t++)this.animateOneMesh(e,this.meshes[t]);this.sharedPhysics&&this.updateSharedPhysics(e),this.animateCamera(e)},animateOneMesh:function(e,t){var r=t.mixer,n=t.ikSolver,i=t.grantSolver,o=t.physics;null!==r&&!0===this.doAnimation&&(this.restoreBones(t),r.update(e),this.backupBones(t)),null!==n&&!0===this.doIk&&n.update(),null!==i&&!0===this.doGrant&&i.update(),!0===t.looped&&(null!==o&&o.reset(),t.looped=!1),null!==o&&this.doPhysics&&!this.sharedPhysics&&o.update(e)},updateSharedPhysics:function(e){if(0!==this.meshes.length&&this.doPhysics&&this.sharedPhysics){var t=this.getMasterPhysics();if(null!==t){for(var r=0,n=this.meshes.length;r<n;r++){null!==(i=this.meshes[r].physics)&&void 0!==i&&i.updateRigidBodies()}t.stepSimulation(e);for(r=0,n=this.meshes.length;r<n;r++){var i;null!==(i=this.meshes[r].physics)&&void 0!==i&&i.updateBones()}}}},animateCamera:function(e){if(null!==this.camera){var t=this.camera.mixer;null!==t&&void 0!==this.camera.center&&!0===this.doCameraAnimation&&(t.update(e),this.camera.updateProjectionMatrix(),this.camera.up.set(0,1,0),this.camera.up.applyQuaternion(this.camera.quaternion),this.camera.lookAt(this.camera.center))}},poseAsVpd:function(e,t,r){void 0===r&&(r={}),!0!==r.preventResetPose&&e.pose();for(var n=e.skeleton.bones,i=t.bones,o={},s=0;s<n.length;s++)o[n[s].name]=s;var a=new Kg,l=new $g;for(s=0;s<i.length;s++){var c=i[s],u=o[c.name];if(void 0!==u){var h=n[u],d=c.translation,p=c.quaternion;a.set(d[0],d[1],d[2]),l.set(p[0],p[1],p[2],p[3]),h.position.add(a),h.quaternion.multiply(l)}}(e.updateMatrixWorld(!0),!0!==r.preventIk)&&new Eb(e).update(r.saveOriginalBonesBeforeIK);!0!==r.preventGrant&&void 0!==e.geometry.grants&&new BT(e).update()},initBackupBones:function(e){e.skeleton.backupBones=[];for(var t=0;t<e.skeleton.bones.length;t++)e.skeleton.backupBones.push(e.skeleton.bones[t].clone())},backupBones:function(e){e.skeleton.backupBoneIsSaved=!0;for(var t=0;t<e.skeleton.bones.length;t++){var r=e.skeleton.backupBones[t],n=e.skeleton.bones[t];r.position.copy(n.position),r.quaternion.copy(n.quaternion)}},restoreBones:function(e){if(!0===e.skeleton.backupBoneIsSaved){e.skeleton.backupBoneIsSaved=!1;for(var t=0;t<e.skeleton.bones.length;t++){var r=e.skeleton.bones[t],n=e.skeleton.backupBones[t];r.position.copy(n.position),r.quaternion.copy(n.quaternion)}}}};var zT=function(e){this.manager=void 0!==e?e:pw};zT.prototype={constructor:zT,load:function(e,t,r,n){var i=this,o=new mw(this.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn("MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),r={},n=/\s+/,i={},o=0;o<t.length;o++){var s=t[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var a=s.indexOf(" "),l=a>=0?s.substring(0,a):s;l=l.toLowerCase();var c=a>=0?s.substring(a+1):"";if(c=c.trim(),"newmtl"===l)r={name:c},i[c]=r;else if(r)if("ka"===l||"kd"===l||"ks"===l){var u=c.split(n,3);r[l]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else r[l]=c}}var h=new zT.MaterialCreator(this.texturePath||this.path,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(i),h}},zT.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:Ry,this.wrap=this.options&&this.options.wrap?this.options.wrap:Mx},zT.MaterialCreator.prototype={constructor:zT.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],i={};for(var o in t[r]=i,n){var s=!0,a=n[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===a[0]&&0===a[1]&&0===a[2]&&(s=!1)}s&&(i[l]=a)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function i(e,r){if(!n[e]){var i=t.getTextureParams(r,n),o=t.loadTexture(function(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}(t.baseUrl,i.url));o.repeat.copy(i.scale),o.offset.copy(i.offset),o.wrapS=t.wrap,o.wrapT=t.wrap,n[e]=o}}for(var o in r){var s,a=r[o];if(""!==a)switch(o.toLowerCase()){case"kd":n.color=(new ay).fromArray(a);break;case"ks":n.specular=(new ay).fromArray(a);break;case"map_kd":i("map",a);break;case"map_ks":i("specularMap",a);break;case"norm":i("normalMap",a);break;case"map_bump":case"bump":i("bumpMap",a);break;case"ns":n.shininess=parseFloat(a);break;case"d":(s=parseFloat(a))<1&&(n.opacity=s,n.transparent=!0);break;case"tr":s=parseFloat(a),this.options&&this.options.invertTrProperty&&(s=1-s),s<1&&(n.opacity=s,n.transparent=!0)}}return this.materials[e]=new bw(n),this.materials[e]},getTextureParams:function(e,t){var r,n={scale:new hy(1,1),offset:new hy(0,0)},i=e.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(e,t,r,n,i){var o,s=Dw.Handlers.get(e),a=void 0!==this.manager?this.manager:pw;return null===s&&(s=new Ow(a)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),o=s.load(e,r,n,i),void 0!==t&&(o.mapping=t),o}};var VT=function(e){this.uuid=Zg.generateUUID(),this.name="",this.allows={},this.type=e,this.userData={}};VT.prototype.isNode=!0,VT.prototype.parse=function(e,t){t=t||{},e.parsing=!0;var r=e.material;this.build(e.addCache(t.cache,t.requires).addSlot(t.slot),"v4"),r.clearVertexNode(),r.clearFragmentNode(),e.removeCache().removeSlot(),e.parsing=!1},VT.prototype.parseAndBuildCode=function(e,t,r){return r=r||{},this.parse(e,r),this.buildCode(e,t,r)},VT.prototype.buildCode=function(e,t,r){r=r||{};var n=e.material,i={result:this.build(e.addCache(r.cache,r.requires).addSlot(r.slot),t)};return e.isShader("vertex")?i.code=n.clearVertexNode():i.code=n.clearFragmentNode(),e.removeCache().removeSlot(),i},VT.prototype.build=function(e,t,r){t=t||this.getType(e,t);var n=e.material,i=n.getDataNode(r||this.uuid);if(e.parsing&&this.appendDepsNode(e,i,t),!1===this.allows[e.shader])throw new Error("Shader "+shader+" is not compatible with this node.");return-1===n.nodes.indexOf(this)&&n.nodes.push(this),void 0!==this.updateFrame&&-1===n.updaters.indexOf(this)&&n.updaters.push(this),this.generate(e,t,r)},VT.prototype.appendDepsNode=function(e,t,r){t.deps=(t.deps||0)+1;var n=e.getFormatLength(r);(n>(t.outputMax||0)||this.getType(e,r))&&(t.outputMax=n,t.output=r)},VT.prototype.getType=function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type},VT.prototype.getJSONNode=function(e){if(!(void 0===e||"string"==typeof e)&&void 0!==e.nodes[this.uuid])return e.nodes[this.uuid]},VT.prototype.createJSONNode=function(e){var t=void 0===e||"string"==typeof e,r={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return r.uuid=this.uuid,r.type=this.nodeType+"Node",""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t||(e.nodes[this.uuid]=r),r},VT.prototype.toJSON=function(e){return this.getJSONNode(e)||this.createJSONNode(e)};var GT=function(e,t){VT.call(this,e),t=t||{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique};GT.prototype=Object.create(VT.prototype),GT.prototype.constructor=GT,GT.prototype.build=function(e,t,r,n){t=t||this.getType(e);var i=e.material;if(this.isShared(e,t)){var o=this.isUnique(e,t);o&&void 0===this.constructor.uuid&&(this.constructor.uuid=Zg.generateUUID()),r=e.getUuid(r||this.getUuid(),!o);var s=i.getDataNode(r);if(e.parsing)return s.deps?(this.appendDepsNode(e,s,t),this.generate(e,l,r)):VT.prototype.build.call(this,e,t,r);if(o)return s.name=s.name||VT.prototype.build.call(this,e,t,r),s.name;if(!e.optimize||1==s.deps)return VT.prototype.build.call(this,e,t,r);r=this.getUuid(!1);var a=this.getTemp(e,r),l=s.output||this.getType(e);if(a)return e.format(a,l,t);a=GT.prototype.generate.call(this,e,t,r,s.output,n);var c=this.generate(e,l,r);return e.isShader("vertex")?i.addVertexNode(a+"="+c+";"):i.addFragmentNode(a+"="+c+";"),e.format(a,l,t)}return VT.prototype.build.call(this,e,t,r)},GT.prototype.isShared=function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared},GT.prototype.isUnique=function(e,t){return this.unique},GT.prototype.getUuid=function(e){var t=(e||void 0==e)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t},GT.prototype.getTemp=function(e,t){t=t||this.uuid;var r=e.material;return e.isShader("vertex")&&r.vertexTemps[t]?r.vertexTemps[t].name:r.fragmentTemps[t]?r.fragmentTemps[t].name:void 0},GT.prototype.generate=function(e,t,r,n,i){return this.isShared(e,t)||console.error("TempNode is not shared!"),r=r||this.uuid,e.isShader("vertex")?e.material.getVertexTemp(r,n||this.getType(e),i).name:e.material.getFragmentTemp(r,n||this.getType(e),i).name};var HT=function(e,t,r,n){e=e||"",this.isMethod="string"!=typeof t,this.useKeywords=!0,GT.call(this,this.isMethod?null:t),this.isMethod?this.eval(e,t,r,n):this.eval(e,r,n)};HT.rDeclaration=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\((.*?)\)/i,HT.rProperties=/[a-z_0-9]+/gi,HT.prototype=Object.create(GT.prototype),HT.prototype.constructor=HT,HT.prototype.eval=function(e,t,r,n){if(e=(e||"").trim(),this.includes=t||[],this.extensions=r||{},this.keywords=n||{},this.isMethod){var i=e.match(HT.rDeclaration);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var o=i[3].match(HT.rProperties);if(o)for(var s=0;s<o.length;){var a,l,c=o[s++];"in"==c||"out"==c||"inout"==c?a=o[s++]:(a=c,c=""),l=o[s++],this.inputs.push({name:l,type:a,qualifier:c})}}else this.type="",this.name=""}this.value=e};var WT={nodes:{},keywords:{},add:function(e){this.nodes[e.name]=e},addKeyword:function(e,t,r){r=void 0===r||r,this.keywords[e]={callback:t,cache:r}},remove:function(e){delete this.nodes[e.name]},removeKeyword:function(e){delete this.keywords[e]},get:function(e){return this.nodes[e]},getKeyword:function(e,t){return this.keywords[e].callback.call(this,t)},getKeywordData:function(e){return this.keywords[e]},contains:function(e){return void 0!=this.nodes[e]},containsKeyword:function(e){return void 0!=this.keywords[e]}},XT=function(e){GT.call(this,"v2",{shared:!1}),this.index=e||0};XT.vertexDict=["uv","uv2"],XT.fragmentDict=["vUv","vUv2"],XT.prototype=Object.create(GT.prototype),XT.prototype.constructor=XT,XT.prototype.nodeType="UV",XT.prototype.generate=function(e,t){var r;return e.material.requires.uv[this.index]=!0,r=e.isShader("vertex")?XT.vertexDict[this.index]:XT.fragmentDict[this.index],e.format(r,this.getType(e),t)},XT.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t};var qT=function(e){GT.call(this,"v3"),this.scope=e||qT.LOCAL};qT.LOCAL="local",qT.WORLD="world",qT.VIEW="view",qT.PROJECTION="projection",qT.prototype=Object.create(GT.prototype),qT.prototype.constructor=qT,qT.prototype.nodeType="Position",qT.prototype.getType=function(e){switch(this.scope){case qT.PROJECTION:return"v4"}return this.type},qT.prototype.isShared=function(e){switch(this.scope){case qT.LOCAL:case qT.WORLD:return!1}return!0},qT.prototype.generate=function(e,t){var r,n=e.material;switch(this.scope){case qT.LOCAL:n.requires.position=!0,r=e.isShader("vertex")?"transformed":"vPosition";break;case qT.WORLD:n.requires.worldPosition=!0,r=(e.isShader("vertex"),"vWPosition");break;case qT.VIEW:r=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case qT.PROJECTION:r=e.isShader("vertex")?"(projectionMatrix * modelViewMatrix * vec4( position, 1.0 ))":"vec4( 0.0 )"}return e.format(r,this.getType(e),t)},qT.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t};var YT=function(e){GT.call(this,"v3"),this.scope=e||YT.LOCAL};YT.LOCAL="local",YT.WORLD="world",YT.VIEW="view",YT.prototype=Object.create(GT.prototype),YT.prototype.constructor=YT,YT.prototype.nodeType="Normal",YT.prototype.isShared=function(e){switch(this.scope){case YT.WORLD:return!0}return!1},YT.prototype.generate=function(e,t){var r,n=e.material;switch(this.scope){case YT.LOCAL:n.requires.normal=!0,r=e.isShader("vertex")?"normal":"vObjectNormal";break;case YT.WORLD:n.requires.worldNormal=!0,r=e.isShader("vertex")?"( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz":"vWNormal";break;case YT.VIEW:r="vNormal"}return e.format(r,this.getType(e),t)},YT.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t};var JT=function(e,t){(t=t||{}).shared=void 0!==t.shared&&t.shared,GT.call(this,e,t),this.readonly=!1};JT.prototype=Object.create(GT.prototype),JT.prototype.constructor=JT,JT.prototype.isReadonly=function(e){return this.readonly},JT.prototype.generate=function(e,t,r,n,i,o){var s=e.material;r=e.getUuid(r||this.getUuid()),n=n||this.getType(e);var a=s.getDataNode(r);return this.isReadonly(e)&&void 0!==this.generateReadonly?this.generateReadonly(e,t,r,n,i,o):e.isShader("vertex")?(a.vertex||(a.vertex=s.createVertexUniform(n,this.value,i,o)),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=s.createFragmentUniform(n,this.value,i,o)),e.format(a.fragment.name,n,t))};var ZT=function(e){JT.call(this,"fv1"),this.value=[e||0]};ZT.prototype=Object.create(JT.prototype),ZT.prototype.constructor=ZT,ZT.prototype.nodeType="Float",Object.defineProperties(ZT.prototype,{number:{get:function(){return this.value[0]},set:function(e){this.value[0]=e}}}),ZT.prototype.generateReadonly=function(e,t,r,n,i,o){var s=this.number;return e.format(Math.floor(s)!==s?s:s+".0",n,t)},ZT.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).number=this.number,!0===this.readonly&&(t.readonly=!0)),t};var QT=function(e,t){ZT.call(this),this.scale=void 0!==e?e:1,this.scope=t||QT.GLOBAL,this.timeScale=1!==this.scale};QT.GLOBAL="global",QT.LOCAL="local",QT.DELTA="delta",QT.prototype=Object.create(ZT.prototype),QT.prototype.constructor=QT,QT.prototype.nodeType="Timer",QT.prototype.isReadonly=function(e){return!1},QT.prototype.isUnique=function(e){return this.timeScale&&(this.scope===QT.GLOBAL||this.scope===QT.DELTA)},QT.prototype.updateFrame=function(e){var t=this.timeScale?this.scale:1;switch(this.scope){case QT.LOCAL:this.number+=e.delta*t;break;case QT.DELTA:this.number=e.delta*t;break;default:this.number=e.time*t}},QT.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope,t.scale=this.scale,t.timeScale=this.timeScale),t};var KT=function(e,t){GT.call(this),this.eval(e||KT.PI,t)};KT.PI="PI",KT.PI2="PI2",KT.RECIPROCAL_PI="RECIPROCAL_PI",KT.RECIPROCAL_PI2="RECIPROCAL_PI2",KT.LOG2="LOG2",KT.EPSILON="EPSILON",KT.prototype=Object.create(GT.prototype),KT.prototype.constructor=KT,KT.prototype.nodeType="Const",KT.prototype.getType=function(e){return e.getTypeByFormat(this.type)},KT.prototype.eval=function(e,t){var r,n,i="",o=(e=(e||"").trim()).match(/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i);this.useDefine=t,o&&o.length>1?(n=o[1],r=o[2],i=o[3]):(r=e,n="fv1"),this.name=r,this.type=n,this.value=i},KT.prototype.build=function(e,t){return"source"!==t?(e.include(this),e.format(this.name,this.getType(e),t)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":void 0},KT.prototype.generate=function(e,t){return e.format(this.name,this.getType(e),t)},KT.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).name=this.name,t.out=this.type,this.value&&(t.value=this.value),!0===t.useDefine&&(t.useDefine=!0)),t},WT.addKeyword("uv",function(){return new XT}),WT.addKeyword("uv2",function(){return new XT(1)}),WT.addKeyword("position",function(){return new qT}),WT.addKeyword("worldPosition",function(){return new qT(qT.WORLD)}),WT.addKeyword("normal",function(){return new YT}),WT.addKeyword("worldNormal",function(){return new YT(YT.WORLD)}),WT.addKeyword("viewPosition",function(){return new qT(YT.VIEW)}),WT.addKeyword("viewNormal",function(){return new YT(YT.VIEW)}),WT.addKeyword("time",function(){return new QT}),WT.add(new KT("vec3 LUMA vec3(0.2125, 0.7154, 0.0721)")),WT.add(new HT(["vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 mUv, vec2 scale ) {","\tvec3 q0 = dFdx( eye_pos );","\tvec3 q1 = dFdy( eye_pos );","\tvec2 st0 = dFdx( mUv.st );","\tvec2 st1 = dFdy( mUv.st );","\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );","\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );","\tvec3 N = normalize( surf_norm );","\tvec3 mapN = map * 2.0 - 1.0;","\tmapN.xy = scale * mapN.xy;","\tmat3 tsn = mat3( S, T, N );","\treturn normalize( tsn * mapN );","}"].join("\n"),null,{derivatives:!0})),WT.add(new HT(["float snoise(vec2 co) {","\treturn fract( sin( dot(co.xy, vec2(12.9898,78.233) ) ) * 43758.5453 );","}"].join("\n"))),WT.add(new HT(["vec3 hue_rgb(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n"))),WT.add(new HT(["vec3 saturation_rgb(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3(dot(rgb, LUMA));","\treturn mix(intensity, rgb, adjustment);","}"].join("\n"))),WT.add(new HT(["float luminance_rgb(vec3 rgb) {","\treturn dot(rgb, LUMA);","}"].join("\n"))),WT.add(new HT(["vec3 vibrance_rgb(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))),HT.prototype.isShared=function(e,t){return!this.isMethod},HT.prototype.getType=function(e){return e.getTypeByFormat(this.type)},HT.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},HT.prototype.getIncludeByName=function(e){for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]},HT.prototype.generate=function(e,t){for(var r,n=0,i=this.value,o=0;o<this.includes.length;o++)e.include(this.includes[o],this);for(var s in this.extensions)e.material.extensions[s]=!0;for(;r=HT.rProperties.exec(this.value);){var a=r[0],l=!this.isMethod||!this.getInputByName(a),c=a;if(this.keywords[a]||this.useKeywords&&l&&WT.containsKeyword(a)){var u=this.keywords[a];if(!u){var h=WT.getKeywordData(a);h.cache&&(u=e.keywords[a]),u=u||WT.getKeyword(a,e),h.cache&&(e.keywords[a]=u)}c=u.build(e)}a!=c&&(i=i.substring(0,r.index+n)+c+i.substring(r.index+a.length+n),n+=c.length-a.length),void 0===this.getIncludeByName(c)&&WT.contains(c)&&e.include(WT.get(c))}return"source"===t?i:this.isMethod?(e.include(this,!1,i),this.name):e.format("("+i+")",this.getType(e),t)};var $T=function(e,t){GT.call(this,"v3"),this.setScope(e||$T.POSITION),this.setCamera(t)};$T.fDepthColor=new HT(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n")),$T.POSITION="position",$T.DEPTH="depth",$T.TO_VERTEX="toVertex",$T.prototype=Object.create(GT.prototype),$T.prototype.constructor=$T,$T.prototype.nodeType="Camera",$T.prototype.setCamera=function(e){this.camera=e,this.updateFrame=void 0!==e?this.onUpdateFrame:void 0},$T.prototype.setScope=function(e){switch(this.scope){case $T.DEPTH:delete this.near,delete this.far}switch(this.scope=e,e){case $T.DEPTH:var t=this.camera;this.near=new ZT(t?t.near:1),this.far=new ZT(t?t.far:1200)}},$T.prototype.getType=function(e){switch(this.scope){case $T.DEPTH:return"fv1"}return this.type},$T.prototype.isUnique=function(e){switch(this.scope){case $T.DEPTH:case $T.TO_VERTEX:return!0}return!1},$T.prototype.isShared=function(e){switch(this.scope){case $T.POSITION:return!1}return!0},$T.prototype.generate=function(e,t){var r;e.material;switch(this.scope){case $T.POSITION:r="cameraPosition";break;case $T.DEPTH:var n=$T.fDepthColor;e.include(n),r=n.name+"("+this.near.build(e,"fv1")+","+this.far.build(e,"fv1")+")";break;case $T.TO_VERTEX:r="normalize( "+new qT(qT.WORLD).build(e,"v3")+" - cameraPosition )"}return e.format(r,this.getType(e),t)},$T.prototype.onUpdateFrame=function(e){switch(this.scope){case $T.DEPTH:var t=this.camera;this.near.number=t.near,this.far.number=t.far}},$T.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t)switch((t=this.createJSONNode(e)).scope=this.scope,this.camera&&(t.camera=this.camera.uuid),this.scope){case $T.DEPTH:t.near=this.near.number,t.far=this.far.number}return t};Object.assign((function(e,t){this.manager=void 0!==e?e:pw,this.nodes={},this.materials={},this.passes={},this.names={},this.library=t||{}}).prototype,{load:function(e,t,r,n){var i=this;return new mw(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n),this},getObjectByName:function(e){return this.names[e]},getObjectById:function(e){return this.library[e]||this.nodes[e]||this.names[e]},getNode:function(e){var t=this.getObjectById(e);return t||console.warn('Node "'+e+'" not found.'),t},parse:function(e){var t,r,n,i,o;for(t in e.nodes)r=e.nodes[t],n=new THREE[r.type],r.name?(n.name=r.name,this.names[n.name]=n):n.readonly=!0,void 0!==r.readonly&&(n.readonly=r.readonly),this.nodes[t]=n;for(t in e.materials)r=e.materials[t],n=new THREE[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.materials[t]=n;for(t in e.passes)r=e.passes[t],n=new THREE[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.passes[t]=n;for(t in e.material&&(this.material=this.materials[t]),e.pass&&(this.pass=this.passes[t]),e.nodes)switch(r=e.nodes[t],n=this.nodes[t],r.type){case"FloatNode":n.number=r.number;break;case"ColorNode":n.value.copy(r);break;case"Vector2Node":n.x=r.x,n.y=r.y;break;case"Vector3Node":n.x=r.x,n.y=r.y,n.z=r.z;break;case"Vector4Node":n.x=r.x,n.y=r.y,n.z=r.z,n.w=r.w;break;case"Matrix3Node":case"Matrix4Node":n.value.fromArray(r.elements);break;case"OperatorNode":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.op=r.op;break;case"Math1Node":n.a=this.getNode(r.a),n.method=r.method;break;case"Math2Node":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.method=r.method;break;case"Math3Node":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.c=this.getNode(r.c),n.method=r.method;break;case"UVNode":case"ColorsNode":n.index=r.index;break;case"LuminanceNode":n.rgb=this.getNode(r.rgb);break;case"PositionNode":case"NormalNode":case"ReflectNode":case"LightNode":n.scope=r.scope;break;case"SwitchNode":n.node=this.getNode(r.node),n.components=r.components;break;case"JoinNode":for(i in r.inputs)n[i]=this.getNode(r.inputs[i]);break;case"CameraNode":switch(n.setScope(r.scope),r.camera&&n.setCamera(this.getNode(r.camera)),r.scope){case $T.DEPTH:n.near.number=r.near,n.far.number=r.far}break;case"ColorAdjustmentNode":n.rgb=this.getNode(r.rgb),n.adjustment=this.getNode(r.adjustment),n.method=r.method;break;case"UVTransformNode":n.uv=this.getNode(r.uv),n.transform=this.getNode(r.transform);break;case"BumpNode":n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.scale=this.getNode(r.scale);break;case"BlurNode":n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.scale=this.getNode(r.scale),n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.radius=this.getNode(r.radius),void 0!==r.size&&(n.size=new hy(r.size.x,r.size.y)),n.blurX=r.blurX,n.blurY=r.blurY;break;case"ResolutionNode":n.renderer=this.getNode(r.renderer);break;case"ScreenUVNode":n.resolution=this.getNode(r.resolution);break;case"VelocityNode":r.target&&n.setTarget(this.getNode(r.target)),n.setParams(r.params);break;case"TimerNode":n.scope=r.scope,n.scale=r.scale;break;case"ConstNode":n.name=r.name,n.type=r.out,n.value=r.value,n.useDefine=!0===r.useDefine;break;case"AttributeNode":case"VarNode":n.type=r.out;break;case"ReflectorNode":n.setMirror(this.getNode(r.mirror)),r.offset&&(n.offset=this.getNode(r.offset));break;case"NoiseNode":n.coord=this.getNode(r.coord);break;case"FunctionNode":for(i in n.isMethod=r.isMethod,n.useKeywords=r.useKeywords,n.extensions=r.extensions,n.keywords={},r.keywords)n.keywords[i]=this.getNode(r.keywords[i]);if(r.includes)for(o=0;o<r.includes.length;o++)n.includes.push(this.getNode(r.includes[o]));n.eval(r.src,n.includes,n.extensions,n.keywords),n.isMethod||(n.type=r.out);break;case"FunctionCallNode":for(i in r.inputs)n.inputs[i]=this.getNode(r.inputs[i]);n.value=this.getNode(r.value);break;case"TextureNode":case"CubeTextureNode":case"ScreenNode":r.value&&(n.value=this.getNode(r.value)),n.coord=this.getNode(r.coord),r.bias&&(n.bias=this.getNode(r.bias)),void 0!==n.project&&(n.project=r.project);break;case"RoughnessToBlinnExponentNode":break;case"RawNode":n.value=this.getNode(r.value);break;case"StandardNode":case"PhongNode":case"SpriteNode":n.color=this.getNode(r.color),r.alpha&&(n.alpha=this.getNode(r.alpha)),r.specular&&(n.specular=this.getNode(r.specular)),r.shininess&&(n.shininess=this.getNode(r.shininess)),r.roughness&&(n.roughness=this.getNode(r.roughness)),r.metalness&&(n.metalness=this.getNode(r.metalness)),r.reflectivity&&(n.reflectivity=this.getNode(r.reflectivity)),r.clearCoat&&(n.clearCoat=this.getNode(r.clearCoat)),r.clearCoatRoughness&&(n.clearCoatRoughness=this.getNode(r.clearCoatRoughness)),r.normal&&(n.normal=this.getNode(r.normal)),r.normalScale&&(n.normalScale=this.getNode(r.normalScale)),r.emissive&&(n.emissive=this.getNode(r.emissive)),r.ambient&&(n.ambient=this.getNode(r.ambient)),r.shadow&&(n.shadow=this.getNode(r.shadow)),r.light&&(n.light=this.getNode(r.light)),r.ao&&(n.ao=this.getNode(r.ao)),r.environment&&(n.environment=this.getNode(r.environment)),r.environmentAlpha&&(n.environmentAlpha=this.getNode(r.environmentAlpha)),r.transform&&(n.transform=this.getNode(r.transform)),!1===r.spherical&&(n.spherical=!1);break;default:console.warn(r.type,"not supported.")}for(t in e.materials)r=e.materials[t],n=this.materials[t],void 0!==r.name&&(n.name=r.name),void 0!==r.blending&&(n.blending=r.blending),void 0!==r.flatShading&&(n.flatShading=r.flatShading),void 0!==r.side&&(n.side=r.side),n.depthFunc=r.depthFunc,n.depthTest=r.depthTest,n.depthWrite=r.depthWrite,void 0!==r.wireframe&&(n.wireframe=r.wireframe),void 0!==r.wireframeLinewidth&&(n.wireframeLinewidth=r.wireframeLinewidth),void 0!==r.wireframeLinecap&&(n.wireframeLinecap=r.wireframeLinecap),void 0!==r.wireframeLinejoin&&(n.wireframeLinejoin=r.wireframeLinejoin),void 0!==r.skinning&&(n.skinning=r.skinning),void 0!==r.morphTargets&&(n.morphTargets=r.morphTargets),void 0!==r.visible&&(n.visible=r.visible),void 0!==r.userData&&(n.userData=r.userData),n.vertex=this.getNode(r.vertex),n.fragment=this.getNode(r.fragment),n.vertex===n.fragment&&(n.node=n.vertex),n.build(),void 0!==r.fog&&(n.fog=r.fog),void 0!==r.lights&&(n.lights=r.lights),void 0!==r.transparent&&(n.transparent=r.transparent);for(t in e.passes)r=e.passes[t],(n=this.passes[t]).value=this.getNode(r.value),n.build();return this.material||this.pass||this}});!function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /;function n(e){this.manager=void 0!==e?e:pw,this.materials=null}n.prototype={constructor:n,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){this.path=e},setMaterials:function(e){return this.materials=e,this},parse:function(n){console.time("OBJLoader");var i=new function(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(e,t,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[r+0],n[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,i,o,s,a,l){var c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(r,c);if(this.addVertex(u,h,d),void 0!==n&&""!==n){var p=this.uvs.length;u=this.parseUVIndex(n,p),h=this.parseUVIndex(i,p),d=this.parseUVIndex(o,p),this.addUV(u,h,d)}if(void 0!==s&&""!==s){var f=this.normals.length;u=this.parseNormalIndex(s,f),h=s===a?u:this.parseNormalIndex(a,f),d=s===l?u:this.parseNormalIndex(l,f),this.addNormal(u,h,d)}this.colors.length>0&&this.addColor(u,h,d)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,n=e.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var s=0;for(o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],n))}};return e.startObject("",!1),e};-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var o=n.split("\n"),s="",a="",l=[],c="function"==typeof"".trimLeft,u=0,h=o.length;u<h;u++)if(s=o[u],0!==(s=c?s.trimLeft():s.trim()).length&&"#"!==(a=s.charAt(0)))if("v"===a){var d=s.split(/\s+/);switch(d[0]){case"v":i.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&i.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":i.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":i.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===a){for(var p=s.substr(1).trim().split(/\s+/),f=[],m=0,v=p.length;m<v;m++){var g=p[m];if(g.length>0){var y=g.split("/");f.push(y)}}var x=f[0];for(m=1,v=f.length-1;m<v;m++){var b=f[m],w=f[m+1];i.addFace(x[0],b[0],w[0],x[1],b[1],w[1],x[2],b[2],w[2])}}else if("l"===a){var _=s.substring(1).trim().split(" "),S=[],T=[];if(-1===s.indexOf("/"))S=_;else for(var M=0,A=_.length;M<A;M++){var E=_[M].split("/");""!==E[0]&&S.push(E[0]),""!==E[1]&&T.push(E[1])}i.addLineGeometry(S,T)}else if("p"===a){var C=s.substr(1).trim().split(" ");i.addPointGeometry(C)}else if(null!==(l=e.exec(s))){var P=(" "+l[0].substr(1).trim()).substr(1);i.startObject(P)}else if(r.test(s))i.object.startMaterial(s.substring(7).trim(),i.materialLibraries);else if(t.test(s))i.materialLibraries.push(s.substring(7).trim());else{if("s"!==a){if("\0"===s)continue;throw new Error('OBJLoader: Unexpected line: "'+s+'"')}if((l=s.split(" ")).length>1){var O=l[1].trim().toLowerCase();i.object.smooth="0"!==O&&"off"!==O}else i.object.smooth=!0;(H=i.object.currentMaterial())&&(H.smooth=i.object.smooth)}i.finalize();var D=new mS;D.materialLibraries=[].concat(i.materialLibraries);for(u=0,h=i.objects.length;u<h;u++){var N=i.objects[u],L=N.geometry,I=N.materials,R="Line"===L.type,F="Points"===L.type,k=!1;if(0!==L.vertices.length){var U=new Cy;U.addAttribute("position",new Sy(L.vertices,3)),L.normals.length>0?U.addAttribute("normal",new Sy(L.normals,3)):U.computeVertexNormals(),L.colors.length>0&&(k=!0,U.addAttribute("color",new Sy(L.colors,3))),L.uvs.length>0&&U.addAttribute("uv",new Sy(L.uvs,2));for(var B,j=[],z=0,V=I.length;z<V;z++){var G=I[z],H=void 0;if(null!==this.materials)if(H=this.materials.create(G.name),!R||!H||H instanceof bb){if(F&&H&&!(H instanceof Tw)){var W=new Tw({size:10,sizeAttenuation:!1});X.copy(H),H=W}}else{var X=new bb;X.copy(H),X.lights=!1,H=X}H||((H=R?new bb:F?new Tw({size:1,sizeAttenuation:!1}):new bw).name=G.name),H.flatShading=!G.smooth,H.vertexColors=k?jy:Uy,j.push(H)}if(j.length>1){for(z=0,V=I.length;z<V;z++){G=I[z];U.addGroup(G.groupStart,G.groupCount,z)}B=R?new FS(U,j):F?new $_(U,j):new Mb(U,j)}else B=R?new FS(U,j[0]):F?new $_(U,j[0]):new Mb(U,j[0]);B.name=N.name,D.add(B)}}return console.timeEnd("OBJLoader"),D}}}();void 0===AT&&console.error('"LoaderSupport" is not available. "OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.');!function(){var e="2.4.0",t=AT.Validator;function r(r){console.info("Using OBJLoader2 version: "+e),this.manager=t.verifyInput(r,pw),this.logging={enabled:!0,debug:!1},this.modelName="",this.instanceNo=0,this.path="",this.useIndices=!1,this.disregardNormals=!1,this.materialPerSmoothingGroup=!1,this.loaderRootNode=new mS,this.meshBuilder=new AT.MeshBuilder,this.callbacks=new AT.Callbacks,this.workerSupport=new AT.WorkerSupport,this.terminateWorkerOnLoad=!0}r.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.meshBuilder.setLogging(this.logging.enabled,this.logging.debug)},r.prototype.setModelName=function(e){this.modelName=t.verifyInput(e,this.modelName)},r.prototype.setPath=function(e){this.path=t.verifyInput(e,this.path)},r.prototype.setStreamMeshesTo=function(e){this.loaderRootNode=t.verifyInput(e,this.loaderRootNode)},r.prototype.setMaterials=function(e){this.meshBuilder.setMaterials(e)},r.prototype.setUseIndices=function(e){this.useIndices=!0===e},r.prototype.setDisregardNormals=function(e){this.disregardNormals=!0===e},r.prototype.setMaterialPerSmoothingGroup=function(e){this.materialPerSmoothingGroup=!0===e},r.prototype._setCallbacks=function(e){t.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),t.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),t.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),t.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials),this.meshBuilder._setCallbacks(this.callbacks)},r.prototype.onProgress=function(e,r,n){var i=t.isValid(r)?r:"",o={detail:{type:e,modelName:this.modelName,instanceNo:this.instanceNo,text:i,numericalValue:n}};t.isValid(this.callbacks.onProgress)&&this.callbacks.onProgress(o),this.logging.enabled&&this.logging.debug&&console.debug(i)},r.prototype._onError=function(e){var t="Error occurred while downloading!";throw e.currentTarget&&null!==e.currentTarget.statusText&&(t+="\nurl: "+e.currentTarget.responseURL+"\nstatus: "+e.currentTarget.statusText),this.onProgress("error",t,-1),t},r.prototype.load=function(e,t,r,n,i,o){var s=new AT.ResourceDescriptor(e,"OBJ");this._loadObj(s,t,r,n,i,o)},r.prototype._loadObj=function(e,r,n,i,o,s){t.isValid(i)||(i=this._onError),t.isValid(e)||i("An invalid ResourceDescriptor was provided. Unable to continue!");var a=this,l=function(t){if(e.content=t,s)a.parseAsync(t,r);else{var n=new AT.Callbacks;n.setCallbackOnMeshAlter(o),a._setCallbacks(n),r({detail:{loaderRootNode:a.parse(t),modelName:a.modelName,instanceNo:a.instanceNo}})}};if(!t.isValid(e.url)||t.isValid(e.content))l(t.isValid(e.content)?e.content:null);else{if(!t.isValid(n)){var c=0,u=0;n=function(t){if(t.lengthComputable&&(u=t.loaded/t.total)>c){c=u;var r='Download of "'+e.url+'": '+(100*u).toFixed(2)+"%";a.onProgress("progressLoad",r,u)}}}var h=new mw(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(e.url,l,n,i)}},r.prototype.run=function(e,r){this._applyPrepData(e);var n=e.checkResourceDescriptorFiles(e.resources,[{ext:"obj",type:"ArrayBuffer",ignore:!1},{ext:"mtl",type:"String",ignore:!1},{ext:"zip",type:"String",ignore:!0}]);t.isValid(r)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=r,this.logging.enabled=this.workerSupport.logging.enabled,this.logging.debug=this.workerSupport.logging.debug);var i=this;this._loadMtl(n.mtl,function(t){null!==t&&i.meshBuilder.setMaterials(t),i._loadObj(n.obj,i.callbacks.onLoad,null,null,i.callbacks.onMeshAlter,e.useAsync)},e.crossOrigin,e.materialOptions)},r.prototype._applyPrepData=function(e){t.isValid(e)&&(this.setLogging(e.logging.enabled,e.logging.debug),this.setModelName(e.modelName),this.setStreamMeshesTo(e.streamMeshesTo),this.meshBuilder.setMaterials(e.materials),this.setUseIndices(e.useIndices),this.setDisregardNormals(e.disregardNormals),this.setMaterialPerSmoothingGroup(e.materialPerSmoothingGroup),this._setCallbacks(e.getCallbacks()))},r.prototype.parse=function(e){if(!t.isValid(e))return console.warn("Provided content is not a valid ArrayBuffer or String."),this.loaderRootNode;this.logging.enabled&&console.time("OBJLoader2 parse: "+this.modelName),this.meshBuilder.init();var r=new n;r.setLogging(this.logging.enabled,this.logging.debug),r.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),r.setUseIndices(this.useIndices),r.setDisregardNormals(this.disregardNormals),r.setMaterials(this.meshBuilder.getMaterials());var i=this;r.setCallbackMeshBuilder(function(e){var t,r=i.meshBuilder.processPayload(e);for(var n in r)t=r[n],i.loaderRootNode.add(t)});if(r.setCallbackProgress(function(e,t){i.onProgress("progressParse",e,t)}),e instanceof ArrayBuffer||e instanceof Uint8Array)this.logging.enabled&&console.info("Parsing arrayBuffer..."),r.parse(e);else{if(!("string"==typeof e||e instanceof String))throw"Provided content was neither of type String nor Uint8Array! Aborting...";this.logging.enabled&&console.info("Parsing text..."),r.parseText(e)}return this.logging.enabled&&console.timeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},r.prototype.parseAsync=function(e,r){var i=this,o=!1,s=function(){r({detail:{loaderRootNode:i.loaderRootNode,modelName:i.modelName,instanceNo:i.instanceNo}}),o&&i.logging.enabled&&console.timeEnd("OBJLoader2 parseAsync: "+i.modelName)};t.isValid(e)?o=!0:(console.warn("Provided content is not a valid ArrayBuffer."),s()),o&&this.logging.enabled&&console.time("OBJLoader2 parseAsync: "+this.modelName),this.meshBuilder.init();this.workerSupport.validate(function(e,r){var i="";return i+="\n\n",i+="var LoaderSupport = {};\n\n",i+=e("LoaderSupport.Validator",t),i+=r("Parser",n)},"Parser"),this.workerSupport.setCallbacks(function(e){var t,r=i.meshBuilder.processPayload(e);for(var n in r)t=r[n],i.loaderRootNode.add(t)},s),i.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var a={},l=this.meshBuilder.getMaterials();for(var c in l)a[c]=c;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logging:{enabled:this.logging.enabled,debug:this.logging.debug},materials:{materials:a},data:{input:e,options:null}})};var n=function(){function e(){this.callbackProgress=null,this.callbackMeshBuilder=null,this.contentRef=null,this.legacyMode=!1,this.materials={},this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0},this.logging={enabled:!0,debug:!1}}return e.prototype.resetRawMesh=function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this.pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},e.prototype.setUseAsync=function(e){this.useAsync=e},e.prototype.setMaterialPerSmoothingGroup=function(e){this.materialPerSmoothingGroup=e},e.prototype.setUseIndices=function(e){this.useIndices=e},e.prototype.setDisregardNormals=function(e){this.disregardNormals=e},e.prototype.setMaterials=function(e){this.materials=AT.Validator.verifyInput(e,this.materials),this.materials=AT.Validator.verifyInput(this.materials,{})},e.prototype.setCallbackMeshBuilder=function(e){if(!AT.Validator.isValid(e))throw'Unable to run as no "MeshBuilder" callback is set.';this.callbackMeshBuilder=e},e.prototype.setCallbackProgress=function(e){this.callbackProgress=e},e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},e.prototype.configure=function(){if(this.pushSmoothingGroup(1),this.logging.enabled){var e=Object.keys(this.materials),t="OBJLoader2.Parser configuration:"+(e.length>0?"\n\tmaterialNames:\n\t\t- "+e.join("\n\t\t- "):"\n\tmaterialNames: None")+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackMeshBuilderName: "+this.callbackMeshBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name;console.info(t)}},e.prototype.parse=function(e){this.logging.enabled&&console.time("OBJLoader2.Parser.parse"),this.configure();var t=new Uint8Array(e);this.contentRef=t;var r=t.byteLength;this.globalCounts.totalBytes=r;for(var n,i=new Array(128),o="",s=0,a=0,l=0;l<r;l++)switch(n=t[l]){case 32:o.length>0&&(i[s++]=o),o="";break;case 47:o.length>0&&(i[s++]=o),a++,o="";break;case 10:o.length>0&&(i[s++]=o),o="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=l,this.processLine(i,s,a),s=0,a=0;break;case 13:break;default:o+=String.fromCharCode(n)}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parse")},e.prototype.parseText=function(e){this.logging.enabled&&console.time("OBJLoader2.Parser.parseText"),this.configure(),this.legacyMode=!0,this.contentRef=e;var t=e.length;this.globalCounts.totalBytes=t;for(var r,n=new Array(128),i="",o=0,s=0,a=0;a<t;a++)switch(r=e[a]){case" ":i.length>0&&(n[o++]=i),i="";break;case"/":i.length>0&&(n[o++]=i),s++,i="";break;case"\n":i.length>0&&(n[o++]=i),i="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=a,this.processLine(n,o,s),o=0,s=0;break;case"\r":break;default:i+=r}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parseText")},e.prototype.processLine=function(e,t,r){if(!(t<1)){var n,i,o,s,a=function(e,t,r,n){var i="";if(n>r){var o;if(t)for(o=r;o<n;o++)i+=e[o];else for(o=r;o<n;o++)i+=String.fromCharCode(e[o]);i=i.trim()}return i};switch(s=e[0]){case"v":this.vertices.push(parseFloat(e[1])),this.vertices.push(parseFloat(e[2])),this.vertices.push(parseFloat(e[3])),t>4&&(this.colors.push(parseFloat(e[4])),this.colors.push(parseFloat(e[5])),this.colors.push(parseFloat(e[6])));break;case"vt":this.uvs.push(parseFloat(e[1])),this.uvs.push(parseFloat(e[2]));break;case"vn":this.normals.push(parseFloat(e[1])),this.normals.push(parseFloat(e[2])),this.normals.push(parseFloat(e[3]));break;case"f":if(n=t-1,0===r)for(this.checkFaceType(0),o=2,i=n;o<i;o++)this.buildFace(e[1]),this.buildFace(e[o]),this.buildFace(e[o+1]);else if(n===2*r)for(this.checkFaceType(1),o=3,i=n-2;o<i;o+=2)this.buildFace(e[1],e[2]),this.buildFace(e[o],e[o+1]),this.buildFace(e[o+2],e[o+3]);else if(2*n==3*r)for(this.checkFaceType(2),o=4,i=n-3;o<i;o+=3)this.buildFace(e[1],e[2],e[3]),this.buildFace(e[o],e[o+1],e[o+2]),this.buildFace(e[o+3],e[o+4],e[o+5]);else for(this.checkFaceType(3),o=3,i=n-2;o<i;o+=2)this.buildFace(e[1],void 0,e[2]),this.buildFace(e[o],void 0,e[o+1]),this.buildFace(e[o+2],void 0,e[o+3]);break;case"l":case"p":if((n=t-1)===2*r)for(this.checkFaceType(4),o=1,i=n+1;o<i;o+=2)this.buildFace(e[o],e[o+1]);else for(this.checkFaceType("l"===s?5:6),o=1,i=n+1;o<i;o++)this.buildFace(e[o]);break;case"s":this.pushSmoothingGroup(e[1]);break;case"g":this.processCompletedMesh(),this.rawMesh.groupName=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.rawMesh.objectName=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var l=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==l&&this.rawMesh.activeMtlName!==l&&(this.rawMesh.activeMtlName=l,this.rawMesh.counts.mtlCount++,this.checkSubGroup())}}},e.prototype.pushSmoothingGroup=function(e){var t=parseInt(e);isNaN(t)&&(t="off"===e?0:1);var r=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?t:0===t?0:1,this.rawMesh.smoothingGroup.real=t,r!==t&&(this.rawMesh.counts.smoothingGroupCount++,this.checkSubGroup())},e.prototype.checkFaceType=function(e){this.rawMesh.faceType!==e&&(this.processCompletedMesh(),this.rawMesh.faceType=e,this.checkSubGroup())},e.prototype.checkSubGroup=function(){var e=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[e],AT.Validator.isValid(this.rawMesh.subGroupInUse)||(this.rawMesh.subGroupInUse={index:e,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[e]=this.rawMesh.subGroupInUse)},e.prototype.buildFace=function(e,t,r){this.disregardNormals&&(r=void 0);var n=this,i=function(){var i=parseInt(e),o=3*(i>0?i-1:i+n.vertices.length/3),s=n.rawMesh.subGroupInUse.vertices;s.push(n.vertices[o++]),s.push(n.vertices[o++]),s.push(n.vertices[o]);var a=n.colors.length>0?o:null;if(null!==a){var l=n.rawMesh.subGroupInUse.colors;l.push(n.colors[a++]),l.push(n.colors[a++]),l.push(n.colors[a])}if(t){var c=parseInt(t),u=2*(c>0?c-1:c+n.uvs.length/2),h=n.rawMesh.subGroupInUse.uvs;h.push(n.uvs[u++]),h.push(n.uvs[u])}if(r){var d=parseInt(r),p=3*(d>0?d-1:d+n.normals.length/3),f=n.rawMesh.subGroupInUse.normals;f.push(n.normals[p++]),f.push(n.normals[p++]),f.push(n.normals[p])}};if(this.useIndices){var o=e+(t?"_"+t:"_n")+(r?"_"+r:"_n"),s=this.rawMesh.subGroupInUse.indexMappings[o];AT.Validator.isValid(s)?this.rawMesh.counts.doubleIndicesCount++:(s=this.rawMesh.subGroupInUse.vertices.length/3,i(),this.rawMesh.subGroupInUse.indexMappings[o]=s,this.rawMesh.subGroupInUse.indexMappingsCount++),this.rawMesh.subGroupInUse.indices.push(s)}else i();this.rawMesh.counts.faceCount++},e.prototype.createRawMeshReport=function(e){return"Input Object number: "+e+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},e.prototype.finalizeRawMesh=function(){var e,t,r=[],n=0,i=0,o=0,s=0,a=0,l=0;for(var c in this.rawMesh.subGroups)if((e=this.rawMesh.subGroups[c]).vertices.length>0){if((t=e.indices).length>0&&i>0)for(var u in t)t[u]=t[u]+i;r.push(e),n+=e.vertices.length,i+=e.indexMappingsCount,o+=e.indices.length,s+=e.colors.length,l+=e.uvs.length,a+=e.normals.length}var h=null;return r.length>0&&(h={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:r,absoluteVertexCount:n,absoluteIndexCount:o,absoluteColorCount:s,absoluteNormalCount:a,absoluteUvCount:l,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),h},e.prototype.processCompletedMesh=function(){var e=this.finalizeRawMesh();if(AT.Validator.isValid(e)){if(this.colors.length>0&&this.colors.length!==this.vertices.length)throw"Vertex Colors were detected, but vertex count and color count do not match!";this.logging.enabled&&this.logging.debug&&console.debug(this.createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(e);var t=this.globalCounts.currentByte/this.globalCounts.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*t).toFixed(2)+"%",t),this.resetRawMesh(),!0}return!1},e.prototype.buildMesh=function(e){var t=e.subGroups,r=new Float32Array(e.absoluteVertexCount);this.globalCounts.vertices+=e.absoluteVertexCount/3,this.globalCounts.faces+=e.faceCount,this.globalCounts.doubleIndicesCount+=e.doubleIndicesCount;var n,i,o,s,a,l,c,u=e.absoluteIndexCount>0?new Uint32Array(e.absoluteIndexCount):null,h=e.absoluteColorCount>0?new Float32Array(e.absoluteColorCount):null,d=e.absoluteNormalCount>0?new Float32Array(e.absoluteNormalCount):null,p=e.absoluteUvCount>0?new Float32Array(e.absoluteUvCount):null,f=AT.Validator.isValid(h),m=[],v=t.length>1,g=0,y=[],x=[],b=0,w=0,_=0,S=0,T=0,M=0,A=0;for(var E in t)if(t.hasOwnProperty(E)){if(c=(n=t[E]).materialName,l=this.rawMesh.faceType<4?c+(f?"_vertexColor":"")+(0===n.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial",s=this.materials[c],a=this.materials[l],!AT.Validator.isValid(s)&&!AT.Validator.isValid(a)){var C=f?"defaultVertexColorMaterial":"defaultMaterial";s=this.materials[C],this.logging.enabled&&console.warn('object_group "'+n.objectName+"_"+n.groupName+'" was defined with unresolvable material "'+c+'"! Assigning "'+C+'".'),(c=C)===l&&(a=s,l=C)}if(!AT.Validator.isValid(a)){var P={materialNameOrg:c,materialName:l,materialProperties:{vertexColors:f?2:0,flatShading:0===n.smoothingGroup}},O={cmd:"materialData",materials:{materialCloneInstructions:P}};this.callbackMeshBuilder(O),this.useAsync&&(this.materials[l]=P)}if(v?((i=y[l])||(i=g,y[l]=g,m.push(l),g++),o={start:M,count:A=this.useIndices?n.indices.length:n.vertices.length/3,index:i},x.push(o),M+=A):m.push(l),r.set(n.vertices,b),b+=n.vertices.length,u&&(u.set(n.indices,w),w+=n.indices.length),h&&(h.set(n.colors,_),_+=n.colors.length),d&&(d.set(n.normals,S),S+=n.normals.length),p&&(p.set(n.uvs,T),T+=n.uvs.length),this.logging.enabled&&this.logging.debug){var D=AT.Validator.isValid(i)?"\n\t\tmaterialIndex: "+i:"",N="\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+n.groupName+"\n\t\tIndex: "+n.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+n.materialName+"\n\t\tsmoothingGroup: "+n.smoothingGroup+D+"\n\t\tobjectName: "+n.objectName+"\n\t\t#vertices: "+n.vertices.length/3+"\n\t\t#indices: "+n.indices.length+"\n\t\t#colors: "+n.colors.length/3+"\n\t\t#uvs: "+n.uvs.length/2+"\n\t\t#normals: "+n.normals.length/3;console.debug(N)}}this.outputObjectCount++,this.callbackMeshBuilder({cmd:"meshData",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:e.name},materials:{multiMaterial:v,materialNames:m,materialGroups:x},buffers:{vertices:r,indices:u,colors:h,normals:d,uvs:p},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[r.buffer],AT.Validator.isValid(u)?[u.buffer]:null,AT.Validator.isValid(h)?[h.buffer]:null,AT.Validator.isValid(d)?[d.buffer]:null,AT.Validator.isValid(p)?[p.buffer]:null)},e.prototype.finalizeParsing=function(){if(this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this.processCompletedMesh()&&this.logging.enabled){var e="Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount;console.info(e)}},e}();r.prototype.loadMtl=function(e,t,r,n,i){var o=new AT.ResourceDescriptor(e,"MTL");o.setContent(t),this._loadMtl(o,r,n,i)},r.prototype._loadMtl=function(e,r,n,i){void 0===zT&&console.error('"MTLLoader" is not available. "OBJLoader2" requires it for loading MTL files.'),t.isValid(e)&&this.logging.enabled&&console.time("Loading MTL: "+e.name);var o=[],s=this,a=function(n){var i=[];if(t.isValid(n))for(var a in n.preload(),i=n.materials)i.hasOwnProperty(a)&&(o[a]=i[a]);t.isValid(e)&&s.logging.enabled&&console.timeEnd("Loading MTL: "+e.name),r(o,n)};if(t.isValid(e)&&(t.isValid(e.content)||t.isValid(e.url))){var l=new zT(this.manager);if(n=t.verifyInput(n,"anonymous"),l.setCrossOrigin(n),l.setPath(e.path),t.isValid(i)&&l.setMaterialOptions(i),t.isValid(e.content))a(t.isValid(e.content)?l.parse(e.content):null);else if(t.isValid(e.url)){new mw(this.manager).load(e.url,function(t){e.content=t,a(l.parse(t))},this._onProgress,this._onError)}}else a()}}();var eM=function(e){this.manager=void 0!==e?e:pw,this.littleEndian=!0};eM.prototype={constructor:eM,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(r){t(i.parse(r,e))},r,n)},parse:function(e,t){var r=Nw.decodeText(e),n=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=n[1],t.headerLen=n[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map(function(e){return parseInt(e,10)})),null!==t.count)t.count=t.count[1].split(" ").map(function(e){return parseInt(e,10)});else{t.count=[];for(var i=0,o=t.fields.length;i<o;i++)t.count.push(1)}t.offset={};var s=0;for(i=0,o=t.fields.length;i<o;i++)"ascii"===t.data?t.offset[t.fields[i]]=i:(t.offset[t.fields[i]]=s,s+=t.size[i]);return t.rowSize=s,t}(r),i=[],o=[],s=[];if("ascii"===n.data)for(var a=n.offset,l=r.substr(n.headerLen).split("\n"),c=0,u=l.length;c<u;c++){var h=l[c].split(" ");if(void 0!==a.x&&(i.push(parseFloat(h[a.x])),i.push(parseFloat(h[a.y])),i.push(parseFloat(h[a.z]))),void 0!==a.rgb){var d=new Float32Array([parseFloat(h[a.rgb])]),p=new DataView(d.buffer,0);s.push(p.getUint8(0)/255),s.push(p.getUint8(1)/255),s.push(p.getUint8(2)/255)}void 0!==a.normal_x&&(o.push(parseFloat(h[a.normal_x])),o.push(parseFloat(h[a.normal_y])),o.push(parseFloat(h[a.normal_z])))}if("binary_compressed"!==n.data){if("binary"===n.data){p=new DataView(e,n.headerLen),a=n.offset,c=0;for(var f=0;c<n.points;c++,f+=n.rowSize)void 0!==a.x&&(i.push(p.getFloat32(f+a.x,this.littleEndian)),i.push(p.getFloat32(f+a.y,this.littleEndian)),i.push(p.getFloat32(f+a.z,this.littleEndian))),void 0!==a.rgb&&(s.push(p.getUint8(f+a.rgb+0)/255),s.push(p.getUint8(f+a.rgb+1)/255),s.push(p.getUint8(f+a.rgb+2)/255)),void 0!==a.normal_x&&(o.push(p.getFloat32(f+a.normal_x,this.littleEndian)),o.push(p.getFloat32(f+a.normal_y,this.littleEndian)),o.push(p.getFloat32(f+a.normal_z,this.littleEndian)))}var m=new Cy;i.length>0&&m.addAttribute("position",new Sy(i,3)),o.length>0&&m.addAttribute("normal",new Sy(o,3)),s.length>0&&m.addAttribute("color",new Sy(s,3)),m.computeBoundingSphere();var v=new Tw({size:.005});s.length>0?v.vertexColors=!0:v.color.setHex(16777215*Math.random());var g=new $_(m,v),y=t.split("").reverse().join("");return y=(y=/([^\/]*)/.exec(y))[1].split("").reverse().join(""),g.name=y,g}console.error("PCDLoader: binary_compressed files are not supported")}};var tM=function(e){this.manager=void 0!==e?e:pw};tM.prototype={constructor:tM,load:function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){function t(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function n(e,t){var r=parseInt(p[f].substr(e,t));if(r){var n=function(e,t){return"s"+Math.min(e,t)+"e"+Math.max(e,t)}(v,r);void 0===d[n]&&(h.push([v-1,r-1,1]),d[n]=h.length-1)}}for(var i,o,s,a,l,c={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},u=[],h=[],d={},p=e.split("\n"),f=0,m=p.length;f<m;f++)if("ATOM"===p[f].substr(0,4)||"HETATM"===p[f].substr(0,6))i=parseFloat(p[f].substr(30,7)),o=parseFloat(p[f].substr(38,7)),s=parseFloat(p[f].substr(46,7)),a=parseInt(p[f].substr(6,5))-1,""===(l=t(p[f].substr(76,2)).toLowerCase())&&(l=t(p[f].substr(12,2)).toLowerCase()),u[a]=[i,o,s,c[l],r(l)];else if("CONECT"===p[f].substr(0,6)){var v=parseInt(p[f].substr(6,5));n(11,5),n(16,5),n(21,5),n(26,5)}return function(){var e,t,r={geometryAtoms:new Cy,geometryBonds:new Cy,json:{atoms:u,bonds:h}},n=r.geometryAtoms,i=r.geometryBonds,o=[],s=[],a=[];for(e=0,t=u.length;e<t;e++){var l=u[e],c=l[0],d=l[1],p=l[2];o.push(c,d,p);var f=l[3][0]/255,m=l[3][1]/255,v=l[3][2]/255;s.push(f,m,v)}for(e=0,t=h.length;e<t;e++){var g=h[e],y=g[0],x=g[1];a.push(o[3*y+0]),a.push(o[3*y+1]),a.push(o[3*y+2]),a.push(o[3*x+0]),a.push(o[3*x+1]),a.push(o[3*x+2])}return n.addAttribute("position",new Sy(o,3)),n.addAttribute("color",new Sy(s,3)),i.addAttribute("position",new Sy(a,3)),r}()}};var rM=function(e){this.manager=void 0!==e?e:pw};rM.prototype={constructor:rM,load:function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){function t(e){var t={};for(var r in e){var n,i=e[r],o=i.type,s=i.components;switch(o){case"float32":n=new Sy(i.data,s);break;case"uint8":n=new gy(i.data,s);break;case"uint16":n=new by(i.data,s);break;default:console.log('PlayCanvasLoader: Array type "%s" not yet supported.',o)}t[r]=n}e._attributes=t}function r(e){var t=new Cy;t.setIndex(e.indices);var r=o.vertices[e.vertices]._attributes;for(var n in r){var i=r[n];"texCoord0"===n&&(n="uv"),t.addAttribute(n,i)}e._geometry=t}function n(e){var t=o.nodes[e.node],r=o.meshes[e.mesh];void 0===t._geometries&&(t._geometries=[]),t._geometries.push(r._geometry)}function i(e){var t=new mS,r=e._geometries;if(void 0!==r)for(var n=new bw,i=0,o=r.length;i<o;i++){var s=r[i];t.add(new Mb(s,n))}for(i=0,o=e.rotation.length;i<o;i++)e.rotation[i]*=Math.PI/180;t.name=e.name,t.position.fromArray(e.position),t.quaternion.setFromEuler((new ty).fromArray(e.rotation)),t.scale.fromArray(e.scale),e._object=t}for(var o=e.model,s=0,a=o.vertices.length;s<a;s++)t(o.vertices[s]);for(s=0,a=o.meshes.length;s<a;s++)r(o.meshes[s]);for(s=0,a=o.meshInstances.length;s<a;s++)n(o.meshInstances[s]);for(s=0,a=o.nodes.length;s<a;s++)i(o.nodes[s]);for(s=0,a=o.parents.length;s<a;s++){var l=o.parents[s];-1!==l&&o.nodes[l]._object.add(o.nodes[s]._object)}return o.nodes[0]._object}};var nM=function(e){this.manager=void 0!==e?e:pw,this.propertyNameMapping={}};nM.prototype={constructor:nM,load:function(e,t,r,n){var i=this,o=new mw(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,n=/ply([\s\S]*)end_header\s/.exec(e);null!==n&&(t=n[1],r=n[0].length);var i,o,s,a={comments:[],elements:[],headerLength:r},l=t.split("\n");function c(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}for(var h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim()))switch(o=(s=d.split(/\s+/)).shift(),d=s.join(" "),o){case"format":a.format=s[0],a.version=s[1];break;case"comment":a.comments.push(d);break;case"element":void 0!==i&&a.elements.push(i),(i={}).name=s[0],i.count=parseInt(s[1]),i.properties=[];break;case"property":i.properties.push(c(s,u.propertyNameMapping));break;default:console.log("unhandled",o,s)}}return void 0!==i&&a.elements.push(i),a}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function n(e,t){for(var n=t.split(/\s+/),i={},o=0;o<e.length;o++)if("list"===e[o].type){for(var s=[],a=r(n.shift(),e[o].countType),l=0;l<a;l++)s.push(r(n.shift(),e[o].itemType));i[e[o].name]=s}else i[e[o].name]=r(n.shift(),e[o].type);return i}function i(e,t){var r,i={indices:[],vertices:[],normals:[],uvs:[],colors:[]},a="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(a=r[1]);for(var l=a.split("\n"),c=0,u=0,h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim())){u>=t.elements[c].count&&(c++,u=0);var p=n(t.elements[c].properties,d);s(i,t.elements[c].name,p),u++}}return o(i)}function o(e){var t=new Cy;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new Sy(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new Sy(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new Sy(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new Sy(e.colors,3)),t.computeBoundingSphere(),t}function s(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var n=r.vertex_indices||r.vertex_index;3===n.length?e.indices.push(n[0],n[1],n[2]):4===n.length&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]))}}function a(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function l(e,t,r,n){for(var i,o={},s=0,l=0;l<r.length;l++)if("list"===r[l].type){var c=[],u=(i=a(e,t+s,r[l].countType,n))[0];s+=i[1];for(var h=0;h<u;h++)i=a(e,t+s,r[l].itemType,n),c.push(i[0]),s+=i[1];o[r[l].name]=c}else i=a(e,t+s,r[l].type,n),o[r[l].name]=i[0],s+=i[1];return[o,s]}var c,u=this;if(e instanceof ArrayBuffer){var h=Nw.decodeText(new Uint8Array(e)),d=t(h);c="ascii"===d.format?i(h,d):function(e,t){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],colors:[]},i="binary_little_endian"===t.format,a=new DataView(e,t.headerLength),c=0,u=0;u<t.elements.length;u++)for(var h=0;h<t.elements[u].count;h++){c+=(r=l(a,c,t.elements[u].properties,i))[1];var d=r[0];s(n,t.elements[u].name,d)}return o(n)}(e,d)}else c=i(e,t(e));return c}};var iM=null;function oM(){if(null===iM){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);t[0]=170,t[1]=187,iM=43707===r[0]}return iM}var sM=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],aM={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function lM(e,t,r,n,i){var o,s=t.BYTES_PER_ELEMENT;if(i===oM()||1===s)o=new t(e,r,n);else{var a=new DataView(e,r,n*s),l=aM[t.name],c=!i,u=0;for(o=new t(n);u<n;u++)o[u]=a[l](u*s,c)}return o}var cM=function(e){this.manager=void 0!==e?e:pw};cM.prototype={constructor:cM,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),e=e.replace(/\*/g,oM()?"be":"le"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){console.time("PRWMLoader");var t,r,n=function(e){var t=new Uint8Array(e),r=t[0],n=t[1],i=!!(n>>7&1),o=n>>6&1,s=1==(n>>5&1),a=31&n,l=0,c=0;if(s?(l=(t[2]<<16)+(t[3]<<8)+t[4],c=(t[5]<<16)+(t[6]<<8)+t[7]):(l=t[2]+(t[3]<<8)+(t[4]<<16),c=t[5]+(t[6]<<8)+(t[7]<<16)),0===r)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==r)throw new Error("PRWM decoder: Unsupported format version: "+r);if(!i){if(0!==o)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==c)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var u,h,d,p,f,m,v,g,y=8,x={};for(g=0;g<a;g++){for(u="";y<t.length&&(h=t[y],y++,0!==h);)u+=String.fromCharCode(h);d=(n=t[y])>>7&1,p=1+(n>>4&3),y++,m=lM(e,f=sM[15&n],y=4*Math.ceil(y/4),p*l,s),y+=f.BYTES_PER_ELEMENT*p*l,x[u]={type:d,cardinality:p,values:m}}return y=4*Math.ceil(y/4),v=null,i&&(v=lM(e,1===o?Uint32Array:Uint16Array,y,c,s)),{version:r,attributes:x,indices:v}}(e),i=Object.keys(n.attributes),o=new Cy;for(r=0;r<i.length;r++)t=n.attributes[i[r]],o.addAttribute(i[r],new my(t.values,t.cardinality,t.normalized));return null!==n.indices&&o.setIndex(new my(n.indices,1)),console.timeEnd("PRWMLoader"),o}},cM.isBigEndianPlatform=function(){return oM()};var uM=function(e){this.manager=void 0!==e?e:pw,this._parser=uM.parse};uM.prototype=Object.create(BS.prototype),uM.prototype.constructor=uM,uM.parse=function(e,t){var r=new Uint32Array(e,0,13),n={buffer:e,header:r,loadMipmaps:t};return 55727696===r[0]?uM._parseV3(n):559044176===r[11]?uM._parseV2(n):void console.error("PVRLoader: Unknown PVR format.")},uM._parseV3=function(e){var t,r,n=e.header,i=n[12],o=n[2],s=n[6],a=n[7],l=n[10],c=n[11];switch(o){case 0:t=2,r=eb;break;case 1:t=2,r=rb;break;case 2:t=4,r=$x;break;case 3:t=4,r=tb;break;default:console.error("PVRLoader: Unsupported PVR format:",o)}return e.dataPtr=52+i,e.bpp=t,e.format=r,e.width=a,e.height=s,e.numSurfaces=l,e.numMipmaps=c,e.isCubemap=6===l,uM._extract(e)},uM._parseV2=function(e){var t,r,n=e.header,i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[10],u=n[12],h=255&l,d=c>0;return 25===h?(r=d?tb:$x,t=4):24===h?(r=d?rb:eb,t=2):console.error("PVRLoader: Unknown PVR format:",h),e.dataPtr=i,e.bpp=t,e.format=r,e.width=s,e.height=o,e.numSurfaces=u,e.numMipmaps=a+1,e.isCubemap=6===u,uM._extract(e)},uM._extract=function(e){var t,r={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},n=e.buffer,i=e.dataPtr,o=e.bpp,s=e.numSurfaces,a=0,l=0,c=0,u=0,h=0;2===o?(l=8,c=4):(l=4,c=4),t=l*c*o/8,r.mipmaps.length=e.numMipmaps*s;for(var d=0;d<e.numMipmaps;){var p=e.width>>d,f=e.height>>d;h=f/c,(u=p/l)<2&&(u=2),h<2&&(h=2),a=u*h*t;for(var m=0;m<s;m++){var v={data:new Uint8Array(n,i,a),width:p,height:f};r.mipmaps[m*e.numMipmaps+d]=v,i+=a}d++}return r};var hM=function(e){this.manager=void 0!==e?e:pw};hM.prototype={constructor:hM,load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){try{t(i.parse(e))}catch(e){n&&n(e)}},r,n)},parse:function(e){var t=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var t;if(84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var r=[115,111,108,105,100],n=0;n<5;n++)if(r[n]!=t.getUint8(n,!1))return!0;return!1}(t)?function(e){for(var t,r,n,i,o,s,a,l,c=new DataView(e),u=c.getUint32(80,!0),h=!1,d=0;d<70;d++)1129270351==c.getUint32(d,!1)&&82==c.getUint8(d+4)&&61==c.getUint8(d+5)&&(h=!0,i=[],o=c.getUint8(d+6)/255,s=c.getUint8(d+7)/255,a=c.getUint8(d+8)/255,l=c.getUint8(d+9)/255);for(var p=new Cy,f=[],m=[],v=0;v<u;v++){var g=84+50*v,y=c.getFloat32(g,!0),x=c.getFloat32(g+4,!0),b=c.getFloat32(g+8,!0);if(h){var w=c.getUint16(g+48,!0);0==(32768&w)?(t=(31&w)/31,r=(w>>5&31)/31,n=(w>>10&31)/31):(t=o,r=s,n=a)}for(var _=1;_<=3;_++){var S=g+12*_;f.push(c.getFloat32(S,!0)),f.push(c.getFloat32(S+4,!0)),f.push(c.getFloat32(S+8,!0)),m.push(y,x,b),h&&i.push(t,r,n)}}return p.addAttribute("position",new my(new Float32Array(f),3)),p.addAttribute("normal",new my(new Float32Array(m),3)),h&&(p.addAttribute("color",new my(new Float32Array(i),3)),p.hasColors=!0,p.alpha=l),p}(t):function(e){for(var t,r=new Cy,n=/facet([\s\S]*?)endfacet/g,i=0,o=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+o+o+o,"g"),a=new RegExp("normal"+o+o+o,"g"),l=[],c=[],u=new Kg;null!==(t=n.exec(e));){for(var h=0,d=0,p=t[0];null!==(t=a.exec(p));)u.x=parseFloat(t[1]),u.y=parseFloat(t[2]),u.z=parseFloat(t[3]),d++;for(;null!==(t=s.exec(p));)l.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),c.push(u.x,u.y,u.z),h++;1!==d&&console.error("STLLoader: Something isn't right with the normal of face number "+i),3!==h&&console.error("STLLoader: Something isn't right with the vertices of face number "+i),i++}return r.addAttribute("position",new Sy(l,3)),r.addAttribute("normal",new Sy(c,3)),r}(function(e){return"string"!=typeof e?Nw.decodeText(new Uint8Array(e)):e}(e))}};var dM=function(e){this.manager=void 0!==e?e:pw};dM.prototype={constructor:dM,load:function(e,t,r,n){var i=new DOMParser;new mw(this.manager).load(e,function(e){var r=i.parseFromString(e,"image/svg+xml");t(r.documentElement)},r,n)}};var pM=function(e){this.manager=void 0!==e?e:pw,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]};pM.prototype={constructor:pM,load:function(e,t,r,n){var i=this,o=void 0!==this.path?this.path:Nw.extractUrlBase(e),s=new mw(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){t(i.parse(e,o))},r,n)},parse:function(e,t){this.group=new mS,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(var r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group},readFile:function(e,t){var r=new DataView(e),n=this.readChunk(r);if(n.id===mM||n.id===vM||n.id===fM)for(var i=this.nextChunk(r,n);0!==i;){if(i===gM){var o=this.readDWord(r);this.debugMessage("3DS file version: "+o)}else i===_M?(this.resetPosition(r),this.readMeshData(r,t)):this.debugMessage("Unknown main chunk: "+i.toString(16));i=this.nextChunk(r,n)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(e,t){for(var r=this.readChunk(e),n=this.nextChunk(e,r);0!==n;){if(n===SM){var i=+this.readDWord(e);this.debugMessage("Mesh Version: "+i)}else if(n===TM){var o=this.readFloat(e);this.debugMessage("Master scale: "+o),this.group.scale.set(o,o,o)}else n===HM?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):n===MM?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+n.toString(16));n=this.nextChunk(e,r)}},readNamedObject:function(e){var t=this.readChunk(e),r=this.readString(e,64);t.cur=this.position;for(var n=this.nextChunk(e,t);0!==n;){if(n===WM){this.resetPosition(e);var i=this.readMesh(e);i.name=r,this.meshes.push(i)}else this.debugMessage("Unknown named object chunk: "+n.toString(16));n=this.nextChunk(e,t)}this.endChunk(t)},readMaterialEntry:function(e,t){for(var r=this.readChunk(e),n=this.nextChunk(e,r),i=new bw;0!==n;){if(n===AM)i.name=this.readString(e,64),this.debugMessage("   Name: "+i.name);else if(n===LM)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(n===IM){var o=this.readByte(e);i.wireframeLinewidth=o,this.debugMessage("   Wireframe Thickness: "+o)}else if(n===DM)i.side=ky,this.debugMessage("   DoubleSided");else if(n===NM)this.debugMessage("   Additive Blending"),i.blending=Gy;else if(n===CM)this.debugMessage("   Diffuse Color"),i.color=this.readColor(e);else if(n===PM)this.debugMessage("   Specular Color"),i.specular=this.readColor(e);else if(n===EM)this.debugMessage("   Ambient color"),i.color=this.readColor(e);else if(n===OM){var s=this.readWord(e);i.shininess=s,this.debugMessage("   Shininess : "+s)}else n===RM?(this.debugMessage("   ColorMap"),this.resetPosition(e),i.map=this.readMap(e,t)):n===kM?(this.debugMessage("   BumpMap"),this.resetPosition(e),i.bumpMap=this.readMap(e,t)):n===FM?(this.debugMessage("   OpacityMap"),this.resetPosition(e),i.alphaMap=this.readMap(e,t)):n===UM?(this.debugMessage("   SpecularMap"),this.resetPosition(e),i.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+n.toString(16));n=this.nextChunk(e,r)}this.endChunk(r),this.materials[i.name]=i},readMesh:function(e){var t=this.readChunk(e),r=this.nextChunk(e,t),n=null,i=[],o=new Mb(n=new py,new bw);for(o.name="mesh";0!==r;){if(r===XM){var s=this.readWord(e);this.debugMessage("   Vertex: "+s);for(var a=0;a<s;a++)n.vertices.push(new Kg(this.readFloat(e),this.readFloat(e),this.readFloat(e)))}else if(r===qM)this.resetPosition(e),this.readFaceArray(e,o);else if(r===JM){var l=this.readWord(e);this.debugMessage("   UV: "+l),i=[];for(a=0;a<l;a++)i.push(new hy(this.readFloat(e),this.readFloat(e)))}else if(r===ZM){this.debugMessage("   Tranformation Matrix (TODO)");var c=[];for(a=0;a<12;a++)c[a]=this.readFloat(e);var u=new Qg;u.elements[0]=c[0],u.elements[1]=c[6],u.elements[2]=c[3],u.elements[3]=c[9],u.elements[4]=c[2],u.elements[5]=c[8],u.elements[6]=c[5],u.elements[7]=c[11],u.elements[8]=c[1],u.elements[9]=c[7],u.elements[10]=c[4],u.elements[11]=c[10],u.elements[12]=0,u.elements[13]=0,u.elements[14]=0,u.elements[15]=1,u.transpose();var h=new Qg;h.getInverse(u,!0),n.applyMatrix(h),u.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(e,t)}if(this.endChunk(t),i.length>0){var d=[];for(a=0;a<n.faces.length;a++)d.push([i[n.faces[a].a],i[n.faces[a].b],i[n.faces[a].c]]);n.faceVertexUvs[0]=d}return n.computeVertexNormals(),o},readFaceArray:function(e,t){var r=this.readChunk(e),n=this.readWord(e);this.debugMessage("   Faces: "+n);for(var i=0;i<n;++i){t.geometry.faces.push(new ly(this.readWord(e),this.readWord(e),this.readWord(e)));this.readWord(e)}for(;this.position<r.end;){if((r=this.readChunk(e)).id===YM){this.debugMessage("      Material Group"),this.resetPosition(e);var o=this.readMaterialGroup(e),s=this.materials[o.name];void 0!==s&&(t.material=s,""===s.name&&(s.name=t.name))}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}this.endChunk(r)},readMap:function(e,t){var r=this.readChunk(e),n=this.nextChunk(e,r),i={},o=new Ow(this.manager);for(o.setPath(t);0!==n;){if(n===BM){var s=this.readString(e,128);i=o.load(s),this.debugMessage("      File: "+t+s)}else n===VM?(i.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+i.offset.x)):n===GM?(i.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+i.offset.y)):n===jM?(i.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+i.repeat.x)):n===zM?(i.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.toString(16));n=this.nextChunk(e,r)}return this.endChunk(r),i},readMaterialGroup:function(e){this.readChunk(e);var t=this.readString(e,64),r=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);for(var n=[],i=0;i<r;++i)n.push(this.readWord(e));return{name:t,index:n}},readColor:function(e){var t=this.readChunk(e),r=new ay;if(t.id===xM||t.id===bM){var n=this.readByte(e),i=this.readByte(e),o=this.readByte(e);r.setRGB(n/255,i/255,o/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===yM||t.id===wM){n=this.readFloat(e),i=this.readFloat(e),o=this.readFloat(e);r.setRGB(n,i,o),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),r},readChunk:function(e){var t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t},endChunk:function(e){this.position=e.end},nextChunk:function(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{var r=this.readChunk(e);return t.cur+=r.size,r.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(e){var t=e.getUint8(this.position,!0);return this.position+=1,t},readFloat:function(e){try{var t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}},readInt:function(e){var t=e.getInt32(this.position,!0);return this.position+=4,t},readShort:function(e){var t=e.getInt16(this.position,!0);return this.position+=2,t},readDWord:function(e){var t=e.getUint32(this.position,!0);return this.position+=4,t},readWord:function(e){var t=e.getUint16(this.position,!0);return this.position+=2,t},readString:function(e,t){for(var r="",n=0;n<t;n++){var i=this.readByte(e);if(!i)break;r+=String.fromCharCode(i)}return r},setPath:function(e){return this.path=e,this},debugMessage:function(e){this.debug&&console.log(e)}};var fM=19789,mM=15786,vM=49725,gM=2,yM=16,xM=17,bM=18,wM=19,_M=15677,SM=15678,TM=256,MM=45055,AM=40960,EM=40976,CM=40992,PM=41008,OM=41024,DM=41089,NM=41091,LM=41093,IM=41095,RM=41472,FM=41488,kM=41520,UM=41476,BM=41728,jM=41812,zM=41814,VM=41816,GM=41818,HM=16384,WM=16640,XM=16656,qM=16672,YM=16688,JM=16704,ZM=16736,QM=function(e){this.manager=void 0!==e?e:pw,this.reversed=!1};QM.prototype={constructor:QM,load:function(e,t,r,n){var i=this,o=new mw(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){function t(e){var t,r=[];e.forEach(function(e){"m"===e.type.toLowerCase()?(t=[e],r.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)});var n=[];return r.forEach(function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(t);for(var r=e.length-1;r>0;r--){var i=e[r];t={type:i.type};void 0!==i.x2&&void 0!==i.y2?(t.x1=i.x2,t.y1=i.y2,t.x2=i.x1,t.y2=i.y1):void 0!==i.x1&&void 0!==i.y1&&(t.x1=i.x1,t.y1=i.y1),t.x=e[r-1].x,t.y=e[r-1].y,n.push(t)}}),n}return"undefined"==typeof opentype?(console.warn("TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,r){for(var n=Math.round,i={},o=1e5/(72*(e.unitsPerEm||2048)),s=0;s<e.glyphs.length;s++){var a=e.glyphs.glyphs[s];if(void 0!==a.unicode){var l={ha:n(a.advanceWidth*o),x_min:n(a.xMin*o),x_max:n(a.xMax*o),o:""};r&&(a.path.commands=t(a.path.commands)),a.path.commands.forEach(function(e,t){"c"===e.type.toLowerCase()&&(e.type="b"),l.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(l.o+=n(e.x*o)+" "+n(e.y*o)+" "),void 0!==e.x1&&void 0!==e.y1&&(l.o+=n(e.x1*o)+" "+n(e.y1*o)+" "),void 0!==e.x2&&void 0!==e.y2&&(l.o+=n(e.x2*o)+" "+n(e.y2*o)+" ")}),i[String.fromCharCode(a.unicode)]=l}}return{glyphs:i,familyName:e.familyName,ascender:n(e.ascender*o),descender:n(e.descender*o),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}};var KM=function(){};KM.prototype.load=function(e,t,r){this.downloadModelJson(e,t,r)},KM.BufferGeometryCreator=function(){},KM.BufferGeometryCreator.prototype.create=function(e,t){var r,n,i=t.length/3,o=new Cy,s=new Float32Array(3*i*3),a=new Float32Array(3*i*3),l=new Float32Array(3*i*2),c=e.length;for(n=0,r=0;r<c;r+=8)s[n++]=e[r],s[n++]=e[r+1],s[n++]=e[r+2];for(n=0,r=3;r<c;r+=8)l[n++]=e[r],l[n++]=e[r+1];for(n=0,r=5;r<c;r+=8)a[n++]=e[r],a[n++]=e[r+1],a[n++]=e[r+2];return o.setIndex(new my(t,1)),o.addAttribute("position",new my(s,3)),o.addAttribute("normal",new my(a,3)),o.addAttribute("uv",new my(l,2)),o.computeBoundingSphere(),o};var $M={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};function eA(e,t,r){(new mw).load(e,t,r)}KM.prototype.decompressAttribsInner_=function(e,t,r,n,i,o,s,a){for(var l=0,c=t;c<r;c++){var u=e.charCodeAt(c);l+=u>>1^-(1&u),n[i]=a*(l+s),i+=o}},KM.prototype.decompressIndices_=function(e,t,r,n,i){for(var o=0,s=0;s<r;s++){var a=e.charCodeAt(t++);n[i++]=o-a,0===a&&o++}},KM.prototype.decompressAABBs_=function(e,t,r,n,i){for(var o=6*r,s=t+o,a=0,l=new Float32Array(o),c=t;c<s;c+=6){var u=e.charCodeAt(c+0)+n[0],h=e.charCodeAt(c+1)+n[1],d=e.charCodeAt(c+2)+n[2],p=e.charCodeAt(c+3)+1>>1,f=e.charCodeAt(c+4)+1>>1,m=e.charCodeAt(c+5)+1>>1;l[a++]=i[0]*(u+p),l[a++]=i[1]*(h+f),l[a++]=i[2]*(d+m),l[a++]=i[0]*p,l[a++]=i[1]*f,l[a++]=i[2]*m}return l},KM.prototype.decompressMesh=function(e,t,r,n,i,o){for(var s=r.decodeScales.length,a=r.decodeOffsets,l=r.decodeScales,c=t.attribRange[0],u=t.attribRange[1],h=c,d=new Float32Array(s*u),p=0;p<s;p++){var f=h+u,m=l[p];m&&this.decompressAttribsInner_(e,h,f,d,p,s,a[p],m),h=f}var v=3*t.indexRange[1],g=new Uint16Array(v);this.decompressIndices_(e,h,v,g,0);var y=void 0,x=t.bboxes;x&&(y=this.decompressAABBs_(e,x,t.names.length,a,l)),o(n,i,d,g,y,t)},KM.prototype.copyAttrib=function(e,t,r,n){for(var i=0;i<e;i++)r[i]=t[e*n+i]},KM.prototype.decodeAttrib2=function(e,t,r,n,i,o,s,a,l,c){for(var u=0;u<5;u++){var h=e.charCodeAt(i+o*u+c),d=h>>1^-(1&h);l[u]+=d,a[t*c+u]=l[u],s[t*c+u]=n[u]*(l[u]+r[u])}},KM.prototype.accumulateNormal=function(e,t,r,n,i){var o=n[8*e],s=n[8*e+1],a=n[8*e+2],l=n[8*t],c=n[8*t+1],u=n[8*t+2],h=n[8*r],d=n[8*r+1],p=n[8*r+2];l-=o,h-=o,o=(c-=s)*(p-=a)-(u-=a)*(d-=s),s=u*h-l*p,a=l*d-c*h,i[3*e]+=o,i[3*e+1]+=s,i[3*e+2]+=a,i[3*t]+=o,i[3*t+1]+=s,i[3*t+2]+=a,i[3*r]+=o,i[3*r+1]+=s,i[3*r+2]+=a},KM.prototype.decompressMesh2=function(e,t,r,n,i,o){for(var s=r.decodeScales.length,a=r.decodeOffsets,l=r.decodeScales,c=t.attribRange[0],u=t.attribRange[1],h=t.codeRange[0],d=3*t.codeRange[2],p=new Uint16Array(d),f=new Int32Array(3*u),m=new Uint16Array(s),v=new Uint16Array(s*u),g=new Float32Array(s*u),y=0,x=0,b=0;b<d;b+=3){var w=e.charCodeAt(h++),_=Math.min(b,96);if(w<_){var S,T,M,A=w%3,E=b-(w-A);switch(A){case 0:S=p[E+2],T=p[E+1],M=p[E+0];break;case 1:S=p[E+0],T=p[E+2],M=p[E+1];break;case 2:S=p[E+1],T=p[E+0],M=p[E+2]}p[x++]=S,p[x++]=T;var C=y-(w=e.charCodeAt(h++));if(p[x++]=C,0===w){for(var P=0;P<5;P++){var O=e.charCodeAt(c+u*P+y),D=(O>>1^-(1&O))+v[s*S+P]+v[s*T+P]-v[s*M+P];m[P]=D,v[s*y+P]=D,g[s*y+P]=l[P]*(D+a[P])}y++}else this.copyAttrib(s,v,m,C);this.accumulateNormal(S,T,C,v,f)}else{var N=y-(w-_);p[x++]=N,w===_?this.decodeAttrib2(e,s,a,l,c,u,g,v,m,y++):this.copyAttrib(s,v,m,N);var L=y-(w=e.charCodeAt(h++));p[x++]=L,0===w?this.decodeAttrib2(e,s,a,l,c,u,g,v,m,y++):this.copyAttrib(s,v,m,L);var I=y-(w=e.charCodeAt(h++));if(p[x++]=I,0===w){for(P=0;P<5;P++)m[P]=(v[s*N+P]+v[s*L+P])/2;this.decodeAttrib2(e,s,a,l,c,u,g,v,m,y++)}else this.copyAttrib(s,v,m,I);this.accumulateNormal(N,L,I,v,f)}}for(b=0;b<u;b++){var R=f[3*b],F=f[3*b+1],k=f[3*b+2],U=511/Math.sqrt(R*R+F*F+k*k),B=e.charCodeAt(c+5*u+b),j=e.charCodeAt(c+6*u+b),z=e.charCodeAt(c+7*u+b);g[s*b+5]=U*R+(B>>1^-(1&B)),g[s*b+6]=U*F+(j>>1^-(1&j)),g[s*b+7]=U*k+(z>>1^-(1&z))}o(n,i,g,p,void 0,t)},KM.prototype.downloadMesh=function(e,t,r,n,i){var o=this,s=0;eA(e,function(e){!function(e){for(;s<r.length;){var a=r[s],l=a.indexRange;if(l){var c=l[0]+3*l[1];if(e.length<c)break;o.decompressMesh(e,a,n,t,s,i)}else{var u=a.codeRange;if(c=u[0]+u[1],e.length<c)break;o.decompressMesh2(e,a,n,t,s,i)}++s}}(e)})},KM.prototype.downloadMeshes=function(e,t,r,n){for(var i in t){var o=t[i];this.downloadMesh(e+i,i,o,r,n)}},KM.prototype.createMeshCallback=function(e,t,r){var n=0,i=0,o={},s={},a={},l=t.urls;for(var c in l)o[c]=l[c].length,s[c]=0,i++,a[c]=new oy;var u=new oy,h=new zT.MaterialCreator(e,t.options);h.setMaterials(t.materials),h.preload();var d=new KM.BufferGeometryCreator;return function(e,t,l,c,p,f){var m=new Mb(d.create(l,c),h.create(f.material));a[e].add(m),s[e]++,s[e]===o[e]&&(n++,u.add(a[e]),n===i&&r(u))}},KM.prototype.downloadModel=function(e,t,r,n){var i=this.createMeshCallback(t,r,n);this.downloadMeshes(e,r.urls,r.decodeParams,i)},KM.prototype.downloadModelJson=function(e,t,r){!function(e,t){eA(e,function(e){t(JSON.parse(e))},function(){})}(e,(function(n){n.decodeParams||(r&&r.decodeParams?n.decodeParams=r.decodeParams:n.decodeParams=$M),n.options=r;var i=e.substr(0,e.lastIndexOf("/")+1),o=i;r&&r.geometryBase&&"/"!==(i=r.geometryBase).charAt(i.length-1)&&(i+="/"),r&&r.materialBase&&"/"!==(o=r.materialBase).charAt(o.length-1)&&(o+="/"),this.downloadModel(i,o,n,t)}).bind(this))};var tA=function(e){this.manager=void 0!==e?e:pw};tA.prototype={constructor:tA,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,crossOrigin:"Anonymous",load:function(e,t,r,n){var i=this;new mw(this.manager).load(e,function(e){t(i.parse(e))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.texturePath||"",r=new Ow(this.manager);r.setCrossOrigin(this.crossOrigin);for(var n=new ew,i=e.split("\n"),o=i.length-1;o>-1;o--){var s=i[o];if(/{.*[{\[]/.test(s))(a=s.split("{").join("{\n").split("\n")).unshift(1),a.unshift(o),i.splice.apply(i,a);else if(/\].*}/.test(s)){var a;(a=s.split("]").join("]\n").split("\n")).unshift(1),a.unshift(o),i.splice.apply(i,a)}if(/}.*}/.test(s))(a=s.split("}").join("}\n").split("\n")).unshift(1),a.unshift(o),i.splice.apply(i,a);/^\b[^\s]+\b$/.test(s.trim())?(i[o+1]=s+" "+i[o+1].trim(),i.splice(o,1)):s.indexOf("coord")>-1&&s.indexOf("[")<0&&s.indexOf("{")<0&&(i[o]+=" Coordinate {}")}var l=i.shift();return/V1.0/.exec(l)?console.warn("VRMLLoader: V1.0 not supported yet."):/V2.0/.exec(l)&&function(e,n){var i={},o=/(\b|\-|\+)([\d\.e]+)/,s=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,a=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g;function l(e,t,r,n,i){for(var o=!0===i?1:-1,s=[],a={},l={},c=0;c<r.length;c++){var u={x:o*(Math.cos(r[c])*t),y:o*(Math.sin(r[c])*t)};s.push(u)}for(var h=e.index,d=e.attributes.position,p=new my(new Float32Array(3*e.attributes.position.count),3),f=new Kg,m=new ay,v=0;v<h.count;v++){var g=h.getX(v);f.fromBufferAttribute(d,g);for(var y=0;y<n.length;y++)if(0===y?(a.x=0,a.y=!0===i?t:-1*t):(a.x=s[y-1].x,a.y=s[y-1].y),void 0!==(l=s[y]))if(!0==(!0===i?f.y<=a.y&&f.y>l.y:f.y>=a.y&&f.y<l.y)){var x=n[y],b=n[y+1],w=Math.abs(f.y-a.y)/(a.y-l.y);m.copy(x).lerp(b,w),p.setXYZ(g,m.r,m.g,m.b)}else{var _=n[!0===i?n.length-1:0];p.setXYZ(g,_.r,_.g,_.b)}}e.addAttribute("color",p)}var c=[];function u(e,t){for(var r,n,i,l=[],u={},h=/[^\s,\[\]]+/g;null!==(r=h.exec(t));)l.push(r[0]);switch(n=l[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=n,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=n,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=n,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":case"texCoordIndex":this.recordingFieldname=n,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(l.length>0)for(var d=0;d<l.length;d++)/(-?\d+)/.test(l[d])&&("-1"===l[d]?(c.length>0&&this.indexes.push(c),c=[]):c.push(parseInt(l[d])));/]/.exec(t)&&(c.length>0&&this.indexes.push(c),c=[],this.isRecordingFaces=!1,e[this.recordingFieldname]=this.indexes)}else if(this.isRecordingPoints){if("Coordinate"==e.nodeType)for(;null!==(l=a.exec(t));)i={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])},this.points.push(i);if("TextureCoordinate"==e.nodeType)for(;null!==(l=s.exec(t));)i={x:parseFloat(l[1]),y:parseFloat(l[2])},this.points.push(i);/]/.exec(t)&&(this.isRecordingPoints=!1,e.points=this.points)}else if(this.isRecordingAngles){if(l.length>0)for(d=0;d<l.length;d++)o.test(l[d])&&this.angles.push(parseFloat(l[d]));/]/.exec(t)&&(this.isRecordingAngles=!1,e[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(;null!==(l=a.exec(t));){var p={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])};this.colors.push(p)}/]/.exec(t)&&(this.isRecordingColors=!1,e[this.recordingFieldname]=this.colors)}else if("NULL"!==l[l.length-1]&&"children"!==n){switch(n){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!==l.length){console.warn("VRMLLoader: Invalid color format detected for %s.",n);break}u={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])};break;case"location":case"direction":case"translation":case"scale":case"size":if(4!==l.length){console.warn("VRMLLoader: Invalid vector format detected for %s.",n);break}u={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])};break;case"intensity":case"cutOffAngle":case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!==l.length){console.warn("VRMLLoader: Invalid single float value specification detected for %s.",n);break}u=parseFloat(l[1]);break;case"rotation":if(5!==l.length){console.warn("VRMLLoader: Invalid quaternion format detected for %s.",n);break}u={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3]),w:parseFloat(l[4])};break;case"on":case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!==l.length){console.warn("VRMLLoader: Invalid format detected for %s.",n);break}u="TRUE"===l[1]}e[n]=u}return u}!function e(o,s){var a;if("string"!=typeof o){a=s,o.string.indexOf("AmbientLight")>-1&&"PointLight"===o.nodeType&&(o.nodeType="AmbientLight");var c=void 0===o.on||o.on,u=void 0!==o.intensity?o.intensity:1,h=new ay;if(o.color&&h.copy(o.color),"AmbientLight"===o.nodeType)(a=new RS(h,u)).visible=c,s.add(a);else if("PointLight"===o.nodeType){var d=0;void 0!==o.radius&&o.radius<1e3&&(d=o.radius),(a=new ES(h,u,d)).visible=c,s.add(a)}else if("SpotLight"===o.nodeType){u=1,d=0;var p=Math.PI/3;c=!0,void 0!==o.radius&&o.radius<1e3&&(d=o.radius),void 0!==o.cutOffAngle&&(p=o.cutOffAngle),(a=new DS(h,u,d,p,0)).visible=c,s.add(a)}else if("Transform"===o.nodeType||"Group"===o.nodeType){if(a=new oy,/DEF/.exec(o.string)&&(a.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[a.name]=a),void 0!==o.translation){var f=o.translation;a.position.set(f.x,f.y,f.z)}if(void 0!==o.rotation){var m=o.rotation;a.quaternion.setFromAxisAngle(new Kg(m.x,m.y,m.z),m.w)}if(void 0!==o.scale){var v=o.scale;a.scale.set(v.x,v.y,v.z)}s.add(a)}else if("Shape"===o.nodeType)a=new Mb,/DEF/.exec(o.string)&&(a.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[a.name]=a),s.add(a);else if("Background"===o.nodeType){var g=2e4,y=new Oy(g,20,20),x=new xb({fog:!1,side:Fy});if(o.skyColor.length>1)l(y,g,o.skyAngle,o.skyColor,!0),x.vertexColors=jy;else{var b=o.skyColor[0];x.color.setRGB(b.r,b.b,b.g)}if(n.add(new Mb(y,x)),void 0!==o.groundColor){var w=new Oy(g=12e3,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),_=new xb({fog:!1,side:Fy,vertexColors:jy});l(w,g,o.groundAngle,o.groundColor,!1),n.add(new Mb(w,_))}}else{if(/geometry/.exec(o.string)){if("Box"===o.nodeType)v=o.size,s.geometry=new Db(v.x,v.y,v.z);else if("Cylinder"===o.nodeType)s.geometry=new Lb(o.radius,o.radius,o.height);else if("Cone"===o.nodeType)s.geometry=new Lb(o.topRadius,o.bottomRadius,o.height);else if("Sphere"===o.nodeType)s.geometry=new Oy(o.radius);else if("IndexedFaceSet"===o.nodeType){var S,T,M,A,E,C=new Cy,P=[],O=[];for(B=0,M=o.children.length;B<M;B++){if("TextureCoordinate"===(j=o.children[B]).nodeType&&j.points)for(A=0,E=j.points.length;A<E;A++)T=j.points[A],O.push(T.x,T.y);if("Coordinate"===j.nodeType){if(j.points)for(A=0,E=j.points.length;A<E;A++)S=j.points[A],P.push(S.x,S.y,S.z);if(j.string.indexOf("DEF")>-1){var D=/DEF\s+([^\s]+)/.exec(j.string)[1];i[D]=P.slice(0)}j.string.indexOf("USE")>-1&&(X=/USE\s+([^\s]+)/.exec(j.string)[1],P=i[X])}}var N=0;if(o.coordIndex){var L=[],I=[];for(S=new Kg,T=new hy,B=0,M=o.coordIndex.length;B<M;B++){var R=o.coordIndex[B];for(N=0;R.length>=3&&N<R.length-2;){void 0===o.ccw&&(o.ccw=!0);var F=R[0],k=R[N+(o.ccw?1:2)],U=R[N+(o.ccw?2:1)];S.fromArray(P,3*F),T.fromArray(O,2*F),L.push(S.x,S.y,S.z),I.push(T.x,T.y),S.fromArray(P,3*k),T.fromArray(O,2*k),L.push(S.x,S.y,S.z),I.push(T.x,T.y),S.fromArray(P,3*U),T.fromArray(O,2*U),L.push(S.x,S.y,S.z),I.push(T.x,T.y),N++}}P=L,O=I}else s.parent.remove(s);!1===o.solid&&(s.material.side=ky),C.solid=o.solid,C.addAttribute("position",new Sy(P,3)),O.length>0&&C.addAttribute("uv",new Sy(O,2)),C.computeVertexNormals(),C.computeBoundingSphere(),/DEF/.exec(o.string)&&(C.name=/DEF ([^\s]+)/.exec(o.string)[1],i[C.name]=C),s.geometry=C}return}if(/appearance/.exec(o.string)){for(var B=0;B<o.children.length;B++){var j;if("Material"===(j=o.children[B]).nodeType){var z=new bw;if(void 0!==j.diffuseColor){var V=j.diffuseColor;z.color.setRGB(V.r,V.g,V.b)}if(void 0!==j.emissiveColor){var G=j.emissiveColor;z.emissive.setRGB(G.r,G.g,G.b)}void 0!==j.specularColor&&(v=j.specularColor,z.specular.setRGB(v.r,v.g,v.b)),void 0!==j.transparency&&(f=j.transparency,z.opacity=Math.abs(1-f),z.transparent=!0),/DEF/.exec(o.string)&&(z.name=/DEF ([^\s]+)/.exec(o.string)[1],i[z.name]=z),s.material=z}if("ImageTexture"===j.nodeType){var H=/"([^"]+)"/.exec(j.children[0]);H&&(s.material.name=H[1],s.material.map=r.load(t+H[1]))}}return}}B=0;for(var W=o.children.length;B<W;B++)e(o.children[B],a)}else if(/USE/.exec(o)){var X=/USE\s+?([^\s]+)/.exec(o)[1];void 0==i[X]?console.warn("VRMLLoader: %s is not defined.",X):/appearance/.exec(o)&&X?s.material=i[X].clone():/geometry/.exec(o)&&X?(s.geometry=i[X].clone(),void 0!==i[X].solid&&!1===i[X].solid&&(s.geometry.solid=!1,s.material.side=ky)):X&&(a=i[X].clone(),s.add(a))}}(function(e){for(var t,r,n={string:"Scene",children:[]},i=n,o=0;o<e.length;o++){var s="",a=e[o];if(null===/^\s+?$/g.exec(a)&&""!==(a=a.trim())){if(/#/.exec(a)){var l=a.split("#");a=l[0],s=l[1]}if(t=/([^\s]*){1}(?:\s+)?{/.exec(a)){var c={nodeType:t[1],string:a,parent:i,children:[],comment:s};i.children.push(c),i=c,/}/.exec(a)&&(r=/{(.*)}/.exec(a)[1],c.children.push(r),u(i,r),i=i.parent)}else/}/.exec(a)?i=i.parent:""!==a&&(u(i,a),i.children.push(a))}}return n}(e),n)}(i,n),n}};function rA(e){oy.call(this),this.material=e,this.render=function(){}}Object.assign((function(e){this.manager=void 0!==e?e:pw}).prototype,ey.prototype,{load:function(e,t,r,n){var i=this,o=new mw(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){function t(e,t){var r=e.length,n=new Float32Array(r+t.length);return n.set(e),n.set(t,r),n}function r(e,t){var r=e.length,n=new Int32Array(r+t.length);return n.set(e),n.set(t,r),n}function n(e){for(var t="",r=new Uint8Array(e),n=0,i=r.length;i--;)t+=String.fromCharCode(r[n++]);return t}var i=Nw.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==i[0].indexOf("xml")?function(e){function n(e){var t,r,n,i,o,s,a="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],c=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=u.length;for(t=0;t<h;t++)l[t]=u[t];for(t=0;t<h;++t)c[u.charCodeAt(t)]=t;if(c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63,(h=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s=new a(3*h/4-(o="="===e[h-2]?2:"="===e[h-1]?1:0)),n=o>0?h-4:h;var d=0;for(t=0,r=0;t<n;t+=4,r+=3)i=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],s[d++]=(16711680&i)>>16,s[d++]=(65280&i)>>8,s[d++]=255&i;return 2===o?(i=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,s[d++]=255&i):1===o&&(i=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,s[d++]=i>>8&255,s[d++]=255&i),s}function i(e,i){var o=0;if("UInt64"===s.attributes.header_type?o=8:"UInt32"===s.attributes.header_type&&(o=4),"binary"===e.attributes.format&&i){var a,l,c,u,h,d;if("Float32"===e.attributes.type)var p=new Float32Array;else"Int64"===e.attributes.type&&(p=new Int32Array);l=(a=n(e["#text"]))[0];for(var f=1;f<o-1;f++)l|=a[f]<<f*o;for(u=(l+3)*o,d=u+=u%3>0?3-u%3:0,(h=[]).push(d),c=3*o,f=0;f<l;f++){for(var m=a[f*o+c],v=1;v<o-1;v++)m|=a[f*o+c+v]<<8*v;d+=m,h.push(d)}for(f=0;f<h.length-1;f++)g=(g=new Zlib.Inflate(a.slice(h[f],h[f+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===e.attributes.type?p=t(p,g=new Float32Array(g)):"Int64"===e.attributes.type&&(p=r(p,g=new Int32Array(g)));delete e["#text"],"Float32"===e.attributes.type?"binary"===e.attributes.format&&(i||(p=p.filter(function(e,t){if(0!==t)return!0}))):"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(i||(p=p.filter(function(e,t){if(0!==t)return!0})),p=p.filter(function(e,t){if(t%2!=1)return!0}))}else{if("binary"!==e.attributes.format||i)if(e["#text"])var g=e["#text"].split(/\s+/).filter(function(e){if(""!==e)return e});else g=new Int32Array(0).buffer;else g=(g=n(e["#text"])).slice(o).buffer;delete e["#text"],"Float32"===e.attributes.type?p=new Float32Array(g):"Int32"===e.attributes.type?p=new Int32Array(g):"Int64"===e.attributes.type&&(p=new Int32Array(g),"binary"===e.attributes.format&&(p=p.filter(function(e,t){if(t%2!=1)return!0})))}return p}var o=null;if(window.DOMParser)try{o=(new DOMParser).parseFromString(e,"text/xml")}catch(e){o=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!o.loadXML())throw new Error(o.parseError.reason+o.parseError.srcText)}catch(e){o=null}}var s=function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r.attributes={};for(var n=0;n<t.attributes.length;n++){var i=t.attributes.item(n);r.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var s=t.childNodes.item(o),a=s.nodeName;if(void 0===r[a])""!==(c=e(s))&&(r[a]=c);else{if(void 0===r[a].push){var l=r[a];r[a]=[l]}var c;""!==(c=e(s))&&r[a].push(c)}}return r}(o.documentElement),a=[],l=[],c=[];if(s.PolyData){for(var u=s.PolyData.Piece,h=s.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],p=0,f=d.length;p<f;){var m=u[d[p]];if(m&&m.DataArray){if("[object Array]"===Object.prototype.toString.call(m.DataArray))var v=m.DataArray;else v=[m.DataArray];for(var g=0,y=v.length;g<y;)"#text"in v[g]&&v[g]["#text"].length>0&&(v[g].text=i(v[g],h)),g++;switch(d[p]){case"PointData":var x=parseInt(u.attributes.NumberOfPoints),b=m.attributes.Normals;if(x>0)for(var w=0,_=v.length;w<_;w++)if(b===v[w].attributes.Name){var S=v[w].attributes.NumberOfComponents;(l=new Float32Array(x*S)).set(v[w].text,0)}break;case"Points":(x=parseInt(u.attributes.NumberOfPoints))>0&&(S=m.DataArray.attributes.NumberOfComponents,(a=new Float32Array(x*S)).set(m.DataArray.text,0));break;case"Strips":var T=parseInt(u.attributes.NumberOfStrips);if(T>0){var M=new Int32Array(m.DataArray[0].text.length),A=new Int32Array(m.DataArray[1].text.length);M.set(m.DataArray[0].text,0),A.set(m.DataArray[1].text,0);var E=T+M.length;c=new Uint32Array(3*E-9*T);var C=0;for(w=0,_=T;w<_;w++){for(var P=[],O=0,D=A[w],N=0;O<D-N;O++)P.push(M[O]),w>0&&(N=A[w-1]);var L=0;for(D=A[w],N=0;L<D-N-2;L++)L%2?(c[C++]=P[L],c[C++]=P[L+2],c[C++]=P[L+1]):(c[C++]=P[L],c[C++]=P[L+1],c[C++]=P[L+2]),w>0&&(N=A[w-1])}}break;case"Polys":var I=parseInt(u.attributes.NumberOfPolys);if(I>0){M=new Int32Array(m.DataArray[0].text.length),A=new Int32Array(m.DataArray[1].text.length),M.set(m.DataArray[0].text,0),A.set(m.DataArray[1].text,0),E=I+M.length,c=new Uint32Array(3*E-9*I),C=0;var R=0;for(w=0,_=I,N=0;w<_;){var F=[];for(O=0,D=A[w];O<D-N;)F.push(M[R++]),O++;for(L=1;L<D-N-1;)c[C++]=F[0],c[C++]=F[L],c[C++]=F[L+1],L++;N=A[++w-1]}}}}p++}var k=new Cy;return k.setIndex(new my(c,1)),k.addAttribute("position",new my(a,3)),l.length===a.length&&k.addAttribute("normal",new my(l,3)),k}}(n(e)):i[2].includes("ASCII")?function(e){var t,r,n=[],i=[],o=[],s=[],a=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,c=/^POINTS /,u=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,p=/^CELL_DATA[ ]+(\d+)/,f=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,g=!1,y=!1,x=!1,b=!1,w=!1,_=!1,S=e.split("\n");for(var T in S){var M=S[T];if(v)for(;null!==(t=a.exec(M));){var A=parseFloat(t[1]),E=parseFloat(t[2]),C=parseFloat(t[3]);i.push(A,E,C)}else if(g){if(null!==(t=l.exec(M))){var P=parseInt(t[1]),O=t[2].split(/\s+/);if(P>=3)for(var D=parseInt(O[0]),N=1,L=0;L<P-2;++L)I=parseInt(O[N]),R=parseInt(O[N+1]),n.push(D,I,R),N++}}else if(y){if(null!==(t=l.exec(M))){var I,R;if(P=parseInt(t[1]),O=t[2].split(/\s+/),P>=3)for(L=0;L<P-2;L++)L%2==1?(D=parseInt(O[L]),I=parseInt(O[L+2]),R=parseInt(O[L+1]),n.push(D,I,R)):(D=parseInt(O[L]),I=parseInt(O[L+1]),R=parseInt(O[L+2]),n.push(D,I,R))}}else if(x||b)if(w)for(;null!==(t=a.exec(M));){var F=parseFloat(t[1]),k=parseFloat(t[2]),U=parseFloat(t[3]);o.push(F,k,U)}else if(_)for(;null!==(t=a.exec(M));){var B=parseFloat(t[1]),j=parseFloat(t[2]),z=parseFloat(t[3]);s.push(B,j,z)}null!==u.exec(M)?(g=!0,v=!1,y=!1):null!==c.exec(M)?(g=!1,v=!0,y=!1):null!==h.exec(M)?(g=!1,v=!1,y=!0):null!==d.exec(M)?(x=!0,v=!1,g=!1,y=!1):null!==p.exec(M)?(b=!0,v=!1,g=!1,y=!1):null!==f.exec(M)?(w=!0,_=!1,v=!1,g=!1,y=!1):null!==m.exec(M)&&(_=!0,w=!1,v=!1,g=!1,y=!1)}var V="point";if(o.length===n.length&&(V="cell"),"point"===V)(r=new Cy).setIndex(new my(new Uint32Array(n),1)),r.addAttribute("position",new my(new Float32Array(i),3)),o.length===i.length&&r.addAttribute("color",new my(new Float32Array(o),3)),s.length===i.length&&r.addAttribute("normal",new my(new Float32Array(s),3));else{r=new py;var G,H,W,X,q=n.length/3,Y=i.length/3;for(L=0;L<Y;++L)A=i[3*L+0],E=i[3*L+1],C=i[3*L+2],r.vertices.push(new Kg(A,E,C));for(T=0;T<q;++T)H=n[3*T+0],W=n[3*T+1],X=n[3*T+2],r.faces.push(new ly(H,W,X));if(o.length===3*q)for(T=0;T<q;++T)G=r.faces[T],F=o[3*T+0],k=o[3*T+1],U=o[3*T+2],G.color=(new ay).setRGB(F,k,U)}return r}(n(e)):function(e){var t,r,n,i,o,s,a,l=new Uint8Array(e),c=new DataView(e),u=[],h=[],d=[],p=0;function f(e,t){for(var r=t,n=e[r],i=[];10!==n;)i.push(String.fromCharCode(n)),n=e[++r];return{start:t,end:r,next:r+1,parsedString:i.join("")}}for(;;){if(0===(a=(s=f(l,p)).parsedString).indexOf("POINTS")){for(t=4*(i=parseInt(a.split(" ")[1],10))*3,u=new Float32Array(3*i),r=s.next,n=0;n<i;n++)u[3*n]=c.getFloat32(r,!1),u[3*n+1]=c.getFloat32(r+4,!1),u[3*n+2]=c.getFloat32(r+8,!1),r+=12;s.next=s.next+t+1}else if(0===a.indexOf("TRIANGLE_STRIPS")){var m=parseInt(a.split(" ")[1],10);t=4*(b=parseInt(a.split(" ")[2],10)),d=new Uint32Array(3*b-9*m);var v=0;for(r=s.next,n=0;n<m;n++){var g=c.getInt32(r,!1),y=[];for(r+=4,o=0;o<g;o++)y.push(c.getInt32(r,!1)),r+=4;for(var x=0;x<g-2;x++)x%2?(d[v++]=y[x],d[v++]=y[x+2],d[v++]=y[x+1]):(d[v++]=y[x],d[v++]=y[x+1],d[v++]=y[x+2])}s.next=s.next+t+1}else if(0===a.indexOf("POLYGONS")){var b;for(m=parseInt(a.split(" ")[1],10),t=4*(b=parseInt(a.split(" ")[2],10)),d=new Uint32Array(3*b-9*m),v=0,r=s.next,n=0;n<m;n++){for(g=c.getInt32(r,!1),y=[],r+=4,o=0;o<g;o++)y.push(c.getInt32(r,!1)),r+=4;for(x=1;x<g-1;x++)d[v++]=y[0],d[v++]=y[x],d[v++]=y[x+1]}s.next=s.next+t+1}else if(0===a.indexOf("POINT_DATA")){for(i=parseInt(a.split(" ")[1],10),s=f(l,s.next),t=4*i*3,h=new Float32Array(3*i),r=s.next,n=0;n<i;n++)h[3*n]=c.getFloat32(r,!1),h[3*n+1]=c.getFloat32(r+4,!1),h[3*n+2]=c.getFloat32(r+8,!1),r+=12;s.next=s.next+t}if((p=s.next)>=l.byteLength)break}var w=new Cy;return w.setIndex(new my(d,1)),w.addAttribute("position",new my(u,3)),h.length===u.length&&w.addAttribute("normal",new my(h,3)),w}(e)}}),rA.prototype=Object.create(oy.prototype),rA.prototype.constructor=rA,rA.prototype.isImmediateRenderObject=!0;var nA=function(e,t,r,n){rA.call(this,t);var i=this,o=new Float32Array(36),s=new Float32Array(36);function a(e,t,r){return e+(t-e)*r}function l(e,t,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[t+0]=n+d*i.delta,o[t+1]=l,o[t+2]=c,s[t+0]=a(p[e+0],p[e+3],d),s[t+1]=a(p[e+1],p[e+4],d),s[t+2]=a(p[e+2],p[e+5],d)}function c(e,t,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[t+0]=n,o[t+1]=l+d*i.delta,o[t+2]=c;var f=e+3*i.yd;s[t+0]=a(p[e+0],p[f+0],d),s[t+1]=a(p[e+1],p[f+1],d),s[t+2]=a(p[e+2],p[f+2],d)}function u(e,t,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[t+0]=n,o[t+1]=l,o[t+2]=c+d*i.delta;var f=e+3*i.zd;s[t+0]=a(p[e+0],p[f+0],d),s[t+1]=a(p[e+1],p[f+1],d),s[t+2]=a(p[e+2],p[f+2],d)}function h(e){var t=3*e;0===i.normal_cache[t]&&(i.normal_cache[t+0]=i.field[e-1]-i.field[e+1],i.normal_cache[t+1]=i.field[e-i.yd]-i.field[e+i.yd],i.normal_cache[t+2]=i.field[e-i.zd]-i.field[e+i.zd])}function d(e,t,r,n,a,d){var f=n+1,m=n+i.yd,v=n+i.zd,g=f+i.yd,y=f+i.zd,x=n+i.yd+i.zd,b=f+i.yd+i.zd,w=0,_=i.field[n],S=i.field[f],T=i.field[m],M=i.field[g],A=i.field[v],E=i.field[y],C=i.field[x],P=i.field[b];_<a&&(w|=1),S<a&&(w|=2),T<a&&(w|=8),M<a&&(w|=4),A<a&&(w|=16),E<a&&(w|=32),C<a&&(w|=128),P<a&&(w|=64);var O=iA[w];if(0===O)return 0;var D=i.delta,N=e+D,L=t+D,I=r+D;1&O&&(h(n),h(f),l(3*n,0,a,e,t,r,_,S)),2&O&&(h(f),h(g),c(3*f,3,a,N,t,r,S,M)),4&O&&(h(m),h(g),l(3*m,6,a,e,L,r,T,M)),8&O&&(h(n),h(m),c(3*n,9,a,e,t,r,_,T)),16&O&&(h(v),h(y),l(3*v,12,a,e,t,I,A,E)),32&O&&(h(y),h(b),c(3*y,15,a,N,t,I,E,P)),64&O&&(h(x),h(b),l(3*x,18,a,e,L,I,C,P)),128&O&&(h(v),h(x),c(3*v,21,a,e,t,I,A,C)),256&O&&(h(n),h(v),u(3*n,24,a,e,t,r,_,A)),512&O&&(h(f),h(y),u(3*f,27,a,N,t,r,S,E)),1024&O&&(h(g),h(b),u(3*g,30,a,N,L,r,M,P)),2048&O&&(h(m),h(x),u(3*m,33,a,e,L,r,T,C)),w<<=4;for(var R,F,k,U=0,B=0;-1!=oA[w+B];)F=(R=w+B)+1,k=R+2,p(o,s,3*oA[R],3*oA[F],3*oA[k],d),B+=3,U++;return U}function p(e,t,r,n,o,s){var a=3*i.count;if(i.positionArray[a+0]=e[r],i.positionArray[a+1]=e[r+1],i.positionArray[a+2]=e[r+2],i.positionArray[a+3]=e[n],i.positionArray[a+4]=e[n+1],i.positionArray[a+5]=e[n+2],i.positionArray[a+6]=e[o],i.positionArray[a+7]=e[o+1],i.positionArray[a+8]=e[o+2],i.normalArray[a+0]=t[r],i.normalArray[a+1]=t[r+1],i.normalArray[a+2]=t[r+2],i.normalArray[a+3]=t[n],i.normalArray[a+4]=t[n+1],i.normalArray[a+5]=t[n+2],i.normalArray[a+6]=t[o],i.normalArray[a+7]=t[o+1],i.normalArray[a+8]=t[o+2],i.enableUvs){var l=2*i.count;i.uvArray[l+0]=e[r],i.uvArray[l+1]=e[r+2],i.uvArray[l+2]=e[n],i.uvArray[l+3]=e[n+2],i.uvArray[l+4]=e[o],i.uvArray[l+5]=e[o+2]}i.enableColors&&(i.colorArray[a+0]=e[r],i.colorArray[a+1]=e[r+1],i.colorArray[a+2]=e[r+2],i.colorArray[a+3]=e[n],i.colorArray[a+4]=e[n+1],i.colorArray[a+5]=e[n+2],i.colorArray[a+6]=e[o],i.colorArray[a+7]=e[o+1],i.colorArray[a+8]=e[o+2]),i.count+=3,i.count>=i.maxCount-3&&(i.hasPositions=!0,i.hasNormals=!0,i.enableUvs&&(i.hasUvs=!0),i.enableColors&&(i.hasColors=!0),s(i))}this.enableUvs=void 0!==r&&r,this.enableColors=void 0!==n&&n,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(e){if(0!==this.count){for(var t=3*this.count;t<this.positionArray.length;t++)this.positionArray[t]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),e(this)}},this.addBall=function(e,t,r,n,i){var o=Math.sign(n);n=Math.abs(n);var s=this.size*Math.sqrt(n/i),a=r*this.size,l=t*this.size,c=e*this.size,u=Math.floor(a-s);u<1&&(u=1);var h=Math.floor(a+s);h>this.size-1&&(h=this.size-1);var d=Math.floor(l-s);d<1&&(d=1);var p=Math.floor(l+s);p>this.size-1&&(p=this.size-1);var f=Math.floor(c-s);f<1&&(f=1);var m,v,g,y,x,b,w,_,S,T,M,A=Math.floor(c+s);for(A>this.size-1&&(A=this.size-1),g=u;g<h;g++)for(x=this.size2*g,S=(_=g/this.size-r)*_,v=d;v<p;v++)for(y=x+this.size*v,T=(w=v/this.size-t)*w,m=f;m<A;m++)(M=n/(1e-6+(b=m/this.size-e)*b+T+S)-i)>0&&(this.field[y+m]+=M*o)},this.addPlaneX=function(e,t){var r,n,i,o,s,a,l=this.size,c=this.yd,u=this.zd,h=this.field,d=l*Math.sqrt(e/t);for(d>l&&(d=l),r=0;r<d;r++)if((o=e/(1e-4+(s=r/l)*s)-t)>0)for(n=0;n<l;n++)for(a=r+n*c,i=0;i<l;i++)h[u*i+a]+=o},this.addPlaneY=function(e,t){var r,n,i,o,s,a,l,c=this.size,u=this.yd,h=this.zd,d=this.field,p=c*Math.sqrt(e/t);for(p>c&&(p=c),n=0;n<p;n++)if((o=e/(1e-4+(s=n/c)*s)-t)>0)for(a=n*u,r=0;r<c;r++)for(l=a+r,i=0;i<c;i++)d[h*i+l]+=o},this.addPlaneZ=function(e,t){var r,n,i,o,s,a,l,c=this.size,u=this.yd,h=this.zd,d=this.field,p=c*Math.sqrt(e/t);for(p>c&&(p=c),i=0;i<p;i++)if((o=e/(1e-4+(s=i/c)*s)-t)>0)for(a=h*i,n=0;n<c;n++)for(l=a+n*u,r=0;r<c;r++)d[l+r]+=o},this.reset=function(){var e;for(e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0},this.render=function(e){this.begin();for(var t=this.size-2,r=1;r<t;r++)for(var n=this.size2*r,i=(r-this.halfsize)/this.halfsize,o=1;o<t;o++)for(var s=n+this.size*o,a=(o-this.halfsize)/this.halfsize,l=1;l<t;l++){d((l-this.halfsize)/this.halfsize,a,i,s+l,this.isolation,e)}this.end(e)},this.generateGeometry=function(){var e=0,t=new py,r=[];return this.render(function(n){for(var i=0;i<n.count;i++){var o=(new Kg).fromArray(n.positionArray,3*i),s=(new Kg).fromArray(n.normalArray,3*i);t.vertices.push(o),r.push(s)}var a=n.count/3;for(i=0;i<a;i++){var l=3*(e+i),c=l+1,u=l+2,h=new ly(l,c,u,[r[l],r[c],r[u]]);t.faces.push(h)}e+=a,n.count=0}),t},this.init(e)};nA.prototype=Object.create(rA.prototype),nA.prototype.constructor=nA;var iA=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),oA=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);!function(){var e={}}();function sA(e,t,r,n,i,o,s,a,l){nw.call(this,e,t,r,n,i,o,s,a,l),this.needsUpdate=!0}function aA(e){oy.call(this),this.type="Sprite",this.material=void 0!==e?e:new Ew,this.center=new hy(.5,.5)}sA.prototype=Object.create(nw.prototype),sA.prototype.constructor=sA,aA.prototype=Object.assign(Object.create(oy.prototype),{constructor:aA,isSprite:!0,raycast:function(){var e=new Kg,t=new Kg,r=new Kg;return function(n,i){t.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(t,e),r.setFromMatrixScale(this.matrixWorld);var o=r.x*r.y/4;if(!(t.distanceToSquared(e)>o)){var s=n.ray.origin.distanceTo(e);s<n.near||s>n.far||i.push({distance:s,point:e.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return oy.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var lA=function(e,t){this.lut=[],this.map=cA[e],this.n=t,this.mapname=e;for(var r=1/this.n,n=0;n<=1;n+=r)for(var i=0;i<this.map.length-1;i++)if(n>=this.map[i][0]&&n<this.map[i+1][0]){var o=this.map[i][0],s=this.map[i+1][0],a=new ay(16777215).setHex(this.map[i][1]),l=new ay(16777215).setHex(this.map[i+1][1]),c=a.lerp(l,(n-o)/(s-o));this.lut.push(c)}return this.set(this)};lA.prototype={constructor:lA,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(e){return e instanceof lA&&this.copy(e),this},setMin:function(e){return this.minV=e,this},setMax:function(e){return this.maxV=e,this},changeNumberOfColors:function(e){return this.n=e,new lA(this.mapname,this.n)},changeColorMap:function(e){return this.mapname=e,new lA(this.mapname,this.n)},copy:function(e){return this.lut=e.lut,this.mapname=e.mapname,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this},getColor:function(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);var t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]},addColorMap:function(e,t){cA[e]=t},setLegendOn:function(e){void 0===e&&(e={}),this.legend={},this.legend.layout=e.hasOwnProperty("layout")?e.layout:"vertical",this.legend.position=e.hasOwnProperty("position")?e.position:{x:21.5,y:8,z:5},this.legend.dimensions=e.hasOwnProperty("dimensions")?e.dimensions:{width:.5,height:3},this.legend.canvas=document.createElement("canvas"),this.legend.canvas.setAttribute("id","legend"),this.legend.canvas.setAttribute("hidden",!0),document.body.appendChild(this.legend.canvas),this.legend.ctx=this.legend.canvas.getContext("2d"),this.legend.canvas.setAttribute("width",1),this.legend.canvas.setAttribute("height",this.n),this.legend.texture=new nw(this.legend.canvas);var t=this.legend.ctx.getImageData(0,0,1,this.n),r=t.data;this.map=cA[this.mapname];for(var n=0,i=1/this.n,o=1;o>=0;o-=i)for(var s=this.map.length-1;s>=0;s--)if(o<this.map[s][0]&&o>=this.map[s-1][0]){var a=this.map[s-1][0],l=this.map[s][0],c=new ay(16777215).setHex(this.map[s-1][1]),u=new ay(16777215).setHex(this.map[s][1]),h=c.lerp(u,(o-a)/(l-a));r[4*n]=Math.round(255*h.r),r[4*n+1]=Math.round(255*h.g),r[4*n+2]=Math.round(255*h.b),r[4*n+3]=255,n+=1}return this.legend.ctx.putImageData(t,0,0),this.legend.texture.needsUpdate=!0,this.legend.legendGeometry=new lw(this.legend.dimensions.width,this.legend.dimensions.height),this.legend.legendMaterial=new xb({map:this.legend.texture,side:ky}),this.legend.mesh=new Mb(this.legend.legendGeometry,this.legend.legendMaterial),"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh.position.copy(this.legend.position),this.legend.mesh},setLegendOff:function(){return this.legend=null,this.legend},setLegendLayout:function(e){return!!this.legend&&(this.legend.layout!=e&&(("horizontal"==e||"vertical"==e)&&(this.layout=e,"horizontal"==e&&(this.legend.mesh.rotation.z=Math.PI/180*90),"vertical"==e&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh)))},setLegendPosition:function(e){return this.legend.position=new Kg(e.x,e.y,e.z),this.legend},setLegendLabels:function(e,t){if(!this.legend)return!1;"function"==typeof e&&(t=e),void 0===e&&(e={}),this.legend.labels={},this.legend.labels.fontsize=e.hasOwnProperty("fontsize")?e.fontsize:24,this.legend.labels.fontface=e.hasOwnProperty("fontface")?e.fontface:"Arial",this.legend.labels.title=e.hasOwnProperty("title")?e.title:"",this.legend.labels.um=e.hasOwnProperty("um")?" [ "+e.um+" ]":"",this.legend.labels.ticks=e.hasOwnProperty("ticks")?e.ticks:0,this.legend.labels.decimal=e.hasOwnProperty("decimal")?e.decimal:2,this.legend.labels.notation=e.hasOwnProperty("notation")?e.notation:"standard";var r=255,n=100,i=100,o=.8,s=255,a=0,l=0,c=1,u=document.createElement("canvas"),h=u.getContext("2d");h.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface;h.measureText(this.legend.labels.title.toString()+this.legend.labels.um.toString()).width;h.fillStyle="rgba("+r+","+n+","+i+","+o+")",h.strokeStyle="rgba("+s+","+a+","+l+","+c+")",h.lineWidth=4,h.fillStyle="rgba( 0, 0, 0, 1.0 )",h.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);var d=new sA(u);d.minFilter=Dx;var p=new aA(new Ew({map:d}));if(p.scale.set(2,1,1),"vertical"==this.legend.layout&&p.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z),"horizontal"==this.legend.layout&&p.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z),this.legend.labels.ticks>0){var f={},m={};if("vertical"==this.legend.layout)var v=this.legend.position.y+.36*this.legend.dimensions.height,g=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var y=this.legend.position.x+.75*this.legend.dimensions.height,x=this.legend.position.x-1.2*this.legend.dimensions.width;for(var b=0;b<this.legend.labels.ticks;b++){var w=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*b+this.minV;w=t?t(w):"scientific"==this.legend.labels.notation?w.toExponential(this.legend.labels.decimal):w.toFixed(this.legend.labels.decimal);var _=document.createElement("canvas"),S=_.getContext("2d");S.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface;S.measureText(w.toString()).width;S.fillStyle="rgba("+r+","+n+","+i+","+o+")",S.strokeStyle="rgba("+s+","+a+","+l+","+c+")",S.lineWidth=4,S.fillStyle="rgba( 0, 0, 0, 1.0 )",S.fillText(w.toString(),4,this.legend.labels.fontsize+4);var T=new sA(_);T.minFilter=Dx;var M=new aA(new Ew({map:T}));if(M.scale.set(2,1,1),"vertical"==this.legend.layout){var A=g+(v-g)*((w-this.minV)/(this.maxV-this.minV));M.position.set(this.legend.position.x+2.7*this.legend.dimensions.width,A,this.legend.position.z)}if("horizontal"==this.legend.layout){A=x+(y-x)*((w-this.minV)/(this.maxV-this.minV));if(this.legend.labels.ticks>5)if(b%2==0)var E=1.7;else E=2.1;else E=1.7;M.position.set(A,this.legend.position.y-this.legend.dimensions.width*E,this.legend.position.z)}var C=new bb({color:0,linewidth:2}),P=[];if("vertical"==this.legend.layout){var O=this.legend.position.y-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((w-this.minV)/(this.maxV-this.minV)*.99);P.push(new Kg(this.legend.position.x+.55*this.legend.dimensions.width,O,this.legend.position.z)),P.push(new Kg(this.legend.position.x+.7*this.legend.dimensions.width,O,this.legend.position.z))}if("horizontal"==this.legend.layout){O=this.legend.position.x-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((w-this.minV)/(this.maxV-this.minV)*.99);P.push(new Kg(O,this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),P.push(new Kg(O,this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z))}var D=new Ab((new Cy).setFromPoints(P),C);m[b]=D,f[b]=M}}return{title:p,ticks:f,lines:m}}};var cA={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]},uA=function(e,t){Mb.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,n=r-1,i=r/1;this.createAnimation("__default",0,n,i),this.setAnimationWeight("__default",1)};uA.prototype=Object.assign(Object.create(Mb.prototype),{constructor:uA,createAnimation:function(e,t,r,n){var i={start:t,end:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},autoCreateAnimations:function(e){for(var t,r=/([a-z]+)_?(\d+)/i,n={},i=this.geometry,o=0,s=i.morphTargets.length;o<s;o++){var a=i.morphTargets[o].name.match(r);if(a&&a.length>1)n[l=a[1]]||(n[l]={start:1/0,end:-1/0}),o<(c=n[l]).start&&(c.start=o),o>c.end&&(c.end=o),t||(t=l)}for(var l in n){var c=n[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},setAnimationDirectionForward:function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},setAnimationDirectionBackward:function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},setAnimationFPS:function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},setAnimationDuration:function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},setAnimationWeight:function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},setAnimationTime:function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},getAnimationTime:function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},getAnimationDuration:function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},playAnimation:function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},stopAnimation:function(e){var t=this.animationsMap[e];t&&(t.active=!1)},update:function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var n=this.animationsList[t];if(n.active){var i=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.start+Zg.clamp(Math.floor(n.time/i),0,n.length-1),s=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var a=n.time%i/i;n.directionBackwards&&(a=1-a),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=a*s,this.morphTargetInfluences[n.lastFrame]=(1-a)*s):this.morphTargetInfluences[n.currentFrame]=s}}}});ly.prototype.set=function(e,t,r){this.a=e,this.b=t,this.c=r};var hA=function(e,t,r,n,i,o){this.array_type=n,this.register_type=r,this.unit_size=i,this.accessors=o,this.buffer=new n(e*i),this.register=[],this.length=0,this.real_length=e,this.available_registers=t;for(var s=0;s<t;s++)this.register.push(new r)};function dA(e){var t=["x","y","z"],r=["x","y"],n=new hA(0,3,Kg,Float32Array,3,t),i=new hA(0,3,ly,Uint32Array,3,["a","b","c"]),o=new hA(0,3,hy,Float32Array,2,r),s=new hA(0,3,Kg,Float32Array,3,t);n.from_existing(e.getAttribute("position").array),i.from_existing(e.index.array),o.from_existing(e.getAttribute("uv").array),function(e){var t=["x","y","z"],r=new hA(0,5,Kg,Float32Array,3,t),n=new hA(0,3,ly,Uint32Array,3,["a","b","c"]);r.from_existing(e.getAttribute("position").array);var i,o=new hA(3*r.length,4,Kg,Float32Array,3,t),s=new hA(r.length,1,function(){this.x=0},Float32Array,1,["x"]);o.length=r.length,n.from_existing(e.index.array);for(var a=[0,0,0],l=0,c=n.length;l<c;l++)n.index_to_register(l,0),r.index_to_register(n.register[0].a,0),r.index_to_register(n.register[0].b,1),r.index_to_register(n.register[0].c,2),o.register[0].subVectors(r.register[1],r.register[0]),o.register[1].subVectors(r.register[2],r.register[1]),o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),s.buffer[n.register[0].a]+=i,s.buffer[n.register[0].b]+=i,s.buffer[n.register[0].c]+=i;for(l=0,c=n.length;l<c;l++)n.index_to_register(l,0),r.index_to_register(n.register[0].a,0),r.index_to_register(n.register[0].b,1),r.index_to_register(n.register[0].c,2),o.register[0].subVectors(r.register[1],r.register[0]),o.register[1].subVectors(r.register[2],r.register[0]),o.register[3].set(0,0,0),o.register[3].x=o.register[0].y*o.register[1].z-o.register[0].z*o.register[1].y,o.register[3].y=o.register[0].z*o.register[1].x-o.register[0].x*o.register[1].z,o.register[3].z=o.register[0].x*o.register[1].y-o.register[0].y*o.register[1].x,o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),a[0]=i/s.buffer[n.register[0].a],a[1]=i/s.buffer[n.register[0].b],a[2]=i/s.buffer[n.register[0].c],o.buffer[3*n.register[0].a+0]+=o.register[3].x*a[0],o.buffer[3*n.register[0].a+1]+=o.register[3].y*a[0],o.buffer[3*n.register[0].a+2]+=o.register[3].z*a[0],o.buffer[3*n.register[0].b+0]+=o.register[3].x*a[1],o.buffer[3*n.register[0].b+1]+=o.register[3].y*a[1],o.buffer[3*n.register[0].b+2]+=o.register[3].z*a[1],o.buffer[3*n.register[0].c+0]+=o.register[3].x*a[2],o.buffer[3*n.register[0].c+1]+=o.register[3].y*a[2],o.buffer[3*n.register[0].c+2]+=o.register[3].z*a[2];o.trim_size(),e.addAttribute("normal",new my(o.buffer,3))}(e),s.from_existing(e.getAttribute("normal").array);for(var a=new hA(3*i.length,3,Kg,Float32Array,3,t),l=new hA(3*i.length,3,Kg,Float32Array,3,t),c=new hA(3*i.length,3,hy,Float32Array,2,r),u=0,h=i.length;u<h;u++)i.index_to_register(u,0),n.index_to_register(i.register[0].a,0),n.index_to_register(i.register[0].b,1),n.index_to_register(i.register[0].c,2),a.push_element(n.register[0]),a.push_element(n.register[1]),a.push_element(n.register[2]),0!==o.length&&(o.index_to_register(3*u+0,0),o.index_to_register(3*u+1,1),o.index_to_register(3*u+2,2),c.push_element(o.register[0]),c.push_element(o.register[1]),c.push_element(o.register[2])),s.index_to_register(i.register[0].a,0),s.index_to_register(i.register[0].b,1),s.index_to_register(i.register[0].c,2),l.push_element(s.register[0]),l.push_element(s.register[1]),l.push_element(s.register[2]);return a.trim_size(),c.trim_size(),l.trim_size(),e.index=null,e.addAttribute("position",new my(a.buffer,3)),e.addAttribute("normal",new my(l.buffer,3)),0!==c.length&&e.addAttribute("uv",new my(c.buffer,2)),e}hA.prototype={constructor:hA,index_to_register:function(e,t,r){var n=e*this.unit_size;if(t>=this.available_registers)throw new Error("BufferSubdivisionModifier: Not enough registers in TypedArrayHelper.");if(e>this.length)throw new Error("BufferSubdivisionModifier: Index is out of range in TypedArrayHelper.");for(var i=0;i<this.unit_size;i++)this.register[t][this.accessors[i]]=this.buffer[n+i]},resize:function(e){var t;(0===e&&(e=8),e<this.length)?this.buffer=this.buffer.subarray(0,this.length*this.unit_size):this.buffer.length<e*this.unit_size?((t=new this.array_type(e*this.unit_size)).set(this.buffer),this.buffer=t,this.real_length=e):((t=new this.array_type(e*this.unit_size)).set(this.buffer.subarray(0,this.length*this.unit_size)),this.buffer=t,this.real_length=e)},from_existing:function(e){var t=e.length;this.buffer=new this.array_type(t),this.buffer.set(e),this.length=e.length/this.unit_size,this.real_length=this.length},push_element:function(e){this.length+1>this.real_length&&this.resize(2*this.real_length);for(var t=this.length*this.unit_size,r=0;r<this.unit_size;r++)this.buffer[t+r]=e[this.accessors[r]];this.length++},trim_size:function(){this.length<this.real_length&&this.resize(this.length)}};var pA=function(e){this.subdivisions=void 0===e?1:e};pA.prototype.modify=function(e){e instanceof py?(e.mergeVertices(),void 0===e.normals&&(e.normals=[]),e=function(e){for(var t=new Cy,r=new hA(e.vertices.length,0,Kg,Float32Array,3,["x","y","z"]),n=new hA(e.faces.length,0,ly,Uint32Array,3,["a","b","c"]),i=new hA(3*e.faceVertexUvs[0].length*3,0,hy,Float32Array,2,["x","y"]),o=0,s=e.vertices.length;o<s;o++)r.push_element(e.vertices[o]);for(o=0,s=e.faces.length;o<s;o++)n.push_element(e.faces[o]);for(o=0,s=e.faceVertexUvs[0].length;o<s;o++)i.push_element(e.faceVertexUvs[0][o][0]),i.push_element(e.faceVertexUvs[0][o][1]),i.push_element(e.faceVertexUvs[0][o][2]);return n.trim_size(),r.trim_size(),i.trim_size(),t.setIndex(new my(n.buffer,3)),t.addAttribute("position",new my(r.buffer,3)),t.addAttribute("uv",new my(i.buffer,2)),t}(e)):e instanceof Cy||console.error("BufferSubdivisionModifier: Geometry is not an instance of BufferGeometry or Geometry");for(var t=this.subdivisions;t-- >0;)this.smooth(e);return dA(e)};var fA=function(e,t){this.a=e,this.b=t,this.faces=[],this.newEdge=null};!function(){var e=["a","b","c"],t=["x","y","z"],r=["x","y"];function n(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function i(e,t,r,n,i,o){var s,a=Math.min(e,t),l=Math.max(e,t),c=a+"_"+l;c in n?s=n[c]:(s=new fA(a,l),n[c]=s),s.faces.push(i),o[e].edges.push(s),o[t].edges.push(s)}function o(e,t){e.push_element(t)}function s(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function a(e,t,r,n){e.push_element(t),e.push_element(r),e.push_element(n)}pA.prototype.smooth=function(l){var c,u,h,d,p,f,m,v,g,y,x,b,w;c=new hA(0,3,Kg,Float32Array,3,t),u=new hA(0,3,ly,Uint32Array,3,e),h=new hA(0,3,hy,Float32Array,2,r),c.from_existing(l.getAttribute("position").array),u.from_existing(l.index.array),h.from_existing(l.getAttribute("uv").array);var _,S,T,M,A,E,C,P=!1;void 0!==h&&0!==h.length&&(P=!0),function(e,t,r,n){var o,s,a;for(o=0,s=e.length;o<s;o++)r[o]={edges:[]};for(o=0,s=t.length;o<s;o++)t.index_to_register(o,0),i((a=t.register[0]).a,a.b,0,n,o,r),i(a.b,a.c,0,n,o,r),i(a.c,a.a,0,n,o,r)}(c,u,b=new Array(c.length),w={});var O=(d=new hA(2*l.getAttribute("position").array.length/3,2,Kg,Float32Array,3,t)).register[1];for(v in w){for(S=w[v],T=d.register[0],A=3/8,E=1/8,2!==(C=S.faces.length)&&(A=.5,E=0),c.index_to_register(S.a,0),c.index_to_register(S.b,1),T.addVectors(c.register[0],c.register[1]).multiplyScalar(A),O.set(0,0,0),y=0;y<C;y++){for(u.index_to_register(S.faces[y],0),M=u.register[0],x=0;x<3&&(c.index_to_register(M[e[x]],2),_=c.register[2],M[e[x]]===S.a||M[e[x]]===S.b);x++);O.add(_)}O.multiplyScalar(E),T.add(O),S.newEdge=d.length,d.push_element(T)}var D,N,L,I,R,F,k,U,B,j,z=d.length;for(v=0,g=c.length;v<g;v++){for(c.index_to_register(v,0,t),F=c.register[0],3===(m=(R=b[v].edges).length)?D=3/16:m>3&&(D=3/(8*m)),N=1-m*D,L=D,m<=2&&2===m&&(N=.75,L=1/8),k=F.multiplyScalar(N),O.set(0,0,0),y=0;y<m;y++)_=(I=R[y]).a!==v?I.a:I.b,c.index_to_register(_,1,t),O.add(c.register[1]);O.multiplyScalar(L),k.add(O),d.push_element(k,t)}p=new hA(4*l.index.array.length/3,1,ly,Float32Array,3,e);var V=(f=new hA(4*l.getAttribute("uv").array.length/2,3,hy,Float32Array,2,r)).register[0],G=f.register[1],H=f.register[2],W=p.register[0];for(v=0,g=u.length;v<g;v++)if(u.index_to_register(v,0),U=n((M=u.register[0]).a,M.b,w).newEdge,B=n(M.b,M.c,w).newEdge,j=n(M.c,M.a,w).newEdge,W.set(U,B,j),o(p,W),W.set(M.a+z,U,j),o(p,W),W.set(M.b+z,B,U),o(p,W),W.set(M.c+z,j,B),o(p,W),!0===P){h.index_to_register(3*v+0,0),h.index_to_register(3*v+1,1),h.index_to_register(3*v+2,2);var X=h.register[0],q=h.register[1],Y=h.register[2];V.set(s(X.x,q.x),s(X.y,q.y)),G.set(s(q.x,Y.x),s(q.y,Y.y)),H.set(s(X.x,Y.x),s(X.y,Y.y)),a(f,V,G,H),a(f,X,V,H),a(f,q,G,V),a(f,Y,H,G)}p.trim_size(),d.trim_size(),f.trim_size(),l.setIndex(new my(p.buffer,3)),l.addAttribute("position",new my(d.buffer,3)),l.addAttribute("uv",new my(f.buffer,2))}}();(function(){}).prototype.modify=function(e){for(var t=[],r=0,n=e.faces.length;r<n;r++){var i=t.length,o=e.faces[r],s=o.a,a=o.b,l=o.c,c=e.vertices[s],u=e.vertices[a],h=e.vertices[l];t.push(c.clone()),t.push(u.clone()),t.push(h.clone()),o.a=i,o.b=i+1,o.c=i+2}e.vertices=t};!function(){var e=new Kg,t=new Kg;function r(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}function n(e,t){var r,n,i,o=t.position.distanceTo(e.position),s=0,a=[],l=(e.faces,e.faces.length);for(r=0;r<l;r++)(n=e.faces[r]).hasVertex(t)&&a.push(n);for(r=0;r<l;r++){var c=1;n=e.faces[r];for(var u=0;u<a.length;u++){i=a[u];var h=n.normal.dot(i.normal);c=Math.min(c,(1.001-h)/2)}s=Math.max(s,c)}return a.length<2&&(s=1),o*s+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var r=n(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}function o(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){r(e.neighbors.pop().neighbors,e)}r(t,e)}function s(e,t){r(t,e),e.v1&&r(e.v1.faces,e),e.v2&&r(e.v2.faces,e),e.v3&&r(e.v3.faces,e);for(var n,i,o=[this.v1,this.v2,this.v3],s=0;s<3;s++)n=o[s],i=o[(s+1)%3],n&&i&&(n.removeIfNonNeighbor(i),i.removeIfNonNeighbor(n))}function a(e,t,r,n){if(n){var a,l=[];for(a=0;a<r.neighbors.length;a++)l.push(r.neighbors[a]);for(a=r.faces.length-1;a>=0;a--)r.faces[a].hasVertex(n)&&s(r.faces[a],t);for(a=r.faces.length-1;a>=0;a--)r.faces[a].replaceVertex(r,n);for(o(r,e),a=0;a<l.length;a++)i(l[a])}else o(r,e)}function l(e){for(var t=e[0],r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}function c(e,t,r,n,i,o){this.a=n,this.b=i,this.c=o,this.v1=e,this.v2=t,this.v3=r,this.normal=new Kg,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function u(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}c.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position,i=this.v3.position;e.subVectors(i,n),t.subVectors(r,n),e.cross(t).normalize(),this.normal.copy(e)},c.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},c.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),r(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},u.prototype.addUniqueNeighbor=function(e){!function(e,t){-1===e.indexOf(t)&&e.push(t)}(this.neighbors,e)},u.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(e))return;t.splice(n,1)}},(function(){}).prototype.modify=function(e,t){e instanceof Cy&&!e.vertices&&!e.faces&&(console.log("converting BufferGeometry to Geometry"),e=(new py).fromBufferGeometry(e)),e.mergeVertices();var r,n,o,s,h=e.vertices,d=e.faces,p=(new py,new Array(h.length)),f=new Array(d.length);for(r=0,n=h.length;r<n;r++)p[r]=new u(h[r],r);for(r=0,n=d.length;r<n;r++)o=d[r],f[r]=new c(p[o.a],p[o.b],p[o.c],o.a,o.b,o.c);for(r=0,n=p.length;r<n;r++)i(p[r]);for(var m=t;m--;){if(!(s=l(p))){console.log("no next vertex");break}a(p,f,s,s.collapseNeighbor)}var v=new py;for(r=0;r<p.length;r++){var g=p[r];v.vertices.push(g.position)}for(r=0;r<f.length;r++){var y=f[r];v.faces.push(new ly(p.indexOf(y.v1),p.indexOf(y.v2),p.indexOf(y.v3)))}return v}}();var mA=function(e){this.subdivisions=void 0===e?1:e};mA.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);e.computeFaceNormals(),e.computeVertexNormals()},function(){var e=["a","b","c"];function t(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function r(e,t,r,n,i,o){var s,a=Math.min(e,t),l=Math.max(e,t),c=a+"_"+l;c in n?s=n[c]:(s={a:r[a],b:r[l],newEdge:null,faces:[]},n[c]=s);s.faces.push(i),o[e].edges.push(s),o[t].edges.push(s)}function n(e,t,r,n){e.push(new ly(t,r,n))}function i(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function o(e,t,r,n){e.push([t.clone(),r.clone(),n.clone()])}mA.prototype.smooth=function(s){var a,l,c,u,h,d,p,f,m,v,g,y,x,b,w=new Kg,_=[];a=s.vertices,l=s.faces;var S,T,M,A,E,C,P,O,D,N,L,I,R,F,k=void 0!==(c=s.faceVertexUvs[0])&&c.length>0;for(p in function(e,t,n,i){var o,s,a;for(o=0,s=e.length;o<s;o++)n[o]={edges:[]};for(o=0,s=t.length;o<s;o++)r((a=t[o]).a,a.b,e,i,a,n),r(a.b,a.c,e,i,a,n),r(a.c,a.a,e,i,a,n)}(a,l,g=new Array(a.length),y={}),x=[],y){for(T=y[p],M=new Kg,E=3/8,C=1/8,2!=(P=T.faces.length)&&(E=.5,C=0),M.addVectors(T.a,T.b).multiplyScalar(E),w.set(0,0,0),m=0;m<P;m++){for(A=T.faces[m],v=0;v<3&&((S=a[A[e[v]]])===T.a||S===T.b);v++);w.add(S)}w.multiplyScalar(C),M.add(w),T.newEdge=x.length,x.push(M)}for(b=[],p=0,f=a.length;p<f;p++){for(R=a[p],3==(d=(I=g[p].edges).length)?O=3/16:d>3&&(O=3/(8*d)),D=1-d*O,N=O,d<=2&&2==d&&(D=.75,N=1/8),F=R.clone().multiplyScalar(D),w.set(0,0,0),m=0;m<d;m++)S=(L=I[m]).a!==R?L.a:L.b,w.add(S);w.multiplyScalar(N),F.add(w),b.push(F)}u=b.concat(x);var U,B,j,z,V,G,H,W=b.length;h=[];var X=new hy,q=new hy,Y=new hy;for(p=0,f=l.length;p<f;p++)n(h,U=t((A=l[p]).a,A.b,y).newEdge+W,B=t(A.b,A.c,y).newEdge+W,j=t(A.c,A.a,y).newEdge+W),n(h,A.a,U,j),n(h,A.b,B,U),n(h,A.c,j,B),k&&(V=(z=c[p])[0],G=z[1],H=z[2],X.set(i(V.x,G.x),i(V.y,G.y)),q.set(i(G.x,H.x),i(G.y,H.y)),Y.set(i(V.x,H.x),i(V.y,H.y)),o(_,X,q,Y),o(_,V,X,Y),o(_,G,q,X),o(_,H,Y,q));s.vertices=u,s.faces=h,k&&(s.faceVertexUvs[0]=_)}}();(function(e){this.maxEdgeLength=e}).prototype.modify=function(e){for(var t,r=[],n=[],i=this.maxEdgeLength*this.maxEdgeLength,o=0,s=e.faceVertexUvs.length;o<s;o++)n[o]=[];for(o=0,s=e.faces.length;o<s;o++){var a=e.faces[o];if(a instanceof ly){var l=a.a,c=a.b,u=a.c,h=e.vertices[l],d=e.vertices[c],p=e.vertices[u],f=h.distanceToSquared(d),m=d.distanceToSquared(p),v=h.distanceToSquared(p);if(f>i||m>i||v>i){var g=e.vertices.length,y=a.clone(),x=a.clone();if(f>=m&&f>=v){if((b=h.clone()).lerp(d,.5),y.a=l,y.b=g,y.c=u,x.a=g,x.b=c,x.c=u,3===a.vertexNormals.length)(w=a.vertexNormals[0].clone()).lerp(a.vertexNormals[1],.5),y.vertexNormals[1].copy(w),x.vertexNormals[0].copy(w);if(3===a.vertexColors.length)(_=a.vertexColors[0].clone()).lerp(a.vertexColors[1],.5),y.vertexColors[1].copy(_),x.vertexColors[0].copy(_);t=0}else if(m>=f&&m>=v){if((b=d.clone()).lerp(p,.5),y.a=l,y.b=c,y.c=g,x.a=g,x.b=u,x.c=l,3===a.vertexNormals.length)(w=a.vertexNormals[1].clone()).lerp(a.vertexNormals[2],.5),y.vertexNormals[2].copy(w),x.vertexNormals[0].copy(w),x.vertexNormals[1].copy(a.vertexNormals[2]),x.vertexNormals[2].copy(a.vertexNormals[0]);if(3===a.vertexColors.length)(_=a.vertexColors[1].clone()).lerp(a.vertexColors[2],.5),y.vertexColors[2].copy(_),x.vertexColors[0].copy(_),x.vertexColors[1].copy(a.vertexColors[2]),x.vertexColors[2].copy(a.vertexColors[0]);t=1}else{var b,w,_;if((b=h.clone()).lerp(p,.5),y.a=l,y.b=c,y.c=g,x.a=g,x.b=c,x.c=u,3===a.vertexNormals.length)(w=a.vertexNormals[0].clone()).lerp(a.vertexNormals[2],.5),y.vertexNormals[2].copy(w),x.vertexNormals[0].copy(w);if(3===a.vertexColors.length)(_=a.vertexColors[0].clone()).lerp(a.vertexColors[2],.5),y.vertexColors[2].copy(_),x.vertexColors[0].copy(_);t=2}r.push(y,x),e.vertices.push(b);for(var S=0,T=e.faceVertexUvs.length;S<T;S++)if(e.faceVertexUvs[S].length){var M=e.faceVertexUvs[S][o],A=M[0],E=M[1],C=M[2];if(0===t){(D=A.clone()).lerp(E,.5);var P=[A.clone(),D.clone(),C.clone()],O=[D.clone(),E.clone(),C.clone()]}else if(1===t){(D=E.clone()).lerp(C,.5);P=[A.clone(),E.clone(),D.clone()],O=[D.clone(),C.clone(),A.clone()]}else{var D;(D=A.clone()).lerp(C,.5);P=[A.clone(),E.clone(),D.clone()],O=[D.clone(),E.clone(),C.clone()]}n[S].push(P,O)}}else{r.push(a);for(S=0,T=e.faceVertexUvs.length;S<T;S++)n[S].push(e.faceVertexUvs[S][o])}}}e.faces=r,e.faceVertexUvs=n};var vA=function(e,t){Mb.call(this,e,t),this.type="MorphAnimMesh",this.mixer=new FT(this),this.activeAction=null};vA.prototype=Object.create(Mb.prototype),vA.prototype.constructor=vA,vA.prototype.setDirectionForward=function(){this.mixer.timeScale=1},vA.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},vA.prototype.playAnimation=function(e,t){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var r=Jb.findByName(this,e);if(!r)throw new Error("MorphAnimMesh: animations["+e+"] undefined in .playAnimation()");var n=this.mixer.clipAction(r);n.timeScale=r.tracks.length*t/r.duration,this.activeAction=n.play()},vA.prototype.updateAnimation=function(e){this.mixer.update(e)},vA.prototype.copy=function(e){return Mb.prototype.copy.call(this,e),this.mixer=new FT(this),this};var gA=function(e){GT.call(this,"v4",{shared:!1}),this.index=e||0};gA.vertexDict=["color","color2"],gA.fragmentDict=["vColor","vColor2"],gA.prototype=Object.create(GT.prototype),gA.prototype.constructor=gA,gA.prototype.generate=function(e,t){var r;return e.material.requires.color[this.index]=!0,r=e.isShader("vertex")?gA.vertexDict[this.index]:gA.fragmentDict[this.index],e.format(r,this.getType(e),t)},gA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t};var yA=function(e){GT.call(this,"v3",{shared:!1}),this.scope=e||yA.TOTAL};yA.TOTAL="total",yA.prototype=Object.create(GT.prototype),yA.prototype.constructor=yA,yA.prototype.nodeType="Light",yA.prototype.generate=function(e,t){return e.isCache("light")?e.format("reflectedLight.directDiffuse",this.getType(e),t):(console.warn('LightNode is only compatible in "light" channel.'),e.format("vec3( 0.0 )",this.getType(e),t))},yA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t};var xA=function(e){GT.call(this,"v3",{unique:!0}),this.scope=e||xA.CUBE};xA.CUBE="cube",xA.SPHERE="sphere",xA.VECTOR="vector",xA.prototype=Object.create(GT.prototype),xA.prototype.constructor=xA,xA.prototype.nodeType="Reflect",xA.prototype.getType=function(e){switch(this.scope){case xA.SPHERE:return"v2"}return this.type},xA.prototype.generate=function(e,t){var r;switch(this.scope){case xA.VECTOR:e.material.addFragmentNode("vec3 reflectVec = inverseTransformDirection( reflect( -normalize( vViewPosition ), normal ), viewMatrix );"),r="reflectVec";break;case xA.CUBE:var n=new xA(xA.VECTOR).build(e,"v3");e.material.addFragmentNode("vec3 reflectCubeVec = vec3( -1.0 * "+n+".x, "+n+".yz );"),r="reflectCubeVec";break;case xA.SPHERE:n=new xA(xA.VECTOR).build(e,"v3");e.material.addFragmentNode("vec2 reflectSphereVec = normalize((viewMatrix * vec4("+n+", 0.0 )).xyz + vec3(0.0,0.0,1.0)).xy * 0.5 + 0.5;"),r="reflectSphereVec"}return e.format(r,this.getType(this.type),t)},xA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t};var bA=function(e){GT.call(this,"v2"),this.resolution=e};bA.prototype=Object.create(GT.prototype),bA.prototype.constructor=bA,bA.prototype.nodeType="ScreenUV",bA.prototype.generate=function(e,t){var r;e.material;return e.isShader("fragment")?r="(gl_FragCoord.xy/"+this.resolution.build(e,"v2")+")":(console.warn("ScreenUVNode is not compatible with "+e.shader+" shader."),r="vec2( 0.0 )"),e.format(r,this.getType(e),t)},bA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).resolution=this.resolution.toJSON(e).uuid),t};var wA=function(e,t){VT.call(this,t),this.name=e};wA.prototype=Object.create(VT.prototype),wA.prototype.constructor=wA,wA.prototype.nodeType="Attribute",wA.prototype.getAttributeType=function(e){return"number"==typeof this.type?e.getConstructorFromLength(this.type):this.type},wA.prototype.getType=function(e){var t=this.getAttributeType(e);return e.getTypeByFormat(t)},wA.prototype.generate=function(e,t){var r=this.getAttributeType(e),n=e.material.getAttribute(this.name,r);return e.format(e.isShader("vertex")?this.name:n.varying.name,this.getType(e),t)},wA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).out=this.type),t};var _A=function(e,t){GT.call(this),this.setFunction(e,t)};_A.prototype=Object.create(GT.prototype),_A.prototype.constructor=_A,_A.prototype.nodeType="FunctionCall",_A.prototype.setFunction=function(e,t){this.value=e,this.inputs=t||[]},_A.prototype.getFunction=function(){return this.value},_A.prototype.getType=function(e){return this.value.getType(e)},_A.prototype.generate=function(e,t){e.material;for(var r=this.getType(e),n=this.value,i=n.build(e,t)+"(",o=[],s=0;s<n.inputs.length;s++){var a=n.inputs[s],l=this.inputs[s]||this.inputs[a.name];o.push(l.build(e,e.getTypeByFormat(a.type)))}return i+=o.join(",")+")",e.format(i,r,t)},_A.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){var r=this.value;if((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,r.inputs.length){t.inputs={};for(var n=0;n<r.inputs.length;n++){var i=r.inputs[n],o=this.inputs[n]||this.inputs[i.name];t.inputs[i.name]=o.toJSON(e).uuid}}}return t};var SA=function(e){VT.call(this,"v4"),this.value=e};SA.prototype=Object.create(VT.prototype),SA.prototype.constructor=SA,SA.prototype.nodeType="Raw",SA.prototype.generate=function(e){e.material;var t=this.value.parseAndBuildCode(e,this.type),r=t.code+"\n";return"vertex"==e.shader?r+="gl_Position = "+t.result+";":r+="gl_FragColor = "+t.result+";",r},SA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t};var TA=function(e){this.material=e,this.caches=[],this.slots=[],this.keywords={},this.parsing=!1,this.optimize=!0,this.update()};TA.type={float:"fv1",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"iv1"},TA.constructors=["float","vec2","vec3","vec4"],TA.elements=["x","y","z","w"],TA.prototype={constructor:TA,addCache:function(e,t){return this.caches.push({name:e||"",requires:t||{}}),this.update()},removeCache:function(){return this.caches.pop(),this.update()},addSlot:function(e){return this.slots.push({name:e||""}),this.update()},removeSlot:function(){return this.slots.pop(),this.update()},isCache:function(e){for(var t=this.caches.length;t--;)if(this.caches[t].name==e)return!0;return!1},isSlot:function(e){for(var t=this.slots.length;t--;)if(this.slots[t].name==e)return!0;return!1},update:function(){var e=this.caches[this.caches.length-1],t=this.slots[this.slots.length-1];return this.slot=t?t.name:"",this.cache=e?e.name:"",this.requires=e?e.requires:{},this},require:function(e,t){return this.requires[e]=t,this},include:function(e,t,r){return this.material.include(this,e,t,r),this},colorToVector:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},getConstructorFromLength:function(e){return TA.constructors[e-1]},getFormatName:function(e){return e.replace(/c/g,"v3").replace(/fv1/g,"v1").replace(/iv1/g,"i")},isFormatMatrix:function(e){return/^m/.test(e)},getFormatLength:function(e){return parseInt(this.getFormatName(e).substr(1))},getFormatFromLength:function(e){return 1==e?"fv1":"v"+e},format:function(e,t,r){switch(this.getFormatName(r+"="+t)){case"v1=v2":case"v1=v3":case"v1=v4":return e+".x";case"v1=i":return"float("+e+")";case"v2=v1":return"vec2("+e+")";case"v2=v3":case"v2=v4":return e+".xy";case"v2=i":return"vec2(float("+e+"))";case"v3=v1":return"vec3("+e+")";case"v3=v2":return"vec3("+e+",0.0)";case"v3=v4":return e+".xyz";case"v3=i":return"vec2(float("+e+"))";case"v4=v1":return"vec4("+e+")";case"v4=v2":return"vec4("+e+",0.0,1.0)";case"v4=v3":return"vec4("+e+",1.0)";case"v4=i":return"vec4(float("+e+"))";case"i=v1":return"int("+e+")";case"i=v2":case"i=v3":case"i=v4":return"int("+e+".x)"}return e},getTypeByFormat:function(e){return TA.type[e]||e},getUuid:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e},getElementByIndex:function(e){return TA.elements[e]},getIndexByElement:function(e){return TA.elements.indexOf(e)},isShader:function(e){return this.shader==e},setShader:function(e){return this.shader=e,this}};var MA=function(e,t){sw.call(this),this.vertex=e||new SA(new qT(qT.PROJECTION)),this.fragment=t||new SA(new AA(16711680)),this.updaters=[]};MA.types={t:"sampler2D",tc:"samplerCube",bv1:"bool",iv1:"int",fv1:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"},MA.addShortcuts=function(e,t,r){function n(e,t){return{get:function(){return this[e][t]},set:function(r){this[e][t]=r}}}return function(){for(var i={},o=0;o<r.length;++o){var s=r[o];i[s]=n(t,s)}Object.defineProperties(e,i)}()},MA.prototype=Object.create(sw.prototype),MA.prototype.constructor=MA,MA.prototype.type="NodeMaterial",MA.prototype.updateFrame=function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])},MA.prototype.build=function(){var e,t;this.nodes=[],this.defines={},this.uniforms={},this.attributes={},this.extensions={},this.nodeData={},this.vertexUniform=[],this.fragmentUniform=[],this.vars=[],this.vertexTemps=[],this.fragmentTemps=[],this.uniformList=[],this.consts=[],this.functions=[],this.updaters=[],this.requires={uv:[],color:[],lights:this.lights,fog:this.fog},this.vertexPars="",this.fragmentPars="",this.vertexCode="",this.fragmentCode="",this.vertexNode="",this.fragmentNode="",this.prefixCode=["#ifdef GL_EXT_shader_texture_lod","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>"].join("\n");var r=new TA(this);return e=this.vertex.build(r.setShader("vertex"),"v4"),t=this.fragment.build(r.setShader("fragment"),"v4"),this.requires.uv[0]&&(this.addVertexPars("varying vec2 vUv;"),this.addFragmentPars("varying vec2 vUv;"),this.addVertexCode("vUv = uv;")),this.requires.uv[1]&&(this.addVertexPars("varying vec2 vUv2; attribute vec2 uv2;"),this.addFragmentPars("varying vec2 vUv2;"),this.addVertexCode("vUv2 = uv2;")),this.requires.color[0]&&(this.addVertexPars("varying vec4 vColor; attribute vec4 color;"),this.addFragmentPars("varying vec4 vColor;"),this.addVertexCode("vColor = color;")),this.requires.color[1]&&(this.addVertexPars("varying vec4 vColor2; attribute vec4 color2;"),this.addFragmentPars("varying vec4 vColor2;"),this.addVertexCode("vColor2 = color2;")),this.requires.position&&(this.addVertexPars("varying vec3 vPosition;"),this.addFragmentPars("varying vec3 vPosition;"),this.addVertexCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVertexPars("varying vec3 vWPosition;"),this.addFragmentPars("varying vec3 vWPosition;"),this.addVertexCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVertexPars("varying vec3 vObjectNormal;"),this.addFragmentPars("varying vec3 vObjectNormal;"),this.addVertexCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVertexPars("varying vec3 vWNormal;"),this.addFragmentPars("varying vec3 vWNormal;"),this.addVertexCode("vWNormal = ( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz;")),this.fog=this.requires.fog,this.lights=this.requires.lights,this.transparent=this.requires.transparent||this.blending>Vy,this.vertexShader=[this.prefixCode,this.vertexPars,this.getCodePars(this.vertexUniform,"uniform"),this.getIncludes(this.consts.vertex),this.getIncludes(this.functions.vertex),"void main(){",this.getCodePars(this.vertexTemps),e,this.vertexCode,"}"].join("\n"),this.fragmentShader=[this.prefixCode,this.fragmentPars,this.getCodePars(this.fragmentUniform,"uniform"),this.getIncludes(this.consts.fragment),this.getIncludes(this.functions.fragment),"void main(){",this.getCodePars(this.fragmentTemps),this.fragmentCode,t,"}"].join("\n"),this.needsUpdate=!0,this.dispose(),this},MA.prototype.define=function(e,t){this.defines[e]=void 0==t?1:t},MA.prototype.isDefined=function(e){return void 0!=this.defines[e]},MA.prototype.mergeUniform=function(e){for(var t in e)this.uniforms[t]=e[t]},MA.prototype.createUniform=function(e,t,r,n){var i=this.uniformList.length,o={type:e,value:t,name:r||"nVu"+i,needsUpdate:n};return this.uniformList.push(o),o},MA.prototype.getVertexTemp=function(e,t,r){var n=this.vertexTemps[e];if(!n){var i=this.vertexTemps.length;n={name:r||"nVt"+i,type:t},this.vertexTemps.push(n),this.vertexTemps[e]=n}return n},MA.prototype.getFragmentTemp=function(e,t,r){var n=this.fragmentTemps[e];if(!n){var i=this.fragmentTemps.length;n={name:r||"nVt"+i,type:t},this.fragmentTemps.push(n),this.fragmentTemps[e]=n}return n},MA.prototype.getVar=function(e,t,r){var n=this.vars[e];if(!n){var i=this.vars.length,o=r||"nVv"+i;n={name:o,type:t},this.vars.push(n),this.vars[e]=n,this.addVertexPars("varying "+t+" "+o+";"),this.addFragmentPars("varying "+t+" "+o+";")}return n},MA.prototype.getAttribute=function(e,t){if(!this.attributes[e]){var r=this.getVar(e,t);this.addVertexPars("attribute "+t+" "+e+";"),this.addVertexCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:t}}return this.attributes[e]},MA.prototype.getIncludes=function(){function e(e,t){return e.deps.length-t.deps.length}return function(t){if(!t)return"";for(var r="",n=(t=t.sort(e),0);n<t.length;n++)t[n].src&&(r+=t[n].src+"\n");return r}}(),MA.prototype.addVertexPars=function(e){this.vertexPars+=e+"\n"},MA.prototype.addFragmentPars=function(e){this.fragmentPars+=e+"\n"},MA.prototype.addVertexCode=function(e){this.vertexCode+=e+"\n"},MA.prototype.addFragmentCode=function(e){this.fragmentCode+=e+"\n"},MA.prototype.addVertexNode=function(e){this.vertexNode+=e+"\n"},MA.prototype.clearVertexNode=function(){var e=this.vertexNode;return this.vertexNode="",e},MA.prototype.addFragmentNode=function(e){this.fragmentNode+=e+"\n"},MA.prototype.clearFragmentNode=function(){var e=this.fragmentNode;return this.fragmentNode="",e},MA.prototype.getCodePars=function(e,t){t=t||"";for(var r="",n=0,i=e.length;n<i;++n){var o=e[n].type,s=e[n].name,a=e[n].value;"t"==o&&a instanceof _T&&(o="tc");var l=MA.types[o];if(void 0==l)throw new Error("Node pars "+o+" not found.");r+=t+" "+l+" "+s+";\n"}return r},MA.prototype.createVertexUniform=function(e,t,r,n){var i=this.createUniform(e,t,r,n);return this.vertexUniform.push(i),this.vertexUniform[i.name]=i,this.uniforms[i.name]=i,i},MA.prototype.createFragmentUniform=function(e,t,r,n){var i=this.createUniform(e,t,r,n);return this.fragmentUniform.push(i),this.fragmentUniform[i.name]=i,this.uniforms[i.name]=i,i},MA.prototype.getDataNode=function(e){return this.nodeData[e]=this.nodeData[e]||{}},MA.prototype.include=function(e,t,r,n){var i;(t="string"==typeof t?WT.get(t):t)instanceof HT?i=this.functions[e.shader]=this.functions[e.shader]||[]:t instanceof KT&&(i=this.consts[e.shader]=this.consts[e.shader]||[]);var o=i[t.name];if(o||(o=i[t.name]={node:t,deps:[]},i.push(o),o.src=t.build(e,"source")),t instanceof HT&&r&&i[r.name]&&-1==i[r.name].deps.indexOf(t)&&(i[r.name].deps.push(t),t.includes&&t.includes.length)){var s=0;do{this.include(e,t.includes[s++],r)}while(s<t.includes.length)}n&&(o.src=n)},MA.prototype.toJSON=function(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.materials&&(e.materials={}),!e.materials[this.uuid]){var t={};t.uuid=this.uuid,t.type=this.type,e.materials[t.uuid]=t,""!==this.name&&(t.name=this.name),this.blending!==Vy&&(t.blending=this.blending),!0===this.flatShading&&(t.flatShading=this.flatShading),this.side!==Ry&&(t.side=this.side),!0===this.transparent&&(t.transparent=this.transparent),t.depthFunc=this.depthFunc,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,!0===this.wireframe&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(t.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(t.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(t.morphTargets=!0),!0===this.skinning&&(t.skinning=!0),t.fog=this.fog,t.lights=this.lights,!1===this.visible&&(t.visible=!1),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.vertex=this.vertex.toJSON(e).uuid,t.fragment=this.fragment.toJSON(e).uuid}return e.material=this.uuid,e};var AA=function(e){JT.call(this,"c"),this.value=new ay(e||0)};AA.prototype=Object.create(JT.prototype),AA.prototype.constructor=AA,AA.prototype.nodeType="Color",MA.addShortcuts(AA.prototype,"value",["r","g","b"]),AA.prototype.generateReadonly=function(e,t,r,n,i,o){return e.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",n,t)},AA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).r=this.r,t.g=this.g,t.b=this.b,!0===this.readonly&&(t.readonly=!0)),t};var EA=function(e,t,r){JT.call(this,"v4",{shared:!0}),this.value=e,this.coord=t||new xA,this.bias=r};EA.prototype=Object.create(JT.prototype),EA.prototype.constructor=EA,EA.prototype.nodeType="CubeTexture",EA.prototype.getTexture=function(e,t){return JT.prototype.generate.call(this,e,t,this.value.uuid,"t")},EA.prototype.generate=function(e,t){if("samplerCube"===t)return this.getTexture(e,t);var r,n=this.getTexture(e,t),i=this.coord.build(e,"v3"),o=this.bias?this.bias.build(e,"fv1"):void 0;return void 0==o&&e.requires.bias&&(o=e.requires.bias.build(e,"fv1")),r=o?"texCubeBias("+n+","+i+","+o+")":"texCube("+n+","+i+")",e.isSlot("color")?r="mapTexelToLinear("+r+")":e.isSlot("emissive")?r="emissiveMapTexelToLinear("+r+")":e.isSlot("environment")&&(r="envMapTexelToLinear("+r+")"),e.format(r,this.type,t)},EA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.uuid,t.coord=this.coord.toJSON(e).uuid,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t};var CA=function(e){JT.call(this,"iv1"),this.value=[Math.floor(e||0)]};CA.prototype=Object.create(JT.prototype),CA.prototype.constructor=CA,CA.prototype.nodeType="Int",Object.defineProperties(CA.prototype,{number:{get:function(){return this.value[0]},set:function(e){this.value[0]=Math.floor(e)}}}),CA.prototype.generateReadonly=function(e,t,r,n,i,o){return e.format(this.number,n,t)},CA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).number=this.number,!0===this.readonly&&(t.readonly=!0)),t};var PA=function(e){JT.call(this,"m3"),this.value=e||new ny};PA.prototype=Object.create(JT.prototype),PA.prototype.constructor=PA,PA.prototype.nodeType="Matrix3",PA.prototype.generateReadonly=function(e,t,r,n,i,o){return e.format("mat3( "+this.value.elements.join(", ")+" )",n,t)},PA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat(),!0===this.readonly&&(t.readonly=!0)),t};var OA=function(e){JT.call(this,"m4"),this.value=e||new Qg};OA.prototype=Object.create(JT.prototype),OA.prototype.constructor=OA,OA.prototype.nodeType="Matrix4",OA.prototype.generateReadonly=function(e,t,r,n,i,o){return e.format("mat4( "+this.value.elements.join(", ")+" )",n,t)},OA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat(),!0===this.readonly&&(t.readonly=!0)),t};var DA=function(e,t,r){GT.call(this),this.a=e,this.b=t,this.op=r||DA.ADD};DA.ADD="+",DA.SUB="-",DA.MUL="*",DA.DIV="/",DA.prototype=Object.create(GT.prototype),DA.prototype.constructor=DA,DA.prototype.nodeType="Operator",DA.prototype.getType=function(e){var t=this.a.getType(e),r=this.b.getType(e);return e.isFormatMatrix(t)?"v4":e.getFormatLength(r)>e.getFormatLength(t)?r:t},DA.prototype.generate=function(e,t){e.material.getDataNode(this.uuid);var r=this.getType(e),n=this.a.build(e,r),i=this.b.build(e,r);return e.format("("+n+this.op+i+")",r,t)},DA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op),t};var NA=function(e,t,r,n){JT.call(this,"v4",{shared:!0}),this.value=e,this.coord=t||new XT,this.bias=r,this.project=void 0!==n&&n};NA.prototype=Object.create(JT.prototype),NA.prototype.constructor=NA,NA.prototype.nodeType="Texture",NA.prototype.getTexture=function(e,t){return JT.prototype.generate.call(this,e,t,this.value.uuid,"t")},NA.prototype.generate=function(e,t){if("sampler2D"===t)return this.getTexture(e,t);var r,n,i=this.getTexture(e,t),o=this.coord.build(e,this.project?"v4":"v2"),s=this.bias?this.bias.build(e,"fv1"):void 0;return void 0==s&&e.requires.bias&&(s=e.requires.bias.build(e,"fv1")),r=this.project?"texture2DProj":s?"tex2DBias":"tex2D",n=s?r+"("+i+","+o+","+s+")":r+"("+i+","+o+")",e.isSlot("color")?n="mapTexelToLinear("+n+")":e.isSlot("emissive")?n="emissiveMapTexelToLinear("+n+")":e.isSlot("environment")&&(n="envMapTexelToLinear("+n+")"),e.format(n,this.type,t)},NA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.value&&(t.value=this.value.uuid),t.coord=this.coord.toJSON(e).uuid,t.project=this.project,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t};var LA=function(e){GT.call(this,"v4"),e&&this.setMirror(e)};LA.prototype=Object.create(GT.prototype),LA.prototype.constructor=LA,LA.prototype.nodeType="Reflector",LA.prototype.setMirror=function(e){this.mirror=e,this.textureMatrix=new OA(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new qT(qT.LOCAL),this.coord=new DA(this.textureMatrix,this.localPosition,DA.MUL),this.coordResult=new DA(null,this.coord,DA.ADD),this.texture=new NA(this.mirror.material.uniforms.tDiffuse.value,this.coord,null,!0)},LA.prototype.generate=function(e,t){e.material;return e.isShader("fragment")?(this.coordResult.a=this.offset,this.texture.coord=this.offset?this.coordResult:this.coord,"sampler2D"===t?this.texture.build(e,t):e.format(this.texture.build(e,this.type),this.type,t)):(console.warn("ReflectorNode is not compatible with "+e.shader+" shader."),e.format("vec4(0.0)",this.type,t))},LA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).mirror=this.mirror.uuid,this.offset&&(t.offset=this.offset.toJSON(e).uuid)),t};var IA=function(e){NA.call(this,void 0,e)};IA.prototype=Object.create(NA.prototype),IA.prototype.constructor=IA,IA.prototype.nodeType="Screen",IA.prototype.isUnique=function(){return!0},IA.prototype.getTexture=function(e,t){return JT.prototype.generate.call(this,e,t,this.getUuid(),"t","renderTexture")};var RA=function(e,t){JT.call(this,"v2"),this.value=new hy(e,t)};RA.prototype=Object.create(JT.prototype),RA.prototype.constructor=RA,RA.prototype.nodeType="Vector2",MA.addShortcuts(RA.prototype,"value",["x","y"]),RA.prototype.generateReadonly=function(e,t,r,n,i,o){return e.format("vec2( "+this.x+", "+this.y+" )",n,t)},RA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,!0===this.readonly&&(t.readonly=!0)),t};var FA=function(e,t,r){JT.call(this,"v3"),this.type="v3",this.value=new Kg(e,t,r)};FA.prototype=Object.create(JT.prototype),FA.prototype.constructor=FA,FA.prototype.nodeType="Vector3",MA.addShortcuts(FA.prototype,"value",["x","y","z"]),FA.prototype.generateReadonly=function(e,t,r,n,i,o){return e.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",n,t)},FA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,!0===this.readonly&&(t.readonly=!0)),t};var kA=function(e,t,r,n){JT.call(this,"v4"),this.value=new fy(e,t,r,n)};kA.prototype=Object.create(JT.prototype),kA.prototype.constructor=kA,kA.prototype.nodeType="Vector4",MA.addShortcuts(kA.prototype,"value",["x","y","z","w"]),kA.prototype.generateReadonly=function(e,t,r,n,i,o){return e.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",n,t)},kA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,!0===this.readonly&&(t.readonly=!0)),t};var UA=function(){VT.call(this),this.color=new AA(15658734),this.specular=new AA(1118481),this.shininess=new ZT(30)};UA.prototype=Object.create(VT.prototype),UA.prototype.constructor=UA,UA.prototype.nodeType="Phong",UA.prototype.build=function(e){var t,r=e.material;if(r.define("PHONG"),r.define("ALPHATEST","0.0"),r.requires.lights=!0,e.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(e,"v3",{cache:"transform"}):void 0;r.mergeUniform(ow.merge([F_.fog,F_.lights])),r.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&i.push(n.code,"transformed = "+n.result+";"),i.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>"),t=i.join("\n")}else{this.color.parse(e,{slot:"color"}),this.specular.parse(e),this.shininess.parse(e),this.alpha&&this.alpha.parse(e),this.normal&&this.normal.parse(e),this.normalScale&&this.normal&&this.normalScale.parse(e),this.light&&this.light.parse(e,{cache:"light"}),this.ao&&this.ao.parse(e),this.ambient&&this.ambient.parse(e),this.shadow&&this.shadow.parse(e),this.emissive&&this.emissive.parse(e,{slot:"emissive"}),this.environment&&this.environment.parse(e,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.parse(e);var o=this.color.buildCode(e,"c",{slot:"color"}),s=this.specular.buildCode(e,"c"),a=this.shininess.buildCode(e,"fv1"),l=this.alpha?this.alpha.buildCode(e,"fv1"):void 0,c=this.normal?this.normal.buildCode(e,"v3"):void 0,u=this.normalScale&&this.normal?this.normalScale.buildCode(e,"v2"):void 0,h=this.light?this.light.buildCode(e,"v3",{cache:"light"}):void 0,d=this.ao?this.ao.buildCode(e,"fv1"):void 0,p=this.ambient?this.ambient.buildCode(e,"c"):void 0,f=this.shadow?this.shadow.buildCode(e,"c"):void 0,m=this.emissive?this.emissive.buildCode(e,"c",{slot:"emissive"}):void 0,v=this.environment?this.environment.buildCode(e,"c",{slot:"environment"}):void 0,g=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(e,"fv1"):void 0;r.requires.transparent=void 0!=l,r.addFragmentPars(["#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));i=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;",o.code,"\tvec3 diffuseColor = "+o.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",s.code,"\tvec3 specular = "+s.result+";",a.code,"\tfloat shininess = max(0.0001,"+a.result+");","\tfloat specularStrength = 1.0;"];l&&i.push(l.code,"if ( "+l.result+" <= ALPHATEST ) discard;"),c&&(e.include("perturbNormal2Arb"),i.push(c.code),u&&i.push(u.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+c.result+","+(new XT).build(e,"v2")+","+(u?u.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(h?"vec3( 1.0 )":"diffuseColor")+";"),i.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h&&(i.push(h.code,"reflectedLight.directDiffuse = "+h.result+";"),i.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),d&&i.push(d.code,"reflectedLight.indirectDiffuse *= "+d.result+";"),p&&i.push(p.code,"reflectedLight.indirectDiffuse += "+p.result+";"),f&&i.push(f.code,"reflectedLight.directDiffuse *= "+f.result+";","reflectedLight.directSpecular *= "+f.result+";"),m&&i.push(m.code,"reflectedLight.directDiffuse += "+m.result+";"),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),v&&(i.push(v.code),g?i.push(g.code,"outgoingLight = mix( outgoingLight, "+v.result+", "+g.result+" );"):i.push("outgoingLight = "+v.result+";")),l?i.push("gl_FragColor = vec4( outgoingLight, "+l.result+" );"):i.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),t=i.join("\n")}return t},UA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.transform&&(t.transform=this.transform.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.specular=this.specular.toJSON(e).uuid,t.shininess=this.shininess.toJSON(e).uuid,this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.normalScale&&(t.normalScale=this.normalScale.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.environmentAlpha&&(t.environmentAlpha=this.environmentAlpha.toJSON(e).uuid)),t};var BA=function(){this.node=new UA,MA.call(this,this.node,this.node),this.type="PhongNodeMaterial"};BA.prototype=Object.create(MA.prototype),BA.prototype.constructor=BA,MA.addShortcuts(BA.prototype,"node",["color","alpha","specular","shininess","normal","normalScale","emissive","ambient","light","shadow","ao","environment","environmentAlpha","transform"]);var jA=function(){VT.call(this),this.color=new AA(15658734),this.spherical=!0};jA.prototype=Object.create(VT.prototype),jA.prototype.constructor=jA,jA.prototype.nodeType="Sprite",jA.prototype.build=function(e){var t,r=e.material;if(r.define("SPRITE"),r.requires.lights=!1,r.requires.transparent=void 0!=this.alpha,e.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(e,"v3",{cache:"transform"}):void 0;r.mergeUniform(ow.merge([F_.fog])),r.addVertexPars(["#include <fog_pars_vertex>"].join("\n")),t=["#include <begin_vertex>"],n&&t.push(n.code,"transformed = "+n.result+";"),t.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||t.push("modelMtx[1][1] = 1.0;"),t.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&t.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),t.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );")}else{r.addFragmentPars(["#include <fog_pars_fragment>"].join("\n")),this.color.parse(e,{slot:"color"}),this.alpha&&this.alpha.parse(e);var i=this.color.buildCode(e,"c",{slot:"color"}),o=this.alpha?this.alpha.buildCode(e,"fv1"):void 0;t=[i.code],o?t.push(o.code,"gl_FragColor = vec4( "+i.result+", "+o.result+" );"):t.push("gl_FragColor = vec4( "+i.result+", 1.0 );"),t.push("#include <fog_fragment>")}return t.join("\n")},jA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.transform&&(t.transform=this.transform.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,!1===this.spherical&&(t.spherical=!1),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid)),t};var zA=function(){this.node=new jA,MA.call(this,this.node,this.node),this.type="SpriteNodeMaterial"};zA.prototype=Object.create(MA.prototype),zA.prototype.constructor=zA,MA.addShortcuts(zA.prototype,"node",["color","alpha","transform","spherical"]);var VA=function(){GT.call(this,"fv1")};VA.getSpecularMIPLevel=new HT(["float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {","\tfloat maxMIPLevelScalar = float( maxMIPLevel );","\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n")),VA.prototype=Object.create(GT.prototype),VA.prototype.constructor=VA,VA.prototype.nodeType="RoughnessToBlinnExponent",VA.prototype.generate=function(e,t){var r=e.material;return e.isShader("fragment")?r.isDefined("PHYSICAL")?(e.include(VA.getSpecularMIPLevel),e.isCache("clearCoat")?e.format("getSpecularMIPLevel( Material_ClearCoat_BlinnShininessExponent( material ), 8 )",this.type,t):e.format("getSpecularMIPLevel( Material_BlinnShininessExponent( material ), 8 )",this.type,t)):(console.warn("RoughnessToBlinnExponentNode is only compatible with PhysicalMaterial."),e.format("0.0",this.type,t)):(console.warn("RoughnessToBlinnExponentNode is not compatible with "+e.shader+" shader."),e.format("0.0",this.type,t))};var GA=function(){VT.call(this),this.color=new AA(15658734),this.roughness=new ZT(.5),this.metalness=new ZT(.5)};GA.prototype=Object.create(VT.prototype),GA.prototype.constructor=GA,GA.prototype.nodeType="Standard",GA.prototype.build=function(e){var t,r=e.material;if(r.define("PHYSICAL"),this.clearCoat||this.clearCoatRoughness||r.define("STANDARD"),r.define("ALPHATEST","0.0"),r.requires.lights=!0,r.extensions.shaderTextureLOD=!0,e.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(e,"v3",{cache:"transform"}):void 0;r.mergeUniform(ow.merge([F_.fog,F_.lights])),r.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&i.push(n.code,"transformed = "+n.result+";"),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),t=i.join("\n")}else{var o={bias:new VA,offsetU:0,offsetV:0},s=!r.isDefined("STANDARD");this.color.parse(e,{slot:"color"}),this.roughness.parse(e),this.metalness.parse(e),this.alpha&&this.alpha.parse(e),this.normal&&this.normal.parse(e),this.normalScale&&this.normal&&this.normalScale.parse(e),this.clearCoat&&this.clearCoat.parse(e),this.clearCoatRoughness&&this.clearCoatRoughness.parse(e),this.reflectivity&&this.reflectivity.parse(e),this.light&&this.light.parse(e,{cache:"light"}),this.ao&&this.ao.parse(e),this.ambient&&this.ambient.parse(e),this.shadow&&this.shadow.parse(e),this.emissive&&this.emissive.parse(e,{slot:"emissive"}),this.environment&&this.environment.parse(e,{cache:"env",requires:o,slot:"environment"});var a=this.color.buildCode(e,"c",{slot:"color"}),l=this.roughness.buildCode(e,"fv1"),c=this.metalness.buildCode(e,"fv1"),u=this.alpha?this.alpha.buildCode(e,"fv1"):void 0,h=this.normal?this.normal.buildCode(e,"v3"):void 0,d=this.normalScale&&this.normal?this.normalScale.buildCode(e,"v2"):void 0,p=this.clearCoat?this.clearCoat.buildCode(e,"fv1"):void 0,f=this.clearCoatRoughness?this.clearCoatRoughness.buildCode(e,"fv1"):void 0,m=this.reflectivity?this.reflectivity.buildCode(e,"fv1"):void 0,v=this.light?this.light.buildCode(e,"v3",{cache:"light"}):void 0,g=this.ao?this.ao.buildCode(e,"fv1"):void 0,y=this.ambient?this.ambient.buildCode(e,"c"):void 0,x=this.shadow?this.shadow.buildCode(e,"c"):void 0,b=this.emissive?this.emissive.buildCode(e,"c",{slot:"emissive"}):void 0,w=this.environment?this.environment.buildCode(e,"c",{cache:"env",requires:o,slot:"environment"}):void 0,_=s&&w?this.environment.buildCode(e,"c",{cache:"clearCoat",requires:o,slot:"environment"}):void 0;r.requires.transparent=void 0!=u,r.addFragmentPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_vertex>"].join("\n"));i=["\t#include <normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );",a.code,"\tvec3 diffuseColor = "+a.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",l.code,"\tfloat roughnessFactor = "+l.result+";",c.code,"\tfloat metalnessFactor = "+c.result+";"];u&&i.push(u.code,"if ( "+u.result+" <= ALPHATEST ) discard;"),h&&(e.include("perturbNormal2Arb"),i.push(h.code),d&&i.push(d.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+h.result+","+(new XT).build(e,"v2")+","+(d?d.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(v?"vec3( 1.0 )":"diffuseColor * (1.0 - metalnessFactor)")+";"),i.push("material.specularRoughness = clamp( roughnessFactor, DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"),p?i.push(p.code,"material.clearCoat = saturate( "+p.result+" );"):s&&i.push("material.clearCoat = 0.0;"),f?i.push(f.code,"material.clearCoatRoughness = clamp( "+f.result+", DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"):s&&i.push("material.clearCoatRoughness = 0.0;"),m?i.push(m.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+m.result+" ) ), diffuseColor, metalnessFactor );"):i.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),i.push("#include <lights_fragment_begin>","#include <lights_fragment_end>"),v&&(i.push(v.code,"reflectedLight.directDiffuse = "+v.result+";"),i.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),g&&i.push(g.code,"reflectedLight.indirectDiffuse *= "+g.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+g.result+", material.specularRoughness );"),y&&i.push(y.code,"reflectedLight.indirectDiffuse += "+y.result+";"),x&&i.push(x.code,"reflectedLight.directDiffuse *= "+x.result+";","reflectedLight.directSpecular *= "+x.result+";"),b&&i.push(b.code,"reflectedLight.directDiffuse += "+b.result+";"),w&&(i.push(w.code),_&&i.push(_.code,"clearCoatRadiance += "+_.result+";"),i.push("RE_IndirectSpecular("+w.result+", clearCoatRadiance, geometry, material, reflectedLight );")),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),u?i.push("gl_FragColor = vec4( outgoingLight, "+u.result+" );"):i.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),t=i.join("\n")}return t},GA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.transform&&(t.transform=this.transform.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.roughness=this.roughness.toJSON(e).uuid,t.metalness=this.metalness.toJSON(e).uuid,this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.normalScale&&(t.normalScale=this.normalScale.toJSON(e).uuid),this.clearCoat&&(t.clearCoat=this.clearCoat.toJSON(e).uuid),this.clearCoatRoughness&&(t.clearCoatRoughness=this.clearCoatRoughness.toJSON(e).uuid),this.reflectivity&&(t.reflectivity=this.reflectivity.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid)),t};var HA=function(){this.node=new GA,MA.call(this,this.node,this.node),this.type="StandardNodeMaterial"};HA.prototype=Object.create(MA.prototype),HA.prototype.constructor=HA,MA.addShortcuts(HA.prototype,"node",["color","alpha","roughness","metalness","reflectivity","clearCoat","clearCoatRoughness","normal","normalScale","emissive","ambient","light","shadow","ao","environment","transform"]);var WA=function(e,t){GT.call(this),this.a=e,this.method=t||WA.SIN};WA.RAD="radians",WA.DEG="degrees",WA.EXP="exp",WA.EXP2="exp2",WA.LOG="log",WA.LOG2="log2",WA.SQRT="sqrt",WA.INV_SQRT="inversesqrt",WA.FLOOR="floor",WA.CEIL="ceil",WA.NORMALIZE="normalize",WA.FRACT="fract",WA.SAT="saturate",WA.SIN="sin",WA.COS="cos",WA.TAN="tan",WA.ASIN="asin",WA.ACOS="acos",WA.ARCTAN="atan",WA.ABS="abs",WA.SIGN="sign",WA.LENGTH="length",WA.NEGATE="negate",WA.INVERT="invert",WA.prototype=Object.create(GT.prototype),WA.prototype.constructor=WA,WA.prototype.nodeType="Math1",WA.prototype.getType=function(e){switch(this.method){case WA.LENGTH:return"fv1"}return this.a.getType(e)},WA.prototype.generate=function(e,t){e.material;var r=this.getType(e),n=this.a.build(e,r);switch(this.method){case WA.NEGATE:n="(-"+n+")";break;case WA.INVERT:n="(1.0-"+n+")";break;default:n=this.method+"("+n+")"}return e.format(n,r,t)},WA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.method=this.method),t};var XA=function(e,t,r){GT.call(this),this.a=e,this.b=t,this.method=r||XA.DISTANCE};XA.MIN="min",XA.MAX="max",XA.MOD="mod",XA.STEP="step",XA.REFLECT="reflect",XA.DISTANCE="distance",XA.DOT="dot",XA.CROSS="cross",XA.POW="pow",XA.prototype=Object.create(GT.prototype),XA.prototype.constructor=XA,XA.prototype.nodeType="Math2",XA.prototype.getInputType=function(e){return e.getFormatLength(this.b.getType(e))>e.getFormatLength(this.a.getType(e))?this.b.getType(e):this.a.getType(e)},XA.prototype.getType=function(e){switch(this.method){case XA.DISTANCE:case XA.DOT:return"fv1";case XA.CROSS:return"v3"}return this.getInputType(e)},XA.prototype.generate=function(e,t){e.material;var r,n,i=this.getInputType(e),o=e.getFormatLength(this.a.getType(e)),s=e.getFormatLength(this.b.getType(e));switch(this.method){case XA.CROSS:r=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case XA.STEP:r=this.a.build(e,1==o?"fv1":i),n=this.b.build(e,i);break;case XA.MIN:case XA.MAX:case XA.MOD:r=this.a.build(e,i),n=this.b.build(e,1==s?"fv1":i);break;default:r=this.a.build(e,i),n=this.b.build(e,i)}return e.format(this.method+"("+r+","+n+")",this.getType(e),t)},XA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.method=this.method),t};var qA=function(e,t,r,n){GT.call(this),this.a=e,this.b=t,this.c=r,this.method=n||qA.MIX};qA.MIX="mix",qA.REFRACT="refract",qA.SMOOTHSTEP="smoothstep",qA.FACEFORWARD="faceforward",qA.prototype=Object.create(GT.prototype),qA.prototype.constructor=qA,qA.prototype.nodeType="Math3",qA.prototype.getType=function(e){var t=e.getFormatLength(this.a.getType(e)),r=e.getFormatLength(this.b.getType(e)),n=e.getFormatLength(this.c.getType(e));return t>r&&t>n?this.a.getType(e):r>n?this.b.getType(e):this.c.getType(e)},qA.prototype.generate=function(e,t){e.material;var r,n,i,o=this.getType(e),s=(e.getFormatLength(this.a.getType(e)),e.getFormatLength(this.b.getType(e)),e.getFormatLength(this.c.getType(e)));switch(this.method){case qA.REFRACT:r=this.a.build(e,o),n=this.b.build(e,o),i=this.c.build(e,"fv1");break;case qA.MIX:r=this.a.build(e,o),n=this.b.build(e,o),i=this.c.build(e,1==s?"fv1":o);break;default:r=this.a.build(e,o),n=this.b.build(e,o),i=this.c.build(e,o)}return e.format(this.method+"("+r+","+n+","+i+")",o,t)},qA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.c=this.c.toJSON(e).uuid,t.method=this.method),t};var YA=function(e){this.time=void 0!==e?e:0,this.frameId=0};YA.prototype.update=function(e){return++this.frameId,this.time+=e,this.delta=e,this},YA.prototype.updateNode=function(e){return e.frameId===this.frameId?this:(e.updateFrame(this),e.frameId=this.frameId,this)};var JA=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(JA.prototype,{setSize:function(e,t){},render:function(e,t,r,n,i){console.error("Pass: .render() must be implemented in derived pass.")}});var ZA=function(e,t){JA.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof sw?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=ow.clone(e.uniforms),this.material=new sw({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};ZA.prototype=Object.assign(Object.create(JA.prototype),{constructor:ZA,render:function(e,t,r,n,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}});var QA=function(){ZA.call(this),this.name="",this.uuid=Zg.generateUUID(),this.userData={},this.textureID="renderTexture",this.fragment=new SA(new IA),this.node=new MA,this.node.fragment=this.fragment,this.build()};QA.prototype=Object.create(ZA.prototype),QA.prototype.constructor=QA,MA.addShortcuts(QA.prototype,"fragment",["value"]),QA.prototype.build=function(){this.node.build(),this.uniforms=this.node.uniforms,this.material=this.node},QA.prototype.toJSON=function(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.passes&&(e.passes={}),!e.passes[this.uuid]){var t={};t.uuid=this.uuid,t.type="NodePass",e.passes[this.uuid]=t,""!==this.name&&(t.name=this.name),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.value=this.value.toJSON(e).uuid}return e.pass=this.uuid,e};var KA=function(e,t,r,n){GT.call(this,"v4"),this.value=e,this.coord=t||new XT,this.radius=new RA(1,1),this.size=n,this.blurX=!0,this.blurY=!0,this.horizontal=new ZT(1/64),this.vertical=new ZT(1/64)};KA.fBlurX=new HT(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum;","}"].join("\n")),KA.fBlurY=new HT(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum;","}"].join("\n")),KA.prototype=Object.create(GT.prototype),KA.prototype.constructor=KA,KA.prototype.nodeType="Blur",KA.prototype.updateFrame=function(e){if(this.size)this.horizontal.number=this.radius.x/this.size.x,this.vertical.number=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var t=this.value.value.image;this.horizontal.number=this.radius.x/t.width,this.vertical.number=this.radius.y/t.height}},KA.prototype.generate=function(e,t){e.material;var r=KA.fBlurX,n=KA.fBlurY;if(e.include(r),e.include(n),e.isShader("fragment")){var i,o=[];return this.blurX&&o.push(r.name+"("+this.value.build(e,"sampler2D")+","+this.coord.build(e,"v2")+","+this.horizontal.build(e,"fv1")+")"),this.blurY&&o.push(n.name+"("+this.value.build(e,"sampler2D")+","+this.coord.build(e,"v2")+","+this.vertical.build(e,"fv1")+")"),i=2==o.length?"("+o.join("+")+"/2.0)":o.length?"("+o[0]+")":"vec4( 0.0 )",e.format(i,this.getType(e),t)}return console.warn("BlurNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},KA.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.coord=this.coord.toJSON(e).uuid,t.radius=this.radius.toJSON(e).uuid,this.size&&(t.size={x:this.size.x,y:this.size.y}),t.blurX=this.blurX,t.blurY=this.blurY),t};var $A=function(e,t,r){GT.call(this,"v3"),this.value=e,this.coord=t||new XT,this.scale=r||new RA(1,1)};$A.fBumpToNormal=new HT(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, vec2 scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 + ( dBx * scale.x ), .5 + ( dBy * scale.y ), 1.0 );","}"].join("\n"),null,{derivatives:!0}),$A.prototype=Object.create(GT.prototype),$A.prototype.constructor=$A,$A.prototype.nodeType="Bump",$A.prototype.generate=function(e,t){e.material;var r=$A.fBumpToNormal;return e.include(r),e.isShader("fragment")?e.format(r.name+"("+this.value.build(e,"sampler2D")+","+this.coord.build(e,"v2")+","+this.scale.build(e,"v2")+")",this.getType(e),t):(console.warn("BumpNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t))},$A.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.coord=this.coord.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t};var eE=function(e,t,r){GT.call(this,"v3"),this.rgb=e,this.adjustment=t,this.method=r||eE.SATURATION};eE.SATURATION="saturation",eE.HUE="hue",eE.VIBRANCE="vibrance",eE.BRIGHTNESS="brightness",eE.CONTRAST="contrast",eE.prototype=Object.create(GT.prototype),eE.prototype.constructor=eE,eE.prototype.nodeType="ColorAdjustment",eE.prototype.generate=function(e,t){var r,n=this.rgb.build(e,"v3"),i=this.adjustment.build(e,"fv1");switch(this.method){case eE.SATURATION:r="saturation_rgb";break;case eE.HUE:r="hue_rgb";break;case eE.VIBRANCE:r="vibrance_rgb";break;case eE.BRIGHTNESS:return e.format("("+n+"+"+i+")",this.getType(e),t);case eE.CONTRAST:return e.format("("+n+"*"+i+")",this.getType(e),t)}return e.include(r),e.format(r+"("+n+","+i+")",this.getType(e),t)},eE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid,t.adjustment=this.adjustment.toJSON(e).uuid,t.method=this.method),t};var tE=function(e,t,r,n){GT.call(this,"fv1"),this.x=e,this.y=t,this.z=r,this.w=n};tE.inputs=["x","y","z","w"],tE.prototype=Object.create(GT.prototype),tE.prototype.constructor=tE,tE.prototype.nodeType="Join",tE.prototype.getNumElements=function(){for(var e=tE.inputs,t=e.length;t--;)if(void 0!==this[e[t]]){++t;break}return Math.max(t,2)},tE.prototype.getType=function(e){return e.getFormatFromLength(this.getNumElements())},tE.prototype.generate=function(e,t){e.material;for(var r=this.getType(e),n=this.getNumElements(),i=tE.inputs,o=[],s=0;s<n;s++){var a=this[i[s]];o.push(a?a.build(e,"fv1"):"0.")}var l=(n>1?e.getConstructorFromLength(n):"")+"("+o.join(",")+")";return e.format(l,r,t)},tE.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).inputs={};for(var r=this.getNumElements(),n=tE.inputs,i=0;i<r;i++){var o=this[n[i]];o&&(t.inputs[n[i]]=o.toJSON(e).uuid)}}return t};var rE=function(e){GT.call(this,"fv1"),this.rgb=e};rE.prototype=Object.create(GT.prototype),rE.prototype.constructor=rE,rE.prototype.nodeType="Luminance",rE.prototype.generate=function(e,t){return e.include("luminance_rgb"),e.format("luminance_rgb("+this.rgb.build(e,"v3")+")",this.getType(e),t)},rE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid),t};var nE=function(e){GT.call(this,"fv1"),this.coord=e};nE.prototype=Object.create(GT.prototype),nE.prototype.constructor=nE,nE.prototype.nodeType="Noise",nE.prototype.generate=function(e,t){return e.include("snoise"),e.format("snoise("+this.coord.build(e,"v2")+")",this.getType(e),t)},nE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).coord=this.coord.toJSON(e).uuid),t};var iE=function(e,t,r,n,i){GT.call(this,"v3"),this.value=e,this.scale=r||new ZT(1),this.normal=n||new YT(YT.LOCAL),this.position=i||new qT(YT.VIEW)};iE.prototype=Object.create(GT.prototype),iE.prototype.constructor=iE,iE.prototype.nodeType="NormalMap",iE.prototype.generate=function(e,t){e.material;return e.include("perturbNormal2Arb"),e.isShader("fragment")?e.format("perturbNormal2Arb(-"+this.position.build(e,"v3")+","+this.normal.build(e,"v3")+","+this.value.build(e,"v3")+","+this.value.coord.build(e,"v2")+","+this.scale.build(e,"v2")+")",this.getType(e),t):(console.warn("NormalMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t))},iE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.uuid,t.scale=this.scale.toJSON(e).uuid,t.normal=this.normal.toJSON(e).uuid,t.position=this.position.toJSON(e).uuid),t};var oE=function(e){RA.call(this),this.renderer=e};oE.prototype=Object.create(RA.prototype),oE.prototype.constructor=oE,oE.prototype.nodeType="Resolution",oE.prototype.updateFrame=function(e){var t=this.renderer.getSize(),r=this.renderer.getPixelRatio();this.x=t.width*r,this.y=t.height*r},oE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).renderer=this.renderer.uuid),t};var sE=function(e,t){VT.call(this),this.node=e,this.components=t||"x"};sE.prototype=Object.create(VT.prototype),sE.prototype.constructor=sE,sE.prototype.nodeType="Switch",sE.prototype.getType=function(e){return e.getFormatFromLength(this.components.length)},sE.prototype.generate=function(e,t){var r=this.node.getType(e),n=e.getFormatLength(r)-1,i=this.node.build(e,r);if(n>0){var o,s=0,a=e.colorToVector(this.components),l=a.length;for(o=0;o<l;o++)s=Math.max(s,e.getIndexByElement(a.charAt(o)));for(s>n&&(s=n),i+=".",o=0;o<l;o++){a.charAt(o);var c=e.getIndexByElement(a.charAt(o));c>s&&(c=s),i+=e.getElementByIndex(c)}return e.format(i,this.getType(e),t)}return e.format(i,r,t)},sE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).node=this.node.toJSON(e).uuid,t.components=this.components),t};var aE=function(){HT.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=new XT,this.transform=new PA};aE.prototype=Object.create(HT.prototype),aE.prototype.constructor=aE,aE.prototype.nodeType="UVTransform",aE.prototype.generate=function(e,t){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.transform,HT.prototype.generate.call(this,e,t)},aE.prototype.setUvTransform=function(e,t,r,n,i,o,s){o=void 0!==o?o:.5,s=void 0!==s?s:.5,this.transform.value.setUvTransform(e,t,r,n,i,o,s)},aE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid,t.transform=this.transform.toJSON(e).uuid),t};var lE=function(e,t){FA.call(this),this.params={},this.velocity=new Kg,this.setTarget(e),this.setParams(t)};lE.prototype=Object.create(FA.prototype),lE.prototype.constructor=lE,lE.prototype.nodeType="Velocity",lE.prototype.isReadonly=function(e){return!1},lE.prototype.setParams=function(e){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=e||{},this.params.type){case"elastic":this.moment=new Kg,this.speed=new Kg,this.springVelocity=new Kg,this.lastVelocity=new Kg}},lE.prototype.setTarget=function(e){this.target&&(delete this.position,delete this.oldPosition),this.target=e,e&&(this.position=e.getWorldPosition(),this.oldPosition=this.position.clone())},lE.prototype.updateFrameVelocity=function(e){this.target&&(this.position=this.target.getWorldPosition(),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},lE.prototype.updateFrame=function(e){switch(this.updateFrameVelocity(e),this.params.type){case"elastic":var t=e.delta*(this.params.fps||60),r=Math.pow(this.params.spring,t),n=Math.pow(this.params.damping,t);this.velocity.multiplyScalar(Math.exp(-this.params.damping*t)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(n).multiplyScalar(1-r)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(r),this.moment.add(this.springVelocity),this.moment.multiplyScalar(n),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},lE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.target&&(t.target=this.target.uuid),t.params=JSON.parse(JSON.stringify(this.params))),t};var cE=function(e){VT.call(this,e)};function uE(e,t){this.min=void 0!==e?e:new hy(1/0,1/0),this.max=void 0!==t?t:new hy(-1/0,-1/0)}cE.prototype=Object.create(VT.prototype),cE.prototype.constructor=cE,cE.prototype.nodeType="Var",cE.prototype.getType=function(e){return e.getTypeByFormat(this.type)},cE.prototype.generate=function(e,t){var r=e.material.getVar(this.uuid,this.type);return e.format(r.name,this.getType(e),t)},cE.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).out=this.type),t},Object.assign(uE.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new hy;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("Box2: .getCenter() target is now required"),e=new hy),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("Box2: .getSize() target is now required"),e=new hy),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("Box2: .getParameter() target is now required"),t=new hy),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("Box2: .clampPoint() target is now required"),t=new hy),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new hy;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var hE=function(){Mb.call(this,hE.Geometry,new xb({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var e=new Kg,t=new K_(new Uint8Array(768),16,16,Gx);t.minFilter=Cx,t.magFilter=Cx,t.wrapS=Ax,t.wrapT=Ax,t.needsUpdate=!0;var r=new K_(new Uint8Array(768),16,16,Gx);r.minFilter=Cx,r.magFilter=Cx,r.wrapS=Ax,r.wrapT=Ax,r.needsUpdate=!0;var n=hE.Geometry,i=new Mw({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),o=new Mw({uniforms:{map:{value:t},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),s=new Mb(n,i),a=[],l=dE.Shader,c=new Mw({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new ay(16777215)},scale:{value:new hy},screenPosition:{value:new Kg}},vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:Gy,transparent:!0,depthWrite:!1}),u=new Mb(n,c);this.addElement=function(e){a.push(e)};var h=new hy,d=new hy,p=new uE,f=new fy;this.onBeforeRender=function(l,m,v){f.copy(l.getCurrentViewport());var g=f.w/f.z,y=f.z/2,x=f.w/2,b=16/f.w;if(h.set(b*g,b),p.min.set(f.x,f.y),p.max.set(f.x+(f.z-16),f.y+(f.w-16)),e.setFromMatrixPosition(this.matrixWorld),e.applyMatrix4(v.matrixWorldInverse),e.applyMatrix4(v.projectionMatrix),d.x=f.x+e.x*y+y-8,d.y=f.y+e.y*x+x-8,p.containsPoint(d)){l.copyFramebufferToTexture(d,t),(M=i.uniforms).scale.value=h,M.screenPosition.value=e,l.renderBufferDirect(v,null,n,i,s,null),l.copyFramebufferToTexture(d,r),(M=o.uniforms).scale.value=h,M.screenPosition.value=e,l.renderBufferDirect(v,null,n,o,s,null);for(var w=2*-e.x,_=2*-e.y,S=0,T=a.length;S<T;S++){var M,A=a[S];(M=c.uniforms).color.value.copy(A.color),M.map.value=A.texture,M.screenPosition.value.x=e.x+w*A.distance,M.screenPosition.value.y=e.y+_*A.distance;b=A.size/f.w,g=f.w/f.z;M.scale.value.set(b*g,b),c.uniformsNeedUpdate=!0,l.renderBufferDirect(v,null,n,c,u,null)}}},this.dispose=function(){i.dispose(),o.dispose(),c.dispose(),t.dispose(),r.dispose();for(var e=0,n=a.length;e<n;e++)a[e].texture.dispose()}};hE.prototype=Object.create(Mb.prototype),hE.prototype.constructor=hE,hE.prototype.isLensflare=!0;var dE=function(e,t,r,n){this.texture=e,this.size=t||1,this.distance=r||0,this.color=n||new ay(16777215)};dE.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},hE.Geometry=function(){var e=new Cy,t=new iS(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5);return e.setIndex([0,1,2,0,2,3]),e.addAttribute("position",new sS(t,3,0,!1)),e.addAttribute("uv",new sS(t,2,3,!1)),e}();var pE=function(e,t){Mb.call(this,e),this.type="Reflector";var r=this,n=void 0!==(t=t||{}).color?new ay(t.color):new ay(8355711),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,a=t.shader||pE.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,c=new Sb,u=new Kg,h=new Kg,d=new Kg,p=new Qg,f=new Kg(0,0,-1),m=new fy,v=new fy,g=new Kg,y=new Kg,x=new fy,b=new Qg,w=new Kb,_=new iw(i,o,{minFilter:Dx,magFilter:Dx,format:Gx,stencilBuffer:!1});Zg.isPowerOfTwo(i)&&Zg.isPowerOfTwo(o)||(_.texture.generateMipmaps=!1);var S=new sw({uniforms:ow.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});S.uniforms.tDiffuse.value=_.texture,S.uniforms.color.value=n,S.uniforms.textureMatrix.value=b,this.material=S,this.onBeforeRender=function(e,t,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),p.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(p),g.subVectors(h,d),!(g.dot(u)>0)){g.reflect(u).negate(),g.add(h),p.extractRotation(n.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),y.subVectors(h,f),y.reflect(u).negate(),y.add(h),w.position.copy(g),w.up.set(0,1,0),w.up.applyMatrix4(p),w.up.reflect(u),w.lookAt(y),w.far=n.far,w.updateMatrixWorld(),w.projectionMatrix.copy(n.projectionMatrix),w.userData.recursion=0,b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(w.projectionMatrix),b.multiply(w.matrixWorldInverse),b.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(w.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var i=w.projectionMatrix;x.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],x.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],x.z=-1,x.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(x)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-s,i.elements[14]=m.w,r.visible=!1;var o=e.getRenderTarget(),a=e.vr.enabled,S=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,w,_,!0),e.vr.enabled=a,e.shadowMap.autoUpdate=S,e.setRenderTarget(o);var T=n.bounds;if(void 0!==T){var M=e.getSize(),A=e.getPixelRatio();v.x=T.x*M.width*A,v.y=T.y*M.height*A,v.z=T.z*M.width*A,v.w=T.w*M.height*A,e.state.viewport(v)}r.visible=!0}},this.getRenderTarget=function(){return _}};pE.prototype=Object.create(Mb.prototype),pE.prototype.constructor=pE,pE.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};(function(e,t){pE.call(this,e,t),this.geometry.setDrawRange(0,0),this.renderOrder=-1/0}).prototype=Object.create(pE.prototype);var fE=function(e,t){Mb.call(this,e),this.type="Refractor";var r=this,n=void 0!==(t=t||{}).color?new ay(t.color):new ay(8355711),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,a=t.shader||fE.RefractorShader,l=new Kb;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var c=new Sb,u=new Qg,h=new iw(i,o,{minFilter:Dx,magFilter:Dx,format:Gx,stencilBuffer:!1});Zg.isPowerOfTwo(i)&&Zg.isPowerOfTwo(o)||(h.texture.generateMipmaps=!1),this.material=new sw({uniforms:ow.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=h.texture,this.material.uniforms.textureMatrix.value=u;var d=function(){var e=new Kg,t=new Kg,n=new Qg,i=new Kg,o=new Kg;return function(s){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(s.matrixWorld),i.subVectors(e,t),n.extractRotation(r.matrixWorld),o.set(0,0,1),o.applyMatrix4(n),i.dot(o)<0}}(),p=function(){var e=new Kg,t=new Kg,n=new $g,i=new Kg;return function(){r.matrixWorld.decompose(t,n,i),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),c.setFromNormalAndCoplanarPoint(e,t)}}(),f=function(){var e=new Sb,t=new fy,r=new fy;return function(n){l.matrixWorld.copy(n.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(n.projectionMatrix),l.far=n.far,e.copy(c),e.applyMatrix4(l.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var i=l.projectionMatrix;r.x=(Math.sign(t.x)+i.elements[8])/i.elements[0],r.y=(Math.sign(t.y)+i.elements[9])/i.elements[5],r.z=-1,r.w=(1+i.elements[10])/i.elements[14],t.multiplyScalar(2/t.dot(r)),i.elements[2]=t.x,i.elements[6]=t.y,i.elements[10]=t.z+1-s,i.elements[14]=t.w}}();var m=function(){var e=new fy;return function(t,n,i){r.visible=!1;var o=t.getRenderTarget(),s=t.vr.enabled,a=t.shadowMap.autoUpdate;t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(n,l,h,!0),t.vr.enabled=s,t.shadowMap.autoUpdate=a,t.setRenderTarget(o);var c=i.bounds;if(void 0!==c){var u=t.getSize(),d=t.getPixelRatio();e.x=c.x*u.width*d,e.y=c.y*u.height*d,e.z=c.z*u.width*d,e.w=c.w*u.height*d,t.state.viewport(e)}r.visible=!0}}();this.onBeforeRender=function(e,t,n){!0!==n.userData.refractor&&!0!=!d(n)&&(p(),function(e){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(e.projectionMatrix),u.multiply(e.matrixWorldInverse),u.multiply(r.matrixWorld)}(n),f(n),m(e,t,n))},this.getRenderTarget=function(){return h}};fE.prototype=Object.create(Mb.prototype),fE.prototype.constructor=fE,fE.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var mE=function(e){var t=new xb({color:0,transparent:!0,opacity:.6,depthWrite:!1});Mb.call(this,e.geometry,t),this.meshMatrix=e.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1};mE.prototype=Object.create(Mb.prototype),mE.prototype.constructor=mE,mE.prototype.update=function(){var e=new Qg;return function(t,r){var n=t.normal.x*r.x+t.normal.y*r.y+t.normal.z*r.z+-t.constant*r.w,i=e.elements;i[0]=n-r.x*t.normal.x,i[4]=-r.x*t.normal.y,i[8]=-r.x*t.normal.z,i[12]=-r.x*-t.constant,i[1]=-r.y*t.normal.x,i[5]=n-r.y*t.normal.y,i[9]=-r.y*t.normal.z,i[13]=-r.y*-t.constant,i[2]=-r.z*t.normal.x,i[6]=-r.z*t.normal.y,i[10]=n-r.z*t.normal.z,i[14]=-r.z*-t.constant,i[3]=-r.w*t.normal.x,i[7]=-r.w*t.normal.y,i[11]=-r.w*t.normal.z,i[15]=n-r.w*-t.constant,this.matrix.multiplyMatrices(e,this.meshMatrix)}}();var vE=function(){var e=vE.SkyShader,t=new sw({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:ow.clone(e.uniforms),side:Fy});Mb.call(this,new Db(1,1,1),t)};vE.prototype=Object.create(Mb.prototype),vE.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Kg}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var gE=function(e,t){Mb.call(this,e);var r=this,n=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,i=void 0!==t.textureHeight?t.textureHeight:512,o=void 0!==t.clipBias?t.clipBias:0,s=void 0!==t.alpha?t.alpha:1,a=void 0!==t.time?t.time:0,l=void 0!==t.waterNormals?t.waterNormals:null,c=void 0!==t.sunDirection?t.sunDirection:new Kg(.70707,.70707,0),u=new ay(void 0!==t.sunColor?t.sunColor:16777215),h=new ay(void 0!==t.waterColor?t.waterColor:8355711),d=void 0!==t.eye?t.eye:new Kg(0,0,0),p=void 0!==t.distortionScale?t.distortionScale:20,f=void 0!==t.side?t.side:Ry,m=void 0!==t.fog&&t.fog,v=new Sb,g=new Kg,y=new Kg,x=new Kg,b=new Qg,w=new Kg(0,0,-1),_=new fy,S=new Kg,T=new Kg,M=new fy,A=new Qg,E=new Kb,C=new iw(n,i,{minFilter:Dx,magFilter:Dx,format:Gx,stencilBuffer:!1});Zg.isPowerOfTwo(n)&&Zg.isPowerOfTwo(i)||(C.texture.generateMipmaps=!1);var P={uniforms:ow.merge([F_.fog,F_.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Qg},sunColor:{value:new ay(8355711)},sunDirection:{value:new Kg(.70707,.70707,0)},eye:{value:new Kg},waterColor:{value:new ay(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",R_.fog_pars_vertex,R_.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",R_.fog_vertex,R_.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",R_.common,R_.packing,R_.bsdfs,R_.fog_pars_fragment,R_.lights_pars_begin,R_.shadowmap_pars_fragment,R_.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",R_.tonemapping_fragment,R_.fog_fragment,"}"].join("\n")},O=new sw({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:ow.clone(P.uniforms),transparent:!0,lights:!0,side:f,fog:m});O.uniforms.mirrorSampler.value=C.texture,O.uniforms.textureMatrix.value=A,O.uniforms.alpha.value=s,O.uniforms.time.value=a,O.uniforms.normalSampler.value=l,O.uniforms.sunColor.value=u,O.uniforms.waterColor.value=h,O.uniforms.sunDirection.value=c,O.uniforms.distortionScale.value=p,O.uniforms.eye.value=d,r.material=O,r.onBeforeRender=function(e,t,n){if(y.setFromMatrixPosition(r.matrixWorld),x.setFromMatrixPosition(n.matrixWorld),b.extractRotation(r.matrixWorld),g.set(0,0,1),g.applyMatrix4(b),S.subVectors(y,x),!(S.dot(g)>0)){S.reflect(g).negate(),S.add(y),b.extractRotation(n.matrixWorld),w.set(0,0,-1),w.applyMatrix4(b),w.add(x),T.subVectors(y,w),T.reflect(g).negate(),T.add(y),E.position.copy(S),E.up.set(0,1,0),E.up.applyMatrix4(b),E.up.reflect(g),E.lookAt(T),E.far=n.far,E.updateMatrixWorld(),E.projectionMatrix.copy(n.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(E.projectionMatrix),A.multiply(E.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(g,y),v.applyMatrix4(E.matrixWorldInverse),_.set(v.normal.x,v.normal.y,v.normal.z,v.constant);var i=E.projectionMatrix;M.x=(Math.sign(_.x)+i.elements[8])/i.elements[0],M.y=(Math.sign(_.y)+i.elements[9])/i.elements[5],M.z=-1,M.w=(1+i.elements[10])/i.elements[14],_.multiplyScalar(2/_.dot(M)),i.elements[2]=_.x,i.elements[6]=_.y,i.elements[10]=_.z+1-o,i.elements[14]=_.w,d.setFromMatrixPosition(n.matrixWorld);var s=e.getRenderTarget(),a=e.vr.enabled,l=e.shadowMap.autoUpdate;r.visible=!1,e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,E,C,!0),r.visible=!0,e.vr.enabled=a,e.shadowMap.autoUpdate=l,e.setRenderTarget(s)}}};function yE(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function xE(e,t){Mb.call(this,e),this.type="Water2";var r=this,n=void 0!==(t=t||{}).color?new ay(t.color):new ay(16777215),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,a=t.flowDirection||new hy(1,0),l=t.flowSpeed||.03,c=t.reflectivity||.02,u=t.scale||1,h=t.shader||xE.Water2Shader,d=new Ow,p=t.flowMap||void 0,f=t.normalMap0||d.load("textures/water/Water2_1_M_Normal.jpg"),m=t.normalMap1||d.load("textures/water/Water2_2_M_Normal.jpg"),v=.15,g=.5*v,y=new Qg,x=new yE;if(void 0!==pE)if(void 0!==fE){var b=new pE(e,{textureWidth:i,textureHeight:o,clipBias:s}),w=new fE(e,{textureWidth:i,textureHeight:o,clipBias:s});b.matrixAutoUpdate=!1,w.matrixAutoUpdate=!1,this.material=new sw({uniforms:ow.merge([F_.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==p?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:p}):this.material.uniforms.flowDirection={type:"v2",value:a},f.wrapS=f.wrapT=Mx,m.wrapS=m.wrapT=Mx,this.material.uniforms.tReflectionMap.value=b.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=w.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=n,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=y,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=g,this.material.uniforms.config.value.z=g,this.material.uniforms.config.value.w=u,this.onBeforeRender=function(e,t,n){!function(e){y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(e.projectionMatrix),y.multiply(e.matrixWorldInverse),y.multiply(r.matrixWorld)}(n),function(){var e=x.getDelta(),t=r.material.uniforms.config;t.value.x+=l*e,t.value.y=t.value.x+g,t.value.x>=v?(t.value.x=0,t.value.y=g):t.value.y>=v&&(t.value.y=t.value.y-v)}(),r.visible=!1,b.matrixWorld.copy(r.matrixWorld),w.matrixWorld.copy(r.matrixWorld),b.onBeforeRender(e,t,n),w.onBeforeRender(e,t,n),r.visible=!0}}else console.error("Water2: Required component Refractor not found.");else console.error("Water2: Required component Reflector not found.")}gE.prototype=Object.create(Mb.prototype),gE.prototype.constructor=gE,Object.assign(yE.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),xE.prototype=Object.create(Mb.prototype),xE.prototype.constructor=xE,xE.Water2Shader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new fy}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")};var bE=function(e,t,r,n){function i(e,t){return void 0!==e?e:t}this.changed=!0,this.initial=!0,this.oceanCamera=new tw,this.oceanCamera.position.z=1,this.renderer=e,this.renderer.clearColor(16777215),this.scene=new ew,n=n||{},this.clearColor=i(n.CLEAR_COLOR,[1,1,1,0]),this.geometryOrigin=i(n.GEOMETRY_ORIGIN,[-1e3,-1e3]),this.sunDirectionX=i(n.SUN_DIRECTION[0],-1),this.sunDirectionY=i(n.SUN_DIRECTION[1],1),this.sunDirectionZ=i(n.SUN_DIRECTION[2],1),this.oceanColor=i(n.OCEAN_COLOR,new Kg(.004,.016,.047)),this.skyColor=i(n.SKY_COLOR,new Kg(3.2,9.6,12.8)),this.exposure=i(n.EXPOSURE,.35),this.geometryResolution=i(n.GEOMETRY_RESOLUTION,32),this.geometrySize=i(n.GEOMETRY_SIZE,2e3),this.resolution=i(n.RESOLUTION,64),this.floatSize=i(n.SIZE_OF_FLOAT,4),this.windX=i(n.INITIAL_WIND[0],10),this.windY=i(n.INITIAL_WIND[1],10),this.size=i(n.INITIAL_SIZE,250),this.choppiness=i(n.INITIAL_CHOPPINESS,1.5),this.matrixNeedsUpdate=!1;var o=i(n.USE_HALF_FLOAT,!1)?kx:Fx,s={minFilter:Dx,magFilter:Dx,wrapS:Ax,wrapT:Ax,format:Hx,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o},a={minFilter:Cx,magFilter:Cx,wrapS:Ax,wrapT:Ax,format:Hx,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o},l={minFilter:Cx,magFilter:Cx,wrapS:Mx,wrapT:Mx,format:Hx,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o};this.initialSpectrumFramebuffer=new iw(this.resolution,this.resolution,l),this.spectrumFramebuffer=new iw(this.resolution,this.resolution,a),this.pingPhaseFramebuffer=new iw(this.resolution,this.resolution,a),this.pongPhaseFramebuffer=new iw(this.resolution,this.resolution,a),this.pingTransformFramebuffer=new iw(this.resolution,this.resolution,a),this.pongTransformFramebuffer=new iw(this.resolution,this.resolution,a),this.displacementMapFramebuffer=new iw(this.resolution,this.resolution,s),this.normalMapFramebuffer=new iw(this.resolution,this.resolution,s);var c=k_.ocean_sim_vertex,u=k_.ocean_subtransform,h=ow.clone(u.uniforms);this.materialOceanHorizontal=new sw({uniforms:h,vertexShader:c.vertexShader,fragmentShader:"#define HORIZONTAL \n"+u.fragmentShader}),this.materialOceanHorizontal.uniforms.u_transformSize={value:this.resolution},this.materialOceanHorizontal.uniforms.u_subtransformSize={value:null},this.materialOceanHorizontal.uniforms.u_input={value:null},this.materialOceanHorizontal.depthTest=!1;var d=k_.ocean_subtransform,p=ow.clone(d.uniforms);this.materialOceanVertical=new sw({uniforms:p,vertexShader:c.vertexShader,fragmentShader:d.fragmentShader}),this.materialOceanVertical.uniforms.u_transformSize={value:this.resolution},this.materialOceanVertical.uniforms.u_subtransformSize={value:null},this.materialOceanVertical.uniforms.u_input={value:null},this.materialOceanVertical.depthTest=!1;var f=k_.ocean_initial_spectrum,m=ow.clone(f.uniforms);this.materialInitialSpectrum=new sw({uniforms:m,vertexShader:c.vertexShader,fragmentShader:f.fragmentShader}),this.materialInitialSpectrum.uniforms.u_wind={value:new hy},this.materialInitialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialInitialSpectrum.depthTest=!1;var v=k_.ocean_phase,g=ow.clone(v.uniforms);this.materialPhase=new sw({uniforms:g,vertexShader:c.vertexShader,fragmentShader:v.fragmentShader}),this.materialPhase.uniforms.u_resolution={value:this.resolution},this.materialPhase.depthTest=!1;var y=k_.ocean_spectrum,x=ow.clone(y.uniforms);this.materialSpectrum=new sw({uniforms:x,vertexShader:c.vertexShader,fragmentShader:y.fragmentShader}),this.materialSpectrum.uniforms.u_initialSpectrum={value:null},this.materialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialSpectrum.depthTest=!1;var b=k_.ocean_normals,w=ow.clone(b.uniforms);this.materialNormal=new sw({uniforms:w,vertexShader:c.vertexShader,fragmentShader:b.fragmentShader}),this.materialNormal.uniforms.u_displacementMap={value:null},this.materialNormal.uniforms.u_resolution={value:this.resolution},this.materialNormal.depthTest=!1;var _=k_.ocean_main,S=ow.clone(_.uniforms);this.materialOcean=new sw({uniforms:S,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader}),this.materialOcean.uniforms.u_geometrySize={value:this.resolution},this.materialOcean.uniforms.u_displacementMap={value:this.displacementMapFramebuffer.texture},this.materialOcean.uniforms.u_normalMap={value:this.normalMapFramebuffer.texture},this.materialOcean.uniforms.u_oceanColor={value:this.oceanColor},this.materialOcean.uniforms.u_skyColor={value:this.skyColor},this.materialOcean.uniforms.u_sunDirection={value:new Kg(this.sunDirectionX,this.sunDirectionY,this.sunDirectionZ)},this.materialOcean.uniforms.u_exposure={value:this.exposure},this.materialOceanHorizontal.blending=0,this.materialOceanVertical.blending=0,this.materialInitialSpectrum.blending=0,this.materialPhase.blending=0,this.materialSpectrum.blending=0,this.materialNormal.blending=0,this.materialOcean.blending=0,this.screenQuad=new Mb(new lw(2,2)),this.scene.add(this.screenQuad),this.generateSeedPhaseTexture(),this.generateMesh()};function wE(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new Cy;i.setIndex(new my(r,1)),i.addAttribute("position",new my(n,3)),FS.call(this,i,new bb({color:t})),this.matrixAutoUpdate=!1,this.update()}function _E(e){return!isNaN(e)&&isFinite(e)}function SE(e){return e?!0!==function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e)?[e]:e:[]}function TE(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}bE.prototype.generateMesh=function(){var e=new lw(this.geometrySize,this.geometrySize,this.geometryResolution,this.geometryResolution);e.rotateX(-Math.PI/2),this.oceanMesh=new Mb(e,this.materialOcean)},bE.prototype.render=function(){this.scene.overrideMaterial=null,this.changed&&this.renderInitialSpectrum(),this.renderWavePhase(),this.renderSpectrum(),this.renderSpectrumFFT(),this.renderNormalMap(),this.scene.overrideMaterial=null},bE.prototype.generateSeedPhaseTexture=function(){this.pingPhase=!0;for(var e=new window.Float32Array(this.resolution*this.resolution*4),t=0;t<this.resolution;t++)for(var r=0;r<this.resolution;r++)e[t*this.resolution*4+4*r]=2*Math.random()*Math.PI,e[t*this.resolution*4+4*r+1]=0,e[t*this.resolution*4+4*r+2]=0,e[t*this.resolution*4+4*r+3]=0;this.pingPhaseTexture=new K_(e,this.resolution,this.resolution,Hx),this.pingPhaseTexture.wrapS=Ax,this.pingPhaseTexture.wrapT=Ax,this.pingPhaseTexture.type=Fx,this.pingPhaseTexture.needsUpdate=!0},bE.prototype.renderInitialSpectrum=function(){this.scene.overrideMaterial=this.materialInitialSpectrum,this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX,this.windY),this.materialInitialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.initialSpectrumFramebuffer,!0)},bE.prototype.renderWavePhase=function(){this.scene.overrideMaterial=this.materialPhase,this.screenQuad.material=this.materialPhase,this.initial?(this.materialPhase.uniforms.u_phases.value=this.pingPhaseTexture,this.initial=!1):this.materialPhase.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialPhase.uniforms.u_deltaTime.value=this.deltaTime,this.materialPhase.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.pingPhase?this.pongPhaseFramebuffer:this.pingPhaseFramebuffer),this.pingPhase=!this.pingPhase},bE.prototype.renderSpectrum=function(){this.scene.overrideMaterial=this.materialSpectrum,this.materialSpectrum.uniforms.u_initialSpectrum.value=this.initialSpectrumFramebuffer.texture,this.materialSpectrum.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialSpectrum.uniforms.u_choppiness.value=this.choppiness,this.materialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.spectrumFramebuffer)},bE.prototype.renderSpectrumFFT=function(){var e=Math.log(this.resolution)/Math.log(2);this.scene.overrideMaterial=this.materialOceanHorizontal;for(var t=0;t<e;t++)0===t?(this.materialOceanHorizontal.uniforms.u_input.value=this.spectrumFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer)):t%2==1?(this.materialOceanHorizontal.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanHorizontal.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer));this.scene.overrideMaterial=this.materialOceanVertical;for(t=e;t<2*e;t++)t===2*e-1?(this.materialOceanVertical.uniforms.u_input.value=e%2==0?this.pingTransformFramebuffer.texture:this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.render(this.scene,this.oceanCamera,this.displacementMapFramebuffer)):t%2==1?(this.materialOceanVertical.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanVertical.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer))},bE.prototype.renderNormalMap=function(){this.scene.overrideMaterial=this.materialNormal,this.changed&&(this.materialNormal.uniforms.u_size.value=this.size),this.materialNormal.uniforms.u_displacementMap.value=this.displacementMapFramebuffer.texture,this.renderer.render(this.scene,this.oceanCamera,this.normalMapFramebuffer,!0)},wE.prototype=Object.create(FS.prototype),wE.prototype.constructor=wE,wE.prototype.update=function(){var e=new cy;return function(t){if(void 0!==t&&console.warn("BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,n=e.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),wE.prototype.setFromObject=function(e){return this.object=e,this.update(),this};var ME=function(e){if((e=e||{}).tree=this,this.nodeCount=0,this.INDEX_INSIDE_CROSS=-1,this.INDEX_OUTSIDE_OFFSET=2,this.INDEX_OUTSIDE_POS_X=_E(e.INDEX_OUTSIDE_POS_X)?e.INDEX_OUTSIDE_POS_X:0,this.INDEX_OUTSIDE_NEG_X=_E(e.INDEX_OUTSIDE_NEG_X)?e.INDEX_OUTSIDE_NEG_X:1,this.INDEX_OUTSIDE_POS_Y=_E(e.INDEX_OUTSIDE_POS_Y)?e.INDEX_OUTSIDE_POS_Y:2,this.INDEX_OUTSIDE_NEG_Y=_E(e.INDEX_OUTSIDE_NEG_Y)?e.INDEX_OUTSIDE_NEG_Y:3,this.INDEX_OUTSIDE_POS_Z=_E(e.INDEX_OUTSIDE_POS_Z)?e.INDEX_OUTSIDE_POS_Z:4,this.INDEX_OUTSIDE_NEG_Z=_E(e.INDEX_OUTSIDE_NEG_Z)?e.INDEX_OUTSIDE_NEG_Z:5,this.INDEX_OUTSIDE_MAP=[],this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1},this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1,this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1,this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1,this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1,this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1,this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1,this.utilVec31Search=new Kg,this.utilVec32Search=new Kg,this.scene=e.scene,this.scene){var t=new wE(new Mb(new Ob(1,1,1)),16711782);this.visualGeometry=t.geometry,this.visualMaterial=t.material}this.objects=[],this.objectsMap={},this.objectsData=[],this.objectsDeferred=[],this.depthMax=_E(e.depthMax)?e.depthMax:1/0,this.objectsThreshold=_E(e.objectsThreshold)?e.objectsThreshold:8,this.overlapPct=_E(e.overlapPct)?e.overlapPct:.15,this.undeferred=e.undeferred||!1,this.root=e.root instanceof EE?e.root:new EE(e)};ME.prototype={update:function(){if(this.objectsDeferred.length>0){for(var e=0,t=this.objectsDeferred.length;e<t;e++){var r=this.objectsDeferred[e];this.addDeferred(r.object,r.options)}this.objectsDeferred.length=0}},add:function(e,t){this.undeferred?(this.updateObject(e),this.addDeferred(e,t)):this.objectsDeferred.push({object:e,options:t})},addDeferred:function(e,t){var r,n,i,o,s,a;if(e instanceof AE&&(e=e.object),e.uuid||(e.uuid=Zg.generateUUID()),!this.objectsMap[e.uuid])if(this.objects.push(e),this.objectsMap[e.uuid]=e,t&&(o=t.useFaces,a=t.useVertices),!0===a)for(r=0,n=(s=e.geometry.vertices).length;r<n;r++)this.addObjectData(e,s[r]);else if(!0===o)for(r=0,n=(i=e.geometry.faces).length;r<n;r++)this.addObjectData(e,i[r]);else this.addObjectData(e)},addObjectData:function(e,t){var r=new AE(e,t);this.objectsData.push(r),this.root.addObject(r)},remove:function(e){var t,r,n,i,o=e;if(e instanceof AE&&(e=e.object),this.objectsMap[e.uuid]){if(this.objectsMap[e.uuid]=void 0,-1!==(n=TE(this.objects,e)))for(this.objects.splice(n,1),t=0,r=(i=this.root.removeObject(o)).length;t<r;t++)o=i[t],-1!==(n=TE(this.objectsData,o))&&this.objectsData.splice(n,1)}else this.objectsDeferred.length>0&&-1!==(n=function(e,t,r){for(var n=0,i=e.length;n<i;n++)if(e[n][t]===r)return n;return-1}(this.objectsDeferred,"object",e))&&this.objectsDeferred.splice(n,1)},extend:function(e){var t,r,n,i;if(e instanceof ME)for(t=0,r=(n=e.objectsData).length;t<r;t++)i=n[t],this.add(i,{useFaces:i.faces,useVertices:i.vertices})},rebuild:function(){var e,t,r,n,i,o=[];for(e=0,t=this.objectsData.length;e<t;e++)r=(n=this.objectsData[e]).node,n.update(),r instanceof EE&&!n.positionLast.equals(n.position)&&(i=n.indexOctant,r.getOctantIndex(n)!==i&&o.push(n));for(e=0,t=o.length;e<t;e++)(n=o[e]).node.removeObject(n),this.root.addObject(n)},updateObject:function(e){var t,r,n,i,o=[e];for(n=e.parent;n;)o.push(n),n=n.parent;for(t=0,r=o.length;t<r;t++)!0===(n=o[t]).matrixWorldNeedsUpdate&&(i=n);void 0!==i&&i.updateMatrixWorld()},search:function(e,t,r,n){var i,o,s,a,l,c,u,h,d,p;for(s=[].concat(this.root.objects),t>0||(t=Number.MAX_VALUE),n instanceof Kg&&(n=this.utilVec31Search.copy(n).normalize(),p=this.utilVec32Search.set(1,1,1).divide(n)),i=0,o=this.root.nodesIndices.length;i<o;i++)s=this.root.nodesByIndex[this.root.nodesIndices[i]].search(e,t,s,n,p);if(!0===r)for(c=[],h=[],i=0,o=s.length;i<o;i++)-1===(d=TE(h,l=(a=s[i]).object))?(u={object:l,faces:[],vertices:[]},c.push(u),h.push(l)):u=c[d],a.faces?u.faces.push(a.faces):a.vertices&&u.vertices.push(a.vertices);else c=s;return c},setRoot:function(e){e instanceof EE&&(this.root=e,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};var AE=function(e,t){this.object=e,t instanceof ly?(this.faces=t,this.face3=!0,this.utilVec31FaceBounds=new Kg):t instanceof Kg&&(this.vertices=t),this.radius=0,this.position=new Kg,this.object instanceof oy&&this.update(),this.positionLast=this.position.clone()};AE.prototype={update:function(){this.face3?(this.radius=this.getFace3BoundingRadius(this.object,this.faces),this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.vertices?(this.radius=this.object.material.size||1,this.position.copy(this.vertices).applyMatrix4(this.object.matrixWorld)):this.object.geometry?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius,this.position.copy(this.object.geometry.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):(this.radius=this.object.boundRadius,this.position.setFromMatrixPosition(this.object.matrixWorld)),this.radius=this.radius*Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)},getFace3BoundingRadius:function(e,t){void 0===t.centroid&&(t.centroid=new Kg);var r=(e.geometry||e).vertices,n=t.centroid,i=r[t.a],o=r[t.b],s=r[t.c],a=this.utilVec31FaceBounds;return n.addVectors(i,o).add(s).divideScalar(3),Math.max(a.subVectors(n,i).length(),a.subVectors(n,o).length(),a.subVectors(n,s).length())}};var EE=function(e){this.utilVec31Branch=new Kg,this.utilVec31Expand=new Kg,this.utilVec31Ray=new Kg,(e=e||{}).tree instanceof ME?this.tree=e.tree:e.parent instanceof EE!=!0&&(e.root=this,this.tree=new ME(e)),this.id=this.tree.nodeCount++,this.position=e.position instanceof Kg?e.position:new Kg,this.radius=e.radius>0?e.radius:1,this.indexOctant=e.indexOctant,this.depth=0,this.reset(),this.setParent(e.parent),this.overlap=this.radius*this.tree.overlapPct,this.radiusOverlap=this.radius+this.overlap,this.left=this.position.x-this.radiusOverlap,this.right=this.position.x+this.radiusOverlap,this.bottom=this.position.y-this.radiusOverlap,this.top=this.position.y+this.radiusOverlap,this.back=this.position.z-this.radiusOverlap,this.front=this.position.z+this.radiusOverlap,this.tree.scene&&(this.visual=new FS(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual))};EE.prototype={setParent:function(e){e!==this&&this.parent!==e&&(this.parent=e,this.updateProperties())},updateProperties:function(){var e,t;for(this.parent instanceof EE?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0,e=0,t=this.nodesIndices.length;e<t;e++)this.nodesByIndex[this.nodesIndices[e]].updateProperties()},reset:function(e,t){var r,n,i,o=this.nodesIndices||[],s=this.nodesByIndex;for(this.objects=[],this.nodesIndices=[],this.nodesByIndex={},r=0,n=o.length;r<n;r++)(i=s[o[r]]).setParent(void 0),!0===e&&i.reset(e,t);!0===t&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(e,t){e.indexOctant=t,-1===TE(this.nodesIndices,t)&&this.nodesIndices.push(t),this.nodesByIndex[t]=e,e.parent!==this&&e.setParent(this)},removeNode:function(e){var t,r;t=TE(this.nodesIndices,e),this.nodesIndices.splice(t,1),r=r||this.nodesByIndex[e],delete this.nodesByIndex[e],r.parent===this&&r.setParent(void 0)},addObject:function(e){var t;(t=this.getOctantIndex(e))>-1&&this.nodesIndices.length>0?this.branch(t).addObject(e):t<-1&&this.parent instanceof EE?this.parent.addObject(e):(-1===TE(this.objects,e)&&this.objects.push(e),e.node=this,this.checkGrow())},addObjectWithoutCheck:function(e){var t,r,n;for(t=0,r=e.length;t<r;t++)n=e[t],this.objects.push(n),n.node=this},removeObject:function(e){var t,r,n,i;if((n=(i=this.removeObjectRecursive(e,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]})).nodesRemovedFrom).length>0)for(t=0,r=n.length;t<r;t++)n[t].shrink();return i.objectsDataRemoved},removeObjectRecursive:function(e,t){var r,n,i,o,s=-1;if(e instanceof AE)-1!==(s=TE(this.objects,e))&&(this.objects.splice(s,1),e.node=void 0,t.objectsDataRemoved.push(e),t.searchComplete=o=!0);else for(r=this.objects.length-1;r>=0;r--)if((i=this.objects[r]).object===e&&(this.objects.splice(r,1),i.node=void 0,t.objectsDataRemoved.push(i),o=!0,!i.faces&&!i.vertices)){t.searchComplete=!0;break}if(!0===o&&t.nodesRemovedFrom.push(this),!0!==t.searchComplete)for(r=0,n=this.nodesIndices.length;r<n&&!0!==(t=this.nodesByIndex[this.nodesIndices[r]].removeObjectRecursive(e,t)).searchComplete;r++);return t},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&this.tree.objectsThreshold>0&&this.grow()},grow:function(){var e,t,r,n,i=[],o=[],s=[],a=[],l=[];for(r=0,n=this.objects.length;r<n;r++)t=this.objects[r],(e=this.getOctantIndex(t))>-1?(s.push(t),a.push(e)):e<-1?(i.push(t),o.push(e)):l.push(t);s.length>0&&(l=l.concat(this.split(s,a))),i.length>0&&(l=l.concat(this.expand(i,o))),this.objects=l,this.checkMerge()},split:function(e,t){var r,n,i,o,s;if(this.depth<this.tree.depthMax){for(e=e||this.objects,t=t||[],s=[],r=0,n=e.length;r<n;r++)o=e[r],(i=t[r])>-1?this.branch(i).addObject(o):s.push(o);e===this.objects&&(this.objects=s)}else s=this.objects;return s},branch:function(e){var t,r,n,i,o;return this.nodesByIndex[e]instanceof EE?t=this.nodesByIndex[e]:(n=(r=.5*this.radiusOverlap)-r*this.tree.overlapPct,i=this.utilVec31Branch.set(1&e?n:-n,2&e?n:-n,4&e?n:-n),o=(new Kg).addVectors(this.position,i),t=new EE({tree:this.tree,parent:this,position:o,radius:r,indexOctant:e}),this.addNode(t,e)),t},expand:function(e,t){var r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C,P,O=this.tree.INDEX_OUTSIDE_MAP,D=this.utilVec31Expand;if(this.tree.root.getDepthEnd()<this.tree.depthMax){for(e=e||this.objects,t=t||[],o=[],s=[],r=0,n=O.length;r<n;r++)O[r].count=0;for(r=0,n=e.length;r<n;r++)i=e[r],(a=t[r])<-1?((l=-a-this.tree.INDEX_OUTSIDE_OFFSET)&this.tree.FLAG_POS_X?O[this.tree.INDEX_OUTSIDE_POS_X].count++:l&this.tree.FLAG_NEG_X&&O[this.tree.INDEX_OUTSIDE_NEG_X].count++,l&this.tree.FLAG_POS_Y?O[this.tree.INDEX_OUTSIDE_POS_Y].count++:l&this.tree.FLAG_NEG_Y&&O[this.tree.INDEX_OUTSIDE_NEG_Y].count++,l&this.tree.FLAG_POS_Z?O[this.tree.INDEX_OUTSIDE_POS_Z].count++:l&this.tree.FLAG_NEG_Z&&O[this.tree.INDEX_OUTSIDE_NEG_Z].count++,s.push(i)):o.push(i);if(s.length>0)for((u=O.slice(0)).sort(function(e,t){return t.count-e.count}),f=1|(h=u[0]).index,v=u[1],g=u[2],m=1|(d=(1|v.index)!==f?v:g).index,v=u[2],g=u[3],y=u[4],x=1|v.index,b=1|g.index,p=x!==f&&x!==m?v:b!==f&&b!==m?g:y,w=h.x+d.x+p.x,_=h.y+d.y+p.y,S=h.z+d.z+p.z,a=this.getOctantIndexFromPosition(w,_,S),c=this.getOctantIndexFromPosition(-w,-_,-S),T=this.overlap,M=this.radius,A=(E=this.tree.overlapPct>0?T/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*M)+E*this.tree.overlapPct-(M+T),D.set(1&a?A:-A,2&a?A:-A,4&a?A:-A),C=(new Kg).addVectors(this.position,D),(P=new EE({tree:this.tree,position:C,radius:E})).addNode(this,c),this.tree.setRoot(P),r=0,n=s.length;r<n;r++)this.tree.root.addObject(s[r]);e===this.objects&&(this.objects=o)}else o=e;return o},shrink:function(){this.checkMerge(),this.tree.root.checkContract()},checkMerge:function(){for(var e,t=this;t.parent instanceof EE&&t.getObjectCountEnd()<this.tree.objectsThreshold;)e=t,t=t.parent;t!==this&&t.merge(e)},merge:function(e){var t,r,n;for(t=0,r=(e=SE(e)).length;t<r;t++)n=e[t],this.addObjectWithoutCheck(n.getObjectsEnd()),n.reset(!0,!0),this.removeNode(n.indexOctant,n);this.checkMerge()},checkContract:function(){var e,t,r,n,i,o,s;if(this.nodesIndices.length>0){for(o=0,s=this.objects.length,e=0,t=this.nodesIndices.length;e<t;e++)s+=n=(r=this.nodesByIndex[this.nodesIndices[e]]).getObjectCountEnd(),(i instanceof EE==!1||n>o)&&(i=r,o=n);(s-=o)<this.tree.objectsThreshold&&i instanceof EE&&this.contract(i)}},contract:function(e){var t,r,n;for(t=0,r=this.nodesIndices.length;t<r;t++)(n=this.nodesByIndex[this.nodesIndices[t]])!==e&&(e.addObjectWithoutCheck(n.getObjectsEnd()),n.reset(!0,!0));e.addObjectWithoutCheck(this.objects),this.reset(!1,!0),this.tree.setRoot(e),e.checkContract()},getOctantIndex:function(e){var t,r,n,i,o,s,a,l,c=this.position,u=this.radiusOverlap,h=this.overlap,d=0;if(e instanceof AE?(r=e.radius,t=e.position,e.positionLast.copy(t)):e instanceof EE&&(t=e.position,r=0),n=t.x-c.x,i=t.y-c.y,o=t.z-c.z,s=Math.abs(n),a=Math.abs(i),l=Math.abs(o),Math.max(s,a,l)+r>u)return s+r>u&&(d^=n>0?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),a+r>u&&(d^=i>0?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),l+r>u&&(d^=o>0?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),e.indexOctant=-d-this.tree.INDEX_OUTSIDE_OFFSET,e.indexOctant;if(n-r>-h)d|=1;else if(!(n+r<h))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;if(i-r>-h)d|=2;else if(!(i+r<h))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;if(o-r>-h)d|=4;else if(!(o+r<h))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;return e.indexOctant=d,e.indexOctant},getOctantIndexFromPosition:function(e,t,r){var n=0;return e>0&&(n|=1),t>0&&(n|=2),r>0&&(n|=4),n},search:function(e,t,r,n,i){var o,s;if(!0===(n?this.intersectRay(e,n,t,i):this.intersectSphere(e,t)))for(r=r.concat(this.objects),o=0,s=this.nodesIndices.length;o<s;o++)r=this.nodesByIndex[this.nodesIndices[o]].search(e,t,r,n);return r},intersectSphere:function(e,t){var r=t*t,n=e.x,i=e.y,o=e.z;return n<this.left?r-=Math.pow(n-this.left,2):n>this.right&&(r-=Math.pow(n-this.right,2)),i<this.bottom?r-=Math.pow(i-this.bottom,2):i>this.top&&(r-=Math.pow(i-this.top,2)),o<this.back?r-=Math.pow(o-this.back,2):o>this.front&&(r-=Math.pow(o-this.front,2)),r>=0},intersectRay:function(e,t,r,n){void 0===n&&(n=this.utilVec31Ray.set(1,1,1).divide(t));var i,o=(this.left-e.x)*n.x,s=(this.right-e.x)*n.x,a=(this.bottom-e.y)*n.y,l=(this.top-e.y)*n.y,c=(this.back-e.z)*n.z,u=(this.front-e.z)*n.z,h=Math.min(Math.min(Math.max(o,s),Math.max(a,l)),Math.max(c,u));return!(h<0)&&!((i=Math.max(Math.max(Math.min(o,s),Math.min(a,l)),Math.min(c,u)))>h||i>r)},getDepthEnd:function(e){var t,r;if(this.nodesIndices.length>0)for(t=0,r=this.nodesIndices.length;t<r;t++)e=this.nodesByIndex[this.nodesIndices[t]].getDepthEnd(e);else e=!e||this.depth>e?this.depth:e;return e},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var e,t,r=this.nodesIndices.length;for(e=0,t=this.nodesIndices.length;e<t;e++)r+=this.nodesByIndex[this.nodesIndices[e]].getNodeCountRecursive();return r},getObjectsEnd:function(e){var t,r;for(e=(e||[]).concat(this.objects),t=0,r=this.nodesIndices.length;t<r;t++)e=this.nodesByIndex[this.nodesIndices[t]].getObjectsEnd(e);return e},getObjectCountEnd:function(){var e,t,r=this.objects.length;for(e=0,t=this.nodesIndices.length;e<t;e++)r+=this.nodesByIndex[this.nodesIndices[e]].getObjectCountEnd();return r},getObjectCountStart:function(){for(var e=this.objects.length,t=this.parent;t instanceof EE;)e+=t.objects.length,t=t.parent;return e},toConsole:function(e){var t,r;for(e="string"==typeof e?e:"   ",console.log(this.parent?e+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth),console.log(this.parent?e+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects),console.log(this.parent?e+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex),t=0,r=this.nodesIndices.length;t<r;t++)this.nodesByIndex[this.nodesIndices[t]].toConsole(e+"   ")}},Rw.prototype.intersectOctreeObject=function(e,t){var r,n,i,o;return e.object instanceof oy?(e=(n=e).object,o=n.faces,i=e.geometry.faces,o.length>0&&(e.geometry.faces=o),r=this.intersectObject(e,t),o.length>0&&(e.geometry.faces=i)):r=this.intersectObject(e,t),r},Rw.prototype.intersectOctreeObjects=function(e,t){var r,n,i=[];for(r=0,n=e.length;r<n;r++)i=i.concat(this.intersectOctreeObject(e[r],t));return i};var CE=function(e,t){this.cubeLods=e,this.numLods=t;var r=4*e[0].width,n=e[0].texture,i={format:n.format,magFilter:n.magFilter,minFilter:n.minFilter,type:n.type,generateMipmaps:n.generateMipmaps,anisotropy:n.anisotropy,encoding:n.encoding===pb?fb:n.encoding};i.encoding===fb&&(i.magFilter=Dx,i.minFilter=Dx),this.CubeUVRenderTarget=new iw(r,r,i),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=Sx,this.camera=new tw(.5*-r,.5*r,.5*-r,.5*r,0,1e3),this.scene=new ew,this.scene.add(this.camera),this.objects=[];var o=[];o.push(new hy(0,0)),o.push(new hy(1,0)),o.push(new hy(2,0)),o.push(new hy(0,1)),o.push(new hy(1,1)),o.push(new hy(2,1));var s=r;r=e[0].width;var a=0,l=4;this.numLods=Math.log(e[0].width)/Math.log(2)-2;for(var c=0;c<this.numLods;c++){var u=.5*(s-s/l);r>16&&(l*=2);for(var h=r>16?6:1,d=0,p=0,f=r,m=0;m<h;m++){for(var v=0;v<6;v++){var g=this.getShader();g.uniforms.envMap.value=this.cubeLods[c].texture,g.envMap=this.cubeLods[c].texture,g.uniforms.faceIndex.value=v,g.uniforms.mapSize.value=f;var y=new Mb(new aw(f,f,0),g);y.position.x=o[v].x*f-u+d,y.position.y=o[v].y*f-u+a+p,y.material.side=ky,this.scene.add(y),this.objects.push(y)}p+=1.75*f,d+=1.25*f,f/=2}a+=2*r,r>16&&(r/=2)}};function PE(e,t,r){iw.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0}CE.prototype={constructor:CE,update:function(e){var t=e.gammaInput,r=e.gammaOutput,n=e.toneMapping,i=e.toneMappingExposure,o=e.getRenderTarget();e.gammaInput=!1,e.gammaOutput=!1,e.toneMapping=vx,e.toneMappingExposure=1,e.render(this.scene,this.camera,this.CubeUVRenderTarget,!1),e.setRenderTarget(o),e.toneMapping=n,e.toneMappingExposure=i,e.gammaInput=t,e.gammaOutput=r},getShader:function(){return new sw({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new Kg(1,1,1)}},vertexShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tvoid main() {\t\t\t\t\tvUv = uv;\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\t\t\t\t}",fragmentShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform samplerCube envMap;\t\t\t\tuniform float mapSize;\t\t\t\tuniform vec3 testColor;\t\t\t\tuniform int faceIndex;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec3 sampleDirection;\t\t\t\t\tvec2 uv = vUv;\t\t\t\t\tuv = uv * 2.0 - 1.0;\t\t\t\t\tuv.y *= -1.0;\t\t\t\t\tif(faceIndex == 0) {\t\t\t\t\t\tsampleDirection = normalize(vec3(1.0, uv.y, -uv.x));\t\t\t\t\t} else if(faceIndex == 1) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, 1.0, uv.y));\t\t\t\t\t} else if(faceIndex == 2) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, uv.y, 1.0));\t\t\t\t\t} else if(faceIndex == 3) {\t\t\t\t\t\tsampleDirection = normalize(vec3(-1.0, uv.y, uv.x));\t\t\t\t\t} else if(faceIndex == 4) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));\t\t\t\t\t} else {\t\t\t\t\t\tsampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));\t\t\t\t\t}\t\t\t\t\tvec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );\t\t\t\t\tgl_FragColor = linearToOutputTexel( color );\t\t\t\t}",blending:Xy,premultipliedAlpha:!1,blendSrc:Qy,blendDst:Zy,blendSrcAlpha:Qy,blendDstAlpha:Zy,blendEquation:qy})}},PE.prototype=Object.create(iw.prototype),PE.prototype.constructor=PE,PE.prototype.isWebGLRenderTargetCube=!0;var OE=function(e,t,r){this.sourceTexture=e,this.resolution=void 0!==r?r:256,this.samplesPerLevel=void 0!==t?t:16;var n=e.encoding===ub||e.encoding===db||e.encoding===hb;this.sourceTexture.minFilter=n?Dx:Cx,this.sourceTexture.magFilter=n?Dx:Cx,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&n,this.cubeLods=[];var i=this.resolution,o={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(i)/Math.log(2)-2;for(var s=0;s<this.numLods;s++){var a=new PE(i,i,o);a.texture.name="PMREMGenerator.cube"+s,this.cubeLods.push(a),i=Math.max(16,i/2)}this.camera=new tw(-1,1,1,-1,0,1e3),this.shader=this.getShader(),this.shader.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,this.planeMesh=new Mb(new aw(2,2,0),this.shader),this.planeMesh.material.side=ky,this.scene=new ew,this.scene.add(this.planeMesh),this.scene.add(this.camera),this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture};OE.prototype={constructor:OE,update:function(e){this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture;var t=e.gammaInput,r=e.gammaOutput,n=e.toneMapping,i=e.toneMappingExposure,o=e.getRenderTarget();e.toneMapping=vx,e.toneMappingExposure=1,e.gammaInput=!1,e.gammaOutput=!1;for(var s=0;s<this.numLods;s++){var a=s/(this.numLods-1);this.shader.uniforms.roughness.value=.9*a,this.shader.uniforms.queryScale.value.x=0==s?-1:1;var l=this.cubeLods[s].width;this.shader.uniforms.mapSize.value=l,this.renderToCubeMapTarget(e,this.cubeLods[s]),s<5&&(this.shader.uniforms.envMap.value=this.cubeLods[s].texture)}e.setRenderTarget(o),e.toneMapping=n,e.toneMappingExposure=i,e.gammaInput=t,e.gammaOutput=r},renderToCubeMapTarget:function(e,t){for(var r=0;r<6;r++)this.renderToCubeMapTargetFace(e,t,r)},renderToCubeMapTargetFace:function(e,t,r){t.activeCubeFace=r,this.shader.uniforms.faceIndex.value=r,e.render(this.scene,this.camera,t,!0)},getShader:function(){return new sw({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},queryScale:{value:new Kg(1,1,1)},testColor:{value:new Kg(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform vec3 testColor;\n\t\t\t\tuniform vec3 queryScale;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tmat3 vecSpace = matrixFromVector(normalize(sampleDirection * queryScale));\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap,vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:Xy,blendSrc:Qy,blendDst:Zy,blendSrcAlpha:Qy,blendDstAlpha:Zy,blendEquation:qy})}};var DE={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},NE={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float l = linearToRelativeLuminance( texel.rgb );","gl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},LE={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","uniform sampler2D luminanceMap;","#else","uniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","#ifdef ADAPTED_LUMINANCE","float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","#else","float fLumAvg = averageLuminance;","#endif","float fLumPixel = linearToRelativeLuminance( vColor );","float fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","return fLumCompressed * vColor;","}","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")},IE=function(e,t){JA.call(this),this.resolution=void 0!==t?t:256,this.needsInit=!0,this.adaptive=void 0===e||!!e,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,void 0===DE&&console.error("AdaptiveToneMappingPass relies on CopyShader");var r=DE;this.copyUniforms=ow.clone(r.uniforms),this.materialCopy=new sw({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,blending:zy,depthTest:!1}),void 0===NE&&console.error("AdaptiveToneMappingPass relies on LuminosityShader"),this.materialLuminance=new sw({uniforms:ow.clone(NE.uniforms),vertexShader:NE.vertexShader,fragmentShader:NE.fragmentShader,blending:zy}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","float fLastLum = max( minLuminance, lastLum.r );","float fCurrentLum = max( minLuminance, currentLum.r );","fCurrentLum *= fCurrentLum;","float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));","gl_FragColor.r = fAdaptedLum;","}"].join("\n")},this.materialAdaptiveLum=new sw({uniforms:ow.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:zy}),void 0===LE&&console.error("AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new sw({uniforms:ow.clone(LE.uniforms),vertexShader:LE.vertexShader,fragmentShader:LE.fragmentShader,blending:zy}),this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};IE.prototype=Object.assign(Object.create(JA.prototype),{constructor:IE,render:function(e,t,r,n,i){this.needsInit&&(this.reset(e),this.luminanceRT.texture.type=r.texture.type,this.previousLuminanceRT.texture.type=r.texture.type,this.currentLuminanceRT.texture.type=r.texture.type,this.needsInit=!1),this.adaptive&&(this.quad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=r.texture,e.render(this.scene,this.camera,this.currentLuminanceRT),this.quad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=n,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,e.render(this.scene,this.camera,this.luminanceRT),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,e.render(this.scene,this.camera,this.previousLuminanceRT)),this.quad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=r.texture,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)},reset:function(e){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var t={minFilter:Dx,magFilter:Dx,format:Hx};this.luminanceRT=new iw(this.resolution,this.resolution,t),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new iw(this.resolution,this.resolution,t),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1,t.minFilter=Lx,this.currentLuminanceRT=new iw(this.resolution,this.resolution,t),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.quad.material=new xb({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},setAdaptive:function(e){e?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0},setAdaptionRate:function(e){e&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(e))},setMinLuminance:function(e){e&&(this.materialToneMap.uniforms.minLuminance.value=e,this.materialAdaptiveLum.uniforms.minLuminance.value=e)},setMaxLuminance:function(e){e&&(this.materialToneMap.uniforms.maxLuminance.value=e)},setAverageLuminance:function(e){e&&(this.materialToneMap.uniforms.averageLuminance.value=e)},setMiddleGrey:function(e){e&&(this.materialToneMap.uniforms.middleGrey.value=e)},dispose:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}});var RE={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new hy(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var r,n,i,o,s=2*Math.ceil(3*e)+1;for(s>25&&(s=25),o=.5*(s-1),n=new Array(s),i=0,r=0;r<s;++r)n[r]=t(r-o,e),i+=n[r];for(r=0;r<s;++r)n[r]/=i;return n}},FE=function(e,t,r,n){JA.call(this),e=void 0!==e?e:1,t=void 0!==t?t:25,r=void 0!==r?r:4,n=void 0!==n?n:256;var i={minFilter:Dx,magFilter:Dx,format:Hx};this.renderTargetX=new iw(n,n,i),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new iw(n,n,i),this.renderTargetY.texture.name="BloomPass.y",void 0===DE&&console.error("BloomPass relies on CopyShader");var o=DE;this.copyUniforms=ow.clone(o.uniforms),this.copyUniforms.opacity.value=e,this.materialCopy=new sw({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:Gy,transparent:!0}),void 0===RE&&console.error("BloomPass relies on ConvolutionShader");var s=RE;this.convolutionUniforms=ow.clone(s.uniforms),this.convolutionUniforms.uImageIncrement.value=FE.blurX,this.convolutionUniforms.cKernel.value=RE.buildKernel(r),this.materialConvolution=new sw({uniforms:this.convolutionUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.needsSwap=!1,this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};FE.prototype=Object.assign(Object.create(JA.prototype),{constructor:FE,render:function(e,t,r,n,i){i&&e.context.disable(e.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=FE.blurX,e.render(this.scene,this.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=FE.blurY,e.render(this.scene,this.camera,this.renderTargetY,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,i&&e.context.enable(e.context.STENCIL_TEST),e.render(this.scene,this.camera,r,this.clear)}}),FE.blurX=new hy(.001953125,0),FE.blurY=new hy(0,.001953125);var kE=function(e,t,r){JA.call(this),this.scene=e,this.camera=t;var n=void 0!==r.focus?r.focus:1,i=void 0!==r.aspect?r.aspect:t.aspect,o=void 0!==r.aperture?r.aperture:.025,s=void 0!==r.maxblur?r.maxblur:1,a=r.width||window.innerWidth||1,l=r.height||window.innerHeight||1;this.renderTargetColor=new iw(a,l,{minFilter:Dx,magFilter:Dx,format:Gx}),this.renderTargetColor.texture.name="BokehPass.color",this.renderTargetDepth=this.renderTargetColor.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new $b,this.materialDepth.depthPacking=vb,this.materialDepth.blending=zy,void 0===cw&&console.error("BokehPass relies on BokehShader");var c=cw,u=ow.clone(c.uniforms);u.tDepth.value=this.renderTargetDepth.texture,u.focus.value=n,u.aspect.value=i,u.aperture.value=o,u.maxblur.value=s,u.nearClip.value=t.near,u.farClip.value=t.far,this.materialBokeh=new sw({defines:Object.assign({},c.defines),uniforms:u,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),this.uniforms=u,this.needsSwap=!1,this.camera2=new tw(-1,1,1,-1,0,1),this.scene2=new ew,this.quad2=new Mb(new lw(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new ay,this.oldClearAlpha=1};kE.prototype=Object.assign(Object.create(JA.prototype),{constructor:kE,render:function(e,t,r,n,i){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.render(this.scene,this.camera,this.renderTargetDepth,!0),this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?e.render(this.scene2,this.camera2):e.render(this.scene2,this.camera2,t,this.clear),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(this.oldClearAlpha),e.autoClear=this.oldAutoClear}});var UE=function(e,t){JA.call(this),this.needsSwap=!1,this.clearColor=void 0!==e?e:0,this.clearAlpha=void 0!==t?t:0};UE.prototype=Object.assign(Object.create(JA.prototype),{constructor:UE,render:function(e,t,r,n,i){var o,s;this.clearColor&&(o=e.getClearColor().getHex(),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),this.clearColor&&e.setClearColor(o,s)}});var BE=function(e,t,r){JA.call(this),this.camera=e,this.needsSwap=!1,this.cubeShader=k_.cube,this.cubeMesh=new Mb(new Db(10,10,10),new sw({uniforms:this.cubeShader.uniforms,vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:Fy})),this.envMap=t,this.opacity=void 0!==r?r:1,this.cubeScene=new ew,this.cubeCamera=new Kb,this.cubeScene.add(this.cubeMesh)};BE.prototype=Object.assign(Object.create(JA.prototype),{constructor:BE,render:function(e,t,r,n,i){var o=e.autoClear;e.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.envMap,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,e.render(this.cubeScene,this.cubeCamera,this.renderToScreen?null:r,this.clear),e.autoClear=o}});var jE={uniforms:{tDiffuse:{value:null},tSize:{value:new hy(256,256)},center:{value:new hy(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},zE=function(e,t,r){JA.call(this),void 0===jE&&console.error("DotScreenPass relies on DotScreenShader");var n=jE;this.uniforms=ow.clone(n.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==r&&(this.uniforms.scale.value=r),this.material=new sw({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};zE.prototype=Object.assign(Object.create(JA.prototype),{constructor:zE,render:function(e,t,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.tSize.value.set(r.width,r.height),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}});var VE=function(e,t){JA.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};VE.prototype=Object.assign(Object.create(JA.prototype),{constructor:VE,render:function(e,t,r,n,i){var o,s,a=e.context,l=e.state;l.buffers.color.setMask(!1),l.buffers.depth.setMask(!1),l.buffers.color.setLocked(!0),l.buffers.depth.setLocked(!0),this.inverse?(o=0,s=1):(o=1,s=0),l.buffers.stencil.setTest(!0),l.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),l.buffers.stencil.setFunc(a.ALWAYS,o,4294967295),l.buffers.stencil.setClear(s),e.render(this.scene,this.camera,r,this.clear),e.render(this.scene,this.camera,t,this.clear),l.buffers.color.setLocked(!1),l.buffers.depth.setLocked(!1),l.buffers.stencil.setFunc(a.EQUAL,1,4294967295),l.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP)}});var GE=function(){JA.call(this),this.needsSwap=!1};GE.prototype=Object.create(JA.prototype),Object.assign(GE.prototype,{render:function(e,t,r,n,i){e.state.buffers.stencil.setTest(!1)}});var HE=function(e,t){if(this.renderer=e,void 0===t){var r={minFilter:Dx,magFilter:Dx,format:Hx,stencilBuffer:!1},n=e.getDrawingBufferSize();(t=new iw(n.width,n.height,r)).texture.name="EffectComposer.rt1"}this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===DE&&console.error("EffectComposer relies on CopyShader"),void 0===ZA&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new ZA(DE)};Object.assign(HE.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize();e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){var t,r,n=!1,i=this.passes.length;for(r=0;r<i;r++)if(!1!==(t=this.passes[r]).enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==VE&&(t instanceof VE?n=!0:t instanceof GE&&(n=!1))}},reset:function(e){if(void 0===e){var t=this.renderer.getDrawingBufferSize();(e=this.renderTarget1.clone()).setSize(t.width,t.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(e,t)}});var WE={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},XE=function(e,t,r,n){JA.call(this),void 0===WE&&console.error("FilmPass relies on FilmShader");var i=WE;this.uniforms=ow.clone(i.uniforms),this.material=new sw({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==r&&(this.uniforms.sCount.value=r),this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};XE.prototype=Object.assign(Object.create(JA.prototype),{constructor:XE,render:function(e,t,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.time.value+=n,this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}});var qE={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")},YE=function(e){JA.call(this),void 0===qE&&console.error("GlitchPass relies on DigitalGlitch");var t=qE;this.uniforms=ow.clone(t.uniforms),void 0==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new sw({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.goWild=!1,this.curF=0,this.generateTrigger()};YE.prototype=Object.assign(Object.create(JA.prototype),{constructor:YE,render:function(e,t,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=Zg.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=Zg.randFloat(-1,1),this.uniforms.seed_y.value=Zg.randFloat(-1,1),this.uniforms.distortion_x.value=Zg.randFloat(0,1),this.uniforms.distortion_y.value=Zg.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=Zg.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=Zg.randFloat(0,1),this.uniforms.distortion_y.value=Zg.randFloat(0,1),this.uniforms.seed_x.value=Zg.randFloat(-.3,.3),this.uniforms.seed_y.value=Zg.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)},generateTrigger:function(){this.randX=Zg.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),r=e*e,n=0;n<r;n++){var i=Zg.randFloat(0,1);t[3*n+0]=i,t[3*n+1]=i,t[3*n+2]=i}var o=new K_(t,e,e,Gx,Fx);return o.needsUpdate=!0,o}});var JE=function(e,t,r,n){this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new ay(1,1,1),this.hiddenEdgeColor=new ay(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,JA.call(this),this.resolution=void 0!==e?new hy(e.x,e.y):new hy(256,256);var i={minFilter:Dx,magFilter:Dx,format:Hx},o=Math.round(this.resolution.x/this.downSampleRatio),s=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new xb({color:16777215}),this.maskBufferMaterial.side=ky,this.renderTargetMaskBuffer=new iw(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new $b,this.depthMaterial.side=ky,this.depthMaterial.depthPacking=vb,this.depthMaterial.blending=zy,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=ky,this.prepareMaskMaterial.fragmentShader=function(e,t){var r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new iw(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new iw(o,s,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new iw(o,s,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new iw(Math.round(o/2),Math.round(s/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new iw(o,s,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new iw(Math.round(o/2),Math.round(s/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new hy(o,s),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new hy(Math.round(o/2),Math.round(s/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===DE&&console.error("OutlinePass relies on CopyShader");var a=DE;this.copyUniforms=ow.clone(a.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new sw({uniforms:this.copyUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,blending:zy,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new ay,this.oldClearAlpha=1,this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new ay,this.tempPulseColor2=new ay,this.textureMatrix=new Qg};JE.prototype=Object.assign(Object.create(JA.prototype),{constructor:JE,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value=new hy(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value=new hy(r,n)},changeVisibilityOfSelectedObjects:function(e){function t(t){t instanceof Mb&&(t.visible=e)}for(var r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function r(e){e instanceof Mb&&t.push(e)}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(r)}this.renderScene.traverse(function(r){if(r instanceof Mb||r instanceof Ab||r instanceof aA){for(var n=!1,i=0;i<t.length;i++)if(t[i].id===r.id){n=!0;break}if(!n){var o=r.visible;e&&!r.bVisible||(r.visible=e),r.bVisible=o}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,r,n,i){if(0!==this.selectedObjects.length){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,i&&e.context.disable(e.context.STENCIL_TEST),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var s=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.render(this.renderScene,this.renderCamera,this.renderTargetDepthBuffer,!0),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new hy(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.render(this.renderScene,this.renderCamera,this.renderTargetMaskBuffer,!0),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=s,this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,!0),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var a=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(a),this.tempPulseColor2.multiplyScalar(a)}this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new hy(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=JE.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.render(this.scene,this.camera,this.renderTargetBlurBuffer1,!0),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=JE.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=JE.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetBlurBuffer2,!0),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=JE.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,!0),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.context.enable(e.context.STENCIL_TEST),e.render(this.scene,this.camera,r,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}},getPrepareMaskMaterial:function(){return new sw({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new hy(.5,.5)},textureMatrix:{value:new Qg}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new sw({uniforms:{maskTexture:{value:null},texSize:{value:new hy(.5,.5)},visibleEdgeColor:{value:new Kg(1,1,1)},hiddenEdgeColor:{value:new Kg(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new sw({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new hy(.5,.5)},direction:{value:new hy(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\t\t\t\t}"})},getOverlayMaterial:function(){return new sw({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:Gy,depthTest:!1,depthWrite:!1,transparent:!0})}}),JE.BlurDirectionX=new hy(1,0),JE.BlurDirectionY=new hy(0,1);var ZE=function(e,t,r,n,i){JA.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};function QE(e,t,r,n,i,o,s,a,l,c){if((c=void 0!==c?c:Yx)!==Yx&&c!==Jx)throw new Error("DepthTexture format must be either DepthFormat or DepthStencilFormat");void 0===r&&c===Yx&&(r=Rx),void 0===r&&c===Jx&&(r=zx),nw.call(this,null,n,i,o,s,a,c,r,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:Cx,this.minFilter=void 0!==a?a:Cx,this.flipY=!1,this.generateMipmaps=!1}ZE.prototype=Object.assign(Object.create(JA.prototype),{constructor:ZE,render:function(e,t,r,n,i){var o,s,a=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(o=e.getClearColor().getHex(),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),this.clearColor&&e.setClearColor(o,s),this.scene.overrideMaterial=null,e.autoClear=a}}),QE.prototype=Object.create(nw.prototype),QE.prototype.constructor=QE,QE.prototype.isDepthTexture=!0;var KE={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},size:{type:"v2",value:new hy(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},cameraProjectionMatrix:{type:"m4",value:new Qg},cameraInverseProjectionMatrix:{type:"m4",value:new Qg},scale:{type:"f",value:1},intensity:{type:"f",value:.1},bias:{type:"f",value:.5},minResolution:{type:"f",value:0},kernelRadius:{type:"f",value:100},randomSeed:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},$E={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new hy(512,512)},sampleUvOffsets:{type:"v2v",value:[new hy(0,0)]},sampleWeights:{type:"1fv",value:[1]},tDepth:{type:"t",value:null},cameraNear:{type:"f",value:10},cameraFar:{type:"f",value:1e3},depthCutoff:{type:"f",value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},eC={createSampleWeights:function(e,t){for(var r=function(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)},n=[],i=0;i<=e;i++)n.push(r(i,t));return n},createSampleOffsets:function(e,t){for(var r=[],n=0;n<=e;n++)r.push(t.clone().multiplyScalar(n));return r},configure:function(e,t,r,n){e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=eC.createSampleOffsets(t,n),e.uniforms.sampleWeights.value=eC.createSampleWeights(t,r),e.needsUpdate=!0}},tC={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},rC=function(e,t,r,n,i){(JA.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==r&&r,this.supportsNormalTexture=void 0!==n&&n,this.oldClearColor=new ay,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==i?new hy(i.x,i.y):new hy(256,256),this.saoRenderTarget=new iw(this.resolution.x,this.resolution.y,{minFilter:Dx,magFilter:Dx,format:Hx}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new iw(this.resolution.x,this.resolution.y,{minFilter:Cx,magFilter:Cx,format:Hx}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension)&&((r=new QE).type=Rx,r.minFilter=Cx,r.maxFilter=Cx,this.beautyRenderTarget.depthTexture=r,this.beautyRenderTarget.depthBuffer=!0);this.depthMaterial=new $b,this.depthMaterial.depthPacking=vb,this.depthMaterial.blending=zy,this.normalMaterial=new xw,this.normalMaterial.blending=zy,void 0===KE&&console.error("SAOPass relies on SAOShader"),this.saoMaterial=new sw({defines:Object.assign({},KE.defines),fragmentShader:KE.fragmentShader,vertexShader:KE.vertexShader,uniforms:ow.clone(KE.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=zy,void 0===$E&&console.error("SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new sw({uniforms:ow.clone($E.uniforms),defines:Object.assign({},$E.defines),vertexShader:$E.vertexShader,fragmentShader:$E.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=zy,this.hBlurMaterial=new sw({uniforms:ow.clone($E.uniforms),defines:Object.assign({},$E.defines),vertexShader:$E.vertexShader,fragmentShader:$E.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=zy,void 0===DE&&console.error("SAOPass relies on CopyShader"),this.materialCopy=new sw({uniforms:ow.clone(DE.uniforms),vertexShader:DE.vertexShader,fragmentShader:DE.fragmentShader,blending:zy}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=Xy,this.materialCopy.blendSrc=ix,this.materialCopy.blendDst=Zy,this.materialCopy.blendEquation=qy,this.materialCopy.blendSrcAlpha=rx,this.materialCopy.blendDstAlpha=Zy,this.materialCopy.blendEquationAlpha=qy,void 0===DE&&console.error("SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new sw({uniforms:ow.clone(tC.uniforms),vertexShader:tC.vertexShader,fragmentShader:tC.fragmentShader,blending:zy}),this.quadCamera=new tw(-1,1,1,-1,0,1),this.quadScene=new ew,this.quad=new Mb(new aw(2,2),null),this.quadScene.add(this.quad)};rC.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},rC.prototype=Object.assign(Object.create(JA.prototype),{constructor:rC,render:function(e,t,r,n,i){if(this.renderToScreen&&(this.materialCopy.blending=zy,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1!==this.params.output){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.clearTarget(this.depthRenderTarget),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var s=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=s,this.hBlurMaterial.uniforms.depthCutoff.value=s,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(eC.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new hy(0,1)),eC.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new hy(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.render(this.scene,this.camera,this.beautyRenderTarget,!0),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var a=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,a=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?a.blending=Xy:a.blending=zy,this.renderPass(e,a,this.renderToScreen?null:r),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}},renderPass:function(e,t,r,n,i){var o=e.getClearColor(),s=e.getClearAlpha(),a=e.autoClear;e.autoClear=!1;var l=void 0!==n&&null!==n;l&&(e.setClearColor(n),e.setClearAlpha(i||0)),this.quad.material=t,e.render(this.quadScene,this.quadCamera,r,l),e.autoClear=a,e.setClearColor(o),e.setClearAlpha(s)},renderOverride:function(e,t,r,n,i){var o=e.getClearColor(),s=e.getClearAlpha(),a=e.autoClear;e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i;var l=void 0!==n&&null!==n;l&&(e.setClearColor(n),e.setClearAlpha(i||0)),this.scene.overrideMaterial=t,e.render(this.scene,this.camera,r,l),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(o),e.setClearAlpha(s)},setSize:function(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}});var nC=function(e){JA.call(this),void 0===DE&&console.error("SavePass relies on CopyShader");var t=DE;this.textureID="tDiffuse",this.uniforms=ow.clone(t.uniforms),this.material=new sw({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new iw(window.innerWidth,window.innerHeight,{minFilter:Dx,magFilter:Dx,format:Gx,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};nC.prototype=Object.assign(Object.create(JA.prototype),{constructor:nC,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,e.render(this.scene,this.camera,this.renderTarget,this.clear)}});var iC=[{defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new hy(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","vUv = uv;","SMAAEdgeDetectionVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","vec4 delta;","vec3 C = texture2D( colorTex, texcoord ).rgb;","vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","vec3 t = abs( C - Cleft );","delta.x = max( max( t.r, t.g ), t.b );","vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","t = abs( C - Ctop );","delta.y = max( max( t.r, t.g ), t.b );","vec2 edges = step( threshold, delta.xy );","if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","discard;","vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","t = abs( C - Cright );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","t = abs( C - Cbottom );","delta.w = max( max( t.r, t.g ), t.b );","float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","t = abs( C - Cleftleft );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","t = abs( C - Ctoptop );","delta.w = max( max( t.r, t.g ), t.b );","maxDelta = max( max( maxDelta, delta.z ), delta.w );","edges.xy *= step( 0.5 * maxDelta, delta.xy );","return vec4( edges, 0.0, 0.0 );","}","void main() {","gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},{defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new hy(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","vPixcoord = texcoord / resolution;","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","vUv = uv;","SMAABlendingWeightCalculationVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","vec2 round( vec2 x ) {","return sign( x ) * floor( abs( x ) + 0.5 );","}","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","e.r = bias + e.r * scale;","return 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x += 0.25 * resolution.x;","texcoord.x += resolution.x;","texcoord.x += 2.0 * resolution.x;","texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","return texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x -= 0.25 * resolution.x;","texcoord.x -= resolution.x;","texcoord.x -= 2.0 * resolution.x;","texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","return texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y -= 0.25 * resolution.y;","texcoord.y -= resolution.y;","texcoord.y -= 2.0 * resolution.y;","texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","return texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y += 0.25 * resolution.y;","texcoord.y += resolution.y;","texcoord.y += 2.0 * resolution.y;","texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","return texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","return texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","vec2 e = texture2D( edgesTex, texcoord ).rg;","if ( e.g > 0.0 ) {","vec2 d;","vec2 coords;","coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","coords.y = offset[ 1 ].y;","d.x = coords.x;","float e1 = texture2D( edgesTex, coords, 0.0 ).r;","coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","d.y = coords.x;","d = d / resolution.x - pixcoord.x;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","}","if ( e.r > 0.0 ) {","vec2 d;","vec2 coords;","coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","coords.x = offset[ 0 ].x;","d.x = coords.y;","float e1 = texture2D( edgesTex, coords, 0.0 ).g;","coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","d.y = coords.y;","d = d / resolution.y - pixcoord.y;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","}","return weights;","}","void main() {","gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},{uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new hy(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","vUv = uv;","SMAANeighborhoodBlendingVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","vec4 a;","a.xz = texture2D( blendTex, texcoord ).xz;","a.y = texture2D( blendTex, offset[ 1 ].zw ).g;","a.w = texture2D( blendTex, offset[ 1 ].xy ).a;","if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","return texture2D( colorTex, texcoord, 0.0 );","} else {","vec2 offset;","offset.x = a.a > a.b ? a.a : -a.b;","offset.y = a.g > a.r ? -a.g : a.r;","if ( abs( offset.x ) > abs( offset.y )) {","offset.y = 0.0;","} else {","offset.x = 0.0;","}","vec4 C = texture2D( colorTex, texcoord, 0.0 );","texcoord += sign( offset ) * resolution;","vec4 Cop = texture2D( colorTex, texcoord, 0.0 );","float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","C.xyz = pow(C.xyz, vec3(2.2));","Cop.xyz = pow(Cop.xyz, vec3(2.2));","vec4 mixed = mix(C, Cop, s);","mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","return mixed;","}","}","void main() {","gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")}],oC=function(e,t){JA.call(this),this.edgesRT=new iw(e,t,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:Dx,format:Gx}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new iw(e,t,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:Dx,format:Hx}),this.weightsRT.texture.name="SMAAPass.weights";var r=new Image;r.src=this.getAreaTexture(),this.areaTexture=new nw,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=r,this.areaTexture.format=Gx,this.areaTexture.minFilter=Dx,this.areaTexture.generateMipmaps=!1,this.areaTexture.needsUpdate=!0,this.areaTexture.flipY=!1;var n=new Image;n.src=this.getSearchTexture(),this.searchTexture=new nw,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=n,this.searchTexture.magFilter=Cx,this.searchTexture.minFilter=Cx,this.searchTexture.generateMipmaps=!1,this.searchTexture.needsUpdate=!0,this.searchTexture.flipY=!1,void 0===iC&&console.error("SMAAPass relies on SMAAShader"),this.uniformsEdges=ow.clone(iC[0].uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new sw({defines:Object.assign({},iC[0].defines),uniforms:this.uniformsEdges,vertexShader:iC[0].vertexShader,fragmentShader:iC[0].fragmentShader}),this.uniformsWeights=ow.clone(iC[1].uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new sw({defines:Object.assign({},iC[1].defines),uniforms:this.uniformsWeights,vertexShader:iC[1].vertexShader,fragmentShader:iC[1].fragmentShader}),this.uniformsBlend=ow.clone(iC[2].uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new sw({uniforms:this.uniformsBlend,vertexShader:iC[2].vertexShader,fragmentShader:iC[2].fragmentShader}),this.needsSwap=!1,this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};oC.prototype=Object.assign(Object.create(JA.prototype),{constructor:oC,render:function(e,t,r,n,i){this.uniformsEdges.tDiffuse.value=r.texture,this.quad.material=this.materialEdges,e.render(this.scene,this.camera,this.edgesRT,this.clear),this.quad.material=this.materialWeights,e.render(this.scene,this.camera,this.weightsRT,this.clear),this.uniformsBlend.tColor.value=r.texture,this.quad.material=this.materialBlend,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)},setSize:function(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)},getAreaTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var sC=function(e,t,r,n){JA.call(this),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==n?n:0,void 0===DE&&console.error("SSAARenderPass relies on CopyShader");var i=DE;this.copyUniforms=ow.clone(i.uniforms),this.copyMaterial=new sw({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:Gy,depthTest:!1,depthWrite:!1}),this.camera2=new tw(-1,1,1,-1,0,1),this.scene2=new ew,this.quad2=new Mb(new aw(2,2),this.copyMaterial),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2)};sC.prototype=Object.assign(Object.create(JA.prototype),{constructor:sC,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new iw(r.width,r.height,{minFilter:Dx,magFilter:Dx,format:Hx}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var n=sC.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=e.autoClear;e.autoClear=!1;var o=e.getClearColor().getHex(),s=e.getClearAlpha(),a=1/n.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var l=r.width,c=r.height,u=0;u<n.length;u++){var h=n[u];this.camera.setViewOffset&&this.camera.setViewOffset(l,c,.0625*h[0],.0625*h[1],l,c);var d=a;if(this.unbiased)d+=1/32*((u+.5)/n.length-.5);this.copyUniforms.opacity.value=d,e.setClearColor(this.clearColor,this.clearAlpha),e.render(this.scene,this.camera,this.sampleRenderTarget,!0),0===u&&e.setClearColor(0,0),e.render(this.scene2,this.camera2,this.renderToScreen?null:t,0===u)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=i,e.setClearColor(o,s)}}),sC.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var aC={uniforms:{tDiffuse:{value:null},tDepth:{value:null},size:{value:new hy(512,512)},cameraNear:{value:1},cameraFar:{value:100},radius:{value:32},onlyAO:{value:0},aoClamp:{value:.25},lumInfluence:{value:.7}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","#ifdef USE_LOGDEPTHBUF","uniform float logDepthBufFC;","#endif","uniform float radius;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","const int samples = 64;","const bool useNoise = true;","const float noiseAmount = 0.0004;","const float diffArea = 0.4;","const float gDisplace = 0.4;","#include <packing>","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );","float gg = fract( coord.t * ( size.y / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float readDepth( const in vec2 coord ) {","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","#ifdef USE_LOGDEPTHBUF","float logz = unpackRGBAToDepth( texture2D( tDepth, coord ) );","float w = pow(2.0, (logz / logDepthBufFC)) - 1.0;","float z = (logz / w) + 1.0;","#else","float z = unpackRGBAToDepth( texture2D( tDepth, coord ) );","#endif","return cameraCoef / ( cameraFarPlusNear - z * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 8.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * ( dd * dd ) / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + radius * vv;","vec2 coord2 = vUv - radius * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / size.x ) / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float ao = 0.0;","float dz = 1.0 / float( samples );","float l = 0.0;","float z = 1.0 - dz / 2.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","float pw = cos( l ) * r;","float ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},lC=function(e,t,r,n){if(void 0===aC)return console.warn("SSAOPass depends on SSAOShader"),new ZA;ZA.call(this,aC),this.width=void 0!==r?r:512,this.height=void 0!==n?n:256,this.renderToScreen=!1,this.camera2=t,this.scene2=e,this.depthMaterial=new $b,this.depthMaterial.depthPacking=vb,this.depthMaterial.blending=zy,this.depthRenderTarget=new iw(this.width,this.height,{minFilter:Dx,magFilter:Dx}),this.uniforms.tDepth.value=this.depthRenderTarget.texture,this.uniforms.size.value.set(this.width,this.height),this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far,this.uniforms.radius.value=4,this.uniforms.onlyAO.value=!1,this.uniforms.aoClamp.value=.25,this.uniforms.lumInfluence.value=.7,Object.defineProperties(this,{radius:{get:function(){return this.uniforms.radius.value},set:function(e){this.uniforms.radius.value=e}},onlyAO:{get:function(){return this.uniforms.onlyAO.value},set:function(e){this.uniforms.onlyAO.value=e}},aoClamp:{get:function(){return this.uniforms.aoClamp.value},set:function(e){this.uniforms.aoClamp.value=e}},lumInfluence:{get:function(){return this.uniforms.lumInfluence.value},set:function(e){this.uniforms.lumInfluence.value=e}}})};lC.prototype=Object.create(ZA.prototype),lC.prototype.render=function(e,t,r,n,i){this.scene2.overrideMaterial=this.depthMaterial,e.render(this.scene2,this.camera2,this.depthRenderTarget,!0),this.scene2.overrideMaterial=null,ZA.prototype.render.call(this,e,t,r,n,i)},lC.prototype.setScene=function(e){this.scene2=e},lC.prototype.setCamera=function(e){this.camera2=e,this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far},lC.prototype.setSize=function(e,t){this.width=e,this.height=t,this.uniforms.size.value.set(this.width,this.height),this.depthRenderTarget.setSize(this.width,this.height)};var cC=function(e,t,r){void 0===sC&&console.error("TAARenderPass relies on SSAARenderPass"),sC.call(this,e,t,r),this.sampleLevel=0,this.accumulate=!1};cC.JitterVectors=sC.JitterVectors,cC.prototype=Object.assign(Object.create(sC.prototype),{constructor:cC,render:function(e,t,r,n){if(!this.accumulate)return sC.prototype.render.call(this,e,t,r,n),void(this.accumulateIndex=-1);var i=cC.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new iw(r.width,r.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new iw(r.width,r.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(sC.prototype.render.call(this,e,this.holdRenderTarget,r,n),this.accumulateIndex=0);var o=e.autoClear;e.autoClear=!1;var s=1/i.length;if(this.accumulateIndex>=0&&this.accumulateIndex<i.length){this.copyUniforms.opacity.value=s,this.copyUniforms.tDiffuse.value=t.texture;for(var a=Math.pow(2,this.sampleLevel),l=0;l<a;l++){var c=i[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,.0625*c[0],.0625*c[1],r.width,r.height),e.render(this.scene,this.camera,t,!0),e.render(this.scene2,this.camera2,this.sampleRenderTarget,0===this.accumulateIndex),this.accumulateIndex++,this.accumulateIndex>=i.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var u=this.accumulateIndex*s;u>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.render(this.scene2,this.camera2,t,!0)),u<1&&(this.copyUniforms.opacity.value=1-u,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.render(this.scene2,this.camera2,t,0===u)),e.autoClear=o}});var uC=function(e,t){JA.call(this),void 0===DE&&console.error("TexturePass relies on CopyShader");var r=DE;this.map=e,this.opacity=void 0!==t?t:1,this.uniforms=ow.clone(r.uniforms),this.material=new sw({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};uC.prototype=Object.assign(Object.create(JA.prototype),{constructor:uC,render:function(e,t,r,n,i){var o=e.autoClear;e.autoClear=!1,this.quad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,e.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),e.autoClear=o}});var hC={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new ay(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},dC=function(e,t,r,n){JA.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new hy(e.x,e.y):new hy(256,256);var i={minFilter:Dx,magFilter:Dx,format:Hx};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new iw(o,s,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var a=0;a<this.nMips;a++){var l;(l=new iw(o,s,i)).texture.name="UnrealBloomPass.h"+a,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l),(l=new iw(o,s,i)).texture.name="UnrealBloomPass.v"+a,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),o=Math.round(o/2),s=Math.round(s/2)}void 0===hC&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var c=hC;this.highPassUniforms=ow.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new sw({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var u=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2),a=0;a<this.nMips;a++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[a])),this.separableBlurMaterials[a].uniforms.texSize.value=new hy(o,s),o=Math.round(o/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Kg(1,1,1),new Kg(1,1,1),new Kg(1,1,1),new Kg(1,1,1),new Kg(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===DE&&console.error("BloomPass relies on CopyShader");var h=DE;this.copyUniforms=ow.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new sw({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:Gy,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new ay,this.oldClearAlpha=1,this.camera=new tw(-1,1,1,-1,0,1),this.scene=new ew,this.basic=new xb,this.quad=new Mb(new lw(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};dC.prototype=Object.assign(Object.create(JA.prototype),{constructor:dC,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new hy(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,i){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(new ay(0,0,0),0),i&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=r.texture,e.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.render(this.scene,this.camera,this.renderTargetBright,!0);for(var s=this.renderTargetBright,a=0;a<this.nMips;a++)this.quad.material=this.separableBlurMaterials[a],this.separableBlurMaterials[a].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[a].uniforms.direction.value=dC.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetsHorizontal[a],!0),this.separableBlurMaterials[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurMaterials[a].uniforms.direction.value=dC.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetsVertical[a],!0),s=this.renderTargetsVertical[a];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.render(this.scene,this.camera,void 0,!1):e.render(this.scene,this.camera,r,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new sw({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new hy(.5,.5)},direction:{value:new hy(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new sw({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),dC.BlurDirectionX=new hy(1,0),dC.BlurDirectionY=new hy(0,1);function pC(e,t,r,n,i,o){this.planes=[void 0!==e?e:new Sb,void 0!==t?t:new Sb,void 0!==r?r:new Sb,void 0!==n?n:new Sb,void 0!==i?i:new Sb,void 0!==o?o:new Sb]}Object.assign(pC.prototype,{set:function(e,t,r,n,i,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(s-n,u-a,f-h,y-m).normalize(),t[1].setComponents(s+n,u+a,f+h,y+m).normalize(),t[2].setComponents(s+i,u+l,f+d,y+v).normalize(),t[3].setComponents(s-i,u-l,f-d,y-v).normalize(),t[4].setComponents(s-o,u-c,f-p,y-g).normalize(),t[5].setComponents(s+o,u+c,f+p,y+g).normalize(),this},intersectsObject:function(){var e=new uy;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new uy;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(r)<n)return!1}return!0},intersectsBox:function(){var e=new Kg,t=new Kg;return function(r){for(var n=this.planes,i=0;i<6;i++){var o=n[i];e.x=o.normal.x>0?r.min.x:r.max.x,t.x=o.normal.x>0?r.max.x:r.min.x,e.y=o.normal.y>0?r.min.y:r.max.y,t.y=o.normal.y>0?r.max.y:r.min.y,e.z=o.normal.z>0?r.min.z:r.max.z,t.z=o.normal.z>0?r.max.z:r.min.z;var s=o.distanceToPoint(e),a=o.distanceToPoint(t);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var fC=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},mC=function(){this.id=0,this.v1=new vC,this.v2=new vC,this.v3=new vC,this.normalModel=new Kg,this.vertexNormalsModel=[new Kg,new Kg,new Kg],this.vertexNormalsLength=0,this.color=new ay,this.material=null,this.uvs=[new hy,new hy,new hy],this.z=0,this.renderOrder=0},vC=function(){this.position=new Kg,this.positionWorld=new Kg,this.positionScreen=new fy,this.visible=!0};vC.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)};var gC=function(){this.id=0,this.v1=new vC,this.v2=new vC,this.vertexColors=[new ay,new ay],this.material=null,this.z=0,this.renderOrder=0},yC=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new hy,this.material=null,this.renderOrder=0},xC=function(){var e,t,r,n,i,o,s,a,l,c,u,h=[],d=0,p=[],f=0,m=[],v=0,g=[],y=0,x=[],b=0,w={objects:[],lights:[],elements:[]},_=new Kg,S=new fy,T=new cy(new Kg(-1,-1,-1),new Kg(1,1,1)),M=new cy,A=new Array(3),E=new Qg,C=new Qg,P=new Qg,O=new ny,D=new pC,N=new fy,L=new fy;this.projectVector=function(e,t){console.warn("Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("Projector: .pickingRay() is now raycaster.setFromCamera().")};var I=new function(){var e=[],t=[],n=[],o=null,a=null,l=new ny;function c(e){var t=e.position,r=e.positionWorld,n=e.positionScreen;r.copy(t).applyMatrix4(u),n.copy(r).applyMatrix4(C);var i=1/n.w;n.x*=i,n.y*=i,n.z*=i,e.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1}function h(e,t,r){return!0===e.visible||!0===t.visible||!0===r.visible||(A[0]=e.positionScreen,A[1]=t.positionScreen,A[2]=r.positionScreen,T.intersectsBox(M.setFromPoints(A)))}function d(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(r){a=(o=r).material,l.getNormalMatrix(o.matrixWorld),e.length=0,t.length=0,n.length=0},projectVertex:c,checkTriangleVisibility:h,checkBackfaceCulling:d,pushVertex:function(e,t,n){(r=k()).position.set(e,t,n),c(r)},pushNormal:function(t,r,n){e.push(t,r,n)},pushColor:function(e,r,n){t.push(e,r,n)},pushUv:function(e,t){n.push(e,t)},pushLine:function(e,r){var n=p[e],i=p[r];n.positionScreen.copy(n.position).applyMatrix4(P),i.positionScreen.copy(i.position).applyMatrix4(P),!0===z(n.positionScreen,i.positionScreen)&&(n.positionScreen.multiplyScalar(1/n.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(s=B()).id=o.id,s.v1.copy(n),s.v2.copy(i),s.z=Math.max(n.positionScreen.z,i.positionScreen.z),s.renderOrder=o.renderOrder,s.material=o.material,o.material.vertexColors===jy&&(s.vertexColors[0].fromArray(t,3*e),s.vertexColors[1].fromArray(t,3*r)),w.elements.push(s))},pushTriangle:function(t,r,s){var c=arguments,u=p[t],f=p[r],m=p[s];if(!1!==h(u,f,m)&&(a.side===ky||!0===d(u,f,m))){(i=U()).id=o.id,i.v1.copy(u),i.v2.copy(f),i.v3.copy(m),i.z=(u.positionScreen.z+f.positionScreen.z+m.positionScreen.z)/3,i.renderOrder=o.renderOrder,i.normalModel.fromArray(e,3*t),i.normalModel.applyMatrix3(l).normalize();for(var v=0;v<3;v++){var g=i.vertexNormalsModel[v];g.fromArray(e,3*c[v]),g.applyMatrix3(l).normalize(),i.uvs[v].fromArray(n,2*c[v])}i.vertexNormalsLength=3,i.material=o.material,w.elements.push(i)}}}};function R(r){(e=function(){if(t===d){var e=new fC;return h.push(e),d++,t++,e}return h[t++]}()).id=r.id,e.object=r,_.setFromMatrixPosition(r.matrixWorld),_.applyMatrix4(C),e.z=_.z,e.renderOrder=r.renderOrder,w.objects.push(e)}function F(e,t,r){var n=1/e.w;e.z*=n,e.z>=-1&&e.z<=1&&((l=function(){if(c===b){var e=new yC;return x.push(e),b++,c++,e}return x[c++]}()).id=t.id,l.x=e.x*n,l.y=e.y*n,l.z=e.z,l.renderOrder=t.renderOrder,l.object=t,l.rotation=t.rotation,l.scale.x=t.scale.x*Math.abs(l.x-(e.x+r.projectionMatrix.elements[0])/(e.w+r.projectionMatrix.elements[12])),l.scale.y=t.scale.y*Math.abs(l.y-(e.y+r.projectionMatrix.elements[5])/(e.w+r.projectionMatrix.elements[13])),l.material=t.material,w.elements.push(l))}function k(){if(n===f){var e=new vC;return p.push(e),f++,n++,e}return p[n++]}function U(){if(o===v){var e=new mC;return m.push(e),v++,o++,e}return m[o++]}function B(){if(a===y){var e=new gC;return g.push(e),y++,a++,e}return g[a++]}function j(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function z(e,t){var r=0,n=1,i=e.z+e.w,o=t.z+t.w,s=-e.z+e.w,a=-t.z+t.w;return i>=0&&o>=0&&s>=0&&a>=0||!(i<0&&o<0||s<0&&a<0)&&(i<0?r=Math.max(r,i/(i-o)):o<0&&(n=Math.min(n,i/(i-o))),s<0?r=Math.max(r,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),!(n<r)&&(e.lerp(t,r),t.lerp(e,1-n),!0))}this.projectScene=function(e,r,l,h){o=0,a=0,c=0,w.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),E.copy(r.matrixWorldInverse),C.multiplyMatrices(r.projectionMatrix,E),D.setFromMatrix(C),t=0,w.objects.length=0,w.lights.length=0,function e(t){if(!1!==t.visible){if(t instanceof MS)w.lights.push(t);else if(t instanceof Mb||t instanceof Ab||t instanceof $_){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===D.intersectsObject(t))return;R(t)}else if(t instanceof aA){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===D.intersectsSprite(t))return;R(t)}for(var r=t.children,n=0,i=r.length;n<i;n++)e(r[n])}}(e),!0===l&&w.objects.sort(j);for(var d=w.objects,f=0,m=d.length;f<m;f++){var v=d[f].object,g=v.geometry;if(I.setObject(v),u=v.matrixWorld,n=0,v instanceof Mb){if(g instanceof Cy){var y=g.attributes,x=g.groups;if(void 0===y.position)continue;for(var b=0,T=(we=y.position.array).length;b<T;b+=3)I.pushVertex(we[b],we[b+1],we[b+2]);if(void 0!==y.normal){var M=y.normal.array;for(b=0,T=M.length;b<T;b+=3)I.pushNormal(M[b],M[b+1],M[b+2])}if(void 0!==y.uv){var A=y.uv.array;for(b=0,T=A.length;b<T;b+=2)I.pushUv(A[b],A[b+1])}if(null!==g.index){var V=g.index.array;if(x.length>0)for(var G=0;G<x.length;G++){var H=x[G];for(b=H.start,T=H.start+H.count;b<T;b+=3)I.pushTriangle(V[b],V[b+1],V[b+2])}else for(b=0,T=V.length;b<T;b+=3)I.pushTriangle(V[b],V[b+1],V[b+2])}else for(b=0,T=we.length/3;b<T;b+=3)I.pushTriangle(b,b+1,b+2)}else if(g instanceof py){var W=g.vertices,X=g.faces,q=g.faceVertexUvs[0];O.getNormalMatrix(u);for(var Y=v.material,J=Array.isArray(Y),Z=0,Q=W.length;Z<Q;Z++){var K=W[Z];if(_.copy(K),!0===Y.morphTargets)for(var $=g.morphTargets,ee=v.morphTargetInfluences,te=0,re=$.length;te<re;te++){var ne=ee[te];if(0!==ne){var ie=$[te].vertices[Z];_.x+=(ie.x-K.x)*ne,_.y+=(ie.y-K.y)*ne,_.z+=(ie.z-K.z)*ne}}I.pushVertex(_.x,_.y,_.z)}for(var oe=0,se=X.length;oe<se;oe++){var ae=X[oe];if(void 0!==(Y=!0===J?v.material[ae.materialIndex]:v.material)){var le=Y.side,ce=p[ae.a],ue=p[ae.b],he=p[ae.c];if(!1!==I.checkTriangleVisibility(ce,ue,he)){var de=I.checkBackfaceCulling(ce,ue,he);if(le!==ky){if(le===Ry&&!1===de)continue;if(le===Fy&&!0===de)continue}(i=U()).id=v.id,i.v1.copy(ce),i.v2.copy(ue),i.v3.copy(he),i.normalModel.copy(ae.normal),!1!==de||le!==Fy&&le!==ky||i.normalModel.negate(),i.normalModel.applyMatrix3(O).normalize();for(var pe=ae.vertexNormals,fe=0,me=Math.min(pe.length,3);fe<me;fe++){var ve=i.vertexNormalsModel[fe];ve.copy(pe[fe]),!1!==de||le!==Fy&&le!==ky||ve.negate(),ve.applyMatrix3(O).normalize()}i.vertexNormalsLength=pe.length;var ge=q[oe];if(void 0!==ge)for(var ye=0;ye<3;ye++)i.uvs[ye].copy(ge[ye]);i.color=ae.color,i.material=Y,i.z=(ce.positionScreen.z+ue.positionScreen.z+he.positionScreen.z)/3,i.renderOrder=v.renderOrder,w.elements.push(i)}}}}}else if(v instanceof Ab){if(P.multiplyMatrices(C,u),g instanceof Cy){if(void 0!==(y=g.attributes).position){for(b=0,T=(we=y.position.array).length;b<T;b+=3)I.pushVertex(we[b],we[b+1],we[b+2]);if(void 0!==y.color){var xe=y.color.array;for(b=0,T=xe.length;b<T;b+=3)I.pushColor(xe[b],xe[b+1],xe[b+2])}if(null!==g.index)for(b=0,T=(V=g.index.array).length;b<T;b+=2)I.pushLine(V[b],V[b+1]);else{var be=v instanceof FS?2:1;for(b=0,T=we.length/3-1;b<T;b+=be)I.pushLine(b,b+1)}}}else if(g instanceof py){if(0===(W=v.geometry.vertices).length)continue;(ce=k()).positionScreen.copy(W[0]).applyMatrix4(P);for(be=v instanceof FS?2:1,Z=1,Q=W.length;Z<Q;Z++)(ce=k()).positionScreen.copy(W[Z]).applyMatrix4(P),(Z+1)%be>0||(ue=p[n-2],N.copy(ce.positionScreen),L.copy(ue.positionScreen),!0===z(N,L)&&(N.multiplyScalar(1/N.w),L.multiplyScalar(1/L.w),(s=B()).id=v.id,s.v1.positionScreen.copy(N),s.v2.positionScreen.copy(L),s.z=Math.max(N.z,L.z),s.renderOrder=v.renderOrder,s.material=v.material,v.material.vertexColors===jy&&(s.vertexColors[0].copy(v.geometry.colors[Z]),s.vertexColors[1].copy(v.geometry.colors[Z-1])),w.elements.push(s)))}}else if(v instanceof $_){if(P.multiplyMatrices(C,u),g instanceof py)for(Z=0,Q=(W=v.geometry.vertices).length;Z<Q;Z++){K=W[Z];S.set(K.x,K.y,K.z,1),S.applyMatrix4(P),F(S,v,r)}else if(g instanceof Cy){if(void 0!==(y=g.attributes).position){var we;for(b=0,T=(we=y.position.array).length;b<T;b+=3)S.set(we[b],we[b+1],we[b+2],1),S.applyMatrix4(P),F(S,v,r)}}}else v instanceof aA&&(S.set(u.elements[12],u.elements[13],u.elements[14],1),S.applyMatrix4(C),F(S,v,r))}return!0===h&&w.elements.sort(j),w}},bC=function(e){yb.call(this),this.type="SpriteCanvasMaterial",this.color=new ay(16777215),this.program=function(){},this.setValues(e)};bC.prototype=Object.create(yb.prototype),bC.prototype.constructor=bC,bC.prototype.isSpriteCanvasMaterial=!0,bC.prototype.clone=function(){var e=new bC;return e.copy(this),e.color.copy(this.color),e.program=this.program,e};var wC=function(e){oy.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(e){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};wC.prototype=Object.create(oy.prototype),wC.prototype.constructor=wC;var _C=function(e){oy.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};_C.prototype=Object.create(oy.prototype),_C.prototype.constructor=_C;var SC=function(e){_C.call(this,e)};SC.prototype=Object.create(_C.prototype),SC.prototype.constructor=SC;Object.assign((function(e){console.log("RaytracingRenderer",Dy),e=e||{};var t,r,n=this,i=[],o=!1,s=document.createElement("canvas"),a=s.getContext("2d",{alpha:!0===e.alpha}),l=new ay(0);this.domElement=s,this.autoClear=!0;var c=e.workers,u=e.blockSize||64;this.randomize=e.randomize;var h,d,p,f=[],m=0,v=0;function g(e){e.postMessage({init:[t,r],worker:e.id,blockSize:u})}function y(e){if(!f.length)return o=!1,n.dispatchEvent({type:"complete"});var t=f.pop(),r=t%d*u,i=(t/d|0)*u;e.postMessage({render:!0,x:r,y:i,sceneId:v}),a.fillStyle="#"+e.color,a.fillRect(r,i,u,u)}console.log("%cSpinning off "+c+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(t){for(c=t||navigator.hardwareConcurrency||4;i.length<c;){var r=new Worker(e.workerPath);r.id=m++,r.onmessage=function(e){var t=e.data;if(t&&t.blockSize&&v==t.sceneId){var r=new ImageData(new Uint8ClampedArray(t.data),t.blockSize,t.blockSize);if(a.putImageData(r,t.blockX,t.blockY),console.log("Worker "+this.id,t.time/1e3,(Date.now()-w)/1e3+" s"),i.length>c)return i.splice(i.indexOf(this),1),this.terminate();y(this)}},r.color=(new ay).setHSL(Math.random(),.8,.8).getHexString(),i.push(r),g(r),o&&(r.postMessage({scene:x,camera:b,annex:_,sceneId:v}),y(r))}if(!o)for(;i.length>c;)i.pop().terminate()},this.setWorkers(c),this.setClearColor=function(e,t){l.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,n){s.width=e,s.height=n,t=s.width,r=s.height,a.fillStyle="white",i.forEach(g)},this.setSize(s.width,s.height),this.clear=function(){};var x,b,w,_={},S={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function T(e){var t=e.material;if(t&&!(t.uuid in _)){var r={};for(var n in S)void 0!==t[n]&&(r[n]=t[n]);_[t.uuid]=r}}this.render=function(e,s){o=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),x=e.toJSON(),b=s.toJSON(),++v,e.traverse(T),i.forEach(function(e){e.postMessage({scene:x,camera:b,annex:_,sceneId:v})}),a.clearRect(0,0,t,r),w=Date.now(),d=Math.ceil(t/u),p=Math.ceil(r/u),h=d*p,f=[];for(var l=0;l<h;l++)f.push(l);if(n.randomize)for(l=0;l<h;l++){var c=Math.random()*h|0,m=f[c];f[c]=f[l],f[l]=m}i.forEach(y)}}).prototype,ey.prototype);var TC=function(e){console.log("SoftwareRenderer",Dy);var t,r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),y=g.getContext("2d",{alpha:!0===e.alpha}),x=e.alpha,b={},w={},_=new ay(0),S=1,T=2,M=4,A=(1<<M)-1,E=3,C=1<<E,P=1<<24,O=!1,D=new Kg(0,0,1),N=new Kg,L=1/0,I=1/0,R=0,F=0,k=1/0,U=1/0,B=0,j=0,z=new xC,V=new fy,G=new fy,H=new fy,W=new hy,X=new hy,q=new hy,Y=[],J=0,Z=[],Q=0,K=[],$=0;function ee(e){for(var n=t*r*4,i=0;i<n;i+=4)d[i]=255*e.r|0,d[i+1]=255*e.g|0,d[i+2]=255*e.b|0,d[i+3]=x?0:255;y.fillStyle=x?"rgba(0, 0, 0, 0)":e.getStyle(),y.fillRect(0,0,t,r)}function te(e,t){var r=0,n=0,i=255*e.color.r,o=255*e.color.g,s=255*e.color.b,a=new Uint8Array(768);if(t){for(;r<204;)a[n++]=Math.min(r*i/204,255),a[n++]=Math.min(r*o/204,255),a[n++]=Math.min(r*s/204,255),++r;for(;r<256;)a[n++]=Math.min(i+(r-204)*(255-i)/82,255),a[n++]=Math.min(o+(r-204)*(255-o)/82,255),a[n++]=Math.min(s+(r-204)*(255-s)/82,255),++r}else for(;r<256;)a[n++]=Math.min(r*i/255,255),a[n++]=Math.min(r*o/255,255),a[n++]=Math.min(r*s/255,255),++r;return a}function re(e,t,r,n,i,o,s,a,l){var c=4*r,u=w[l.map.id];if(u.data){var h=u.width,d=l.transparent,p=h-1,f=u.data,m=4*((o*h&p)*h+(i*h&p));if(d){var v=f[m],g=f[m+1],y=f[m+2],x=f[m+3]*l.opacity/255,b=e[c],_=e[c+1],S=e[c+2];e[c]=v*x+b*(1-x),e[c+1]=g*x+_*(1-x),e[c+2]=y*x+S*(1-x),e[c+3]=(l.opacity<<8)-1,255==e[c+3]&&(t[r]=n)}else e[c]=f[m],e[c+1]=f[m+1],e[c+2]=f[m+2],e[c+3]=(l.opacity<<8)-1,t[r]=n}}function ne(e,t,r,n,i,o,s,a,l){var c=4*r,u=w[l.map.id];if(u.data){var h=u.width,d=l.transparent,p=3*(s>0?~~s:0),f=h-1,m=u.data,v=4*((o*h&f)*h+(i*h&f));if(d){var g=l.palette[p]*m[v],y=l.palette[p+1]*m[v+1],x=l.palette[p+2]*m[v+2],b=m[v+3]*l.opacity/256,_=e[c],S=e[c+1],T=e[c+2];e[c]=g*b+_*(1-b),e[c+1]=y*b+S*(1-b),e[c+2]=x*b+T*(1-b),e[c+3]=(l.opacity<<8)-1,255==e[c+3]&&(t[r]=n)}else e[c]=l.palette[p]*m[v]>>8,e[c+1]=l.palette[p+1]*m[v+1]>>8,e[c+2]=l.palette[p+2]*m[v+2]>>8,e[c+3]=(l.opacity<<8)-1,t[r]=n}}function ie(e){var t=e.id,r=b[t];if(r&&e.map&&!w[e.map.id]&&delete b[t],void 0===b[t]||!0===e.needsUpdate){if(e instanceof xb||e instanceof yw||e instanceof bw||e instanceof Ew)if(e instanceof yw?e.palette||(e.palette=te(e,!1)):e instanceof bw&&(e.palette||(e.palette=te(e,!0))),e.map){var n=new TC.Texture;if(n.fromImage(e.map.image),!n.data)return;w[e.map.id]=n,r=e instanceof xb||e instanceof Ew?re:ne}else i=e.vertexColors===By?["var colorOffset = offset * 4;","buffer[ colorOffset ] = face.color.r * 255;","buffer[ colorOffset + 1 ] = face.color.g * 255;","buffer[ colorOffset + 2 ] = face.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"):["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * 255;","buffer[ colorOffset + 1 ] = material.color.g * 255;","buffer[ colorOffset + 2 ] = material.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"),r=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i);else if(e instanceof bb){var i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * (color1.r+color2.r) * 0.5 * 255;","buffer[ colorOffset + 1 ] = material.color.g * (color1.g+color2.g) * 0.5 * 255;","buffer[ colorOffset + 2 ] = material.color.b * (color1.b+color2.b) * 0.5 * 255;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n");r=new Function("buffer, depthBuf, offset, depth, color1, color2, material",i)}else{i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = u * 255;","buffer[ colorOffset + 1 ] = v * 255;","buffer[ colorOffset + 2 ] = 0;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n");r=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i)}b[t]=r,e.needsUpdate=!1}return r}function oe(e,i,h,f,g,y,x,b,w){if(!(e.z<-1||e.z>1||i.z<-1||i.z>1||h.z<-1||h.z>1)){var _=1<<M,P=e.x*o+l|0,O=i.x*o+l|0,D=h.x*o+l|0,N=e.y*s+c|0,k=i.y*s+c|0,U=h.y*s+c|0,B=b.vertexNormalsModel&&b.vertexNormalsModel.length,j=f&&g&&y,z=Math.max(Math.sqrt((P-O)*(P-O)+(N-k)*(N-k)),Math.sqrt((O-D)*(O-D)+(k-U)*(k-U)),Math.sqrt((D-P)*(D-P)+(U-N)*(U-N)));if(!(b instanceof yC)&&z>100*_){var V,G,H,W,X,q,ee,te,re,ne,ie={vertexNormalsModel:[],color:b.color};if(j)$===K.length?(V=new hy,K.push(V),++$,G=new hy,K.push(G),++$,H=new hy,K.push(H),++$):(V=K[$],G=K[++$],H=K[++$],++$),W=(1+i.z)*(i.w/e.w)/(1+e.z),V.copy(f).multiplyScalar(W).add(g).multiplyScalar(1/(W+1)),W=(1+h.z)*(h.w/i.w)/(1+i.z),G.copy(g).multiplyScalar(W).add(y).multiplyScalar(1/(W+1)),W=(1+e.z)*(e.w/h.w)/(1+h.z),H.copy(y).multiplyScalar(W).add(f).multiplyScalar(1/(W+1));return J===Y.length?(X=new fy,Y.push(X),++J,q=new fy,Y.push(q),++J,ee=new fy,Y.push(ee),++J):(X=Y[J],q=Y[++J],ee=Y[++J],++J),X.copy(e).add(i).multiplyScalar(.5),q.copy(i).add(h).multiplyScalar(.5),ee.copy(h).add(e).multiplyScalar(.5),B&&(Q===Z.length?(te=new Kg,Z.push(te),++Q,re=new Kg,Z.push(re),++Q,ne=new Kg,Z.push(ne),++Q):(te=Z[Q],re=Z[++Q],ne=Z[++Q],++Q),te.copy(b.vertexNormalsModel[0]).add(b.vertexNormalsModel[1]).normalize(),re.copy(b.vertexNormalsModel[1]).add(b.vertexNormalsModel[2]).normalize(),ne.copy(b.vertexNormalsModel[2]).add(b.vertexNormalsModel[0]).normalize()),B&&(ie.vertexNormalsModel[0]=b.vertexNormalsModel[0],ie.vertexNormalsModel[1]=te,ie.vertexNormalsModel[2]=ne),oe(e,X,ee,f,V,H,x,ie,w),B&&(ie.vertexNormalsModel[0]=b.vertexNormalsModel[1],ie.vertexNormalsModel[1]=re,ie.vertexNormalsModel[2]=te),oe(i,q,X,g,G,V,x,ie,w),B&&(ie.vertexNormalsModel[0]=te,ie.vertexNormalsModel[1]=re,ie.vertexNormalsModel[2]=ne),oe(X,q,ee,V,G,H,x,ie,w),B&&(ie.vertexNormalsModel[0]=b.vertexNormalsModel[2],ie.vertexNormalsModel[1]=ne,ie.vertexNormalsModel[2]=re),void oe(h,ee,q,y,H,G,x,ie,w)}var se,le,ce,ue,he,de,pe,fe,me,ve,ge,ye,xe=e.z*a+u|0,be=i.z*a+u|0,we=h.z*a+u|0;j=!1;f&&g&&y&&(j=!0,se=f.x,le=1-f.y,ce=g.x,ue=1-g.y,he=y.x,de=1-y.y),B&&(pe=b.vertexNormalsModel[0],fe=b.vertexNormalsModel[1],me=b.vertexNormalsModel[2],ve=255*pe.z,ge=255*fe.z,ye=255*me.z);var _e=P-O,Se=k-N,Te=O-D,Me=U-k,Ae=D-P,Ee=N-U,Ce=Math.max(Math.min(P,O,D)+A>>M,0),Pe=Math.min(Math.max(P,O,D)+A>>M,t),Oe=Math.max(Math.min(N,k,U)+A>>M,0),De=Math.min(Math.max(N,k,U)+A>>M,r);L=Math.min(Ce,L),R=Math.max(Pe,R),I=Math.min(Oe,I),F=Math.max(De,F);var Ne=C,Le=(Ce&=~(Ne-1))<<M,Ie=(Oe&=~(Ne-1))<<M,Re=Se*(Le-P)+_e*(Ie-N),Fe=Me*(Le-O)+Te*(Ie-k),ke=Ee*(Le-D)+Ae*(Ie-U);(Se>0||0==Se&&_e>0)&&Re++,(Me>0||0==Me&&Te>0)&&Fe++,(Ee>0||0==Ee&&Ae>0)&&ke++,Re=Re-1>>M,Fe=Fe-1>>M,ke=ke-1>>M;var Ue,Be,je,ze,Ve,Ge=xe-be,He=we-xe,We=1/(_e*Ee-Ae*Se),Xe=We*(Ge*Ee-He*Se),qe=We*(Ge*Ae-_e*He),Ye=xe+(Le-P)*Xe+(Ie-N)*qe|0;if(Xe=Xe*_|0,qe=qe*_|0,j){var Je=se-ce,Ze=he-se,Qe=We*(Je*Ee-Ze*Se),Ke=We*(Je*Ae-_e*Ze),$e=le-ue,et=de-le;je=se+(Le-P)*Qe+(Ie-N)*Ke,ze=le+(Le-P)*(Ue=We*($e*Ee-et*Se))+(Ie-N)*(Be=We*($e*Ae-_e*et)),Qe*=_,Ke*=_,Ue*=_,Be*=_}if(B){var tt,rt=ve-ge,nt=ye-ve,it=We*(rt*Ee-nt*Se);Ve=ve+(Le-P)*it+(Ie-N)*(tt=We*(rt*Ae-_e*nt)),it*=_,tt*=_}var ot=Ne-1,st=0,at=0,lt=0,ct=0,ut=0,ht=0,dt=0,pt=0;_e>=0?at-=ot*_e:st-=ot*_e,Se>=0?at-=ot*Se:st-=ot*Se,Te>=0?ct-=ot*Te:lt-=ot*Te,Me>=0?ct-=ot*Me:lt-=ot*Me,Ae>=0?ht-=ot*Ae:ut-=ot*Ae,Ee>=0?ht-=ot*Ee:ut-=ot*Ee,Xe>=0?pt+=ot*Xe:dt+=ot*Xe,qe>=0?pt+=ot*qe:dt+=ot*qe;var ft,mt,vt,gt=t-Ne,yt=Re,xt=Fe,bt=ke,wt=Ye,_t=-Ne,St=_t*Se,Tt=_t*Me,Mt=_t*Ee,At=_t*Xe;j&&(ft=_t*Qe,mt=_t*Ue),B&&(vt=_t*it);for(var Et=Ce,Ct=Oe;Ct<De;Ct+=Ne){for(;Et>=Ce&&Et<Pe&&yt>=at&&xt>=ct&&bt>=ht;)Et+=_t,yt+=St,xt+=Tt,bt+=Mt,wt+=At,j&&(je+=ft,ze+=mt),B&&(Ve+=vt);for(_t=-_t,St=-St,Tt=-Tt,Mt=-Mt,At=-At,j&&(ft=-ft,mt=-mt),B&&(vt=-vt);Et+=_t,yt+=St,xt+=Tt,bt+=Mt,wt+=At,j&&(je+=ft,ze+=mt),B&&(Ve+=vt),!(Et<Ce||Et>=Pe);)if(yt<at){if(St<0)break}else if(xt<ct){if(Tt<0)break}else if(bt<ht){if(Mt<0)break}else{var Pt=Et>>E,Ot=Ct>>E,Dt=Pt+Ot*n,Nt=wt+dt;if(!(m[Dt]<Nt)){var Lt=v[Dt];Lt&T&&ae(Pt,Ot),v[Dt]=Lt&~(S|T);var It=Et+Ct*t;if(yt>=st&&xt>=lt&&bt>=ut){var Rt=wt+pt;m[Dt]=Math.min(m[Dt],Rt);var Ft=yt,kt=xt,Ut=wt;j&&(Ht=je,Wt=ze),B&&(Xt=Ve);for(var Bt=0;Bt<Ne;Bt++){var jt=Ft,zt=kt,Vt=Ut;j&&(Yt=Ht,Jt=Wt),B&&(Zt=Xt);for(var Gt=0;Gt<Ne;Gt++){(Kt=Vt)<p[It]&&x(d,p,It,Kt,Yt,Jt,Zt,b,w),jt+=Se,zt+=Me,Vt+=Xe,j&&(Yt+=Qe,Jt+=Ue),B&&(Zt+=it),It++}Ft+=_e,kt+=Te,Ut+=qe,j&&(Ht+=Ke,Wt+=Be),B&&(Xt+=tt),It+=gt}}else{Ft=yt,kt=xt;var Ht,Wt,Xt,qt=bt;Ut=wt;j&&(Ht=je,Wt=ze),B&&(Xt=Ve);for(Bt=0;Bt<Ne;Bt++){jt=Ft,zt=kt;var Yt,Jt,Zt,Qt=qt;Vt=Ut;j&&(Yt=Ht,Jt=Wt),B&&(Zt=Xt);for(Gt=0;Gt<Ne;Gt++){var Kt;if((jt|zt|Qt)>=0)(Kt=Vt)<p[It]&&x(d,p,It,Kt,Yt,Jt,Zt,b,w);jt+=Se,zt+=Me,Qt+=Ee,Vt+=Xe,j&&(Yt+=Qe,Jt+=Ue),B&&(Zt+=it),It++}Ft+=_e,kt+=Te,qt+=Ae,Ut+=qe,j&&(Ht+=Ke,Wt+=Be),B&&(Xt+=tt),It+=gt}}}}yt+=Ne*_e,xt+=Ne*Te,bt+=Ne*Ae,wt+=Ne*qe,j&&(je+=Ne*Ke,ze+=Ne*Be),B&&(Ve+=Ne*tt)}}}function se(e,b,w,k,U,B){if(O||(O=!0,C=1<<(E=0),function(e,b){n=Math.floor(e/C),i=Math.floor(b/C);var w=1<<M;o=w*(t=n*C)/2,s=-w*(r=i*C)/2,a=P/2,l=w*t/2+.5,c=w*r/2+.5,u=P/2+.5,g.width=t,g.height=r,y.fillStyle=x?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,t,r),h=y.getImageData(0,0,t,r),d=h.data,p=new Int32Array(d.length/4),f=n*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;ee(_)}(g.width,g.height)),!(e.z<-1||e.z>1||b.z<-1||b.z>1)){var j=Math.floor(.5*(B.linewidth-1)),z=e.x*o+l|0,V=b.x*o+l|0,G=e.y*s+c|0,H=b.y*s+c|0,W=e.z*a+u|0,X=b.z*a+u|0,q=z-V,Y=G-H,J=W-X,Z=Math.max(Math.min(z,V)+A>>M,0),Q=Math.min(Math.max(z,V)+A>>M,t),K=Math.max(Math.min(G,H)+A>>M,0),$=Math.min(Math.max(G,H)+A>>M,r),te=Math.max(Math.min(W,X)+A>>M,0),re=Math.max(W,X)+A>>M;L=Math.min(Z,L),R=Math.max(Q,R),I=Math.min(K,I),F=Math.max($,F);var ne,ie,oe,se,le,ce=Math.sqrt(Y*Y+q*q),ue=q/ce,he=Y/ce,de=J/ce;for(N.set(ue,he,de),N.cross(D),N.normalize();ce>0;){ne=(ne=V+ce*ue)+A>>M,ie=(ie=H+ce*he)+A>>M,le=X+ce*de+A>>M;for(var pe=-j;pe<=j;++pe)if(oe=Math.floor(ne+N.x*pe),se=Math.floor(ie+N.y*pe),!(L>=oe||R<=oe||I>=se||F<=se)){var fe=oe>>E,me=se>>E,ve=fe+me*n;if(!(m[ve]<te)){m[ve]=Math.min(m[ve],re);var ge=v[ve];ge&T&&ae(fe,me),v[ve]=ge&~(S|T);var ye=oe+se*t;le<p[ye]&&U(d,p,ye,le,w,k,B)}}--ce}}}function ae(e,r){for(var n=e*C+r*C*t,i=4*n,o=t-C,s=4*o,a=0;a<C;a++){for(var l=0;l<C;l++)p[n++]=P,d[i++]=255*_.r|0,d[i++]=255*_.g|0,d[i++]=255*_.b|0,d[i++]=x?0:255;n+=o,i+=s}}this.domElement=g,this.autoClear=!0,this.setClearColor=function(e){_.set(e),ee(_)},this.setPixelRatio=function(){},this.setSize=function(e,b){n=Math.floor(e/C),i=Math.floor(b/C);var w=1<<M;o=w*(t=n*C)/2,s=-w*(r=i*C)/2,a=P/2,l=w*t/2+.5,c=w*r/2+.5,u=P/2+.5,g.width=t,g.height=r,y.fillStyle=x?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,t,r),h=y.getImageData(0,0,t,r),d=h.data,p=new Int32Array(d.length/4),f=n*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;ee(_)},this.setSize(g.width,g.height),this.clear=function(){L=1/0,I=1/0,R=0,F=0,J=0,Q=0,$=0;for(var e=0;e<f;e++)m[e]=P,v[e]=v[e]&S?S:T},this.render=function(e,t){this.clear();var r=e.background;r&&r.isColor&&ee(r);for(var o=z.projectScene(e,t,!1,!1).elements,s=0,a=o.length;s<a;s++){var l=o[s],c=l.material;if(p=ie(c))if(l instanceof mC)l.uvs?oe(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,l.uvs[0],l.uvs[1],l.uvs[2],p,l,c):oe(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,null,null,null,p,l,c);else if(l instanceof yC){var u=.5*l.scale.x,d=.5*l.scale.y;V.copy(l),V.x-=u,V.y+=d,G.copy(l),G.x-=u,G.y-=d,H.copy(l),H.x+=u,H.y+=d,c.map?(W.set(0,1),X.set(0,0),q.set(1,1),oe(V,G,H,W,X,q,p,l,c)):oe(V,G,H,null,null,null,p,l,c),V.copy(l),V.x+=u,V.y+=d,G.copy(l),G.x-=u,G.y-=d,H.copy(l),H.x+=u,H.y-=d,c.map?(W.set(1,1),X.set(0,0),q.set(1,0),oe(V,G,H,W,X,q,p,l,c)):oe(V,G,H,null,null,null,p,l,c)}else if(l instanceof gC){var p=ie(c);se(l.v1.positionScreen,l.v2.positionScreen,l.vertexColors[0],l.vertexColors[1],p,c)}}!function(){for(var e=0,t=0;t<i;t++)for(var r=0;r<n;r++)v[e]&T&&(ae(r,t),v[e]=S),e++}();var f=Math.min(L,k),m=Math.min(I,U),g=Math.max(R,B)-f,x=Math.max(F,j)-m;f!==1/0&&y.putImageData(h,0,0,f,m,g,x),k=L,U=I,B=R,j=F}};TC.Texture=function(){var e;this.fromImage=function(t){if(!(!t||t.width<=0||t.height<=0)){void 0===e&&(e=document.createElement("canvas"));var r=t.width>t.height?t.width:t.height;r=Zg.ceilPowerOfTwo(r),e.width==r&&e.height==r||(e.width=r,e.height=r);var n=e.getContext("2d");n.clearRect(0,0,r,r),n.drawImage(t,0,0,r,r);var i=n.getImageData(0,0,r,r);this.data=i.data,this.width=r,this.height=r,this.srcUrl=t.src}}};var MC=function(e){oy.call(this),this.node=e};MC.prototype=Object.create(oy.prototype),MC.prototype.constructor=MC;var AC=new nw,EC=new _T;function CC(){this.seq=[],this.map={}}var PC=[],OC=[],DC=new Float32Array(16),NC=new Float32Array(9);function LC(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,o=PC[i];if(void 0===o&&(o=new Float32Array(i),PC[i]=o),0!==t){n.toArray(o,0);for(var s=1,a=0;s!==t;++s)a+=r,e[s].toArray(o,a)}return o}function IC(e,t){var r=OC[t];void 0===r&&(r=new Int32Array(t),OC[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocTextureUnit();return r}function RC(e,t){e.uniform1f(this.addr,t)}function FC(e,t){e.uniform1i(this.addr,t)}function kC(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function UC(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function BC(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function jC(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function zC(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(NC.set(t.elements),e.uniformMatrix3fv(this.addr,!1,NC))}function VC(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(DC.set(t.elements),e.uniformMatrix4fv(this.addr,!1,DC))}function GC(e,t,r){var n=r.allocTextureUnit();e.uniform1i(this.addr,n),r.setTexture2D(t||AC,n)}function HC(e,t,r){var n=r.allocTextureUnit();e.uniform1i(this.addr,n),r.setTextureCube(t||EC,n)}function WC(e,t){e.uniform2iv(this.addr,t)}function XC(e,t){e.uniform3iv(this.addr,t)}function qC(e,t){e.uniform4iv(this.addr,t)}function YC(e,t){e.uniform1fv(this.addr,t)}function JC(e,t){e.uniform1iv(this.addr,t)}function ZC(e,t){e.uniform2fv(this.addr,LC(t,this.size,2))}function QC(e,t){e.uniform3fv(this.addr,LC(t,this.size,3))}function KC(e,t){e.uniform4fv(this.addr,LC(t,this.size,4))}function $C(e,t){e.uniformMatrix2fv(this.addr,!1,LC(t,this.size,4))}function eP(e,t){e.uniformMatrix3fv(this.addr,!1,LC(t,this.size,9))}function tP(e,t){e.uniformMatrix4fv(this.addr,!1,LC(t,this.size,16))}function rP(e,t,r){var n=t.length,i=IC(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTexture2D(t[o]||AC,i[o])}function nP(e,t,r){var n=t.length,i=IC(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTextureCube(t[o]||EC,i[o])}function iP(e,t,r){this.id=e,this.addr=r,this.setValue=function(e){switch(e){case 5126:return RC;case 35664:return kC;case 35665:return UC;case 35666:return BC;case 35674:return jC;case 35675:return zC;case 35676:return VC;case 35678:case 36198:return GC;case 35680:return HC;case 5124:case 35670:return FC;case 35667:case 35671:return WC;case 35668:case 35672:return XC;case 35669:case 35673:return qC}}(t.type)}function oP(e,t,r){this.id=e,this.addr=r,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return YC;case 35664:return ZC;case 35665:return QC;case 35666:return KC;case 35674:return $C;case 35675:return eP;case 35676:return tP;case 35678:return rP;case 35680:return nP;case 5124:case 35670:return JC;case 35667:case 35671:return WC;case 35668:case 35672:return XC;case 35669:case 35673:return qC}}(t.type)}function sP(e){this.id=e,CC.call(this)}sP.prototype.setValue=function(e,t){for(var r=this.seq,n=0,i=r.length;n!==i;++n){var o=r[n];o.setValue(e,t[o.id])}};var aP=/([\w\d_]+)(\])?(\[|\.)?/g;function lP(e,t){e.seq.push(t),e.map[t.id]=t}function cP(e,t,r){var n=e.name,i=n.length;for(aP.lastIndex=0;;){var o=aP.exec(n),s=aP.lastIndex,a=o[1],l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===i){lP(r,void 0===c?new iP(a,e,t):new oP(a,e,t));break}var u=r.map[a];void 0===u&&lP(r,u=new sP(a)),r=u}}function uP(e,t,r){CC.call(this),this.renderer=r;for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;++i){var o=e.getActiveUniform(t,i),s=o.name;cP(o,e.getUniformLocation(t,s),this)}}uP.prototype.setValue=function(e,t,r){var n=this.map[t];void 0!==n&&n.setValue(e,r,this.renderer)},uP.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},uP.upload=function(e,t,r,n){for(var i=0,o=t.length;i!==o;++i){var s=t[i],a=r[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}},uP.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var o=e[n];o.id in t&&r.push(o)}return r};function hP(e){Kb.call(this),this.cameras=e||[]}function dP(e){"string"==typeof e&&(console.warn("Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}hP.prototype=Object.assign(Object.create(Kb.prototype),{constructor:hP,isArrayCamera:!0}),dP.prototype.clone=function(){return new dP(void 0===this.value.clone?this.value:this.value.clone())};new hy(1/1024,1/512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","","","","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","","#if (FXAA_PC == 1)","","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","    #endif","","                        }","                        #endif","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n");var pP={packVector3:["float vec3_to_float( vec3 data ) {","\tconst float unit = 255.0/256.0;","\thighp float compressed = fract( data.x * unit ) + floor( data.y * unit * 255.0 ) + floor( data.z * unit * 255.0 ) * 255.0;","\treturn compressed;","}"].join("\n"),unpackFloat:["vec3 float_to_vec3( float data ) {","\tconst float unit = 255.0;","\tvec3 uncompressed;","\tuncompressed.x = fract( data );","\tfloat zInt = floor( data / unit );","\tuncompressed.z = fract( zInt / unit );","\tuncompressed.y = fract( floor( data - ( zInt * unit ) ) / unit );","\treturn uncompressed;","}"].join("\n"),packNormal:["vec2 normal_to_vec2( vec3 normal ) {","\treturn normal.xy / sqrt( normal.z * 8.0 + 8.0 ) + 0.5;","}"].join("\n"),unpackVector2:["vec3 vec2_to_normal( vec2 data ) {","\tvec2 fenc = data * 4.0 - 2.0;","\tfloat f = dot( fenc, fenc );","\tfloat g = sqrt( 1.0 - f / 4.0 );","\tvec3 normal;","\tnormal.xy = fenc * g;","\tnormal.z = 1.0 - f / 2.0;","\treturn normal;","}"].join("\n"),computeTextureCoord:["vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );"].join("\n"),packNormalDepth:["vec4 packedNormalDepth;","packedNormalDepth.xyz = normal * 0.5 + 0.5;","packedNormalDepth.w = position.z / position.w;"].join("\n"),unpackNormalDepth:["vec4 normalDepthMap = texture2D( samplerNormalDepth, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = normalDepthMap.xyz * 2.0 - 1.0;"].join("\n"),packNormalDepthShininess:["vec4 packedNormalDepthShininess;","packedNormalDepthShininess.xy = normal_to_vec2( normal );","packedNormalDepthShininess.z = shininess;","packedNormalDepthShininess.w = position.z / position.w;"].join("\n"),unpackNormalDepthShininess:["vec4 normalDepthMap = texture2D( samplerNormalDepthShininess, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = vec2_to_normal( normalDepthMap.xy );","float shininess = normalDepthMap.z;"].join("\n"),packColor:["vec4 packedColor;","packedColor.x = vec3_to_float( diffuseColor.rgb );","packedColor.y = vec3_to_float( emissiveColor );","packedColor.z = vec3_to_float( specularColor );","packedColor.w = shininess;"].join("\n"),unpackColor:["vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 diffuseColor = float_to_vec3( colorMap.x );","vec3 emissiveColor = float_to_vec3( colorMap.y );","vec3 specularColor = float_to_vec3( colorMap.z );","float shininess = colorMap.w;"].join("\n"),packLight:["vec4 packedLight;","packedLight.xyz = lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * attenuation;","packedLight.w = lightIntensity * specular * max( dot( lightVector, normal ), 0.0 ) * attenuation;"].join("\n"),computeVertexPositionVS:["vec2 xy = texCoord * 2.0 - 1.0;","vec4 vertexPositionProjected = vec4( xy, depth, 1.0 );","vec4 vertexPositionVS = matProjInverse * vertexPositionProjected;","vertexPositionVS.xyz /= vertexPositionVS.w;","vertexPositionVS.w = 1.0;"].join("\n"),computeSpecular:["vec3 halfVector = normalize( lightVector - normalize( vertexPositionVS.xyz ) );","float dotNormalHalf = max( dot( normal, halfVector ), 0.0 );","float specular = 0.31830988618 * ( shininess * 0.5 + 1.0 ) * pow( dotNormalHalf, shininess );"].join("\n"),combine:["gl_FragColor = vec4( lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * ( diffuseColor + specular * specularColor ) * attenuation, 1.0 );"].join("\n")},fP={commonUniforms:{matProjInverse:new dP(new Qg),viewWidth:new dP(800),viewHeight:new dP(600)}};["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",pP.packNormalDepth,"\tgl_FragColor = packedNormalDepth;","}"].join("\n"),new dP(null),new dP(new fy(0,0,1,1)),new dP(new ay(0)),new dP(new ay(0)),new dP(new ay(0)),new dP(30),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","#include <uv_pars_fragment>","#include <map_pars_fragment>",pP.packVector3,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;","#include <map_fragment>",pP.packColor,"\tgl_FragColor = packedColor;","}"].join("\n"),Object.assign({samplerColor:new dP(null)},fP.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;",pP.unpackFloat,"void main() {",pP.computeTextureCoord,pP.unpackColor,"\tgl_FragColor = vec4( emissiveColor, 1.0 );","}"].join("\n"),Object.assign({samplerNormalDepth:new dP(null),samplerColor:new dP(null),lightColor:new dP(new ay(0)),lightPositionVS:new dP(new Kg(0,1,0)),lightIntensity:new dP(1),lightRadius:new dP(1)},fP.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",pP.unpackFloat,"void main() {",pP.computeTextureCoord,pP.unpackNormalDepth,pP.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",pP.unpackColor,pP.computeSpecular,"\t//float cutoff = 0.3;","\t//float denom = distance / lightRadius + 1.0;","\t//float attenuation = 1.0 / ( denom * denom );","\t//attenuation = ( attenuation - cutoff ) / ( 1.0 - cutoff );","\t//attenuation = max( attenuation, 0.0 );","\t//attenuation *= attenuation;","\t//diffuseColor *= saturate( -distance / lightRadius + 1.0 );","\t//float attenuation = 1.0;","\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",pP.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new dP(null),samplerColor:new dP(null),lightColor:new dP(new ay(0)),lightDirectionVS:new dP(new Kg(0,1,0)),lightPositionVS:new dP(new Kg(0,1,0)),lightAngle:new dP(1),lightIntensity:new dP(1)},fP.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",pP.unpackFloat,"void main() {",pP.computeTextureCoord,pP.unpackNormalDepth,pP.computeVertexPositionVS,pP.unpackColor,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}","\tdiffuseColor *= spot;",pP.computeSpecular,"\tconst float attenuation = 1.0;",pP.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new dP(null),samplerColor:new dP(null),lightColor:new dP(new ay(0)),lightDirectionVS:new dP(new Kg(0,1,0)),lightIntensity:new dP(1)},fP.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",pP.unpackFloat,"void main() {",pP.computeTextureCoord,pP.unpackNormalDepth,pP.computeVertexPositionVS,pP.unpackColor,"\tvec3 lightVector = normalize( lightDirectionVS );",pP.computeSpecular,"\tconst float attenuation = 1.0;",pP.combine,"}"].join("\n"),new dP(30),["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","uniform float shininess;",pP.packNormal,"void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",pP.packNormalDepthShininess,"\tgl_FragColor = packedNormalDepthShininess;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new dP(null),lightColor:new dP(new ay(0)),lightPositionVS:new dP(new Kg(0,1,0)),lightIntensity:new dP(1),lightRadius:new dP(1)},fP.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",pP.unpackFloat,pP.unpackVector2,"void main() {",pP.computeTextureCoord,pP.unpackNormalDepthShininess,pP.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",pP.computeSpecular,"\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",pP.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new dP(null),lightColor:new dP(new ay(0)),lightDirectionVS:new dP(new Kg(0,1,0)),lightPositionVS:new dP(new Kg(0,1,0)),lightAngle:new dP(1),lightIntensity:new dP(1)},fP.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",pP.unpackFloat,pP.unpackVector2,"void main() {",pP.computeTextureCoord,pP.unpackNormalDepthShininess,pP.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}",pP.computeSpecular,"\tconst float attenuation = 1.0;",pP.packLight,"\tgl_FragColor = spot * packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new dP(null),lightColor:new dP(new ay(0)),lightDirectionVS:new dP(new Kg(0,1,0)),lightIntensity:new dP(1)},fP.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",pP.unpackFloat,pP.unpackVector2,"void main() {",pP.computeTextureCoord,pP.unpackNormalDepthShininess,pP.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightDirectionVS );",pP.computeSpecular,"\tconst float attenuation = 1.0;",pP.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerLight:new dP(null),map:new dP(null),offsetRepeat:new dP(new fy(0,0,1,1)),diffuse:new dP(new ay(0)),emissive:new dP(new ay(0)),specular:new dP(new ay(0)),shininess:new dP(30)},fP.commonUniforms),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform sampler2D samplerLight;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float viewHeight;","uniform float viewWidth;","#include <uv_pars_fragment>","#include <map_pars_fragment>",pP.unpackFloat,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;",pP.computeTextureCoord,"\tvec4 light = texture2D( samplerLight, texCoord );","#include <map_fragment>","\tvec3 diffuseFinal = diffuseColor.rgb * light.rgb;","\tvec3 emissiveFinal = emissiveColor;","\tvec3 specularFinal = specularColor * light.rgb * light.a;","\tgl_FragColor = vec4( diffuseFinal + emissiveFinal + specularFinal, 1.0 );","}"].join("\n"),new dP(null),["varying vec2 texCoord;","void main() {","\tvec4 pos = vec4( sign( position.xy ), 0.0, 1.0 );","\ttexCoord = pos.xy * vec2( 0.5 ) + 0.5;","\tgl_Position = pos;","}"].join("\n"),["varying vec2 texCoord;","uniform sampler2D samplerResult;","void main() {","\tgl_FragColor = texture2D( samplerResult, texCoord );","}"].join("\n");(function(e,t){Cy.call(this);var r=[],n=[],i=[],o=[1,1,1],s=[1,1,0],a=new Kg(0,1,0),l=new Kg,c=new Kg,u=new $g,h=new $g;h.setFromAxisAngle(a,Math.PI/2);var d=new Kg,p=new Kg;p.copy(e.getPointAt(0));for(var f=[new Kg(-.225,0,0),new Kg(0,-.05,0),new Kg(0,-.175,0),new Kg(0,-.05,0),new Kg(.225,0,0),new Kg(0,-.175,0)],m=2*Math.PI,v=5,g=[],y=0;y<v;y++){var x=y/v*m;g.push(new Kg(.06*Math.sin(x),.06*Math.cos(x),0))}v=6;var b=[];for(y=0;y<v;y++)x=y/v*m,b.push(new Kg(.025*Math.sin(x),.025*Math.cos(x),0));var w=new Kg,_=new Kg;function S(e,t){_.set(0,0,-1).applyQuaternion(u);for(var o=0;o<e.length;o++)w.copy(e[o]),w.applyQuaternion(u),w.add(d),r.push(w.x,w.y,w.z),n.push(_.x,_.y,_.z),i.push(t[0],t[1],t[2]);for(_.set(0,0,1).applyQuaternion(u),o=e.length-1;o>=0;o--)w.copy(e[o]),w.applyQuaternion(u),w.add(d),r.push(w.x,w.y,w.z),n.push(_.x,_.y,_.z),i.push(t[0],t[1],t[2])}var T=new Kg,M=new Kg,A=new Kg,E=new Kg,C=new Kg,P=new Kg,O=new Kg,D=new Kg;function N(e,t,o){for(var s=0,a=e.length;s<a;s++){var l=e[s],c=e[(s+1)%a];T.copy(l).add(t),T.applyQuaternion(u),T.add(d),M.copy(c).add(t),M.applyQuaternion(u),M.add(d),A.copy(c).add(t),A.applyQuaternion(h),A.add(p),E.copy(l).add(t),E.applyQuaternion(h),E.add(p),r.push(T.x,T.y,T.z),r.push(M.x,M.y,M.z),r.push(E.x,E.y,E.z),r.push(M.x,M.y,M.z),r.push(A.x,A.y,A.z),r.push(E.x,E.y,E.z),C.copy(l),C.applyQuaternion(u),C.normalize(),P.copy(c),P.applyQuaternion(u),P.normalize(),O.copy(c),O.applyQuaternion(h),O.normalize(),D.copy(l),D.applyQuaternion(h),D.normalize(),n.push(C.x,C.y,C.z),n.push(P.x,P.y,P.z),n.push(D.x,D.y,D.z),n.push(P.x,P.y,P.z),n.push(O.x,O.y,O.z),n.push(D.x,D.y,D.z),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2])}}var L=new Kg;for(y=1;y<=t;y++)d.copy(e.getPointAt(y/t)),a.set(0,1,0),l.subVectors(d,p).normalize(),c.crossVectors(a,l).normalize(),a.crossVectors(l,c),x=Math.atan2(l.x,l.z),u.setFromAxisAngle(a,x),y%2==0&&S(f,s),N(g,L.set(0,-.125,0),s),N(b,L.set(.2,0,0),o),N(b,L.set(-.2,0,0),o),p.copy(d),h.copy(u);this.addAttribute("position",new my(new Float32Array(r),3)),this.addAttribute("normal",new my(new Float32Array(n),3)),this.addAttribute("color",new my(new Float32Array(i),3))}).prototype=Object.create(Cy.prototype),(function(e,t){Cy.call(this);var r=[],n=[],i=new $g,o=new Kg(0,1,0),s=new Kg,a=new Kg,l=[new Kg(0,.05,-.05),new Kg(0,.05,.05),new Kg(0,-.05,0)],c=[new Kg(-.05,0,.05),new Kg(-.05,0,-.05),new Kg(.05,0,0)],u=[new Kg(.05,0,-.05),new Kg(.05,0,.05),new Kg(-.05,0,0)],h=new Kg,d=new Kg,p=new Kg,f=new Kg,m=new Kg,v=new Kg,g=new Kg,y=new Kg;function x(e,t,o){for(var s=0,a=e.length;s<a;s++){var l=e[s],c=e[(s+1)%a];h.copy(l),h.applyQuaternion(i),h.add(t),d.copy(c),d.applyQuaternion(i),d.add(t),p.copy(c),p.applyQuaternion(i),p.add(o),f.copy(l),f.applyQuaternion(i),f.add(o),r.push(h.x,h.y,h.z),r.push(d.x,d.y,d.z),r.push(f.x,f.y,f.z),r.push(d.x,d.y,d.z),r.push(p.x,p.y,p.z),r.push(f.x,f.y,f.z),m.copy(l),m.applyQuaternion(i),m.normalize(),v.copy(c),v.applyQuaternion(i),v.normalize(),g.copy(c),g.applyQuaternion(i),g.normalize(),y.copy(l),y.applyQuaternion(i),y.normalize(),n.push(m.x,m.y,m.z),n.push(v.x,v.y,v.z),n.push(y.x,y.y,y.z),n.push(v.x,v.y,v.z),n.push(g.x,g.y,g.z),n.push(y.x,y.y,y.z)}}for(var b=new Kg,w=new Kg,_=1;_<=t;_++){s.copy(e.getPointAt(_/t)),a.copy(e.getTangentAt(_/t));var S=Math.atan2(a.x,a.z);i.setFromAxisAngle(o,S),s.y>10?(b.set(-.75,-.35,0),b.applyQuaternion(i),b.add(s),w.set(.75,-.35,0),w.applyQuaternion(i),w.add(s),x(l,b,w),b.set(-.7,-.3,0),b.applyQuaternion(i),b.add(s),w.set(-.7,-s.y,0),w.applyQuaternion(i),w.add(s),x(c,b,w),b.set(.7,-.3,0),b.applyQuaternion(i),b.add(s),w.set(.7,-s.y,0),w.applyQuaternion(i),w.add(s),x(u,b,w)):(b.set(0,-.2,0),b.applyQuaternion(i),b.add(s),w.set(0,-s.y,0),w.applyQuaternion(i),w.add(s),x(u,b,w))}this.addAttribute("position",new my(new Float32Array(r),3)),this.addAttribute("normal",new my(new Float32Array(n),3))}).prototype=Object.create(Cy.prototype),(function(e,t){Cy.call(this);var r=[],n=new Kg(0,1,0),i=new Kg,o=new $g,s=new $g;s.setFromAxisAngle(n,Math.PI/2);var a=new Kg,l=new Kg;l.copy(e.getPointAt(0)),l.y=0;for(var c=new Kg,u=new Kg,h=new Kg,d=new Kg,p=1;p<=t;p++){a.copy(e.getPointAt(p/t)),a.y=0,i.subVectors(a,l);var f=Math.atan2(i.x,i.z);o.setFromAxisAngle(n,f),c.set(-.3,0,0),c.applyQuaternion(o),c.add(a),u.set(.3,0,0),u.applyQuaternion(o),u.add(a),h.set(.3,0,0),h.applyQuaternion(s),h.add(l),d.set(-.3,0,0),d.applyQuaternion(s),d.add(l),r.push(c.x,c.y,c.z),r.push(u.x,u.y,u.z),r.push(d.x,d.y,d.z),r.push(u.x,u.y,u.z),r.push(h.x,h.y,h.z),r.push(d.x,d.y,d.z),l.copy(a),s.copy(o)}this.addAttribute("position",new my(new Float32Array(r),3))}).prototype=Object.create(Cy.prototype),(function(){Cy.call(this);for(var e=[],t=0;t<100;t++){var r=800*Math.random()-400,n=50*Math.random()+50,i=800*Math.random()-400,o=40*Math.random()+20;e.push(r-o,n,i-o),e.push(r+o,n,i-o),e.push(r-o,n,i+o),e.push(r+o,n,i-o),e.push(r+o,n,i+o),e.push(r-o,n,i+o)}this.addAttribute("position",new my(new Float32Array(e),3))}).prototype=Object.create(Cy.prototype),(function(e){Cy.call(this);var t=[],r=[],n=new Rw;n.ray.direction.set(0,-1,0);for(var i=0;i<2e3;i++){var o=500*Math.random()-250,s=500*Math.random()-250;n.ray.origin.set(o,50,s);var a=n.intersectObject(e);if(0!==a.length){var l=a[0].point.y,c=5*Math.random()+.5,u=Math.random()*Math.PI*2;t.push(o+Math.sin(u),l,s+Math.cos(u)),t.push(o,l+c,s),t.push(o+Math.sin(u+Math.PI),l,s+Math.cos(u+Math.PI)),u+=Math.PI/2,t.push(o+Math.sin(u),l,s+Math.cos(u)),t.push(o,l+c,s),t.push(o+Math.sin(u+Math.PI),l,s+Math.cos(u+Math.PI));for(var h=.1*Math.random(),d=0;d<6;d++)r.push(.2+h,.4+h,0)}}this.addAttribute("position",new my(new Float32Array(t),3)),this.addAttribute("color",new my(new Float32Array(r),3))}).prototype=Object.create(Cy.prototype);new hy(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n"),new hy(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n"),new hy(.5,.5),new ay(16772608),new ay(0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n"),["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n"),new hy,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if (depthblur) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n"),new Kg(2,2,2),new Kg(1,1,1),new Kg(0,0,0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n"),new ay(16777215),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n"),new hy(512,512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n"),["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float angle = hue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (saturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","}","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","vec2 p = vUv;","if (side == 0){","if (p.x > 0.5) p.x = 1.0 - p.x;","}else if (side == 1){","if (p.x < 0.5) p.x = 1.0 - p.x;","}else if (side == 2){","if (p.y < 0.5) p.y = 1.0 - p.y;","}else if (side == 3){","if (p.y > 0.5) p.y = 1.0 - p.y;","} ","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n"),new hy(512,512),new hy(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n"),["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","vec2 parallaxMap( in vec3 V ) {","float initialHeight = texture2D( bumpMap, vUv ).r;","vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","return vUv - texCoordOffset;","}","#else","vec2 parallaxMap( in vec3 V ) {","float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","float layerHeight = 1.0 / numLayers;","float currentLayerHeight = 0.0;","vec2 dtex = parallaxScale * V.xy / V.z / numLayers;","vec2 currentTextureCoords = vUv;","float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","for ( int i = 0; i < 30; i += 1 ) {","if ( heightFromTexture <= currentLayerHeight ) {","break;","}","currentLayerHeight += layerHeight;","currentTextureCoords -= dtex;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","}","#ifdef USE_STEEP_PARALLAX","return currentTextureCoords;","#elif defined( USE_RELIEF_PARALLAX )","vec2 deltaTexCoord = dtex / 2.0;","float deltaHeight = layerHeight / 2.0;","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","const int numSearches = 5;","for ( int i = 0; i < numSearches; i += 1 ) {","deltaTexCoord /= 2.0;","deltaHeight /= 2.0;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","if( heightFromTexture > currentLayerHeight ) {","currentTextureCoords -= deltaTexCoord;","currentLayerHeight += deltaHeight;","} else {","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","}","}","return currentTextureCoords;","#elif defined( USE_OCLUSION_PARALLAX )","vec2 prevTCoords = currentTextureCoords + dtex;","float nextH = heightFromTexture - currentLayerHeight;","float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;","float weight = nextH / ( nextH - prevH );","return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","#else","return vUv;","#endif","}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","vec2 texDx = dFdx( vUv );","vec2 texDy = dFdy( vUv );","vec3 vSigmaX = dFdx( surfPosition );","vec3 vSigmaY = dFdy( surfPosition );","vec3 vR1 = cross( vSigmaY, surfNormal );","vec3 vR2 = cross( surfNormal, vSigmaX );","float fDet = dot( vSigmaX, vR1 );","vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","vec3 vProjVtex;","vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","vProjVtex.z = dot( surfNormal, viewPosition );","return parallaxMap( vProjVtex );","}","void main() {","vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","gl_FragColor = texture2D( map, mapUv );","}"].join("\n"),["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float pixelSize;","uniform vec2 resolution;","varying highp vec2 vUv;","void main(){","vec2 dxy = pixelSize / resolution;","vec2 coord = dxy * floor( vUv / dxy );","gl_FragColor = texture2D(tDiffuse, coord);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n"),new hy,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","gl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","gl_FragColor = newTex;","}"].join("\n"),new hy(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = rand( vUv );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n"),["uniform mat4 textureMatrix;","varying vec2 vUv;","varying vec4 vUvRefraction;","void main() {","\tvUv = uv;","\tvUvRefraction = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform float time;","uniform sampler2D tDiffuse;","uniform sampler2D tDudv;","varying vec2 vUv;","varying vec4 vUvRefraction;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );","}","void main() {"," float waveStrength = 0.1;"," float waveSpeed = 0.03;","\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;","\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );","\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;"," vec4 uv = vec4( vUvRefraction );"," uv.xy += distortion;","\tvec4 base = texture2DProj( tDiffuse, uv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n"),ow.merge([F_.fog,F_.lights,{enableBump:{value:0},enableSpecular:{value:0},tDiffuse:{value:null},tBeckmann:{value:null},diffuse:{value:new ay(15658734)},specular:{value:new ay(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75},bumpMap:{value:null},bumpScale:{value:1},specularMap:{value:null},offsetRepeat:{value:new fy(0,0,1,1)},uWrapRGB:{value:new Kg(.75,.375,.1875)}}]),["#define USE_BUMPMAP","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",R_.common,R_.bsdfs,R_.packing,R_.lights_pars_begin,R_.shadowmap_pars_fragment,R_.fog_pars_fragment,R_.bumpmap_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","diffuseColor = diffuseColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewerDirection = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 totalSpecularLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += pointLight[ i ].color * ( pointDiffuseWeight * attenuation );","totalSpecularLight += pointLight[ i ].color * specular * ( pointSpecularWeight * specularStrength * attenuation );","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * ( dirSpecularWeight * specularStrength );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewerDirection, uRoughness, uSpecularBrightness );","vec3 hemiSpecularColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","totalSpecularLight += hemiSpecularColor * specular * ( hemiSpecularWeight * specularStrength );","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor * diffuse ) + totalSpecularLight;","gl_FragColor = linearToOutputTexel( vec4( outgoingLight, diffuseColor.a ) );",R_.fog_fragment,"}"].join("\n"),["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",R_.common,R_.lights_pars_begin,R_.shadowmap_pars_vertex,R_.fog_pars_vertex,"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",R_.shadowmap_vertex,R_.fog_vertex,"}"].join("\n"),ow.merge([F_.fog,F_.lights,{passID:{value:0},tDiffuse:{value:null},tNormal:{value:null},tBlur1:{value:null},tBlur2:{value:null},tBlur3:{value:null},tBlur4:{value:null},tBeckmann:{value:null},uNormalScale:{value:1},diffuse:{value:new ay(15658734)},specular:{value:new ay(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",R_.common,R_.lights_pars_begin,R_.fog_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 mSpecular = vec4( specular, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","diffuseColor *= colDiffuse;","vec4 posAndU = vec4( -vViewPosition, vUv.x );","vec4 posAndU_dx = dFdx( posAndU ),  posAndU_dy = dFdy( posAndU );","vec3 tangent = posAndU_dx.w * posAndU_dx.xyz + posAndU_dy.w * posAndU_dy.xyz;","vec3 normal = normalize( vNormal );","vec3 binormal = normalize( cross( tangent, normal ) );","tangent = cross( normal, binormal );","mat3 tsb = mat3( tangent, binormal, normal );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec3 finalNormal = tsb * normalTex;","normal = normalize( finalNormal );","vec3 viewerDirection = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( pointLights[ i ].direction );","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","totalDiffuseLight += pointLightColor[ i ] * ( pointDiffuseWeight * attenuation );","if ( passID == 1 ) {","float pointSpecularWeight = KS_Skin_Specular( normal, pointVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += pointLightColor[ i ] * mSpecular.xyz * ( pointSpecularWeight * attenuation );","}","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","if ( passID == 1 ) {","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += directionalLights[ i ].color * mSpecular.xyz * dirSpecularWeight;","}","}","#endif","outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalSpecularLight );","if ( passID == 0 ) {","outgoingLight = sqrt( outgoingLight );","} else if ( passID == 1 ) {","#ifdef VERSION1","vec3 nonblurColor = sqrt(outgoingLight );","#else","vec3 nonblurColor = outgoingLight;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;","outgoingLight = vec3( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color );","outgoingLight *= sqrt( colDiffuse.xyz );","outgoingLight += ambientLightColor * diffuse * colDiffuse.xyz + totalSpecularLight;","#ifndef VERSION1","outgoingLight = sqrt( outgoingLight );","#endif","}","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",R_.fog_fragment,"}"].join("\n"),["#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",R_.common,R_.fog_pars_vertex,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif",R_.fog_vertex,"}"].join("\n"),["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",R_.common,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {","return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n"),ow.merge([F_.fog,F_.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new ay(15658734)},specular:{value:new ay(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new hy(1,1)},uRepeatOverlay:{value:new hy(1,1)},uOffset:{value:new hy(0,0)}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",R_.common,R_.bsdfs,R_.lights_pars_begin,R_.shadowmap_pars_fragment,R_.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",R_.fog_fragment,"}"].join("\n"),["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",R_.shadowmap_pars_vertex,R_.fog_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",R_.shadowmap_vertex,R_.fog_vertex,"}"].join("\n"),new Kg,new ay(15658734),new ay(328965),new ay(16777215),["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n"),new Kg,new ay(15658734),new ay(328965),new ay(15658734),new ay(8421504),new ay(0),new ay(0),new ay(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n"),new Kg,new ay(15658734),new ay(328965),new ay(16777215),new ay(0),new ay(0),new ay(0),new ay(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n"),new Kg,new ay(15658734),new ay(328965),new ay(16777215),new ay(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n");var mP=function(e){void 0==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};mP.prototype.dot=function(e,t,r){return e[0]*t+e[1]*r},mP.prototype.dot3=function(e,t,r,n){return e[0]*t+e[1]*r+e[2]*n},mP.prototype.dot4=function(e,t,r,n,i){return e[0]*t+e[1]*r+e[2]*n+e[3]*i},mP.prototype.noise=function(e,t){var r,n,i=(e+t)*(.5*(Math.sqrt(3)-1)),o=Math.floor(e+i),s=Math.floor(t+i),a=(3-Math.sqrt(3))/6,l=(o+s)*a,c=e-(o-l),u=t-(s-l);c>u?(r=1,n=0):(r=0,n=1);var h=c-r+a,d=u-n+a,p=c-1+2*a,f=u-1+2*a,m=255&o,v=255&s,g=this.perm[m+this.perm[v]]%12,y=this.perm[m+r+this.perm[v+n]]%12,x=this.perm[m+1+this.perm[v+1]]%12,b=.5-c*c-u*u,w=.5-h*h-d*d,_=.5-p*p-f*f;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[g],c,u))+(w<0?0:(w*=w)*w*this.dot(this.grad3[y],h,d))+(_<0?0:(_*=_)*_*this.dot(this.grad3[x],p,f)))},mP.prototype.noise3d=function(e,t,r){var n,i,o,s,a,l,c=(e+t+r)*(1/3),u=Math.floor(e+c),h=Math.floor(t+c),d=Math.floor(r+c),p=1/6,f=(u+h+d)*p,m=e-(u-f),v=t-(h-f),g=r-(d-f);m>=v?v>=g?(n=1,i=0,o=0,s=1,a=1,l=0):m>=g?(n=1,i=0,o=0,s=1,a=0,l=1):(n=0,i=0,o=1,s=1,a=0,l=1):v<g?(n=0,i=0,o=1,s=0,a=1,l=1):m<g?(n=0,i=1,o=0,s=0,a=1,l=1):(n=0,i=1,o=0,s=1,a=1,l=0);var y=m-n+p,x=v-i+p,b=g-o+p,w=m-s+2*p,_=v-a+2*p,S=g-l+2*p,T=m-1+.5,M=v-1+.5,A=g-1+.5,E=255&u,C=255&h,P=255&d,O=this.perm[E+this.perm[C+this.perm[P]]]%12,D=this.perm[E+n+this.perm[C+i+this.perm[P+o]]]%12,N=this.perm[E+s+this.perm[C+a+this.perm[P+l]]]%12,L=this.perm[E+1+this.perm[C+1+this.perm[P+1]]]%12,I=.6-m*m-v*v-g*g,R=.6-y*y-x*x-b*b,F=.6-w*w-_*_-S*S,k=.6-T*T-M*M-A*A;return 32*((I<0?0:(I*=I)*I*this.dot3(this.grad3[O],m,v,g))+(R<0?0:(R*=R)*R*this.dot3(this.grad3[D],y,x,b))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[N],w,_,S))+(k<0?0:(k*=k)*k*this.dot3(this.grad3[L],T,M,A)))},mP.prototype.noise4d=function(e,t,r,n){var i,o,s,a,l,c,u,h,d,p,f,m,v=this.grad4,g=this.simplex,y=this.perm,x=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,w=(e+t+r+n)*x,_=Math.floor(e+w),S=Math.floor(t+w),T=Math.floor(r+w),M=Math.floor(n+w),A=(_+S+T+M)*b,E=e-(_-A),C=t-(S-A),P=r-(T-A),O=n-(M-A),D=(E>C?32:0)+(E>P?16:0)+(C>P?8:0)+(E>O?4:0)+(C>O?2:0)+(P>O?1:0),N=E-(i=g[D][0]>=3?1:0)+b,L=C-(o=g[D][1]>=3?1:0)+b,I=P-(s=g[D][2]>=3?1:0)+b,R=O-(a=g[D][3]>=3?1:0)+b,F=E-(l=g[D][0]>=2?1:0)+2*b,k=C-(c=g[D][1]>=2?1:0)+2*b,U=P-(u=g[D][2]>=2?1:0)+2*b,B=O-(h=g[D][3]>=2?1:0)+2*b,j=E-(d=g[D][0]>=1?1:0)+3*b,z=C-(p=g[D][1]>=1?1:0)+3*b,V=P-(f=g[D][2]>=1?1:0)+3*b,G=O-(m=g[D][3]>=1?1:0)+3*b,H=E-1+4*b,W=C-1+4*b,X=P-1+4*b,q=O-1+4*b,Y=255&_,J=255&S,Z=255&T,Q=255&M,K=y[Y+y[J+y[Z+y[Q]]]]%32,$=y[Y+i+y[J+o+y[Z+s+y[Q+a]]]]%32,ee=y[Y+l+y[J+c+y[Z+u+y[Q+h]]]]%32,te=y[Y+d+y[J+p+y[Z+f+y[Q+m]]]]%32,re=y[Y+1+y[J+1+y[Z+1+y[Q+1]]]]%32,ne=.6-E*E-C*C-P*P-O*O,ie=.6-N*N-L*L-I*I-R*R,oe=.6-F*F-k*k-U*U-B*B,se=.6-j*j-z*z-V*V-G*G,ae=.6-H*H-W*W-X*X-q*q;return 27*((ne<0?0:(ne*=ne)*ne*this.dot4(v[K],E,C,P,O))+(ie<0?0:(ie*=ie)*ie*this.dot4(v[$],N,L,I,R))+(oe<0?0:(oe*=oe)*oe*this.dot4(v[ee],F,k,U,B))+(se<0?0:(se*=se)*se*this.dot4(v[te],j,z,V,G))+(ae<0?0:(ae*=ae)*ae*this.dot4(v[re],H,W,X,q)))};var vP=function(e,t,r){this._scene=e,this._trackInfo=t,this._onUpdate=r,this._mixer=new FT(e),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]};vP.prototype={constructor:vP,init:function(e){for(var t=[],r=this._trackInfo,n=0,i=r.length;n!==i;++n){var o=r[n];t.push(this._addTrack(o.type,o.propertyPath,o.initialValue,o.interpolation))}this._clip=new Jb("editclip",0,t),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(e){this._action.time=e,this._mixer.update(0),this._onUpdate()},setDuration:function(e){this._clip.duration=e},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(e){return this._tracks[e].times},setKeyframe:function(e,t){var r=this._tracks[e],n=r.times,i=Timeliner.binarySearch(n,t),o=r.values,s=r.getValueSize(),a=i*s;if(i<0){a=(i=~i)*s;for(var l=n.length+1,c=o.length+s,u=l-1;u!==i;--u)n[u]=n[u-1];u=c-1;for(var h=a+s-1;u!==h;--u)o[u]=o[u-s]}n[i]=t,this._propRefs[e].getValue(o,a)},delKeyframe:function(e,t){var r=this._tracks[e],n=r.times,i=Timeliner.binarySearch(n,t);if(n.length>1&&i>=0){for(var o=n.length-1,s=r.values,a=r.getValueSize(),l=s.length-a,c=i;c!==o;++c)n[c]=n[c+1];n.pop();for(var u=i*a;u!==l;++u)s[u]=s[u+a];s.length=l}},moveKeyframe:function(e,t,r,n){var i=this._tracks[e],o=i.times,s=Timeliner.binarySearch(o,t);if(s>=0){for(var a=n?o.length:s+1,l=o[s-1]<=t||!n&&t>=o[s+1];s!==a;)o[s++]+=r;l&&this._sort(i)}},serialize:function(){for(var e={duration:this._clip.duration,channels:{}},t=this._channelNames,r=this._tracks,n=e.channels,i=0,o=t.length;i!==o;++i){var s=t[i],a=r[s];n[s]={times:a.times,values:a.values}}return e},deserialize:function(e){var t=this._channelNames,r=this._tracks,n=e.channels;this.setDuration(e.duration);for(var i=0,o=t.length;i!==o;++i){var s=t[i],a=r[s],l=n[s];this._setArray(a.times,l.times),this._setArray(a.values,l.values)}this.setDisplayTime(this._mixer.time)},_sort:function(e){var t=e.times,r=Xb.getKeyframeOrder(t);this._setArray(t,Xb.sortedArray(t,1,r));var n=e.values,i=e.getValueSize();this._setArray(n,Xb.sortedArray(n,i,r))},_setArray:function(e,t){e.length=0,e.push.apply(e,t)},_addTrack:function(e,t,r,n){var i=new e(t,[0],r,n);return i.times=Array.prototype.slice.call(i.times),i.values=Array.prototype.slice.call(i.values),this._channelNames.push(t),this._tracks[t]=i,this._propRefs[t]=new B_(this._scene,t),i}};var gP={quicksortIP:function(e,t,r){for(var n,i,o=[],s=-1,a=0,l=e.length/t-1,c=0,u=0,h=0,d=function(r,n){for(r*=t,n*=t,h=0;h<t;h++)c=e[r+h],e[r+h]=e[n+h],e[n+h]=c},p=new Float32Array(t),f=new Float32Array(t);;)if(l-a<=25){for(i=a+1;i<=l;i++){for(u=0;u<t;u++)p[u]=e[i*t+u];for(n=i-1;n>=a&&e[n*t+r]>p[r];){for(u=0;u<t;u++)e[(n+1)*t+u]=e[n*t+u];n--}for(u=0;u<t;u++)e[(n+1)*t+u]=p[u]}if(-1==s)break;l=o[s--],a=o[s--]}else{for(i=l,d(a+l>>1,n=a+1),e[a*t+r]>e[l*t+r]&&d(a,l),e[n*t+r]>e[l*t+r]&&d(n,l),e[a*t+r]>e[n*t+r]&&d(a,n),u=0;u<t;u++)f[u]=e[n*t+u];for(;;){do{n++}while(e[n*t+r]<f[r]);do{i--}while(e[i*t+r]>f[r]);if(i<n)break;d(n,i)}for(u=0;u<t;u++)e[(a+1)*t+u]=e[i*t+u],e[i*t+u]=f[u];l-n+1>=i-a?(o[++s]=n,o[++s]=l,l=i-1):(o[++s]=a,o[++s]=i-1,a=n)}return e},Kdtree:function(e,t,r){var n=this,i=0,o=function(e,t){return e.subarray(t*r,t*r+r)};this.root=function e(t,s,a,l){var c,u,h=s%r,d=t.length/r;return s>i&&(i=s),0===d?null:1===d?new n.Node(o(t,0),s,a,l):(gP.quicksortIP(t,r,h),c=Math.floor(d/2),(u=new n.Node(o(t,c),s,a,c+l)).left=e(t.subarray(0,c*r),s+1,u,l),u.right=e(t.subarray((c+1)*r,t.length),s+1,u,l+c+1),u)}(e,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(e,i,o){var s,a,l;if(l=new gP.Kdtree.BinaryHeap(function(e){return-e[1]}),o)for(s=0;s<i;s+=1)l.push([null,o]);for(function n(o){var s,a,c,u,h=o.depth%r,d=t(e,o.obj),p=[];function f(e,t){l.push([e,t]),l.size()>i&&l.pop()}for(u=0;u<r;u+=1)u===o.depth%r?p[u]=e[u]:p[u]=o.obj[u];a=t(p,o.obj),null!==o.right||null!==o.left?(n(s=null===o.right?o.left:null===o.left?o.right:e[h]<o.obj[h]?o.left:o.right),(l.size()<i||d<l.peek()[1])&&f(o,d),(l.size()<i||Math.abs(a)<l.peek()[1])&&null!==(c=s===o.left?o.right:o.left)&&n(c)):(l.size()<i||d<l.peek()[1])&&f(o,d)}(n.root),a=[],s=0;s<i;s+=1)l.content[s][0]&&a.push([l.content[s][0],l.content[s][1]]);return a}}};gP.Kdtree.prototype.Node=function(e,t,r,n){this.obj=e,this.left=null,this.right=null,this.parent=r,this.depth=t,this.pos=n},gP.Kdtree.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},gP.Kdtree.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,r=0;r<t;r++)if(this.content[r]==e){var n=this.content.pop();return void(r!=t-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var r=Math.floor((e+1)/2)-1,n=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[r]=t,this.content[e]=n,e=r}},sinkDown:function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=2*(e+1),o=i-1,s=null;if(o<t){var a=this.content[o],l=this.scoreFunction(a);l<n&&(s=o)}if(i<t){var c=this.content[i];this.scoreFunction(c)<(null===s?n:l)&&(s=i)}if(null===s)break;this.content[e]=this.content[s],this.content[s]=r,e=s}}};var yP={merge:function(e,t,r){var n;console.warn("GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof Mb&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},randomPointInTriangle:function(){var e=new Kg;return function(t,r,n){var i=new Kg,o=Math.random(),s=Math.random();o+s>1&&(o=1-o,s=1-s);var a=1-o-s;return i.copy(t),i.multiplyScalar(o),e.copy(r),e.multiplyScalar(s),i.add(e),e.copy(n),e.multiplyScalar(a),i.add(e),i}}(),randomPointInFace:function(e,t){var r,n,i;return r=t.vertices[e.a],n=t.vertices[e.b],i=t.vertices[e.c],yP.randomPointInTriangle(r,n,i)},randomPointsInGeometry:function(e,t){var r,n,i,o,s,a=e.faces,l=e.vertices,c=a.length,u=0,h=[];for(n=0;n<c;n++)i=l[(r=a[n]).a],o=l[r.b],s=l[r.c],r._area=yP.triangleArea(i,o,s),u+=r._area,h[n]=u;function d(e){return function t(r,n){if(n<r)return r;var i=r+Math.floor((n-r)/2);return h[i]>e?t(r,i-1):h[i]<e?t(i+1,n):i}(0,h.length-1)}var p,f=[];for(n=0;n<t;n++)p=d(Math.random()*u),f[n]=yP.randomPointInFace(a[p],e);return f},randomPointsInBufferGeometry:function(e,t){var r,n,i,o,s=e.attributes.position.array,a=0,l=[];n=new Kg,i=new Kg,o=new Kg;var c=s.length/9;for(r=0;r<c;r++)n.set(s[9*r+0],s[9*r+1],s[9*r+2]),i.set(s[9*r+3],s[9*r+4],s[9*r+5]),o.set(s[9*r+6],s[9*r+7],s[9*r+8]),a+=yP.triangleArea(n,i,o),l.push(a);function u(e){return function t(r,n){if(n<r)return r;var i=r+Math.floor((n-r)/2);return l[i]>e?t(r,i-1):l[i]<e?t(i+1,n):i}(0,l.length-1)}var h,d=[];for(r=0;r<t;r++)h=u(Math.random()*a),n.set(s[9*h+0],s[9*h+1],s[9*h+2]),i.set(s[9*h+3],s[9*h+4],s[9*h+5]),o.set(s[9*h+6],s[9*h+7],s[9*h+8]),d[r]=yP.randomPointInTriangle(n,i,o);return d},triangleArea:function(){var e=new Kg,t=new Kg;return function(r,n,i){return e.subVectors(n,r),t.subVectors(i,r),e.cross(t),.5*e.length()}}(),center:function(e){return console.warn("GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},xP=function(e){var t,r=this,n=void 0!==e.name&&""!==e.name,i=10,o=10,s=256,a=256,l=new tw(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);l.position.set(0,0,2);var c,u,h=new ew,d=tC,p=new ow.clone(d.uniforms),f=new sw({uniforms:p,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}),m=new Mb(new lw(s,a),f);if(h.add(m),n){var v=(c=document.createElement("canvas")).getContext("2d");v.font="Bold 20px Arial";var g=v.measureText(e.name).width;c.width=g,c.height=25,v.font="Bold 20px Arial",v.fillStyle="rgba( 255, 0, 0, 1 )",v.fillText(e.name,0,20);var y=new nw(c);y.magFilter=Dx,y.minFilter=Dx,y.needsUpdate=!0;var x=new xb({map:y,side:ky});x.transparent=!0;var b=new lw(c.width,c.height);u=new Mb(b,x),h.add(u)}this.enabled=!0,this.size={width:s,height:a,set:function(e,t){this.width=e,this.height=t,m.scale.set(this.width/s,this.height/a,1),r.position.set(r.position.x,r.position.y)}},this.position={x:i,y:o,set:function(e,t){this.x=e,this.y=t;var i=r.size.width,o=r.size.height;m.position.set(-window.innerWidth/2+i/2+this.x,window.innerHeight/2-o/2-this.y,0),n&&u.position.set(m.position.x,m.position.y-r.size.height/2+c.height/2,0)}},this.render=function(r){this.enabled&&(p.tDiffuse.value=e.shadow.map.texture,t=r.autoClear,r.autoClear=!1,r.clearDepth(),r.render(h,l),r.autoClear=t)},this.updateForWindowResize=function(){this.enabled&&(l.left=window.innerWidth/-2,l.right=window.innerWidth/2,l.top=window.innerHeight/2,l.bottom=window.innerHeight/-2,l.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()};xP.prototype.constructor=xP;var bP=function(e,t,r){var n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new nw(this.canvas);i.minFilter=Dx,i.wrapS=i.wrapT=Ax;var o=new xb({map:i,side:ky,transparent:!0});this.mesh=new Mb(this.geometry,o),this.geometryNeedsUpdate=!0,this.repaint()};bP.prototype={constructor:bP,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,i=(this.axis,this.index,this.canvasBuffer),o=this.ctxBuffer,s=o.getImageData(0,0,e,t),a=s.data,l=n.data,c=n.upperThreshold,u=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,p=0;if("label"===n.dataType)for(var f=0;f<t;f++)for(var m=0;m<e;m++){var v=l[r(m,f)];v=v>=this.colorMap.length?v%this.colorMap.length+1:v;var g=this.colorMap[v];a[4*p]=g>>24&255,a[4*p+1]=g>>16&255,a[4*p+2]=g>>8&255,a[4*p+3]=255&g,p++}else for(f=0;f<t;f++)for(m=0;m<e;m++){var y=l[r(m,f)],x=255;x=c>=y&&u<=y?x:0,y=(y=Math.floor(255*(y-h)/(d-h)))>255?255:y<0?0:0|y,a[4*p]=y,a[4*p+1]=y,a[4*p+2]=y,a[4*p+3]=x,p++}o.putImageData(s,0,0),this.ctx.drawImage(i,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry=new aw(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix=(new Qg).identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}};var wP=function(){oy.call(this);var e,t=this,r=[0,0],n=!1,i=new Kg;this.matrixAutoUpdate=!1,this.getGamepad=function(){return e},this.getTouchpadState=function(){return n},this.update=function(){if(void 0!==(e=function(){for(var e=navigator.getGamepads&&navigator.getGamepads(),t=0;t<4;t++){var r=e[t];if(r&&"Daydream Controller"===r.id)return r}}())&&void 0!==e.pose){var o=e.pose;if(null===o)return;null!==o.orientation&&t.quaternion.fromArray(o.orientation),t.updateMatrix(),t.visible=!0,null===o.angularVelocity||i.equals(o.angularVelocity)||(i.fromArray(o.angularVelocity),t.dispatchEvent({type:"angularvelocitychanged",angularVelocity:i})),r[0]===e.axes[0]&&r[1]===e.axes[1]||(r[0]=e.axes[0],r[1]=e.axes[1],t.dispatchEvent({type:"axischanged",axes:r})),n!==e.buttons[0].pressed&&(n=e.buttons[0].pressed,t.dispatchEvent({type:n?"touchpaddown":"touchpadup"}))}else t.visible=!1},this.getTouchPadState=function(){return console.warn("DaydreamController: getTouchPadState() is now getTouchpadState()"),n}};wP.prototype=Object.create(oy.prototype),wP.prototype.constructor=wP;var _P=function(){oy.call(this);var e,t=this,r=[0,0],n=!1,i=!1,o=new Kg;this.matrixAutoUpdate=!0,this.getGamepad=function(){return e},this.getTouchpadState=function(){return n},this.update=function(){if(void 0!==(e=function(){for(var e=navigator.getGamepads&&navigator.getGamepads(),t=0;t<4;t++){var r=e[t];if(r&&"Gear VR Controller"===r.id)return r}}())&&void 0!==e.pose){var s=e.pose;if(null===s)return;null!==s.orientation&&t.quaternion.fromArray(s.orientation),t.updateMatrix(),t.visible=!0,null===s.angularVelocity||o.equals(s.angularVelocity)||(o.fromArray(s.angularVelocity),t.dispatchEvent({type:"angularvelocitychanged",angularVelocity:o})),r[0]===e.axes[0]&&r[1]===e.axes[1]||(r[0]=e.axes[0],r[1]=e.axes[1],t.dispatchEvent({type:"axischanged",axes:r})),n!==e.buttons[0].pressed&&(n=e.buttons[0].pressed,t.dispatchEvent({type:n?"touchpaddown":"touchpadup",axes:r})),i!==e.buttons[1].pressed&&(i=e.buttons[1].pressed,t.dispatchEvent({type:i?"triggerdown":"triggerup"}))}else t.visible=!1},this.getTouchPadState=function(){return console.warn("GearVRController: getTouchPadState() is now getTouchpadState()"),n},this.setHand=function(){console.warn("GearVRController: setHand() has been removed.")}};_P.prototype=Object.create(oy.prototype),_P.prototype.constructor=_P;var SP=function(e){oy.call(this);var t,r=this,n=[0,0],i=!1,o=!1,s=!1,a=!1;this.matrixAutoUpdate=!1,this.standingMatrix=new Qg,this.getGamepad=function(){return t},this.getButtonState=function(e){return"thumbpad"===e?i:"trigger"===e?o:"grips"===e?s:"menu"===e?a:void 0},this.update=function(){if(void 0!==(t=function(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,n=0;r<t.length;r++){var i=t[r];if(i&&("OpenVR Gamepad"===i.id||i.id.startsWith("Oculus Touch")||i.id.startsWith("Spatial Controller"))){if(n===e)return i;n++}}}(e))&&void 0!==t.pose){if(null===t.pose)return;var l=t.pose;null!==l.position&&r.position.fromArray(l.position),null!==l.orientation&&r.quaternion.fromArray(l.orientation),r.matrix.compose(r.position,r.quaternion,r.scale),r.matrix.premultiply(r.standingMatrix),r.matrixWorldNeedsUpdate=!0,r.visible=!0,n[0]===t.axes[0]&&n[1]===t.axes[1]||(n[0]=t.axes[0],n[1]=t.axes[1],r.dispatchEvent({type:"axischanged",axes:n})),i!==t.buttons[0].pressed&&(i=t.buttons[0].pressed,r.dispatchEvent({type:i?"thumbpaddown":"thumbpadup",axes:n})),o!==t.buttons[1].pressed&&(o=t.buttons[1].pressed,r.dispatchEvent({type:o?"triggerdown":"triggerup"})),s!==t.buttons[2].pressed&&(s=t.buttons[2].pressed,r.dispatchEvent({type:s?"gripsdown":"gripsup"})),a!==t.buttons[3].pressed&&(a=t.buttons[3].pressed,r.dispatchEvent({type:a?"menudown":"menuup"}))}else r.visible=!1}};function TP(e,t,r,n){py.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new MP(e,t,r,n)),this.mergeVertices()}function MP(e,t,r,n){Cy.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,s=[],a=[],l=[],c=[],u=new Kg,h=new hy;for(a.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var d=r+o/t*n;u.x=e*Math.cos(d),u.y=e*Math.sin(d),a.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(a[i]/e+1)/2,h.y=(a[i+1]/e+1)/2,c.push(h.x,h.y)}for(i=1;i<=t;i++)s.push(i,i+1,0);this.setIndex(s),this.addAttribute("position",new Sy(a,3)),this.addAttribute("normal",new Sy(l,3)),this.addAttribute("uv",new Sy(c,2))}function AP(e,t){py.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new EP(e,t)),this.mergeVertices()}function EP(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];qw.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function CP(e,t,r,n,i,o,s,a){m_.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function PP(e,t,r,n,i,o){CP.call(this,e,t,r,r,n,i,o),this.type="ArcCurve"}function OP(){var e=0,t=0,r=0,n=0;function i(i,o,s,a){e=i,t=s,r=-3*i+3*o-2*s-a,n=2*i-2*o+s+a}return{initCatmullRom:function(e,t,r,n,o){i(t,r,o*(r-e),o*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,o,s,a){var l=(t-e)/o-(r-e)/(o+s)+(r-t)/s,c=(r-t)/s-(n-t)/(s+a)+(n-r)/a;i(t,r,l*=s,c*=s)},calc:function(i){var o=i*i;return e+t*i+r*o+n*(o*i)}}}SP.prototype=Object.create(oy.prototype),SP.prototype.constructor=SP,TP.prototype=Object.create(py.prototype),TP.prototype.constructor=TP,MP.prototype=Object.create(Cy.prototype),MP.prototype.constructor=MP,AP.prototype=Object.create(py.prototype),AP.prototype.constructor=AP,EP.prototype=Object.create(qw.prototype),EP.prototype.constructor=EP,CP.prototype=Object.create(m_.prototype),CP.prototype.constructor=CP,CP.prototype.isEllipseCurve=!0,CP.prototype.getPoint=function(e,t){for(var r=t||new hy,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var s=this.aStartAngle+e*i,a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=a-this.aX,d=l-this.aY;a=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(a,l)},CP.prototype.copy=function(e){return m_.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},CP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},CP.prototype.fromJSON=function(e){return m_.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},PP.prototype=Object.create(CP.prototype),PP.prototype.constructor=PP,PP.prototype.isArcCurve=!0;var DP=new Kg,NP=new OP,LP=new OP,IP=new OP;function RP(e,t,r,n){m_.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function FP(e,t,r,n,i){var o=.5*(n-t),s=.5*(i-r),a=e*e;return(2*r-2*n+o+s)*(e*a)+(-3*r+3*n-2*o-s)*a+o*e+r}function kP(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function UP(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}function BP(e,t,r,n){m_.call(this),this.type="CubicBezierCurve",this.v0=e||new hy,this.v1=t||new hy,this.v2=r||new hy,this.v3=n||new hy}function jP(e,t,r,n){m_.call(this),this.type="CubicBezierCurve3",this.v0=e||new Kg,this.v1=t||new Kg,this.v2=r||new Kg,this.v3=n||new Kg}function zP(e,t){m_.call(this),this.type="LineCurve",this.v1=e||new hy,this.v2=t||new hy}function VP(e,t){m_.call(this),this.type="LineCurve3",this.v1=e||new Kg,this.v2=t||new Kg}function GP(e,t,r){m_.call(this),this.type="QuadraticBezierCurve",this.v0=e||new hy,this.v1=t||new hy,this.v2=r||new hy}function HP(e,t,r){m_.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Kg,this.v1=t||new Kg,this.v2=r||new Kg}function WP(e){m_.call(this),this.type="SplineCurve",this.points=e||[]}RP.prototype=Object.create(m_.prototype),RP.prototype.constructor=RP,RP.prototype.isCatmullRomCurve3=!0,RP.prototype.getPoint=function(e,t){var r,n,i,o,s=t||new Kg,a=this.points,l=a.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/a.length)+1)*a.length:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=a[(u-1)%l]:(DP.subVectors(a[0],a[1]).add(a[0]),r=DP),n=a[u%l],i=a[(u+1)%l],this.closed||u+2<l?o=a[(u+2)%l]:(DP.subVectors(a[l-1],a[l-2]).add(a[l-1]),o=DP),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),NP.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,p,f,m),LP.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,p,f,m),IP.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(NP.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),LP.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),IP.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return s.set(NP.calc(h),LP.calc(h),IP.calc(h)),s},RP.prototype.copy=function(e){m_.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},RP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},RP.prototype.fromJSON=function(e){m_.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Kg).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},BP.prototype=Object.create(m_.prototype),BP.prototype.constructor=BP,BP.prototype.isCubicBezierCurve=!0,BP.prototype.getPoint=function(e,t){var r=t||new hy,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(UP(e,n.x,i.x,o.x,s.x),UP(e,n.y,i.y,o.y,s.y)),r},BP.prototype.copy=function(e){return m_.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},BP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},BP.prototype.fromJSON=function(e){return m_.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},jP.prototype=Object.create(m_.prototype),jP.prototype.constructor=jP,jP.prototype.isCubicBezierCurve3=!0,jP.prototype.getPoint=function(e,t){var r=t||new Kg,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(UP(e,n.x,i.x,o.x,s.x),UP(e,n.y,i.y,o.y,s.y),UP(e,n.z,i.z,o.z,s.z)),r},jP.prototype.copy=function(e){return m_.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},jP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},jP.prototype.fromJSON=function(e){return m_.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},zP.prototype=Object.create(m_.prototype),zP.prototype.constructor=zP,zP.prototype.isLineCurve=!0,zP.prototype.getPoint=function(e,t){var r=t||new hy;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},zP.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},zP.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},zP.prototype.copy=function(e){return m_.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},zP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},zP.prototype.fromJSON=function(e){return m_.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},VP.prototype=Object.create(m_.prototype),VP.prototype.constructor=VP,VP.prototype.isLineCurve3=!0,VP.prototype.getPoint=function(e,t){var r=t||new Kg;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},VP.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},VP.prototype.copy=function(e){return m_.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},VP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},VP.prototype.fromJSON=function(e){return m_.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},GP.prototype=Object.create(m_.prototype),GP.prototype.constructor=GP,GP.prototype.isQuadraticBezierCurve=!0,GP.prototype.getPoint=function(e,t){var r=t||new hy,n=this.v0,i=this.v1,o=this.v2;return r.set(kP(e,n.x,i.x,o.x),kP(e,n.y,i.y,o.y)),r},GP.prototype.copy=function(e){return m_.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},GP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},GP.prototype.fromJSON=function(e){return m_.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},HP.prototype=Object.create(m_.prototype),HP.prototype.constructor=HP,HP.prototype.isQuadraticBezierCurve3=!0,HP.prototype.getPoint=function(e,t){var r=t||new Kg,n=this.v0,i=this.v1,o=this.v2;return r.set(kP(e,n.x,i.x,o.x),kP(e,n.y,i.y,o.y),kP(e,n.z,i.z,o.z)),r},HP.prototype.copy=function(e){return m_.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},HP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},HP.prototype.fromJSON=function(e){return m_.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},WP.prototype=Object.create(m_.prototype),WP.prototype.constructor=WP,WP.prototype.isSplineCurve=!0,WP.prototype.getPoint=function(e,t){var r=t||new hy,n=this.points,i=(n.length-1)*e,o=Math.floor(i),s=i-o,a=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set(FP(s,a.x,l.x,c.x,u.x),FP(s,a.y,l.y,c.y,u.y)),r},WP.prototype.copy=function(e){m_.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},WP.prototype.toJSON=function(){var e=m_.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},WP.prototype.fromJSON=function(e){m_.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new hy).fromArray(n))}return this};var XP={ArcCurve:PP,CatmullRomCurve3:RP,CubicBezierCurve:BP,CubicBezierCurve3:jP,EllipseCurve:CP,LineCurve:zP,LineCurve3:VP,QuadraticBezierCurve:GP,QuadraticBezierCurve3:HP,SplineCurve:WP};function qP(){m_.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function YP(e){qP.call(this),this.type="Path",this.currentPoint=new hy,e&&this.setFromPoints(e)}function JP(e){YP.call(this,e),this.uuid=Zg.generateUUID(),this.type="Shape",this.holes=[]}qP.prototype=Object.assign(Object.create(m_.prototype),{constructor:qP,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new XP.LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,o=this.curves[n],s=o.getLength(),a=0===s?0:1-i/s;return o.getPointAt(a)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],s=o&&o.isEllipseCurve?2*e:o&&o.isLineCurve?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s),l=0;l<a.length;l++){var c=a[l];t&&t.equals(c)||(r.push(c),t=c)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){m_.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=m_.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){m_.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new XP[n.type]).fromJSON(n))}return this}}),YP.prototype=Object.assign(Object.create(qP.prototype),{constructor:YP,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new zP(this.currentPoint.clone(),new hy(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){var i=new GP(this.currentPoint.clone(),new hy(e,t),new hy(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(e,t,r,n,i,o){var s=new BP(this.currentPoint.clone(),new hy(e,t),new hy(r,n),new hy(i,o));this.curves.push(s),this.currentPoint.set(i,o)},splineThru:function(e){var t=new WP([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,n,i,o){var s=this.currentPoint.x,a=this.currentPoint.y;this.absarc(e+s,t+a,r,n,i,o)},absarc:function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},ellipse:function(e,t,r,n,i,o,s,a){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,r,n,i,o,s,a)},absellipse:function(e,t,r,n,i,o,s,a){var l=new CP(e,t,r,n,i,o,s,a);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return qP.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=qP.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return qP.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),JP.prototype=Object.assign(Object.create(YP.prototype),{constructor:JP,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){YP.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=YP.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){YP.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new YP).fromJSON(n))}return this}});var ZP=function(e,t,r){r=r||2;var n,i,o,s,a,l,c,u=t&&t.length,h=u?t[0]*r:e.length,d=QP(e,0,h,r,!0),p=[];if(!d)return p;if(u&&(d=function(e,t,r,n){var i,o,s,a,l,c=[];for(i=0,o=t.length;i<o;i++)s=t[i]*n,a=i<o-1?t[i+1]*n:e.length,(l=QP(e,s,a,n,!1))===l.next&&(l.steiner=!0),c.push(aO(l));for(c.sort(iO),i=0;i<c.length;i++)oO(c[i],r),r=KP(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=o=e[0],i=s=e[1];for(var f=r;f<h;f+=r)a=e[f],l=e[f+1],a<n&&(n=a),l<i&&(i=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-i))?1/c:0}return $P(d,p,r,n,i,c),p};function QP(e,t,r,n,i){var o,s;if(i===function(e,t,r,n){for(var i=0,o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,r,n)>0)for(o=t;o<r;o+=n)s=mO(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=mO(o,e[o],e[o+1],s);return s&&hO(s,s.next)&&(vO(s),s=s.next),s}function KP(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!hO(n,n.next)&&0!==uO(n.prev,n,n.next))n=n.next;else{if(vO(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function $P(e,t,r,n,i,o,s){if(e){!s&&o&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=sO(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,s,a,l,c=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(s>1)}(i)}(e,n,i,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?tO(e,n,i,o):eO(e))t.push(a.i/r),t.push(e.i/r),t.push(l.i/r),vO(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?$P(e=rO(e,t,r),t,r,n,i,o,2):2===s&&nO(e,t,r,n,i,o):$P(KP(e),t,r,n,i,o,1);break}}}function eO(e){var t=e.prev,r=e,n=e.next;if(uO(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(lO(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&uO(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function tO(e,t,r,n){var i=e.prev,o=e,s=e.next;if(uO(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=sO(a,l,t,r,n),d=sO(c,u,t,r,n),p=e.nextZ;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&lO(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&uO(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=e.prevZ;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&lO(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&uO(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function rO(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!hO(i,o)&&dO(i,n,n.next,o)&&pO(i,o)&&pO(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),vO(n),vO(n.next),n=e=o),n=n.next}while(n!==e);return n}function nO(e,t,r,n,i,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&cO(s,a)){var l=fO(s,a);return s=KP(s,s.next),l=KP(l,l.next),$P(s,t,r,n,i,o),void $P(l,t,r,n,i,o)}a=a.next}s=s.next}while(s!==e)}function iO(e,t){return e.x-t.x}function oO(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;n=r.next;for(;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&lO(o<h?i:s,o,u,h,o<h?s:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&pO(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=fO(t,e);KP(r,r.next)}}function sO(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function aO(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function lO(e,t,r,n,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function cO(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&dO(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&pO(e,t)&&pO(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function uO(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function hO(e,t){return e.x===t.x&&e.y===t.y}function dO(e,t,r,n){return!!(hO(e,t)&&hO(r,n)||hO(e,n)&&hO(r,t))||uO(e,t,r)>0!=uO(e,t,n)>0&&uO(r,n,e)>0!=uO(r,n,t)>0}function pO(e,t){return uO(e.prev,e,e.next)<0?uO(e,t,e.next)>=0&&uO(e,e.prev,t)>=0:uO(e,t,e.prev)<0||uO(e,e.next,t)<0}function fO(e,t){var r=new gO(e.i,e.x,e.y),n=new gO(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function mO(e,t,r,n){var i=new gO(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function vO(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function gO(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var yO={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return yO.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];xO(e),bO(r,e);var o=e.length;t.forEach(xO);for(var s=0;s<t.length;s++)n.push(o),o+=t[s].length,bO(r,t[s]);var a=ZP(r,n);for(s=0;s<a.length;s+=3)i.push(a.slice(s,s+3));return i}};function xO(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function bO(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function wO(e,t){py.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new _O(e,t)),this.mergeVertices()}function _O(e,t){Cy.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],o=[],s=0,a=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),this.addGroup(s,a,l),s+=a,a=0;function c(e){var s,l,c,u=n.length/3,h=e.extractPoints(t),d=h.shape,p=h.holes;if(!1===yO.isClockWise(d))for(d=d.reverse(),s=0,l=p.length;s<l;s++)c=p[s],!0===yO.isClockWise(c)&&(p[s]=c.reverse());var f=yO.triangulateShape(d,p);for(s=0,l=p.length;s<l;s++)c=p[s],d=d.concat(c);for(s=0,l=d.length;s<l;s++){var m=d[s];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(s=0,l=f.length;s<l;s++){var v=f[s],g=v[0]+u,y=v[1]+u,x=v[2]+u;r.push(g,y,x),a+=3}}this.setIndex(r),this.addAttribute("position",new Sy(n,3)),this.addAttribute("normal",new Sy(i,3)),this.addAttribute("uv",new Sy(o,2))}function SO(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}wO.prototype=Object.create(py.prototype),wO.prototype.constructor=wO,wO.prototype.toJSON=function(){var e=py.prototype.toJSON.call(this);return SO(this.parameters.shapes,e)},_O.prototype=Object.create(Cy.prototype),_O.prototype.constructor=_O,_O.prototype.toJSON=function(){var e=Cy.prototype.toJSON.call(this);return SO(this.parameters.shapes,e)};var TO=function(e){SP.call(this,e);var t=2*Math.PI,r={COLOR:0,SIZE:1},n=r.COLOR,i=new ay(1,1,1),o=1;var s=new Mb(a=new TP(1,32),d=new xb({map:function(){var e=document.createElement("canvas");e.width=256,e.height=256;for(var r=e.getContext("2d"),n=r.getImageData(0,0,256,256),i=n.data,o=new ay,s=0,a=0;s<i.length;s+=4,a++){var l=a%256/256-.5,c=Math.floor(a/256)/256-.5;o.setHSL(Math.atan2(c,l)/t,1,2*(.5-Math.sqrt(l*l+c*c))),i[s+0]=256*o.r,i[s+1]=256*o.g,i[s+2]=256*o.b,i[s+3]=256}return r.putImageData(n,0,0),new sA(e)}()}));s.position.set(0,.005,.0495),s.rotation.x=-1.45,s.scale.setScalar(.02),this.add(s);var a=new AP(.1,2);(d=new xb).color=i;var l=new Mb(a,d);s.add(l);var c=new mS;c.position.set(0,.005,.0495),c.rotation.x=-1.45,c.scale.setScalar(.02),this.add(c);var u=new JP;u.moveTo(0,-1),u.lineTo(1,1),u.lineTo(-1,1);var h=new Mb(a=new wO(u),d=new xb({color:2236962,wireframe:!0}));h.position.z=.001,f(h.geometry,1),c.add(h);var d;a=new wO(u);(d=new xb({side:ky})).color=i;var p=new Mb(a,d);function f(e,t){var r=Math.atan(.25),n=1.5*t,i=Math.tan(r)*n*2;e.vertices[0].set(0,-.75,0),e.vertices[1].set(0+i/2,-.75+n,0),e.vertices[2].set(0-i/2,-.75+n,0),e.verticesNeedUpdate=!0}p.position.z=.0011,f(p.geometry,.5),c.add(p),c.visible=!1,this.getColor=function(){return i},this.getSize=function(){return o},this.addEventListener("axischanged",function(e){if(!1!==this.getButtonState("thumbpad")){var s=e.axes[0]/2,a=-e.axes[1]/2;if(n===r.COLOR&&(i.setHSL(Math.atan2(a,s)/t,1,2*(.5-Math.sqrt(s*s+a*a))),l.position.set(e.axes[0],e.axes[1],0)),n===r.SIZE){var c=.5-a;o=2*c,f(p.geometry,c)}}}),this.addEventListener("gripsdown",function(e){return n===r.COLOR?(n=r.SIZE,s.visible=!1,void(c.visible=!0)):n===r.SIZE?(n=r.COLOR,s.visible=!0,void(c.visible=!1)):void 0})};TO.prototype=Object.create(SP.prototype),TO.prototype.constructor=TO;var MO,AO;function EO(e){DT.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function CO(e,t,r){oy.call(this),this.type="CubeCamera";var n=new Kb(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Kg(1,0,0)),this.add(n);var i=new Kb(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Kg(-1,0,0)),this.add(i);var o=new Kb(90,1,e,t);o.up.set(0,0,1),o.lookAt(new Kg(0,1,0)),this.add(o);var s=new Kb(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new Kg(0,-1,0)),this.add(s);var a=new Kb(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new Kg(0,0,1)),this.add(a);var l=new Kb(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Kg(0,0,-1)),this.add(l);var c={format:Gx,magFilter:Dx,minFilter:Dx};this.renderTarget=new PE(r,r,c),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,i,r),r.activeCubeFace=2,e.render(t,o,r),r.activeCubeFace=3,e.render(t,s,r),r.activeCubeFace=4,e.render(t,a,r),r.texture.generateMipmaps=c,r.activeCubeFace=5,e.render(t,l,r),e.setRenderTarget(null)},this.clear=function(e,t,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,e.setRenderTarget(i),e.clear(t,r,n);e.setRenderTarget(null)}}function PO(e,t,r){my.call(this,e,t),this.meshPerAttribute=r||1}function OO(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function DO(e){this.type="Font",this.data=e}function NO(e,t,r,n,i,o){var s=o.glyphs[e]||o.glyphs["?"];if(s){var a,l,c,u,h,d,p,f,m=new OO;if(s.o)for(var v=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),g=0,y=v.length;g<y;){switch(v[g++]){case"m":a=v[g++]*r+n,l=v[g++]*r+i,m.moveTo(a,l);break;case"l":a=v[g++]*r+n,l=v[g++]*r+i,m.lineTo(a,l);break;case"q":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,m.quadraticCurveTo(h,d,c,u);break;case"b":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,p=v[g++]*r+n,f=v[g++]*r+i,m.bezierCurveTo(h,d,p,f,c,u)}}return{offsetX:s.ha*r,path:m}}}function LO(e,t,r,n,i,o,s){Nb.call(this,0,e,t,r,n,i,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function IO(e,t,r,n,i,o,s){Lb.call(this,0,e,t,r,n,i,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function RO(e,t){py.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new FO(e,t)),this.mergeVertices()}function FO(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];qw.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function kO(e,t){Cy.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,o,s=[],a=Math.cos(Zg.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(o=new py).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=a){var y=h[g.index1];s.push(y.x,y.y,y.z),y=h[g.index2],s.push(y.x,y.y,y.z)}}this.addAttribute("position",new Sy(s,3))}function UO(e,t){py.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new BO(e,t)),this.mergeVertices()}function BO(e,t){void 0!==e&&(Cy.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function jO(e,t,r,n){py.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new zO(e,t,r,n)),this.mergeVertices()}function zO(e,t,r,n){Cy.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=Zg.clamp(n,0,2*Math.PI);var i,o,s,a=[],l=[],c=[],u=1/t,h=new Kg,d=new hy;for(o=0;o<=t;o++){var p=r+o*u*n,f=Math.sin(p),m=Math.cos(p);for(s=0;s<=e.length-1;s++)h.x=e[s].x*f,h.y=e[s].y,h.z=e[s].x*m,l.push(h.x,h.y,h.z),d.x=o/t,d.y=s/(e.length-1),c.push(d.x,d.y)}for(o=0;o<t;o++)for(s=0;s<e.length-1;s++){var v=i=s+o*e.length,g=i+e.length,y=i+e.length+1,x=i+1;a.push(v,g,x),a.push(g,y,x)}if(this.setIndex(a),this.addAttribute("position",new Sy(l,3)),this.addAttribute("uv",new Sy(c,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,w=new Kg,_=new Kg,S=new Kg;for(i=t*e.length*3,o=0,s=0;o<e.length;o++,s+=3)w.x=b[s+0],w.y=b[s+1],w.z=b[s+2],_.x=b[i+s+0],_.y=b[i+s+1],_.z=b[i+s+2],S.addVectors(w,_).normalize(),b[s+0]=b[i+s+0]=S.x,b[s+1]=b[i+s+1]=S.y,b[s+2]=b[i+s+2]=S.z}}function VO(e,t,r){py.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new GO(e,t,r)),this.mergeVertices()}function GO(e,t,r){Cy.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,o=[],s=[],a=[],l=[],c=new Kg,u=new Kg,h=new Kg,d=new Kg,p=new Kg,f=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var v=i/t;e(v,m,u),s.push(u.x,u.y,u.z),v-1e-5>=0?(e(v-1e-5,m,h),d.subVectors(u,h)):(e(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(e(v,m-1e-5,h),p.subVectors(u,h)):(e(v,m+1e-5,h),p.subVectors(h,u)),c.crossVectors(d,p).normalize(),a.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var g=n*f+i,y=n*f+i+1,x=(n+1)*f+i+1,b=(n+1)*f+i;o.push(g,y,b),o.push(y,x,b)}this.setIndex(o),this.addAttribute("position",new Sy(s,3)),this.addAttribute("normal",new Sy(a,3)),this.addAttribute("uv",new Sy(l,2))}function HO(e,t,r,n,i,o){py.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new WO(e,t,r,n,i,o)),this.mergeVertices()}function WO(e,t,r,n,i,o){Cy.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var s,a,l,c=[],u=[],h=[],d=[],p=e,f=(t-e)/(n=void 0!==n?Math.max(1,n):1),m=new Kg,v=new hy;for(a=0;a<=n;a++){for(l=0;l<=r;l++)s=i+l/r*o,m.x=p*Math.cos(s),m.y=p*Math.sin(s),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);p+=f}for(a=0;a<n;a++){var g=a*(r+1);for(l=0;l<r;l++){var y=s=l+g,x=s+r+1,b=s+r+2,w=s+1;c.push(y,x,w),c.push(x,b,w)}}this.setIndex(c),this.addAttribute("position",new Sy(u,3)),this.addAttribute("normal",new Sy(h,3)),this.addAttribute("uv",new Sy(d,2))}function XO(e,t){py.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qO(e,t)),this.mergeVertices()}function qO(e,t){qw.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function YO(e,t){py.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new JO(e,t)),this.mergeVertices()}function JO(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("TextGeometry: font parameter is not an instance of Font."),new py;var n=r.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),BO.call(this,n,t),this.type="TextBufferGeometry"}function ZO(e,t,r,n,i,o,s){py.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==s&&console.warn("TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new QO(e,t,r,n,i,o)),this.mergeVertices()}function QO(e,t,r,n,i,o){Cy.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var s,a,l=[],c=[],u=[],h=[],d=new Kg,p=new Kg,f=new Kg,m=new Kg,v=new Kg,g=new Kg,y=new Kg;for(s=0;s<=r;++s){var x=s/r*i*Math.PI*2;for(E(x,i,o,e,f),E(x+.01,i,o,e,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),a=0;a<=n;++a){var b=a/n*Math.PI*2,w=-t*Math.cos(b),_=t*Math.sin(b);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(s/r),h.push(a/n)}}for(a=1;a<=r;a++)for(s=1;s<=n;s++){var S=(n+1)*(a-1)+(s-1),T=(n+1)*a+(s-1),M=(n+1)*a+s,A=(n+1)*(a-1)+s;l.push(S,T,A),l.push(T,M,A)}function E(e,t,r,n,i){var o=Math.cos(e),s=Math.sin(e),a=r/t*e,l=Math.cos(a);i.x=n*(2+l)*.5*o,i.y=n*(2+l)*s*.5,i.z=n*Math.sin(a)*.5}this.setIndex(l),this.addAttribute("position",new Sy(c,3)),this.addAttribute("normal",new Sy(u,3)),this.addAttribute("uv",new Sy(h,2))}function KO(e,t,r,n,i,o){py.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("TubeGeometry: taper has been removed.");var s=new $O(e,t,r,n,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function $O(e,t,r,n,i){Cy.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var s,a,l=new Kg,c=new Kg,u=new hy,h=new Kg,d=[],p=[],f=[],m=[];function v(i){h=e.getPointAt(i/t,h);var s=o.normals[i],u=o.binormals[i];for(a=0;a<=n;a++){var f=a/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*s.x+m*u.x,c.y=v*s.y+m*u.y,c.z=v*s.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(s=0;s<t;s++)v(s);v(!1===i?t:0),function(){for(s=0;s<=t;s++)for(a=0;a<=n;a++)u.x=s/t,u.y=a/n,f.push(u.x,u.y)}(),function(){for(a=1;a<=t;a++)for(s=1;s<=n;s++){var e=(n+1)*(a-1)+(s-1),r=(n+1)*a+(s-1),i=(n+1)*a+s,o=(n+1)*(a-1)+s;m.push(e,r,o),m.push(r,i,o)}}()}(),this.setIndex(m),this.addAttribute("position",new Sy(d,3)),this.addAttribute("normal",new Sy(p,3)),this.addAttribute("uv",new Sy(f,2))}function eD(e,t,r,n,i,o){oy.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===MO&&((MO=new Cy).addAttribute("position",new Sy([0,0,0,0,1,0],3)),(AO=new Lb(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ab(MO,new bb({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mb(AO,new xb({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,o)}function tD(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Cy;r.addAttribute("position",new Sy(t,3)),r.addAttribute("color",new Sy([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new bb({vertexColors:jy});FS.call(this,r,n)}function rD(e,t){this.type="Box3Helper",this.box=e;var r=void 0!==t?t:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Cy;i.setIndex(new my(n,1)),i.addAttribute("position",new Sy([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),FS.call(this,i,new bb({color:r})),this.geometry.computeBoundingSphere()}function nD(e){var t=new Cy,r=new bb({color:16777215,vertexColors:By}),n=[],i=[],o={},s=new ay(16755200),a=new ay(16711680),l=new ay(43775),c=new ay(16777215),u=new ay(3355443);function h(e,t,r){d(e,r),d(t,r)}function d(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.addAttribute("position",new Sy(n,3)),t.addAttribute("color",new Sy(i,3)),FS.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function iD(e,t,r){oy.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new Cy;n.addAttribute("position",new Sy([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new bb({fog:!1});this.lightPlane=new Ab(n,i),this.add(this.lightPlane),(n=new Cy).addAttribute("position",new Sy([0,0,0,0,0,1],3)),this.targetLine=new Ab(n,i),this.add(this.targetLine),this.update()}function oD(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=a.faces.length:console.warn("FaceNormalsHelper: only Geometry is supported. Use VertexNormalsHelper, instead.");var l=new Cy,c=new Sy(2*s*3,3);l.addAttribute("position",c),FS.call(this,l,new bb({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function sD(e,t,r,n){e=e||10,t=t||10,r=new ay(void 0!==r?r:4473924),n=new ay(void 0!==n?n:8947848);for(var i=t/2,o=e/t,s=e/2,a=[],l=[],c=0,u=0,h=-s;c<=t;c++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);var d=c===i?r:n;d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3}var p=new Cy;p.addAttribute("position",new Sy(a,3)),p.addAttribute("color",new Sy(l,3));var f=new bb({vertexColors:jy});FS.call(this,p,f)}function aD(e,t,r){oy.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Jw(t);n.rotateY(.5*Math.PI),this.material=new xb({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=jy);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new my(o,3)),this.add(new Mb(n,this.material)),this.update()}function lD(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new Cy;i.addAttribute("position",new Sy([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Ab.call(this,i,new bb({color:n}));var o=new Cy;o.addAttribute("position",new Sy([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Mb(o,new xb({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function cD(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new Oy(t,4,2),i=new xb({wireframe:!0,fog:!1});Mb.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function uD(e,t,r,n,i,o){e=e||10,t=t||16,r=r||8,n=n||64,i=new ay(void 0!==i?i:4473924),o=new ay(void 0!==o?o:8947848);var s,a,l,c,u,h,d,p=[],f=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),s=Math.sin(l)*e,a=Math.cos(l)*e,p.push(0,0,0),p.push(s,0,a),d=1&c?i:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:o,h=e-e/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b);var m=new Cy;m.addAttribute("position",new Sy(p,3)),m.addAttribute("color",new Sy(f,3));var v=new bb({vertexColors:jy});FS.call(this,m,v)}function hD(e,t){oy.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var r=new bb({fog:!1}),n=new Cy;n.addAttribute("position",new my(new Float32Array(15),3)),this.line=new Ab(n,r),this.add(this.line),this.update()}function dD(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new Cy,n=[],i=[],o=new ay(0,0,1),s=new ay(0,1,0),a=0;a<t.length;a++){var l=t[a];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}r.addAttribute("position",new Sy(n,3)),r.addAttribute("color",new Sy(i,3));var c=new bb({vertexColors:jy,depthTest:!1,depthWrite:!1,transparent:!0});FS.call(this,r,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function pD(e,t){oy.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new Cy,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var s=i/32*Math.PI*2,a=o/32*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(a),Math.sin(a),1)}r.addAttribute("position",new Sy(n,3));var l=new bb({fog:!1});this.cone=new FS(r,l),this.add(this.cone),this.update()}function fD(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=3*a.faces.length:a&&a.isBufferGeometry&&(s=a.attributes.normal.count);var l=new Cy,c=new Sy(2*s*3,3);l.addAttribute("position",c),FS.call(this,l,new bb({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function mD(e,t,r,n){MS.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function vD(e){this.manager=void 0!==e?e:pw}Object.assign((function(){var e=arguments;this.uuid=Zg.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var r=0,n=arguments.length;r!==n;++r)t[e[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}).prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=arguments,t=this._objects,r=t.length,n=this.nCachedObjects_,i=this._indicesByUUID,o=this._paths,s=this._parsedPaths,a=this._bindings,l=a.length,c=void 0,u=0,h=arguments.length;u!==h;++u){var d=e[u],p=d.uuid,f=i[p];if(void 0===f){f=r++,i[p]=f,t.push(d);for(var m=0,v=l;m!==v;++m)a[m].push(new B_(d,o[m],s[m]))}else if(f<n){c=t[f];var g=--n,y=t[g];i[y.uuid]=f,t[f]=y,i[p]=g,t[g]=d;for(m=0,v=l;m!==v;++m){var x=a[m],b=x[g],w=x[f];x[f]=b,void 0===w&&(w=new B_(d,o[m],s[m])),x[g]=w}}else t[f]!==c&&console.error("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=arguments,t=this._objects,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,s=0,a=arguments.length;s!==a;++s){var l=e[s],c=l.uuid,u=n[c];if(void 0!==u&&u>=r){var h=r++,d=t[h];n[d.uuid]=u,t[u]=d,n[c]=h,t[h]=l;for(var p=0,f=o;p!==f;++p){var m=i[p],v=m[h],g=m[u];m[u]=v,m[h]=g}}}this.nCachedObjects_=r},uncache:function(){for(var e=arguments,t=this._objects,r=t.length,n=this.nCachedObjects_,i=this._indicesByUUID,o=this._bindings,s=o.length,a=0,l=arguments.length;a!==l;++a){var c=e[a].uuid,u=i[c];if(void 0!==u)if(delete i[c],u<n){var h=--n,d=t[h],p=t[y=--r];i[d.uuid]=u,t[u]=d,i[p.uuid]=h,t[h]=p,t.pop();for(var f=0,m=s;f!==m;++f){var v=(x=o[f])[h],g=x[y];x[u]=v,x[h]=g,x.pop()}}else{var y;i[(p=t[y=--r]).uuid]=u,t[u]=p,t.pop();for(f=0,m=s;f!==m;++f){var x;(x=o[f])[u]=x[y],x.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);n=i.length,r[e]=n,o.push(e),s.push(t),i.push(u);for(var h=c,d=a.length;h!==d;++h){var p=a[h];u[h]=new B_(p,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=r,o[r]=a,o.pop(),i[r]=i[s],i.pop(),n[r]=n[s],n.pop()}}}),Object.assign((function(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}).prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),EO.prototype=Object.assign(Object.create(DT.prototype),{constructor:EO,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new Kg;return function(t){oy.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),CO.prototype=Object.create(oy.prototype),CO.prototype.constructor=CO,PO.prototype=Object.assign(Object.create(my.prototype),{constructor:PO,isInstancedBufferAttribute:!0,copy:function(e){return my.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(OO.prototype,{moveTo:function(e,t){this.currentPath=new YP,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function(e,t,r,n,i,o){this.currentPath.bezierCurveTo(e,t,r,n,i,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],o=new JP;o.curves=i.curves,t.push(o)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,o=0;o<r;i=o++){var s=t[i],a=t[o],l=a.x-s.x,c=a.y-s.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(s=t[o],l=-l,a=t[i],c=-c),e.y<s.y||e.y>a.y)continue;if(e.y===s.y){if(e.x===s.x)return!0}else{var u=c*(e.x-s.x)-l*(e.y-s.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(e.y!==s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return n}var i=yO.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return r(o);var s,a,l,c=[];if(1===o.length)return a=o[0],(l=new JP).curves=a.curves,c.push(l),c;var u=!i(o[0].getPoints());u=e?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)s=i(h=(a=o[g]).getPoints()),(s=e?!s:s)?(!u&&f[v]&&v++,f[v]={s:new JP,p:h},f[v].s.curves=a.curves,u&&v++,m[v]=[]):m[v].push({h:a,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var x=!1,b=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)n(M.p,f[E].p)&&(w!==E&&b.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):x=!0);A&&p[w].push(M)}b.length>0&&(x||(m=p))}g=0;for(var C=f.length;g<C;g++){l=f[g].s,c.push(l);for(var P=0,O=(d=m[g]).length;P<O;P++)l.holes.push(d[P].h)}return c}}),Object.assign(DO.prototype,{isFont:!0,generateShapes:function(e,t,r){void 0===t&&(t=100),void 0===r&&(r=4);for(var n=[],i=function(e,t,r,n){for(var i=String(e).split(""),o=t/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=[],l=0,c=0,u=0;u<i.length;u++){var h=i[u];if("\n"===h)l=0,c-=s;else{var d=NO(h,r,o,l,c,n);l+=d.offsetX,a.push(d.path)}}return a}(e,t,r,this.data),o=0,s=i.length;o<s;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}),LO.prototype=Object.create(Nb.prototype),LO.prototype.constructor=LO,IO.prototype=Object.create(Lb.prototype),IO.prototype.constructor=IO,RO.prototype=Object.create(py.prototype),RO.prototype.constructor=RO,FO.prototype=Object.create(qw.prototype),FO.prototype.constructor=FO,kO.prototype=Object.create(Cy.prototype),kO.prototype.constructor=kO,UO.prototype=Object.create(py.prototype),UO.prototype.constructor=UO,BO.prototype=Object.create(Cy.prototype),BO.prototype.constructor=BO,BO.prototype.getArrays=function(){var e=this.getAttribute("position"),t=e?Array.prototype.slice.call(e.array):[],r=this.getAttribute("uv"),n=r?Array.prototype.slice.call(r.array):[],i=this.index;return{position:t,uv:n,index:i?Array.prototype.slice.call(i.array):[]}},BO.prototype.addShapeList=function(e,t){var r=e.length;t.arrays=this.getArrays();for(var n=0;n<r;n++){var i=e[n];this.addShape(i,t)}this.setIndex(t.arrays.index),this.addAttribute("position",new Sy(t.arrays.position,3)),this.addAttribute("uv",new Sy(t.arrays.uv,2))},BO.prototype.addShape=function(e,t){var r,n,i,o,s,a,l,c,u=t.arrays?t.arrays:this.getArrays(),h=u.position,d=u.index,p=u.uv,f=[],m=void 0!==t.amount?t.amount:100,v=void 0!==t.bevelThickness?t.bevelThickness:6,g=void 0!==t.bevelSize?t.bevelSize:v-2,y=void 0!==t.bevelSegments?t.bevelSegments:3,x=void 0===t.bevelEnabled||t.bevelEnabled,b=void 0!==t.curveSegments?t.curveSegments:12,w=void 0!==t.steps?t.steps:1,_=t.extrudePath,S=!1,T=void 0!==t.UVGenerator?t.UVGenerator:UO.WorldUVGenerator;_&&(r=_.getSpacedPoints(w),S=!0,x=!1,n=void 0!==t.frames?t.frames:_.computeFrenetFrames(w,!1),i=new Kg,o=new Kg,s=new Kg),x||(y=0,v=0,g=0);var M=this,A=e.extractPoints(b),E=A.shape,C=A.holes;if(!yO.isClockWise(E))for(E=E.reverse(),l=0,c=C.length;l<c;l++)a=C[l],yO.isClockWise(a)&&(C[l]=a.reverse());var P=yO.triangulateShape(E,C),O=E;for(l=0,c=C.length;l<c;l++)a=C[l],E=E.concat(a);function D(e,t,r){return t||console.error("ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var N,L,I,R,F,k,U=E.length,B=P.length;function j(e,t,r){var n,i,o,s=e.x-t.x,a=e.y-t.y,l=r.x-e.x,c=r.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(u),p=Math.sqrt(l*l+c*c),f=t.x-a/d,m=t.y+s/d,v=((r.x-c/p-f)*c-(r.y+l/p-m)*l)/(s*c-a*l),g=(n=f+s*v-e.x)*n+(i=m+a*v-e.y)*i;if(g<=2)return new hy(n,i);o=Math.sqrt(g/2)}else{var y=!1;s>Number.EPSILON?l>Number.EPSILON&&(y=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(a)===Math.sign(c)&&(y=!0),y?(n=-a,i=s,o=Math.sqrt(u)):(n=s,i=a,o=Math.sqrt(u/2))}return new hy(n/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=j(O[V],O[H],O[W]);var X,q,Y=[],J=z.concat();for(l=0,c=C.length;l<c;l++){for(a=C[l],X=[],V=0,H=(G=a.length)-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=j(a[V],a[H],a[W]);Y.push(X),J=J.concat(X)}for(N=0;N<y;N++){for(I=N/y,R=v*Math.cos(I*Math.PI/2),L=g*Math.sin(I*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=D(O[V],z[V],L)).x,F.y,-R);for(l=0,c=C.length;l<c;l++)for(a=C[l],X=Y[l],V=0,G=a.length;V<G;V++)Q((F=D(a[V],X[V],L)).x,F.y,-R)}for(L=g,V=0;V<U;V++)F=x?D(E[V],J[V],L):E[V],S?(o.copy(n.normals[0]).multiplyScalar(F.x),i.copy(n.binormals[0]).multiplyScalar(F.y),s.copy(r[0]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,0);for(q=1;q<=w;q++)for(V=0;V<U;V++)F=x?D(E[V],J[V],L):E[V],S?(o.copy(n.normals[q]).multiplyScalar(F.x),i.copy(n.binormals[q]).multiplyScalar(F.y),s.copy(r[q]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,m/w*q);for(N=y-1;N>=0;N--){for(I=N/y,R=v*Math.cos(I*Math.PI/2),L=g*Math.sin(I*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=D(O[V],z[V],L)).x,F.y,m+R);for(l=0,c=C.length;l<c;l++)for(a=C[l],X=Y[l],V=0,G=a.length;V<G;V++)F=D(a[V],X[V],L),S?Q(F.x,F.y+r[w-1].y,r[w-1].x+R):Q(F.x,F.y,m+R)}function Z(e,t){var r,n;for(V=e.length;--V>=0;){r=V,(n=V-1)<0&&(n=e.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var s=U*i,a=U*(i+1);$(t+r+s,t+n+s,t+n+a,t+r+a)}}}function Q(e,t,r){f.push(e),f.push(t),f.push(r)}function K(e,t,r){ee(e),ee(t),ee(r);var n=h.length/3,i=T.generateTopUV(M,h,n-3,n-2,n-1);te(i[0]),te(i[1]),te(i[2])}function $(e,t,r,n){ee(e),ee(t),ee(n),ee(t),ee(r),ee(n);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);te(o[0]),te(o[1]),te(o[3]),te(o[1]),te(o[2]),te(o[3])}function ee(e){d.push(h.length/3),h.push(f[3*e+0]),h.push(f[3*e+1]),h.push(f[3*e+2])}function te(e){p.push(e.x),p.push(e.y)}!function(){var e=h.length/3;if(x){var t=0,r=U*t;for(V=0;V<B;V++)K((k=P[V])[2]+r,k[1]+r,k[0]+r);for(r=U*(t=w+2*y),V=0;V<B;V++)K((k=P[V])[0]+r,k[1]+r,k[2]+r)}else{for(V=0;V<B;V++)K((k=P[V])[2],k[1],k[0]);for(V=0;V<B;V++)K((k=P[V])[0]+U*w,k[1]+U*w,k[2]+U*w)}M.addGroup(e,h.length/3-e,0)}(),function(){var e=h.length/3,t=0;for(Z(O,t),t+=O.length,l=0,c=C.length;l<c;l++)Z(a=C[l],t),t+=a.length;M.addGroup(e,h.length/3-e,1)}(),t.arrays||(this.setIndex(d),this.addAttribute("position",new Sy(h,3)),this.addAttribute("uv",new Sy(p,2)))},UO.WorldUVGenerator={generateTopUV:function(e,t,r,n,i){var o=t[3*r],s=t[3*r+1],a=t[3*n],l=t[3*n+1],c=t[3*i],u=t[3*i+1];return[new hy(o,s),new hy(a,l),new hy(c,u)]},generateSideWallUV:function(e,t,r,n,i,o){var s=t[3*r],a=t[3*r+1],l=t[3*r+2],c=t[3*n],u=t[3*n+1],h=t[3*n+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(a-u)<.01?[new hy(s,1-l),new hy(c,1-h),new hy(d,1-f),new hy(m,1-g)]:[new hy(a,1-l),new hy(u,1-h),new hy(p,1-f),new hy(v,1-g)]}},jO.prototype=Object.create(py.prototype),jO.prototype.constructor=jO,zO.prototype=Object.create(Cy.prototype),zO.prototype.constructor=zO,VO.prototype=Object.create(py.prototype),VO.prototype.constructor=VO,GO.prototype=Object.create(Cy.prototype),GO.prototype.constructor=GO,HO.prototype=Object.create(py.prototype),HO.prototype.constructor=HO,WO.prototype=Object.create(Cy.prototype),WO.prototype.constructor=WO,XO.prototype=Object.create(py.prototype),XO.prototype.constructor=XO,qO.prototype=Object.create(qw.prototype),qO.prototype.constructor=qO,YO.prototype=Object.create(py.prototype),YO.prototype.constructor=YO,JO.prototype=Object.create(BO.prototype),JO.prototype.constructor=JO,ZO.prototype=Object.create(py.prototype),ZO.prototype.constructor=ZO,QO.prototype=Object.create(Cy.prototype),QO.prototype.constructor=QO,KO.prototype=Object.create(py.prototype),KO.prototype.constructor=KO,$O.prototype=Object.create(Cy.prototype),$O.prototype.constructor=$O,eD.prototype=Object.create(oy.prototype),eD.prototype.constructor=eD,eD.prototype.setDirection=function(){var e,t=new Kg;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),eD.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},eD.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},tD.prototype=Object.create(FS.prototype),tD.prototype.constructor=tD,rD.prototype=Object.create(FS.prototype),rD.prototype.constructor=rD,rD.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),oy.prototype.updateMatrixWorld.call(this,e))},nD.prototype=Object.create(FS.prototype),nD.prototype.constructor=nD,nD.prototype.update=function(){var e,t,r=new Kg,n=new Qb;function i(i,o,s,a){r.set(o,s,a).unproject(n);var l=t[i];if(void 0!==l)for(var c=e.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],r.x,r.y,r.z)}return function(){e=this.geometry,t=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),iD.prototype=Object.create(oy.prototype),iD.prototype.constructor=iD,iD.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},iD.prototype.update=function(){var e=new Kg,t=new Kg,r=new Kg;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),oD.prototype=Object.create(FS.prototype),oD.prototype.constructor=oD,oD.prototype.update=function(){var e=new Kg,t=new Kg,r=new ny;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,l=0,c=0,u=a.length;c<u;c++){var h=a[c],d=h.normal;e.copy(s[h.a]).add(s[h.b]).add(s[h.c]).divideScalar(3).applyMatrix4(n),t.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),i.setXYZ(l,e.x,e.y,e.z),l+=1,i.setXYZ(l,t.x,t.y,t.z),l+=1}i.needsUpdate=!0}}(),sD.prototype=Object.create(FS.prototype),sD.prototype.constructor=sD,aD.prototype=Object.create(oy.prototype),aD.prototype.constructor=aD,aD.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},aD.prototype.update=function(){var e=new Kg,t=new ay,r=new ay;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,s=i.count;o<s;o++){var a=o<s/2?t:r;i.setXYZ(o,a.r,a.g,a.b)}i.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),lD.prototype=Object.create(Ab.prototype),lD.prototype.constructor=lD,lD.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),oy.prototype.updateMatrixWorld.call(this,e)},cD.prototype=Object.create(Mb.prototype),cD.prototype.constructor=cD,cD.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},cD.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},uD.prototype=Object.create(FS.prototype),uD.prototype.constructor=uD,hD.prototype=Object.create(oy.prototype),hD.prototype.constructor=hD,hD.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},hD.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=e,n[1]=-t,n[2]=0,n[3]=e,n[4]=t,n[5]=0,n[6]=-e,n[7]=t,n[8]=0,n[9]=-e,n[10]=-t,n[11]=0,n[12]=e,n[13]=-t,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},dD.prototype=Object.create(FS.prototype),dD.prototype.constructor=dD,dD.prototype.updateMatrixWorld=function(){var e=new Kg,t=new Qg,r=new Qg;return function(n){var i=this.bones,o=this.geometry,s=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var a=0,l=0;a<i.length;a++){var c=i[a];c.parent&&c.parent.isBone&&(t.multiplyMatrices(r,c.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(r,c.parent.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute("position").needsUpdate=!0,oy.prototype.updateMatrixWorld.call(this,n)}}(),pD.prototype=Object.create(oy.prototype),pD.prototype.constructor=pD,pD.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},pD.prototype.update=function(){var e=new Kg,t=new Kg;return function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),fD.prototype=Object.create(FS.prototype),fD.prototype.constructor=fD,fD.prototype.update=function(){var e=new Kg,t=new Kg,r=new ny;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,l=s.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=a[d[n[p]]],v=d.vertexNormals[p];e.copy(m).applyMatrix4(i),t.copy(v).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}else if(s&&s.isBufferGeometry){var g=s.attributes.position,y=s.attributes.normal;for(c=0,p=0,f=g.count;p<f;p++)e.set(g.getX(p),g.getY(p),g.getZ(p)).applyMatrix4(i),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}o.needsUpdate=!0}}(),mD.prototype=Object.assign(Object.create(MS.prototype),{constructor:mD,isRectAreaLight:!0,copy:function(e){return MS.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=MS.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign((function(e){this.manager=void 0!==e?e:pw}).prototype,{load:function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e,t){for(var r=[],n=0;n<e.length;n++){var i=Jb.parse(e[n]);r.push(i)}t(r)}}),Object.assign(vD.prototype,{load:function(e,t,r,n){var i=this;new mw(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=new Cy,r=e.data.index;if(void 0!==r){var n=new gD[r.type](r.array);t.setIndex(new my(n,1))}var i=e.data.attributes;for(var o in i){var s=i[o];n=new gD[s.type](s.array);t.addAttribute(o,new my(n,s.itemSize,s.normalized))}var a=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==a)for(var l=0,c=a.length;l!==c;++l){var u=a[l];t.addGroup(u.start,u.count,u.materialIndex)}var h=e.data.boundingSphere;if(void 0!==h){var d=new Kg;void 0!==h.center&&d.fromArray(h.center),t.boundingSphere=new uy(d,h.radius)}return t}});var gD={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function yD(e){"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:pw,this.options=void 0}function xD(){oy.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function bD(e,t,r){this.name="",this.color=new ay(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function wD(e,t){this.name="",this.color=new ay(e),this.density=void 0!==t?t:25e-5}Object.assign((function(e){this.manager=void 0!==e?e:pw}).prototype,{crossOrigin:"Anonymous",load:function(e,t,r,n){var i=new _T,o=new Pw(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function a(r){o.load(e[r],function(e){i.images[r]=e,6===++s&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(var l=0;l<e.length;++l)a(l);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign((function(e){this.manager=void 0!==e?e:pw}).prototype,{load:function(e,t,r,n){var i=this,o=new mw(this.manager);o.setPath(this.path),o.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)},r,n)},parse:function(e){return new DO(e)},setPath:function(e){return this.path=e,this}}),yD.prototype={constructor:yD,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var i=this,o=hw.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(r){hw.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},xD.prototype=Object.assign(Object.create(oy.prototype),{constructor:xD,copy:function(e){oy.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);r.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new Kg;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,r)}}(),update:function(){var e=new Kg,t=new Kg;return function(r){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);n[0].object.visible=!0;for(var o=1,s=n.length;o<s&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<s;o++)n[o].object.visible=!1}}}(),toJSON:function(e){var t=oy.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),bD.prototype.isFog=!0,bD.prototype.clone=function(){return new bD(this.color.getHex(),this.near,this.far)},bD.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},wD.prototype.isFogExp2=!0,wD.prototype.clone=function(){return new wD(this.color.getHex(),this.density)},wD.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};var _D={WireframeGeometry:aS,TetrahedronGeometry:XO,TetrahedronBufferGeometry:qO,OctahedronGeometry:Yw,OctahedronBufferGeometry:Jw,IcosahedronGeometry:AP,IcosahedronBufferGeometry:EP,DodecahedronGeometry:RO,DodecahedronBufferGeometry:FO,PolyhedronGeometry:Xw,PolyhedronBufferGeometry:qw,TubeGeometry:KO,TubeBufferGeometry:$O,TorusKnotGeometry:ZO,TorusGeometry:Zw,TorusBufferGeometry:Qw,TextGeometry:YO,TextBufferGeometry:JO,SphereGeometry:Py,SphereBufferGeometry:Oy,RingGeometry:HO,RingBufferGeometry:WO,PlaneGeometry:aw,PlaneBufferGeometry:lw,LatheGeometry:jO,LatheBufferGeometry:zO,ShapeGeometry:wO,ShapeBufferGeometry:_O,ExtrudeGeometry:UO,ExtrudeBufferGeometry:BO,EdgesGeometry:kO,ConeGeometry:LO,ConeBufferGeometry:IO,CylinderGeometry:Nb,CylinderBufferGeometry:Lb,CircleGeometry:TP,CircleBufferGeometry:MP,BoxGeometry:Ob,BoxBufferGeometry:Db};Object.assign((function(e){this.manager=void 0!==e?e:pw,this.texturePath=""}).prototype,{load:function(e,t,r,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this;new mw(i.manager).load(e,function(r){var o=null;try{o=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,t):console.error("ObjectLoader: Can't load "+e+". Use JSONLoader instead.")},r,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(a)}),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,n,s);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new JP).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new Lw,i=new vD,o=0,s=e.length;o<s;o++){var a,l=e[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new _D[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new _D[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new _D[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new _D[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new _D[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new _D[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new _D[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new _D[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new _D[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new _D[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new _D[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new _D[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var c=[];for(o=0,s=l.shapes.length;o<s;o++){var u=t[l.shapes[o]];c.push(u)}a=new _D[l.type](c,l.curveSegments);break;case"BufferGeometry":a=i.parse(l);break;case"Geometry":a=n.parse(l,this.texturePath).geometry;break;default:console.warn('ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),r[l.uuid]=a}return r},parseMaterials:function(e,t){var r={};if(void 0!==e){var n=new Cw;n.setTextures(t);for(var i=0,o=e.length;i<o;i++){var s=e[i];if("MultiMaterial"===s.type){for(var a=[],l=0;l<s.materials.length;l++)a.push(n.parse(s.materials[l]));r[s.uuid]=a}else r[s.uuid]=n.parse(s)}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=Jb.parse(e[r]);t.push(n)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),o.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemEnd(e),r.manager.itemError(e)})}if(void 0!==e&&e.length>0){var o=new Pw(new dw(t));o.setCrossOrigin(this.crossOrigin);for(var s=0,a=e.length;s<a;s++){var l=e[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=i(c)}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var s=e[i];void 0===s.image&&console.warn('ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("ObjectLoader: Undefined image",s.image);var a=new nw(t[s.image]);a.needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,SD)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],TD),a.wrapT=r(s.wrap[1],TD)),void 0!==s.format&&(a.format=s.format),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,MD)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,MD)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),n[s.uuid]=a}return n},parseObject:function(e,t,r){var n;function i(e){return void 0===t[e]&&console.warn("ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var o=e[n];void 0===r[o]&&console.warn("ObjectLoader: Undefined material",o),t.push(r[o])}return t}return void 0===r[e]&&console.warn("ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new ew,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new ay(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new bD(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new wD(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new Kb(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new tw(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new RS(e.color,e.intensity);break;case"DirectionalLight":n=new PS(e.color,e.intensity);break;case"PointLight":n=new ES(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new mD(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new DS(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new NS(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=i(e.geometry),a=o(e.material);n=s.bones&&s.bones.length>0?new bS(s,a):new Mb(s,a);break;case"LOD":n=new xD;break;case"Line":n=new Ab(i(e.geometry),o(e.material),e.mode);break;case"LineLoop":n=new zS(i(e.geometry),o(e.material));break;case"LineSegments":n=new FS(i(e.geometry),o(e.material));break;case"PointCloud":case"Points":n=new $_(i(e.geometry),o(e.material));break;case"Sprite":n=new aA(o(e.material));break;case"Group":n=new mS;break;default:n=new oy}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],t,r));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var d=u[h],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}return n}});var SD={UVMapping:gx,CubeReflectionMapping:yx,CubeRefractionMapping:xx,EquirectangularReflectionMapping:bx,EquirectangularRefractionMapping:wx,SphericalReflectionMapping:_x,CubeUVReflectionMapping:Sx,CubeUVRefractionMapping:Tx},TD={RepeatWrapping:Mx,ClampToEdgeWrapping:Ax,MirroredRepeatWrapping:Ex},MD={NearestFilter:Cx,NearestMipMapNearestFilter:Px,NearestMipMapLinearFilter:Ox,LinearFilter:Dx,LinearMipMapNearestFilter:Nx,LinearMipMapLinearFilter:Lx};function AD(e,t,r,n,i,o,s,a,l){nw.call(this,e,t,r,n,i,o,s,a,l),this.generateMipmaps=!1}Object.assign((function(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}).prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),AD.prototype=Object.assign(Object.create(nw.prototype),{constructor:AD,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});var ED,CD=function(e,t){Mb.call(this,e);var r=this,n=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,i=void 0!==t.textureHeight?t.textureHeight:512,o=void 0!==t.clipBias?t.clipBias:0,s=void 0!==t.alpha?t.alpha:1,a=void 0!==t.time?t.time:0,l=void 0!==t.waterNormals?t.waterNormals:null,c=void 0!==t.sunDirection?t.sunDirection:new Kg(.70707,.70707,0),u=new ay(void 0!==t.sunColor?t.sunColor:16777215),h=new ay(void 0!==t.waterColor?t.waterColor:8355711),d=void 0!==t.eye?t.eye:new Kg(0,0,0),p=void 0!==t.distortionScale?t.distortionScale:20,f=void 0!==t.side?t.side:Ry,m=void 0!==t.fog&&t.fog,v=new Sb,g=new Kg,y=new Kg,x=new Kg,b=new Qg,w=new Kg(0,0,-1),_=new fy,S=new Kg,T=new Kg,M=new fy,A=new Qg,E=new Kb,C=new iw(n,i,{minFilter:Dx,magFilter:Dx,format:Gx,stencilBuffer:!1});Zg.isPowerOfTwo(n)&&Zg.isPowerOfTwo(i)||(C.texture.generateMipmaps=!1);var P={uniforms:ow.merge([F_.fog,F_.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Qg},sunColor:{value:new ay(8355711)},sunDirection:{value:new Kg(.70707,.70707,0)},eye:{value:new Kg},waterColor:{value:new ay(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",R_.fog_pars_vertex,R_.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",R_.fog_vertex,R_.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",R_.common,R_.packing,R_.bsdfs,R_.fog_pars_fragment,R_.lights_pars_begin,R_.shadowmap_pars_fragment,R_.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xy * size );","\tvec3 surfaceNormal = normalize( noise.xyz * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xy * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",R_.tonemapping_fragment,R_.fog_fragment,"}"].join("\n")},O=new sw({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:ow.clone(P.uniforms),transparent:!0,lights:!0,side:f,fog:m});O.uniforms.mirrorSampler.value=C.texture,O.uniforms.textureMatrix.value=A,O.uniforms.alpha.value=s,O.uniforms.time.value=a,O.uniforms.normalSampler.value=l,O.uniforms.sunColor.value=u,O.uniforms.waterColor.value=h,O.uniforms.sunDirection.value=c,O.uniforms.distortionScale.value=p,O.uniforms.eye.value=d,r.material=O,r.mirrorCamera=E,r.onBeforeRender=function(e,t,n){if(y.setFromMatrixPosition(r.matrixWorld),x.setFromMatrixPosition(n.matrixWorld),b.extractRotation(r.matrixWorld),g.set(0,0,1),g.applyMatrix4(b),S.subVectors(y,x),!(S.dot(g)>0)){S.reflect(g).negate(),S.add(y),b.extractRotation(n.matrixWorld),w.set(0,0,-1),w.applyMatrix4(b),w.add(x),T.subVectors(y,w),T.reflect(g).negate(),T.add(y),E.position.copy(S),E.up.set(0,1,0),E.up.applyMatrix4(b),E.up.reflect(g),E.lookAt(T),E.far=n.far,E.updateMatrixWorld(),E.projectionMatrix.copy(n.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(E.projectionMatrix),A.multiply(E.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(g,y),v.applyMatrix4(E.matrixWorldInverse),_.set(v.normal.x,v.normal.y,v.normal.z,v.constant);var i=E.projectionMatrix;M.x=(Math.sign(_.x)+i.elements[8])/i.elements[0],M.y=(Math.sign(_.y)+i.elements[9])/i.elements[5],M.z=-1,M.w=(1+i.elements[10])/i.elements[14],_.multiplyScalar(2/_.dot(M)),i.elements[2]=_.x,i.elements[6]=_.y,i.elements[10]=_.z+1-o,i.elements[14]=_.w,d.setFromMatrixPosition(n.matrixWorld);var s=e.getRenderTarget(),a=e.vr.enabled,l=e.shadowMap.autoUpdate;r.visible=!1,e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,E,C,!0),r.visible=!0,e.vr.enabled=a,e.shadowMap.autoUpdate=l,e.setRenderTarget(s)}}};CD.prototype=Object.create(Mb.prototype),CD.prototype.constructor=CD,function(e){e[e.DefaultSceneLayer=0]="DefaultSceneLayer",e[e.SeaReflectionLayer=1]="SeaReflectionLayer"}(ED||(ED={}));var PD=ED,OD=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})};class DD{constructor(e){this.controlService=e,this.beforeWorldRenderSubject=new O,this.afterWorldRenderSubject=new O,this.beforeControlRenderSubject=new O,this.afterControlRenderSubject=new O,this.renderWorldLoopEnabled=!1,this.fieldOfView=45,this.nearClippingPane=1,this.farClippingPane=1e4,this.cameraDistance=64,this.controlsRenderingAlreadyRequested=!1,this.worldRenderingAlreadyRequested=!1,this.sunLightPhi=.9,this.sunLightTheta=2.5,this.seaLevel=58,e.cameraDistanceSubject.subscribe(e=>{if(this.cameraDistance=e,this.sunDirectLight){let e=(this.cameraDistance*Math.tan(this.fieldOfView*Math.PI/360)+this.seaLevel*Math.tan(this.sunLightPhi))*Math.sin(Math.PI/2-this.sunLightPhi);e*=Math.sqrt(3),e*=1.1,this.sunDirectLight.shadow.camera.bottom=-e,this.sunDirectLight.shadow.camera.top=e,this.sunDirectLight.shadow.camera.left=-e,this.sunDirectLight.shadow.camera.right=e,this.sunDirectLight.shadow.camera.near=0,this.sunDirectLight.shadow.camera.far=4*this.cameraDistance,this.sunDirectLight.shadow.map&&(this.sunDirectLight.shadow.map.dispose(),this.sunDirectLight.shadow.map=null)}})}get worldCanvas(){return this.worldCanvasRef.nativeElement}get controlCanvas(){return this.controlCanvasRef.nativeElement}animateCamera(){this.camera&&this.car&&this.car.mesh&&(this.camera.position.x=this.car.mesh.position.x+Math.cos(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.y=this.car.mesh.position.y+Math.sin(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.z=this.cameraDistance,this.camera.up=new Og.Vector3(0,1,0),this.camera.lookAt(new Og.Vector3(this.car.mesh.position.x+Math.cos(this.car.rotation)*this.car.speed/2,this.car.mesh.position.y+Math.sin(this.car.rotation)*this.car.speed/2,this.car.mesh.position.z)),this.sunDirectLight.position.set(this.camera.position.x+this.cameraDistance*Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.camera.position.y+this.cameraDistance*Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.car.mesh.position.z+this.cameraDistance*Math.cos(this.sunLightPhi)),this.sunDirectLight.target.position.set(this.camera.position.x,this.camera.position.y,this.car.mesh.position.z))}resizeCanvas(e,t){this.worldCanvas.width=e,this.worldCanvas.height=t,this.controlCanvas.width=e,this.controlCanvas.height=t,this.camera.aspect=this.worldCanvas.width/this.worldCanvas.height,this.camera.updateProjectionMatrix(),this.worldRenderer&&this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer&&this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height),this.renderWorldLoopEnabled||this.renderWorldOnce(),this.renderControlsOnce()}addCar(e,t=!1){t&&(this.car=e),this.scene.add(e.mesh)}addMap(e,t){e.traverse(function(e){e instanceof Og.Mesh&&(e.castShadow=t,e.receiveShadow=t)}),this.scene.add(e)}addControlElement(e){this.controlScene.add(e)}createScene(){this.scene=new Og.Scene,this.controlScene=new Og.Scene;let e=this.worldCanvas.width/this.worldCanvas.height;this.camera=new Og.PerspectiveCamera(this.fieldOfView,e,this.nearClippingPane,this.farClippingPane),this.camera.layers.enable(PD.SeaReflectionLayer),this.sunAmbientLight=new Og.HemisphereLight(12303359,8949920,.85),this.sunAmbientLight.position.set(0,0,1),this.sunAmbientLight.layers.enable(PD.SeaReflectionLayer),this.scene.add(this.sunAmbientLight),this.sunDirectLight=new Og.DirectionalLight(16777215,1.5),this.sunDirectLight.layers.enable(PD.SeaReflectionLayer),this.sunDirectLight.castShadow=!0,this.sunDirectLight.shadow.mapSize.width=2048,this.sunDirectLight.shadow.mapSize.height=2048,this.scene.add(this.sunDirectLight),this.scene.add(this.sunDirectLight.target),console.log(this.sunDirectLight);const t=new Og.Vector3(Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.cos(this.sunLightPhi));this.sky=new Dg,this.sky.scale.setScalar(8e3),this.sky.up=new Og.Vector3(0,0,1),this.sky.material.fragmentShader=this.sky.material.fragmentShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.vertexShader=this.sky.material.vertexShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.uniforms.turbidity.value=10,this.sky.material.uniforms.rayleigh.value=2,this.sky.material.uniforms.luminance.value=1,this.sky.material.uniforms.mieCoefficient.value=.005,this.sky.material.uniforms.mieDirectionalG.value=.8,this.sky.material.uniforms.sunPosition.value=t.clone(),this.sky.layers.set(PD.SeaReflectionLayer),this.scene.add(this.sky),this.water=new CD(new Og.PlaneBufferGeometry(1e4,1e4),{textureWidth:512,textureHeight:512,waterNormals:(new Og.TextureLoader).load("assets/models/maps/common/textures/waternormals.jpg",function(e){e.wrapS=e.wrapT=Og.RepeatWrapping}),alpha:1,sunDirection:t.clone(),sunColor:16777215,waterColor:13365,distortionScale:3.7}),this.water.material.uniforms.size.value=3,this.water.position.z=-this.seaLevel,this.scene.add(this.water),this.beforeWorldRenderSubject.subscribe(()=>{this.water.material.uniforms.time.value+=1/60}),this.water.mirrorCamera.layers.set(PD.SeaReflectionLayer)}initCanvases(){this.worldRenderer=new Og.WebGLRenderer({canvas:this.worldCanvas,antialias:!0,preserveDrawingBuffer:!0}),this.worldRenderer.shadowMap.enabled=!0,this.worldRenderer.shadowMapType=Og.PCFSoftShadowMap,this.worldRenderer.setPixelRatio(devicePixelRatio),this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer=new Og.WebGLRenderer({canvas:this.controlCanvas,antialias:!0,alpha:!0}),this.controlRenderer.setPixelRatio(devicePixelRatio),this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height)}ngAfterViewInit(){this.resizeCanvas(window.innerWidth,window.innerHeight),this.initCanvases()}ngOnInit(){this.createScene()}renderWorldOnce(){this.worldRenderingAlreadyRequested||(this.worldRenderingAlreadyRequested=!0,requestAnimationFrame(this._renderWorldSceneRoutine.bind(this)))}startWorldRenderingLoop(){this.renderWorldLoopEnabled=!0,this.renderWorldOnce()}stopWorldRenderingLoop(){this.renderWorldLoopEnabled=!1}renderControlsOnce(){this.controlsRenderingAlreadyRequested||(this.controlsRenderingAlreadyRequested=!0,requestAnimationFrame(this._renderControlSceneRoutine.bind(this)))}renderControlsOnceSync(){return OD(this,void 0,void 0,function*(){return new Promise(e=>{const t=this.afterControlRenderSubject.subscribe(()=>{t.unsubscribe(),e()});this.renderControlsOnce()})})}_renderWorldSceneRoutine(){this.beforeWorldRenderSubject.next(),this.worldRenderer.render(this.scene,this.camera),this.afterWorldRenderSubject.next(),this.renderWorldLoopEnabled?requestAnimationFrame(this._renderWorldSceneRoutine.bind(this)):this.worldRenderingAlreadyRequested=!1}_renderControlSceneRoutine(){this.beforeControlRenderSubject.next(),this.controlRenderer.render(this.controlScene,this.camera),this.afterControlRenderSubject.next(),this.controlsRenderingAlreadyRequested=!1}}var ND=to({encapsulation:0,styles:[["stage-3d[_ngcontent-%COMP%]{width:100%;height:100%}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}"]],data:{}});function LD(e){return qs(0,[ks(402653184,1,{worldCanvasRef:0}),ks(402653184,2,{controlCanvasRef:0}),(e()(),Lo(2,0,[[1,0],["worldCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null)),(e()(),Lo(3,0,[[2,0],["controlCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null))],null,null)}Ko("stage-3d",DD,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"stage-3d",[],null,null,null,LD,ND)),_s(1,4308992,null,0,DD,[Jg],null,null)],function(e,t){e(t,1,0)},null)},{},{},[]);var ID=r("3hGs");class RD{constructor(e,t,r,n){this.scene=e,this.polygon=t,this.roadSpline=r,this.startPositions=n}}class FD{constructor(){this.outerPolygon=[[-2048,-2048],[2048,-2048],[2048,2048],[-2048,2048]],this.innerPolygons=[]}isContainingPoint(e){if(!Fg.isPointInsidePolygon(e,this.outerPolygon))return!1;for(let t of this.innerPolygons)if(Fg.isPointInsidePolygon(e,t))return!1;return!0}getLinePolygonIntersection(e,t){let r=this.isContainingPoint(e)?e:t,n=r===e?t:e;for(;Fg.getDistanceBetweenPoints(r,n)>.05;){let e=Fg.getMiddlePoint(r,n);this.isContainingPoint(e)?r=e:n=e}return Fg.getMiddlePoint(r,n)}static fromDummyObject(e){return new FD}}var kD=PIXI.Point;class UD{constructor(e=new PIXI.Point,t=0,r=0){this.position=new kD,this.rotation=0,this.speed=0,this.position=e,this.rotation=t,this.speed=r}}class BD extends Og.Vector3{constructor(e,t,r){super(e,t,0),this.distanceFromStart=r}}class jD{constructor(e,t){this.pointOnSpline=e,this.lineIndex=t}}class zD{constructor(e,t){this.distanceFromStart=e,this.lapPercent=t}}class VD{constructor(e){this.minSegmentLength=Number.MAX_SAFE_INTEGER,this.roadLength=0,this.points=[],this.lines=[];for(let r=0;r<e.length;r++){if(r>0){const t=e[r].distanceTo(e[r-1]);this.roadLength+=t,this.minSegmentLength=Math.min(this.minSegmentLength,t),this.lines.push(new Og.Line3(e[r-1],e[r]))}this.points.push(new BD(e[r].x,e[r].y,this.roadLength))}const t=e[e.length-1].distanceTo(e[0]);this.roadLength+=t,this.minSegmentLength=Math.min(this.minSegmentLength,t),this.lines.push(new Og.Line3(e[e.length-1],e[0]))}getNearestPointOnSpline(e,t=-1,r=Number.MAX_SAFE_INTEGER){let n;if(-1===t)n=this.lines.map((e,t)=>({line:e,originalIndex:t}));else{n=[];for(let e=t-r;e<=t+r;e++){const t=(e+this.lines.length)%this.lines.length;n.push({line:this.lines[t],originalIndex:t})}}return n.map(t=>new jD(t.line.closestPointToPoint(e,!0,new Og.Vector3),t.originalIndex)).reduce((t,r)=>t?r.pointOnSpline.distanceTo(e)<t.pointOnSpline.distanceTo(e)?r:t:r,null)}getLapProgress(e){const t=this.points[e.lineIndex].distanceFromStart+this.lines[e.lineIndex].start.distanceTo(e.pointOnSpline);return new zD(t,100*t/this.roadLength)}}var GD=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})},HD=PIXI.Point;class WD{constructor(){}loadCar(e){return GD(this,void 0,void 0,function*(){const t=WD.CARS_CACHE.get(e);if(t)return console.log("Car loaded from cache"),t.clone();const r=yield this.loadColladaScene(`cars/${e}/`,"body");return r.scene.traverse(function(e){if(e.geometry){const t=(new Og.BufferGeometry).fromGeometry(e.geometry),r=new Og.Mesh(t,e.material),n=e.parent;n.add(r),n.remove(e),e.geometry.dispose(),e.dispose&&e.dispose(),e.material.map&&(delete e.material.map.image.__zone_symbol__errorfalse,delete e.material.map.image.__zone_symbol__loadfalse),e.material.bumpMap&&(delete e.material.bumpMap.image.__zone_symbol__errorfalse,delete e.material.bumpMap.image.__zone_symbol__loadfalse)}}),WD.CARS_CACHE.set(e,r.scene),r.scene})}loadMap(e){return GD(this,void 0,void 0,function*(){const t=yield this.loadColladaScene(`maps/${e}/`,"scene"),r=new FD,n=[];let i;for(let e=0;e<t.scene.children.length;e++){let o=!1;const s=t.scene.children[e];if(s.colladaId){const e=s.colladaId.match(WD.POSITION_NODE_REGEX);e&&(n[+e[1]]=new UD(new HD(s.position.x,s.position.y),s.rotation.z),o=!0),s.colladaId.match(WD.ROAD_CENTER_NODE_REGEX)&&(i=this.parseSpline(s),o=!0);const t=s.colladaId.match(WD.POLYGON_NODE_REGEX);t&&("outer"===t[1]?r.outerPolygon=this.parseSpline(s).map(e=>[e.x,e.y]):"inner"===t[1]&&r.innerPolygons.push(this.parseSpline(s).map(e=>[e.x,e.y])),o=!0)}else o=!0;o&&(t.scene.remove(s),s.traverse(e=>{e.geometry&&(e.geometry.dispose(),e.material.dispose()),e.dispose&&e.dispose()}),e--)}return t.scene.traverse(function(e){if(e instanceof Og.Mesh&&(e.parent&&"cliffs"===e.parent.name?(e.material.color=new Og.Color(.68,.67,.65),e.material.bumpScale=.3,e.layers.set(PD.SeaReflectionLayer)):e.parent&&"tonnels_arc"===e.parent.name?(e.material.color=new Og.Color(.68,.67,.65),e.material.bumpScale=.25):e.parent&&"bridge01"===e.parent.name&&(e.material.color=new Og.Color(.76,.76,.66),e.material.specular=new Og.Color(0,0,0),e.material.bumpScale=.1)),e.geometry){const t=(new Og.BufferGeometry).fromGeometry(e.geometry),r=new Og.Mesh(t,e.material);r.layers=e.layers;const n=e.parent;n.add(r),n.remove(e),e.geometry.dispose(),e.dispose&&e.dispose(),e.material.map&&(delete e.material.map.image.__zone_symbol__errorfalse,delete e.material.map.image.__zone_symbol__loadfalse),e.material.bumpMap&&(delete e.material.bumpMap.image.__zone_symbol__errorfalse,delete e.material.bumpMap.image.__zone_symbol__loadfalse)}}),new RD(t.scene,r,new VD(i),n)})}parseSpline(e){const t=new Og.Vector3;let r=e;for(;r&&!r.geometry;)r.position&&t.add(r.position),r=r.children[0];return r.position&&t.add(r.position),r.geometry.vertices.map(e=>{const r=e.clone();return r.add(t),r})}loadColladaScene(e,t="scene"){return GD(this,void 0,void 0,function*(){return new Promise((r,n)=>{setTimeout(()=>GD(this,void 0,void 0,function*(){ID().load(`${WD.PREFIX}${e}${t}.dae`,e=>GD(this,void 0,void 0,function*(){yield this.waitForAllContentLoaded(),r(e)}))}),15)})})}waitForAllContentLoaded(){return GD(this,void 0,void 0,function*(){return new Promise((e,t)=>{Og.DefaultLoadingManager.onProgress=function(t,r,n){r===n&&e()},Og.DefaultLoadingManager.onError=function(e,r,n){t()}})})}}WD.PREFIX="assets/models/",WD.CARS_CACHE=new Map,WD.POLYGON_NODE_REGEX=/^node-maphelper_polygon_(outer|inner)$/,WD.POSITION_NODE_REGEX=/^node-maphelper_player-position_(\d+)$/,WD.ROAD_CENTER_NODE_REGEX=/^node-maphelper_road-center$/;class XD extends O{constructor(){super(...arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(e){return this.hasError?(e.error(this.thrownError),v.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),v.EMPTY):super._subscribe(e)}next(e){this.hasCompleted||(this.value=e,this.hasNext=!0)}error(e){this.hasCompleted||super.error(e)}complete(){this.hasCompleted=!0,this.hasNext&&super.next(this.value),super.complete()}}function qD(e){const{args:t,subscriber:r,params:n}=e,{callbackFunc:i,context:o,scheduler:s}=n;let{subject:a}=n;if(!a){a=n.subject=new XD;const e=(...e)=>{const t=e.length<=1?e[0]:e;this.add(s.schedule(YD,0,{value:t,subject:a}))};try{i.apply(o,[...t,e])}catch(e){a.error(e)}}this.add(a.subscribe(r))}function YD(e){const{value:t,subject:r}=e;r.next(t),r.complete()}function JD(e){const{params:t,subscriber:r,context:n}=e,{callbackFunc:i,args:o,scheduler:s}=t;let a=t.subject;if(!a){a=t.subject=new XD;const e=(...e)=>{const t=e.shift();if(t)this.add(s.schedule(QD,0,{err:t,subject:a}));else{const t=e.length<=1?e[0]:e;this.add(s.schedule(ZD,0,{value:t,subject:a}))}};try{i.apply(n,[...o,e])}catch(e){this.add(s.schedule(QD,0,{err:e,subject:a}))}}this.add(a.subscribe(r))}function ZD(e){const{value:t,subject:r}=e;r.next(t),r.complete()}function QD(e){const{err:t,subject:r}=e;r.error(t)}M.bindCallback=function e(t,r,n){if(r){if(!N(r))return(...i)=>e(t,n)(...i).pipe(H(e=>c(e)?r(...e):r(e)));n=r}return function(...e){const r=this;let i;const o={context:r,subject:i,callbackFunc:t,scheduler:n};return new M(s=>{if(n){const t={args:e,subscriber:s,params:o};return n.schedule(qD,0,t)}if(!i){i=new XD;const n=(...e)=>{i.next(e.length<=1?e[0]:e),i.complete()};try{t.apply(r,[...e,n])}catch(e){i.error(e)}}return i.subscribe(s)})}},M.bindNodeCallback=function e(t,r,n){if(r){if(!N(r))return(...i)=>e(t,n)(...i).pipe(H(e=>c(e)?r(...e):r(e)));n=r}return function(...e){const r={subject:void 0,args:e,callbackFunc:t,scheduler:n,context:this};return new M(i=>{const{context:o}=r;let{subject:s}=r;if(n)return n.schedule(JD,0,{params:r,subscriber:i,context:o});if(!s){s=r.subject=new XD;const n=(...e)=>{const t=e.shift();t?s.error(t):(s.next(e.length<=1?e[0]:e),s.complete())};try{t.apply(o,[...e,n])}catch(e){s.error(e)}}return s.subscribe(i)})}};const KD={};class $D{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new eN(e,this.resultSelector))}}class eN extends G{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(KD),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let r=0;r<t;r++){const t=e[r];this.add(V(this,t,t,r))}}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,r,n,i){const o=this.values,s=o[r],a=this.toRespond?s===KD?--this.toRespond:this.toRespond:0;o[r]=t,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)}}function tN(...e){return 1===e.length||2===e.length&&N(e[1])?Y(e[0]):hp()(hc(...e))}function rN(e){return new M(t=>{let r;try{r=e()}catch(e){return void t.error(e)}return(r?Y(r):cc()).subscribe(t)})}function nN(...e){let t;return"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&c(e[0])&&(e=e[0]),0===e.length?lc:t?nN(e).pipe(H(e=>t(...e))):new M(t=>new iN(t,e))}M.combineLatest=function(...e){let t=null,r=null;return N(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&c(e[0])&&(e=e[0]),q(e,r).lift(new $D(t))},M.concat=tN,M.defer=rN,M.empty=cc;class iN extends G{constructor(e,t){super(e),this.sources=t,this.completed=0,this.haveValues=0;const r=t.length;this.values=new Array(r);for(let n=0;n<r;n++){const e=V(this,t[n],null,n);e&&this.add(e)}}notifyNext(e,t,r,n,i){this.values[r]=t,i._hasValue||(i._hasValue=!0,this.haveValues++)}notifyComplete(e){const{destination:t,haveValues:r,values:n}=this,i=n.length;e._hasValue?(this.completed++,this.completed===i&&(r===i&&t.next(n),t.complete())):t.complete()}}M.forkJoin=nN,M.from=Y;Object.prototype.toString;function oN(e){const{subscriber:t,condition:r}=e;if(t.closed)return;if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(r){let n;try{n=r(e.state)}catch(e){return void t.error(e)}if(!n)return void t.complete();if(t.closed)return}let n;try{n=e.resultSelector(e.state)}catch(e){return void t.error(e)}return t.closed||(t.next(n),t.closed)?void 0:this.schedule(e)}M.fromEvent=function e(t,r,n,o){return i(n)&&(o=n,n=void 0),o?e(t,r,n).pipe(H(e=>c(e)?o(...e):o(e))):new M(e=>{!function e(t,r,n,i,o){let s;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){const e=t;t.addEventListener(r,n,o),s=(()=>e.removeEventListener(r,n,o))}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){const e=t;t.on(r,n),s=(()=>e.off(r,n))}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){const e=t;t.addListener(r,n),s=(()=>e.removeListener(r,n))}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let s=0,a=t.length;s<a;s++)e(t[s],r,n,i,o)}i.add(s)}(t,r,function(t){arguments.length>1?e.next(Array.prototype.slice.call(arguments)):e.next(t)},e,n)})},M.fromEventPattern=function e(t,r,n){return n?e(t,r).pipe(H(e=>c(e)?n(...e):n(e))):new M(e=>{const n=(...t)=>e.next(1===t.length?t[0]:t);let o;try{o=t(n)}catch(t){return void e.error(t)}if(i(r))return()=>r(n,o)})},M.fromPromise=Y,M.generate=function(e,t,r,n,i){let o,s;if(1==arguments.length){const n=e;s=n.initialState,t=n.condition,r=n.iterate,o=n.resultSelector||K,i=n.scheduler}else void 0===n||N(n)?(s=e,o=K,i=n):(s=e,o=n);return new M(e=>{let n=s;if(i)return i.schedule(oN,0,{subscriber:e,iterate:r,condition:t,resultSelector:o,state:n});for(;;){if(t){let r;try{r=t(n)}catch(t){return void e.error(t)}if(!r){e.complete();break}}let i;try{i=o(n)}catch(t){return void e.error(t)}if(e.next(i),e.closed)break;try{n=r(n)}catch(t){return void e.error(t)}}})},M.if=function(e,t=lc,r=lc){return rN(()=>e()?t:r)};class sN extends v{constructor(e,t){super()}schedule(e,t=0){return this}}class aN extends sN{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this}requestAsyncId(e,t,r=0){return setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r=!1,n=void 0;try{this.work(e)}catch(e){r=!0,n=!!e&&e||new Error(e)}if(r)return this.unsubscribe(),n}_unsubscribe(){const e=this.id,t=this.scheduler,r=t.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}class lN{constructor(e,t=lN.now){this.SchedulerAction=e,this.now=t}schedule(e,t=0,r){return new this.SchedulerAction(this,e).schedule(r,t)}}lN.now=Date.now?Date.now:()=>+new Date;class cN extends lN{constructor(e,t=lN.now){super(e,()=>cN.delegate&&cN.delegate!==this?cN.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,r){return cN.delegate&&cN.delegate!==this?cN.delegate.schedule(e,t,r):super.schedule(e,t,r)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}const uN=new cN(aN);function hN(e){return!c(e)&&e-parseFloat(e)+1>=0}function dN(e){const{subscriber:t,counter:r,period:n}=e;t.next(r),this.schedule({subscriber:t,counter:r+1,period:n},n)}function pN(...e){if(1===e.length){if(!c(e[0]))return e[0];e=e[0]}return q(e,void 0).lift(new fN)}M.interval=function(e=0,t=uN){return(!hN(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=uN),new M(r=>(r.add(t.schedule(dN,e,{subscriber:r,counter:0,period:e})),r))},M.merge=ee;class fN{call(e,t){return t.subscribe(new mN(e))}}class mN extends G{constructor(e){super(e),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(e){this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(let r=0;r<t&&!this.hasFirst;r++){let t=e[r],n=V(this,t,t,r);this.subscriptions&&this.subscriptions.push(n),this.add(n)}this.observables=null}}notifyNext(e,t,r,n,i){if(!this.hasFirst){this.hasFirst=!0;for(let e=0;e<this.subscriptions.length;e++)if(e!==r){let t=this.subscriptions[e];t.unsubscribe(),this.remove(t)}this.subscriptions=null}this.destination.next(t)}}M.race=pN;const vN=new M(_);function gN(e){const{keys:t,index:r,subscriber:n,subscription:i,obj:o}=e;if(!n.closed)if(r<t.length){const e=t[r];n.next([e,o[e]]),i.add(this.schedule({keys:t,index:r+1,subscriber:n,subscription:i,obj:o}))}else n.complete()}function yN(e){const{start:t,index:r,count:n,subscriber:i}=e;r>=n?i.complete():(i.next(t),i.closed||(e.index=r+1,e.start=t+1,this.schedule(e)))}function xN(e=0,t,r){let n=-1;return hN(t)?n=Number(t)<1?1:Number(t):N(t)&&(r=t),N(r)||(r=uN),new M(t=>{const i=hN(e)?e:+e-r.now();return r.schedule(bN,i,{index:0,period:n,subscriber:t})})}function bN(e){const{index:t,period:r,subscriber:n}=e;if(n.next(t),!n.closed){if(-1===r)return n.complete();e.index=t+1,this.schedule(e,r)}}function wN(...e){const t=e[e.length-1];return"function"==typeof t&&e.pop(),q(e,void 0).lift(new _N(t))}M.never=function(){return vN},M.of=hc,M.onErrorResumeNext=function e(...t){if(0===t.length)return lc;const[r,...n]=t;return 1===t.length&&c(r)?e(...r):new M(t=>{const i=()=>t.add(e(...n).subscribe(t));return Y(r).subscribe({next(e){t.next(e)},error:i,complete:i})})},M.pairs=function(e,t){return new M(t?r=>{const n=Object.keys(e),i=new v;return i.add(t.schedule(gN,0,{keys:n,index:0,subscriber:r,subscription:i,obj:e})),i}:t=>{const r=Object.keys(e);for(let n=0;n<r.length&&!t.closed;n++){const i=r[n];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},M.range=function(e=0,t=0,r){return new M(n=>{let i=0;if(r)return r.schedule(yN,0,{index:i,count:t,start:e,subscriber:n});for(;;){if(i++>=t){n.complete();break}if(n.next(e++),n.closed)break}})},M.using=function(e,t){return new M(r=>{let n,i;try{n=e()}catch(e){return void r.error(e)}try{i=t(n)}catch(e){return void r.error(e)}const o=(i?Y(i):lc).subscribe(r);return()=>{o.unsubscribe(),n&&n.unsubscribe()}})},M.throw=nc,M.throwError=nc,M.timer=xN;class _N{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new SN(e,this.resultSelector))}}class SN extends x{constructor(e,t,r=Object.create(null)){super(e),this.iterators=[],this.active=0,this.resultSelector="function"==typeof t?t:null,this.values=r}_next(e){const t=this.iterators;c(e)?t.push(new MN(e)):"function"==typeof e[F]?t.push(new TN(e[F]())):t.push(new AN(this.destination,this,e))}_complete(){const e=this.iterators,t=e.length;if(0!==t){this.active=t;for(let r=0;r<t;r++){let t=e[r];t.stillUnsubscribed?this.add(t.subscribe(t,r)):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const e=this.iterators,t=e.length,r=this.destination;for(let o=0;o<t;o++){let t=e[o];if("function"==typeof t.hasValue&&!t.hasValue())return}let n=!1;const i=[];for(let o=0;o<t;o++){let t=e[o],s=t.next();if(t.hasCompleted()&&(n=!0),s.done)return void r.complete();i.push(s.value)}this.resultSelector?this._tryresultSelector(i):r.next(i),n&&r.complete()}_tryresultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)}}class TN{constructor(e){this.iterator=e,this.nextResult=e.next()}hasValue(){return!0}next(){const e=this.nextResult;return this.nextResult=this.iterator.next(),e}hasCompleted(){const e=this.nextResult;return e&&e.done}}class MN{constructor(e){this.array=e,this.index=0,this.length=0,this.length=e.length}[F](){return this}next(e){const t=this.index++,r=this.array;return t<this.length?{value:r[t],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class AN extends G{constructor(e,t,r){super(e),this.parent=t,this.observable=r,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[F](){return this}next(){const e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(e,t,r,n,i){this.buffer.push(t),this.parent.checkIterators()}subscribe(e,t){return V(this,this.observable,this,t)}}M.zip=wN;const EN="undefined"!=typeof window&&window,CN="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,PN="undefined"!=typeof global&&global,ON=EN||PN||CN;function DN(e,t=null){return new UN({method:"GET",url:e,headers:t})}function NN(e,t,r){return new UN({method:"POST",url:e,body:t,headers:r})}function LN(e,t){return new UN({method:"DELETE",url:e,headers:t})}function IN(e,t,r){return new UN({method:"PUT",url:e,body:t,headers:r})}function RN(e,t,r){return new UN({method:"PATCH",url:e,body:t,headers:r})}!function(){if(!ON)throw new Error("RxJS could not find any global context (window, self, global)")}();const FN=H((e,t)=>e.response);function kN(e,t){return FN(new UN({method:"GET",url:e,responseType:"json",headers:t}))}class UN extends M{constructor(e){super();const t={async:!0,createXHR:function(){return this.crossDomain?function(){if(ON.XMLHttpRequest)return new ON.XMLHttpRequest;if(ON.XDomainRequest)return new ON.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(ON.XMLHttpRequest)return new ON.XMLHttpRequest;{let e;try{const t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(let r=0;r<3;r++)try{if(e=t[r],new ON.ActiveXObject(e))break}catch(e){}return new ON.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof e)t.url=e;else for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);this.request=t}_subscribe(e){return new BN(e,this.request)}}UN.create=(()=>{const e=e=>new UN(e);return e.get=DN,e.post=NN,e.delete=LN,e.put=IN,e.patch=RN,e.getJSON=kN,e})();class BN extends x{constructor(e,t){super(e),this.request=t,this.done=!1;const r=t.headers=t.headers||{};t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in r||ON.FormData&&t.body instanceof ON.FormData||void 0===t.body||(r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),t.body=this.serializeBody(t.body,t.headers["Content-Type"]),this.send()}next(e){this.done=!0;const{xhr:t,request:r,destination:n}=this,i=new jN(e,t,r);n.next(i)}send(){const{request:e,request:{user:t,method:r,url:n,async:i,password:o,headers:s,body:a}}=this,l=f(e.createXHR).call(e);if(l===h)this.error(h.e);else{let c;if(this.xhr=l,this.setupEvents(l,e),(c=t?f(l.open).call(l,r,n,i,t,o):f(l.open).call(l,r,n,i))===h)return this.error(h.e),null;if(i&&(l.timeout=e.timeout,l.responseType=e.responseType),"withCredentials"in l&&(l.withCredentials=!!e.withCredentials),this.setHeaders(l,s),(c=a?f(l.send).call(l,a):f(l.send).call(l))===h)return this.error(h.e),null}return l}serializeBody(e,t){if(!e||"string"==typeof e)return e;if(ON.FormData&&e instanceof ON.FormData)return e;if(t){const e=t.indexOf(";");-1!==e&&(t=t.substring(0,e))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&");case"application/json":return JSON.stringify(e);default:return e}}setHeaders(e,t){for(let r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r])}setupEvents(e,t){const r=t.progressSubscriber;function n(e){const{subscriber:t,progressSubscriber:r,request:i}=n;r&&r.error(e),t.error(new GN(this,i))}if(e.ontimeout=n,n.request=t,n.subscriber=this,n.progressSubscriber=r,e.upload&&"withCredentials"in e){if(r){let t;t=function(e){const{progressSubscriber:r}=t;r.next(e)},ON.XDomainRequest?e.onprogress=t:e.upload.onprogress=t,t.progressSubscriber=r}let n;n=function(e){const{progressSubscriber:t,subscriber:r,request:i}=n;t&&t.error(e),r.error(new zN("ajax error",this,i))},e.onerror=n,n.request=t,n.subscriber=this,n.progressSubscriber=r}function i(e){const{subscriber:t,progressSubscriber:r,request:n}=i;if(4===this.readyState){let i=1223===this.status?204:this.status,o="text"===this.responseType?this.response||this.responseText:this.response;0===i&&(i=o?200:0),i<400?(r&&r.complete(),t.next(e),t.complete()):(r&&r.error(e),t.error(new zN("ajax error "+i,this,n)))}}e.onreadystatechange=i,i.subscriber=this,i.progressSubscriber=r,i.request=t}unsubscribe(){const{done:e,xhr:t}=this;!e&&t&&4!==t.readyState&&"function"==typeof t.abort&&t.abort(),super.unsubscribe()}}class jN{constructor(e,t,r){this.originalEvent=e,this.xhr=t,this.request=r,this.status=t.status,this.responseType=t.responseType||r.responseType,this.response=VN(this.responseType,t)}}class zN extends Error{constructor(e,t,r){super(e),this.message=e,this.xhr=t,this.request=r,this.status=t.status,this.responseType=t.responseType||r.responseType,this.response=VN(this.responseType,t),this.name="AjaxError",Object.setPrototypeOf(this,zN.prototype)}}function VN(e,t){switch(e){case"json":return"response"in t?t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):JSON.parse(t.responseText||"null");case"xml":return t.responseXML;case"text":default:return"response"in t?t.response:t.responseText}}class GN extends zN{constructor(e,t){super("ajax timeout",e,t),Object.setPrototypeOf(this,GN.prototype)}}const HN=UN.create;M.ajax=HN;const WN=new class extends cN{}(class extends aN{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(e,t,r):e.flush(this)}});class XN{constructor(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}}accept(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)}toObservable(){switch(this.kind){case"N":return hc(this.value);case"E":return nc(this.error);case"C":return cc()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new XN("N",e):XN.undefinedValueNotification}static createError(e){return new XN("E",void 0,e)}static createComplete(){return XN.completeNotification}}function qN(e,t=0){return function(r){return r.lift(new YN(e,t))}}XN.completeNotification=new XN("C"),XN.undefinedValueNotification=new XN("N",void 0);class YN{constructor(e,t=0){this.scheduler=e,this.delay=t}call(e,t){return t.subscribe(new JN(e,this.scheduler,this.delay))}}class JN extends x{constructor(e,t,r=0){super(e),this.scheduler=t,this.delay=r}static dispatch(e){const{notification:t,destination:r}=e;t.observe(r),this.unsubscribe()}scheduleMessage(e){this.add(this.scheduler.schedule(JN.dispatch,this.delay,new ZN(e,this.destination)))}_next(e){this.scheduleMessage(XN.createNext(e))}_error(e){this.scheduleMessage(XN.createError(e))}_complete(){this.scheduleMessage(XN.createComplete())}}class ZN{constructor(e,t){this.notification=e,this.destination=t}}class QN extends O{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift(),super.next(e)}nextTimeWindow(e){this._events.push(new KN(this._getNow(),e)),this._trimBufferThenGetEvents(),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,r=t?this._events:this._trimBufferThenGetEvents(),n=this.scheduler,i=r.length;let o;if(this.closed)throw new E;if(this.isStopped||this.hasError?o=v.EMPTY:(this.observers.push(e),o=new C(this,e)),n&&e.add(e=new JN(e,n)),t)for(let s=0;s<i&&!e.closed;s++)e.next(r[s]);else for(let s=0;s<i&&!e.closed;s++)e.next(r[s].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o}_getNow(){return(this.scheduler||WN).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,r=this._windowTime,n=this._events,i=n.length;let o=0;for(;o<i&&!(e-n[o].time<r);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&n.splice(0,o),n}}class KN{constructor(e,t){this.time=e,this.value=t}}const $N={url:"",deserializer:e=>JSON.parse(e.data),serializer:e=>JSON.stringify(e)},eL="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }";class tL extends D{constructor(e,t){if(super(),e instanceof M)this.destination=t,this.source=e;else{const t=this._config=Object.assign({},$N);if(t.WebSocketCtor=WebSocket,this._output=new O,"string"==typeof e)t.url=e;else for(let r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);if(!t.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new QN}}lift(e){const t=new tL(this._config,this.destination);return t.operator=e,t.source=this,t}_resetState(){this._socket=null,this.source||(this.destination=new QN),this._output=new O}multiplex(e,t,r){const n=this;return new M(i=>{const o=f(e)();o===h?i.error(h.e):n.next(o);let s=n.subscribe(e=>{const t=f(r)(e);t===h?i.error(h.e):t&&i.next(e)},e=>i.error(e),()=>i.complete());return()=>{const e=f(t)();e===h?i.error(h.e):n.next(e),s.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:e,protocol:t,url:r,binaryType:n}=this._config,i=this._output;let o=null;try{o=t?new e(r,t):new e(r),this._socket=o,n&&(this._socket.binaryType=n)}catch(e){return void i.error(e)}const s=new v(()=>{this._socket=null,o&&1===o.readyState&&o.close()});o.onopen=(e=>{const{openObserver:t}=this._config;t&&t.next(e);const r=this.destination;this.destination=x.create(e=>{if(1===o.readyState){const{serializer:t}=this._config,r=f(t)(e);if(r===h)return void this.destination.error(h.e);o.send(r)}},e=>{const{closingObserver:t}=this._config;t&&t.next(void 0),e&&e.code?o.close(e.code,e.reason):i.error(new TypeError(eL)),this._resetState()},()=>{const{closingObserver:e}=this._config;e&&e.next(void 0),o.close(),this._resetState()}),r&&r instanceof QN&&s.add(r.subscribe(this.destination))}),o.onerror=(e=>{this._resetState(),i.error(e)}),o.onclose=(e=>{this._resetState();const{closeObserver:t}=this._config;t&&t.next(e),e.wasClean?i.complete():i.error(e)}),o.onmessage=(e=>{const{deserializer:t}=this._config,r=f(t)(e);r===h?i.error(h.e):i.next(r)})}_subscribe(e){const{source:t}=this;if(t)return t.subscribe(e);this._socket||this._connectSocket();let r=new v;return r.add(this._output.subscribe(e)),r.add(()=>{const{_socket:e}=this;0===this._output.observers.length&&(e&&1===e.readyState&&e.close(),this._resetState())}),r}unsubscribe(){const{source:e,_socket:t}=this;t&&1===t.readyState&&(t.close(),this._resetState()),super.unsubscribe(),e||(this.destination=new QN)}}function rL(e){return function(t){return t.lift(new nL(e))}}M.webSocket=function(e){return new tL(e)};class nL{constructor(e){this.closingNotifier=e}call(e,t){return t.subscribe(new iL(e,this.closingNotifier))}}class iL extends G{constructor(e,t){super(e),this.buffer=[],this.add(V(this,t))}_next(e){this.buffer.push(e)}notifyNext(e,t,r,n,i){const o=this.buffer;this.buffer=[],this.destination.next(o)}}function oL(e,t=null){return function(r){return r.lift(new sL(e,t))}}M.prototype.buffer=function(e){return rL(e)(this)};class sL{constructor(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?lL:aL}call(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))}}class aL extends x{constructor(e,t){super(e),this.bufferSize=t,this.buffer=[]}_next(e){const t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])}_complete(){const e=this.buffer;e.length>0&&this.destination.next(e),super._complete()}}class lL extends x{constructor(e,t,r){super(e),this.bufferSize=t,this.startBufferEvery=r,this.buffers=[],this.count=0}_next(e){const{bufferSize:t,startBufferEvery:r,buffers:n,count:i}=this;this.count++,i%r==0&&n.push([]);for(let o=n.length;o--;){const r=n[o];r.push(e),r.length===t&&(n.splice(o,1),this.destination.next(r))}}_complete(){const{buffers:e,destination:t}=this;for(;e.length>0;){let r=e.shift();r.length>0&&t.next(r)}super._complete()}}function cL(e){let t=arguments.length,r=uN;N(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],t--);let n=null;t>=2&&(n=arguments[1]);let i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),function(t){return t.lift(new uL(e,n,i,r))}}M.prototype.bufferCount=function(e,t=null){return oL(e,t)(this)};class uL{constructor(e,t,r,n){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=r,this.scheduler=n}call(e,t){return t.subscribe(new dL(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))}}class hL{constructor(){this.buffer=[]}}class dL extends x{constructor(e,t,r,n,i){super(e),this.bufferTimeSpan=t,this.bufferCreationInterval=r,this.maxBufferSize=n,this.scheduler=i,this.contexts=[];const o=this.openContext();if(this.timespanOnly=null==r||r<0,this.timespanOnly){const e={subscriber:this,context:o,bufferTimeSpan:t};this.add(o.closeAction=i.schedule(pL,t,e))}else{const e={subscriber:this,context:o},n={bufferTimeSpan:t,bufferCreationInterval:r,subscriber:this,scheduler:i};this.add(o.closeAction=i.schedule(mL,t,e)),this.add(i.schedule(fL,r,n))}}_next(e){const t=this.contexts,r=t.length;let n;for(let i=0;i<r;i++){const r=t[i],o=r.buffer;o.push(e),o.length==this.maxBufferSize&&(n=r)}n&&this.onBufferFull(n)}_error(e){this.contexts.length=0,super._error(e)}_complete(){const{contexts:e,destination:t}=this;for(;e.length>0;){const r=e.shift();t.next(r.buffer)}super._complete()}_unsubscribe(){this.contexts=null}onBufferFull(e){this.closeContext(e);const t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();const t=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:t};this.add(e.closeAction=this.scheduler.schedule(pL,t,r))}}openContext(){const e=new hL;return this.contexts.push(e),e}closeContext(e){this.destination.next(e.buffer);const t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)}}function pL(e){const t=e.subscriber,r=e.context;r&&t.closeContext(r),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function fL(e){const{bufferCreationInterval:t,bufferTimeSpan:r,subscriber:n,scheduler:i}=e,o=n.openContext(),s=this;n.closed||(n.add(o.closeAction=i.schedule(mL,r,{subscriber:n,context:o})),s.schedule(e,t))}function mL(e){const{subscriber:t,context:r}=e;t.closeContext(r)}function vL(e,t){return function(r){return r.lift(new gL(e,t))}}M.prototype.bufferTime=function(e){let t=arguments.length,r=uN;N(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],t--);let n=null;t>=2&&(n=arguments[1]);let i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),cL(e,n,i,r)(this)};class gL{constructor(e,t){this.openings=e,this.closingSelector=t}call(e,t){return t.subscribe(new yL(e,this.openings,this.closingSelector))}}class yL extends G{constructor(e,t,r){super(e),this.openings=t,this.closingSelector=r,this.contexts=[],this.add(V(this,t))}_next(e){const t=this.contexts,r=t.length;for(let n=0;n<r;n++)t[n].buffer.push(e)}_error(e){const t=this.contexts;for(;t.length>0;){const e=t.shift();e.subscription.unsubscribe(),e.buffer=null,e.subscription=null}this.contexts=null,super._error(e)}_complete(){const e=this.contexts;for(;e.length>0;){const t=e.shift();this.destination.next(t.buffer),t.subscription.unsubscribe(),t.buffer=null,t.subscription=null}this.contexts=null,super._complete()}notifyNext(e,t,r,n,i){e?this.closeBuffer(e):this.openBuffer(t)}notifyComplete(e){this.closeBuffer(e.context)}openBuffer(e){try{const t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(e){this._error(e)}}closeBuffer(e){const t=this.contexts;if(t&&e){const{buffer:r,subscription:n}=e;this.destination.next(r),t.splice(t.indexOf(e),1),this.remove(n),n.unsubscribe()}}trySubscribe(e){const t=this.contexts,r=new v,n={buffer:[],subscription:r};t.push(n);const i=V(this,e,n);!i||i.closed?this.closeBuffer(n):(i.context=n,this.add(i),r.add(i))}}function xL(e){return function(t){return t.lift(new bL(e))}}M.prototype.bufferToggle=function(e,t){return vL(e,t)(this)};class bL{constructor(e){this.closingSelector=e}call(e,t){return t.subscribe(new wL(e,this.closingSelector))}}class wL extends G{constructor(e,t){super(e),this.closingSelector=t,this.subscribing=!1,this.openBuffer()}_next(e){this.buffer.push(e)}_complete(){const e=this.buffer;e&&this.destination.next(e),super._complete()}_unsubscribe(){this.buffer=null,this.subscribing=!1}notifyNext(e,t,r,n,i){this.openBuffer()}notifyComplete(){this.subscribing?this.complete():this.openBuffer()}openBuffer(){let{closingSubscription:e}=this;e&&(this.remove(e),e.unsubscribe());const t=this.buffer;this.buffer&&this.destination.next(t),this.buffer=[];const r=f(this.closingSelector)();r===h?this.error(h.e):(e=new v,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(V(this,r)),this.subscribing=!1)}}function _L(e){return oc(e)(this)}function SL(e){return t=>t.lift(new $D(e))}function TL(e,t){return mc(()=>e,t)}function ML(e){return t=>t.lift(new AL(e,t))}M.prototype.bufferWhen=function(e){return xL(e)(this)},M.prototype.catch=_L,M.prototype._catch=_L,M.prototype.combineAll=function(e){return SL(e)(this)},M.prototype.combineLatest=function(...e){let t=null;return"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&c(e[0])&&(e=e[0].slice()),this.lift.call(hc(this,...e),new $D(t))},M.prototype.concat=function(...e){return this.lift.call(tN(this,...e))},M.prototype.concatAll=function(){return hp()(this)},M.prototype.concatMap=function(e){return mc(e)(this)},M.prototype.concatMapTo=function(e){return TL(e)(this)};class AL{constructor(e,t){this.predicate=e,this.source=t}call(e,t){return t.subscribe(new EL(e,this.predicate,this.source))}}class EL extends x{constructor(e,t,r){super(e),this.predicate=t,this.source=r,this.count=0,this.index=0}_next(e){this.predicate?this._tryPredicate(e):this.count++}_tryPredicate(e){let t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++}_complete(){this.destination.next(this.count),this.destination.complete()}}function CL(){return function(e){return e.lift(new PL)}}M.prototype.count=function(e){return ML(e)(this)};class PL{call(e,t){return t.subscribe(new OL(e))}}class OL extends x{constructor(e){super(e)}_next(e){e.observe(this.destination)}}function DL(e){return t=>t.lift(new NL(e))}M.prototype.dematerialize=function(){return CL()(this)};class NL{constructor(e){this.durationSelector=e}call(e,t){return t.subscribe(new LL(e,this.durationSelector))}}class LL extends G{constructor(e,t){super(e),this.durationSelector=t,this.hasValue=!1,this.durationSubscription=null}_next(e){try{const t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}}_complete(){this.emitValue(),this.destination.complete()}_tryNext(e,t){let r=this.durationSubscription;this.value=e,this.hasValue=!0,r&&(r.unsubscribe(),this.remove(r)),(r=V(this,t))&&!r.closed&&this.add(this.durationSubscription=r)}notifyNext(e,t,r,n,i){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){if(this.hasValue){const e=this.value,t=this.durationSubscription;t&&(this.durationSubscription=null,t.unsubscribe(),this.remove(t)),this.value=null,this.hasValue=!1,super._next(e)}}}function IL(e,t=uN){return r=>r.lift(new RL(e,t))}M.prototype.debounce=function(e){return DL(e)(this)};class RL{constructor(e,t){this.dueTime=e,this.scheduler=t}call(e,t){return t.subscribe(new FL(e,this.dueTime,this.scheduler))}}class FL extends x{constructor(e,t,r){super(e),this.dueTime=t,this.scheduler=r,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(kL,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:e}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}clearDebounce(){const e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}function kL(e){e.debouncedNext()}function UL(e){return e instanceof Date&&!isNaN(+e)}function BL(e,t=uN){const r=UL(e)?+e-t.now():Math.abs(e);return e=>e.lift(new jL(r,t))}M.prototype.debounceTime=function(e,t=uN){return IL(e,t)(this)},M.prototype.defaultIfEmpty=function(e=null){return $d(e)(this)};class jL{constructor(e,t){this.delay=e,this.scheduler=t}call(e,t){return t.subscribe(new zL(e,this.delay,this.scheduler))}}class zL extends x{constructor(e,t,r){super(e),this.delay=t,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){const t=e.source,r=t.queue,n=e.scheduler,i=e.destination;for(;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(i);if(r.length>0){const t=Math.max(0,r[0].time-n.now());this.schedule(e,t)}else this.unsubscribe(),t.active=!1}_schedule(e){this.active=!0,this.add(e.schedule(zL.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0===this.errored)return;const t=this.scheduler,r=new VL(t.now()+this.delay,e);this.queue.push(r),!1===this.active&&this._schedule(t)}_next(e){this.scheduleNotification(XN.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e)}_complete(){this.scheduleNotification(XN.createComplete())}}class VL{constructor(e,t){this.time=e,this.notification=t}}function GL(e,t){return t?r=>new XL(r,t).lift(new HL(e)):t=>t.lift(new HL(e))}M.prototype.delay=function(e,t=uN){return BL(e,t)(this)};class HL{constructor(e){this.delayDurationSelector=e}call(e,t){return t.subscribe(new WL(e,this.delayDurationSelector))}}class WL extends G{constructor(e,t){super(e),this.delayDurationSelector=t,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}notifyNext(e,t,r,n,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()}notifyError(e,t){this._error(e)}notifyComplete(e){const t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()}_next(e){try{const t=this.delayDurationSelector(e);t&&this.tryDelay(t,e)}catch(e){this.destination.error(e)}}_complete(){this.completed=!0,this.tryComplete()}removeSubscription(e){e.unsubscribe();const t=this.delayNotifierSubscriptions.indexOf(e);let r=null;return-1!==t&&(r=this.values[t],this.delayNotifierSubscriptions.splice(t,1),this.values.splice(t,1)),r}tryDelay(e,t){const r=V(this,e,t);r&&!r.closed&&(this.add(r),this.delayNotifierSubscriptions.push(r)),this.values.push(t)}tryComplete(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()}}class XL extends M{constructor(e,t){super(),this.source=e,this.subscriptionDelay=t}_subscribe(e){this.subscriptionDelay.subscribe(new qL(e,this.source))}}class qL extends x{constructor(e,t){super(),this.parent=e,this.source=t,this.sourceSubscribed=!1}_next(e){this.subscribeToSource()}_error(e){this.unsubscribe(),this.parent.error(e)}_complete(){this.subscribeToSource()}subscribeToSource(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))}}function YL(e,t){return r=>r.lift(new JL(e,t))}M.prototype.delayWhen=function(e,t){return GL(e,t)(this)};class JL{constructor(e,t){this.keySelector=e,this.flushes=t}call(e,t){return t.subscribe(new ZL(e,this.keySelector,this.flushes))}}class ZL extends G{constructor(e,t,r){super(e),this.keySelector=t,this.values=new Set,r&&this.add(V(this,r))}notifyNext(e,t,r,n,i){this.values.clear()}notifyError(e,t){this._error(e)}_next(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)}_useKeySelector(e){let t;const{destination:r}=this;try{t=this.keySelector(e)}catch(e){return void r.error(e)}this._finalizeNext(t,e)}_finalizeNext(e,t){const{values:r}=this;r.has(e)||(r.add(e),this.destination.next(t))}}function QL(e,t){return r=>r.lift(new KL(e,t))}M.prototype.distinct=function(e,t){return YL(e,t)(this)};class KL{constructor(e,t){this.compare=e,this.keySelector=t}call(e,t){return t.subscribe(new $L(e,this.compare,this.keySelector))}}class $L extends x{constructor(e,t,r){super(e),this.keySelector=r,this.hasKey=!1,"function"==typeof t&&(this.compare=t)}compare(e,t){return e===t}_next(e){let t=e;if(this.keySelector&&(t=f(this.keySelector)(e))===h)return this.destination.error(h.e);let r=!1;if(this.hasKey){if((r=f(this.compare)(this.key,t))===h)return this.destination.error(h.e)}else this.hasKey=!0;!1===Boolean(r)&&(this.key=t,this.destination.next(e))}}function eI(e,t){return QL((r,n)=>t?t(r[e],n[e]):r[e]===n[e])}function tI(e,t,r){return Jd(e,t,r)(this)}function rI(){return e=>e.lift(new nI)}M.prototype.distinctUntilChanged=function(e,t){return QL(e,t)(this)},M.prototype.distinctUntilKeyChanged=function(e,t){return eI(e,t)(this)},M.prototype.do=tI,M.prototype._do=tI;class nI{call(e,t){return t.subscribe(new iI(e))}}class iI extends G{constructor(e){super(e),this.hasCompleted=!1,this.hasSubscription=!1}_next(e){this.hasSubscription||(this.hasSubscription=!0,this.add(V(this,e)))}_complete(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()}notifyComplete(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}function oI(e,t){return t?r=>r.pipe(oI((r,n)=>Y(e(r,n)).pipe(H((e,i)=>t(r,e,n,i))))):t=>t.lift(new sI(e))}M.prototype.exhaust=function(){return rI()(this)};class sI{constructor(e){this.project=e}call(e,t){return t.subscribe(new aI(e,this.project))}}class aI extends G{constructor(e,t){super(e),this.project=t,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}_next(e){this.hasSubscription||this.tryNext(e)}tryNext(e){const t=this.index++,r=this.destination;try{const n=this.project(e,t);this.hasSubscription=!0,this.add(V(this,n,e,t))}catch(e){r.error(e)}}_complete(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()}notifyNext(e,t,r,n,i){this.destination.next(t)}notifyError(e){this.destination.error(e)}notifyComplete(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}function lI(e,t=Number.POSITIVE_INFINITY,r){return t=(t||0)<1?Number.POSITIVE_INFINITY:t,n=>n.lift(new cI(e,t,r))}M.prototype.exhaustMap=function(e){return oI(e)(this)};class cI{constructor(e,t,r){this.project=e,this.concurrent=t,this.scheduler=r}call(e,t){return t.subscribe(new uI(e,this.project,this.concurrent,this.scheduler))}}class uI extends G{constructor(e,t,r,n){super(e),this.project=t,this.concurrent=r,this.scheduler=n,this.index=0,this.active=0,this.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(this.buffer=[])}static dispatch(e){const{subscriber:t,result:r,value:n,index:i}=e;t.subscribeToProjection(r,n,i)}_next(e){const t=this.destination;if(t.closed)return void this._complete();const r=this.index++;if(this.active<this.concurrent){t.next(e);let n=f(this.project)(e,r);if(n===h)t.error(h.e);else if(this.scheduler){const t={subscriber:this,result:n,value:e,index:r};this.add(this.scheduler.schedule(uI.dispatch,0,t))}else this.subscribeToProjection(n,e,r)}else this.buffer.push(e)}subscribeToProjection(e,t,r){this.active++,this.add(V(this,e,t,r))}_complete(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()}notifyNext(e,t,r,n,i){this._next(t)}notifyComplete(e){const t=this.buffer;this.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()}}function hI(e,t){if(e<0)throw new Wd;const r=arguments.length>=2;return n=>n.pipe(dc((t,r)=>r===e),np(1),r?$d(t):Kd(()=>new Wd))}function dI(e){return t=>t.lift(new pI(e))}M.prototype.expand=function(e,t=Number.POSITIVE_INFINITY,r){return lI(e,t=(t||0)<1?Number.POSITIVE_INFINITY:t,r)(this)},M.prototype.elementAt=function(e,t){return hI.apply(void 0,arguments)(this)},M.prototype.filter=function(e,t){return dc(e,t)(this)};class pI{constructor(e){this.callback=e}call(e,t){return t.subscribe(new fI(e,this.callback))}}class fI extends x{constructor(e,t){super(e),this.add(new v(t))}}function mI(e){return dI(e)(this)}function vI(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return r=>r.lift(new gI(e,r,!1,t))}M.prototype.finally=mI,M.prototype._finally=mI;class gI{constructor(e,t,r,n){this.predicate=e,this.source=t,this.yieldIndex=r,this.thisArg=n}call(e,t){return t.subscribe(new yI(e,this.predicate,this.source,this.yieldIndex,this.thisArg))}}class yI extends x{constructor(e,t,r,n,i){super(e),this.predicate=t,this.source=r,this.yieldIndex=n,this.thisArg=i,this.index=0}notifyComplete(e){const t=this.destination;t.next(e),t.complete()}_next(e){const{predicate:t,thisArg:r}=this,n=this.index++;try{t.call(r||this,e,n,this.source)&&this.notifyComplete(this.yieldIndex?n:e)}catch(e){this.destination.error(e)}}_complete(){this.notifyComplete(this.yieldIndex?-1:void 0)}}function xI(e,t){return r=>r.lift(new gI(e,r,!0,t))}function bI(e,t,r,n){return i=>i.lift(new wI(e,t,r,n))}M.prototype.find=function(e,t){return vI(e,t)(this)},M.prototype.findIndex=function(e,t){return xI(e,t)(this)},M.prototype.first=function(...e){return sp(...e)(this)};class wI{constructor(e,t,r,n){this.keySelector=e,this.elementSelector=t,this.durationSelector=r,this.subjectSelector=n}call(e,t){return t.subscribe(new _I(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))}}class _I extends x{constructor(e,t,r,n,i){super(e),this.keySelector=t,this.elementSelector=r,this.durationSelector=n,this.subjectSelector=i,this.groups=null,this.attemptedToUnsubscribe=!1,this.count=0}_next(e){let t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)}_group(e,t){let r=this.groups;r||(r=this.groups=new Map);let n,i=r.get(t);if(this.elementSelector)try{n=this.elementSelector(e)}catch(e){this.error(e)}else n=e;if(!i){i=this.subjectSelector?this.subjectSelector():new O,r.set(t,i);const e=new TI(t,i,this);if(this.destination.next(e),this.durationSelector){let e;try{e=this.durationSelector(new TI(t,i))}catch(e){return void this.error(e)}this.add(e.subscribe(new SI(t,i,this)))}}i.closed||i.next(n)}_error(e){const t=this.groups;t&&(t.forEach((t,r)=>{t.error(e)}),t.clear()),this.destination.error(e)}_complete(){const e=this.groups;e&&(e.forEach((e,t)=>{e.complete()}),e.clear()),this.destination.complete()}removeGroup(e){this.groups.delete(e)}unsubscribe(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&super.unsubscribe())}}class SI extends x{constructor(e,t,r){super(t),this.key=e,this.group=t,this.parent=r}_next(e){this.complete()}_unsubscribe(){const{parent:e,key:t}=this;this.key=this.parent=null,e&&e.removeGroup(t)}}class TI extends M{constructor(e,t,r){super(),this.key=e,this.groupSubject=t,this.refCountSubscription=r}_subscribe(e){const t=new v,{refCountSubscription:r,groupSubject:n}=this;return r&&!r.closed&&t.add(new MI(r)),t.add(n.subscribe(e)),t}}class MI extends v{constructor(e){super(),this.parent=e,e.count++}unsubscribe(){const e=this.parent;e.closed||this.closed||(super.unsubscribe(),e.count-=1,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())}}function AI(){return function(e){return e.lift(new EI)}}M.prototype.groupBy=function(e,t,r,n){return bI(e,t,r,n)(this)};class EI{call(e,t){return t.subscribe(new CI(e))}}class CI extends x{_next(e){}}function PI(){return e=>e.lift(new OI)}M.prototype.ignoreElements=function(){return AI()(this)};class OI{call(e,t){return t.subscribe(new DI(e))}}class DI extends x{constructor(e){super(e)}notifyComplete(e){const t=this.destination;t.next(e),t.complete()}_next(e){this.notifyComplete(!1)}_complete(){this.notifyComplete(!0)}}function NI(e){return function(t){return t.lift(new LI(e))}}M.prototype.isEmpty=function(){return PI()(this)};class LI{constructor(e){this.durationSelector=e}call(e,t){return t.subscribe(new II(e,this.durationSelector))}}class II extends G{constructor(e,t){super(e),this.durationSelector=t,this.hasValue=!1}_next(e){if(this.value=e,this.hasValue=!0,!this.throttled){const t=f(this.durationSelector)(e);if(t===h)this.destination.error(h.e);else{const e=V(this,t);!e||e.closed?this.clearThrottle():this.add(this.throttled=e)}}}clearThrottle(){const{value:e,hasValue:t,throttled:r}=this;r&&(this.remove(r),this.throttled=null,r.unsubscribe()),t&&(this.value=null,this.hasValue=!1,this.destination.next(e))}notifyNext(e,t,r,n){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function RI(e,t=uN){return NI(()=>xN(e,t))}function FI(e){return e(this)}function kI(e){return t=>t.lift(new UI(e))}M.prototype.audit=function(e){return NI(e)(this)},M.prototype.auditTime=function(e,t=uN){return RI(e,t)(this)},M.prototype.last=function(...e){return rp(...e)(this)},M.prototype.let=FI,M.prototype.letBind=FI,M.prototype.every=function(e,t){return Vd(e,t)(this)},M.prototype.map=function(e,t){return H(e,t)(this)};class UI{constructor(e){this.value=e}call(e,t){return t.subscribe(new BI(e,this.value))}}class BI extends x{constructor(e,t){super(e),this.value=t}_next(e){this.destination.next(this.value)}}function jI(){return function(e){return e.lift(new zI)}}M.prototype.mapTo=function(e){return kI(e)(this)};class zI{call(e,t){return t.subscribe(new VI(e))}}class VI extends x{constructor(e){super(e)}_next(e){this.destination.next(XN.createNext(e))}_error(e){const t=this.destination;t.next(XN.createError(e)),t.complete()}_complete(){const e=this.destination;e.next(XN.createComplete()),e.complete()}}function GI(e){return up("function"==typeof e?(t,r)=>e(t,r)>0?t:r:(e,t)=>e>t?e:t)}function HI(e,t=Number.POSITIVE_INFINITY){return J(e,t)(this)}function WI(e,t,r=Number.POSITIVE_INFINITY){return"function"==typeof t?J(()=>e,t,r):("number"==typeof t&&(r=t),J(()=>e,r))}function XI(e,t=Number.POSITIVE_INFINITY){return WI(e,t)(this)}function qI(e,t,r=Number.POSITIVE_INFINITY){return n=>n.lift(new YI(e,t,r))}M.prototype.materialize=function(){return jI()(this)},M.prototype.max=function(e){return GI(e)(this)},M.prototype.merge=function(...e){return this.lift.call(ee(this,...e))},M.prototype.mergeAll=function(e=Number.POSITIVE_INFINITY){return $(e)(this)},M.prototype.mergeMap=HI,M.prototype.flatMap=HI,M.prototype.flatMapTo=XI,M.prototype.mergeMapTo=XI;class YI{constructor(e,t,r){this.accumulator=e,this.seed=t,this.concurrent=r}call(e,t){return t.subscribe(new JI(e,this.accumulator,this.seed,this.concurrent))}}class JI extends G{constructor(e,t,r,n){super(e),this.accumulator=t,this.acc=r,this.concurrent=n,this.hasValue=!1,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){if(this.active<this.concurrent){const t=this.index++,r=f(this.accumulator)(this.acc,e),n=this.destination;r===h?n.error(h.e):(this.active++,this._innerSub(r,e,t))}else this.buffer.push(e)}_innerSub(e,t,r){this.add(V(this,e,t,r))}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())}notifyNext(e,t,r,n,i){const{destination:o}=this;this.acc=t,this.hasValue=!0,o.next(t)}notifyComplete(e){const t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())}}function ZI(e){return up("function"==typeof e?(t,r)=>e(t,r)<0?t:r:(e,t)=>e<t?e:t)}function QI(...e){return 1===e.length&&c(e[0])&&(e=e[0]),t=>t.lift(new KI(e))}M.prototype.mergeScan=function(e,t,r=Number.POSITIVE_INFINITY){return qI(e,t,r)(this)},M.prototype.min=function(e){return ZI(e)(this)},M.prototype.multicast=function(e,t){return le(e,t)(this)},M.prototype.observeOn=function(e,t=0){return qN(e,t)(this)};class KI{constructor(e){this.nextSources=e}call(e,t){return t.subscribe(new $I(e,this.nextSources))}}class $I extends G{constructor(e,t){super(e),this.destination=e,this.nextSources=t}notifyError(e,t){this.subscribeToNextSource()}notifyComplete(e){this.subscribeToNextSource()}_error(e){this.subscribeToNextSource()}_complete(){this.subscribeToNextSource()}subscribeToNextSource(){const e=this.nextSources.shift();e?this.add(V(this,e)):this.destination.complete()}}function eR(){return e=>e.lift(new tR)}M.prototype.onErrorResumeNext=function(...e){return QI(...e)(this)};class tR{call(e,t){return t.subscribe(new rR(e))}}class rR extends x{constructor(e){super(e),this.hasPrev=!1}_next(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e}}function nR(e,t){return r=>[dc(e,t)(r),dc(function(e,t){function r(){return!r.pred.apply(r.thisArg,arguments)}return r.pred=e,r.thisArg=t,r}(e,t))(r)]}function iR(...e){const t=e.length;if(0===t)throw new Error("list of properties cannot be empty.");return r=>H(function(e,t){return r=>{let n=r;for(let i=0;i<t;i++){const t=n[e[i]];if(void 0===t)return;n=t}return n}}(e,t))(r)}function oR(e){return e?le(()=>new O,e):le(new O)}function sR(e){return t=>le(new jd(e))(t)}function aR(e,t,r,n){r&&"function"!=typeof r&&(n=r);const i="function"==typeof r?r:void 0,o=new QN(e,t,n);return e=>le(()=>o,i)(e)}function lR(){return e=>le(new XD)(e)}function cR(...e){return function(t){return 1===e.length&&c(e[0])&&(e=e[0]),t.lift.call(pN(t,...e))}}function uR(e=-1){return t=>0===e?cc():e<0?t.lift(new hR(-1,t)):t.lift(new hR(e-1,t))}M.prototype.pairwise=function(){return eR()(this)},M.prototype.partition=function(e,t){return nR(e,t)(this)},M.prototype.pluck=function(...e){return iR(...e)(this)},M.prototype.publish=function(e){return oR(e)(this)},M.prototype.publishBehavior=function(e){return sR(e)(this)},M.prototype.publishReplay=function(e,t,r,n){return aR(e,t,r,n)(this)},M.prototype.publishLast=function(){return lR()(this)},M.prototype.race=function(...e){return cR(...e)(this)},M.prototype.reduce=function(e,t){return arguments.length>=2?up(e,t)(this):up(e)(this)};class hR{constructor(e,t){this.count=e,this.source=t}call(e,t){return t.subscribe(new dR(e,this.count,this.source))}}class dR extends x{constructor(e,t,r){super(e),this.count=t,this.source=r}complete(){if(!this.isStopped){const{source:e,count:t}=this;if(0===t)return super.complete();t>-1&&(this.count=t-1),e.subscribe(this._unsubscribeAndRecycle())}}}function pR(e){return t=>t.lift(new fR(e))}M.prototype.repeat=function(e=-1){return uR(e)(this)};class fR{constructor(e){this.notifier=e}call(e,t){return t.subscribe(new mR(e,this.notifier,t))}}class mR extends G{constructor(e,t,r){super(e),this.notifier=t,this.source=r,this.sourceIsBeingSubscribedTo=!0}notifyNext(e,t,r,n,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)}notifyComplete(e){if(!1===this.sourceIsBeingSubscribedTo)return super.complete()}complete(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return super.complete();this._unsubscribeAndRecycle(),this.notifications.next()}}_unsubscribe(){const{notifications:e,retriesSubscription:t}=this;e&&(e.unsubscribe(),this.notifications=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null}_unsubscribeAndRecycle(){const{_unsubscribe:e}=this;return this._unsubscribe=null,super._unsubscribeAndRecycle(),this._unsubscribe=e,this}subscribeToRetries(){this.notifications=new O;const e=f(this.notifier)(this.notifications);if(e===h)return super.complete();this.retries=e,this.retriesSubscription=V(this,e)}}function vR(e=-1){return t=>t.lift(new gR(e,t))}M.prototype.repeatWhen=function(e){return pR(e)(this)};class gR{constructor(e,t){this.count=e,this.source=t}call(e,t){return t.subscribe(new yR(e,this.count,this.source))}}class yR extends x{constructor(e,t,r){super(e),this.count=t,this.source=r}error(e){if(!this.isStopped){const{source:t,count:r}=this;if(0===r)return super.error(e);r>-1&&(this.count=r-1),t.subscribe(this._unsubscribeAndRecycle())}}}function xR(e){return t=>t.lift(new bR(e,t))}M.prototype.retry=function(e=-1){return vR(e)(this)};class bR{constructor(e,t){this.notifier=e,this.source=t}call(e,t){return t.subscribe(new wR(e,this.notifier,this.source))}}class wR extends G{constructor(e,t,r){super(e),this.notifier=t,this.source=r}error(e){if(!this.isStopped){let t=this.errors,r=this.retries,n=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(t=new O,(r=f(this.notifier)(t))===h)return super.error(h.e);n=V(this,r)}this._unsubscribeAndRecycle(),this.errors=t,this.retries=r,this.retriesSubscription=n,t.next(e)}}_unsubscribe(){const{errors:e,retriesSubscription:t}=this;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null}notifyNext(e,t,r,n,i){const{_unsubscribe:o}=this;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)}}function _R(e){return t=>t.lift(new SR(e))}M.prototype.retryWhen=function(e){return xR(e)(this)};class SR{constructor(e){this.notifier=e}call(e,t){const r=new TR(e),n=t.subscribe(r);return n.add(V(r,this.notifier)),n}}class TR extends G{constructor(){super(...arguments),this.hasValue=!1}_next(e){this.value=e,this.hasValue=!0}notifyNext(e,t,r,n,i){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))}}function MR(e,t=uN){return r=>r.lift(new AR(e,t))}M.prototype.sample=function(e){return _R(e)(this)};class AR{constructor(e,t){this.period=e,this.scheduler=t}call(e,t){return t.subscribe(new ER(e,this.period,this.scheduler))}}class ER extends x{constructor(e,t,r){super(e),this.period=t,this.scheduler=r,this.hasValue=!1,this.add(r.schedule(CR,t,{subscriber:this,period:t}))}_next(e){this.lastValue=e,this.hasValue=!0}notifyNext(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))}}function CR(e){let{subscriber:t,period:r}=e;t.notifyNext(),this.schedule(e,r)}function PR(e,t){return r=>r.lift(new OR(e,t))}M.prototype.sampleTime=function(e,t=uN){return MR(e,t)(this)},M.prototype.scan=function(e,t){return arguments.length>=2?ap(e,t)(this):ap(e)(this)};class OR{constructor(e,t){this.compareTo=e,this.comparor=t}call(e,t){return t.subscribe(new DR(e,this.compareTo,this.comparor))}}class DR extends x{constructor(e,t,r){super(e),this.compareTo=t,this.comparor=r,this._a=[],this._b=[],this._oneComplete=!1,this.add(t.subscribe(new NR(e,this)))}_next(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())}_complete(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0}checkValues(){const{_a:e,_b:t,comparor:r}=this;for(;e.length>0&&t.length>0;){let n=e.shift(),i=t.shift(),o=!1;r?(o=f(r)(n,i))===h&&this.destination.error(h.e):o=n===i,o||this.emit(!1)}}emit(e){const{destination:t}=this;t.next(e),t.complete()}nextB(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())}}class NR extends x{constructor(e,t){super(e),this.parent=t}_next(e){this.parent.nextB(e)}_error(e){this.parent.error(e)}_complete(){this.parent._complete()}}function LR(e,t,r){return n=>n.lift(function(e,t,r){let n,i,o=0,s=!1,a=!1;return function(l){o++,n&&!s||(s=!1,n=new QN(e,t,r),i=l.subscribe({next(e){n.next(e)},error(e){s=!0,n.error(e)},complete(){a=!0,n.complete()}}));const c=n.subscribe(this);return()=>{o--,c.unsubscribe(),i&&0===o&&a&&i.unsubscribe()}}}(e,t,r))}function IR(e){return t=>t.lift(new RR(e,t))}M.prototype.sequenceEqual=function(e,t){return PR(e,t)(this)},M.prototype.share=function(){return he()(this)},M.prototype.shareReplay=function(e,t,r){return LR(e,t,r)(this)};class RR{constructor(e,t){this.predicate=e,this.source=t}call(e,t){return t.subscribe(new FR(e,this.predicate,this.source))}}class FR extends x{constructor(e,t,r){super(e),this.predicate=t,this.source=r,this.seenValue=!1,this.index=0}applySingleValue(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)}_next(e){const t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)}tryNext(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(e){this.destination.error(e)}}_complete(){const e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new zd)}}function kR(e){return t=>t.lift(new UR(e))}M.prototype.single=function(e){return IR(e)(this)};class UR{constructor(e){this.total=e}call(e,t){return t.subscribe(new BR(e,this.total))}}class BR extends x{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){++this.count>this.total&&this.destination.next(e)}}function jR(e){return t=>t.lift(new zR(e))}M.prototype.skip=function(e){return kR(e)(this)};class zR{constructor(e){if(this._skipCount=e,this._skipCount<0)throw new Wd}call(e,t){return 0===this._skipCount?t.subscribe(new x(e)):t.subscribe(new VR(e,this._skipCount))}}class VR extends x{constructor(e,t){super(e),this._skipCount=t,this._count=0,this._ring=new Array(t)}_next(e){const t=this._skipCount,r=this._count++;if(r<t)this._ring[r]=e;else{const n=r%t,i=this._ring,o=i[n];i[n]=e,this.destination.next(o)}}}function GR(e){return t=>t.lift(new HR(e))}M.prototype.skipLast=function(e){return jR(e)(this)};class HR{constructor(e){this.notifier=e}call(e,t){return t.subscribe(new WR(e,this.notifier))}}class WR extends G{constructor(e,t){super(e),this.hasValue=!1,this.add(this.innerSubscription=V(this,t))}_next(e){this.hasValue&&super._next(e)}notifyNext(e,t,r,n,i){this.hasValue=!0,this.innerSubscription.unsubscribe()}notifyComplete(){}}function XR(e){return t=>t.lift(new qR(e))}M.prototype.skipUntil=function(e){return GR(e)(this)};class qR{constructor(e){this.predicate=e}call(e,t){return t.subscribe(new YR(e,this.predicate))}}class YR extends x{constructor(e,t){super(e),this.predicate=t,this.skipping=!0,this.index=0}_next(e){const t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)}tryCallPredicate(e){try{const t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}}}function JR(...e){return t=>{let r=e[e.length-1];N(r)?e.pop():r=null;const n=e.length;return tN(1!==n||r?n>0?q(e,r):cc(r):uc(e[0]),t)}}M.prototype.skipWhile=function(e){return XR(e)(this)},M.prototype.startWith=function(...e){return JR(...e)(this)};let ZR=1;const QR={};const KR={setImmediate(e){const t=ZR++;return QR[t]=e,Promise.resolve().then(()=>(function(e){const t=QR[e];t&&t()})(t)),t},clearImmediate(e){delete QR[e]}};const $R=new class extends cN{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let r,n=-1,i=t.length;e=e||t.shift();do{if(r=e.execute(e.state,e.delay))break}while(++n<i&&(e=t.shift()));if(this.active=!1,r){for(;++n<i&&(e=t.shift());)e.unsubscribe();throw r}}}(class extends aN{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,r=0){return null!==r&&r>0?super.requestAsyncId(e,t,r):(e.actions.push(this),e.scheduled||(e.scheduled=KR.setImmediate(e.flush.bind(e,null))))}recycleAsyncId(e,t,r=0){if(null!==r&&r>0||null===r&&this.delay>0)return super.recycleAsyncId(e,t,r);0===e.actions.length&&(KR.clearImmediate(t),e.scheduled=void 0)}});class eF extends M{constructor(e,t=0,r=$R){super(),this.source=e,this.delayTime=t,this.scheduler=r,(!hN(t)||t<0)&&(this.delayTime=0),r&&"function"==typeof r.schedule||(this.scheduler=$R)}static create(e,t=0,r=$R){return new eF(e,t,r)}static dispatch(e){const{source:t,subscriber:r}=e;return this.add(t.subscribe(r))}_subscribe(e){const t=this.delayTime,r=this.source;return this.scheduler.schedule(eF.dispatch,t,{source:r,subscriber:e})}}function tF(e,t=0){return function(r){return r.lift(new rF(e,t))}}class rF{constructor(e,t){this.scheduler=e,this.delay=t}call(e,t){return new eF(t,this.delay,this.scheduler).subscribe(e)}}function nF(e,t){return"function"==typeof t?r=>r.pipe(nF((r,n)=>Y(e(r,n)).pipe(H((e,i)=>t(r,e,n,i))))):t=>t.lift(new iF(e))}M.prototype.subscribeOn=function(e,t=0){return tF(e,t)(this)};class iF{constructor(e){this.project=e}call(e,t){return t.subscribe(new oF(e,this.project))}}class oF extends G{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this._innerSub(t,e,r)}_innerSub(e,t,r){const n=this.innerSubscription;n&&n.unsubscribe(),this.add(this.innerSubscription=V(this,e,t,r))}_complete(){const{innerSubscription:e}=this;e&&!e.closed||super._complete()}_unsubscribe(){this.innerSubscription=null}notifyComplete(e){this.remove(e),this.innerSubscription=null,this.isStopped&&super._complete()}notifyNext(e,t,r,n,i){this.destination.next(t)}}function sF(){return nF(K)}function aF(){return sF()(this)}function lF(e,t){return t?nF(()=>e,t):nF(()=>e)}function cF(e){return t=>t.lift(new uF(e))}M.prototype.switch=aF,M.prototype._switch=aF,M.prototype.switchMap=function(e){return nF(e)(this)},M.prototype.switchMapTo=function(e){return lF(e)(this)},M.prototype.take=function(e){return np(e)(this)},M.prototype.takeLast=function(e){return Xd(e)(this)};class uF{constructor(e){this.notifier=e}call(e,t){const r=new hF(e),n=V(r,this.notifier);return n&&!n.closed?(r.add(n),t.subscribe(r)):r}}class hF extends G{constructor(e){super(e)}notifyNext(e,t,r,n,i){this.complete()}notifyComplete(){}}function dF(e){return t=>t.lift(new pF(e))}M.prototype.takeUntil=function(e){return cF(e)(this)};class pF{constructor(e){this.predicate=e}call(e,t){return t.subscribe(new fF(e,this.predicate))}}class fF extends x{constructor(e,t){super(e),this.predicate=t,this.index=0}_next(e){const t=this.destination;let r;try{r=this.predicate(e,this.index++)}catch(e){return void t.error(e)}this.nextOrComplete(e,r)}nextOrComplete(e,t){const r=this.destination;Boolean(t)?r.next(e):r.complete()}}M.prototype.takeWhile=function(e){return dF(e)(this)};const mF={leading:!0,trailing:!1};function vF(e,t=mF){return r=>r.lift(new gF(e,t.leading,t.trailing))}class gF{constructor(e,t,r){this.durationSelector=e,this.leading=t,this.trailing=r}call(e,t){return t.subscribe(new yF(e,this.durationSelector,this.leading,this.trailing))}}class yF extends G{constructor(e,t,r,n){super(e),this.destination=e,this.durationSelector=t,this._leading=r,this._trailing=n,this._hasValue=!1}_next(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))}send(){const{_hasValue:e,_sendValue:t}=this;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=null}throttle(e){const t=this.tryDurationSelector(e);t&&this.add(this._throttled=V(this,t))}tryDurationSelector(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}}throttlingDone(){const{_throttled:e,_trailing:t}=this;e&&e.unsubscribe(),this._throttled=null,t&&this.send()}notifyNext(e,t,r,n,i){this.throttlingDone()}notifyComplete(){this.throttlingDone()}}function xF(e,t=uN,r=mF){return n=>n.lift(new bF(e,t,r.leading,r.trailing))}M.prototype.throttle=function(e,t=mF){return vF(e,t)(this)};class bF{constructor(e,t,r,n){this.duration=e,this.scheduler=t,this.leading=r,this.trailing=n}call(e,t){return t.subscribe(new wF(e,this.duration,this.scheduler,this.leading,this.trailing))}}class wF extends x{constructor(e,t,r,n,i){super(e),this.duration=t,this.scheduler=r,this.leading=n,this.trailing=i,this._hasTrailingValue=!1,this._trailingValue=null}_next(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(_F,this.duration,{subscriber:this})),this.leading&&this.destination.next(e))}_complete(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}clearThrottle(){const e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)}}function _F(e){const{subscriber:t}=e;t.clearThrottle()}function SF(e=uN){return t=>rN(()=>t.pipe(ap(({current:t},r)=>({value:r,current:e.now(),last:t}),{current:e.now(),value:void 0,last:void 0}),H(({current:e,last:t,value:r})=>new TF(r,e-t))))}M.prototype.throttleTime=function(e,t=uN,r=mF){return xF(e,t,r)(this)};class TF{constructor(e,t){this.value=e,this.interval=t}}M.prototype.timeInterval=function(e=uN){return SF(e)(this)};class MF extends Error{constructor(){super("Timeout has occurred"),Object.setPrototypeOf(this,MF.prototype)}}function AF(e,t,r=uN){return n=>{let i=UL(e),o=i?+e-r.now():Math.abs(e);return n.lift(new EF(o,i,t,r))}}class EF{constructor(e,t,r,n){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=r,this.scheduler=n}call(e,t){return t.subscribe(new CF(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}class CF extends G{constructor(e,t,r,n,i){super(e),this.absoluteTimeout=t,this.waitFor=r,this.withObservable=n,this.scheduler=i,this.action=null,this.scheduleTimeout()}static dispatchTimeout(e){const{withObservable:t}=e;e._unsubscribeAndRecycle(),e.add(V(e,t))}scheduleTimeout(){const{action:e}=this;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(CF.dispatchTimeout,this.waitFor,this))}_next(e){this.absoluteTimeout||this.scheduleTimeout(),super._next(e)}_unsubscribe(){this.action=null,this.scheduler=null,this.withObservable=null}}function PF(e,t=uN){return AF(e,nc(new MF),t)}function OF(e=uN){return H(t=>new DF(t,e.now()))}M.prototype.timeout=function(e,t=uN){return PF(e,t)(this)},M.prototype.timeoutWith=function(e,t,r=uN){return AF(e,t,r)(this)};class DF{constructor(e,t){this.value=e,this.timestamp=t}}function NF(e,t,r){return 0===r?[t]:(e.push(t),e)}function LF(){return up(NF,[])}M.prototype.timestamp=function(e=uN){return OF(e)(this)},M.prototype.toArray=function(){return LF()(this)};r("XypG");function IF(e){return function(t){return t.lift(new RF(e))}}class RF{constructor(e){this.windowBoundaries=e}call(e,t){const r=new FF(e),n=t.subscribe(r);return n.closed||r.add(V(r,this.windowBoundaries)),n}}class FF extends G{constructor(e){super(e),this.window=new O,e.next(this.window)}notifyNext(e,t,r,n,i){this.openWindow()}notifyError(e,t){this._error(e)}notifyComplete(e){this._complete()}_next(e){this.window.next(e)}_error(e){this.window.error(e),this.destination.error(e)}_complete(){this.window.complete(),this.destination.complete()}_unsubscribe(){this.window=null}openWindow(){const e=this.window;e&&e.complete();const t=this.destination,r=this.window=new O;t.next(r)}}function kF(e,t=0){return function(r){return r.lift(new UF(e,t))}}M.prototype.window=function(e){return IF(e)(this)};class UF{constructor(e,t){this.windowSize=e,this.startWindowEvery=t}call(e,t){return t.subscribe(new BF(e,this.windowSize,this.startWindowEvery))}}class BF extends x{constructor(e,t,r){super(e),this.destination=e,this.windowSize=t,this.startWindowEvery=r,this.windows=[new O],this.count=0,e.next(this.windows[0])}_next(e){const t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,r=this.destination,n=this.windowSize,i=this.windows,o=i.length;for(let a=0;a<o&&!this.closed;a++)i[a].next(e);const s=this.count-n+1;if(s>=0&&s%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){const e=new O;i.push(e),r.next(e)}}_error(e){const t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)}_complete(){const e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()}_unsubscribe(){this.count=0,this.windows=null}}function jF(e){let t=uN,r=null,n=Number.POSITIVE_INFINITY;return N(arguments[3])&&(t=arguments[3]),N(arguments[2])?t=arguments[2]:hN(arguments[2])&&(n=arguments[2]),N(arguments[1])?t=arguments[1]:hN(arguments[1])&&(r=arguments[1]),function(i){return i.lift(new zF(e,r,n,t))}}M.prototype.windowCount=function(e,t=0){return kF(e,t)(this)};class zF{constructor(e,t,r,n){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=r,this.scheduler=n}call(e,t){return t.subscribe(new GF(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))}}class VF extends O{constructor(){super(...arguments),this._numberOfNextedValues=0}next(e){this._numberOfNextedValues++,super.next(e)}get numberOfNextedValues(){return this._numberOfNextedValues}}class GF extends x{constructor(e,t,r,n,i){super(e),this.destination=e,this.windowTimeSpan=t,this.windowCreationInterval=r,this.maxWindowSize=n,this.scheduler=i,this.windows=[];const o=this.openWindow();if(null!==r&&r>=0){const e={subscriber:this,window:o,context:null},n={windowTimeSpan:t,windowCreationInterval:r,subscriber:this,scheduler:i};this.add(i.schedule(XF,t,e)),this.add(i.schedule(WF,r,n))}else{const e={subscriber:this,window:o,windowTimeSpan:t};this.add(i.schedule(HF,t,e))}}_next(e){const t=this.windows,r=t.length;for(let n=0;n<r;n++){const r=t[n];r.closed||(r.next(e),r.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(r))}}_error(e){const t=this.windows;for(;t.length>0;)t.shift().error(e);this.destination.error(e)}_complete(){const e=this.windows;for(;e.length>0;){const t=e.shift();t.closed||t.complete()}this.destination.complete()}openWindow(){const e=new VF;return this.windows.push(e),this.destination.next(e),e}closeWindow(e){e.complete();const t=this.windows;t.splice(t.indexOf(e),1)}}function HF(e){const{subscriber:t,windowTimeSpan:r,window:n}=e;n&&t.closeWindow(n),e.window=t.openWindow(),this.schedule(e,r)}function WF(e){const{windowTimeSpan:t,subscriber:r,scheduler:n,windowCreationInterval:i}=e;let o={action:this,subscription:null};const s={subscriber:r,window:r.openWindow(),context:o};o.subscription=n.schedule(XF,t,s),this.add(o.subscription),this.schedule(e,i)}function XF(e){const{subscriber:t,window:r,context:n}=e;n&&n.action&&n.subscription&&n.action.remove(n.subscription),t.closeWindow(r)}function qF(e,t){return r=>r.lift(new YF(e,t))}M.prototype.windowTime=function(e){let t=uN,r=null,n=Number.POSITIVE_INFINITY;return N(arguments[3])&&(t=arguments[3]),N(arguments[2])?t=arguments[2]:hN(arguments[2])&&(n=arguments[2]),N(arguments[1])?t=arguments[1]:hN(arguments[1])&&(r=arguments[1]),jF(e,r,n,t)(this)};class YF{constructor(e,t){this.openings=e,this.closingSelector=t}call(e,t){return t.subscribe(new JF(e,this.openings,this.closingSelector))}}class JF extends G{constructor(e,t,r){super(e),this.openings=t,this.closingSelector=r,this.contexts=[],this.add(this.openSubscription=V(this,t,t))}_next(e){const{contexts:t}=this;if(t){const r=t.length;for(let n=0;n<r;n++)t[n].window.next(e)}}_error(e){const{contexts:t}=this;if(this.contexts=null,t){const r=t.length;let n=-1;for(;++n<r;){const r=t[n];r.window.error(e),r.subscription.unsubscribe()}}super._error(e)}_complete(){const{contexts:e}=this;if(this.contexts=null,e){const t=e.length;let r=-1;for(;++r<t;){const t=e[r];t.window.complete(),t.subscription.unsubscribe()}}super._complete()}_unsubscribe(){const{contexts:e}=this;if(this.contexts=null,e){const t=e.length;let r=-1;for(;++r<t;){const t=e[r];t.window.unsubscribe(),t.subscription.unsubscribe()}}}notifyNext(e,t,r,n,i){if(e===this.openings){const{closingSelector:e}=this,r=f(e)(t);if(r===h)return this.error(h.e);{const e=new O,t=new v,n={window:e,subscription:t};this.contexts.push(n);const i=V(this,r,n);i.closed?this.closeWindow(this.contexts.length-1):(i.context=n,t.add(i)),this.destination.next(e)}}else this.closeWindow(this.contexts.indexOf(e))}notifyError(e){this.error(e)}notifyComplete(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))}closeWindow(e){if(-1===e)return;const{contexts:t}=this,r=t[e],{window:n,subscription:i}=r;t.splice(e,1),n.complete(),i.unsubscribe()}}function ZF(e){return function(t){return t.lift(new QF(e))}}M.prototype.windowToggle=function(e,t){return qF(e,t)(this)};class QF{constructor(e){this.closingSelector=e}call(e,t){return t.subscribe(new KF(e,this.closingSelector))}}class KF extends G{constructor(e,t){super(e),this.destination=e,this.closingSelector=t,this.openWindow()}notifyNext(e,t,r,n,i){this.openWindow(i)}notifyError(e,t){this._error(e)}notifyComplete(e){this.openWindow(e)}_next(e){this.window.next(e)}_error(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()}_complete(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()}unsubscribeClosingNotification(){this.closingNotification&&this.closingNotification.unsubscribe()}openWindow(e=null){e&&(this.remove(e),e.unsubscribe());const t=this.window;t&&t.complete();const r=this.window=new O;this.destination.next(r);const n=f(this.closingSelector)();if(n===h){const e=h.e;this.destination.error(e),this.window.error(e)}else this.add(this.closingNotification=V(this,n))}}function $F(...e){return t=>{let r;"function"==typeof e[e.length-1]&&(r=e.pop());const n=e;return t.lift(new ek(n,r))}}M.prototype.windowWhen=function(e){return ZF(e)(this)};class ek{constructor(e,t){this.observables=e,this.project=t}call(e,t){return t.subscribe(new tk(e,this.observables,this.project))}}class tk extends G{constructor(e,t,r){super(e),this.observables=t,this.project=r,this.toRespond=[];const n=t.length;this.values=new Array(n);for(let i=0;i<n;i++)this.toRespond.push(i);for(let i=0;i<n;i++){let e=t[i];this.add(V(this,e,e,i))}}notifyNext(e,t,r,n,i){this.values[r]=t;const o=this.toRespond;if(o.length>0){const e=o.indexOf(r);-1!==e&&o.splice(e,1)}}notifyComplete(){}_next(e){if(0===this.toRespond.length){const t=[e,...this.values];this.project?this._tryProject(t):this.destination.next(t)}}_tryProject(e){let t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)}}function rk(e){return t=>t.lift(new _N(e))}M.prototype.withLatestFrom=function(...e){return $F(...e)(this)},M.prototype.zip=function(...e){return this.lift.call(wN(this,...e))},M.prototype.zipAll=function(e){return rk(e)(this)};new class extends cN{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let r,n=-1,i=t.length;e=e||t.shift();do{if(r=e.execute(e.state,e.delay))break}while(++n<i&&(e=t.shift()));if(this.active=!1,r){for(;++n<i&&(e=t.shift());)e.unsubscribe();throw r}}}(class extends aN{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,r=0){return null!==r&&r>0?super.requestAsyncId(e,t,r):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame(()=>e.flush(null))))}recycleAsyncId(e,t,r=0){if(null!==r&&r>0||null===r&&this.delay>0)return super.recycleAsyncId(e,t,r);0===e.actions.length&&(cancelAnimationFrame(t),e.scheduled=void 0)}});function nk(...e){let t=null;return"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&c(e[0])&&(e=e[0].slice()),r=>r.lift.call(Y([r,...e]),new $D(t))}function ik(...e){return t=>t.lift.call(tN(t,...e))}function ok(...e){return t=>t.lift.call(ee(t,...e))}function sk(...e){return function(t){return t.lift.call(wN(t,...e))}}function ak(e){return class extends e{constructor(...e){super(...e),this.displayListValid=!1,this._unscaledWidth=0,this._unscaledHeight=0}getUnscaledWidth(){return this._unscaledWidth}setUnscaledWidth(e){this._unscaledWidth!==e&&(this._unscaledWidth=e,this.invalidateDisplayList())}getUnscaledHeight(){return this._unscaledHeight}setUnscaledHeight(e){this._unscaledHeight!==e&&(this._unscaledHeight=e,this.invalidateDisplayList())}getSmallSide(){return Math.min(this.getUnscaledWidth(),this.getUnscaledHeight())}invalidateDisplayList(){this.displayListValid=!1}validateDisplayList(){return!this.displayListValid&&(this.updateDisplayList(),this.displayListValid=!0,!0)}updateDisplayList(){}on(e,t,r){return super.on(e,t,r)}off(e,t,r){return super.off(e,t,r)}set x(e){super.x!==e&&(super.x=e,this.emit("moved"))}set y(e){super.y!==e&&(super.y=e,this.emit("moved"))}set rotation(e){super.rotation!==e&&(super.rotation=e,this.emit("rotated"))}}}const lk=ak(PIXI.Container);class ck extends lk{constructor(){super()}validateDisplayList(){if(!this.children||0===this.children.length)return!1;let e=super.validateDisplayList();for(const t of this.children)e=t.validateDisplayList()||e;return e}updateDisplayList(){}addChild(e){const t=super.addChild(e);return this.onChildAdded(t),t}addChildAt(e,t){const r=super.addChildAt(e,t);return this.onChildAdded(r),r}removeChild(e){const t=super.removeChild(e);return this.onChildRemoved(t),t}removeChildAt(e){const t=super.removeChildAt(e);return this.onChildRemoved(t),t}removeChildren(e,t){const r=super.removeChildren(e,t);return r.forEach(e=>this.onChildRemoved(e)),r}onChildAdded(e){e.on("moved",this.invalidateDisplayList,this),e.on("rotated",this.invalidateDisplayList,this)}onChildRemoved(e){e.off("moved",this.invalidateDisplayList,this),e.off("rotated",this.invalidateDisplayList,this)}}const uk=ak(PIXI.Graphics);class hk extends uk{}var dk=PIXI.Point;class pk extends hk{set mapData(e){this._mapData=e,this.invalidateDisplayList()}set scalingSquare(e){this._scalingSquare=e,this.invalidateDisplayList()}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(8,16777215);const e=this._mapData.roadSpline.points.map(e=>new dk((e.x-this._scalingSquare.x)*this.getUnscaledWidth()/this._scalingSquare.width,(this._scalingSquare.y-e.y)*this.getUnscaledHeight()/this._scalingSquare.height+this.getUnscaledHeight()));e.push(e[0]),this.drawPolygon(e);const t=(Fg.getAngleBetweenPoints(e[0],e[1])+Fg.getAngleBetweenPoints(e[e.length-2],e[0]))/2;this.lineStyle(4,16777215),this.moveTo(e[0].x+16*Math.cos(t+Math.PI/2),e[0].y+16*Math.sin(t+Math.PI/2)),this.lineTo(e[0].x-16*Math.cos(t+Math.PI/2),e[0].y-16*Math.sin(t+Math.PI/2))}}class fk extends hk{updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(2,16777215),this.beginFill(0,.3),this.drawRect(0,0,this.getUnscaledWidth(),this.getUnscaledHeight()),this.endFill()}}class mk extends hk{set color(e){this._color!==e&&(this._color=e,this.invalidateDisplayList())}set size(e){this._size!==e&&(this._size=e,this.invalidateDisplayList())}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(1,0),this.beginFill(this._color),this.drawCircle(0,0,this._size),this.endFill()}}var vk=PIXI.Rectangle,gk=PIXI.Point;class yk extends ck{constructor(e){super(),this.cars=[],this.carListeners=new Map,this.mapData=e,this.background=new fk,this.background.setUnscaledWidth(this.getUnscaledWidth()),this.background.setUnscaledHeight(this.getUnscaledHeight()),this.addChild(this.background),this.calculateScalingSquare(),this.trackSpline=new pk,this.trackSpline.setUnscaledWidth(this.getUnscaledWidth()),this.trackSpline.setUnscaledHeight(this.getUnscaledHeight()),this.trackSpline.mapData=this.mapData,this.trackSpline.scalingSquare=this.scalingSquare,this.addChild(this.trackSpline)}setUnscaledWidth(e){super.setUnscaledWidth(e),this.background.setUnscaledWidth(e),this.trackSpline.setUnscaledWidth(e)}setUnscaledHeight(e){super.setUnscaledHeight(e),this.background.setUnscaledHeight(e),this.trackSpline.setUnscaledHeight(e)}calculateScalingSquare(){const e=new gk(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),t=new gk(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);this.mapData.roadSpline.points.forEach(r=>{e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),t.x=Math.max(t.x,r.x),t.y=Math.max(t.y,r.y)});const r=new gk(t.x-e.x,t.y-e.y);this.scalingSquare=new vk(e.x-.1*r.x,e.y-.1*r.y,1.2*r.x,1.2*r.y),this.scalingSquare.width/this.scalingSquare.height>1?(this.scalingSquare.y-=(this.scalingSquare.width-this.scalingSquare.height)/2,this.scalingSquare.height+=this.scalingSquare.width-this.scalingSquare.height):(this.scalingSquare.x-=(this.scalingSquare.height-this.scalingSquare.width)/2,this.scalingSquare.width+=this.scalingSquare.height-this.scalingSquare.width)}addCar(e,t=!1){const r=new mk;r.color=yk.CAR_COLORS[Math.floor(Math.random()*yk.CAR_COLORS.length)],r.size=t?8:5;const n=e.getPosition();r.x=(n.x-this.scalingSquare.x)*this.getUnscaledWidth()/this.scalingSquare.width,r.y=(this.scalingSquare.y-n.y)*this.getUnscaledHeight()/this.scalingSquare.height+this.getUnscaledHeight(),this.addChild(r);const i=e.positionChangedSubject.subscribe(e=>{r.x=(e.x-this.scalingSquare.x)*this.getUnscaledWidth()/this.scalingSquare.width,r.y=(this.scalingSquare.y-e.y)*this.getUnscaledHeight()/this.scalingSquare.height+this.getUnscaledHeight()});this.cars.push(e),this.carListeners.set(e.id,{indicator:r,positionChangedSub:i})}dispose(){for(const e of this.cars)this.removeChild(this.carListeners.get(e.id).indicator),this.carListeners.get(e.id).positionChangedSub.unsubscribe(),this.carListeners.delete(e.id);this.cars=[]}}yk.CAR_COLORS=[4357620,12465647,14679099,14679099,14679099,49775,16583698,8375620];class xk extends hk{updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(2,16777215),this.beginFill(0,.3),this.drawCircle(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,this.getSmallSide()/2),this.endFill()}}var bk=PIXI.Text;class wk extends hk{constructor(e=320){super(),this.startAngle=3*Math.PI/4,this.endAngle=9*Math.PI/4,this.maxSpeed=e}get maxSpeed(){return this._maxSpeed}set maxSpeed(e){e=20*Math.ceil(e/20),this._maxSpeed!==e&&(this._maxSpeed=e,this._divisionsCount=e/20+1,this.updateChildren(),this.invalidateDisplayList())}set currentSpeed(e){e=Math.min(this.maxSpeed,e),this._currentSpeed!==e&&(this._currentSpeed=e,this.invalidateDisplayList())}setUnscaledWidth(e){super.setUnscaledWidth(e),this.updateChildren()}setUnscaledHeight(e){super.setUnscaledHeight(e),this.updateChildren()}updateChildren(){this.removeChildren();for(let e=0;e<this._divisionsCount;e++){const t=this.startAngle+e*(this.endAngle-this.startAngle)/(this._divisionsCount-1),r=20*e,n=new kg(.875*this.getSmallSide()/2,t).cartesianPoint,i=new bk(r.toString(),{fontFamily:"Lucida Console",fontSize:18,fontWeight:"bold",fill:r<=this._currentSpeed?wk.CURRENT_SPEED_COLOR:16777215,align:"center"});i.anchor.x=i.anchor.y=.5,i.x=n.x+this.getUnscaledWidth()/2,i.y=n.y+this.getUnscaledHeight()/2,this.addChild(i)}}updateDisplayList(){super.updateDisplayList();const e=this.startAngle+(this.endAngle-this.startAngle)*(this._currentSpeed/this.maxSpeed);this.clear(),this.lineStyle(2,wk.CURRENT_SPEED_COLOR),this.arc(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,.65*this.getSmallSide()/2,this.startAngle,e),this.lineStyle(2,16777215),this.arc(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,.65*this.getSmallSide()/2,e,this.endAngle);for(let t=0;t<=4*(this._divisionsCount-1);t++){const r=t%4==0,n=t%2==0,i=this.startAngle+t*(this.endAngle-this.startAngle)/(this._divisionsCount-1)/4,o=new kg(.65*this.getSmallSide()/2,i).cartesianPoint,s=new kg((r?.75:n?.72:.69)*this.getSmallSide()/2,i).cartesianPoint;this.lineStyle(2,i>e?16777215:wk.CURRENT_SPEED_COLOR),this.moveTo(o.x+this.getUnscaledWidth()/2,o.y+this.getUnscaledHeight()/2),this.lineTo(s.x+this.getUnscaledWidth()/2,s.y+this.getUnscaledHeight()/2)}for(let t of this.children)t.style.fill=+t.text<=this._currentSpeed?wk.CURRENT_SPEED_COLOR:16777215}}wk.CURRENT_SPEED_COLOR=16738137;var _k=PIXI.Point;class Sk extends hk{constructor(e=320){super(),this.startAngle=3*Math.PI/4,this.endAngle=9*Math.PI/4,this.maxSpeed=e}get maxSpeed(){return this._maxSpeed}set maxSpeed(e){e=20*Math.ceil(e/20),this._maxSpeed!==e&&(this._maxSpeed=e,this.rotation=this.startAngle+(this.endAngle-this.startAngle)*(this._currentSpeed/this.maxSpeed))}set currentSpeed(e){e=Math.min(1.05*this.maxSpeed,e),this._currentSpeed!==e&&(this._currentSpeed=e,this.rotation=this.startAngle+(this.endAngle-this.startAngle)*(this._currentSpeed/this.maxSpeed))}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(1,3355443),this.beginFill(4357620,1),this.drawPolygon([new _k(-.05*this.getSmallSide(),0),new _k(0,.02*this.getSmallSide()),new _k(.35*this.getSmallSide(),.005*this.getSmallSide()),new _k(.4*this.getSmallSide(),0),new _k(.35*this.getSmallSide(),-.005*this.getSmallSide()),new _k(0,-.02*this.getSmallSide()),new _k(-.05*this.getSmallSide(),0)]),this.endFill()}}class Tk extends ck{get selectionSpeed(){return this._selectionSpeed}set selectionSpeed(e){this._selectionSpeed!==e&&(this._selectionSpeed=e,e>=0?(this.selectionArrow.currentSpeed=3.6*e,this.selectionArrow.visible=!0):this.selectionArrow.visible=!1,this.invalidateDisplayList())}setUnscaledWidth(e){super.setUnscaledWidth(e),this.background.setUnscaledWidth(e),this.dials.setUnscaledWidth(e),this.arrow.setUnscaledWidth(e),this.selectionArrow.setUnscaledWidth(e),this.arrow.x=e/2,this.selectionArrow.x=e/2}setUnscaledHeight(e){super.setUnscaledHeight(e),this.background.setUnscaledHeight(e),this.dials.setUnscaledHeight(e),this.arrow.setUnscaledHeight(e),this.selectionArrow.setUnscaledHeight(e),this.arrow.y=e/2,this.selectionArrow.y=e/2}constructor(e){super(),this.car=e,this.background=new xk,this.background.setUnscaledWidth(this.getUnscaledWidth()),this.background.setUnscaledHeight(this.getUnscaledHeight()),this.addChild(this.background),this.dials=new wk,this.dials.setUnscaledWidth(this.getUnscaledWidth()),this.dials.setUnscaledHeight(this.getUnscaledHeight()),this.dials.currentSpeed=3.6*e.speed,this.addChild(this.dials),this.arrow=new Sk,this.arrow.setUnscaledWidth(this.getUnscaledWidth()),this.arrow.setUnscaledHeight(this.getUnscaledHeight()),this.arrow.currentSpeed=3.6*e.speed,this.arrow.x=this.getUnscaledWidth()/2,this.arrow.y=this.getUnscaledHeight()/2,this.addChild(this.arrow),this.selectionArrow=new Sk,this.selectionArrow.setUnscaledWidth(this.getUnscaledWidth()),this.selectionArrow.setUnscaledHeight(this.getUnscaledHeight()),this.selectionArrow.x=this.getUnscaledWidth()/2,this.selectionArrow.y=this.getUnscaledHeight()/2,this.selectionArrow.alpha=.7,this.addChild(this.selectionArrow),e.speedChangedSubject.subscribe(e=>{this.dials.currentSpeed=3.6*e,this.arrow.currentSpeed=3.6*e})}}class Mk{constructor(e){this.controlService=e}addCar(e){this.cars.push(e),this.miniMap.addCar(e)}initHud(e,t,r){this.renderer=Ng.autoDetectRenderer(window.innerWidth,window.innerHeight,{antialias:!0,resolution:1,transparent:!0,preserveDrawingBuffer:!0,clearBeforeRender:!1}),this.canvasWidth=window.innerWidth,this.canvasHeight=window.innerHeight,this.renderer.view.style.position="absolute",this.renderer.view.style.display="block",e.nativeElement.appendChild(this.renderer.view),this.myCar=t,this.cars=[t],this.canvasStage=new ck,this.miniMap=new yk(r),this.miniMap.setUnscaledWidth(300),this.miniMap.setUnscaledHeight(300),this.miniMap.x=20,this.miniMap.y=this.canvasHeight-320,this.miniMap.addCar(t,!0),this.canvasStage.addChild(this.miniMap),this.speedometer=new Tk(t),this.speedometer.setUnscaledWidth(300),this.speedometer.setUnscaledHeight(300),this.speedometer.x=this.canvasWidth-320,this.speedometer.y=this.canvasHeight-320,this.canvasStage.addChild(this.speedometer),this.controlService.trajectorySelectionSubject.subscribe(e=>{const r=e?Math.max(0,Hg.getSpeedInUniformlyAcceleratedMotionByDistance(t.speed,e.l,1)):-1;this.speedometer.selectionSpeed=r}),requestAnimationFrame(this._renderPixiStageRoutine.bind(this))}_renderPixiStageRoutine(){if(requestAnimationFrame(this._renderPixiStageRoutine.bind(this)),this.canvasStage.validateDisplayList()){const e=this.renderer.view.getContext("2d")||this.renderer.view.getContext("webgl");e instanceof CanvasRenderingContext2D?(e.clearRect(20,this.canvasHeight-320,300,300),e.clearRect(this.canvasWidth-320,this.canvasHeight-320,300,300)):(e.enable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.scissor(20,20,300,300),e.clear(e.COLOR_BUFFER_BIT),e.scissor(this.canvasWidth-320,20,300,300),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.SCISSOR_TEST)),this.renderer.render(this.canvasStage)}}resizeCanvas(e,t){this.canvasStage&&this.renderer&&(this.canvasWidth!=e||this.canvasHeight!=t)&&(this.renderer.resize(e,t),this.canvasWidth=e,this.canvasHeight=t,this.miniMap.y=t-320,this.speedometer.x=e-320,this.speedometer.y=t-320,this.canvasStage.invalidateDisplayList())}}class Ak{constructor(e,t,r){this.carId=e,this.progress=t,this.lapNumber=r}}class Ek{getEngineForce(){return this.engineForce}getBrakingForce(){return this.brakingForce}getSteeringMaxCurvature(e){return 1/(Ek.DORMANT_TURN_RADIUS+Math.pow(e,2)/this.steeringFactor)}getDragForce(e){return this.dragConstant*Math.pow(e,2)}getWheelFrictionForce(e){return this.wheelFrictionConstant*Math.abs(e)}getMaxAcceleration(e){return(this.getEngineForce()-this.getDragForce(e)-this.getWheelFrictionForce(e))/this.mass}getMaxDeceleration(e){const t=-Hg.getAccelerationToAchieveSpeed(e,0,1);return Math.min(t,(this.getBrakingForce()+this.getDragForce(e)+this.getWheelFrictionForce(e))/this.mass)}static fromDTO(e){const t=new Ek;return t.steeringFactor=e.steering,t.dragConstant=e.dragConstant,t.wheelFrictionConstant=e.wheelFrictionConstant,t.engineForce=e.engineForce,t.brakingForce=e.brakingForce,t.mass=e.mass,t}}Ek.DORMANT_TURN_RADIUS=5.5;var Ck=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})},Pk=Ng.Point;class Ok{constructor(e,t,r,n=0,i=0,o=0,s=0){this.id=e,this.model=t,this.characteristics=r,this.x=n,this.y=i,this.rotation=o,this._speed=s,this.ready=!1,this.positionChangedSubject=new O,this.speedChangedSubject=new O}get speed(){return this._speed}set speed(e){e!==this._speed&&(this._speed=e,this.speedChangedSubject.next(e))}initMesh(e,t=!0){return Ck(this,void 0,void 0,function*(){this.mesh=yield e.loadCar("BMW_M3_MW"),this.mesh.position.x=this.x,this.mesh.position.y=this.y,this.mesh.position.z=0,this.mesh.rotation.z=this.rotation,this.mesh.traverse(function(e){e instanceof Og.Mesh&&(e.castShadow=t,e.receiveShadow=t)}),this.ready=!0})}setX(e){e!=this.x&&(this.x=e,this.ready&&(this.mesh.position.x=this.x),this.positionChangedSubject.next(this.getPosition()))}setY(e){e!=this.y&&(this.y=e,this.ready&&(this.mesh.position.y=this.y),this.positionChangedSubject.next(this.getPosition()))}getPosition(){return new Pk(this.x,this.y)}setPosition(e){this.x==e.x&&this.y==e.y||(this.x=e.x,this.y=e.y,this.ready&&this.mesh.position.set(e.x,e.y,0),this.positionChangedSubject.next(this.getPosition()))}setRotation(e){e!=this.rotation&&(this.rotation=e,this.ready&&(this.mesh.rotation.z=this.rotation))}clone(){return new Ok(5*(this.id+1),this.model,this.characteristics,this.x,this.y,this.rotation)}static fromDTO(e){return new Ok(Math.round(1e3*Math.random()),"BMW_M3_MW",Ek.fromDTO(e))}}var Dk=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Nk{constructor(e,t,r,n,i,o,s,a){this.hudService=e,this.socketService=t,this.loginService=r,this.carService=n,this.ngZone=i,this.modelLoaderService=o,this.controlService=s,this.router=a,window.onresize=(e=>{this.ngZone.run(()=>{this.resizeCanvas(window.innerWidth,window.innerHeight)})})}get raceTimestamp(){return this.stepsCount}resizeCanvas(e,t){this.hudService.resizeCanvas(e,t),this.stage3d.resizeCanvas(e,t)}initGameplay(e,t,r){return Dk(this,void 0,void 0,function*(){this.isWaitingPlayers=!0,this.isLoadingMap=!0,this.stage3d=t,this.cars=new Map,this.lastCarPositionsOnRoadSpline=new Map,this.myCarId=r.id,this.stepsCount=0,r.ready||(yield r.initMesh(this.modelLoaderService,!0)),this.mapData=yield this.modelLoaderService.loadMap("default-map"),console.log(this.mapData),this.cars.set(r.id,r),this.hudService.initHud(e,r,this.mapData),this.stage3d.addCar(r,!0),this.stage3d.addMap(this.mapData.scene,!0),this.controlService.initControls(this.stage3d,r),this.isLoadingMap=!1})}startGame(){return Dk(this,void 0,void 0,function*(){const e=this.loginService.currentUser;if(!e)return this.socketService.socketAvailable()&&this.socketService.disconnect(),console.warn("no user on game start"),this.router.navigate(["login"]);this.socketService.stepSubject.subscribe(e=>this.onStepComplete(e.map(e=>(e.trajectory&&(e.trajectory=new zg(e.trajectory.l,e.trajectory.c)),e)))),this.socketService.readyToStart({id:this.myCarId,name:e.login})})}onStepComplete(e){return Dk(this,void 0,void 0,function*(){this.stepsCount++,this.stepsCount>1&&(this.stage3d.startWorldRenderingLoop(),yield this.playAnimations(e),this.stage3d.stopWorldRenderingLoop()),this.startNewIteration(e).then()})}calculateCarPositionsOnRoad(e=0){const t=[];for(const r of this.cars.values()){const n=r.getPosition(),i=this.lastCarPositionsOnRoadSpline.get(r.id);let o=-1,s=0,a=0;if(i){const t=this.raceTimestamp+e-i.calculatedAt,r=(i.speed+20)*t;s=Math.max(2,Math.ceil(r/this.mapData.roadSpline.minSegmentLength)),o=i.pos.lineIndex,a=i.lap}const l=this.mapData.roadSpline.getNearestPointOnSpline(new Og.Vector3(n.x,n.y,0),o,s),c=this.mapData.roadSpline.getLapProgress(l);i&&(i.progress.lapPercent>75&&c.lapPercent<25?2===++a&&console.log("Someone finished"):i.progress.lapPercent<25&&c.lapPercent>75&&a--),this.lastCarPositionsOnRoadSpline.set(r.id,{calculatedAt:this.raceTimestamp+e,speed:r.speed,pos:l,progress:c,lap:a}),t.push(new Ak(r.id,c,a))}t.sort((e,t)=>e.lapNumber===t.lapNumber?t.progress.lapPercent-e.progress.lapPercent:t.lapNumber-e.lapNumber),2===t.find(e=>e.carId===this.myCarId).lapNumber&&this.socketService.finished(this.stepsCount)}playAnimations(e){return Dk(this,void 0,void 0,function*(){const t=new Map,r=new Map;for(let i of e){let e=this.cars.get(i.id);e&&i.trajectory&&t.set(i.id,{rotation:e.rotation,position:e.getPosition(),speed:e.speed})}const n=(new Date).getTime();return new Promise(i=>{const o=this.stage3d.beforeWorldRenderSubject.subscribe(()=>{const s=((new Date).getTime()-n)/1e3;if(s>=1)o.unsubscribe(),i();else{for(let n of e){if(r.has(n.id))continue;let e=this.cars.get(n.id),i=t.get(n.id);if(e&&n.trajectory&&i){const t=new zg(Hg.getDistanceInUniformlyAcceleratedMotion(i.speed,n.acceleration,s),n.trajectory.c);if(Math.abs(t.l)>=Math.abs(n.trajectory.l))r.set(n.id,!0),e.setPosition(n.finalCarProperties.position),e.setRotation(n.finalCarProperties.rotation),e.speed=n.finalCarProperties.speed;else{const r=t.polarPosition;r.theta+=i.rotation;const o=r.cartesianPoint;o.x+=i.position.x,o.y+=i.position.y,e.setPosition(o),e.setRotation(i.rotation+t.pointerRotation),e.speed=n.trajectory.l<0?0:Hg.getSpeedInUniformlyAcceleratedMotion(i.speed,n.acceleration,s)}}}this.calculateCarPositionsOnRoad(s),this.controlService.updateCameraDistance()}this.stage3d.animateCamera()})})})}startNewIteration(e){return Dk(this,void 0,void 0,function*(){if(!this.myCarId&&0!==this.myCarId||!this.cars.get(this.myCarId))return void console.log('Don\'t have "myCar" for arc functionality :(');this.isWaitingPlayers&&(this.isWaitingPlayers=!1);for(let s of e){let e=this.cars.get(s.id);e?(e.setPosition(s.finalCarProperties.position),e.setRotation(s.finalCarProperties.rotation),e.speed=s.finalCarProperties.speed):(yield(e=new Ok(s.id,"lambo",new Ek,s.finalCarProperties.position.x,s.finalCarProperties.position.y,s.finalCarProperties.rotation,s.finalCarProperties.speed)).initMesh(this.modelLoaderService,!0),this.stage3d.addCar(e),this.hudService.addCar(e),this.cars.set(e.id,e))}this.calculateCarPositionsOnRoad();let t,r,n,i=this.cars.get(this.myCarId),o=0;this.mapData.polygon.isContainingPoint(i.getPosition())?(t=Math.max(0,this.getMinDistanceOnNextStep(i)),r=this.getMaxDistanceOnNextStep(i),o=i.speed,n=i.characteristics.getSteeringMaxCurvature(i.speed)):(t=0,r=this.getMaxDistanceOnNextStep(i,0),o=0,n=i.characteristics.getSteeringMaxCurvature(0)),Math.abs(o)<.25&&(t=-r+Math.abs(o)),this.controlService.updateCameraDistance(),this.controlService.adjustControlPositions(),this.stage3d.animateCamera(),this.stage3d.renderWorldOnce(),this.controlService.askForSelectedPosition(t,r,o,n).then(e=>{const t=e.polarPosition;t.theta+=i.rotation;const r=t.cartesianPoint;r.x+=i.x,r.y+=i.y;const n={id:i.id,finalCarProperties:{position:i.getPosition(),rotation:i.rotation,speed:i.speed},trajectory:e,acceleration:Hg.getAccelerationInUniformlyAcceleratedMotion(i.speed,e.l,1)};let o=e.breakToSegments().map(e=>{const t=kg.fromCartesian(e);return t.theta+=i.rotation,(e=t.cartesianPoint).x+=i.x,e.y+=i.y,e});for(let s=0;s<o.length;s++){const t=o[s];if(!this.mapData.polygon.isContainingPoint(t)){let t=this.mapData.polygon.getLinePolygonIntersection(s>0?o[s-1]:i.getPosition(),o[s]),r=Math.min(.1,Fg.getDistanceBetweenPoints(i.getPosition(),t)),a=Fg.getAngleBetweenPoints(t,i.getPosition());return n.finalCarProperties.speed=0,n.finalCarProperties.position.x=t.x+Math.cos(a)*r,n.finalCarProperties.position.y=t.y+Math.sin(a)*r,Fg.getDistanceBetweenPoints(i.getPosition(),n.finalCarProperties.position)>.01?(n.finalCarProperties.rotation+=s*(e.pointerRotation/o.length),n.trajectory=new zg(e.l*s/o.length,e.c)):n.trajectory=new zg(0,0),void this.socketService.nextStep(n)}}n.finalCarProperties.speed=Math.max(0,Hg.getSpeedInUniformlyAcceleratedMotionByDistance(i.speed,e.l,1)),n.finalCarProperties.rotation+=e.pointerRotation,n.finalCarProperties.position=r,this.socketService.nextStep(n)})})}getMinDistanceOnNextStep(e,t=e.speed){return Hg.getDistanceInUniformlyAcceleratedMotion(t,-e.characteristics.getMaxDeceleration(t),1)}getMaxDistanceOnNextStep(e,t=e.speed){return Hg.getDistanceInUniformlyAcceleratedMotion(t,e.characteristics.getMaxAcceleration(t),1)}setRaceResults(e){this.raceResults=e}getLastRaceResults(){return this.raceResults}}class Lk{constructor(e,t,r,n){this.gameplayService=e,this.router=t,this.socketService=r,this.carService=n}ngOnInit(){if(!this.socketService.socketAvailable())return console.warn("No socket is open on game start"),this.router.navigate(["menu"]);const e=this.carService.selectedCar;if(!e)return console.warn("car is not selected"),this.router.navigate(["selectCars"]);const t=Ok.fromDTO(e);this.gameplayService.initGameplay(this.canvasContainer,this.stage3d,t).then(()=>{this.gameplayService.startGame(),this.socketService.finishSubject.subscribe(e=>{this.gameplayService.setRaceResults(e),this.router.navigate(["finish"])})})}checkIfLoadingMap(){return this.gameplayService.isLoadingMap}chechIfWaitingPlayers(){return this.gameplayService.isWaitingPlayers}}var Ik=to({encapsulation:0,styles:[[".screen-centered-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:absolute;top:0;left:0;right:0;bottom:0}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}.click-through[_ngcontent-%COMP%]{pointer-events:none}.loading-h[_ngcontent-%COMP%]{text-align:center}.invisible[_ngcontent-%COMP%]{display:none}"]],data:{}});function Rk(e){return qs(0,[(e()(),Lo(0,0,null,null,3,"div",[["class","screen-centered-container"]],null,null,null,null,null)),(e()(),Lo(1,0,null,null,2,"div",[],null,null,null,null,null)),(e()(),Lo(2,0,null,null,1,"h1",[["class","loading-h"]],null,null,null,null,null)),(e()(),Hs(3,null,[" "," "]))],null,function(e,t){e(t,3,0,t.component.checkIfLoadingMap()?"Loading map":"Waiting other players")})}function Fk(e){return qs(0,[ks(402653184,1,{canvasContainer:0}),ks(402653184,2,{stage3d:0}),(e()(),Lo(2,0,null,null,5,"div",[],null,null,null,null,null)),(e()(),Lo(3,0,null,null,1,"stage-3d",[["class","full-screen"]],[[2,"invisible",null]],null,null,LD,ND)),_s(4,4308992,[[2,4],["stage3d",4]],0,DD,[Jg],null,null),(e()(),Lo(5,0,[[1,0],["canvasContainer",1]],null,0,"div",[["class","full-screen click-through"]],[[2,"invisible",null]],null,null,null,null)),(e()(),No(16777216,null,null,1,null,Rk)),_s(7,16384,null,0,Iu,[Cn,En],{ngIf:[0,"ngIf"]},null)],function(e,t){var r=t.component;e(t,4,0),e(t,7,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers())},function(e,t){var r=t.component;e(t,3,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers()),e(t,5,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers())})}var kk=Ko("page-gameplay",Lk,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"page-gameplay",[],null,null,null,Fk,Ik)),_s(1,114688,null,0,Lk,[Nk,Hv,kd,Tg],null,null)],function(e,t){e(t,1,0)},null)},{},{},[]),Uk=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Bk{constructor(e,t,r,n){this.router=e,this.gameplayService=t,this.lobbyService=r,this.socketService=n,this.messageText=t.getLastRaceResults()?"Congratulations! You won the race!":"Good luck next time!"}tryAgain(){this.lobbyService.quickStart().subscribe(e=>Uk(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(e.serverUrl),this.router.navigate(["/selectCars"])}catch(e){console.log("Can't connect to lobby"),console.error(e)}}))}}var jk=to({encapsulation:0,styles:[["finish-screen[_ngcontent-%COMP%]{background-color:#fff}.finish-content[_ngcontent-%COMP%]{width:500px;height:70%;margin:0 auto;display:flex;justify-content:space-around;flex-direction:column}.finish-message[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center}.finish-text[_ngcontent-%COMP%]{color:gray}.finish-button[_ngcontent-%COMP%]{width:60%;margin:20px auto!important;justify-content:space-around;align-self:center;display:flex}"]],data:{}});function zk(e){return qs(0,[(e()(),Lo(0,0,null,null,10,"div",[],null,null,null,null,null)),(e()(),Lo(1,0,null,null,9,"div",[["class","finish-content"]],null,null,null,null,null)),(e()(),Lo(2,0,null,null,8,"div",[["class","finish-message"]],null,null,null,null,null)),(e()(),Lo(3,0,null,null,1,"h1",[["class","finish-text"]],null,null,null,null,null)),(e()(),Hs(4,null,["",""])),(e()(),Lo(5,0,null,null,1,"button",[["class","finish-button"]],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.tryAgain()&&n);return n},null,null)),(e()(),Hs(-1,null,["Race again"])),(e()(),Lo(7,0,null,null,3,"button",[["class","finish-button"]],null,[[null,"click"]],function(e,t,r){var n=!0;"click"===t&&(n=!1!==cs(e,8).onClick()&&n);return n},null,null)),_s(8,16384,null,0,qv,[Hv,nv,[8,null],gn,yn],{routerLink:[0,"routerLink"]},null),function(e,t){return Gs(32,e,new Array(t))}(9,1),(e()(),Hs(-1,null,["Go to menu"]))],function(e,t){e(t,8,0,e(t,9,0,"menu"))},function(e,t){e(t,4,0,t.component.messageText)})}var Vk=Ko("finish-screen",Bk,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"finish-screen",[],null,null,null,zk,jk)),_s(1,49152,null,0,Bk,[Hv,Nk,Nd,kd],null,null)],null,null)},{},{},[]);class Gk{constructor(e,t,r,n){this.loginService=e,this.carService=t,this.fb=r,this.router=n}onLoginClick(e,t){this.loginService.login(e,t).subscribe(e=>{this.router.navigate(["/menu"])},e=>{console.error(e)})}onFacebookLoginClick(){this.fb.login().then(e=>console.log(e)).catch(e=>console.error(e))}onSignupClick(e,t){this.loginService.createUser(e,t).subscribe(e=>{console.log(JSON.stringify(e))},e=>{console.error(e)})}}var Hk=to({encapsulation:0,styles:[[".login[_ngcontent-%COMP%]{height:100%;margin:0 auto}.background[_ngcontent-%COMP%]{height:100%;width:100%;position:absolute;display:flex;justify-content:space-between;flex-direction:column;z-index:-1}.title[_ngcontent-%COMP%]{color:#467daf;font-size:82px;font-family:Arial;position:absolute;bottom:200px;right:200px}.title-end[_ngcontent-%COMP%]{color:grey}.background-part[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.left-top-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/left-top-line.svg);height:130px;width:165px;zoom:150%}.right-top-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/right-top-line.svg);height:95px;width:190px;zoom:120%;margin-right:200px}.right-bottom-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/right-bottom-line.svg);height:160px;width:155px;zoom:150%}.left-bottom-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/left-bottom-line.svg);height:140px;width:210px;align-self:flex-end;zoom:150%}.car[_ngcontent-%COMP%]{background-image:url(/assets/images/login/car.svg);height:220px;width:434px;zoom:120%;position:absolute;top:40px;right:350px;z-index:-1}.car-lines[_ngcontent-%COMP%]{width:60%;background-image:url(/assets/images/login/car-line.svg);background-size:cover;height:50%;position:absolute;right:0;z-index:-1}button[_ngcontent-%COMP%]{margin-top:10px;width:350px;height:45px;background-color:#fff;border:2px solid #467daf;color:#467daf;border-radius:3px;font-size:large}button[_ngcontent-%COMP%]:focus{outline:0}.content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;justify-content:center}.content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill{-webkit-box-shadow:0 0 0 30px #fff inset}.content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:0;outline:0;background:0 0;border-bottom:2px solid #467daf;margin-top:10px;width:350px;height:45px;font-size:large}.login-form[_ngcontent-%COMP%]{padding-left:180px;padding-bottom:60px;display:flex;flex-direction:column}.login-button[_ngcontent-%COMP%]{width:300px}.fb-button[_ngcontent-%COMP%]{width:45px;background-color:#467daf;color:#fff}.button-panel[_ngcontent-%COMP%]{padding-top:30px}"]],data:{}});function Wk(e){return qs(0,[(e()(),Lo(0,0,null,null,25,"div",[["class","login"]],null,null,null,null,null)),(e()(),Lo(1,0,null,null,6,"div",[["class","background"]],null,null,null,null,null)),(e()(),Lo(2,0,null,null,2,"div",[["class","background-part"]],null,null,null,null,null)),(e()(),Lo(3,0,null,null,0,"div",[["class","left-top-lines"]],null,null,null,null,null)),(e()(),Lo(4,0,null,null,0,"div",[["class","right-top-lines"]],null,null,null,null,null)),(e()(),Lo(5,0,null,null,2,"div",[["class","background-part"]],null,null,null,null,null)),(e()(),Lo(6,0,null,null,0,"div",[["class","left-bottom-lines"]],null,null,null,null,null)),(e()(),Lo(7,0,null,null,0,"div",[["class","right-bottom-lines"]],null,null,null,null,null)),(e()(),Lo(8,0,null,null,0,"div",[["class","car"]],null,null,null,null,null)),(e()(),Lo(9,0,null,null,0,"div",[["class","car-lines"]],null,null,null,null,null)),(e()(),Lo(10,0,null,null,3,"div",[["class","title"]],null,null,null,null,null)),(e()(),Hs(-1,null,[" NONAME "])),(e()(),Lo(12,0,null,null,1,"span",[["class","title-end"]],null,null,null,null,null)),(e()(),Hs(-1,null,["RACING"])),(e()(),Lo(14,0,null,null,11,"div",[["class","content"]],null,null,null,null,null)),(e()(),Lo(15,0,null,null,10,"div",[["class","login-form"]],null,null,null,null,null)),(e()(),Lo(16,0,[["username",1]],null,0,"input",[["id","username"],["placeholder","Username"],["type","text"]],null,null,null,null,null)),(e()(),Lo(17,0,[["pass",1]],null,0,"input",[["id","pass"],["placeholder","Password"],["type","password"]],null,null,null,null,null)),(e()(),Lo(18,0,null,null,7,"div",[["class","button-panel"]],null,null,null,null,null)),(e()(),Lo(19,0,null,null,4,"div",[],null,null,null,null,null)),(e()(),Lo(20,0,null,null,1,"button",[["class","login-button"]],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onLoginClick(cs(e,16).value,cs(e,17).value)&&n);return n},null,null)),(e()(),Hs(-1,null,[" Log in "])),(e()(),Lo(22,0,null,null,1,"button",[["class","fb-button"]],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onFacebookLoginClick()&&n);return n},null,null)),(e()(),Hs(-1,null,[" Fb "])),(e()(),Lo(24,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(e,t,r){var n=!0,i=e.component;"click"===t&&(n=!1!==i.onSignupClick(cs(e,16).value,cs(e,17).value)&&n);return n},null,null)),(e()(),Hs(-1,null,[" Sign Up "]))],null,null)}var Xk=Ko("page-login",Gk,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"page-login",[],null,null,null,Wk,Hk)),_s(1,49152,null,0,Gk,[Od,Tg,Kl,Hv],null,null)],null,null)},{},{},[]);class qk{constructor(){this.showLoader=new O}}class Yk{constructor(e){this.uiService=e}ngOnInit(){this.uiService.showLoader.subscribe(e=>this.visible=e)}}var Jk=to({encapsulation:0,styles:[[".loader-layer[_ngcontent-%COMP%]{background-color:grey;opacity:.5;height:100%;width:100%;position:absolute;display:flex;align-items:center;flex-direction:column;justify-content:space-around}.loader[_ngcontent-%COMP%], .loader[_ngcontent-%COMP%]:after, .loader[_ngcontent-%COMP%]:before{border-radius:50%}.loader[_ngcontent-%COMP%]{color:#fff;font-size:11px;text-indent:-99999em;margin:55px auto;position:relative;width:10em;height:10em;box-shadow:inset 0 0 0 1em;-webkit-transform:translateZ(0);transform:translateZ(0)}.loader[_ngcontent-%COMP%]:after, .loader[_ngcontent-%COMP%]:before{position:absolute;content:''}.loader[_ngcontent-%COMP%]:before{width:5.2em;height:10.2em;background:grey;border-radius:10.2em 0 0 10.2em;top:-.1em;left:-.1em;-webkit-transform-origin:5.2em 5.1em;transform-origin:5.2em 5.1em;-webkit-animation:2s 1.5s infinite load2;animation:2s 1.5s infinite load2}.loader[_ngcontent-%COMP%]:after{width:5.2em;height:10.2em;background:grey;border-radius:0 10.2em 10.2em 0;top:-.1em;left:5.1em;-webkit-transform-origin:0 5.1em;transform-origin:0 5.1em;-webkit-animation:2s infinite load2;animation:2s infinite load2}@-webkit-keyframes load2{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes load2{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}"]],data:{}});function Zk(e){return qs(0,[(e()(),Lo(0,0,null,null,2,"div",[["class","loader-layer"]],null,null,null,null,null)),(e()(),Lo(1,0,null,null,1,"div",[["class","loader"]],null,null,null,null,null)),(e()(),Hs(-1,null,["Loading..."]))],null,null)}function Qk(e){return qs(0,[(e()(),No(16777216,null,null,1,null,Zk)),_s(1,16384,null,0,Iu,[Cn,En],{ngIf:[0,"ngIf"]},null)],function(e,t){e(t,1,0,t.component.visible)},null)}Ko("loader-layer",Yk,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"loader-layer",[],null,null,null,Qk,Jk)),_s(1,114688,null,0,Yk,[qk],null,null)],function(e,t){e(t,1,0)},null)},{},{},[]);var Kk=to({encapsulation:0,styles:[[""]],data:{}});function $k(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"loader-layer",[],null,null,null,Qk,Jk)),_s(1,114688,null,0,Yk,[qk],null,null),(e()(),Lo(2,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),_s(3,212992,null,0,$v,[Kv,Cn,Ir,[8,null],Pn],null,null)],function(e,t){e(t,1,0),e(t,3,0)},null)}var eU=Ko("app-root",rc,function(e){return qs(0,[(e()(),Lo(0,0,null,null,1,"app-root",[],null,null,null,$k,Kk)),_s(1,49152,null,0,rc,[Kl],null,null)],null,null)},{},{},[]);class tU{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class rU extends tU{get formDirective(){return null}get path(){return null}}function nU(e){return null==e||0===e.length}const iU=new pe("NgValidators"),oU=new pe("NgAsyncValidators"),sU=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;class aU{static min(e){return t=>{if(nU(t.value)||nU(e))return null;const r=parseFloat(t.value);return!isNaN(r)&&r<e?{min:{min:e,actual:t.value}}:null}}static max(e){return t=>{if(nU(t.value)||nU(e))return null;const r=parseFloat(t.value);return!isNaN(r)&&r>e?{max:{max:e,actual:t.value}}:null}}static required(e){return nU(e.value)?{required:!0}:null}static requiredTrue(e){return!0===e.value?null:{required:!0}}static email(e){return nU(e.value)?null:sU.test(e.value)?null:{email:!0}}static minLength(e){return t=>{if(nU(t.value))return null;const r=t.value?t.value.length:0;return r<e?{minlength:{requiredLength:e,actualLength:r}}:null}}static maxLength(e){return t=>{const r=t.value?t.value.length:0;return r>e?{maxlength:{requiredLength:e,actualLength:r}}:null}}static pattern(e){if(!e)return aU.nullValidator;let t,r;return"string"==typeof e?(r="","^"!==e.charAt(0)&&(r+="^"),r+=e,"$"!==e.charAt(e.length-1)&&(r+="$"),t=new RegExp(r)):(r=e.toString(),t=e),e=>{if(nU(e.value))return null;const n=e.value;return t.test(n)?null:{pattern:{requiredPattern:r,actualValue:n}}}}static nullValidator(e){return null}static compose(e){if(!e)return null;const t=e.filter(lU);return 0==t.length?null:function(e){return uU(function(e,t){return t.map(t=>t(e))}(e,t))}}static composeAsync(e){if(!e)return null;const t=e.filter(lU);return 0==t.length?null:function(e){return nN(function(e,t){return t.map(t=>t(e))}(e,t).map(cU)).pipe(H(uU))}}}function lU(e){return null!=e}function cU(e){const t=mr(e)?Y(e):e;if(!vr(t))throw new Error("Expected validator to return Promise or Observable.");return t}function uU(e){const t=e.reduce((e,t)=>null!=t?Object.assign({},e,t):e,{});return 0===Object.keys(t).length?null:t}const hU=new pe("NgValueAccessor"),dU={provide:hU,useExisting:Ke(()=>pU),multi:!0};class pU{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=(e=>{}),this.onTouched=(()=>{})}writeValue(e){this._renderer.setProperty(this._elementRef.nativeElement,"checked",e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)}}pU.decorators=[{type:Ee,args:[{selector:"input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]",host:{"(change)":"onChange($event.target.checked)","(blur)":"onTouched()"},providers:[dU]}]}],pU.ctorParameters=(()=>[{type:gn},{type:yn}]);const fU={provide:hU,useExisting:Ke(()=>vU),multi:!0};const mU=new pe("CompositionEventMode");class vU{constructor(e,t,r){this._renderer=e,this._elementRef=t,this._compositionMode=r,this.onChange=(e=>{}),this.onTouched=(()=>{}),this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=pp()?pp().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){const t=null==e?"":e;this._renderer.setProperty(this._elementRef.nativeElement,"value",t)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}function gU(e){return e.validate?t=>e.validate(t):e}function yU(e){return e.validate?t=>e.validate(t):e}vU.decorators=[{type:Ee,args:[{selector:"input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]",host:{"(input)":"$any(this)._handleInput($event.target.value)","(blur)":"onTouched()","(compositionstart)":"$any(this)._compositionStart()","(compositionend)":"$any(this)._compositionEnd($event.target.value)"},providers:[fU]}]}],vU.ctorParameters=(()=>[{type:gn},{type:yn},{type:void 0,decorators:[{type:tt},{type:et,args:[mU]}]}]);const xU={provide:hU,useExisting:Ke(()=>bU),multi:!0};class bU{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=(e=>{}),this.onTouched=(()=>{})}writeValue(e){const t=null==e?"":e;this._renderer.setProperty(this._elementRef.nativeElement,"value",t)}registerOnChange(e){this.onChange=(t=>{e(""==t?null:parseFloat(t))})}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)}}function wU(){throw new Error("unimplemented")}bU.decorators=[{type:Ee,args:[{selector:"input[type=number][formControlName],input[type=number][formControl],input[type=number][ngModel]",host:{"(change)":"onChange($event.target.value)","(input)":"onChange($event.target.value)","(blur)":"onTouched()"},providers:[xU]}]}],bU.ctorParameters=(()=>[{type:gn},{type:yn}]);class _U extends tU{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null,this._rawValidators=[],this._rawAsyncValidators=[]}get validator(){return wU()}get asyncValidator(){return wU()}}const SU={provide:hU,useExisting:Ke(()=>MU),multi:!0};class TU{constructor(){this._accessors=[]}add(e,t){this._accessors.push([e,t])}remove(e){for(let t=this._accessors.length-1;t>=0;--t)if(this._accessors[t][1]===e)return void this._accessors.splice(t,1)}select(e){this._accessors.forEach(t=>{this._isSameGroup(t,e)&&t[1]!==e&&t[1].fireUncheck(e.value)})}_isSameGroup(e,t){return!!e[0].control&&(e[0]._parent===t._control._parent&&e[1].name===t.name)}}TU.decorators=[{type:Rt}],TU.ctorParameters=(()=>[]);class MU{constructor(e,t,r,n){this._renderer=e,this._elementRef=t,this._registry=r,this._injector=n,this.onChange=(()=>{}),this.onTouched=(()=>{})}ngOnInit(){this._control=this._injector.get(_U),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this._renderer.setProperty(this._elementRef.nativeElement,"checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=(()=>{e(this.value),this._registry.select(this)})}fireUncheck(e){this.writeValue(e)}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)}_checkName(){this.name&&this.formControlName&&this.name!==this.formControlName&&this._throwNameError(),!this.name&&this.formControlName&&(this.name=this.formControlName)}_throwNameError(){throw new Error('\n      If you define both a name and a formControlName attribute on your radio button, their values\n      must match. Ex: <input type="radio" formControlName="food" name="food">\n    ')}}MU.decorators=[{type:Ee,args:[{selector:"input[type=radio][formControlName],input[type=radio][formControl],input[type=radio][ngModel]",host:{"(change)":"onChange()","(blur)":"onTouched()"},providers:[SU]}]}],MU.ctorParameters=(()=>[{type:gn},{type:yn},{type:TU},{type:ut}]),MU.propDecorators={name:[{type:Oe}],formControlName:[{type:Oe}],value:[{type:Oe}]};const AU={provide:hU,useExisting:Ke(()=>EU),multi:!0};class EU{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=(e=>{}),this.onTouched=(()=>{})}writeValue(e){this._renderer.setProperty(this._elementRef.nativeElement,"value",parseFloat(e))}registerOnChange(e){this.onChange=(t=>{e(""==t?null:parseFloat(t))})}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)}}EU.decorators=[{type:Ee,args:[{selector:"input[type=range][formControlName],input[type=range][formControl],input[type=range][ngModel]",host:{"(change)":"onChange($event.target.value)","(input)":"onChange($event.target.value)","(blur)":"onTouched()"},providers:[AU]}]}],EU.ctorParameters=(()=>[{type:gn},{type:yn}]);const CU={formControlName:'\n    <div [formGroup]="myGroup">\n      <input formControlName="firstName">\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       firstName: new FormControl()\n    });',formGroupName:'\n    <div [formGroup]="myGroup">\n       <div formGroupName="person">\n          <input formControlName="firstName">\n       </div>\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       person: new FormGroup({ firstName: new FormControl() })\n    });',formArrayName:'\n    <div [formGroup]="myGroup">\n      <div formArrayName="cities">\n        <div *ngFor="let city of cityArray.controls; index as i">\n          <input [formControlName]="i">\n        </div>\n      </div>\n    </div>\n\n    In your class:\n\n    this.cityArray = new FormArray([new FormControl(\'SF\')]);\n    this.myGroup = new FormGroup({\n      cities: this.cityArray\n    });',ngModelGroup:'\n    <form>\n       <div ngModelGroup="person">\n          <input [(ngModel)]="person.name" name="firstName">\n       </div>\n    </form>',ngModelWithFormGroup:'\n    <div [formGroup]="myGroup">\n       <input formControlName="firstName">\n       <input [(ngModel)]="showMoreControls" [ngModelOptions]="{standalone: true}">\n    </div>\n  '};class PU{static controlParentException(){throw new Error(`formControlName must be used with a parent formGroup directive.  You'll want to add a formGroup\n       directive and pass it an existing FormGroup instance (you can create one in your class).\n\n      Example:\n\n      ${CU.formControlName}`)}static ngModelGroupException(){throw new Error(`formControlName cannot be used with an ngModelGroup parent. It is only compatible with parents\n       that also have a "form" prefix: formGroupName, formArrayName, or formGroup.\n\n       Option 1:  Update the parent to be formGroupName (reactive form strategy)\n\n        ${CU.formGroupName}\n\n        Option 2: Use ngModel instead of formControlName (template-driven strategy)\n\n        ${CU.ngModelGroup}`)}static missingFormException(){throw new Error(`formGroup expects a FormGroup instance. Please pass one in.\n\n       Example:\n\n       ${CU.formControlName}`)}static groupParentException(){throw new Error(`formGroupName must be used with a parent formGroup directive.  You'll want to add a formGroup\n      directive and pass it an existing FormGroup instance (you can create one in your class).\n\n      Example:\n\n      ${CU.formGroupName}`)}static arrayParentException(){throw new Error(`formArrayName must be used with a parent formGroup directive.  You'll want to add a formGroup\n       directive and pass it an existing FormGroup instance (you can create one in your class).\n\n        Example:\n\n        ${CU.formArrayName}`)}static disabledAttrWarning(){console.warn("\n      It looks like you're using the disabled attribute with a reactive form directive. If you set disabled to true\n      when you set up this control in your component class, the disabled attribute will actually be set in the DOM for\n      you. We recommend using this approach to avoid 'changed after checked' errors.\n       \n      Example: \n      form = new FormGroup({\n        first: new FormControl({value: 'Nancy', disabled: true}, Validators.required),\n        last: new FormControl('Drew', Validators.required)\n      });\n    ")}static ngModelWarning(e){console.warn(`\n    It looks like you're using ngModel on the same form field as ${e}. \n    Support for using the ngModel input property and ngModelChange event with \n    reactive form directives has been deprecated in Angular v6 and will be removed \n    in Angular v7.\n    \n    For more information on this, see our API docs here:\n    https://angular.io/api/forms/${"formControl"===e?"FormControlDirective":"FormControlName"}#use-with-ngmodel\n    `)}}const OU={provide:hU,useExisting:Ke(()=>NU),multi:!0};function DU(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}class NU{constructor(e,t){this._renderer=e,this._elementRef=t,this._optionMap=new Map,this._idCounter=0,this.onChange=(e=>{}),this.onTouched=(()=>{}),this._compareWith=He}set compareWith(e){if("function"!=typeof e)throw new Error(`compareWith must be a function, but received ${JSON.stringify(e)}`);this._compareWith=e}writeValue(e){this.value=e;const t=this._getOptionId(e);null==t&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);const r=DU(t,e);this._renderer.setProperty(this._elementRef.nativeElement,"value",r)}registerOnChange(e){this.onChange=(t=>{this.value=this._getOptionValue(t),e(this.value)})}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t),e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}NU.decorators=[{type:Ee,args:[{selector:"select:not([multiple])[formControlName],select:not([multiple])[formControl],select:not([multiple])[ngModel]",host:{"(change)":"onChange($event.target.value)","(blur)":"onTouched()"},providers:[OU]}]}],NU.ctorParameters=(()=>[{type:gn},{type:yn}]),NU.propDecorators={compareWith:[{type:Oe}]};class LU{constructor(e,t,r){this._element=e,this._renderer=t,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(DU(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}LU.decorators=[{type:Ee,args:[{selector:"option"}]}],LU.ctorParameters=(()=>[{type:yn},{type:gn},{type:NU,decorators:[{type:tt},{type:it}]}]),LU.propDecorators={ngValue:[{type:Oe,args:["ngValue"]}],value:[{type:Oe,args:["value"]}]};const IU={provide:hU,useExisting:Ke(()=>FU),multi:!0};function RU(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}class FU{constructor(e,t){this._renderer=e,this._elementRef=t,this._optionMap=new Map,this._idCounter=0,this.onChange=(e=>{}),this.onTouched=(()=>{}),this._compareWith=He}set compareWith(e){if("function"!=typeof e)throw new Error(`compareWith must be a function, but received ${JSON.stringify(e)}`);this._compareWith=e}writeValue(e){let t;if(this.value=e,Array.isArray(e)){const r=e.map(e=>this._getOptionId(e));t=((e,t)=>{e._setSelected(r.indexOf(t.toString())>-1)})}else t=((e,t)=>{e._setSelected(!1)});this._optionMap.forEach(t)}registerOnChange(e){this.onChange=(t=>{const r=[];if(t.hasOwnProperty("selectedOptions")){const e=t.selectedOptions;for(let t=0;t<e.length;t++){const n=e.item(t),i=this._getOptionValue(n.value);r.push(i)}}else{const e=t.options;for(let t=0;t<e.length;t++){const n=e.item(t);if(n.selected){const e=this._getOptionValue(n.value);r.push(e)}}}this.value=r,e(r)})}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)}_registerOption(e){const t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t)._value,e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}FU.decorators=[{type:Ee,args:[{selector:"select[multiple][formControlName],select[multiple][formControl],select[multiple][ngModel]",host:{"(change)":"onChange($event.target)","(blur)":"onTouched()"},providers:[IU]}]}],FU.ctorParameters=(()=>[{type:gn},{type:yn}]),FU.propDecorators={compareWith:[{type:Oe}]};class kU{constructor(e,t,r){this._element=e,this._renderer=t,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(RU(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(RU(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}function UU(e,t){return[...t.path,e]}function BU(e,t){e||GU(t,"Cannot find control with"),t.valueAccessor||GU(t,"No value accessor for form control with"),e.validator=aU.compose([e.validator,t.validator]),e.asyncValidator=aU.composeAsync([e.asyncValidator,t.asyncValidator]),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(r=>{e._pendingValue=r,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&jU(e,t)})}(e,t),function(e,t){e.registerOnChange((e,r)=>{t.valueAccessor.writeValue(e),r&&t.viewToModelUpdate(e)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&jU(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),t.valueAccessor.setDisabledState&&e.registerOnDisabledChange(e=>{t.valueAccessor.setDisabledState(e)}),t._rawValidators.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(()=>e.updateValueAndValidity())}),t._rawAsyncValidators.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(()=>e.updateValueAndValidity())})}function jU(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function zU(e,t){null==e&&GU(t,"Cannot find control with"),e.validator=aU.compose([e.validator,t.validator]),e.asyncValidator=aU.composeAsync([e.asyncValidator,t.asyncValidator])}function VU(e){return GU(e,"There is no FormControl instance attached to form control element with")}function GU(e,t){let r;throw r=e.path.length>1?`path: '${e.path.join(" -> ")}'`:e.path[0]?`name: '${e.path}'`:"unspecified name attribute",new Error(`${t} ${r}`)}function HU(e){return null!=e?aU.compose(e.map(gU)):null}function WU(e){return null!=e?aU.composeAsync(e.map(yU)):null}function XU(e,t){if(!e.hasOwnProperty("model"))return!1;const r=e.model;return!!r.isFirstChange()||!He(t,r.currentValue)}kU.decorators=[{type:Ee,args:[{selector:"option"}]}],kU.ctorParameters=(()=>[{type:yn},{type:gn},{type:FU,decorators:[{type:tt},{type:it}]}]),kU.propDecorators={ngValue:[{type:Oe,args:["ngValue"]}],value:[{type:Oe,args:["value"]}]};const qU=[pU,EU,bU,NU,FU,MU];function YU(e,t){e._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function JU(e,t){if(!t)return null;Array.isArray(t)||GU(e,"Value accessor was not provided as an array for form control with");let r=void 0,n=void 0,i=void 0;return t.forEach(t=>{t.constructor===vU?r=t:!function(e){return qU.some(t=>e.constructor===t)}(t)?(i&&GU(e,"More than one custom value accessor matches form control with"),i=t):(n&&GU(e,"More than one built-in value accessor matches form control with"),n=t)}),i||(n||(r||(GU(e,"No valid value accessor for form control with"),null)))}function ZU(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}function QU(e,t,r,n){sn()&&"never"!==n&&((null!==n&&"once"!==n||t._ngModelWarningSentOnce)&&("always"!==n||r._ngModelWarningSent)||(PU.ngModelWarning(e),t._ngModelWarningSentOnce=!0,r._ngModelWarningSent=!0))}class KU extends rU{ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return UU(this.name,this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return HU(this._validators)}get asyncValidator(){return WU(this._asyncValidators)}_checkParentType(){}}class $U{constructor(e){this._cd=e}get ngClassUntouched(){return!!this._cd.control&&this._cd.control.untouched}get ngClassTouched(){return!!this._cd.control&&this._cd.control.touched}get ngClassPristine(){return!!this._cd.control&&this._cd.control.pristine}get ngClassDirty(){return!!this._cd.control&&this._cd.control.dirty}get ngClassValid(){return!!this._cd.control&&this._cd.control.valid}get ngClassInvalid(){return!!this._cd.control&&this._cd.control.invalid}get ngClassPending(){return!!this._cd.control&&this._cd.control.pending}}const eB={"[class.ng-untouched]":"ngClassUntouched","[class.ng-touched]":"ngClassTouched","[class.ng-pristine]":"ngClassPristine","[class.ng-dirty]":"ngClassDirty","[class.ng-valid]":"ngClassValid","[class.ng-invalid]":"ngClassInvalid","[class.ng-pending]":"ngClassPending"};class tB extends $U{constructor(e){super(e)}}tB.decorators=[{type:Ee,args:[{selector:"[formControlName],[ngModel],[formControl]",host:eB}]}],tB.ctorParameters=(()=>[{type:_U,decorators:[{type:rt}]}]);class rB extends $U{constructor(e){super(e)}}rB.decorators=[{type:Ee,args:[{selector:"[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]",host:eB}]}],rB.ctorParameters=(()=>[{type:rU,decorators:[{type:rt}]}]);const nB="VALID",iB="INVALID",oB="PENDING",sB="DISABLED";function aB(e){const t=cB(e)?e.validators:e;return Array.isArray(t)?HU(t):t||null}function lB(e,t){const r=cB(t)?t.asyncValidators:e;return Array.isArray(r)?WU(r):r||null}function cB(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class uB{constructor(e,t){this.validator=e,this.asyncValidator=t,this._onCollectionChange=(()=>{}),this.pristine=!0,this.touched=!1,this._onDisabledChange=[]}get parent(){return this._parent}get valid(){return this.status===nB}get invalid(){return this.status===iB}get pending(){return this.status==oB}get disabled(){return this.status===sB}get enabled(){return this.status!==sB}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this.validator=aB(e)}setAsyncValidators(e){this.asyncValidator=lB(e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=oB,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){this.status=sB,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign({},e,{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(e),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){this.status=nB,this._forEachChild(t=>{t.enable(Object.assign({},e,{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(e),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==nB&&this.status!==oB||this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?sB:nB}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=oB;const t=cU(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>this.setErrors(t,{emitEvent:e}))}}_cancelExistingSubscription(){this._asyncValidationSubscription&&this._asyncValidationSubscription.unsubscribe()}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,r){return null==t?null:(t instanceof Array||(t=t.split(r)),t instanceof Array&&0===t.length?null:t.reduce((e,t)=>e instanceof dB?e.controls[t]||null:e instanceof pB&&e.at(t)||null,e))}(this,e,".")}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Hr,this.statusChanges=new Hr}_calculateStatus(){return this._allControlsDisabled()?sB:this.errors?iB:this._anyControlsHaveStatus(oB)?oB:this._anyControlsHaveStatus(iB)?iB:nB}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){cB(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}}class hB extends uB{constructor(e=null,t,r){super(aB(t),lB(r,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),this._initObservables()}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_clearChangeFns(){this._onChange=[],this._onDisabledChange=[],this._onCollectionChange=(()=>{})}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange))&&(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0)}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class dB extends uB{constructor(e,t,r){super(aB(t),lB(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t){this.registerControl(e,t),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(e){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity(),this._onCollectionChange()}setControl(e,t){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity(),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(r=>{this._throwIfControlMissing(r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){Object.keys(e).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}reset(e={},t={}){this._forEachChild((r,n)=>{r.reset(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t),this._updatePristine(t),this._updateTouched(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t instanceof hB?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>e(this.controls[t],t))}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){let t=!1;return this._forEachChild((r,n)=>{t=t||this.contains(n)&&e(r)}),t}_reduceValue(){return this._reduceChildren({},(e,t,r)=>((t.enabled||this.disabled)&&(e[r]=t.value),e))}_reduceChildren(e,t){let r=e;return this._forEachChild((e,n)=>{r=t(r,e,n)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control with name: '${r}'.`)})}}class pB extends uB{constructor(e,t,r){super(aB(t),lB(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}at(e){return this.controls[e]}push(e){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity(),this._onCollectionChange()}insert(e,t){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity()}removeAt(e){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity()}setControl(e,t){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,r)=>{this._throwIfControlMissing(r),this.at(r).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e.forEach((e,r)=>{this.at(r)&&this.at(r).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}reset(e=[],t={}){this._forEachChild((r,n)=>{r.reset(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t),this._updatePristine(t),this._updateTouched(t)}getRawValue(){return this.controls.map(e=>e instanceof hB?e.value:e.getRawValue())}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control at index: ${r}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const fB={provide:rU,useExisting:Ke(()=>vB)},mB=Promise.resolve(null);class vB extends rU{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new Hr,this.form=new dB({},HU(e),WU(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){mB.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),BU(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){mB.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),ZU(this._directives,e)})}addFormGroup(e){mB.then(()=>{const t=this._findContainer(e.path),r=new dB({});zU(r,e),t.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){mB.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){mB.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,YU(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}vB.decorators=[{type:Ee,args:[{selector:"form:not([ngNoForm]):not([formGroup]),ngForm,[ngForm]",providers:[fB],host:{"(submit)":"onSubmit($event)","(reset)":"onReset()"},outputs:["ngSubmit"],exportAs:"ngForm"}]}],vB.ctorParameters=(()=>[{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]}]),vB.propDecorators={options:[{type:Oe,args:["ngFormOptions"]}]};class gB{static modelParentException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroup directive.  Try using\n      formGroup's partner directive "formControlName" instead.  Example:\n\n      ${CU.formControlName}\n\n      Or, if you'd like to avoid registering this form control, indicate that it's standalone in ngModelOptions:\n\n      Example:\n\n      ${CU.ngModelWithFormGroup}`)}static formGroupNameException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroupName or formArrayName directive.\n\n      Option 1: Use formControlName instead of ngModel (reactive strategy):\n\n      ${CU.formGroupName}\n\n      Option 2:  Update ngModel's parent be ngModelGroup (template-driven strategy):\n\n      ${CU.ngModelGroup}`)}static missingNameException(){throw new Error('If ngModel is used within a form tag, either the name attribute must be set or the form\n      control must be defined as \'standalone\' in ngModelOptions.\n\n      Example 1: <input [(ngModel)]="person.firstName" name="first">\n      Example 2: <input [(ngModel)]="person.firstName" [ngModelOptions]="{standalone: true}">')}static modelGroupParentException(){throw new Error(`\n      ngModelGroup cannot be used with a parent formGroup directive.\n\n      Option 1: Use formGroupName instead of ngModelGroup (reactive strategy):\n\n      ${CU.formGroupName}\n\n      Option 2:  Use a regular form tag instead of the formGroup directive (template-driven strategy):\n\n      ${CU.ngModelGroup}`)}}const yB={provide:rU,useExisting:Ke(()=>xB)};class xB extends KU{constructor(e,t,r){super(),this._parent=e,this._validators=t,this._asyncValidators=r}_checkParentType(){this._parent instanceof xB||this._parent instanceof vB||gB.modelGroupParentException()}}xB.decorators=[{type:Ee,args:[{selector:"[ngModelGroup]",providers:[yB],exportAs:"ngModelGroup"}]}],xB.ctorParameters=(()=>[{type:rU,decorators:[{type:it},{type:nt}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]}]),xB.propDecorators={name:[{type:Oe,args:["ngModelGroup"]}]};const bB={provide:_U,useExisting:Ke(()=>_B)},wB=Promise.resolve(null);class _B extends _U{constructor(e,t,r,n){super(),this.control=new hB,this._registered=!1,this.update=new Hr,this._parent=e,this._rawValidators=t||[],this._rawAsyncValidators=r||[],this.valueAccessor=JU(this,n)}ngOnChanges(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),XU(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?UU(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return HU(this._rawValidators)}get asyncValidator(){return WU(this._rawAsyncValidators)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){BU(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){!(this._parent instanceof xB)&&this._parent instanceof KU?gB.formGroupNameException():this._parent instanceof xB||this._parent instanceof vB||gB.modelParentException()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()||this.name||gB.missingNameException()}_updateValue(e){wB.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1})})}_updateDisabled(e){const t=e.isDisabled.currentValue,r=""===t||t&&"false"!==t;wB.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable()})}}_B.decorators=[{type:Ee,args:[{selector:"[ngModel]:not([formControlName]):not([formControl])",providers:[bB],exportAs:"ngModel"}]}],_B.ctorParameters=(()=>[{type:rU,decorators:[{type:tt},{type:it}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[hU]}]}]),_B.propDecorators={name:[{type:Oe}],isDisabled:[{type:Oe,args:["disabled"]}],model:[{type:Oe,args:["ngModel"]}],options:[{type:Oe,args:["ngModelOptions"]}],update:[{type:De,args:["ngModelChange"]}]};const SB=new pe("NgModelWithFormControlWarning"),TB={provide:_U,useExisting:Ke(()=>MB)};class MB extends _U{constructor(e,t,r,n){super(),this._ngModelWarningConfig=n,this.update=new Hr,this._ngModelWarningSent=!1,this._rawValidators=e||[],this._rawAsyncValidators=t||[],this.valueAccessor=JU(this,r)}set isDisabled(e){PU.disabledAttrWarning()}ngOnChanges(e){this._isControlChanged(e)&&(BU(this.form,this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this.form.updateValueAndValidity({emitEvent:!1})),XU(e,this.viewModel)&&(QU("formControl",MB,this,this._ngModelWarningConfig),this.form.setValue(this.model),this.viewModel=this.model)}get path(){return[]}get validator(){return HU(this._rawValidators)}get asyncValidator(){return WU(this._rawAsyncValidators)}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}MB._ngModelWarningSentOnce=!1,MB.decorators=[{type:Ee,args:[{selector:"[formControl]",providers:[TB],exportAs:"ngForm"}]}],MB.ctorParameters=(()=>[{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[hU]}]},{type:void 0,decorators:[{type:tt},{type:et,args:[SB]}]}]),MB.propDecorators={form:[{type:Oe,args:["formControl"]}],isDisabled:[{type:Oe,args:["disabled"]}],model:[{type:Oe,args:["ngModel"]}],update:[{type:De,args:["ngModelChange"]}]};const AB={provide:rU,useExisting:Ke(()=>EB)};class EB extends rU{constructor(e,t){super(),this._validators=e,this._asyncValidators=t,this.submitted=!1,this.directives=[],this.form=null,this.ngSubmit=new Hr}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations())}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const t=this.form.get(e.path);return BU(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}getControl(e){return this.form.get(e.path)}removeControl(e){ZU(this.directives,e)}addFormGroup(e){const t=this.form.get(e.path);zU(t,e),t.updateValueAndValidity({emitEvent:!1})}removeFormGroup(e){}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){const t=this.form.get(e.path);zU(t,e),t.updateValueAndValidity({emitEvent:!1})}removeFormArray(e){}getFormArray(e){return this.form.get(e.path)}updateModel(e,t){this.form.get(e.path).setValue(t)}onSubmit(e){return this.submitted=!0,YU(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const t=this.form.get(e.path);e.control!==t&&(!function(e,t){t.valueAccessor.registerOnChange(()=>VU(t)),t.valueAccessor.registerOnTouched(()=>VU(t)),t._rawValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(null)}),t._rawAsyncValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(null)}),e&&e._clearChangeFns()}(e.control,e),t&&BU(t,e),e.control=t)}),this.form._updateTreeValidity({emitEvent:!1})}_updateRegistrations(){this.form._registerOnCollectionChange(()=>this._updateDomValue()),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{}),this._oldForm=this.form}_updateValidators(){const e=HU(this._validators);this.form.validator=aU.compose([this.form.validator,e]);const t=WU(this._asyncValidators);this.form.asyncValidator=aU.composeAsync([this.form.asyncValidator,t])}_checkFormPresent(){this.form||PU.missingFormException()}}EB.decorators=[{type:Ee,args:[{selector:"[formGroup]",providers:[AB],host:{"(submit)":"onSubmit($event)","(reset)":"onReset()"},exportAs:"ngForm"}]}],EB.ctorParameters=(()=>[{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]}]),EB.propDecorators={form:[{type:Oe,args:["formGroup"]}],ngSubmit:[{type:De}]};const CB={provide:rU,useExisting:Ke(()=>PB)};class PB extends KU{constructor(e,t,r){super(),this._parent=e,this._validators=t,this._asyncValidators=r}_checkParentType(){NB(this._parent)&&PU.groupParentException()}}PB.decorators=[{type:Ee,args:[{selector:"[formGroupName]",providers:[CB]}]}],PB.ctorParameters=(()=>[{type:rU,decorators:[{type:tt},{type:it},{type:nt}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]}]),PB.propDecorators={name:[{type:Oe,args:["formGroupName"]}]};const OB={provide:rU,useExisting:Ke(()=>DB)};class DB extends rU{constructor(e,t,r){super(),this._parent=e,this._validators=t,this._asyncValidators=r}ngOnInit(){this._checkParentType(),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return UU(this.name,this._parent)}get validator(){return HU(this._validators)}get asyncValidator(){return WU(this._asyncValidators)}_checkParentType(){NB(this._parent)&&PU.arrayParentException()}}function NB(e){return!(e instanceof PB||e instanceof EB||e instanceof DB)}DB.decorators=[{type:Ee,args:[{selector:"[formArrayName]",providers:[OB]}]}],DB.ctorParameters=(()=>[{type:rU,decorators:[{type:tt},{type:it},{type:nt}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]}]),DB.propDecorators={name:[{type:Oe,args:["formArrayName"]}]};const LB={provide:_U,useExisting:Ke(()=>IB)};class IB extends _U{constructor(e,t,r,n,i){super(),this._ngModelWarningConfig=i,this._added=!1,this.update=new Hr,this._ngModelWarningSent=!1,this._parent=e,this._rawValidators=t||[],this._rawAsyncValidators=r||[],this.valueAccessor=JU(this,n)}set isDisabled(e){PU.disabledAttrWarning()}ngOnChanges(e){this._added||this._setUpControl(),XU(e,this.viewModel)&&(QU("formControlName",IB,this,this._ngModelWarningConfig),this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return UU(this.name,this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return HU(this._rawValidators)}get asyncValidator(){return WU(this._rawAsyncValidators)}_checkParentType(){!(this._parent instanceof PB)&&this._parent instanceof KU?PU.ngModelGroupException():this._parent instanceof PB||this._parent instanceof EB||this._parent instanceof DB||PU.controlParentException()}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}IB._ngModelWarningSentOnce=!1,IB.decorators=[{type:Ee,args:[{selector:"[formControlName]",providers:[LB]}]}],IB.ctorParameters=(()=>[{type:rU,decorators:[{type:tt},{type:it},{type:nt}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[iU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[oU]}]},{type:Array,decorators:[{type:tt},{type:rt},{type:et,args:[hU]}]},{type:void 0,decorators:[{type:tt},{type:et,args:[SB]}]}]),IB.propDecorators={name:[{type:Oe,args:["formControlName"]}],isDisabled:[{type:Oe,args:["disabled"]}],model:[{type:Oe,args:["ngModel"]}],update:[{type:De,args:["ngModelChange"]}]};const RB={provide:iU,useExisting:Ke(()=>UB),multi:!0},kB={provide:iU,useExisting:Ke(()=>BB),multi:!0};class UB{get required(){return this._required}set required(e){this._required=null!=e&&!1!==e&&"false"!==`${e}`,this._onChange&&this._onChange()}validate(e){return this.required?aU.required(e):null}registerOnValidatorChange(e){this._onChange=e}}UB.decorators=[{type:Ee,args:[{selector:":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]",providers:[RB],host:{"[attr.required]":'required ? "" : null'}}]}],UB.ctorParameters=(()=>[]),UB.propDecorators={required:[{type:Oe}]};class BB extends UB{validate(e){return this.required?aU.requiredTrue(e):null}}BB.decorators=[{type:Ee,args:[{selector:"input[type=checkbox][required][formControlName],input[type=checkbox][required][formControl],input[type=checkbox][required][ngModel]",providers:[kB],host:{"[attr.required]":'required ? "" : null'}}]}],BB.ctorParameters=(()=>[]);const jB={provide:iU,useExisting:Ke(()=>zB),multi:!0};class zB{set email(e){this._enabled=""===e||!0===e||"true"===e,this._onChange&&this._onChange()}validate(e){return this._enabled?aU.email(e):null}registerOnValidatorChange(e){this._onChange=e}}zB.decorators=[{type:Ee,args:[{selector:"[email][formControlName],[email][formControl],[email][ngModel]",providers:[jB]}]}],zB.ctorParameters=(()=>[]),zB.propDecorators={email:[{type:Oe}]};const VB={provide:iU,useExisting:Ke(()=>GB),multi:!0};class GB{ngOnChanges(e){"minlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return null==this.minlength?null:this._validator(e)}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=aU.minLength(parseInt(this.minlength,10))}}GB.decorators=[{type:Ee,args:[{selector:"[minlength][formControlName],[minlength][formControl],[minlength][ngModel]",providers:[VB],host:{"[attr.minlength]":"minlength ? minlength : null"}}]}],GB.ctorParameters=(()=>[]),GB.propDecorators={minlength:[{type:Oe}]};const HB={provide:iU,useExisting:Ke(()=>WB),multi:!0};class WB{ngOnChanges(e){"maxlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return null!=this.maxlength?this._validator(e):null}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=aU.maxLength(parseInt(this.maxlength,10))}}WB.decorators=[{type:Ee,args:[{selector:"[maxlength][formControlName],[maxlength][formControl],[maxlength][ngModel]",providers:[HB],host:{"[attr.maxlength]":"maxlength ? maxlength : null"}}]}],WB.ctorParameters=(()=>[]),WB.propDecorators={maxlength:[{type:Oe}]};const XB={provide:iU,useExisting:Ke(()=>qB),multi:!0};class qB{ngOnChanges(e){"pattern"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=aU.pattern(this.pattern)}}qB.decorators=[{type:Ee,args:[{selector:"[pattern][formControlName],[pattern][formControl],[pattern][ngModel]",providers:[XB],host:{"[attr.pattern]":"pattern ? pattern : null"}}]}],qB.ctorParameters=(()=>[]),qB.propDecorators={pattern:[{type:Oe}]};class YB{group(e,t=null){const r=this._reduceControls(e),n=null!=t?t.validator:null,i=null!=t?t.asyncValidator:null;return new dB(r,n,i)}control(e,t,r){return new hB(e,t,r)}array(e,t,r){const n=e.map(e=>this._createControl(e));return new pB(n,t,r)}_reduceControls(e){const t={};return Object.keys(e).forEach(r=>{t[r]=this._createControl(e[r])}),t}_createControl(e){if(e instanceof hB||e instanceof dB||e instanceof pB)return e;if(Array.isArray(e)){const t=e[0],r=e.length>1?e[1]:null,n=e.length>2?e[2]:null;return this.control(t,r,n)}return this.control(e)}}YB.decorators=[{type:Rt}],YB.ctorParameters=(()=>[]);new Ut("6.0.0");class JB{}JB.decorators=[{type:Ee,args:[{selector:"form:not([ngNoForm]):not([ngNativeValidate])",host:{novalidate:""}}]}],JB.ctorParameters=(()=>[]);const ZB=[JB,LU,kU,vU,bU,EU,pU,NU,FU,MU,tB,rB,UB,GB,WB,qB,BB,zB],QB=[_B,xB,vB],KB=[MB,EB,IB,PB,DB];class $B{}$B.decorators=[{type:Ft,args:[{declarations:ZB,exports:ZB}]}],$B.ctorParameters=(()=>[]);class ej{}ej.decorators=[{type:Ft,args:[{declarations:QB,providers:[TU],exports:[$B,QB]}]}],ej.ctorParameters=(()=>[]);class tj{static withConfig(e){return{ngModule:tj,providers:[{provide:SB,useValue:e.warnOnNgModelWithFormControl}]}}}tj.decorators=[{type:Ft,args:[{declarations:[KB],providers:[YB,TU],exports:[$B,KB]}]}],tj.ctorParameters=(()=>[]);var rj=function(e,t,r){return new rl(e,t,r)}(il,[rc],function(e){return function(e){const t={},r=[];let n=!1;for(let i=0;i<e.length;i++){const o=e[i];o.token===fr&&(n=!0),1073741824&o.flags&&r.push(o.token),o.index=i,t[Ki(o.token)]=o}return{factory:null,providersByKey:t,providers:e,modules:r,isRoot:n}}([Vo(512,Ir,Rr,[[8,[_g,Pg,kk,Vk,Xk,eU]],[3,Ir],kr]),Vo(5120,ni,ai,[[3,ni]]),Vo(4608,Mu,Eu,[ni,[2,Tu]]),Vo(5120,xr,br,[]),Vo(5120,Zn,oi,[]),Vo(5120,Qn,si,[]),Vo(4608,Mf,Af,[kh]),Vo(6144,Ui,null,[Mf]),Vo(4608,xf,bf,[]),Vo(5120,Bp,function(e,t,r,n,i,o){return[new gf(e,t),new Tf(r),new wf(n,i,o)]},[kh,Wr,kh,kh,xf,Ar]),Vo(4608,jp,jp,[Bp,Wr]),Vo(135680,Gp,Gp,[kh]),Vo(4608,Zp,Zp,[jp,Gp]),Vo(6144,mn,null,[Zp]),Vo(6144,Vp,null,[Gp]),Vo(4608,Kr,Kr,[Wr]),Vo(4608,Ep,Ep,[kh]),Vo(4608,Dp,Dp,[kh]),Vo(4608,TU,TU,[]),Vo(4608,yd,xd,[kh,Tr,vd]),Vo(4608,bd,bd,[yd,gd]),Vo(4608,qk,qk,[]),Vo(5120,nd,function(e,t){return[e,new class{constructor(e){this.uiService=e}intercept(e,t){return this.uiService.showLoader.next(!0),t.handle(e).do(e=>{e instanceof Kh&&this.uiService.showLoader.next(!1)})}}(t)]},[bd,qk]),Vo(4608,fd,fd,[]),Vo(6144,pd,null,[fd]),Vo(4608,md,md,[pd]),Vo(6144,jh,null,[md]),Vo(4608,Bh,wd,[jh,ut]),Vo(4608,td,td,[Bh]),Vo(5120,nv,mg,[Hv]),Vo(4608,ng,ng,[]),Vo(6144,tg,null,[ng]),Vo(135680,ig,ig,[Hv,xn,Cr,ut,tg]),Vo(4608,rg,rg,[]),Vo(5120,xg,yg,[vg]),Vo(5120,Mr,function(e){return[e]},[xg]),Vo(4608,Kl,Kl,[]),Vo(4608,Ad,Ad,[td,Hv]),Vo(4608,Pd,Pd,[Ad]),Vo(4608,Od,Od,[Pd,Hv]),Vo(4608,Sg,Sg,[Ad]),Vo(4608,Tg,Tg,[Sg]),Vo(4608,kd,kd,[]),Vo(4608,Jg,Jg,[kd]),Vo(4608,Mk,Mk,[Jg]),Vo(4608,WD,WD,[]),Vo(4608,Nk,Nk,[Mk,kd,Od,Tg,Wr,WD,Jg,Hv]),Vo(4608,Dd,Dd,[Ad]),Vo(4608,Nd,Nd,[Dd]),Vo(1024,ag,dg,[[3,Hv]]),Vo(1024,Xt,Rf,[]),Vo(1024,an,function(){return[cg()]},[]),Vo(512,vg,vg,[ut]),Vo(1024,gr,function(e,t){return[kp(e),gg(t)]},[[2,an],vg]),Vo(512,yr,yr,[[2,gr]]),Vo(131584,dn,dn,[Wr,Ar,ut,Xt,Ir,yr]),Vo(512,Tm,Mm,[]),Vo(512,Kv,Kv,[]),Vo(256,sg,{},[]),Vo(1024,yc,hg,[vc,[2,xc],sg]),Vo(512,bc,bc,[yc]),Vo(512,Cr,Cr,[]),Vo(512,xn,Mn,[Cr,[2,Sn]]),Vo(1024,Uv,function(){return[[{path:"menu",component:Bd},{path:"selectCars",component:Mg},{path:"game",component:Lk},{path:"finish",component:Bk},{path:"login",component:Gk},{path:"**",redirectTo:"login"}]]},[]),Vo(1024,Hv,fg,[dn,Tm,Kv,bc,ut,xn,Cr,Uv,sg,[2,jv],[2,Fv]]),Vo(1073742336,ug,ug,[[2,ag],[2,Hv]]),Vo(1073742336,tc,tc,[]),Vo(1073742336,Ih,Ih,[]),Vo(1073742336,li,li,[dn]),Vo(1073742336,Ff,Ff,[[3,Ff]]),Vo(1073742336,$B,$B,[]),Vo(1073742336,ej,ej,[]),Vo(1073742336,_d,_d,[]),Vo(1073742336,Sd,Sd,[]),Vo(1073742336,il,il,[]),Vo(256,fr,!0,[]),Vo(256,vd,"XSRF-TOKEN",[]),Vo(256,gd,"X-XSRF-TOKEN",[])])});(function(){if(nn)throw new Error("Cannot enable prod mode after platform setup.");rn=!1})(),If().bootstrapModuleFactory(rj)}},[[4,0]]]);