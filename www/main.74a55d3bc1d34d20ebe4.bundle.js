webpackJsonp([0],{"+3/4":function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("TToO"),i=function(t){function e(e){t.call(this),this.scheduler=e}return Object(r.c)(e,t),e.create=function(t){return new e(t)},e.dispatch=function(t){t.subscriber.complete()},e.prototype._subscribe=function(t){var n=this.scheduler;if(n)return n.schedule(e.dispatch,0,{subscriber:t});t.complete()},e}(n("YaPU").a)},"+4Qc":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=s(n("/MUw")),o=n("FjAT"),a=s(n("NqTp"));function s(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(){var e=this;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._head=new a.default(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/i.default.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e){return this._addListener(new a.default(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL))},t.prototype.addOnce=function(t,e){return this._addListener(new a.default(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL,!0))},t.prototype._addListener=function(t){var e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var n=this._head.next;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this},t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null},t.prototype.update=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),e=void 0;if(t>this.lastTime){(e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),this.deltaTime=e*i.default.TARGET_FPMS*this.speed;for(var n=this._head,r=n.next;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.elapsedMS=0;this.lastTime=t},r(t,[{key:"FPS",get:function(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(Math.max(0,t)/1e3,i.default.TARGET_FPMS);this._maxElapsedMS=1/e}}]),t}();e.default=c},"+9Il":function(t,e,n){"use strict";e.__esModule=!0;var r=s(n("5tzz")),i=n("FjAT"),o=n("Q5/2"),a=s(n("NGfj"));function s(t){return t&&t.__esModule?t:{default:t}}var c=new o.Matrix,u=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=t._texture,n=this.renderer,r=e._frame.width,s=e._frame.height,u=t.transform.worldTransform,l=0,h=0;if(!(e.orig.width<=0||e.orig.height<=0)&&e.baseTexture.source&&(n.setBlendMode(t.blendMode),e.valid)){n.context.globalAlpha=t.worldAlpha;var d=e.baseTexture.scaleMode===i.SCALE_MODES.LINEAR;n.smoothProperty&&n.context[n.smoothProperty]!==d&&(n.context[n.smoothProperty]=d),e.trim?(l=e.trim.width/2+e.trim.x-t.anchor.x*e.orig.width,h=e.trim.height/2+e.trim.y-t.anchor.y*e.orig.height):(l=(.5-t.anchor.x)*e.orig.width,h=(.5-t.anchor.y)*e.orig.height),e.rotate&&(u.copy(c),o.GroupD8.matrixAppendRotationInv(u=c,e.rotate,l,h),l=0,h=0),l-=e.orig.width/2,h-=e.orig.height/2,n.roundPixels?(n.context.setTransform(u.a,u.b,u.c,u.d,u.tx*n.resolution|0,u.ty*n.resolution|0),l|=0,h|=0):n.context.setTransform(u.a,u.b,u.c,u.d,u.tx*n.resolution,u.ty*n.resolution);var p=e.baseTexture.resolution;16777215!==t.tint?(t.cachedTint===t.tint&&t.tintedTexture.tintId===t._texture._updateID||(t.cachedTint=t.tint,t.tintedTexture=a.default.getTintedTexture(t,t.tint)),n.context.drawImage(t.tintedTexture,0,0,r*p,s*p,l*n.resolution,h*n.resolution,e.orig.width*n.resolution,e.orig.height*n.resolution)):n.context.drawImage(e.baseTexture.source,e._frame.x*p,e._frame.y*p,r*p,s*p,l*n.resolution,h*n.resolution,e.orig.width*n.resolution,e.orig.height*n.resolution)}},t.prototype.destroy=function(){this.renderer=null},t}();e.default=u,r.default.registerPlugin("sprite",u)},"+CnV":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t){var e,r=n("AMGY").a.Symbol;return"function"==typeof r?r.observable?e=r.observable:(e=r("observable"),r.observable=e):e="@@observable",e}()},"+DNt":function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){function e(n){return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   vec2 v = vec2(x, y);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  gl_FragColor = color;","}"].join("\n")))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((r=n("Obmw"))&&r.__esModule?r:{default:r}).default);e.default=i},"+MIv":function(t,e,n){"use strict";e.__esModule=!0;var r=n("27Ej");Object.defineProperty(e,"webgl",{enumerable:!0,get:function(){return o(r).default}});var i=n("JJ61");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"canvas",{enumerable:!0,get:function(){return o(i).default}})},"+QcN":function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){for(var e=t.getParameter(t.MAX_VARYING_VECTORS),n=15;n>e;)n-=2;return n}},"+lzb":function(t,e){function n(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}},"+uzX":function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){var n=!e;if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");if(n){var r=document.createElement("canvas");r.width=1,r.height=1,e=i.default.createContext(r)}for(var s=e.createShader(e.FRAGMENT_SHADER);;){var c=o.replace(/%forloop%/gi,a(t));if(e.shaderSource(s,c),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))break;t=t/2|0}return n&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),t};var r,i=(r=n("8QNu"))&&r.__esModule?r:{default:r},o=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function a(t){for(var e="",n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+="if(test == "+n+".0){}");return e}},"/9A/":function(t,e){t.exports=function(t,e,n){var r;if(n){var i=n.tempAttribState,o=n.attribState;for(r=0;r<i.length;r++)i[r]=!1;for(r=0;r<e.length;r++)i[e[r].attribute.location]=!0;for(r=0;r<o.length;r++)o[r]!==i[r]&&(o[r]=i[r],n.attribState[r]?t.enableVertexAttribArray(r):t.disableVertexAttribArray(r))}else for(r=0;r<e.length;r++)t.enableVertexAttribArray(e[r].attribute.location)}},"/B0E":function(t,e,n){"use strict";e.__esModule=!0,e.autoDetectRenderer=e.Application=e.Filter=e.SpriteMaskFilter=e.Quad=e.RenderTarget=e.ObjectRenderer=e.WebGLManager=e.Shader=e.CanvasRenderTarget=e.TextureUvs=e.VideoBaseTexture=e.BaseRenderTexture=e.RenderTexture=e.BaseTexture=e.TextureMatrix=e.Texture=e.Spritesheet=e.CanvasGraphicsRenderer=e.GraphicsRenderer=e.GraphicsData=e.Graphics=e.TextMetrics=e.TextStyle=e.Text=e.SpriteRenderer=e.CanvasTinter=e.CanvasSpriteRenderer=e.Sprite=e.TransformBase=e.TransformStatic=e.Transform=e.Container=e.DisplayObject=e.Bounds=e.glCore=e.WebGLRenderer=e.CanvasRenderer=e.ticker=e.utils=e.settings=void 0;var r=n("FjAT");Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})});var i=n("Q5/2");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=n("8QNu");Object.defineProperty(e,"glCore",{enumerable:!0,get:function(){return q(o).default}});var a=n("F+P4");Object.defineProperty(e,"Bounds",{enumerable:!0,get:function(){return q(a).default}});var s=n("3Wvr");Object.defineProperty(e,"DisplayObject",{enumerable:!0,get:function(){return q(s).default}});var c=n("dtlK");Object.defineProperty(e,"Container",{enumerable:!0,get:function(){return q(c).default}});var u=n("W1MY");Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return q(u).default}});var l=n("qisP");Object.defineProperty(e,"TransformStatic",{enumerable:!0,get:function(){return q(l).default}});var h=n("mAOr");Object.defineProperty(e,"TransformBase",{enumerable:!0,get:function(){return q(h).default}});var d=n("izXE");Object.defineProperty(e,"Sprite",{enumerable:!0,get:function(){return q(d).default}});var p=n("+9Il");Object.defineProperty(e,"CanvasSpriteRenderer",{enumerable:!0,get:function(){return q(p).default}});var f=n("NGfj");Object.defineProperty(e,"CanvasTinter",{enumerable:!0,get:function(){return q(f).default}});var m=n("0yPo");Object.defineProperty(e,"SpriteRenderer",{enumerable:!0,get:function(){return q(m).default}});var v=n("AM6m");Object.defineProperty(e,"Text",{enumerable:!0,get:function(){return q(v).default}});var g=n("UxPA");Object.defineProperty(e,"TextStyle",{enumerable:!0,get:function(){return q(g).default}});var y=n("4LTl");Object.defineProperty(e,"TextMetrics",{enumerable:!0,get:function(){return q(y).default}});var b=n("4Nog");Object.defineProperty(e,"Graphics",{enumerable:!0,get:function(){return q(b).default}});var x=n("Z1wJ");Object.defineProperty(e,"GraphicsData",{enumerable:!0,get:function(){return q(x).default}});var w=n("8ZQA");Object.defineProperty(e,"GraphicsRenderer",{enumerable:!0,get:function(){return q(w).default}});var _=n("thfa");Object.defineProperty(e,"CanvasGraphicsRenderer",{enumerable:!0,get:function(){return q(_).default}});var S=n("i45y");Object.defineProperty(e,"Spritesheet",{enumerable:!0,get:function(){return q(S).default}});var T=n("qD+0");Object.defineProperty(e,"Texture",{enumerable:!0,get:function(){return q(T).default}});var M=n("nQP+");Object.defineProperty(e,"TextureMatrix",{enumerable:!0,get:function(){return q(M).default}});var A=n("8USZ");Object.defineProperty(e,"BaseTexture",{enumerable:!0,get:function(){return q(A).default}});var E=n("1g9v");Object.defineProperty(e,"RenderTexture",{enumerable:!0,get:function(){return q(E).default}});var C=n("KFrc");Object.defineProperty(e,"BaseRenderTexture",{enumerable:!0,get:function(){return q(C).default}});var P=n("YdyU");Object.defineProperty(e,"VideoBaseTexture",{enumerable:!0,get:function(){return q(P).default}});var O=n("M75x");Object.defineProperty(e,"TextureUvs",{enumerable:!0,get:function(){return q(O).default}});var N=n("vwuV");Object.defineProperty(e,"CanvasRenderTarget",{enumerable:!0,get:function(){return q(N).default}});var L=n("Obmw");Object.defineProperty(e,"Shader",{enumerable:!0,get:function(){return q(L).default}});var I=n("3psj");Object.defineProperty(e,"WebGLManager",{enumerable:!0,get:function(){return q(I).default}});var R=n("MIKO");Object.defineProperty(e,"ObjectRenderer",{enumerable:!0,get:function(){return q(R).default}});var D=n("EoU7");Object.defineProperty(e,"RenderTarget",{enumerable:!0,get:function(){return q(D).default}});var F=n("tl0p");Object.defineProperty(e,"Quad",{enumerable:!0,get:function(){return q(F).default}});var U=n("hScZ");Object.defineProperty(e,"SpriteMaskFilter",{enumerable:!0,get:function(){return q(U).default}});var k=n("bmpC");Object.defineProperty(e,"Filter",{enumerable:!0,get:function(){return q(k).default}});var j=n("5XUO");Object.defineProperty(e,"Application",{enumerable:!0,get:function(){return q(j).default}});var B=n("oUe4");Object.defineProperty(e,"autoDetectRenderer",{enumerable:!0,get:function(){return B.autoDetectRenderer}});var z=X(n("aH6o")),V=X(n("z1Av")),G=q(n("/MUw")),H=q(n("5tzz")),W=q(n("qo3d"));function X(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function q(t){return t&&t.__esModule?t:{default:t}}e.settings=G.default,e.utils=z,e.ticker=V,e.CanvasRenderer=H.default,e.WebGLRenderer=W.default},"/MUw":function(t,e,n){"use strict";e.__esModule=!0;var r=o(n("0Wwa")),i=o(n("Dyrc"));function o(t){return t&&t.__esModule?t:{default:t}}e.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,r.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1,width:800,height:600,legacy:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,i.default)(),MESH_CANVAS_PADDING:0}},"/SMQ":function(t,e,n){"use strict";function r(t){var e=document.createElement("canvas");e.width=6,e.height=1;var n=e.getContext("2d");return n.fillStyle=t,n.fillRect(0,0,6,1),e}e.__esModule=!0,e.default=function(){if("undefined"==typeof document)return!1;var t=r("#ff00ff"),e=r("#ffff00"),n=document.createElement("canvas");n.width=6,n.height=1;var i=n.getContext("2d");i.globalCompositeOperation="multiply",i.drawImage(t,0,0),i.drawImage(e,2,0);var o=i.getImageData(2,0,1,1);if(!o)return!1;var a=o.data;return 255===a[0]&&0===a[1]&&0===a[2]}},"/Zzt":function(t,e,n){"use strict";e.__esModule=!0,e.calculateScreenSpaceMatrix=function(t,e,n){var r=t.identity();return r.translate(e.x/n.width,e.y/n.height),r.scale(n.width,n.height),r},e.calculateNormalizedScreenSpaceMatrix=function(t,e,n){var r=t.identity();return r.translate(e.x/n.width,e.y/n.height),r.scale(n.width/e.width,n.height/e.height),r},e.calculateSpriteMatrix=function(t,e,n,i){var o=i._texture.orig,a=t.set(n.width,0,0,n.height,e.x,e.y),s=i.worldTransform.copy(r.Matrix.TEMP_MATRIX);return s.invert(),a.prepend(s),a.scale(1/o.width,1/o.height),a.translate(i.anchor.x,i.anchor.y),a};var r=n("Q5/2")},"/brp":function(t,e){t.exports=function(t,e){var n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!n)throw new Error("This browser does not support webGL. Try using the canvas renderer");return n}},"/iUD":function(t,e,n){"use strict";e.a=function(t){return"function"==typeof t}},"/nXB":function(t,e,n){"use strict";e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=Number.POSITIVE_INFINITY,s=null,c=t[t.length-1];return Object(o.a)(c)?(s=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof c&&(n=t.pop()),null===s&&1===t.length&&t[0]instanceof r.a?t[0]:Object(a.a)(n)(new i.a(t,s))};var r=n("YaPU"),i=n("Veqx"),o=n("1Q68"),a=n("8D5t")},0:function(t,e,n){t.exports=n("x35b")},"0Emr":function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("3psj"))&&r.__esModule?r:{default:r},o=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.stencilMaskStack=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setMaskStack=function(t){this.stencilMaskStack=t;var e=this.renderer.gl;0===t.length?e.disable(e.STENCIL_TEST):e.enable(e.STENCIL_TEST)},e.prototype.pushStencil=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.renderer._activeRenderTarget.attachStencilBuffer();var e=this.renderer.gl,n=this.stencilMaskStack.length;0===n&&e.enable(e.STENCIL_TEST),this.stencilMaskStack.push(t),e.colorMask(!1,!1,!1,!1),e.stencilFunc(e.EQUAL,n,this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.INCR),this.renderer.plugins.graphics.render(t),this._useCurrent()},e.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var t=this.renderer.gl,e=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(t.disable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(0)):(t.colorMask(!1,!1,!1,!1),t.stencilOp(t.KEEP,t.KEEP,t.DECR),this.renderer.plugins.graphics.render(e),this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},e.prototype.destroy=function(){i.default.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},e}(i.default);e.default=o},"0P3J":function(t,e,n){"use strict";e.a=function(){return function(t){return t.lift(new o(t))}};var r=n("TToO"),i=n("OVmG"),o=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new a(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i},t}(),a=function(t){function e(e,n){t.call(this,e),this.connectable=n}return Object(r.c)(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(i.a)},"0Wwa":function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){return i.default.tablet||i.default.phone?4:t};var r,i=(r=n("Sst2"))&&r.__esModule?r:{default:r}},"0yPo":function(t,e,n){"use strict";e.__esModule=!0;var r=p(n("MIKO")),i=p(n("qo3d")),o=p(n("fq6b")),a=p(n("GyJD")),s=p(n("+uzX")),c=p(n("tv36")),u=p(n("/MUw")),l=n("aH6o"),h=p(n("8QNu")),d=p(n("eWjs"));function p(t){return t&&t.__esModule?t:{default:t}}var f=0,m=0,v=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));r.vertSize=5,r.vertByteSize=4*r.vertSize,r.size=u.default.SPRITE_BATCH_SIZE,r.buffers=[];for(var i=1;i<=d.default.nextPow2(r.size);i*=2)r.buffers.push(new c.default(4*i*r.vertByteSize));r.indices=(0,o.default)(r.size),r.shader=null,r.currentIndex=0,r.groups=[];for(var a=0;a<r.size;a++)r.groups[a]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};return r.sprites=[],r.vertexBuffers=[],r.vaos=[],r.vaoMax=2,r.vertexCount=0,r.renderer.on("prerender",r.onPrerender,r),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.renderer.legacy?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u.default.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=(0,s.default)(this.MAX_TEXTURES,t)),this.shader=(0,a.default)(t,this.MAX_TEXTURES),this.indexBuffer=h.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.renderer.bindVao(null);for(var e=this.shader.attributes,n=0;n<this.vaoMax;n++){var r=this.vertexBuffers[n]=h.default.GLBuffer.createVertexBuffer(t,null,t.STREAM_DRAW),i=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(r,e.aVertexPosition,t.FLOAT,!1,this.vertByteSize,0).addAttribute(r,e.aTextureCoord,t.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(r,e.aColor,t.UNSIGNED_BYTE,!0,this.vertByteSize,12);e.aTextureId&&i.addAttribute(r,e.aTextureId,t.FLOAT,!1,this.vertByteSize,16),this.vaos[n]=i}this.vao=this.vaos[0],this.currentBlendMode=99999,this.boundTextures=new Array(this.MAX_TEXTURES)},e.prototype.onPrerender=function(){this.vertexCount=0},e.prototype.render=function(t){this.currentIndex>=this.size&&this.flush(),t._texture._uvs&&(this.sprites[this.currentIndex++]=t)},e.prototype.flush=function(){if(0!==this.currentIndex){var t=this.renderer.gl,e=this.MAX_TEXTURES,n=d.default.nextPow2(this.currentIndex),r=d.default.log2(n),i=this.buffers[r],o=this.sprites,a=this.groups,s=i.float32View,c=i.uint32View,p=this.boundTextures,v=this.renderer.boundTextures,g=this.renderer.textureGC.count,y=0,b=void 0,x=void 0,w=1,_=0,S=a[0],T=void 0,M=void 0,A=l.premultiplyBlendMode[o[0]._texture.baseTexture.premultipliedAlpha?1:0][o[0].blendMode];S.textureCount=0,S.start=0,S.blend=A,f++;var E=void 0;for(E=0;E<e;++E){var C=v[E];C._enabled!==f?(p[E]=C,C._virtalBoundId=E,C._enabled=f):p[E]=this.renderer.emptyTextures[E]}for(f++,E=0;E<this.currentIndex;++E){var P=o[E];b=P._texture.baseTexture;var O=l.premultiplyBlendMode[Number(b.premultipliedAlpha)][P.blendMode];if(A!==O&&(A=O,x=null,_=e,f++),x!==b&&(x=b,b._enabled!==f)){if(_===e&&(f++,S.size=E-S.start,_=0,(S=a[w++]).blend=A,S.textureCount=0,S.start=E),b.touched=g,-1===b._virtalBoundId)for(var N=0;N<e;++N){var L=(N+m)%e,I=p[L];if(I._enabled!==f){m++,I._virtalBoundId=-1,b._virtalBoundId=L,p[L]=b;break}}b._enabled=f,S.textureCount++,S.ids[_]=b._virtalBoundId,S.textures[_++]=b}if(T=P.vertexData,M=P._texture._uvs.uvsUint32,this.renderer.roundPixels){var R=this.renderer.resolution;s[y]=(T[0]*R|0)/R,s[y+1]=(T[1]*R|0)/R,s[y+5]=(T[2]*R|0)/R,s[y+6]=(T[3]*R|0)/R,s[y+10]=(T[4]*R|0)/R,s[y+11]=(T[5]*R|0)/R,s[y+15]=(T[6]*R|0)/R,s[y+16]=(T[7]*R|0)/R}else s[y]=T[0],s[y+1]=T[1],s[y+5]=T[2],s[y+6]=T[3],s[y+10]=T[4],s[y+11]=T[5],s[y+15]=T[6],s[y+16]=T[7];c[y+2]=M[0],c[y+7]=M[1],c[y+12]=M[2],c[y+17]=M[3];var D=Math.min(P.worldAlpha,1),F=D<1&&b.premultipliedAlpha?(0,l.premultiplyTint)(P._tintRGB,D):P._tintRGB+(255*D<<24);c[y+3]=c[y+8]=c[y+13]=c[y+18]=F,s[y+4]=s[y+9]=s[y+14]=s[y+19]=b._virtalBoundId,y+=20}if(S.size=E-S.start,u.default.CAN_UPLOAD_SAME_BUFFER)this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!0);else{if(this.vaoMax<=this.vertexCount){this.vaoMax++;var U=this.shader.attributes,k=this.vertexBuffers[this.vertexCount]=h.default.GLBuffer.createVertexBuffer(t,null,t.STREAM_DRAW),j=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(k,U.aVertexPosition,t.FLOAT,!1,this.vertByteSize,0).addAttribute(k,U.aTextureCoord,t.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(k,U.aColor,t.UNSIGNED_BYTE,!0,this.vertByteSize,12);U.aTextureId&&j.addAttribute(k,U.aTextureId,t.FLOAT,!1,this.vertByteSize,16),this.vaos[this.vertexCount]=j}this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!1),this.vertexCount++}for(E=0;E<e;++E)v[E]._virtalBoundId=-1;for(E=0;E<w;++E){for(var B=a[E],z=B.textureCount,V=0;V<z;V++)v[B.ids[V]]!==(x=B.textures[V])&&this.renderer.bindTexture(x,B.ids[V],!0),x._virtalBoundId=-1;this.renderer.state.setBlendMode(B.blend),t.drawElements(t.TRIANGLES,6*B.size,t.UNSIGNED_SHORT,6*B.start*2)}this.currentIndex=0}},e.prototype.start=function(){this.renderer.bindShader(this.shader),u.default.CAN_UPLOAD_SAME_BUFFER&&(this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].bind())},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this.vaoMax;e++)this.vertexBuffers[e]&&this.vertexBuffers[e].destroy(),this.vaos[e]&&this.vaos[e].destroy();this.indexBuffer&&this.indexBuffer.destroy(),this.renderer.off("prerender",this.onPrerender,this),t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null;for(var n=0;n<this.buffers.length;++n)this.buffers[n].destroy()},e}(r.default);e.default=v,i.default.registerPlugin("sprite",v)},1:function(t,e){},"13Cv":function(t,e,n){"use strict";e.__esModule=!0,e.default=function(){return function(t,e){var n=t.name+"_image";if(t.data&&t.type===i.Resource.TYPE.JSON&&t.data.frames&&!this.resources[n]){var r={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},o=s(t,this.baseUrl);this.add(n,o,r,function(n){if(n.error)e(n.error);else{var r=new a.Spritesheet(n.texture.baseTexture,t.data,t.url);r.parse(function(){t.spritesheet=r,t.textures=r.textures,e()})}})}else e()}},e.getResourcePath=s;var r,i=n("SMx8"),o=(r=n("UZ5h"))&&r.__esModule?r:{default:r},a=n("/B0E");function s(t,e){return t.isDataUrl?t.data.meta.image:o.default.resolve(t.url.replace(e,""),t.data.meta.image)}},"1Bqh":function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("TToO"),i=function(t){function e(e,n){t.call(this),this.subject=e,this.subscriber=n,this.closed=!1}return Object(r.c)(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(n("VwZZ").a)},"1Q68":function(t,e,n){"use strict";e.a=function(t){return t&&"function"==typeof t.schedule}},"1g9v":function(t,e,n){"use strict";e.__esModule=!0;var r=i(n("KFrc"));function i(t){return t&&t.__esModule?t:{default:t}}var o=function(t){function e(n,i){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=null;if(!(n instanceof r.default)){var a=arguments[1],s=arguments[2],c=arguments[3],u=arguments[4];console.warn("Please use RenderTexture.create("+a+", "+s+") instead of the ctor directly."),o=arguments[0],i=null,n=new r.default(a,s,c,u)}var l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,i));return l.legacyRenderer=o,l.valid=!0,l._updateUvs(),l}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e,n){t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,n||this.baseTexture.resize(t,e),this._updateUvs()},e.create=function(t,n,i,o){return new e(new r.default(t,n,i,o))},e}(i(n("qD+0")).default);e.default=o},"1nuA":function(t,e,n){"use strict";e.decode=e.parse=n("kMPS"),e.encode=e.stringify=n("xaZU")},"27Ej":function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),i=new r.Rectangle,o=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,e.extract=this}return t.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},t.prototype.base64=function(t){return this.canvas(t).toDataURL()},t.prototype.canvas=function(t){var e=this.renderer,n=void 0,o=void 0,a=void 0,s=!1,c=void 0,u=!1;t&&(t instanceof r.RenderTexture?c=t:(c=this.renderer.generateTexture(t),u=!0)),c?(o=(n=c.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,a=c.frame,s=!1):(o=(n=this.renderer.rootRenderTarget).resolution,s=!0,(a=i).width=n.size.width,a.height=n.size.height);var l=a.width*o,h=a.height*o,d=new r.CanvasRenderTarget(l,h);if(n){e.bindRenderTarget(n);var p=new Uint8Array(4*l*h),f=e.gl;f.readPixels(a.x*o,a.y*o,l,h,f.RGBA,f.UNSIGNED_BYTE,p);var m=d.context.getImageData(0,0,l,h);m.data.set(p),d.context.putImageData(m,0,0),s&&(d.context.scale(1,-1),d.context.drawImage(d.canvas,0,-h))}return u&&c.destroy(!0),d.canvas},t.prototype.pixels=function(t){var e=this.renderer,n=void 0,o=void 0,a=void 0,s=void 0,c=!1;t&&(t instanceof r.RenderTexture?s=t:(s=this.renderer.generateTexture(t),c=!0)),s?(o=(n=s.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,a=s.frame):(o=(n=this.renderer.rootRenderTarget).resolution,(a=i).width=n.size.width,a.height=n.size.height);var u=a.width*o,l=a.height*o,h=new Uint8Array(4*u*l);if(n){e.bindRenderTarget(n);var d=e.gl;d.readPixels(a.x*o,a.y*o,u,l,d.RGBA,d.UNSIGNED_BYTE,h)}return c&&s.destroy(!0),h},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t}();e.default=o,r.WebGLRenderer.registerPlugin("extract",o)},"2fqX":function(t,e,n){"use strict";Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1})},"2gBs":function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}},"38rC":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=c(n("kFAI")),a=n("aH6o"),s=c(n("/MUw"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return i._textWidth=0,i._textHeight=0,i._glyphs=[],i._font={tint:void 0!==r.tint?r.tint:16777215,align:r.align||"left",name:null,size:0},i.font=r.font,i._text=n,i._maxWidth=0,i._maxLineHeight=0,i._anchor=new o.default(function(){i.dirty=!0},i,0,0),i.dirty=!1,i.updateText(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateText=function(){for(var t=e.fonts[this._font.name],n=this._font.size/t.size,r=new i.Point,o=[],a=[],s=null,c=0,u=0,l=0,h=-1,d=0,p=0,f=0,m=0;m<this.text.length;m++){var v=this.text.charCodeAt(m);if(/(\s)/.test(this.text.charAt(m))&&(h=m,d=c),/(?:\r\n|\r|\n)/.test(this.text.charAt(m)))a.push(c),u=Math.max(u,c),l++,r.x=0,r.y+=t.lineHeight,s=null;else if(-1!==h&&this._maxWidth>0&&r.x*n>this._maxWidth)i.utils.removeItems(o,h-p,m-h),m=h,h=-1,++p,a.push(d),u=Math.max(u,d),l++,r.x=0,r.y+=t.lineHeight,s=null;else{var g=t.chars[v];g&&(s&&g.kerning[s]&&(r.x+=g.kerning[s]),o.push({texture:g.texture,line:l,charCode:v,position:new i.Point(r.x+g.xOffset,r.y+g.yOffset)}),c=r.x+(g.texture.width+g.xOffset),r.x+=g.xAdvance,f=Math.max(f,g.yOffset+g.texture.height),s=v)}}a.push(c),u=Math.max(u,c);for(var y=[],b=0;b<=l;b++){var x=0;"right"===this._font.align?x=u-a[b]:"center"===this._font.align&&(x=(u-a[b])/2),y.push(x)}for(var w=o.length,_=this.tint,S=0;S<w;S++){var T=this._glyphs[S];T?T.texture=o[S].texture:(T=new i.Sprite(o[S].texture),this._glyphs.push(T)),T.position.x=(o[S].position.x+y[o[S].line])*n,T.position.y=o[S].position.y*n,T.scale.x=T.scale.y=n,T.tint=_,T.parent||this.addChild(T)}for(var M=w;M<this._glyphs.length;++M)this.removeChild(this._glyphs[M]);if(this._textWidth=u*n,this._textHeight=(r.y+t.lineHeight)*n,0!==this.anchor.x||0!==this.anchor.y)for(var A=0;A<w;A++)this._glyphs[A].x-=this._textWidth*this.anchor.x,this._glyphs[A].y-=this._textHeight*this.anchor.y;this._maxLineHeight=f*n},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},e.registerFont=function(t,n){var r={},o=t.getElementsByTagName("info")[0],c=t.getElementsByTagName("common")[0],u=t.getElementsByTagName("page")[0].getAttribute("file"),l=(0,a.getResolutionOfUrl)(u,s.default.RESOLUTION);r.font=o.getAttribute("face"),r.size=parseInt(o.getAttribute("size"),10),r.lineHeight=parseInt(c.getAttribute("lineHeight"),10)/l,r.chars={};for(var h=t.getElementsByTagName("char"),d=0;d<h.length;d++){var p=h[d],f=parseInt(p.getAttribute("id"),10),m=new i.Rectangle(parseInt(p.getAttribute("x"),10)/l+n.frame.x/l,parseInt(p.getAttribute("y"),10)/l+n.frame.y/l,parseInt(p.getAttribute("width"),10)/l,parseInt(p.getAttribute("height"),10)/l);r.chars[f]={xOffset:parseInt(p.getAttribute("xoffset"),10)/l,yOffset:parseInt(p.getAttribute("yoffset"),10)/l,xAdvance:parseInt(p.getAttribute("xadvance"),10)/l,kerning:{},texture:new i.Texture(n.baseTexture,m)}}for(var v=t.getElementsByTagName("kerning"),g=0;g<v.length;g++){var y=v[g],b=parseInt(y.getAttribute("first"),10)/l,x=parseInt(y.getAttribute("second"),10)/l,w=parseInt(y.getAttribute("amount"),10)/l;r.chars[x]&&(r.chars[x].kerning[b]=w)}return e.fonts[r.font]=r,r},r(e,[{key:"tint",get:function(){return this._font.tint},set:function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0}},{key:"align",get:function(){return this._font.align},set:function(t){this._font.align=t||"left",this.dirty=!0}},{key:"anchor",get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copy(t)}},{key:"font",get:function(){return this._font},set:function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):e.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)}},{key:"text",get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}},{key:"maxLineHeight",get:function(){return this.validate(),this._maxLineHeight}},{key:"textWidth",get:function(){return this.validate(),this._textWidth}},{key:"textHeight",get:function(){return this.validate(),this._textHeight}}]),e}(i.Container);e.default=u,u.fonts={}},"3AVc":function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),i=n("FjAT");n("o/zv");var o=new r.Matrix,a=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.shader=null,r.simpleShader=null,r.quad=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.shader=new r.Shader(t,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"),this.simpleShader=new r.Shader(t,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"),this.renderer.bindVao(null),this.quad=new r.Quad(t,this.renderer.state.attribState),this.quad.initVao(this.shader)},e.prototype.render=function(t){var e=this.renderer,n=this.quad;e.bindVao(n.vao);var a=n.vertices;a[0]=a[6]=t._width*-t.anchor.x,a[1]=a[3]=t._height*-t.anchor.y,a[2]=a[4]=t._width*(1-t.anchor.x),a[5]=a[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((a=n.uvs)[0]=a[6]=-t.anchor.x,a[1]=a[3]=-t.anchor.y,a[2]=a[4]=1-t.anchor.x,a[5]=a[7]=1-t.anchor.y),n.upload();var s=t._texture,c=s.baseTexture,u=t.tileTransform.localTransform,l=t.uvTransform,h=c.isPowerOfTwo&&s.frame.width===c.width&&s.frame.height===c.height;h&&(c._glTextures[e.CONTEXT_UID]?h=c.wrapMode!==i.WRAP_MODES.CLAMP:c.wrapMode===i.WRAP_MODES.CLAMP&&(c.wrapMode=i.WRAP_MODES.REPEAT));var d=h?this.simpleShader:this.shader;e.bindShader(d);var p=s.width,f=s.height,m=t._width,v=t._height;o.set(u.a*p/m,u.b*p/v,u.c*f/m,u.d*f/v,u.tx/m,u.ty/v),o.invert(),h?o.prepend(l.mapCoord):(d.uniforms.uMapCoord=l.mapCoord.toArray(!0),d.uniforms.uClampFrame=l.uClampFrame,d.uniforms.uClampOffset=l.uClampOffset),d.uniforms.uTransform=o.toArray(!0),d.uniforms.uColor=r.utils.premultiplyTintToRgba(t.tint,t.worldAlpha,d.uniforms.uColor,c.premultipliedAlpha),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=e.bindTexture(s),e.setBlendMode(r.utils.correctBlendMode(t.blendMode,c.premultipliedAlpha)),n.vao.draw(this.renderer.gl.TRIANGLES,6,0)},e}(r.ObjectRenderer);e.default=a,r.WebGLRenderer.registerPlugin("tilingSprite",a)},"3IRH":function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},"3JLa":function(t,e){var n={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};t.exports=function(t){return n[t]}},"3Wvr":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=h(n("BzvE")),o=n("FjAT"),a=h(n("/MUw")),s=h(n("qisP")),c=h(n("W1MY")),u=h(n("F+P4")),l=n("Q5/2");function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this)),r=a.default.TRANSFORM_MODE===o.TRANSFORM_MODE.STATIC?s.default:c.default;return n.tempDisplayObjectParent=null,n.transform=new r,n.alpha=1,n.visible=!0,n.renderable=!0,n.parent=null,n.worldAlpha=1,n.filterArea=null,n._filters=null,n._enabledFilters=null,n._bounds=new u.default,n._boundsID=0,n._lastBoundsID=-1,n._boundsRect=null,n._localBoundsRect=null,n._mask=null,n._destroyed=!1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),e||(this._boundsRect||(this._boundsRect=new l.Rectangle),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){var e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new l.Rectangle),t=this._localBoundsRect);var r=this.getBounds(!1,t);return this.parent=n,this.transform=e,r},e.prototype.toGlobal=function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)},e.prototype.renderWebGL=function(t){},e.prototype.renderCanvas=function(t){},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.position.x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this.position.y=t,this.scale.x=e||1,this.scale.y=n||1,this.rotation=r,this.skew.x=i,this.skew.y=o,this.pivot.x=a,this.pivot.y=s,this},e.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},r(e,[{key:"_tempDisplayObjectParent",get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new e),this.tempDisplayObjectParent}},{key:"x",get:function(){return this.position.x},set:function(t){this.transform.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.transform.position.y=t}},{key:"worldTransform",get:function(){return this.transform.worldTransform}},{key:"localTransform",get:function(){return this.transform.localTransform}},{key:"position",get:function(){return this.transform.position},set:function(t){this.transform.position.copy(t)}},{key:"scale",get:function(){return this.transform.scale},set:function(t){this.transform.scale.copy(t)}},{key:"pivot",get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copy(t)}},{key:"skew",get:function(){return this.transform.skew},set:function(t){this.transform.skew.copy(t)}},{key:"rotation",get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t}},{key:"worldVisible",get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}},{key:"mask",get:function(){return this._mask},set:function(t){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)}},{key:"filters",get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}]),e}(i.default);e.default=d,d.prototype.displayObjectUpdateTransform=d.prototype.updateTransform},"3a3m":function(t,e,n){"use strict";e.a=function(){return function(t){return Object(i.a)()(Object(r.a)(a)(t))}};var r=n("Jwyl"),i=n("0P3J"),o=n("g5jc");function a(){return new o.b}},"3psj":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.renderer.on("context",this.onContextChange,this)}return t.prototype.onContextChange=function(){},t.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null},t}();e.default=r},"4LTl":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(e,n,r,i,o,a,s,c,u){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.text=e,this.style=n,this.width=r,this.height=i,this.lines=o,this.lineWidths=a,this.lineHeight=s,this.maxLineWidth=c,this.fontProperties=u}return t.measureText=function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t._canvas;r=r||n.wordWrap;var o=n.toFontString(),a=t.measureFont(o),s=i.getContext("2d");s.font=o;for(var c=(r?t.wordWrap(e,n,i):e).split(/(?:\r\n|\r|\n)/),u=new Array(c.length),l=0,h=0;h<c.length;h++){var d=s.measureText(c[h]).width+(c[h].length-1)*n.letterSpacing;u[h]=d,l=Math.max(l,d)}var p=l+n.strokeThickness;n.dropShadow&&(p+=n.dropShadowDistance);var f=n.lineHeight||a.fontSize+n.strokeThickness,m=Math.max(f,a.fontSize+n.strokeThickness)+(c.length-1)*(f+n.leading);return n.dropShadow&&(m+=n.dropShadowDistance),new t(e,n,p,m,c,u,f+n.leading,l,a)},t.wordWrap=function(e,n){for(var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t._canvas).getContext("2d"),i="",o=0,a="",s={},c=n.letterSpacing,u=n.wordWrapWidth+n.letterSpacing,l=t.getFromCache(" ",c,s,r),h=e.split(" "),d=0;d<h.length;d++){var p=h[d],f=t.getFromCache(p,c,s,r);if(f>u)if(n.breakWords)for(var m=(i.length>0?" "+p:p).split(""),v=0;v<m.length;v++){var g=m[v],y=t.getFromCache(g,c,s,r);y+o>u&&(a+=t.addLine(i),i="",o=0),i+=g,o+=y}else i.length>0&&(a+=t.addLine(i),i="",o=0),a+=t.addLine(p),i="",o=0;else f+o>u&&(a+=t.addLine(i),i="",o=0),i+=i.length>0?" "+p:p,o+=f+l}return a+t.addLine(i,!1)},t.addLine=function(t){return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?t:t+"\n"},t.getFromCache=function(t,e,n,r){var i=n[t];if(void 0===i){var o=t.length*e;i=r.measureText(t).width+o,n[t]=i}return i},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var n={},r=t._canvas,i=t._context;i.font=e;var o=Math.ceil(i.measureText("|M\xc9q").width),a=Math.ceil(i.measureText("M").width),s=2*a;a=1.4*a|0,r.width=o,r.height=s,i.fillStyle="#f00",i.fillRect(0,0,o,s),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|M\xc9q",0,a);var c=i.getImageData(0,0,o,s).data,u=c.length,l=4*o,h=0,d=0,p=!1;for(h=0;h<a;++h){for(var f=0;f<l;f+=4)if(255!==c[d+f]){p=!0;break}if(p)break;d+=l}for(n.ascent=a-h,d=u-l,p=!1,h=s;h>a;--h){for(var m=0;m<l;m+=4)if(255!==c[d+m]){p=!0;break}if(p)break;d-=l}return n.descent=h-a,n.fontSize=n.ascent+n.descent,t._fonts[e]=n,n},t}();e.default=r;var i=document.createElement("canvas");i.width=i.height=10,r._canvas=i,r._context=i.getContext("2d"),r._fonts={}},"4Nog":function(t,e,n){"use strict";e.__esModule=!0;var r=f(n("dtlK")),i=f(n("1g9v")),o=f(n("qD+0")),a=f(n("Z1wJ")),s=f(n("izXE")),c=n("Q5/2"),u=n("aH6o"),l=n("FjAT"),h=f(n("F+P4")),d=f(n("icz7")),p=f(n("5tzz"));function f(t){return t&&t.__esModule?t:{default:t}}var m=void 0,v=new c.Matrix,g=new c.Point,y=new Float32Array(4),b=new Float32Array(4),x=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.fillAlpha=1,r.lineWidth=0,r.nativeLines=n,r.lineColor=0,r.graphicsData=[],r.tint=16777215,r._prevTint=16777215,r.blendMode=l.BLEND_MODES.NORMAL,r.currentPath=null,r._webGL={},r.isMask=!1,r.boundsPadding=0,r._localBounds=new h.default,r.dirty=0,r.fastRectDirty=-1,r.clearDirty=0,r.boundsDirty=-1,r.cachedSpriteDirty=!1,r._spriteRect=null,r._fastRect=!1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.clone=function(){var t=new e;t.renderable=this.renderable,t.fillAlpha=this.fillAlpha,t.lineWidth=this.lineWidth,t.lineColor=this.lineColor,t.tint=this.tint,t.blendMode=this.blendMode,t.isMask=this.isMask,t.boundsPadding=this.boundsPadding,t.dirty=0,t.cachedSpriteDirty=this.cachedSpriteDirty;for(var n=0;n<this.graphicsData.length;++n)t.graphicsData.push(this.graphicsData[n].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t.updateLocalBounds(),t},e.prototype.lineStyle=function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.lineWidth=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this.lineColor=t,this.lineAlpha=e,this.currentPath)if(this.currentPath.shape.points.length){var n=new c.Polygon(this.currentPath.shape.points.slice(-2));n.closed=!1,this.drawShape(n)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},e.prototype.moveTo=function(t,e){var n=new c.Polygon([t,e]);return n.closed=!1,this.drawShape(n),this},e.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty++,this},e.prototype.quadraticCurveTo=function(t,e,n,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var i=this.currentPath.shape.points,o=0,a=0;0===i.length&&this.moveTo(0,0);for(var s=i[i.length-2],c=i[i.length-1],u=1;u<=20;++u){var l=u/20;i.push((o=s+(t-s)*l)+(t+(n-t)*l-o)*l,(a=c+(e-c)*l)+(e+(r-e)*l-a)*l)}return this.dirty++,this},e.prototype.bezierCurveTo=function(t,e,n,r,i,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var a=this.currentPath.shape.points,s=a[a.length-2],c=a[a.length-1];return a.length-=2,(0,d.default)(s,c,t,e,n,r,i,o,a),this.dirty++,this},e.prototype.arcTo=function(t,e,n,r,i){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var o=this.currentPath.shape.points,a=o[o.length-1]-e,s=o[o.length-2]-t,c=r-e,u=n-t,l=Math.abs(a*u-s*c);if(l<1e-8||0===i)o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e);else{var h=a*a+s*s,d=c*c+u*u,p=a*c+s*u,f=i*Math.sqrt(h)/l,m=i*Math.sqrt(d)/l,v=f*p/h,g=m*p/d,y=f*u+m*s,b=f*c+m*a,x=u*(f+g),w=c*(f+g),_=Math.atan2(a*(m+v)-b,s*(m+v)-y),S=Math.atan2(w-b,x-y);this.arc(y+t,b+e,i,_,S,s*c>u*a)}return this.dirty++,this},e.prototype.arc=function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(r===i)return this;!o&&i<=r?i+=l.PI_2:o&&r<=i&&(r+=l.PI_2);var a=i-r,s=40*Math.ceil(Math.abs(a)/l.PI_2);if(0===a)return this;var c=t+Math.cos(r)*n,u=e+Math.sin(r)*n,h=this.currentPath?this.currentPath.shape.points:null;h?h[h.length-2]===c&&h[h.length-1]===u||h.push(c,u):(this.moveTo(c,u),h=this.currentPath.shape.points);for(var d=a/(2*s),p=2*d,f=Math.cos(d),m=Math.sin(d),v=s-1,g=v%1/v,y=0;y<=v;++y){var b=d+r+p*(y+g*y),x=Math.cos(b),w=-Math.sin(b);h.push((f*x+m*w)*n+t,(f*-w+m*x)*n+e)}return this.dirty++,this},e.prototype.beginFill=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.filling=!0,this.fillColor=t,this.fillAlpha=e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},e.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},e.prototype.drawRect=function(t,e,n,r){return this.drawShape(new c.Rectangle(t,e,n,r)),this},e.prototype.drawRoundedRect=function(t,e,n,r,i){return this.drawShape(new c.RoundedRectangle(t,e,n,r,i)),this},e.prototype.drawCircle=function(t,e,n){return this.drawShape(new c.Circle(t,e,n)),this},e.prototype.drawEllipse=function(t,e,n,r){return this.drawShape(new c.Ellipse(t,e,n,r)),this},e.prototype.drawPolygon=function(t){var e=t,n=!0;if(e instanceof c.Polygon&&(n=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(var r=0;r<e.length;++r)e[r]=arguments[r]}var i=new c.Polygon(e);return i.closed=n,this.drawShape(i),this},e.prototype.drawStar=function(t,e,n,r,i){i=i||r/2;for(var o=-1*Math.PI/2+(arguments.length>5&&void 0!==arguments[5]?arguments[5]:0),a=2*n,s=l.PI_2/a,c=[],u=0;u<a;u++){var h=u%2?i:r,d=u*s+o;c.push(t+h*Math.cos(d),e+h*Math.sin(d))}return this.drawPolygon(c)},e.prototype.clear=function(){return(this.lineWidth||this.filling||this.graphicsData.length>0)&&(this.lineWidth=0,this.filling=!1,this.boundsDirty=-1,this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this._spriteRect=null,this},e.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===l.SHAPES.RECT&&!this.graphicsData[0].lineWidth},e.prototype._renderWebGL=function(t){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect()),this._fastRect?this._renderSpriteRect(t):(t.setObjectRenderer(t.plugins.graphics),t.plugins.graphics.render(this))},e.prototype._renderSpriteRect=function(t){var e=this.graphicsData[0].shape;this._spriteRect||(this._spriteRect=new s.default(new o.default(o.default.WHITE)));var n=this._spriteRect;if(16777215===this.tint)n.tint=this.graphicsData[0].fillColor;else{var r=y,i=b;(0,u.hex2rgb)(this.graphicsData[0].fillColor,r),(0,u.hex2rgb)(this.tint,i),r[0]*=i[0],r[1]*=i[1],r[2]*=i[2],n.tint=(0,u.rgb2hex)(r)}n.alpha=this.graphicsData[0].fillAlpha,n.worldAlpha=this.worldAlpha*n.alpha,n.blendMode=this.blendMode,n._texture._frame.width=e.width,n._texture._frame.height=e.height,n.transform.worldTransform=this.transform.worldTransform,n.anchor.set(-e.x/e.width,-e.y/e.height),n._onAnchorUpdate(),n._renderWebGL(t)},e.prototype._renderCanvas=function(t){!0!==this.isMask&&t.plugins.graphics.render(this)},e.prototype._calculateBounds=function(){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.cachedSpriteDirty=!0);var t=this._localBounds;this._bounds.addFrame(this.transform,t.minX,t.minY,t.maxX,t.maxY)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,g);for(var e=this.graphicsData,n=0;n<e.length;++n){var r=e[n];if(r.fill&&r.shape&&r.shape.contains(g.x,g.y)){if(r.holes)for(var i=0;i<r.holes.length;i++)if(r.holes[i].contains(g.x,g.y))return!1;return!0}}return!1},e.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,n=1/0,r=-1/0;if(this.graphicsData.length)for(var i=0,o=0,a=0,s=0,c=0,u=0;u<this.graphicsData.length;u++){var h=this.graphicsData[u],d=h.type,p=h.lineWidth;if(i=h.shape,d===l.SHAPES.RECT||d===l.SHAPES.RREC)a=i.y-p/2,s=i.width+p,c=i.height+p,t=(o=i.x-p/2)<t?o:t,e=o+s>e?o+s:e,n=a<n?a:n,r=a+c>r?a+c:r;else if(d===l.SHAPES.CIRC)a=i.y,c=i.radius+p/2,t=(o=i.x)-(s=i.radius+p/2)<t?o-s:t,e=o+s>e?o+s:e,n=a-c<n?a-c:n,r=a+c>r?a+c:r;else if(d===l.SHAPES.ELIP)a=i.y,c=i.height+p/2,t=(o=i.x)-(s=i.width+p/2)<t?o-s:t,e=o+s>e?o+s:e,n=a-c<n?a-c:n,r=a+c>r?a+c:r;else for(var f=i.points,m=0,v=0,g=0,y=0,b=0,x=0,w=0,_=0,S=0;S+2<f.length;S+=2)o=f[S],a=f[S+1],m=f[S+2],v=f[S+3],g=Math.abs(m-o),y=Math.abs(v-a),c=p,(s=Math.sqrt(g*g+y*y))<1e-9||(x=(c/s*g+y)/2,_=(v+a)/2,t=(w=(m+o)/2)-(b=(c/s*y+g)/2)<t?w-b:t,e=w+b>e?w+b:e,n=_-x<n?_-x:n,r=_+x>r?_+x:r)}else t=0,e=0,n=0,r=0;var T=this.boundsPadding;this._localBounds.minX=t-T,this._localBounds.maxX=e+T,this._localBounds.minY=n-T,this._localBounds.maxY=r+T},e.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new a.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,t);return this.graphicsData.push(e),e.type===l.SHAPES.POLY&&(e.shape.closed=e.shape.closed||this.filling,this.currentPath=e),this.dirty++,e},e.prototype.generateCanvasTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.getLocalBounds(),r=i.default.create(n.width,n.height,t,e);m||(m=new p.default),this.transform.updateLocalTransform(),this.transform.localTransform.copy(v),v.invert(),v.tx-=n.x,v.ty-=n.y,m.render(this,r,!0,v);var a=o.default.fromCanvas(r.baseTexture._canvasRenderTarget.canvas,t,"graphics");return a.baseTexture.resolution=e,a.baseTexture.update(),a},e.prototype.closePath=function(){var t=this.currentPath;return t&&t.shape&&t.shape.close(),this},e.prototype.addHole=function(){var t=this.graphicsData.pop();return this.currentPath=this.graphicsData[this.graphicsData.length-1],this.currentPath.addHole(t.shape),this.currentPath=null,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e);for(var n=0;n<this.graphicsData.length;++n)this.graphicsData[n].destroy();for(var r in this._webgl)for(var i=0;i<this._webgl[r].data.length;++i)this._webgl[r].data[i].destroy();this._spriteRect&&this._spriteRect.destroy(),this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null},e}(r.default);e.default=x,x._SPRITE_TEXTURE=null},"5+9/":function(t,e,n){var r=n("ZOjo"),i=n("gVZZ"),o=n("ElvI"),a=n("QamB"),s=n("9rXv"),c=n("Fy0/")("engine.io-client:polling");t.exports=l;var u=null!=new(n("P2cu"))({xdomain:!1}).responseType;function l(t){u&&!(t&&t.forceBase64)||(this.supportsBinary=!1),r.call(this,t)}a(l,r),l.prototype.name="polling",l.prototype.doOpen=function(){this.poll()},l.prototype.pause=function(t){var e=this;function n(){c("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){c("pre-pause polling complete"),--r||n()})),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",function(){c("pre-pause writing complete"),--r||n()}))}else n()},l.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},l.prototype.onData=function(t){var e=this;c("polling got data %s",t),o.decodePayload(t,this.socket.binaryType,function(t,n,r){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},l.prototype.doClose=function(){var t=this;function e(){c("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),e()):(c("transport not open - deferring close"),this.once("open",e))},l.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};o.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},l.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=s()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t}},"5+KW":function(t,e,n){(function(e){var r=n("sOR5"),i=Object.prototype.toString,o="function"==typeof e.Blob||"[object BlobConstructor]"===i.call(e.Blob),a="function"==typeof e.File||"[object FileConstructor]"===i.call(e.File);t.exports=function t(n){if(!n||"object"!=typeof n)return!1;if(r(n)){for(var i=0,s=n.length;i<s;i++)if(t(n[i]))return!0;return!1}if("function"==typeof e.Buffer&&e.Buffer.isBuffer&&e.Buffer.isBuffer(n)||"function"==typeof e.ArrayBuffer&&n instanceof ArrayBuffer||o&&n instanceof Blob||a&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return t(n.toJSON(),!0);for(var c in n)if(Object.prototype.hasOwnProperty.call(n,c)&&t(n[c]))return!0;return!1}}).call(e,n("DuR2"))},"50uv":function(t,e,n){"use strict";(function(t){e.__esModule=!0,e.loader=e.prepare=e.particles=e.mesh=e.loaders=e.interaction=e.filters=e.extras=e.extract=e.accessibility=void 0;var r=n("cv0E");Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})});var i=n("/B0E");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o,a=(o=n("slDu"))&&o.__esModule?o:{default:o},s=v(n("kEDM")),c=v(n("+MIv")),u=v(n("PMti")),l=v(n("d8XH")),h=v(n("LGVh")),d=v(n("gVev")),p=v(n("B13k")),f=v(n("9bEX")),m=v(n("QyjV"));function v(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}i.utils.mixins.performMixins();var g=d.shared||null;e.accessibility=s,e.extract=c,e.extras=u,e.filters=l,e.interaction=h,e.loaders=d,e.mesh=p,e.particles=f,e.prepare=m,e.loader=g,"function"==typeof a.default&&(0,a.default)(e),t.PIXI=e}).call(e,n("DuR2"))},"5Ljx":function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){for(var e=r[t],n=e.length,o=i,a="",s=void 0,c=0;c<t;c++){var u="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",c);s=c,c>=n&&(s=t-c-1),a+=u=u.replace("%value%",e[s]),a+="\n"}return(o=o.replace("%blur%",a)).replace("%size%",t)};var r={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},i=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n")},"5XUO":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n("oUe4"),o=u(n("dtlK")),a=n("z1Av"),s=u(n("/MUw")),c=n("FjAT");function u(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,r,c,u){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),"number"==typeof e&&(e=Object.assign({width:e,height:n||s.default.RENDER_OPTIONS.height,forceCanvas:!!c,sharedTicker:!!u},r)),this._options=e=Object.assign({autoStart:!0,sharedTicker:!1,forceCanvas:!1,sharedLoader:!1},e),this.renderer=(0,i.autoDetectRenderer)(e),this.stage=new o.default,this._ticker=null,this.ticker=e.sharedTicker?a.shared:new a.Ticker,e.autoStart&&this.start()}return t.prototype.render=function(){this.renderer.render(this.stage)},t.prototype.stop=function(){this._ticker.stop()},t.prototype.start=function(){this._ticker.start()},t.prototype.destroy=function(t){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}this.stage.destroy(),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},r(t,[{key:"ticker",set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,c.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}},{key:"view",get:function(){return this.renderer.view}},{key:"screen",get:function(){return this.renderer.screen}}]),t}();e.default=l},"5tzz":function(t,e,n){"use strict";e.__esModule=!0;var r=l(n("PjB0")),i=l(n("UsJC")),o=l(n("vwuV")),a=l(n("Q/rl")),s=n("aH6o"),c=n("FjAT"),u=l(n("/MUw"));function l(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(n,r,o){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"Canvas",n,r,o));return s.type=c.RENDERER_TYPE.CANVAS,s.rootContext=s.view.getContext("2d",{alpha:s.transparent}),s.context=s.rootContext,s.refresh=!0,s.maskManager=new i.default(s),s.smoothProperty="imageSmoothingEnabled",s.rootContext.imageSmoothingEnabled||(s.rootContext.webkitImageSmoothingEnabled?s.smoothProperty="webkitImageSmoothingEnabled":s.rootContext.mozImageSmoothingEnabled?s.smoothProperty="mozImageSmoothingEnabled":s.rootContext.oImageSmoothingEnabled?s.smoothProperty="oImageSmoothingEnabled":s.rootContext.msImageSmoothingEnabled&&(s.smoothProperty="msImageSmoothingEnabled")),s.initPlugins(),s.blendModes=(0,a.default)(),s._activeBlendMode=null,s.renderingToScreen=!1,s.resize(s.options.width,s.options.height),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.render=function(t,e,n,r,i){if(this.view){this.renderingToScreen=!e,this.emit("prerender");var a=this.resolution;e?((e=e.baseTexture||e)._canvasRenderTarget||(e._canvasRenderTarget=new o.default(e.width,e.height,e.resolution),e.source=e._canvasRenderTarget.canvas,e.valid=!0),this.context=e._canvasRenderTarget.context,this.resolution=e._canvasRenderTarget.resolution):this.context=this.rootContext;var s=this.context;if(e||(this._lastObjectRendered=t),!i){var u=t.parent,l=this._tempDisplayObjectParent.transform.worldTransform;r?(r.copy(l),this._tempDisplayObjectParent.transform._worldID=-1):l.identity(),t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=u}s.save(),s.setTransform(1,0,0,1,0,0),s.globalAlpha=1,this._activeBlendMode=c.BLEND_MODES.NORMAL,s.globalCompositeOperation=this.blendModes[c.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(s.fillStyle="black",s.clear()),(void 0!==n?n:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?s.clearRect(0,0,this.width,this.height):(s.fillStyle=this._backgroundColorString,s.fillRect(0,0,this.width,this.height)));var h=this.context;this.context=s,t.renderCanvas(this),this.context=h,s.restore(),this.resolution=a,this.emit("postrender")}},e.prototype.clear=function(t){var e=this.context;t=t||this._backgroundColorString,!this.transparent&&t?(e.fillStyle=t,e.fillRect(0,0,this.width,this.height)):e.clearRect(0,0,this.width,this.height)},e.prototype.setBlendMode=function(t){this._activeBlendMode!==t&&(this._activeBlendMode=t,this.context.globalCompositeOperation=this.blendModes[t])},e.prototype.destroy=function(e){this.destroyPlugins(),t.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},e.prototype.resize=function(e,n){t.prototype.resize.call(this,e,n),this.smoothProperty&&(this.rootContext[this.smoothProperty]=u.default.SCALE_MODE===c.SCALE_MODES.LINEAR)},e.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},e}(r.default);e.default=h,s.pluginTarget.mixin(h)},"66C6":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=a(n("tOxb")),o=a(n("bva0"));function a(t){return t&&t.__esModule?t:{default:t}}var s=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),c=null;function u(){}var l=function(){function t(e,n,r){if(function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),"string"!=typeof e||"string"!=typeof n)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===n.indexOf("data:")),this.name=e,this.url=n,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=u,this._onLoadBinding=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this),this.onStart=new o.default,this.onProgress=new o.default,this.onComplete=new o.default,this.onAfterMiddleware=new o.default}return t.setExtensionLoadType=function(e,n){h(t._loadTypeMap,e,n)},t.setExtensionXhrType=function(e,n){h(t._xhrTypeMap,e,n)},t.prototype.complete=function(){if(this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}},t.prototype.load=function(e){var n=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout(function(){return e(n)},1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:s&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t.prototype._hasFlag=function(t){return!!(this._flags&t)},t.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},t.prototype._loadElement=function(t){this.data=this.metadata.loadElement?this.metadata.loadElement:"image"===t&&"undefined"!=typeof window.Image?new Image:document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},t.prototype._loadSourceElement=function(t){if(this.data=this.metadata.loadElement?this.metadata.loadElement:"audio"===t&&"undefined"!=typeof window.Audio?new Audio:document.createElement(t),null!==this.data){if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,n=0;n<this.url.length;++n)this.data.appendChild(this._createSource(t,this.url[n],Array.isArray(e)?e[n]:e));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()}else this.abort("Unsupported element: "+t)},t.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.responseType=this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?t.XHR_RESPONSE_TYPE.TEXT:this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXdrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},t.prototype._createSource=function(t,e,n){n||(n=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=n,r},t.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},t.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},t.prototype._xhrOnError=function(){var t=this.xhr;this.abort(d(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},t.prototype._xhrOnAbort=function(){this.abort(d(this.xhr)+" Request was aborted by the user.")},t.prototype._xdrOnTimeout=function(){this.abort(d(this.xhr)+" Request timed out.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,n="",r="undefined"==typeof e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&"undefined"!=typeof e.responseType||(n=e.responseText),0===r&&(n.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2==(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=n,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(n),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(n,"text/xml")}else{var o=document.createElement("div");o.innerHTML=n,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||n;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},t.prototype._determineCrossOrigin=function(t,e){return 0===t.indexOf("data:")?"":(e=e||window.location,c||(c=document.createElement("a")),c.href=t,(t=(0,i.default)(c.href,{strictMode:!0})).host!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||(t.protocol?t.protocol+":":"")!==e.protocol?"anonymous":"")},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var n=t.indexOf("/");e=t.substring(n+1,t.indexOf(";",n))}else{var r=t.indexOf("?"),i=t.indexOf("#"),o=Math.min(r>-1?r:t.length,i>-1?i:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},r(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function h(t,e,n){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=n)}function d(t){return t.toString().replace("object ","")}e.default=l,l.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},l.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},l.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},l.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},l._loadTypeMap={gif:l.LOAD_TYPE.IMAGE,png:l.LOAD_TYPE.IMAGE,bmp:l.LOAD_TYPE.IMAGE,jpg:l.LOAD_TYPE.IMAGE,jpeg:l.LOAD_TYPE.IMAGE,tif:l.LOAD_TYPE.IMAGE,tiff:l.LOAD_TYPE.IMAGE,webp:l.LOAD_TYPE.IMAGE,tga:l.LOAD_TYPE.IMAGE,svg:l.LOAD_TYPE.IMAGE,"svg+xml":l.LOAD_TYPE.IMAGE,mp3:l.LOAD_TYPE.AUDIO,ogg:l.LOAD_TYPE.AUDIO,wav:l.LOAD_TYPE.AUDIO,mp4:l.LOAD_TYPE.VIDEO,webm:l.LOAD_TYPE.VIDEO},l._xhrTypeMap={xhtml:l.XHR_RESPONSE_TYPE.DOCUMENT,html:l.XHR_RESPONSE_TYPE.DOCUMENT,htm:l.XHR_RESPONSE_TYPE.DOCUMENT,xml:l.XHR_RESPONSE_TYPE.DOCUMENT,tmx:l.XHR_RESPONSE_TYPE.DOCUMENT,svg:l.XHR_RESPONSE_TYPE.DOCUMENT,tsx:l.XHR_RESPONSE_TYPE.DOCUMENT,gif:l.XHR_RESPONSE_TYPE.BLOB,png:l.XHR_RESPONSE_TYPE.BLOB,bmp:l.XHR_RESPONSE_TYPE.BLOB,jpg:l.XHR_RESPONSE_TYPE.BLOB,jpeg:l.XHR_RESPONSE_TYPE.BLOB,tif:l.XHR_RESPONSE_TYPE.BLOB,tiff:l.XHR_RESPONSE_TYPE.BLOB,webp:l.XHR_RESPONSE_TYPE.BLOB,tga:l.XHR_RESPONSE_TYPE.BLOB,json:l.XHR_RESPONSE_TYPE.JSON,text:l.XHR_RESPONSE_TYPE.TEXT,txt:l.XHR_RESPONSE_TYPE.TEXT,ttf:l.XHR_RESPONSE_TYPE.BUFFER,otf:l.XHR_RESPONSE_TYPE.BUFFER},l.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},"6Lyv":function(t,e,n){"use strict";var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E"));r.DisplayObject.prototype.name=null,r.Container.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null}},"6Pue":function(t,e,n){"use strict";e.__esModule=!0;var r=u(n("SMx8")),i=n("gxtk"),o=u(n("BzvE")),a=u(n("nfXk")),s=u(n("13Cv")),c=u(n("j9EU"));function u(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(n,r){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,r));o.default.call(i);for(var a=0;a<e._pixiMiddleware.length;++a)i.use(e._pixiMiddleware[a]());return i.onStart.add(function(t){return i.emit("start",t)}),i.onProgress.add(function(t,e){return i.emit("progress",t,e)}),i.onError.add(function(t,e,n){return i.emit("error",t,e,n)}),i.onLoad.add(function(t,e){return i.emit("load",t,e)}),i.onComplete.add(function(t,e){return i.emit("complete",t,e)}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.addPixiMiddleware=function(t){e._pixiMiddleware.push(t)},e.prototype.destroy=function(){this.removeAllListeners(),this.reset()},e}(r.default);for(var h in e.default=l,o.default.prototype)l.prototype[h]=o.default.prototype[h];l._pixiMiddleware=[i.blobMiddlewareFactory,a.default,s.default,c.default];var d=r.default.Resource;d.setExtensionXhrType("fnt",d.XHR_RESPONSE_TYPE.DOCUMENT)},"6mly":function(t,e,n){(function(e){var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),i=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}();function o(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}t[e]=r}}}t.exports=r?i?e.Blob:function(t,e){return o(t),new Blob(t,e||{})}:n&&n.prototype.append&&n.prototype.getBlob?function(t,e){e=e||{};var r=new n;o(t);for(var i=0;i<t.length;i++)r.append(t[i]);return e.type?r.getBlob(e.type):r.getBlob()}:void 0}).call(e,n("DuR2"))},"6nzH":function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("kpDK"))&&r.__esModule?r:{default:r},o=function(t){function e(n,r,o){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return a._ready=!0,a.verticesX=r||10,a.verticesY=o||10,a.drawMode=i.default.DRAW_MODES.TRIANGLES,a.refresh(),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._refresh=function(){for(var t=this._texture,e=this.verticesX*this.verticesY,n=[],r=[],i=[],o=this.verticesX-1,a=this.verticesY-1,s=t.width/o,c=t.height/a,u=0;u<e;u++){var l=u%this.verticesX,h=u/this.verticesX|0;n.push(l*s,h*c),r.push(l/o,h/a)}for(var d=o*a,p=0;p<d;p++){var f=p%o,m=p/o|0,v=m*this.verticesX+f+1,g=(m+1)*this.verticesX+f,y=(m+1)*this.verticesX+f+1;i.push(m*this.verticesX+f,v,g),i.push(v,y,g)}this.vertices=new Float32Array(n),this.uvs=new Float32Array(r),this.colors=new Float32Array([]),this.indices=new Uint16Array(i),this.dirty++,this.indexDirty++,this.multiplyUvs()},e.prototype._onTextureUpdate=function(){i.default.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},e}(i.default);e.default=o},"7F6j":function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("zFUS"))&&r.__esModule?r:{default:r},o=n("FjAT"),a=function(){function t(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),Array.isArray(n[0])&&(n=n[0]),n[0]instanceof i.default){for(var a=[],s=0,c=n.length;s<c;s++)a.push(n[s].x,n[s].y);n=a}this.closed=!0,this.points=n,this.type=o.SHAPES.POLY}return t.prototype.clone=function(){return new t(this.points.slice())},t.prototype.close=function(){var t=this.points;t[0]===t[t.length-2]&&t[1]===t[t.length-1]||t.push(t[0],t[1])},t.prototype.contains=function(t,e){for(var n=!1,r=this.points.length/2,i=0,o=r-1;i<r;o=i++){var a=this.points[2*i],s=this.points[2*i+1],c=this.points[2*o+1];s>e!=c>e&&t<(e-s)/(c-s)*(this.points[2*o]-a)+a&&(n=!n)}return n},t}();e.default=a},"7IZn":function(t,e,n){var r=n("NZvU"),i=n("3JLa"),o=function(t,e,n,r){gl.vertexAttribPointer(this.location,this.size,t||gl.FLOAT,e||!1,n||0,r||0)};t.exports=function(t,e){for(var n={},a=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s=0;s<a;s++){var c=t.getActiveAttrib(e,s),u=r(t,c.type);n[c.name]={type:u,size:i(u),location:t.getAttribLocation(e,c.name),pointer:o}}return n}},"7VTH":function(t,e,n){"use strict";e.__esModule=!0,e.encodeBinary=function(t){for(var e="",n=0;n<t.length;){for(var i=[0,0,0],o=[0,0,0,0],a=0;a<i.length;++a)i[a]=n<t.length?255&t.charCodeAt(n++):0;switch(o[0]=i[0]>>2,o[1]=(3&i[0])<<4|i[1]>>4,o[2]=(15&i[1])<<2|i[2]>>6,o[3]=63&i[2],n-(t.length-1)){case 2:o[3]=64,o[2]=64;break;case 1:o[3]=64}for(var s=0;s<o.length;++s)e+=r.charAt(o[s])}return e};var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},"8D5t":function(t,e,n){"use strict";e.a=function(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),Object(r.a)(i.a,null,t)};var r=n("Qnch"),i=n("lAP5")},"8QNu":function(t,e,n){var r={createContext:n("/brp"),setVertexAttribArrays:n("/9A/"),GLBuffer:n("bBNR"),GLFramebuffer:n("U7Sr"),GLShader:n("Q5o8"),GLTexture:n("Q+pJ"),VertexArrayObject:n("Cvg1"),shader:n("rW72")};"undefined"!=typeof t&&t.exports&&(t.exports=r),"undefined"!=typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=r)},"8USZ":function(t,e,n){"use strict";e.__esModule=!0;var r=n("aH6o"),i=c(n("/MUw")),o=c(n("BzvE")),a=c(n("h9yw")),s=c(n("eWjs"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(n,o,a){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return s.uid=(0,r.uid)(),s.touched=0,s.resolution=a||i.default.RESOLUTION,s.width=100,s.height=100,s.realWidth=100,s.realHeight=100,s.scaleMode=void 0!==o?o:i.default.SCALE_MODE,s.hasLoaded=!1,s.isLoading=!1,s.source=null,s.origSource=null,s.imageType=null,s.sourceScale=1,s.premultipliedAlpha=!0,s.imageUrl=null,s.isPowerOfTwo=!1,s.mipmap=i.default.MIPMAP_TEXTURES,s.wrapMode=i.default.WRAP_MODE,s._glTextures={},s._enabled=0,s._virtalBoundId=-1,s._destroyed=!1,s.textureCacheIds=[],n&&s.loadSource(n),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.update=function(){"svg"!==this.imageType&&(this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height,this._updateDimensions()),this.emit("update",this)},e.prototype._updateDimensions=function(){this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=s.default.isPow2(this.realWidth)&&s.default.isPow2(this.realHeight)},e.prototype.loadSource=function(t){var e=this.isLoading;this.hasLoaded=!1,this.isLoading=!1,e&&this.source&&(this.source.onload=null,this.source.onerror=null);var n=!this.source;if(this.source=t,(t.src&&t.complete||t.getContext)&&t.width&&t.height)this._updateImageType(),"svg"===this.imageType?this._loadSvgSource():this._sourceLoaded(),n&&this.emit("loaded",this);else if(!t.getContext){this.isLoading=!0;var r=this;if(t.onload=function(){r._updateImageType(),t.onload=null,t.onerror=null,r.isLoading&&(r.isLoading=!1,r._sourceLoaded(),"svg"!==r.imageType?r.emit("loaded",r):r._loadSvgSource())},t.onerror=function(){t.onload=null,t.onerror=null,r.isLoading&&(r.isLoading=!1,r.emit("error",r))},t.complete&&t.src){if(t.onload=null,t.onerror=null,"svg"===r.imageType)return void r._loadSvgSource();this.isLoading=!1,t.width&&t.height?(this._sourceLoaded(),e&&this.emit("loaded",this)):e&&this.emit("error",this)}}},e.prototype._updateImageType=function(){if(this.imageUrl){var t=(0,r.decomposeDataUri)(this.imageUrl),e=void 0;if(t&&"image"===t.mediaType){var n=t.subType.split("+")[0];if(!(e=(0,r.getUrlFileExtension)("."+n)))throw new Error("Invalid image type in data URI.")}else(e=(0,r.getUrlFileExtension)(this.imageUrl))||(e="png");this.imageType=e}},e.prototype._loadSvgSource=function(){if("svg"===this.imageType){var t=(0,r.decomposeDataUri)(this.imageUrl);t?this._loadSvgSourceUsingDataUri(t):this._loadSvgSourceUsingXhr()}},e.prototype._loadSvgSourceUsingDataUri=function(t){var e=void 0;if("base64"===t.encoding){if(!atob)throw new Error("Your browser doesn't support base64 conversions.");e=atob(t.data)}else e=t.data;this._loadSvgSourceUsingString(e)},e.prototype._loadSvgSourceUsingXhr=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){if(e.readyState!==e.DONE||200!==e.status)throw new Error("Failed to load SVG using XHR.");t._loadSvgSourceUsingString(e.response)},e.onerror=function(){return t.emit("error",t)},e.open("GET",this.imageUrl,!0),e.send()},e.prototype._loadSvgSourceUsingString=function(t){var n=(0,r.getSvgSize)(t),i=n.width,o=n.height;if(!i||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");this.realWidth=Math.round(i*this.sourceScale),this.realHeight=Math.round(o*this.sourceScale),this._updateDimensions();var a=document.createElement("canvas");a.width=this.realWidth,a.height=this.realHeight,a._pixiId="canvas_"+(0,r.uid)(),a.getContext("2d").drawImage(this.source,0,0,i,o,0,0,this.realWidth,this.realHeight),this.origSource=this.source,this.source=a,e.addToCache(this,a._pixiId),this.isLoading=!1,this._sourceLoaded(),this.emit("loaded",this)},e.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},e.prototype.destroy=function(){this.imageUrl&&(delete r.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")),this.source=null,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this._destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.updateSourceImage=function(t){this.source.src=t,this.loadSource(this.source)},e.fromImage=function(t,n,i,o){var s=r.BaseTextureCache[t];if(!s){var c=new Image;void 0===n&&0!==t.indexOf("data:")?c.crossOrigin=(0,a.default)(t):n&&(c.crossOrigin="string"==typeof n?n:"anonymous"),(s=new e(c,i)).imageUrl=t,o&&(s.sourceScale=o),s.resolution=(0,r.getResolutionOfUrl)(t),c.src=t,e.addToCache(s,t)}return s},e.fromCanvas=function(t,n){t._pixiId||(t._pixiId=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas")+"_"+(0,r.uid)());var i=r.BaseTextureCache[t._pixiId];return i||(i=new e(t,n),e.addToCache(i,t._pixiId)),i},e.from=function(t,n,i){if("string"==typeof t)return e.fromImage(t,void 0,n,i);if(t instanceof HTMLImageElement){var o=t.src,a=r.BaseTextureCache[o];return a||((a=new e(t,n)).imageUrl=o,i&&(a.sourceScale=i),a.resolution=(0,r.getResolutionOfUrl)(o),e.addToCache(a,o)),a}return t instanceof HTMLCanvasElement?e.fromCanvas(t,n):t},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),r.BaseTextureCache[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),r.BaseTextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=r.BaseTextureCache[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete r.BaseTextureCache[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)delete r.BaseTextureCache[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},e}(o.default);e.default=u},"8ZQA":function(t,e,n){"use strict";e.__esModule=!0;var r=n("aH6o"),i=n("FjAT"),o=p(n("MIKO")),a=p(n("qo3d")),s=p(n("Twrw")),c=p(n("d5OP")),u=p(n("RZRe")),l=p(n("giQI")),h=p(n("SBy4")),d=p(n("ngSy"));function p(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.graphicsDataPool=[],r.primitiveShader=null,r.gl=n.gl,r.CONTEXT_UID=0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.primitiveShader=new c.default(this.gl)},e.prototype.destroy=function(){o.default.prototype.destroy.call(this);for(var t=0;t<this.graphicsDataPool.length;++t)this.graphicsDataPool[t].destroy();this.graphicsDataPool=null},e.prototype.render=function(t){var e=this.renderer,n=e.gl,i=void 0,o=t._webGL[this.CONTEXT_UID];o&&t.dirty===o.dirty||(this.updateGraphics(t),o=t._webGL[this.CONTEXT_UID]),e.bindShader(this.primitiveShader),e.state.setBlendMode(t.blendMode);for(var a=0,s=o.data.length;a<s;a++){var c=(i=o.data[a]).shader;e.bindShader(c),c.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),c.uniforms.tint=(0,r.hex2rgb)(t.tint),c.uniforms.alpha=t.worldAlpha,e.bindVao(i.vao),i.nativeLines?n.drawArrays(n.LINES,0,i.points.length/6):i.vao.draw(n.TRIANGLE_STRIP,i.indices.length)}},e.prototype.updateGraphics=function(t){var e=t._webGL[this.CONTEXT_UID];if(e||(e=t._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:this.renderer.gl,clearDirty:-1,dirty:-1}),e.dirty=t.dirty,t.clearDirty!==e.clearDirty){e.clearDirty=t.clearDirty;for(var n=0;n<e.data.length;n++)this.graphicsDataPool.push(e.data[n]);e.data.length=0,e.lastIndex=0}for(var r=void 0,o=void 0,a=e.lastIndex;a<t.graphicsData.length;a++){var s=t.graphicsData[a];r=this.getWebGLData(e,0),s.nativeLines&&s.lineWidth&&(o=this.getWebGLData(e,0,!0),e.lastIndex++),s.type===i.SHAPES.POLY&&(0,u.default)(s,r,o),s.type===i.SHAPES.RECT?(0,l.default)(s,r,o):s.type===i.SHAPES.CIRC||s.type===i.SHAPES.ELIP?(0,d.default)(s,r,o):s.type===i.SHAPES.RREC&&(0,h.default)(s,r,o),e.lastIndex++}this.renderer.bindVao(null);for(var c=0;c<e.data.length;c++)(r=e.data[c]).dirty&&r.upload()},e.prototype.getWebGLData=function(t,e,n){var r=t.data[t.data.length-1];return(!r||r.nativeLines!==n||r.points.length>32e4)&&((r=this.graphicsDataPool.pop()||new s.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState)).nativeLines=n,r.reset(e),t.data.push(r)),r.dirty=!0,r},e}(o.default);e.default=f,a.default.registerPlugin("graphics",f)},"8o49":function(t,e,n){"use strict";e.__esModule=!0;var r,i=n("FjAT"),o=(r=n("/MUw"))&&r.__esModule?r:{default:r},a=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=o.default.GC_MAX_IDLE,this.checkCountMax=o.default.GC_MAX_CHECK_COUNT,this.mode=o.default.GC_MODE}return t.prototype.update=function(){this.count++,this.mode!==i.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},t.prototype.run=function(){for(var t=this.renderer.textureManager,e=t._managedTextures,n=!1,r=0;r<e.length;r++){var i=e[r];!i._glRenderTargets&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){for(var o=0,a=0;a<e.length;a++)null!==e[a]&&(e[o++]=e[a]);e.length=o}},t.prototype.unload=function(t){t._texture&&t._texture._glRenderTargets&&this.renderer.textureManager.destroyTexture(t._texture,!0);for(var e=t.children.length-1;e>=0;e--)this.unload(t.children[e])},t}();e.default=a},"9GXS":function(t,e,n){"use strict";(function(t){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!t.performance||!t.performance.now){var e=Date.now();t.performance||(t.performance={}),t.performance.now=function(){return Date.now()-e}}for(var n=Date.now(),r=["ms","moz","webkit","o"],i=0;i<r.length&&!t.requestAnimationFrame;++i){var o=r[i];t.requestAnimationFrame=t[o+"RequestAnimationFrame"],t.cancelAnimationFrame=t[o+"CancelAnimationFrame"]||t[o+"CancelRequestAnimationFrame"]}t.requestAnimationFrame||(t.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),r=16+n-e;return r<0&&(r=0),n=e,setTimeout(function(){n=Date.now(),t(performance.now())},r)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){return clearTimeout(t)})}).call(e,n("DuR2"))},"9bEX":function(t,e,n){"use strict";e.__esModule=!0;var r=n("RjLg");Object.defineProperty(e,"ParticleContainer",{enumerable:!0,get:function(){return o(r).default}});var i=n("TlGl");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"ParticleRenderer",{enumerable:!0,get:function(){return o(i).default}})},"9rXv":function(t,e,n){"use strict";var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,a={},s=0,c=0;function u(t){var e="";do{e=i[t%o]+e,t=Math.floor(t/o)}while(t>0);return e}function l(){var t=u(+new Date);return t!==r?(s=0,r=t):t+"."+u(s++)}for(;c<o;c++)a[i[c]]=c;l.encode=u,l.decode=function(t){var e=0;for(c=0;c<t.length;c++)e=e*o+a[t.charAt(c)];return e},t.exports=l},AM6m:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=p(n("izXE")),o=p(n("qD+0")),a=n("Q5/2"),s=n("aH6o"),c=n("FjAT"),u=p(n("/MUw")),l=p(n("UxPA")),h=p(n("4LTl")),d=p(n("jwA5"));function p(t){return t&&t.__esModule?t:{default:t}}var f={texture:!0,children:!1,baseTexture:!0},m=function(t){function e(n,r,i){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=i||document.createElement("canvas")).width=3,i.height=3;var s=o.default.fromCanvas(i,u.default.SCALE_MODE,"text");s.orig=new a.Rectangle,s.trim=new a.Rectangle;var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,s));return o.default.addToCache(c._texture,c._texture.baseTexture.textureCacheIds[0]),c.canvas=i,c.context=c.canvas.getContext("2d"),c.resolution=u.default.RESOLUTION,c._text=null,c._style=null,c._styleListener=null,c._font="",c.text=n,c.style=r,c.localStyleID=-1,c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var n=this.context,r=h.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas),i=r.height,o=r.lines,a=r.lineHeight,s=r.lineWidths,c=r.maxLineWidth,u=r.fontProperties;this.canvas.width=Math.ceil((Math.max(1,r.width)+2*e.padding)*this.resolution),this.canvas.height=Math.ceil((Math.max(1,i)+2*e.padding)*this.resolution),n.scale(this.resolution,this.resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.strokeStyle=e.stroke,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;var l=void 0,d=void 0;if(e.dropShadow){n.fillStyle=e.dropShadowColor,n.globalAlpha=e.dropShadowAlpha,n.shadowBlur=e.dropShadowBlur,e.dropShadowBlur>0&&(n.shadowColor=e.dropShadowColor);for(var p=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,f=Math.sin(e.dropShadowAngle)*e.dropShadowDistance,m=0;m<o.length;m++)l=e.strokeThickness/2,d=e.strokeThickness/2+m*a+u.ascent,"right"===e.align?l+=c-s[m]:"center"===e.align&&(l+=(c-s[m])/2),e.fill&&(this.drawLetterSpacing(o[m],l+p+e.padding,d+f+e.padding),e.stroke&&e.strokeThickness&&(n.strokeStyle=e.dropShadowColor,this.drawLetterSpacing(o[m],l+p+e.padding,d+f+e.padding,!0),n.strokeStyle=e.stroke))}n.shadowBlur=0,n.globalAlpha=1,n.fillStyle=this._generateFillStyle(e,o);for(var v=0;v<o.length;v++)l=e.strokeThickness/2,d=e.strokeThickness/2+v*a+u.ascent,"right"===e.align?l+=c-s[v]:"center"===e.align&&(l+=(c-s[v])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[v],l+e.padding,d+e.padding,!0),e.fill&&this.drawLetterSpacing(o[v],l+e.padding,d+e.padding);this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this._style.letterSpacing;if(0!==i)for(var o=String.prototype.split.call(t,""),a=e,s=0,c="";s<t.length;)c=o[s++],r?this.context.strokeText(c,a,n):this.context.fillText(c,a,n),a+=this.context.measureText(c).width+i;else r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=(0,d.default)(t);t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0)}var n=this._texture,r=this._style,i=r.trim?0:r.padding,o=n.baseTexture;o.hasLoaded=!0,o.resolution=this.resolution,o.realWidth=t.width,o.realHeight=t.height,o.width=t.width/this.resolution,o.height=t.height/this.resolution,n.trim.width=n._frame.width=t.width/this.resolution,n.trim.height=n._frame.height=t.height/this.resolution,n.trim.x=-i,n.trim.y=-i,n.orig.width=n._frame.width-2*i,n.orig.height=n._frame.height-2*i,this._onTextureUpdate(),o.emit("update",o),this.dirty=!1},e.prototype.renderWebGL=function(e){this.resolution!==e.resolution&&(this.resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype.renderWebGL.call(this,e)},e.prototype._renderCanvas=function(e){this.resolution!==e.resolution&&(this.resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._renderCanvas.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._onStyleChange=function(){this.dirty=!0},e.prototype._generateFillStyle=function(t,e){if(!Array.isArray(t.fill))return t.fill;if(navigator.isCocoonJS)return t.fill[0];var n=void 0,r=void 0,i=void 0,o=this.canvas.width/this.resolution,a=this.canvas.height/this.resolution,s=t.fill.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var l=s.length+1,h=1;h<l;++h)u.push(h/l);if(s.unshift(t.fill[0]),u.unshift(0),s.push(t.fill[t.fill.length-1]),u.push(1),t.fillGradientType===c.TEXT_GRADIENT.LINEAR_VERTICAL){n=this.context.createLinearGradient(o/2,0,o/2,a),r=(s.length+1)*e.length,i=0;for(var d=0;d<e.length;d++){i+=1;for(var p=0;p<s.length;p++)n.addColorStop("number"==typeof u[p]?u[p]/e.length+d/e.length:i/r,s[p]),i++}}else{n=this.context.createLinearGradient(0,a/2,o,a/2),r=s.length+1,i=1;for(var f=0;f<s.length;f++)n.addColorStop("number"==typeof u[f]?u[f]:i/r,s[f]),i++}return n},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},f,e),t.prototype.destroy.call(this,e),this.context=null,this.canvas=null,this._style=null},r(e,[{key:"width",get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=(0,s.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=(0,s.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"style",get:function(){return this._style},set:function(t){this._style=(t=t||{})instanceof l.default?t:new l.default(t),this.localStyleID=-1,this.dirty=!0}},{key:"text",get:function(){return this._text},set:function(t){t=String(""===t||null===t||void 0===t?" ":t),this._text!==t&&(this._text=t,this.dirty=!0)}}]),e}(i.default);e.default=m},AMGY:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return o});var r="undefined"!=typeof window&&window,i="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,o=r||"undefined"!=typeof t&&t||i}).call(e,n("DuR2"))},AWov:function(t,e,n){"use strict";t.exports=function(t,e,n){var r,i=t.length;if(!(e>=i||0===n)){var o=i-(n=e+n>i?i-e:n);for(r=e;r<o;++r)t[r]=t[r+n];t.length=o}}},AYMf:function(t,e,n){var r=n("Xz3Q"),i=n("pnVU"),o=n("bqFq"),a=n("SJFm"),s=n("zqJT"),c=n("Fy0/")("socket.io-client:socket"),u=n("gVZZ"),l=n("5+KW");t.exports=p;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=i.prototype.emit;function p(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[a(t,"open",s(this,"onopen")),a(t,"packet",s(this,"onpacket")),a(t,"close",s(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var t=o(arguments);return t.unshift("message"),this.emit.apply(this,t),this},p.prototype.emit=function(t){if(h.hasOwnProperty(t))return d.apply(this,arguments),this;var e=o(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:l(e))?r.BINARY_EVENT:r.EVENT,data:e,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},p.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},p.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?u.encode(this.query):this.query;c("sending connect packet with query %s",t),this.packet({type:r.CONNECT,query:t})}else this.packet({type:r.CONNECT})},p.prototype.onclose=function(t){c("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},p.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(t);break;case r.ACK:case r.BINARY_ACK:this.onack(t);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",t.data)}},p.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e),null!=t.id&&(c("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?d.apply(this,e):this.receiveBuffer.push(e)},p.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var i=o(arguments);c("sending ack %j",i),e.packet({type:l(i)?r.BINARY_ACK:r.ACK,id:t,data:i})}}},p.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(c("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):c("bad ack %s",t.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)d.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(t){return this.flags.compress=t,this},p.prototype.binary=function(t){return this.flags.binary=t,this}},B13k:function(t,e,n){"use strict";e.__esModule=!0;var r=n("kpDK");Object.defineProperty(e,"Mesh",{enumerable:!0,get:function(){return u(r).default}});var i=n("XkNl");Object.defineProperty(e,"MeshRenderer",{enumerable:!0,get:function(){return u(i).default}});var o=n("mImb");Object.defineProperty(e,"CanvasMeshRenderer",{enumerable:!0,get:function(){return u(o).default}});var a=n("6nzH");Object.defineProperty(e,"Plane",{enumerable:!0,get:function(){return u(a).default}});var s=n("qC7s");Object.defineProperty(e,"NineSlicePlane",{enumerable:!0,get:function(){return u(s).default}});var c=n("aRcS");function u(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Rope",{enumerable:!0,get:function(){return u(c).default}})},BEQ0:function(t,e,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,a,s=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))i.call(n,u)&&(s[u]=n[u]);if(r){a=r(n);for(var l=0;l<a.length;l++)o.call(n,a[l])&&(s[a[l]]=n[a[l]])}}return s}},BX3T:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=Array.isArray||function(t){return t&&"number"==typeof t.length}},BmFd:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E"));n("o/zv");var o=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));return r.alpha=n,r.glShaderKey="alpha",r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t}}]),e}(i.Filter);e.default=o},BzvE:function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),s.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},s.prototype.listeners=function(t,e){var n=this._events[i?i+t:t];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},s.prototype.emit=function(t,e,n,r,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,a),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,n);break;case 4:l[u].fn.call(l[u].context,e,n,r);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(t,e,n){var r=new a(e,n||this),o=i?i+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},s.prototype.once=function(t,e,n){var r=new a(e,n||this,!0),o=i?i+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},s.prototype.removeListener=function(t,e,n,r){var a=i?i+t:t;if(!this._events[a])return this;if(!e)return 0==--this._eventsCount?this._events=new o:delete this._events[a],this;var s=this._events[a];if(s.fn)s.fn!==e||r&&!s.once||n&&s.context!==n||(0==--this._eventsCount?this._events=new o:delete this._events[a]);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==e||r&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new o:delete this._events[a]}return this},s.prototype.removeAllListeners=function(t){var e;return t?this._events[e=i?i+t:t]&&(0==--this._eventsCount?this._events=new o:delete this._events[e]):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=i,s.EventEmitter=s,t.exports=s},Csua:function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}},Ctjl:function(t,e,n){var r=n("psuf"),i=n("AYMf"),o=n("pnVU"),a=n("Xz3Q"),s=n("SJFm"),c=n("zqJT"),u=n("Fy0/")("socket.io-client:manager"),l=n("Csua"),h=n("+lzb"),d=Object.prototype.hasOwnProperty;function p(t,e){if(!(this instanceof p))return new p(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||a;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=p,p.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)d.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},p.prototype.updateSocketIds=function(){for(var t in this.nsps)d.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},p.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},o(p.prototype),p.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},p.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},p.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(t,e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=r(this.uri,this.opts);var n=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=s(n,"open",function(){i.onopen(),t&&t()}),a=s(n,"error",function(e){if(u("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var l=setTimeout(function(){u("connect attempt timed out after %d",c),o.destroy(),n.close(),n.emit("error","timeout"),i.emitAll("connect_timeout",c)},c);this.subs.push({destroy:function(){clearTimeout(l)}})}return this.subs.push(o),this.subs.push(a),this},p.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(s(t,"data",c(this,"ondata"))),this.subs.push(s(t,"ping",c(this,"onping"))),this.subs.push(s(t,"pong",c(this,"onpong"))),this.subs.push(s(t,"error",c(this,"onerror"))),this.subs.push(s(t,"close",c(this,"onclose"))),this.subs.push(s(this.decoder,"decoded",c(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(t){this.decoder.add(t)},p.prototype.ondecoded=function(t){this.emit("packet",t)},p.prototype.onerror=function(t){u("error",t),this.emitAll("error",t)},p.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new i(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",o),n.on("connect",function(){n.id=r.generateId(t)}),this.autoConnect&&o()}function o(){~l(r.connecting,n)||r.connecting.push(n)}return n},p.prototype.destroy=function(t){var e=l(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},p.prototype.packet=function(t){u("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},p.prototype.cleanup=function(){u("cleanup");for(var t=this.subs.length,e=0;e<t;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(t){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();u("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(u("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(u("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(u("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},p.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},Cvg1:function(t,e,n){var r=n("/9A/");function i(t,e){if(this.nativeVaoExtension=null,i.FORCE_NATIVE||(this.nativeVaoExtension=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object")),this.nativeState=e,this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var n=t.getParameter(t.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(n),attribState:new Array(n)}}this.gl=t,this.attributes=[],this.indexBuffer=null,this.dirty=!1}i.prototype.constructor=i,t.exports=i,i.FORCE_NATIVE=!1,i.prototype.bind=function(){if(this.nativeVao){if(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty)return this.dirty=!1,this.activate(),this;this.indexBuffer&&this.indexBuffer.bind()}else this.activate();return this},i.prototype.unbind=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null),this},i.prototype.activate=function(){for(var t=this.gl,e=null,n=0;n<this.attributes.length;n++){var i=this.attributes[n];e!==i.buffer&&(i.buffer.bind(),e=i.buffer),t.vertexAttribPointer(i.attribute.location,i.attribute.size,i.type||t.FLOAT,i.normalized||!1,i.stride||0,i.start||0)}return r(t,this.attributes,this.nativeState),this.indexBuffer&&this.indexBuffer.bind(),this},i.prototype.addAttribute=function(t,e,n,r,i,o){return this.attributes.push({buffer:t,attribute:e,location:e.location,type:n||this.gl.FLOAT,normalized:r||!1,stride:i||0,start:o||0}),this.dirty=!0,this},i.prototype.addIndex=function(t){return this.indexBuffer=t,this.dirty=!0,this},i.prototype.clear=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.attributes.length=0,this.indexBuffer=null,this},i.prototype.draw=function(t,e,n){var r=this.gl;return this.indexBuffer?r.drawElements(t,e||this.indexBuffer.data.length,r.UNSIGNED_SHORT,2*(n||0)):r.drawArrays(t,n,e||this.getSize()),this},i.prototype.destroy=function(){this.gl=null,this.indexBuffer=null,this.attributes=null,this.nativeState=null,this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao),this.nativeVaoExtension=null,this.nativeVao=null},i.prototype.getSize=function(){var t=this.attributes[0];return t.buffer.data.length/(t.stride/4||t.attribute.size)}},DVpw:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),a=(r=n("NGfj"))&&r.__esModule?r:{default:r},s=new o.Point,c=function(t){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return a.tileTransform=new o.TransformStatic,a._width=r,a._height=i,a._canvasPattern=null,a.uvTransform=n.transform||new o.TextureMatrix(n),a.pluginName="tilingSprite",a.uvRespectAnchor=!1,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._onTextureUpdate=function(){this.uvTransform&&(this.uvTransform.texture=this._texture),this.cachedTint=16777215},e.prototype._renderWebGL=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.hasLoaded){var n=t.context,r=this.worldTransform,i=t.resolution,s=e.baseTexture,c=s.resolution,u=this.tilePosition.x/this.tileScale.x%e._frame.width*c,l=this.tilePosition.y/this.tileScale.y%e._frame.height*c;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var h=new o.CanvasRenderTarget(e._frame.width,e._frame.height,c);16777215!==this.tint?(this.tintedTexture=a.default.getTintedTexture(this,this.tint),h.context.drawImage(this.tintedTexture,0,0)):h.context.drawImage(s.source,-e._frame.x*c,-e._frame.y*c),this.cachedTint=this.tint,this._canvasPattern=h.context.createPattern(h.canvas,"repeat")}n.globalAlpha=this.worldAlpha,n.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i,r.ty*i),t.setBlendMode(this.blendMode),n.fillStyle=this._canvasPattern,n.scale(this.tileScale.x/c,this.tileScale.y/c);var d=this.anchor.x*-this._width,p=this.anchor.y*-this._height;this.uvRespectAnchor?(n.translate(u,l),n.fillRect(-u+d,-l+p,this._width/this.tileScale.x*c,this._height/this.tileScale.y*c)):(n.translate(u+d,l+p),n.fillRect(-u,-l,this._width/this.tileScale.x*c,this._height/this.tileScale.y*c))}},e.prototype._calculateBounds=function(){this._bounds.addFrame(this.transform,this._width*-this._anchor._x,this._height*-this._anchor._y,this._width*(1-this._anchor._x),this._height*(1-this._anchor._y))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._x),e||(this._localBoundsRect||(this._localBoundsRect=new o.Rectangle),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,s);var e=this._width,n=this._height,r=-e*this.anchor._x;if(s.x>=r&&s.x<r+e){var i=-n*this.anchor._y;if(s.y>=i&&s.y<i+n)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvTransform=null},e.from=function(t,n,r){return new e(o.Texture.from(t),n,r)},e.fromFrame=function(t,n,r){var i=o.utils.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new e(i,n,r)},e.fromImage=function(t,n,r,i,a){return new e(o.Texture.fromImage(t,i,a),n,r)},i(e,[{key:"clampMargin",get:function(){return this.uvTransform.clampMargin},set:function(t){this.uvTransform.clampMargin=t,this.uvTransform.update(!0)}},{key:"tileScale",get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copy(t)}},{key:"tilePosition",get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copy(t)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t}}]),e}(o.Sprite);e.default=c},DmT9:function(t,e,n){var r=n("V1mL"),i=n("Xz3Q"),o=n("Ctjl"),a=n("Fy0/")("socket.io-client");t.exports=e=c;var s=e.managers={};function c(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,i=r(t),c=i.source,u=i.id;return e.forceNew||e["force new connection"]||!1===e.multiplex||s[u]&&i.path in s[u].nsps?(a("ignoring socket cache for %s",c),n=o(c,e)):(s[u]||(a("new io instance for %s",c),s[u]=o(c,e)),n=s[u]),i.query&&!e.query&&(e.query=i.query),n.socket(i.path,e)}e.protocol=i.protocol,e.connect=c,e.Manager=n("Ctjl"),e.Socket=n("AYMf")},DuR2:function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},Dyrc:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(){return!(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))}},EN1B:function(t,e){},EarI:function(t,e){var n=1e3,r=6e4,i=36e5,o=24*i;function a(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var s,c=typeof t;if("string"===c&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(t);if("number"===c&&!1===isNaN(t))return e.long?a(s=t,o,"day")||a(s,i,"hour")||a(s,r,"minute")||a(s,n,"second")||s+" ms":function(t){return t>=o?Math.round(t/o)+"d":t>=i?Math.round(t/i)+"h":t>=r?Math.round(t/r)+"m":t>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},ElvI:function(t,e,n){(function(t){var r,i=n("2gBs"),o=n("5+KW"),a=n("Tff0"),s=n("YUmt"),c=n("eAwk");t&&t.ArrayBuffer&&(r=n("kVGU"));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),l="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),h=u||l;e.protocol=3;var d=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=i(d),f={type:"error",data:"parser error"},m=n("6mly");function v(t,e,n){for(var r=new Array(t.length),i=s(t.length,n),o=function(t,n,i){e(n,function(e,n){r[t]=n,i(e,r)})},a=0;a<t.length;a++)o(a,t[a],i)}e.encodePacket=function(n,r,i,o){"function"==typeof r&&(o=r,r=!1),"function"==typeof i&&(o=i,i=null);var a=void 0===n.data?void 0:n.data.buffer||n.data;if(t.ArrayBuffer&&a instanceof ArrayBuffer)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=t.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=d[t.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return r(a.buffer)}(n,r,o);if(m&&a instanceof t.Blob)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(h)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=new FileReader;return i.onload=function(){t.data=i.result,e.encodePacket(t,n,!0,r)},i.readAsArrayBuffer(t.data)}(t,n,r);var i=new Uint8Array(1);return i[0]=d[t.type],r(new m([i.buffer,t.data]))}(n,r,o);if(a&&a.base64)return function(t,n){return n("b"+e.packets[t.type]+t.data.data)}(n,o);var s=d[n.type];return void 0!==n.data&&(s+=i?c.encode(String(n.data),{strict:!1}):String(n.data)),o(""+s)},e.encodeBase64Packet=function(n,r){var i,o="b"+e.packets[n.type];if(m&&n.data instanceof t.Blob){var a=new FileReader;return a.onload=function(){var t=a.result.split(",")[1];r(o+t)},a.readAsDataURL(n.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(t){for(var s=new Uint8Array(n.data),c=new Array(s.length),u=0;u<s.length;u++)c[u]=s[u];i=String.fromCharCode.apply(null,c)}return o+=t.btoa(i),r(o)},e.decodePacket=function(t,n,r){if(void 0===t)return f;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(r&&!1===(t=function(t){try{t=c.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return f;var i=t.charAt(0);return Number(i)==i&&p[i]?t.length>1?{type:p[i],data:t.substring(1)}:{type:p[i]}:f}i=new Uint8Array(t)[0];var o=a(t,1);return m&&"blob"===n&&(o=new m([o])),{type:p[i],data:o}},e.decodeBase64Packet=function(t,e){var n=p[t.charAt(0)];if(!r)return{type:n,data:{base64:!0,data:t.substr(1)}};var i=r.decode(t.substr(1));return"blob"===e&&m&&(i=new m([i])),{type:n,data:i}},e.encodePayload=function(t,n,r){"function"==typeof n&&(r=n,n=null);var i=o(t);return n&&i?m&&!h?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r):t.length?void v(t,function(t,r){e.encodePacket(t,!!i&&n,!1,function(t){r(null,function(t){return t.length+":"+t}(t))})},function(t,e){return r(e.join(""))}):r("0:")},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===t)return r(f,0,1);for(var o,a,s="",c=0,u=t.length;c<u;c++){var l=t.charAt(c);if(":"===l){if(""===s||s!=(o=Number(s)))return r(f,0,1);if(s!=(a=t.substr(c+1,o)).length)return r(f,0,1);if(a.length){if(i=e.decodePacket(a,n,!1),f.type===i.type&&f.data===i.data)return r(f,0,1);if(!1===r(i,c+o,u))return}c+=o,s=""}else s+=l}return""!==s?r(f,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){if(!t.length)return n(new ArrayBuffer(0));v(t,function(t,n){e.encodePacket(t,!0,!0,function(t){return n(null,t)})},function(t,e){var r=e.reduce(function(t,e){var n;return t+(n="string"==typeof e?e.length:e.byteLength).toString().length+n+2},0),i=new Uint8Array(r),o=0;return e.forEach(function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);n=r.buffer}i[o++]=e?0:1;var s=n.byteLength.toString();for(a=0;a<s.length;a++)i[o++]=parseInt(s[a]);for(i[o++]=255,r=new Uint8Array(n),a=0;a<r.length;a++)i[o++]=r[a]}),n(i.buffer)})},e.encodePayloadAsBlob=function(t,n){v(t,function(t,n){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);t=r.buffer,e[0]=0}var o=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),a=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)a[i]=parseInt(o[i]);if(a[o.length]=255,m){var s=new m([e.buffer,a.buffer,t]);n(null,s)}})},function(t,e){return n(new m(e))})},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var i=t,o=[];i.byteLength>0;){for(var s=new Uint8Array(i),c=0===s[0],u="",l=1;255!==s[l];l++){if(u.length>310)return r(f,0,1);u+=s[l]}i=a(i,2+u.length),u=parseInt(u);var h=a(i,0,u);if(c)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var d=new Uint8Array(h);for(h="",l=0;l<d.length;l++)h+=String.fromCharCode(d[l])}o.push(h),i=a(i,u)}var p=o.length;o.forEach(function(t,i){r(e.decodePacket(t,n,!0),i,p)})}}).call(e,n("DuR2"))},EmDc:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.maxItemsPerFrame=e,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();e.default=r},EoU7:function(t,e,n){"use strict";e.__esModule=!0;var r,i=n("Q5/2"),o=n("FjAT"),a=(r=n("/MUw"))&&r.__esModule?r:{default:r},s=n("8QNu"),c=function(){function t(e,n,r,c,u,l){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.frameBuffer=null,this.texture=null,this.clearColor=[0,0,0,0],this.size=new i.Rectangle(0,0,1,1),this.resolution=u||a.default.RESOLUTION,this.projectionMatrix=new i.Matrix,this.transform=null,this.frame=null,this.defaultFrame=new i.Rectangle,this.destinationFrame=null,this.sourceFrame=null,this.stencilBuffer=null,this.stencilMaskStack=[],this.filterData=null,this.scaleMode=void 0!==c?c:a.default.SCALE_MODE,this.root=l,this.root?(this.frameBuffer=new s.GLFramebuffer(e,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=s.GLFramebuffer.createRGBA(e,100,100),this.scaleMode===o.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture),this.setFrame(),this.resize(n,r)}return t.prototype.clear=function(t){var e=t||this.clearColor;this.frameBuffer.clear(e[0],e[1],e[2],e[3])},t.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()},t.prototype.setFrame=function(t,e){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||this.destinationFrame},t.prototype.activate=function(){var t=this.gl;this.frameBuffer.bind(),this.calculateProjection(this.destinationFrame,this.sourceFrame),this.transform&&this.projectionMatrix.append(this.transform),this.destinationFrame!==this.sourceFrame?(t.enable(t.SCISSOR_TEST),t.scissor(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):t.disable(t.SCISSOR_TEST),t.viewport(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)},t.prototype.calculateProjection=function(t,e){var n=this.projectionMatrix;e=e||t,n.identity(),this.root?(n.a=1/t.width*2,n.d=-1/t.height*2,n.tx=-1-e.x*n.a,n.ty=1-e.y*n.d):(n.a=1/t.width*2,n.d=1/t.height*2,n.tx=-1-e.x*n.a,n.ty=-1-e.y*n.d)},t.prototype.resize=function(t,e){e|=0,(this.size.width!==(t|=0)||this.size.height!==e)&&(this.size.width=t,this.size.height=e,this.defaultFrame.width=t,this.defaultFrame.height=e,this.frameBuffer.resize(t*this.resolution,e*this.resolution),this.calculateProjection(this.frame||this.size))},t.prototype.destroy=function(){this.frameBuffer.destroy(),this.frameBuffer=null,this.texture=null},t}();e.default=c},"F+P4":function(t,e,n){"use strict";e.__esModule=!0;var r=n("Q5/2"),i=function(){function t(){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?r.Rectangle.EMPTY:((t=t||new r.Rectangle(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addQuad=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY,o=t[0],a=t[1];e=o<e?o:e,n=a<n?a:n,r=o>r?o:r,i=a>i?a:i,a=t[3],e=(o=t[2])<e?o:e,n=a<n?a:n,r=o>r?o:r,i=a>i?a:i,a=t[5],e=(o=t[4])<e?o:e,n=a<n?a:n,r=o>r?o:r,i=a>i?a:i,a=t[7],e=(o=t[6])<e?o:e,n=a<n?a:n,r=o>r?o:r,i=a>i?a:i,this.minX=e,this.minY=n,this.maxX=r,this.maxY=i},t.prototype.addFrame=function(t,e,n,r,i){var o=t.worldTransform,a=o.a,s=o.b,c=o.c,u=o.d,l=o.tx,h=o.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,v=a*e+c*n+l,g=s*e+u*n+h;d=v<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=s*r+u*n+h,d=(v=a*r+c*n+l)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=s*e+u*i+h,d=(v=a*e+c*i+l)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=s*r+u*i+h,d=(v=a*r+c*i+l)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},t.prototype.addVertices=function(t,e,n,r){for(var i=t.worldTransform,o=i.a,a=i.b,s=i.c,c=i.d,u=i.tx,l=i.ty,h=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=n;m<r;m+=2){var v=e[m],g=e[m+1],y=o*v+s*g+u,b=c*g+a*v+l;h=y<h?y:h,d=b<d?b:d,p=y>p?y:p,f=b>f?b:f}this.minX=h,this.minY=d,this.maxX=p,this.maxY=f},t.prototype.addBounds=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>i?t.maxY:i},t.prototype.addBoundsMask=function(t,e){var n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=i&&r<=o){var a=this.minX,s=this.minY,c=this.maxX,u=this.maxY;this.minX=n<a?n:a,this.minY=r<s?r:s,this.maxX=i>c?i:c,this.maxY=o>u?o:u}},t.prototype.addBoundsArea=function(t,e){var n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=i&&r<=o){var a=this.minX,s=this.minY,c=this.maxX,u=this.maxY;this.minX=n<a?n:a,this.minY=r<s?r:s,this.maxX=i>c?i:c,this.maxY=o>u?o:u}},t}();e.default=i},FH9r:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e,n){t.nativeLines?function(t,e){var r=0,o=t.points;if(0!==o.length){var a=n.points,s=o.length/2,c=(0,i.hex2rgb)(t.lineColor),u=t.lineAlpha,l=c[0]*u,h=c[1]*u,d=c[2]*u;for(r=1;r<s;r++){var p=o[2*r],f=o[2*r+1];a.push(o[2*(r-1)],o[2*(r-1)+1]),a.push(l,h,d,u),a.push(p,f),a.push(l,h,d,u)}}}(t):function(t,e){var n=t.points;if(0!==n.length){var o=new r.Point(n[0],n[1]),a=new r.Point(n[n.length-2],n[n.length-1]);if(o.x===a.x&&o.y===a.y){(n=n.slice()).pop(),n.pop();var s=(a=new r.Point(n[n.length-2],n[n.length-1])).x+.5*(o.x-a.x),c=a.y+.5*(o.y-a.y);n.unshift(s,c),n.push(s,c)}var u=e.points,l=e.indices,h=n.length/2,d=n.length,p=u.length/6,f=t.lineWidth/2,m=(0,i.hex2rgb)(t.lineColor),v=t.lineAlpha,g=m[0]*v,y=m[1]*v,b=m[2]*v,x=n[0],w=n[1],_=n[2],S=n[3],T=0,M=0,A=-(w-S),E=x-_,C=0,P=0,O=0,N=0,L=Math.sqrt(A*A+E*E);A/=L,E/=L,u.push(x-(A*=f),w-(E*=f),g,y,b,v),u.push(x+A,w+E,g,y,b,v);for(var I=1;I<h-1;++I){T=n[2*(I+1)],M=n[2*(I+1)+1],A=-((w=n[2*(I-1)+1])-(S=n[2*I+1])),E=(x=n[2*(I-1)])-(_=n[2*I]),A/=L=Math.sqrt(A*A+E*E),E/=L,A*=f,E*=f,C=-(S-M),P=_-T,C/=L=Math.sqrt(C*C+P*P),P/=L;var R=-E+w-(-E+S),D=-A+_-(-A+x),F=(-A+x)*(-E+S)-(-A+_)*(-E+w),U=-(P*=f)+M-(-P+S),k=-(C*=f)+_-(-C+T),j=(-C+T)*(-P+S)-(-C+_)*(-P+M),B=R*k-U*D;if(Math.abs(B)<.1)B+=10.1,u.push(_-A,S-E,g,y,b,v),u.push(_+A,S+E,g,y,b,v);else{var z=(D*j-k*F)/B,V=(U*F-R*j)/B;(z-_)*(z-_)+(V-S)*(V-S)>196*f*f?(O=A-C,N=E-P,O/=L=Math.sqrt(O*O+N*N),N/=L,u.push(_-(O*=f),S-(N*=f)),u.push(g,y,b,v),u.push(_+O,S+N),u.push(g,y,b,v),u.push(_-O,S-N),u.push(g,y,b,v),d++):(u.push(z,V),u.push(g,y,b,v),u.push(_-(z-_),S-(V-S)),u.push(g,y,b,v))}}A=-((w=n[2*(h-2)+1])-(S=n[2*(h-1)+1])),E=(x=n[2*(h-2)])-(_=n[2*(h-1)]),A/=L=Math.sqrt(A*A+E*E),E/=L,u.push(_-(A*=f),S-(E*=f)),u.push(g,y,b,v),u.push(_+A,S+E),u.push(g,y,b,v),l.push(p);for(var G=0;G<d;++G)l.push(p++);l.push(p-1)}}(t,e)};var r=n("Q5/2"),i=n("aH6o")},FjAT:function(t,e,n){"use strict";e.__esModule=!0,e.VERSION="4.7.2",e.PI_2=2*Math.PI,e.RAD_TO_DEG=180/Math.PI,e.DEG_TO_RAD=Math.PI/180,e.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2},e.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19},e.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},e.SCALE_MODES={LINEAR:0,NEAREST:1},e.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},e.GC_MODES={AUTO:0,MANUAL:1},e.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i,e.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;(charset=[\w-]+|base64))?,(.*)/i,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},e.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},e.TRANSFORM_MODE={STATIC:0,DYNAMIC:1},e.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},e.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50}},"Fy0/":function(t,e,n){(function(r){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof r&&"env"in r&&(t=r.env.DEBUG),t}(e=t.exports=n("vmzn")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&"%c"===t&&(o=++i)}),t.splice(o,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(e,n("W2nU"))},GK6M:function(t,e,n){"use strict";e.a=function(t){return r=t,o};var r,i=n("fKB6");function o(){try{return r.apply(this,arguments)}catch(t){return i.a.e=t,i.a}}},"Gc6/":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.maxMilliseconds=e,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}();e.default=r},GyJD:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){var n=o;n=(n=n.replace(/%count%/gi,e)).replace(/%forloop%/gi,function(t){var e="";e+="\n",e+="\n";for(var n=0;n<t;n++)n>0&&(e+="\nelse "),n<t-1&&(e+="if(textureId == "+n+".0)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+n+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"}(e));for(var r=new i.default(t,"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n",n),a=[],s=0;s<e;s++)a[s]=s;return r.bind(),r.uniforms.uSamplers=a,r};var r,i=(r=n("Obmw"))&&r.__esModule?r:{default:r};n("o/zv");var o=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","float textureId = floor(vTextureId+0.5);","%forloop%","gl_FragColor = color * vColor;","}"].join("\n")},HVUN:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=(r=n("zFUS"))&&r.__esModule?r:{default:r},a=n("FjAT"),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.a=e,this.b=n,this.c=r,this.d=i,this.tx=o,this.ty=a,this.array=null}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,n,r,i,o){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},t.prototype.apply=function(t,e){e=e||new o.default;var n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new o.default;var n=1/(this.a*this.d+this.c*-this.b),r=t.x,i=t.y;return e.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.a,i=this.c,o=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=i*e-this.d*n,this.d=i*n+this.d*e,this.tx=o*e-this.ty*n,this.ty=o*n+this.ty*e,this},t.prototype.append=function(t){var e=this.a,n=this.b,r=this.c,i=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*i+this.ty,this},t.prototype.setTransform=function(t,e,n,r,i,o,a,s,c){return this.a=Math.cos(a+c)*i,this.b=Math.sin(a+c)*i,this.c=-Math.sin(a-s)*o,this.d=Math.cos(a-s)*o,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var n=this.a,r=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,n=this.b,r=this.c,i=this.d,o=-Math.atan2(-r,i),s=Math.atan2(n,e),c=Math.abs(o+s);return c<1e-5||Math.abs(a.PI_2-c)<1e-5?(t.rotation=s,e<0&&i>=0&&(t.rotation+=t.rotation<=0?Math.PI:-Math.PI),t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=s),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+i*i),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,r=this.d,i=this.tx,o=t*r-e*n;return this.a=r/o,this.b=-e/o,this.c=-n/o,this.d=t/o,this.tx=(n*this.ty-r*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},i(t,null,[{key:"IDENTITY",get:function(){return new t}},{key:"TEMP_MATRIX",get:function(){return new t}}]),t}();e.default=s},"I/rR":function(t,e,n){"use strict";e.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=l(n("SdIY")),a=l(n("rdl+")),s=l(n("tIUM")),c=l(n("BzvE")),u=l(n("qsr7"));function l(t){return t&&t.__esModule?t:{default:t}}i.utils.mixins.delayMixin(i.DisplayObject.prototype,u.default);var h=1,d={target:null,data:{global:null}},p=function(t){function e(n,r){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r=r||{},s.renderer=n,s.autoPreventDefault=void 0===r.autoPreventDefault||r.autoPreventDefault,s.interactionFrequency=r.interactionFrequency||10,s.mouse=new o.default,s.mouse.identifier=h,s.mouse.global.set(-999999),s.activeInteractionData={},s.activeInteractionData[h]=s.mouse,s.interactionDataPool=[],s.eventData=new a.default,s.interactionDOMElement=null,s.moveWhenInside=!1,s.eventsAdded=!1,s.mouseOverRenderer=!1,s.supportsTouchEvents="ontouchstart"in window,s.supportsPointerEvents=!!window.PointerEvent,s.onPointerUp=s.onPointerUp.bind(s),s.processPointerUp=s.processPointerUp.bind(s),s.onPointerCancel=s.onPointerCancel.bind(s),s.processPointerCancel=s.processPointerCancel.bind(s),s.onPointerDown=s.onPointerDown.bind(s),s.processPointerDown=s.processPointerDown.bind(s),s.onPointerMove=s.onPointerMove.bind(s),s.processPointerMove=s.processPointerMove.bind(s),s.onPointerOut=s.onPointerOut.bind(s),s.processPointerOverOut=s.processPointerOverOut.bind(s),s.onPointerOver=s.onPointerOver.bind(s),s.cursorStyles={default:"inherit",pointer:"pointer"},s.currentCursorMode=null,s.cursor=null,s._tempPoint=new i.Point,s.resolution=1,s.setTargetElement(s.renderer.view,s.renderer.resolution),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.hitTest=function(t,e){return d.target=null,d.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(d,e,null,!0),d.target},e.prototype.setTargetElement=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents()},e.prototype.addEvents=function(){this.interactionDOMElement&&(i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},e.prototype.removeEvents=function(){this.interactionDOMElement&&(i.ticker.shared.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},e.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var e in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var n=this.activeInteractionData[e];if(n.originalEvent&&"touch"!==n.pointerType){var r=this.configureInteractionEventForDOMEvent(this.eventData,n.originalEvent,n);this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(this.currentCursorMode!==(t=t||"default")){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch("undefined"==typeof e?"undefined":r(e)){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,n){n.stopped||(n.currentTarget=t,n.type=e,t.emit(e,n),t[e]&&t[e](n))},e.prototype.mapPositionToPoint=function(t,e,n){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=navigator.isCocoonJS?this.resolution:1/this.resolution;t.x=this.interactionDOMElement.width/r.width*(e-r.left)*i,t.y=this.interactionDOMElement.height/r.height*(n-r.top)*i},e.prototype.processInteractive=function(t,e,n,r,i){if(!e||!e.visible)return!1;var o=t.data.global,a=!1,s=i=e.interactive||i,c=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(r=!1,c=!1)),s=!1):e._mask&&r&&(e._mask.containsPoint(o)||(r=!1,c=!1)),c&&e.interactiveChildren&&e.children)for(var u=e.children,l=u.length-1;l>=0;l--){var h=u[l],d=this.processInteractive(t,h,n,r,s);if(d){if(!h.parent)continue;s=!1,d&&(t.target&&(r=!1),a=!0)}}return i&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),n&&n(t,e,!!a))),a},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&t.preventDefault();for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",a),"touch"===i.pointerType?this.emit("touchstart",a):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit(2===i.button?"rightdown":"mousedown",this.eventData)}}},e.prototype.processPointerDown=function(t,e,n){var r=t.data,i=t.data.identifier;if(n)if(e.trackedPointers[i]||(e.trackedPointers[i]=new s.default(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var o=2===r.button;o?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,n){for(var r=this.normalizeToPointerData(t),i=r.length,o=t.target!==this.interactionDOMElement?"outside":"",a=0;a<i;a++){var s=r[a],c=this.getInteractionDataForPointerId(s),u=this.configureInteractionEventForDOMEvent(this.eventData,s,c);u.data.originalEvent=t,this.processInteractive(u,this.renderer._lastObjectRendered,n,e||!o),this.emit(e?"pointercancel":"pointerup"+o,u),"mouse"===s.pointerType||"pen"===s.pointerType?this.emit(2===s.button?"rightup"+o:"mouseup"+o,u):"touch"===s.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,u),this.releaseInteractionDataForPointerId(s.pointerId,c))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var n=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===n.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,n){var r=t.data,i=t.data.identifier,o=e.trackedPointers[i],a="touch"===r.pointerType;if("mouse"===r.pointerType||"pen"===r.pointerType){var c=2===r.button,u=s.default.FLAGS,l=void 0!==o&&o.flags&(c?u.RIGHT_DOWN:u.LEFT_DOWN);n?(this.dispatchEvent(e,c?"rightup":"mouseup",t),l&&this.dispatchEvent(e,c?"rightclick":"click",t)):l&&this.dispatchEvent(e,c?"rightupoutside":"mouseupoutside",t),o&&(c?o.rightDown=!1:o.leftDown=!1)}n?(this.dispatchEvent(e,"pointerup",t),a&&this.dispatchEvent(e,"touchend",t),o&&(this.dispatchEvent(e,"pointertap",t),a&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),a&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[i]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerMove,"touch"!==i.pointerType||this.moveWhenInside),this.emit("pointermove",a),"touch"===i.pointerType&&this.emit("touchmove",a),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",a)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,n){var r=t.data,i="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType;o&&this.processPointerOverOut(t,e,n),this.moveWhenInside&&!n||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(n.identifier)}},e.prototype.processPointerOverOut=function(t,e,n){var r=t.data,i=t.data.identifier,o="mouse"===r.pointerType||"pen"===r.pointerType,a=e.trackedPointers[i];n&&!a&&(a=e.trackedPointers[i]=new s.default(i)),void 0!==a&&(n&&this.mouseOverRenderer?(a.over||(a.over=!0,this.dispatchEvent(e,"pointerover",t),o&&this.dispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):a.over&&(a.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),a.none&&delete e.trackedPointers[i]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},e.prototype.getInteractionDataForPointerId=function(t){var e=t.pointerId,n=void 0;return e===h||"mouse"===t.pointerType?n=this.mouse:this.activeInteractionData[e]?n=this.activeInteractionData[e]:((n=this.interactionDataPool.pop()||new o.default).identifier=e,this.activeInteractionData[e]=n),n.copyEvent(t),n},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,n){return t.data=n,this.mapPositionToPoint(n.global,e.clientX,e.clientY),navigator.isCocoonJS&&"touch"===e.pointerType&&(n.global.x=n.global.x/this.resolution,n.global.y=n.global.y/this.resolution),"touch"===e.pointerType&&(e.globalX=n.global.x,e.globalY=n.global.y),n.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,r=t.changedTouches.length;n<r;n++){var i=t.changedTouches[n];"undefined"==typeof i.button&&(i.button=t.touches.length?1:0),"undefined"==typeof i.buttons&&(i.buttons=t.touches.length?1:0),"undefined"==typeof i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),"undefined"==typeof i.width&&(i.width=i.radiusX||1),"undefined"==typeof i.height&&(i.height=i.radiusY||1),"undefined"==typeof i.tiltX&&(i.tiltX=0),"undefined"==typeof i.tiltY&&(i.tiltY=0),"undefined"==typeof i.pointerType&&(i.pointerType="touch"),"undefined"==typeof i.pointerId&&(i.pointerId=i.identifier||0),"undefined"==typeof i.pressure&&(i.pressure=i.force||.5),i.twist=0,i.tangentialPressure=0,"undefined"==typeof i.layerX&&(i.layerX=i.offsetX=i.clientX),"undefined"==typeof i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):("undefined"==typeof t.isPrimary&&(t.isPrimary=!0),"undefined"==typeof t.width&&(t.width=1),"undefined"==typeof t.height&&(t.height=1),"undefined"==typeof t.tiltX&&(t.tiltX=0),"undefined"==typeof t.tiltY&&(t.tiltY=0),"undefined"==typeof t.pointerType&&(t.pointerType="mouse"),"undefined"==typeof t.pointerId&&(t.pointerId=h),"undefined"==typeof t.pressure&&(t.pressure=.5),t.twist=0,t.tangentialPressure=0,t.isNormalized=!0,e.push(t));return e},e.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},e}(c.default);e.default=p,i.WebGLRenderer.registerPlugin("interaction",p),i.CanvasRenderer.registerPlugin("interaction",p)},Ibme:function(t,e,n){"use strict";e.__esModule=!0;var r=n("FjAT"),i=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=n,this.width=i,this.height=o,this.radius=a,this.type=r.SHAPES.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var n=t-(this.x+this.radius),r=e-(this.y+this.radius),i=this.radius*this.radius;if(n*n+r*r<=i)return!0;if((n=t-(this.x+this.width-this.radius))*n+r*r<=i)return!0;if(n*n+(r=e-(this.y+this.height-this.radius))*r<=i)return!0;if((n=t-(this.x+this.radius))*n+r*r<=i)return!0}return!1},t}();e.default=i},It3W:function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,s,c,u,l,p,m,v=e&&e.length,g=v?e[0]*n:t.length,y=i(t,0,g,n,!0),b=[];if(!y)return b;if(v&&(y=function(t,e,n,r){var a,s,c,u=[];for(a=0,s=e.length;a<s;a++)(c=i(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r,!1))===c.next&&(c.steiner=!0),u.push(f(c));for(u.sort(h),a=0;a<u.length;a++)d(u[a],n),n=o(n,n.next);return n}(t,e,y,n)),t.length>80*n){r=c=t[0],s=u=t[1];for(var x=n;x<g;x+=n)p=t[x+1],(l=t[x])<r&&(r=l),p<s&&(s=p),l>c&&(c=l),p>u&&(u=p);m=0!==(m=Math.max(c-r,u-s))?1/m:0}return a(y,b,n,r,s,m),b}function i(t,e,n,r,i){var o,a;if(i===M(t,e,n,r)>0)for(o=e;o<n;o+=r)a=_(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=_(o,t[o],t[o+1],a);return a&&y(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!y(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,h,d){if(t){!d&&h&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,c,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(t,r,i,h);for(var f,m,v=t;t.prev!==t.next;)if(f=t.prev,m=t.next,h?c(t,r,i,h):s(t))e.push(f.i/n),e.push(t.i/n),e.push(m.i/n),S(t),t=m.next,v=m.next;else if((t=m)===v){d?1===d?a(t=u(t,e,n),e,n,r,i,h,2):2===d&&l(t,e,n,r,i,h):a(o(t),e,n,r,i,h,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(g(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(m(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function c(t,e,n,r){var i=t.prev,o=t,a=t.next;if(g(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=p(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),l=p(s,c,e,n,r),h=t.prevZ,d=t.nextZ;h&&h.z>=u&&d&&d.z<=l;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=u;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=l;){if(d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function u(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!y(i,o)&&b(i,r,r.next,o)&&x(i,o)&&x(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),S(r),S(r.next),r=t=o),r=r.next}while(r!==t);return r}function l(t,e,n,r,i,s){var c=t;do{for(var u=c.next.next;u!==c.prev;){if(c.i!==u.i&&v(c,u)){var l=w(c,u);return c=o(c,c.next),l=o(l,l.next),a(c,e,n,r,i,s),void a(l,e,n,r,i,s)}u=u.next}c=c.next}while(c!==t)}function h(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var c,u=n,l=n.x,h=n.y,d=1/0;for(r=n.next;r!==u;)i>=r.x&&r.x>=l&&i!==r.x&&m(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&((c=Math.abs(o-r.y)/(i-r.x))<d||c===d&&r.x>n.x)&&x(r,t)&&(n=r,d=c),r=r.next;return n}(t,e)){var n=w(e,t);o(n,n.next)}}function p(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function m(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&x(t,e)&&x(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){return!!(y(t,e)&&y(n,r)||y(t,r)&&y(n,e))||g(t,e,n)>0!=g(t,e,r)>0&&g(n,r,t)>0!=g(n,r,e)>0}function x(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var n=new T(t.i,t.x,t.y),r=new T(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function _(t,e,n,r){var i=new T(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(M(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(M(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var c=0;for(a=0;a<r.length;a+=3){var u=r[a]*n,l=r[a+1]*n,h=r[a+2]*n;c+=Math.abs((t[u]-t[h])*(t[l+1]-t[u+1])-(t[u]-t[l])*(t[h+1]-t[u+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n}},JD0k:function(t,e){var n=function(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log(t.getShaderInfoLog(r)),null)};t.exports=function(t,e,r,i){var o=n(t,t.VERTEX_SHADER,e),a=n(t,t.FRAGMENT_SHADER,r),s=t.createProgram();if(t.attachShader(s,o),t.attachShader(s,a),i)for(var c in i)t.bindAttribLocation(s,i[c],c);return t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(s,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(s)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(s)),t.deleteProgram(s),s=null),t.deleteShader(o),t.deleteShader(a),s}},JJ61:function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),i=new r.Rectangle,o=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,e.extract=this}return t.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},t.prototype.base64=function(t){return this.canvas(t).toDataURL()},t.prototype.canvas=function(t){var e=this.renderer,n=void 0,o=void 0,a=void 0,s=void 0;t&&(s=t instanceof r.RenderTexture?t:e.generateTexture(t)),s?(n=s.baseTexture._canvasRenderTarget.context,o=s.baseTexture._canvasRenderTarget.resolution,a=s.frame):(n=e.rootContext,(a=i).width=this.renderer.width,a.height=this.renderer.height);var c=a.width*o,u=a.height*o,l=new r.CanvasRenderTarget(c,u),h=n.getImageData(a.x*o,a.y*o,c,u);return l.context.putImageData(h,0,0),l.canvas},t.prototype.pixels=function(t){var e=this.renderer,n=void 0,o=void 0,a=void 0,s=void 0;return t&&(s=t instanceof r.RenderTexture?t:e.generateTexture(t)),s?(n=s.baseTexture._canvasRenderTarget.context,o=s.baseTexture._canvasRenderTarget.resolution,a=s.frame):(n=e.rootContext,(a=i).width=e.width,a.height=e.height),n.getImageData(0,0,a.width*o,a.height*o).data},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t}();e.default=o,r.CanvasRenderer.registerPlugin("extract",o)},JdRN:function(t,e,n){"use strict";e.__esModule=!0,e.default={mixin:function(t){!function(t){t.__plugins={},t.registerPlugin=function(e,n){t.__plugins[e]=n},t.prototype.initPlugins=function(){for(var e in this.plugins=this.plugins||{},t.__plugins)this.plugins[e]=new t.__plugins[e](this)},t.prototype.destroyPlugins=function(){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;this.plugins=null}}(t)}}},Jnfr:function(t,e){function n(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="Jnfr"},Jwyl:function(t,e,n){"use strict";e.a=function(t,e){return function(n){var o;if(o="function"==typeof t?t:function(){return t},"function"==typeof e)return n.lift(new i(o,e));var a=Object.create(n,r.a);return a.source=n,a.subjectFactory=o,a}};var r=n("NO/a"),i=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(t);return i.add(e.subscribe(r)),i},t}()},KFrc:function(t,e,n){"use strict";e.__esModule=!0;var r=o(n("8USZ")),i=o(n("/MUw"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments[2],a=arguments[3];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,null,o));return s.resolution=a||i.default.RESOLUTION,s.width=Math.ceil(n),s.height=Math.ceil(r),s.realWidth=s.width*s.resolution,s.realHeight=s.height*s.resolution,s.scaleMode=void 0!==o?o:i.default.SCALE_MODE,s.hasLoaded=!0,s._glRenderTargets={},s._canvasRenderTarget=null,s.valid=!1,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this))},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.renderer=null},e}(r.default);e.default=a},KWAD:function(t,e,n){"use strict";Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t})},LGVh:function(t,e,n){"use strict";e.__esModule=!0;var r=n("SdIY");Object.defineProperty(e,"InteractionData",{enumerable:!0,get:function(){return c(r).default}});var i=n("I/rR");Object.defineProperty(e,"InteractionManager",{enumerable:!0,get:function(){return c(i).default}});var o=n("qsr7");Object.defineProperty(e,"interactiveTarget",{enumerable:!0,get:function(){return c(o).default}});var a=n("tIUM");Object.defineProperty(e,"InteractionTrackingData",{enumerable:!0,get:function(){return c(a).default}});var s=n("rdl+");function c(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"InteractionEvent",{enumerable:!0,get:function(){return c(s).default}})},M75x:function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("VWTR"))&&r.__esModule?r:{default:r},o=function(){function t(){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsUint32=new Uint32Array(4)}return t.prototype.set=function(t,e,n){var r=e.width,o=e.height;if(n){var a=t.width/2/r,s=t.height/2/o,c=t.x/r+a,u=t.y/o+s;n=i.default.add(n,i.default.NW),this.x0=c+a*i.default.uX(n),this.y0=u+s*i.default.uY(n),n=i.default.add(n,2),this.x1=c+a*i.default.uX(n),this.y1=u+s*i.default.uY(n),n=i.default.add(n,2),this.x2=c+a*i.default.uX(n),this.y2=u+s*i.default.uY(n),n=i.default.add(n,2),this.x3=c+a*i.default.uX(n),this.y3=u+s*i.default.uY(n)}else this.x0=t.x/r,this.y0=t.y/o,this.x1=(t.x+t.width)/r,this.y1=t.y/o,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/o,this.x3=t.x/r,this.y3=(t.y+t.height)/o;this.uvsUint32[0]=(65535*this.y0&65535)<<16|65535*this.x0&65535,this.uvsUint32[1]=(65535*this.y1&65535)<<16|65535*this.x1&65535,this.uvsUint32[2]=(65535*this.y2&65535)<<16|65535*this.x2&65535,this.uvsUint32[3]=(65535*this.y3&65535)<<16|65535*this.x3&65535},t}();e.default=o},M81j:function(t,e,n){"use strict";var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),i=s(n("qD+0")),o=s(n("8USZ")),a=n("aH6o");function s(t){return t&&t.__esModule?t:{default:t}}var c=r.DisplayObject,u=new r.Matrix;c.prototype._cacheAsBitmap=!1,c.prototype._cacheData=!1,Object.defineProperties(c.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap!==t){this._cacheAsBitmap=t;var e=void 0;t?(this._cacheData||(this._cacheData=new function t(){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.textureCacheId=null,this.originalRenderWebGL=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null}),(e=this._cacheData).originalRenderWebGL=this.renderWebGL,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this._calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=e.originalRenderWebGL,this.renderCanvas=e.originalRenderCanvas,this._calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}}),c.prototype._renderCachedWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite._transformID=-1,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(t))},c.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.currentRenderer.flush();var n=this.getLocalBounds().clone();this._filters&&n.pad(this._filters[0].padding);var s=t._activeRenderTarget,c=t.filterManager.filterStack,l=r.RenderTexture.create(0|n.width,0|n.height),h="cacheAsBitmap_"+(0,a.uid)();this._cacheData.textureCacheId=h,o.default.addToCache(l.baseTexture,h),i.default.addToCache(l,h);var d=u;d.tx=-n.x,d.ty=-n.y,this.transform.worldTransform.identity(),this.renderWebGL=this._cacheData.originalRenderWebGL,t.render(this,l,!0,d,!0),t.bindRenderTarget(s),t.filterManager.filterStack=c,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this._mask=null,this.filterArea=null;var p=new r.Sprite(l);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-n.x/n.width,p.anchor.y=-n.y/n.height,p.alpha=e,p._bounds=this._bounds,this._calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=p.containsPoint.bind(p)}},c.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite.renderCanvas(t))},c.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),n=this.alpha;this.alpha=1;var s=t.context,c=r.RenderTexture.create(0|e.width,0|e.height),l="cacheAsBitmap_"+(0,a.uid)();this._cacheData.textureCacheId=l,o.default.addToCache(c.baseTexture,l),i.default.addToCache(c,l);var h=u;this.transform.localTransform.copy(h),h.invert(),h.tx-=e.x,h.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,c,!0,h,!1),t.context=s,this.renderCanvas=this._renderCachedCanvas,this._calculateBounds=this._calculateCachedBounds,this._mask=null,this.filterArea=null;var d=new r.Sprite(c);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-e.x/e.width,d.anchor.y=-e.y/e.height,d._bounds=this._bounds,d.alpha=n,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.updateTransform=this.displayObjectUpdateTransform,this._cacheData.sprite=d,this.containsPoint=d.containsPoint.bind(d)}},c.prototype._calculateCachedBounds=function(){this._cacheData.sprite._calculateBounds()},c.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},c.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,o.default.removeFromCache(this._cacheData.textureCacheId),i.default.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},c.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)}},MIKO:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){function e(){return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.start=function(){},e.prototype.stop=function(){this.flush()},e.prototype.flush=function(){},e.prototype.render=function(t){},e}(((r=n("3psj"))&&r.__esModule?r:{default:r}).default);e.default=i},"Ml+6":function(t,e,n){"use strict";function r(){}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"WebGLRenderTargetCube",function(){return sn}),n.d(e,"WebGLRenderTarget",function(){return an}),n.d(e,"WebGLRenderer",function(){return Oi}),n.d(e,"ShaderLib",function(){return xn}),n.d(e,"UniformsLib",function(){return bn}),n.d(e,"UniformsUtils",function(){return mn}),n.d(e,"ShaderChunk",function(){return fn}),n.d(e,"FogExp2",function(){return Ni}),n.d(e,"Fog",function(){return Li}),n.d(e,"Scene",function(){return Ii}),n.d(e,"Sprite",function(){return Di}),n.d(e,"LOD",function(){return Fi}),n.d(e,"SkinnedMesh",function(){return ji}),n.d(e,"Skeleton",function(){return Ui}),n.d(e,"Bone",function(){return ki}),n.d(e,"Mesh",function(){return fr}),n.d(e,"LineSegments",function(){return Vi}),n.d(e,"LineLoop",function(){return Gi}),n.d(e,"Line",function(){return zi}),n.d(e,"Points",function(){return Wi}),n.d(e,"Group",function(){return Xi}),n.d(e,"VideoTexture",function(){return qi}),n.d(e,"DataTexture",function(){return cn}),n.d(e,"CompressedTexture",function(){return Yi}),n.d(e,"CubeTexture",function(){return vr}),n.d(e,"CanvasTexture",function(){return Mi}),n.d(e,"DepthTexture",function(){return Zi}),n.d(e,"Texture",function(){return rn}),n.d(e,"CompressedTextureLoader",function(){return _a}),n.d(e,"DataTextureLoader",function(){return Sa}),n.d(e,"CubeTextureLoader",function(){return Ma}),n.d(e,"TextureLoader",function(){return Aa}),n.d(e,"ObjectLoader",function(){return Os}),n.d(e,"MaterialLoader",function(){return xs}),n.d(e,"BufferGeometryLoader",function(){return ws}),n.d(e,"DefaultLoadingManager",function(){return ba}),n.d(e,"LoadingManager",function(){return ya}),n.d(e,"JSONLoader",function(){return Ps}),n.d(e,"ImageLoader",function(){return Ta}),n.d(e,"ImageBitmapLoader",function(){return Ds}),n.d(e,"FontLoader",function(){return js}),n.d(e,"FileLoader",function(){return wa}),n.d(e,"Loader",function(){return Es}),n.d(e,"LoaderUtils",function(){return Cs}),n.d(e,"Cache",function(){return ga}),n.d(e,"AudioLoader",function(){return lc}),n.d(e,"SpotLightShadow",function(){return $a}),n.d(e,"SpotLight",function(){return ts}),n.d(e,"PointLight",function(){return es}),n.d(e,"RectAreaLight",function(){return os}),n.d(e,"HemisphereLight",function(){return Qa}),n.d(e,"DirectionalLightShadow",function(){return ns}),n.d(e,"DirectionalLight",function(){return rs}),n.d(e,"AmbientLight",function(){return is}),n.d(e,"LightShadow",function(){return Ka}),n.d(e,"Light",function(){return Ja}),n.d(e,"StereoCamera",function(){return hc}),n.d(e,"PerspectiveCamera",function(){return Ei}),n.d(e,"OrthographicCamera",function(){return On}),n.d(e,"CubeCamera",function(){return dc}),n.d(e,"ArrayCamera",function(){return Ci}),n.d(e,"Camera",function(){return Pn}),n.d(e,"AudioListener",function(){return pc}),n.d(e,"PositionalAudio",function(){return mc}),n.d(e,"AudioContext",function(){return uc}),n.d(e,"AudioAnalyser",function(){return vc}),n.d(e,"Audio",function(){return fc}),n.d(e,"VectorKeyframeTrack",function(){return ys}),n.d(e,"StringKeyframeTrack",function(){return as}),n.d(e,"QuaternionKeyframeTrack",function(){return ls}),n.d(e,"NumberKeyframeTrack",function(){return ds}),n.d(e,"ColorKeyframeTrack",function(){return hs}),n.d(e,"BooleanKeyframeTrack",function(){return ss}),n.d(e,"PropertyMixer",function(){return gc}),n.d(e,"PropertyBinding",function(){return bc}),n.d(e,"KeyframeTrack",function(){return gs}),n.d(e,"AnimationUtils",function(){return vs}),n.d(e,"AnimationObjectGroup",function(){return xc}),n.d(e,"AnimationMixer",function(){return _c}),n.d(e,"AnimationClip",function(){return bs}),n.d(e,"Uniform",function(){return Sc}),n.d(e,"InstancedBufferGeometry",function(){return Tc}),n.d(e,"BufferGeometry",function(){return Zn}),n.d(e,"Geometry",function(){return Dn}),n.d(e,"InterleavedBufferAttribute",function(){return Mc}),n.d(e,"InstancedInterleavedBuffer",function(){return Ec}),n.d(e,"InterleavedBuffer",function(){return Ac}),n.d(e,"InstancedBufferAttribute",function(){return Cc}),n.d(e,"Face3",function(){return Nn}),n.d(e,"Object3D",function(){return Cn}),n.d(e,"Raycaster",function(){return Pc}),n.d(e,"Layers",function(){return _n}),n.d(e,"EventDispatcher",function(){return r}),n.d(e,"Clock",function(){return Lc}),n.d(e,"QuaternionLinearInterpolant",function(){return us}),n.d(e,"LinearInterpolant",function(){return fs}),n.d(e,"DiscreteInterpolant",function(){return ms}),n.d(e,"CubicInterpolant",function(){return ps}),n.d(e,"Interpolant",function(){return cs}),n.d(e,"Triangle",function(){return pr}),n.d(e,"Math",function(){return He}),n.d(e,"Spherical",function(){return Ic}),n.d(e,"Cylindrical",function(){return Rc}),n.d(e,"Plane",function(){return hn}),n.d(e,"Frustum",function(){return dn}),n.d(e,"Sphere",function(){return ln}),n.d(e,"Ray",function(){return hr}),n.d(e,"Matrix4",function(){return Xe}),n.d(e,"Matrix3",function(){return Ze}),n.d(e,"Box3",function(){return un}),n.d(e,"Box2",function(){return Dc}),n.d(e,"Line3",function(){return dr}),n.d(e,"Euler",function(){return wn}),n.d(e,"Vector4",function(){return on}),n.d(e,"Vector3",function(){return Ye}),n.d(e,"Vector2",function(){return We}),n.d(e,"Quaternion",function(){return qe}),n.d(e,"Color",function(){return gn}),n.d(e,"ImmediateRenderObject",function(){return Fc}),n.d(e,"VertexNormalsHelper",function(){return Uc}),n.d(e,"SpotLightHelper",function(){return kc}),n.d(e,"SkeletonHelper",function(){return jc}),n.d(e,"PointLightHelper",function(){return Bc}),n.d(e,"RectAreaLightHelper",function(){return zc}),n.d(e,"HemisphereLightHelper",function(){return Vc}),n.d(e,"GridHelper",function(){return Gc}),n.d(e,"PolarGridHelper",function(){return Hc}),n.d(e,"FaceNormalsHelper",function(){return Wc}),n.d(e,"DirectionalLightHelper",function(){return Xc}),n.d(e,"CameraHelper",function(){return qc}),n.d(e,"BoxHelper",function(){return Yc}),n.d(e,"Box3Helper",function(){return Zc}),n.d(e,"PlaneHelper",function(){return Jc}),n.d(e,"ArrowHelper",function(){return Qc}),n.d(e,"AxesHelper",function(){return Kc}),n.d(e,"Shape",function(){return Za}),n.d(e,"Path",function(){return Ya}),n.d(e,"ShapePath",function(){return Fs}),n.d(e,"Font",function(){return Us}),n.d(e,"CurvePath",function(){return qa}),n.d(e,"Curve",function(){return Ea}),n.d(e,"ShapeUtils",function(){return Uo}),n.d(e,"WebGLUtils",function(){return Ai}),n.d(e,"WireframeGeometry",function(){return Ji}),n.d(e,"ParametricGeometry",function(){return Qi}),n.d(e,"ParametricBufferGeometry",function(){return Ki}),n.d(e,"TetrahedronGeometry",function(){return eo}),n.d(e,"TetrahedronBufferGeometry",function(){return no}),n.d(e,"OctahedronGeometry",function(){return ro}),n.d(e,"OctahedronBufferGeometry",function(){return io}),n.d(e,"IcosahedronGeometry",function(){return oo}),n.d(e,"IcosahedronBufferGeometry",function(){return ao}),n.d(e,"DodecahedronGeometry",function(){return so}),n.d(e,"DodecahedronBufferGeometry",function(){return co}),n.d(e,"PolyhedronGeometry",function(){return $i}),n.d(e,"PolyhedronBufferGeometry",function(){return to}),n.d(e,"TubeGeometry",function(){return uo}),n.d(e,"TubeBufferGeometry",function(){return lo}),n.d(e,"TorusKnotGeometry",function(){return ho}),n.d(e,"TorusKnotBufferGeometry",function(){return po}),n.d(e,"TorusGeometry",function(){return fo}),n.d(e,"TorusBufferGeometry",function(){return mo}),n.d(e,"TextGeometry",function(){return Vo}),n.d(e,"TextBufferGeometry",function(){return Go}),n.d(e,"SphereGeometry",function(){return Ho}),n.d(e,"SphereBufferGeometry",function(){return Wo}),n.d(e,"RingGeometry",function(){return Xo}),n.d(e,"RingBufferGeometry",function(){return qo}),n.d(e,"PlaneGeometry",function(){return Kn}),n.d(e,"PlaneBufferGeometry",function(){return $n}),n.d(e,"LatheGeometry",function(){return Yo}),n.d(e,"LatheBufferGeometry",function(){return Zo}),n.d(e,"ShapeGeometry",function(){return Jo}),n.d(e,"ShapeBufferGeometry",function(){return Qo}),n.d(e,"ExtrudeGeometry",function(){return Bo}),n.d(e,"ExtrudeBufferGeometry",function(){return zo}),n.d(e,"EdgesGeometry",function(){return $o}),n.d(e,"ConeGeometry",function(){return na}),n.d(e,"ConeBufferGeometry",function(){return ra}),n.d(e,"CylinderGeometry",function(){return ta}),n.d(e,"CylinderBufferGeometry",function(){return ea}),n.d(e,"CircleGeometry",function(){return ia}),n.d(e,"CircleBufferGeometry",function(){return oa}),n.d(e,"BoxGeometry",function(){return Jn}),n.d(e,"BoxBufferGeometry",function(){return Qn}),n.d(e,"ShadowMaterial",function(){return sa}),n.d(e,"SpriteMaterial",function(){return Ri}),n.d(e,"RawShaderMaterial",function(){return ca}),n.d(e,"ShaderMaterial",function(){return lr}),n.d(e,"PointsMaterial",function(){return Hi}),n.d(e,"MeshPhysicalMaterial",function(){return la}),n.d(e,"MeshStandardMaterial",function(){return ua}),n.d(e,"MeshPhongMaterial",function(){return ha}),n.d(e,"MeshToonMaterial",function(){return da}),n.d(e,"MeshNormalMaterial",function(){return pa}),n.d(e,"MeshLambertMaterial",function(){return fa}),n.d(e,"MeshDepthMaterial",function(){return _i}),n.d(e,"MeshDistanceMaterial",function(){return Si}),n.d(e,"MeshBasicMaterial",function(){return ur}),n.d(e,"LineDashedMaterial",function(){return ma}),n.d(e,"LineBasicMaterial",function(){return Bi}),n.d(e,"Material",function(){return cr}),n.d(e,"Float64BufferAttribute",function(){return Wn}),n.d(e,"Float32BufferAttribute",function(){return Hn}),n.d(e,"Uint32BufferAttribute",function(){return Gn}),n.d(e,"Int32BufferAttribute",function(){return Vn}),n.d(e,"Uint16BufferAttribute",function(){return zn}),n.d(e,"Int16BufferAttribute",function(){return Bn}),n.d(e,"Uint8ClampedBufferAttribute",function(){return jn}),n.d(e,"Uint8BufferAttribute",function(){return kn}),n.d(e,"Int8BufferAttribute",function(){return Un}),n.d(e,"BufferAttribute",function(){return Fn}),n.d(e,"ArcCurve",function(){return Pa}),n.d(e,"CatmullRomCurve3",function(){return Da}),n.d(e,"CubicBezierCurve",function(){return ja}),n.d(e,"CubicBezierCurve3",function(){return Ba}),n.d(e,"EllipseCurve",function(){return Ca}),n.d(e,"LineCurve",function(){return za}),n.d(e,"LineCurve3",function(){return Va}),n.d(e,"QuadraticBezierCurve",function(){return Ga}),n.d(e,"QuadraticBezierCurve3",function(){return Ha}),n.d(e,"SplineCurve",function(){return Wa}),n.d(e,"REVISION",function(){return p}),n.d(e,"MOUSE",function(){return f}),n.d(e,"CullFaceNone",function(){return m}),n.d(e,"CullFaceBack",function(){return v}),n.d(e,"CullFaceFront",function(){return g}),n.d(e,"CullFaceFrontBack",function(){return y}),n.d(e,"FrontFaceDirectionCW",function(){return b}),n.d(e,"FrontFaceDirectionCCW",function(){return x}),n.d(e,"BasicShadowMap",function(){return w}),n.d(e,"PCFShadowMap",function(){return _}),n.d(e,"PCFSoftShadowMap",function(){return S}),n.d(e,"FrontSide",function(){return T}),n.d(e,"BackSide",function(){return M}),n.d(e,"DoubleSide",function(){return A}),n.d(e,"FlatShading",function(){return E}),n.d(e,"SmoothShading",function(){return C}),n.d(e,"NoColors",function(){return P}),n.d(e,"FaceColors",function(){return O}),n.d(e,"VertexColors",function(){return N}),n.d(e,"NoBlending",function(){return L}),n.d(e,"NormalBlending",function(){return I}),n.d(e,"AdditiveBlending",function(){return R}),n.d(e,"SubtractiveBlending",function(){return D}),n.d(e,"MultiplyBlending",function(){return F}),n.d(e,"CustomBlending",function(){return U}),n.d(e,"AddEquation",function(){return k}),n.d(e,"SubtractEquation",function(){return j}),n.d(e,"ReverseSubtractEquation",function(){return B}),n.d(e,"MinEquation",function(){return z}),n.d(e,"MaxEquation",function(){return V}),n.d(e,"ZeroFactor",function(){return G}),n.d(e,"OneFactor",function(){return H}),n.d(e,"SrcColorFactor",function(){return W}),n.d(e,"OneMinusSrcColorFactor",function(){return X}),n.d(e,"SrcAlphaFactor",function(){return q}),n.d(e,"OneMinusSrcAlphaFactor",function(){return Y}),n.d(e,"DstAlphaFactor",function(){return Z}),n.d(e,"OneMinusDstAlphaFactor",function(){return J}),n.d(e,"DstColorFactor",function(){return Q}),n.d(e,"OneMinusDstColorFactor",function(){return K}),n.d(e,"SrcAlphaSaturateFactor",function(){return $}),n.d(e,"NeverDepth",function(){return tt}),n.d(e,"AlwaysDepth",function(){return et}),n.d(e,"LessDepth",function(){return nt}),n.d(e,"LessEqualDepth",function(){return rt}),n.d(e,"EqualDepth",function(){return it}),n.d(e,"GreaterEqualDepth",function(){return ot}),n.d(e,"GreaterDepth",function(){return at}),n.d(e,"NotEqualDepth",function(){return st}),n.d(e,"MultiplyOperation",function(){return ct}),n.d(e,"MixOperation",function(){return ut}),n.d(e,"AddOperation",function(){return lt}),n.d(e,"NoToneMapping",function(){return ht}),n.d(e,"LinearToneMapping",function(){return dt}),n.d(e,"ReinhardToneMapping",function(){return pt}),n.d(e,"Uncharted2ToneMapping",function(){return ft}),n.d(e,"CineonToneMapping",function(){return mt}),n.d(e,"UVMapping",function(){return vt}),n.d(e,"CubeReflectionMapping",function(){return gt}),n.d(e,"CubeRefractionMapping",function(){return yt}),n.d(e,"EquirectangularReflectionMapping",function(){return bt}),n.d(e,"EquirectangularRefractionMapping",function(){return xt}),n.d(e,"SphericalReflectionMapping",function(){return wt}),n.d(e,"CubeUVReflectionMapping",function(){return _t}),n.d(e,"CubeUVRefractionMapping",function(){return St}),n.d(e,"RepeatWrapping",function(){return Tt}),n.d(e,"ClampToEdgeWrapping",function(){return Mt}),n.d(e,"MirroredRepeatWrapping",function(){return At}),n.d(e,"NearestFilter",function(){return Et}),n.d(e,"NearestMipMapNearestFilter",function(){return Ct}),n.d(e,"NearestMipMapLinearFilter",function(){return Pt}),n.d(e,"LinearFilter",function(){return Ot}),n.d(e,"LinearMipMapNearestFilter",function(){return Nt}),n.d(e,"LinearMipMapLinearFilter",function(){return Lt}),n.d(e,"UnsignedByteType",function(){return It}),n.d(e,"ByteType",function(){return Rt}),n.d(e,"ShortType",function(){return Dt}),n.d(e,"UnsignedShortType",function(){return Ft}),n.d(e,"IntType",function(){return Ut}),n.d(e,"UnsignedIntType",function(){return kt}),n.d(e,"FloatType",function(){return jt}),n.d(e,"HalfFloatType",function(){return Bt}),n.d(e,"UnsignedShort4444Type",function(){return zt}),n.d(e,"UnsignedShort5551Type",function(){return Vt}),n.d(e,"UnsignedShort565Type",function(){return Gt}),n.d(e,"UnsignedInt248Type",function(){return Ht}),n.d(e,"AlphaFormat",function(){return Wt}),n.d(e,"RGBFormat",function(){return Xt}),n.d(e,"RGBAFormat",function(){return qt}),n.d(e,"LuminanceFormat",function(){return Yt}),n.d(e,"LuminanceAlphaFormat",function(){return Zt}),n.d(e,"RGBEFormat",function(){return Jt}),n.d(e,"DepthFormat",function(){return Qt}),n.d(e,"DepthStencilFormat",function(){return Kt}),n.d(e,"RGB_S3TC_DXT1_Format",function(){return $t}),n.d(e,"RGBA_S3TC_DXT1_Format",function(){return te}),n.d(e,"RGBA_S3TC_DXT3_Format",function(){return ee}),n.d(e,"RGBA_S3TC_DXT5_Format",function(){return ne}),n.d(e,"RGB_PVRTC_4BPPV1_Format",function(){return re}),n.d(e,"RGB_PVRTC_2BPPV1_Format",function(){return ie}),n.d(e,"RGBA_PVRTC_4BPPV1_Format",function(){return oe}),n.d(e,"RGBA_PVRTC_2BPPV1_Format",function(){return ae}),n.d(e,"RGB_ETC1_Format",function(){return se}),n.d(e,"RGBA_ASTC_4x4_Format",function(){return ce}),n.d(e,"RGBA_ASTC_5x4_Format",function(){return ue}),n.d(e,"RGBA_ASTC_5x5_Format",function(){return le}),n.d(e,"RGBA_ASTC_6x5_Format",function(){return he}),n.d(e,"RGBA_ASTC_6x6_Format",function(){return de}),n.d(e,"RGBA_ASTC_8x5_Format",function(){return pe}),n.d(e,"RGBA_ASTC_8x6_Format",function(){return fe}),n.d(e,"RGBA_ASTC_8x8_Format",function(){return me}),n.d(e,"RGBA_ASTC_10x5_Format",function(){return ve}),n.d(e,"RGBA_ASTC_10x6_Format",function(){return ge}),n.d(e,"RGBA_ASTC_10x8_Format",function(){return ye}),n.d(e,"RGBA_ASTC_10x10_Format",function(){return be}),n.d(e,"RGBA_ASTC_12x10_Format",function(){return xe}),n.d(e,"RGBA_ASTC_12x12_Format",function(){return we}),n.d(e,"LoopOnce",function(){return _e}),n.d(e,"LoopRepeat",function(){return Se}),n.d(e,"LoopPingPong",function(){return Te}),n.d(e,"InterpolateDiscrete",function(){return Me}),n.d(e,"InterpolateLinear",function(){return Ae}),n.d(e,"InterpolateSmooth",function(){return Ee}),n.d(e,"ZeroCurvatureEnding",function(){return Ce}),n.d(e,"ZeroSlopeEnding",function(){return Pe}),n.d(e,"WrapAroundEnding",function(){return Oe}),n.d(e,"TrianglesDrawMode",function(){return Ne}),n.d(e,"TriangleStripDrawMode",function(){return Le}),n.d(e,"TriangleFanDrawMode",function(){return Ie}),n.d(e,"LinearEncoding",function(){return Re}),n.d(e,"sRGBEncoding",function(){return De}),n.d(e,"GammaEncoding",function(){return Fe}),n.d(e,"RGBEEncoding",function(){return Ue}),n.d(e,"LogLuvEncoding",function(){return ke}),n.d(e,"RGBM7Encoding",function(){return je}),n.d(e,"RGBM16Encoding",function(){return Be}),n.d(e,"RGBDEncoding",function(){return ze}),n.d(e,"BasicDepthPacking",function(){return Ve}),n.d(e,"RGBADepthPacking",function(){return Ge}),n.d(e,"CubeGeometry",function(){return Jn}),n.d(e,"Face4",function(){return $c}),n.d(e,"LineStrip",function(){return tu}),n.d(e,"LinePieces",function(){return eu}),n.d(e,"MeshFaceMaterial",function(){return nu}),n.d(e,"MultiMaterial",function(){return ru}),n.d(e,"PointCloud",function(){return iu}),n.d(e,"Particle",function(){return ou}),n.d(e,"ParticleSystem",function(){return au}),n.d(e,"PointCloudMaterial",function(){return su}),n.d(e,"ParticleBasicMaterial",function(){return cu}),n.d(e,"ParticleSystemMaterial",function(){return uu}),n.d(e,"Vertex",function(){return lu}),n.d(e,"DynamicBufferAttribute",function(){return hu}),n.d(e,"Int8Attribute",function(){return du}),n.d(e,"Uint8Attribute",function(){return pu}),n.d(e,"Uint8ClampedAttribute",function(){return fu}),n.d(e,"Int16Attribute",function(){return mu}),n.d(e,"Uint16Attribute",function(){return vu}),n.d(e,"Int32Attribute",function(){return gu}),n.d(e,"Uint32Attribute",function(){return yu}),n.d(e,"Float32Attribute",function(){return bu}),n.d(e,"Float64Attribute",function(){return xu}),n.d(e,"ClosedSplineCurve3",function(){return wu}),n.d(e,"SplineCurve3",function(){return _u}),n.d(e,"Spline",function(){return Su}),n.d(e,"AxisHelper",function(){return Tu}),n.d(e,"BoundingBoxHelper",function(){return Mu}),n.d(e,"EdgesHelper",function(){return Au}),n.d(e,"WireframeHelper",function(){return Eu}),n.d(e,"XHRLoader",function(){return Cu}),n.d(e,"BinaryTextureLoader",function(){return Pu}),n.d(e,"GeometryUtils",function(){return Ou}),n.d(e,"ImageUtils",function(){return Nu}),n.d(e,"Projector",function(){return Lu}),n.d(e,"CanvasRenderer",function(){return Iu}),n.d(e,"SceneUtils",function(){return Ru}),n.d(e,"LensFlare",function(){return Du}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}),Object.assign(r.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t)}}}});var i,o,a,s,c,u,l,h,d,p="91",f={LEFT:0,MIDDLE:1,RIGHT:2},m=0,v=1,g=2,y=3,b=0,x=1,w=0,_=1,S=2,T=0,M=1,A=2,E=1,C=2,P=0,O=1,N=2,L=0,I=1,R=2,D=3,F=4,U=5,k=100,j=101,B=102,z=103,V=104,G=200,H=201,W=202,X=203,q=204,Y=205,Z=206,J=207,Q=208,K=209,$=210,tt=0,et=1,nt=2,rt=3,it=4,ot=5,at=6,st=7,ct=0,ut=1,lt=2,ht=0,dt=1,pt=2,ft=3,mt=4,vt=300,gt=301,yt=302,bt=303,xt=304,wt=305,_t=306,St=307,Tt=1e3,Mt=1001,At=1002,Et=1003,Ct=1004,Pt=1005,Ot=1006,Nt=1007,Lt=1008,It=1009,Rt=1010,Dt=1011,Ft=1012,Ut=1013,kt=1014,jt=1015,Bt=1016,zt=1017,Vt=1018,Gt=1019,Ht=1020,Wt=1021,Xt=1022,qt=1023,Yt=1024,Zt=1025,Jt=qt,Qt=1026,Kt=1027,$t=33776,te=33777,ee=33778,ne=33779,re=35840,ie=35841,oe=35842,ae=35843,se=36196,ce=37808,ue=37809,le=37810,he=37811,de=37812,pe=37813,fe=37814,me=37815,ve=37816,ge=37817,ye=37818,be=37819,xe=37820,we=37821,_e=2200,Se=2201,Te=2202,Me=2300,Ae=2301,Ee=2302,Ce=2400,Pe=2401,Oe=2402,Ne=0,Le=1,Ie=2,Re=3e3,De=3001,Fe=3007,Ue=3002,ke=3003,je=3004,Be=3005,ze=3006,Ve=3200,Ge=3201,He={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}(),clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*He.DEG2RAD},radToDeg:function(t){return t*He.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function We(t,e){this.x=t||0,this.y=e||0}function Xe(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function qe(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1}function Ye(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}function Ze(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(We.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(We.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:(i=new We,o=new We,function(t,e){return i.set(t,t),o.set(e,e),this.clamp(i,o)}),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}}),Object.assign(Xe.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,o,a,s,c,u,l,h,d,p,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=c,v[6]=u,v[10]=l,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Xe).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:(h=new Ye,function(t){var e=this.elements,n=t.elements,r=1/h.setFromMatrixColumn(t,0).length(),i=1/h.setFromMatrixColumn(t,1).length(),o=1/h.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,this}),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),c=Math.sin(r),u=Math.cos(i),l=Math.sin(i);if("XYZ"===t.order){var h=o*u,d=o*l,p=a*u,f=a*l;e[0]=s*u,e[4]=-s*l,e[8]=c,e[1]=d+p*c,e[5]=h-f*c,e[9]=-a*s,e[2]=f-h*c,e[6]=p+d*c,e[10]=o*s}else if("YXZ"===t.order){var m=s*l,v=c*u;e[0]=(g=s*u)+(y=c*l)*a,e[4]=v*a-m,e[8]=o*c,e[1]=o*l,e[5]=o*u,e[9]=-a,e[2]=m*a-v,e[6]=y+g*a,e[10]=o*s}else if("ZXY"===t.order){var g,y;m=s*l,v=c*u,e[0]=(g=s*u)-(y=c*l)*a,e[4]=-o*l,e[8]=v+m*a,e[1]=m+v*a,e[5]=o*u,e[9]=y-g*a,e[2]=-o*c,e[6]=a,e[10]=o*s}else if("ZYX"===t.order)h=o*u,d=o*l,p=a*u,f=a*l,e[0]=s*u,e[4]=p*c-d,e[8]=h*c+f,e[1]=s*l,e[5]=f*c+h,e[9]=d*c-p,e[2]=-c,e[6]=a*s,e[10]=o*s;else if("YZX"===t.order){var b=o*s,x=o*c,w=a*s,_=a*c;e[0]=s*u,e[4]=_-b*l,e[8]=w*l+x,e[1]=l,e[5]=o*u,e[9]=-a*u,e[2]=-c*u,e[6]=x*l+w,e[10]=b-_*l}else"XZY"===t.order&&(b=o*s,x=o*c,w=a*s,_=a*c,e[0]=s*u,e[4]=-l,e[8]=c*u,e[1]=b*l+_,e[5]=o*u,e[9]=x*l-w,e[2]=w*l-x,e[6]=a*u,e[10]=_*l+b);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,n=t._x,r=t._y,i=t._z,o=t._w,a=n+n,s=r+r,c=i+i,u=n*a,l=n*s,h=n*c,d=r*s,p=r*c,f=i*c,m=o*a,v=o*s,g=o*c;return e[0]=1-(d+f),e[4]=l-g,e[8]=h+v,e[1]=l+g,e[5]=1-(u+f),e[9]=p-m,e[2]=h-v,e[6]=p+m,e[10]=1-(u+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:(c=new Ye,u=new Ye,l=new Ye,function(t,e,n){var r=this.elements;return l.subVectors(t,e),0===l.lengthSq()&&(l.z=1),l.normalize(),c.crossVectors(n,l),0===c.lengthSq()&&(1===Math.abs(n.z)?l.x+=1e-4:l.z+=1e-4,l.normalize(),c.crossVectors(n,l)),c.normalize(),u.crossVectors(l,c),r[0]=c.x,r[4]=u.x,r[8]=l.x,r[1]=c.y,r[5]=u.y,r[9]=l.y,r[2]=c.z,r[6]=u.z,r[10]=l.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],c=n[12],u=n[1],l=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],b=n[11],x=n[15],w=r[0],_=r[4],S=r[8],T=r[12],M=r[1],A=r[5],E=r[9],C=r[13],P=r[2],O=r[6],N=r[10],L=r[14],I=r[3],R=r[7],D=r[11],F=r[15];return i[0]=o*w+a*M+s*P+c*I,i[4]=o*_+a*A+s*O+c*R,i[8]=o*S+a*E+s*N+c*D,i[12]=o*T+a*C+s*L+c*F,i[1]=u*w+l*M+h*P+d*I,i[5]=u*_+l*A+h*O+d*R,i[9]=u*S+l*E+h*N+d*D,i[13]=u*T+l*C+h*L+d*F,i[2]=p*w+f*M+m*P+v*I,i[6]=p*_+f*A+m*O+v*R,i[10]=p*S+f*E+m*N+v*D,i[14]=p*T+f*C+m*L+v*F,i[3]=g*w+y*M+b*P+x*I,i[7]=g*_+y*A+b*O+x*R,i[11]=g*S+y*E+b*N+x*D,i[15]=g*T+y*C+b*L+x*F,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new Ye;return function(e){for(var n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix4(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],c=t[13],u=t[2],l=t[6],h=t[10],d=t[14];return t[3]*(+i*s*l-r*c*l-i*a*h+n*c*h+r*a*d-n*s*d)+t[7]*(+e*s*d-e*c*h+i*o*h-r*o*d+r*c*u-i*s*u)+t[11]*(+e*c*l-e*a*d-i*o*l+n*o*d+i*a*u-n*c*u)+t[15]*(-r*a*u-e*s*l+e*a*h+r*o*l-n*o*h+n*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,r=t.elements,i=r[0],o=r[1],a=r[2],s=r[3],c=r[4],u=r[5],l=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],b=r[15],x=p*y*h-g*f*h+g*l*m-u*y*m-p*l*b+u*f*b,w=v*f*h-d*y*h-v*l*m+c*y*m+d*l*b-c*f*b,_=d*g*h-v*p*h+v*u*m-c*g*m-d*u*b+c*p*b,S=v*p*l-d*g*l-v*u*f+c*g*f+d*u*y-c*p*y,T=i*x+o*w+a*_+s*S;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return n[0]=x*A,n[1]=(g*f*s-p*y*s-g*a*m+o*y*m+p*a*b-o*f*b)*A,n[2]=(u*y*s-g*l*s+g*a*h-o*y*h-u*a*b+o*l*b)*A,n[3]=(p*l*s-u*f*s-p*a*h+o*f*h+u*a*m-o*l*m)*A,n[4]=w*A,n[5]=(d*y*s-v*f*s+v*a*m-i*y*m-d*a*b+i*f*b)*A,n[6]=(v*l*s-c*y*s-v*a*h+i*y*h+c*a*b-i*l*b)*A,n[7]=(c*f*s-d*l*s+d*a*h-i*f*h-c*a*m+i*l*m)*A,n[8]=_*A,n[9]=(v*p*s-d*g*s-v*o*m+i*g*m+d*o*b-i*p*b)*A,n[10]=(c*g*s-v*u*s+v*o*h-i*g*h-c*o*b+i*u*b)*A,n[11]=(d*u*s-c*p*s-d*o*h+i*p*h+c*o*m-i*u*m)*A,n[12]=S*A,n[13]=(d*g*a-v*p*a+v*o*f-i*g*f-d*o*y+i*p*y)*A,n[14]=(v*u*a-c*g*a-v*o*l+i*g*l+c*o*y-i*u*y)*A,n[15]=(c*p*a-d*u*a+d*o*l-i*p*l-c*o*f+i*u*f)*A,this},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,c=i*o,u=i*a;return this.set(c*o+n,c*a-r*s,c*s+r*a,0,c*a+r*s,u*a+n,u*s-r*o,0,c*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){return this.makeRotationFromQuaternion(e),this.scale(n),this.setPosition(t),this},decompose:(a=new Ye,s=new Xe,function(t,e,n){var r=this.elements,i=a.set(r[0],r[1],r[2]).length(),o=a.set(r[4],r[5],r[6]).length(),c=a.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],s.copy(this);var u=1/i,l=1/o,h=1/c;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=l,s.elements[5]*=l,s.elements[6]*=l,s.elements[8]*=h,s.elements[9]*=h,s.elements[10]*=h,e.setFromRotationMatrix(s),n.x=i,n.y=o,n.z=c,this}),makePerspective:function(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),l=-(o+i)/(o-i),h=-2*o*i/(o-i);return a[0]=2*i/(e-t),a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=s,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,n,r,i,o){var a=this.elements,s=1/(e-t),c=1/(n-r),u=1/(o-i),l=(e+t)*s,h=(n+r)*c,d=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}),Object.assign(qe,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,o,a){var s=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(l!==f||s!==h||c!==d||u!==p){var m=1-a,v=s*h+c*d+u*p+l*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,v*g);m=Math.sin(m*x)/b,a=Math.sin(a*x)/b}var w=a*g;if(s=s*m+h*w,c=c*m+d*w,u=u*m+p*w,l=l*m+f*w,m===1-a){var _=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=_,c*=_,u*=_,l*=_}}t[e]=s,t[e+1]=c,t[e+2]=u,t[e+3]=l}}),Object.defineProperties(qe.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(qe.prototype,{set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,o=t.order,a=Math.cos,s=Math.sin,c=a(n/2),u=a(r/2),l=a(i/2),h=s(n/2),d=s(r/2),p=s(i/2);return"XYZ"===o?(this._x=h*u*l+c*d*p,this._y=c*d*l-h*u*p,this._z=c*u*p+h*d*l,this._w=c*u*l-h*d*p):"YXZ"===o?(this._x=h*u*l+c*d*p,this._y=c*d*l-h*u*p,this._z=c*u*p-h*d*l,this._w=c*u*l+h*d*p):"ZXY"===o?(this._x=h*u*l-c*d*p,this._y=c*d*l+h*u*p,this._z=c*u*p+h*d*l,this._w=c*u*l-h*d*p):"ZYX"===o?(this._x=h*u*l-c*d*p,this._y=c*d*l+h*u*p,this._z=c*u*p-h*d*l,this._w=c*u*l+h*d*p):"YZX"===o?(this._x=h*u*l+c*d*p,this._y=c*d*l+h*u*p,this._z=c*u*p-h*d*l,this._w=c*u*l-h*d*p):"XZY"===o&&(this._x=h*u*l-c*d*p,this._y=c*d*l-h*u*p,this._z=c*u*p+h*d*l,this._w=c*u*l+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],c=n[9],u=n[2],l=n[6],h=n[10],d=r+s+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(l-c)*e,this._y=(o-u)*e,this._z=(a-i)*e):r>s&&r>h?(e=2*Math.sqrt(1+r-s-h),this._w=(l-c)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+u)/e):s>h?(e=2*Math.sqrt(1+s-r-h),this._w=(o-u)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(c+l)/e):(e=2*Math.sqrt(1+h-r-s),this._w=(a-i)/e,this._x=(o+u)/e,this._y=(c+l)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new Ye;return function(n,r){return void 0===e&&(e=new Ye),(t=n.dot(r)+1)<1e-6?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,c=e._z,u=e._w;return this._x=n*u+o*a+r*c-i*s,this._y=r*u+o*s+i*a-n*c,this._z=i*u+o*c+n*s-r*a,this._w=o*u-n*a-r*s-i*c,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var c=Math.atan2(s,a),u=Math.sin((1-e)*c)/s,l=Math.sin(e*c)/s;return this._w=o*u+this._w*l,this._x=n*u+this._x*l,this._y=r*u+this._y*l,this._z=i*u+this._z*l,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Ye.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(d=new qe,function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(d.setFromEuler(t))}),applyAxisAngle:function(){var t=new qe;return function(e,n){return this.applyQuaternion(t.setFromAxisAngle(e,n))}}(),applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,c=s*e+o*r-a*n,u=s*n+a*e-i*r,l=s*r+i*n-o*e,h=-i*e-o*n-a*r;return this.x=c*s+h*-i+u*-a-l*-o,this.y=u*s+h*-o+l*-i-c*-a,this.z=l*s+h*-a+c*-o-u*-i,this},project:function(){var t=new Xe;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new Xe;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new Ye,e=new Ye;return function(n,r){return t.set(n,n,n),e.set(r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new Ye;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new Ye;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(He.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(Ze.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,o,a,s,c){var u=this.elements;return u[0]=t,u[1]=r,u[2]=a,u[3]=e,u[4]=i,u[5]=s,u[6]=n,u[7]=o,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Ye;return function(e){for(var n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix3(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],s=n[6],c=n[1],u=n[4],l=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],b=r[7],x=r[2],w=r[5],_=r[8];return i[0]=o*f+a*g+s*x,i[3]=o*m+a*y+s*w,i[6]=o*v+a*b+s*_,i[1]=c*f+u*g+l*x,i[4]=c*m+u*y+l*w,i[7]=c*v+u*b+l*_,i[2]=h*f+d*g+p*x,i[5]=h*m+d*y+p*w,i[8]=h*v+d*b+p*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8];return e*o*u-e*a*c-n*i*u+n*a*s+r*i*c-r*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=t.elements,r=this.elements,i=n[0],o=n[1],a=n[2],s=n[3],c=n[4],u=n[5],l=n[6],h=n[7],d=n[8],p=d*c-u*h,f=u*l-d*s,m=h*s-c*l,v=i*p+o*f+a*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=p*y,r[1]=(a*h-d*o)*y,r[2]=(u*o-a*c)*y,r[3]=f*y,r[4]=(d*i-a*l)*y,r[5]=(a*s-u*i)*y,r[6]=m*y,r[7]=(o*l-h*i)*y,r[8]=(c*i-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,o,a){var s=Math.cos(i),c=Math.sin(i);this.set(n*s,n*c,-n*(s*o+c*a)+o+t,-r*c,r*s,-r*(-c*o+s*a)+a+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],c=r[4],u=r[7];return r[0]=e*i+n*s,r[3]=e*o+n*c,r[6]=e*a+n*u,r[1]=-n*i+e*s,r[4]=-n*o+e*c,r[7]=-n*a+e*u,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var Je,Qe,Ke,$e,tn,en,nn=0;function rn(t,e,n,r,i,o,a,s,c,u){Object.defineProperty(this,"id",{value:nn++}),this.uuid=He.generateUUID(),this.name="",this.image=void 0!==t?t:rn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:rn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:Mt,this.wrapT=void 0!==r?r:Mt,this.magFilter=void 0!==i?i:Ot,this.minFilter=void 0!==o?o:Lt,this.anisotropy=void 0!==c?c:1,this.format=void 0!==a?a:qt,this.type=void 0!==s?s:It,this.offset=new We(0,0),this.repeat=new We(1,1),this.center=new We(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ze,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:Re,this.version=0,this.onUpdate=null}function on(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1}function an(t,e,n){this.width=t,this.height=e,this.scissor=new on(0,0,t,e),this.scissorTest=!1,this.viewport=new on(0,0,t,e),void 0===(n=n||{}).minFilter&&(n.minFilter=Ot),this.texture=new rn(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function sn(t,e,n){an.call(this,t,e,n),this.activeCubeFace=0,this.activeMipMapLevel=0}function cn(t,e,n,r,i,o,a,s,c,u,l,h){rn.call(this,null,o,a,s,c,u,r,i,l,h),this.image={data:t,width:e,height:n},this.magFilter=void 0!==c?c:Et,this.minFilter=void 0!==u?u:Et,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function un(t,e){this.min=void 0!==t?t:new Ye(1/0,1/0,1/0),this.max=void 0!==e?e:new Ye(-1/0,-1/0,-1/0)}function ln(t,e){this.center=void 0!==t?t:new Ye,this.radius=void 0!==e?e:0}function hn(t,e){this.normal=void 0!==t?t:new Ye(1,0,0),this.constant=void 0!==e?e:0}function dn(t,e,n,r,i,o){this.planes=[void 0!==t?t:new hn,void 0!==e?e:new hn,void 0!==n?n:new hn,void 0!==r?r:new hn,void 0!==i?i:new hn,void 0!==o?o:new hn]}rn.DEFAULT_IMAGE=void 0,rn.DEFAULT_MAPPING=vt,rn.prototype=Object.assign(Object.create(r.prototype),{constructor:rn,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var r=this.image;void 0===r.uuid&&(r.uuid=He.generateUUID()),e||void 0!==t.images[r.uuid]||(t.images[r.uuid]={uuid:r.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var n=e.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(r)}),n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===vt){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Tt:t.x=t.x-Math.floor(t.x);break;case Mt:t.x=t.x<0?0:1;break;case At:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Tt:t.y=t.y-Math.floor(t.y);break;case Mt:t.y=t.y<0?0:1;break;case At:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(rn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(on.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,i,o=t.elements,a=o[0],s=o[4],c=o[8],u=o[1],l=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-u)<.01&&Math.abs(c-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+u)<.1&&Math.abs(c+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+l+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(a+1)/2,v=(l+1)/2,g=(f+1)/2,y=(s+u)/4,b=(c+d)/4,x=(h+p)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=b/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=x/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=b/(i=Math.sqrt(g)),r=x/i),this.set(n,r,i,e),this}var w=Math.sqrt((p-h)*(p-h)+(c-d)*(c-d)+(u-s)*(u-s));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(c-d)/w,this.z=(u-s)/w,this.w=Math.acos((a+l+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new on,e=new on),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),an.prototype=Object.assign(Object.create(r.prototype),{constructor:an,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(sn.prototype=Object.create(an.prototype)).constructor=sn,sn.prototype.isWebGLRenderTargetCube=!0,(cn.prototype=Object.create(rn.prototype)).constructor=cn,cn.prototype.isDataTexture=!0,Object.assign(un.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=t.length;s<c;s+=3){var u=t[s],l=t[s+1],h=t[s+2];u<e&&(e=u),l<n&&(n=l),h<r&&(r=h),u>i&&(i=u),l>o&&(o=l),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=t.count;s<c;s++){var u=t.getX(s),l=t.getY(s),h=t.getZ(s);u<e&&(e=u),l<n&&(n=l),h<r&&(r=h),u>i&&(i=u),l>o&&(o=l),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Ye;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Ye),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Ye),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,n,r=new Ye;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(e=0,n=a.length;e<n;e++)r.copy(a[e]),r.applyMatrix4(i.matrixWorld),t.expandByPoint(r)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(e=0,n=s.count;e<n;e++)r.fromBufferAttribute(s,e).applyMatrix4(i.matrixWorld),t.expandByPoint(r)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(i),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Ye),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(Qe=new Ye,function(t){return this.clampPoint(t.center,Qe),Qe.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=t.constant&&n>=t.constant},intersectsTriangle:function(){var t=new Ye,e=new Ye,n=new Ye,r=new Ye,i=new Ye,o=new Ye,a=new Ye,s=new Ye,c=new Ye,u=new Ye;function l(r){var i,o;for(i=0,o=r.length-3;i<=o;i+=3){a.fromArray(r,i);var s=c.x*Math.abs(a.x)+c.y*Math.abs(a.y)+c.z*Math.abs(a.z),u=t.dot(a),l=e.dot(a),h=n.dot(a);if(Math.max(-Math.max(u,l,h),Math.min(u,l,h))>s)return!1}return!0}return function(a){if(this.isEmpty())return!1;this.getCenter(s),c.subVectors(this.max,s),t.subVectors(a.a,s),e.subVectors(a.b,s),n.subVectors(a.c,s),r.subVectors(e,t),i.subVectors(n,e),o.subVectors(t,n);var h=[0,-r.z,r.y,0,-i.z,i.y,0,-o.z,o.y,r.z,0,-r.x,i.z,0,-i.x,o.z,0,-o.x,-r.y,r.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!l(h)&&!!l(h=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(r,i),l(h=[u.x,u.y,u.z]))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Ye),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Ye;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new Ye;return function(e){return void 0===e&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),e=new ln),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(Je=[new Ye,new Ye,new Ye,new Ye,new Ye,new Ye,new Ye,new Ye],function(t){return this.isEmpty()?this:(Je[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Je[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Je[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Je[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Je[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Je[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Je[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Je[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Je),this)}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(ln.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(Ke=new un,function(t,e){var n=this.center;void 0!==e?n.copy(e):Ke.setFromPoints(t).getCenter(n);for(var r=0,i=0,o=t.length;i<o;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Ye),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new un),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(hn.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Ye,e=new Ye;return function(n,r,i){var o=t.subVectors(i,r).cross(e.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Ye),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Ye;return function(e,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new Ye);var r=e.delta(t),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?n.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:n.copy(r).multiplyScalar(o).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Ye),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Ye,e=new Ze;return function(n,r){var i=r||e.getNormalMatrix(n),o=this.coplanarPoint(t).applyMatrix4(n),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(dn.prototype,{set:function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromMatrix:function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return e[0].setComponents(a-r,l-s,f-h,y-m).normalize(),e[1].setComponents(a+r,l+s,f+h,y+m).normalize(),e[2].setComponents(a+i,l+c,f+d,y+v).normalize(),e[3].setComponents(a-i,l-c,f-d,y-v).normalize(),e[4].setComponents(a-o,l-u,f-p,y-g).normalize(),e[5].setComponents(a+o,l+u,f+p,y+g).normalize(),this},intersectsObject:(en=new ln,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),en.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(en)}),intersectsSprite:function(){var t=new ln;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(n)<r)return!1;return!0},intersectsBox:($e=new Ye,tn=new Ye,function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];$e.x=r.normal.x>0?t.min.x:t.max.x,tn.x=r.normal.x>0?t.max.x:t.min.x,$e.y=r.normal.y>0?t.min.y:t.max.y,tn.y=r.normal.y>0?t.max.y:t.min.y,$e.z=r.normal.z>0?t.min.z:t.max.z,tn.z=r.normal.z>0?t.max.z:t.min.z;var i=r.distanceToPoint($e),o=r.distanceToPoint(tn);if(i<0&&o<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});var pn,fn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},mn={merge:function(t){for(var e={},n=0;n<t.length;n++){var r=this.clone(t[n]);for(var i in r)e[i]=r[i]}return e},clone:function(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];e[n][r]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return e}},vn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function gn(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}Object.assign(gn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(){function t(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}return function(e,n,r){if(e=He.euclideanModulo(e,1),n=He.clamp(n,0,1),r=He.clamp(r,0,1),0===n)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+n):r+n-r*n,o=2*r-i;this.r=t(o,i,e+1/3),this.g=t(o,i,e),this.b=t(o,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,i=n[2];switch(n[1]){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(r[1])/360,a=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(o,a,s)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c,u=(c=n[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&t.length>0&&(void 0!==(c=vn[t])?this.setHex(c):console.warn("THREE.Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(){var t=this.r,e=this.g,n=this.b;return this.r=t*t,this.g=e*e,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),c=(s+a)/2;if(s===a)e=0,n=0;else{var u=a-s;switch(n=c<=.5?u/(a+s):u/(2-a-s),a){case r:e=(i-o)/u+(i<o?6:0);break;case i:e=(o-r)/u+2;break;case o:e=(r-i)/u+4}e/=6}return t.h=e,t.s=n,t.l=c,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(pn={},function(t,e,n){return this.getHSL(pn),pn.h+=t,pn.s+=e,pn.l+=n,this.setHSL(pn.h,pn.s,pn.l),this}),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var yn,bn={common:{diffuse:{value:new gn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ze},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new We(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new gn(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new gn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Ze}}},xn={basic:{uniforms:mn.merge([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.fog]),vertexShader:fn.meshbasic_vert,fragmentShader:fn.meshbasic_frag},lambert:{uniforms:mn.merge([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.fog,bn.lights,{emissive:{value:new gn(0)}}]),vertexShader:fn.meshlambert_vert,fragmentShader:fn.meshlambert_frag},phong:{uniforms:mn.merge([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.gradientmap,bn.fog,bn.lights,{emissive:{value:new gn(0)},specular:{value:new gn(1118481)},shininess:{value:30}}]),vertexShader:fn.meshphong_vert,fragmentShader:fn.meshphong_frag},standard:{uniforms:mn.merge([bn.common,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.roughnessmap,bn.metalnessmap,bn.fog,bn.lights,{emissive:{value:new gn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:fn.meshphysical_vert,fragmentShader:fn.meshphysical_frag},points:{uniforms:mn.merge([bn.points,bn.fog]),vertexShader:fn.points_vert,fragmentShader:fn.points_frag},dashed:{uniforms:mn.merge([bn.common,bn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:fn.linedashed_vert,fragmentShader:fn.linedashed_frag},depth:{uniforms:mn.merge([bn.common,bn.displacementmap]),vertexShader:fn.depth_vert,fragmentShader:fn.depth_frag},normal:{uniforms:mn.merge([bn.common,bn.bumpmap,bn.normalmap,bn.displacementmap,{opacity:{value:1}}]),vertexShader:fn.normal_vert,fragmentShader:fn.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:fn.cube_vert,fragmentShader:fn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:fn.equirect_vert,fragmentShader:fn.equirect_frag},distanceRGBA:{uniforms:mn.merge([bn.common,bn.displacementmap,{referencePosition:{value:new Ye},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:fn.distanceRGBA_vert,fragmentShader:fn.distanceRGBA_frag},shadow:{uniforms:mn.merge([bn.lights,bn.fog,{color:{value:new gn(0)},opacity:{value:1}}]),vertexShader:fn.shadow_vert,fragmentShader:fn.shadow_frag}};function wn(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||wn.DefaultOrder}function _n(){this.mask=1}xn.physical={uniforms:mn.merge([xn.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:fn.meshphysical_vert,fragmentShader:fn.meshphysical_frag},wn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],wn.DefaultOrder="XYZ",Object.defineProperties(wn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(wn.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=He.clamp,i=t.elements,o=i[0],a=i[4],s=i[8],c=i[1],u=i[5],l=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o))):"ZYX"===e?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===e?(this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new Xe;return function(e,n,r){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,n,r)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(yn=new qe,function(t){return yn.setFromEuler(this),this.setFromQuaternion(yn,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Ye(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(_n.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var Sn,Tn,Mn,An,En=0;function Cn(){Object.defineProperty(this,"id",{value:En++}),this.uuid=He.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Cn.DefaultUp.clone();var t=new Ye,e=new wn,n=new qe,r=new Ye(1,1,1);e.onChange(function(){n.setFromEuler(e,!1)}),n.onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new Xe},normalMatrix:{value:new Ze}}),this.matrix=new Xe,this.matrixWorld=new Xe,this.matrixAutoUpdate=Cn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new _n,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Pn(){Cn.call(this),this.type="Camera",this.matrixWorldInverse=new Xe,this.projectionMatrix=new Xe}function On(t,e,n,r,i,o){Pn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Nn(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new Ye,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new gn,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Cn.DefaultUp=new Ye(0,1,0),Cn.DefaultMatrixAutoUpdate=!0,Cn.prototype=Object.assign(Object.create(r.prototype),{constructor:Cn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(An=new qe,function(t,e){return An.setFromAxisAngle(t,e),this.quaternion.multiply(An),this}),rotateOnWorldAxis:function(){var t=new qe;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new Ye(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new Ye(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new Ye(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new Ye;return function(e,n){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translateX:function(){var t=new Ye(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new Ye(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new Ye(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(Mn=new Xe,function(t){return t.applyMatrix4(Mn.getInverse(this.matrixWorld))}),lookAt:function(){var t=new Xe,e=new Ye;return function(n,r,i){n.isVector3?e.copy(n):e.set(n,r,i),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Ye),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Sn=new Ye,Tn=new Ye,function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new qe),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Sn,t,Tn),t}),getWorldScale:function(){var t=new Ye,e=new qe;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new Ye),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,n),n}}(),getWorldDirection:function(){var t=new qe;return function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Ye),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.matrix=this.matrix.toArray(),void 0!==this.geometry){r.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,c=a.length;s<c;s++)i(t.shapes,a[s]);else i(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(s=0,c=this.material.length;s<c;s++)u.push(i(t.materials,this.material[s]));r.material=u}else r.material=i(t.materials,this.material);if(this.children.length>0)for(r.children=[],s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(t).object);if(e){var l=f(t.geometries),h=f(t.materials),d=f(t.textures),p=f(t.images);a=f(t.shapes),l.length>0&&(n.geometries=l),h.length>0&&(n.materials=h),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),a.length>0&&(n.shapes=a)}return n.object=r,n;function f(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++)this.add(t.children[n].clone());return this}}),Pn.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Pn,isCamera:!0,copy:function(t,e){return Cn.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new qe;return function(e){return void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Ye),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){Cn.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),On.prototype=Object.assign(Object.create(Pn.prototype),{constructor:On,isOrthographicCamera:!0,copy:function(t,e){return Pn.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,o=n+t,a=r+e,s=r-e;if(null!==this.view&&this.view.enabled){var c=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),l=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=l*(this.view.offsetX/c))+l*(this.view.width/c),s=(a-=h*(this.view.offsetY/u))-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far)},toJSON:function(t){var e=Cn.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Object.assign(Nn.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var Ln,In,Rn=0;function Dn(){Object.defineProperty(this,"id",{value:Rn+=2}),this.uuid=He.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Fn(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Un(t,e,n){Fn.call(this,new Int8Array(t),e,n)}function kn(t,e,n){Fn.call(this,new Uint8Array(t),e,n)}function jn(t,e,n){Fn.call(this,new Uint8ClampedArray(t),e,n)}function Bn(t,e,n){Fn.call(this,new Int16Array(t),e,n)}function zn(t,e,n){Fn.call(this,new Uint16Array(t),e,n)}function Vn(t,e,n){Fn.call(this,new Int32Array(t),e,n)}function Gn(t,e,n){Fn.call(this,new Uint32Array(t),e,n)}function Hn(t,e,n){Fn.call(this,new Float32Array(t),e,n)}function Wn(t,e,n){Fn.call(this,new Float64Array(t),e,n)}function Xn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function qn(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}Dn.prototype=Object.assign(Object.create(r.prototype),{constructor:Dn,isGeometry:!0,applyMatrix:function(t){for(var e=(new Ze).getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(t);for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(e).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new Xe;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Xe;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Xe;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Xe;return function(e,n,r){return t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new Xe;return function(e,n,r){return t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:(In=new Cn,function(t){In.lookAt(t),In.updateMatrix(),this.applyMatrix(In.matrix)}),fromBufferGeometry:function(t){var e=this,n=null!==t.index?t.index.array:void 0,r=t.attributes,i=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,c=void 0!==r.uv2?r.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=[],l=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)e.vertices.push(new Ye(i[d],i[d+1],i[d+2])),void 0!==o&&u.push(new Ye(o[d],o[d+1],o[d+2])),void 0!==a&&e.colors.push(new gn(a[d],a[d+1],a[d+2])),void 0!==s&&l.push(new We(s[p],s[p+1])),void 0!==c&&h.push(new We(c[p],c[p+1]));function f(t,n,r,i){var d=new Nn(t,n,r,void 0!==o?[u[t].clone(),u[n].clone(),u[r].clone()]:[],void 0!==a?[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()]:[],i);e.faces.push(d),void 0!==s&&e.faceVertexUvs[0].push([l[t].clone(),l[n].clone(),l[r].clone()]),void 0!==c&&e.faceVertexUvs[1].push([h[t].clone(),h[n].clone(),h[r].clone()])}var m=t.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==n?f(n[p],n[p+1],n[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==n)for(d=0;d<n.length;d+=3)f(n[d],n[d+1],n[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:(Ln=new Ye,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ln).negate(),this.translate(Ln.x,Ln.y,Ln.z),this}),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new Xe;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new Ye,e=new Ye,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,n,r,i,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)a[e]=new Ye;if(t){var s,c,u=new Ye,l=new Ye;for(r=0,i=this.faces.length;r<i;r++)s=this.vertices[(o=this.faces[r]).a],u.subVectors(this.vertices[o.c],c=this.vertices[o.b]),l.subVectors(s,c),u.cross(l),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,n=this.vertices.length;e<n;e++)a[e].normalize();for(r=0,i=this.faces.length;r<i;r++){var h=(o=this.faces[r]).vertexNormals;3===h.length?(h[0].copy(a[o.a]),h[1].copy(a[o.b]),h[2].copy(a[o.c])):(h[0]=a[o.a].clone(),h[1]=a[o.b].clone(),h[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,n;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var r=(n=this.faces[t]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new Dn;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)c=new Ye,u={a:new Ye,b:new Ye,c:new Ye},a.push(c),s.push(u)}var c,u,l=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)u=l.vertexNormals[n],(c=l.faceNormals[n]).copy((i=this.faces[n]).normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new un),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ln),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t&&t.isGeometry){var r,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,c=t.faces,u=this.faceVertexUvs[0],l=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===n&&(n=0),void 0!==e&&(r=(new Ze).getNormalMatrix(e));for(var p=0,f=a.length;p<f;p++){var m=a[p].clone();void 0!==e&&m.applyMatrix4(e),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=c.length;p<f;p++){var v,g,y=c[p],b=y.vertexNormals,x=y.vertexColors;(v=new Nn(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==r&&v.normal.applyMatrix3(r).normalize();for(var w=0,_=b.length;w<_;w++)g=b[w].clone(),void 0!==r&&g.applyMatrix3(r).normalize(),v.vertexNormals.push(g);for(v.color.copy(y.color),w=0,_=x.length;w<_;w++)v.vertexColors.push(x[w].clone());v.materialIndex=y.materialIndex+n,s.push(v)}for(p=0,f=l.length;p<f;p++){var S=l[p],T=[];if(void 0!==S){for(w=0,_=S.length;w<_;w++)T.push(S[w].clone());u.push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,n,r,i,o,a,s,c={},u=[],l=[],h=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)t=this.vertices[n],void 0===c[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(c[e]=n,u.push(this.vertices[n]),l[n]=u.length-1):l[n]=l[c[e]];var d=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=l[i.a],i.b=l[i.b],i.c=l[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var f=d[n];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new Ye(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===e&&(r=[]),a&&a.length===e&&(i=[]),n=0;n<e;n++){var s=t[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var a=[],s=[],c={},u=[],l={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=S(b=S(b=S(b=S(b=S(b=S(b=S(b=S(b,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),a.push(b),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var x=this.faceVertexUvs[0][i];a.push(A(x[0]),A(x[1]),A(x[2]))}if(m&&a.push(T(p.normal)),v){var w=p.vertexNormals;a.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&a.push(M(p.color)),y){var _=p.vertexColors;a.push(M(_[0]),M(_[1]),M(_[2]))}}function S(t,e,n){return n?t|1<<e:t&~(1<<e)}function T(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==c[e]?c[e]:(c[e]=s.length/3,s.push(t.x,t.y,t.z),c[e])}function M(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==l[e]?l[e]:(l[e]=u.length,u.push(t.getHex()),l[e])}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=r,t.data.normals=s,u.length>0&&(t.data.colors=u),h.length>0&&(t.data.uvs=[h]),t.data.faces=a,t},clone:function(){return(new Dn).copy(this)},copy:function(t){var e,n,r,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,n=s.length;e<n;e++)this.vertices.push(s[e].clone());var c=t.colors;for(e=0,n=c.length;e<n;e++)this.colors.push(c[e].clone());var u=t.faces;for(e=0,n=u.length;e<n;e++)this.faces.push(u[e].clone());for(e=0,n=t.faceVertexUvs.length;e<n;e++){var l=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),r=0,i=l.length;r<i;r++){var h=l[r],d=[];for(o=0,a=h.length;o<a;o++)d.push(h[o].clone());this.faceVertexUvs[e].push(d)}}var p=t.morphTargets;for(e=0,n=p.length;e<n;e++){var f={};if(f.name=p[e].name,void 0!==p[e].vertices)for(f.vertices=[],r=0,i=p[e].vertices.length;r<i;r++)f.vertices.push(p[e].vertices[r].clone());if(void 0!==p[e].normals)for(f.normals=[],r=0,i=p[e].normals.length;r<i;r++)f.normals.push(p[e].normals[r].clone());this.morphTargets.push(f)}var m=t.morphNormals;for(e=0,n=m.length;e<n;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],r=0,i=m[e].vertexNormals.length;r<i;r++){var g=m[e].vertexNormals[r],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],r=0,i=m[e].faceNormals.length;r<i;r++)v.faceNormals.push(m[e].faceNormals[r].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,n=b.length;e<n;e++)this.skinWeights.push(b[e].clone());var x=t.skinIndices;for(e=0,n=x.length;e<n;e++)this.skinIndices.push(x[e].clone());var w=t.lineDistances;for(e=0,n=w.length;e<n;e++)this.lineDistances.push(w[e]);var _=t.boundingBox;null!==_&&(this.boundingBox=_.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Fn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Fn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new gn),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new We),e[n++]=o.x,e[n++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new Ye),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new on),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(Un.prototype=Object.create(Fn.prototype)).constructor=Un,(kn.prototype=Object.create(Fn.prototype)).constructor=kn,(jn.prototype=Object.create(Fn.prototype)).constructor=jn,(Bn.prototype=Object.create(Fn.prototype)).constructor=Bn,(zn.prototype=Object.create(Fn.prototype)).constructor=zn,(Vn.prototype=Object.create(Fn.prototype)).constructor=Vn,(Gn.prototype=Object.create(Fn.prototype)).constructor=Gn,(Hn.prototype=Object.create(Fn.prototype)).constructor=Hn,(Wn.prototype=Object.create(Fn.prototype)).constructor=Wn,Object.assign(Xn.prototype,{computeGroups:function(t){for(var e,n=[],r=void 0,i=t.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,n.push(e)),e={start:3*o,materialIndex:r})}void 0!==e&&(e.count=3*o-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e,n=t.faces,r=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=t.morphTargets,c=s.length;if(c>0){e=[];for(var u=0;u<c;u++)e[u]=[];this.morphTargets.position=e}var l,h=t.morphNormals,d=h.length;if(d>0){for(l=[],u=0;u<d;u++)l[u]=[];this.morphTargets.normal=l}var p=t.skinIndices,f=t.skinWeights,m=p.length===r.length,v=f.length===r.length;for(u=0;u<n.length;u++){var g=n[u];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=g.normal;this.normals.push(b,b,b)}var x,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}!0===o&&(void 0!==(x=i[0][u])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new We,new We,new We))),!0===a&&(void 0!==(x=i[1][u])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new We,new We,new We)));for(var S=0;S<c;S++){var T=s[S].vertices;e[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[u];l[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Yn=1;function Zn(){Object.defineProperty(this,"id",{value:Yn+=2}),this.uuid=He.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Jn(t,e,n,r,i,o){Dn.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Qn(t,e,n,r,i,o)),this.mergeVertices()}function Qn(t,e,n,r,i,o){Zn.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};var a=this;t=t||1,e=e||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1;var s=[],c=[],u=[],l=[],h=0,d=0;function p(t,e,n,r,i,o,p,f,m,v,g){var y,b,x=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new Ye;for(b=0;b<A;b++){var O=b*w-S;for(y=0;y<M;y++)P[t]=(y*x-_)*r,P[e]=O*i,P[n]=T,c.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[n]=f>0?1:-1,u.push(P.x,P.y,P.z),l.push(y/m),l.push(1-b/v),E+=1}for(b=0;b<v;b++)for(y=0;y<m;y++){var N=h+y+M*(b+1),L=h+(y+1)+M*(b+1),I=h+(y+1)+M*b;s.push(h+y+M*b,N,I),s.push(N,L,I),C+=6}a.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,n,e,t,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,n,e,-t,o,i,1),p("x","z","y",1,1,t,n,e,r,o,2),p("x","z","y",1,-1,t,n,-e,r,o,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(s),this.addAttribute("position",new Hn(c,3)),this.addAttribute("normal",new Hn(u,3)),this.addAttribute("uv",new Hn(l,2))}function Kn(t,e,n,r){Dn.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new $n(t,e,n,r)),this.mergeVertices()}function $n(t,e,n,r){Zn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};var i,o,a=(t=t||1)/2,s=(e=e||1)/2,c=Math.floor(n)||1,u=Math.floor(r)||1,l=c+1,h=u+1,d=t/c,p=e/u,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-s;for(i=0;i<l;i++)m.push(i*d-a,-y,0),v.push(0,0,1),g.push(i/c),g.push(1-o/u)}for(o=0;o<u;o++)for(i=0;i<c;i++){var b=i+l*(o+1),x=i+1+l*(o+1),w=i+1+l*o;f.push(i+l*o,b,w),f.push(b,x,w)}this.setIndex(f),this.addAttribute("position",new Hn(m,3)),this.addAttribute("normal",new Hn(v,3)),this.addAttribute("uv",new Hn(g,2))}Zn.prototype=Object.assign(Object.create(r.prototype),{constructor:Zn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){this.index=Array.isArray(t)?new(qn(t)>65535?Gn:zn)(t,1):t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new Fn(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var n=this.attributes.normal;return void 0!==n&&((new Ze).getNormalMatrix(t).applyToBufferAttribute(n),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new Xe;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Xe;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Xe;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Xe;return function(e,n,r){return t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new Xe;return function(e,n,r){return t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t=new Cn;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new Ye;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var n=new Hn(3*e.vertices.length,3),r=new Hn(3*e.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(e.vertices)),this.addAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new Hn(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Hn(e,3)),this},updateFromObject:function(t){var e,n=t.geometry;if(t.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(n.vertices),e.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(n.normals),e.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(n.colors),e.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(n.uvs),e.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(n.lineDistances),e.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Xn).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new Fn(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.addAttribute("normal",new Fn(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(3*t.colors.length);this.addAttribute("color",new Fn(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new Fn(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new Fn(o,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var s=[],c=t.morphTargets[a],u=0,l=c.length;u<l;u++){var h=c[u],d=new Hn(3*h.length,3);s.push(d.copyVector3sArray(h))}this.morphAttributes[a]=s}if(t.skinIndices.length>0){var p=new Hn(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new Hn(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new un);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new un,e=new Ye;return function(){null===this.boundingSphere&&(this.boundingSphere=new ln);var n=this.attributes.position;if(n){var r=this.boundingSphere.center;t.setFromBufferAttribute(n),t.getCenter(r);for(var i=0,o=0,a=n.count;o<a;o++)e.x=n.getX(o),e.y=n.getY(o),e.z=n.getZ(o),i=Math.max(i,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,n=this.groups;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new Fn(new Float32Array(r.length),3));else for(var i=e.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;var s,c,u,l=e.normal.array,h=new Ye,d=new Ye,p=new Ye,f=new Ye,m=new Ye;if(t){var v=t.array;0===n.length&&this.addGroup(0,v.length);for(var g=0,y=n.length;g<y;++g){var b=n[g],x=b.start;for(o=x,a=x+b.count;o<a;o+=3)c=3*v[o+1],u=3*v[o+2],h.fromArray(r,s=3*v[o+0]),d.fromArray(r,c),p.fromArray(r,u),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),l[s]+=f.x,l[s+1]+=f.y,l[s+2]+=f.z,l[c]+=f.x,l[c+1]+=f.y,l[c+2]+=f.z,l[u]+=f.x,l[u+1]+=f.y,l[u+2]+=f.z}}else for(o=0,a=r.length;o<a;o+=9)h.fromArray(r,o),d.fromArray(r,o+3),p.fromArray(r,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),l[o]=f.x,l[o+1]=f.y,l[o+2]=f.z,l[o+3]=f.x,l[o+4]=f.y,l[o+5]=f.z,l[o+6]=f.x,l[o+7]=f.y,l[o+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var i=n[r].array,o=t.attributes[r],a=o.array,s=0,c=o.itemSize*e;s<a.length;s++,c++)i[c]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){var t=new Ye;return function(){for(var e=this.attributes.normal,n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.normalize(),e.setXYZ(n,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Zn,e=this.index.array,n=this.attributes;for(var r in n){for(var i=n[r],o=i.array,a=i.itemSize,s=new o.constructor(e.length*a),c=0,u=0,l=0,h=e.length;l<h;l++){c=e[l]*a;for(var d=0;d<a;d++)s[u++]=o[c++]}t.addAttribute(r,new Fn(s,a))}var p=this.groups;for(l=0,h=p.length;l<h;l++){var f=p[l];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;if(null!==r){var i=Array.prototype.slice.call(r.array);t.data.index={type:r.array.constructor.name,array:i}}var o=this.attributes;for(var n in o){var a=o[n];i=Array.prototype.slice.call(a.array),t.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:i,normalized:a.normalized}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var c=this.boundingSphere;return null!==c&&(t.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),t},clone:function(){return(new Zn).copy(this)},copy:function(t){var e,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o)this.addAttribute(e,o[e].clone());var a=t.morphAttributes;for(e in a){var s=[],c=a[e];for(n=0,r=c.length;n<r;n++)s.push(c[n].clone());this.morphAttributes[e]=s}var u=t.groups;for(n=0,r=u.length;n<r;n++){var l=u[n];this.addGroup(l.start,l.count,l.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Jn.prototype=Object.create(Dn.prototype)).constructor=Jn,(Qn.prototype=Object.create(Zn.prototype)).constructor=Qn,(Kn.prototype=Object.create(Dn.prototype)).constructor=Kn,($n.prototype=Object.create(Zn.prototype)).constructor=$n;var tr,er,nr,rr,ir,or,ar,sr=0;function cr(){Object.defineProperty(this,"id",{value:sr++}),this.uuid=He.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=I,this.side=T,this.flatShading=!1,this.vertexColors=P,this.opacity=1,this.transparent=!1,this.blendSrc=q,this.blendDst=Y,this.blendEquation=k,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=rt,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function ur(t){cr.call(this),this.type="MeshBasicMaterial",this.color=new gn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ct,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function lr(t){cr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function hr(t,e){this.origin=void 0!==t?t:new Ye,this.direction=void 0!==e?e:new Ye}function dr(t,e){this.start=void 0!==t?t:new Ye,this.end=void 0!==e?e:new Ye}function pr(t,e,n){this.a=void 0!==t?t:new Ye,this.b=void 0!==e?e:new Ye,this.c=void 0!==n?n:new Ye}function fr(t,e){Cn.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Zn,this.material=void 0!==e?e:new ur({color:16777215*Math.random()}),this.drawMode=Ne,this.updateMorphTargets()}function mr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function vr(t,e,n,r,i,o,a,s,c,u){rn.call(this,t=void 0!==t?t:[],e=void 0!==e?e:gt,n,r,i,o,a,s,c,u),this.flipY=!1}cr.prototype=Object.assign(Object.create(r.prototype),{constructor:cr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n)if("shading"!==e){var r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]="overdraw"===e?Number(n):n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===E;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==I&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==T&&(n.side=this.side),this.vertexColors!==P&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){var i=r(t.textures),o=r(t.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,n=null;if(null!==e){var r=e.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(ur.prototype=Object.create(cr.prototype)).constructor=ur,ur.prototype.isMeshBasicMaterial=!0,ur.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},(lr.prototype=Object.create(cr.prototype)).constructor=lr,lr.prototype.isShaderMaterial=!0,lr.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=mn.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},lr.prototype.toJSON=function(t){var e=cr.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Object.assign(hr.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Ye),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new Ye;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Ye),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new Ye;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:(er=new Ye,nr=new Ye,rr=new Ye,function(t,e,n,r){er.copy(t).add(e).multiplyScalar(.5),nr.copy(e).sub(t).normalize(),rr.copy(this.origin).sub(er);var i,o,a,s,c=.5*t.distanceTo(e),u=-this.direction.dot(nr),l=rr.dot(this.direction),h=-rr.dot(nr),d=rr.lengthSq(),p=Math.abs(1-u*u);if(p>0)if(o=u*l-h,s=c*p,(i=u*h-l)>=0)if(o>=-s)if(o<=s){var f=1/p;a=(i*=f)*(i+u*(o*=f)+2*l)+o*(u*i+o+2*h)+d}else o=c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+d;else o=-c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+d;else o<=-s?a=-(i=Math.max(0,-(-u*c+l)))*i+(o=i>0?-c:Math.min(Math.max(-c,-h),c))*(o+2*h)+d:o<=s?(i=0,a=(o=Math.min(Math.max(-c,-h),c))*(o+2*h)+d):a=-(i=Math.max(0,-(u*c+l)))*i+(o=i>0?c:Math.min(Math.max(-c,-h),c))*(o+2*h)+d;else o=u>0?-c:c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(nr).multiplyScalar(o).add(er),a}),intersectSphere:function(){var t=new Ye;return function(e,n){t.subVectors(e.center,this.origin);var r=t.dot(this.direction),i=t.dot(t)-r*r,o=e.radius*e.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=r-a,c=r+a;return s<0&&c<0?null:this.at(s<0?c:s,n)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var n,r,i,o,a,s,c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,h=this.origin;return c>=0?(n=(t.min.x-h.x)*c,r=(t.max.x-h.x)*c):(n=(t.max.x-h.x)*c,r=(t.min.x-h.x)*c),u>=0?(i=(t.min.y-h.y)*u,o=(t.max.y-h.y)*u):(i=(t.max.y-h.y)*u,o=(t.min.y-h.y)*u),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),l>=0?(a=(t.min.z-h.z)*l,s=(t.max.z-h.z)*l):(a=(t.max.z-h.z)*l,s=(t.min.z-h.z)*l),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))},intersectsBox:(tr=new Ye,function(t){return null!==this.intersectBox(t,tr)}),intersectTriangle:function(){var t=new Ye,e=new Ye,n=new Ye,r=new Ye;return function(i,o,a,s,c){e.subVectors(o,i),n.subVectors(a,i),r.crossVectors(e,n);var u,l=this.direction.dot(r);if(l>0){if(s)return null;u=1}else{if(!(l<0))return null;u=-1,l=-l}t.subVectors(this.origin,i);var h=u*this.direction.dot(n.crossVectors(t,n));if(h<0)return null;var d=u*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>l)return null;var p=-u*t.dot(r);return p<0?null:this.at(p/l,c)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(dr.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Ye),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Ye),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Ye),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(ir=new Ye,or=new Ye,function(t,e){ir.subVectors(t,this.start),or.subVectors(this.end,this.start);var n=or.dot(or),r=or.dot(ir)/n;return e&&(r=He.clamp(r,0,1)),r}),closestPointToPoint:function(t,e,n){var r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Ye),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(pr,{getNormal:(ar=new Ye,function(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Ye),r.subVectors(n,e),ar.subVectors(t,e),r.cross(ar);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}),getBarycoord:function(){var t=new Ye,e=new Ye,n=new Ye;return function(r,i,o,a,s){t.subVectors(a,i),e.subVectors(o,i),n.subVectors(r,i);var c=t.dot(t),u=t.dot(e),l=t.dot(n),h=e.dot(e),d=e.dot(n),p=c*h-u*u;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Ye),0===p)return s.set(-2,-1,-1);var f=1/p,m=(h*l-u*d)*f,v=(c*d-u*l)*f;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var t=new Ye;return function(e,n,r,i){return pr.getBarycoord(e,n,r,i,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}()}),Object.assign(pr.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new Ye,e=new Ye;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Ye),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return pr.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ye),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return pr.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return pr.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new hn,e=[new dr,new dr,new dr],n=new Ye,r=new Ye;return function(i,o){void 0===o&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new Ye);var a=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(i,n),!0===this.containsPoint(n))o.copy(n);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var s=0;s<e.length;s++){e[s].closestPointToPoint(n,!0,r);var c=n.distanceToSquared(r);c<a&&(a=c,o.copy(r))}}return o}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),fr.prototype=Object.assign(Object.create(Cn.prototype),{constructor:fr,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return Cn.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)n=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{var s=r.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)n=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}},raycast:function(){var t=new Xe,e=new hr,n=new ln,r=new Ye,i=new Ye,o=new Ye,a=new Ye,s=new Ye,c=new Ye,u=new We,l=new We,h=new We,d=new Ye,p=new Ye,f=new Ye;function m(t,e,n,r,i,o,a){return pr.getBarycoord(t,e,n,r,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),a.multiplyScalar(d.z),i.add(o).add(a),i.clone()}function v(t,e,n,r,i,o,a,s){if(null===(e.side===M?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,e.side!==A,s)))return null;f.copy(s),f.applyMatrix4(t.matrixWorld);var c=n.ray.origin.distanceTo(f);return c<n.near||c>n.far?null:{distance:c,point:f.clone(),object:t}}function g(t,e,n,a,s,c,d,f){r.fromBufferAttribute(a,c),i.fromBufferAttribute(a,d),o.fromBufferAttribute(a,f);var g=v(t,t.material,e,n,r,i,o,p);if(g){s&&(u.fromBufferAttribute(s,c),l.fromBufferAttribute(s,d),h.fromBufferAttribute(s,f),g.uv=m(p,r,i,o,u,l,h));var y=new Nn(c,d,f);pr.getNormal(r,i,o,y.normal),g.face=y,g.faceIndex=c}return g}return function(d,f){var y,b=this.geometry,x=this.material,w=this.matrixWorld;if(void 0!==x&&(null===b.boundingSphere&&b.computeBoundingSphere(),n.copy(b.boundingSphere),n.applyMatrix4(w),!1!==d.ray.intersectsSphere(n)&&(t.getInverse(w),e.copy(d.ray).applyMatrix4(t),null===b.boundingBox||!1!==e.intersectsBox(b.boundingBox))))if(b.isBufferGeometry){var _,S,T,M,A,E=b.index,C=b.attributes.position,P=b.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(y=g(this,d,e,C,P,_,S,T))&&(y.faceIndex=Math.floor(M/3),f.push(y));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(y=g(this,d,e,C,P,_=M,S=M+1,T=M+2))&&(y.index=_,f.push(y))}else if(b.isGeometry){var O,N,L,I,R=Array.isArray(x),D=b.vertices,F=b.faces,U=b.faceVertexUvs[0];U.length>0&&(I=U);for(var k=0,j=F.length;k<j;k++){var B=F[k],z=R?x[B.materialIndex]:x;if(void 0!==z){if(O=D[B.a],N=D[B.b],L=D[B.c],!0===z.morphTargets){var V=b.morphTargets,G=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var q=V[H].vertices;r.addScaledVector(a.subVectors(q[B.a],O),X),i.addScaledVector(s.subVectors(q[B.b],N),X),o.addScaledVector(c.subVectors(q[B.c],L),X)}}r.add(O),i.add(N),o.add(L),O=r,N=i,L=o}if(y=v(this,z,d,e,O,N,L,p)){if(I&&I[k]){var Y=I[k];u.copy(Y[0]),l.copy(Y[1]),h.copy(Y[2]),y.uv=m(p,O,N,L,u,l,h)}y.face=B,y.faceIndex=k,f.push(y)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(vr.prototype=Object.create(rn.prototype)).constructor=vr,vr.prototype.isCubeTexture=!0,Object.defineProperty(vr.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var gr=new rn,yr=new vr;function br(){this.seq=[],this.map={}}var xr=[],wr=[],_r=new Float32Array(16),Sr=new Float32Array(9);function Tr(t,e,n){var r=t[0];if(r<=0||r>0)return t;var i=e*n,o=xr[i];if(void 0===o&&(o=new Float32Array(i),xr[i]=o),0!==e){r.toArray(o,0);for(var a=1,s=0;a!==e;++a)t[a].toArray(o,s+=n)}return o}function Mr(t,e){var n=wr[e];void 0===n&&(n=new Int32Array(e),wr[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocTextureUnit();return n}function Ar(t,e){t.uniform1f(this.addr,e)}function Er(t,e){t.uniform1i(this.addr,e)}function Cr(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function Pr(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function Or(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function Nr(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function Lr(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(Sr.set(e.elements),t.uniformMatrix3fv(this.addr,!1,Sr))}function Ir(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(_r.set(e.elements),t.uniformMatrix4fv(this.addr,!1,_r))}function Rr(t,e,n){var r=n.allocTextureUnit();t.uniform1i(this.addr,r),n.setTexture2D(e||gr,r)}function Dr(t,e,n){var r=n.allocTextureUnit();t.uniform1i(this.addr,r),n.setTextureCube(e||yr,r)}function Fr(t,e){t.uniform2iv(this.addr,e)}function Ur(t,e){t.uniform3iv(this.addr,e)}function kr(t,e){t.uniform4iv(this.addr,e)}function jr(t,e){t.uniform1fv(this.addr,e)}function Br(t,e){t.uniform1iv(this.addr,e)}function zr(t,e){t.uniform2fv(this.addr,Tr(e,this.size,2))}function Vr(t,e){t.uniform3fv(this.addr,Tr(e,this.size,3))}function Gr(t,e){t.uniform4fv(this.addr,Tr(e,this.size,4))}function Hr(t,e){t.uniformMatrix2fv(this.addr,!1,Tr(e,this.size,4))}function Wr(t,e){t.uniformMatrix3fv(this.addr,!1,Tr(e,this.size,9))}function Xr(t,e){t.uniformMatrix4fv(this.addr,!1,Tr(e,this.size,16))}function qr(t,e,n){var r=e.length,i=Mr(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.setTexture2D(e[o]||gr,i[o])}function Yr(t,e,n){var r=e.length,i=Mr(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.setTextureCube(e[o]||yr,i[o])}function Zr(t,e,n){this.id=t,this.addr=n,this.setValue=function(t){switch(e.type){case 5126:return Ar;case 35664:return Cr;case 35665:return Pr;case 35666:return Or;case 35674:return Nr;case 35675:return Lr;case 35676:return Ir;case 35678:case 36198:return Rr;case 35680:return Dr;case 5124:case 35670:return Er;case 35667:case 35671:return Fr;case 35668:case 35672:return Ur;case 35669:case 35673:return kr}}()}function Jr(t,e,n){this.id=t,this.addr=n,this.size=e.size,this.setValue=function(t){switch(e.type){case 5126:return jr;case 35664:return zr;case 35665:return Vr;case 35666:return Gr;case 35674:return Hr;case 35675:return Wr;case 35676:return Xr;case 35678:return qr;case 35680:return Yr;case 5124:case 35670:return Br;case 35667:case 35671:return Fr;case 35668:case 35672:return Ur;case 35669:case 35673:return kr}}()}function Qr(t){this.id=t,br.call(this)}Qr.prototype.setValue=function(t,e){for(var n=this.seq,r=0,i=n.length;r!==i;++r){var o=n[r];o.setValue(t,e[o.id])}};var Kr=/([\w\d_]+)(\])?(\[|\.)?/g;function $r(t,e){t.seq.push(e),t.map[e.id]=e}function ti(t,e,n){var r=t.name,i=r.length;for(Kr.lastIndex=0;;){var o=Kr.exec(r),a=o[1],s=o[3];if("]"===o[2]&&(a|=0),void 0===s||"["===s&&Kr.lastIndex+2===i){$r(n,void 0===s?new Zr(a,t,e):new Jr(a,t,e));break}var c=n.map[a];void 0===c&&$r(n,c=new Qr(a)),n=c}}function ei(t,e,n){br.call(this),this.renderer=n;for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<r;++i){var o=t.getActiveUniform(e,i);ti(o,t.getUniformLocation(e,o.name),this)}}function ni(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),!1===t.getShaderParameter(r,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(r),function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(n)),r}ei.prototype.setValue=function(t,e,n){var r=this.map[e];void 0!==r&&r.setValue(t,n,this.renderer)},ei.prototype.setOptional=function(t,e,n){var r=e[n];void 0!==r&&this.setValue(t,n,r)},ei.upload=function(t,e,n,r){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,r)}},ei.seqWithValue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var o=t[r];o.id in e&&n.push(o)}return n};var ri=0;function ii(t){switch(t){case Re:return["Linear","( value )"];case De:return["sRGB","( value )"];case Ue:return["RGBE","( value )"];case je:return["RGBM","( value, 7.0 )"];case Be:return["RGBM","( value, 16.0 )"];case ze:return["RGBD","( value, 256.0 )"];case Fe:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function oi(t,e){var n=ii(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function ai(t){return""!==t}function si(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function ci(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function ui(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(t,e){var n=fn[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return ui(n)})}function li(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,n,r){for(var i="",o=parseInt(e);o<parseInt(n);o++)i+=r.replace(/\[ i \]/g,"[ "+o+" ]");return i})}function hi(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function di(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}var pi,fi,mi,vi,gi,yi,bi,xi,wi=0;function _i(t){cr.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ve,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function Si(t){cr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Ye,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Ti(t,e,n){for(var r=new dn,i=new Xe,o=new We,a=new We(n,n),s=new Ye,c=new Ye,u=1,l=2,h=1+(u|l),d=new Array(h),p=new Array(h),f={},m={0:M,1:T,2:A},v=[new Ye(1,0,0),new Ye(-1,0,0),new Ye(0,0,1),new Ye(0,0,-1),new Ye(0,1,0),new Ye(0,-1,0)],g=[new Ye(0,1,0),new Ye(0,1,0),new Ye(0,1,0),new Ye(0,1,0),new Ye(0,0,1),new Ye(0,0,-1)],y=[new on,new on,new on,new on,new on,new on],b=0;b!==h;++b){var x=0!=(b&u),w=0!=(b&l),S=new _i({depthPacking:Ge,morphTargets:x,skinning:w});d[b]=S;var E=new Si({morphTargets:x,skinning:w});p[b]=E}var C=this;function P(e,n,r,i,o,a){var s=e.geometry,c=null,h=d,v=e.customDepthMaterial;if(r&&(h=p,v=e.customDistanceMaterial),v)c=v;else{var g=!1;n.morphTargets&&(s&&s.isBufferGeometry?g=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(g=s.morphTargets&&s.morphTargets.length>0)),e.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var y=0;g&&(y|=u),e.isSkinnedMesh&&n.skinning&&(y|=l),c=h[y]}if(t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var b=c.uuid,x=n.uuid,w=f[b];void 0===w&&(f[b]=w={});var _=w[x];void 0===_&&(_=c.clone(),w[x]=_),c=_}return c.visible=n.visible,c.wireframe=n.wireframe,c.side=null!=n.shadowSide?n.shadowSide:m[n.side],c.clipShadows=n.clipShadows,c.clippingPlanes=n.clippingPlanes,c.clipIntersection=n.clipIntersection,c.wireframeLinewidth=n.wireframeLinewidth,c.linewidth=n.linewidth,r&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(i),c.nearDistance=o,c.farDistance=a),c}function O(n,i,o,a){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var s=e.update(n),u=n.material;if(Array.isArray(u))for(var l=s.groups,h=0,d=l.length;h<d;h++){var p=l[h],f=u[p.materialIndex];if(f&&f.visible){var m=P(n,f,a,c,o.near,o.far);t.renderBufferDirect(o,null,s,m,n,p)}}else u.visible&&(m=P(n,u,a,c,o.near,o.far),t.renderBufferDirect(o,null,s,m,n,null))}for(var v=n.children,g=0,y=v.length;g<y;g++)O(v[g],i,o,a)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_,this.render=function(e,n,u){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==e.length){var l,h=t.state;h.disable(t.context.BLEND),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(var d=0,p=e.length;d<p;d++){var f=e[d],m=f.shadow,b=f&&f.isPointLight;if(void 0!==m){var x=m.camera;if(o.copy(m.mapSize),o.min(a),b){var w=o.x,_=o.y;y[0].set(2*w,_,w,_),y[1].set(0,_,w,_),y[2].set(3*w,_,w,_),y[3].set(w,_,w,_),y[4].set(3*w,0,w,_),y[5].set(w,0,w,_),o.x*=4,o.y*=2}null===m.map&&(m.map=new an(o.x,o.y,{minFilter:Et,magFilter:Et,format:qt}),m.map.texture.name=f.name+".shadowMap",x.updateProjectionMatrix()),m.isSpotLightShadow&&m.update(f);var S=m.map,T=m.matrix;c.setFromMatrixPosition(f.matrixWorld),x.position.copy(c),b?(l=6,T.makeTranslation(-c.x,-c.y,-c.z)):(l=1,s.setFromMatrixPosition(f.target.matrixWorld),x.lookAt(s),x.updateMatrixWorld(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(x.projectionMatrix),T.multiply(x.matrixWorldInverse)),t.setRenderTarget(S),t.clear();for(var M=0;M<l;M++)b&&(s.copy(x.position),s.add(v[M]),x.up.copy(g[M]),x.lookAt(s),x.updateMatrixWorld(),h.viewport(y[M])),i.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),r.setFromMatrix(i),O(n,u,x,b)}else console.warn("THREE.WebGLShadowMap:",f,"has no shadow.")}C.needsUpdate=!1}}}function Mi(t,e,n,r,i,o,a,s,c){rn.call(this,t,e,n,r,i,o,a,s,c),this.needsUpdate=!0}function Ai(t,e){return{convert:function(n){var r;if(n===Tt)return t.REPEAT;if(n===Mt)return t.CLAMP_TO_EDGE;if(n===At)return t.MIRRORED_REPEAT;if(n===Et)return t.NEAREST;if(n===Ct)return t.NEAREST_MIPMAP_NEAREST;if(n===Pt)return t.NEAREST_MIPMAP_LINEAR;if(n===Ot)return t.LINEAR;if(n===Nt)return t.LINEAR_MIPMAP_NEAREST;if(n===Lt)return t.LINEAR_MIPMAP_LINEAR;if(n===It)return t.UNSIGNED_BYTE;if(n===zt)return t.UNSIGNED_SHORT_4_4_4_4;if(n===Vt)return t.UNSIGNED_SHORT_5_5_5_1;if(n===Gt)return t.UNSIGNED_SHORT_5_6_5;if(n===Rt)return t.BYTE;if(n===Dt)return t.SHORT;if(n===Ft)return t.UNSIGNED_SHORT;if(n===Ut)return t.INT;if(n===kt)return t.UNSIGNED_INT;if(n===jt)return t.FLOAT;if(n===Bt&&null!==(r=e.get("OES_texture_half_float")))return r.HALF_FLOAT_OES;if(n===Wt)return t.ALPHA;if(n===Xt)return t.RGB;if(n===qt)return t.RGBA;if(n===Yt)return t.LUMINANCE;if(n===Zt)return t.LUMINANCE_ALPHA;if(n===Qt)return t.DEPTH_COMPONENT;if(n===Kt)return t.DEPTH_STENCIL;if(n===k)return t.FUNC_ADD;if(n===j)return t.FUNC_SUBTRACT;if(n===B)return t.FUNC_REVERSE_SUBTRACT;if(n===G)return t.ZERO;if(n===H)return t.ONE;if(n===W)return t.SRC_COLOR;if(n===X)return t.ONE_MINUS_SRC_COLOR;if(n===q)return t.SRC_ALPHA;if(n===Y)return t.ONE_MINUS_SRC_ALPHA;if(n===Z)return t.DST_ALPHA;if(n===J)return t.ONE_MINUS_DST_ALPHA;if(n===Q)return t.DST_COLOR;if(n===K)return t.ONE_MINUS_DST_COLOR;if(n===$)return t.SRC_ALPHA_SATURATE;if((n===$t||n===te||n===ee||n===ne)&&null!==(r=e.get("WEBGL_compressed_texture_s3tc"))){if(n===$t)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===te)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===ee)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ne)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((n===re||n===ie||n===oe||n===ae)&&null!==(r=e.get("WEBGL_compressed_texture_pvrtc"))){if(n===re)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===ie)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===oe)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===ae)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===se&&null!==(r=e.get("WEBGL_compressed_texture_etc1")))return r.COMPRESSED_RGB_ETC1_WEBGL;if((n===ce||n===ue||n===le||n===he||n===de||n===pe||n===fe||n===me||n===ve||n===ge||n===ye||n===be||n===xe||n===we)&&null!==(r=e.get("WEBGL_compressed_texture_astc")))return n;if((n===z||n===V)&&null!==(r=e.get("EXT_blend_minmax"))){if(n===z)return r.MIN_EXT;if(n===V)return r.MAX_EXT}return n===Ht&&null!==(r=e.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:0}}}function Ei(t,e,n,r){Pn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Ci(t){Ei.call(this),this.cameras=t||[]}function Pi(t){var e=this,n=null,r=null,i=null,o=new Xe,a=new Xe;"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData);var s=new Xe,c=new qe,u=new Ye,l=new Ei;l.bounds=new on(0,0,.5,1),l.layers.enable(1);var h=new Ei;h.bounds=new on(.5,0,.5,1),h.layers.enable(2);var d,p,f=new Ci([l,h]);function m(){if(null!==n&&n.isPresenting){var r=n.getEyeParameters("left"),i=r.renderWidth,o=r.renderHeight;p=t.getPixelRatio(),d=t.getSize(),t.setDrawingBufferSize(2*i,o,1)}else e.enabled&&t.setDrawingBufferSize(d.width,d.height,p)}f.layers.enable(1),f.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",m,!1),this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return n},this.setDevice=function(t){void 0!==t&&(n=t)},this.setPoseTarget=function(t){void 0!==t&&(i=t)},this.getCamera=function(t){if(null===n)return t;n.depthNear=t.near,n.depthFar=t.far,n.getFrameData(r);var d=n.stageParameters;d?o.fromArray(d.sittingToStandingTransform):o.makeTranslation(0,e.userHeight,0);var p=r.pose,m=null!==i?i:t;if(m.matrix.copy(o),m.matrix.decompose(m.position,m.quaternion,m.scale),null!==p.orientation&&(c.fromArray(p.orientation),m.quaternion.multiply(c)),null!==p.position&&(c.setFromRotationMatrix(o),u.fromArray(p.position),u.applyQuaternion(c),m.position.add(u)),m.updateMatrixWorld(),!1===n.isPresenting)return t;l.near=t.near,h.near=t.near,l.far=t.far,h.far=t.far,f.matrixWorld.copy(t.matrixWorld),f.matrixWorldInverse.copy(t.matrixWorldInverse),l.matrixWorldInverse.fromArray(r.leftViewMatrix),h.matrixWorldInverse.fromArray(r.rightViewMatrix),a.getInverse(o),l.matrixWorldInverse.multiply(a),h.matrixWorldInverse.multiply(a);var v=m.parent;null!==v&&(s.getInverse(v.matrixWorld),l.matrixWorldInverse.multiply(s),h.matrixWorldInverse.multiply(s)),l.matrixWorld.getInverse(l.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),l.projectionMatrix.fromArray(r.leftProjectionMatrix),h.projectionMatrix.fromArray(r.rightProjectionMatrix),f.projectionMatrix.copy(l.projectionMatrix);var g=n.getLayers();if(g.length){var y=g[0];null!==y.leftBounds&&4===y.leftBounds.length&&l.bounds.fromArray(y.leftBounds),null!==y.rightBounds&&4===y.rightBounds.length&&h.bounds.fromArray(y.rightBounds)}return f},this.getStandingMatrix=function(){return o},this.submitFrame=function(){n&&n.isPresenting&&n.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",m)}}function Oi(t){console.log("THREE.WebGLRenderer",p);var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",l=null,h=null;this.domElement=e,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=dt,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,f,y,b,x,w,T,E,C,O,N,k,j,B,z,V,G,H,W,X=this,q=!1,Y=null,Z=null,J=-1,Q="",K=null,$=null,vt=new on,Tt=new on,At=null,Nt=0,Lt=e.width,Rt=e.height,Dt=1,Ut=new on(0,0,Lt,Rt),zt=new on(0,0,Lt,Rt),Vt=!1,Gt=new dn,Wt=new function(){var t=this,e=null,n=0,r=!1,i=!1,o=new hn,a=new Ze,s={value:null,needsUpdate:!1};function c(){s.value!==e&&(s.value=e,s.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function u(e,n,r,i){var c=null!==e?e.length:0,u=null;if(0!==c){if(u=s.value,!0!==i||null===u){var l=r+4*c,h=n.matrixWorldInverse;a.getNormalMatrix(h),(null===u||u.length<l)&&(u=new Float32Array(l));for(var d=0,p=r;d!==c;++d,p+=4)o.copy(e[d]).applyMatrix4(h,a),o.normal.toArray(u,p),u[p+3]=o.constant}s.value=u,s.needsUpdate=!0}return t.numPlanes=c,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,o){var a=0!==t.length||i||0!==n||r;return r=i,e=u(t,o,0),n=t.length,a},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,c()},this.setState=function(t,o,a,l,h,d){if(!r||null===t||0===t.length||i&&!a)i?u(null):c();else{var p=i?0:n,f=4*p,m=h.clippingState||null;s.value=m,m=u(t,l,f,d);for(var v=0;v!==f;++v)m[v]=e[v];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}},Yt=!1,Zt=!1,Jt=new Xe,$t=new Ye;function te(){return null===Y?Dt:1}try{var ee={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:u};if(e.addEventListener("webglcontextlost",oe,!1),e.addEventListener("webglcontextrestored",ae,!1),null===(d=n||e.getContext("webgl",ee)||e.getContext("experimental-webgl",ee)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){console.error("THREE.WebGLRenderer: "+t.message)}function ne(){(f=new function(t){var e={};return{get:function(n){if(void 0!==e[n])return e[n];var r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":r=t.getExtension("WEBGL_compressed_texture_etc1");break;default:r=t.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=r,r}}}(d)).get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_float_linear"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays"),W=new Ai(d,f),y=new function(t,e,n){var r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o=void 0!==n.precision?n.precision:"highp",a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);var s=!0===n.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=t.getParameter(t.MAX_TEXTURE_SIZE),h=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),d=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),f=t.getParameter(t.MAX_VARYING_VECTORS),m=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,g=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==r)return r;var n=e.get("EXT_texture_filter_anisotropic");return r=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:s,maxTextures:c,maxVertexTextures:u,maxTextureSize:l,maxCubemapSize:h,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:g,floatVertexTextures:v&&g}}(d,f,t),(b=new function(t,e,n){var r=new function(){var e=!1,n=new on,r=null,i=new on(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,a,s){!0===s&&(e*=a,r*=a,o*=a),n.set(e,r,o,a),!1===i.equals(n)&&(t.clearColor(e,r,o,a),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},i=new function(){var e=!1,n=null,r=null,i=null;return{setTest:function(e){e?q(t.DEPTH_TEST):Y(t.DEPTH_TEST)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case tt:t.depthFunc(t.NEVER);break;case et:t.depthFunc(t.ALWAYS);break;case nt:t.depthFunc(t.LESS);break;case rt:t.depthFunc(t.LEQUAL);break;case it:t.depthFunc(t.EQUAL);break;case ot:t.depthFunc(t.GEQUAL);break;case at:t.depthFunc(t.GREATER);break;case st:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},o=new function(){var e=!1,n=null,r=null,i=null,o=null,a=null,s=null,c=null,u=null;return{setTest:function(e){e?q(t.STENCIL_TEST):Y(t.STENCIL_TEST)},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,a){r===e&&i===n&&o===a||(t.stencilFunc(e,n,a),r=e,i=n,o=a)},setOp:function(e,n,r){a===e&&s===n&&c===r||(t.stencilOp(e,n,r),a=e,s=n,c=r)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,a=null,s=null,c=null,u=null}}},a=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=new Uint8Array(a),c=new Uint8Array(a),u=new Uint8Array(a),l={},h=null,d=null,p=null,f=null,y=null,b=null,x=null,w=null,_=null,S=!1,T=null,E=null,C=null,P=null,O=null,N=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),k=!1,j=0,B=t.getParameter(t.VERSION);-1!==B.indexOf("WebGL")?(j=parseFloat(/^WebGL\ ([0-9])/.exec(B)[1]),k=j>=1):-1!==B.indexOf("OpenGL ES")&&(j=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(B)[1]),k=j>=2);var z=null,V={},G=new on,H=new on;function W(e,n,r){var i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var a=0;a<r;a++)t.texImage2D(n+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i);return o}var X={};function q(e){!0!==l[e]&&(t.enable(e),l[e]=!0)}function Y(e){!1!==l[e]&&(t.disable(e),l[e]=!1)}function Z(e,r,i,o,a,s,c,u){if(e!==L?q(t.BLEND):Y(t.BLEND),e!==U){if(e!==p||u!==S)switch(e){case R:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE));break;case D:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR));break;case F:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR));break;default:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA))}f=null,y=null,b=null,x=null,w=null,_=null}else a=a||r,s=s||i,c=c||o,r===f&&a===x||(t.blendEquationSeparate(n.convert(r),n.convert(a)),f=r,x=a),i===y&&o===b&&s===w&&c===_||(t.blendFuncSeparate(n.convert(i),n.convert(o),n.convert(s),n.convert(c)),y=i,b=o,w=s,_=c);p=e,S=u}function J(e){T!==e&&(t.frontFace(e?t.CW:t.CCW),T=e)}function Q(e){e!==m?(q(t.CULL_FACE),e!==E&&t.cullFace(e===v?t.BACK:e===g?t.FRONT:t.FRONT_AND_BACK)):Y(t.CULL_FACE),E=e}function K(e,n,r){e?(q(t.POLYGON_OFFSET_FILL),P===n&&O===r||(t.polygonOffset(n,r),P=n,O=r)):Y(t.POLYGON_OFFSET_FILL)}function $(e){void 0===e&&(e=t.TEXTURE0+N-1),z!==e&&(t.activeTexture(e),z=e)}return X[t.TEXTURE_2D]=W(t.TEXTURE_2D,t.TEXTURE_2D,1),X[t.TEXTURE_CUBE_MAP]=W(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),r.setClear(0,0,0,1),i.setClear(1),o.setClear(0),q(t.DEPTH_TEST),i.setFunc(rt),J(!1),Q(v),q(t.CULL_FACE),q(t.BLEND),Z(I),{buffers:{color:r,depth:i,stencil:o},initAttributes:function(){for(var t=0,e=s.length;t<e;t++)s[t]=0},enableAttribute:function(n){s[n]=1,0===c[n]&&(t.enableVertexAttribArray(n),c[n]=1),0!==u[n]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(n,0),u[n]=0)},enableAttributeAndDivisor:function(n,r){s[n]=1,0===c[n]&&(t.enableVertexAttribArray(n),c[n]=1),u[n]!==r&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(n,r),u[n]=r)},disableUnusedAttributes:function(){for(var e=0,n=c.length;e!==n;++e)c[e]!==s[e]&&(t.disableVertexAttribArray(e),c[e]=0)},enable:q,disable:Y,getCompressedTextureFormats:function(){if(null===h&&(h=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")||e.get("WEBGL_compressed_texture_astc")))for(var n=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),r=0;r<n.length;r++)h.push(n[r]);return h},useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:Z,setMaterial:function(e,n){e.side===A?Y(t.CULL_FACE):q(t.CULL_FACE);var o=e.side===M;n&&(o=!o),J(o),!0===e.transparent?Z(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):Z(L),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),r.setMask(e.colorWrite),K(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:J,setCullFace:Q,setLineWidth:function(e){e!==C&&(k&&t.lineWidth(e),C=e)},setPolygonOffset:K,setScissorTest:function(e){e?q(t.SCISSOR_TEST):Y(t.SCISSOR_TEST)},activeTexture:$,bindTexture:function(e,n){null===z&&$();var r=V[z];void 0===r&&(V[z]=r={type:void 0,texture:void 0}),r.type===e&&r.texture===n||(t.bindTexture(e,n||X[e]),r.type=e,r.texture=n)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===G.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),G.copy(e))},viewport:function(e){!1===H.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),H.copy(e))},reset:function(){for(var e=0;e<c.length;e++)1===c[e]&&(t.disableVertexAttribArray(e),c[e]=0);l={},h=null,z=null,V={},d=null,p=null,T=null,E=null,r.reset(),i.reset(),o.reset()}}}(d,f,W)).scissor(Tt.copy(zt).multiplyScalar(Dt)),b.viewport(vt.copy(Ut).multiplyScalar(Dt)),x=new function(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,r,i){switch(i=i||1,e.calls++,r){case t.TRIANGLES:e.triangles+=i*(n/3);break;case t.TRIANGLE_STRIP:case t.TRIANGLE_FAN:e.triangles+=i*(n-2);break;case t.LINES:e.lines+=i*(n/2);break;case t.LINE_STRIP:e.lines+=i*(n-1);break;case t.LINE_LOOP:e.lines+=i*n;break;case t.POINTS:e.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}(d),w=new function(){var t=new WeakMap;return{get:function(e){var n=t.get(e);return void 0===n&&t.set(e,n={}),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}},T=new function(t,e,n,r,i,o,a){var s,c="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,u={};function l(t,e){if(t.width>e||t.height>e){if("data"in t)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+t.width+"x"+t.height+").");var n=e/Math.max(t.width,t.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=Math.floor(t.width*n),r.height=Math.floor(t.height*n),r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+r.width+"x"+r.height,t),r}return t}function h(t){return He.isPowerOfTwo(t.width)&&He.isPowerOfTwo(t.height)}function d(t,e){return t.generateMipmaps&&e&&t.minFilter!==Et&&t.minFilter!==Ot}function p(e,n,i,o){t.generateMipmap(e),r.get(n).__maxMipLevel=Math.log2(Math.max(i,o))}function f(e){return e===Et||e===Ct||e===Pt?t.NEAREST:t.LINEAR}function m(e){var n=e.target;n.removeEventListener("dispose",m),function(e){var n=r.get(e);if(e.image&&n.__image__webglTextureCube)t.deleteTexture(n.__image__webglTextureCube);else{if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture)}r.remove(e)}(n),n.isVideoTexture&&delete u[n.id],a.memory.textures--}function v(e){var n=e.target;n.removeEventListener("dispose",v),function(e){var n=r.get(e),i=r.get(e.texture);if(e){if(void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(var o=0;o<6;o++)t.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[o]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer);r.remove(e.texture),r.remove(e)}}(n),a.memory.textures--}function g(e,f){var v=r.get(e);if(e.isVideoTexture&&function(t){var e=t.id,n=a.render.frame;u[e]!==n&&(u[e]=n,t.update())}(e),e.version>0&&v.__version!==e.version){var g=e.image;if(void 0===g)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else{if(!1!==g.complete)return void function(e,r,u){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",m),e.__webglTexture=t.createTexture(),a.memory.textures++),n.activeTexture(t.TEXTURE0+u),n.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment);var f=l(r.image,i.maxTextureSize);(function(t){return t.wrapS!==Mt||t.wrapT!==Mt||t.minFilter!==Et&&t.minFilter!==Ot})(r)&&!1===h(f)&&(f=function(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap?(void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=He.floorPowerOfTwo(t.width),s.height=He.floorPowerOfTwo(t.height),s.getContext("2d").drawImage(t,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+s.width+"x"+s.height,t),s):t}(f));var v=h(f),g=o.convert(r.format),b=o.convert(r.type);y(t.TEXTURE_2D,r,v);var x,w=r.mipmaps;if(r.isDepthTexture){var _=t.DEPTH_COMPONENT;if(r.type===jt){if(!c)throw new Error("Float Depth Texture only supported in WebGL2.0");_=t.DEPTH_COMPONENT32F}else c&&(_=t.DEPTH_COMPONENT16);r.format===Qt&&_===t.DEPTH_COMPONENT&&r.type!==Ft&&r.type!==kt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ft,b=o.convert(r.type)),r.format===Kt&&(_=t.DEPTH_STENCIL,r.type!==Ht&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ht,b=o.convert(r.type))),n.texImage2D(t.TEXTURE_2D,0,_,f.width,f.height,0,g,b,null)}else if(r.isDataTexture)if(w.length>0&&v){for(var S=0,T=w.length;S<T;S++)n.texImage2D(t.TEXTURE_2D,S,g,(x=w[S]).width,x.height,0,g,b,x.data);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(t.TEXTURE_2D,0,g,f.width,f.height,0,g,b,f.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(S=0,T=w.length;S<T;S++)x=w[S],r.format!==qt&&r.format!==Xt?n.getCompressedTextureFormats().indexOf(g)>-1?n.compressedTexImage2D(t.TEXTURE_2D,S,g,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(t.TEXTURE_2D,S,g,x.width,x.height,0,g,b,x.data);e.__maxMipLevel=w.length-1}else if(w.length>0&&v){for(S=0,T=w.length;S<T;S++)n.texImage2D(t.TEXTURE_2D,S,g,g,b,x=w[S]);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(t.TEXTURE_2D,0,g,g,b,f),e.__maxMipLevel=0;d(r,v)&&p(t.TEXTURE_2D,r,f.width,f.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(v,e,f);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e)}}n.activeTexture(t.TEXTURE0+f),n.bindTexture(t.TEXTURE_2D,v.__webglTexture)}function y(n,a,s){var c;if(s?(t.texParameteri(n,t.TEXTURE_WRAP_S,o.convert(a.wrapS)),t.texParameteri(n,t.TEXTURE_WRAP_T,o.convert(a.wrapT)),t.texParameteri(n,t.TEXTURE_MAG_FILTER,o.convert(a.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,o.convert(a.minFilter))):(t.texParameteri(n,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(n,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),a.wrapS===Mt&&a.wrapT===Mt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",a),t.texParameteri(n,t.TEXTURE_MAG_FILTER,f(a.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,f(a.minFilter)),a.minFilter!==Et&&a.minFilter!==Ot&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",a)),c=e.get("EXT_texture_filter_anisotropic")){if(a.type===jt&&null===e.get("OES_texture_float_linear"))return;if(a.type===Bt&&null===e.get("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(t.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function b(e,i,a,s){var c=o.convert(i.texture.format),u=o.convert(i.texture.type);n.texImage2D(s,0,c,i.width,i.height,0,c,u,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,a,s,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function x(e,n){t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):n.depthBuffer&&n.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,n.width,n.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}this.setTexture2D=g,this.setTextureCube=function(e,s){var c=r.get(e);if(6===e.image.length)if(e.version>0&&c.__version!==e.version){c.__image__webglTextureCube||(e.addEventListener("dispose",m),c.__image__webglTextureCube=t.createTexture(),a.memory.textures++),n.activeTexture(t.TEXTURE0+s),n.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var u=e&&e.isCompressedTexture,f=e.image[0]&&e.image[0].isDataTexture,v=[],g=0;g<6;g++)v[g]=u||f?f?e.image[g].image:e.image[g]:l(e.image[g],i.maxCubemapSize);var b=v[0],x=h(b),w=o.convert(e.format),_=o.convert(e.type);for(y(t.TEXTURE_CUBE_MAP,e,x),g=0;g<6;g++)if(u)for(var S,T=v[g].mipmaps,M=0,A=T.length;M<A;M++)S=T[M],e.format!==qt&&e.format!==Xt?n.getCompressedTextureFormats().indexOf(w)>-1?n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,w,_,S.data);else f?n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,v[g].width,v[g].height,0,w,_,v[g].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,w,_,v[g]);c.__maxMipLevel=u?T.length-1:0,d(e,x)&&p(t.TEXTURE_CUBE_MAP,e,b.width,b.height),c.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(t.TEXTURE0+s),n.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,i){n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_CUBE_MAP,r.get(e).__webglTexture)},this.setupRenderTarget=function(e){var i=r.get(e),o=r.get(e.texture);e.addEventListener("dispose",v),o.__webglTexture=t.createTexture(),a.memory.textures++;var s=!0===e.isWebGLRenderTargetCube,c=h(e);if(s){i.__webglFramebuffer=[];for(var u=0;u<6;u++)i.__webglFramebuffer[u]=t.createFramebuffer()}else i.__webglFramebuffer=t.createFramebuffer();if(s){for(n.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture),y(t.TEXTURE_CUBE_MAP,e.texture,c),u=0;u<6;u++)b(i.__webglFramebuffer[u],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+u);d(e.texture,c)&&p(t.TEXTURE_CUBE_MAP,e.texture,e.width,e.height),n.bindTexture(t.TEXTURE_CUBE_MAP,null)}else n.bindTexture(t.TEXTURE_2D,o.__webglTexture),y(t.TEXTURE_2D,e.texture,c),b(i.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),d(e.texture,c)&&p(t.TEXTURE_2D,e.texture,e.width,e.height),n.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&function(e){var n=r.get(e),i=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),g(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Qt)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,i,0);else{if(n.depthTexture.format!==Kt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,i,0)}}(n.__webglFramebuffer,e)}else if(i){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=t.createRenderbuffer(),x(n.__webglDepthbuffer[o],e)}else t.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),x(n.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}(e)},this.updateRenderTargetMipmap=function(e){var i=e.texture;if(d(i,h(e))){var o=e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,a=r.get(i).__webglTexture;n.bindTexture(o,a),p(o,i,e.width,e.height),n.bindTexture(o,null)}}}(d,f,b,w,y,W,x),E=new function(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var r=e.get(n);r&&(t.deleteBuffer(r.buffer),e.delete(n))},update:function(n,r){n.isInterleavedBufferAttribute&&(n=n.data);var i=e.get(n);void 0===i?e.set(n,function(e,n){var r=e.array,i=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,r,i),e.onUploadCallback();var a=t.FLOAT;return r instanceof Float32Array?a=t.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=t.UNSIGNED_SHORT:r instanceof Int16Array?a=t.SHORT:r instanceof Uint32Array?a=t.UNSIGNED_INT:r instanceof Int32Array?a=t.INT:r instanceof Int8Array?a=t.BYTE:r instanceof Uint8Array&&(a=t.UNSIGNED_BYTE),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(n,r)):i.version<n.version&&(function(e,n,r){var o=n.array,a=n.updateRange;t.bindBuffer(r,i.buffer),!1===n.dynamic?t.bufferData(r,o,t.STATIC_DRAW):-1===a.count?t.bufferSubData(r,0,o):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(0,n,r),i.version=n.version)}}}(d),C=new function(t,e,n){var r={},i={};function o(t){var a=t.target,s=r[a.id];for(var c in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[c]);a.removeEventListener("dispose",o),delete r[a.id];var u=i[a.id];u&&(e.remove(u),delete i[a.id]),(u=i[s.id])&&(e.remove(u),delete i[s.id]),n.memory.geometries--}return{get:function(t,e){var i=r[e.id];return i||(e.addEventListener("dispose",o),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Zn).setFromObject(t)),i=e._bufferGeometry),r[e.id]=i,n.memory.geometries++,i)},update:function(n){var r=n.index,i=n.attributes;for(var o in null!==r&&e.update(r,t.ELEMENT_ARRAY_BUFFER),i)e.update(i[o],t.ARRAY_BUFFER);var a=n.morphAttributes;for(var o in a)for(var s=a[o],c=0,u=s.length;c<u;c++)e.update(s[c],t.ARRAY_BUFFER)},getWireframeAttribute:function(n){var r=i[n.id];if(r)return r;var o,a=[],s=n.index,c=n.attributes;if(null!==s)for(var u=0,l=(o=s.array).length;u<l;u+=3)a.push(h=o[u+0],d=o[u+1],d,p=o[u+2],p,h);else for(u=0,l=(o=c.position.array).length/3-1;u<l;u+=3){var h,d,p;a.push(h=u+0,d=u+1,d,p=u+2,p,h)}return r=new(qn(a)>65535?Gn:zn)(a,1),e.update(r,t.ELEMENT_ARRAY_BUFFER),i[n.id]=r,r}}}(d,E,x),O=new function(t,e){var n={};return{update:function(r){var i=e.render.frame,o=r.geometry,a=t.get(r,o);return n[a.id]!==i&&(o.isGeometry&&a.updateFromObject(r),t.update(a),n[a.id]=i),a},dispose:function(){n={}}}}(C,x),z=new function(t){var e={},n=new Float32Array(8);return{update:function(r,i,o,a){var s=r.morphTargetInfluences,c=s.length,u=e[i.id];if(void 0===u){u=[];for(var l=0;l<c;l++)u[l]=[l,0];e[i.id]=u}var h=o.morphTargets&&i.morphAttributes.position,d=o.morphNormals&&i.morphAttributes.normal;for(l=0;l<c;l++)0!==(p=u[l])[1]&&(h&&i.removeAttribute("morphTarget"+l),d&&i.removeAttribute("morphNormal"+l));for(l=0;l<c;l++)(p=u[l])[0]=l,p[1]=s[l];for(u.sort(mr),l=0;l<8;l++){var p;if(p=u[l]){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+l,h[f]),d&&i.addAttribute("morphNormal"+l,d[f]),n[l]=m;continue}}n[l]=0}a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}(d),N=new function(t,e,n){var r=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function a(t,e){var n;return t?t.isTexture?n=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=t.texture.encoding):n=Re,n===Re&&e&&(n=Fe),n}this.getParameters=function(e,r,o,s,c,u,l){var h=i[e.type],d=l.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(n.floatVertexTextures)return 1024;var r=Math.floor((n.maxVertexUniforms-20)/4),i=Math.min(r,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}(l):0,p=n.precision;null!==e.precision&&(p=n.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",p,"instead.");var f=t.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:n.vertexTextures,outputEncoding:a(f?f.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:a(e.map,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:a(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===_t||e.envMap.mapping===St),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:a(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!s,useFog:e.fog,fogExp:s&&s.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:n.logarithmicDepthBuffer,skinning:e.skinning&&d>0,maxBones:d,useVertexTexture:n.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:c,numClipIntersection:u,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&l.receiveShadow&&o.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===A,flipSided:e.side===M,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,n){var r=[];if(n.shaderID?r.push(n.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)r.push(i),r.push(e.defines[i]);for(var a=0;a<o.length;a++)r.push(n[o[a]]);return r.push(e.onBeforeCompile.toString()),r.push(t.gammaOutput),r.join()},this.acquireProgram=function(n,i,o,a){for(var s,c=0,u=r.length;c<u;c++){var l=r[c];if(l.code===a){++(s=l).usedTimes;break}}return void 0===s&&(s=new function(t,e,n,r,i,o){var a=t.context,s=r.defines,c=i.vertexShader,u=i.fragmentShader,l="SHADOWMAP_TYPE_BASIC";o.shadowMapType===_?l="SHADOWMAP_TYPE_PCF":o.shadowMapType===S&&(l="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",p="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(r.envMap.mapping){case gt:case yt:h="ENVMAP_TYPE_CUBE";break;case _t:case St:h="ENVMAP_TYPE_CUBE_UV";break;case bt:case xt:h="ENVMAP_TYPE_EQUIREC";break;case wt:h="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case yt:case xt:d="ENVMAP_MODE_REFRACTION"}switch(r.combine){case ct:p="ENVMAP_BLENDING_MULTIPLY";break;case ut:p="ENVMAP_BLENDING_MIX";break;case lt:p="ENVMAP_BLENDING_ADD"}}var f,m,v,g,y,b=t.gammaFactor>0?t.gammaFactor:1,x=function(t,e,n){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ai).join("\n")}(r.extensions,o,e),w=function(t){var e=[];for(var n in t){var r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),T=a.createProgram();r.isRawShaderMaterial?((f=[w].filter(ai).join("\n")).length>0&&(f+="\n"),(m=[x,w].filter(ai).join("\n")).length>0&&(m+="\n")):(f=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,w,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+b,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ai).join("\n"),m=[x,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,w,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+b,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+h:"",o.envMap?"#define "+d:"",o.envMap?"#define "+p:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&e.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==ht?"#define TONE_MAPPING":"",o.toneMapping!==ht?fn.tonemapping_pars_fragment:"",o.toneMapping!==ht?function(t,e){var n;switch(e){case dt:n="Linear";break;case pt:n="Reinhard";break;case ft:n="Uncharted2";break;case mt:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 toneMapping( vec3 color ) { return "+n+"ToneMapping( color ); }"}(0,o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?fn.encodings_pars_fragment:"",o.mapEncoding?oi("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?oi("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?oi("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?(v="linearToOutputTexel",g=o.outputEncoding,y=ii(g),"vec4 "+v+"( vec4 value ) { return LinearTo"+y[0]+y[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(ai).join("\n")),c=ci(c=si(c=ui(c),o),o),u=ci(u=si(u=ui(u),o),o),c=li(c);var M=m+(u=li(u)),A=ni(a,a.VERTEX_SHADER,f+c),E=ni(a,a.FRAGMENT_SHADER,M);a.attachShader(T,A),a.attachShader(T,E),void 0!==r.index0AttributeName?a.bindAttribLocation(T,0,r.index0AttributeName):!0===o.morphTargets&&a.bindAttribLocation(T,0,"position"),a.linkProgram(T);var C,P,O=a.getProgramInfoLog(T).trim(),N=a.getShaderInfoLog(A).trim(),L=a.getShaderInfoLog(E).trim(),I=!0,R=!0;return!1===a.getProgramParameter(T,a.LINK_STATUS)?(I=!1,console.error("THREE.WebGLProgram: shader error: ",a.getError(),"gl.VALIDATE_STATUS",a.getProgramParameter(T,a.VALIDATE_STATUS),"gl.getProgramInfoLog",O,N,L)):""!==O?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",O):""!==N&&""!==L||(R=!1),R&&(this.diagnostics={runnable:I,material:r,programLog:O,vertexShader:{log:N,prefix:f},fragmentShader:{log:L,prefix:m}}),a.deleteShader(A),a.deleteShader(E),this.getUniforms=function(){return void 0===C&&(C=new ei(a,T,t)),C},this.getAttributes=function(){return void 0===P&&(P=function(t,e){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var o=t.getActiveAttrib(e,i).name;n[o]=t.getAttribLocation(e,o)}return n}(a,T)),P},this.destroy=function(){a.deleteProgram(T),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=ri++,this.code=n,this.usedTimes=1,this.program=T,this.vertexShader=A,this.fragmentShader=E,this}(t,e,a,n,i,o),r.push(s)),s},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=r.indexOf(t);r[e]=r[r.length-1],r.pop(),t.destroy()}},this.programs=r}(X,f,y),k=new function(){var t={};return{get:function(e,n){var r=e.id+","+n.id,i=t[r];return void 0===i&&(i=new function(){var t=[],e=0,n=[],r=[];return{opaque:n,transparent:r,init:function(){e=0,n.length=0,r.length=0},push:function(i,o,a,s,c){var u=t[e];void 0===u?t[e]=u={id:i.id,object:i,geometry:o,material:a,program:a.program,renderOrder:i.renderOrder,z:s,group:c}:(u.id=i.id,u.object=i,u.geometry=o,u.material=a,u.program=a.program,u.renderOrder=i.renderOrder,u.z=s,u.group=c),(!0===a.transparent?r:n).push(u),e++},sort:function(){n.length>1&&n.sort(hi),r.length>1&&r.sort(di)}}},t[r]=i),i},dispose:function(){t={}}}},j=new function(){var t={};return{get:function(e,n){var r=e.id+","+n.id,i=t[r];return void 0===i&&(i=new function(){var t=new function(){var t=new function(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new Ye,color:new gn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new We};break;case"SpotLight":n={position:new Ye,direction:new Ye,color:new gn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new We};break;case"PointLight":n={position:new Ye,color:new gn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new We,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new Ye,skyColor:new gn,groundColor:new gn};break;case"RectAreaLight":n={color:new gn,position:new Ye,halfWidth:new Ye,halfHeight:new Ye}}return t[e.id]=n,n}}},e={id:wi++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=new Ye,r=new Xe,i=new Xe;return{setup:function(o,a,s){for(var c=0,u=0,l=0,h=0,d=0,p=0,f=0,m=0,v=s.matrixWorldInverse,g=0,y=o.length;g<y;g++){var b=o[g],x=b.color,w=b.intensity,_=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=x.r*w,u+=x.g*w,l+=x.b*w;else if(b.isDirectionalLight)(M=t.get(b)).color.copy(b.color).multiplyScalar(b.intensity),M.direction.setFromMatrixPosition(b.matrixWorld),n.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(n),M.direction.transformDirection(v),M.shadow=b.castShadow,b.castShadow&&(M.shadowBias=(T=b.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),e.directionalShadowMap[h]=S,e.directionalShadowMatrix[h]=b.shadow.matrix,e.directional[h]=M,h++;else if(b.isSpotLight)(M=t.get(b)).position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(v),M.color.copy(x).multiplyScalar(w),M.distance=_,M.direction.setFromMatrixPosition(b.matrixWorld),n.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(n),M.direction.transformDirection(v),M.coneCos=Math.cos(b.angle),M.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),M.decay=0===b.distance?0:b.decay,M.shadow=b.castShadow,b.castShadow&&(M.shadowBias=(T=b.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),e.spotShadowMap[p]=S,e.spotShadowMatrix[p]=b.shadow.matrix,e.spot[p]=M,p++;else if(b.isRectAreaLight)(M=t.get(b)).color.copy(x).multiplyScalar(w),M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(v),i.identity(),r.copy(b.matrixWorld),r.premultiply(v),i.extractRotation(r),M.halfWidth.set(.5*b.width,0,0),M.halfHeight.set(0,.5*b.height,0),M.halfWidth.applyMatrix4(i),M.halfHeight.applyMatrix4(i),e.rectArea[f]=M,f++;else if(b.isPointLight){var T;(M=t.get(b)).position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(v),M.color.copy(b.color).multiplyScalar(b.intensity),M.distance=b.distance,M.decay=0===b.distance?0:b.decay,M.shadow=b.castShadow,b.castShadow&&(M.shadowBias=(T=b.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize,M.shadowCameraNear=T.camera.near,M.shadowCameraFar=T.camera.far),e.pointShadowMap[d]=S,e.pointShadowMatrix[d]=b.shadow.matrix,e.point[d]=M,d++}else if(b.isHemisphereLight){var M;(M=t.get(b)).direction.setFromMatrixPosition(b.matrixWorld),M.direction.transformDirection(v),M.direction.normalize(),M.skyColor.copy(b.color).multiplyScalar(w),M.groundColor.copy(b.groundColor).multiplyScalar(w),e.hemi[m]=M,m++}}e.ambient[0]=c,e.ambient[1]=u,e.ambient[2]=l,e.directional.length=h,e.spot.length=p,e.rectArea.length=f,e.point.length=d,e.hemi.length=m,e.hash=e.id+","+h+","+d+","+p+","+f+","+m+","+a.length},state:e}},e=[],n=[],r=[];return{init:function(){e.length=0,n.length=0,r.length=0},state:{lightsArray:e,shadowsArray:n,spritesArray:r,lights:t},setupLights:function(r){t.setup(e,n,r)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)},pushSprite:function(t){r.push(t)}}},t[r]=i),i},dispose:function(){t={}}}},B=new function(t,e,n,r){var i,o,a,s=new gn(0),c=0;function u(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,r)}return{getClearColor:function(){return s},setClearColor:function(t,e){s.set(t),u(s,c=void 0!==e?e:1)},getClearAlpha:function(){return c},setClearAlpha:function(t){u(s,c=t)},render:function(e,r,l,h){var d=r.background;null===d?u(s,c):d&&d.isColor&&(u(d,1),h=!0),(t.autoClear||h)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),d&&d.isCubeTexture?(void 0===a&&((a=new fr(new Qn(1,1,1),new lr({uniforms:xn.cube.uniforms,vertexShader:xn.cube.vertexShader,fragmentShader:xn.cube.fragmentShader,side:M,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},n.update(a.geometry)),a.material.uniforms.tCube.value=d,e.push(a,a.geometry,a.material,0,null)):d&&d.isTexture&&(void 0===i&&(i=new On(-1,1,1,-1,0,1),o=new fr(new $n(2,2),new ur({depthTest:!1,depthWrite:!1,fog:!1})),n.update(o.geometry)),o.material.map=d,t.renderBufferDirect(i,null,o.geometry,o.material,o,null))}}}(X,b,C,s),V=new function(t,e,n){var r;this.setMode=function(t){r=t},this.render=function(e,i){t.drawArrays(r,e,i),n.update(i,r)},this.renderInstances=function(t,i,o){var a=e.get("ANGLE_instanced_arrays");if(null!==a){var s=t.attributes.position;s.isInterleavedBufferAttribute?a.drawArraysInstancedANGLE(r,0,o=s.data.count,t.maxInstancedCount):a.drawArraysInstancedANGLE(r,i,o,t.maxInstancedCount),n.update(o,r,t.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(d,f,x),G=new function(t,e,n){var r,i,o;this.setMode=function(t){r=t},this.setIndex=function(t){i=t.type,o=t.bytesPerElement},this.render=function(e,a){t.drawElements(r,a,i,e*o),n.update(a,r)},this.renderInstances=function(t,a,s){var c=e.get("ANGLE_instanced_arrays");null!==c?(c.drawElementsInstancedANGLE(r,s,i,a*o,t.maxInstancedCount),n.update(s,r,t.maxInstancedCount)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(d,f,x),H=new function(t,e,n,r,i){var o,a,s,c,u,l,h=new Ye,d=new qe,p=new Ye;function f(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(m,v,g){if(0!==m.length){void 0===s&&function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),n=new Uint16Array([0,1,2,0,2,3]);o=e.createBuffer(),a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW),s=function(){var t=e.createProgram(),n=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(n,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),e.shaderSource(r,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),e.compileShader(n),e.compileShader(r),e.attachShader(t,n),e.attachShader(t,r),e.linkProgram(t),t}(),c={position:e.getAttribLocation(s,"position"),uv:e.getAttribLocation(s,"uv")},u={uvOffset:e.getUniformLocation(s,"uvOffset"),uvScale:e.getUniformLocation(s,"uvScale"),rotation:e.getUniformLocation(s,"rotation"),center:e.getUniformLocation(s,"center"),scale:e.getUniformLocation(s,"scale"),color:e.getUniformLocation(s,"color"),map:e.getUniformLocation(s,"map"),opacity:e.getUniformLocation(s,"opacity"),modelViewMatrix:e.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(s,"projectionMatrix"),fogType:e.getUniformLocation(s,"fogType"),fogDensity:e.getUniformLocation(s,"fogDensity"),fogNear:e.getUniformLocation(s,"fogNear"),fogFar:e.getUniformLocation(s,"fogFar"),fogColor:e.getUniformLocation(s,"fogColor"),fogDepth:e.getUniformLocation(s,"fogDepth"),alphaTest:e.getUniformLocation(s,"alphaTest")};var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=8,r.height=8;var h=r.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),l=new Mi(r)}(),n.useProgram(s),n.initAttributes(),n.enableAttribute(c.position),n.enableAttribute(c.uv),n.disableUnusedAttributes(),n.disable(e.CULL_FACE),n.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(c.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(c.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.uniformMatrix4fv(u.projectionMatrix,!1,g.projectionMatrix.elements),n.activeTexture(e.TEXTURE0),e.uniform1i(u.map,0);var y=0,b=0,x=v.fog;x?(e.uniform3f(u.fogColor,x.color.r,x.color.g,x.color.b),x.isFog?(e.uniform1f(u.fogNear,x.near),e.uniform1f(u.fogFar,x.far),e.uniform1i(u.fogType,1),y=1,b=1):x.isFogExp2&&(e.uniform1f(u.fogDensity,x.density),e.uniform1i(u.fogType,2),y=2,b=2)):(e.uniform1i(u.fogType,0),y=0,b=0);for(var w=0,_=m.length;w<_;w++)(M=m[w]).modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,M.matrixWorld),M.z=-M.modelViewMatrix.elements[14];m.sort(f);var S=[],T=[];for(w=0,_=m.length;w<_;w++){var M,A=(M=m[w]).material;if(!1!==A.visible){M.onBeforeRender(t,v,g,void 0,A,void 0),e.uniform1f(u.alphaTest,A.alphaTest),e.uniformMatrix4fv(u.modelViewMatrix,!1,M.modelViewMatrix.elements),M.matrixWorld.decompose(h,d,p),S[0]=p.x,S[1]=p.y,T[0]=M.center.x-.5,T[1]=M.center.y-.5;var E=0;v.fog&&A.fog&&(E=b),y!==E&&(e.uniform1i(u.fogType,E),y=E),null!==A.map?(e.uniform2f(u.uvOffset,A.map.offset.x,A.map.offset.y),e.uniform2f(u.uvScale,A.map.repeat.x,A.map.repeat.y)):(e.uniform2f(u.uvOffset,0,0),e.uniform2f(u.uvScale,1,1)),e.uniform1f(u.opacity,A.opacity),e.uniform3f(u.color,A.color.r,A.color.g,A.color.b),e.uniform1f(u.rotation,A.rotation),e.uniform2fv(u.center,T),e.uniform2fv(u.scale,S),n.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst,A.blendEquationAlpha,A.blendSrcAlpha,A.blendDstAlpha,A.premultipliedAlpha),n.buffers.depth.setTest(A.depthTest),n.buffers.depth.setMask(A.depthWrite),n.buffers.color.setMask(A.colorWrite),r.setTexture2D(A.map||l,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),M.onAfterRender(t,v,g,void 0,A,void 0)}}n.enable(e.CULL_FACE),n.reset()}}}(X,d,b,T,y),x.programs=N.programs,X.context=d,X.capabilities=y,X.extensions=f,X.properties=w,X.renderLists=k,X.state=b,X.info=x}ne();var re=new Pi(X);this.vr=re;var ie=new Ti(X,O,y.maxTextureSize);function oe(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),q=!0}function ae(){console.log("THREE.WebGLRenderer: Context Restored."),q=!1,ne()}function se(t){var e=t.target;e.removeEventListener("dispose",se),function(t){ce(t),w.remove(t)}(e)}function ce(t){var e=w.get(t).program;t.program=void 0,void 0!==e&&N.releaseProgram(e)}this.shadowMap=ie,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var t=f.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=f.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Dt},this.setPixelRatio=function(t){void 0!==t&&(Dt=t,this.setSize(Lt,Rt,!1))},this.getSize=function(){return{width:Lt,height:Rt}},this.setSize=function(t,n,r){var i=re.getDevice();i&&i.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Lt=t,Rt=n,e.width=t*Dt,e.height=n*Dt,!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(){return{width:Lt*Dt,height:Rt*Dt}},this.setDrawingBufferSize=function(t,n,r){Lt=t,Rt=n,Dt=r,e.width=t*r,e.height=n*r,this.setViewport(0,0,t,n)},this.getCurrentViewport=function(){return vt},this.setViewport=function(t,e,n,r){Ut.set(t,Rt-e-r,n,r),b.viewport(vt.copy(Ut).multiplyScalar(Dt))},this.setScissor=function(t,e,n,r){zt.set(t,Rt-e-r,n,r),b.scissor(Tt.copy(zt).multiplyScalar(Dt))},this.setScissorTest=function(t){b.setScissorTest(Vt=t)},this.getClearColor=function(){return B.getClearColor()},this.setClearColor=function(){B.setClearColor.apply(B,arguments)},this.getClearAlpha=function(){return B.getClearAlpha()},this.setClearAlpha=function(){B.setClearAlpha.apply(B,arguments)},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=d.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=d.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=d.STENCIL_BUFFER_BIT),d.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,n,r){this.setRenderTarget(t),this.clear(e,n,r)},this.dispose=function(){e.removeEventListener("webglcontextlost",oe,!1),e.removeEventListener("webglcontextrestored",ae,!1),k.dispose(),j.dispose(),w.dispose(),O.dispose(),re.dispose(),de()},this.renderBufferImmediate=function(t,e,n){b.initAttributes();var r=w.get(t);t.hasPositions&&!r.position&&(r.position=d.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=d.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=d.createBuffer()),t.hasColors&&!r.color&&(r.color=d.createBuffer());var i=e.getAttributes();if(t.hasPositions&&(d.bindBuffer(d.ARRAY_BUFFER,r.position),d.bufferData(d.ARRAY_BUFFER,t.positionArray,d.DYNAMIC_DRAW),b.enableAttribute(i.position),d.vertexAttribPointer(i.position,3,d.FLOAT,!1,0,0)),t.hasNormals){if(d.bindBuffer(d.ARRAY_BUFFER,r.normal),!n.isMeshPhongMaterial&&!n.isMeshStandardMaterial&&!n.isMeshNormalMaterial&&!0===n.flatShading)for(var o=0,a=3*t.count;o<a;o+=9){var s=t.normalArray,c=(s[o+0]+s[o+3]+s[o+6])/3,u=(s[o+1]+s[o+4]+s[o+7])/3,l=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=c,s[o+1]=u,s[o+2]=l,s[o+3]=c,s[o+4]=u,s[o+5]=l,s[o+6]=c,s[o+7]=u,s[o+8]=l}d.bufferData(d.ARRAY_BUFFER,t.normalArray,d.DYNAMIC_DRAW),b.enableAttribute(i.normal),d.vertexAttribPointer(i.normal,3,d.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(d.bindBuffer(d.ARRAY_BUFFER,r.uv),d.bufferData(d.ARRAY_BUFFER,t.uvArray,d.DYNAMIC_DRAW),b.enableAttribute(i.uv),d.vertexAttribPointer(i.uv,2,d.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==P&&(d.bindBuffer(d.ARRAY_BUFFER,r.color),d.bufferData(d.ARRAY_BUFFER,t.colorArray,d.DYNAMIC_DRAW),b.enableAttribute(i.color),d.vertexAttribPointer(i.color,3,d.FLOAT,!1,0,0)),b.disableUnusedAttributes(),d.drawArrays(d.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){var a=i.isMesh&&i.matrixWorld.determinant()<0;b.setMaterial(r,a);var s=ye(t,e,r,i),c=n.id+"_"+s.id+"_"+(!0===r.wireframe),u=!1;c!==Q&&(Q=c,u=!0),i.morphTargetInfluences&&(z.update(i,n,r,s),u=!0);var l,h=n.index,p=n.attributes.position,m=1;!0===r.wireframe&&(h=C.getWireframeAttribute(n),m=2);var v=V;null!==h&&(l=E.get(h),(v=G).setIndex(l)),u&&(function(t,e,n,r){if(n&&n.isInstancedBufferGeometry&&null===f.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===r&&(r=0),b.initAttributes();var i=n.attributes,o=e.getAttributes(),a=t.defaultAttributeValues;for(var s in o){var c=o[s];if(c>=0){var u=i[s];if(void 0!==u){var l=u.normalized,h=u.itemSize,p=E.get(u);if(void 0===p)continue;var m=p.buffer,v=p.type,g=p.bytesPerElement;if(u.isInterleavedBufferAttribute){var y=u.data,x=y.stride,w=u.offset;y&&y.isInstancedInterleavedBuffer?(b.enableAttributeAndDivisor(c,y.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=y.meshPerAttribute*y.count)):b.enableAttribute(c),d.bindBuffer(d.ARRAY_BUFFER,m),d.vertexAttribPointer(c,h,v,l,x*g,(r*x+w)*g)}else u.isInstancedBufferAttribute?(b.enableAttributeAndDivisor(c,u.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=u.meshPerAttribute*u.count)):b.enableAttribute(c),d.bindBuffer(d.ARRAY_BUFFER,m),d.vertexAttribPointer(c,h,v,l,0,r*h*g)}else if(void 0!==a){var _=a[s];if(void 0!==_)switch(_.length){case 2:d.vertexAttrib2fv(c,_);break;case 3:d.vertexAttrib3fv(c,_);break;case 4:d.vertexAttrib4fv(c,_);break;default:d.vertexAttrib1fv(c,_)}}}}b.disableUnusedAttributes()}}(r,s,n),null!==h&&d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l.buffer));var g=1/0;null!==h?g=h.count:void 0!==p&&(g=p.count);var y=n.drawRange.start*m,x=n.drawRange.count*m,w=null!==o?o.start*m:0,_=null!==o?o.count*m:1/0,S=Math.max(y,w),T=Math.min(g,y+x,w+_)-1,M=Math.max(0,T-S+1);if(0!==M){if(i.isMesh)if(!0===r.wireframe)b.setLineWidth(r.wireframeLinewidth*te()),v.setMode(d.LINES);else switch(i.drawMode){case Ne:v.setMode(d.TRIANGLES);break;case Le:v.setMode(d.TRIANGLE_STRIP);break;case Ie:v.setMode(d.TRIANGLE_FAN)}else if(i.isLine){var A=r.linewidth;void 0===A&&(A=1),b.setLineWidth(A*te()),v.setMode(i.isLineSegments?d.LINES:i.isLineLoop?d.LINE_LOOP:d.LINE_STRIP)}else i.isPoints&&v.setMode(d.POINTS);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&v.renderInstances(n,S,M):v.render(S,M)}},this.compile=function(t,e){(h=j.get(t,e)).init(),t.traverse(function(t){t.isLight&&(h.pushLight(t),t.castShadow&&h.pushShadow(t))}),h.setupLights(e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var n=0;n<e.material.length;n++)ge(e.material[n],t.fog,e);else ge(e.material,t.fog,e)})};var ue,le=!1,he=null;function de(){le=!1}function pe(){var t=re.getDevice();t&&t.isPresenting?t.requestAnimationFrame(fe):window.requestAnimationFrame(fe)}function fe(t){!1!==le&&(he(t),pe())}function me(t,e,n,r){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,c=a.geometry,u=void 0===r?a.material:r,l=a.group;if(n.isArrayCamera){$=n;for(var h=n.cameras,d=0,p=h.length;d<p;d++){var f=h[d];if(s.layers.test(f.layers)){var m=f.bounds;b.viewport(vt.set(m.x*Lt,m.y*Rt,m.z*Lt,m.w*Rt).multiplyScalar(Dt)),ve(s,e,f,c,u,l)}}}else $=null,ve(s,e,n,c,u,l)}}function ve(t,e,n,r,i,o){if(t.onBeforeRender(X,e,n,r,i,o),h=j.get(e,$||n),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var a=t.isMesh&&t.matrixWorld.determinant()<0;b.setMaterial(i,a);var s=ye(n,e.fog,i,t);Q="",function(t,e,n){t.render(function(t){X.renderBufferImmediate(t,e,n)})}(t,s,i)}else X.renderBufferDirect(n,e.fog,r,i,t,o);t.onAfterRender(X,e,n,r,i,o),h=j.get(e,$||n)}function ge(t,e,n){var r=w.get(t),i=h.state.lights,o=N.getParameters(t,i.state,h.state.shadowsArray,e,Wt.numPlanes,Wt.numIntersection,n),a=N.getProgramCode(t,o),s=r.program,c=!0;if(void 0===s)t.addEventListener("dispose",se);else if(s.code!==a)ce(t);else if(r.lightsHash!==i.state.hash)w.update(t,"lightsHash",i.state.hash),c=!1;else{if(void 0!==o.shaderID)return;c=!1}if(c){if(o.shaderID){var u=xn[o.shaderID];r.shader={name:t.type,uniforms:mn.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else r.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(r.shader,X),s=N.acquireProgram(t,r.shader,o,a),r.program=s,t.program=s}var l=s.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var d=0;d<X.maxMorphTargets;d++)l["morphTarget"+d]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals)for(t.numSupportedMorphNormals=0,d=0;d<X.maxMorphNormals;d++)l["morphNormal"+d]>=0&&t.numSupportedMorphNormals++;var p=r.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=Wt.numPlanes,r.numIntersection=Wt.numIntersection,p.clippingPlanes=Wt.uniform),r.fog=e,r.lightsHash=i.state.hash,t.lights&&(p.ambientLightColor.value=i.state.ambient,p.directionalLights.value=i.state.directional,p.spotLights.value=i.state.spot,p.rectAreaLights.value=i.state.rectArea,p.pointLights.value=i.state.point,p.hemisphereLights.value=i.state.hemi,p.directionalShadowMap.value=i.state.directionalShadowMap,p.directionalShadowMatrix.value=i.state.directionalShadowMatrix,p.spotShadowMap.value=i.state.spotShadowMap,p.spotShadowMatrix.value=i.state.spotShadowMatrix,p.pointShadowMap.value=i.state.pointShadowMap,p.pointShadowMatrix.value=i.state.pointShadowMatrix);var f=r.program.getUniforms(),m=ei.seqWithValue(f.seq,p);r.uniformsList=m}function ye(t,e,n,r){Nt=0;var i=w.get(n),o=h.state.lights;Yt&&(Zt||t!==K)&&Wt.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,i,t===K&&n.id===J),!1===n.needsUpdate&&(void 0===i.program?n.needsUpdate=!0:n.fog&&i.fog!==e?n.needsUpdate=!0:n.lights&&i.lightsHash!==o.state.hash?n.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===Wt.numPlanes&&i.numIntersection===Wt.numIntersection||(n.needsUpdate=!0)),n.needsUpdate&&(ge(n,e,r),n.needsUpdate=!1);var a,s,c=!1,u=!1,l=!1,p=i.program,f=p.getUniforms(),m=i.shader.uniforms;if(b.useProgram(p.program)&&(c=!0,u=!0,l=!0),n.id!==J&&(J=n.id,u=!0),c||t!==K){if(f.setValue(d,"projectionMatrix",t.projectionMatrix),y.logarithmicDepthBuffer&&f.setValue(d,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),K!==($||t)&&(K=$||t,u=!0,l=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var v=f.map.cameraPosition;void 0!==v&&v.setValue(d,$t.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&f.setValue(d,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){f.setOptional(d,r,"bindMatrix"),f.setOptional(d,r,"bindMatrixInverse");var g=r.skeleton;if(g)if(y.floatVertexTextures){if(void 0===g.boneTexture){var x=Math.sqrt(4*g.bones.length);x=He.ceilPowerOfTwo(x),x=Math.max(x,4);var _=new Float32Array(x*x*4);_.set(g.boneMatrices);var S=new cn(_,x,x,qt,jt);S.needsUpdate=!0,g.boneMatrices=_,g.boneTexture=S,g.boneTextureSize=x}f.setValue(d,"boneTexture",g.boneTexture),f.setValue(d,"boneTextureSize",g.boneTextureSize)}else f.setOptional(d,g,"boneMatrices")}return u&&(f.setValue(d,"toneMappingExposure",X.toneMappingExposure),f.setValue(d,"toneMappingWhitePoint",X.toneMappingWhitePoint),n.lights&&((a=m).ambientLightColor.needsUpdate=s=l,a.directionalLights.needsUpdate=s,a.pointLights.needsUpdate=s,a.spotLights.needsUpdate=s,a.rectAreaLights.needsUpdate=s,a.hemisphereLights.needsUpdate=s),e&&n.fog&&function(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(m,e),n.isMeshBasicMaterial?be(m,n):n.isMeshLambertMaterial?(be(m,n),function(t,e){e.emissiveMap&&(m.emissiveMap.value=e.emissiveMap)}(0,n)):n.isMeshPhongMaterial?(be(m,n),n.isMeshToonMaterial?function(t,e){xe(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(m,n):xe(m,n)):n.isMeshStandardMaterial?(be(m,n),n.isMeshPhysicalMaterial?function(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,we(t,e)}(m,n):we(m,n)):n.isMeshDepthMaterial?(be(m,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(m,n)):n.isMeshDistanceMaterial?(be(m,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(m,n)):n.isMeshNormalMaterial?(be(m,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(m,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}(m,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(m,n)):n.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*Dt,t.scale.value=.5*Rt,t.map.value=e.map,null!==e.map){if(!0===e.map.matrixAutoUpdate){var n=e.map.offset,r=e.map.repeat,i=e.map.center;e.map.matrix.setUvTransform(n.x,n.y,r.x,r.y,e.map.rotation,i.x,i.y)}t.uvTransform.value.copy(e.map.matrix)}}(m,n):n.isShadowMaterial&&(m.color.value=n.color,m.opacity.value=n.opacity),void 0!==m.ltc_1&&(m.ltc_1.value=bn.LTC_1),void 0!==m.ltc_2&&(m.ltc_2.value=bn.LTC_2),ei.upload(d,i.uniformsList,m,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ei.upload(d,i.uniformsList,m,X),n.uniformsNeedUpdate=!1),f.setValue(d,"modelViewMatrix",r.modelViewMatrix),f.setValue(d,"normalMatrix",r.normalMatrix),f.setValue(d,"modelMatrix",r.matrixWorld),p}function be(t,e){var n;if(t.opacity.value=e.opacity,e.color&&(t.diffuse.value=e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=w.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?n=e.map:e.specularMap?n=e.specularMap:e.displacementMap?n=e.displacementMap:e.normalMap?n=e.normalMap:e.bumpMap?n=e.bumpMap:e.roughnessMap?n=e.roughnessMap:e.metalnessMap?n=e.metalnessMap:e.alphaMap?n=e.alphaMap:e.emissiveMap&&(n=e.emissiveMap),void 0!==n){if(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate){var r=n.offset,i=n.repeat,o=n.center;n.matrix.setUvTransform(r.x,r.y,i.x,i.y,n.rotation,o.x,o.y)}t.uvTransform.value.copy(n.matrix)}}function xe(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function we(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}this.animate=function(t){null!==(he=t)?le||(pe(),le=!0):de()},this.render=function(t,e,n,r){if(e&&e.isCamera){if(!q){Q="",J=-1,K=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),re.enabled&&(e=re.getCamera(e)),(h=j.get(t,e)).init(),t.onBeforeRender(X,t,e,n),Jt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Gt.setFromMatrix(Jt),Yt=Wt.init(this.clippingPlanes,Zt=this.localClippingEnabled,e),(l=k.get(t,e)).init(),function t(e,n,r){if(!1!==e.visible){if(e.layers.test(n.layers))if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite)e.frustumCulled&&!Gt.intersectsSprite(e)||h.pushSprite(e);else if(e.isImmediateRenderObject)r&&$t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Jt),l.push(e,null,e.material,$t.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||Gt.intersectsObject(e))){r&&$t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Jt);var i=O.update(e),o=e.material;if(Array.isArray(o))for(var a=i.groups,s=0,c=a.length;s<c;s++){var u=a[s],d=o[u.materialIndex];d&&d.visible&&l.push(e,i,d,$t.z,u)}else o.visible&&l.push(e,i,o,$t.z,null)}var p=e.children;for(s=0,c=p.length;s<c;s++)t(p[s],n,r)}}(t,e,X.sortObjects),!0===X.sortObjects&&l.sort(),Yt&&Wt.beginShadows(),ie.render(h.state.shadowsArray,t,e),h.setupLights(e),Yt&&Wt.endShadows(),this.info.autoReset&&this.info.reset(),void 0===n&&(n=null),this.setRenderTarget(n),B.render(l,t,e,r);var i=l.opaque,o=l.transparent;if(t.overrideMaterial){var a=t.overrideMaterial;i.length&&me(i,t,e,a),o.length&&me(o,t,e,a)}else i.length&&me(i,t,e),o.length&&me(o,t,e);H.render(h.state.spritesArray,t,e),n&&T.updateRenderTargetMipmap(n),b.buffers.depth.setTest(!0),b.buffers.depth.setMask(!0),b.buffers.color.setMask(!0),b.setPolygonOffset(!1),t.onAfterRender(X,t,e),re.enabled&&re.submitFrame(),l=null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var t=Nt;return t>=y.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+t+" texture units while this GPU supports only "+y.maxTextures),Nt+=1,t},this.setTexture2D=(ue=!1,function(t,e){t&&t.isWebGLRenderTarget&&(ue||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),ue=!0),t=t.texture),T.setTexture2D(t,e)}),this.setTexture=function(){var t=!1;return function(e,n){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0),T.setTexture2D(e,n)}}(),this.setTextureCube=function(){var t=!1;return function(e,n){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?T.setTextureCube(e,n):T.setTextureCubeDynamic(e,n)}}(),this.getRenderTarget=function(){return Y},this.setRenderTarget=function(t){Y=t,t&&void 0===w.get(t).__webglFramebuffer&&T.setupRenderTarget(t);var e=null,n=!1;if(t){var r=w.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(e=r[t.activeCubeFace],n=!0):e=r,vt.copy(t.viewport),Tt.copy(t.scissor),At=t.scissorTest}else vt.copy(Ut).multiplyScalar(Dt),Tt.copy(zt).multiplyScalar(Dt),At=Vt;if(Z!==e&&(d.bindFramebuffer(d.FRAMEBUFFER,e),Z=e),b.viewport(vt),b.scissor(Tt),b.setScissorTest(At),n){var i=w.get(t.texture);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,i.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,n,r,i,o){if(t&&t.isWebGLRenderTarget){var a=w.get(t).__webglFramebuffer;if(a){var s=!1;a!==Z&&(d.bindFramebuffer(d.FRAMEBUFFER,a),s=!0);try{var c=t.texture,u=c.format,l=c.type;if(u!==qt&&W.convert(u)!==d.getParameter(d.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===It||W.convert(l)===d.getParameter(d.IMPLEMENTATION_COLOR_READ_TYPE)||l===jt&&(f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||l===Bt&&f.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&d.readPixels(e,n,r,i,W.convert(u),W.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&d.bindFramebuffer(d.FRAMEBUFFER,Z)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,n){var r=e.image.width,i=e.image.height,o=W.convert(e.format);this.setTexture2D(e,0),d.copyTexImage2D(d.TEXTURE_2D,n||0,o,t.x,t.y,r,i,0)},this.copyTextureToTexture=function(t,e,n,r){var i=e.image.width,o=e.image.height,a=W.convert(n.format),s=W.convert(n.type),c=e.isDataTexture?e.image.data:e.image;this.setTexture2D(n,0),d.texSubImage2D(d.TEXTURE_2D,r||0,t.x,t.y,i,o,a,s,c)}}function Ni(t,e){this.name="",this.color=new gn(t),this.density=void 0!==e?e:25e-5}function Li(t,e,n){this.name="",this.color=new gn(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function Ii(){Cn.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Ri(t){cr.call(this),this.type="SpriteMaterial",this.color=new gn(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Di(t){Cn.call(this),this.type="Sprite",this.material=void 0!==t?t:new Ri,this.center=new We(.5,.5)}function Fi(){Cn.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Ui(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Xe)}}function ki(){Cn.call(this),this.type="Bone"}function ji(t,e){fr.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Xe,this.bindMatrixInverse=new Xe;var n=new Ui(this.initBones());this.bind(n,this.matrixWorld),this.normalizeSkinWeights()}function Bi(t){cr.call(this),this.type="LineBasicMaterial",this.color=new gn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function zi(t,e,n){if(1===n)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Vi(t,e);Cn.call(this),this.type="Line",this.geometry=void 0!==t?t:new Zn,this.material=void 0!==e?e:new Bi({color:16777215*Math.random()})}function Vi(t,e){zi.call(this,t,e),this.type="LineSegments"}function Gi(t,e){zi.call(this,t,e),this.type="LineLoop"}function Hi(t){cr.call(this),this.type="PointsMaterial",this.color=new gn(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function Wi(t,e){Cn.call(this),this.type="Points",this.geometry=void 0!==t?t:new Zn,this.material=void 0!==e?e:new Hi({color:16777215*Math.random()})}function Xi(){Cn.call(this),this.type="Group"}function qi(t,e,n,r,i,o,a,s,c){rn.call(this,t,e,n,r,i,o,a,s,c),this.generateMipmaps=!1}function Yi(t,e,n,r,i,o,a,s,c,u,l,h){rn.call(this,null,o,a,s,c,u,r,i,l,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Zi(t,e,n,r,i,o,a,s,c,u){if((u=void 0!==u?u:Qt)!==Qt&&u!==Kt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===Qt&&(n=Ft),void 0===n&&u===Kt&&(n=Ht),rn.call(this,null,r,i,o,a,s,u,n,c),this.image={width:t,height:e},this.magFilter=void 0!==a?a:Et,this.minFilter=void 0!==s?s:Et,this.flipY=!1,this.generateMipmaps=!1}function Ji(t){Zn.call(this),this.type="WireframeGeometry";var e,n,r,i,o,a,s,c,u,l,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,r=m.length;e<r;e++){var v=m[e];for(n=0;n<3;n++)s=v[f[n]],c=v[f[(n+1)%3]],d[0]=Math.min(s,c),d[1]=Math.max(s,c),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]})}for(u in p)h.push((l=t.vertices[(a=p[u]).index1]).x,l.y,l.z),h.push((l=t.vertices[a.index2]).x,l.y,l.z)}else if(t&&t.isBufferGeometry){var g,y,b,x,w;if(l=new Ye,null!==t.index){for(g=t.attributes.position,y=t.index,0===(b=t.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),i=0,o=b.length;i<o;++i)for(e=w=(x=b[i]).start,r=w+x.count;e<r;e+=3)for(n=0;n<3;n++)s=y.getX(e+n),c=y.getX(e+(n+1)%3),d[0]=Math.min(s,c),d[1]=Math.max(s,c),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]});for(u in p)l.fromBufferAttribute(g,(a=p[u]).index1),h.push(l.x,l.y,l.z),l.fromBufferAttribute(g,a.index2),h.push(l.x,l.y,l.z)}else for(e=0,r=(g=t.attributes.position).count/3;e<r;e++)for(n=0;n<3;n++)l.fromBufferAttribute(g,3*e+n),h.push(l.x,l.y,l.z),l.fromBufferAttribute(g,3*e+(n+1)%3),h.push(l.x,l.y,l.z)}this.addAttribute("position",new Hn(h,3))}function Qi(t,e,n){Dn.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new Ki(t,e,n)),this.mergeVertices()}function Ki(t,e,n){Zn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};var r,i,o=[],a=[],s=[],c=[],u=new Ye,l=new Ye,h=new Ye,d=new Ye,p=new Ye,f=e+1;for(r=0;r<=n;r++){var m=r/n;for(i=0;i<=e;i++){var v=i/e;t(v,m,l),a.push(l.x,l.y,l.z),v-1e-5>=0?(t(v-1e-5,m,h),d.subVectors(l,h)):(t(v+1e-5,m,h),d.subVectors(h,l)),m-1e-5>=0?(t(v,m-1e-5,h),p.subVectors(l,h)):(t(v,m+1e-5,h),p.subVectors(h,l)),u.crossVectors(d,p).normalize(),s.push(u.x,u.y,u.z),c.push(v,m)}}for(r=0;r<n;r++)for(i=0;i<e;i++){var g=r*f+i+1,y=(r+1)*f+i+1,b=(r+1)*f+i;o.push(r*f+i,g,b),o.push(g,y,b)}this.setIndex(o),this.addAttribute("position",new Hn(a,3)),this.addAttribute("normal",new Hn(s,3)),this.addAttribute("uv",new Hn(c,2))}function $i(t,e,n,r){Dn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new to(t,e,n,r)),this.mergeVertices()}function to(t,e,n,r){Zn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1;var i=[],o=[];function a(t,e,n,r){var i,o,a=Math.pow(2,r),c=[];for(i=0;i<=a;i++){c[i]=[];var u=t.clone().lerp(n,i/a),l=e.clone().lerp(n,i/a),h=a-i;for(o=0;o<=h;o++)c[i][o]=0===o&&i===a?u:u.clone().lerp(l,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var d=Math.floor(o/2);o%2==0?(s(c[i][d+1]),s(c[i+1][d]),s(c[i][d])):(s(c[i][d+1]),s(c[i+1][d+1]),s(c[i+1][d]))}}function s(t){i.push(t.x,t.y,t.z)}function c(e,n){var r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function u(t,e,n,r){r<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=r/2/Math.PI+.5)}function l(t){return Math.atan2(t.z,-t.x)}!function(t){for(var n=new Ye,r=new Ye,i=new Ye,o=0;o<e.length;o+=3)c(e[o+0],n),c(e[o+1],r),c(e[o+2],i),a(n,r,i,t)}(r=r||0),function(t){for(var e=new Ye,n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){for(var t=new Ye,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var n=l(t)/2/Math.PI+.5,r=(a=t,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(n,1-r)}var a;(function(){for(var t=new Ye,e=new Ye,n=new Ye,r=new Ye,a=new We,s=new We,c=new We,h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),c.set(o[d+4],o[d+5]),r.copy(t).add(e).add(n).divideScalar(3);var p=l(r);u(a,d+0,t,p),u(s,d+2,e,p),u(c,d+4,n,p)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],n=o[t+2],r=o[t+4],i=Math.max(e,n,r),a=Math.min(e,n,r);i>.9&&a<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),r<.2&&(o[t+4]+=1))}}()}(),this.addAttribute("position",new Hn(i,3)),this.addAttribute("normal",new Hn(i.slice(),3)),this.addAttribute("uv",new Hn(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function eo(t,e){Dn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new no(t,e)),this.mergeVertices()}function no(t,e){to.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ro(t,e){Dn.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new io(t,e)),this.mergeVertices()}function io(t,e){to.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function oo(t,e){Dn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ao(t,e)),this.mergeVertices()}function ao(t,e){var n=(1+Math.sqrt(5))/2;to.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function so(t,e){Dn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new co(t,e)),this.mergeVertices()}function co(t,e){var n=(1+Math.sqrt(5))/2,r=1/n;to.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function uo(t,e,n,r,i,o){Dn.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new lo(t,e,n,r,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function lo(t,e,n,r,i){Zn.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},e=e||64,n=n||1,r=r||8;var o=t.computeFrenetFrames(e,i=i||!1);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,c=new Ye,u=new Ye,l=new We,h=new Ye,d=[],p=[],f=[],m=[];function v(i){h=t.getPointAt(i/e,h);var a=o.normals[i],l=o.binormals[i];for(s=0;s<=r;s++){var f=s/r*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);u.x=v*a.x+m*l.x,u.y=v*a.y+m*l.y,u.z=v*a.z+m*l.z,u.normalize(),p.push(u.x,u.y,u.z),c.x=h.x+n*u.x,c.y=h.y+n*u.y,c.z=h.z+n*u.z,d.push(c.x,c.y,c.z)}}!function(){for(a=0;a<e;a++)v(a);v(!1===i?e:0),function(){for(a=0;a<=e;a++)for(s=0;s<=r;s++)l.x=a/e,l.y=s/r,f.push(l.x,l.y)}(),function(){for(s=1;s<=e;s++)for(a=1;a<=r;a++){var t=(r+1)*s+(a-1),n=(r+1)*s+a,i=(r+1)*(s-1)+a;m.push((r+1)*(s-1)+(a-1),t,i),m.push(t,n,i)}}()}(),this.setIndex(m),this.addAttribute("position",new Hn(d,3)),this.addAttribute("normal",new Hn(p,3)),this.addAttribute("uv",new Hn(f,2))}function ho(t,e,n,r,i,o,a){Dn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new po(t,e,n,r,i,o)),this.mergeVertices()}function po(t,e,n,r,i,o){Zn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var a,s,c=[],u=[],l=[],h=[],d=new Ye,p=new Ye,f=new Ye,m=new Ye,v=new Ye,g=new Ye,y=new Ye;for(a=0;a<=n;++a){var b=a/n*i*Math.PI*2;for(A(b,i,o,t,f),A(b+.01,i,o,t,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=r;++s){var x=s/r*Math.PI*2,w=-e*Math.cos(x),_=e*Math.sin(x);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),u.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),l.push(p.x,p.y,p.z),h.push(a/n),h.push(s/r)}}for(s=1;s<=n;s++)for(a=1;a<=r;a++){var S=(r+1)*s+(a-1),T=(r+1)*s+a,M=(r+1)*(s-1)+a;c.push((r+1)*(s-1)+(a-1),S,M),c.push(S,T,M)}function A(t,e,n,r,i){var o=Math.cos(t),a=Math.sin(t),s=n/e*t,c=Math.cos(s);i.x=r*(2+c)*.5*o,i.y=r*(2+c)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(c),this.addAttribute("position",new Hn(u,3)),this.addAttribute("normal",new Hn(l,3)),this.addAttribute("uv",new Hn(h,2))}function fo(t,e,n,r,i){Dn.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new mo(t,e,n,r,i)),this.mergeVertices()}function mo(t,e,n,r,i){Zn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,a,s=[],c=[],u=[],l=[],h=new Ye,d=new Ye,p=new Ye;for(o=0;o<=n;o++)for(a=0;a<=r;a++){var f=a/r*i,m=o/n*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),c.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),u.push(p.x,p.y,p.z),l.push(a/r),l.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=r;a++){var v=(r+1)*(o-1)+a-1,g=(r+1)*(o-1)+a,y=(r+1)*o+a;s.push((r+1)*o+a-1,v,y),s.push(v,g,y)}this.setIndex(s),this.addAttribute("position",new Hn(c,3)),this.addAttribute("normal",new Hn(u,3)),this.addAttribute("uv",new Hn(l,2))}function vo(t,e,n,r,i){var o,a;if(i===function(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Ro(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Ro(o,t[o],t[o+1],a);return a&&Oo(a,a.next)&&(Do(a),a=a.next),a}function go(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Oo(r,r.next)&&0!==Po(r.prev,r,r.next))r=r.next;else{if(Do(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function yo(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Mo(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,c,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(t,r,i,o);for(var s,c,u=t;t.prev!==t.next;)if(s=t.prev,c=t.next,o?xo(t,r,i,o):bo(t))e.push(s.i/n),e.push(t.i/n),e.push(c.i/n),Do(t),t=c.next,u=c.next;else if((t=c)===u){a?1===a?yo(t=wo(t,e,n),e,n,r,i,o,2):2===a&&_o(t,e,n,r,i,o):yo(go(t),e,n,r,i,o,1);break}}}function bo(t){var e=t.prev,n=t,r=t.next;if(Po(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Eo(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Po(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function xo(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Po(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=Mo(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),l=Mo(s,c,e,n,r),h=t.nextZ;h&&h.z<=l;){if(h!==t.prev&&h!==t.next&&Eo(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Po(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(h=t.prevZ;h&&h.z>=u;){if(h!==t.prev&&h!==t.next&&Eo(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Po(h.prev,h,h.next)>=0)return!1;h=h.prevZ}return!0}function wo(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Oo(i,o)&&No(i,r,r.next,o)&&Lo(i,o)&&Lo(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Do(r),Do(r.next),r=t=o),r=r.next}while(r!==t);return r}function _o(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Co(a,s)){var c=Io(a,s);return a=go(a,a.next),c=go(c,c.next),yo(a,e,n,r,i,o),void yo(c,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function So(t,e){return t.x-e.x}function To(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var c,u=n,l=n.x,h=n.y,d=1/0;for(r=n.next;r!==u;)i>=r.x&&r.x>=l&&i!==r.x&&Eo(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&((c=Math.abs(o-r.y)/(i-r.x))<d||c===d&&r.x>n.x)&&Lo(r,t)&&(n=r,d=c),r=r.next;return n}(t,e)){var n=Io(e,t);go(n,n.next)}}function Mo(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ao(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function Eo(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Co(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&No(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&Lo(t,e)&&Lo(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function Po(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Oo(t,e){return t.x===e.x&&t.y===e.y}function No(t,e,n,r){return!!(Oo(t,e)&&Oo(n,r)||Oo(t,r)&&Oo(n,e))||Po(t,e,n)>0!=Po(t,e,r)>0&&Po(n,r,t)>0!=Po(n,r,e)>0}function Lo(t,e){return Po(t.prev,t,t.next)<0?Po(t,e,t.next)>=0&&Po(t,t.prev,e)>=0:Po(t,e,t.prev)<0||Po(t,t.next,e)<0}function Io(t,e){var n=new Fo(t.i,t.x,t.y),r=new Fo(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ro(t,e,n,r){var i=new Fo(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Do(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fo(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}(_i.prototype=Object.create(cr.prototype)).constructor=_i,_i.prototype.isMeshDepthMaterial=!0,_i.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},(Si.prototype=Object.create(cr.prototype)).constructor=Si,Si.prototype.isMeshDistanceMaterial=!0,Si.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},(Mi.prototype=Object.create(rn.prototype)).constructor=Mi,Ei.prototype=Object.assign(Object.create(Pn.prototype),{constructor:Ei,isPerspectiveCamera:!0,copy:function(t,e){return Pn.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*He.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*He.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*He.RAD2DEG*Math.atan(Math.tan(.5*He.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*He.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,e-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var c=this.filmOffset;0!==c&&(i+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far)},toJSON:function(t){var e=Cn.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Ci.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Ci,isArrayCamera:!0}),Ni.prototype.isFogExp2=!0,Ni.prototype.clone=function(){return new Ni(this.color.getHex(),this.density)},Ni.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Li.prototype.isFog=!0,Li.prototype.clone=function(){return new Li(this.color.getHex(),this.near,this.far)},Li.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Ii.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Ii,copy:function(t,e){return Cn.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=Cn.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),(Ri.prototype=Object.create(cr.prototype)).constructor=Ri,Ri.prototype.isSpriteMaterial=!0,Ri.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},Di.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Di,isSprite:!0,raycast:(pi=new Ye,fi=new Ye,mi=new Ye,function(t,e){fi.setFromMatrixPosition(this.matrixWorld),t.ray.closestPointToPoint(fi,pi),mi.setFromMatrixScale(this.matrixWorld);var n=mi.x*mi.y/4;if(!(fi.distanceToSquared(pi)>n)){var r=t.ray.origin.distanceTo(pi);r<t.near||r>t.far||e.push({distance:r,point:pi.clone(),face:null,object:this})}}),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Cn.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}}),Fi.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Fi,copy:function(t){Cn.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,r=e.length;n<r;n++){var i=e[n];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var n=this.levels,r=0;r<n.length&&!(e<n[r].distance);r++);n.splice(r,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object},raycast:(vi=new Ye,function(t,e){vi.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(vi);this.getObjectForDistance(n).raycast(t,e)}),update:function(){var t=new Ye,e=new Ye;return function(n){var r=this.levels;if(r.length>1){t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var i=t.distanceTo(e);r[0].object.visible=!0;for(var o=1,a=r.length;o<a&&i>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<a;o++)r[o].object.visible=!1}}}(),toJSON:function(t){var e=Cn.prototype.toJSON.call(this,t);e.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Object.assign(Ui.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new Xe;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n;for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(gi=new Xe,yi=new Xe,function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=t.length;i<o;i++)gi.multiplyMatrices(t[i]?t[i].matrixWorld:yi,e[i]),gi.toArray(n,16*i);void 0!==r&&(r.needsUpdate=!0)}),clone:function(){return new Ui(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}}}),ki.prototype=Object.assign(Object.create(Cn.prototype),{constructor:ki,isBone:!0}),ji.prototype=Object.assign(Object.create(fr.prototype),{constructor:ji,isSkinnedMesh:!0,initBones:function(){var t,e,n,r,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(n=0,r=this.geometry.bones.length;n<r;n++)e=this.geometry.bones[n],t=new ki,i.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(n=0,r=this.geometry.bones.length;n<r;n++)-1!==(e=this.geometry.bones[n]).parent&&null!==e.parent&&void 0!==i[e.parent]?i[e.parent].add(i[n]):this.add(i[n])}return this.updateMatrixWorld(!0),i},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var n=this.geometry.skinWeights[e];(t=1/n.manhattanLength())!=1/0?n.multiplyScalar(t):n.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var r=new on,i=this.geometry.attributes.skinWeight;for(e=0;e<i.count;e++)r.x=i.getX(e),r.y=i.getY(e),r.z=i.getZ(e),r.w=i.getW(e),(t=1/r.manhattanLength())!=1/0?r.multiplyScalar(t):r.set(1,0,0,0),i.setXYZW(e,r.x,r.y,r.z,r.w)}},updateMatrixWorld:function(t){fr.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(Bi.prototype=Object.create(cr.prototype)).constructor=Bi,Bi.prototype.isLineBasicMaterial=!0,Bi.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},zi.prototype=Object.assign(Object.create(Cn.prototype),{constructor:zi,isLine:!0,computeLineDistances:(bi=new Ye,xi=new Ye,function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)bi.fromBufferAttribute(e,r-1),xi.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=bi.distanceTo(xi);t.addAttribute("lineDistance",new THREE.Float32BufferAttribute(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;for((n=t.lineDistances)[0]=0,r=1,i=o.length;r<i;r++)n[r]=n[r-1],n[r]+=o[r-1].distanceTo(o[r])}return this}),raycast:function(){var t=new Xe,e=new hr,n=new ln;return function(r,i){var o=r.linePrecision,a=o*o,s=this.geometry,c=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(c),!1!==r.ray.intersectsSphere(n)){t.getInverse(c),e.copy(r.ray).applyMatrix4(t);var u=new Ye,l=new Ye,h=new Ye,d=new Ye,p=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var f=s.index,m=s.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=p){var b=v[g+1];u.fromArray(m,3*v[g]),l.fromArray(m,3*b),e.distanceSqToSegment(u,l,d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=r.ray.origin.distanceTo(d))<r.near||_>r.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,y=m.length/3-1;g<y;g+=p)u.fromArray(m,3*g),l.fromArray(m,3*g+3),e.distanceSqToSegment(u,l,d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=r.ray.origin.distanceTo(d))<r.near||_>r.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(s.isGeometry){var x=s.vertices,w=x.length;for(g=0;g<w-1;g+=p){var _;e.distanceSqToSegment(x[g],x[g+1],d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=r.ray.origin.distanceTo(d))<r.near||_>r.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Vi.prototype=Object.assign(Object.create(zi.prototype),{constructor:Vi,isLineSegments:!0,computeLineDistances:function(){var t=new Ye,e=new Ye;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var r=n.attributes.position,i=[],o=0,a=r.count;o<a;o+=2)t.fromBufferAttribute(r,o),e.fromBufferAttribute(r,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e);n.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var s=n.vertices;for(i=n.lineDistances,o=0,a=s.length;o<a;o+=2)t.copy(s[o]),e.copy(s[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e)}return this}}()}),Gi.prototype=Object.assign(Object.create(zi.prototype),{constructor:Gi,isLineLoop:!0}),(Hi.prototype=Object.create(cr.prototype)).constructor=Hi,Hi.prototype.isPointsMaterial=!0,Hi.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},Wi.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Wi,isPoints:!0,raycast:function(){var t=new Xe,e=new hr,n=new ln;return function(r,i){var o=this,a=this.geometry,s=this.matrixWorld,c=r.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(s),n.radius+=c,!1!==r.ray.intersectsSphere(n)){t.getInverse(s),e.copy(r.ray).applyMatrix4(t);var u=c/((this.scale.x+this.scale.y+this.scale.z)/3),l=u*u,h=new Ye,d=new Ye;if(a.isBufferGeometry){var p=a.index,f=a.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var b=f.length/3;v<b;v++)h.fromArray(f,3*v),w(h,v)}}else{var x=a.vertices;for(v=0,b=x.length;v<b;v++)w(x[v],v)}}function w(t,n){var a=e.distanceSqToPoint(t);if(a<l){e.closestPointToPoint(t,d),d.applyMatrix4(s);var c=r.ray.origin.distanceTo(d);if(c<r.near||c>r.far)return;i.push({distance:c,distanceToRay:Math.sqrt(a),point:d.clone(),index:n,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Xi.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Xi,isGroup:!0}),qi.prototype=Object.assign(Object.create(rn.prototype),{constructor:qi,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(Yi.prototype=Object.create(rn.prototype)).constructor=Yi,Yi.prototype.isCompressedTexture=!0,(Zi.prototype=Object.create(rn.prototype)).constructor=Zi,Zi.prototype.isDepthTexture=!0,(Ji.prototype=Object.create(Zn.prototype)).constructor=Ji,(Qi.prototype=Object.create(Dn.prototype)).constructor=Qi,(Ki.prototype=Object.create(Zn.prototype)).constructor=Ki,($i.prototype=Object.create(Dn.prototype)).constructor=$i,(to.prototype=Object.create(Zn.prototype)).constructor=to,(eo.prototype=Object.create(Dn.prototype)).constructor=eo,(no.prototype=Object.create(to.prototype)).constructor=no,(ro.prototype=Object.create(Dn.prototype)).constructor=ro,(io.prototype=Object.create(to.prototype)).constructor=io,(oo.prototype=Object.create(Dn.prototype)).constructor=oo,(ao.prototype=Object.create(to.prototype)).constructor=ao,(so.prototype=Object.create(Dn.prototype)).constructor=so,(co.prototype=Object.create(to.prototype)).constructor=co,(uo.prototype=Object.create(Dn.prototype)).constructor=uo,(lo.prototype=Object.create(Zn.prototype)).constructor=lo,(ho.prototype=Object.create(Dn.prototype)).constructor=ho,(po.prototype=Object.create(Zn.prototype)).constructor=po,(fo.prototype=Object.create(Dn.prototype)).constructor=fo,(mo.prototype=Object.create(Zn.prototype)).constructor=mo;var Uo={area:function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return Uo.area(t)<0},triangulateShape:function(t,e){var n=[],r=[],i=[];ko(t),jo(n,t);var o=t.length;e.forEach(ko);for(var a=0;a<e.length;a++)r.push(o),o+=e[a].length,jo(n,e[a]);var s=function(t,e,n){n=n||2;var r,i,o,a,s,c,u,l=e&&e.length,h=l?e[0]*n:t.length,d=vo(t,0,h,n,!0),p=[];if(!d)return p;if(l&&(d=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=vo(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(Ao(a));for(s.sort(So),i=0;i<s.length;i++)To(s[i],n),n=go(n,n.next);return n}(t,e,d,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var f=n;f<h;f+=n)c=t[f+1],(s=t[f])<r&&(r=s),c<i&&(i=c),s>o&&(o=s),c>a&&(a=c);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return yo(d,p,n,r,i,u),p}(n,r);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function ko(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function jo(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function Bo(t,e){Dn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new zo(t,e)),this.mergeVertices()}function zo(t,e){"undefined"!=typeof t&&(Zn.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function Vo(t,e){Dn.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Go(t,e)),this.mergeVertices()}function Go(t,e){var n=(e=e||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Dn;var r=n.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),zo.call(this,r,e),this.type="TextBufferGeometry"}function Ho(t,e,n,r,i,o,a){Dn.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Wo(t,e,n,r,i,o,a)),this.mergeVertices()}function Wo(t,e,n,r,i,o,a){Zn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var s,c,u=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),l=0,h=[],d=new Ye,p=new Ye,f=[],m=[],v=[],g=[];for(c=0;c<=n;c++){var y=[],b=c/n;for(s=0;s<=e;s++){var x=s/e;d.x=-t*Math.cos(r+x*i)*Math.sin(o+b*a),d.y=t*Math.cos(o+b*a),d.z=t*Math.sin(r+x*i)*Math.sin(o+b*a),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(x,1-b),y.push(l++)}h.push(y)}for(c=0;c<n;c++)for(s=0;s<e;s++){var w=h[c][s],_=h[c+1][s],S=h[c+1][s+1];(0!==c||o>0)&&f.push(h[c][s+1],w,S),(c!==n-1||u<Math.PI)&&f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new Hn(m,3)),this.addAttribute("normal",new Hn(v,3)),this.addAttribute("uv",new Hn(g,2))}function Xo(t,e,n,r,i,o){Dn.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new qo(t,e,n,r,i,o)),this.mergeVertices()}function qo(t,e,n,r,i,o){Zn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,c,u=[],l=[],h=[],d=[],p=t,f=(e-t)/(r=void 0!==r?Math.max(1,r):1),m=new Ye,v=new We;for(s=0;s<=r;s++){for(c=0;c<=n;c++)a=i+c/n*o,m.x=p*Math.cos(a),m.y=p*Math.sin(a),l.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/e+1)/2,v.y=(m.y/e+1)/2,d.push(v.x,v.y);p+=f}for(s=0;s<r;s++){var g=s*(n+1);for(c=0;c<n;c++){var y=(a=c+g)+n+1,b=a+n+2,x=a+1;u.push(a,y,x),u.push(y,b,x)}}this.setIndex(u),this.addAttribute("position",new Hn(l,3)),this.addAttribute("normal",new Hn(h,3)),this.addAttribute("uv",new Hn(d,2))}function Yo(t,e,n,r){Dn.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new Zo(t,e,n,r)),this.mergeVertices()}function Zo(t,e,n,r){Zn.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e)||12,n=n||0,r=r||2*Math.PI,r=He.clamp(r,0,2*Math.PI);var i,o,a,s=[],c=[],u=[],l=1/e,h=new Ye,d=new We;for(o=0;o<=e;o++){var p=n+o*l*r,f=Math.sin(p),m=Math.cos(p);for(a=0;a<=t.length-1;a++)h.x=t[a].x*f,h.y=t[a].y,h.z=t[a].x*m,c.push(h.x,h.y,h.z),d.x=o/e,d.y=a/(t.length-1),u.push(d.x,d.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var v=(i=a+o*t.length)+t.length,g=i+t.length+1,y=i+1;s.push(i,v,y),s.push(v,g,y)}if(this.setIndex(s),this.addAttribute("position",new Hn(c,3)),this.addAttribute("uv",new Hn(u,2)),this.computeVertexNormals(),r===2*Math.PI){var b=this.attributes.normal.array,x=new Ye,w=new Ye,_=new Ye;for(i=e*t.length*3,o=0,a=0;o<t.length;o++,a+=3)x.x=b[a+0],x.y=b[a+1],x.z=b[a+2],w.x=b[i+a+0],w.y=b[i+a+1],w.z=b[i+a+2],_.addVectors(x,w).normalize(),b[a+0]=b[i+a+0]=_.x,b[a+1]=b[i+a+1]=_.y,b[a+2]=b[i+a+2]=_.z}}function Jo(t,e){Dn.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Qo(t,e)),this.mergeVertices()}function Qo(t,e){Zn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var n=[],r=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(t))u(t);else for(var c=0;c<t.length;c++)u(t[c]),this.addGroup(a,s,c),a+=s,s=0;function u(t){var a,c,u,l=r.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;if(!1===Uo.isClockWise(d))for(d=d.reverse(),a=0,c=p.length;a<c;a++)!0===Uo.isClockWise(u=p[a])&&(p[a]=u.reverse());var f=Uo.triangulateShape(d,p);for(a=0,c=p.length;a<c;a++)d=d.concat(u=p[a]);for(a=0,c=d.length;a<c;a++){var m=d[a];r.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,c=f.length;a<c;a++){var v=f[a];n.push(v[0]+l,v[1]+l,v[2]+l),s+=3}}this.setIndex(n),this.addAttribute("position",new Hn(r,3)),this.addAttribute("normal",new Hn(i,3)),this.addAttribute("uv",new Hn(o,2))}function Ko(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++)e.shapes.push(t[n].uuid);else e.shapes.push(t.uuid);return e}function $o(t,e){Zn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var n,r,i,o,a=[],s=Math.cos(He.DEG2RAD*e),c=[0,0],u={},l=["a","b","c"];t.isBufferGeometry?(o=new Dn).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)n=m[l[v]],r=m[l[(v+1)%3]],c[0]=Math.min(n,r),c[1]=Math.max(n,r),void 0===u[i=c[0]+","+c[1]]?u[i]={index1:c[0],index2:c[1],face1:p,face2:void 0}:u[i].face2=p;for(i in u){var g=u[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];a.push(y.x,y.y,y.z),a.push((y=h[g.index2]).x,y.y,y.z)}}this.addAttribute("position",new Hn(a,3))}function ta(t,e,n,r,i,o,a,s){Dn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new ea(t,e,n,r,i,o,a,s)),this.mergeVertices()}function ea(t,e,n,r,i,o,a,s){Zn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var c=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var u=[],l=[],h=[],d=[],p=0,f=[],m=n/2,v=0;function g(n){var i,o,f,g=new We,y=new Ye,b=0,x=!0===n?t:e,w=!0===n?1:-1;for(o=p,i=1;i<=r;i++)l.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=r;i++){var _=i/r*s+a,S=Math.cos(_),T=Math.sin(_);y.x=x*T,y.y=m*w,y.z=x*S,l.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<r;i++){var M=o+i,A=f+i;!0===n?u.push(A,A+1,M):u.push(A+1,A,M),b+=3}c.addGroup(v,b,!0===n?1:2),v+=b}!function(){var o,g,y=new Ye,b=new Ye,x=0,w=(e-t)/n;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(e-t)+t;for(o=0;o<=r;o++){var M=o/r,A=M*s+a,E=Math.sin(A),C=Math.cos(A);b.x=T*E,b.y=-S*n+m,b.z=T*C,l.push(b.x,b.y,b.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<r;o++)for(g=0;g<i;g++){var P=f[g+1][o],O=f[g+1][o+1],N=f[g][o+1];u.push(f[g][o],P,N),u.push(P,O,N),x+=6}c.addGroup(v,x,0),v+=x}(),!1===o&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(u),this.addAttribute("position",new Hn(l,3)),this.addAttribute("normal",new Hn(h,3)),this.addAttribute("uv",new Hn(d,2))}function na(t,e,n,r,i,o,a){ta.call(this,0,t,e,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function ra(t,e,n,r,i,o,a){ea.call(this,0,t,e,n,r,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function ia(t,e,n,r){Dn.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new oa(t,e,n,r)),this.mergeVertices()}function oa(t,e,n,r){Zn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o,a=[],s=[],c=[],u=[],l=new Ye,h=new We;for(s.push(0,0,0),c.push(0,0,1),u.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var d=n+o/e*r;l.x=t*Math.cos(d),l.y=t*Math.sin(d),s.push(l.x,l.y,l.z),c.push(0,0,1),h.x=(s[i]/t+1)/2,h.y=(s[i+1]/t+1)/2,u.push(h.x,h.y)}for(i=1;i<=e;i++)a.push(i,i+1,0);this.setIndex(a),this.addAttribute("position",new Hn(s,3)),this.addAttribute("normal",new Hn(c,3)),this.addAttribute("uv",new Hn(u,2))}(Bo.prototype=Object.create(Dn.prototype)).constructor=Bo,(zo.prototype=Object.create(Zn.prototype)).constructor=zo,zo.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],n=this.getAttribute("uv"),r=n?Array.prototype.slice.call(n.array):[],i=this.index;return{position:e,uv:r,index:i?Array.prototype.slice.call(i.array):[]}},zo.prototype.addShapeList=function(t,e){var n=t.length;e.arrays=this.getArrays();for(var r=0;r<n;r++)this.addShape(t[r],e);this.setIndex(e.arrays.index),this.addAttribute("position",new Hn(e.arrays.position,3)),this.addAttribute("uv",new Hn(e.arrays.uv,2))},zo.prototype.addShape=function(t,e){var n,r,i,o,a,s,c,u,l=e.arrays?e.arrays:this.getArrays(),h=l.position,d=l.index,p=l.uv,f=[],m=void 0!==e.amount?e.amount:100,v=void 0!==e.bevelThickness?e.bevelThickness:6,g=void 0!==e.bevelSize?e.bevelSize:v-2,y=void 0!==e.bevelSegments?e.bevelSegments:3,b=void 0===e.bevelEnabled||e.bevelEnabled,x=void 0!==e.curveSegments?e.curveSegments:12,w=void 0!==e.steps?e.steps:1,_=e.extrudePath,S=!1,T=void 0!==e.UVGenerator?e.UVGenerator:Bo.WorldUVGenerator;_&&(n=_.getSpacedPoints(w),S=!0,b=!1,r=void 0!==e.frames?e.frames:_.computeFrenetFrames(w,!1),i=new Ye,o=new Ye,a=new Ye),b||(y=0,v=0,g=0);var M=this,A=t.extractPoints(x),E=A.shape,C=A.holes;if(!Uo.isClockWise(E))for(E=E.reverse(),c=0,u=C.length;c<u;c++)Uo.isClockWise(s=C[c])&&(C[c]=s.reverse());var P=Uo.triangulateShape(E,C),O=E;for(c=0,u=C.length;c<u;c++)E=E.concat(s=C[c]);function N(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}var L,I,R,D,F,U,k=E.length,j=P.length;function B(t,e,n){var r,i,o,a=t.x-e.x,s=t.y-e.y,c=n.x-t.x,u=n.y-t.y,l=a*a+s*s;if(Math.abs(a*u-s*c)>Number.EPSILON){var h=Math.sqrt(l),d=Math.sqrt(c*c+u*u),p=e.x-s/h,f=e.y+a/h,m=((n.x-u/d-p)*u-(n.y+c/d-f)*c)/(a*u-s*c),v=(r=p+a*m-t.x)*r+(i=f+s*m-t.y)*i;if(v<=2)return new We(r,i);o=Math.sqrt(v/2)}else{var g=!1;a>Number.EPSILON?c>Number.EPSILON&&(g=!0):a<-Number.EPSILON?c<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(u)&&(g=!0),g?(r=-s,i=a,o=Math.sqrt(l)):(r=a,i=s,o=Math.sqrt(l/2))}return new We(r/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=B(O[V],O[H],O[W]);var X,q,Y=[],Z=z.concat();for(c=0,u=C.length;c<u;c++){for(X=[],H=(G=(s=C[c]).length)-1,W=1+(V=0);V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=B(s[V],s[H],s[W]);Y.push(X),Z=Z.concat(X)}for(L=0;L<y;L++){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,-D);for(c=0,u=C.length;c<u;c++)for(X=Y[c],V=0,G=(s=C[c]).length;V<G;V++)Q((F=N(s[V],X[V],I)).x,F.y,-D)}for(I=g,V=0;V<k;V++)F=b?N(E[V],Z[V],I):E[V],S?(o.copy(r.normals[0]).multiplyScalar(F.x),i.copy(r.binormals[0]).multiplyScalar(F.y),a.copy(n[0]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,0);for(q=1;q<=w;q++)for(V=0;V<k;V++)F=b?N(E[V],Z[V],I):E[V],S?(o.copy(r.normals[q]).multiplyScalar(F.x),i.copy(r.binormals[q]).multiplyScalar(F.y),a.copy(n[q]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,m/w*q);for(L=y-1;L>=0;L--){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,m+D);for(c=0,u=C.length;c<u;c++)for(X=Y[c],V=0,G=(s=C[c]).length;V<G;V++)F=N(s[V],X[V],I),S?Q(F.x,F.y+n[w-1].y,n[w-1].x+D):Q(F.x,F.y,m+D)}function J(t,e){var n,r;for(V=t.length;--V>=0;){n=V,(r=V-1)<0&&(r=t.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var a=k*i,s=k*(i+1);$(e+n+a,e+r+a,e+r+s,e+n+s)}}}function Q(t,e,n){f.push(t),f.push(e),f.push(n)}function K(t,e,n){tt(t),tt(e),tt(n);var r=h.length/3,i=T.generateTopUV(M,h,r-3,r-2,r-1);et(i[0]),et(i[1]),et(i[2])}function $(t,e,n,r){tt(t),tt(e),tt(r),tt(e),tt(n),tt(r);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);et(o[0]),et(o[1]),et(o[3]),et(o[1]),et(o[2]),et(o[3])}function tt(t){d.push(h.length/3),h.push(f[3*t+0]),h.push(f[3*t+1]),h.push(f[3*t+2])}function et(t){p.push(t.x),p.push(t.y)}!function(){var t=h.length/3;if(b){var e=0,n=k*e;for(V=0;V<j;V++)K((U=P[V])[2]+n,U[1]+n,U[0]+n);for(n=k*(e=w+2*y),V=0;V<j;V++)K((U=P[V])[0]+n,U[1]+n,U[2]+n)}else{for(V=0;V<j;V++)K((U=P[V])[2],U[1],U[0]);for(V=0;V<j;V++)K((U=P[V])[0]+k*w,U[1]+k*w,U[2]+k*w)}M.addGroup(t,h.length/3-t,0)}(),function(){var t=h.length/3,e=0;for(J(O,e),e+=O.length,c=0,u=C.length;c<u;c++)J(s=C[c],e),e+=s.length;M.addGroup(t,h.length/3-t,1)}(),e.arrays||(this.setIndex(d),this.addAttribute("position",new Hn(h,3)),this.addAttribute("uv",new Hn(p,2)))},Bo.WorldUVGenerator={generateTopUV:function(t,e,n,r,i){var o=e[3*r],a=e[3*r+1],s=e[3*i],c=e[3*i+1];return[new We(e[3*n],e[3*n+1]),new We(o,a),new We(s,c)]},generateSideWallUV:function(t,e,n,r,i,o){var a=e[3*n],s=e[3*n+1],c=e[3*n+2],u=e[3*r],l=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],v=e[3*o+1],g=e[3*o+2];return Math.abs(s-l)<.01?[new We(a,1-c),new We(u,1-h),new We(d,1-f),new We(m,1-g)]:[new We(s,1-c),new We(l,1-h),new We(p,1-f),new We(v,1-g)]}},(Vo.prototype=Object.create(Dn.prototype)).constructor=Vo,(Go.prototype=Object.create(zo.prototype)).constructor=Go,(Ho.prototype=Object.create(Dn.prototype)).constructor=Ho,(Wo.prototype=Object.create(Zn.prototype)).constructor=Wo,(Xo.prototype=Object.create(Dn.prototype)).constructor=Xo,(qo.prototype=Object.create(Zn.prototype)).constructor=qo,(Yo.prototype=Object.create(Dn.prototype)).constructor=Yo,(Zo.prototype=Object.create(Zn.prototype)).constructor=Zo,(Jo.prototype=Object.create(Dn.prototype)).constructor=Jo,Jo.prototype.toJSON=function(){var t=Dn.prototype.toJSON.call(this);return Ko(this.parameters.shapes,t)},(Qo.prototype=Object.create(Zn.prototype)).constructor=Qo,Qo.prototype.toJSON=function(){var t=Zn.prototype.toJSON.call(this);return Ko(this.parameters.shapes,t)},($o.prototype=Object.create(Zn.prototype)).constructor=$o,(ta.prototype=Object.create(Dn.prototype)).constructor=ta,(ea.prototype=Object.create(Zn.prototype)).constructor=ea,(na.prototype=Object.create(ta.prototype)).constructor=na,(ra.prototype=Object.create(ea.prototype)).constructor=ra,(ia.prototype=Object.create(Dn.prototype)).constructor=ia,(oa.prototype=Object.create(Zn.prototype)).constructor=oa;var aa=Object.freeze({WireframeGeometry:Ji,ParametricGeometry:Qi,ParametricBufferGeometry:Ki,TetrahedronGeometry:eo,TetrahedronBufferGeometry:no,OctahedronGeometry:ro,OctahedronBufferGeometry:io,IcosahedronGeometry:oo,IcosahedronBufferGeometry:ao,DodecahedronGeometry:so,DodecahedronBufferGeometry:co,PolyhedronGeometry:$i,PolyhedronBufferGeometry:to,TubeGeometry:uo,TubeBufferGeometry:lo,TorusKnotGeometry:ho,TorusKnotBufferGeometry:po,TorusGeometry:fo,TorusBufferGeometry:mo,TextGeometry:Vo,TextBufferGeometry:Go,SphereGeometry:Ho,SphereBufferGeometry:Wo,RingGeometry:Xo,RingBufferGeometry:qo,PlaneGeometry:Kn,PlaneBufferGeometry:$n,LatheGeometry:Yo,LatheBufferGeometry:Zo,ShapeGeometry:Jo,ShapeBufferGeometry:Qo,ExtrudeGeometry:Bo,ExtrudeBufferGeometry:zo,EdgesGeometry:$o,ConeGeometry:na,ConeBufferGeometry:ra,CylinderGeometry:ta,CylinderBufferGeometry:ea,CircleGeometry:ia,CircleBufferGeometry:oa,BoxGeometry:Jn,BoxBufferGeometry:Qn});function sa(t){cr.call(this),this.type="ShadowMaterial",this.color=new gn(0),this.transparent=!0,this.setValues(t)}function ca(t){lr.call(this,t),this.type="RawShaderMaterial"}function ua(t){cr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new gn(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function la(t){ua.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function ha(t){cr.call(this),this.type="MeshPhongMaterial",this.color=new gn(16777215),this.specular=new gn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ct,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function da(t){ha.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function pa(t){cr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function fa(t){cr.call(this),this.type="MeshLambertMaterial",this.color=new gn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ct,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ma(t){Bi.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}(sa.prototype=Object.create(cr.prototype)).constructor=sa,sa.prototype.isShadowMaterial=!0,sa.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.color.copy(t.color),this},(ca.prototype=Object.create(lr.prototype)).constructor=ca,ca.prototype.isRawShaderMaterial=!0,(ua.prototype=Object.create(cr.prototype)).constructor=ua,ua.prototype.isMeshStandardMaterial=!0,ua.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(la.prototype=Object.create(ua.prototype)).constructor=la,la.prototype.isMeshPhysicalMaterial=!0,la.prototype.copy=function(t){return ua.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},(ha.prototype=Object.create(cr.prototype)).constructor=ha,ha.prototype.isMeshPhongMaterial=!0,ha.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(da.prototype=Object.create(ha.prototype)).constructor=da,da.prototype.isMeshToonMaterial=!0,da.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},(pa.prototype=Object.create(cr.prototype)).constructor=pa,pa.prototype.isMeshNormalMaterial=!0,pa.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(fa.prototype=Object.create(cr.prototype)).constructor=fa,fa.prototype.isMeshLambertMaterial=!0,fa.prototype.copy=function(t){return cr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(ma.prototype=Object.create(Bi.prototype)).constructor=ma,ma.prototype.isLineDashedMaterial=!0,ma.prototype.copy=function(t){return Bi.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var va=Object.freeze({ShadowMaterial:sa,SpriteMaterial:Ri,RawShaderMaterial:ca,ShaderMaterial:lr,PointsMaterial:Hi,MeshPhysicalMaterial:la,MeshStandardMaterial:ua,MeshPhongMaterial:ha,MeshToonMaterial:da,MeshNormalMaterial:pa,MeshLambertMaterial:fa,MeshDepthMaterial:_i,MeshDistanceMaterial:Si,MeshBasicMaterial:ur,LineDashedMaterial:ma,LineBasicMaterial:Bi,Material:cr}),ga={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function ya(t,e,n){var r=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this}}var ba=new ya,xa={};function wa(t){this.manager=void 0!==t?t:ba}function _a(t){this.manager=void 0!==t?t:ba,this._parser=null}function Sa(t){this.manager=void 0!==t?t:ba,this._parser=null}function Ta(t){this.manager=void 0!==t?t:ba}function Ma(t){this.manager=void 0!==t?t:ba}function Aa(t){this.manager=void 0!==t?t:ba}function Ea(){this.type="Curve",this.arcLengthDivisions=200}function Ca(t,e,n,r,i,o,a,s){Ea.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Pa(t,e,n,r,i,o){Ca.call(this,t,e,n,n,r,i,o),this.type="ArcCurve"}function Oa(){var t=0,e=0,n=0,r=0;function i(i,o,a,s){t=i,e=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,a,s){var c=(e-t)/o-(n-t)/(o+a)+(n-e)/a,u=(n-e)/a-(r-e)/(a+s)+(r-n)/s;i(e,n,c*=a,u*=a)},calc:function(i){var o=i*i;return t+e*i+n*o+r*(o*i)}}}Object.assign(wa.prototype,{load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=ga.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===xa[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],c=!!a[2],u=a[3];u=window.decodeURIComponent(u),c&&(u=window.atob(u));try{var l,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),p=0;p<u.length;p++)d[p]=u.charCodeAt(p);l="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;l=f.parseFromString(u,s);break;case"json":l=JSON.parse(u);break;default:l=u}window.setTimeout(function(){e&&e(l),i.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){r&&r(e),i.manager.itemEnd(t),i.manager.itemError(t)},0)}}else{xa[t]=[],xa[t].push({onLoad:e,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",t,!0),m.addEventListener("load",function(e){var n=this.response;ga.add(t,n);var r=xa[t];if(delete xa[t],200===this.status){for(var o=0,a=r.length;o<a;o++)(s=r[o]).onLoad&&s.onLoad(n);i.manager.itemEnd(t)}else if(0===this.status){for(console.warn("THREE.FileLoader: HTTP Status 0 received."),o=0,a=r.length;o<a;o++)(s=r[o]).onLoad&&s.onLoad(n);i.manager.itemEnd(t)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)}},!1),m.addEventListener("progress",function(e){for(var n=xa[t],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(e)}},!1),m.addEventListener("error",function(e){var n=xa[t];delete xa[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(t),m}xa[t].push({onLoad:e,onProgress:n,onError:r})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(_a.prototype,{load:function(t,e,n,r){var i=this,o=[],a=new Yi;a.image=o;var s=new wa(this.manager);function c(c){s.load(t[c],function(t){var n=i._parser(t,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(u+=1)&&(1===n.mipmapCount&&(a.minFilter=Ot),a.format=n.format,a.needsUpdate=!0,e&&e(a))},n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var u=0,l=0,h=t.length;l<h;++l)c(l);else s.load(t,function(t){var n=i._parser(t,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var c=0;c<n.mipmapCount;c++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+c]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=Ot),a.format=n.format,a.needsUpdate=!0,e&&e(a)},n,r);return a},setPath:function(t){return this.path=t,this}}),Object.assign(Sa.prototype,{load:function(t,e,n,r){var i=this,o=new cn,a=new wa(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){var n=i._parser(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:Mt,o.wrapT=void 0!==n.wrapT?n.wrapT:Mt,o.magFilter=void 0!==n.magFilter?n.magFilter:Ot,o.minFilter=void 0!==n.minFilter?n.minFilter:Lt,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps),1===n.mipmapCount&&(o.minFilter=Ot),o.needsUpdate=!0,e&&e(o,n))},n,r),o}}),Object.assign(Ta.prototype,{crossOrigin:"Anonymous",load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=ga.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){ga.add(t,this),e&&e(this),i.manager.itemEnd(t)},!1),a.addEventListener("error",function(e){r&&r(e),i.manager.itemEnd(t),i.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Ma.prototype,{crossOrigin:"Anonymous",load:function(t,e,n,r){var i=new vr,o=new Ta(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(t[n],function(t){i.images[n]=t,6==++a&&(i.needsUpdate=!0,e&&e(i))},void 0,r)}for(var c=0;c<t.length;++c)s(c);return i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Aa.prototype,{crossOrigin:"Anonymous",load:function(t,e,n,r){var i=new rn,o=new Ta(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(n){i.image=n;var r=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?Xt:qt,i.needsUpdate=!0,void 0!==e&&e(i)},n,r),i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Ea.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=t;n++)o+=(e=this.getPoint(n/t)).distanceTo(i),r.push(o),i=e;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n,r=this.getLengths(),i=0,o=r.length;n=e||t*r[o-1];for(var a,s=0,c=o-1;s<=c;)if((a=r[i=Math.floor(s+(c-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){c=i;break}c=i-1}if(r[i=c]===n)return i/(o-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(o-1)},getTangent:function(t){var e=t-1e-4,n=t+1e-4;e<0&&(e=0),n>1&&(n=1);var r=this.getPoint(e);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var n,r,i=new Ye,o=[],a=[],s=[],c=new Ye,u=new Xe;for(n=0;n<=t;n++)o[n]=this.getTangentAt(n/t),o[n].normalize();a[0]=new Ye,s[0]=new Ye;var l=Number.MAX_VALUE,h=Math.abs(o[0].x),d=Math.abs(o[0].y),p=Math.abs(o[0].z);for(h<=l&&(l=h,i.set(1,0,0)),d<=l&&(l=d,i.set(0,1,0)),p<=l&&i.set(0,0,1),c.crossVectors(o[0],i).normalize(),a[0].crossVectors(o[0],c),s[0].crossVectors(o[0],a[0]),n=1;n<=t;n++)a[n]=a[n-1].clone(),s[n]=s[n-1].clone(),c.crossVectors(o[n-1],o[n]),c.length()>Number.EPSILON&&(c.normalize(),r=Math.acos(He.clamp(o[n-1].dot(o[n]),-1,1)),a[n].applyMatrix4(u.makeRotationAxis(c,r))),s[n].crossVectors(o[n],a[n]);if(!0===e)for(r=Math.acos(He.clamp(a[0].dot(a[t]),-1,1)),r/=t,o[0].dot(c.crossVectors(a[0],a[t]))>0&&(r=-r),n=1;n<=t;n++)a[n].applyMatrix4(u.makeRotationAxis(o[n],r*n)),s[n].crossVectors(o[n],a[n]);return{tangents:o,normals:a,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),(Ca.prototype=Object.create(Ea.prototype)).constructor=Ca,Ca.prototype.isEllipseCurve=!0,Ca.prototype.getPoint=function(t,e){for(var n=e||new We,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,d=c-this.aY;s=h*u-d*l+this.aX,c=h*l+d*u+this.aY}return n.set(s,c)},Ca.prototype.copy=function(t){return Ea.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Ca.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Ca.prototype.fromJSON=function(t){return Ea.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},(Pa.prototype=Object.create(Ca.prototype)).constructor=Pa,Pa.prototype.isArcCurve=!0;var Na=new Ye,La=new Oa,Ia=new Oa,Ra=new Oa;function Da(t,e,n,r){Ea.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Fa(t,e,n,r,i){var o=.5*(r-e),a=.5*(i-n),s=t*t;return(2*n-2*r+o+a)*(t*s)+(-3*n+3*r-2*o-a)*s+o*t+n}function Ua(t,e,n,r){return function(t,n){var r=1-t;return r*r*e}(t)+function(t,e){return 2*(1-t)*t*n}(t)+function(t,e){return t*t*r}(t)}function ka(t,e,n,r,i){return function(t,n){var r=1-t;return r*r*r*e}(t)+function(t,e){var r=1-t;return 3*r*r*t*n}(t)+function(t,e){return 3*(1-t)*t*t*r}(t)+function(t,e){return t*t*t*i}(t)}function ja(t,e,n,r){Ea.call(this),this.type="CubicBezierCurve",this.v0=t||new We,this.v1=e||new We,this.v2=n||new We,this.v3=r||new We}function Ba(t,e,n,r){Ea.call(this),this.type="CubicBezierCurve3",this.v0=t||new Ye,this.v1=e||new Ye,this.v2=n||new Ye,this.v3=r||new Ye}function za(t,e){Ea.call(this),this.type="LineCurve",this.v1=t||new We,this.v2=e||new We}function Va(t,e){Ea.call(this),this.type="LineCurve3",this.v1=t||new Ye,this.v2=e||new Ye}function Ga(t,e,n){Ea.call(this),this.type="QuadraticBezierCurve",this.v0=t||new We,this.v1=e||new We,this.v2=n||new We}function Ha(t,e,n){Ea.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Ye,this.v1=e||new Ye,this.v2=n||new Ye}function Wa(t){Ea.call(this),this.type="SplineCurve",this.points=t||[]}(Da.prototype=Object.create(Ea.prototype)).constructor=Da,Da.prototype.isCatmullRomCurve3=!0,Da.prototype.getPoint=function(t,e){var n,r,i,o,a=e||new Ye,s=this.points,c=s.length,u=(c-(this.closed?0:1))*t,l=Math.floor(u),h=u-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s.length)+1)*s.length:0===h&&l===c-1&&(l=c-2,h=1),this.closed||l>0?n=s[(l-1)%c]:(Na.subVectors(s[0],s[1]).add(s[0]),n=Na),r=s[l%c],i=s[(l+1)%c],this.closed||l+2<c?o=s[(l+2)%c]:(Na.subVectors(s[c-1],s[c-2]).add(s[c-1]),o=Na),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(n.distanceToSquared(r),d),f=Math.pow(r.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),La.initNonuniformCatmullRom(n.x,r.x,i.x,o.x,p,f,m),Ia.initNonuniformCatmullRom(n.y,r.y,i.y,o.y,p,f,m),Ra.initNonuniformCatmullRom(n.z,r.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(La.initCatmullRom(n.x,r.x,i.x,o.x,this.tension),Ia.initCatmullRom(n.y,r.y,i.y,o.y,this.tension),Ra.initCatmullRom(n.z,r.z,i.z,o.z,this.tension));return a.set(La.calc(h),Ia.calc(h),Ra.calc(h)),a},Da.prototype.copy=function(t){Ea.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Da.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Da.prototype.fromJSON=function(t){Ea.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new Ye).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},(ja.prototype=Object.create(Ea.prototype)).constructor=ja,ja.prototype.isCubicBezierCurve=!0,ja.prototype.getPoint=function(t,e){var n=e||new We,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(ka(t,r.x,i.x,o.x,a.x),ka(t,r.y,i.y,o.y,a.y)),n},ja.prototype.copy=function(t){return Ea.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ja.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ja.prototype.fromJSON=function(t){return Ea.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(Ba.prototype=Object.create(Ea.prototype)).constructor=Ba,Ba.prototype.isCubicBezierCurve3=!0,Ba.prototype.getPoint=function(t,e){var n=e||new Ye,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(ka(t,r.x,i.x,o.x,a.x),ka(t,r.y,i.y,o.y,a.y),ka(t,r.z,i.z,o.z,a.z)),n},Ba.prototype.copy=function(t){return Ea.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Ba.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Ba.prototype.fromJSON=function(t){return Ea.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(za.prototype=Object.create(Ea.prototype)).constructor=za,za.prototype.isLineCurve=!0,za.prototype.getPoint=function(t,e){var n=e||new We;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},za.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},za.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},za.prototype.copy=function(t){return Ea.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},za.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},za.prototype.fromJSON=function(t){return Ea.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(Va.prototype=Object.create(Ea.prototype)).constructor=Va,Va.prototype.isLineCurve3=!0,Va.prototype.getPoint=function(t,e){var n=e||new Ye;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Va.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Va.prototype.copy=function(t){return Ea.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Va.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Va.prototype.fromJSON=function(t){return Ea.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(Ga.prototype=Object.create(Ea.prototype)).constructor=Ga,Ga.prototype.isQuadraticBezierCurve=!0,Ga.prototype.getPoint=function(t,e){var n=e||new We,r=this.v0,i=this.v1,o=this.v2;return n.set(Ua(t,r.x,i.x,o.x),Ua(t,r.y,i.y,o.y)),n},Ga.prototype.copy=function(t){return Ea.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ga.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ga.prototype.fromJSON=function(t){return Ea.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(Ha.prototype=Object.create(Ea.prototype)).constructor=Ha,Ha.prototype.isQuadraticBezierCurve3=!0,Ha.prototype.getPoint=function(t,e){var n=e||new Ye,r=this.v0,i=this.v1,o=this.v2;return n.set(Ua(t,r.x,i.x,o.x),Ua(t,r.y,i.y,o.y),Ua(t,r.z,i.z,o.z)),n},Ha.prototype.copy=function(t){return Ea.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ha.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ha.prototype.fromJSON=function(t){return Ea.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(Wa.prototype=Object.create(Ea.prototype)).constructor=Wa,Wa.prototype.isSplineCurve=!0,Wa.prototype.getPoint=function(t,e){var n=e||new We,r=this.points,i=(r.length-1)*t,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return n.set(Fa(a,s.x,c.x,u.x,l.x),Fa(a,s.y,c.y,u.y,l.y)),n},Wa.prototype.copy=function(t){Ea.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this},Wa.prototype.toJSON=function(){var t=Ea.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t},Wa.prototype.fromJSON=function(t){Ea.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new We).fromArray(r))}return this};var Xa=Object.freeze({ArcCurve:Pa,CatmullRomCurve3:Da,CubicBezierCurve:ja,CubicBezierCurve3:Ba,EllipseCurve:Ca,LineCurve:za,LineCurve3:Va,QuadraticBezierCurve:Ga,QuadraticBezierCurve3:Ha,SplineCurve:Wa});function qa(){Ea.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ya(t){qa.call(this),this.type="Path",this.currentPoint=new We,t&&this.setFromPoints(t)}function Za(t){Ya.call(this,t),this.uuid=He.generateUUID(),this.type="Shape",this.holes=[]}function Ja(t,e){Cn.call(this),this.type="Light",this.color=new gn(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Qa(t,e,n){Ja.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Cn.DefaultUp),this.updateMatrix(),this.groundColor=new gn(e)}function Ka(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new We(512,512),this.map=null,this.matrix=new Xe}function $a(){Ka.call(this,new Ei(50,1,.5,500))}function ts(t,e,n,r,i,o){Ja.call(this,t,e),this.type="SpotLight",this.position.copy(Cn.DefaultUp),this.updateMatrix(),this.target=new Cn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new $a}function es(t,e,n,r){Ja.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Ka(new Ei(90,1,.5,500))}function ns(){Ka.call(this,new On(-5,5,5,-5,.5,500))}function rs(t,e){Ja.call(this,t,e),this.type="DirectionalLight",this.position.copy(Cn.DefaultUp),this.updateMatrix(),this.target=new Cn,this.shadow=new ns}function is(t,e){Ja.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function os(t,e,n,r){Ja.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function as(t,e,n,r){gs.call(this,t,e,n,r)}function ss(t,e,n){gs.call(this,t,e,n)}function cs(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function us(t,e,n,r){cs.call(this,t,e,n,r)}function ls(t,e,n,r){gs.call(this,t,e,n,r)}function hs(t,e,n,r){gs.call(this,t,e,n,r)}function ds(t,e,n,r){gs.call(this,t,e,n,r)}function ps(t,e,n,r){cs.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function fs(t,e,n,r){cs.call(this,t,e,n,r)}function ms(t,e,n,r){cs.call(this,t,e,n,r)}qa.prototype=Object.assign(Object.create(Ea.prototype),{constructor:qa,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new za(e,t))},getPoint:function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=e){var i=n[r]-e,o=this.curves[r],a=o.getLength();return o.getPointAt(0===a?0:1-i/a)}r++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o.getPoints(o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t),s=0;s<a.length;s++){var c=a[s];e&&e.equals(c)||(n.push(c),e=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){Ea.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=Ea.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){Ea.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push((new Xa[r.type]).fromJSON(r))}return this}}),Ya.prototype=Object.assign(Object.create(qa.prototype),{constructor:Ya,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var n=new za(this.currentPoint.clone(),new We(t,e));this.curves.push(n),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,n,r){var i=new Ga(this.currentPoint.clone(),new We(t,e),new We(n,r));this.curves.push(i),this.currentPoint.set(n,r)},bezierCurveTo:function(t,e,n,r,i,o){var a=new ja(this.currentPoint.clone(),new We(t,e),new We(n,r),new We(i,o));this.curves.push(a),this.currentPoint.set(i,o)},splineThru:function(t){var e=new Wa([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,n,r,i,o){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o)},absarc:function(t,e,n,r,i,o){this.absellipse(t,e,n,n,r,i,o)},ellipse:function(t,e,n,r,i,o,a,s){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o,a,s)},absellipse:function(t,e,n,r,i,o,a,s){var c=new Ca(t,e,n,r,i,o,a,s);if(this.curves.length>0){var u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);var l=c.getPoint(1);this.currentPoint.copy(l)},copy:function(t){return qa.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=qa.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return qa.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Za.prototype=Object.assign(Object.create(Ya.prototype),{constructor:Za,getPointsHoles:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Ya.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=Ya.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){Ya.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push((new Ya).fromJSON(r))}return this}}),Ja.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Ja,isLight:!0,copy:function(t){return Cn.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=Cn.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Qa.prototype=Object.assign(Object.create(Ja.prototype),{constructor:Qa,isHemisphereLight:!0,copy:function(t){return Ja.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Ka.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),$a.prototype=Object.assign(Object.create(Ka.prototype),{constructor:$a,isSpotLightShadow:!0,update:function(t){var e=this.camera,n=2*He.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix())}}),ts.prototype=Object.assign(Object.create(Ja.prototype),{constructor:ts,isSpotLight:!0,copy:function(t){return Ja.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),es.prototype=Object.assign(Object.create(Ja.prototype),{constructor:es,isPointLight:!0,copy:function(t){return Ja.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),ns.prototype=Object.assign(Object.create(Ka.prototype),{constructor:ns}),rs.prototype=Object.assign(Object.create(Ja.prototype),{constructor:rs,isDirectionalLight:!0,copy:function(t){return Ja.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),is.prototype=Object.assign(Object.create(Ja.prototype),{constructor:is,isAmbientLight:!0}),os.prototype=Object.assign(Object.create(Ja.prototype),{constructor:os,isRectAreaLight:!0,copy:function(t){return Ja.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Ja.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),as.prototype=Object.assign(Object.create(gs.prototype),{constructor:as,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Me,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ss.prototype=Object.assign(Object.create(gs.prototype),{constructor:ss,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Me,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(cs.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{var o;n:{r:if(!(t<r)){for(var a=n+2;;){if(void 0===r){if(t<i)break r;return this._cachedIndex=n=e.length,this.afterEnd_(n-1,t,i)}if(n===a)break;if(i=r,t<(r=e[++n]))break e}o=e.length;break n}if(t>=i)break t;var s=e[1];for(t<s&&(n=2,i=s),a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===a)break;if(r=i,t>=(i=e[--n-1]))break e}o=n,n=0}for(;n<o;){var c=n+o>>>1;t<e[c]?o=c:n=c+1}if(r=e[n],void 0===(i=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return this._cachedIndex=n=e.length,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r,o=0;o!==r;++o)e[o]=n[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(cs.prototype,{beforeStart_:cs.prototype.copySampleValue_,afterEnd_:cs.prototype.copySampleValue_}),us.prototype=Object.assign(Object.create(cs.prototype),{constructor:us,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=(n-e)/(r-e),u=s+a;s!==u;s+=4)qe.slerpFlat(i,0,o,s-a,o,s,c);return i}}),ls.prototype=Object.assign(Object.create(gs.prototype),{constructor:ls,ValueTypeName:"quaternion",DefaultInterpolation:Ae,InterpolantFactoryMethodLinear:function(t){return new us(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),hs.prototype=Object.assign(Object.create(gs.prototype),{constructor:hs,ValueTypeName:"color"}),ds.prototype=Object.assign(Object.create(gs.prototype),{constructor:ds,ValueTypeName:"number"}),ps.prototype=Object.assign(Object.create(cs.prototype),{constructor:ps,DefaultSettings_:{endingStart:Ce,endingEnd:Ce},intervalChanged_:function(t,e,n){var r=this.parameterPositions,i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case Pe:i=t,a=2*e-n;break;case Oe:a=e+r[i=r.length-2]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Pe:o=t,s=2*n-e;break;case Oe:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}var c=.5*(n-e),u=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(s-n),this._offsetPrev=i*u,this._offsetNext=o*u},interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=s-a,u=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f,x=0;x!==a;++x)i[x]=v*o[u+x]+g*o[c+x]+y*o[s+x]+b*o[l+x];return i}}),fs.prototype=Object.assign(Object.create(cs.prototype),{constructor:fs,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=s-a,u=(n-e)/(r-e),l=1-u,h=0;h!==a;++h)i[h]=o[c+h]*l+o[s+h]*u;return i}}),ms.prototype=Object.assign(Object.create(cs.prototype),{constructor:ms,interpolate_:function(t){return this.copySampleValue_(t-1)}});var vs={arraySlice:function(t,e,n){return vs.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=new Array(e),r=0;r!==e;++r)n[r]=r;return n.sort(function(e,n){return t[e]-t[n]}),n},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*e,c=0;c!==e;++c)i[a++]=t[s+c];return i},flattenJSON:function(t,e,n,r){for(var i=1,o=t[0];void 0!==o&&void 0===o[r];)o=t[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}}};function gs(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=vs.convertArray(e,this.TimeBufferType),this.values=vs.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation),this.validate(),this.optimize()}function ys(t,e,n,r){gs.call(this,t,e,n,r)}function bs(t,e,n){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.uuid=He.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function xs(t){this.manager=void 0!==t?t:ba,this.textures={}}function ws(t){this.manager=void 0!==t?t:ba}Object.assign(gs,{parse:function(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=gs._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var n=[],r=[];vs.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,n=t.constructor;if(void 0!==n.toJSON)e=n.toJSON(t);else{e={name:t.name,times:vs.convertArray(t.times,Array),values:vs.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(e.interpolation=r)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ds;case"vector":case"vector2":case"vector3":case"vector4":return ys;case"color":return hs;case"quaternion":return ls;case"bool":case"boolean":return ss;case"string":return as}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}}),Object.assign(gs.prototype,{constructor:gs,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ae,InterpolantFactoryMethodDiscrete:function(t){return new ms(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new fs(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new ps(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Me:e=this.InterpolantFactoryMethodDiscrete;break;case Ae:e=this.InterpolantFactoryMethodLinear;break;case Ee:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",n)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Me;case this.InterpolantFactoryMethodLinear:return Ae;case this.InterpolantFactoryMethodSmooth:return Ee}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=vs.arraySlice(n,i,o),this.values=vs.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==r&&vs.isTypedArray(r)){a=0;for(var c=r.length;a!==c;++a){var u=r[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,n=this.getValueSize(),r=this.getInterpolation()===Ee,i=1,o=t.length-1,a=1;a<o;++a){var s=!1,c=t[a];if(c!==t[a+1]&&(1!==a||c!==c[0]))if(r)s=!0;else for(var u=a*n,l=u-n,h=u+n,d=0;d!==n;++d){var p=e[u+d];if(p!==e[l+d]||p!==e[h+d]){s=!0;break}}if(s){if(a!==i){t[i]=t[a];var f=a*n,m=i*n;for(d=0;d!==n;++d)e[m+d]=e[f+d]}++i}}if(o>0){for(t[i]=t[o],f=o*n,m=i*n,d=0;d!==n;++d)e[m+d]=e[f+d];++i}return i!==t.length&&(this.times=vs.arraySlice(t,0,i),this.values=vs.arraySlice(e,0,i*n)),this}}),ys.prototype=Object.assign(Object.create(gs.prototype),{constructor:ys,ValueTypeName:"vector"}),Object.assign(bs,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,o=n.length;i!==o;++i)e.push(gs.parse(n[i]).scale(r));return new bs(t.name,t.duration,e)},toJSON:function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e},i=0,o=n.length;i!==o;++i)e.push(gs.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],c=[];s.push((a+i-1)%i,a,(a+1)%i),c.push(0,1,0);var u=vs.getKeyframeOrder(s);s=vs.sortedArray(s,1,u),c=vs.sortedArray(c,1,u),r||0!==s[0]||(s.push(i),c.push(c[0])),o.push(new ds(".morphTargetInfluences["+e[a].name+"]",s,c).scale(1/n))}return new bs(t,-1,o)},findByName:function(t,e){var n=t;Array.isArray(t)||(n=t.geometry&&t.geometry.animations||t.animations);for(var r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],c=s.name.match(i);if(c&&c.length>1){var u=r[h=c[1]];u||(r[h]=u=[]),u.push(s)}}var l=[];for(var h in r)l.push(bs.CreateFromMorphTargetSequence(h,r[h],e,n));return l},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,e,n,r,i){if(0!==n.length){var o=[],a=[];vs.flattenJSON(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],c=0;c<s.length;c++){var u=s[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var l={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)l[u[h].morphTargets[d]]=-1;for(var p in l){var f=[],m=[];for(d=0;d!==u[h].morphTargets.length;++d){var v=u[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}r.push(new ds(".morphTargetInfluence["+p+"]",f,m))}o=l.length*(a||1)}else{var g=".bones["+e[c].name+"]";n(ys,g+".position",u,"pos",r),n(ls,g+".quaternion",u,"rot",r),n(ys,g+".scale",u,"scl",r)}}return 0===r.length?null:new bs(i,o,r)}}),Object.assign(bs.prototype,{resetDuration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),Object.assign(xs.prototype,{load:function(t,e,n,r){var i=this;new wa(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var r=new va[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearCoat&&(r.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(r.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(r.uniforms=t.uniforms),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(r.vertexColors=t.vertexColors),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap),r.transparent=!0),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),r.normalScale=(new We).fromArray(i)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),r}}),Object.assign(ws.prototype,{load:function(t,e,n,r){var i=this;new wa(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},parse:function(t){var e=new Zn,n=t.data.index;if(void 0!==n){var r=new As[n.type](n.array);e.setIndex(new Fn(r,1))}var i=t.data.attributes;for(var o in i){var a=i[o];r=new As[a.type](a.array),e.addAttribute(o,new Fn(r,a.itemSize,a.normalized))}var s=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==s)for(var c=0,u=s.length;c!==u;++c){var l=s[c];e.addGroup(l.start,l.count,l.materialIndex)}var h=t.data.boundingSphere;if(void 0!==h){var d=new Ye;void 0!==h.center&&d.fromArray(h.center),e.boundingSphere=new ln(d,h.radius)}return e}});var _s,Ss,Ts,Ms,As={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Es(){}Es.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,n=0,r=e.length;n<r;n+=2){var i=e[n+1];if(e[n].test(t))return i}return null}},Object.assign(Es.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,n){for(var r=[],i=0;i<t.length;++i)r[i]=this.createMaterial(t[i],e,n);return r},createMaterial:(_s={NoBlending:L,NormalBlending:I,AdditiveBlending:R,SubtractiveBlending:D,MultiplyBlending:F,CustomBlending:U},Ss=new gn,Ts=new Aa,Ms=new xs,function(t,e,n){var r={};function i(t,i,o,a,s){var c,u=e+t,l=Es.Handlers.get(u);null!==l?c=l.load(u):(Ts.setCrossOrigin(n),c=Ts.load(u)),void 0!==i&&(c.repeat.fromArray(i),1!==i[0]&&(c.wrapS=Tt),1!==i[1]&&(c.wrapT=Tt)),void 0!==o&&c.offset.fromArray(o),void 0!==a&&("repeat"===a[0]&&(c.wrapS=Tt),"mirror"===a[0]&&(c.wrapS=At),"repeat"===a[1]&&(c.wrapT=Tt),"mirror"===a[1]&&(c.wrapT=At)),void 0!==s&&(c.anisotropy=s);var h=He.generateUUID();return r[h]=c,h}var o={uuid:He.generateUUID(),type:"MeshLambertMaterial"};for(var a in t){var s=t[a];switch(a){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":o.name=s;break;case"blending":o.blending=_s[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",a,"is no longer supported.");break;case"colorDiffuse":o.color=Ss.fromArray(s).getHex();break;case"colorSpecular":o.specular=Ss.fromArray(s).getHex();break;case"colorEmissive":o.emissive=Ss.fromArray(s).getHex();break;case"specularCoef":o.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(o.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(o.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(o.type="MeshStandardMaterial");break;case"mapDiffuse":o.map=i(s,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":o.emissiveMap=i(s,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":o.lightMap=i(s,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":o.aoMap=i(s,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":o.bumpMap=i(s,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":o.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":o.normalMap=i(s,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":o.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":o.specularMap=i(s,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":o.metalnessMap=i(s,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":o.roughnessMap=i(s,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":o.alphaMap=i(s,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":o.side=M;break;case"doubleSided":o.side=A;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),o.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":o[a]=s;break;case"vertexColors":!0===s&&(o.vertexColors=N),"face"===s&&(o.vertexColors=O);break;default:console.error("THREE.Loader.createMaterial: Unsupported",a,s)}}return"MeshBasicMaterial"===o.type&&delete o.emissive,"MeshPhongMaterial"!==o.type&&delete o.specular,o.opacity<1&&(o.transparent=!0),Ms.setTextures(r),Ms.parse(o)})});var Cs={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")}};function Ps(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:ba,this.withCredentials=!1}function Os(t){this.manager=void 0!==t?t:ba,this.texturePath=""}Object.assign(Ps.prototype,{load:function(t,e,n,r){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Cs.extractUrlBase(t),a=new wa(this.manager);a.setWithCredentials(this.withCredentials),a.load(t,function(n){var r=JSON.parse(n),a=r.metadata;if(void 0!==a){var s=a.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.")}var c=i.parse(r,o);e(c.geometry,c.materials)},n,r)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){void 0!==t.data&&(t=t.data),t.scale=void 0!==t.scale?1/t.scale:1;var n=new Dn;return function(t,e){function n(t,e){return t&1<<e}var r,i,o,a,s,c,u,l,h,d,p,f,m,v,g,y,b,x,w,_,S,T,M,A,E,C=t.faces,P=t.vertices,O=t.normals,N=t.colors,L=t.scale,I=0;if(void 0!==t.uvs){for(r=0;r<t.uvs.length;r++)t.uvs[r].length&&I++;for(r=0;r<I;r++)e.faceVertexUvs[r]=[]}for(a=0,s=P.length;a<s;)(x=new Ye).x=P[a++]*L,x.y=P[a++]*L,x.z=P[a++]*L,e.vertices.push(x);for(a=0,s=C.length;a<s;)if(p=n(d=C[a++],0),f=n(d,1),m=n(d,3),v=n(d,4),g=n(d,5),y=n(d,6),b=n(d,7),p){if((_=new Nn).a=C[a],_.b=C[a+1],_.c=C[a+3],(S=new Nn).a=C[a+1],S.b=C[a+2],S.c=C[a+3],a+=4,f&&(h=C[a++],_.materialIndex=h,S.materialIndex=h),o=e.faces.length,m)for(r=0;r<I;r++)for(A=t.uvs[r],e.faceVertexUvs[r][o]=[],e.faceVertexUvs[r][o+1]=[],i=0;i<4;i++)E=new We(A[2*(l=C[a++])],A[2*l+1]),2!==i&&e.faceVertexUvs[r][o].push(E),0!==i&&e.faceVertexUvs[r][o+1].push(E);if(v&&(u=3*C[a++],_.normal.set(O[u++],O[u++],O[u]),S.normal.copy(_.normal)),g)for(r=0;r<4;r++)u=3*C[a++],M=new Ye(O[u++],O[u++],O[u]),2!==r&&_.vertexNormals.push(M),0!==r&&S.vertexNormals.push(M);if(y&&(c=C[a++],_.color.setHex(T=N[c]),S.color.setHex(T)),b)for(r=0;r<4;r++)T=N[c=C[a++]],2!==r&&_.vertexColors.push(new gn(T)),0!==r&&S.vertexColors.push(new gn(T));e.faces.push(_),e.faces.push(S)}else{if((w=new Nn).a=C[a++],w.b=C[a++],w.c=C[a++],f&&(h=C[a++],w.materialIndex=h),o=e.faces.length,m)for(r=0;r<I;r++)for(A=t.uvs[r],e.faceVertexUvs[r][o]=[],i=0;i<3;i++)E=new We(A[2*(l=C[a++])],A[2*l+1]),e.faceVertexUvs[r][o].push(E);if(v&&(u=3*C[a++],w.normal.set(O[u++],O[u++],O[u])),g)for(r=0;r<3;r++)u=3*C[a++],M=new Ye(O[u++],O[u++],O[u]),w.vertexNormals.push(M);if(y&&(c=C[a++],w.color.setHex(N[c])),b)for(r=0;r<3;r++)c=C[a++],w.vertexColors.push(new gn(N[c]));e.faces.push(w)}}(t,n),function(t,e){var n=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var r=0,i=t.skinWeights.length;r<i;r+=n)e.skinWeights.push(new on(t.skinWeights[r],n>1?t.skinWeights[r+1]:0,n>2?t.skinWeights[r+2]:0,n>3?t.skinWeights[r+3]:0));if(t.skinIndices)for(r=0,i=t.skinIndices.length;r<i;r+=n)e.skinIndices.push(new on(t.skinIndices[r],n>1?t.skinIndices[r+1]:0,n>2?t.skinIndices[r+2]:0,n>3?t.skinIndices[r+3]:0));e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,n),function(t,e){var n=t.scale;if(void 0!==t.morphTargets)for(var r=0,i=t.morphTargets.length;r<i;r++){e.morphTargets[r]={},e.morphTargets[r].name=t.morphTargets[r].name,e.morphTargets[r].vertices=[];for(var o=e.morphTargets[r].vertices,a=t.morphTargets[r].vertices,s=0,c=a.length;s<c;s+=3){var u=new Ye;u.x=a[s]*n,u.y=a[s+1]*n,u.z=a[s+2]*n,o.push(u)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var l=e.faces,h=t.morphColors[0].colors;for(r=0,i=l.length;r<i;r++)l[r].color.fromArray(h,3*r)}}(t,n),function(t,e){var n=[],r=[];void 0!==t.animation&&r.push(t.animation),void 0!==t.animations&&(t.animations.length?r=r.concat(t.animations):r.push(t.animations));for(var i=0;i<r.length;i++){var o=bs.parseAnimation(r[i],e.bones);o&&n.push(o)}if(e.morphTargets){var a=bs.CreateClipsFromMorphTargetSequences(e.morphTargets,10);n=n.concat(a)}n.length>0&&(e.animations=n)}(t,n),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:n}:{geometry:n,materials:Es.prototype.initMaterials(t.materials,e,this.crossOrigin)}}}),Object.assign(Os.prototype,{load:function(t,e,n,r){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var i=this;new wa(i.manager).load(t,function(n){var o=null;try{o=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead.")},n,r)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var n=this.parseShape(t.shapes),r=this.parseGeometries(t.geometries,n),i=this.parseImages(t.images,function(){void 0!==e&&e(s)}),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,r,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new Za).fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var n={};if(void 0!==t)for(var r=new Ps,i=new ws,o=0,a=t.length;o<a;o++){var s,c=t[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new aa[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new aa[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new aa[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new aa[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new aa[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new aa[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new aa[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new aa[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new aa[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new aa[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new aa[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new aa[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var u=[];for(o=0,a=c.shapes.length;o<a;o++)u.push(e[c.shapes[o]]);s=new aa[c.type](u,c.curveSegments);break;case"BufferGeometry":s=i.parse(c);break;case"Geometry":s=r.parse(c,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),n[c.uuid]=s}return n},parseMaterials:function(t,e){var n={};if(void 0!==t){var r=new xs;r.setTextures(e);for(var i=0,o=t.length;i<o;i++){var a=t[i];if("MultiMaterial"===a.type){for(var s=[],c=0;c<a.materials.length;c++)s.push(r.parse(a.materials[c]));n[a.uuid]=s}else n[a.uuid]=r.parse(a)}}return n},parseAnimations:function(t){for(var e=[],n=0;n<t.length;n++){var r=bs.parse(t[n]);e.push(r)}return e},parseImages:function(t,e){var n=this,r={};function i(t){return n.manager.itemStart(t),o.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemEnd(t),n.manager.itemError(t)})}if(void 0!==t&&t.length>0){var o=new Ta(new ya(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var c=t[a],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.texturePath+c.url;r[c.uuid]=i(u)}}return r},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var r={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new rn(e[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=n(a.mapping,Ls)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=n(a.wrap[0],Is),s.wrapT=n(a.wrap[1],Is)),void 0!==a.format&&(s.format=a.format),void 0!==a.minFilter&&(s.minFilter=n(a.minFilter,Rs)),void 0!==a.magFilter&&(s.magFilter=n(a.magFilter,Rs)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),r[a.uuid]=s}return r},parseObject:function(t,e,n){var r;function i(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var o=t[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":r=new Ii,void 0!==t.background&&Number.isInteger(t.background)&&(r.background=new gn(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new Li(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new Ni(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new Ei(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new On(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new is(t.color,t.intensity);break;case"DirectionalLight":r=new rs(t.color,t.intensity);break;case"PointLight":r=new es(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new os(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new ts(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new Qa(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(t.geometry),s=o(t.material);r=a.bones&&a.bones.length>0?new ji(a,s):new fr(a,s);break;case"LOD":r=new Fi;break;case"Line":r=new zi(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":r=new Gi(i(t.geometry),o(t.material));break;case"LineSegments":r=new Vi(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":r=new Wi(i(t.geometry),o(t.material));break;case"Sprite":r=new Di(o(t.material));break;case"Group":r=new Xi;break;default:r=new Cn}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var c=t.children,u=0;u<c.length;u++)r.add(this.parseObject(c[u],e,n));if("LOD"===t.type)for(var l=t.levels,h=0;h<l.length;h++){var d=l[h],p=r.getObjectByProperty("uuid",d.object);void 0!==p&&r.addLevel(p,d.distance)}return r}});var Ns,Ls={UVMapping:vt,CubeReflectionMapping:gt,CubeRefractionMapping:yt,EquirectangularReflectionMapping:bt,EquirectangularRefractionMapping:xt,SphericalReflectionMapping:wt,CubeUVReflectionMapping:_t,CubeUVRefractionMapping:St},Is={RepeatWrapping:Tt,ClampToEdgeWrapping:Mt,MirroredRepeatWrapping:At},Rs={NearestFilter:Et,NearestMipMapNearestFilter:Ct,NearestMipMapLinearFilter:Pt,LinearFilter:Ot,LinearMipMapNearestFilter:Nt,LinearMipMapLinearFilter:Lt};function Ds(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:ba,this.options=void 0}function Fs(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function Us(t){this.type="Font",this.data=t}function ks(t,e,n,r,i,o){var a=o.glyphs[t]||o.glyphs["?"];if(a){var s,c,u,l,h,d,p,f,m=new Fs;if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,y=v.length;g<y;)switch(v[g++]){case"m":s=v[g++]*n+r,c=v[g++]*n+i,m.moveTo(s,c);break;case"l":s=v[g++]*n+r,c=v[g++]*n+i,m.lineTo(s,c);break;case"q":u=v[g++]*n+r,l=v[g++]*n+i,h=v[g++]*n+r,d=v[g++]*n+i,m.quadraticCurveTo(h,d,u,l);break;case"b":u=v[g++]*n+r,l=v[g++]*n+i,h=v[g++]*n+r,d=v[g++]*n+i,p=v[g++]*n+r,f=v[g++]*n+i,m.bezierCurveTo(h,d,p,f,u,l)}return{offsetX:a.ha*n,path:m}}}function js(t){this.manager=void 0!==t?t:ba}Ds.prototype={constructor:Ds,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var i=this,o=ga.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,i.options)}).then(function(n){ga.add(t,n),e&&e(n),i.manager.itemEnd(t)}).catch(function(e){r&&r(e),i.manager.itemEnd(t),i.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Object.assign(Fs.prototype,{moveTo:function(t,e){this.currentPath=new Ya,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,n,r){this.currentPath.quadraticCurveTo(t,e,n,r)},bezierCurveTo:function(t,e,n,r,i,o){this.currentPath.bezierCurveTo(t,e,n,r,i,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],o=new Za;o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=e[i],s=e[o],c=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=e[o],c=-c,s=e[i],u=-u),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var l=u*(t.x-a.x)-c*(t.y-a.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return r}var i=Uo.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);var a,s,c,u=[];if(1===o.length)return s=o[0],(c=new Za).curves=s.curves,u.push(c),u;var l=!i(o[0].getPoints());l=t?!l:l;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(h=(s=o[g]).getPoints()),(a=t?!a:a)?(!l&&f[v]&&v++,f[v]={s:new Za,p:h},f[v].s.curves=s.curves,l&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!f[0])return n(o);if(f.length>1){for(var b=!1,x=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)r(M.p,f[E].p)&&(w!==E&&x.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):b=!0);A&&p[w].push(M)}x.length>0&&(b||(m=p))}g=0;for(var C=f.length;g<C;g++){u.push(c=f[g].s);for(var P=0,O=(d=m[g]).length;P<O;P++)c.holes.push(d[P].h)}return u}}),Object.assign(Us.prototype,{isFont:!0,generateShapes:function(t,e,n){void 0===e&&(e=100),void 0===n&&(n=4);for(var r=[],i=function(t,e,n,r){for(var i=String(t).split(""),o=e/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*o,s=[],c=0,u=0,l=0;l<i.length;l++){var h=i[l];if("\n"===h)c=0,u-=a;else{var d=ks(h,0,o,c,u,r);c+=d.offsetX,s.push(d.path)}}return s}(t,e,0,this.data),o=0,a=i.length;o<a;o++)Array.prototype.push.apply(r,i[o].toShapes());return r}}),Object.assign(js.prototype,{load:function(t,e,n,r){var i=this,o=new wa(this.manager);o.setPath(this.path),o.load(t,function(t){var n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}var r=i.parse(n);e&&e(r)},n,r)},parse:function(t){return new Us(t)},setPath:function(t){return this.path=t,this}});var Bs,zs,Vs,Gs,Hs,Ws,Xs,qs,Ys,Zs,Js,Qs,Ks,$s,tc,ec,nc,rc,ic,oc,ac,sc,cc,uc={getContext:function(){return void 0===Ns&&(Ns=new(window.AudioContext||window.webkitAudioContext)),Ns},setContext:function(t){Ns=t}};function lc(t){this.manager=void 0!==t?t:ba}function hc(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ei,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ei,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function dc(t,e,n){Cn.call(this),this.type="CubeCamera";var r=new Ei(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new Ye(1,0,0)),this.add(r);var i=new Ei(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new Ye(-1,0,0)),this.add(i);var o=new Ei(90,1,t,e);o.up.set(0,0,1),o.lookAt(new Ye(0,1,0)),this.add(o);var a=new Ei(90,1,t,e);a.up.set(0,0,-1),a.lookAt(new Ye(0,-1,0)),this.add(a);var s=new Ei(90,1,t,e);s.up.set(0,-1,0),s.lookAt(new Ye(0,0,1)),this.add(s);var c=new Ei(90,1,t,e);c.up.set(0,-1,0),c.lookAt(new Ye(0,0,-1)),this.add(c),this.renderTarget=new sn(n,n,{format:Xt,magFilter:Ot,minFilter:Ot}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,n.activeCubeFace=0,t.render(e,r,n),n.activeCubeFace=1,t.render(e,i,n),n.activeCubeFace=2,t.render(e,o,n),n.activeCubeFace=3,t.render(e,a,n),n.activeCubeFace=4,t.render(e,s,n),n.texture.generateMipmaps=u,n.activeCubeFace=5,t.render(e,c,n),t.setRenderTarget(null)},this.clear=function(t,e,n,r){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,t.setRenderTarget(i),t.clear(e,n,r);t.setRenderTarget(null)}}function pc(){Cn.call(this),this.type="AudioListener",this.context=uc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function fc(t){Cn.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function mc(t){fc.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function vc(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function gc(t,e,n){this.binding=t,this.valueSize=n;var r,i=Float64Array;switch(e){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function yc(t,e,n){var r=n||bc.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function bc(t,e,n){this.path=e,this.parsedPath=n||bc.parseTrackName(e),this.node=bc.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function xc(){this.uuid=He.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function wc(t,e,n){this._mixer=t,this._clip=e,this._localRoot=n||null;for(var r=e.tracks,i=r.length,o=new Array(i),a={endingStart:Ce,endingEnd:Ce},s=0;s!==i;++s){var c=r[s].createInterpolant(null);o[s]=c,c.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Se,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function _c(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Sc(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function Tc(){Zn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Mc(t,e,n,r){this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function Ac(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Ec(t,e,n){Ac.call(this,t,e),this.meshPerAttribute=n||1}function Cc(t,e,n){Fn.call(this,t,e),this.meshPerAttribute=n||1}function Pc(t,e,n,r){this.ray=new hr(t,e),this.near=n||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Oc(t,e){return t.distance-e.distance}function Nc(t,e,n,r){if(!1!==t.visible&&(t.raycast(e,n),!0===r))for(var i=t.children,o=0,a=i.length;o<a;o++)Nc(i[o],e,n,!0)}function Lc(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Ic(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}function Rc(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}function Dc(t,e){this.min=void 0!==t?t:new We(1/0,1/0),this.max=void 0!==e?e:new We(-1/0,-1/0)}function Fc(t){Cn.call(this),this.material=t,this.render=function(){}}function Uc(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==n?n:16711680,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var c=new Zn,u=new Hn(2*a*3,3);c.addAttribute("position",u),Vi.call(this,c,new Bi({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function kc(t,e){Cn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var n=new Zn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}n.addAttribute("position",new Hn(r,3));var c=new Bi({fog:!1});this.cone=new Vi(n,c),this.add(this.cone),this.update()}function jc(t){for(var e=function t(e){var n=[];e&&e.isBone&&n.push(e);for(var r=0;r<e.children.length;r++)n.push.apply(n,t(e.children[r]));return n}(t),n=new Zn,r=[],i=[],o=new gn(0,0,1),a=new gn(0,1,0),s=0;s<e.length;s++){var c=e[s];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.addAttribute("position",new Hn(r,3)),n.addAttribute("color",new Hn(i,3));var u=new Bi({vertexColors:N,depthTest:!1,depthWrite:!1,transparent:!0});Vi.call(this,n,u),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Bc(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;var r=new Wo(e,4,2),i=new ur({wireframe:!0,fog:!1});fr.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function zc(t,e){Cn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var n=new Bi({fog:!1}),r=new Zn;r.addAttribute("position",new Fn(new Float32Array(15),3)),this.line=new zi(r,n),this.add(this.line),this.update()}function Vc(t,e,n){Cn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new io(e);r.rotateY(.5*Math.PI),this.material=new ur({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=N);var i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.addAttribute("color",new Fn(o,3)),this.add(new fr(r,this.material)),this.update()}function Gc(t,e,n,r){t=t||10,e=e||10,n=new gn(void 0!==n?n:4473924),r=new gn(void 0!==r?r:8947848);for(var i=e/2,o=t/e,a=t/2,s=[],c=[],u=0,l=0,h=-a;u<=e;u++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var d=u===i?n:r;d.toArray(c,l),d.toArray(c,l+=3),d.toArray(c,l+=3),d.toArray(c,l+=3),l+=3}var p=new Zn;p.addAttribute("position",new Hn(s,3)),p.addAttribute("color",new Hn(c,3));var f=new Bi({vertexColors:N});Vi.call(this,p,f)}function Hc(t,e,n,r,i,o){t=t||10,e=e||16,n=n||8,r=r||64,i=new gn(void 0!==i?i:4473924),o=new gn(void 0!==o?o:8947848);var a,s,c,u,l,h,d,p=[],f=[];for(u=0;u<=e;u++)c=u/e*(2*Math.PI),a=Math.sin(c)*t,s=Math.cos(c)*t,p.push(0,0,0),p.push(a,0,s),f.push((d=1&u?i:o).r,d.g,d.b),f.push(d.r,d.g,d.b);for(u=0;u<=n;u++)for(d=1&u?i:o,h=t-t/n*u,l=0;l<r;l++)c=l/r*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,p.push(a,0,s),f.push(d.r,d.g,d.b),c=(l+1)/r*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,p.push(a,0,s),f.push(d.r,d.g,d.b);var m=new Zn;m.addAttribute("position",new Hn(p,3)),m.addAttribute("color",new Hn(f,3));var v=new Bi({vertexColors:N});Vi.call(this,m,v)}function Wc(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==n?n:16776960,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var c=new Zn,u=new Hn(2*a*3,3);c.addAttribute("position",u),Vi.call(this,c,new Bi({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Xc(t,e,n){Cn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);var r=new Zn;r.addAttribute("position",new Hn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new Bi({fog:!1});this.lightPlane=new zi(r,i),this.add(this.lightPlane),(r=new Zn).addAttribute("position",new Hn([0,0,0,0,0,1],3)),this.targetLine=new zi(r,i),this.add(this.targetLine),this.update()}function qc(t){var e=new Zn,n=new Bi({color:16777215,vertexColors:O}),r=[],i=[],o={},a=new gn(16755200),s=new gn(16711680),c=new gn(43775),u=new gn(16777215),l=new gn(3355443);function h(t,e,n){d(t,n),d(e,n)}function d(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(r.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",u),h("p","c",l),h("cn1","cn2",l),h("cn3","cn4",l),h("cf1","cf2",l),h("cf3","cf4",l),e.addAttribute("position",new Hn(r,3)),e.addAttribute("color",new Hn(i,3)),Vi.call(this,e,n),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Yc(t,e){this.object=t,void 0===e&&(e=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Zn;i.setIndex(new Fn(n,1)),i.addAttribute("position",new Fn(r,3)),Vi.call(this,i,new Bi({color:e})),this.matrixAutoUpdate=!1,this.update()}function Zc(t,e){this.type="Box3Helper",this.box=t;var n=void 0!==e?e:16776960,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Zn;i.setIndex(new Fn(r,1)),i.addAttribute("position",new Hn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Vi.call(this,i,new Bi({color:n})),this.geometry.computeBoundingSphere()}function Jc(t,e,n){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var r=void 0!==n?n:16776960,i=new Zn;i.addAttribute("position",new Hn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),zi.call(this,i,new Bi({color:r}));var o=new Zn;o.addAttribute("position",new Hn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new fr(o,new ur({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}function Qc(t,e,n,r,i,o){Cn.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===oc&&((oc=new Zn).addAttribute("position",new Hn([0,0,0,0,1,0],3)),(ac=new ea(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new zi(oc,new Bi({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new fr(ac,new ur({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,o)}function Kc(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Zn;n.addAttribute("position",new Hn(e,3)),n.addAttribute("color",new Hn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new Bi({vertexColors:N});Vi.call(this,n,r)}function $c(t,e,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Nn(t,e,n,i,o,a)}Object.assign(lc.prototype,{load:function(t,e,n,r){var i=new wa(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){uc.getContext().decodeAudioData(t,function(t){e(t)})},n,r)}}),Object.assign(hc.prototype,{update:(Ys=new Xe,Zs=new Xe,function(t){if(Bs!==this||zs!==t.focus||Vs!==t.fov||Gs!==t.aspect*this.aspect||Hs!==t.near||Ws!==t.far||Xs!==t.zoom||qs!==this.eyeSep){Bs=this,zs=t.focus,Vs=t.fov,Gs=t.aspect*this.aspect,Hs=t.near,Ws=t.far,Xs=t.zoom;var e,n,r=t.projectionMatrix.clone(),i=(qs=this.eyeSep/2)*Hs/zs,o=Hs*Math.tan(He.DEG2RAD*Vs*.5)/Xs;Zs.elements[12]=-qs,Ys.elements[12]=qs,r.elements[0]=2*Hs/((n=o*Gs+i)-(e=-o*Gs+i)),r.elements[8]=(n+e)/(n-e),this.cameraL.projectionMatrix.copy(r),r.elements[0]=2*Hs/((n=o*Gs-i)-(e=-o*Gs-i)),r.elements[8]=(n+e)/(n-e),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Zs),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Ys)})}),(dc.prototype=Object.create(Cn.prototype)).constructor=dc,pc.prototype=Object.assign(Object.create(Cn.prototype),{constructor:pc,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new Ye,e=new qe,n=new Ye,r=new Ye;return function(i){Cn.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(t,e,n),r.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(r.x,this.context.currentTime),o.forwardY.setValueAtTime(r.y,this.context.currentTime),o.forwardZ.setValueAtTime(r.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(r.x,r.y,r.z,a.x,a.y,a.z))}}()}),fc.prototype=Object.assign(Object.create(Cn.prototype),{constructor:fc,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),mc.prototype=Object.assign(Object.create(fc.prototype),{constructor:mc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new Ye;return function(e){Cn.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),Object.assign(vc.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length}}),Object.assign(gc.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valueSize,i=t*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=e}else this._mixBufferRegion(n,i,0,e/(o+=e),r);this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.binding;this.cumulativeWeight=0,i<1&&this._mixBufferRegion(n,r,3*e,1-i,e);for(var a=e,s=e+e;a!==s;++a)if(n[a]!==n[a+e]){o.setValue(n,r);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,n=3*e;this.binding.getValue(t,n);for(var r=e,i=n;r!==i;++r)t[r]=t[n+r%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)t[e+o]=t[n+o]},_slerp:function(t,e,n,r){qe.slerpFlat(t,e,t,e,t,n,r)},_lerp:function(t,e,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*r}}}),Object.assign(yc.prototype,{getValue:function(t,e){this.bind();var n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(bc,{Composite:yc,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new bc.Composite(t,e,n):new bc(t,e,n)},sanitizeNodeName:(ic=new RegExp("[\\[\\]\\.:\\/]","g"),function(t){return t.replace(/\s/g,"_").replace(ic,"")}),parseTrackName:(Js="[^\\[\\]\\.:\\/]",Qs="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ks=/((?:WC+[\/:])*)/.source.replace("WC",Js),$s=/(WCOD+)?/.source.replace("WCOD",Qs),tc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Js),ec=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Js),nc=new RegExp("^"+Ks+$s+tc+ec+"$"),rc=["material","materials","bones"],function(t){var e=nc.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==rc.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.name===e||i.uuid===e)return i;var o=r(i.children);if(o)return o}return null},i=r(t.children);if(i)return i}return null}}),Object.assign(bc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(t=bc.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var o=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var s=t[r];if(void 0!==s){var c=this.Versioning.None;void 0!==t.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===i){i=a;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else console.error("THREE.PropertyBinding: Trying to update property for track: "+e.nodeName+"."+r+" but it wasn't found.",t)}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(bc.prototype,{_getValue_unbound:bc.prototype.getValue,_setValue_unbound:bc.prototype.setValue}),Object.assign(xc.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,c=void 0,u=0,l=arguments.length;u!==l;++u){var h=arguments[u],d=h.uuid,p=r[d];if(void 0===p){p=e++,r[d]=p,t.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new bc(h,i[f],o[f]))}else if(p<n){c=t[p];var v=--n,g=t[v];for(r[g.uuid]=p,t[p]=g,r[d]=v,t[v]=h,f=0,m=s;f!==m;++f){var y=a[f],b=y[p];y[p]=y[v],void 0===b&&(b=new bc(h,i[f],o[f])),y[v]=b}}else t[p]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],c=s.uuid,u=n[c];if(void 0!==u&&u>=e){var l=e++,h=t[l];n[h.uuid]=u,t[u]=h,n[c]=l,t[l]=s;for(var d=0,p=i;d!==p;++d){var f=r[d],m=f[u];f[u]=f[l],f[l]=m}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var c=arguments[a].uuid,u=r[c];if(void 0!==u)if(delete r[c],u<n){var l=--n,h=t[l],d=t[v=--e];r[h.uuid]=u,t[u]=h,r[d.uuid]=l,t[l]=d,t.pop();for(var p=0,f=o;p!==f;++p){var m=(g=i[p])[v];g[u]=g[l],g[l]=m,g.pop()}}else{var v;for(r[(d=t[v=--e]).uuid]=u,t[u]=d,t.pop(),p=0,f=o;p!==f;++p){var g;(g=i[p])[u]=g[v],g.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,c=this.nCachedObjects_,u=new Array(s.length);n[t]=r=i.length,o.push(t),a.push(e),i.push(u);for(var l=c,h=s.length;l!==h;++l)u[l]=new bc(s[l],t,e);return u},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}),Object.assign(wc.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,i=t._clip.duration,o=r/i;t.warp(1,i/r,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,c=o.sampleValues;return s[0]=i,s[1]=i+n,c[0]=t/a,c[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*n;if(o<0||0===n)return;this._startTime=null,e=n*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var c=this._interpolants,u=this._propertyBindings,l=0,h=c.length;l!==h;++l)c[l].evaluate(a),u[l].accumulate(r,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var n=this._clip.duration,r=this.loop,i=this._loopCount;if(r===_e){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=n)e=n;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=r===Te;if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=n||e<0){var a=Math.floor(e/n);e-=n*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var c=t<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&i))return this.time=e,n-e}return this.time=e,e},_setEndings:function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=Pe,r.endingEnd=Pe):(r.endingStart=t?this.zeroSlopeAtStart?Pe:Ce:Oe,r.endingEnd=e?this.zeroSlopeAtEnd?Pe:Ce:Oe)},_scheduleFading:function(t,e,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=n,this}}),_c.prototype=Object.assign(Object.create(r.prototype),{constructor:_c,_bindAction:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,c=this._bindingsByRootAndName,u=c[s];void 0===u&&(c[s]=u={});for(var l=0;l!==i;++l){var h=r[l],d=h.name,p=u[d];if(void 0!==p)o[l]=p;else{if(void 0!==(p=o[l])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}++(p=new gc(bc.create(n,d,e&&e._propertyBindings[l].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[l]=p}a[l].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){var r=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,c=s[s.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){var r=this._bindingsByRootAndName,i=r[e],o=this._bindings;void 0===i&&(r[e]=i={}),i[n]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=e[e.length-1],c=t._cacheIndex;s._cacheIndex=c,e[c]=s,e.pop(),delete a[i];t:{for(var u in a)break t;delete o[r]}},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new fs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?bs.findByName(n,t):t,o=null!==i?i.uuid:t,a=this._actionsByClip[o],s=null;if(void 0!==a){var c=a.actionByRoot[r];if(void 0!==c)return c;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new wc(this,i,e);return this._bindAction(u,s),this._addInactiveAction(u,o,r),u},existingAction:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?bs.findByName(n,t):t,o=this._actionsByClip[i?i.uuid:t];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(t){for(var e=this._actions,n=this._nActiveActions,r=this.time+=t*=this.timeScale,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a)e[a]._update(r,t,i,o);var s=this._bindings,c=this._nActiveBindings;for(a=0;a!==c;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var c=o[a];this._deactivateAction(c);var u=c._cacheIndex,l=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=u,e[u]=l,e.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}},uncacheRoot:function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Sc.prototype.clone=function(){return new Sc(void 0===this.value.clone?this.value:this.value.clone())},Tc.prototype=Object.assign(Object.create(Zn.prototype),{constructor:Tc,isInstancedBufferGeometry:!0,copy:function(t){return Zn.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(Mc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Mc.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}}),Object.defineProperty(Ac.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ac.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Ec.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Ec,isInstancedInterleavedBuffer:!0,copy:function(t){return Ac.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Cc.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Cc,isInstancedBufferAttribute:!0,copy:function(t){return Fn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Pc.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){var r=n||[];return Nc(t,this,r,e),r.sort(Oc),r},intersectObjects:function(t,e,n){var r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,o=t.length;i<o;i++)Nc(t[i],this,r,e);return r.sort(Oc),r}}),Object.assign(Lc.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Object.assign(Ic.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(He.clamp(t.y/this.radius,-1,1))),this}}),Object.assign(Rc.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),Object.assign(Dc.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new We;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new We),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new We),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new We),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new We),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new We;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),(Fc.prototype=Object.create(Cn.prototype)).constructor=Fc,Fc.prototype.isImmediateRenderObject=!0,(Uc.prototype=Object.create(Vi.prototype)).constructor=Uc,Uc.prototype.update=function(){var t=new Ye,e=new Ye,n=new Ze;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,c=a.faces,u=0,l=0,h=c.length;l<h;l++)for(var d=c[l],p=0,f=d.vertexNormals.length;p<f;p++){var m=d.vertexNormals[p];t.copy(s[d[r[p]]]).applyMatrix4(i),e.copy(m).applyMatrix3(n).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),o.setXYZ(u+=1,e.x,e.y,e.z),u+=1}else if(a&&a.isBufferGeometry){var v=a.attributes.position,g=a.attributes.normal;for(u=0,p=0,f=v.count;p<f;p++)t.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),e.set(g.getX(p),g.getY(p),g.getZ(p)),e.applyMatrix3(n).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),o.setXYZ(u+=1,e.x,e.y,e.z),u+=1}o.needsUpdate=!0}}(),(kc.prototype=Object.create(Cn.prototype)).constructor=kc,kc.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},kc.prototype.update=function(){var t=new Ye,e=new Ye;return function(){this.light.updateMatrixWorld();var n=this.light.distance?this.light.distance:1e3,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(jc.prototype=Object.create(Vi.prototype)).constructor=jc,jc.prototype.updateMatrixWorld=function(){var t=new Ye,e=new Xe,n=new Xe;return function(r){var i=this.bones,o=this.geometry,a=o.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var s=0,c=0;s<i.length;s++){var u=i[s];u.parent&&u.parent.isBone&&(e.multiplyMatrices(n,u.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(c,t.x,t.y,t.z),e.multiplyMatrices(n,u.parent.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(c+1,t.x,t.y,t.z),c+=2)}o.getAttribute("position").needsUpdate=!0,Cn.prototype.updateMatrixWorld.call(this,r)}}(),(Bc.prototype=Object.create(fr.prototype)).constructor=Bc,Bc.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Bc.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(zc.prototype=Object.create(Cn.prototype)).constructor=zc,zc.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},zc.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,n=this.line.geometry.attributes.position,r=n.array;r[0]=t,r[1]=-e,r[2]=0,r[3]=t,r[4]=e,r[5]=0,r[6]=-t,r[7]=e,r[8]=0,r[9]=-t,r[10]=-e,r[11]=0,r[12]=t,r[13]=-e,r[14]=0,n.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Vc.prototype=Object.create(Cn.prototype)).constructor=Vc,Vc.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Vc.prototype.update=function(){var t=new Ye,e=new gn,n=new gn;return function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=r.geometry.getAttribute("color");e.copy(this.light.color),n.copy(this.light.groundColor);for(var o=0,a=i.count;o<a;o++){var s=o<a/2?e:n;i.setXYZ(o,s.r,s.g,s.b)}i.needsUpdate=!0}r.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Gc.prototype=Object.create(Vi.prototype)).constructor=Gc,(Hc.prototype=Object.create(Vi.prototype)).constructor=Hc,(Wc.prototype=Object.create(Vi.prototype)).constructor=Wc,Wc.prototype.update=function(){var t=new Ye,e=new Ye,n=new Ze;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,c=0,u=0,l=s.length;u<l;u++){var h=s[u],d=h.normal;t.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(r),e.copy(d).applyMatrix3(n).normalize().multiplyScalar(this.size).add(t),i.setXYZ(c,t.x,t.y,t.z),i.setXYZ(c+=1,e.x,e.y,e.z),c+=1}i.needsUpdate=!0}}(),(Xc.prototype=Object.create(Cn.prototype)).constructor=Xc,Xc.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Xc.prototype.update=function(){var t=new Ye,e=new Ye,n=new Ye;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(e,t),this.lightPlane.lookAt(n),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(n),this.targetLine.scale.z=n.length()}}(),(qc.prototype=Object.create(Vi.prototype)).constructor=qc,qc.prototype.update=function(){var t,e,n=new Ye,r=new Pn;function i(i,o,a,s){n.set(o,a,s).unproject(r);var c=e[i];if(void 0!==c)for(var u=t.getAttribute("position"),l=0,h=c.length;l<h;l++)u.setXYZ(c[l],n.x,n.y,n.z)}return function(){t=this.geometry,e=this.pointMap,r.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(Yc.prototype=Object.create(Vi.prototype)).constructor=Yc,Yc.prototype.update=function(){var t=new un;return function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var n=t.min,r=t.max,i=this.geometry.attributes.position,o=i.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=n.x,o[4]=r.y,o[5]=r.z,o[6]=n.x,o[7]=n.y,o[8]=r.z,o[9]=r.x,o[10]=n.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=n.z,o[15]=n.x,o[16]=r.y,o[17]=n.z,o[18]=n.x,o[19]=n.y,o[20]=n.z,o[21]=r.x,o[22]=n.y,o[23]=n.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Yc.prototype.setFromObject=function(t){return this.object=t,this.update(),this},(Zc.prototype=Object.create(Vi.prototype)).constructor=Zc,Zc.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),Cn.prototype.updateMatrixWorld.call(this,t))},(Jc.prototype=Object.create(zi.prototype)).constructor=Jc,Jc.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),Cn.prototype.updateMatrixWorld.call(this,t)},(Qc.prototype=Object.create(Cn.prototype)).constructor=Qc,Qc.prototype.setDirection=(cc=new Ye,function(t){t.y>.99999?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(cc.set(t.z,0,-t.x).normalize(),sc=Math.acos(t.y),this.quaternion.setFromAxisAngle(cc,sc))}),Qc.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},Qc.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(Kc.prototype=Object.create(Vi.prototype)).constructor=Kc;var tu=0,eu=1;function nu(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function ru(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function iu(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Wi(t,e)}function ou(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Di(t)}function au(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Wi(t,e)}function su(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Hi(t)}function cu(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Hi(t)}function uu(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Hi(t)}function lu(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Ye(t,e,n)}function hu(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new Fn(t,e).setDynamic(!0)}function du(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Un(t,e)}function pu(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new kn(t,e)}function fu(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new jn(t,e)}function mu(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Bn(t,e)}function vu(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new zn(t,e)}function gu(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Vn(t,e)}function yu(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Gn(t,e)}function bu(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Hn(t,e)}function xu(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Wn(t,e)}function wu(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Da.call(this,t),this.type="catmullrom",this.closed=!0}function _u(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Da.call(this,t),this.type="catmullrom"}function Su(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Da.call(this,t),this.type="catmullrom"}function Tu(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Kc(t)}function Mu(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Yc(t,e)}function Au(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Vi(new $o(t.geometry),new Bi({color:void 0!==e?e:16777215}))}function Eu(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Vi(new Ji(t.geometry),new Bi({color:void 0!==e?e:16777215}))}function Cu(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new wa(t)}function Pu(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Sa(t)}Ea.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Ea.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(qa.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Dn,n=0,r=t.length;n<r;n++){var i=t[n];e.vertices.push(new Ye(i.x,i.y,i.z||0))}return e}}),Object.assign(Ya.prototype,{fromPoints:function(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),wu.prototype=Object.create(Da.prototype),_u.prototype=Object.create(Da.prototype),Su.prototype=Object.create(Da.prototype),Object.assign(Su.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Gc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},jc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Es.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Cs.extractUrlBase(t)}}),Object.assign(Dc.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(un.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),dr.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(He,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),He.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),He.ceilPowerOfTwo(t)}}),Object.assign(Ze.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Xe.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new Ye),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)}}),hn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},qe.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(hr.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(pr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(pr,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pr.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pr.getNormal(t,e,n,r)}}),Object.assign(Za.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Bo(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jo(this,t)}}),Object.assign(We.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ye.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(on.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Dn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Cn.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Cn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Fi.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ui.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Ea.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Ei.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Ja.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Fn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Zn.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Zn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Sc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(cr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new gn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===E}}}),Object.defineProperties(ha.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(lr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Oi.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(Oi.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ti.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(an.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Pi.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),fc.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new lc).load(t,function(t){e.setBuffer(t)}),this},vc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},dc.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var Ou={merge:function(t,e,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},Nu={crossOrigin:void 0,loadTexture:function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Aa;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},loadTextureCube:function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Ma;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};function Lu(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function Iu(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}var Ru={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function Du(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}},MsCo:function(t,e,n){(function(t,r){var i;!function(r){var o,a=2147483647,s=36,c=1,u=26,l=38,h=700,d=72,p=128,f="-",m=/^xn--/,v=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=s-c,x=Math.floor,w=String.fromCharCode;function _(t){throw new RangeError(y[t])}function S(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function T(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+S((t=t.replace(g,".")).split("."),e).join(".")}function M(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function A(t){return S(t,function(t){var e="";return t>65535&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+w(t)}).join("")}function E(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function C(t,e,n){var r=0;for(t=n?x(t/h):t>>1,t+=x(t/e);t>b*u>>1;r+=s)t=x(t/b);return x(r+(b+1)*t/(t+l))}function P(t){var e,n,r,i,o,l,h,m,v,g,y,b=[],w=t.length,S=0,T=p,M=d;for((n=t.lastIndexOf(f))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&_("not-basic"),b.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<w;){for(o=S,l=1,h=s;i>=w&&_("invalid-input"),((m=(y=t.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:s)>=s||m>x((a-S)/l))&&_("overflow"),S+=m*l,!(m<(v=h<=M?c:h>=M+u?u:h-M));h+=s)l>x(a/(g=s-v))&&_("overflow"),l*=g;M=C(S-o,e=b.length+1,0==o),x(S/e)>a-T&&_("overflow"),T+=x(S/e),S%=e,b.splice(S++,0,T)}return A(b)}function O(t){var e,n,r,i,o,l,h,m,v,g,y,b,S,T,A,P=[];for(b=(t=M(t)).length,e=p,n=0,o=d,l=0;l<b;++l)(y=t[l])<128&&P.push(w(y));for(r=i=P.length,i&&P.push(f);r<b;){for(h=a,l=0;l<b;++l)(y=t[l])>=e&&y<h&&(h=y);for(h-e>x((a-n)/(S=r+1))&&_("overflow"),n+=(h-e)*S,e=h,l=0;l<b;++l)if((y=t[l])<e&&++n>a&&_("overflow"),y==e){for(m=n,v=s;!(m<(g=v<=o?c:v>=o+u?u:v-o));v+=s)P.push(w(E(g+(A=m-g)%(T=s-g),0))),m=x(A/T);P.push(w(E(m,0))),o=C(n,S,r==i),n=0,++r}++n,++e}return P.join("")}o={version:"1.4.1",ucs2:{decode:M,encode:A},decode:P,encode:O,toASCII:function(t){return T(t,function(t){return v.test(t)?"xn--"+O(t):t})},toUnicode:function(t){return T(t,function(t){return m.test(t)?P(t.slice(4).toLowerCase()):t})}},void 0===(i=(function(){return o}).call(e,n,e,t))||(t.exports=i)}()}).call(e,n("3IRH")(t),n("DuR2"))},N4j0:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t){return t&&"number"==typeof t.length}},NGfj:function(t,e,n){"use strict";e.__esModule=!0;var r,i=n("aH6o"),o={getTintedTexture:function(t,e){var n=t._texture,r="#"+("00000"+(0|(e=o.roundColor(e))).toString(16)).substr(-6);n.tintCache=n.tintCache||{};var i=n.tintCache[r],a=void 0;if(i){if(i.tintId===n._updateID)return n.tintCache[r];a=n.tintCache[r]}else a=o.canvas||document.createElement("canvas");if(o.tintMethod(n,e,a),a.tintId=n._updateID,o.convertTintToImage){var s=new Image;s.src=a.toDataURL(),n.tintCache[r]=s}else n.tintCache[r]=a,o.canvas=null;return a},tintWithMultiply:function(t,e,n){var r=n.getContext("2d"),i=t._frame.clone(),o=t.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,n.width=Math.ceil(i.width),n.height=Math.ceil(i.height),r.save(),r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply",r.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithOverlay:function(t,e,n){var r=n.getContext("2d"),i=t._frame.clone(),o=t.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,n.width=Math.ceil(i.width),n.height=Math.ceil(i.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithPerPixel:function(t,e,n){var r=n.getContext("2d"),o=t._frame.clone(),a=t.baseTexture.resolution;o.x*=a,o.y*=a,o.width*=a,o.height*=a,n.width=Math.ceil(o.width),n.height=Math.ceil(o.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.restore();for(var s=(0,i.hex2rgb)(e),c=s[0],u=s[1],l=s[2],h=r.getImageData(0,0,o.width,o.height),d=h.data,p=0;p<d.length;p+=4)d[p+0]*=c,d[p+1]*=u,d[p+2]*=l;r.putImageData(h,0,0)},roundColor:function(t){var e=o.cacheStepsPerColorChannel,n=(0,i.hex2rgb)(t);return n[0]=Math.min(255,n[0]/e*e),n[1]=Math.min(255,n[1]/e*e),n[2]=Math.min(255,n[2]/e*e),(0,i.rgb2hex)(n)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:(0,((r=n("/SMQ"))&&r.__esModule?r:{default:r}).default)(),tintMethod:0};o.tintMethod=o.canUseMultiply?o.tintWithMultiply:o.tintWithPerPixel,e.default=o},"NO/a":function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n("TToO"),i=n("g5jc"),o=n("YaPU"),a=n("VwZZ"),s=n("0P3J"),c=function(t){function e(e,n){t.call(this),this.source=e,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}return Object(r.c)(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new a.a).add(this.source.subscribe(new l(this.getSubject(),this))),t.closed?(this._connection=null,t=a.a.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return Object(s.a)()(this)},e}(o.a).prototype,u={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:c._subscribe},_isComplete:{value:c._isComplete,writable:!0},getSubject:{value:c.getSubject},connect:{value:c.connect},refCount:{value:c.refCount}},l=function(t){function e(e,n){t.call(this,e),this.connectable=n}return Object(r.c)(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(i.c)},NZvU:function(t,e){var n=null,r={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};t.exports=function(t,e){if(!n){var i=Object.keys(r);n={};for(var o=0;o<i.length;++o){var a=i[o];n[t[a]]=r[a]}}return n[e]}},"Nf+U":function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),i=a(n("Sst2")),o=a(n("fiP3"));function a(t){return t&&t.__esModule?t:{default:t}}r.utils.mixins.delayMixin(r.DisplayObject.prototype,o.default);var s=100,c=0,u=0,l=2,h=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),!i.default.tablet&&!i.default.phone||navigator.isCocoonJS||this.createTouchHook();var n=document.createElement("div");n.style.width=s+"px",n.style.height=s+"px",n.style.position="absolute",n.style.top=c+"px",n.style.left=u+"px",n.style.zIndex=l,this.div=n,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessabillity=!1,window.addEventListener("keydown",this._onKeyDown,!1)}return t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2,e.style.backgroundColor="#FF0000",e.title="HOOK DIV",e.addEventListener("focus",function(){t.isMobileAccessabillity=!0,t.activate(),document.body.removeChild(e)}),document.body.appendChild(e)},t.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},t.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,n=e.length-1;n>=0;n--)this.updateAccessibleObjects(e[n])}},t.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,n=t.height/this.renderer.height,i=this.div;i.style.left=t.left+"px",i.style.top=t.top+"px",i.style.width=this.renderer.width+"px",i.style.height=this.renderer.height+"px";for(var o=0;o<this.children.length;o++){var a=this.children[o];if(a.renderId!==this.renderId)a._accessibleActive=!1,r.utils.removeItems(this.children,o,1),this.div.removeChild(a._accessibleDiv),this.pool.push(a._accessibleDiv),a._accessibleDiv=null,o--,0===this.children.length&&this.deactivate();else{i=a._accessibleDiv;var s=a.hitArea,c=a.worldTransform;a.hitArea?(i.style.left=(c.tx+s.x*c.a)*e+"px",i.style.top=(c.ty+s.y*c.d)*n+"px",i.style.width=s.width*c.a*e+"px",i.style.height=s.height*c.d*n+"px"):(s=a.getBounds(),this.capHitArea(s),i.style.left=s.x*e+"px",i.style.top=s.y*n+"px",i.style.width=s.width*e+"px",i.style.height=s.height*n+"px")}}this.renderId++}},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width=s+"px",e.style.height=s+"px",e.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=l,e.style.borderStyle="none",e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleTitle||t.accessibleHint||(e.title="displayObject "+this.tabIndex),t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData)},t.prototype._onFocus=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},t.prototype._onFocusOut=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(){this.deactivate()},t.prototype.destroy=function(){this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();e.default=h,r.WebGLRenderer.registerPlugin("accessibility",h),r.CanvasRenderer.registerPlugin("accessibility",h)},NqTp:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.fn=e,this.context=n,this.priority=r,this.once=i,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return e=e||null,this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.previous;return this.next=t?null:e,this.previous=null,e},t}();e.default=r},OVmG:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var r=n("TToO"),i=n("/iUD"),o=n("VwZZ"),a=n("t7NR"),s=n("tLDX"),c=function(t){function e(e,n,r){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a.a;break;case 1:if(!e){this.destination=a.a;break}if("object"==typeof e){if(l(e)){var i=e[s.a]();this.syncErrorThrowable=i.syncErrorThrowable,this.destination=i,i.add(this)}else this.syncErrorThrowable=!0,this.destination=new u(this,e);break}default:this.syncErrorThrowable=!0,this.destination=new u(this,e,n,r)}}return Object(r.c)(e,t),e.prototype[s.a]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this},e}(o.a),u=function(t){function e(e,n,r,o){var s;t.call(this),this._parentSubscriber=e;var c=this;Object(i.a)(n)?s=n:n&&(s=n.next,r=n.error,o=n.complete,n!==a.a&&(c=Object.create(n),Object(i.a)(c.unsubscribe)&&this.add(c.unsubscribe.bind(c)),c.unsubscribe=this.unsubscribe.bind(this))),this._context=c,this._next=s,this._error=r,this._complete=o}return Object(r.c)(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber;if(this._error)e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!e.syncErrorThrowable)throw this.unsubscribe(),t;e.syncErrorValue=t,e.syncErrorThrown=!0,this.unsubscribe()}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){throw this.unsubscribe(),t}},e.prototype.__tryOrSetError=function(t,e,n){try{e.call(this._context,n)}catch(e){return t.syncErrorValue=e,t.syncErrorThrown=!0,!0}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(c);function l(t){return t instanceof c||"syncErrorThrowable"in t&&t[s.a]}},Obmw:function(t,e,n){"use strict";e.__esModule=!0;var r,i=n("8QNu"),o=(r=n("/MUw"))&&r.__esModule?r:{default:r};function a(t,e){if(t instanceof Array){if("precision"!==t[0].substring(0,9)){var n=t.slice(0);return n.unshift("precision "+e+" float;"),n}}else if("precision"!==t.trim().substring(0,9))return"precision "+e+" float;\n"+t;return t}var s=function(t){function e(n,r,i,s,c){return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,a(r,c||o.default.PRECISION_VERTEX),a(i,c||o.default.PRECISION_FRAGMENT),void 0,s))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(i.GLShader);e.default=s},P2cu:function(t,e,n){(function(e){var r=n("bKul");t.exports=function(t){var n=t.xdomain,i=t.xscheme,o=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(t){}if(!n)try{return new(e[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}}).call(e,n("DuR2"))},PIsA:function(t,e,n){"use strict";var r=n("AMGY"),i=n("N4j0"),o=n("cQXm"),a=n("dgOU"),s=n("YaPU"),c=n("etqZ"),u=n("TToO"),l=function(t){function e(e,n,r){t.call(this),this.parent=e,this.outerValue=n,this.outerIndex=r,this.index=0}return Object(u.c)(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(n("OVmG").a),h=n("+CnV");e.a=function(t,e,n,u){var d=new l(t,n,u);if(d.closed)return null;if(e instanceof s.a)return e._isScalar?(d.next(e.value),d.complete(),null):(d.syncErrorThrowable=!0,e.subscribe(d));if(Object(i.a)(e)){for(var p=0,f=e.length;p<f&&!d.closed;p++)d.next(e[p]);d.closed||d.complete()}else{if(Object(o.a)(e))return e.then(function(t){d.closed||(d.next(t),d.complete())},function(t){return d.error(t)}).then(null,function(t){r.a.setTimeout(function(){throw t})}),d;if(e&&"function"==typeof e[c.a])for(var m=e[c.a]();;){var v=m.next();if(v.done){d.complete();break}if(d.next(v.value),d.closed)break}else if(e&&"function"==typeof e[h.a]){var g=e[h.a]();if("function"==typeof g.subscribe)return g.subscribe(new l(t,n,u));d.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var y=Object(a.a)(e)?"an invalid object":"'"+e+"'";d.error(new TypeError("You provided "+y+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))}}return null}},PMti:function(t,e,n){"use strict";e.__esModule=!0,e.BitmapText=e.TilingSpriteRenderer=e.TilingSprite=e.AnimatedSprite=void 0;var r=n("hYez");Object.defineProperty(e,"AnimatedSprite",{enumerable:!0,get:function(){return s(r).default}});var i=n("DVpw");Object.defineProperty(e,"TilingSprite",{enumerable:!0,get:function(){return s(i).default}});var o=n("3AVc");Object.defineProperty(e,"TilingSpriteRenderer",{enumerable:!0,get:function(){return s(o).default}});var a=n("38rC");function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"BitmapText",{enumerable:!0,get:function(){return s(a).default}}),n("M81j"),n("6Lyv"),n("aWrq")},PjB0:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n("aH6o"),o=n("Q5/2"),a=n("FjAT"),s=h(n("/MUw")),c=h(n("dtlK")),u=h(n("1g9v")),l=h(n("BzvE"));function h(t){return t&&t.__esModule?t:{default:t}}var d=new o.Matrix,p=function(t){function e(n,r,u,l){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return(0,i.sayHello)(n),"number"==typeof r&&(r=Object.assign({width:r,height:u||s.default.RENDER_OPTIONS.height},l)),r=Object.assign({},s.default.RENDER_OPTIONS,r),h.options=r,h.type=a.RENDERER_TYPE.UNKNOWN,h.screen=new o.Rectangle(0,0,r.width,r.height),h.view=r.view||document.createElement("canvas"),h.resolution=r.resolution||s.default.RESOLUTION,h.transparent=r.transparent,h.autoResize=r.autoResize||!1,h.blendModes=null,h.preserveDrawingBuffer=r.preserveDrawingBuffer,h.clearBeforeRender=r.clearBeforeRender,h.roundPixels=r.roundPixels,h._backgroundColor=0,h._backgroundColorRgba=[0,0,0,0],h._backgroundColorString="#000000",h.backgroundColor=r.backgroundColor||h._backgroundColor,h._tempDisplayObjectParent=new c.default,h._lastObjectRendered=h._tempDisplayObjectParent,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoResize&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},e.prototype.generateTexture=function(t,e,n,r){r=r||t.getLocalBounds();var i=u.default.create(0|r.width,0|r.height,e,n);return d.tx=-r.x,d.ty=-r.y,this.render(t,i,!1,d,!0),i},e.prototype.destroy=function(t){t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=a.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},r(e,[{key:"width",get:function(){return this.view.width}},{key:"height",get:function(){return this.view.height}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=(0,i.hex2string)(t),(0,i.hex2rgb)(t,this._backgroundColorRgba)}}]),e}(l.default);e.default=p},"Q+pJ":function(t,e){var n=function(t,e,n,r,i){this.gl=t,this.texture=t.createTexture(),this.mipmap=!1,this.premultiplyAlpha=!1,this.width=e||-1,this.height=n||-1,this.format=r||t.RGBA,this.type=i||t.UNSIGNED_BYTE};n.prototype.upload=function(t){this.bind();var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var n=t.videoWidth||t.width,r=t.videoHeight||t.height;r!==this.height||n!==this.width?e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,t):e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.format,this.type,t),this.width=n,this.height=r};var r=!1;n.prototype.uploadData=function(t,e,n){this.bind();var i=this.gl;if(t instanceof Float32Array){if(!r){if(!i.getExtension("OES_texture_float"))throw new Error("floating point textures not available");r=!0}this.type=i.FLOAT}else this.type=this.type||i.UNSIGNED_BYTE;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e!==this.width||n!==this.height?i.texImage2D(i.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,t||null):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e,n,this.format,this.type,t||null),this.width=e,this.height=n},n.prototype.bind=function(t){var e=this.gl;void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},n.prototype.unbind=function(){var t=this.gl;t.bindTexture(t.TEXTURE_2D,null)},n.prototype.minFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.mipmap?t?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST:t?e.LINEAR:e.NEAREST)},n.prototype.magFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t?e.LINEAR:e.NEAREST)},n.prototype.enableMipmap=function(){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_2D)},n.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},n.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},n.prototype.enableWrapClamp=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)},n.prototype.enableWrapRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)},n.prototype.enableWrapMirrorRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)},n.prototype.destroy=function(){this.gl.deleteTexture(this.texture)},n.fromSource=function(t,e,r){var i=new n(t);return i.premultiplyAlpha=r||!1,i.upload(e),i},n.fromData=function(t,e,r,i){var o=new n(t);return o.uploadData(e,r,i),o},t.exports=n},"Q/rl":function(t,e,n){"use strict";e.__esModule=!0,e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,o.default)()?(t[i.BLEND_MODES.NORMAL]="source-over",t[i.BLEND_MODES.ADD]="lighter",t[i.BLEND_MODES.MULTIPLY]="multiply",t[i.BLEND_MODES.SCREEN]="screen",t[i.BLEND_MODES.OVERLAY]="overlay",t[i.BLEND_MODES.DARKEN]="darken",t[i.BLEND_MODES.LIGHTEN]="lighten",t[i.BLEND_MODES.COLOR_DODGE]="color-dodge",t[i.BLEND_MODES.COLOR_BURN]="color-burn",t[i.BLEND_MODES.HARD_LIGHT]="hard-light",t[i.BLEND_MODES.SOFT_LIGHT]="soft-light",t[i.BLEND_MODES.DIFFERENCE]="difference",t[i.BLEND_MODES.EXCLUSION]="exclusion",t[i.BLEND_MODES.HUE]="hue",t[i.BLEND_MODES.SATURATION]="saturate",t[i.BLEND_MODES.COLOR]="color",t[i.BLEND_MODES.LUMINOSITY]="luminosity"):(t[i.BLEND_MODES.NORMAL]="source-over",t[i.BLEND_MODES.ADD]="lighter",t[i.BLEND_MODES.MULTIPLY]="source-over",t[i.BLEND_MODES.SCREEN]="source-over",t[i.BLEND_MODES.OVERLAY]="source-over",t[i.BLEND_MODES.DARKEN]="source-over",t[i.BLEND_MODES.LIGHTEN]="source-over",t[i.BLEND_MODES.COLOR_DODGE]="source-over",t[i.BLEND_MODES.COLOR_BURN]="source-over",t[i.BLEND_MODES.HARD_LIGHT]="source-over",t[i.BLEND_MODES.SOFT_LIGHT]="source-over",t[i.BLEND_MODES.DIFFERENCE]="source-over",t[i.BLEND_MODES.EXCLUSION]="source-over",t[i.BLEND_MODES.HUE]="source-over",t[i.BLEND_MODES.SATURATION]="source-over",t[i.BLEND_MODES.COLOR]="source-over",t[i.BLEND_MODES.LUMINOSITY]="source-over"),t[i.BLEND_MODES.NORMAL_NPM]=t[i.BLEND_MODES.NORMAL],t[i.BLEND_MODES.ADD_NPM]=t[i.BLEND_MODES.ADD],t[i.BLEND_MODES.SCREEN_NPM]=t[i.BLEND_MODES.SCREEN],t};var r,i=n("FjAT"),o=(r=n("/SMQ"))&&r.__esModule?r:{default:r}},"Q5/2":function(t,e,n){"use strict";e.__esModule=!0;var r=n("zFUS");Object.defineProperty(e,"Point",{enumerable:!0,get:function(){return d(r).default}});var i=n("kFAI");Object.defineProperty(e,"ObservablePoint",{enumerable:!0,get:function(){return d(i).default}});var o=n("HVUN");Object.defineProperty(e,"Matrix",{enumerable:!0,get:function(){return d(o).default}});var a=n("VWTR");Object.defineProperty(e,"GroupD8",{enumerable:!0,get:function(){return d(a).default}});var s=n("h4XE");Object.defineProperty(e,"Circle",{enumerable:!0,get:function(){return d(s).default}});var c=n("V0yo");Object.defineProperty(e,"Ellipse",{enumerable:!0,get:function(){return d(c).default}});var u=n("7F6j");Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return d(u).default}});var l=n("gQZj");Object.defineProperty(e,"Rectangle",{enumerable:!0,get:function(){return d(l).default}});var h=n("Ibme");function d(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"RoundedRectangle",{enumerable:!0,get:function(){return d(h).default}})},Q5o8:function(t,e,n){var r=n("JD0k"),i=n("7IZn"),o=n("rN5J"),a=n("Qn7E"),s=n("sMVv"),c=function(t,e,n,c,u){this.gl=t,c&&(e=a(e,c),n=a(n,c)),this.program=r(t,e,n,u),this.attributes=i(t,this.program),this.uniformData=o(t,this.program),this.uniforms=s(t,this.uniformData)};c.prototype.bind=function(){return this.gl.useProgram(this.program),this},c.prototype.destroy=function(){this.attributes=null,this.uniformData=null,this.uniforms=null,this.gl.deleteProgram(this.program)},t.exports=c},"QAU/":function(t,e,n){"use strict";e.__esModule=!0;var r=l(n("3psj")),i=l(n("EoU7")),o=l(n("tl0p")),a=n("Q5/2"),s=l(n("Obmw")),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/Zzt")),u=l(n("eWjs"));function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var d=function t(){h(this,t),this.renderTarget=null,this.sourceFrame=new a.Rectangle,this.destinationFrame=new a.Rectangle,this.filters=[],this.target=null,this.resolution=1},p=function(t){function e(n){h(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.gl=r.renderer.gl,r.quad=new o.default(r.gl,n.state.attribState),r.shaderCache={},r.pool={},r.filterData=null,r.managedFilters=[],r.renderer.on("prerender",r.onPrerender,r),r._screenWidth=n.view.width,r._screenHeight=n.view.height,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.pushFilter=function(t,e){var n=this.renderer,r=this.filterData;if(!r){r=this.renderer._activeRenderTarget.filterStack;var i=new d;i.sourceFrame=i.destinationFrame=this.renderer._activeRenderTarget.size,i.renderTarget=n._activeRenderTarget,this.renderer._activeRenderTarget.filterData=r={index:0,stack:[i]},this.filterData=r}var o=r.stack[++r.index],a=r.stack[0].destinationFrame;o||(o=r.stack[r.index]=new d);var s=t.filterArea&&0===t.filterArea.x&&0===t.filterArea.y&&t.filterArea.width===n.screen.width&&t.filterArea.height===n.screen.height,c=e[0].resolution,u=0|e[0].padding,l=s?n.screen:t.filterArea||t.getBounds(!0),h=o.sourceFrame,p=o.destinationFrame;h.x=(l.x*c|0)/c,h.y=(l.y*c|0)/c,h.width=(l.width*c|0)/c,h.height=(l.height*c|0)/c,s||(r.stack[0].renderTarget.transform||e[0].autoFit&&h.fit(a),h.pad(u)),p.width=h.width,p.height=h.height;var f=this.getPotRenderTarget(n.gl,h.width,h.height,c);o.target=t,o.filters=e,o.resolution=c,o.renderTarget=f,f.setFrame(p,h),n.bindRenderTarget(f),f.clear()},e.prototype.popFilter=function(){var t=this.filterData,e=t.stack[t.index-1],n=t.stack[t.index];this.quad.map(n.renderTarget.size,n.sourceFrame).upload();var r=n.filters;if(1===r.length)r[0].apply(this,n.renderTarget,e.renderTarget,!1,n),this.freePotRenderTarget(n.renderTarget);else{var i=n.renderTarget,o=this.getPotRenderTarget(this.renderer.gl,n.sourceFrame.width,n.sourceFrame.height,n.resolution);o.setFrame(n.destinationFrame,n.sourceFrame),o.clear();var a=0;for(a=0;a<r.length-1;++a){r[a].apply(this,i,o,!0,n);var s=i;i=o,o=s}r[a].apply(this,i,e.renderTarget,!1,n),this.freePotRenderTarget(i),this.freePotRenderTarget(o)}t.index--,0===t.index&&(this.filterData=null)},e.prototype.applyFilter=function(t,e,n,r){var i=this.renderer,o=i.gl,a=t.glShaders[i.CONTEXT_UID];a||(t.glShaderKey?(a=this.shaderCache[t.glShaderKey])||(a=new s.default(this.gl,t.vertexSrc,t.fragmentSrc),t.glShaders[i.CONTEXT_UID]=this.shaderCache[t.glShaderKey]=a,this.managedFilters.push(t)):(a=t.glShaders[i.CONTEXT_UID]=new s.default(this.gl,t.vertexSrc,t.fragmentSrc),this.managedFilters.push(t)),i.bindVao(null),this.quad.initVao(a)),i.bindVao(this.quad.vao),i.bindRenderTarget(n),r&&(o.disable(o.SCISSOR_TEST),i.clear(),o.enable(o.SCISSOR_TEST)),n===i.maskManager.scissorRenderTarget&&i.maskManager.pushScissorMask(null,i.maskManager.scissorData),i.bindShader(a);var c=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=c,this.syncUniforms(a,t),i.state.setBlendMode(t.blendMode),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.texture.texture),this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0),o.bindTexture(o.TEXTURE_2D,c._glTextures[this.renderer.CONTEXT_UID].texture)},e.prototype.syncUniforms=function(t,e){var n=e.uniformData,r=e.uniforms,i=1,o=void 0;if(t.uniforms.filterArea){var a=t.uniforms.filterArea;a[0]=(o=this.filterData.stack[this.filterData.index]).renderTarget.size.width,a[1]=o.renderTarget.size.height,a[2]=o.sourceFrame.x,a[3]=o.sourceFrame.y,t.uniforms.filterArea=a}if(t.uniforms.filterClamp){o=o||this.filterData.stack[this.filterData.index];var s=t.uniforms.filterClamp;s[0]=0,s[1]=0,s[2]=(o.sourceFrame.width-1)/o.renderTarget.size.width,s[3]=(o.sourceFrame.height-1)/o.renderTarget.size.height,t.uniforms.filterClamp=s}for(var c in n){var u=n[c].type;if("sampler2d"===u&&0!==r[c]){if(r[c].baseTexture)t.uniforms[c]=this.renderer.bindTexture(r[c].baseTexture,i);else{t.uniforms[c]=i;var l=this.renderer.gl;this.renderer.boundTextures[i]=this.renderer.emptyTextures[i],l.activeTexture(l.TEXTURE0+i),r[c].texture.bind()}i++}else if("mat3"===u)t.uniforms[c]=void 0!==r[c].a?r[c].toArray(!0):r[c];else if("vec2"===u)if(void 0!==r[c].x){var h=t.uniforms[c]||new Float32Array(2);h[0]=r[c].x,h[1]=r[c].y,t.uniforms[c]=h}else t.uniforms[c]=r[c];else"float"===u?t.uniforms.data[c].value!==n[c]&&(t.uniforms[c]=r[c]):t.uniforms[c]=r[c]}},e.prototype.getRenderTarget=function(t,e){var n=this.filterData.stack[this.filterData.index],r=this.getPotRenderTarget(this.renderer.gl,n.sourceFrame.width,n.sourceFrame.height,e||n.resolution);return r.setFrame(n.destinationFrame,n.sourceFrame),r},e.prototype.returnRenderTarget=function(t){this.freePotRenderTarget(t)},e.prototype.calculateScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return c.calculateScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size)},e.prototype.calculateNormalizedScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return c.calculateNormalizedScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size,e.destinationFrame)},e.prototype.calculateSpriteMatrix=function(t,e){var n=this.filterData.stack[this.filterData.index];return c.calculateSpriteMatrix(t,n.sourceFrame,n.renderTarget.size,e)},e.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.renderer,n=this.managedFilters;e.off("prerender",this.onPrerender,this);for(var r=0;r<n.length;r++)t||n[r].glShaders[e.CONTEXT_UID].destroy(),delete n[r].glShaders[e.CONTEXT_UID];this.shaderCache={},t?this.pool={}:this.emptyPool()},e.prototype.getPotRenderTarget=function(t,e,n,r){var o="screen";n*=r,(e*=r)===this._screenWidth&&n===this._screenHeight||(o=(65535&(e=u.default.nextPow2(e)))<<16|65535&(n=u.default.nextPow2(n))),this.pool[o]||(this.pool[o]=[]);var a=this.pool[o].pop();if(!a){var s=this.renderer.boundTextures[0];t.activeTexture(t.TEXTURE0),a=new i.default(t,e,n,null,1),t.bindTexture(t.TEXTURE_2D,s._glTextures[this.renderer.CONTEXT_UID].texture)}return a.resolution=r,a.defaultFrame.width=a.size.width=e/r,a.defaultFrame.height=a.size.height=n/r,a},e.prototype.emptyPool=function(){for(var t in this.pool){var e=this.pool[t];if(e)for(var n=0;n<e.length;n++)e[n].destroy(!0)}this.pool={}},e.prototype.freePotRenderTarget=function(t){var e=t.size.width*t.resolution,n=t.size.height*t.resolution,r="screen";e===this._screenWidth&&n===this._screenHeight||(r=(65535&e)<<16|65535&n),this.pool[r].push(t)},e.prototype.onPrerender=function(){if(this._screenWidth!==this.renderer.view.width||this._screenHeight!==this.renderer.view.height){this._screenWidth=this.renderer.view.width,this._screenHeight=this.renderer.view.height;var t=this.pool.screen;if(t)for(var e=0;e<t.length;e++)t[e].destroy(!0);this.pool.screen=[]}},e}(r.default);e.default=p},QHw4:function(t,e,n){(function(t){var r=n("sOR5"),i=n("UZ14"),o=Object.prototype.toString,a="function"==typeof t.Blob||"[object BlobConstructor]"===o.call(t.Blob),s="function"==typeof t.File||"[object FileConstructor]"===o.call(t.File);e.deconstructPacket=function(t){var e=[],n=t;return n.data=function t(e,n){if(!e)return e;if(i(e)){var o={_placeholder:!0,num:n.length};return n.push(e),o}if(r(e)){for(var a=new Array(e.length),s=0;s<e.length;s++)a[s]=t(e[s],n);return a}if("object"==typeof e&&!(e instanceof Date)){for(var c in a={},e)a[c]=t(e[c],n);return a}return e}(t.data,e),n.attachments=e.length,{packet:n,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(r(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],n);else if("object"==typeof e)for(var o in e)e[o]=t(e[o],n);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var n=0,o=t;!function t(c,u,l){if(!c)return c;if(a&&c instanceof Blob||s&&c instanceof File){n++;var h=new FileReader;h.onload=function(){l?l[u]=this.result:o=this.result,--n||e(o)},h.readAsArrayBuffer(c)}else if(r(c))for(var d=0;d<c.length;d++)t(c[d],d,c);else if("object"==typeof c&&!i(c))for(var p in c)t(c[p],p,c)}(o),n||e(o)}}).call(e,n("DuR2"))},QamB:function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},Qn7E:function(t,e){t.exports=function(t,e){return"precision"!==t.substring(0,9)?"precision "+e+" float;\n"+t:t}},Qnch:function(t,e,n){"use strict";e.a=function(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return"number"==typeof e&&(n=e,e=null),r.lift(new a(t,e,n))}};var r=n("TToO"),i=n("PIsA"),o=n("tZ2B"),a=function(){function t(t,e,n){void 0===n&&(n=Number.POSITIVE_INFINITY),this.project=t,this.resultSelector=e,this.concurrent=n}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.project,this.resultSelector,this.concurrent))},t}(),s=function(t){function e(e,n,r,i){void 0===i&&(i=Number.POSITIVE_INFINITY),t.call(this,e),this.project=n,this.resultSelector=r,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return Object(r.c)(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){this.add(Object(i.a)(this,t,e,n))},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){this.resultSelector?this._notifyResultSelector(t,e,n,r):this.destination.next(e)},e.prototype._notifyResultSelector=function(t,e,n,r){var i;try{i=this.resultSelector(t,e,n,r)}catch(t){return void this.destination.error(t)}this.destination.next(i)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(o.a)},QyjV:function(t,e,n){"use strict";e.__esModule=!0;var r=n("RgHu");Object.defineProperty(e,"webgl",{enumerable:!0,get:function(){return c(r).default}});var i=n("jMVn");Object.defineProperty(e,"canvas",{enumerable:!0,get:function(){return c(i).default}});var o=n("k6PJ");Object.defineProperty(e,"BasePrepare",{enumerable:!0,get:function(){return c(o).default}});var a=n("EmDc");Object.defineProperty(e,"CountLimiter",{enumerable:!0,get:function(){return c(a).default}});var s=n("Gc6/");function c(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"TimeLimiter",{enumerable:!0,get:function(){return c(s).default}})},RZRe:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e,n){t.points=t.shape.points.slice();var a=t.points;if(t.fill&&a.length>=6){for(var s=[],c=t.holes,u=0;u<c.length;u++){var l=c[u];s.push(a.length/2),a=a.concat(l.points)}var h=e.points,d=e.indices,p=a.length/2,f=(0,i.hex2rgb)(t.fillColor),m=t.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,b=(0,o.default)(a,s,2);if(!b)return;for(var x=h.length/6,w=0;w<b.length;w+=3)d.push(b[w]+x),d.push(b[w]+x),d.push(b[w+1]+x),d.push(b[w+2]+x),d.push(b[w+2]+x);for(var _=0;_<p;_++)h.push(a[2*_],a[2*_+1],v,g,y,m)}t.lineWidth>0&&(0,r.default)(t,e,n)};var r=a(n("FH9r")),i=n("aH6o"),o=a(n("It3W"));function a(t){return t&&t.__esModule?t:{default:t}}},Rf9G:function(t,e,n){"use strict";e.a=function(){return Object(r.a)()(this)};var r=n("3a3m")},RgHu:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.uploadHookHelper=r.renderer,r.registerFindHook(c),r.registerUploadHook(a),r.registerUploadHook(s),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((r=n("k6PJ"))&&r.__esModule?r:{default:r}).default);function a(t,e){return e instanceof i.BaseTexture&&(e._glTextures[t.CONTEXT_UID]||t.textureManager.updateTexture(e),!0)}function s(t,e){return e instanceof i.Graphics&&((e.dirty||e.clearDirty||!e._webGL[t.plugins.graphics.CONTEXT_UID])&&t.plugins.graphics.updateGraphics(e),!0)}function c(t,e){return t instanceof i.Graphics&&(e.push(t),!0)}e.default=o,i.WebGLRenderer.registerPlugin("prepare",o)},RjLg:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=n("aH6o"),a=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,r=arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16384,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return o>16384&&(o=16384),o>n&&(o=n),s._properties=[!1,!0,!1,!1,!1],s._maxSize=n,s._batchSize=o,s._glBuffers={},s._bufferUpdateIDs=[],s._updateID=0,s.interactiveChildren=!1,s.blendMode=i.BLEND_MODES.NORMAL,s.autoResize=a,s.roundPixels=!0,s.baseTexture=null,s.setProperties(r),s._tint=0,s.tintRgb=new Float32Array(4),s.tint=16777215,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},e.prototype.renderWebGL=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.hasLoaded||this.baseTexture.once("update",function(){return e.onChildrenChange(0)})),t.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},e.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,n=this.worldTransform,r=!0,i=0,o=0,a=0,s=0;t.setBlendMode(this.blendMode),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var c=0;c<this.children.length;++c){var u=this.children[c];if(u.visible){var l=u._texture.frame;if(e.globalAlpha=this.worldAlpha*u.alpha,u.rotation%(2*Math.PI)==0)r&&(e.setTransform(n.a,n.b,n.c,n.d,n.tx*t.resolution,n.ty*t.resolution),r=!1),i=u.anchor.x*(-l.width*u.scale.x)+u.position.x+.5,o=u.anchor.y*(-l.height*u.scale.y)+u.position.y+.5,a=l.width*u.scale.x,s=l.height*u.scale.y;else{r||(r=!0),u.displayObjectUpdateTransform();var h=u.worldTransform;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution|0,h.ty*t.resolution|0):e.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution,h.ty*t.resolution),i=u.anchor.x*-l.width+.5,o=u.anchor.y*-l.height+.5,a=l.width,s=l.height}var d=u._texture.baseTexture.resolution;e.drawImage(u._texture.baseTexture.source,l.x*d,l.y*d,l.width*d,l.height*d,i*t.resolution,o*t.resolution,a*t.resolution,s*t.resolution)}}}},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._buffers)for(var n=0;n<this._buffers.length;++n)this._buffers[n].destroy();this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},r(e,[{key:"tint",get:function(){return this._tint},set:function(t){this._tint=t,(0,o.hex2rgb)(t,this.tintRgb)}}]),e}(i.Container);e.default=a},SBy4:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e,n){var a=t.shape,s=a.x,u=a.y,l=a.width,h=a.height,d=a.radius,p=[];if(p.push(s,u+d),c(s,u+h-d,s,u+h,s+d,u+h,p),c(s+l-d,u+h,s+l,u+h,s+l,u+h-d,p),c(s+l,u+d,s+l,u,s+l-d,u,p),c(s+d,u,s,u,s,u+d+1e-10,p),t.fill){for(var f=(0,o.hex2rgb)(t.fillColor),m=t.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,b=e.points,x=e.indices,w=b.length/6,_=(0,r.default)(p,null,2),S=0,T=_.length;S<T;S+=3)x.push(_[S]+w),x.push(_[S]+w),x.push(_[S+1]+w),x.push(_[S+2]+w),x.push(_[S+2]+w);for(var M=0,A=p.length;M<A;M++)b.push(p[M],p[++M],v,g,y,m)}if(t.lineWidth){var E=t.points;t.points=p,(0,i.default)(t,e,n),t.points=E}};var r=a(n("It3W")),i=a(n("FH9r")),o=n("aH6o");function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e,n){return t+(e-t)*n}function c(t,e,n,r,i,o){for(var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],c=0,u=0,l=0,h=0,d=0,p=0,f=0,m=0;f<=20;++f)c=s(t,n,m=f/20),u=s(e,r,m),l=s(n,i,m),h=s(r,o,m),d=s(c,l,m),p=s(u,h,m),a.push(d,p);return a}},SJFm:function(t,e){t.exports=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}},SMx8:function(t,e,n){"use strict";var r=n("j0z+").default,i=n("66C6").default,o=n("umD3"),a=n("7VTH");r.Resource=i,r.async=o,r.base64=a,t.exports=r,t.exports.default=r},SdIY:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=function(){function t(){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.global=new i.Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return t.prototype.getLocalPosition=function(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)},t.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},r(t,[{key:"pointerId",get:function(){return this.identifier}}]),t}();e.default=o},"Si/7":function(t,e,n){"use strict";e.__esModule=!0,e.default=function(){for(var t=[],e=[],n=0;n<32;n++)t[n]=n,e[n]=n;t[r.BLEND_MODES.NORMAL_NPM]=r.BLEND_MODES.NORMAL,t[r.BLEND_MODES.ADD_NPM]=r.BLEND_MODES.ADD,t[r.BLEND_MODES.SCREEN_NPM]=r.BLEND_MODES.SCREEN,e[r.BLEND_MODES.NORMAL]=r.BLEND_MODES.NORMAL_NPM,e[r.BLEND_MODES.ADD]=r.BLEND_MODES.ADD_NPM,e[r.BLEND_MODES.SCREEN]=r.BLEND_MODES.SCREEN_NPM;var i=[];return i.push(e),i.push(t),i};var r=n("FjAT")},Sst2:function(t,e,n){var r,i,o,a,s,c,u,l,h,d,p,f,m,v,g,y,b,x,w,_,S;a=/iPhone/i,s=/iPod/i,c=/iPad/i,u=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,l=/Android/i,h=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,d=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,p=/Windows Phone/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,m=/BlackBerry/i,v=/BB10/i,g=/Opera Mini/i,y=/(CriOS|Chrome)(?=.*\bMobile\b)/i,b=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,x=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),w=function(t,e){return t.test(e)},_=function(t){var e=t||navigator.userAgent,n=e.split("[FBAN");if("undefined"!=typeof n[1]&&(e=n[0]),"undefined"!=typeof(n=e.split("Twitter"))[1]&&(e=n[0]),this.apple={phone:w(a,e),ipod:w(s,e),tablet:!w(a,e)&&w(c,e),device:w(a,e)||w(s,e)||w(c,e)},this.amazon={phone:w(h,e),tablet:!w(h,e)&&w(d,e),device:w(h,e)||w(d,e)},this.android={phone:w(h,e)||w(u,e),tablet:!w(h,e)&&!w(u,e)&&(w(d,e)||w(l,e)),device:w(h,e)||w(d,e)||w(u,e)||w(l,e)},this.windows={phone:w(p,e),tablet:w(f,e),device:w(p,e)||w(f,e)},this.other={blackberry:w(m,e),blackberry10:w(v,e),opera:w(g,e),firefox:w(b,e),chrome:w(y,e),device:w(m,e)||w(v,e)||w(g,e)||w(b,e)||w(y,e)},this.seven_inch=w(x,e),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},S=function(){var t=new _;return t.Class=_,t},"undefined"!=typeof t&&t.exports&&"undefined"==typeof window?t.exports=_:"undefined"!=typeof t&&t.exports&&"undefined"!=typeof window?t.exports=S():(i=[],void 0===(o="function"==typeof(r=this.isMobile=S())?r.apply(e,i):r)||(t.exports=o))},TILf:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("TToO"),i=function(t){function e(e,n){t.call(this),this.value=e,this.scheduler=n,this._isScalar=!0,n&&(this._isScalar=!1)}return Object(r.c)(e,t),e.create=function(t,n){return new e(t,n)},e.dispatch=function(t){var e=t.value,n=t.subscriber;t.done?n.complete():(n.next(e),n.closed||(t.done=!0,this.schedule(t)))},e.prototype._subscribe=function(t){var n=this.value,r=this.scheduler;if(r)return r.schedule(e.dispatch,0,{done:!1,value:n,subscriber:t});t.next(n),t.closed||t.complete()},e}(n("YaPU").a)},TToO:function(t,e,n){"use strict";e.c=function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},n.d(e,"a",function(){return i}),e.b=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},e.d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}},Tff0:function(t,e){t.exports=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(t),o=new Uint8Array(n-e),a=e,s=0;a<n;a++,s++)o[s]=i[a];return o.buffer}},TlGl:function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),i=s(n("+DNt")),o=s(n("s4oU")),a=n("aH6o");function s(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return i.shader=null,i.indexBuffer=null,i.properties=null,i.tempMatrix=new r.Matrix,i.CONTEXT_UID=0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new i.default(t),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:!0,uploadFunction:this.uploadTint,offset:0}]},e.prototype.start=function(){this.renderer.bindShader(this.shader)},e.prototype.render=function(t){var e=t.children,n=t._maxSize,i=t._batchSize,o=this.renderer,a=e.length;if(0!==a){a>n&&(a=n);var s=t._glBuffers[o.CONTEXT_UID];s||(s=t._glBuffers[o.CONTEXT_UID]=this.generateBuffers(t));var c=e[0]._texture.baseTexture;this.renderer.setBlendMode(r.utils.correctBlendMode(t.blendMode,c.premultipliedAlpha));var u=o.gl,l=t.worldTransform.copy(this.tempMatrix);l.prepend(o._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=l.toArray(!0),this.shader.uniforms.uColor=r.utils.premultiplyRgba(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,c.premultipliedAlpha),this.shader.uniforms.uSampler=o.bindTexture(c);for(var h=!1,d=0,p=0;d<a;d+=i,p+=1){var f=a-d;if(f>i&&(f=i),p>=s.length){if(!t.autoResize)break;s.push(this._generateOneMoreBuffer(t))}var m=s[p];m.uploadDynamic(e,d,f),(h=h||m._updateID<(t._bufferUpdateIDs[d]||0))&&(m._updateID=t._updateID,m.uploadStatic(e,d,f)),o.bindVao(m.vao),m.vao.draw(u.TRIANGLES,6*f)}}},e.prototype.generateBuffers=function(t){for(var e=this.renderer.gl,n=[],r=t._maxSize,i=t._batchSize,a=t._properties,s=0;s<r;s+=i)n.push(new o.default(e,this.properties,a,i));return n},e.prototype._generateOneMoreBuffer=function(t){return new o.default(this.renderer.gl,this.properties,t._properties,t._batchSize)},e.prototype.uploadVertices=function(t,e,n,r,i,o){for(var a=0,s=0,c=0,u=0,l=0;l<n;++l){var h=t[e+l],d=h._texture,p=h.scale.x,f=h.scale.y,m=d.trim,v=d.orig;m?(a=(s=m.x-h.anchor.x*v.width)+m.width,c=(u=m.y-h.anchor.y*v.height)+m.height):(a=v.width*(1-h.anchor.x),s=v.width*-h.anchor.x,c=v.height*(1-h.anchor.y),u=v.height*-h.anchor.y),r[o]=s*p,r[o+1]=u*f,r[o+i]=a*p,r[o+i+1]=u*f,r[o+2*i]=a*p,r[o+2*i+1]=c*f,r[o+3*i]=s*p,r[o+3*i+1]=c*f,o+=4*i}},e.prototype.uploadPosition=function(t,e,n,r,i,o){for(var a=0;a<n;a++){var s=t[e+a].position;r[o]=s.x,r[o+1]=s.y,r[o+i]=s.x,r[o+i+1]=s.y,r[o+2*i]=s.x,r[o+2*i+1]=s.y,r[o+3*i]=s.x,r[o+3*i+1]=s.y,o+=4*i}},e.prototype.uploadRotation=function(t,e,n,r,i,o){for(var a=0;a<n;a++){var s=t[e+a].rotation;r[o]=s,r[o+i]=s,r[o+2*i]=s,r[o+3*i]=s,o+=4*i}},e.prototype.uploadUvs=function(t,e,n,r,i,o){for(var a=0;a<n;++a){var s=t[e+a]._texture._uvs;s?(r[o]=s.x0,r[o+1]=s.y0,r[o+i]=s.x1,r[o+i+1]=s.y1,r[o+2*i]=s.x2,r[o+2*i+1]=s.y2,r[o+3*i]=s.x3,r[o+3*i+1]=s.y3,o+=4*i):(r[o]=0,r[o+1]=0,r[o+i]=0,r[o+i+1]=0,r[o+2*i]=0,r[o+2*i+1]=0,r[o+3*i]=0,r[o+3*i+1]=0,o+=4*i)}},e.prototype.uploadTint=function(t,e,n,r,i,o){for(var s=0;s<n;++s){var c=t[e+s],u=c.alpha,l=u<1&&c._texture.baseTexture.premultipliedAlpha?(0,a.premultiplyTint)(c._tintRGB,u):c._tintRGB+(255*u<<24);r[o]=l,r[o+i]=l,r[o+2*i]=l,r[o+3*i]=l,o+=4*i}},e.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),t.prototype.destroy.call(this),this.shader.destroy(),this.indices=null,this.tempMatrix=null},e}(r.ObjectRenderer);e.default=c,r.WebGLRenderer.registerPlugin("particle",c)},Twrw:function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("8QNu"))&&r.__esModule?r:{default:r},o=function(){function t(e,n,r){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=i.default.GLBuffer.createVertexBuffer(e),this.indexBuffer=i.default.GLBuffer.createIndexBuffer(e),this.dirty=!0,this.nativeLines=!1,this.glPoints=null,this.glIndices=null,this.shader=n,this.vao=new i.default.VertexArrayObject(e,r).addIndex(this.indexBuffer).addAttribute(this.buffer,n.attributes.aVertexPosition,e.FLOAT,!1,24,0).addAttribute(this.buffer,n.attributes.aColor,e.FLOAT,!1,24,8)}return t.prototype.reset=function(){this.points.length=0,this.indices.length=0},t.prototype.upload=function(){this.glPoints=new Float32Array(this.points),this.buffer.upload(this.glPoints),this.glIndices=new Uint16Array(this.indices),this.indexBuffer.upload(this.glIndices),this.dirty=!1},t.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.vao.destroy(),this.buffer.destroy(),this.indexBuffer.destroy(),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null},t}();e.default=o},U7Sr:function(t,e,n){var r=n("Q+pJ"),i=function(t,e,n){this.gl=t,this.framebuffer=t.createFramebuffer(),this.stencil=null,this.texture=null,this.width=e||100,this.height=n||100};i.prototype.enableTexture=function(t){var e=this.gl;this.texture=t||new r(e),this.texture.bind(),this.bind(),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.texture,0)},i.prototype.enableStencil=function(){if(!this.stencil){var t=this.gl;this.stencil=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencil),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height)}},i.prototype.clear=function(t,e,n,r){this.bind();var i=this.gl;i.clearColor(t,e,n,r),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},i.prototype.bind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer)},i.prototype.unbind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},i.prototype.resize=function(t,e){var n=this.gl;this.width=t,this.height=e,this.texture&&this.texture.uploadData(null,t,e),this.stencil&&(n.bindRenderbuffer(n.RENDERBUFFER,this.stencil),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t,e))},i.prototype.destroy=function(){var t=this.gl;this.texture&&this.texture.destroy(),t.deleteFramebuffer(this.framebuffer),this.gl=null,this.stencil=null,this.texture=null},i.createRGBA=function(t,e,n,o){var a=r.fromData(t,null,e,n);a.enableNearestScaling(),a.enableWrapClamp();var s=new i(t,e,n);return s.enableTexture(a),s.unbind(),s},i.createFloat32=function(t,e,n,o){var a=new r.fromData(t,o,e,n);a.enableNearestScaling(),a.enableWrapClamp();var s=new i(t,e,n);return s.enableTexture(a),s.unbind(),s},t.exports=i},UZ14:function(t,e,n){(function(e){t.exports=function(t){return n&&e.Buffer.isBuffer(t)||r&&(t instanceof e.ArrayBuffer||i(t))};var n="function"==typeof e.Buffer&&"function"==typeof e.Buffer.isBuffer,r="function"==typeof e.ArrayBuffer,i=r&&"function"==typeof e.ArrayBuffer.isView?e.ArrayBuffer.isView:function(t){return t.buffer instanceof e.ArrayBuffer}}).call(e,n("DuR2"))},UZ5h:function(t,e,n){"use strict";var r=n("MsCo"),i=n("qOJP");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=b,e.resolve=function(t,e){return b(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?b(t,!1,!0).resolveObject(e):e},e.format=function(t){return i.isString(t)&&(t=b(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(u),h=["%","/","?",";","#"].concat(l),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n("1nuA");function b(t,e,n){if(t&&i.isObject(t)&&t instanceof o)return t;var r=new o;return r.parse(t,e,n),r}o.prototype.parse=function(t,e,n){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),s=-1!==o&&o<t.indexOf("#")?"?":"#",u=t.split(s);u[0]=u[0].replace(/\\/g,"/");var b=t=u.join(s);if(b=b.trim(),!n&&1===t.split("#").length){var x=c.exec(b);if(x)return this.path=b,this.href=b,this.pathname=x[1],x[2]?(this.search=x[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=a.exec(b);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,b=b.substr(w.length)}if(n||w||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===b.substr(0,2);!S||w&&v[w]||(b=b.substr(2),this.slashes=!0)}if(!v[w]&&(S||w&&!g[w])){for(var T,M,A=-1,E=0;E<d.length;E++)-1!==(C=b.indexOf(d[E]))&&(-1===A||C<A)&&(A=C);for(-1!==(M=-1===A?b.lastIndexOf("@"):b.lastIndexOf("@",A))&&(T=b.slice(0,M),b=b.slice(M+1),this.auth=decodeURIComponent(T)),A=-1,E=0;E<h.length;E++){var C;-1!==(C=b.indexOf(h[E]))&&(-1===A||C<A)&&(A=C)}-1===A&&(A=b.length),this.host=b.slice(0,A),b=b.slice(A),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var O=this.hostname.split(/\./),N=(E=0,O.length);E<N;E++){var L=O[E];if(L&&!L.match(p)){for(var I="",R=0,D=L.length;R<D;R++)L.charCodeAt(R)>127?I+="x":I+=L[R];if(!I.match(p)){var F=O.slice(0,E),U=O.slice(E+1),k=L.match(f);k&&(F.push(k[1]),U.unshift(k[2])),U.length&&(b="/"+U.join(".")+b),this.hostname=F.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),P||(this.hostname=r.toASCII(this.hostname));var j=this.port?":"+this.port:"";this.host=(this.hostname||"")+j,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[_])for(E=0,N=l.length;E<N;E++){var B=l[E];if(-1!==b.indexOf(B)){var z=encodeURIComponent(B);z===B&&(z=escape(B)),b=b.split(B).join(z)}}var V=b.indexOf("#");-1!==V&&(this.hash=b.substr(V),b=b.slice(0,V));var G=b.indexOf("?");return-1!==G?(this.search=b.substr(G),this.query=b.substr(G+1),e&&(this.query=y.parse(this.query)),b=b.slice(0,G)):e&&(this.search="",this.query={}),b&&(this.pathname=b),g[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(j=this.pathname||"")+(this.search||"")),this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=y.stringify(this.query));var s=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+o+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var n=new o,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var c=Object.keys(t),u=0;u<c.length;u++){var l=c[u];"protocol"!==l&&(n[l]=t[l])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!g[t.protocol]){for(var h=Object.keys(t),d=0;d<h.length;d++){var p=h[d];n[p]=t[p]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||v[t.protocol])n.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}return n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,(n.pathname||n.search)&&(n.path=(n.pathname||"")+(n.search||"")),n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=y||m||n.host&&t.pathname,x=b,w=n.pathname&&n.pathname.split("/")||[],_=(f=t.pathname&&t.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(_&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),b=b&&(""===f[0]||""===w[0])),y)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,w=f;else if(f.length)w||(w=[]),w.pop(),w=w.concat(f),n.search=t.search,n.query=t.query;else if(!i.isNullOrUndefined(t.search))return _&&(n.hostname=n.host=w.shift(),(E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=E.shift(),n.host=n.hostname=E.shift())),n.search=t.search,n.query=t.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!w.length)return n.pathname=null,n.path=n.search?"/"+n.search:null,n.href=n.format(),n;for(var S=w.slice(-1)[0],T=(n.host||t.host||w.length>1)&&("."===S||".."===S)||""===S,M=0,A=w.length;A>=0;A--)"."===(S=w[A])?w.splice(A,1):".."===S?(w.splice(A,1),M++):M&&(w.splice(A,1),M--);if(!b&&!x)for(;M--;M)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),T&&"/"!==w.join("/").substr(-1)&&w.push("");var E,C=""===w[0]||w[0]&&"/"===w[0].charAt(0);return _&&(n.hostname=n.host=C?"":w.length?w.shift():"",(E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=E.shift(),n.host=n.hostname=E.shift())),(b=b||n.host&&w.length)&&!C&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},UsJC:function(t,e,n){"use strict";e.__esModule=!0;var r=n("FjAT"),i=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.pushMask=function(t){var e=this.renderer;e.context.save();var n=t.alpha,r=t.transform.worldTransform,i=e.resolution;e.context.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i,r.ty*i),t._texture||(this.renderGraphicsShape(t),e.context.clip()),t.worldAlpha=n},t.prototype.renderGraphicsShape=function(t){var e=this.renderer.context,n=t.graphicsData.length;if(0!==n){e.beginPath();for(var i=0;i<n;i++){var o=t.graphicsData[i],a=o.shape;if(o.type===r.SHAPES.POLY){var s=a.points;e.moveTo(s[0],s[1]);for(var c=1;c<s.length/2;c++)e.lineTo(s[2*c],s[2*c+1]);s[0]===s[s.length-2]&&s[1]===s[s.length-1]&&e.closePath()}else if(o.type===r.SHAPES.RECT)e.rect(a.x,a.y,a.width,a.height),e.closePath();else if(o.type===r.SHAPES.CIRC)e.arc(a.x,a.y,a.radius,0,2*Math.PI),e.closePath();else if(o.type===r.SHAPES.ELIP){var u=2*a.width,l=2*a.height,h=a.x-u/2,d=a.y-l/2,p=u/2*.5522848,f=l/2*.5522848,m=h+u,v=d+l,g=h+u/2,y=d+l/2;e.moveTo(h,y),e.bezierCurveTo(h,y-f,g-p,d,g,d),e.bezierCurveTo(g+p,d,m,y-f,m,y),e.bezierCurveTo(m,y+f,g+p,v,g,v),e.bezierCurveTo(g-p,v,h,y+f,h,y),e.closePath()}else if(o.type===r.SHAPES.RREC){var b=a.x,x=a.y,w=a.width,_=a.height,S=a.radius,T=Math.min(w,_)/2|0;e.moveTo(b,x+(S=S>T?T:S)),e.lineTo(b,x+_-S),e.quadraticCurveTo(b,x+_,b+S,x+_),e.lineTo(b+w-S,x+_),e.quadraticCurveTo(b+w,x+_,b+w,x+_-S),e.lineTo(b+w,x+S),e.quadraticCurveTo(b+w,x,b+w-S,x),e.lineTo(b+S,x),e.quadraticCurveTo(b,x,b,x+S),e.closePath()}}}},t.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},t.prototype.destroy=function(){},t}();e.default=i},UxPA:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n("FjAT"),o=n("aH6o"),a={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:i.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,wordWrap:!1,wordWrapWidth:100,leading:0},s=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.styleID=0,this.reset(),l(this,e,e)}return t.prototype.clone=function(){var e={};return l(e,this,a),new t(e)},t.prototype.reset=function(){l(this,a,a)},t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var n=e.length-1;n>=0;n--){var r=e[n].trim();/([\"\'])[^\'\"]+\1/.test(r)||(r='"'+r+'"'),e[n]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},r(t,[{key:"align",get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)}},{key:"breakWords",get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}},{key:"dropShadow",get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}},{key:"dropShadowAlpha",get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}},{key:"dropShadowAngle",get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}},{key:"dropShadowBlur",get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}},{key:"dropShadowColor",get:function(){return this._dropShadowColor},set:function(t){var e=u(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}},{key:"dropShadowDistance",get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}},{key:"fill",get:function(){return this._fill},set:function(t){var e=u(t);this._fill!==e&&(this._fill=e,this.styleID++)}},{key:"fillGradientType",get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}},{key:"fillGradientStops",get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}},{key:"fontVariant",get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}},{key:"leading",get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)}},{key:"stroke",get:function(){return this._stroke},set:function(t){var e=u(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}},{key:"strokeThickness",get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}},{key:"textBaseline",get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}},{key:"trim",get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}},{key:"wordWrapWidth",get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}}]),t}();function c(t){return"number"==typeof t?(0,o.hex2string)(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function u(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=c(t[e]);return t}return c(t)}function l(t,e,n){for(var r in n)t[r]=Array.isArray(e[r])?e[r].slice():e[r]}e.default=s},V0yo:function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("gQZj"))&&r.__esModule?r:{default:r},o=n("FjAT"),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=n,this.width=r,this.height=i,this.type=o.SHAPES.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=(t-this.x)/this.width,r=(e-this.y)/this.height;return(n*=n)+(r*=r)<=1},t.prototype.getBounds=function(){return new i.default(this.x-this.width,this.y-this.height,this.width,this.height)},t}();e.default=a},V1mL:function(t,e,n){(function(e){var r=n("fOB9"),i=n("Fy0/")("socket.io-client:url");t.exports=function(t,n){var o=t;n=n||e.location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t="undefined"!=typeof n?n.protocol+"//"+t:"https://"+t),i("parse %s",t),o=r(t)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var a=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+a+":"+o.port,o.href=o.protocol+"://"+a+(n&&n.port===o.port?"":":"+o.port),o}}).call(e,n("DuR2"))},VWTR:function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("HVUN"))&&r.__esModule?r:{default:r},o=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],a=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],s=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],c=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],u=[],l=[];function h(t){return t<0?-1:t>0?1:0}!function(){for(var t=0;t<16;t++){var e=[];l.push(e);for(var n=0;n<16;n++)for(var r=h(o[t]*o[n]+s[t]*a[n]),d=h(a[t]*o[n]+c[t]*a[n]),p=h(o[t]*s[n]+s[t]*c[n]),f=h(a[t]*s[n]+c[t]*c[n]),m=0;m<16;m++)if(o[m]===r&&a[m]===d&&s[m]===p&&c[m]===f){e.push(m);break}}for(var v=0;v<16;v++){var g=new i.default;g.set(o[v],a[v],s[v],c[v],0,0),u.push(g)}}();var d={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(t){return o[t]},uY:function(t){return a[t]},vX:function(t){return s[t]},vY:function(t){return c[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return l[t][e]},sub:function(t,e){return l[t][d.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?d.S:d.N:2*Math.abs(e)<=Math.abs(t)?t>0?d.E:d.W:e>0?t>0?d.SE:d.SW:t>0?d.NE:d.NW},matrixAppendRotationInv:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=u[d.inv(e)];i.tx=n,i.ty=r,t.append(i)}};e.default=d},Veqx:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var r=n("TToO"),i=n("YaPU"),o=n("TILf"),a=n("+3/4"),s=n("1Q68"),c=function(t){function e(e,n){t.call(this),this.array=e,this.scheduler=n,n||1!==e.length||(this._isScalar=!0,this.value=e[0])}return Object(r.c)(e,t),e.create=function(t,n){return new e(t,n)},e.of=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];var r=t[t.length-1];Object(s.a)(r)?t.pop():r=null;var i=t.length;return i>1?new e(t,r):1===i?new o.a(t[0],r):new a.a(r)},e.dispatch=function(t){var e=t.array,n=t.index,r=t.subscriber;n>=t.count?r.complete():(r.next(e[n]),r.closed||(t.index=n+1,this.schedule(t)))},e.prototype._subscribe=function(t){var n=this.array,r=n.length,i=this.scheduler;if(i)return i.schedule(e.dispatch,0,{array:n,index:0,count:r,subscriber:t});for(var o=0;o<r&&!t.closed;o++)t.next(n[o]);t.complete()},e}(i.a)},VwZZ:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n("BX3T"),i=n("dgOU"),o=n("/iUD"),a=n("GK6M"),s=n("fKB6"),c=n("oCQ5"),u=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var n=this._parent,u=this._parents,h=this._unsubscribe,d=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var p=-1,f=u?u.length:0;n;)n.remove(this),n=++p<f&&u[p]||null;if(Object(o.a)(h)&&Object(a.a)(h).call(this)===s.a&&(e=!0,t=t||(s.a.e instanceof c.a?l(s.a.e.errors):[s.a.e])),Object(r.a)(d))for(p=-1,f=d.length;++p<f;){var m=d[p];if(Object(i.a)(m)&&Object(a.a)(m.unsubscribe).call(m)===s.a){e=!0,t=t||[];var v=s.a.e;v instanceof c.a?t=t.concat(l(v.errors)):t.push(v)}}if(e)throw new c.a(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var n=e;switch(typeof e){case"function":n=new t(e);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.prototype._addParent=function(t){var e=this._parent,n=this._parents;e&&e!==t?n?-1===n.indexOf(t)&&n.push(t):this._parents=[t]:this._parent=t},t.EMPTY=((e=new t).closed=!0,e),t}();function l(t){return t.reduce(function(t,e){return t.concat(e instanceof c.a?e.errors:e)},[])}},W1MY:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n("Q5/2"),a=function(t){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n.position=new o.Point(0,0),n.scale=new o.Point(1,1),n.skew=new o.ObservablePoint(n.updateSkew,n,0,0),n.pivot=new o.Point(0,0),n._rotation=0,n._cx=1,n._sx=0,n._cy=0,n._sy=1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x)},e.prototype.updateLocalTransform=function(){var t=this.localTransform;t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d)},e.prototype.updateTransform=function(t){var e=this.localTransform;e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d);var n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._worldID++},e.prototype.setFromMatrix=function(t){t.decompose(this)},i(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()}}]),e}(((r=n("mAOr"))&&r.__esModule?r:{default:r}).default);e.default=a},W2nU:function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,u=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&p())}function p(){if(!l){var t=s(d);l=!0;for(var e=u.length;e;){for(c=u,u=[];++h<e;)c&&c[h].run();h=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new f(t,e)),1!==u.length||l||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},WT6e:function(t,e,n){"use strict";(function(t){n.d(e,"g",function(){return $t}),n.d(e,"O",function(){return Xt}),n.d(e,"R",function(){return qt}),n.d(e,"N",function(){return Zt}),n.d(e,"v",function(){return Yt}),n.d(e,"c",function(){return ot}),n.d(e,"z",function(){return ct}),n.d(e,"y",function(){return ut}),n.d(e,"b",function(){return lt}),n.d(e,"d",function(){return rt}),n.d(e,"e",function(){return it}),n.d(e,"Q",function(){return ye}),n.d(e,"I",function(){return kt}),n.d(e,"T",function(){return Bt}),n.d(e,"r",function(){return ze}),n.d(e,"f",function(){return We}),n.d(e,"l",function(){return Ot}),n.d(e,"k",function(){return tt}),n.d(e,"C",function(){return qe}),n.d(e,"D",function(){return Xe}),n.d(e,"a",function(){return d}),n.d(e,"L",function(){return p}),n.d(e,"J",function(){return f}),n.d(e,"P",function(){return P}),n.d(e,"o",function(){return R}),n.d(e,"n",function(){return u}),n.d(e,"m",function(){return v}),n.d(e,"x",function(){return g}),n.d(e,"E",function(){return b}),n.d(e,"w",function(){return Nt}),n.d(e,"A",function(){return ee}),n.d(e,"B",function(){return ne}),n.d(e,"i",function(){return pt}),n.d(e,"j",function(){return wt}),n.d(e,"s",function(){return Mt}),n.d(e,"u",function(){return Tt}),n.d(e,"t",function(){return ie}),n.d(e,"F",function(){return ce}),n.d(e,"G",function(){return ae}),n.d(e,"H",function(){return le}),n.d(e,"K",function(){return he}),n.d(e,"h",function(){return de}),n.d(e,"p",function(){return De}),n.d(e,"q",function(){return Fe}),n.d(e,"M",function(){return we}),n.d(e,"S",function(){return Be}),n.d(e,"_5",function(){return Se}),n.d(e,"V",function(){return ht}),n.d(e,"U",function(){return _t}),n.d(e,"_2",function(){return _}),n.d(e,"_8",function(){return E}),n.d(e,"_16",function(){return C}),n.d(e,"_6",function(){return nt}),n.d(e,"_7",function(){return et}),n.d(e,"W",function(){return Bn}),n.d(e,"X",function(){return or}),n.d(e,"Y",function(){return ro}),n.d(e,"Z",function(){return hn}),n.d(e,"_0",function(){return Cr}),n.d(e,"_1",function(){return zn}),n.d(e,"_4",function(){return kn}),n.d(e,"_9",function(){return Jn}),n.d(e,"_10",function(){return Zn}),n.d(e,"_12",function(){return vr}),n.d(e,"_15",function(){return Vr}),n.d(e,"_17",function(){return Yr}),n.d(e,"_18",function(){return Qr}),n.d(e,"_11",function(){return Ve}),n.d(e,"_13",function(){return Ge}),n.d(e,"_14",function(){return He}),n.d(e,"_3",function(){return at});var r=n("TToO"),i=n("YaPU"),o=n("/nXB"),a=n("Rf9G"),s=n("g5jc"),c=n("VwZZ"),u=function(){function t(t){this._desc=t,this.ngMetadataName="InjectionToken"}return t.prototype.toString=function(){return"InjectionToken "+this._desc},t}(),l="__paramaters__";function h(t,e,n){var r=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var r=t.apply(void 0,e);for(var i in r)this[i]=r[i]}}}(e);function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this instanceof i)return r.apply(this,t),this;var n,o=new((n=i).bind.apply(n,[void 0].concat(t)));return a.annotation=o,a;function a(t,e,n){for(var r=t.hasOwnProperty(l)?t[l]:Object.defineProperty(t,l,{value:[]})[l];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(o),t}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}var d=new u("AnalyzeForEntryComponents"),p=function(){var t={Emulated:0,Native:1,None:2};return t[t.Emulated]="Emulated",t[t.Native]="Native",t[t.None]="None",t}(),f=function(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")},m=new f("5.2.9"),v=h("Inject",function(t){return{token:t}}),g=h("Optional"),y=h("Self"),b=h("SkipSelf"),x="undefined"!=typeof window&&window,w="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,_=x||"undefined"!=typeof t&&t||w,S=Promise.resolve(0),T=null;function M(){if(!T){var t=_.Symbol;if(t&&t.iterator)T=t.iterator;else for(var e=Object.getOwnPropertyNames(Map.prototype),n=0;n<e.length;++n){var r=e[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(T=r)}}return T}function A(t){"undefined"==typeof Zone?S.then(function(){t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}function E(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function C(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(C).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var e=t.toString();if(null==e)return""+e;var n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function P(t){return t.__forward_ref__=P,t.toString=function(){return C(this())},t}function O(t){return"function"==typeof t&&t.hasOwnProperty("__forward_ref__")&&t.__forward_ref__===P?t():t}var N="__source",L=new Object,I=function(){function t(){}return t.prototype.get=function(t,e){if(void 0===e&&(e=L),e===L)throw new Error("NullInjectorError: No provider for "+C(t)+"!");return e},t}(),R=function(){function t(){}return t.create=function(t,e){return Array.isArray(t)?new H(t,e):new H(t.providers,t.parent,t.name||null)},t.THROW_IF_NOT_FOUND=L,t.NULL=new I,t}(),D=function(t){return t},F=[],U=D,k=function(){return Array.prototype.slice.call(arguments)},j={},B=function(t){for(var e in t)if(t[e]===j)return e;throw Error("!prop")}({provide:String,useValue:j}),z=R.NULL,V=/\n/gm,G="\u0275",H=function(){function t(t,e,n){void 0===e&&(e=z),void 0===n&&(n=null),this.parent=e,this.source=n;var r=this._records=new Map;r.set(R,{token:R,fn:D,deps:F,value:this,useNew:!1}),function t(e,n){if(n)if((n=O(n))instanceof Array)for(var r=0;r<n.length;r++)t(e,n[r]);else{if("function"==typeof n)throw q("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw q("Unexpected provider",n);var i=O(n.provide),o=function(t){var e=function(t){var e=F,n=t.deps;if(n&&n.length){e=[];for(var r=0;r<n.length;r++){var i=6;if((c=O(n[r]))instanceof Array)for(var o=0,a=c;o<a.length;o++){var s=a[o];s instanceof g||s==g?i|=1:s instanceof b||s==b?i&=-3:s instanceof y||s==y?i&=-5:c=s instanceof v?s.token:O(s)}e.push({token:c,options:i})}}else if(t.useExisting){var c;e=[{token:c=O(t.useExisting),options:6}]}else if(!(n||B in t))throw q("'deps' required",t);return e}(t),n=D,r=F,i=!1,o=O(t.provide);if(B in t)r=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)i=!0,n=O(t.useClass);else{if("function"!=typeof o)throw q("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);i=!0,n=o}return{deps:e,fn:n,useNew:i,value:r}}(n);if(!0===n.multi){var a=e.get(i);if(a){if(a.fn!==k)throw W(i)}else e.set(i,a={token:n.provide,deps:[],useNew:!1,fn:k,value:F});a.deps.push({token:i=n,options:6})}var s=e.get(i);if(s&&s.fn==k)throw W(i);e.set(i,o)}}(r,t)}return t.prototype.get=function(t,e){var n=this._records.get(t);try{return function t(e,n,r,i,o){try{return function(e,n,r,i,o){var a,s;if(n){if((a=n.value)==U)throw Error(G+"Circular dependency");if(a===F){n.value=U;var c=n.useNew,u=n.fn,l=n.deps,h=F;if(l.length){h=[];for(var d=0;d<l.length;d++){var p=l[d],f=p.options,m=2&f?r.get(p.token):void 0;h.push(t(p.token,m,r,m||4&f?i:z,1&f?null:R.THROW_IF_NOT_FOUND))}}n.value=a=c?new((s=u).bind.apply(s,[void 0].concat(h))):u.apply(void 0,h)}}else a=i.get(e,o);return a}(e,n,r,i,o)}catch(t){throw t instanceof Error||(t=new Error(t)),(t.ngTempTokenPath=t.ngTempTokenPath||[]).unshift(e),n&&n.value==U&&(n.value=F),t}}(t,n,this._records,this.parent,e)}catch(e){var r=e.ngTempTokenPath;throw t[N]&&r.unshift(t[N]),e.message=X("\n"+e.message,r,this.source),e.ngTokenPath=r,e.ngTempTokenPath=null,e}},t.prototype.toString=function(){var t=[];return this._records.forEach(function(e,n){return t.push(C(n))}),"StaticInjector["+t.join(", ")+"]"},t}();function W(t){return q("Cannot mix multi providers and regular providers",t)}function X(t,e,n){void 0===n&&(n=null),t=t&&"\n"===t.charAt(0)&&t.charAt(1)==G?t.substr(2):t;var r=C(e);if(e instanceof Array)r=e.map(C).join(" -> ");else if("object"==typeof e){var i=[];for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];i.push(o+":"+("string"==typeof a?JSON.stringify(a):C(a)))}r="{"+i.join(", ")+"}"}return"StaticInjectorError"+(n?"("+n+")":"")+"["+r+"]: "+t.replace(V,"\n  ")}function q(t,e){return new Error(X(t,e))}var Y="ngDebugContext",Z="ngOriginalError",J="ngErrorLogger";function Q(t){return t[Y]}function K(t){return t[Z]}function $(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.error.apply(t,e)}var tt=function(){function t(){this._console=console}return t.prototype.handleError=function(t){var e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t[J]||$}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)},t.prototype._findContext=function(t){return t?Q(t)?Q(t):this._findContext(K(t)):null},t.prototype._findOriginalError=function(t){for(var e=K(t);e&&K(e);)e=K(e);return e},t}();function et(t){return!!t&&"function"==typeof t.then}function nt(t){return!!t&&"function"==typeof t.subscribe}Function;var rt=new u("Application Initializer"),it=function(){function t(t){var e=this;this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return t.prototype.runInitializers=function(){var t=this;if(!this.initialized){var e=[],n=function(){t.done=!0,t.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var i=this.appInits[r]();et(i)&&e.push(i)}Promise.all(e).then(function(){n()}).catch(function(e){t.reject(e)}),0===e.length&&n(),this.initialized=!0}},t}(),ot=new u("AppId");function at(){return""+st()+st()+st()}function st(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var ct=new u("Platform Initializer"),ut=new u("Platform ID"),lt=new u("appBootstrapListener"),ht=function(){function t(){}return t.prototype.log=function(t){console.log(t)},t.prototype.warn=function(t){console.warn(t)},t.ctorParameters=function(){return[]},t}();function dt(){throw new Error("Runtime compiler is not loaded")}var pt=function(){function t(){}return t.prototype.compileModuleSync=function(t){throw dt()},t.prototype.compileModuleAsync=function(t){throw dt()},t.prototype.compileModuleAndAllComponentsSync=function(t){throw dt()},t.prototype.compileModuleAndAllComponentsAsync=function(t){throw dt()},t.prototype.clearCache=function(){},t.prototype.clearCacheFor=function(t){},t}(),ft=function(){},mt=function(){};function vt(t){var e=Error("No component factory found for "+C(t)+". Did you add it to @NgModule.entryComponents?");return e[bt]=t,e}var gt,yt,bt="ngComponent",xt=function(){function t(){}return t.prototype.resolveComponentFactory=function(t){throw vt(t)},t}(),wt=function(){function t(){}return t.NULL=new xt,t}(),_t=function(){function t(t,e,n){this._parent=e,this._ngModule=n,this._factories=new Map;for(var r=0;r<t.length;r++){var i=t[r];this._factories.set(i.componentType,i)}}return t.prototype.resolveComponentFactory=function(t){var e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw vt(t);return new St(e,this._ngModule)},t}(),St=function(t){function e(e,n){var r=t.call(this)||this;return r.factory=e,r.ngModule=n,r.selector=e.selector,r.componentType=e.componentType,r.ngContentSelectors=e.ngContentSelectors,r.inputs=e.inputs,r.outputs=e.outputs,r}return Object(r.c)(e,t),e.prototype.create=function(t,e,n,r){return this.factory.create(t,e,n,r||this.ngModule)},e}(mt),Tt=function(){},Mt=function(){},At=function(){var t=_.wtf;return!(!t||!(gt=t.trace)||(yt=gt.events,0))}();function Et(t,e){return null}var Ct=At?function(t,e){return void 0===e&&(e=null),yt.createScope(t,e)}:function(t,e){return Et},Pt=At?function(t,e){return gt.leaveScope(t,e),e}:function(t,e){return e},Ot=function(t){function e(e){void 0===e&&(e=!1);var n=t.call(this)||this;return n.__isAsync=e,n}return Object(r.c)(e,t),e.prototype.emit=function(e){t.prototype.next.call(this,e)},e.prototype.subscribe=function(e,n,r){var i,o=function(t){return null},a=function(){return null};e&&"object"==typeof e?(i=this.__isAsync?function(t){setTimeout(function(){return e.next(t)})}:function(t){e.next(t)},e.error&&(o=this.__isAsync?function(t){setTimeout(function(){return e.error(t)})}:function(t){e.error(t)}),e.complete&&(a=this.__isAsync?function(){setTimeout(function(){return e.complete()})}:function(){e.complete()})):(i=this.__isAsync?function(t){setTimeout(function(){return e(t)})}:function(t){e(t)},n&&(o=this.__isAsync?function(t){setTimeout(function(){return n(t)})}:function(t){n(t)}),r&&(a=this.__isAsync?function(){setTimeout(function(){return r()})}:function(){r()}));var s=t.prototype.subscribe.call(this,i,o,a);return e instanceof c.a&&e.add(s),s},e}(s.b),Nt=function(){function t(t){var e,n=t.enableLongStackTrace,r=void 0!==n&&n;if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ot(!1),this.onMicrotaskEmpty=new Ot(!1),this.onStable=new Ot(!1),this.onError=new Ot(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(e=this)._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(t,n,r,i,o,a){try{return Dt(e),t.invokeTask(r,i,o,a)}finally{Ft(e)}},onInvoke:function(t,n,r,i,o,a,s){try{return Dt(e),t.invoke(r,i,o,a,s)}finally{Ft(e)}},onHasTask:function(t,n,r,i){t.hasTask(r,i),n===r&&("microTask"==i.change?(e.hasPendingMicrotasks=i.microTask,Rt(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:function(t,n,r,i){return t.handleError(r,i),e.runOutsideAngular(function(){return e.onError.emit(i)}),!1}})}return t.isInAngularZone=function(){return!0===Zone.current.get("isAngularZone")},t.assertInAngularZone=function(){if(!t.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")},t.assertNotInAngularZone=function(){if(t.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")},t.prototype.run=function(t,e,n){return this._inner.run(t,e,n)},t.prototype.runTask=function(t,e,n,r){var i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+r,t,It,Lt,Lt);try{return i.runTask(o,e,n)}finally{i.cancelTask(o)}},t.prototype.runGuarded=function(t,e,n){return this._inner.runGuarded(t,e,n)},t.prototype.runOutsideAngular=function(t){return this._outer.run(t)},t}();function Lt(){}var It={};function Rt(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(function(){return t.onStable.emit(null)})}finally{t.isStable=!0}}}function Dt(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Ft(t){t._nesting--,Rt(t)}var Ut=function(){function t(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ot,this.onMicrotaskEmpty=new Ot,this.onStable=new Ot,this.onError=new Ot}return t.prototype.run=function(t){return t()},t.prototype.runGuarded=function(t){return t()},t.prototype.runOutsideAngular=function(t){return t()},t.prototype.runTask=function(t){return t()},t}(),kt=function(){function t(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this._watchAngularEvents()}return t.prototype._watchAngularEvents=function(){var t=this;this._ngZone.onUnstable.subscribe({next:function(){t._didWork=!0,t._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){t._ngZone.onStable.subscribe({next:function(){Nt.assertNotInAngularZone(),A(function(){t._isZoneStable=!0,t._runCallbacksIfReady()})}})})},t.prototype.increasePendingRequestCount=function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount},t.prototype.decreasePendingRequestCount=function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount},t.prototype.isStable=function(){return this._isZoneStable&&0==this._pendingCount&&!this._ngZone.hasPendingMacrotasks},t.prototype._runCallbacksIfReady=function(){var t=this;this.isStable()?A(function(){for(;0!==t._callbacks.length;)t._callbacks.pop()(t._didWork);t._didWork=!1}):this._didWork=!0},t.prototype.whenStable=function(t){this._callbacks.push(t),this._runCallbacksIfReady()},t.prototype.getPendingRequestCount=function(){return this._pendingCount},t.prototype.findProviders=function(t,e,n){return[]},t}(),jt=function(){function t(){this._applications=new Map,Vt.addToWindow(this)}return t.prototype.registerApplication=function(t,e){this._applications.set(t,e)},t.prototype.unregisterApplication=function(t){this._applications.delete(t)},t.prototype.unregisterAllApplications=function(){this._applications.clear()},t.prototype.getTestability=function(t){return this._applications.get(t)||null},t.prototype.getAllTestabilities=function(){return Array.from(this._applications.values())},t.prototype.getAllRootElements=function(){return Array.from(this._applications.keys())},t.prototype.findTestabilityInTree=function(t,e){return void 0===e&&(e=!0),Vt.findTestabilityInTree(this,t,e)},t.ctorParameters=function(){return[]},t}();function Bt(t){Vt=t}var zt,Vt=new(function(){function t(){}return t.prototype.addToWindow=function(t){},t.prototype.findTestabilityInTree=function(t,e,n){return null},t}()),Gt=!0,Ht=!1,Wt=new u("AllowMultipleToken");function Xt(){if(Ht)throw new Error("Cannot enable prod mode after platform setup.");Gt=!1}function qt(){return Ht=!0,Gt}var Yt=function(t,e){this.name=t,this.token=e};function Zt(t,e,n){void 0===n&&(n=[]);var r="Platform: "+e,i=new u(r);return function(e){void 0===e&&(e=[]);var o=Jt();if(!o||o.injector.get(Wt,!1))if(t)t(n.concat(e).concat({provide:i,useValue:!0}));else{var a=n.concat(e).concat({provide:i,useValue:!0});!function(t){if(zt&&!zt.destroyed&&!zt.injector.get(Wt,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");zt=t.get(Qt);var e=t.get(ct,null);e&&e.forEach(function(t){return t()})}(R.create({providers:a,name:r}))}return function(t){var e=Jt();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function Jt(){return zt&&!zt.destroyed?zt:null}var Qt=function(){function t(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return t.prototype.bootstrapModuleFactory=function(t,e){var n,r=this,i="noop"===(n=e?e.ngZone:void 0)?new Ut:("zone.js"===n?void 0:n)||new Nt({enableLongStackTrace:qt()}),o=[{provide:Nt,useValue:i}];return i.run(function(){var e=R.create({providers:o,parent:r.injector,name:t.moduleType.name}),n=t.create(e),a=n.injector.get(tt,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy(function(){return te(r._modules,n)}),i.runOutsideAngular(function(){return i.onError.subscribe({next:function(t){a.handleError(t)}})}),function(t,e,i){try{var o=((a=n.injector.get(it)).runInitializers(),a.donePromise.then(function(){return r._moduleDoBootstrap(n),n}));return et(o)?o.catch(function(n){throw e.runOutsideAngular(function(){return t.handleError(n)}),n}):o}catch(n){throw e.runOutsideAngular(function(){return t.handleError(n)}),n}var a}(a,i)})},t.prototype.bootstrapModule=function(t,e){var n=this;void 0===e&&(e=[]);var r=this.injector.get(ft),i=Kt({},e);return r.createCompiler([i]).compileModuleAsync(t).then(function(t){return n.bootstrapModuleFactory(t,i)})},t.prototype._moduleDoBootstrap=function(t){var e=t.injector.get($t);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(function(t){return e.bootstrap(t)});else{if(!t.instance.ngDoBootstrap)throw new Error("The module "+C(t.instance.constructor)+' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.');t.instance.ngDoBootstrap(e)}this._modules.push(t)},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},Object.defineProperty(t.prototype,"injector",{get:function(){return this._injector},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(t){return t.destroy()}),this._destroyListeners.forEach(function(t){return t()}),this._destroyed=!0},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),t}();function Kt(t,e){return Array.isArray(e)?e.reduce(Kt,t):Object(r.a)({},t,e)}var $t=function(){function t(t,e,n,r,s,c){var u=this;this._zone=t,this._console=e,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=s,this._initStatus=c,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=qt(),this._zone.onMicrotaskEmpty.subscribe({next:function(){u._zone.run(function(){u.tick()})}});var l=new i.a(function(t){u._stable=u._zone.isStable&&!u._zone.hasPendingMacrotasks&&!u._zone.hasPendingMicrotasks,u._zone.runOutsideAngular(function(){t.next(u._stable),t.complete()})}),h=new i.a(function(t){var e;u._zone.runOutsideAngular(function(){e=u._zone.onStable.subscribe(function(){Nt.assertNotInAngularZone(),A(function(){u._stable||u._zone.hasPendingMacrotasks||u._zone.hasPendingMicrotasks||(u._stable=!0,t.next(!0))})})});var n=u._zone.onUnstable.subscribe(function(){Nt.assertInAngularZone(),u._stable&&(u._stable=!1,u._zone.runOutsideAngular(function(){t.next(!1)}))});return function(){e.unsubscribe(),n.unsubscribe()}});this.isStable=Object(o.a)(l,a.a.call(h))}return t.prototype.bootstrap=function(t,e){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=t instanceof mt?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);var i=n instanceof St?null:this._injector.get(Tt),o=n.create(R.NULL,[],e||n.selector,i);o.onDestroy(function(){r._unloadComponent(o)});var a=o.injector.get(kt,null);return a&&o.injector.get(jt).registerApplication(o.location.nativeElement,a),this._loadComponent(o),qt()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),o},t.prototype.tick=function(){var e=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var n=t._tickScope();try{this._runningTick=!0,this._views.forEach(function(t){return t.detectChanges()}),this._enforceNoNewChanges&&this._views.forEach(function(t){return t.checkNoChanges()})}catch(t){this._zone.runOutsideAngular(function(){return e._exceptionHandler.handleError(t)})}finally{this._runningTick=!1,Pt(n)}},t.prototype.attachView=function(t){var e=t;this._views.push(e),e.attachToAppRef(this)},t.prototype.detachView=function(t){var e=t;te(this._views,e),e.detachFromAppRef()},t.prototype._loadComponent=function(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(lt,[]).concat(this._bootstrapListeners).forEach(function(e){return e(t)})},t.prototype._unloadComponent=function(t){this.detachView(t.hostView),te(this.components,t)},t.prototype.ngOnDestroy=function(){this._views.slice().forEach(function(t){return t.destroy()})},Object.defineProperty(t.prototype,"viewCount",{get:function(){return this._views.length},enumerable:!0,configurable:!0}),t._tickScope=Ct("ApplicationRef#tick()"),t}();function te(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}var ee=function(){},ne=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}(),re=function(t){this.nativeElement=t},ie=function(){},oe=function(){function t(){this.dirty=!0,this._results=[],this.changes=new Ot,this.length=0}return t.prototype.map=function(t){return this._results.map(t)},t.prototype.filter=function(t){return this._results.filter(t)},t.prototype.find=function(t){return this._results.find(t)},t.prototype.reduce=function(t,e){return this._results.reduce(t,e)},t.prototype.forEach=function(t){this._results.forEach(t)},t.prototype.some=function(t){return this._results.some(t)},t.prototype.toArray=function(){return this._results.slice()},t.prototype[M()]=function(){return this._results[M()]()},t.prototype.toString=function(){return this._results.toString()},t.prototype.reset=function(t){this._results=function t(e){return e.reduce(function(e,n){var r=Array.isArray(n)?t(n):n;return e.concat(r)},[])}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]},t.prototype.notifyOnChanges=function(){this.changes.emit(this)},t.prototype.setDirty=function(){this.dirty=!0},t.prototype.destroy=function(){this.changes.complete(),this.changes.unsubscribe()},t}(),ae=function(){},se={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},ce=function(){function t(t,e){this._compiler=t,this._config=e||se}return t.prototype.load=function(t){return this._compiler instanceof pt?this.loadFactory(t):this.loadAndCompile(t)},t.prototype.loadAndCompile=function(t){var e=this,r=t.split("#"),i=r[0],o=r[1];return void 0===o&&(o="default"),n("Jnfr")(i).then(function(t){return t[o]}).then(function(t){return ue(t,i,o)}).then(function(t){return e._compiler.compileModuleAsync(t)})},t.prototype.loadFactory=function(t){var e=t.split("#"),r=e[0],i=e[1],o="NgFactory";return void 0===i&&(i="default",o=""),n("Jnfr")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(function(t){return t[i+o]}).then(function(t){return ue(t,r,i)})},t}();function ue(t,e,n){if(!t)throw new Error("Cannot find '"+n+"' in '"+e+"'");return t}var le=function(){},he=function(){},de=function(){},pe=function(){function t(t,e,n){this._debugContext=n,this.nativeNode=t,e&&e instanceof fe?e.addChild(this):this.parent=null,this.listeners=[]}return Object.defineProperty(t.prototype,"injector",{get:function(){return this._debugContext.injector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentInstance",{get:function(){return this._debugContext.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._debugContext.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){return this._debugContext.references},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){return this._debugContext.providerTokens},enumerable:!0,configurable:!0}),t}(),fe=function(t){function e(e,n,r){var i=t.call(this,e,n,r)||this;return i.properties={},i.attributes={},i.classes={},i.styles={},i.childNodes=[],i.nativeElement=e,i}return Object(r.c)(e,t),e.prototype.addChild=function(t){t&&(this.childNodes.push(t),t.parent=this)},e.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))},e.prototype.insertChildrenAfter=function(t,e){var n,r=this,i=this.childNodes.indexOf(t);-1!==i&&((n=this.childNodes).splice.apply(n,[i+1,0].concat(e)),e.forEach(function(t){t.parent&&t.parent.removeChild(t),t.parent=r}))},e.prototype.insertBefore=function(t,e){var n=this.childNodes.indexOf(t);-1===n?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(n,0,e))},e.prototype.query=function(t){return this.queryAll(t)[0]||null},e.prototype.queryAll=function(t){var e=[];return me(this,t,e),e},e.prototype.queryAllNodes=function(t){var e=[];return ve(this,t,e),e},Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes.filter(function(t){return t instanceof e})},enumerable:!0,configurable:!0}),e.prototype.triggerEventHandler=function(t,e){this.listeners.forEach(function(n){n.name==t&&n.callback(e)})},e}(pe);function me(t,e,n){t.childNodes.forEach(function(t){t instanceof fe&&(e(t)&&n.push(t),me(t,e,n))})}function ve(t,e,n){t instanceof fe&&t.childNodes.forEach(function(t){e(t)&&n.push(t),t instanceof fe&&ve(t,e,n)})}var ge=new Map;function ye(t){return ge.get(t)||null}function be(t){ge.set(t.nativeNode,t)}function xe(t,e){var n=Se(t),r=Se(e);return n&&r?function(t,e,n){for(var r=t[M()](),i=e[M()]();;){var o=r.next(),a=i.next();if(o.done&&a.done)return!0;if(o.done||a.done)return!1;if(!n(o.value,a.value))return!1}}(t,e,xe):!(n||!t||"object"!=typeof t&&"function"!=typeof t||r||!e||"object"!=typeof e&&"function"!=typeof e)||E(t,e)}var we=function(){function t(t){this.wrapped=t}return t.wrap=function(e){return new t(e)},t.unwrap=function(e){return t.isWrapped(e)?e.wrapped:e},t.isWrapped=function(e){return e instanceof t},t}(),_e=function(){function t(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}return t.prototype.isFirstChange=function(){return this.firstChange},t}();function Se(t){return!!Te(t)&&(Array.isArray(t)||!(t instanceof Map)&&M()in t)}function Te(t){return null!==t&&("function"==typeof t||"object"==typeof t)}var Me=function(){function t(){}return t.prototype.supports=function(t){return Se(t)},t.prototype.create=function(t){return new Ee(t)},t}(),Ae=function(t,e){return e},Ee=function(){function t(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Ae}return t.prototype.forEachItem=function(t){var e;for(e=this._itHead;null!==e;e=e._next)t(e)},t.prototype.forEachOperation=function(t){for(var e=this._itHead,n=this._removalsHead,r=0,i=null;e||n;){var o=!n||e&&e.currentIndex<Ne(n,r,i)?e:n,a=Ne(o,r,i),s=o.currentIndex;if(o===n)r--,n=n._nextRemoved;else if(e=e._next,null==o.previousIndex)r++;else{i||(i=[]);var c=a-r,u=s-r;if(c!=u){for(var l=0;l<c;l++){var h=l<i.length?i[l]:i[l]=0,d=h+l;u<=d&&d<c&&(i[l]=h+1)}i[o.previousIndex]=u-c}}a!==s&&t(o,a,s)}},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachMovedItem=function(t){var e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.forEachIdentityChange=function(t){var e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)},t.prototype.diff=function(t){if(null==t&&(t=[]),!Se(t))throw new Error("Error trying to diff '"+C(t)+"'. Only arrays and iterables are allowed");return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n,r,i,o=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(var s=0;s<this.length;s++)i=this._trackByFn(s,r=t[s]),null!==o&&E(o.trackById,i)?(a&&(o=this._verifyReinsertion(o,r,i,s)),E(o.item,r)||this._addIdentityChange(o,r)):(o=this._mismatch(o,r,i,s),a=!0),o=o._next}else n=0,function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e(t[n]);else for(var r=t[M()](),i=void 0;!(i=r.next()).done;)e(i.value)}(t,function(t){i=e._trackByFn(n,t),null!==o&&E(o.trackById,i)?(a&&(o=e._verifyReinsertion(o,t,i,n)),E(o.item,t)||e._addIdentityChange(o,t)):(o=e._mismatch(o,t,i,n),a=!0),o=o._next,n++}),this.length=n;return this._truncate(o),this.collection=t,this.isDirty},Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead},enumerable:!0,configurable:!0}),t.prototype._reset=function(){if(this.isDirty){var t=void 0,e=void 0;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}},t.prototype._mismatch=function(t,e,n,r){var i;return null===t?i=this._itTail:(i=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(E(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(E(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,r)):t=this._addAfter(new Ce(e,n),i,r),t},t.prototype._verifyReinsertion=function(t,e,n,r){var i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?t=this._reinsertAfter(i,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t},t.prototype._truncate=function(t){for(;null!==t;){var e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)},t.prototype._reinsertAfter=function(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);var r=t._prevRemoved,i=t._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._moveAfter=function(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._addAfter=function(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t},t.prototype._insertAfter=function(t,e,n){var r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Oe),this._linkedRecords.put(t),t.currentIndex=n,t},t.prototype._remove=function(t){return this._addToRemovals(this._unlink(t))},t.prototype._unlink=function(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);var e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t},t.prototype._addToMoves=function(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)},t.prototype._addToRemovals=function(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Oe),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t},t.prototype._addIdentityChange=function(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t},t}(),Ce=function(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},Pe=function(){function t(){this._head=null,this._tail=null}return t.prototype.add=function(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)},t.prototype.get=function(t,e){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&E(n.trackById,t))return n;return null},t.prototype.remove=function(t){var e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head},t}(),Oe=function(){function t(){this.map=new Map}return t.prototype.put=function(t){var e=t.trackById,n=this.map.get(e);n||(n=new Pe,this.map.set(e,n)),n.add(t)},t.prototype.get=function(t,e){var n=this.map.get(t);return n?n.get(t,e):null},t.prototype.remove=function(t){var e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.map.size},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.map.clear()},t}();function Ne(t,e,n){var r=t.previousIndex;if(null===r)return r;var i=0;return n&&r<n.length&&(i=n[r]),r+e+i}var Le=function(){function t(){}return t.prototype.supports=function(t){return t instanceof Map||Te(t)},t.prototype.create=function(){return new Ie},t}(),Ie=function(){function t(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead},enumerable:!0,configurable:!0}),t.prototype.forEachItem=function(t){var e;for(e=this._mapHead;null!==e;e=e._next)t(e)},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachChangedItem=function(t){var e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.diff=function(t){if(t){if(!(t instanceof Map||Te(t)))throw new Error("Error trying to diff '"+C(t)+"'. Only maps and objects are allowed")}else t=new Map;return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(t,function(t,r){if(n&&n.key===r)e._maybeAddToChanges(n,t),e._appendAfter=n,n=n._next;else{var i=e._getOrCreateRecordForKey(r,t);n=e._insertBeforeOrAppend(n,i)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty},t.prototype._insertBeforeOrAppend=function(t,e){if(t){var n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null},t.prototype._getOrCreateRecordForKey=function(t,e){if(this._records.has(t)){var n=this._records.get(t);this._maybeAddToChanges(n,e);var r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}var o=new Re(t);return this._records.set(t,o),o.currentValue=e,this._addToAdditions(o),o},t.prototype._reset=function(){if(this.isDirty){var t=void 0;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}},t.prototype._maybeAddToChanges=function(t,e){E(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))},t.prototype._addToAdditions=function(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)},t.prototype._addToChanges=function(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)},t.prototype._forEach=function(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(function(n){return e(t[n],n)})},t}(),Re=function(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},De=function(){function t(t){this.factories=t}return t.create=function(e,n){if(null!=n){var r=n.factories.slice();return new t(e=e.concat(r))}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,n)},deps:[[t,new b,new g]]}},t.prototype.find=function(t){var e,n=this.factories.find(function(e){return e.supports(t)});if(null!=n)return n;throw new Error("Cannot find a differ supporting object '"+t+"' of type '"+((e=t).name||typeof e)+"'")},t}(),Fe=function(){function t(t){this.factories=t}return t.create=function(e,n){if(n){var r=n.factories.slice();e=e.concat(r)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,n)},deps:[[t,new b,new g]]}},t.prototype.find=function(t){var e=this.factories.find(function(e){return e.supports(t)});if(e)return e;throw new Error("Cannot find a differ supporting object '"+t+"'")},t}(),Ue=[new Le],ke=new De([new Me]),je=new Fe(Ue),Be=Zt(null,"core",[{provide:ut,useValue:"unknown"},{provide:Qt,deps:[R]},{provide:jt,deps:[]},{provide:ht,deps:[]}]),ze=new u("LocaleId");function Ve(){return ke}function Ge(){return je}function He(t){return t||"en-US"}var We=function(t){},Xe=function(){var t={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return t[t.NONE]="NONE",t[t.HTML]="HTML",t[t.STYLE]="STYLE",t[t.SCRIPT]="SCRIPT",t[t.URL]="URL",t[t.RESOURCE_URL]="RESOURCE_URL",t}(),qe=function(){};function Ye(t,e,n){var r=t.state,i=1792&r;return i===e?(t.state=-1793&r|n,t.initIndex=-1,!0):i===n}function Ze(t,e,n){return(1792&t.state)===e&&t.initIndex<=n&&(t.initIndex=n+1,!0)}function Je(t,e){return t.nodes[e]}function Qe(t,e){return t.nodes[e]}function Ke(t,e){return t.nodes[e]}function $e(t,e){return t.nodes[e]}function tn(t,e){return t.nodes[e]}var en={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0};function nn(t,e,n,r){var i="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '"+e+"'. Current value: '"+n+"'.";return r&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){var n=new Error(t);return rn(n,e),n}(i,t)}function rn(t,e){t[Y]=e,t[J]=e.logError.bind(e)}function on(t){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+t)}var an=function(){},sn=new Map;function cn(t){var e=sn.get(t);return e||(e=C(t)+"_"+sn.size,sn.set(t,e)),e}var un="$$undefined",ln="$$empty";function hn(t){return{id:un,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}var dn=0;function pn(t,e,n,r){return!(!(2&t.state)&&E(t.oldValues[e.bindingIndex+n],r))}function fn(t,e,n,r){return!!pn(t,e,n,r)&&(t.oldValues[e.bindingIndex+n]=r,!0)}function mn(t,e,n,r){var i=t.oldValues[e.bindingIndex+n];if(1&t.state||!xe(i,r)){var o=e.bindings[n].name;throw nn(en.createDebugContext(t,e.nodeIndex),o+": "+i,o+": "+r,0!=(1&t.state))}}function vn(t){for(var e=t;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function gn(t,e){for(var n=t;n&&n!==e;)n.state|=64,n=n.viewContainerParent||n.parent}function yn(t,e,n,r){try{return vn(33554432&t.def.nodes[e].flags?Qe(t,e).componentView:t),en.handleEvent(t,e,n,r)}catch(e){t.root.errorHandler.handleError(e)}}function bn(t){return t.parent?Qe(t.parent,t.parentNodeDef.nodeIndex):null}function xn(t){return t.parent?t.parentNodeDef.parent:null}function wn(t,e){switch(201347067&e.flags){case 1:return Qe(t,e.nodeIndex).renderElement;case 2:return Je(t,e.nodeIndex).renderText}}function _n(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function Sn(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function Tn(t){return 1<<t%32}function Mn(t){var e={},n=0,r={};return t&&t.forEach(function(t){var i=t[0],o=t[1];"number"==typeof i?(e[i]=o,n|=Tn(i)):r[i]=o}),{matchedQueries:e,references:r,matchedQueryIds:n}}function An(t,e){return t.map(function(t){var n,r;return Array.isArray(t)?(r=t[0],n=t[1]):(r=0,n=t),n&&("function"==typeof n||"object"==typeof n)&&e&&Object.defineProperty(n,N,{value:e,configurable:!0}),{flags:r,token:n,tokenKey:cn(n)}})}function En(t,e,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===p.Native?Qe(t,n.renderParent.nodeIndex).renderElement:void 0:e}var Cn=new WeakMap;function Pn(t){var e=Cn.get(t);return e||((e=t(function(){return an})).factory=t,Cn.set(t,e)),e}function On(t,e,n,r,i){3===e&&(n=t.renderer.parentNode(wn(t,t.def.lastRenderRootNode))),Nn(t,e,0,t.def.nodes.length-1,n,r,i)}function Nn(t,e,n,r,i,o,a){for(var s=n;s<=r;s++){var c=t.def.nodes[s];11&c.flags&&In(t,c,e,i,o,a),s+=c.childCount}}function Ln(t,e,n,r,i,o){for(var a=t;a&&!_n(a);)a=a.parent;for(var s=a.parent,c=xn(a),u=c.nodeIndex+c.childCount,l=c.nodeIndex+1;l<=u;l++){var h=s.def.nodes[l];h.ngContentIndex===e&&In(s,h,n,r,i,o),l+=h.childCount}if(!s.parent){var d=t.root.projectableNodes[e];if(d)for(l=0;l<d.length;l++)Rn(t,d[l],n,r,i,o)}}function In(t,e,n,r,i,o){if(8&e.flags)Ln(t,e.ngContent.index,n,r,i,o);else{var a=wn(t,e);if(3===n&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&Rn(t,a,n,r,i,o),32&e.bindingFlags&&Rn(Qe(t,e.nodeIndex).componentView,a,n,r,i,o)):Rn(t,a,n,r,i,o),16777216&e.flags)for(var s=Qe(t,e.nodeIndex).viewContainer._embeddedViews,c=0;c<s.length;c++)On(s[c],n,r,i,o);1&e.flags&&!e.element.name&&Nn(t,n,e.nodeIndex+1,e.nodeIndex+e.childCount,r,i,o)}}function Rn(t,e,n,r,i,o){var a=t.renderer;switch(n){case 1:a.appendChild(r,e);break;case 2:a.insertBefore(r,e,i);break;case 3:a.removeChild(r,e);break;case 0:o.push(e)}}var Dn=/^:([^:]+):(.+)$/;function Fn(t){if(":"===t[0]){var e=t.match(Dn);return[e[1],e[2]]}return["",t]}function Un(t){for(var e=0,n=0;n<t.length;n++)e|=t[n].flags;return e}function kn(t,e,n,r,i,o,a,s,c,u,l,h,d,p,f,m,v,g,y,b){switch(t){case 1:return e+jn(n)+r;case 2:return e+jn(n)+r+jn(i)+o;case 3:return e+jn(n)+r+jn(i)+o+jn(a)+s;case 4:return e+jn(n)+r+jn(i)+o+jn(a)+s+jn(c)+u;case 5:return e+jn(n)+r+jn(i)+o+jn(a)+s+jn(c)+u+jn(l)+h;case 6:return e+jn(n)+r+jn(i)+o+jn(a)+s+jn(c)+u+jn(l)+h+jn(d)+p;case 7:return e+jn(n)+r+jn(i)+o+jn(a)+s+jn(c)+u+jn(l)+h+jn(d)+p+jn(f)+m;case 8:return e+jn(n)+r+jn(i)+o+jn(a)+s+jn(c)+u+jn(l)+h+jn(d)+p+jn(f)+m+jn(v)+g;case 9:return e+jn(n)+r+jn(i)+o+jn(a)+s+jn(c)+u+jn(l)+h+jn(d)+p+jn(f)+m+jn(v)+g+jn(y)+b;default:throw new Error("Does not support more than 9 expressions")}}function jn(t){return null!=t?t.toString():""}function Bn(t,e,n,r,i,o){t|=1;var a=Mn(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a.matchedQueries,matchedQueryIds:a.matchedQueryIds,references:a.references,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?Pn(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||an},provider:null,text:null,query:null,ngContent:null}}function zn(t,e,n,r,i,o,a,s,c,u,l,h){void 0===a&&(a=[]),u||(u=an);var d=Mn(n),f=d.matchedQueries,m=d.references,v=d.matchedQueryIds,g=null,y=null;o&&(g=(N=Fn(o))[0],y=N[1]),s=s||[];for(var b=new Array(s.length),x=0;x<s.length;x++){var w=s[x],_=w[0],S=w[2],T=Fn(w[1]),M=T[0],A=T[1],E=void 0,C=void 0;switch(15&_){case 4:C=S;break;case 1:case 8:E=S}b[x]={flags:_,ns:M,name:A,nonMinifiedName:A,securityContext:E,suffix:C}}c=c||[];var P=new Array(c.length);for(x=0;x<c.length;x++){var O=c[x];P[x]={type:0,target:O[0],eventName:O[1],propName:null}}var N,L=(a=a||[]).map(function(t){var e=t[1],n=Fn(t[0]);return[n[0],n[1],e]});return h=function(t){if(t&&t.id===un){var e=null!=t.encapsulation&&t.encapsulation!==p.None||t.styles.length||Object.keys(t.data).length;t.id=e?"c"+dn++:ln}return t&&t.id===ln&&(t=null),t||null}(h),l&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:f,matchedQueryIds:v,references:m,ngContentIndex:r,childCount:i,bindings:b,bindingFlags:Un(b),outputs:P,element:{ns:g,name:y,attrs:L,template:null,componentProvider:null,componentView:l||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:u||an},provider:null,text:null,query:null,ngContent:null}}function Vn(t,e,n){var r,i=n.element,o=t.root.selectorOrNode,a=t.renderer;if(t.parent||!o){r=i.name?a.createElement(i.name,i.ns):a.createComment("");var s=En(t,e,n);s&&a.appendChild(s,r)}else r=a.selectRootElement(o);if(i.attrs)for(var c=0;c<i.attrs.length;c++){var u=i.attrs[c];a.setAttribute(r,u[1],u[2],u[0])}return r}function Gn(t,e,n,r){for(var i=0;i<n.outputs.length;i++){var o=n.outputs[i],a=Hn(t,n.nodeIndex,(h=o.eventName,(l=o.target)?l+":"+h:h)),s=o.target,c=t;"component"===o.target&&(s=null,c=e);var u=c.renderer.listen(s||r,o.eventName,a);t.disposables[n.outputIndex+i]=u}var l,h}function Hn(t,e,n){return function(r){return yn(t,e,n,r)}}function Wn(t,e,n,r){if(!fn(t,e,n,r))return!1;var i=e.bindings[n],o=Qe(t,e.nodeIndex),a=o.renderElement,s=i.name;switch(15&i.flags){case 1:!function(t,e,n,r,i,o){var a=e.securityContext,s=a?t.root.sanitizer.sanitize(a,o):o;s=null!=s?s.toString():null;var c=t.renderer;null!=o?c.setAttribute(n,i,s,r):c.removeAttribute(n,i,r)}(t,i,a,i.ns,s,r);break;case 2:!function(t,e,n,r){var i=t.renderer;r?i.addClass(e,n):i.removeClass(e,n)}(t,a,s,r);break;case 4:!function(t,e,n,r,i){var o=t.root.sanitizer.sanitize(Xe.STYLE,i);if(null!=o){o=o.toString();var a=e.suffix;null!=a&&(o+=a)}else o=null;var s=t.renderer;null!=o?s.setStyle(n,r,o):s.removeStyle(n,r)}(t,i,a,s,r);break;case 8:!function(t,e,n,r,i){var o=e.securityContext,a=o?t.root.sanitizer.sanitize(o,i):i;t.renderer.setProperty(n,r,a)}(33554432&e.flags&&32&i.flags?o.componentView:t,i,a,s,r)}return!0}var Xn=new Object,qn=cn(R),Yn=cn(Tt);function Zn(t,e,n,r){return n=O(n),{index:-1,deps:An(r,C(e)),flags:t,token:e,value:n}}function Jn(t){for(var e={},n=0;n<t.length;n++){var r=t[n];r.index=n,e[cn(r.token)]=r}return{factory:null,providersByKey:e,providers:t}}function Qn(t,e,n){if(void 0===n&&(n=R.THROW_IF_NOT_FOUND),8&e.flags)return e.token;if(2&e.flags&&(n=null),1&e.flags)return t._parent.get(e.token,n);var r=e.tokenKey;switch(r){case qn:case Yn:return t}var i=t._def.providersByKey[r];if(i){var o=t._providers[i.index];return void 0===o&&(o=t._providers[i.index]=Kn(t,i)),o===Xn?void 0:o}return t._parent.get(e.token,n)}function Kn(t,e){var n;switch(201347067&e.flags){case 512:n=function(t,e,n){var r=n.length;switch(r){case 0:return new e;case 1:return new e(Qn(t,n[0]));case 2:return new e(Qn(t,n[0]),Qn(t,n[1]));case 3:return new e(Qn(t,n[0]),Qn(t,n[1]),Qn(t,n[2]));default:for(var i=new Array(r),o=0;o<r;o++)i[o]=Qn(t,n[o]);return new(e.bind.apply(e,[void 0].concat(i)))}}(t,e.value,e.deps);break;case 1024:n=function(t,e,n){var r=n.length;switch(r){case 0:return e();case 1:return e(Qn(t,n[0]));case 2:return e(Qn(t,n[0]),Qn(t,n[1]));case 3:return e(Qn(t,n[0]),Qn(t,n[1]),Qn(t,n[2]));default:for(var i=Array(r),o=0;o<r;o++)i[o]=Qn(t,n[o]);return e.apply(void 0,i)}}(t,e.value,e.deps);break;case 2048:n=Qn(t,e.deps[0]);break;case 256:n=e.value}return void 0===n?Xn:n}function $n(t,e){var n=t.viewContainer._embeddedViews;if((null==e||e>=n.length)&&(e=n.length-1),e<0)return null;var r=n[e];return r.viewContainerParent=null,rr(n,e),en.dirtyParentQueries(r),er(r),r}function tr(t,e,n){var r=e?wn(e,e.def.lastRenderRootNode):t.renderElement;On(n,2,n.renderer.parentNode(r),n.renderer.nextSibling(r),void 0)}function er(t){On(t,3,null,null,void 0)}function nr(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function rr(t,e){e>=t.length-1?t.pop():t.splice(e,1)}var ir=new Object;function or(t,e,n,r,i,o){return new ar(t,e,n,r,i,o)}var ar=function(t){function e(e,n,r,i,o,a){var s=t.call(this)||this;return s.selector=e,s.componentType=n,s._inputs=i,s._outputs=o,s.ngContentSelectors=a,s.viewDefFactory=r,s}return Object(r.c)(e,t),Object.defineProperty(e.prototype,"inputs",{get:function(){var t=[],e=this._inputs;for(var n in e)t.push({propName:n,templateName:e[n]});return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){var t=[];for(var e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t},enumerable:!0,configurable:!0}),e.prototype.create=function(t,e,n,r){if(!r)throw new Error("ngModule should be provided");var i=Pn(this.viewDefFactory),o=i.nodes[0].element.componentProvider.nodeIndex,a=en.createRootView(t,e||[],n,i,r,ir),s=Ke(a,o).instance;return n&&a.renderer.setAttribute(Qe(a,0).renderElement,"ng-version",m.full),new sr(a,new hr(a),s)},e}(mt),sr=function(t){function e(e,n,r){var i=t.call(this)||this;return i._view=e,i._viewRef=n,i._component=r,i._elDef=i._view.def.nodes[0],i.hostView=n,i.changeDetectorRef=n,i.instance=r,i}return Object(r.c)(e,t),Object.defineProperty(e.prototype,"location",{get:function(){return new re(Qe(this._view,this._elDef.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return new mr(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentType",{get:function(){return this._component.constructor},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._viewRef.destroy()},e.prototype.onDestroy=function(t){this._viewRef.onDestroy(t)},e}(function(){});function cr(t,e,n){return new ur(t,e,n)}var ur=function(){function t(t,e,n){this._view=t,this._elDef=e,this._data=n,this._embeddedViews=[]}return Object.defineProperty(t.prototype,"element",{get:function(){return new re(this._data.renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return new mr(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentInjector",{get:function(){for(var t=this._view,e=this._elDef.parent;!e&&t;)e=xn(t),t=t.parent;return t?new mr(t,e):new mr(this._view,null)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var t=this._embeddedViews.length-1;t>=0;t--){var e=$n(this._data,t);en.destroyView(e)}},t.prototype.get=function(t){var e=this._embeddedViews[t];if(e){var n=new hr(e);return n.attachToViewContainerRef(this),n}return null},Object.defineProperty(t.prototype,"length",{get:function(){return this._embeddedViews.length},enumerable:!0,configurable:!0}),t.prototype.createEmbeddedView=function(t,e,n){var r=t.createEmbeddedView(e||{});return this.insert(r,n),r},t.prototype.createComponent=function(t,e,n,r,i){var o=n||this.parentInjector;i||t instanceof St||(i=o.get(Tt));var a=t.create(o,r,void 0,i);return this.insert(a.hostView,e),a},t.prototype.insert=function(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,i,o,a=t;return i=a._view,o=(n=this._data).viewContainer._embeddedViews,null!==(r=e)&&void 0!==r||(r=o.length),i.viewContainerParent=this._view,nr(o,r,i),function(t,e){var n=bn(e);if(n&&n!==t&&!(16&e.state)){e.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(e),function(t,n){if(!(4&n.flags)){e.parent.def.nodeFlags|=4,n.flags|=4;for(var r=n.parent;r;)r.childFlags|=4,r=r.parent}}(0,e.parentNodeDef)}}(n,i),en.dirtyParentQueries(i),tr(n,r>0?o[r-1]:null,i),a.attachToViewContainerRef(this),t},t.prototype.move=function(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,i,o,a,s=this._embeddedViews.indexOf(t._view);return i=e,a=(o=(n=this._data).viewContainer._embeddedViews)[r=s],rr(o,r),null==i&&(i=o.length),nr(o,i,a),en.dirtyParentQueries(a),er(a),tr(n,i>0?o[i-1]:null,a),t},t.prototype.indexOf=function(t){return this._embeddedViews.indexOf(t._view)},t.prototype.remove=function(t){var e=$n(this._data,t);e&&en.destroyView(e)},t.prototype.detach=function(t){var e=$n(this._data,t);return e?new hr(e):null},t}();function lr(t){return new hr(t)}var hr=function(){function t(t){this._view=t,this._viewContainerRef=null,this._appRef=null}return Object.defineProperty(t.prototype,"rootNodes",{get:function(){return On(this._view,0,void 0,void 0,t=[]),t;var t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._view.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return 0!=(128&this._view.state)},enumerable:!0,configurable:!0}),t.prototype.markForCheck=function(){vn(this._view)},t.prototype.detach=function(){this._view.state&=-5},t.prototype.detectChanges=function(){var t=this._view.root.rendererFactory;t.begin&&t.begin();try{en.checkAndUpdateView(this._view)}finally{t.end&&t.end()}},t.prototype.checkNoChanges=function(){en.checkNoChangesView(this._view)},t.prototype.reattach=function(){this._view.state|=4},t.prototype.onDestroy=function(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)},t.prototype.destroy=function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),en.destroyView(this._view)},t.prototype.detachFromAppRef=function(){this._appRef=null,er(this._view),en.dirtyParentQueries(this._view)},t.prototype.attachToAppRef=function(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t},t.prototype.attachToViewContainerRef=function(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t},t}();function dr(t,e){return new pr(t,e)}var pr=function(t){function e(e,n){var r=t.call(this)||this;return r._parentView=e,r._def=n,r}return Object(r.c)(e,t),e.prototype.createEmbeddedView=function(t){return new hr(en.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))},Object.defineProperty(e.prototype,"elementRef",{get:function(){return new re(Qe(this._parentView,this._def.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),e}(le);function fr(t,e){return new mr(t,e)}var mr=function(){function t(t,e){this.view=t,this.elDef=e}return t.prototype.get=function(t,e){return void 0===e&&(e=R.THROW_IF_NOT_FOUND),en.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:cn(t)},e)},t}();function vr(t,e){var n=t.def.nodes[e];if(1&n.flags){var r=Qe(t,n.nodeIndex);return n.element.template?r.template:r.renderElement}if(2&n.flags)return Je(t,n.nodeIndex).renderText;if(20240&n.flags)return Ke(t,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index "+e)}function gr(t){return new yr(t.renderer)}var yr=function(){function t(t){this.delegate=t}return t.prototype.selectRootElement=function(t){return this.delegate.selectRootElement(t)},t.prototype.createElement=function(t,e){var n=Fn(e),r=this.delegate.createElement(n[1],n[0]);return t&&this.delegate.appendChild(t,r),r},t.prototype.createViewRoot=function(t){return t},t.prototype.createTemplateAnchor=function(t){var e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e},t.prototype.createText=function(t,e){var n=this.delegate.createText(e);return t&&this.delegate.appendChild(t,n),n},t.prototype.projectNodes=function(t,e){for(var n=0;n<e.length;n++)this.delegate.appendChild(t,e[n])},t.prototype.attachViewAfter=function(t,e){for(var n=this.delegate.parentNode(t),r=this.delegate.nextSibling(t),i=0;i<e.length;i++)this.delegate.insertBefore(n,e[i],r)},t.prototype.detachView=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}},t.prototype.destroyView=function(t,e){for(var n=0;n<e.length;n++)this.delegate.destroyNode(e[n])},t.prototype.listen=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.listenGlobal=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.setElementProperty=function(t,e,n){this.delegate.setProperty(t,e,n)},t.prototype.setElementAttribute=function(t,e,n){var r=Fn(e),i=r[0],o=r[1];null!=n?this.delegate.setAttribute(t,o,n,i):this.delegate.removeAttribute(t,o,i)},t.prototype.setBindingDebugInfo=function(t,e,n){},t.prototype.setElementClass=function(t,e,n){n?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)},t.prototype.setElementStyle=function(t,e,n){null!=n?this.delegate.setStyle(t,e,n):this.delegate.removeStyle(t,e)},t.prototype.invokeElementMethod=function(t,e,n){t[e].apply(t,n)},t.prototype.setText=function(t,e){this.delegate.setValue(t,e)},t.prototype.animate=function(){throw new Error("Renderer.animate is no longer supported!")},t}();function br(t,e,n,r){return new xr(t,e,n,r)}var xr=function(){function t(t,e,n,r){this._moduleType=t,this._parent=e,this._bootstrapComponents=n,this._def=r,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){for(var e=t._def,n=t._providers=new Array(e.providers.length),r=0;r<e.providers.length;r++){var i=e.providers[r];4096&i.flags||(n[r]=Kn(t,i))}}(this)}return t.prototype.get=function(t,e){return void 0===e&&(e=R.THROW_IF_NOT_FOUND),Qn(this,{token:t,tokenKey:cn(t),flags:0},e)},Object.defineProperty(t.prototype,"instance",{get:function(){return this.get(this._moduleType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentFactoryResolver",{get:function(){return this.get(wt)},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The ng module "+C(this.instance.constructor)+" has already been destroyed.");this._destroyed=!0,function(t,e){for(var n=t._def,r=0;r<n.providers.length;r++)if(131072&n.providers[r].flags){var i=t._providers[r];i&&i!==Xn&&i.ngOnDestroy()}}(this),this._destroyListeners.forEach(function(t){return t()})},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},t}(),wr=cn(function(){}),_r=cn(function(){}),Sr=cn(re),Tr=cn(he),Mr=cn(le),Ar=cn(de),Er=cn(R);function Cr(t,e,n,r,i,o,a,s){var c=[];if(a)for(var u in a){var l=a[u];c[l[0]]={flags:8,name:u,nonMinifiedName:l[1],ns:null,securityContext:null,suffix:null}}var h=[];if(s)for(var d in s)h.push({type:1,propName:d,target:null,eventName:s[d]});return function(t,e,n,r,i,o,a,s,c){var u=Mn(n),l=u.matchedQueries,h=u.references,d=u.matchedQueryIds;c||(c=[]),s||(s=[]),o=O(o);var p=An(a,C(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:l,matchedQueryIds:d,references:h,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:Un(s),outputs:c,element:null,provider:{token:i,value:o,deps:p},text:null,query:null,ngContent:null}}(t,e|=16384,n,r,i,i,o,c,h)}function Pr(t,e){return Ir(t,e)}function Or(t,e){for(var n=t;n.parent&&!_n(n);)n=n.parent;return Rr(n.parent,xn(n),!0,e.provider.value,e.provider.deps)}function Nr(t,e){var n=Rr(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(var r=0;r<e.outputs.length;r++){var i=e.outputs[r],o=n[i.propName].subscribe(Lr(t,e.parent.nodeIndex,i.eventName));t.disposables[e.outputIndex+r]=o.unsubscribe.bind(o)}return n}function Lr(t,e,n){return function(r){return yn(t,e,n,r)}}function Ir(t,e){var n=(8192&e.flags)>0,r=e.provider;switch(201347067&e.flags){case 512:return Rr(t,e.parent,n,r.value,r.deps);case 1024:return function(t,e,n,r,i){var o=i.length;switch(o){case 0:return r();case 1:return r(Fr(t,e,n,i[0]));case 2:return r(Fr(t,e,n,i[0]),Fr(t,e,n,i[1]));case 3:return r(Fr(t,e,n,i[0]),Fr(t,e,n,i[1]),Fr(t,e,n,i[2]));default:for(var a=Array(o),s=0;s<o;s++)a[s]=Fr(t,e,n,i[s]);return r.apply(void 0,a)}}(t,e.parent,n,r.value,r.deps);case 2048:return Fr(t,e.parent,n,r.deps[0]);case 256:return r.value}}function Rr(t,e,n,r,i){var o=i.length;switch(o){case 0:return new r;case 1:return new r(Fr(t,e,n,i[0]));case 2:return new r(Fr(t,e,n,i[0]),Fr(t,e,n,i[1]));case 3:return new r(Fr(t,e,n,i[0]),Fr(t,e,n,i[1]),Fr(t,e,n,i[2]));default:for(var a=new Array(o),s=0;s<o;s++)a[s]=Fr(t,e,n,i[s]);return new(r.bind.apply(r,[void 0].concat(a)))}}var Dr={};function Fr(t,e,n,r,i){if(void 0===i&&(i=R.THROW_IF_NOT_FOUND),8&r.flags)return r.token;var o=t;2&r.flags&&(i=null);var a=r.tokenKey;for(a===Ar&&(n=!(!e||!e.element.componentView)),e&&1&r.flags&&(n=!1,e=e.parent);t;){if(e)switch(a){case wr:return gr(Ur(t,e,n));case _r:return Ur(t,e,n).renderer;case Sr:return new re(Qe(t,e.nodeIndex).renderElement);case Tr:return Qe(t,e.nodeIndex).viewContainer;case Mr:if(e.element.template)return Qe(t,e.nodeIndex).template;break;case Ar:return lr(Ur(t,e,n));case Er:return fr(t,e);default:var s=(n?e.element.allProviders:e.element.publicProviders)[a];if(s){var c=Ke(t,s.nodeIndex);return c||(c={instance:Ir(t,s)},t.nodes[s.nodeIndex]=c),c.instance}}n=_n(t),e=xn(t),t=t.parent}var u=o.root.injector.get(r.token,Dr);return u!==Dr||i===Dr?u:o.root.ngModule.injector.get(r.token,i)}function Ur(t,e,n){var r;if(n)r=Qe(t,e.nodeIndex).componentView;else for(r=t;r.parent&&!_n(r);)r=r.parent;return r}function kr(t,e,n,r,i,o){if(32768&n.flags){var a=Qe(t,n.parent.nodeIndex).componentView;2&a.def.flags&&(a.state|=8)}if(e.instance[n.bindings[r].name]=i,524288&n.flags){o=o||{};var s=we.unwrap(t.oldValues[n.bindingIndex+r]);o[n.bindings[r].nonMinifiedName]=new _e(s,i,0!=(2&t.state))}return t.oldValues[n.bindingIndex+r]=i,o}function jr(t,e){if(t.def.nodeFlags&e)for(var n=t.def.nodes,r=0,i=0;i<n.length;i++){var o=n[i],a=o.parent;for(!a&&o.flags&e&&zr(t,i,o.flags&e,r++),0==(o.childFlags&e)&&(i+=o.childCount);a&&1&a.flags&&i===a.nodeIndex+a.childCount;)a.directChildFlags&e&&(r=Br(t,a,e,r)),a=a.parent}}function Br(t,e,n,r){for(var i=e.nodeIndex+1;i<=e.nodeIndex+e.childCount;i++){var o=t.def.nodes[i];o.flags&n&&zr(t,i,o.flags&n,r++),i+=o.childCount}return r}function zr(t,e,n,r){var i=Ke(t,e);if(i){var o=i.instance;o&&(en.setCurrentNode(t,e),1048576&n&&Ze(t,512,r)&&o.ngAfterContentInit(),2097152&n&&o.ngAfterContentChecked(),4194304&n&&Ze(t,768,r)&&o.ngAfterViewInit(),8388608&n&&o.ngAfterViewChecked(),131072&n&&o.ngOnDestroy())}}function Vr(t,e,n){var r=[];for(var i in n)r.push({propName:i,bindingType:n[i]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:Tn(e),bindings:r},ngContent:null}}function Gr(t){for(var e=t.def.nodeMatchedQueries;t.parent&&Sn(t);){var n=t.parentNodeDef;t=t.parent;for(var r=n.nodeIndex+n.childCount,i=0;i<=r;i++)67108864&(o=t.def.nodes[i]).flags&&536870912&o.flags&&(o.query.filterId&e)===o.query.filterId&&tn(t,i).setDirty(),!(1&o.flags&&i+o.childCount<n.nodeIndex)&&67108864&o.childFlags&&536870912&o.childFlags||(i+=o.childCount)}if(134217728&t.def.nodeFlags)for(i=0;i<t.def.nodes.length;i++){var o;134217728&(o=t.def.nodes[i]).flags&&536870912&o.flags&&tn(t,i).setDirty(),i+=o.childCount}}function Hr(t,e){var n=tn(t,e.nodeIndex);if(n.dirty){var r,i=void 0;if(67108864&e.flags){var o=e.parent.parent;i=Wr(t,o.nodeIndex,o.nodeIndex+o.childCount,e.query,[]),r=Ke(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(i=Wr(t,0,t.def.nodes.length-1,e.query,[]),r=t.component);n.reset(i);for(var a=e.query.bindings,s=!1,c=0;c<a.length;c++){var u=a[c],l=void 0;switch(u.bindingType){case 0:l=n.first;break;case 1:l=n,s=!0}r[u.propName]=l}s&&n.notifyOnChanges()}}function Wr(t,e,n,r,i){for(var o=e;o<=n;o++){var a=t.def.nodes[o],s=a.matchedQueries[r.id];if(null!=s&&i.push(Xr(t,a,s)),1&a.flags&&a.element.template&&(a.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var c=Qe(t,o);if((a.childMatchedQueries&r.filterId)===r.filterId&&(Wr(t,o+1,o+a.childCount,r,i),o+=a.childCount),16777216&a.flags)for(var u=c.viewContainer._embeddedViews,l=0;l<u.length;l++){var h=u[l],d=bn(h);d&&d===c&&Wr(h,0,h.def.nodes.length-1,r,i)}var p=c.template._projectedViews;if(p)for(l=0;l<p.length;l++){var f=p[l];Wr(f,0,f.def.nodes.length-1,r,i)}}(a.childMatchedQueries&r.filterId)!==r.filterId&&(o+=a.childCount)}return i}function Xr(t,e,n){if(null!=n)switch(n){case 1:return Qe(t,e.nodeIndex).renderElement;case 0:return new re(Qe(t,e.nodeIndex).renderElement);case 2:return Qe(t,e.nodeIndex).template;case 3:return Qe(t,e.nodeIndex).viewContainer;case 4:return Ke(t,e.nodeIndex).instance}}function qr(t,e,n){var r=En(t,e,n);r&&Ln(t,n.ngContent.index,1,r,null,void 0)}function Yr(t,e,n){for(var r=new Array(n.length-1),i=1;i<n.length;i++)r[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function Zr(t,e,n){var r,i=t.renderer;r=i.createText(n.text.prefix);var o=En(t,e,n);return o&&i.appendChild(o,r),{renderText:r}}function Jr(t,e){return(null!=t?t.toString():"")+e.suffix}function Qr(t,e,n,r){for(var i=0,o=0,a=0,s=0,c=0,u=null,l=null,h=!1,d=!1,p=null,f=0;f<e.length;f++){var m=e[f];if(m.nodeIndex=f,m.parent=u,m.bindingIndex=i,m.outputIndex=o,m.renderParent=l,a|=m.flags,c|=m.matchedQueryIds,m.element){var v=m.element;v.publicProviders=u?u.element.publicProviders:Object.create(null),v.allProviders=v.publicProviders,h=!1,d=!1,m.element.template&&(c|=m.element.template.nodeMatchedQueries)}if($r(u,m,e.length),i+=m.bindings.length,o+=m.outputs.length,!l&&3&m.flags&&(p=m),20224&m.flags){h||(h=!0,u.element.publicProviders=Object.create(u.element.publicProviders),u.element.allProviders=u.element.publicProviders);var g=0!=(32768&m.flags);0==(8192&m.flags)||g?u.element.publicProviders[cn(m.provider.token)]=m:(d||(d=!0,u.element.allProviders=Object.create(u.element.publicProviders)),u.element.allProviders[cn(m.provider.token)]=m),g&&(u.element.componentProvider=m)}if(u?(u.childFlags|=m.flags,u.directChildFlags|=m.flags,u.childMatchedQueries|=m.matchedQueryIds,m.element&&m.element.template&&(u.childMatchedQueries|=m.element.template.nodeMatchedQueries)):s|=m.flags,m.childCount>0)u=m,Kr(m)||(l=m);else for(;u&&f===u.nodeIndex+u.childCount;){var y=u.parent;y&&(y.childFlags|=u.childFlags,y.childMatchedQueries|=u.childMatchedQueries),l=(u=y)&&Kr(u)?u.renderParent:u}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:c,flags:t,nodes:e,updateDirectives:n||an,updateRenderer:r||an,handleEvent:function(t,n,r,i){return e[n].element.handleEvent(t,r,i)},bindingCount:i,outputCount:o,lastRenderRootNode:p}}function Kr(t){return 0!=(1&t.flags)&&null===t.element.name}function $r(t,e,n){var r=e.element&&e.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index "+e.nodeIndex+"!")}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index "+e.nodeIndex+"!");if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index "+e.nodeIndex+"!");if(134217728&e.flags&&t)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index "+e.nodeIndex+"!")}if(e.childCount){var i=t?t.nodeIndex+t.childCount:n-1;if(e.nodeIndex<=i&&e.nodeIndex+e.childCount>i)throw new Error("Illegal State: childCount of node leads outside of parent, at index "+e.nodeIndex+"!")}}function ti(t,e,n,r){var i=ri(t.root,t.renderer,t,e,n);return ii(i,t.component,r),oi(i),i}function ei(t,e,n){var r=ri(t,t.renderer,null,null,e);return ii(r,n,n),oi(r),r}function ni(t,e,n,r){var i,o=e.element.componentRendererType;return i=o?t.root.rendererFactory.createRenderer(r,o):t.root.renderer,ri(t.root,i,t,e.element.componentProvider,n)}function ri(t,e,n,r,i){var o=new Array(i.nodes.length),a=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:o,state:13,root:t,renderer:e,oldValues:new Array(i.bindingCount),disposables:a,initIndex:-1}}function ii(t,e,n){t.component=e,t.context=n}function oi(t){var e;_n(t)&&(e=Qe(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);for(var n=t.def,r=t.nodes,i=0;i<n.nodes.length;i++){var o=n.nodes[i];en.setCurrentNode(t,i);var a=void 0;switch(201347067&o.flags){case 1:var s=Vn(t,e,o),c=void 0;if(33554432&o.flags){var u=Pn(o.element.componentView);c=en.createComponentView(t,o,u,s)}Gn(t,c,o,s),a={renderElement:s,componentView:c,viewContainer:null,template:o.element.template?dr(t,o):void 0},16777216&o.flags&&(a.viewContainer=cr(t,o,a));break;case 2:a=Zr(t,e,o);break;case 512:case 1024:case 2048:case 256:(a=r[i])||4096&o.flags||(a={instance:Pr(t,o)});break;case 16:a={instance:Or(t,o)};break;case 16384:(a=r[i])||(a={instance:Nr(t,o)}),32768&o.flags&&ii(Qe(t,o.parent.nodeIndex).componentView,a.instance,a.instance);break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=new oe;break;case 8:qr(t,e,o),a=void 0}r[i]=a}fi(t,pi.CreateViewNodes),yi(t,201326592,268435456,0)}function ai(t){ui(t),en.updateDirectives(t,1),mi(t,pi.CheckNoChanges),en.updateRenderer(t,1),fi(t,pi.CheckNoChanges),t.state&=-97}function si(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,Ye(t,0,256),ui(t),en.updateDirectives(t,0),mi(t,pi.CheckAndUpdate),yi(t,67108864,536870912,0);var e=Ye(t,256,512);jr(t,2097152|(e?1048576:0)),en.updateRenderer(t,0),fi(t,pi.CheckAndUpdate),yi(t,134217728,536870912,0),jr(t,8388608|((e=Ye(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,Ye(t,768,1024)}function ci(t,e,n,r,i,o,a,s,c,u,l,h,d){return 0===n?function(t,e,n,r,i,o,a,s,c,u,l,h){switch(201347067&e.flags){case 1:return function(t,e,n,r,i,o,a,s,c,u,l,h){var d=e.bindings.length,p=!1;return d>0&&Wn(t,e,0,n)&&(p=!0),d>1&&Wn(t,e,1,r)&&(p=!0),d>2&&Wn(t,e,2,i)&&(p=!0),d>3&&Wn(t,e,3,o)&&(p=!0),d>4&&Wn(t,e,4,a)&&(p=!0),d>5&&Wn(t,e,5,s)&&(p=!0),d>6&&Wn(t,e,6,c)&&(p=!0),d>7&&Wn(t,e,7,u)&&(p=!0),d>8&&Wn(t,e,8,l)&&(p=!0),d>9&&Wn(t,e,9,h)&&(p=!0),p}(t,e,n,r,i,o,a,s,c,u,l,h);case 2:return function(t,e,n,r,i,o,a,s,c,u,l,h){var d=!1,p=e.bindings,f=p.length;if(f>0&&fn(t,e,0,n)&&(d=!0),f>1&&fn(t,e,1,r)&&(d=!0),f>2&&fn(t,e,2,i)&&(d=!0),f>3&&fn(t,e,3,o)&&(d=!0),f>4&&fn(t,e,4,a)&&(d=!0),f>5&&fn(t,e,5,s)&&(d=!0),f>6&&fn(t,e,6,c)&&(d=!0),f>7&&fn(t,e,7,u)&&(d=!0),f>8&&fn(t,e,8,l)&&(d=!0),f>9&&fn(t,e,9,h)&&(d=!0),d){var m=e.text.prefix;f>0&&(m+=Jr(n,p[0])),f>1&&(m+=Jr(r,p[1])),f>2&&(m+=Jr(i,p[2])),f>3&&(m+=Jr(o,p[3])),f>4&&(m+=Jr(a,p[4])),f>5&&(m+=Jr(s,p[5])),f>6&&(m+=Jr(c,p[6])),f>7&&(m+=Jr(u,p[7])),f>8&&(m+=Jr(l,p[8])),f>9&&(m+=Jr(h,p[9]));var v=Je(t,e.nodeIndex).renderText;t.renderer.setValue(v,m)}return d}(t,e,n,r,i,o,a,s,c,u,l,h);case 16384:return function(t,e,n,r,i,o,a,s,c,u,l,h){var d=Ke(t,e.nodeIndex),p=d.instance,f=!1,m=void 0,v=e.bindings.length;return v>0&&pn(t,e,0,n)&&(f=!0,m=kr(t,d,e,0,n,m)),v>1&&pn(t,e,1,r)&&(f=!0,m=kr(t,d,e,1,r,m)),v>2&&pn(t,e,2,i)&&(f=!0,m=kr(t,d,e,2,i,m)),v>3&&pn(t,e,3,o)&&(f=!0,m=kr(t,d,e,3,o,m)),v>4&&pn(t,e,4,a)&&(f=!0,m=kr(t,d,e,4,a,m)),v>5&&pn(t,e,5,s)&&(f=!0,m=kr(t,d,e,5,s,m)),v>6&&pn(t,e,6,c)&&(f=!0,m=kr(t,d,e,6,c,m)),v>7&&pn(t,e,7,u)&&(f=!0,m=kr(t,d,e,7,u,m)),v>8&&pn(t,e,8,l)&&(f=!0,m=kr(t,d,e,8,l,m)),v>9&&pn(t,e,9,h)&&(f=!0,m=kr(t,d,e,9,h,m)),m&&p.ngOnChanges(m),65536&e.flags&&Ze(t,256,e.nodeIndex)&&p.ngOnInit(),262144&e.flags&&p.ngDoCheck(),f}(t,e,n,r,i,o,a,s,c,u,l,h);case 32:case 64:case 128:return function(t,e,n,r,i,o,a,s,c,u,l,h){var d=e.bindings,p=!1,f=d.length;if(f>0&&fn(t,e,0,n)&&(p=!0),f>1&&fn(t,e,1,r)&&(p=!0),f>2&&fn(t,e,2,i)&&(p=!0),f>3&&fn(t,e,3,o)&&(p=!0),f>4&&fn(t,e,4,a)&&(p=!0),f>5&&fn(t,e,5,s)&&(p=!0),f>6&&fn(t,e,6,c)&&(p=!0),f>7&&fn(t,e,7,u)&&(p=!0),f>8&&fn(t,e,8,l)&&(p=!0),f>9&&fn(t,e,9,h)&&(p=!0),p){var m=$e(t,e.nodeIndex),v=void 0;switch(201347067&e.flags){case 32:v=new Array(d.length),f>0&&(v[0]=n),f>1&&(v[1]=r),f>2&&(v[2]=i),f>3&&(v[3]=o),f>4&&(v[4]=a),f>5&&(v[5]=s),f>6&&(v[6]=c),f>7&&(v[7]=u),f>8&&(v[8]=l),f>9&&(v[9]=h);break;case 64:v={},f>0&&(v[d[0].name]=n),f>1&&(v[d[1].name]=r),f>2&&(v[d[2].name]=i),f>3&&(v[d[3].name]=o),f>4&&(v[d[4].name]=a),f>5&&(v[d[5].name]=s),f>6&&(v[d[6].name]=c),f>7&&(v[d[7].name]=u),f>8&&(v[d[8].name]=l),f>9&&(v[d[9].name]=h);break;case 128:var g=n;switch(f){case 1:v=g.transform(n);break;case 2:v=g.transform(r);break;case 3:v=g.transform(r,i);break;case 4:v=g.transform(r,i,o);break;case 5:v=g.transform(r,i,o,a);break;case 6:v=g.transform(r,i,o,a,s);break;case 7:v=g.transform(r,i,o,a,s,c);break;case 8:v=g.transform(r,i,o,a,s,c,u);break;case 9:v=g.transform(r,i,o,a,s,c,u,l);break;case 10:v=g.transform(r,i,o,a,s,c,u,l,h)}}m.value=v}return p}(t,e,n,r,i,o,a,s,c,u,l,h);default:throw"unreachable"}}(t,e,r,i,o,a,s,c,u,l,h,d):function(t,e,n){switch(201347067&e.flags){case 1:return function(t,e,n){for(var r=!1,i=0;i<n.length;i++)Wn(t,e,i,n[i])&&(r=!0);return r}(t,e,n);case 2:return function(t,e,n){for(var r=e.bindings,i=!1,o=0;o<n.length;o++)fn(t,e,o,n[o])&&(i=!0);if(i){var a="";for(o=0;o<n.length;o++)a+=Jr(n[o],r[o]);a=e.text.prefix+a;var s=Je(t,e.nodeIndex).renderText;t.renderer.setValue(s,a)}return i}(t,e,n);case 16384:return function(t,e,n){for(var r=Ke(t,e.nodeIndex),i=r.instance,o=!1,a=void 0,s=0;s<n.length;s++)pn(t,e,s,n[s])&&(o=!0,a=kr(t,r,e,s,n[s],a));return a&&i.ngOnChanges(a),65536&e.flags&&Ze(t,256,e.nodeIndex)&&i.ngOnInit(),262144&e.flags&&i.ngDoCheck(),o}(t,e,n);case 32:case 64:case 128:return function(t,e,n){for(var r=e.bindings,i=!1,o=0;o<n.length;o++)fn(t,e,o,n[o])&&(i=!0);if(i){var a=$e(t,e.nodeIndex),s=void 0;switch(201347067&e.flags){case 32:s=n;break;case 64:for(s={},o=0;o<n.length;o++)s[r[o].name]=n[o];break;case 128:var c=n[0],u=n.slice(1);s=c.transform.apply(c,u)}a.value=s}return i}(t,e,n);default:throw"unreachable"}}(t,e,r)}function ui(t){var e=t.def;if(4&e.nodeFlags)for(var n=0;n<e.nodes.length;n++){var r=e.nodes[n];if(4&r.flags){var i=Qe(t,n).template._projectedViews;if(i)for(var o=0;o<i.length;o++){var a=i[o];a.state|=32,gn(a,t)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function li(t,e,n,r,i,o,a,s,c,u,l,h,d){return 0===n?function(t,e,n,r,i,o,a,s,c,u,l,h){var d=e.bindings.length;d>0&&mn(t,e,0,n),d>1&&mn(t,e,1,r),d>2&&mn(t,e,2,i),d>3&&mn(t,e,3,o),d>4&&mn(t,e,4,a),d>5&&mn(t,e,5,s),d>6&&mn(t,e,6,c),d>7&&mn(t,e,7,u),d>8&&mn(t,e,8,l),d>9&&mn(t,e,9,h)}(t,e,r,i,o,a,s,c,u,l,h,d):function(t,e,n){for(var r=0;r<n.length;r++)mn(t,e,r,n[r])}(t,e,r),!1}function hi(t,e){if(tn(t,e.nodeIndex).dirty)throw nn(en.createDebugContext(t,e.nodeIndex),"Query "+e.query.id+" not dirty","Query "+e.query.id+" dirty",0!=(1&t.state))}function di(t){if(!(128&t.state)){if(mi(t,pi.Destroy),fi(t,pi.Destroy),jr(t,131072),t.disposables)for(var e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(16&t.state){var e=bn(t);if(e){var n=e.template._projectedViews;n&&(rr(n,n.indexOf(t)),en.dirtyParentQueries(t))}}}(t),t.renderer.destroyNode&&function(t){for(var e=t.def.nodes.length,n=0;n<e;n++){var r=t.def.nodes[n];1&r.flags?t.renderer.destroyNode(Qe(t,n).renderElement):2&r.flags?t.renderer.destroyNode(Je(t,n).renderText):(67108864&r.flags||134217728&r.flags)&&tn(t,n).destroy()}}(t),_n(t)&&t.renderer.destroy(),t.state|=128}}var pi=function(){var t={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return t[t.CreateViewNodes]="CreateViewNodes",t[t.CheckNoChanges]="CheckNoChanges",t[t.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",t[t.Destroy]="Destroy",t}();function fi(t,e){var n=t.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var i=n.nodes[r];33554432&i.flags?vi(Qe(t,r).componentView,e):0==(33554432&i.childFlags)&&(r+=i.childCount)}}function mi(t,e){var n=t.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var i=n.nodes[r];if(16777216&i.flags)for(var o=Qe(t,r).viewContainer._embeddedViews,a=0;a<o.length;a++)vi(o[a],e);else 0==(16777216&i.childFlags)&&(r+=i.childCount)}}function vi(t,e){var n=t.state;switch(e){case pi.CheckNoChanges:0==(128&n)&&(12==(12&n)?ai(t):64&n&&gi(t,pi.CheckNoChangesProjectedViews));break;case pi.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?ai(t):64&n&&gi(t,e));break;case pi.CheckAndUpdate:0==(128&n)&&(12==(12&n)?si(t):64&n&&gi(t,pi.CheckAndUpdateProjectedViews));break;case pi.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?si(t):64&n&&gi(t,e));break;case pi.Destroy:di(t);break;case pi.CreateViewNodes:oi(t)}}function gi(t,e){mi(t,e),fi(t,e)}function yi(t,e,n,r){if(t.def.nodeFlags&e&&t.def.nodeFlags&n)for(var i=t.def.nodes.length,o=0;o<i;o++){var a=t.def.nodes[o];if(a.flags&e&&a.flags&n)switch(en.setCurrentNode(t,a.nodeIndex),r){case 0:Hr(t,a);break;case 1:hi(t,a)}a.childFlags&e&&a.childFlags&n||(o+=a.childCount)}}var bi=!1;function xi(t,e,n,r,i,o){return ei(_i(t,i,i.injector.get(ee),e,n),r,o)}function wi(t,e,n,r,i,o){var a=i.injector.get(ee),s=_i(t,i,new eo(a),e,n),c=Ni(r);return $i(Bi.create,ei,null,[s,c,o])}function _i(t,e,n,r,i){var o=e.injector.get(qe),a=e.injector.get(tt);return{ngModule:e,injector:t,projectableNodes:r,selectorOrNode:i,sanitizer:o,rendererFactory:n,renderer:n.createRenderer(null,null),errorHandler:a}}function Si(t,e,n,r){var i=Ni(n);return $i(Bi.create,ti,null,[t,e,i,r])}function Ti(t,e,n,r){return n=Ei.get(e.element.componentProvider.provider.token)||Ni(n),$i(Bi.create,ni,null,[t,e,n,r])}function Mi(t,e,n,r){return br(t,e,n,function(t){var e=function(t){var e=!1,n=!1;return 0===Ai.size?{hasOverrides:e,hasDeprecatedOverrides:n}:(t.providers.forEach(function(t){var r=Ai.get(t.token);3840&t.flags&&r&&(e=!0,n=n||r.deprecatedBehavior)}),{hasOverrides:e,hasDeprecatedOverrides:n})}(t),n=e.hasDeprecatedOverrides;return e.hasOverrides?(function(t){for(var e=0;e<t.providers.length;e++){var r=t.providers[e];n&&(r.flags|=4096);var i=Ai.get(r.token);i&&(r.flags=-3841&r.flags|i.flags,r.deps=An(i.deps),r.value=i.value)}}(t=t.factory(function(){return an})),t):t}(r))}var Ai=new Map,Ei=new Map;function Ci(t){Ai.set(t.token,t)}function Pi(t,e){var n=Pn(Pn(e.viewDefFactory).nodes[0].element.componentView);Ei.set(t,n)}function Oi(){Ai.clear(),Ei.clear()}function Ni(t){if(0===Ai.size)return t;var e=function(t){for(var e=[],n=null,r=0;r<t.nodes.length;r++){var i=t.nodes[r];1&i.flags&&(n=i),n&&3840&i.flags&&Ai.has(i.provider.token)&&(e.push(n.nodeIndex),n=null)}return e}(t);if(0===e.length)return t;t=t.factory(function(){return an});for(var n=0;n<e.length;n++)r(t,e[n]);return t;function r(t,e){for(var n=e+1;n<t.nodes.length;n++){var r=t.nodes[n];if(1&r.flags)return;if(3840&r.flags){var i=r.provider,o=Ai.get(i.token);o&&(r.flags=-3841&r.flags|o.flags,i.deps=An(o.deps),i.value=o.value)}}}}function Li(t,e,n,r,i,o,a,s,c,u,l,h,d){var p=t.def.nodes[e];return ci(t,p,n,r,i,o,a,s,c,u,l,h,d),224&p.flags?$e(t,e).value:void 0}function Ii(t,e,n,r,i,o,a,s,c,u,l,h,d){var p=t.def.nodes[e];return li(t,p,n,r,i,o,a,s,c,u,l,h,d),224&p.flags?$e(t,e).value:void 0}function Ri(t){return $i(Bi.detectChanges,si,null,[t])}function Di(t){return $i(Bi.checkNoChanges,ai,null,[t])}function Fi(t){return $i(Bi.destroy,di,null,[t])}var Ui,ki,ji,Bi=function(){var t={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return t[t.create]="create",t[t.detectChanges]="detectChanges",t[t.checkNoChanges]="checkNoChanges",t[t.destroy]="destroy",t[t.handleEvent]="handleEvent",t}();function zi(t,e){ki=t,ji=e}function Vi(t,e,n,r){return zi(t,e),$i(Bi.handleEvent,t.def.handleEvent,null,[t,e,n,r])}function Gi(t,e){if(128&t.state)throw on(Bi[Ui]);return zi(t,Zi(t,0)),t.def.updateDirectives(function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=t.def.nodes[n];return 0===e?Wi(t,a,r,i):Xi(t,a,r,i),16384&a.flags&&zi(t,Zi(t,n)),224&a.flags?$e(t,a.nodeIndex).value:void 0},t)}function Hi(t,e){if(128&t.state)throw on(Bi[Ui]);return zi(t,Ji(t,0)),t.def.updateRenderer(function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=t.def.nodes[n];return 0===e?Wi(t,a,r,i):Xi(t,a,r,i),3&a.flags&&zi(t,Ji(t,n)),224&a.flags?$e(t,a.nodeIndex).value:void 0},t)}function Wi(t,e,n,r){if(ci.apply(void 0,[t,e,n].concat(r))){var i=1===n?r[0]:r;if(16384&e.flags){for(var o={},a=0;a<e.bindings.length;a++){var s=e.bindings[a],c=i[a];8&s.flags&&(o[(d=s.nonMinifiedName,"ng-reflect-"+(d=d.replace(/[$@]/g,"_").replace(qi,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"-"+t[1].toLowerCase()})))]=Yi(c))}var u=e.parent,l=Qe(t,u.nodeIndex).renderElement;if(u.element.name)for(var h in o)null!=(c=o[h])?t.renderer.setAttribute(l,h,c):t.renderer.removeAttribute(l,h);else t.renderer.setValue(l,"bindings="+JSON.stringify(o,null,2))}}var d}function Xi(t,e,n,r){li.apply(void 0,[t,e,n].concat(r))}var qi=/([A-Z])/g;function Yi(t){try{return null!=t?t.toString().slice(0,30):t}catch(t){return"[ERROR] Exception while trying to serialize the value"}}function Zi(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function Ji(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var Qi=function(){function t(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];for(var n=this.nodeDef,r=t;n&&0==(1&n.flags);)n=n.parent;if(!n)for(;!n&&r;)n=xn(r),r=r.parent;this.elDef=n,this.elView=r}return Object.defineProperty(t.prototype,"elOrCompView",{get:function(){return Qe(this.elView,this.elDef.nodeIndex).componentView||this.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return fr(this.elView,this.elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.elOrCompView.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.elOrCompView.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){var t=[];if(this.elDef)for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&t.push(n.provider.token),e+=n.childCount}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){var t={};if(this.elDef){Ki(this.elView,this.elDef,t);for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&Ki(this.elView,n,t),e+=n.childCount}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentRenderElement",{get:function(){var t=function(t){for(;t&&!_n(t);)t=t.parent;return t.parent?Qe(t.parent,xn(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderNode",{get:function(){return 2&this.nodeDef.flags?wn(this.view,this.nodeDef):wn(this.elView,this.elDef)},enumerable:!0,configurable:!0}),t.prototype.logError=function(t){for(var e,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];2&this.nodeDef.flags?(e=this.view.def,n=this.nodeDef.nodeIndex):(e=this.elView.def,n=this.elDef.nodeIndex);var o=function(t,e){for(var n=-1,r=0;r<=e;r++)3&t.nodes[r].flags&&n++;return n}(e,n),a=-1;e.factory(function(){return++a===o?(e=t.error).bind.apply(e,[t].concat(r)):an;var e}),a<o&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error.apply(t,r))},t}();function Ki(t,e,n){for(var r in e.references)n[r]=Xr(t,e,e.references[r])}function $i(t,e,n,r){var i=Ui,o=ki,a=ji;try{Ui=t;var s=e.apply(n,r);return ki=o,ji=a,Ui=i,s}catch(t){if(Q(t)||!ki)throw t;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),rn(t,e),t}(t,to())}}function to(){return ki?new Qi(ki,ji):null}var eo=function(){function t(t){this.delegate=t}return t.prototype.createRenderer=function(t,e){return new no(this.delegate.createRenderer(t,e))},t.prototype.begin=function(){this.delegate.begin&&this.delegate.begin()},t.prototype.end=function(){this.delegate.end&&this.delegate.end()},t.prototype.whenRenderingDone=function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)},t}(),no=function(){function t(t){this.delegate=t,this.data=this.delegate.data}return t.prototype.destroyNode=function(t){!function(t){ge.delete(t.nativeNode)}(ye(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)},t.prototype.destroy=function(){this.delegate.destroy()},t.prototype.createElement=function(t,e){var n=this.delegate.createElement(t,e),r=to();if(r){var i=new fe(n,null,r);i.name=t,be(i)}return n},t.prototype.createComment=function(t){var e=this.delegate.createComment(t),n=to();return n&&be(new pe(e,null,n)),e},t.prototype.createText=function(t){var e=this.delegate.createText(t),n=to();return n&&be(new pe(e,null,n)),e},t.prototype.appendChild=function(t,e){var n=ye(t),r=ye(e);n&&r&&n instanceof fe&&n.addChild(r),this.delegate.appendChild(t,e)},t.prototype.insertBefore=function(t,e,n){var r=ye(t),i=ye(e),o=ye(n);r&&i&&r instanceof fe&&r.insertBefore(o,i),this.delegate.insertBefore(t,e,n)},t.prototype.removeChild=function(t,e){var n=ye(t),r=ye(e);n&&r&&n instanceof fe&&n.removeChild(r),this.delegate.removeChild(t,e)},t.prototype.selectRootElement=function(t){var e=this.delegate.selectRootElement(t),n=to();return n&&be(new fe(e,null,n)),e},t.prototype.setAttribute=function(t,e,n,r){var i=ye(t);i&&i instanceof fe&&(i.attributes[r?r+":"+e:e]=n),this.delegate.setAttribute(t,e,n,r)},t.prototype.removeAttribute=function(t,e,n){var r=ye(t);r&&r instanceof fe&&(r.attributes[n?n+":"+e:e]=null),this.delegate.removeAttribute(t,e,n)},t.prototype.addClass=function(t,e){var n=ye(t);n&&n instanceof fe&&(n.classes[e]=!0),this.delegate.addClass(t,e)},t.prototype.removeClass=function(t,e){var n=ye(t);n&&n instanceof fe&&(n.classes[e]=!1),this.delegate.removeClass(t,e)},t.prototype.setStyle=function(t,e,n,r){var i=ye(t);i&&i instanceof fe&&(i.styles[e]=n),this.delegate.setStyle(t,e,n,r)},t.prototype.removeStyle=function(t,e,n){var r=ye(t);r&&r instanceof fe&&(r.styles[e]=null),this.delegate.removeStyle(t,e,n)},t.prototype.setProperty=function(t,e,n){var r=ye(t);r&&r instanceof fe&&(r.properties[e]=n),this.delegate.setProperty(t,e,n)},t.prototype.listen=function(t,e,n){if("string"!=typeof t){var r=ye(t);r&&r.listeners.push(new function(t,e){this.name=t,this.callback=e}(e,n))}return this.delegate.listen(t,e,n)},t.prototype.parentNode=function(t){return this.delegate.parentNode(t)},t.prototype.nextSibling=function(t){return this.delegate.nextSibling(t)},t.prototype.setValue=function(t,e){return this.delegate.setValue(t,e)},t}();function ro(t,e,n){return new oo(t,e,n)}var io,oo=function(t){function e(e,n,r){var i=t.call(this)||this;return i.moduleType=e,i._bootstrapComponents=n,i._ngModuleDefFactory=r,i}return Object(r.c)(e,t),e.prototype.create=function(t){!function(){if(!bi){bi=!0;var t=qt()?{setCurrentNode:zi,createRootView:wi,createEmbeddedView:Si,createComponentView:Ti,createNgModuleRef:Mi,overrideProvider:Ci,overrideComponentView:Pi,clearOverrides:Oi,checkAndUpdateView:Ri,checkNoChangesView:Di,destroyView:Fi,createDebugContext:function(t,e){return new Qi(t,e)},handleEvent:Vi,updateDirectives:Gi,updateRenderer:Hi}:{setCurrentNode:function(){},createRootView:xi,createEmbeddedView:ti,createComponentView:ni,createNgModuleRef:br,overrideProvider:an,overrideComponentView:an,clearOverrides:an,checkAndUpdateView:si,checkNoChangesView:ai,destroyView:di,createDebugContext:function(t,e){return new Qi(t,e)},handleEvent:function(t,e,n,r){return t.def.handleEvent(t,e,n,r)},updateDirectives:function(t,e){return t.def.updateDirectives(0===e?Li:Ii,t)},updateRenderer:function(t,e){return t.def.updateRenderer(0===e?Li:Ii,t)}};en.setCurrentNode=t.setCurrentNode,en.createRootView=t.createRootView,en.createEmbeddedView=t.createEmbeddedView,en.createComponentView=t.createComponentView,en.createNgModuleRef=t.createNgModuleRef,en.overrideProvider=t.overrideProvider,en.overrideComponentView=t.overrideComponentView,en.clearOverrides=t.clearOverrides,en.checkAndUpdateView=t.checkAndUpdateView,en.checkNoChangesView=t.checkNoChangesView,en.destroyView=t.destroyView,en.resolveDep=Fr,en.createDebugContext=t.createDebugContext,en.handleEvent=t.handleEvent,en.updateDirectives=t.updateDirectives,en.updateRenderer=t.updateRenderer,en.dirtyParentQueries=Gr}}();var e=Pn(this._ngModuleDefFactory);return en.createNgModuleRef(this.moduleType,t||R.NULL,this._bootstrapComponents,e)},e}(Mt);"undefined"==typeof ngDevMode&&("undefined"!=typeof window&&(window.ngDevMode=!0),"undefined"!=typeof self&&(self.ngDevMode=!0),"undefined"!=typeof t&&(t.ngDevMode=!0)),io=function(t,e,n){return{parent:io,id:null,node:null,data:[],ngStaticData:[],cleanup:null,renderer:null,child:null,tail:null,next:null,bindingStartIndex:null,creationMode:!0,viewHookStartIndex:null}}()}).call(e,n("DuR2"))},Wi38:function(t,e,n){"use strict";var r,i=(r=n("BEQ0"))&&r.__esModule?r:{default:r};Object.assign||(Object.assign=i.default)},Wj7o:function(t,e){t.exports=function(t,e){for(var n=t[0],r=t[1],i=!1,o=0,a=e.length-1;o<e.length;a=o++){var s=e[o][0],c=e[o][1],u=e[a][1];c>r!=u>r&&n<(e[a][0]-s)*(r-c)/(u-c)+s&&(i=!i)}return i}},XjEo:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=s(n("e3qs")),a=s(n("qLff"));function s(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(n,r,s,c){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return u.blurXFilter=new o.default(n,r,s,c),u.blurYFilter=new a.default(n,r,s,c),u.padding=0,u.resolution=s||i.settings.RESOLUTION,u.quality=r||4,u.blur=n||8,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,n){var r=t.getRenderTarget(!0);this.blurXFilter.apply(t,e,r,!0),this.blurYFilter.apply(t,r,n,!1),t.returnRenderTarget(r)},r(e,[{key:"blur",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"quality",get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blendMode",get:function(){return this.blurYFilter._blendMode},set:function(t){this.blurYFilter._blendMode=t}}]),e}(i.Filter);e.default=c},XkNl:function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),i=a(n("8QNu")),o=a(n("kpDK"));function a(t){return t&&t.__esModule?t:{default:t}}n("o/zv");var s=r.Matrix.IDENTITY,c=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.shader=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){this.shader=new r.Shader(this.renderer.gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")},e.prototype.render=function(t){var e=this.renderer,n=e.gl,a=t._texture;if(a.valid){var c=t._glDatas[e.CONTEXT_UID];c||(e.bindVao(null),(c={shader:this.shader,vertexBuffer:i.default.GLBuffer.createVertexBuffer(n,t.vertices,n.STREAM_DRAW),uvBuffer:i.default.GLBuffer.createVertexBuffer(n,t.uvs,n.STREAM_DRAW),indexBuffer:i.default.GLBuffer.createIndexBuffer(n,t.indices,n.STATIC_DRAW),vao:null,dirty:t.dirty,indexDirty:t.indexDirty}).vao=new i.default.VertexArrayObject(n).addIndex(c.indexBuffer).addAttribute(c.vertexBuffer,c.shader.attributes.aVertexPosition,n.FLOAT,!1,8,0).addAttribute(c.uvBuffer,c.shader.attributes.aTextureCoord,n.FLOAT,!1,8,0),t._glDatas[e.CONTEXT_UID]=c),e.bindVao(c.vao),t.dirty!==c.dirty&&(c.dirty=t.dirty,c.uvBuffer.upload(t.uvs)),t.indexDirty!==c.indexDirty&&(c.indexDirty=t.indexDirty,c.indexBuffer.upload(t.indices)),c.vertexBuffer.upload(t.vertices),e.bindShader(c.shader),c.shader.uniforms.uSampler=e.bindTexture(a),e.state.setBlendMode(r.utils.correctBlendMode(t.blendMode,a.baseTexture.premultipliedAlpha)),c.shader.uniforms.uTransform&&(c.shader.uniforms.uTransform=t.uploadUvTransform?t._uvTransform.mapCoord.toArray(!0):s.toArray(!0)),c.shader.uniforms.translationMatrix=t.worldTransform.toArray(!0),c.shader.uniforms.uColor=r.utils.premultiplyRgba(t.tintRgb,t.worldAlpha,c.shader.uniforms.uColor,a.baseTexture.premultipliedAlpha),c.vao.draw(t.drawMode===o.default.DRAW_MODES.TRIANGLE_MESH?n.TRIANGLE_STRIP:n.TRIANGLES,t.indices.length,0)}},e}(r.ObjectRenderer);e.default=c,r.WebGLRenderer.registerPlugin("mesh",c)},Xqxu:function(t,e,n){(function(e){var r=n("Y+et"),i=n("pnVU"),o=n("Fy0/")("engine.io-client:socket"),a=n("Csua"),s=n("ElvI"),c=n("fOB9"),u=n("gVZZ");function l(t,n){if(!(this instanceof l))return new l(t,n);n=n||{},t&&"object"==typeof t&&(n=t,t=null),t?(t=c(t),n.hostname=t.host,n.secure="https"===t.protocol||"wss"===t.protocol,n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=c(n.host).host),this.secure=null!=n.secure?n.secure:e.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(e.location?location.hostname:"localhost"),this.port=n.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.transportOptions=n.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized,this.forceNode=!!n.forceNode;var r="object"==typeof e&&e;r.global===r&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=l,l.priorWebsocketSuccess=!1,i(l.prototype),l.protocol=s.protocol,l.Socket=l,l.Transport=n("ZOjo"),l.transports=n("Y+et"),l.parser=n("ElvI"),l.prototype.createTransport=function(t){o('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=s.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new r[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},l.prototype.open=function(){var t;if(this.rememberUpgrade&&l.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},l.prototype.setTransport=function(t){o("setting transport %s",t.name);var e=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},l.prototype.probe=function(t){o('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=!1,r=this;function i(){r.onlyBinaryUpgrades&&(n=n||!this.supportsBinary&&r.transport.supportsBinary),n||(o('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',t),r.upgrading=!0,r.emit("upgrading",e),!e)return;l.priorWebsocketSuccess="websocket"===e.name,o('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(o("changing transport and sending upgrade packet"),d(),r.setTransport(e),e.send([{type:"upgrade"}]),r.emit("upgrade",e),e=null,r.upgrading=!1,r.flush())})}else{o('probe transport "%s" failed',t);var a=new Error("probe error");a.transport=e.name,r.emit("upgradeError",a)}}))}function a(){n||(n=!0,d(),e.close(),e=null)}function s(n){var i=new Error("probe error: "+n);i.transport=e.name,a(),o('probe transport "%s" failed because of error: %s',t,n),r.emit("upgradeError",i)}function c(){s("transport closed")}function u(){s("socket closed")}function h(t){e&&t.name!==e.name&&(o('"%s" works - aborting "%s"',t.name,e.name),a())}function d(){e.removeListener("open",i),e.removeListener("error",s),e.removeListener("close",c),r.removeListener("close",u),r.removeListener("upgrading",h)}l.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",s),e.once("close",c),this.once("close",u),this.once("upgrading",h),e.open()},l.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",l.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},l.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else o('packet received with socket readyState "%s"',this.readyState)},l.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},l.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},l.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},l.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},l.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},l.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},l.prototype.write=l.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},l.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:t,data:e,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},l.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}function e(){t.onClose("forced close"),o("socket closing - telling transport to close"),t.transport.close()}function n(){t.removeListener("upgrade",n),t.removeListener("upgradeError",n),e()}function r(){t.once("upgrade",n),t.once("upgradeError",n)}return this},l.prototype.onError=function(t){o("socket error %j",t),l.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},l.prototype.onClose=function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(o('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},l.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~a(this.transports,t[n])&&e.push(t[n]);return e}}).call(e,n("DuR2"))},Xz3Q:function(t,e,n){var r=n("Fy0/")("socket.io-parser"),i=n("pnVU"),o=n("QHw4"),a=n("sOR5"),s=n("UZ14");function c(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=c,e.Decoder=h;var u=e.ERROR+'"encode error"';function l(t){var n=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return u;n+=i}return r("encoded %j as %s",t,n),n}function h(){this.reconstructor=null}function d(t){this.reconPack=t,this.buffers=[]}function p(t){return{type:e.ERROR,data:"parser error: "+t}}c.prototype.encode=function(t,n){r("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?function(t,e){o.removeBlobs(t,function(t){var n=o.deconstructPacket(t),r=l(n.packet),i=n.buffers;i.unshift(r),e(i)})}(t,n):n([l(t)])},i(h.prototype),h.prototype.add=function(t){var n;if("string"==typeof t)n=function(t){var n=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return p("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var o="";"-"!==t.charAt(++n)&&(o+=t.charAt(n),n!=t.length););if(o!=Number(o)||"-"!==t.charAt(n))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===t.charAt(n+1))for(i.nsp="";++n&&","!==(c=t.charAt(n))&&(i.nsp+=c,n!==t.length););else i.nsp="/";var s=t.charAt(n+1);if(""!==s&&Number(s)==s){for(i.id="";++n;){var c;if(null==(c=t.charAt(n))||Number(c)!=c){--n;break}if(i.id+=t.charAt(n),n===t.length)break}i.id=Number(i.id)}if(t.charAt(++n)){var u=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(n));if(!1===u||i.type!==e.ERROR&&!a(u))return p("invalid payload");i.data=u}return r("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type?(this.reconstructor=new d(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!s(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",n))}},h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},"Y+et":function(t,e,n){(function(t){var r=n("P2cu"),i=n("nXuP"),o=n("ZEn9"),a=n("cwTZ");e.polling=function(e){var n=!1,a=!1,s=!1!==e.jsonp;if(t.location){var c="https:"===location.protocol,u=location.port;u||(u=c?443:80),n=e.hostname!==location.hostname||u!==e.port,a=e.secure!==c}if(e.xdomain=n,e.xscheme=a,"open"in new r(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new o(e)},e.websocket=a}).call(e,n("DuR2"))},YTpx:function(t,e,n){"use strict";function r(t,e){if(t&&e)for(var n=Object.keys(e),r=0;r<n.length;++r){var i=n[r];Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}}e.__esModule=!0,e.mixin=r,e.delayMixin=function(t,e){i.push(t,e)},e.performMixins=function(){for(var t=0;t<i.length;t+=2)r(i[t],i[t+1]);i.length=0};var i=[]},YUmt:function(t,e){function n(){}t.exports=function(t,e,r){var i=!1;return r=r||n,o.count=t,0===t?e():o;function o(t,n){if(o.count<=0)throw new Error("after called too many times");--o.count,t?(i=!0,e(t),e=r):0!==o.count||i||e(null,n)}}},YaPU:function(t,e,n){"use strict";var r=n("AMGY"),i=n("OVmG"),o=n("tLDX"),a=n("t7NR"),s=n("+CnV"),c=n("f9aG");n.d(e,"a",function(){return u});var u=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,s=function(t,e,n){if(t){if(t instanceof i.a)return t;if(t[o.a])return t[o.a]()}return t||e||n?new i.a(t,e,n):new i.a(a.a)}(t,e,n);if(r?r.call(s,this.source):s.add(this.source||!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.syncErrorThrown=!0,t.syncErrorValue=e,t.error(e)}},t.prototype.forEach=function(t,e){var n=this;if(e||(r.a.Rx&&r.a.Rx.config&&r.a.Rx.config.Promise?e=r.a.Rx.config.Promise:r.a.Promise&&(e=r.a.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,r){var i;i=n.subscribe(function(e){if(i)try{t(e)}catch(t){r(t),i.unsubscribe()}else t(e)},r,e)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[s.a]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 0===t.length?this:Object(c.b)(t)(this)},t.prototype.toPromise=function(t){var e=this;if(t||(r.a.Rx&&r.a.Rx.config&&r.a.Rx.config.Promise?t=r.a.Rx.config.Promise:r.a.Promise&&(t=r.a.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}()},Ydo6:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E"));n("o/zv");var o=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));return i.noise=n,i.seed=r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"noise",get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t}},{key:"seed",get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t}}]),e}(i.Filter);e.default=o},YdyU:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=u(n("8USZ")),o=n("aH6o"),a=n("z1Av"),s=n("FjAT"),c=u(n("h9yw"));function u(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(n,r){if(function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),!n)throw new Error("No video source element specified.");(n.readyState===n.HAVE_ENOUGH_DATA||n.readyState===n.HAVE_FUTURE_DATA)&&n.width&&n.height&&(n.complete=!0);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,r));return i.width=n.videoWidth,i.height=n.videoHeight,i._autoUpdate=!0,i._isAutoUpdating=!1,i.autoPlay=!0,i.update=i.update.bind(i),i._onCanPlay=i._onCanPlay.bind(i),n.addEventListener("play",i._onPlayStart.bind(i)),n.addEventListener("pause",i._onPlayStop.bind(i)),i.hasLoaded=!1,i.__loaded=!1,i._isSourceReady()?i._onCanPlay():(n.addEventListener("canplay",i._onCanPlay),n.addEventListener("canplaythrough",i._onCanPlay)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},e.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(a.shared.add(this.update,this,s.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0)},e.prototype._onPlayStop=function(){this._isAutoUpdating&&(a.shared.remove(this.update,this),this._isAutoUpdating=!1)},e.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.emit("loaded",this)),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.source.play())},e.prototype.destroy=function(){this._isAutoUpdating&&a.shared.remove(this.update,this),this.source&&this.source._pixiId&&(i.default.removeFromCache(this.source._pixiId),delete this.source._pixiId,this.source.pause(),this.source.src="",this.source.load()),t.prototype.destroy.call(this)},e.fromVideo=function(t,n){t._pixiId||(t._pixiId="video_"+(0,o.uid)());var r=o.BaseTextureCache[t._pixiId];return r||(r=new e(t,n),i.default.addToCache(r,t._pixiId)),r},e.fromUrl=function(t,n,r){var i=document.createElement("video");i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","");var o=Array.isArray(t)?t[0].src||t[0]:t.src||t;if(void 0===r&&0!==o.indexOf("data:")?i.crossOrigin=(0,c.default)(o):r&&(i.crossOrigin="string"==typeof r?r:"anonymous"),Array.isArray(t))for(var a=0;a<t.length;++a)i.appendChild(h(t[a].src||t[a],t[a].mime));else i.appendChild(h(o,t.mime));return i.load(),e.fromVideo(i,n)},r(e,[{key:"autoUpdate",get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(a.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(a.shared.add(this.update,this,s.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0))}}]),e}(i.default);function h(t,e){e||(e="video/"+t.substr(t.lastIndexOf(".")+1));var n=document.createElement("source");return n.src=t,n.type=e,n}e.default=l,l.fromUrls=l.fromUrl},Z1wJ:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(e,n,r,i,o,a,s,c){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.lineWidth=e,this.nativeLines=s,this.lineColor=n,this.lineAlpha=r,this._lineTint=n,this.fillColor=i,this.fillAlpha=o,this._fillTint=i,this.fill=a,this.holes=[],this.shape=c,this.type=c.type}return t.prototype.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape)},t.prototype.addHole=function(t){this.holes.push(t)},t.prototype.destroy=function(){this.shape=null,this.holes=null},t}();e.default=r},Z7et:function(t,e,n){var r=n("Ml+6");Sky=function(){var t=Sky.SkyShader,e=new r.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r.UniformsUtils.clone(t.uniforms),side:r.BackSide});r.Mesh.call(this,new r.SphereBufferGeometry(1,32,15),e)},Sky.prototype=Object.create(r.Mesh.prototype),Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new r.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},t.exports=Sky},ZEn9:function(t,e,n){(function(e){var r=n("5+9/"),i=n("QamB");t.exports=u;var o,a=/\n/g,s=/\\n/g;function c(){}function u(t){r.call(this,t),this.query=this.query||{},o||(e.___eio||(e.___eio=[]),o=e.___eio),this.index=o.length;var n=this;o.push(function(t){n.onData(t)}),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=c)},!1)}i(u,r),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},u.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},u.prototype.doWrite=function(t,e){var n=this;if(!this.form){var r,i=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function u(){l(),e()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{r=document.createElement('<iframe src="javascript:0" name="'+n.iframeId+'">')}catch(t){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),l(),t=t.replace(s,"\\\n"),this.area.value=t.replace(a,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&u()}:this.iframe.onload=u}}).call(e,n("DuR2"))},ZOjo:function(t,e,n){var r=n("ElvI"),i=n("pnVU");function o(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=o,i(o.prototype),o.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(t){var e=r.decodePacket(t,this.socket.binaryType);this.onPacket(e)},o.prototype.onPacket=function(t){this.emit("packet",t)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},ZSfh:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}},aH6o:function(t,e,n){"use strict";e.__esModule=!0,e.premultiplyBlendMode=e.BaseTextureCache=e.TextureCache=e.earcut=e.mixins=e.pluginTarget=e.EventEmitter=e.removeItems=e.isMobile=void 0,e.uid=function(){return++f},e.hex2rgb=function(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},e.hex2string=function(t){return t=t.toString(16),"#"+("000000".substr(0,6-t.length)+t)},e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)},e.getResolutionOfUrl=function(t,e){var n=i.default.RETINA_PREFIX.exec(t);return n?parseFloat(n[1]):void 0!==e?e:1},e.decomposeDataUri=function(t){var e=r.DATA_URI.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,encoding:e[3]?e[3].toLowerCase():void 0,data:e[4]}},e.getUrlFileExtension=function(t){var e=r.URL_FILE_EXTENSION.exec(t);if(e)return e[1].toLowerCase()},e.getSvgSize=function(t){var e=r.SVG_SIZE.exec(t),n={};return e&&(n[e[1]]=Math.round(parseFloat(e[3])),n[e[5]]=Math.round(parseFloat(e[7]))),n},e.skipHello=function(){m=!0},e.sayHello=function(t){m||(navigator.userAgent.toLowerCase().indexOf("chrome")>-1?window.console.log.apply(console,["\n %c %c %c PixiJS "+r.VERSION+" - \u2730 "+t+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):window.console&&window.console.log("PixiJS "+r.VERSION+" - "+t+" - http://www.pixijs.com/"),m=!0)},e.isWebGLSupported=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!n||!n.getContextAttributes().stencil);if(n){var i=n.getExtension("WEBGL_lose_context");i&&i.loseContext()}return n=null,r}catch(t){return!1}},e.sign=function(t){return 0===t?0:t<0?-1:1},e.destroyTextureCache=function(){var t=void 0;for(t in v)v[t].destroy();for(t in g)g[t].destroy()},e.clearTextureCache=function(){var t=void 0;for(t in v)delete v[t];for(t in g)delete g[t]},e.correctBlendMode=function(t,e){return y[e?1:0][t]},e.premultiplyTint=function(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var n=t>>16&255,r=t>>8&255;return(255*e<<24)+((n=n*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+((255&t)*e+.5|0)},e.premultiplyRgba=function(t,e,n,r){return n=n||new Float32Array(4),r||void 0===r?(n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e):(n[0]=t[0],n[1]=t[1],n[2]=t[2]),n[3]=e,n},e.premultiplyTintToRgba=function(t,e,n,r){return(n=n||new Float32Array(4))[0]=(t>>16&255)/255,n[1]=(t>>8&255)/255,n[2]=(255&t)/255,(r||void 0===r)&&(n[0]*=e,n[1]*=e,n[2]*=e),n[3]=e,n};var r=n("FjAT"),i=p(n("/MUw")),o=p(n("BzvE")),a=p(n("JdRN")),s=d(n("YTpx")),c=d(n("Sst2")),u=p(n("AWov")),l=p(n("Si/7")),h=p(n("It3W"));function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function p(t){return t&&t.__esModule?t:{default:t}}var f=0,m=!1;e.isMobile=c,e.removeItems=u.default,e.EventEmitter=o.default,e.pluginTarget=a.default,e.mixins=s,e.earcut=h.default;var v=e.TextureCache=Object.create(null),g=e.BaseTextureCache=Object.create(null),y=e.premultiplyBlendMode=(0,l.default)()},aRcS:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){function e(n,r){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return i.points=r,i.vertices=new Float32Array(4*r.length),i.uvs=new Float32Array(4*r.length),i.colors=new Float32Array(2*r.length),i.indices=new Uint16Array(2*r.length),i.autoUpdate=!0,i.refresh(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._refresh=function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){this.vertices.length/4!==t.length&&(this.vertices=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length));var e=this.uvs,n=this.indices,r=this.colors;e[0]=0,e[1]=0,e[2]=0,e[3]=1,r[0]=1,r[1]=1,n[0]=0,n[1]=1;for(var i=t.length,o=1;o<i;o++){var a=4*o,s=o/(i-1);e[a]=s,e[a+1]=0,e[a+2]=s,e[a+3]=1,r[a=2*o]=1,r[a+1]=1,n[a=2*o]=a,n[a+1]=a+1}this.dirty++,this.indexDirty++,this.multiplyUvs(),this.refreshVertices()}},e.prototype.refreshVertices=function(){var t=this.points;if(!(t.length<1))for(var e=t[0],n=void 0,r=0,i=0,o=this.vertices,a=t.length,s=0;s<a;s++){var c=t[s],u=4*s;i=-((n=s<t.length-1?t[s+1]:c).x-e.x),r=n.y-e.y;var l=10*(1-s/(a-1));l>1&&(l=1);var h=Math.sqrt(r*r+i*i),d=this._texture.height/2;r/=h,i/=h,i*=d,o[u]=c.x+(r*=d),o[u+1]=c.y+i,o[u+2]=c.x-r,o[u+3]=c.y-i,e=c}},e.prototype.updateTransform=function(){this.autoUpdate&&this.refreshVertices(),this.containerUpdateTransform()},e}(((r=n("kpDK"))&&r.__esModule?r:{default:r}).default);e.default=i},aWrq:function(t,e,n){"use strict";var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E"));r.DisplayObject.prototype.getGlobalPosition=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r.Point;return this.parent?this.parent.toGlobal(this.position,t,arguments.length>1&&void 0!==arguments[1]&&arguments[1]):(t.x=this.position.x,t.y=this.position.y),t}},aoKs:function(t,e){var n=function(t){for(var e=new Array(t),n=0;n<e.length;n++)e[n]=!1;return e};t.exports=function(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return n(2*e);case"bvec3":return n(3*e);case"bvec4":return n(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}},bBNR:function(t,e){var n=new ArrayBuffer(0),r=function(t,e,r,i){this.gl=t,this.buffer=t.createBuffer(),this.type=e||t.ARRAY_BUFFER,this.drawType=i||t.STATIC_DRAW,this.data=n,r&&this.upload(r),this._updateID=0};r.prototype.upload=function(t,e,n){n||this.bind();var r=this.gl;t=t||this.data,e=e||0,this.data.byteLength>=t.byteLength?r.bufferSubData(this.type,e,t):r.bufferData(this.type,t,this.drawType),this.data=t},r.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},r.createVertexBuffer=function(t,e,n){return new r(t,t.ARRAY_BUFFER,e,n)},r.createIndexBuffer=function(t,e,n){return new r(t,t.ELEMENT_ARRAY_BUFFER,e,n)},r.create=function(t,e,n,i){return new r(t,e,n,i)},r.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},t.exports=r},bKul:function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},bmpC:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=c(n("n9CN")),o=n("aH6o"),a=n("FjAT"),s=c(n("/MUw"));function c(t){return t&&t.__esModule?t:{default:t}}var u={},l=function(){function t(e,n,r){for(var c in function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=n||t.defaultFragmentSrc,this._blendMode=a.BLEND_MODES.NORMAL,this.uniformData=r||(0,i.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler"),this.uniforms={},this.uniformData)this.uniforms[c]=this.uniformData[c].value,this.uniformData[c].type&&(this.uniformData[c].type=this.uniformData[c].type.toLowerCase());this.glShaders={},u[this.vertexSrc+this.fragmentSrc]||(u[this.vertexSrc+this.fragmentSrc]=(0,o.uid)()),this.glShaderKey=u[this.vertexSrc+this.fragmentSrc],this.padding=4,this.resolution=s.default.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0}return t.prototype.apply=function(t,e,n,r,i){t.applyFilter(this,e,n,r)},r(t,[{key:"blendMode",get:function(){return this._blendMode},set:function(t){this._blendMode=t}}],[{key:"defaultVertexSrc",get:function(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]),t}();e.default=l},bqFq:function(t,e){t.exports=function(t,e){for(var n=[],r=(e=e||0)||0;r<t.length;r++)n[r-e]=t[r];return n}},bva0:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,n,r){void 0===n&&(n=!1),i(this,t),this._fn=e,this._once=n,this._thisArg=r,this._next=this._prev=this._owner=null}return r(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function a(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var s=function(){function t(){i(this,t),this._head=this._tail=void 0}return r(t,[{key:"handlers",value:function(){var t=this._head;if(!(arguments.length<=0||void 0===arguments[0])&&arguments[0])return!!t;for(var e=[];t;)e.push(t),t=t._next;return e}},{key:"has",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return a(this,new o(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return a(this,new o(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();s.MiniSignalBinding=o,e.default=s,t.exports=e.default},cQXm:function(t,e,n){"use strict";e.a=function(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},cv0E:function(t,e,n){"use strict";n("Wi38"),n("9GXS"),n("2fqX"),n("KWAD"),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array)},cwTZ:function(t,e,n){(function(e){var r,i=n("ZOjo"),o=n("ElvI"),a=n("gVZZ"),s=n("QamB"),c=n("9rXv"),u=n("Fy0/")("engine.io-client:websocket"),l=e.WebSocket||e.MozWebSocket;if("undefined"==typeof window)try{r=n(1)}catch(t){}var h=l;function d(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=l&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(h=r),i.call(this,t)}h||"undefined"!=typeof window||(h=r),t.exports=d,s(d,i),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?e?new h(t,e):new h(t):new h(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},d.prototype.write=function(t){var n=this;this.writable=!1;for(var r=t.length,i=0,a=r;i<a;i++)!function(t){o.encodePacket(t,n.supportsBinary,function(i){if(!n.usingBrowserWebSocket){var o={};t.options&&(o.compress=t.options.compress),n.perMessageDeflate&&("string"==typeof i?e.Buffer.byteLength(i):i.length)<n.perMessageDeflate.threshold&&(o.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(i):n.ws.send(i,o)}catch(t){u("websocket closed before onclose event")}--r||(n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0))})}(t[i])},d.prototype.onClose=function(){i.prototype.onClose.call(this)},d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},d.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||(t.b64=1),(t=a.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},d.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===d.prototype.name)}}).call(e,n("DuR2"))},d5OP:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){function e(n){return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((r=n("Obmw"))&&r.__esModule?r:{default:r}).default);e.default=i},d8XH:function(t,e,n){"use strict";e.__esModule=!0;var r=n("leFA");Object.defineProperty(e,"FXAAFilter",{enumerable:!0,get:function(){return h(r).default}});var i=n("Ydo6");Object.defineProperty(e,"NoiseFilter",{enumerable:!0,get:function(){return h(i).default}});var o=n("o3GV");Object.defineProperty(e,"DisplacementFilter",{enumerable:!0,get:function(){return h(o).default}});var a=n("XjEo");Object.defineProperty(e,"BlurFilter",{enumerable:!0,get:function(){return h(a).default}});var s=n("e3qs");Object.defineProperty(e,"BlurXFilter",{enumerable:!0,get:function(){return h(s).default}});var c=n("qLff");Object.defineProperty(e,"BlurYFilter",{enumerable:!0,get:function(){return h(c).default}});var u=n("mlJa");Object.defineProperty(e,"ColorMatrixFilter",{enumerable:!0,get:function(){return h(u).default}});var l=n("BmFd");function h(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"AlphaFilter",{enumerable:!0,get:function(){return h(l).default}})},dgOU:function(t,e,n){"use strict";e.a=function(t){return null!=t&&"object"==typeof t}},dtlK:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n("aH6o"),a=function(t){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n.children=[],n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onChildrenChange=function(){},e.prototype.addChild=function(t){var e=arguments.length;if(e>1)for(var n=0;n<e;n++)this.addChild(arguments[n]);else t.parent&&t.parent.removeChild(t),t.parent=this,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),t.emit("added",this);return t},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),t},e.prototype.swapChildren=function(t,e){if(t!==e){var n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(t);(0,o.removeItems)(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(t){var e=arguments.length;if(e>1)for(var n=0;n<e;n++)this.removeChild(arguments[n]);else{var r=this.children.indexOf(t);if(-1===r)return null;t.parent=null,t.transform._parentID=-1,(0,o.removeItems)(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this)}return t},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,(0,o.removeItems)(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),e},e.prototype.removeChildren=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1],n="number"==typeof e?e:this.children.length,r=n-t,i=void 0;if(r>0&&r<=n){i=this.children.splice(t,r);for(var o=0;o<i.length;++o)i[o].parent=null,i[o].transform&&(i[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var a=0;a<i.length;++a)i[a].emit("removed",this);return i}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var n=this.children[t];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.visible&&e.renderable&&(e.calculateBounds(),e._mask?(e._mask.calculateBounds(),this._bounds.addBoundsMask(e._bounds,e._mask._bounds)):e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds))}this._lastBoundsID=this._boundsID},e.prototype._calculateBounds=function(){},e.prototype.renderWebGL=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(t);else{this._renderWebGL(t);for(var e=0,n=this.children.length;e<n;++e)this.children[e].renderWebGL(t)}},e.prototype.renderAdvancedWebGL=function(t){t.flush();var e=this._filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r]);this._enabledFilters.length&&t.filterManager.pushFilter(this,this._enabledFilters)}n&&t.maskManager.pushMask(this,this._mask),this._renderWebGL(t);for(var i=0,o=this.children.length;i<o;i++)this.children[i].renderWebGL(t);t.flush(),n&&t.maskManager.popMask(this,this._mask),e&&this._enabledFilters&&this._enabledFilters.length&&t.filterManager.popFilter()},e.prototype._renderWebGL=function(t){},e.prototype._renderCanvas=function(t){},e.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,n=this.children.length;e<n;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.prototype.destroy=function(e){t.prototype.destroy.call(this);var n="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(n)for(var i=0;i<r.length;++i)r[i].destroy(e)},i(e,[{key:"width",get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}},{key:"height",get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}]),e}(((r=n("3Wvr"))&&r.__esModule?r:{default:r}).default);e.default=a,a.prototype.containerUpdateTransform=a.prototype.updateTransform},e3qs:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=c(n("vpgX")),a=c(n("5Ljx")),s=c(n("+QcN"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(n,r,s,c){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var u=(0,o.default)(c=c||5,!0),l=(0,a.default)(c),h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,u,l));return h.resolution=s||i.settings.RESOLUTION,h._quality=0,h.quality=r||4,h.strength=n||8,h.firstRun=!0,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,n,r){if(this.firstRun){var i=(0,s.default)(t.renderer.gl);this.vertexSrc=(0,o.default)(i,!0),this.fragmentSrc=(0,a.default)(i),this.firstRun=!1}if(this.uniforms.strength=1/n.size.width*(n.size.width/e.size.width),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,n,r);else{for(var c=t.getRenderTarget(!0),u=e,l=c,h=0;h<this.passes-1;h++){t.applyFilter(this,u,l,!0);var d=l;l=u,u=d}t.applyFilter(this,u,n,r),t.returnRenderTarget(c)}},r(e,[{key:"blur",get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}]),e}(i.Filter);e.default=u},eAwk:function(t,e,n){(function(t,r){var i;!function(r){var o,a,s,c=String.fromCharCode;function u(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function l(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function h(t,e){return c(t>>e&63|128)}function d(t,e){if(0==(4294967168&t))return c(t);var n="";return 0==(4294965248&t)?n=c(t>>6&31|192):0==(4294901760&t)?(l(t,e)||(t=65533),n=c(t>>12&15|224),n+=h(t,6)):0==(4292870144&t)&&(n=c(t>>18&7|240),n+=h(t,12),n+=h(t,6)),n+c(63&t|128)}function p(){if(s>=a)throw Error("Invalid byte index");var t=255&o[s];if(s++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function f(t){var e,n;if(s>a)throw Error("Invalid byte index");if(s==a)return!1;if(e=255&o[s],s++,0==(128&e))return e;if(192==(224&e)){if((n=(31&e)<<6|p())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&e)){if((n=(15&e)<<12|p()<<6|p())>=2048)return l(n,t)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=(7&e)<<18|p()<<12|p()<<6|p())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var m={version:"2.1.2",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,r=u(t),i=r.length,o=-1,a="";++o<i;)a+=d(r[o],n);return a},decode:function(t,e){var n=!1!==(e=e||{}).strict;o=u(t),a=o.length,s=0;for(var r,i=[];!1!==(r=f(n));)i.push(r);return function(t){for(var e,n=t.length,r=-1,i="";++r<n;)(e=t[r])>65535&&(i+=c((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=c(e);return i}(i)}};void 0===(i=(function(){return m}).call(e,n,e,t))||(t.exports=i)}()}).call(e,n("3IRH")(t),n("DuR2"))},eWjs:function(t,e,n){"use strict";"use restrict";function r(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=r,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var i=new Array(256);!function(t){for(var e=0;e<256;++e){var n=e,r=e,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;t[e]=r<<i&255}}(i),e.reverse=function(t){return i[255&t]<<24|i[t>>>8&255]<<16|i[t>>>16&255]<<8|i[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>r(t)+1}},etqZ:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t){var e=t.Symbol;if("function"==typeof e)return e.iterator||(e.iterator=e("iterator polyfill")),e.iterator;var n=t.Set;if(n&&"function"==typeof(new n)["@@iterator"])return"@@iterator";var r=t.Map;if(r)for(var i=Object.getOwnPropertyNames(r.prototype),o=0;o<i.length;++o){var a=i[o];if("entries"!==a&&"size"!==a&&r.prototype[a]===r.prototype.entries)return a}return"@@iterator"}(n("AMGY").a)},f9aG:function(t,e,n){"use strict";e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return i(t)},e.b=i;var r=n("gIN1");function i(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:r.a}},fKB6:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r={e:{}}},fOB9:function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),o=t.indexOf("]");-1!=i&&-1!=o&&(t=t.substring(0,i)+t.substring(i,o).replace(/:/g,";")+t.substring(o,t.length));for(var a=n.exec(t||""),s={},c=14;c--;)s[r[c]]=a[c]||"";return-1!=i&&-1!=o&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},fiP3:function(t,e,n){"use strict";e.__esModule=!0,e.default={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},fq6b:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){for(var e=6*t,n=new Uint16Array(e),r=0,i=0;r<e;r+=6,i+=4)n[r+0]=i+0,n[r+1]=i+1,n[r+2]=i+2,n[r+3]=i+0,n[r+4]=i+2,n[r+5]=i+3;return n}},g5jc:function(t,e,n){"use strict";n.d(e,"c",function(){return l}),n.d(e,"b",function(){return h}),n.d(e,"a",function(){return d});var r=n("TToO"),i=n("YaPU"),o=n("OVmG"),a=n("VwZZ"),s=n("x6VL"),c=n("1Bqh"),u=n("tLDX"),l=function(t){function e(e){t.call(this,e),this.destination=e}return Object(r.c)(e,t),e}(o.a),h=function(t){function e(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return Object(r.c)(e,t),e.prototype[u.a]=function(){return new l(this)},e.prototype.lift=function(t){var e=new d(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new s.a;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new s.a;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new s.a;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new s.a;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new s.a;return this.hasError?(t.error(this.thrownError),a.a.EMPTY):this.isStopped?(t.complete(),a.a.EMPTY):(this.observers.push(t),new c.a(this,t))},e.prototype.asObservable=function(){var t=new i.a;return t.source=this,t},e.create=function(t,e){return new d(t,e)},e}(i.a),d=function(t){function e(e,n){t.call(this),this.destination=e,this.source=n}return Object(r.c)(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):a.a.EMPTY},e}(h)},gIN1:function(t,e,n){"use strict";e.a=function(){}},gQZj:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n("FjAT"),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=Number(e),this.y=Number(n),this.width=Number(r),this.height=Number(o),this.type=i.SHAPES.RECT}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},t.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},t.prototype.fit=function(t){this.x<t.x&&(this.width+=this.x,this.width<0&&(this.width=0),this.x=t.x),this.y<t.y&&(this.height+=this.y,this.height<0&&(this.height=0),this.y=t.y),this.x+this.width>t.x+t.width&&(this.width=t.width-this.x,this.width<0&&(this.width=0)),this.y+this.height>t.y+t.height&&(this.height=t.height-this.y,this.height<0&&(this.height=0))},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.width=n-e,this.y=r,this.height=i-r},r(t,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"EMPTY",get:function(){return new t(0,0,0,0)}}]),t}();e.default=o},gVZZ:function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}},gVev:function(t,e,n){"use strict";e.__esModule=!0,e.shared=e.Resource=e.textureParser=e.getResourcePath=e.spritesheetParser=e.parseBitmapFontData=e.bitmapFontParser=e.Loader=void 0;var r=n("j9EU");Object.defineProperty(e,"bitmapFontParser",{enumerable:!0,get:function(){return u(r).default}}),Object.defineProperty(e,"parseBitmapFontData",{enumerable:!0,get:function(){return r.parse}});var i=n("13Cv");Object.defineProperty(e,"spritesheetParser",{enumerable:!0,get:function(){return u(i).default}}),Object.defineProperty(e,"getResourcePath",{enumerable:!0,get:function(){return i.getResourcePath}});var o=n("nfXk");Object.defineProperty(e,"textureParser",{enumerable:!0,get:function(){return u(o).default}});var a=n("SMx8");Object.defineProperty(e,"Resource",{enumerable:!0,get:function(){return a.Resource}});var s=u(n("5XUO")),c=u(n("6Pue"));function u(t){return t&&t.__esModule?t:{default:t}}e.Loader=c.default;var l=new c.default;l.destroy=function(){},e.shared=l;var h=s.default.prototype;h._loader=null,Object.defineProperty(h,"loader",{get:function(){return this._loader||(this._loader=this._options.sharedLoader?l:new c.default),this._loader}}),h._parentDestroy=h.destroy,h.destroy=function(t){this._loader&&(this._loader.destroy(),this._loader=null),this._parentDestroy(t)}},giQI:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e,n){var r=t.shape,a=r.x,s=r.y,c=r.width,u=r.height;if(t.fill){var l=(0,o.hex2rgb)(t.fillColor),h=t.fillAlpha,d=l[0]*h,p=l[1]*h,f=l[2]*h,m=e.points,v=e.indices,g=m.length/6;m.push(a,s),m.push(d,p,f,h),m.push(a+c,s),m.push(d,p,f,h),m.push(a,s+u),m.push(d,p,f,h),m.push(a+c,s+u),m.push(d,p,f,h),v.push(g,g,g+1,g+2,g+3,g+3)}if(t.lineWidth){var y=t.points;t.points=[a,s,a+c,s,a+c,s+u,a,s+u,a,s],(0,i.default)(t,e,n),t.points=y}};var r,i=(r=n("FH9r"))&&r.__esModule?r:{default:r},o=n("aH6o")},gxtk:function(t,e,n){"use strict";e.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.blobMiddlewareFactory=function(){return function(t,e){if(t.data){if(t.xhr&&t.xhrType===i.default.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var n=(c=s.createObjectURL(t.data),t.blob=t.data,t.data=new Image,t.data.src=c,t.type=i.default.TYPE.IMAGE,t.data.onload=function(){s.revokeObjectURL(c),t.data.onload=null,e()},{v:void 0});if("object"===("undefined"==typeof n?"undefined":r(n)))return n.v}}else{var a=t.xhr.getResponseHeader("content-type");if(a&&0===a.indexOf("image"))return t.data=new Image,t.data.src="data:"+a+";base64,"+o.default.encodeBinary(t.xhr.responseText),t.type=i.default.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}var c;e()}else e()}};var i=a(n("66C6")),o=a(n("7VTH"));function a(t){return t&&t.__esModule?t:{default:t}}var s=window.URL||window.webkitURL},h4XE:function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("gQZj"))&&r.__esModule?r:{default:r},o=n("FjAT"),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=n,this.radius=r,this.type=o.SHAPES.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var n=this.x-t,r=this.y-e;return(n*=n)+(r*=r)<=this.radius*this.radius},t.prototype.getBounds=function(){return new i.default(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t}();e.default=a},h9yw:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location;return 0===t.indexOf("data:")?"":(e=e||window.location,o||(o=document.createElement("a")),o.href=t,(t=i.default.parse(o.href)).hostname!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||t.protocol!==e.protocol?"anonymous":"")};var r,i=(r=n("UZ5h"))&&r.__esModule?r:{default:r},o=void 0},hScZ:function(t,e,n){"use strict";e.__esModule=!0;var r=a(n("bmpC")),i=n("Q5/2"),o=(n("o/zv"),a(n("nQP+")));function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=new i.Matrix,o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));return n.renderable=!1,o.maskSprite=n,o.maskMatrix=r,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,n){var r=this.maskSprite,i=this.maskSprite.texture;i.valid&&(i.transform||(i.transform=new o.default(i,0)),i.transform.update(),this.uniforms.mask=i,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(i.transform.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=i.transform.uClampFrame,t.applyFilter(this,e,n))},e}(r.default);e.default=s},hYez:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=function(t){function e(n,r){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n[0]instanceof i.Texture?n[0]:n[0].texture));return o._textures=null,o._durations=null,o.textures=n,o._autoUpdate=!1!==r,o.animationSpeed=1,o.loop=!0,o.onComplete=null,o.onFrameChange=null,o.onLoop=null,o._currentTime=0,o.playing=!1,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&i.ticker.shared.remove(this.update,this))},e.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.HIGH))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){var e=this.animationSpeed*t,n=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n?this.onLoop():this.animationSpeed<0&&this.currentFrame>n&&this.onLoop()),this.updateTexture())},e.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this.cachedTint=16777215,this.onFrameChange&&this.onFrameChange(this.currentFrame)},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e)},e.fromFrames=function(t){for(var n=[],r=0;r<t.length;++r)n.push(i.Texture.fromFrame(t[r]));return new e(n)},e.fromImages=function(t){for(var n=[],r=0;r<t.length;++r)n.push(i.Texture.fromImage(t[r]));return new e(n)},r(e,[{key:"totalFrames",get:function(){return this._textures.length}},{key:"textures",get:function(){return this._textures},set:function(t){if(t[0]instanceof i.Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this.gotoAndStop(0),this.updateTexture()}},{key:"currentFrame",get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}}]),e}(i.Sprite);e.default=o},i45y:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n("/B0E"),o=n("aH6o"),a=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.baseTexture=e,this.textures={},this.data=n,this.resolution=this._updateResolution(r||this.baseTexture.imageUrl),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return r(t,null,[{key:"BATCH_SIZE",get:function(){return 1e3}}]),t.prototype._updateResolution=function(t){var e=this.data.meta.scale,n=(0,o.getResolutionOfUrl)(t,null);return null===n&&(n=void 0!==e?parseFloat(e):1),1!==n&&(this.baseTexture.resolution=n,this.baseTexture.update()),n},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var n=e,r=t.BATCH_SIZE,o=this.baseTexture.sourceScale;n-e<r&&n<this._frameKeys.length;){var a=this._frameKeys[n],s=this._frames[a],c=s.frame;if(c){var u,l=null,h=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,d=new i.Rectangle(0,0,Math.floor(h.w*o)/this.resolution,Math.floor(h.h*o)/this.resolution);u=s.rotated?new i.Rectangle(Math.floor(c.x*o)/this.resolution,Math.floor(c.y*o)/this.resolution,Math.floor(c.h*o)/this.resolution,Math.floor(c.w*o)/this.resolution):new i.Rectangle(Math.floor(c.x*o)/this.resolution,Math.floor(c.y*o)/this.resolution,Math.floor(c.w*o)/this.resolution,Math.floor(c.h*o)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(l=new i.Rectangle(Math.floor(s.spriteSourceSize.x*o)/this.resolution,Math.floor(s.spriteSourceSize.y*o)/this.resolution,Math.floor(c.w*o)/this.resolution,Math.floor(c.h*o)/this.resolution)),this.textures[a]=new i.Texture(this.baseTexture,u,d,l,s.rotated?2:0),i.Texture.addToCache(this.textures[a],a)}n++}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():e._parseComplete()},0)},t.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},t}();e.default=a},icz7:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e,n,r,i,o,a,s){var c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],u=0,l=0,h=0,d=0,p=0;c.push(t,e);for(var f=1,m=0;f<=20;++f)c.push((h=(l=(u=1-(m=f/20))*u)*u)*t+3*l*m*n+3*u*(d=m*m)*i+(p=d*m)*a,h*e+3*l*m*r+3*u*d*o+p*s);return c}},izXE:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n("Q5/2"),o=n("aH6o"),a=n("FjAT"),s=u(n("qD+0")),c=u(n("dtlK"));function u(t){return t&&t.__esModule?t:{default:t}}var l=new i.Point,h=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r._anchor=new i.ObservablePoint(r._onAnchorUpdate,r),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=a.BLEND_MODES.NORMAL,r.shader=null,r.cachedTint=16777215,r.texture=n||s.default.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.pluginName="sprite",r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this.cachedTint=16777215,this._width&&(this.scale.x=(0,o.sign)(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=(0,o.sign)(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID,this._textureID=this._texture._updateID;var t=this._texture,e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,o=e.d,a=e.tx,s=e.ty,c=this.vertexData,u=t.trim,l=t.orig,h=this._anchor,d=0,p=0,f=0,m=0;u?(d=(p=u.x-h._x*l.width)+u.width,f=(m=u.y-h._y*l.height)+u.height):(d=(p=-h._x*l.width)+l.width,f=(m=-h._y*l.height)+l.height),c[0]=n*p+i*m+a,c[1]=o*m+r*p+s,c[2]=n*d+i*m+a,c[3]=o*m+r*d+s,c[4]=n*d+i*f+a,c[5]=o*f+r*d+s,c[6]=n*p+i*f+a,c[7]=o*f+r*p+s}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this.vertexTrimmedData,e=this._texture.orig,n=this._anchor,r=this.transform.worldTransform,i=r.a,o=r.b,a=r.c,s=r.d,c=r.tx,u=r.ty,l=-n._x*e.width,h=l+e.width,d=-n._y*e.height,p=d+e.height;t[0]=i*l+a*d+c,t[1]=s*d+o*l+u,t[2]=i*h+a*d+c,t[3]=s*d+o*h+u,t[4]=i*h+a*p+c,t[5]=s*p+o*h+u,t[6]=i*l+a*p+c,t[7]=s*p+o*l+u},e.prototype._renderWebGL=function(t){this.calculateVertices(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._renderCanvas=function(t){t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,l);var e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x,i=0;return l.x>=r&&l.x<r+e&&l.y>=(i=-n*this.anchor.y)&&l.y<i+n},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this._anchor=null,("boolean"==typeof e?e:e&&e.texture)&&this._texture.destroy(!!("boolean"==typeof e?e:e&&e.baseTexture)),this._texture=null,this.shader=null},e.from=function(t){return new e(s.default.from(t))},e.fromFrame=function(t){var n=o.TextureCache[t];if(!n)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return new e(n)},e.fromImage=function(t,n,r){return new e(s.default.fromImage(t,n,r))},r(e,[{key:"width",get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=(0,o.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=(0,o.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"anchor",get:function(){return this._anchor},set:function(t){this._anchor.copy(t)}},{key:"tint",get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this.cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}]),e}(c.default);e.default=h},"j0z+":function(t,e,n){"use strict";e.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=u(n("bva0")),a=u(n("tOxb")),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("umD3")),c=u(n("66C6"));function u(t){return t&&t.__esModule?t:{default:t}}var l=/(#[\w-]+)?$/,h=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.baseUrl=n,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,n){return e._loadResource(t,n)},this._queue=s.queue(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new o.default,this.onError=new o.default,this.onLoad=new o.default,this.onStart=new o.default,this.onComplete=new o.default}return t.prototype.add=function(t,e,n,i){if(Array.isArray(t)){for(var o=0;o<t.length;++o)this.add(t[o]);return this}if("object"===("undefined"==typeof t?"undefined":r(t))&&(i=e||t.callback||t.onComplete,n=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(i=n,n=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof n&&(i=n,n=null),this.loading&&(!n||!n.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new c.default(t,e,n),"function"==typeof i&&this.resources[t].onAfterMiddleware.once(i),this.loading){for(var a=n.parentResource,s=[],u=0;u<a.children.length;++u)a.children[u].isComplete||s.push(a.children[u]);var l=a.progressChunk*(s.length+1)/(s.length+2);a.children.push(this.resources[t]),a.progressChunk=l;for(var h=0;h<s.length;++h)s[h].progressChunk=l;this.resources[t].progressChunk=l}return this._queue.push(this.resources[t]),this},t.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},t.prototype.use=function(t){return this._afterMiddleware.push(t),this},t.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},t.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,n=0;n<this._queue._tasks.length;++n)this._queue._tasks[n].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},t.prototype._prepareUrl=function(t){var e=(0,a.default)(t,{strictMode:!0}),n=void 0;if(n=e.protocol||!e.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=l.exec(n)[0];-1!==(n=n.substr(0,n.length-r.length)).indexOf("?")?n+="&"+this.defaultQueryString:n+="?"+this.defaultQueryString,n+=r}return n},t.prototype._loadResource=function(t,e){var n=this;t._dequeue=e,s.eachSeries(this._beforeMiddleware,function(e,r){e.call(n,t,function(){r(t.isComplete?{}:null)})},function(){t.isComplete?n._onLoad(t):(t._onLoadBinding=t.onComplete.once(n._onLoad,n),t.load())},!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),s.eachSeries(this._afterMiddleware,function(n,r){n.call(e,t,r)},function(){t.onAfterMiddleware.dispatch(t),e.progress+=t.progressChunk,e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()},!0)},i(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();e.default=h},j9EU:function(t,e,n){"use strict";e.__esModule=!0,e.parse=s,e.default=function(){return function(t,e){if(t.data&&t.type===o.Resource.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var n=t.isDataUrl?"":r.dirname(t.url);t.isDataUrl&&("."===n&&(n=""),this.baseUrl&&n&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(n+="/")),(n=n.replace(this.baseUrl,""))&&"/"!==n.charAt(n.length-1)&&(n+="/");var a=n+t.data.getElementsByTagName("page")[0].getAttribute("file");i.utils.TextureCache[a]?(s(t,i.utils.TextureCache[a]),e()):this.add(t.name+"_image",a,{crossOrigin:t.crossOrigin,loadType:o.Resource.LOAD_TYPE.IMAGE,metadata:t.metadata.imageMetadata,parentResource:t},function(n){s(t,n.texture),e()})}else e();else e()}};var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("o/zv")),i=n("/B0E"),o=n("SMx8"),a=n("PMti");function s(t,e){t.bitmapFont=a.BitmapText.registerFont(t.data,e)}},jMVn:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=16,a=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.uploadHookHelper=r,r.canvas=document.createElement("canvas"),r.canvas.width=o,r.canvas.height=o,r.ctx=r.canvas.getContext("2d"),r.registerUploadHook(s),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.ctx=null,this.canvas=null},e}(((r=n("k6PJ"))&&r.__esModule?r:{default:r}).default);function s(t,e){if(e instanceof i.BaseTexture){var n=e.source,r=0===n.width?t.canvas.width:Math.min(t.canvas.width,n.width),o=0===n.height?t.canvas.height:Math.min(t.canvas.height,n.height);return t.ctx.drawImage(n,0,0,r,o,0,0,t.canvas.width,t.canvas.height),!0}return!1}e.default=a,i.CanvasRenderer.registerPlugin("prepare",a)},jwA5:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){var e=t.width,n=t.height,r=t.getContext("2d"),i=r.getImageData(0,0,e,n).data,o=i.length,a={top:null,left:null,right:null,bottom:null},s=void 0,c=void 0,u=void 0;for(s=0;s<o;s+=4)0!==i[s+3]&&(c=s/4%e,u=~~(s/4/e),null===a.top&&(a.top=u),null===a.left?a.left=c:c<a.left&&(a.left=c),null===a.right?a.right=c+1:a.right<c&&(a.right=c+1),null===a.bottom?a.bottom=u:a.bottom<u&&(a.bottom=u));var l=r.getImageData(a.left,a.top,e=a.right-a.left,n=a.bottom-a.top+1);return{height:n,width:e,data:l}}},k6PJ:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=(r=n("EmDc"))&&r.__esModule?r:{default:r},a=i.ticker.shared;i.settings.UPLOADS_PER_FRAME=4;var s=function(){function t(e){var n=this;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.limiter=new o.default(i.settings.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){n.queue&&n.prepareItems()},this.registerFindHook(p),this.registerFindHook(f),this.registerFindHook(c),this.registerFindHook(u),this.registerFindHook(l),this.registerUploadHook(h),this.registerUploadHook(d)}return t.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,a.addOnce(this.tick,this,i.UPDATE_PRIORITY.UTILITY))):e&&e()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)a.addOnce(this.tick,this,i.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(var s=0,c=o.length;s<c;s++)o[s]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof i.Container)for(var r=t.children.length-1;r>=0;r--)this.add(t.children[r]);return this},t.prototype.destroy=function(){this.ticking&&a.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function c(t,e){var n=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof i.Texture){var o=t._textures[r].baseTexture;-1===e.indexOf(o)&&(e.push(o),n=!0)}return n}function u(t,e){return t instanceof i.BaseTexture&&(-1===e.indexOf(t)&&e.push(t),!0)}function l(t,e){if(t._texture&&t._texture instanceof i.Texture){var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function h(t,e){return e instanceof i.Text&&(e.updateText(!0),!0)}function d(t,e){if(e instanceof i.TextStyle){var n=e.toFontString();return i.TextMetrics.measureFont(n),!0}return!1}function p(t,e){if(t instanceof i.Text){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function f(t,e){return t instanceof i.TextStyle&&(-1===e.indexOf(t)&&e.push(t),!0)}e.default=s},kEDM:function(t,e,n){"use strict";e.__esModule=!0;var r=n("fiP3");Object.defineProperty(e,"accessibleTarget",{enumerable:!0,get:function(){return o(r).default}});var i=n("Nf+U");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"AccessibilityManager",{enumerable:!0,get:function(){return o(i).default}})},kFAI:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._x=r,this._y=i,this.cb=e,this.scope=n}return t.prototype.set=function(t,e){var n=t||0,r=e||(0!==e?n:0);this._x===n&&this._y===r||(this._x=n,this._y=r,this.cb.call(this.scope))},t.prototype.copy=function(t){this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope))},r(t,[{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}]),t}();e.default=i},kMPS:function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,o){e=e||"&",n=n||"=";var a={};if("string"!=typeof t||0===t.length)return a;var s=/\+/g;t=t.split(e);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var u=t.length;c>0&&u>c&&(u=c);for(var l=0;l<u;++l){var h,d,p,f,m=t[l].replace(s,"%20"),v=m.indexOf(n);v>=0?(h=m.substr(0,v),d=m.substr(v+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),r(a,p)?i(a[p])?a[p].push(f):a[p]=[a[p],f]:a[p]=f}return a};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},kVGU:function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),i=r.length,o="";for(n=0;n<i;n+=3)o+=t[r[n]>>2],o+=t[(3&r[n])<<4|r[n+1]>>4],o+=t[(15&r[n+1])<<2|r[n+2]>>6],o+=t[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},e.decode=function(t){var e,r,i,o,a,s=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var l=new ArrayBuffer(s),h=new Uint8Array(l);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],i=n[t.charCodeAt(e+1)],o=n[t.charCodeAt(e+2)],a=n[t.charCodeAt(e+3)],h[u++]=r<<2|i>>4,h[u++]=(15&i)<<4|o>>2,h[u++]=(3&o)<<6|63&a;return l}}()},kpDK:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),a=(r=n("qD+0"))&&r.__esModule?r:{default:r},s=new o.Point,c=new o.Polygon,u=function(t){function e(n,r,i,s,c){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return u._texture=n||a.default.EMPTY,u.uvs=i||new Float32Array([0,0,1,0,1,1,0,1]),u.vertices=r||new Float32Array([0,0,100,0,100,100,0,100]),u.indices=s||new Uint16Array([0,1,3,2]),u.dirty=0,u.indexDirty=0,u.blendMode=o.BLEND_MODES.NORMAL,u.canvasPadding=o.settings.MESH_CANVAS_PADDING,u.drawMode=c||e.DRAW_MODES.TRIANGLE_MESH,u.shader=null,u.tintRgb=new Float32Array([1,1,1]),u._glDatas={},u._uvTransform=new o.TextureMatrix(u._texture),u.uploadUvTransform=!1,u.pluginName="mesh",u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._renderWebGL=function(t){this.refresh(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._renderCanvas=function(t){this.refresh(),t.plugins[this.pluginName].render(this)},e.prototype._onTextureUpdate=function(){this._uvTransform.texture=this._texture,this.refresh()},e.prototype.multiplyUvs=function(){this.uploadUvTransform||this._uvTransform.multiplyUvs(this.uvs)},e.prototype.refresh=function(t){this._uvTransform.update(t)&&this._refresh()},e.prototype._refresh=function(){},e.prototype._calculateBounds=function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,s);for(var n=this.vertices,r=c.points,i=this.indices,o=this.indices.length,a=this.drawMode===e.DRAW_MODES.TRIANGLES?3:1,u=0;u+2<o;u+=a){var l=2*i[u],h=2*i[u+1],d=2*i[u+2];if(r[0]=n[l],r[1]=n[l+1],r[2]=n[h],r[3]=n[h+1],r[4]=n[d],r[5]=n[d+1],c.contains(s.x,s.y))return!0}return!1},i(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}},{key:"tint",get:function(){return o.utils.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=o.utils.hex2rgb(t,this.tintRgb)}}]),e}(o.Container);e.default=u,u.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},lAP5:function(t,e,n){"use strict";e.a=function(t){return t}},leFA:function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E"));n("o/zv");var i=function(t){function e(){return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(r.Filter);e.default=i},m0PG:function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("mDHO"))&&r.__esModule?r:{default:r},o=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.activeState=new Uint8Array(16),this.defaultState=new Uint8Array(16),this.defaultState[0]=1,this.stackIndex=0,this.stack=[],this.gl=e,this.maxAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)},this.blendModes=(0,i.default)(e),this.nativeVaoExtension=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object")}return t.prototype.push=function(){var t=this.stack[this.stackIndex];t||(t=this.stack[this.stackIndex]=new Uint8Array(16)),++this.stackIndex;for(var e=0;e<this.activeState.length;e++)t[e]=this.activeState[e]},t.prototype.pop=function(){var t=this.stack[--this.stackIndex];this.setState(t)},t.prototype.setState=function(t){this.setBlend(t[0]),this.setDepthTest(t[1]),this.setFrontFace(t[2]),this.setCullFace(t[3]),this.setBlendMode(t[4])},t.prototype.setBlend=function(t){this.activeState[0]!==(t=t?1:0)&&(this.activeState[0]=t,this.gl[t?"enable":"disable"](this.gl.BLEND))},t.prototype.setBlendMode=function(t){if(t!==this.activeState[4]){this.activeState[4]=t;var e=this.blendModes[t];2===e.length?this.gl.blendFunc(e[0],e[1]):this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3])}},t.prototype.setDepthTest=function(t){this.activeState[1]!==(t=t?1:0)&&(this.activeState[1]=t,this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST))},t.prototype.setCullFace=function(t){this.activeState[3]!==(t=t?1:0)&&(this.activeState[3]=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE))},t.prototype.setFrontFace=function(t){this.activeState[2]!==(t=t?1:0)&&(this.activeState[2]=t,this.gl.frontFace(this.gl[t?"CW":"CCW"]))},t.prototype.resetAttributes=function(){for(var t=0;t<this.attribState.tempAttribState.length;t++)this.attribState.tempAttribState[t]=0;for(var e=0;e<this.attribState.attribState.length;e++)this.attribState.attribState[e]=0;for(var n=1;n<this.maxAttribs;n++)this.gl.disableVertexAttribArray(n)},t.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null),this.resetAttributes();for(var t=0;t<this.activeState.length;++t)this.activeState[t]=32;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.setState(this.defaultState)},t}();e.default=o},mAOr:function(t,e,n){"use strict";e.__esModule=!0;var r=n("Q5/2"),i=function(){function t(){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.worldTransform=new r.Matrix,this.localTransform=new r.Matrix,this._worldID=0,this._parentID=0}return t.prototype.updateLocalTransform=function(){},t.prototype.updateTransform=function(t){var e=t.worldTransform,n=this.worldTransform,r=this.localTransform;n.a=r.a*e.a+r.b*e.c,n.b=r.a*e.b+r.b*e.d,n.c=r.c*e.a+r.d*e.c,n.d=r.c*e.b+r.d*e.d,n.tx=r.tx*e.a+r.ty*e.c+e.tx,n.ty=r.tx*e.b+r.ty*e.d+e.ty,this._worldID++},t}();e.default=i,i.prototype.updateWorldTransform=i.prototype.updateTransform,i.IDENTITY=new i},mDHO:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e[r.BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.ADD]=[t.ONE,t.DST_ALPHA],e[r.BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR],e[r.BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.ADD_NPM]=[t.SRC_ALPHA,t.DST_ALPHA,t.ONE,t.DST_ALPHA],e[r.BLEND_MODES.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_COLOR],e};var r=n("FjAT")},mHjp:function(t,e,n){var r=n("Ml+6");t.exports=function(){var t,e,n,i,o,a,s,c,u,l,h=null,d=null,p=null,f={},m={},v={},g={},y={},b={},x={},w={},_={},S=r.SmoothShading,T={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},M=1,A="Y",E=null;function C(l,f,S){if(h=(new DOMParser).parseFromString(l,"text/xml"),f=f||p,void 0!==S){var C=S.split("/");C.pop(),s=(C.length<1?".":C.join("/"))+"/"}!function(){var t=h.querySelectorAll("asset")[0];if(t&&t.childNodes)for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"unit":var r=n.getAttribute("meter");r&&(M=parseFloat(r));break;case"up_axis":A=n.textContent.charAt(0)}}}(),function(){if(!0!==T.convertUpAxis||A===T.upAxis)E=null;else switch(A){case"X":E="Y"===T.upAxis?"XtoY":"XtoZ";break;case"Y":E="X"===T.upAxis?"YtoX":"YtoZ";break;case"Z":E="X"===T.upAxis?"ZtoX":"ZtoY"}}(),m=P("library_images image",j,"image"),b=P("library_materials material",ot,"material"),x=P("library_effects effect",lt,"effect"),y=P("library_geometries geometry",Z,"geometry"),w=P("library_cameras camera",vt,"camera"),_=P("library_lights light",yt,"light"),g=P("library_controllers controller",B,"controller"),v=P("library_animations animation",dt,"animation"),o=P("library_visual_scenes visual_scene",G,"visual_scene"),a=P("library_kinematics_models kinematics_model",xt,"kinematics_model"),c=[],u=[],t=function(){var t=h.querySelectorAll("scene instance_visual_scene")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return o[e.length>0?e:"visual_scene0"]}return null}(),d=new r.Group;for(var O=0;O<t.nodes.length;O++)d.add(R(t.nodes[O]));d.scale.multiplyScalar(M),n=[],function e(r){var i=t.getChildById(r.colladaId,!0),o=null;if(i&&i.keys){n.push(o={fps:60,hierarchy:[{node:i,keys:i.keys,sids:i.sids}],node:r,name:"animation_"+r.name,length:0});for(var a=0,s=i.keys.length;a<s;a++)o.length=Math.max(o.length,i.keys[a].time)}else o={hierarchy:[{keys:[],sids:[]}]};for(a=0,s=r.children.length;a<s;a++)for(var c=0,u=e(r.children[a]).hierarchy.length;c<u;c++)o.hierarchy.push({keys:[],sids:[]});return o}(d),e=function(){var t=h.querySelectorAll("instance_kinematics_model")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return a[e.length>0?e:"kinematics_model0"]}return null}(),function(){if(e&&0===e.joints.length)i=void 0;else{var n={},o=function(r,i){var o=i.getAttribute("id"),a=t.getChildById(o,!0),s=e.joints[r];d.traverse(function(t){t.colladaId==o&&(n[r]={node:t,transforms:a.transforms,joint:s,position:s.zeroPosition})})};i={joints:e&&e.joints,getJointValue:function(t){var e=n[t];if(e)return e.position;console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue:function(t,e){var i=n[t];if(i){var o=i.joint;if(e>o.limits.max||e<o.limits.min)console.log("setJointValue: joint "+t+" value "+e+" outside of limits (min: "+o.limits.min+", max: "+o.limits.max+")");else if(o.static)console.log("setJointValue: joint "+t+" is static");else{var a=i.node,c=o.axis,u=i.transforms,l=new r.Matrix4;for(s=0;s<u.length;s++){var h=u[s];if(h.sid&&-1!==h.sid.indexOf("joint"+t))switch(o.type){case"revolute":l.multiply(d.makeRotationAxis(c,r.Math.degToRad(e)));break;case"prismatic":l.multiply(d.makeTranslation(c.x*e,c.y*e,c.z*e));break;default:console.warn("setJointValue: unknown joint type: "+o.type)}else{var d=new r.Matrix4;switch(h.type){case"matrix":l.multiply(h.obj);break;case"translate":l.multiply(d.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"rotate":l.multiply(d.makeRotationAxis(h.obj,h.angle))}}}var p=Array.prototype.slice.call(l.elements);a.matrix.set.apply(a.matrix,[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]]),a.matrix.decompose(a.position,a.quaternion,a.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};var a=h.querySelector("scene instance_kinematics_scene");if(a)for(var s=0;s<a.childNodes.length;s++){var c=a.childNodes[s];if(1==c.nodeType)switch(c.nodeName){case"bind_joint_axis":var u=c.getAttribute("target").split("/").pop(),l=c.querySelector("axis param").textContent,p=parseInt(l.split("joint").pop().split(".")[0]),f=h.querySelector('[sid="'+u+'"]');f&&o(p,f.parentElement)}}}}();var N={scene:d,morphs:c,skins:u,animations:n,kinematics:i,dae:{images:m,materials:b,cameras:w,lights:_,effects:x,geometries:y,controllers:g,animations:v,visualScenes:o,visualScene:t,scene:t,kinematicsModels:a,kinematicsModel:e}};return f&&f(N),N}function P(t,e,n){for(var r=h.querySelectorAll(t),i={},o=0,a=r.length,s=0;s<a;s++){var c=r[s],u=(new e).parse(c);u.id&&0!==u.id.length||(u.id=n+o++),i[u.id]=u}return i}function O(t,e){var n=e instanceof X?g[e.url]:e;if(n&&n.morph){for(var r=n.morph,i=0;i<r.targets.length;i++){var o=y[r.targets[i]];if(o.mesh&&o.mesh.primitives&&o.mesh.primitives.length){var a=o.mesh.primitives[0].geometry;a.vertices.length===t.vertices.length&&t.morphTargets.push({name:"target_1",vertices:a.vertices})}}t.morphTargets.push({name:"target_Z",vertices:t.vertices})}else console.log("could not find morph controller!")}function N(t,e,n,i){if(t.world=t.world||new r.Matrix4,t.localworld=t.localworld||new r.Matrix4,t.world.copy(t.matrix),t.localworld.copy(t.matrix),t.channels&&t.channels.length){var o=t.channels[0].sampler.output[n];o instanceof r.Matrix4&&(t.world.copy(o),t.localworld.copy(o),0===n&&t.matrix.copy(o))}i&&t.world.multiplyMatrices(i,t.world),e.push(t);for(var a=0;a<t.nodes.length;a++)N(t.nodes[a],e,n,t.world)}function L(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=-1;if("JOINT"==i.type){for(var a=0;a<e.joints.length;a++)if(i.sid===e.joints[a]){o=a;break}if(o>=0){var s=e.invBindMatrices[o];for(i.invBindMatrix=s,i.skinningMatrix=new r.Matrix4,i.skinningMatrix.multiplyMatrices(i.world,s),i.animatrix=new r.Matrix4,i.animatrix.copy(i.localworld),i.weights=[],a=0;a<e.weights.length;a++)for(var c=0;c<e.weights[a].length;c++){var u=e.weights[a][c];u.joint===o&&i.weights.push(u)}}else console.warn("ColladaLoader: Could not find joint '"+i.sid+"'."),i.skinningMatrix=new r.Matrix4,i.weights=[]}}}function I(e,n,i){var o=g[n.url];if(i=void 0!==i?i:40,o&&o.skin)if(n.skeleton&&n.skeleton.length){for(var a=function(){var t,e=1e6,n=-e,r=0;for(var i in v){var o=v[i];t=t||o.id;for(var a=0;a<o.sampler.length;a++){var s=o.sampler[a];s.create(),e=Math.min(e,s.startTime),n=Math.max(n,s.endTime),r=Math.max(r,s.input.length)}}return{start:e,end:n,frames:r,ID:t}}(),s=t.getChildById(n.skeleton[0],!0)||t.getChildBySid(n.skeleton[0],!0),c=function(t){var e=[],n=function(t,e,i){var o={};o.name=e.sid,o.parent=t,o.matrix=e.matrix;var a=[new r.Vector3,new r.Quaternion,new r.Vector3];for(var s in o.matrix.decompose(a[0],a[1],a[2]),o.pos=[a[0].x,a[0].y,a[0].z],o.scl=[a[2].x,a[2].y,a[2].z],o.rotq=[a[1].x,a[1].y,a[1].z,a[1].w],i.push(o),e.nodes)n(e.sid,e.nodes[s],i)};return n(-1,t,e),e}(s),u=o.skin.joints,l=[],h=0;h<u.length;h++)for(var d=0;d<c.length;d++)c[d].name===u[h]&&(l[h]=c[d]);for(h=0;h<l.length;h++)for(d=0;d<l.length;d++)l[h].parent===l[d].name&&(l[h].parent=d);for(new r.Vector3,h=0;h<e.vertices.length;h++)e.vertices[h].applyMatrix4(o.skin.bindShapeMatrix);var p=[],f=[],m=o.skin.weights;for(h=0;h<m.length;h++){var y=new r.Vector4(m[h][0]?m[h][0].joint:0,m[h][1]?m[h][1].joint:0,m[h][2]?m[h][2].joint:0,m[h][3]?m[h][3].joint:0),b=new r.Vector4(m[h][0]?m[h][0].weight:0,m[h][1]?m[h][1].weight:0,m[h][2]?m[h][2].weight:0,m[h][3]?m[h][3].weight:0);p.push(y),f.push(b)}e.skinIndices=p,e.skinWeights=f,e.bones=l;var x={name:a.ID,fps:30,length:a.frames/30,hierarchy:[]};for(d=0;d<l.length;d++)x.hierarchy.push({parent:l[d].parent,name:l[d].name,keys:[]});for(console.log("ColladaLoader:",a.ID+" has "+l.length+" bones."),function(t,e,n){var i=[];N(e,i,-1),L(i,n.skin);for(var o=new r.Vector3,a=[],s=0;s<t.vertices.length;s++)a.push(new r.Vector3);for(s=0;s<i.length;s++)if("JOINT"==i[s].type)for(var c=0;c<i[s].weights.length;c++){var u=i[s].weights[c],l=u.index,h=u.weight,d=t.vertices[l],p=a[l];o.x=d.x,o.y=d.y,o.z=d.z,o.applyMatrix4(i[s].skinningMatrix),p.x+=o.x*h,p.y+=o.y*h,p.z+=o.z*h}for(s=0;s<t.vertices.length;s++)t.vertices[s]=a[s]}(e,s,o),i=0;i<a.frames;i++){var w=[];for(N(s,w,i),L(w,o.skin),h=0;h<w.length;h++)for(d=0;d<x.hierarchy.length;d++)if(x.hierarchy[d].name===w[h].sid){var _={};_.time=i/30,_.matrix=w[h].animatrix,0===i&&(w[h].matrix=_.matrix);var S=[new r.Vector3,new r.Quaternion,new r.Vector3];_.matrix.decompose(S[0],S[1],S[2]),_.pos=[S[0].x,S[0].y,S[0].z],_.scl=[S[2].x,S[2].y,S[2].z],_.rot=S[1],x.hierarchy[d].keys.push(_)}e.animation=x}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function R(t,e){var n,i,o,a,s=new r.Object3D;for(o=0;o<t.controllers.length;o++){var l=g[t.controllers[o].url];switch(l.type){case"skin":if(y[l.skin.source])(d=new Y).url=l.skin.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d),n=t.controllers[o];else if(g[l.skin.source]){var h=g[l.skin.source];i=h,h.morph&&y[h.morph.source]&&((d=new Y).url=h.morph.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d))}break;case"morph":var d;y[l.morph.source]&&((d=new Y).url=l.morph.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d),i=t.controllers[o]),console.log("ColladaLoader: Morph-controller partially supported.")}}var p={};for(o=0;o<t.geometries.length;o++){var f,m=t.geometries[o],v=m.instance_material,S=y[m.url],M={},A=[],E=0;if(S){if(!S.mesh||!S.mesh.primitives)continue;if(0===s.name.length&&(s.name=S.id),v)for(a=0;a<v.length;a++){var C=v[a],P=b[C.target],N=x[P.instance_effect.url].shader.material;if(S.doubleSided){if(!(C.symbol in p)){var L=N.clone();L.side=r.DoubleSide,p[C.symbol]=L}N=p[C.symbol]}N.opacity=N.opacity?N.opacity:1,M[C.symbol]=E,A.push(N),(f=N).name=null===P.name||""===P.name?P.id:P.name,E++}var D,F=f||new r.MeshLambertMaterial({color:14540253,side:S.doubleSided?r.DoubleSide:r.FrontSide}),U=S.mesh.geometry3js;E>1&&(F=new r.MultiMaterial(A)),void 0!==n?(I(U,n),U.morphTargets.length>0?(F.morphTargets=!0,F.skinning=!1):(F.morphTargets=!1,F.skinning=!0),(D=new r.SkinnedMesh(U,F,!1)).name="skin_"+u.length,u.push(D)):void 0!==i?(O(U,i),F.morphTargets=!0,(D=new r.Mesh(U,F)).name="morph_"+c.length,c.push(D)):D=!0===U.isLineStrip?new r.Line(U):new r.Mesh(U,F),s.add(D)}}for(o=0;o<t.cameras.length;o++){var k=w[t.cameras[o].url],j=new r.PerspectiveCamera(k.yfov,parseFloat(k.aspect_ratio),parseFloat(k.znear),parseFloat(k.zfar));s.add(j)}for(o=0;o<t.lights.length;o++){var B=null,z=_[t.lights[o].url];if(z&&z.technique){var V=z.color.getHex(),G=z.intensity,H=z.distance,W=z.falloff_angle;switch(z.technique){case"directional":(B=new r.DirectionalLight(V,G,H)).position.set(0,0,1);break;case"point":B=new r.PointLight(V,G,H);break;case"spot":(B=new r.SpotLight(V,G,H,W)).position.set(0,0,1);break;case"ambient":B=new r.AmbientLight(V)}}B&&s.add(B)}if(s.name=t.name||t.id||"",s.colladaId=t.id||"",s.layer=t.layer||"",s.matrix=t.matrix,s.matrix.decompose(s.position,s.quaternion,s.scale),T.centerGeometry&&s.geometry){var X=s.geometry.center();X.multiply(s.scale),X.applyQuaternion(s.quaternion),s.position.sub(X)}for(o=0;o<t.nodes.length;o++)s.add(R(t.nodes[o]));return s}function D(t){for(var e=h.querySelectorAll("library_nodes node"),n=0;n<e.length;n++){var r=e[n].attributes.getNamedItem("id");if(r&&r.value===t)return e[n]}}function F(t,e){for(var n=null,r=0,i=t.length;r<i&&null===n;r++){var o=t[r];if(o.time===e)n=o;else if(o.time>e)break}return n}function U(t,e){for(var n=-1,r=0,i=t.length;r<i&&-1===n;r++)t[r].time>=e&&(n=r);return n}function k(t,e,n,r){var i=function(t,e,n){for(n=n>=0?n:n+t.length;n>=0;n--){var r=t[n];if(r.hasTarget(e))return r}return null}(t,r,n?n-1:0),o=function(t,e,n){for(;n<t.length;n++){var r=t[n];if(r.hasTarget(e))return r}return null}(t,r,n+1);if(i&&o){var a,s=(e.time-i.time)/(o.time-i.time),c=i.getTarget(r),u=o.getTarget(r).data,l=c.data;if("matrix"===c.type)a=l;else if(l.length){a=[];for(var h=0;h<l.length;++h)a[h]=l[h]+(u[h]-l[h])*s}else a=l+(u-l)*s;e.addTarget(r,c.transform,c.member,a)}}function j(){this.id="",this.init_from=""}function B(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function z(){this.method=null,this.source=null,this.targets=null,this.weights=null}function V(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function G(){this.id="",this.name="",this.nodes=[],this.scene=new r.Group}function H(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new r.Matrix4}function W(){this.sid="",this.type="",this.data=[],this.obj=null}function X(){this.url="",this.skeleton=[],this.instance_material=[]}function q(){this.symbol="",this.target=""}function Y(){this.url="",this.instance_material=[]}function Z(){this.id="",this.mesh=null}function J(t){this.geometry=t.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function Q(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new r.Geometry}function K(){Q.call(this),this.vcount=[]}function $(){Q.call(this),this.vcount=1}function tt(){Q.call(this),this.vcount=3}function et(){this.source="",this.count=0,this.stride=0,this.params=[]}function nt(){this.input={}}function rt(){this.semantic="",this.offset=0,this.source="",this.set=0}function it(t){this.id=t,this.type=null}function ot(){this.id="",this.name="",this.instance_effect=null}function at(){this.color=new r.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function st(t,e){this.type=t,this.effect=e,this.material=null}function ct(t){this.effect=t,this.init_from=null,this.format=null}function ut(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function lt(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function ht(){this.url=""}function dt(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function pt(t){this.animation=t,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function ft(t){this.id="",this.animation=t,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function mt(t){this.targets=[],this.time=t}function vt(){this.id="",this.name="",this.technique=""}function gt(){this.url=""}function yt(){this.id="",this.name="",this.technique=""}function bt(){this.url=""}function xt(){this.id="",this.name="",this.joints=[],this.links=[]}function wt(){this.sid="",this.name="",this.axis=new r.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function _t(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function St(){this.joint="",this.transforms=[],this.links=[]}function Tt(t){var e=t.getAttribute("id");return void 0!=f[e]?f[e]:(f[e]=new it(e).parse(t),f[e])}function Mt(t){for(var e=Ct(t),n=[],r=0,i=e.length;r<i;r++)n.push("true"===e[r]||"1"===e[r]);return n}function At(t){for(var e=Ct(t),n=[],r=0,i=e.length;r<i;r++)n.push(parseFloat(e[r]));return n}function Et(t){for(var e=Ct(t),n=[],r=0,i=e.length;r<i;r++)n.push(parseInt(e[r],10));return n}function Ct(t){return t.length>0?function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}(t).split(/\s+/):[]}function Pt(t,e,n){return t.hasAttribute(e)?parseInt(t.getAttribute(e),10):n}function Ot(t,e){(new r.ImageLoader).load(e,function(e){t.image=e,t.needsUpdate=!0})}function Nt(t,e){t.doubleSided=!1;var n=e.querySelectorAll("extra double_sided")[0];n&&n&&1===parseInt(n.textContent,10)&&(t.doubleSided=!0)}function Lt(t,e){if(!0===T.convertUpAxis&&A!==T.upAxis)switch(E){case"XtoY":var n=t[0];t[0]=e*t[1],t[1]=n;break;case"XtoZ":n=t[2],t[2]=t[1],t[1]=t[0],t[0]=n;break;case"YtoX":n=t[0],t[0]=t[1],t[1]=e*n;break;case"YtoZ":n=t[1],t[1]=e*t[2],t[2]=n;break;case"ZtoX":n=t[0],t[0]=t[1],t[1]=t[2],t[2]=n;break;case"ZtoY":n=t[1],t[1]=t[2],t[2]=e*n}}function It(t,e){var n=[t[e],t[e+1],t[e+2]];return Lt(n,-1),new r.Vector3(n[0],n[1],n[2])}function Rt(t){if(T.convertUpAxis){var e=[t[0],t[4],t[8]];Lt(e,-1),t[0]=e[0],t[4]=e[1],t[8]=e[2],Lt(e=[t[1],t[5],t[9]],-1),t[1]=e[0],t[5]=e[1],t[9]=e[2],Lt(e=[t[2],t[6],t[10]],-1),t[2]=e[0],t[6]=e[1],t[10]=e[2],Lt(e=[t[0],t[1],t[2]],-1),t[0]=e[0],t[1]=e[1],t[2]=e[2],Lt(e=[t[4],t[5],t[6]],-1),t[4]=e[0],t[5]=e[1],t[6]=e[2],Lt(e=[t[8],t[9],t[10]],-1),t[8]=e[0],t[9]=e[1],t[10]=e[2],Lt(e=[t[3],t[7],t[11]],-1),t[3]=e[0],t[7]=e[1],t[11]=e[2]}return(new r.Matrix4).set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Dt(t){if(T.convertUpAxis)switch(t){case"X":switch(E){case"XtoY":case"XtoZ":case"YtoX":t="Y";break;case"ZtoX":t="Z"}break;case"Y":switch(E){case"XtoY":case"YtoX":case"ZtoX":t="X";break;case"XtoZ":case"YtoZ":case"ZtoY":t="Z"}break;case"Z":switch(E){case"XtoZ":t="X";break;case"YtoZ":case"ZtoX":case"ZtoY":t="Y"}}return t}return j.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];"init_from"===n.nodeName&&(this.init_from=n.textContent)}return this},B.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.type="none";for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"skin":this.skin=(new V).parse(n),this.type=n.nodeName;break;case"morph":this.morph=(new z).parse(n),this.type=n.nodeName}}return this},z.prototype.parse=function(t){var e,n={},r=[];for(this.method=t.getAttribute("method"),this.source=t.getAttribute("source").replace(/^#/,""),e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":n[(a=(new it).parse(i)).id]=a;break;case"targets":r=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(e=0;e<r.length;e++){var o=r[e],a=n[o.source];switch(o.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read()}}return this},z.prototype.parseInputs=function(t){for(var e=[],n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType)switch(r.nodeName){case"input":e.push((new rt).parse(r))}}return e},V.prototype.parse=function(t){var e,n,r={};this.source=t.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var a=At(o.textContent);this.bindShapeMatrix=Rt(a);break;case"source":var s=(new it).parse(o);r[s.id]=s;break;case"joints":e=o;break;case"vertex_weights":n=o;break;default:console.log(o.nodeName)}}return this.parseJoints(e,r),this.parseWeights(n,r),this},V.prototype.parseJoints=function(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType)switch(r.nodeName){case"input":var i=(new rt).parse(r),o=e[i.source];"JOINT"===i.semantic?this.joints=o.read():"INV_BIND_MATRIX"===i.semantic&&(this.invBindMatrices=o.read())}}},V.prototype.parseWeights=function(t,e){for(var n,r,i=[],o=0;o<t.childNodes.length;o++){var a=t.childNodes[o];if(1==a.nodeType)switch(a.nodeName){case"input":i.push((new rt).parse(a));break;case"v":n=Et(a.textContent);break;case"vcount":r=Et(a.textContent)}}var s=0;for(o=0;o<r.length;o++){for(var c=r[o],u=[],l=0;l<c;l++){for(var h={},d=0;d<i.length;d++){var p=i[d],f=n[s+p.offset];switch(p.semantic){case"JOINT":h.joint=f;break;case"WEIGHT":h.weight=e[p.source].data[f]}}u.push(h),s+=i.length}for(l=0;l<u.length;l++)u[l].index=o;this.weights.push(u)}},G.prototype.getChildById=function(t,e){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(t,e);if(r)return r}return null},G.prototype.getChildBySid=function(t,e){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(t,e);if(r)return r}return null},G.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.nodes=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"node":this.nodes.push((new H).parse(n))}}return this},H.prototype.getChannelForTransform=function(t){for(var e=0;e<this.channels.length;e++){var n,r=this.channels[e],i=r.target.split("/"),o=(i.shift(),i.shift()),a=o.indexOf(".")>=0,s=o.indexOf("(")>=0;if(a)o=(i=o.split(".")).shift(),i.shift();else if(s){o=(n=o.split("(")).shift();for(var c=0;c<n.length;c++)n[c]=parseInt(n[c].replace(/\)/,""))}if(o===t)return r.info={sid:o,dotSyntax:a,arrSyntax:s,arrIndices:n},r}return null},H.prototype.getChildById=function(t,e){if(this.id===t)return this;if(e)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(t,e);if(r)return r}return null},H.prototype.getChildBySid=function(t,e){if(this.sid===t)return this;if(e)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(t,e);if(r)return r}return null},H.prototype.getTransformBySid=function(t){for(var e=0;e<this.transforms.length;e++)if(this.transforms[e].sid===t)return this.transforms[e];return null},H.prototype.parse=function(t){this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.layer=t.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new r.Matrix4;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"node":this.nodes.push((new H).parse(n));break;case"instance_camera":this.cameras.push((new gt).parse(n));break;case"instance_controller":this.controllers.push((new X).parse(n));break;case"instance_geometry":this.geometries.push((new Y).parse(n));break;case"instance_light":this.lights.push((new bt).parse(n));break;case"instance_node":var i=D(n.getAttribute("url").replace(/^#/,""));i&&this.nodes.push((new H).parse(i));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new W).parse(n));break;case"extra":break;default:console.log(n.nodeName)}}return this.channels=function(t){var e=[],n=1e6,r=-1e6;for(var i in v)for(var o=v[i],a=0;a<o.channel.length;a++){var s=o.channel[a],c=o.sampler[a];(i=s.target.split("/")[0])==t.id&&(c.create(),s.sampler=c,n=Math.min(n,c.startTime),r=Math.max(r,c.endTime),e.push(s))}return e.length&&(t.startTime=n,t.endTime=r),e}(this),function(t){if(t.channels&&t.channels.length){for(var e=[],n=[],r=0,i=t.channels.length;r<i;r++){var o,a=t.channels[r],s=a.fullSid,c=a.sampler,u=c.input,l=t.getTransformBySid(a.sid);if(a.arrIndices){o=[];for(var h=0,d=a.arrIndices.length;h<d;h++)o[h]=((y=a.arrIndices[h])>-1&&y<3&&(y={X:0,Y:1,Z:2}[y=Dt(["X","Y","Z"][y])]),y)}else o=Dt(a.member);if(l)for(-1===n.indexOf(s)&&n.push(s),h=0,d=u.length;h<d;h++){var p=u[h],f=c.getData(l.type,h,o);if(!(g=F(e,p))){g=new mt(p);var m=U(e,p);e.splice(-1===m?e.length:m,0,g)}g.addTarget(s,l,o,f)}else console.log('Could not find transform "'+a.sid+'" in node '+t.id)}for(r=0;r<n.length;r++){var v=n[r];for(h=0;h<e.length;h++){var g;(g=e[h]).hasTarget(v)||k(e,g,h,v)}}t.keys=e,t.sids=n}var y}(this),this.updateMatrix(),this},H.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},W.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=At(t.textContent),this.convert(),this},W.prototype.convert=function(){switch(this.type){case"matrix":this.obj=Rt(this.data);break;case"rotate":this.angle=r.Math.degToRad(this.data[3]);case"translate":Lt(this.data,-1),this.obj=new r.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Lt(this.data,1),this.obj=new r.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},W.prototype.apply=(l=new r.Matrix4,function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(l.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(l.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}),W.prototype.update=function(t,e){var n=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else 2===e.length?this.obj["n"+(e[0]+1)+(e[1]+1)]=t:console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=n[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=n[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=r.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=r.Math.degToRad(t[3])}}},X.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1===n.nodeType)switch(n.nodeName){case"skeleton":this.skeleton.push(n.textContent.replace(/^#/,""));break;case"bind_material":for(var r=n.querySelectorAll("instance_material"),i=0;i<r.length;i++){var o=r[i];this.instance_material.push((new q).parse(o))}}}return this},q.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},Y.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"bind_material"===n.nodeName){for(var r=n.querySelectorAll("instance_material"),i=0;i<r.length;i++){var o=r[i];this.instance_material.push((new q).parse(o))}break}}return this},Z.prototype.parse=function(t){this.id=t.getAttribute("id"),Nt(this,t);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"mesh":this.mesh=new J(this).parse(n)}}return this},J.prototype.parse=function(t){this.primitives=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"source":Tt(n);break;case"vertices":this.vertices=(new nt).parse(n);break;case"linestrips":this.primitives.push((new $).parse(n));break;case"triangles":this.primitives.push((new tt).parse(n));break;case"polygons":this.primitives.push((new Q).parse(n));break;case"polylist":this.primitives.push((new K).parse(n))}}if(this.geometry3js=new r.Geometry,null===this.vertices)return this;var i=f[this.vertices.input.POSITION.source].data;for(e=0;e<i.length;e+=3)this.geometry3js.vertices.push(It(i,e).clone());for(e=0;e<this.primitives.length;e++){var o=this.primitives[e];o.setVertices(this.vertices),this.handlePrimitive(o,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},J.prototype.handlePrimitive=function(t,e){if(t instanceof $)e.isLineStrip=!0;else{var n,i,o,a,s,c,u,l=t.p,h=t.inputs,d=0,p=3,m=0,v=[];for(n=0;n<h.length;n++){var g=(o=h[n]).offset+1;switch(m=m<g?g:m,o.semantic){case"TEXCOORD":v.push(o.set)}}for(var y=0;y<l.length;++y)for(var b=l[y],x=0;x<b.length;){var w=[],_=[],S=null,M=[];for(p=t.vcount?t.vcount.length?t.vcount[d++]:t.vcount:b.length/m,n=0;n<p;n++)for(i=0;i<h.length;i++)switch(s=(a=b[x+n*m+(o=h[i]).offset])*(u=(c=f[o.source]).accessor.params.length),o.semantic){case"VERTEX":w.push(a);break;case"NORMAL":_.push(It(c.data,s));break;case"TEXCOORD":void 0===(S=S||{})[o.set]&&(S[o.set]=[]),S[o.set].push(new r.Vector2(c.data[s],c.data[s+1]));break;case"COLOR":M.push((new r.Color).setRGB(c.data[s],c.data[s+1],c.data[s+2]))}if(0===_.length)if(o=this.vertices.input.NORMAL){u=(c=f[o.source]).accessor.params.length;for(var A=0,E=w.length;A<E;A++)_.push(It(c.data,w[A]*u))}else e.calcNormals=!0;if(!S&&(S={},o=this.vertices.input.TEXCOORD))for(v.push(o.set),u=(c=f[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)s=w[A]*u,void 0===S[o.set]&&(S[o.set]=[]),S[o.set].push(new r.Vector2(c.data[s],1-c.data[s+1]));if(0===M.length&&(o=this.vertices.input.COLOR))for(u=(c=f[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)s=w[A]*u,M.push((new r.Color).setRGB(c.data[s],c.data[s+1],c.data[s+2]));var C,P,O=null,N=[];if(3===p)N.push(new r.Face3(w[0],w[1],w[2],_,M.length?M:new r.Color));else if(4===p)N.push(new r.Face3(w[0],w[1],w[3],_.length?[_[0].clone(),_[1].clone(),_[3].clone()]:[],M.length?[M[0],M[1],M[3]]:new r.Color)),N.push(new r.Face3(w[1],w[2],w[3],_.length?[_[1].clone(),_[2].clone(),_[3].clone()]:[],M.length?[M[1],M[2],M[3]]:new r.Color));else if(p>4&&T.subdivideFaces){var L=M.length?M:new r.Color;for(i=1;i<p-1;)N.push(new r.Face3(w[0],w[i],w[i+1],_.length?[_[0].clone(),_[i++].clone(),_[i].clone()]:[],L))}if(N.length)for(A=0,E=N.length;A<E;A++)for((O=N[A]).daeMaterial=t.material,e.faces.push(O),i=0;i<v.length;i++)C=S[v[i]],P=p>4?[C[0],C[A+1],C[A+2]]:4===p?0===A?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],void 0===e.faceVertexUvs[i]&&(e.faceVertexUvs[i]=[]),e.faceVertexUvs[i].push(P);else console.log("dropped face with vcount "+p+" for geometry with id: "+e.id);x+=m*p}}},Q.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source===t.id&&(this.inputs[e].source=t.input.POSITION.source)},Q.prototype.parse=function(t){this.material=t.getAttribute("material"),this.count=Pt(t,"count",0);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"input":this.inputs.push((new rt).parse(t.childNodes[e]));break;case"vcount":this.vcount=Et(n.textContent);break;case"p":this.p.push(Et(n.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},(K.prototype=Object.create(Q.prototype)).constructor=K,($.prototype=Object.create(Q.prototype)).constructor=$,(tt.prototype=Object.create(Q.prototype)).constructor=tt,et.prototype.parse=function(t){this.params=[],this.source=t.getAttribute("source"),this.count=Pt(t,"count",0),this.stride=Pt(t,"stride",0);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if("param"===n.nodeName){var r={};r.name=n.getAttribute("name"),r.type=n.getAttribute("type"),this.params.push(r)}}return this},nt.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++)if("input"===t.childNodes[e].nodeName){var n=(new rt).parse(t.childNodes[e]);this.input[n.semantic]=n}return this},rt.prototype.parse=function(t){return this.semantic=t.getAttribute("semantic"),this.source=t.getAttribute("source").replace(/^#/,""),this.set=Pt(t,"set",-1),this.offset=Pt(t,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},it.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"bool_array":this.data=Mt(n.textContent),this.type=n.nodeName;break;case"float_array":this.data=At(n.textContent),this.type=n.nodeName;break;case"int_array":this.data=Et(n.textContent),this.type=n.nodeName;break;case"IDREF_array":case"Name_array":this.data=Ct(n.textContent),this.type=n.nodeName;break;case"technique_common":for(var r=0;r<n.childNodes.length;r++)if("accessor"===n.childNodes[r].nodeName){this.accessor=(new et).parse(n.childNodes[r]);break}}}return this},it.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var n=0;n<this.data.length;n+=16){var r=Rt(this.data.slice(n,n+16));t.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},ot.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"===t.childNodes[e].nodeName){this.instance_effect=(new ht).parse(t.childNodes[e]);break}return this},at.prototype.isColor=function(){return null===this.texture},at.prototype.isTexture=function(){return null!=this.texture},at.prototype.parse=function(t){"transparent"===t.nodeName&&(this.opaque=t.getAttribute("opaque"));for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"color":var i=At(n.textContent);this.color=new r.Color,this.color.setRGB(i[0],i[1],i[2]),this.color.a=i[3];break;case"texture":this.texture=n.getAttribute("texture"),this.texcoord=n.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(n)}}return this},at.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&(t=t.childNodes[1]).childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":this.texOpts[n.nodeName]="TRUE"===n.textContent.toUpperCase()?1:parseInt(n.textContent);break;default:this.texOpts[n.nodeName]=n.textContent}}return this},st.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[n.nodeName]=(new at).parse(n);break;case"bump":var r=n.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new at).parse(n):"normalmap"===r.toLowerCase()?this.normal=(new at).parse(n):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new at).parse(n)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new at).parse(n));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var i=n.querySelectorAll("float");i.length>0&&(this[n.nodeName]=parseFloat(i[0].textContent))}}return this.create(),this},st.prototype.create=function(){var t={},e=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var n=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;n>0&&(e=!0,t.transparent=!0,t.opacity=1-n)}var i={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var o in this)switch(o){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var a=this[o];if(a instanceof at)if(a.isTexture()){var c=this.effect.sampler[a.texture];if(void 0!==c&&void 0!==c.source){var u=this.effect.surface[c.source];if(void 0!==u){var l=m[u.init_from];if(l){var h,d=s+l.init_from,p=r.Loader.Handlers.get(d);null!==p?h=p.load(d):Ot(h=new r.Texture,d),h.wrapS=a.texOpts.wrapU?r.RepeatWrapping:r.ClampToEdgeWrapping,h.wrapT=a.texOpts.wrapV?r.RepeatWrapping:r.ClampToEdgeWrapping,h.offset.x=a.texOpts.offsetU,h.offset.y=a.texOpts.offsetV,h.repeat.x=a.texOpts.repeatU,h.repeat.y=a.texOpts.repeatV,t[i[o]]=h,"emission"===o&&(t.emissive=16777215)}}}}else"diffuse"!==o&&e||("emission"===o?t.emissive=a.color.getHex():t[o]=a.color.getHex());break;case"shininess":t[o]=this[o];break;case"reflectivity":t[o]=this[o],t[o]>0&&(t.envMap=T.defaultEnvMap),t.combine=r.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[o],1!==this[o]&&(t.envMap=T.defaultEnvMap)}switch(t.shading=S,t.side=this.effect.doubleSided?r.DoubleSide:r.FrontSide,void 0!==t.diffuse&&(t.color=t.diffuse,delete t.diffuse),this.type){case"constant":void 0!=t.emissive&&(t.color=t.emissive),this.material=new r.MeshBasicMaterial(t);break;case"phong":case"blinn":this.material=new r.MeshPhongMaterial(t);break;case"lambert":default:this.material=new r.MeshLambertMaterial(t)}return this.material},ct.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"init_from":this.init_from=n.textContent;break;case"format":this.format=n.textContent;break;default:console.log("unhandled Surface prop: "+n.nodeName)}}return this},ut.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"source":this.source=n.textContent;break;case"minfilter":this.minfilter=n.textContent;break;case"magfilter":this.magfilter=n.textContent;break;case"mipfilter":this.mipfilter=n.textContent;break;case"wrap_s":this.wrap_s=n.textContent;break;case"wrap_t":this.wrap_t=n.textContent;break;default:console.log("unhandled Sampler2D prop: "+n.nodeName)}}return this},lt.prototype.create=function(){if(null===this.shader)return null},lt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),Nt(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(n))}}return this},lt.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[e]=new ct(this).parse(r);break;case"sampler2D":this.sampler[e]=new ut(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},lt.prototype.parseProfileCOMMON=function(t){for(var e,n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":e=r;break;case"newparam":this.parseNewparam(r);break;case"image":var i=(new j).parse(r);m[i.id]=i;break;case"extra":break;default:console.log(r.nodeName)}}return e},lt.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new st(n.nodeName,this).parse(n);break;case"extra":this.parseExtra(n)}}},lt.prototype.parseExtra=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"technique":this.parseExtraTechnique(n)}}},lt.prototype.parseExtraTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"bump":this.shader.parse(t)}}},ht.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},dt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.source={};for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"animation":var r=(new dt).parse(n);for(var i in r.source)this.source[i]=r.source[i];for(var o=0;o<r.channel.length;o++)this.channel.push(r.channel[o]),this.sampler.push(r.sampler[o]);break;case"source":i=(new it).parse(n),this.source[i.id]=i;break;case"sampler":this.sampler.push(new ft(this).parse(n));break;case"channel":this.channel.push(new pt(this).parse(n))}}return this},pt.prototype.parse=function(t){this.source=t.getAttribute("source").replace(/^#/,""),this.target=t.getAttribute("target");var e=this.target.split("/"),n=(e.shift(),e.shift()),r=n.indexOf(".")>=0,i=n.indexOf("(")>=0;if(r)e=n.split("."),this.sid=e.shift(),this.member=e.shift();else if(i){var o=n.split("(");this.sid=o.shift();for(var a=0;a<o.length;a++)o[a]=parseInt(o[a].replace(/\)/,""));this.arrIndices=o}else this.sid=n;return this.fullSid=n,this.dotSyntax=r,this.arrSyntax=i,this},ft.prototype.parse=function(t){this.id=t.getAttribute("id"),this.inputs=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"input":this.inputs.push((new rt).parse(n))}}return this},ft.prototype.create=function(){for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],n=this.animation.source[e.source];switch(e.semantic){case"INPUT":this.input=n.read();break;case"OUTPUT":this.output=n.read(),this.strideOut=n.accessor.stride;break;case"INTERPOLATION":this.interpolation=n.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(e.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){for(this.startTime=1e8,this.endTime=-1e8,t=0;t<this.input.length;t++)this.startTime=Math.min(this.startTime,this.input[t]),this.endTime=Math.max(this.endTime,this.input[t]);this.duration=this.endTime-this.startTime}},ft.prototype.getData=function(t,e,n){var r;if("matrix"===t&&16===this.strideOut)r=this.output[e];else if(this.strideOut>1){r=[],e*=this.strideOut;for(var i=0;i<this.strideOut;++i)r[i]=this.output[e+i];if(3===this.strideOut)switch(t){case"rotate":case"translate":Lt(r,-1);break;case"scale":Lt(r,1)}else 4===this.strideOut&&"matrix"===t&&Lt(r,-1)}else r=this.output[e],n&&"translate"===t&&(r=function(t,e){if(!0!==T.convertUpAxis||A===T.upAxis)return e;switch(t){case"X":e="XtoY"===E?-1*e:e;break;case"Y":e="YtoZ"===E||"YtoX"===E?-1*e:e;break;case"Z":e="ZtoY"===E?-1*e:e}return e}(n,r));return r},mt.prototype.addTarget=function(t,e,n,r){this.targets.push({sid:t,member:n,transform:e,data:r})},mt.prototype.apply=function(t){for(var e=0;e<this.targets.length;++e){var n=this.targets[e];t&&n.sid!==t||n.transform.update(n.data,n.member)}},mt.prototype.getTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return this.targets[e];return null},mt.prototype.hasTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return!0;return!1},mt.prototype.interpolate=function(t,e){for(var n=0,r=this.targets.length;n<r;n++){var i,o=this.targets[n],a=t.getTarget(o.sid);if("matrix"!==o.transform.type&&a){var s=(e-this.time)/(t.time-this.time),c=a.data,u=o.data;if(s<0&&(s=0),s>1&&(s=1),u.length){i=[];for(var l=0;l<u.length;++l)i[l]=u[l]+(c[l]-u[l])*s}else i=u+(c-u)*s}else i=o.data;o.transform.update(i,o.member)}},vt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"optics":this.parseOptics(n)}}return this},vt.prototype.parseOptics=function(t){for(var e=0;e<t.childNodes.length;e++)if("technique_common"===t.childNodes[e].nodeName)for(var n=t.childNodes[e],r=0;r<n.childNodes.length;r++)if(this.technique=n.childNodes[r].nodeName,"perspective"===this.technique)for(var i=n.childNodes[r],o=0;o<i.childNodes.length;o++)switch((s=i.childNodes[o]).nodeName){case"yfov":this.yfov=s.textContent;break;case"xfov":this.xfov=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}else if("orthographic"===this.technique){var a=n.childNodes[r];for(o=0;o<a.childNodes.length;o++){var s;switch((s=a.childNodes[o]).nodeName){case"xmag":this.xmag=s.textContent;break;case"ymag":this.ymag=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}}}return this},gt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},yt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"technique_common":this.parseCommon(n);break;case"technique":this.parseTechnique(n)}}return this},yt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++)switch(t.childNodes[e].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=t.childNodes[e].nodeName;for(var n=t.childNodes[e],i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];switch(o.nodeName){case"color":var a=At(o.textContent);this.color=new r.Color(0),this.color.setRGB(a[0],a[1],a[2]),this.color.a=a[3];break;case"falloff_angle":this.falloff_angle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);this.distance=s?Math.sqrt(1/s):0}}}return this},yt.prototype.parseTechnique=function(t){this.profile=t.getAttribute("profile");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"intensity":this.intensity=parseFloat(n.textContent)}}return this},bt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},xt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.joints=[],this.links=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"technique_common":this.parseCommon(n)}}return this},xt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(t.childNodes[e].nodeName){case"joint":this.joints.push((new wt).parse(n));break;case"link":this.links.push((new _t).parse(n))}}return this},wt.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.axis=new r.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var e=At(t.querySelector("axis").textContent);this.axis=It(e,0);var n=t.querySelector("limits min")?parseFloat(t.querySelector("limits min").textContent):-360,i=t.querySelector("limits max")?parseFloat(t.querySelector("limits max").textContent):360;this.limits={min:n,max:i};for(var o=["prismatic","revolute"],a=0;a<o.length;a++){var s=o[a];t.querySelector(s)&&(this.type=s)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},_t.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.transforms=[],this.attachments=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"attachment_full":this.attachments.push((new St).parse(n));break;case"rotate":case"translate":case"matrix":this.transforms.push((new W).parse(n))}}return this},St.prototype.parse=function(t){this.joint=t.getAttribute("joint").split("/").pop(),this.links=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"link":this.links.push((new _t).parse(n));break;case"rotate":case"translate":case"matrix":this.transforms.push((new W).parse(n))}}return this},{load:function(t,e,n,r){var i=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState?0!==o.status&&200!==o.status||(o.response?(p=e,C(o.response,void 0,t)):r?r():console.error("ColladaLoader: Empty or non-existing file ("+t+")")):3===o.readyState&&n&&(0===i&&(i=o.getResponseHeader("Content-Length")),n({total:i,loaded:o.responseText.length}))},o.open("GET",t,!0),o.send(null)}else alert("Don't know how to parse XML!")},parse:C,setPreferredShading:function(t){S=t},applySkin:I,geometries:y,options:T}}},mImb:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=(r=n("kpDK"))&&r.__esModule?r:{default:r},a=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=this.renderer,n=e.context,r=t.worldTransform,i=e.resolution;e.roundPixels?n.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i|0,r.ty*i|0):n.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i,r.ty*i),e.context.globalAlpha=t.worldAlpha,e.setBlendMode(t.blendMode),t.drawMode===o.default.DRAW_MODES.TRIANGLE_MESH?this._renderTriangleMesh(t):this._renderTriangles(t)},t.prototype._renderTriangleMesh=function(t){for(var e=t.vertices.length/2,n=0;n<e-2;n++){var r=2*n;this._renderDrawTriangle(t,r,r+2,r+4)}},t.prototype._renderTriangles=function(t){for(var e=t.indices,n=e.length,r=0;r<n;r+=3)this._renderDrawTriangle(t,2*e[r],2*e[r+1],2*e[r+2])},t.prototype._renderDrawTriangle=function(t,e,n,r){var i=this.renderer.context,o=t.uvs,a=t.vertices,s=t._texture;if(s.valid){var c=s.baseTexture,u=c.source,l=c.width,h=c.height,d=void 0,p=void 0,f=void 0,m=void 0,v=void 0,g=void 0;if(t.uploadUvTransform){var y=t._uvTransform.mapCoord;d=(o[e]*y.a+o[e+1]*y.c+y.tx)*c.width,p=(o[n]*y.a+o[n+1]*y.c+y.tx)*c.width,f=(o[r]*y.a+o[r+1]*y.c+y.tx)*c.width,m=(o[e]*y.b+o[e+1]*y.d+y.ty)*c.height,v=(o[n]*y.b+o[n+1]*y.d+y.ty)*c.height,g=(o[r]*y.b+o[r+1]*y.d+y.ty)*c.height}else d=o[e]*c.width,p=o[n]*c.width,f=o[r]*c.width,m=o[e+1]*c.height,v=o[n+1]*c.height,g=o[r+1]*c.height;var b=a[e],x=a[n],w=a[r],_=a[e+1],S=a[n+1],T=a[r+1],M=t.canvasPadding/this.renderer.resolution;if(M>0){var A=M/Math.abs(t.worldTransform.a),E=M/Math.abs(t.worldTransform.d),C=(b+x+w)/3,P=(_+S+T)/3,O=b-C,N=_-P,L=Math.sqrt(O*O+N*N);b=C+O/L*(L+A),_=P+N/L*(L+E),N=S-P,x=C+(O=x-C)/(L=Math.sqrt(O*O+N*N))*(L+A),S=P+N/L*(L+E),N=T-P,w=C+(O=w-C)/(L=Math.sqrt(O*O+N*N))*(L+A),T=P+N/L*(L+E)}i.save(),i.beginPath(),i.moveTo(b,_),i.lineTo(x,S),i.lineTo(w,T),i.closePath(),i.clip();var I=d*v+m*f+p*g-v*f-m*p-d*g;i.transform((b*v+m*w+x*g-v*w-m*x-b*g)/I,(_*v+m*T+S*g-v*T-m*S-_*g)/I,(d*x+b*f+p*w-x*f-b*p-d*w)/I,(d*S+_*f+p*T-S*f-_*p-d*T)/I,(d*v*w+m*x*f+b*p*g-b*v*f-m*p*w-d*x*g)/I,(d*v*T+m*S*f+_*p*g-_*v*f-m*p*T-d*S*g)/I),i.drawImage(u,0,0,l*c.resolution,h*c.resolution,0,0,l,h),i.restore(),this.renderer.invalidateBlendMode()}},t.prototype.renderMeshFlat=function(t){var e=this.renderer.context,n=t.vertices,r=n.length/2;e.beginPath();for(var i=1;i<r-2;++i){var o=2*i,a=n[o+2],s=n[o+3],c=n[o+4],u=n[o+5];e.moveTo(n[o],n[o+1]),e.lineTo(a,s),e.lineTo(c,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},t.prototype.destroy=function(){this.renderer=null},t}();e.default=a,i.CanvasRenderer.registerPlugin("mesh",a)},mlJa:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E"));n("o/zv");var o=function(t){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));return n.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],n.alpha=1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._loadMatrix=function(t){var e=t;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this._multiply(e,this.uniforms.m,t),e=this._colorMatrix(e)),this.uniforms.m=e},e.prototype._multiply=function(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)},e.prototype.greyscale=function(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var n=Math.cos(t),r=Math.sin(t),i=1/3,o=(0,Math.sqrt)(i);this._loadMatrix([n+(1-n)*i,i*(1-n)-o*r,i*(1-n)+o*r,0,0,i*(1-n)+o*r,n+i*(1-n),i*(1-n)-o*r,0,0,i*(1-n)-o*r,i*(1-n)+o*r,n+i*(1-n),0,0,0,0,0,1,0],e)},e.prototype.contrast=function(t,e){var n=(t||0)+1,r=-.5*(n-1);this._loadMatrix([n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0],e)},e.prototype.saturate=function(){var t=2*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/3+1,e=-.5*(t-1);this._loadMatrix([t,e,e,0,0,e,t,e,0,0,e,e,t,0,0,0,0,0,1,0],arguments[1])},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,n,r,i){t=t||.2,e=e||.15;var o=((n=n||16770432)>>16&255)/255,a=(n>>8&255)/255,s=(255&n)/255,c=((r=r||3375104)>>16&255)/255,u=(r>>8&255)/255,l=(255&r)/255;this._loadMatrix([.3,.59,.11,0,0,o,a,s,t,0,c,u,l,e,0,o-c,a-u,s-l,0,0],i)},e.prototype.night=function(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)},e.prototype.predator=function(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},r(e,[{key:"matrix",get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t}},{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t}}]),e}(i.Filter);e.default=o,o.prototype.grayscale=o.prototype.greyscale},n5XU:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e[r.DRAW_MODES.POINTS]=t.POINTS,e[r.DRAW_MODES.LINES]=t.LINES,e[r.DRAW_MODES.LINE_LOOP]=t.LINE_LOOP,e[r.DRAW_MODES.LINE_STRIP]=t.LINE_STRIP,e[r.DRAW_MODES.TRIANGLES]=t.TRIANGLES,e[r.DRAW_MODES.TRIANGLE_STRIP]=t.TRIANGLE_STRIP,e[r.DRAW_MODES.TRIANGLE_FAN]=t.TRIANGLE_FAN,e};var r=n("FjAT")},n9CN:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e,n){var r=o(t),i=o(e);return Object.assign(r,i)};var r,i=((r=n("8QNu"))&&r.__esModule?r:{default:r}).default.shader.defaultValue;function o(t){for(var e=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"),n={},r=void 0,o=t.replace(/\s+/g," ").split(/\s*;\s*/),a=0;a<o.length;a++){var s=o[a].trim();if(s.indexOf("uniform")>-1){var c=s.split(" "),u=c[1],l=c[2],h=1;l.indexOf("[")>-1&&(l=(r=l.split(/\[|]/))[0],h*=Number(r[1])),l.match(e)||(n[l]={value:i(u,h),name:l,type:u})}}return n}},"nQP+":function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=(r=n("HVUN"))&&r.__esModule?r:{default:r},a=new o.default,s=function(){function t(e,n){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._texture=e,this.mapCoord=new o.default,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._lastTextureID=-1,this.clampOffset=0,this.clampMargin="undefined"==typeof n?.5:n}return t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var n=this.mapCoord,r=0;r<t.length;r+=2){var i=t[r],o=t[r+1];e[r]=i*n.a+o*n.c+n.tx,e[r+1]=i*n.b+o*n.d+n.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._lastTextureID===e._updateID)return!1;this._lastTextureID=e._updateID;var n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);var r=e.orig,i=e.trim;i&&(a.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(a));var o=e.baseTexture,s=this.uClampFrame,c=this.clampMargin/o.resolution,u=this.clampOffset;return s[0]=(e._frame.x+c+u)/o.width,s[1]=(e._frame.y+c+u)/o.height,s[2]=(e._frame.x+e._frame.width-c+u)/o.width,s[3]=(e._frame.y+e._frame.height-c+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,!0},i(t,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._lastTextureID=-1}}]),t}();e.default=s},nXuP:function(t,e,n){(function(e){var r=n("P2cu"),i=n("5+9/"),o=n("pnVU"),a=n("QamB"),s=n("Fy0/")("engine.io-client:polling-xhr");function c(){}function u(t){if(i.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,e.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=t.hostname!==e.location.hostname||r!==t.port,this.xs=t.secure!==n}}function l(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function h(){for(var t in l.requests)l.requests.hasOwnProperty(t)&&l.requests[t].abort()}t.exports=u,t.exports.Request=l,a(u,i),u.prototype.supportsBinary=!0,u.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new l(t)},u.prototype.doWrite=function(t,e){var n=this.request({method:"POST",data:t,isBinary:"string"!=typeof t&&void 0!==t}),r=this;n.on("success",e),n.on("error",function(t){r.onError("xhr post error",t)}),this.sendXhr=n},u.prototype.doPoll=function(){s("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},o(l.prototype),l.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new r(t),i=this;try{s("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.extraHeaders[o])}catch(t){}if("POST"===this.method)try{n.setRequestHeader("Content-type",this.isBinary?"application/octet-stream":"text/plain;charset=UTF-8")}catch(t){}try{n.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){i.onLoad()},n.onerror=function(){i.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState)try{var t=n.getResponseHeader("Content-Type");i.supportsBinary&&"application/octet-stream"===t&&(n.responseType="arraybuffer")}catch(t){}4===n.readyState&&(200===n.status||1223===n.status?i.onLoad():setTimeout(function(){i.onError(n.status)},0))},s("xhr data %s",this.data),n.send(this.data)}catch(t){return void setTimeout(function(){i.onError(t)},0)}e.document&&(this.index=l.requestsCount++,l.requests[this.index]=this)},l.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},l.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},l.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},l.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,t)try{this.xhr.abort()}catch(t){}e.document&&delete l.requests[this.index],this.xhr=null}},l.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},l.prototype.hasXDR=function(){return"undefined"!=typeof e.XDomainRequest&&!this.xs&&this.enablesXDR},l.prototype.abort=function(){this.cleanup()},l.requestsCount=0,l.requests={},e.document&&(e.attachEvent?e.attachEvent("onunload",h):e.addEventListener&&e.addEventListener("beforeunload",h,!1))}).call(e,n("DuR2"))},nfXk:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(){return function(t,e){t.data&&t.type===i.Resource.TYPE.IMAGE&&(t.texture=o.default.fromLoader(t.data,t.url,t.name)),e()}};var r,i=n("SMx8"),o=(r=n("qD+0"))&&r.__esModule?r:{default:r}},ngSy:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e,n){var r=t.shape,s=r.x,c=r.y,u=void 0,l=void 0;if(t.type===o.SHAPES.CIRC?(u=r.radius,l=r.radius):(u=r.width,l=r.height),0!==u&&0!==l){var h=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(r.width+r.height)),d=2*Math.PI/h;if(t.fill){var p=(0,a.hex2rgb)(t.fillColor),f=t.fillAlpha,m=p[0]*f,v=p[1]*f,g=p[2]*f,y=e.points,b=e.indices,x=y.length/6;b.push(x);for(var w=0;w<h+1;w++)y.push(s,c,m,v,g,f),y.push(s+Math.sin(d*w)*u,c+Math.cos(d*w)*l,m,v,g,f),b.push(x++,x++);b.push(x-1)}if(t.lineWidth){var _=t.points;t.points=[];for(var S=0;S<h+1;S++)t.points.push(s+Math.sin(d*S)*u,c+Math.cos(d*S)*l);(0,i.default)(t,e,n),t.points=_}}};var r,i=(r=n("FH9r"))&&r.__esModule?r:{default:r},o=n("FjAT"),a=n("aH6o")},"o/zv":function(t,e,n){(function(t){function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(t){return r.exec(t).slice(1)};function o(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}e.resolve=function(){for(var e="",r=!1,i=arguments.length-1;i>=-1&&!r;i--){var a=i>=0?arguments[i]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,r="/"===a.charAt(0))}return e=n(o(e.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+e||"."},e.normalize=function(t){var r=e.isAbsolute(t),i="/"===a(t,-1);return(t=n(o(t.split("/"),function(t){return!!t}),!r).join("/"))||r||(t="."),t&&i&&(t+="/"),(r?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(o(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var i=r(t.split("/")),o=r(n.split("/")),a=Math.min(i.length,o.length),s=a,c=0;c<a;c++)if(i[c]!==o[c]){s=c;break}var u=[];for(c=s;c<i.length;c++)u.push("..");return(u=u.concat(o.slice(s))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=i(t),n=e[0],r=e[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},e.basename=function(t,e){var n=i(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){return i(t)[3]};var a="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(e,n("W2nU"))},o3GV:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E"));n("o/zv");var o=function(t){function e(n,r){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=new i.Matrix;n.renderable=!1;var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));return a.maskSprite=n,a.maskMatrix=o,a.uniforms.mapSampler=n._texture,a.uniforms.filterMatrix=o,a.uniforms.scale={x:1,y:1},null!==r&&void 0!==r||(r=20),a.scale=new i.Point(r,r),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y,t.applyFilter(this,e,n)},r(e,[{key:"map",get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t}}]),e}(i.Filter);e.default=o},oCQ5:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("TToO"),i=function(t){function e(e){t.call(this),this.errors=e;var n=Error.call(this,e?e.length+" errors occurred during unsubscription:\n  "+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"");this.name=n.name="UnsubscriptionError",this.stack=n.stack,this.message=n.message}return Object(r.c)(e,t),e}(Error)},oUe4:function(t,e,n){"use strict";e.__esModule=!0,e.autoDetectRenderer=function(t,e,n,a){var s=t&&t.forceCanvas;return void 0!==a&&(s=a),!s&&r.isWebGLSupported()?new o.default(t,e,n):new i.default(t,e,n)};var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("aH6o")),i=a(n("5tzz")),o=a(n("qo3d"));function a(t){return t&&t.__esModule?t:{default:t}}},pnVU:function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if((n=r[i])===e||n.fn===e){r.splice(i,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e);return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},psuf:function(t,e,n){t.exports=n("Xqxu"),t.exports.parser=n("ElvI")},qC7s:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=10,a=function(t){function e(n,r,i,a,s){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,4,4));return c._origWidth=n.orig.width,c._origHeight=n.orig.height,c._width=c._origWidth,c._height=c._origHeight,c.leftWidth="undefined"!=typeof r?r:o,c.rightWidth="undefined"!=typeof a?a:o,c.topHeight="undefined"!=typeof i?i:o,c.bottomHeight="undefined"!=typeof s?s:o,c.refresh(!0),c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateHorizontalVertices=function(){var t=this.vertices;t[9]=t[11]=t[13]=t[15]=this._topHeight,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices;t[2]=t[10]=t[18]=t[26]=this._leftWidth,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._renderCanvas=function(t){var e=t.context;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode);var n=this.worldTransform,r=t.resolution;t.roundPixels?e.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r|0,n.ty*r|0):e.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r,n.ty*r);var i=this._texture.baseTexture,o=i.source,a=i.width*i.resolution,s=i.height*i.resolution;this.drawSegment(e,o,a,s,0,1,10,11),this.drawSegment(e,o,a,s,2,3,12,13),this.drawSegment(e,o,a,s,4,5,14,15),this.drawSegment(e,o,a,s,8,9,18,19),this.drawSegment(e,o,a,s,10,11,20,21),this.drawSegment(e,o,a,s,12,13,22,23),this.drawSegment(e,o,a,s,16,17,26,27),this.drawSegment(e,o,a,s,18,19,28,29),this.drawSegment(e,o,a,s,20,21,30,31)},e.prototype.drawSegment=function(t,e,n,r,i,o,a,s){var c=this.uvs,u=this.vertices,l=(c[a]-c[i])*n,h=(c[s]-c[o])*r,d=u[a]-u[i],p=u[s]-u[o];l<1&&(l=1),h<1&&(h=1),d<1&&(d=1),p<1&&(p=1),t.drawImage(e,c[i]*n,c[o]*r,l,h,u[i],u[o],d,p)},e.prototype._refresh=function(){t.prototype._refresh.call(this);var e=this.uvs,n=this._texture;this._origWidth=n.orig.width,this._origHeight=n.orig.height;var r=1/this._origWidth,i=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.dirty++,this.multiplyUvs()},i(e,[{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._refresh()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._refresh()}},{key:"leftWidth",get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()}},{key:"rightWidth",get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()}},{key:"topHeight",get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()}},{key:"bottomHeight",get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()}}]),e}(((r=n("6nzH"))&&r.__esModule?r:{default:r}).default);e.default=a},"qD+0":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=h(n("8USZ")),o=h(n("YdyU")),a=h(n("M75x")),s=h(n("BzvE")),c=n("Q5/2"),u=n("aH6o"),l=h(n("/MUw"));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(n,r,i,o,a){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));if(s.noFrame=!1,r||(s.noFrame=!0,r=new c.Rectangle(0,0,1,1)),n instanceof e&&(n=n.baseTexture),s.baseTexture=n,s._frame=r,s.trim=o,s.valid=!1,s.requiresUpdate=!1,s._uvs=null,s.orig=i||r,s._rotate=Number(a||0),!0===a)s._rotate=2;else if(s._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return n.hasLoaded?(s.noFrame&&(r=new c.Rectangle(0,0,n.width,n.height),n.on("update",s.onBaseTextureUpdated,s)),s.frame=r):n.once("loaded",s.onBaseTextureLoaded,s),s._updateID=0,s.transform=null,s.textureCacheIds=[],s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.update=function(){this.baseTexture.update()},e.prototype.onBaseTextureLoaded=function(t){this._updateID++,this.frame=this.noFrame?new c.Rectangle(0,0,t.width,t.height):this._frame,this.baseTexture.on("update",this.onBaseTextureUpdated,this),this.emit("update",this)},e.prototype.onBaseTextureUpdated=function(t){this._updateID++,this._frame.width=t.width,this._frame.height=t.height,this.emit("update",this)},e.prototype.destroy=function(t){this.baseTexture&&(t&&(u.TextureCache[this.baseTexture.imageUrl]&&e.removeFromCache(this.baseTexture.imageUrl),this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)},e.prototype._updateUvs=function(){this._uvs||(this._uvs=new a.default),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.fromImage=function(t,n,r,o){var a=u.TextureCache[t];return a||(a=new e(i.default.fromImage(t,n,r,o)),e.addToCache(a,t)),a},e.fromFrame=function(t){var e=u.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return e},e.fromCanvas=function(t,n){return new e(i.default.fromCanvas(t,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas"))},e.fromVideo=function(t,n){return"string"==typeof t?e.fromVideoUrl(t,n):new e(o.default.fromVideo(t,n))},e.fromVideoUrl=function(t,n){return new e(o.default.fromUrl(t,n))},e.from=function(t){return"string"==typeof t?u.TextureCache[t]||(null!==t.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?e.fromVideoUrl(t):e.fromImage(t)):t instanceof HTMLImageElement?new e(i.default.from(t)):t instanceof HTMLCanvasElement?e.fromCanvas(t,l.default.SCALE_MODE,"HTMLCanvasElement"):t instanceof HTMLVideoElement?e.fromVideo(t):t instanceof i.default?new e(t):t},e.fromLoader=function(t,n,r){var o=new i.default(t,void 0,(0,u.getResolutionOfUrl)(n)),a=new e(o);return o.imageUrl=n,r||(r=n),i.default.addToCache(a.baseTexture,r),e.addToCache(a,r),r!==n&&(i.default.addToCache(a.baseTexture,n),e.addToCache(a,n)),a},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),u.TextureCache[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),u.TextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=u.TextureCache[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete u.TextureCache[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)u.TextureCache[t.textureCacheIds[r]]===t&&delete u.TextureCache[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},r(e,[{key:"frame",get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,n=t.y,r=t.width,i=t.height,o=e+r>this.baseTexture.width,a=n+i>this.baseTexture.height;if(o||a)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width+" "+(o&&a?"and":"or")+" Y: "+n+" + "+i+" = "+(n+i)+" > "+this.baseTexture.height);this.valid=r&&i&&this.baseTexture.hasLoaded,this.trim||this.rotate||(this.orig=t),this.valid&&this._updateUvs()}},{key:"rotate",get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this._updateUvs()}},{key:"width",get:function(){return this.orig.width}},{key:"height",get:function(){return this.orig.height}}]),e}(s.default);function p(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}e.default=d,d.EMPTY=new d(new i.default),p(d.EMPTY),p(d.EMPTY.baseTexture),d.WHITE=function(){var t=document.createElement("canvas");t.width=10,t.height=10;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,10,10),new d(new i.default(t))}(),p(d.WHITE),p(d.WHITE.baseTexture)},qKrd:function(t,e){t.exports=function(t){function e(e,n){var r,i,o,a,s;this.object=e,this.domElement=void 0!==n?n:document,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:t.MOUSE.LEFT,ZOOM:t.MOUSE.MIDDLE,PAN:t.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(u),c.update(),p=d.NONE},this.update=(r=new t.Vector3,i=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),o=i.clone().inverse(),a=new t.Vector3,s=new t.Quaternion,function(){var t=c.object.position;return r.copy(t).sub(c.target),r.applyQuaternion(i),m.setFromVector3(r),c.autoRotate&&p===d.NONE&&O(2*Math.PI/60/60*c.autoRotateSpeed),m.theta+=v.theta,m.phi+=v.phi,m.theta=Math.max(c.minAzimuthAngle,Math.min(c.maxAzimuthAngle,m.theta)),m.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=g,m.radius=Math.max(c.minDistance,Math.min(c.maxDistance,m.radius)),c.target.add(y),r.setFromSpherical(m),r.applyQuaternion(o),t.copy(c.target).add(r),c.object.lookAt(c.target),!0===c.enableDamping?(v.theta*=1-c.dampingFactor,v.phi*=1-c.dampingFactor):v.set(0,0,0),g=1,y.set(0,0,0),!!(b||a.distanceToSquared(c.object.position)>f||8*(1-s.dot(c.object.quaternion))>f)&&(c.dispatchEvent(u),a.copy(c.object.position),s.copy(c.object.quaternion),b=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",X,!1),c.domElement.removeEventListener("mousedown",k,!1),c.domElement.removeEventListener("wheel",z,!1),c.domElement.removeEventListener("touchstart",G,!1),c.domElement.removeEventListener("touchend",W,!1),c.domElement.removeEventListener("touchmove",H,!1),document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",B,!1),window.removeEventListener("keydown",V,!1)};var c=this,u={type:"change"},l={type:"start"},h={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},p=d.NONE,f=1e-6,m=new t.Spherical,v=new t.Spherical,g=1,y=new t.Vector3,b=!1,x=new t.Vector2,w=new t.Vector2,_=new t.Vector2,S=new t.Vector2,T=new t.Vector2,M=new t.Vector2,A=new t.Vector2,E=new t.Vector2,C=new t.Vector2;function P(){return Math.pow(.95,c.zoomSpeed)}function O(t){v.theta-=t}function N(t){v.phi-=t}var L,I=(L=new t.Vector3,function(t,e){L.setFromMatrixColumn(e,0),L.multiplyScalar(-t),y.add(L)}),R=function(){var e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),y.add(e)}}(),D=function(){var e=new t.Vector3;return function(n,r){var i=c.domElement===document?c.domElement.body:c.domElement;if(c.object instanceof t.PerspectiveCamera){e.copy(c.object.position).sub(c.target);var o=e.length();o*=Math.tan(c.object.fov/2*Math.PI/180),I(2*n*o/i.clientHeight,c.object.matrix),R(2*r*o/i.clientHeight,c.object.matrix)}else c.object instanceof t.OrthographicCamera?(I(n*(c.object.right-c.object.left)/c.object.zoom/i.clientWidth,c.object.matrix),R(r*(c.object.top-c.object.bottom)/c.object.zoom/i.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function F(e){c.object instanceof t.PerspectiveCamera?g/=e:c.object instanceof t.OrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function U(e){c.object instanceof t.PerspectiveCamera?g*=e:c.object instanceof t.OrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function k(t){if(!1!==c.enabled){if(t.preventDefault(),t.button===c.mouseButtons.ORBIT){if(!1===c.enableRotate)return;!function(t){x.set(t.clientX,t.clientY)}(t),p=d.ROTATE}else if(t.button===c.mouseButtons.ZOOM){if(!1===c.enableZoom)return;!function(t){A.set(t.clientX,t.clientY)}(t),p=d.DOLLY}else if(t.button===c.mouseButtons.PAN){if(!1===c.enablePan)return;!function(t){S.set(t.clientX,t.clientY)}(t),p=d.PAN}p!==d.NONE&&(document.addEventListener("mousemove",j,!1),document.addEventListener("mouseup",B,!1),c.dispatchEvent(l))}}function j(t){if(!1!==c.enabled)if(t.preventDefault(),p===d.ROTATE){if(!1===c.enableRotate)return;!function(t){w.set(t.clientX,t.clientY),_.subVectors(w,x);var e=c.domElement===document?c.domElement.body:c.domElement;O(2*Math.PI*_.x/e.clientWidth*c.rotateSpeed),N(2*Math.PI*_.y/e.clientHeight*c.rotateSpeed),x.copy(w),c.update()}(t)}else if(p===d.DOLLY){if(!1===c.enableZoom)return;!function(t){E.set(t.clientX,t.clientY),C.subVectors(E,A),C.y>0?F(P()):C.y<0&&U(P()),A.copy(E),c.update()}(t)}else if(p===d.PAN){if(!1===c.enablePan)return;!function(t){T.set(t.clientX,t.clientY),M.subVectors(T,S),D(M.x,M.y),S.copy(T),c.update()}(t)}}function B(t){!1!==c.enabled&&(document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",B,!1),c.dispatchEvent(h),p=d.NONE)}function z(t){!1===c.enabled||!1===c.enableZoom||p!==d.NONE&&p!==d.ROTATE||(t.preventDefault(),t.stopPropagation(),function(t){t.deltaY<0?U(P()):t.deltaY>0&&F(P()),c.update()}(t),c.dispatchEvent(l),c.dispatchEvent(h))}function V(t){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(t){switch(t.keyCode){case c.keys.UP:D(0,c.keyPanSpeed),c.update();break;case c.keys.BOTTOM:D(0,-c.keyPanSpeed),c.update();break;case c.keys.LEFT:D(c.keyPanSpeed,0),c.update();break;case c.keys.RIGHT:D(-c.keyPanSpeed,0),c.update()}}(t)}function G(t){if(!1!==c.enabled){switch(t.touches.length){case 1:if(!1===c.enableRotate)return;!function(t){x.set(t.touches[0].pageX,t.touches[0].pageY)}(t),p=d.TOUCH_ROTATE;break;case 2:if(!1===c.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);A.set(0,r)}(t),p=d.TOUCH_DOLLY;break;case 3:if(!1===c.enablePan)return;!function(t){S.set(t.touches[0].pageX,t.touches[0].pageY)}(t),p=d.TOUCH_PAN;break;default:p=d.NONE}p!==d.NONE&&c.dispatchEvent(l)}}function H(t){if(!1!==c.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===c.enableRotate)return;if(p!==d.TOUCH_ROTATE)return;!function(t){w.set(t.touches[0].pageX,t.touches[0].pageY),_.subVectors(w,x);var e=c.domElement===document?c.domElement.body:c.domElement;O(2*Math.PI*_.x/e.clientWidth*c.rotateSpeed),N(2*Math.PI*_.y/e.clientHeight*c.rotateSpeed),x.copy(w),c.update()}(t);break;case 2:if(!1===c.enableZoom)return;if(p!==d.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);E.set(0,r),C.subVectors(E,A),C.y>0?U(P()):C.y<0&&F(P()),A.copy(E),c.update()}(t);break;case 3:if(!1===c.enablePan)return;if(p!==d.TOUCH_PAN)return;!function(t){T.set(t.touches[0].pageX,t.touches[0].pageY),M.subVectors(T,S),D(M.x,M.y),S.copy(T),c.update()}(t);break;default:p=d.NONE}}function W(t){!1!==c.enabled&&(c.dispatchEvent(h),p=d.NONE)}function X(t){t.preventDefault()}c.domElement.addEventListener("contextmenu",X,!1),c.domElement.addEventListener("mousedown",k,!1),c.domElement.addEventListener("wheel",z,!1),c.domElement.addEventListener("touchstart",G,!1),c.domElement.addEventListener("touchend",W,!1),c.domElement.addEventListener("touchmove",H,!1),window.addEventListener("keydown",V,!1),this.update()}return(e.prototype=Object.create(t.EventDispatcher.prototype)).constructor=e,Object.defineProperties(e.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}}),e}},qLff:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("/B0E")),o=c(n("vpgX")),a=c(n("5Ljx")),s=c(n("+QcN"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(n,r,s,c){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var u=(0,o.default)(c=c||5,!1),l=(0,a.default)(c),h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,u,l));return h.resolution=s||i.settings.RESOLUTION,h._quality=0,h.quality=r||4,h.strength=n||8,h.firstRun=!0,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,n,r){if(this.firstRun){var i=(0,s.default)(t.renderer.gl);this.vertexSrc=(0,o.default)(i,!1),this.fragmentSrc=(0,a.default)(i),this.firstRun=!1}if(this.uniforms.strength=1/n.size.height*(n.size.height/e.size.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,n,r);else{for(var c=t.getRenderTarget(!0),u=e,l=c,h=0;h<this.passes-1;h++){t.applyFilter(this,u,l,!0);var d=l;l=u,u=d}t.applyFilter(this,u,n,r),t.returnRenderTarget(c)}},r(e,[{key:"blur",get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}]),e}(i.Filter);e.default=u},qOJP:function(t,e,n){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},qisP:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n("Q5/2"),a=function(t){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n.position=new o.ObservablePoint(n.onChange,n,0,0),n.scale=new o.ObservablePoint(n.onChange,n,1,1),n.pivot=new o.ObservablePoint(n.onChange,n,0,0),n.skew=new o.ObservablePoint(n.updateSkew,n,0,0),n._rotation=0,n._cx=1,n._sx=0,n._cy=0,n._sy=1,n._localID=0,n._currentLocalID=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onChange=function(){this._localID++},e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},e.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale._x,t.b=this._sx*this.scale._x,t.c=this._cy*this.scale._y,t.d=this._sy*this.scale._y,t.tx=this.position._x-(this.pivot._x*t.a+this.pivot._y*t.c),t.ty=this.position._y-(this.pivot._x*t.b+this.pivot._y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},e.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale._x,e.b=this._sx*this.scale._x,e.c=this._cy*this.scale._y,e.d=this._sy*this.scale._y,e.tx=this.position._x-(this.pivot._x*e.a+this.pivot._y*e.c),e.ty=this.position._y-(this.pivot._x*e.b+this.pivot._y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}},e.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},i(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()}}]),e}(((r=n("mAOr"))&&r.__esModule?r:{default:r}).default);e.default=a},qo3d:function(t,e,n){"use strict";e.__esModule=!0;var r=y(n("PjB0")),i=y(n("vNDr")),o=y(n("0Emr")),a=y(n("QAU/")),s=y(n("EoU7")),c=y(n("MIKO")),u=y(n("yMAt")),l=y(n("8USZ")),h=y(n("8o49")),d=y(n("m0PG")),p=y(n("n5XU")),f=y(n("ZSfh")),m=n("aH6o"),v=y(n("8QNu")),g=n("FjAT");function y(t){return t&&t.__esModule?t:{default:t}}var b=0,x=function(t){function e(n,r,a){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"WebGL",n,r,a));return s.legacy=s.options.legacy,s.legacy&&(v.default.VertexArrayObject.FORCE_NATIVE=!0),s.type=g.RENDERER_TYPE.WEBGL,s.handleContextLost=s.handleContextLost.bind(s),s.handleContextRestored=s.handleContextRestored.bind(s),s.view.addEventListener("webglcontextlost",s.handleContextLost,!1),s.view.addEventListener("webglcontextrestored",s.handleContextRestored,!1),s._contextOptions={alpha:s.transparent,antialias:s.options.antialias,premultipliedAlpha:s.transparent&&"notMultiplied"!==s.transparent,stencil:!0,preserveDrawingBuffer:s.options.preserveDrawingBuffer,powerPreference:s.options.powerPreference},s._backgroundColorRgba[3]=s.transparent?0:1,s.maskManager=new i.default(s),s.stencilManager=new o.default(s),s.emptyRenderer=new c.default(s),s.currentRenderer=s.emptyRenderer,s.textureManager=null,s.filterManager=null,s.initPlugins(),s.options.context&&(0,f.default)(s.options.context),s.gl=s.options.context||v.default.createContext(s.view,s._contextOptions),s.CONTEXT_UID=b++,s.state=new d.default(s.gl),s.renderingToScreen=!0,s.boundTextures=null,s._activeShader=null,s._activeVao=null,s._activeRenderTarget=null,s._initContext(),s.drawModes=(0,p.default)(s.gl),s._nextTextureLocation=0,s.setBlendMode(0),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._initContext=function(){var t=this.gl;t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext();var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null,this._activeVao=null,this.boundTextures=new Array(e),this.emptyTextures=new Array(e),this.textureManager=new u.default(this),this.filterManager=new a.default(this),this.textureGC=new h.default(this),this.state.resetToDefault(),this.rootRenderTarget=new s.default(t,this.width,this.height,null,this.resolution,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget);var n=new v.default.GLTexture.fromData(t,null,1,1),r={_glTextures:{}};r._glTextures[this.CONTEXT_UID]={};for(var i=0;i<e;i++){var o=new l.default;o._glTextures[this.CONTEXT_UID]=n,this.boundTextures[i]=r,this.emptyTextures[i]=o,this.bindTexture(null,i)}this.emit("context",t),this.resize(this.screen.width,this.screen.height)},e.prototype.render=function(t,e,n,r,i){if(this.renderingToScreen=!e,this.emit("prerender"),this.gl&&!this.gl.isContextLost()){if(this._nextTextureLocation=0,e||(this._lastObjectRendered=t),!i){var o=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=o}this.bindRenderTexture(e,r),this.currentRenderer.start(),(void 0!==n?n:this.clearBeforeRender)&&this._activeRenderTarget.clear(),t.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender")}},e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.resize=function(t,e){r.default.prototype.resize.call(this,t,e),this.rootRenderTarget.resize(t,e),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},e.prototype.setBlendMode=function(t){this.state.setBlendMode(t)},e.prototype.clear=function(t){this._activeRenderTarget.clear(t)},e.prototype.setTransform=function(t){this._activeRenderTarget.transform=t},e.prototype.clearRenderTexture=function(t,e){var n=t.baseTexture._glRenderTargets[this.CONTEXT_UID];return n&&n.clear(e),this},e.prototype.bindRenderTexture=function(t,e){var n=void 0;if(t){var r=t.baseTexture;r._glRenderTargets[this.CONTEXT_UID]||this.textureManager.updateTexture(r,0),this.unbindTexture(r),(n=r._glRenderTargets[this.CONTEXT_UID]).setFrame(t.frame)}else n=this.rootRenderTarget;return n.transform=e,this.bindRenderTarget(n),this},e.prototype.bindRenderTarget=function(t){return t!==this._activeRenderTarget&&(this._activeRenderTarget=t,t.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=t.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(t.stencilMaskStack)),this},e.prototype.bindShader=function(t,e){return this._activeShader!==t&&(this._activeShader=t,t.bind(),!1!==e&&(t.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0))),this},e.prototype.bindTexture=function(t,e,n){if((t=(t=t||this.emptyTextures[e]).baseTexture||t).touched=this.textureGC.count,n)e=e||0;else{for(var r=0;r<this.boundTextures.length;r++)if(this.boundTextures[r]===t)return r;void 0===e&&(this._nextTextureLocation++,this._nextTextureLocation%=this.boundTextures.length,e=this.boundTextures.length-this._nextTextureLocation-1)}var i=this.gl,o=t._glTextures[this.CONTEXT_UID];return o?(this.boundTextures[e]=t,i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,o.texture)):this.textureManager.updateTexture(t,e),e},e.prototype.unbindTexture=function(t){var e=this.gl;t=t.baseTexture||t;for(var n=0;n<this.boundTextures.length;n++)this.boundTextures[n]===t&&(this.boundTextures[n]=this.emptyTextures[n],e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[n]._glTextures[this.CONTEXT_UID].texture));return this},e.prototype.createVao=function(){return new v.default.VertexArrayObject(this.gl,this.state.attribState)},e.prototype.bindVao=function(t){return this._activeVao===t?this:(t?t.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=t,this)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer),this.bindVao(null),this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.emptyTextures[t];return this.rootRenderTarget.activate(),this.state.resetToDefault(),this},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.textureManager.removeAll(),this.filterManager.destroy(!0),this._initContext()},e.prototype.destroy=function(e){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.textureManager.destroy(),t.prototype.destroy.call(this,e),this.uid=0,this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.maskManager=null,this.filterManager=null,this.textureManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null},e}(r.default);e.default=x,m.pluginTarget.mixin(x)},qsr7:function(t,e,n){"use strict";e.__esModule=!0,e.default={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0}},rN5J:function(t,e,n){var r=n("NZvU"),i=n("aoKs");t.exports=function(t,e){for(var n={},o=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),a=0;a<o;a++){var s=t.getActiveUniform(e,a),c=s.name.replace(/\[.*?\]/,""),u=r(t,s.type);n[c]={type:u,size:s.size,location:t.getUniformLocation(e,c),value:i(u,s.size)}}return n}},rW72:function(t,e,n){t.exports={compileProgram:n("JD0k"),defaultValue:n("aoKs"),extractAttributes:n("7IZn"),extractUniforms:n("rN5J"),generateUniformAccessObject:n("sMVv"),setPrecision:n("Qn7E"),mapSize:n("3JLa"),mapType:n("NZvU")}},"rdl+":function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0},t.prototype.reset=function(){this.stopped=!1,this.currentTarget=null,this.target=null},t}();e.default=r},s4oU:function(t,e,n){"use strict";e.__esModule=!0;var r=o(n("8QNu")),i=o(n("fq6b"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e,n,r,i){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var o=0;o<n.length;++o){var a=n[o];a={attribute:a.attribute,size:a.size,uploadFunction:a.uploadFunction,unsignedByte:a.unsignedByte,offset:a.offset},r[o]?this.dynamicProperties.push(a):this.staticProperties.push(a)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.gl,e=0;this.indices=(0,i.default)(this.size),this.indexBuffer=r.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.dynamicStride=0;for(var n=0;n<this.dynamicProperties.length;++n){var o=this.dynamicProperties[n];o.offset=e,e+=o.size,this.dynamicStride+=o.size}var a=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(a),this.dynamicDataUint32=new Uint32Array(a),this.dynamicBuffer=r.default.GLBuffer.createVertexBuffer(t,a,t.STREAM_DRAW);var s=0;this.staticStride=0;for(var c=0;c<this.staticProperties.length;++c){var u=this.staticProperties[c];u.offset=s,s+=u.size,this.staticStride+=u.size}var l=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(l),this.staticDataUint32=new Uint32Array(l),this.staticBuffer=r.default.GLBuffer.createVertexBuffer(t,l,t.STATIC_DRAW),this.vao=new r.default.VertexArrayObject(t).addIndex(this.indexBuffer);for(var h=0;h<this.dynamicProperties.length;++h){var d=this.dynamicProperties[h];d.unsignedByte?this.vao.addAttribute(this.dynamicBuffer,d.attribute,t.UNSIGNED_BYTE,!0,4*this.dynamicStride,4*d.offset):this.vao.addAttribute(this.dynamicBuffer,d.attribute,t.FLOAT,!1,4*this.dynamicStride,4*d.offset)}for(var p=0;p<this.staticProperties.length;++p){var f=this.staticProperties[p];f.unsignedByte?this.vao.addAttribute(this.staticBuffer,f.attribute,t.UNSIGNED_BYTE,!0,4*this.staticStride,4*f.offset):this.vao.addAttribute(this.staticBuffer,f.attribute,t.FLOAT,!1,4*this.staticStride,4*f.offset)}},t.prototype.uploadDynamic=function(t,e,n){for(var r=0;r<this.dynamicProperties.length;r++){var i=this.dynamicProperties[r];i.uploadFunction(t,e,n,i.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer.upload()},t.prototype.uploadStatic=function(t,e,n){for(var r=0;r<this.staticProperties.length;r++){var i=this.staticProperties[r];i.uploadFunction(t,e,n,i.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer.upload()},t.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicBuffer.destroy(),this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer.destroy(),this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null},t}();e.default=a},sMVv:function(t,e){var n=function(t){return function(){return this.data[t].value}},r={float:function(t,e,n){t.uniform1f(e,n)},vec2:function(t,e,n){t.uniform2f(e,n[0],n[1])},vec3:function(t,e,n){t.uniform3f(e,n[0],n[1],n[2])},vec4:function(t,e,n){t.uniform4f(e,n[0],n[1],n[2],n[3])},int:function(t,e,n){t.uniform1i(e,n)},ivec2:function(t,e,n){t.uniform2i(e,n[0],n[1])},ivec3:function(t,e,n){t.uniform3i(e,n[0],n[1],n[2])},ivec4:function(t,e,n){t.uniform4i(e,n[0],n[1],n[2],n[3])},bool:function(t,e,n){t.uniform1i(e,n)},bvec2:function(t,e,n){t.uniform2i(e,n[0],n[1])},bvec3:function(t,e,n){t.uniform3i(e,n[0],n[1],n[2])},bvec4:function(t,e,n){t.uniform4i(e,n[0],n[1],n[2],n[3])},mat2:function(t,e,n){t.uniformMatrix2fv(e,!1,n)},mat3:function(t,e,n){t.uniformMatrix3fv(e,!1,n)},mat4:function(t,e,n){t.uniformMatrix4fv(e,!1,n)},sampler2D:function(t,e,n){t.uniform1i(e,n)}},i={float:function(t,e,n){t.uniform1fv(e,n)},vec2:function(t,e,n){t.uniform2fv(e,n)},vec3:function(t,e,n){t.uniform3fv(e,n)},vec4:function(t,e,n){t.uniform4fv(e,n)},int:function(t,e,n){t.uniform1iv(e,n)},ivec2:function(t,e,n){t.uniform2iv(e,n)},ivec3:function(t,e,n){t.uniform3iv(e,n)},ivec4:function(t,e,n){t.uniform4iv(e,n)},bool:function(t,e,n){t.uniform1iv(e,n)},bvec2:function(t,e,n){t.uniform2iv(e,n)},bvec3:function(t,e,n){t.uniform3iv(e,n)},bvec4:function(t,e,n){t.uniform4iv(e,n)},sampler2D:function(t,e,n){t.uniform1iv(e,n)}};function o(t,e){return function(n){this.data[t].value=n;var o=this.data[t].location;1===e.size?r[e.type](this.gl,o,n):i[e.type](this.gl,o,n)}}function a(t,e){for(var n=e,r=0;r<t.length-1;r++){var i=n[t[r]]||{data:{}};n[t[r]]=i,n=i}return n}t.exports=function(t,e){var r={data:{}};r.gl=t;for(var i=Object.keys(e),s=0;s<i.length;s++){var c=i[s],u=c.split("."),l=u[u.length-1],h=a(u,r),d=e[c];h.data[l]=d,h.gl=t,Object.defineProperty(h,l,{get:n(l),set:o(l,d)})}return r}},sOR5:function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},slDu:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){var e=t.mesh,n=t.particles,r=t.extras,o=t.filters,a=t.prepare,s=t.loaders,c=t.interaction;Object.defineProperties(t,{SpriteBatch:{get:function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")}},AssetLoader:{get:function(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.")}},Stage:{get:function(){return i("You do not need to use a PIXI Stage any more, you can simply render any container."),t.Container}},DisplayObjectContainer:{get:function(){return i("DisplayObjectContainer has been shortened to Container, please use Container from now on."),t.Container}},Strip:{get:function(){return i("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),e.Mesh}},Rope:{get:function(){return i("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),e.Rope}},ParticleContainer:{get:function(){return i("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."),n.ParticleContainer}},MovieClip:{get:function(){return i("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."),r.AnimatedSprite}},TilingSprite:{get:function(){return i("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),r.TilingSprite}},BitmapText:{get:function(){return i("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),r.BitmapText}},blendModes:{get:function(){return i("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),t.BLEND_MODES}},scaleModes:{get:function(){return i("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),t.SCALE_MODES}},BaseTextureCache:{get:function(){return i("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),t.utils.BaseTextureCache}},TextureCache:{get:function(){return i("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),t.utils.TextureCache}},math:{get:function(){return i("The math namespace is deprecated, please access members already accessible on PIXI."),t}},AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),t.Filter}},TransformManual:{get:function(){return i("TransformManual has been renamed to TransformBase, please update your pixi-spine"),t.TransformBase}},TARGET_FPMS:{get:function(){return i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),t.settings.TARGET_FPMS},set:function(e){i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),t.settings.TARGET_FPMS=e}},FILTER_RESOLUTION:{get:function(){return i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),t.settings.FILTER_RESOLUTION},set:function(e){i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),t.settings.FILTER_RESOLUTION=e}},RESOLUTION:{get:function(){return i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),t.settings.RESOLUTION},set:function(e){i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),t.settings.RESOLUTION=e}},MIPMAP_TEXTURES:{get:function(){return i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),t.settings.MIPMAP_TEXTURES},set:function(e){i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),t.settings.MIPMAP_TEXTURES=e}},SPRITE_BATCH_SIZE:{get:function(){return i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),t.settings.SPRITE_BATCH_SIZE},set:function(e){i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),t.settings.SPRITE_BATCH_SIZE=e}},SPRITE_MAX_TEXTURES:{get:function(){return i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),t.settings.SPRITE_MAX_TEXTURES},set:function(e){i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),t.settings.SPRITE_MAX_TEXTURES=e}},RETINA_PREFIX:{get:function(){return i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),t.settings.RETINA_PREFIX},set:function(e){i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),t.settings.RETINA_PREFIX=e}},DEFAULT_RENDER_OPTIONS:{get:function(){return i("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"),t.settings.RENDER_OPTIONS}}});for(var u=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}],l=function(e){var n=u[e];Object.defineProperty(t[n.parent],"DEFAULT",{get:function(){return i("PIXI."+n.parent+".DEFAULT has been deprecated, please use PIXI.settings."+n.target),t.settings[n.target]},set:function(e){i("PIXI."+n.parent+".DEFAULT has been deprecated, please use PIXI.settings."+n.target),t.settings[n.target]=e}})},h=0;h<u.length;h++)l(h);Object.defineProperties(t.settings,{PRECISION:{get:function(){return i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),t.settings.PRECISION_FRAGMENT},set:function(e){i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),t.settings.PRECISION_FRAGMENT=e}}}),r.AnimatedSprite&&Object.defineProperties(r,{MovieClip:{get:function(){return i("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."),r.AnimatedSprite}}}),r&&Object.defineProperties(r,{TextureTransform:{get:function(){return i("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."),t.TextureMatrix}}}),t.DisplayObject.prototype.generateTexture=function(t,e,n){return i("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"),t.generateTexture(this,e,n)},t.Graphics.prototype.generateTexture=function(t,e){return i("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"),this.generateCanvasTexture(t,e)},t.GroupD8.isSwapWidthHeight=function(e){return i("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"),t.GroupD8.isVertical(e)},t.RenderTexture.prototype.render=function(t,e,n,r){this.legacyRenderer.render(t,this,n,e,!r),i("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")},t.RenderTexture.prototype.getImage=function(t){return i("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"),this.legacyRenderer.extract.image(t)},t.RenderTexture.prototype.getBase64=function(t){return i("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"),this.legacyRenderer.extract.base64(t)},t.RenderTexture.prototype.getCanvas=function(t){return i("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"),this.legacyRenderer.extract.canvas(t)},t.RenderTexture.prototype.getPixels=function(t){return i("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"),this.legacyRenderer.pixels(t)},t.Sprite.prototype.setTexture=function(t){this.texture=t,i("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},r.BitmapText&&(r.BitmapText.prototype.setText=function(t){this.text=t,i("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")}),t.Text.prototype.setText=function(t){this.text=t,i("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},t.Text.calculateFontProperties=function(e){return i("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"),t.TextMetrics.measureFont(e)},Object.defineProperties(t.Text,{fontPropertiesCache:{get:function(){return i("Text.fontPropertiesCache is deprecated"),t.TextMetrics._fonts}},fontPropertiesCanvas:{get:function(){return i("Text.fontPropertiesCanvas is deprecated"),t.TextMetrics._canvas}},fontPropertiesContext:{get:function(){return i("Text.fontPropertiesContext is deprecated"),t.TextMetrics._context}}}),t.Text.prototype.setStyle=function(t){this.style=t,i("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},t.Text.prototype.determineFontProperties=function(e){return i("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"),t.TextMetrics.measureFont(e)},t.Text.getFontStyle=function(e){return i("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"),(e=e||{})instanceof t.TextStyle||(e=new t.TextStyle(e)),e.toFontString()},Object.defineProperties(t.TextStyle.prototype,{font:{get:function(){return i("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on"),this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+("number"==typeof this._fontSize?this._fontSize+"px":this._fontSize)+" "+this._fontFamily},set:function(t){i("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"),this._fontStyle=t.indexOf("italic")>1?"italic":t.indexOf("oblique")>-1?"oblique":"normal",this._fontVariant=t.indexOf("small-caps")>-1?"small-caps":"normal";var e=t.split(" "),n=-1;this._fontSize=26;for(var r=0;r<e.length;++r)if(e[r].match(/(px|pt|em|%)/)){n=r,this._fontSize=e[r];break}this._fontWeight="normal";for(var o=0;o<n;++o)if(e[o].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=e[o];break}if(n>-1&&n<e.length-1){this._fontFamily="";for(var a=n+1;a<e.length;++a)this._fontFamily+=e[a]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}}),t.Texture.prototype.setFrame=function(t){this.frame=t,i("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")},t.Texture.addTextureToCache=function(e,n){t.Texture.addToCache(e,n),i("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")},t.Texture.removeTextureFromCache=function(e){return i("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"),t.BaseTexture.removeFromCache(e),t.Texture.removeFromCache(e)},Object.defineProperties(o,{AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),t.AbstractFilter}},SpriteMaskFilter:{get:function(){return i("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),t.SpriteMaskFilter}},VoidFilter:{get:function(){return i("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"),o.AlphaFilter}}}),t.utils.uuid=function(){return i("utils.uuid() is deprecated, please use utils.uid() from now on."),t.utils.uid()},t.utils.canUseNewCanvasBlendModes=function(){return i("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"),t.CanvasTinter.canUseMultiply};var d=!0;if(Object.defineProperty(t.utils,"_saidHello",{set:function(t){t&&(i("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"),this.skipHello()),d=t},get:function(){return d}}),a.BasePrepare&&(a.BasePrepare.prototype.register=function(t,e){return i("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"),t&&this.registerFindHook(t),e&&this.registerUploadHook(e),this}),a.canvas&&Object.defineProperty(a.canvas,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),a.webgl&&Object.defineProperty(a.webgl,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),s.Loader){var p=s.Resource,f=s.Loader;Object.defineProperties(p.prototype,{isJson:{get:function(){return i("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."),this.type===p.TYPE.JSON}},isXml:{get:function(){return i("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."),this.type===p.TYPE.XML}},isImage:{get:function(){return i("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."),this.type===p.TYPE.IMAGE}},isAudio:{get:function(){return i("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."),this.type===p.TYPE.AUDIO}},isVideo:{get:function(){return i("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."),this.type===p.TYPE.VIDEO}}}),Object.defineProperties(f.prototype,{before:{get:function(){return i("The before() method is deprecated, please use pre()."),this.pre}},after:{get:function(){return i("The after() method is deprecated, please use use()."),this.use}}})}c.interactiveTarget&&Object.defineProperty(c.interactiveTarget,"defaultCursor",{set:function(t){i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor=t},get:function(){return i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor}}),c.InteractionManager&&(Object.defineProperty(c.InteractionManager,"defaultCursorStyle",{set:function(t){i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default=t},get:function(){return i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default}}),Object.defineProperty(c.InteractionManager,"currentCursorStyle",{set:function(t){i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode=t},get:function(){return i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode}}))};var r={};function i(t){if(!r[t]){var e=(new Error).stack;"undefined"==typeof e?console.warn("Deprecation Warning: ",t):(e=e.split("\n").splice(3).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t),console.warn(e),console.groupEnd()):(console.warn("Deprecation Warning: ",t),console.warn(e))),r[t]=!0}}},t7NR:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r={closed:!0,next:function(t){},error:function(t){throw t},complete:function(){}}},tIUM:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},r(t,[{key:"pointerId",get:function(){return this._pointerId}},{key:"flags",get:function(){return this._flags},set:function(t){this._flags=t}},{key:"none",get:function(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},set:function(t){this._doSet(this.constructor.FLAGS.OVER,t)}},{key:"rightDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)}},{key:"leftDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)}}]),t}();e.default=i,i.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4})},tLDX:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("AMGY").a.Symbol,i="function"==typeof r&&"function"==typeof r.for?r.for("rxSubscriber"):"@@rxSubscriber"},tOxb:function(t,e,n){"use strict";t.exports=function(t,e){for(var n={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=n.parser[(e=e||{}).strictMode?"strict":"loose"].exec(t),i={},o=14;o--;)i[n.key[o]]=r[o]||"";return i[n.q.name]={},i[n.key[12]].replace(n.q.parser,function(t,e,r){e&&(i[n.q.name][e]=r)}),i}},tZ2B:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("TToO"),i=function(t){function e(){t.apply(this,arguments)}return Object(r.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(n("OVmG").a)},thfa:function(t,e,n){"use strict";e.__esModule=!0;var r,i=(r=n("5tzz"))&&r.__esModule?r:{default:r},o=n("FjAT"),a=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=this.renderer,n=e.context,r=t.worldAlpha,i=t.transform.worldTransform,a=e.resolution;this._prevTint!==this.tint&&(this.dirty=!0),n.setTransform(i.a*a,i.b*a,i.c*a,i.d*a,i.tx*a,i.ty*a),t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),e.setBlendMode(t.blendMode);for(var s=0;s<t.graphicsData.length;s++){var c=t.graphicsData[s],u=c.shape,l=c._fillTint,h=c._lineTint;if(n.lineWidth=c.lineWidth,c.type===o.SHAPES.POLY){n.beginPath(),this.renderPolygon(u.points,u.closed,n);for(var d=0;d<c.holes.length;d++)this.renderPolygon(c.holes[d].points,!0,n);c.fill&&(n.globalAlpha=c.fillAlpha*r,n.fillStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.fill()),c.lineWidth&&(n.globalAlpha=c.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),n.stroke())}else if(c.type===o.SHAPES.RECT)(c.fillColor||0===c.fillColor)&&(n.globalAlpha=c.fillAlpha*r,n.fillStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.fillRect(u.x,u.y,u.width,u.height)),c.lineWidth&&(n.globalAlpha=c.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),n.strokeRect(u.x,u.y,u.width,u.height));else if(c.type===o.SHAPES.CIRC)n.beginPath(),n.arc(u.x,u.y,u.radius,0,2*Math.PI),n.closePath(),c.fill&&(n.globalAlpha=c.fillAlpha*r,n.fillStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.fill()),c.lineWidth&&(n.globalAlpha=c.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),n.stroke());else if(c.type===o.SHAPES.ELIP){var p=2*u.width,f=2*u.height,m=u.x-p/2,v=u.y-f/2;n.beginPath();var g=p/2*.5522848,y=f/2*.5522848,b=m+p,x=v+f,w=m+p/2,_=v+f/2;n.moveTo(m,_),n.bezierCurveTo(m,_-y,w-g,v,w,v),n.bezierCurveTo(w+g,v,b,_-y,b,_),n.bezierCurveTo(b,_+y,w+g,x,w,x),n.bezierCurveTo(w-g,x,m,_+y,m,_),n.closePath(),c.fill&&(n.globalAlpha=c.fillAlpha*r,n.fillStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.fill()),c.lineWidth&&(n.globalAlpha=c.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),n.stroke())}else if(c.type===o.SHAPES.RREC){var S=u.x,T=u.y,M=u.width,A=u.height,E=u.radius,C=Math.min(M,A)/2|0;E=E>C?C:E,n.beginPath(),n.moveTo(S,T+E),n.lineTo(S,T+A-E),n.quadraticCurveTo(S,T+A,S+E,T+A),n.lineTo(S+M-E,T+A),n.quadraticCurveTo(S+M,T+A,S+M,T+A-E),n.lineTo(S+M,T+E),n.quadraticCurveTo(S+M,T,S+M-E,T),n.lineTo(S+E,T),n.quadraticCurveTo(S,T,S,T+E),n.closePath(),(c.fillColor||0===c.fillColor)&&(n.globalAlpha=c.fillAlpha*r,n.fillStyle="#"+("00000"+(0|l).toString(16)).substr(-6),n.fill()),c.lineWidth&&(n.globalAlpha=c.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),n.stroke())}}},t.prototype.updateGraphicsTint=function(t){t._prevTint=t.tint;for(var e=(t.tint>>16&255)/255,n=(t.tint>>8&255)/255,r=(255&t.tint)/255,i=0;i<t.graphicsData.length;++i){var o=t.graphicsData[i],a=0|o.fillColor,s=0|o.lineColor;o._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*n*255<<8)+(255&a)/255*r*255,o._lineTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*n*255<<8)+(255&s)/255*r*255}},t.prototype.renderPolygon=function(t,e,n){n.moveTo(t[0],t[1]);for(var r=1;r<t.length/2;++r)n.lineTo(t[2*r],t[2*r+1]);e&&n.closePath()},t.prototype.destroy=function(){this.renderer=null},t}();e.default=a,i.default.registerPlugin("graphics",a)},tl0p:function(t,e,n){"use strict";e.__esModule=!0;var r=o(n("8QNu")),i=o(n("fq6b"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e,n){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.interleaved=new Float32Array(16);for(var o=0;o<4;o++)this.interleaved[4*o]=this.vertices[2*o],this.interleaved[4*o+1]=this.vertices[2*o+1],this.interleaved[4*o+2]=this.uvs[2*o],this.interleaved[4*o+3]=this.uvs[2*o+1];this.indices=(0,i.default)(1),this.vertexBuffer=r.default.GLBuffer.createVertexBuffer(e,this.interleaved,e.STATIC_DRAW),this.indexBuffer=r.default.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.vao=new r.default.VertexArrayObject(e,n)}return t.prototype.initVao=function(t){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,t.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,t.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)},t.prototype.map=function(t,e){var n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,r=e.y,this.vertices[0]=n=e.x,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this},t.prototype.upload=function(){for(var t=0;t<4;t++)this.interleaved[4*t]=this.vertices[2*t],this.interleaved[4*t+1]=this.vertices[2*t+1],this.interleaved[4*t+2]=this.uvs[2*t],this.interleaved[4*t+3]=this.uvs[2*t+1];return this.vertexBuffer.upload(this.interleaved),this},t.prototype.destroy=function(){var t=this.gl;t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer)},t}();e.default=a},tv36:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.vertices=new ArrayBuffer(e),this.float32View=new Float32Array(this.vertices),this.uint32View=new Uint32Array(this.vertices)}return t.prototype.destroy=function(){this.vertices=null,this.positions=null,this.uvs=null,this.colors=null},t}();e.default=r},umD3:function(t,e,n){"use strict";function r(){}function i(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}e.__esModule=!0,e.eachSeries=function(t,e,n,r){var i=0,o=t.length;!function a(s){s||i===o?n&&n(s):r?setTimeout(function(){e(t[i++],a)},1):e(t[i++],a)}()},e.queue=function(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var n=0,o={_tasks:[],concurrency:e,saturated:r,unsaturated:r,buffer:e/4,empty:r,drain:r,error:r,started:!1,paused:!1,push:function(t,e){a(t,!1,e)},kill:function(){n=0,o.drain=r,o.started=!1,o._tasks=[]},unshift:function(t,e){a(t,!0,e)},process:function(){for(;!o.paused&&n<o.concurrency&&o._tasks.length;){var e=o._tasks.shift();0===o._tasks.length&&o.empty(),(n+=1)===o.concurrency&&o.saturated(),t(e.data,i(s(e)))}},length:function(){return o._tasks.length},running:function(){return n},idle:function(){return o._tasks.length+n===0},pause:function(){!0!==o.paused&&(o.paused=!0)},resume:function(){if(!1!==o.paused){o.paused=!1;for(var t=1;t<=o.concurrency;t++)o.process()}}};function a(t,e,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");if(o.started=!0,null==t&&o.idle())setTimeout(function(){return o.drain()},1);else{var i={data:t,callback:"function"==typeof n?n:r};e?o._tasks.unshift(i):o._tasks.push(i),setTimeout(function(){return o.process()},1)}}function s(t){return function(){n-=1,t.callback.apply(t,arguments),null!=arguments[0]&&o.error(arguments[0],t.data),n<=o.concurrency-o.buffer&&o.unsaturated(),o.idle()&&o.drain(),o.process()}}return o}},vNDr:function(t,e,n){"use strict";e.__esModule=!0;var r=o(n("3psj")),i=o(n("hScZ"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(t){function e(n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return r.scissor=!1,r.scissorData=null,r.scissorRenderTarget=null,r.enableScissor=!0,r.alphaMaskPool=[],r.alphaMaskIndex=0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.pushMask=function(t,e){if(e.texture)this.pushSpriteMask(t,e);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&e.isFastRect()){var n=e.worldTransform,r=Math.atan2(n.b,n.a);(r=Math.round(r*(180/Math.PI)))%90?this.pushStencilMask(e):this.pushScissorMask(t,e)}else this.pushStencilMask(e)},e.prototype.popMask=function(t,e){e.texture?this.popSpriteMask(t,e):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(t,e):this.popStencilMask(t,e)},e.prototype.pushSpriteMask=function(t,e){var n=this.alphaMaskPool[this.alphaMaskIndex];n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new i.default(e)]),n[0].resolution=this.renderer.resolution,n[0].maskSprite=e,t.filterArea=e.getBounds(!0),this.renderer.filterManager.pushFilter(t,n),this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filterManager.popFilter(),this.alphaMaskIndex--},e.prototype.pushStencilMask=function(t){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.pushStencil(t)},e.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.popStencil()},e.prototype.pushScissorMask=function(t,e){e.renderable=!0;var n=this.renderer._activeRenderTarget,r=e.getBounds();r.fit(n.size),e.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var i=this.renderer.resolution;this.renderer.gl.scissor(r.x*i,(n.root?n.size.height-r.y-r.height:r.y)*i,r.width*i,r.height*i),this.scissorRenderTarget=n,this.scissorData=e,this.scissor=!0},e.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var t=this.renderer.gl;t.disable(t.SCISSOR_TEST)},e}(r.default);e.default=a},vmzn:function(t,e,n){function r(t){var n;function r(){if(r.enabled){var t=r,i=+new Date;t.diff=i-(n||i),t.prev=n,t.curr=i,n=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;s++;var i=e.formatters[r];return"function"==typeof i&&(n=i.call(t,o[s]),o.splice(s,1),s--),n}),e.formatArgs.call(t,o),(r.log||e.log||console.log.bind(console)).apply(t,o)}}return r.namespace=t,r.enabled=e.enabled(t),r.useColors=e.useColors(),r.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),r.destroy=i,"function"==typeof e.init&&e.init(r),e.instances.push(r),r}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=r.debug=r.default=r).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n("EarI"),e.instances=[],e.names=[],e.skips=[],e.formatters={}},vpgX:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){var n=Math.ceil(t/2),i=r,o="",a=void 0;a=e?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<t;s++){var c=a.replace("%index%",s);o+=c=c.replace("%sampleIndex%",s-(n-1)+".0"),o+="\n"}return(i=i.replace("%blur%",o)).replace("%size%",t)};var r=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n")},vwuV:function(t,e,n){"use strict";e.__esModule=!0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=(r=n("/MUw"))&&r.__esModule?r:{default:r},a=function(){function t(e,n,r){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||o.default.RESOLUTION,this.resize(e,n)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},i(t,[{key:"width",get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},{key:"height",get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}]),t}();e.default=a},x35b:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={};n.d(r,"audit",function(){return VS}),n.d(r,"auditTime",function(){return WS}),n.d(r,"buffer",function(){return o_}),n.d(r,"bufferCount",function(){return c_}),n.d(r,"bufferTime",function(){return d_}),n.d(r,"bufferToggle",function(){return y_}),n.d(r,"bufferWhen",function(){return w_}),n.d(r,"catchError",function(){return Jn}),n.d(r,"combineAll",function(){return T_}),n.d(r,"combineLatest",function(){return nw}),n.d(r,"concat",function(){return M_}),n.d(r,"concatAll",function(){return er}),n.d(r,"concatMap",function(){return vn}),n.d(r,"concatMapTo",function(){return A_}),n.d(r,"count",function(){return E_}),n.d(r,"debounce",function(){return I_}),n.d(r,"debounceTime",function(){return F_}),n.d(r,"defaultIfEmpty",function(){return Mr}),n.d(r,"delay",function(){return B_}),n.d(r,"delayWhen",function(){return H_}),n.d(r,"dematerialize",function(){return O_}),n.d(r,"distinct",function(){return J_}),n.d(r,"distinctUntilChanged",function(){return $_}),n.d(r,"distinctUntilKeyChanged",function(){return nS}),n.d(r,"elementAt",function(){return vS}),n.d(r,"every",function(){return ur}),n.d(r,"exhaust",function(){return sS}),n.d(r,"exhaustMap",function(){return lS}),n.d(r,"expand",function(){return pS}),n.d(r,"filter",function(){return Nr}),n.d(r,"finalize",function(){return bS}),n.d(r,"find",function(){return SS}),n.d(r,"findIndex",function(){return AS}),n.d(r,"first",function(){return ir}),n.d(r,"groupBy",function(){return OS}),n.d(r,"ignoreElements",function(){return FS}),n.d(r,"isEmpty",function(){return jS}),n.d(r,"last",function(){return pr}),n.d(r,"map",function(){return bn}),n.d(r,"mapTo",function(){return qS}),n.d(r,"materialize",function(){return JS}),n.d(r,"max",function(){return $S}),n.d(r,"merge",function(){return tT}),n.d(r,"mergeAll",function(){return tr.a}),n.d(r,"mergeMap",function(){return mn.a}),n.d(r,"flatMap",function(){return mn.a}),n.d(r,"mergeMapTo",function(){return eT}),n.d(r,"mergeScan",function(){return oT}),n.d(r,"min",function(){return cT}),n.d(r,"multicast",function(){return uT.a}),n.d(r,"observeOn",function(){return zn}),n.d(r,"onErrorResumeNext",function(){return Tw}),n.d(r,"pairwise",function(){return lT}),n.d(r,"partition",function(){return pT}),n.d(r,"pluck",function(){return fT}),n.d(r,"publish",function(){return mT}),n.d(r,"publishBehavior",function(){return vT}),n.d(r,"publishLast",function(){return yT}),n.d(r,"publishReplay",function(){return gT}),n.d(r,"race",function(){return bT}),n.d(r,"reduce",function(){return Pr}),n.d(r,"repeat",function(){return xT}),n.d(r,"repeatWhen",function(){return ST}),n.d(r,"retry",function(){return AT}),n.d(r,"retryWhen",function(){return PT}),n.d(r,"refCount",function(){return wA.a}),n.d(r,"sample",function(){return LT}),n.d(r,"sampleTime",function(){return DT}),n.d(r,"scan",function(){return yr}),n.d(r,"sequenceEqual",function(){return jT}),n.d(r,"share",function(){return _A.a}),n.d(r,"shareReplay",function(){return HT}),n.d(r,"single",function(){return WT}),n.d(r,"skip",function(){return YT}),n.d(r,"skipLast",function(){return QT}),n.d(r,"skipUntil",function(){return tM}),n.d(r,"skipWhile",function(){return rM}),n.d(r,"startWith",function(){return aM}),n.d(r,"switchAll",function(){return vM}),n.d(r,"switchMap",function(){return dM}),n.d(r,"switchMapTo",function(){return yM}),n.d(r,"take",function(){return wM}),n.d(r,"takeLast",function(){return _r}),n.d(r,"takeUntil",function(){return TM}),n.d(r,"takeWhile",function(){return EM}),n.d(r,"tap",function(){return rS}),n.d(r,"throttle",function(){return NM}),n.d(r,"throttleTime",function(){return RM}),n.d(r,"timeInterval",function(){return kM}),n.d(r,"timeout",function(){return VM}),n.d(r,"timeoutWith",function(){return WM}),n.d(r,"timestamp",function(){return YM}),n.d(r,"toArray",function(){return QM}),n.d(r,"window",function(){return KM}),n.d(r,"windowCount",function(){return eA}),n.d(r,"windowTime",function(){return iA}),n.d(r,"windowToggle",function(){return hA}),n.d(r,"windowWhen",function(){return fA}),n.d(r,"withLatestFrom",function(){return gA}),n.d(r,"zip",function(){return Lw}),n.d(r,"zipAll",function(){return xA});var i=n("WT6e"),o=function(){},a=n("TToO");function s(t,e){var n=function(t){return"data-"+t.toString().replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()};Object.defineProperty(t,e,{set:function(t){t=t.toString(),this.setAttribute(n(e),t)},get:function(){return this.getAttribute(n(e))},enumerable:!0})}function c(t,e){return{enumerable:!0,value:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._instance?this._instance[e].apply(this._instance,t):(console.warn("ng2-facebook-sdk: tried calling instance method before component is ready."),null)}}}var u=function(){function t(t,e,n){this.el=t,this.rnd=e,this.fbClass=n,this.nativeElement=this.el.nativeElement,this.rnd.setElementClass(this.nativeElement,this.fbClass,!0)}return t.prototype.setAttribute=function(t,e){t&&e&&this.rnd.setElementAttribute(this.nativeElement,t,e)},t.prototype.getAttribute=function(t){if(t)return this.nativeElement.getAttribute(t)},t}(),l=function(t){function e(e,n){return t.call(this,e,n,"fb-comment-embed")||this}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],l.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],l.prototype,"width",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],l.prototype,"includeParent",void 0);var h=function(t){function e(e,n){var r=t.call(this,e,n,"fb-comments")||this;return r.href=window.location.href,r}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],h.prototype,"colorscheme",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],h.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],h.prototype,"mobile",void 0),Object(a.b)([s,Object(a.d)("design:type",Number)],h.prototype,"numposts",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],h.prototype,"orderBy",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],h.prototype,"width",void 0);var d=function(t){function e(e,n){return t.call(this,e,n,"fb-follow")||this}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],d.prototype,"colorScheme",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],d.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],d.prototype,"kidDirectedSite",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],d.prototype,"layout",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],d.prototype,"showFaces",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],d.prototype,"size",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],d.prototype,"width",void 0);var p=function(t){function e(e,n){var r=t.call(this,e,n,"fb-like")||this;return r.href=window.location.href,r}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],p.prototype,"action",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],p.prototype,"colorScheme",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],p.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],p.prototype,"kidDirectedSite",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],p.prototype,"layout",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],p.prototype,"ref",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],p.prototype,"share",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],p.prototype,"showFaces",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],p.prototype,"size",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],p.prototype,"width",void 0);var f=function(t){function e(e,n){return t.call(this,e,n,"fb-page")||this}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],f.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",Number)],f.prototype,"width",void 0),Object(a.b)([s,Object(a.d)("design:type",Number)],f.prototype,"height",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],f.prototype,"tabs",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],f.prototype,"hideCover",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],f.prototype,"showFacepile",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],f.prototype,"hideCTA",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],f.prototype,"smallHeader",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],f.prototype,"adaptContainerWidth",void 0);var m=function(t){function e(e,n){return t.call(this,e,n,"fb-post")||this}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],m.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],m.prototype,"width",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],m.prototype,"showText",void 0);var v=function(t){function e(e,n){return t.call(this,e,n,"fb-quote")||this}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],v.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],v.prototype,"layout",void 0);var g=function(t){function e(e,n){var r=t.call(this,e,n,"fb-save")||this;return r.uri=window.location.href,r}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],g.prototype,"uri",void 0);var y=function(t){function e(e,n){var r=t.call(this,e,n,"fb-send")||this;return r.href=window.location.href,r}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],y.prototype,"colorScheme",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],y.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],y.prototype,"kidDirectedSite",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],y.prototype,"ref",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],y.prototype,"size",void 0);var b=function(t){function e(e,n){return t.call(this,e,n,"fb-share-button")||this}return Object(a.c)(e,t),e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],b.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],b.prototype,"layout",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],b.prototype,"mobileIframe",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],b.prototype,"size",void 0);var x=function(t){function e(e,n){var r=t.call(this,e,n,"fb-video")||this;return r.startedPlaying=new i.l,r.paused=new i.l,r.finishedPlaying=new i.l,r.startedBuffering=new i.l,r.finishedBuffering=new i.l,r.error=new i.l,r._listeners=[],r.nativeElement.id=r._id="video-"+String(Math.floor(1e4*Math.random()+1)),r}return Object(a.c)(e,t),e.prototype.ngOnInit=function(){var t=this;FB.Event.subscribe("xfbml.ready",function(e){"video"===e.type&&e.id===t._id&&(t._instance=e.instance,t._listeners.push(t._instance.subscribe("startedPlaying",function(e){return t.startedPlaying.emit(e)}),t._instance.subscribe("paused",function(e){return t.paused.emit(e)}),t._instance.subscribe("finishedPlaying",function(e){return t.finishedPlaying.emit(e)}),t._instance.subscribe("startedBuffering",function(e){return t.startedBuffering.emit(e)}),t._instance.subscribe("finishedBuffering",function(e){return t.finishedBuffering.emit(e)}),t._instance.subscribe("error",function(e){return t.error.emit(e)})))})},e.prototype.ngOnDestroy=function(){this._listeners.forEach(function(t){"function"==typeof t.release&&t.release()})},e.prototype.play=function(){},e.prototype.pause=function(){},e.prototype.seek=function(t){},e.prototype.mute=function(){},e.prototype.unmute=function(){},e.prototype.isMuted=function(){},e.prototype.setVolume=function(t){},e.prototype.getVolume=function(){},e.prototype.getCurrentPosition=function(){},e.prototype.getDuration=function(){},e}(u);Object(a.b)([s,Object(a.d)("design:type",String)],x.prototype,"href",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],x.prototype,"allowfullscreen",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],x.prototype,"autoplay",void 0),Object(a.b)([s,Object(a.d)("design:type",String)],x.prototype,"width",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],x.prototype,"showText",void 0),Object(a.b)([s,Object(a.d)("design:type",Boolean)],x.prototype,"showCaptions",void 0),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",void 0)],x.prototype,"play",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",void 0)],x.prototype,"pause",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[Number]),Object(a.d)("design:returntype",void 0)],x.prototype,"seek",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",void 0)],x.prototype,"mute",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",void 0)],x.prototype,"unmute",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",Boolean)],x.prototype,"isMuted",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[Number]),Object(a.d)("design:returntype",void 0)],x.prototype,"setVolume",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",Number)],x.prototype,"getVolume",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",void 0)],x.prototype,"getCurrentPosition",null),Object(a.b)([c,Object(a.d)("design:type",Function),Object(a.d)("design:paramtypes",[]),Object(a.d)("design:returntype",void 0)],x.prototype,"getDuration",null);var w=function(){function t(){}return t.prototype.init=function(t){try{return Promise.resolve(FB.init(t))}catch(t){return Promise.reject(t)}},t.prototype.api=function(t,e,n){return void 0===e&&(e="get"),void 0===n&&(n={}),new Promise(function(r,i){try{FB.api(t,e,n,function(t){t?t.error?i(t.error):r(t):i()})}catch(t){i(t)}})},t.prototype.ui=function(t){return new Promise(function(e,n){try{FB.ui(t,function(t){t?t.error?n(t.error):e(t):n()})}catch(t){n(t)}})},t.prototype.getLoginStatus=function(){return new Promise(function(t,e){try{FB.getLoginStatus(function(n){n?t(n):e()})}catch(t){e(t)}})},t.prototype.login=function(t){return new Promise(function(e,n){try{FB.login(function(t){t.authResponse?e(t):n()},t)}catch(t){n(t)}})},t.prototype.logout=function(){return new Promise(function(t,e){try{FB.logout(function(e){t(e)})}catch(t){e(t)}})},t.prototype.getAuthResponse=function(){try{return FB.getAuthResponse()}catch(t){console.error("ng2-facebook-sdk: ",t)}},t}(),_=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[w]}},t}(),S=function(t){this.fb=t,t.init({appId:"396487237479561",xfbml:!0,version:"v2.8"})},T=n("YaPU"),M=function(){},A=new i.n("Location Initialized"),E=function(){},C=new i.n("appBaseHref"),P=function(){function t(e){var n=this;this._subject=new i.l,this._platformStrategy=e;var r=this._platformStrategy.getBaseHref();this._baseHref=t.stripTrailingSlash(O(r)),this._platformStrategy.onPopState(function(t){n._subject.emit({url:n.path(!0),pop:!0,type:t.type})})}return t.prototype.path=function(t){return void 0===t&&(t=!1),this.normalize(this._platformStrategy.path(t))},t.prototype.isCurrentPathEqualTo=function(e,n){return void 0===n&&(n=""),this.path()==this.normalize(e+t.normalizeQueryParams(n))},t.prototype.normalize=function(e){return t.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,O(e)))},t.prototype.prepareExternalUrl=function(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)},t.prototype.go=function(t,e){void 0===e&&(e=""),this._platformStrategy.pushState(null,"",t,e)},t.prototype.replaceState=function(t,e){void 0===e&&(e=""),this._platformStrategy.replaceState(null,"",t,e)},t.prototype.forward=function(){this._platformStrategy.forward()},t.prototype.back=function(){this._platformStrategy.back()},t.prototype.subscribe=function(t,e,n){return this._subject.subscribe({next:t,error:e,complete:n})},t.normalizeQueryParams=function(t){return t&&"?"!==t[0]?"?"+t:t},t.joinWithSlash=function(t,e){if(0==t.length)return e;if(0==e.length)return t;var n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e},t.stripTrailingSlash=function(t){var e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)},t}();function O(t){return t.replace(/\/index.html$/,"")}var N=function(t){function e(e,n){var r=t.call(this)||this;return r._platformLocation=e,r._baseHref="",null!=n&&(r._baseHref=n),r}return Object(a.c)(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e},e.prototype.prepareExternalUrl=function(t){var e=P.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e},e.prototype.pushState=function(t,e,n,r){var i=this.prepareExternalUrl(n+P.normalizeQueryParams(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(t,e,i)},e.prototype.replaceState=function(t,e,n,r){var i=this.prepareExternalUrl(n+P.normalizeQueryParams(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,i)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(E),L=function(t){function e(e,n){var r=t.call(this)||this;if(r._platformLocation=e,null==n&&(n=r._platformLocation.getBaseHrefFromDOM()),null==n)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return r._baseHref=n,r}return Object(a.c)(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.prepareExternalUrl=function(t){return P.joinWithSlash(this._baseHref,t)},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.pathname+P.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&t?""+e+n:e},e.prototype.pushState=function(t,e,n,r){var i=this.prepareExternalUrl(n+P.normalizeQueryParams(r));this._platformLocation.pushState(t,e,i)},e.prototype.replaceState=function(t,e,n,r){var i=this.prepareExternalUrl(n+P.normalizeQueryParams(r));this._platformLocation.replaceState(t,e,i)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(E),I=["en",[["a","p"],["AM","PM"]],[["AM","PM"],,],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",,"{1} 'at' {0}"],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",function(t){var e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}],R={},D=function(){var t={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return t[t.Zero]="Zero",t[t.One]="One",t[t.Two]="Two",t[t.Few]="Few",t[t.Many]="Many",t[t.Other]="Other",t}(),F=new i.n("UseV4Plurals"),U=function(){},k=function(t){function e(e,n){var r=t.call(this)||this;return r.locale=e,r.deprecatedPluralFn=n,r}return Object(a.c)(e,t),e.prototype.getPluralCategory=function(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){var e=t.toLowerCase().replace(/_/g,"-"),n=R[e];if(n)return n;var r=e.split("-")[0];if(n=R[r])return n;if("en"===r)return I;throw new Error('Missing locale data for the locale "'+t+'".')}(t)[17]}(e||this.locale)(t)){case D.Zero:return"zero";case D.One:return"one";case D.Two:return"two";case D.Few:return"few";case D.Many:return"many";default:return"other"}},e}(U),j=function(){function t(t,e,n,r){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=r}return Object.defineProperty(t.prototype,"first",{get:function(){return 0===this.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this.index===this.count-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"even",{get:function(){return this.index%2==0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"odd",{get:function(){return!this.even},enumerable:!0,configurable:!0}),t}(),B=function(){function t(t,e,n){this._viewContainer=t,this._template=e,this._differs=n,this._differ=null}return Object.defineProperty(t.prototype,"ngForTrackBy",{get:function(){return this._trackByFn},set:function(t){Object(i.R)()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(t)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngForTemplate",{set:function(t){t&&(this._template=t)},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){if("ngForOf"in t){var e=t.ngForOf.currentValue;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(t){throw new Error("Cannot find a differ supporting object '"+e+"' of type '"+((n=e).name||typeof n)+"'. NgFor only supports binding to Iterables such as Arrays.")}}var n},t.prototype.ngDoCheck=function(){if(this._differ){var t=this._differ.diff(this.ngForOf);t&&this._applyChanges(t)}},t.prototype._applyChanges=function(t){var e=this,n=[];t.forEachOperation(function(t,r,i){if(null==t.previousIndex){var o=e._viewContainer.createEmbeddedView(e._template,new j(null,e.ngForOf,-1,-1),i),a=new z(t,o);n.push(a)}else null==i?e._viewContainer.remove(r):(o=e._viewContainer.get(r),e._viewContainer.move(o,i),a=new z(t,o),n.push(a))});for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);r=0;for(var i=this._viewContainer.length;r<i;r++){var o=this._viewContainer.get(r);o.context.index=r,o.context.count=i}t.forEachIdentityChange(function(t){e._viewContainer.get(t.currentIndex).context.$implicit=t.item})},t.prototype._perViewChange=function(t,e){t.context.$implicit=e.item},t}(),z=function(t,e){this.record=t,this.view=e},V=function(){function t(t,e){this._viewContainer=t,this._context=new G,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}return Object.defineProperty(t.prototype,"ngIf",{set:function(t){this._context.$implicit=this._context.ngIf=t,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfThen",{set:function(t){this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfElse",{set:function(t){this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),t.prototype._updateView=function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))},t}(),G=function(){this.$implicit=null,this.ngIf=null},H=function(){},W=new i.n("DocumentToken"),X=null;function q(){return X}var Y,Z={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},J={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Q={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};i._2.Node&&(Y=i._2.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))});var K,$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.parse=function(t){throw new Error("parse not implemented")},e.makeCurrent=function(){var t;t=new e,X||(X=t)},e.prototype.hasProperty=function(t,e){return e in t},e.prototype.setProperty=function(t,e,n){t[e]=n},e.prototype.getProperty=function(t,e){return t[e]},e.prototype.invoke=function(t,e,n){var r;(r=t)[e].apply(r,n)},e.prototype.logError=function(t){window.console&&(console.error?console.error(t):console.log(t))},e.prototype.log=function(t){window.console&&window.console.log&&window.console.log(t)},e.prototype.logGroup=function(t){window.console&&window.console.group&&window.console.group(t)},e.prototype.logGroupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},Object.defineProperty(e.prototype,"attrToPropMap",{get:function(){return Z},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return Y.call(t,e)},e.prototype.querySelector=function(t,e){return t.querySelector(e)},e.prototype.querySelectorAll=function(t,e){return t.querySelectorAll(e)},e.prototype.on=function(t,e,n){t.addEventListener(e,n,!1)},e.prototype.onAndCancel=function(t,e,n){return t.addEventListener(e,n,!1),function(){t.removeEventListener(e,n,!1)}},e.prototype.dispatchEvent=function(t,e){t.dispatchEvent(e)},e.prototype.createMouseEvent=function(t){var e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e},e.prototype.createEvent=function(t){var e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e},e.prototype.preventDefault=function(t){t.preventDefault(),t.returnValue=!1},e.prototype.isPrevented=function(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue},e.prototype.getInnerHTML=function(t){return t.innerHTML},e.prototype.getTemplateContent=function(t){return"content"in t&&this.isTemplateElement(t)?t.content:null},e.prototype.getOuterHTML=function(t){return t.outerHTML},e.prototype.nodeName=function(t){return t.nodeName},e.prototype.nodeValue=function(t){return t.nodeValue},e.prototype.type=function(t){return t.type},e.prototype.content=function(t){return this.hasProperty(t,"content")?t.content:t},e.prototype.firstChild=function(t){return t.firstChild},e.prototype.nextSibling=function(t){return t.nextSibling},e.prototype.parentElement=function(t){return t.parentNode},e.prototype.childNodes=function(t){return t.childNodes},e.prototype.childNodesAsList=function(t){for(var e=t.childNodes,n=new Array(e.length),r=0;r<e.length;r++)n[r]=e[r];return n},e.prototype.clearNodes=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},e.prototype.appendChild=function(t,e){t.appendChild(e)},e.prototype.removeChild=function(t,e){t.removeChild(e)},e.prototype.replaceChild=function(t,e,n){t.replaceChild(e,n)},e.prototype.remove=function(t){return t.parentNode&&t.parentNode.removeChild(t),t},e.prototype.insertBefore=function(t,e,n){t.insertBefore(n,e)},e.prototype.insertAllBefore=function(t,e,n){n.forEach(function(n){return t.insertBefore(n,e)})},e.prototype.insertAfter=function(t,e,n){t.insertBefore(n,e.nextSibling)},e.prototype.setInnerHTML=function(t,e){t.innerHTML=e},e.prototype.getText=function(t){return t.textContent},e.prototype.setText=function(t,e){t.textContent=e},e.prototype.getValue=function(t){return t.value},e.prototype.setValue=function(t,e){t.value=e},e.prototype.getChecked=function(t){return t.checked},e.prototype.setChecked=function(t,e){t.checked=e},e.prototype.createComment=function(t){return this.getDefaultDocument().createComment(t)},e.prototype.createTemplate=function(t){var e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e},e.prototype.createElement=function(t,e){return(e=e||this.getDefaultDocument()).createElement(t)},e.prototype.createElementNS=function(t,e,n){return(n=n||this.getDefaultDocument()).createElementNS(t,e)},e.prototype.createTextNode=function(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)},e.prototype.createScriptTag=function(t,e,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(t,e),r},e.prototype.createStyleElement=function(t,e){var n=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(t,e)),n},e.prototype.createShadowRoot=function(t){return t.createShadowRoot()},e.prototype.getShadowRoot=function(t){return t.shadowRoot},e.prototype.getHost=function(t){return t.host},e.prototype.clone=function(t){return t.cloneNode(!0)},e.prototype.getElementsByClassName=function(t,e){return t.getElementsByClassName(e)},e.prototype.getElementsByTagName=function(t,e){return t.getElementsByTagName(e)},e.prototype.classList=function(t){return Array.prototype.slice.call(t.classList,0)},e.prototype.addClass=function(t,e){t.classList.add(e)},e.prototype.removeClass=function(t,e){t.classList.remove(e)},e.prototype.hasClass=function(t,e){return t.classList.contains(e)},e.prototype.setStyle=function(t,e,n){t.style[e]=n},e.prototype.removeStyle=function(t,e){t.style[e]=""},e.prototype.getStyle=function(t,e){return t.style[e]},e.prototype.hasStyle=function(t,e,n){var r=this.getStyle(t,e)||"";return n?r==n:r.length>0},e.prototype.tagName=function(t){return t.tagName},e.prototype.attributeMap=function(t){for(var e=new Map,n=t.attributes,r=0;r<n.length;r++){var i=n.item(r);e.set(i.name,i.value)}return e},e.prototype.hasAttribute=function(t,e){return t.hasAttribute(e)},e.prototype.hasAttributeNS=function(t,e,n){return t.hasAttributeNS(e,n)},e.prototype.getAttribute=function(t,e){return t.getAttribute(e)},e.prototype.getAttributeNS=function(t,e,n){return t.getAttributeNS(e,n)},e.prototype.setAttribute=function(t,e,n){t.setAttribute(e,n)},e.prototype.setAttributeNS=function(t,e,n,r){t.setAttributeNS(e,n,r)},e.prototype.removeAttribute=function(t,e){t.removeAttribute(e)},e.prototype.removeAttributeNS=function(t,e,n){t.removeAttributeNS(e,n)},e.prototype.templateAwareRoot=function(t){return this.isTemplateElement(t)?this.content(t):t},e.prototype.createHtmlDocument=function(){return document.implementation.createHTMLDocument("fakeTitle")},e.prototype.getDefaultDocument=function(){return document},e.prototype.getBoundingClientRect=function(t){try{return t.getBoundingClientRect()}catch(t){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}},e.prototype.getTitle=function(t){return t.title},e.prototype.setTitle=function(t,e){t.title=e||""},e.prototype.elementMatches=function(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))},e.prototype.isTemplateElement=function(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName},e.prototype.isTextNode=function(t){return t.nodeType===Node.TEXT_NODE},e.prototype.isCommentNode=function(t){return t.nodeType===Node.COMMENT_NODE},e.prototype.isElementNode=function(t){return t.nodeType===Node.ELEMENT_NODE},e.prototype.hasShadowRoot=function(t){return null!=t.shadowRoot&&t instanceof HTMLElement},e.prototype.isShadowRoot=function(t){return t instanceof DocumentFragment},e.prototype.importIntoDoc=function(t){return document.importNode(this.templateAwareRoot(t),!0)},e.prototype.adoptNode=function(t){return document.adoptNode(t)},e.prototype.getHref=function(t){return t.getAttribute("href")},e.prototype.getEventKey=function(t){var e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&Q.hasOwnProperty(e)&&(e=Q[e]))}return J[e]||e},e.prototype.getGlobalEventTarget=function(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null},e.prototype.getHistory=function(){return window.history},e.prototype.getLocation=function(){return window.location},e.prototype.getBaseHref=function(t){var e,n=tt||(tt=document.querySelector("base"))?tt.getAttribute("href"):null;return null==n?null:(e=n,K||(K=document.createElement("a")),K.setAttribute("href",e),"/"===K.pathname.charAt(0)?K.pathname:"/"+K.pathname)},e.prototype.resetBaseElement=function(){tt=null},e.prototype.getUserAgent=function(){return window.navigator.userAgent},e.prototype.setData=function(t,e,n){this.setAttribute(t,"data-"+e,n)},e.prototype.getData=function(t,e){return this.getAttribute(t,"data-"+e)},e.prototype.getComputedStyle=function(t){return getComputedStyle(t)},e.prototype.supportsWebAnimation=function(){return"function"==typeof Element.prototype.animate},e.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},e.prototype.supportsCookies=function(){return!0},e.prototype.getCookie=function(t){return function(t,e){e=encodeURIComponent(e);for(var n=0,r=t.split(";");n<r.length;n++){var i=r[n],o=i.indexOf("="),a=-1==o?[i,""]:[i.slice(0,o),i.slice(o+1)],s=a[1];if(a[0].trim()===e)return decodeURIComponent(s)}return null}(document.cookie,t)},e.prototype.setCookie=function(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)},e}(function(t){function e(){var e=t.call(this)||this;e._animationPrefix=null,e._transitionEnd=null;try{var n=e.createElement("div",document);if(null!=e.getStyle(n,"animationName"))e._animationPrefix="";else for(var r=["Webkit","Moz","O","ms"],i=0;i<r.length;i++)if(null!=e.getStyle(n,r[i]+"AnimationName")){e._animationPrefix="-"+r[i].toLowerCase()+"-";break}var o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(o).forEach(function(t){null!=e.getStyle(n,t)&&(e._transitionEnd=o[t])})}catch(t){e._animationPrefix=null,e._transitionEnd=null}return e}return Object(a.c)(e,t),e.prototype.getDistributedNodes=function(t){return t.getDistributedNodes()},e.prototype.resolveAndSetHref=function(t,e,n){t.href=null==n?e:e+"/../"+n},e.prototype.supportsDOMEvents=function(){return!0},e.prototype.supportsNativeShadowDOM=function(){return"function"==typeof document.body.createShadowRoot},e.prototype.getAnimationPrefix=function(){return this._animationPrefix?this._animationPrefix:""},e.prototype.getTransitionEnd=function(){return this._transitionEnd?this._transitionEnd:""},e.prototype.supportsAnimation=function(){return null!=this._animationPrefix&&null!=this._transitionEnd},e}(function(){function t(){this.resourceLoaderType=null}return Object.defineProperty(t.prototype,"attrToPropMap",{get:function(){return this._attrToPropMap},set:function(t){this._attrToPropMap=t},enumerable:!0,configurable:!0}),t}())),tt=null,et=W;function nt(){return!!window.history.pushState}var rt=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._init(),n}return Object(a.c)(e,t),e.prototype._init=function(){this.location=q().getLocation(),this._history=q().getHistory()},e.prototype.getBaseHrefFromDOM=function(){return q().getBaseHref(this._doc)},e.prototype.onPopState=function(t){q().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)},e.prototype.onHashChange=function(t){q().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)},Object.defineProperty(e.prototype,"pathname",{get:function(){return this.location.pathname},set:function(t){this.location.pathname=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return this.location.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this.location.hash},enumerable:!0,configurable:!0}),e.prototype.pushState=function(t,e,n){nt()?this._history.pushState(t,e,n):this.location.hash=n},e.prototype.replaceState=function(t,e,n){nt()?this._history.replaceState(t,e,n):this.location.hash=n},e.prototype.forward=function(){this._history.forward()},e.prototype.back=function(){this._history.back()},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:i.m,args:[et]}]}]},e}(M),it=function(){function t(t){this._doc=t,this._dom=q()}return t.prototype.addTag=function(t,e){return void 0===e&&(e=!1),t?this._getOrCreateElement(t,e):null},t.prototype.addTags=function(t,e){var n=this;return void 0===e&&(e=!1),t?t.reduce(function(t,r){return r&&t.push(n._getOrCreateElement(r,e)),t},[]):[]},t.prototype.getTag=function(t){return t&&this._dom.querySelector(this._doc,"meta["+t+"]")||null},t.prototype.getTags=function(t){if(!t)return[];var e=this._dom.querySelectorAll(this._doc,"meta["+t+"]");return e?[].slice.call(e):[]},t.prototype.updateTag=function(t,e){if(!t)return null;e=e||this._parseSelector(t);var n=this.getTag(e);return n?this._setMetaElementAttributes(t,n):this._getOrCreateElement(t,!0)},t.prototype.removeTag=function(t){this.removeTagElement(this.getTag(t))},t.prototype.removeTagElement=function(t){t&&this._dom.remove(t)},t.prototype._getOrCreateElement=function(t,e){if(void 0===e&&(e=!1),!e){var n=this._parseSelector(t),r=this.getTag(n);if(r&&this._containsAttributes(t,r))return r}var i=this._dom.createElement("meta");this._setMetaElementAttributes(t,i);var o=this._dom.getElementsByTagName(this._doc,"head")[0];return this._dom.appendChild(o,i),i},t.prototype._setMetaElementAttributes=function(t,e){var n=this;return Object.keys(t).forEach(function(r){return n._dom.setAttribute(e,r,t[r])}),e},t.prototype._parseSelector=function(t){var e=t.name?"name":"property";return e+'="'+t[e]+'"'},t.prototype._containsAttributes=function(t,e){var n=this;return Object.keys(t).every(function(r){return n._dom.getAttribute(e,r)===t[r]})},t}(),ot=new i.n("TRANSITION_ID"),at=[{provide:i.d,useFactory:function(t,e,n){return function(){n.get(i.e).donePromise.then(function(){var n=q();Array.prototype.slice.apply(n.querySelectorAll(e,"style[ng-transition]")).filter(function(e){return n.getAttribute(e,"ng-transition")===t}).forEach(function(t){return n.remove(t)})})}},deps:[ot,et,i.o],multi:!0}],st=function(){function t(){}return t.init=function(){Object(i.T)(new t)},t.prototype.addToWindow=function(t){i._2.getAngularTestability=function(e,n){void 0===n&&(n=!0);var r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},i._2.getAllAngularTestabilities=function(){return t.getAllTestabilities()},i._2.getAllAngularRootElements=function(){return t.getAllRootElements()},i._2.frameworkStabilizers||(i._2.frameworkStabilizers=[]),i._2.frameworkStabilizers.push(function(t){var e=i._2.getAllAngularTestabilities(),n=e.length,r=!1,o=function(e){r=r||e,0==--n&&t(r)};e.forEach(function(t){t.whenStable(o)})})},t.prototype.findTestabilityInTree=function(t,e,n){if(null==e)return null;var r=t.getTestability(e);return null!=r?r:n?q().isShadowRoot(e)?this.findTestabilityInTree(t,q().getHost(e),!0):this.findTestabilityInTree(t,q().parentElement(e),!0):null},t}(),ct=function(){function t(t){this._doc=t}return t.prototype.getTitle=function(){return q().getTitle(this._doc)},t.prototype.setTitle=function(t){q().setTitle(this._doc,t)},t}();function ut(t,e){"undefined"!=typeof COMPILED&&COMPILED||((i._2.ng=i._2.ng||{})[t]=e)}var lt={ApplicationRef:i.g,NgZone:i.w};function ht(t){return Object(i.Q)(t)}var dt=new i.n("EventManagerPlugins"),pt=function(){function t(t,e){var n=this;this._zone=e,this._eventNameToPlugin=new Map,t.forEach(function(t){return t.manager=n}),this._plugins=t.slice().reverse()}return t.prototype.addEventListener=function(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)},t.prototype.addGlobalEventListener=function(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)},t.prototype.getZone=function(){return this._zone},t.prototype._findPluginFor=function(t){var e=this._eventNameToPlugin.get(t);if(e)return e;for(var n=this._plugins,r=0;r<n.length;r++){var i=n[r];if(i.supports(t))return this._eventNameToPlugin.set(t,i),i}throw new Error("No event manager plugin found for event "+t)},t}(),ft=function(){function t(t){this._doc=t}return t.prototype.addGlobalEventListener=function(t,e,n){var r=q().getGlobalEventTarget(this._doc,t);if(!r)throw new Error("Unsupported event target "+r+" for event "+e);return this.addEventListener(r,e,n)},t}(),mt=function(){function t(){this._stylesSet=new Set}return t.prototype.addStyles=function(t){var e=this,n=new Set;t.forEach(function(t){e._stylesSet.has(t)||(e._stylesSet.add(t),n.add(t))}),this.onStylesAdded(n)},t.prototype.onStylesAdded=function(t){},t.prototype.getAllStyles=function(){return Array.from(this._stylesSet)},t}(),vt=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._hostNodes=new Set,n._styleNodes=new Set,n._hostNodes.add(e.head),n}return Object(a.c)(e,t),e.prototype._addStylesToHost=function(t,e){var n=this;t.forEach(function(t){var r=n._doc.createElement("style");r.textContent=t,n._styleNodes.add(e.appendChild(r))})},e.prototype.addHost=function(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)},e.prototype.removeHost=function(t){this._hostNodes.delete(t)},e.prototype.onStylesAdded=function(t){var e=this;this._hostNodes.forEach(function(n){return e._addStylesToHost(t,n)})},e.prototype.ngOnDestroy=function(){this._styleNodes.forEach(function(t){return q().remove(t)})},e}(mt),gt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},yt=/%COMP%/g,bt="_nghost-%COMP%",xt="_ngcontent-%COMP%";function wt(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];Array.isArray(i)?wt(t,i,n):(i=i.replace(yt,t),n.push(i))}return n}function _t(t){return function(e){!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}var St=function(){function t(t,e){this.eventManager=t,this.sharedStylesHost=e,this.rendererByCompId=new Map,this.defaultRenderer=new Tt(t)}return t.prototype.createRenderer=function(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case i.L.Emulated:var n=this.rendererByCompId.get(e.id);return n||(n=new Ct(this.eventManager,this.sharedStylesHost,e),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n;case i.L.Native:return new Pt(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){var r=wt(e.id,e.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}},t.prototype.begin=function(){},t.prototype.end=function(){},t}(),Tt=function(){function t(t){this.eventManager=t,this.data=Object.create(null)}return t.prototype.destroy=function(){},t.prototype.createElement=function(t,e){return e?document.createElementNS(gt[e],t):document.createElement(t)},t.prototype.createComment=function(t){return document.createComment(t)},t.prototype.createText=function(t){return document.createTextNode(t)},t.prototype.appendChild=function(t,e){t.appendChild(e)},t.prototype.insertBefore=function(t,e,n){t&&t.insertBefore(e,n)},t.prototype.removeChild=function(t,e){t&&t.removeChild(e)},t.prototype.selectRootElement=function(t){var e="string"==typeof t?document.querySelector(t):t;if(!e)throw new Error('The selector "'+t+'" did not match any elements');return e.textContent="",e},t.prototype.parentNode=function(t){return t.parentNode},t.prototype.nextSibling=function(t){return t.nextSibling},t.prototype.setAttribute=function(t,e,n,r){if(r){e=r+":"+e;var i=gt[r];i?t.setAttributeNS(i,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)},t.prototype.removeAttribute=function(t,e,n){if(n){var r=gt[n];r?t.removeAttributeNS(r,e):t.removeAttribute(n+":"+e)}else t.removeAttribute(e)},t.prototype.addClass=function(t,e){t.classList.add(e)},t.prototype.removeClass=function(t,e){t.classList.remove(e)},t.prototype.setStyle=function(t,e,n,r){r&i.B.DashCase?t.style.setProperty(e,n,r&i.B.Important?"important":""):t.style[e]=n},t.prototype.removeStyle=function(t,e,n){n&i.B.DashCase?t.style.removeProperty(e):t.style[e]=""},t.prototype.setProperty=function(t,e,n){At(e,"property"),t[e]=n},t.prototype.setValue=function(t,e){t.nodeValue=e},t.prototype.listen=function(t,e,n){return At(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,_t(n)):this.eventManager.addEventListener(t,e,_t(n))},t}(),Mt="@".charCodeAt(0);function At(t,e){if(t.charCodeAt(0)===Mt)throw new Error("Found the synthetic "+e+" "+t+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}var Et,Ct=function(t){function e(e,n,r){var i=t.call(this,e)||this;i.component=r;var o=wt(r.id,r.styles,[]);return n.addStyles(o),i.contentAttr=xt.replace(yt,r.id),i.hostAttr=bt.replace(yt,r.id),i}return Object(a.c)(e,t),e.prototype.applyToHost=function(e){t.prototype.setAttribute.call(this,e,this.hostAttr,"")},e.prototype.createElement=function(e,n){var r=t.prototype.createElement.call(this,e,n);return t.prototype.setAttribute.call(this,r,this.contentAttr,""),r},e}(Tt),Pt=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;o.sharedStylesHost=n,o.hostEl=r,o.component=i,o.shadowRoot=r.createShadowRoot(),o.sharedStylesHost.addHost(o.shadowRoot);for(var a=wt(i.id,i.styles,[]),s=0;s<a.length;s++){var c=document.createElement("style");c.textContent=a[s],o.shadowRoot.appendChild(c)}return o}return Object(a.c)(e,t),e.prototype.nodeOrShadowRoot=function(t){return t===this.hostEl?this.shadowRoot:t},e.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},e.prototype.appendChild=function(e,n){return t.prototype.appendChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.insertBefore=function(e,n,r){return t.prototype.insertBefore.call(this,this.nodeOrShadowRoot(e),n,r)},e.prototype.removeChild=function(e,n){return t.prototype.removeChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.parentNode=function(e){return this.nodeOrShadowRoot(t.prototype.parentNode.call(this,this.nodeOrShadowRoot(e)))},e}(Tt),Ot="undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t},Nt=Ot("addEventListener"),Lt=Ot("removeEventListener"),It={},Rt="__zone_symbol__propagationStopped";"undefined"!=typeof Zone&&Zone[Ot("BLACK_LISTED_EVENTS")]&&(Et={});var Dt=function(t){return!!Et&&Et.hasOwnProperty(t)},Ft=function(t){var e=It[t.type];if(e){var n=this[e];if(n){var r=[t];if(1===n.length)return(a=n[0]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r);for(var i=n.slice(),o=0;o<i.length&&!0!==t[Rt];o++){var a;(a=i[o]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r)}}}},Ut=function(t){function e(e,n){var r=t.call(this,e)||this;return r.ngZone=n,r.patchEvent(),r}return Object(a.c)(e,t),e.prototype.patchEvent=function(){if(Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[Rt]=!0),t&&t.apply(this,arguments)}}},e.prototype.supports=function(t){return!0},e.prototype.addEventListener=function(t,e,n){var r=this,o=n;if(!t[Nt]||i.w.isInAngularZone()&&!Dt(e))t.addEventListener(e,o,!1);else{var a=It[e];a||(a=It[e]=Ot("ANGULAR"+e+"FALSE"));var s=t[a],c=s&&s.length>0;s||(s=t[a]=[]);var u=Dt(e)?Zone.root:Zone.current;if(0===s.length)s.push({zone:u,handler:o});else{for(var l=!1,h=0;h<s.length;h++)if(s[h].handler===o){l=!0;break}l||s.push({zone:u,handler:o})}c||t[Nt](e,Ft,!1)}return function(){return r.removeEventListener(t,e,o)}},e.prototype.removeEventListener=function(t,e,n){var r=t[Lt];if(!r)return t.removeEventListener.apply(t,[e,n,!1]);var i=It[e],o=i&&t[i];if(!o)return t.removeEventListener.apply(t,[e,n,!1]);for(var a=!1,s=0;s<o.length;s++)if(o[s].handler===n){a=!0,o.splice(s,1);break}a?0===o.length&&r.apply(t,[e,Ft,!1]):t.removeEventListener.apply(t,[e,n,!1])},e}(ft),kt={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},jt=new i.n("HammerGestureConfig"),Bt=function(){function t(){this.events=[],this.overrides={}}return t.prototype.buildHammer=function(t){var e=new Hammer(t);for(var n in e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0}),this.overrides)e.get(n).set(this.overrides[n]);return e},t}(),zt=function(t){function e(e,n){var r=t.call(this,e)||this;return r._config=n,r}return Object(a.c)(e,t),e.prototype.supports=function(t){if(!kt.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t))return!1;if(!window.Hammer)throw new Error("Hammer.js is not loaded, can not bind "+t+" event");return!0},e.prototype.addEventListener=function(t,e,n){var r=this,i=this.manager.getZone();return e=e.toLowerCase(),i.runOutsideAngular(function(){var o=r._config.buildHammer(t),a=function(t){i.runGuarded(function(){n(t)})};return o.on(e,a),function(){return o.off(e,a)}})},e.prototype.isCustomEvent=function(t){return this._config.events.indexOf(t)>-1},e}(ft),Vt=["alt","control","meta","shift"],Gt={alt:function(t){return t.altKey},control:function(t){return t.ctrlKey},meta:function(t){return t.metaKey},shift:function(t){return t.shiftKey}},Ht=function(t){function e(e){return t.call(this,e)||this}return Object(a.c)(e,t),e.prototype.supports=function(t){return null!=e.parseEventName(t)},e.prototype.addEventListener=function(t,n,r){var i=e.parseEventName(n),o=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return q().onAndCancel(t,i.domEventName,o)})},e.parseEventName=function(t){var n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;var i=e._normalizeKey(n.pop()),o="";if(Vt.forEach(function(t){var e=n.indexOf(t);e>-1&&(n.splice(e,1),o+=t+".")}),o+=i,0!=n.length||0===i.length)return null;var a={};return a.domEventName=r,a.fullKey=o,a},e.getEventFullKey=function(t){var e="",n=q().getEventKey(t);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Vt.forEach(function(r){r!=n&&(0,Gt[r])(t)&&(e+=r+".")}),e+=n},e.eventCallback=function(t,n,r){return function(i){e.getEventFullKey(i)===t&&r.runGuarded(function(){return n(i)})}},e._normalizeKey=function(t){switch(t){case"esc":return"escape";default:return t}},e}(ft),Wt=function(){function t(t,e){this.defaultDoc=t,this.DOM=e;var n=this.DOM.createHtmlDocument();if(this.inertBodyElement=n.body,null==this.inertBodyElement){var r=this.DOM.createElement("html",n);this.inertBodyElement=this.DOM.createElement("body",n),this.DOM.appendChild(r,this.inertBodyElement),this.DOM.appendChild(n,r)}this.DOM.setInnerHTML(this.inertBodyElement,'<svg><g onload="this.parentNode.remove()"></g></svg>'),!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.DOM.setInnerHTML(this.inertBodyElement,'<svg><p><style><img src="</style><img src=x onerror=alert(1)//">'),this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return t.prototype.getInertBodyElement_XHR=function(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(t){return null}var e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(null);var n=e.response.body;return n.removeChild(n.firstChild),n},t.prototype.getInertBodyElement_DOMParser=function(t){t="<body><remove></remove>"+t+"</body>";try{var e=(new window.DOMParser).parseFromString(t,"text/html").body;return e.removeChild(e.firstChild),e}catch(t){return null}},t.prototype.getInertBodyElement_InertDocument=function(t){var e=this.DOM.createElement("template");return"content"in e?(this.DOM.setInnerHTML(e,t),e):(this.DOM.setInnerHTML(this.inertBodyElement,t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)},t.prototype.stripCustomNsAttrs=function(t){var e=this;this.DOM.attributeMap(t).forEach(function(n,r){"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||e.DOM.removeAttribute(t,r)});for(var n=0,r=this.DOM.childNodesAsList(t);n<r.length;n++){var i=r[n];this.DOM.isElementNode(i)&&this.stripCustomNsAttrs(i)}},t}(),Xt=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,qt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Yt(t){return(t=String(t)).match(Xt)||t.match(qt)?t:(Object(i.R)()&&q().log("WARNING: sanitizing unsafe URL value "+t+" (see http://g.co/ng/security#xss)"),"unsafe:"+t)}function Zt(t){for(var e={},n=0,r=t.split(",");n<r.length;n++)e[r[n]]=!0;return e}function Jt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n={},r=0,i=t;r<i.length;r++){var o=i[r];for(var a in o)o.hasOwnProperty(a)&&(n[a]=!0)}return n}var Qt,Kt=Zt("area,br,col,hr,img,wbr"),$t=Zt("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),te=Zt("rp,rt"),ee=Jt(te,$t),ne=Jt(Kt,Jt($t,Zt("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Jt(te,Zt("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ee),re=Zt("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ie=Zt("srcset"),ae=Jt(re,ie,Zt("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width")),se=function(){function t(){this.sanitizedSomething=!1,this.buf=[],this.DOM=q()}return t.prototype.sanitizeChildren=function(t){for(var e=this.DOM.firstChild(t);e;)if(this.DOM.isElementNode(e)?this.startElement(e):this.DOM.isTextNode(e)?this.chars(this.DOM.nodeValue(e)):this.sanitizedSomething=!0,this.DOM.firstChild(e))e=this.DOM.firstChild(e);else for(;e;){this.DOM.isElementNode(e)&&this.endElement(e);var n=this.checkClobberedElement(e,this.DOM.nextSibling(e));if(n){e=n;break}e=this.checkClobberedElement(e,this.DOM.parentElement(e))}return this.buf.join("")},t.prototype.startElement=function(t){var e=this,n=this.DOM.nodeName(t).toLowerCase();ne.hasOwnProperty(n)?(this.buf.push("<"),this.buf.push(n),this.DOM.attributeMap(t).forEach(function(t,n){var r,i=n.toLowerCase();ae.hasOwnProperty(i)?(re[i]&&(t=Yt(t)),ie[i]&&(r=t,t=(r=String(r)).split(",").map(function(t){return Yt(t.trim())}).join(", ")),e.buf.push(" "),e.buf.push(n),e.buf.push('="'),e.buf.push(le(t)),e.buf.push('"')):e.sanitizedSomething=!0}),this.buf.push(">")):this.sanitizedSomething=!0},t.prototype.endElement=function(t){var e=this.DOM.nodeName(t).toLowerCase();ne.hasOwnProperty(e)&&!Kt.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))},t.prototype.chars=function(t){this.buf.push(le(t))},t.prototype.checkClobberedElement=function(t,e){if(e&&this.DOM.contains(t,e))throw new Error("Failed to sanitize html because the element is clobbered: "+this.DOM.getOuterHTML(t));return e},t}(),ce=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,ue=/([^\#-~ |!])/g;function le(t){return t.replace(/&/g,"&amp;").replace(ce,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(ue,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var he=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),de=/^url\(([^)]+)\)$/,pe=function(){},fe=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n}return Object(a.c)(e,t),e.prototype.sanitize=function(t,e){if(null==e)return null;switch(t){case i.D.NONE:return e;case i.D.HTML:return e instanceof ve?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){var n=q(),r=null;try{Qt=Qt||new Wt(t,n);var o=e?String(e):"";r=Qt.getInertBodyElement(o);var a=5,s=o;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,o=s,s=n.getInnerHTML(r),r=Qt.getInertBodyElement(o)}while(o!==s);var c=new se,u=c.sanitizeChildren(n.getTemplateContent(r)||r);return Object(i.R)()&&c.sanitizedSomething&&n.log("WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss)."),u}finally{if(r)for(var l=n.getTemplateContent(r)||r,h=0,d=n.childNodesAsList(l);h<d.length;h++)n.removeChild(l,d[h])}}(this._doc,String(e)));case i.D.STYLE:return e instanceof ge?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";var e=t.match(de);return e&&Yt(e[1])===e[1]||t.match(he)&&function(t){for(var e=!0,n=!0,r=0;r<t.length;r++){var i=t.charAt(r);"'"===i&&n?e=!e:'"'===i&&e&&(n=!n)}return e&&n}(t)?t:(Object(i.R)()&&q().log("WARNING: sanitizing unsafe style value "+t+" (see http://g.co/ng/security#xss)."),"unsafe")}(e));case i.D.SCRIPT:if(e instanceof ye)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case i.D.URL:return e instanceof xe||e instanceof be?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),Yt(String(e)));case i.D.RESOURCE_URL:if(e instanceof xe)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext "+t+" (see http://g.co/ng/security#xss)")}},e.prototype.checkNotSafeValue=function(t,e){if(t instanceof me)throw new Error("Required a safe "+e+", got a "+t.getTypeName()+" (see http://g.co/ng/security#xss)")},e.prototype.bypassSecurityTrustHtml=function(t){return new ve(t)},e.prototype.bypassSecurityTrustStyle=function(t){return new ge(t)},e.prototype.bypassSecurityTrustScript=function(t){return new ye(t)},e.prototype.bypassSecurityTrustUrl=function(t){return new be(t)},e.prototype.bypassSecurityTrustResourceUrl=function(t){return new xe(t)},e}(pe),me=function(){function t(t){this.changingThisBreaksApplicationSecurity=t}return t.prototype.toString=function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"},t}(),ve=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.getTypeName=function(){return"HTML"},e}(me),ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.getTypeName=function(){return"Style"},e}(me),ye=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.getTypeName=function(){return"Script"},e}(me),be=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.getTypeName=function(){return"URL"},e}(me),xe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.getTypeName=function(){return"ResourceURL"},e}(me),we=[{provide:i.y,useValue:"browser"},{provide:i.z,useValue:function(){$.makeCurrent(),st.init()},multi:!0},{provide:M,useClass:rt,deps:[et]},{provide:et,useFactory:function(){return document},deps:[]}],_e=Object(i.N)(i.S,"browser",we);function Se(){return new i.k}var Te=function(){function t(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return t.withServerTransition=function(e){return{ngModule:t,providers:[{provide:i.c,useValue:e.appId},{provide:ot,useExisting:i.c},at]}},t}();"undefined"!=typeof window&&window;var Me=function(){function t(){}return t.prototype.build=function(){return new XMLHttpRequest},t}(),Ae=function(){var t={Get:0,Post:1,Put:2,Delete:3,Options:4,Head:5,Patch:6};return t[t.Get]="Get",t[t.Post]="Post",t[t.Put]="Put",t[t.Delete]="Delete",t[t.Options]="Options",t[t.Head]="Head",t[t.Patch]="Patch",t}(),Ee=function(){var t={Basic:0,Cors:1,Default:2,Error:3,Opaque:4};return t[t.Basic]="Basic",t[t.Cors]="Cors",t[t.Default]="Default",t[t.Error]="Error",t[t.Opaque]="Opaque",t}(),Ce=function(){var t={NONE:0,JSON:1,FORM:2,FORM_DATA:3,TEXT:4,BLOB:5,ARRAY_BUFFER:6};return t[t.NONE]="NONE",t[t.JSON]="JSON",t[t.FORM]="FORM",t[t.FORM_DATA]="FORM_DATA",t[t.TEXT]="TEXT",t[t.BLOB]="BLOB",t[t.ARRAY_BUFFER]="ARRAY_BUFFER",t}(),Pe=function(){var t={Text:0,Json:1,ArrayBuffer:2,Blob:3};return t[t.Text]="Text",t[t.Json]="Json",t[t.ArrayBuffer]="ArrayBuffer",t[t.Blob]="Blob",t}(),Oe=function(){function t(e){var n=this;this._headers=new Map,this._normalizedNames=new Map,e&&(e instanceof t?e.forEach(function(t,e){t.forEach(function(t){return n.append(e,t)})}):Object.keys(e).forEach(function(t){var r=Array.isArray(e[t])?e[t]:[e[t]];n.delete(t),r.forEach(function(e){return n.append(t,e)})}))}return t.fromResponseHeaderString=function(e){var n=new t;return e.split("\n").forEach(function(t){var e=t.indexOf(":");if(e>0){var r=t.slice(0,e),i=t.slice(e+1).trim();n.set(r,i)}}),n},t.prototype.append=function(t,e){var n=this.getAll(t);null===n?this.set(t,e):n.push(e)},t.prototype.delete=function(t){var e=t.toLowerCase();this._normalizedNames.delete(e),this._headers.delete(e)},t.prototype.forEach=function(t){var e=this;this._headers.forEach(function(n,r){return t(n,e._normalizedNames.get(r),e._headers)})},t.prototype.get=function(t){var e=this.getAll(t);return null===e?null:e.length>0?e[0]:null},t.prototype.has=function(t){return this._headers.has(t.toLowerCase())},t.prototype.keys=function(){return Array.from(this._normalizedNames.values())},t.prototype.set=function(t,e){Array.isArray(e)?e.length&&this._headers.set(t.toLowerCase(),[e.join(",")]):this._headers.set(t.toLowerCase(),[e]),this.mayBeSetNormalizedName(t)},t.prototype.values=function(){return Array.from(this._headers.values())},t.prototype.toJSON=function(){var t=this,e={};return this._headers.forEach(function(n,r){var i=[];n.forEach(function(t){return i.push.apply(i,t.split(","))}),e[t._normalizedNames.get(r)]=i}),e},t.prototype.getAll=function(t){return this.has(t)&&this._headers.get(t.toLowerCase())||null},t.prototype.entries=function(){throw new Error('"entries" method is not implemented on Headers class')},t.prototype.mayBeSetNormalizedName=function(t){var e=t.toLowerCase();this._normalizedNames.has(e)||this._normalizedNames.set(e,t)},t}(),Ne=function(){function t(t){void 0===t&&(t={});var e=t.body,n=t.status,r=t.headers,i=t.statusText,o=t.type,a=t.url;this.body=null!=e?e:null,this.status=null!=n?n:null,this.headers=null!=r?r:null,this.statusText=null!=i?i:null,this.type=null!=o?o:null,this.url=null!=a?a:null}return t.prototype.merge=function(e){return new t({body:e&&null!=e.body?e.body:this.body,status:e&&null!=e.status?e.status:this.status,headers:e&&null!=e.headers?e.headers:this.headers,statusText:e&&null!=e.statusText?e.statusText:this.statusText,type:e&&null!=e.type?e.type:this.type,url:e&&null!=e.url?e.url:this.url})},t}(),Le=function(t){function e(){return t.call(this,{status:200,statusText:"Ok",type:Ee.Default,headers:new Oe})||this}return Object(a.c)(e,t),e}(Ne),Ie=function(){};function Re(t){if("string"!=typeof t)return t;switch(t.toUpperCase()){case"GET":return Ae.Get;case"POST":return Ae.Post;case"PUT":return Ae.Put;case"DELETE":return Ae.Delete;case"OPTIONS":return Ae.Options;case"HEAD":return Ae.Head;case"PATCH":return Ae.Patch}throw new Error('Invalid request method. The method "'+t+'" is not supported.')}var De=function(t){return t>=200&&t<300},Fe=function(){function t(){}return t.prototype.encodeKey=function(t){return Ue(t)},t.prototype.encodeValue=function(t){return Ue(t)},t}();function Ue(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var ke=function(){function t(t,e){void 0===t&&(t=""),void 0===e&&(e=new Fe),this.rawParams=t,this.queryEncoder=e,this.paramsMap=function(t){void 0===t&&(t="");var e=new Map;return t.length>0&&t.split("&").forEach(function(t){var n=t.indexOf("="),r=-1==n?[t,""]:[t.slice(0,n),t.slice(n+1)],i=r[0],o=r[1],a=e.get(i)||[];a.push(o),e.set(i,a)}),e}(t)}return t.prototype.clone=function(){var e=new t("",this.queryEncoder);return e.appendAll(this),e},t.prototype.has=function(t){return this.paramsMap.has(t)},t.prototype.get=function(t){var e=this.paramsMap.get(t);return Array.isArray(e)?e[0]:null},t.prototype.getAll=function(t){return this.paramsMap.get(t)||[]},t.prototype.set=function(t,e){if(void 0!==e&&null!==e){var n=this.paramsMap.get(t)||[];n.length=0,n.push(e),this.paramsMap.set(t,n)}else this.delete(t)},t.prototype.setAll=function(t){var e=this;t.paramsMap.forEach(function(t,n){var r=e.paramsMap.get(n)||[];r.length=0,r.push(t[0]),e.paramsMap.set(n,r)})},t.prototype.append=function(t,e){if(void 0!==e&&null!==e){var n=this.paramsMap.get(t)||[];n.push(e),this.paramsMap.set(t,n)}},t.prototype.appendAll=function(t){var e=this;t.paramsMap.forEach(function(t,n){for(var r=e.paramsMap.get(n)||[],i=0;i<t.length;++i)r.push(t[i]);e.paramsMap.set(n,r)})},t.prototype.replaceAll=function(t){var e=this;t.paramsMap.forEach(function(t,n){var r=e.paramsMap.get(n)||[];r.length=0;for(var i=0;i<t.length;++i)r.push(t[i]);e.paramsMap.set(n,r)})},t.prototype.toString=function(){var t=this,e=[];return this.paramsMap.forEach(function(n,r){n.forEach(function(n){return e.push(t.queryEncoder.encodeKey(r)+"="+t.queryEncoder.encodeValue(n))})}),e.join("&")},t.prototype.delete=function(t){this.paramsMap.delete(t)},t}(),je=function(){function t(){}return t.prototype.json=function(){return"string"==typeof this._body?JSON.parse(this._body):this._body instanceof ArrayBuffer?JSON.parse(this.text()):this._body},t.prototype.text=function(t){if(void 0===t&&(t="legacy"),this._body instanceof ke)return this._body.toString();if(this._body instanceof ArrayBuffer)switch(t){case"legacy":return String.fromCharCode.apply(null,new Uint16Array(this._body));case"iso-8859":return String.fromCharCode.apply(null,new Uint8Array(this._body));default:throw new Error("Invalid value for encodingHint: "+t)}return null==this._body?"":"object"==typeof this._body?JSON.stringify(this._body,null,2):this._body.toString()},t.prototype.arrayBuffer=function(){return this._body instanceof ArrayBuffer?this._body:function(t){for(var e=new Uint16Array(t.length),n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e.buffer}(this.text())},t.prototype.blob=function(){if(this._body instanceof Blob)return this._body;if(this._body instanceof ArrayBuffer)return new Blob([this._body]);throw new Error("The request body isn't either a blob or an array buffer")},t}(),Be=function(t){function e(e){var n=t.call(this)||this;return n._body=e.body,n.status=e.status,n.ok=n.status>=200&&n.status<=299,n.statusText=e.statusText,n.headers=e.headers,n.type=e.type,n.url=e.url,n}return Object(a.c)(e,t),e.prototype.toString=function(){return"Response with status: "+this.status+" "+this.statusText+" for URL: "+this.url},e}(je),ze=/^\)\]\}',?\n/,Ve=function(){function t(t,e,n){var r=this;this.request=t,this.response=new T.a(function(i){var o=e.build();o.open(Ae[t.method].toUpperCase(),t.url),null!=t.withCredentials&&(o.withCredentials=t.withCredentials);var a=function(){var e=1223===o.status?204:o.status,r=null;204!==e&&"string"==typeof(r="undefined"==typeof o.response?o.responseText:o.response)&&(r=r.replace(ze,"")),0===e&&(e=r?200:0);var a,s=Oe.fromResponseHeaderString(o.getAllResponseHeaders()),c=("responseURL"in(a=o)?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):null)||t.url,u=new Ne({body:r,status:e,headers:s,statusText:o.statusText||"OK",url:c});null!=n&&(u=n.merge(u));var l=new Be(u);if(l.ok=De(e),l.ok)return i.next(l),void i.complete();i.error(l)},s=function(t){var e=new Ne({body:t,type:Ee.Error,status:o.status,statusText:o.statusText});null!=n&&(e=n.merge(e)),i.error(new Be(e))};if(r.setDetectedContentType(t,o),null==t.headers&&(t.headers=new Oe),t.headers.has("Accept")||t.headers.append("Accept","application/json, text/plain, */*"),t.headers.forEach(function(t,e){return o.setRequestHeader(e,t.join(","))}),null!=t.responseType&&null!=o.responseType)switch(t.responseType){case Pe.ArrayBuffer:o.responseType="arraybuffer";break;case Pe.Json:o.responseType="json";break;case Pe.Text:o.responseType="text";break;case Pe.Blob:o.responseType="blob";break;default:throw new Error("The selected responseType is not supported")}return o.addEventListener("load",a),o.addEventListener("error",s),o.send(r.request.getBody()),function(){o.removeEventListener("load",a),o.removeEventListener("error",s),o.abort()}})}return t.prototype.setDetectedContentType=function(t,e){if(null==t.headers||null==t.headers.get("Content-Type"))switch(t.contentType){case Ce.NONE:break;case Ce.JSON:e.setRequestHeader("content-type","application/json");break;case Ce.FORM:e.setRequestHeader("content-type","application/x-www-form-urlencoded;charset=UTF-8");break;case Ce.TEXT:e.setRequestHeader("content-type","text/plain");break;case Ce.BLOB:var n=t.blob();n.type&&e.setRequestHeader("content-type",n.type)}},t}(),Ge=function(){function t(t,e){void 0===t&&(t="XSRF-TOKEN"),void 0===e&&(e="X-XSRF-TOKEN"),this._cookieName=t,this._headerName=e}return t.prototype.configureRequest=function(t){var e=q().getCookie(this._cookieName);e&&t.headers.set(this._headerName,e)},t}(),He=function(){function t(t,e,n){this._browserXHR=t,this._baseResponseOptions=e,this._xsrfStrategy=n}return t.prototype.createConnection=function(t){return this._xsrfStrategy.configureRequest(t),new Ve(t,this._browserXHR,this._baseResponseOptions)},t}(),We=function(){function t(t){void 0===t&&(t={});var e=t.method,n=t.headers,r=t.body,i=t.url,o=t.search,a=t.params,s=t.withCredentials,c=t.responseType;this.method=null!=e?Re(e):null,this.headers=null!=n?n:null,this.body=null!=r?r:null,this.url=null!=i?i:null,this.params=this._mergeSearchParams(a||o),this.withCredentials=null!=s?s:null,this.responseType=null!=c?c:null}return Object.defineProperty(t.prototype,"search",{get:function(){return this.params},set:function(t){this.params=t},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){return new t({method:e&&null!=e.method?e.method:this.method,headers:e&&null!=e.headers?e.headers:new Oe(this.headers),body:e&&null!=e.body?e.body:this.body,url:e&&null!=e.url?e.url:this.url,params:e&&this._mergeSearchParams(e.params||e.search),withCredentials:e&&null!=e.withCredentials?e.withCredentials:this.withCredentials,responseType:e&&null!=e.responseType?e.responseType:this.responseType})},t.prototype._mergeSearchParams=function(t){return t?t instanceof ke?t.clone():"string"==typeof t?new ke(t):this._parseParams(t):this.params},t.prototype._parseParams=function(t){var e=this;void 0===t&&(t={});var n=new ke;return Object.keys(t).forEach(function(r){var i=t[r];Array.isArray(i)?i.forEach(function(t){return e._appendParam(r,t,n)}):e._appendParam(r,i,n)}),n},t.prototype._appendParam=function(t,e,n){"string"!=typeof e&&(e=JSON.stringify(e)),n.append(t,e)},t}(),Xe=function(t){function e(){return t.call(this,{method:Ae.Get,headers:new Oe})||this}return Object(a.c)(e,t),e}(We),qe=function(t){function e(e){var n=t.call(this)||this,r=e.url;n.url=e.url;var i,o=e.params||e.search;if(o&&(i="object"!=typeof o||o instanceof ke?o.toString():function(t){var e=new ke;return Object.keys(t).forEach(function(n){var r=t[n];r&&Array.isArray(r)?r.forEach(function(t){return e.append(n,t.toString())}):e.append(n,r.toString())}),e}(o).toString()).length>0){var a="?";-1!=n.url.indexOf("?")&&(a="&"==n.url[n.url.length-1]?"":"&"),n.url=r+a+i}return n._body=e.body,n.method=Re(e.method),n.headers=new Oe(e.headers),n.contentType=n.detectContentType(),n.withCredentials=e.withCredentials,n.responseType=e.responseType,n}return Object(a.c)(e,t),e.prototype.detectContentType=function(){switch(this.headers.get("content-type")){case"application/json":return Ce.JSON;case"application/x-www-form-urlencoded":return Ce.FORM;case"multipart/form-data":return Ce.FORM_DATA;case"text/plain":case"text/html":return Ce.TEXT;case"application/octet-stream":return this._body instanceof Ke?Ce.ARRAY_BUFFER:Ce.BLOB;default:return this.detectContentTypeFromBody()}},e.prototype.detectContentTypeFromBody=function(){return null==this._body?Ce.NONE:this._body instanceof ke?Ce.FORM:this._body instanceof Je?Ce.FORM_DATA:this._body instanceof Qe?Ce.BLOB:this._body instanceof Ke?Ce.ARRAY_BUFFER:this._body&&"object"==typeof this._body?Ce.JSON:Ce.TEXT},e.prototype.getBody=function(){switch(this.contentType){case Ce.JSON:case Ce.FORM:return this.text();case Ce.FORM_DATA:return this._body;case Ce.TEXT:return this.text();case Ce.BLOB:return this.blob();case Ce.ARRAY_BUFFER:return this.arrayBuffer();default:return null}},e}(je),Ye=function(){},Ze="object"==typeof window?window:Ye,Je=Ze.FormData||Ye,Qe=Ze.Blob||Ye,Ke=Ze.ArrayBuffer||Ye;function $e(t,e){return t.createConnection(e).response}function tn(t,e,n,r){return t.merge(new We(e?{method:e.method||n,url:e.url||r,search:e.search,params:e.params,headers:e.headers,body:e.body,withCredentials:e.withCredentials,responseType:e.responseType}:{method:n,url:r}))}var en=function(){function t(t,e){this._backend=t,this._defaultOptions=e}return t.prototype.request=function(t,e){var n;if("string"==typeof t)n=$e(this._backend,new qe(tn(this._defaultOptions,e,Ae.Get,t)));else{if(!(t instanceof qe))throw new Error("First argument must be a url string or Request instance.");n=$e(this._backend,t)}return n},t.prototype.get=function(t,e){return this.request(new qe(tn(this._defaultOptions,e,Ae.Get,t)))},t.prototype.post=function(t,e,n){return this.request(new qe(tn(this._defaultOptions.merge(new We({body:e})),n,Ae.Post,t)))},t.prototype.put=function(t,e,n){return this.request(new qe(tn(this._defaultOptions.merge(new We({body:e})),n,Ae.Put,t)))},t.prototype.delete=function(t,e){return this.request(new qe(tn(this._defaultOptions,e,Ae.Delete,t)))},t.prototype.patch=function(t,e,n){return this.request(new qe(tn(this._defaultOptions.merge(new We({body:e})),n,Ae.Patch,t)))},t.prototype.head=function(t,e){return this.request(new qe(tn(this._defaultOptions,e,Ae.Head,t)))},t.prototype.options=function(t,e){return this.request(new qe(tn(this._defaultOptions,e,Ae.Options,t)))},t}();function nn(){return new Ge}function rn(t,e){return new en(t,e)}var on=function(){},an=function(){function t(){}return t.BACKEND_URL="https://racing-demo-dev.pp.ua",t.FPS=60,t.MOVE_TIMEOUT=7e3,t}(),sn=function(){function t(t){this.http=t,this.apiUrl=an.BACKEND_URL,this.apiHeaders=new Oe({"Content-type":"application/json"})}return t.prototype.apiGet=function(t,e){return void 0===e&&(e=null),this.apiCall(Ae.Get,t,e)},t.prototype.apiPost=function(t,e){return this.apiCall(Ae.Post,t,e)},t.prototype.apiCall=function(t,e,n){void 0===n&&(n=null);var r=this.apiUrl;switch(e&&e.length>0&&(r+="/"+e),t){case Ae.Get:return this.get(r,n,this.apiHeaders);case Ae.Post:return this.post(r,n&&JSON.stringify(n),this.apiHeaders);default:throw new Error("Method "+Ae[t]+"is not supported! See HttpService")}},t.prototype.get=function(t,e,n){return void 0===n&&(n=new Oe),this.http.get(t,{search:e,headers:n}).map(function(t){return t.ok?t.json():(console.log("logError"),null)})},t.prototype.post=function(t,e,n){return void 0===n&&(n=new Oe),this.http.post(t,e,{headers:n}).map(function(t){if(t.ok)return t.json();var e=t.json();try{console.log(e.error)}catch(t){console.log(e)}})},t}(),cn=function(){function t(t){this.apiHttpService=t}return t.prototype.login=function(t){return this.apiHttpService.apiPost("auth/login/",t)},t.prototype.register=function(t){return this.apiHttpService.apiPost("auth/register/",t)},t}(),un=function(){function t(t){this.authDelegate=t,this.currentUser=this.setUserFromLocalStorage()||{}}return t.prototype.setUserFromLocalStorage=function(){try{return JSON.parse(localStorage.getItem("currentUser"))}catch(t){console.warn("LocalStorage unavailable")}},t.prototype.login=function(t,e){var n=this;return this.authDelegate.login({login:t,password:e}).map(function(t){try{localStorage.setItem("currentUser",JSON.stringify(t))}catch(t){console.warn("LocalStorage unavailable")}return n.currentUser=t})},t.prototype.logout=function(){this.currentUser=null;try{localStorage.removeItem("currentUser")}catch(t){console.warn("LocalStorage unavailable")}},t.prototype.createUser=function(t,e){var n=this;return this.authDelegate.register({login:t,password:e}).map(function(t){return n.currentUser=t})},t}(),ln=n("g5jc"),hn=n("x6VL"),dn=function(t){function e(e){t.call(this),this._value=e}return Object(a.c)(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new hn.a;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(ln.b),pn=n("Veqx"),fn=pn.a.of,mn=n("Qnch");function vn(t,e){return Object(mn.a)(t,e,1)}function gn(t,e){return vn(t,e)(this)}var yn=n("OVmG");function bn(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new xn(t,e))}}var xn=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new wn(t,this.project,this.thisArg))},t}(),wn=function(t){function e(e,n,r){t.call(this,e),this.project=n,this.count=0,this.thisArg=r||this}return Object(a.c)(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(yn.a);function _n(t,e){return bn(t,e)(this)}function Sn(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),Object(mn.a)(t,e,n)(this)}var Tn=n("BX3T"),Mn=n("N4j0"),An=n("cQXm"),En=n("AMGY"),Cn=function(t){function e(e,n){t.call(this),this.promise=e,this.scheduler=n}return Object(a.c)(e,t),e.create=function(t,n){return new e(t,n)},e.prototype._subscribe=function(t){var e=this,n=this.promise,r=this.scheduler;if(null==r)this._isScalar?t.closed||(t.next(this.value),t.complete()):n.then(function(n){e.value=n,e._isScalar=!0,t.closed||(t.next(n),t.complete())},function(e){t.closed||t.error(e)}).then(null,function(t){En.a.setTimeout(function(){throw t})});else if(this._isScalar){if(!t.closed)return r.schedule(Pn,0,{value:this.value,subscriber:t})}else n.then(function(n){e.value=n,e._isScalar=!0,t.closed||t.add(r.schedule(Pn,0,{value:n,subscriber:t}))},function(e){t.closed||t.add(r.schedule(On,0,{err:e,subscriber:t}))}).then(null,function(t){En.a.setTimeout(function(){throw t})})},e}(T.a);function Pn(t){var e=t.subscriber;e.closed||(e.next(t.value),e.complete())}function On(t){var e=t.subscriber;e.closed||e.error(t.err)}var Nn=n("etqZ"),Ln=function(t){function e(e,n){if(t.call(this),this.scheduler=n,null==e)throw new Error("iterator cannot be null.");this.iterator=Dn(e)}return Object(a.c)(e,t),e.create=function(t,n){return new e(t,n)},e.dispatch=function(t){var e=t.index,n=t.iterator,r=t.subscriber;if(t.hasError)r.error(t.error);else{var i=n.next();i.done?r.complete():(r.next(i.value),t.index=e+1,r.closed?"function"==typeof n.return&&n.return():this.schedule(t))}},e.prototype._subscribe=function(t){var n=this.iterator,r=this.scheduler;if(r)return r.schedule(e.dispatch,0,{index:0,iterator:n,subscriber:t});for(;;){var i=n.next();if(i.done){t.complete();break}if(t.next(i.value),t.closed){"function"==typeof n.return&&n.return();break}}},e}(T.a),In=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.length),this.str=t,this.idx=e,this.len=n}return t.prototype[Nn.a]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},t}(),Rn=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=function(e){var n,r,i=+t.length;return isNaN(i)?0:0!==i&&"number"==typeof(n=i)&&En.a.isFinite(n)?(i=(0==(r=+i)?r:isNaN(r)?r:r<0?-1:1)*Math.floor(Math.abs(i)))<=0?0:i>Fn?Fn:i:i}()),this.arr=t,this.idx=e,this.len=n}return t.prototype[Nn.a]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},t}();function Dn(t){var e=t[Nn.a];if(!e&&"string"==typeof t)return new In(t);if(!e&&void 0!==t.length)return new Rn(t);if(!e)throw new TypeError("object is not iterable");return t[Nn.a]()}var Fn=Math.pow(2,53)-1,Un=n("TILf"),kn=n("+3/4"),jn=function(t){function e(e,n){t.call(this),this.arrayLike=e,this.scheduler=n,n||1!==e.length||(this._isScalar=!0,this.value=e[0])}return Object(a.c)(e,t),e.create=function(t,n){var r=t.length;return 0===r?new kn.a:1===r?new Un.a(t[0],n):new e(t,n)},e.dispatch=function(t){var e=t.arrayLike,n=t.index,r=t.subscriber;r.closed||(n>=t.length?r.complete():(r.next(e[n]),t.index=n+1,this.schedule(t)))},e.prototype._subscribe=function(t){var n=this.arrayLike,r=this.scheduler,i=n.length;if(r)return r.schedule(e.dispatch,0,{arrayLike:n,index:0,length:i,subscriber:t});for(var o=0;o<i&&!t.closed;o++)t.next(n[o]);t.complete()},e}(T.a),Bn=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return T.a.of(this.value);case"E":return T.a.throw(this.error);case"C":return T.a.empty()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return"undefined"!=typeof e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();function zn(t,e){return void 0===e&&(e=0),function(n){return n.lift(new Vn(t,e))}}var Vn=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new Gn(t,this.scheduler,this.delay))},t}(),Gn=function(t){function e(e,n,r){void 0===r&&(r=0),t.call(this,e),this.scheduler=n,this.delay=r}return Object(a.c)(e,t),e.dispatch=function(t){t.notification.observe(t.destination),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.add(this.scheduler.schedule(e.dispatch,this.delay,new Hn(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(Bn.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(Bn.createError(t))},e.prototype._complete=function(){this.scheduleMessage(Bn.createComplete())},e}(yn.a),Hn=function(t,e){this.notification=t,this.destination=e},Wn=n("+CnV"),Xn=function(t){function e(e,n){t.call(this,null),this.ish=e,this.scheduler=n}return Object(a.c)(e,t),e.create=function(t,n){if(null!=t){if("function"==typeof t[Wn.a])return t instanceof T.a&&!n?t:new e(t,n);if(Object(Tn.a)(t))return new pn.a(t,n);if(Object(An.a)(t))return new Cn(t,n);if("function"==typeof t[Nn.a]||"string"==typeof t)return new Ln(t,n);if(Object(Mn.a)(t))return new jn(t,n)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")},e.prototype._subscribe=function(t){var e=this.ish,n=this.scheduler;return null==n?e[Wn.a]().subscribe(t):e[Wn.a]().subscribe(new Gn(t,n,0))},e}(T.a),qn=Xn.create,Yn=n("tZ2B"),Zn=n("PIsA");function Jn(t){return function(e){var n=new Qn(t),r=e.lift(n);return n.caught=r}}var Qn=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new Kn(t,this.selector,this.caught))},t}(),Kn=function(t){function e(e,n,r){t.call(this,e),this.selector=n,this.caught=r}return Object(a.c)(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle(),this.add(Object(Zn.a)(this,n))}},e}(Yn.a);function $n(t){return Jn(t)(this)}var tr=n("8D5t");function er(){return Object(tr.a)(1)}function nr(){return er()(this)}var rr=function(t){function e(){var e=t.call(this,"no elements in sequence");this.name=e.name="EmptyError",this.stack=e.stack,this.message=e.message}return Object(a.c)(e,t),e}(Error);function ir(t,e,n){return function(r){return r.lift(new or(t,e,n,r))}}var or=function(){function t(t,e,n,r){this.predicate=t,this.resultSelector=e,this.defaultValue=n,this.source=r}return t.prototype.call=function(t,e){return e.subscribe(new ar(t,this.predicate,this.resultSelector,this.defaultValue,this.source))},t}(),ar=function(t){function e(e,n,r,i,o){t.call(this,e),this.predicate=n,this.resultSelector=r,this.defaultValue=i,this.source=o,this.index=0,this.hasCompleted=!1,this._emitted=!1}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.index++;this.predicate?this._tryPredicate(t,e):this._emit(t,e)},e.prototype._tryPredicate=function(t,e){var n;try{n=this.predicate(t,e,this.source)}catch(t){return void this.destination.error(t)}n&&this._emit(t,e)},e.prototype._emit=function(t,e){this.resultSelector?this._tryResultSelector(t,e):this._emitFinal(t)},e.prototype._tryResultSelector=function(t,e){var n;try{n=this.resultSelector(t,e)}catch(t){return void this.destination.error(t)}this._emitFinal(n)},e.prototype._emitFinal=function(t){var e=this.destination;this._emitted||(this._emitted=!0,e.next(t),e.complete(),this.hasCompleted=!0)},e.prototype._complete=function(){var t=this.destination;this.hasCompleted||"undefined"==typeof this.defaultValue?this.hasCompleted||t.error(new rr):(t.next(this.defaultValue),t.complete())},e}(yn.a);function sr(t,e,n){return ir(t,e,n)(this)}var cr=Cn.create;function ur(t,e){return function(n){return n.lift(new lr(t,e,n))}}var lr=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new hr(t,this.predicate,this.thisArg,this.source))},t}(),hr=function(t){function e(e,n,r,i){t.call(this,e),this.predicate=n,this.thisArg=r,this.source=i,this.index=0,this.thisArg=r||this}return Object(a.c)(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(yn.a);function dr(t,e){return ur(t,e)(this)}function pr(t,e,n){return function(r){return r.lift(new fr(t,e,n,r))}}var fr=function(){function t(t,e,n,r){this.predicate=t,this.resultSelector=e,this.defaultValue=n,this.source=r}return t.prototype.call=function(t,e){return e.subscribe(new mr(t,this.predicate,this.resultSelector,this.defaultValue,this.source))},t}(),mr=function(t){function e(e,n,r,i,o){t.call(this,e),this.predicate=n,this.resultSelector=r,this.defaultValue=i,this.source=o,this.hasValue=!1,this.index=0,"undefined"!=typeof i&&(this.lastValue=i,this.hasValue=!0)}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.index++;if(this.predicate)this._tryPredicate(t,e);else{if(this.resultSelector)return void this._tryResultSelector(t,e);this.lastValue=t,this.hasValue=!0}},e.prototype._tryPredicate=function(t,e){var n;try{n=this.predicate(t,e,this.source)}catch(t){return void this.destination.error(t)}if(n){if(this.resultSelector)return void this._tryResultSelector(t,e);this.lastValue=t,this.hasValue=!0}},e.prototype._tryResultSelector=function(t,e){var n;try{n=this.resultSelector(t,e)}catch(t){return void this.destination.error(t)}this.lastValue=n,this.hasValue=!0},e.prototype._complete=function(){var t=this.destination;this.hasValue?(t.next(this.lastValue),t.complete()):t.error(new rr)},e}(yn.a);function vr(t,e,n){return pr(t,e,n)(this)}function gr(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),Object(tr.a)(t)(this)}function yr(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new br(t,e,n))}}var br=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new xr(t,this.accumulator,this.seed,this.hasSeed))},t}(),xr=function(t){function e(e,n,r,i){t.call(this,e),this.accumulator=n,this._seed=r,this.hasSeed=i,this.index=0}return Object(a.c)(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(yn.a),wr=function(t){function e(){var e=t.call(this,"argument out of range");this.name=e.name="ArgumentOutOfRangeError",this.stack=e.stack,this.message=e.message}return Object(a.c)(e,t),e}(Error);function _r(t){return function(e){return 0===t?new kn.a:e.lift(new Sr(t))}}var Sr=function(){function t(t){if(this.total=t,this.total<0)throw new wr}return t.prototype.call=function(t,e){return e.subscribe(new Tr(t,this.total))},t}(),Tr=function(t){function e(e,n){t.call(this,e),this.total=n,this.ring=new Array,this.count=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=e++%n;t.next(r[o])}t.complete()},e}(yn.a);function Mr(t){return void 0===t&&(t=null),function(e){return e.lift(new Ar(t))}}var Ar=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new Er(t,this.defaultValue))},t}(),Er=function(t){function e(e,n){t.call(this,e),this.defaultValue=n,this.isEmpty=!0}return Object(a.c)(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(yn.a),Cr=n("f9aG");function Pr(t,e){return arguments.length>=2?function(n){return Object(Cr.a)(yr(t,e),_r(1),Mr(e))(n)}:function(e){return Object(Cr.a)(yr(function(e,n,r){return t(e,n,r+1)}),_r(1))(e)}}function Or(t,e){return arguments.length>=2?Pr(t,e)(this):Pr(t)(this)}function Nr(t,e){return function(n){return n.lift(new Lr(t,e))}}var Lr=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Ir(t,this.predicate,this.thisArg))},t}(),Ir=function(t){function e(e,n,r){t.call(this,e),this.predicate=n,this.thisArg=r,this.count=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(yn.a);function Rr(t,e){return Nr(t,e)(this)}var Dr=function(t,e){this.id=t,this.url=e},Fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.toString=function(){return"NavigationStart(id: "+this.id+", url: '"+this.url+"')"},e}(Dr),Ur=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i}return Object(a.c)(e,t),e.prototype.toString=function(){return"NavigationEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"')"},e}(Dr),kr=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.reason=r,i}return Object(a.c)(e,t),e.prototype.toString=function(){return"NavigationCancel(id: "+this.id+", url: '"+this.url+"')"},e}(Dr),jr=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.error=r,i}return Object(a.c)(e,t),e.prototype.toString=function(){return"NavigationError(id: "+this.id+", url: '"+this.url+"', error: "+this.error+")"},e}(Dr),Br=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.urlAfterRedirects=r,o.state=i,o}return Object(a.c)(e,t),e.prototype.toString=function(){return"RoutesRecognized(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Dr),zr=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.urlAfterRedirects=r,o.state=i,o}return Object(a.c)(e,t),e.prototype.toString=function(){return"GuardsCheckStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Dr),Vr=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n)||this;return a.urlAfterRedirects=r,a.state=i,a.shouldActivate=o,a}return Object(a.c)(e,t),e.prototype.toString=function(){return"GuardsCheckEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+", shouldActivate: "+this.shouldActivate+")"},e}(Dr),Gr=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.urlAfterRedirects=r,o.state=i,o}return Object(a.c)(e,t),e.prototype.toString=function(){return"ResolveStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Dr),Hr=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.urlAfterRedirects=r,o.state=i,o}return Object(a.c)(e,t),e.prototype.toString=function(){return"ResolveEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Dr),Wr=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadStart(path: "+this.route.path+")"},t}(),Xr=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadEnd(path: "+this.route.path+")"},t}(),qr=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Yr=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Zr=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Jr=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Qr="primary",Kr=function(){function t(t){this.params=t||{}}return t.prototype.has=function(t){return this.params.hasOwnProperty(t)},t.prototype.get=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e[0]:e}return null},t.prototype.getAll=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e:[e]}return[]},Object.defineProperty(t.prototype,"keys",{get:function(){return Object.keys(this.params)},enumerable:!0,configurable:!0}),t}();function $r(t){return new Kr(t)}function ti(t,e,n){var r=n.path.split("/");if(r.length>t.length)return null;if("full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;for(var i={},o=0;o<r.length;o++){var a=r[o],s=t[o];if(a.startsWith(":"))i[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:i}}var ei=function(t,e){this.routes=t,this.module=e};function ni(t,e){void 0===e&&(e="");for(var n=0;n<t.length;n++){var r=t[n];ri(r,ii(e,r))}}function ri(t,e){if(!t)throw new Error("\n      Invalid configuration of route '"+e+"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    ");if(Array.isArray(t))throw new Error("Invalid configuration of route '"+e+"': Array cannot be specified");if(!t.component&&t.outlet&&t.outlet!==Qr)throw new Error("Invalid configuration of route '"+e+"': a componentless route cannot have a named outlet set");if(t.redirectTo&&t.children)throw new Error("Invalid configuration of route '"+e+"': redirectTo and children cannot be used together");if(t.redirectTo&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': redirectTo and loadChildren cannot be used together");if(t.children&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': children and loadChildren cannot be used together");if(t.redirectTo&&t.component)throw new Error("Invalid configuration of route '"+e+"': redirectTo and component cannot be used together");if(t.path&&t.matcher)throw new Error("Invalid configuration of route '"+e+"': path and matcher cannot be used together");if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error("Invalid configuration of route '"+e+"'. One of the following must be provided: component, redirectTo, children or loadChildren");if(void 0===t.path&&void 0===t.matcher)throw new Error("Invalid configuration of route '"+e+"': routes must have either a path or a matcher specified");if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error("Invalid configuration of route '"+e+"': path cannot start with a slash");if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch)throw new Error("Invalid configuration of route '{path: \""+e+'", redirectTo: "'+t.redirectTo+"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.");if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error("Invalid configuration of route '"+e+"': pathMatch can only be set to 'prefix' or 'full'");t.children&&ni(t.children,e)}function ii(t,e){return e?t||e.path?t&&!e.path?t+"/":!t&&e.path?e.path:t+"/"+e.path:"":t}function oi(t){var e=t.children&&t.children.map(oi);return e?Object(a.a)({},t,{children:e}):Object(a.a)({},t)}function ai(t,e){var n,r=Object.keys(t),i=Object.keys(e);if(r.length!=i.length)return!1;for(var o=0;o<r.length;o++)if(t[n=r[o]]!==e[n])return!1;return!0}function si(t){return Array.prototype.concat.apply([],t)}function ci(t){return t.length>0?t[t.length-1]:null}function ui(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)}function li(t){var e=gr.call(t);return dr.call(e,function(t){return!0===t})}function hi(t){return Object(i._6)(t)?t:Object(i._7)(t)?cr(Promise.resolve(t)):fn(t)}function di(t,e,n){return n?function(t,e){return ai(t,e)}(t.queryParams,e.queryParams)&&function t(e,n){if(!vi(e.segments,n.segments))return!1;if(e.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!e.children[r])return!1;if(!t(e.children[r],n.children[r]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(function(n){return e[n]===t[n]})}(t.queryParams,e.queryParams)&&function t(e,n){return function e(n,r,i){if(n.segments.length>i.length)return!!vi(a=n.segments.slice(0,i.length),i)&&!r.hasChildren();if(n.segments.length===i.length){if(!vi(n.segments,i))return!1;for(var o in r.children){if(!n.children[o])return!1;if(!t(n.children[o],r.children[o]))return!1}return!0}var a=i.slice(0,n.segments.length),s=i.slice(n.segments.length);return!!vi(n.segments,a)&&!!n.children[Qr]&&e(n.children[Qr],r,s)}(e,n,n.segments)}(t.root,e.root)}var pi=function(){function t(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}return Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=$r(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return xi.serialize(this)},t}(),fi=function(){function t(t,e){var n=this;this.segments=t,this.children=e,this.parent=null,ui(e,function(t,e){return t.parent=n})}return t.prototype.hasChildren=function(){return this.numberOfChildren>0},Object.defineProperty(t.prototype,"numberOfChildren",{get:function(){return Object.keys(this.children).length},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return wi(this)},t}(),mi=function(){function t(t,e){this.path=t,this.parameters=e}return Object.defineProperty(t.prototype,"parameterMap",{get:function(){return this._parameterMap||(this._parameterMap=$r(this.parameters)),this._parameterMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return Ei(this)},t}();function vi(t,e){return t.length===e.length&&t.every(function(t,n){return t.path===e[n].path})}function gi(t,e){var n=[];return ui(t.children,function(t,r){r===Qr&&(n=n.concat(e(t,r)))}),ui(t.children,function(t,r){r!==Qr&&(n=n.concat(e(t,r)))}),n}var yi=function(){},bi=function(){function t(){}return t.prototype.parse=function(t){var e=new Li(t);return new pi(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())},t.prototype.serialize=function(t){var e,n;return"/"+function t(e,n){if(!e.hasChildren())return wi(e);if(n){var r=e.children[Qr]?t(e.children[Qr],!1):"",i=[];return ui(e.children,function(e,n){n!==Qr&&i.push(n+":"+t(e,!1))}),i.length>0?r+"("+i.join("//")+")":r}var o=gi(e,function(n,r){return r===Qr?[t(e.children[Qr],!1)]:[r+":"+t(n,!1)]});return wi(e)+"/("+o.join("//")+")"}(t.root,!0)+(e=t.queryParams,(n=Object.keys(e).map(function(t){var n=e[t];return Array.isArray(n)?n.map(function(e){return Si(t)+"="+Si(e)}).join("&"):Si(t)+"="+Si(n)})).length?"?"+n.join("&"):"")+("string"==typeof t.fragment?"#"+encodeURI(t.fragment):"")},t}(),xi=new bi;function wi(t){return t.segments.map(function(t){return Ei(t)}).join("/")}function _i(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Si(t){return _i(t).replace(/%3B/gi,";")}function Ti(t){return _i(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Mi(t){return decodeURIComponent(t)}function Ai(t){return Mi(t.replace(/\+/g,"%20"))}function Ei(t){return""+Ti(t.path)+(e=t.parameters,Object.keys(e).map(function(t){return";"+Ti(t)+"="+Ti(e[t])}).join(""));var e}var Ci=/^[^\/()?;=&#]+/;function Pi(t){var e=t.match(Ci);return e?e[0]:""}var Oi=/^[^=?&#]+/,Ni=/^[^?&#]+/,Li=function(){function t(t){this.url=t,this.remaining=t}return t.prototype.parseRootSegment=function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new fi([],{}):new fi([],this.parseChildren())},t.prototype.parseQueryParams=function(){var t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t},t.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},t.prototype.parseChildren=function(){if(""===this.remaining)return{};this.consumeOptional("/");var t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());var e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n[Qr]=new fi(t,e)),n},t.prototype.parseSegment=function(){var t=Pi(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(t),new mi(Mi(t),this.parseMatrixParams())},t.prototype.parseMatrixParams=function(){for(var t={};this.consumeOptional(";");)this.parseParam(t);return t},t.prototype.parseParam=function(t){var e=Pi(this.remaining);if(e){this.capture(e);var n="";if(this.consumeOptional("=")){var r=Pi(this.remaining);r&&this.capture(n=r)}t[Mi(e)]=Mi(n)}},t.prototype.parseQueryParam=function(t){var e,n=(e=this.remaining.match(Oi))?e[0]:"";if(n){this.capture(n);var r="";if(this.consumeOptional("=")){var i=function(t){var e=t.match(Ni);return e?e[0]:""}(this.remaining);i&&this.capture(r=i)}var o=Ai(n),a=Ai(r);if(t.hasOwnProperty(o)){var s=t[o];Array.isArray(s)||(t[o]=s=[s]),s.push(a)}else t[o]=a}},t.prototype.parseParens=function(t){var e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Pi(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '"+this.url+"'");var i=void 0;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):t&&(i=Qr);var o=this.parseChildren();e[i]=1===Object.keys(o).length?o[Qr]:new fi([],o),this.consumeOptional("//")}return e},t.prototype.peekStartsWith=function(t){return this.remaining.startsWith(t)},t.prototype.consumeOptional=function(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)},t.prototype.capture=function(t){if(!this.consumeOptional(t))throw new Error('Expected "'+t+'".')},t}(),Ii=function(t){this.segmentGroup=t||null},Ri=function(t){this.urlTree=t};function Di(t){return new T.a(function(e){return e.error(new Ii(t))})}function Fi(t){return new T.a(function(e){return e.error(new Ri(t))})}function Ui(t){return new T.a(function(e){return e.error(new Error("Only absolute redirects can have named outlets. redirectTo: '"+t+"'"))})}var ki=function(){function t(t,e,n,r,o){this.configLoader=e,this.urlSerializer=n,this.urlTree=r,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(i.u)}return t.prototype.apply=function(){var t=this,e=this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,Qr),n=_n.call(e,function(e){return t.createUrlTree(e,t.urlTree.queryParams,t.urlTree.fragment)});return $n.call(n,function(e){if(e instanceof Ri)return t.allowRedirects=!1,t.match(e.urlTree);if(e instanceof Ii)throw t.noMatchError(e);throw e})},t.prototype.match=function(t){var e=this,n=this.expandSegmentGroup(this.ngModule,this.config,t.root,Qr),r=_n.call(n,function(n){return e.createUrlTree(n,t.queryParams,t.fragment)});return $n.call(r,function(t){if(t instanceof Ii)throw e.noMatchError(t);throw t})},t.prototype.noMatchError=function(t){return new Error("Cannot match any routes. URL Segment: '"+t.segmentGroup+"'")},t.prototype.createUrlTree=function(t,e,n){var r,i=t.segments.length>0?new fi([],((r={})[Qr]=t,r)):t;return new pi(i,e,n)},t.prototype.expandSegmentGroup=function(t,e,n,r){return 0===n.segments.length&&n.hasChildren()?_n.call(this.expandChildren(t,e,n),function(t){return new fi([],t)}):this.expandSegment(t,n,e,n.segments,r,!0)},t.prototype.expandChildren=function(t,e,n){var r=this;return function(n,i){if(0===Object.keys(n).length)return fn({});var o=[],a=[],s={};ui(n,function(n,i){var c=_n.call(r.expandSegmentGroup(t,e,n,i),function(t){return s[i]=t});i===Qr?o.push(c):a.push(c)});var c=nr.call(fn.apply(void 0,o.concat(a))),u=vr.call(c);return _n.call(u,function(){return s})}(n.children)},t.prototype.expandSegment=function(t,e,n,r,i,o){var a=this,s=fn.apply(void 0,n),c=_n.call(s,function(s){var c=a.expandSegmentAgainstRoute(t,e,n,s,r,i,o);return $n.call(c,function(t){if(t instanceof Ii)return fn(null);throw t})}),u=nr.call(c),l=sr.call(u,function(t){return!!t});return $n.call(l,function(t,n){if(t instanceof rr||"EmptyError"===t.name){if(a.noLeftoversInUrl(e,r,i))return fn(new fi([],{}));throw new Ii(e)}throw t})},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.expandSegmentAgainstRoute=function(t,e,n,r,i,o,a){return Vi(r)!==o?Di(e):void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,i):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,r,i,o):Di(e)},t.prototype.expandSegmentAgainstRouteUsingRedirect=function(t,e,n,r,i,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,i,o)},t.prototype.expandWildCardWithParamsAgainstRouteUsingRedirect=function(t,e,n,r){var i=this,o=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Fi(o):Sn.call(this.lineralizeSegments(n,o),function(n){var o=new fi(n,{});return i.expandSegment(t,o,e,n,r,!1)})},t.prototype.expandRegularSegmentAgainstRouteUsingRedirect=function(t,e,n,r,i,o){var a=this,s=ji(e,r,i),c=s.consumedSegments,u=s.lastChild,l=s.positionalParamSegments;if(!s.matched)return Di(e);var h=this.applyRedirectCommands(c,r.redirectTo,l);return r.redirectTo.startsWith("/")?Fi(h):Sn.call(this.lineralizeSegments(r,h),function(r){return a.expandSegment(t,e,n,r.concat(i.slice(u)),o,!1)})},t.prototype.matchSegmentAgainstRoute=function(t,e,n,r){var i=this;if("**"===n.path)return n.loadChildren?_n.call(this.configLoader.load(t.injector,n),function(t){return n._loadedConfig=t,new fi(r,{})}):fn(new fi(r,{}));var o=ji(e,n,r),s=o.consumedSegments,c=o.lastChild;if(!o.matched)return Di(e);var u=r.slice(c),l=this.getChildConfig(t,n);return Sn.call(l,function(t){var n=t.module,r=t.routes,o=function(t,e,n,r){return n.length>0&&function(t,e,n){return r.some(function(n){return zi(t,e,n)&&Vi(n)!==Qr})}(t,n)?{segmentGroup:Bi(new fi(e,function(t,e){var n={};n[Qr]=e;for(var r=0,i=t;r<i.length;r++){var o=i[r];""===o.path&&Vi(o)!==Qr&&(n[Vi(o)]=new fi([],{}))}return n}(r,new fi(n,t.children)))),slicedSegments:[]}:0===n.length&&function(t,e,n){return r.some(function(n){return zi(t,e,n)})}(t,n)?{segmentGroup:Bi(new fi(t.segments,function(t,e,n,i){for(var o={},s=0,c=r;s<c.length;s++){var u=c[s];zi(t,e,u)&&!i[Vi(u)]&&(o[Vi(u)]=new fi([],{}))}return Object(a.a)({},i,o)}(t,n,0,t.children))),slicedSegments:n}:{segmentGroup:t,slicedSegments:n}}(e,s,u,r),c=o.segmentGroup,l=o.slicedSegments;if(0===l.length&&c.hasChildren()){var h=i.expandChildren(n,r,c);return _n.call(h,function(t){return new fi(s,t)})}if(0===r.length&&0===l.length)return fn(new fi(s,{}));var d=i.expandSegment(n,c,r,l,Qr,!0);return _n.call(d,function(t){return new fi(s.concat(t.segments),t.children)})})},t.prototype.getChildConfig=function(t,e){var n=this;return e.children?fn(new ei(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?fn(e._loadedConfig):Sn.call(function(t,e){var n=e.canLoad;return n&&0!==n.length?li(_n.call(qn(n),function(n){var r=t.get(n);return hi(r.canLoad?r.canLoad(e):r(e))})):fn(!0)}(t.injector,e),function(r){return r?_n.call(n.configLoader.load(t.injector,e),function(t){return e._loadedConfig=t,t}):function(t){return new T.a(function(e){return e.error(((n=Error("NavigationCancelingError: Cannot load children because the guard of the route \"path: '"+t.path+"'\" returned false")).ngNavigationCancelingError=!0,n));var n})}(e)}):fn(new ei([],t))},t.prototype.lineralizeSegments=function(t,e){for(var n=[],r=e.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return fn(n);if(r.numberOfChildren>1||!r.children[Qr])return Ui(t.redirectTo);r=r.children[Qr]}},t.prototype.applyRedirectCommands=function(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)},t.prototype.applyRedirectCreatreUrlTree=function(t,e,n,r){var i=this.createSegmentGroup(t,e.root,n,r);return new pi(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)},t.prototype.createQueryParams=function(t,e){var n={};return ui(t,function(t,r){if("string"==typeof t&&t.startsWith(":")){var i=t.substring(1);n[r]=e[i]}else n[r]=t}),n},t.prototype.createSegmentGroup=function(t,e,n,r){var i=this,o=this.createSegments(t,e.segments,n,r),a={};return ui(e.children,function(e,o){a[o]=i.createSegmentGroup(t,e,n,r)}),new fi(o,a)},t.prototype.createSegments=function(t,e,n,r){var i=this;return e.map(function(e){return e.path.startsWith(":")?i.findPosParam(t,e,r):i.findOrReturn(e,n)})},t.prototype.findPosParam=function(t,e,n){var r=n[e.path.substring(1)];if(!r)throw new Error("Cannot redirect to '"+t+"'. Cannot find '"+e.path+"'.");return r},t.prototype.findOrReturn=function(t,e){for(var n=0,r=0,i=e;r<i.length;r++){var o=i[r];if(o.path===t.path)return e.splice(n),o;n++}return t},t}();function ji(t,e,n){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(e.matcher||ti)(n,t,e);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Bi(t){if(1===t.numberOfChildren&&t.children[Qr]){var e=t.children[Qr];return new fi(t.segments.concat(e.segments),e.children)}return t}function zi(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Vi(t){return t.outlet||Qr}var Gi=function(){function t(t){this._root=t}return Object.defineProperty(t.prototype,"root",{get:function(){return this._root.value},enumerable:!0,configurable:!0}),t.prototype.parent=function(t){var e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null},t.prototype.children=function(t){var e=Hi(t,this._root);return e?e.children.map(function(t){return t.value}):[]},t.prototype.firstChild=function(t){var e=Hi(t,this._root);return e&&e.children.length>0?e.children[0].value:null},t.prototype.siblings=function(t){var e=Wi(t,this._root);return e.length<2?[]:e[e.length-2].children.map(function(t){return t.value}).filter(function(e){return e!==t})},t.prototype.pathFromRoot=function(t){return Wi(t,this._root).map(function(t){return t.value})},t}();function Hi(t,e){if(t===e.value)return e;for(var n=0,r=e.children;n<r.length;n++){var i=Hi(t,r[n]);if(i)return i}return null}function Wi(t,e){if(t===e.value)return[e];for(var n=0,r=e.children;n<r.length;n++){var i=Wi(t,r[n]);if(i.length)return i.unshift(e),i}return[]}var Xi=function(){function t(t,e){this.value=t,this.children=e}return t.prototype.toString=function(){return"TreeNode("+this.value+")"},t}();function qi(t){var e={};return t&&t.children.forEach(function(t){return e[t.value.outlet]=t}),e}var Yi=function(t){function e(e,n){var r=t.call(this,e)||this;return r.snapshot=n,to(r,e),r}return Object(a.c)(e,t),e.prototype.toString=function(){return this.snapshot.toString()},e}(Gi);function Zi(t,e){var n=function(t,e){var n=new Ki([],{},{},"",{},Qr,e,null,t.root,-1,{});return new $i("",new Xi(n,[]))}(t,e),r=new dn([new mi("",{})]),i=new dn({}),o=new dn({}),a=new dn({}),s=new dn(""),c=new Ji(r,i,a,s,o,Qr,e,n.root);return c.snapshot=n.root,new Yi(new Xi(c,[]),n)}var Ji=function(){function t(t,e,n,r,i,o,a,s){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=o,this.component=a,this._futureSnapshot=s}return Object.defineProperty(t.prototype,"routeConfig",{get:function(){return this._futureSnapshot.routeConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=_n.call(this.params,function(t){return $r(t)})),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=_n.call(this.queryParams,function(t){return $r(t)})),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.snapshot?this.snapshot.toString():"Future("+this._futureSnapshot+")"},t}();function Qi(t,e){void 0===e&&(e="emptyOnly");var n=t.pathFromRoot,r=0;if("always"!==e)for(r=n.length-1;r>=1;){var i=n[r],o=n[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(o.component)break;r--}}return function(t){return t.reduce(function(t,e){return{params:Object(a.a)({},t.params,e.params),data:Object(a.a)({},t.data,e.data),resolve:Object(a.a)({},t.resolve,e._resolvedData)}},{params:{},data:{},resolve:{}})}(n.slice(r))}var Ki=function(){function t(t,e,n,r,i,o,a,s,c,u,l){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=o,this.component=a,this.routeConfig=s,this._urlSegment=c,this._lastPathIndex=u,this._resolve=l}return Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=$r(this.params)),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=$r(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"Route(url:'"+this.url.map(function(t){return t.toString()}).join("/")+"', path:'"+(this.routeConfig?this.routeConfig.path:"")+"')"},t}(),$i=function(t){function e(e,n){var r=t.call(this,n)||this;return r.url=e,to(r,n),r}return Object(a.c)(e,t),e.prototype.toString=function(){return eo(this._root)},e}(Gi);function to(t,e){e.value._routerState=t,e.children.forEach(function(e){return to(t,e)})}function eo(t){var e=t.children.length>0?" { "+t.children.map(eo).join(", ")+" } ":"";return""+t.value+e}function no(t){if(t.snapshot){var e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,ai(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),ai(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!ai(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),ai(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function ro(t,e){var n,r;return ai(t.params,e.params)&&vi(n=t.url,r=e.url)&&n.every(function(t,e){return ai(t.parameters,r[e].parameters)})&&!(!t.parent!=!e.parent)&&(!t.parent||ro(t.parent,e.parent))}function io(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function oo(t,e,n,r,i){var o={};return r&&ui(r,function(t,e){o[e]=Array.isArray(t)?t.map(function(t){return""+t}):""+t}),new pi(n.root===t?e:function t(e,n,r){var i={};return ui(e.children,function(e,o){i[o]=e===n?r:t(e,n,r)}),new fi(e.segments,i)}(n.root,t,e),o,i)}var ao=function(){function t(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&io(n[0]))throw new Error("Root segment cannot have matrix parameters");var r=n.find(function(t){return"object"==typeof t&&null!=t&&t.outlets});if(r&&r!==ci(n))throw new Error("{outlets:{}} has to be the last command")}return t.prototype.toRoot=function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]},t}(),so=function(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n};function co(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[Qr]:""+t}function uo(t,e,n){if(t||(t=new fi([],{})),0===t.segments.length&&t.hasChildren())return lo(t,e,n);var r=function(t,e,n){for(var r=0,i=e,o={match:!1,pathIndex:0,commandIndex:0};i<t.segments.length;){if(r>=n.length)return o;var a=t.segments[i],s=co(n[r]),c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===s)break;if(s&&c&&"object"==typeof c&&void 0===c.outlets){if(!mo(s,c,a))return o;r+=2}else{if(!mo(s,{},a))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(t,e,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){var o=new fi(t.segments.slice(0,r.pathIndex),{});return o.children[Qr]=new fi(t.segments.slice(r.pathIndex),t.children),lo(o,0,i)}return r.match&&0===i.length?new fi(t.segments,{}):r.match&&!t.hasChildren()?ho(t,e,n):r.match?lo(t,0,i):ho(t,e,n)}function lo(t,e,n){if(0===n.length)return new fi(t.segments,{});var r=function(t){return"object"!=typeof t[0]?((e={})[Qr]=t,e):void 0===t[0].outlets?((n={})[Qr]=t,n):t[0].outlets;var e,n}(n),i={};return ui(r,function(n,r){null!==n&&(i[r]=uo(t.children[r],e,n))}),ui(t.children,function(t,e){void 0===r[e]&&(i[e]=t)}),new fi(t.segments,i)}function ho(t,e,n){for(var r=t.segments.slice(0,e),i=0;i<n.length;){if("object"==typeof n[i]&&void 0!==n[i].outlets){var o=po(n[i].outlets);return new fi(r,o)}if(0===i&&io(n[0]))r.push(new mi(t.segments[e].path,n[0])),i++;else{var a=co(n[i]),s=i<n.length-1?n[i+1]:null;a&&s&&io(s)?(r.push(new mi(a,fo(s))),i+=2):(r.push(new mi(a,{})),i++)}}return new fi(r,{})}function po(t){var e={};return ui(t,function(t,n){null!==t&&(e[n]=ho(new fi([],{}),0,t))}),e}function fo(t){var e={};return ui(t,function(t,n){return e[n]=""+t}),e}function mo(t,e,n){return t==n.path&&ai(e,n.parameters)}var vo=function(t){this.path=t,this.route=this.path[this.path.length-1]},go=function(t,e){this.component=t,this.route=e},yo=function(){function t(t,e,n,r){this.future=t,this.curr=e,this.moduleInjector=n,this.forwardEvent=r,this.canActivateChecks=[],this.canDeactivateChecks=[]}return t.prototype.initialize=function(t){var e=this.future._root;this.setupChildRouteGuards(e,this.curr?this.curr._root:null,t,[e.value])},t.prototype.checkGuards=function(){var t=this;if(!this.isDeactivating()&&!this.isActivating())return fn(!0);var e=this.runCanDeactivateChecks();return Sn.call(e,function(e){return e?t.runCanActivateChecks():fn(!1)})},t.prototype.resolveData=function(t){var e=this;if(!this.isActivating())return fn(null);var n=qn(this.canActivateChecks),r=gn.call(n,function(n){return e.runResolve(n.route,t)});return Or.call(r,function(t,e){return t})},t.prototype.isDeactivating=function(){return 0!==this.canDeactivateChecks.length},t.prototype.isActivating=function(){return 0!==this.canActivateChecks.length},t.prototype.setupChildRouteGuards=function(t,e,n,r){var i=this,o=qi(e);t.children.forEach(function(t){i.setupRouteGuards(t,o[t.value.outlet],n,r.concat([t.value])),delete o[t.value.outlet]}),ui(o,function(t,e){return i.deactivateRouteAndItsChildren(t,n.getContext(e))})},t.prototype.setupRouteGuards=function(t,e,n,r){var i=t.value,o=e?e.value:null,a=n?n.getContext(t.value.outlet):null;if(o&&i.routeConfig===o.routeConfig){var s=this.shouldRunGuardsAndResolvers(o,i,i.routeConfig.runGuardsAndResolvers);s?this.canActivateChecks.push(new vo(r)):(i.data=o.data,i._resolvedData=o._resolvedData),this.setupChildRouteGuards(t,e,i.component?a?a.children:null:n,r),s&&this.canDeactivateChecks.push(new go(a.outlet.component,o))}else o&&this.deactivateRouteAndItsChildren(e,a),this.canActivateChecks.push(new vo(r)),this.setupChildRouteGuards(t,null,i.component?a?a.children:null:n,r)},t.prototype.shouldRunGuardsAndResolvers=function(t,e,n){switch(n){case"always":return!0;case"paramsOrQueryParamsChange":return!ro(t,e)||!ai(t.queryParams,e.queryParams);case"paramsChange":default:return!ro(t,e)}},t.prototype.deactivateRouteAndItsChildren=function(t,e){var n=this,r=qi(t),i=t.value;ui(r,function(t,r){n.deactivateRouteAndItsChildren(t,i.component?e?e.children.getContext(r):null:e)}),this.canDeactivateChecks.push(new go(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))},t.prototype.runCanDeactivateChecks=function(){var t=this,e=qn(this.canDeactivateChecks),n=Sn.call(e,function(e){return t.runCanDeactivate(e.component,e.route)});return dr.call(n,function(t){return!0===t})},t.prototype.runCanActivateChecks=function(){var t=this,e=qn(this.canActivateChecks),n=gn.call(e,function(e){return li(qn([t.fireChildActivationStart(e.route.parent),t.fireActivationStart(e.route),t.runCanActivateChild(e.path),t.runCanActivate(e.route)]))});return dr.call(n,function(t){return!0===t})},t.prototype.fireActivationStart=function(t){return null!==t&&this.forwardEvent&&this.forwardEvent(new Zr(t)),fn(!0)},t.prototype.fireChildActivationStart=function(t){return null!==t&&this.forwardEvent&&this.forwardEvent(new qr(t)),fn(!0)},t.prototype.runCanActivate=function(t){var e=this,n=t.routeConfig?t.routeConfig.canActivate:null;return n&&0!==n.length?li(_n.call(qn(n),function(n){var r,i=e.getToken(n,t);return r=hi(i.canActivate?i.canActivate(t,e.future):i(t,e.future)),sr.call(r)})):fn(!0)},t.prototype.runCanActivateChild=function(t){var e=this,n=t[t.length-1],r=t.slice(0,t.length-1).reverse().map(function(t){return e.extractCanActivateChild(t)}).filter(function(t){return null!==t});return li(_n.call(qn(r),function(t){return li(_n.call(qn(t.guards),function(r){var i,o=e.getToken(r,t.node);return i=hi(o.canActivateChild?o.canActivateChild(n,e.future):o(n,e.future)),sr.call(i)}))}))},t.prototype.extractCanActivateChild=function(t){var e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null},t.prototype.runCanDeactivate=function(t,e){var n=this,r=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!r||0===r.length)return fn(!0);var i=Sn.call(qn(r),function(r){var i,o=n.getToken(r,e);return i=hi(o.canDeactivate?o.canDeactivate(t,e,n.curr,n.future):o(t,e,n.curr,n.future)),sr.call(i)});return dr.call(i,function(t){return!0===t})},t.prototype.runResolve=function(t,e){return _n.call(this.resolveNode(t._resolve,t),function(n){return t._resolvedData=n,t.data=Object(a.a)({},t.data,Qi(t,e).resolve),null})},t.prototype.resolveNode=function(t,e){var n=this,r=Object.keys(t);if(0===r.length)return fn({});if(1===r.length){var i=r[0];return _n.call(this.getResolver(t[i],e),function(t){return(e={})[i]=t,e;var e})}var o={},a=Sn.call(qn(r),function(r){return _n.call(n.getResolver(t[r],e),function(t){return o[r]=t,t})});return _n.call(vr.call(a),function(){return o})},t.prototype.getResolver=function(t,e){var n=this.getToken(t,e);return hi(n.resolve?n.resolve(e,this.future):n(e,this.future))},t.prototype.getToken=function(t,e){var n=function(t){if(!t)return null;for(var e=t.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(n?n.module.injector:this.moduleInjector).get(t)},t}(),bo=function(){},xo=function(){function t(t,e,n,r,i){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i}return t.prototype.recognize=function(){try{var t=So(this.urlTree.root,[],[],this.config).segmentGroup,e=this.processSegmentGroup(this.config,t,Qr),n=new Ki([],Object.freeze({}),Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,{},Qr,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Xi(n,e),i=new $i(this.url,r);return this.inheritParamsAndData(i._root),fn(i)}catch(t){return new T.a(function(e){return e.error(t)})}},t.prototype.inheritParamsAndData=function(t){var e=this,n=t.value,r=Qi(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(function(t){return e.inheritParamsAndData(t)})},t.prototype.processSegmentGroup=function(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)},t.prototype.processChildren=function(t,e){var n,r=this,i=gi(e,function(e,n){return r.processSegmentGroup(t,e,n)});return n={},i.forEach(function(t){var e=n[t.value.outlet];if(e){var r=e.url.map(function(t){return t.toString()}).join("/"),i=t.value.url.map(function(t){return t.toString()}).join("/");throw new Error("Two segments cannot have the same outlet name: '"+r+"' and '"+i+"'.")}n[t.value.outlet]=t.value}),i.sort(function(t,e){return t.value.outlet===Qr?-1:e.value.outlet===Qr?1:t.value.outlet.localeCompare(e.value.outlet)}),i},t.prototype.processSegment=function(t,e,n,r){for(var i=0,o=t;i<o.length;i++){var a=o[i];try{return this.processSegmentAgainstRoute(a,e,n,r)}catch(t){if(!(t instanceof bo))throw t}}if(this.noLeftoversInUrl(e,n,r))return[];throw new bo},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.processSegmentAgainstRoute=function(t,e,n,r){if(t.redirectTo)throw new bo;if((t.outlet||Qr)!==r)throw new bo;var i,o=[],s=[];if("**"===t.path){var c=n.length>0?ci(n).parameters:{};i=new Ki(n,c,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,Ao(t),r,t.component,t,wo(e),_o(e)+n.length,Eo(t))}else{var u=function(t,e,n){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||n.length>0))throw new bo;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(e.matcher||ti)(n,t,e);if(!r)throw new bo;var i={};ui(r.posParams,function(t,e){i[e]=t.path});var o=r.consumed.length>0?Object(a.a)({},i,r.consumed[r.consumed.length-1].parameters):i;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:o}}(e,t,n);o=u.consumedSegments,s=n.slice(u.lastChild),i=new Ki(o,u.parameters,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,Ao(t),r,t.component,t,wo(e),_o(e)+o.length,Eo(t))}var l=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),h=So(e,o,s,l),d=h.segmentGroup,p=h.slicedSegments;if(0===p.length&&d.hasChildren()){var f=this.processChildren(l,d);return[new Xi(i,f)]}if(0===l.length&&0===p.length)return[new Xi(i,[])];var m=this.processSegment(l,d,p,Qr);return[new Xi(i,m)]},t}();function wo(t){for(var e=t;e._sourceSegment;)e=e._sourceSegment;return e}function _o(t){for(var e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;e._sourceSegment;)n+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return n-1}function So(t,e,n,r){if(n.length>0&&function(t,e,n){return r.some(function(n){return To(t,e,n)&&Mo(n)!==Qr})}(t,n)){var i=new fi(e,function(t,e,n,r){var i={};i[Qr]=r,r._sourceSegment=t,r._segmentIndexShift=e.length;for(var o=0,a=n;o<a.length;o++){var s=a[o];if(""===s.path&&Mo(s)!==Qr){var c=new fi([],{});c._sourceSegment=t,c._segmentIndexShift=e.length,i[Mo(s)]=c}}return i}(t,e,r,new fi(n,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return r.some(function(n){return To(t,e,n)})}(t,n)){var o=new fi(t.segments,function(t,e,n,i){for(var o={},s=0,c=r;s<c.length;s++){var u=c[s];if(To(t,e,u)&&!i[Mo(u)]){var l=new fi([],{});l._sourceSegment=t,l._segmentIndexShift=t.segments.length,o[Mo(u)]=l}}return Object(a.a)({},i,o)}(t,n,0,t.children));return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:n}}var s=new fi(t.segments,t.children);return s._sourceSegment=t,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:n}}function To(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function Mo(t){return t.outlet||Qr}function Ao(t){return t.data||{}}function Eo(t){return t.resolve||{}}var Co=function(){},Po=function(){function t(){}return t.prototype.shouldDetach=function(t){return!1},t.prototype.store=function(t,e){},t.prototype.shouldAttach=function(t){return!1},t.prototype.retrieve=function(t){return null},t.prototype.shouldReuseRoute=function(t,e){return t.routeConfig===e.routeConfig},t}(),Oo=new i.n("ROUTES"),No=function(){function t(t,e,n,r){this.loader=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=r}return t.prototype.load=function(t,e){var n=this;this.onLoadStartListener&&this.onLoadStartListener(e);var r=this.loadModuleFactory(e.loadChildren);return _n.call(r,function(r){n.onLoadEndListener&&n.onLoadEndListener(e);var i=r.create(t);return new ei(si(i.injector.get(Oo)).map(oi),i)})},t.prototype.loadModuleFactory=function(t){var e=this;return"string"==typeof t?cr(this.loader.load(t)):Sn.call(hi(t()),function(t){return t instanceof i.s?fn(t):cr(e.compiler.compileModuleAsync(t))})},t}(),Lo=function(){},Io=function(){function t(){}return t.prototype.shouldProcessUrl=function(t){return!0},t.prototype.extract=function(t){return t},t.prototype.merge=function(t,e){return t},t}();function Ro(t){throw t}function Do(t){return fn(null)}var Fo=function(){function t(t,e,n,r,o,a,s,c){var u=this;this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=n,this.location=r,this.config=c,this.navigations=new dn(null),this.navigationId=0,this.events=new ln.b,this.errorHandler=Ro,this.navigated=!1,this.hooks={beforePreactivation:Do,afterPreactivation:Do},this.urlHandlingStrategy=new Io,this.routeReuseStrategy=new Po,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.ngModule=o.get(i.u),this.resetConfig(c),this.currentUrlTree=new pi(new fi([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.configLoader=new No(a,s,function(t){return u.triggerEvent(new Wr(t))},function(t){return u.triggerEvent(new Xr(t))}),this.routerState=Zi(this.currentUrlTree,this.rootComponentType),this.processNavigations()}return t.prototype.resetRootComponentType=function(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType},t.prototype.initialNavigation=function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})},t.prototype.setUpLocationChangeListener=function(){var t=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(function(e){var n=t.urlSerializer.parse(e.url),r="popstate"===e.type?"popstate":"hashchange";setTimeout(function(){t.scheduleNavigation(n,r,{replaceUrl:!0})},0)}))},Object.defineProperty(t.prototype,"url",{get:function(){return this.serializeUrl(this.currentUrlTree)},enumerable:!0,configurable:!0}),t.prototype.triggerEvent=function(t){this.events.next(t)},t.prototype.resetConfig=function(t){ni(t),this.config=t.map(oi),this.navigated=!1},t.prototype.ngOnDestroy=function(){this.dispose()},t.prototype.dispose=function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)},t.prototype.createUrlTree=function(t,e){void 0===e&&(e={});var n=e.relativeTo,r=e.queryParams,o=e.fragment,s=e.preserveQueryParams,c=e.queryParamsHandling,u=e.preserveFragment;Object(i.R)()&&s&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var l=n||this.routerState.root,h=u?this.currentUrlTree.fragment:o,d=null;if(c)switch(c){case"merge":d=Object(a.a)({},this.currentUrlTree.queryParams,r);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=r||null}else d=s?this.currentUrlTree.queryParams:r||null;return null!==d&&(d=this.removeEmptyProps(d)),function(t,e,n,r,i){if(0===n.length)return oo(e.root,e.root,e,r,i);var o=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new ao(!0,0,t);var e=0,n=!1,r=t.reduce(function(t,r,i){if("object"==typeof r&&null!=r){if(r.outlets){var o={};return ui(r.outlets,function(t,e){o[e]="string"==typeof t?t.split("/"):t}),t.concat([{outlets:o}])}if(r.segmentPath)return t.concat([r.segmentPath])}return"string"!=typeof r?t.concat([r]):0===i?(r.split("/").forEach(function(r,i){0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?e++:""!=r&&t.push(r))}),t):t.concat([r])},[]);return new ao(n,e,r)}(n);if(o.toRoot())return oo(e.root,new fi([],{}),e,r,i);var a=function(t,n,r){if(t.isAbsolute)return new so(e.root,!0,0);if(-1===r.snapshot._lastPathIndex)return new so(r.snapshot._urlSegment,!0,0);var i=io(t.commands[0])?0:1;return function(e,n,o){for(var a=r.snapshot._urlSegment,s=r.snapshot._lastPathIndex+i,c=t.numberOfDoubleDots;c>s;){if(c-=s,!(a=a.parent))throw new Error("Invalid number of '../'");s=a.segments.length}return new so(a,!1,s-c)}()}(o,0,t),s=a.processChildren?lo(a.segmentGroup,a.index,o.commands):uo(a.segmentGroup,a.index,o.commands);return oo(a.segmentGroup,s,e,r,i)}(l,this.currentUrlTree,t,d,h)},t.prototype.navigateByUrl=function(t,e){void 0===e&&(e={skipLocationChange:!1});var n=t instanceof pi?t:this.parseUrl(t),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",e)},t.prototype.navigate=function(t,e){return void 0===e&&(e={skipLocationChange:!1}),function(t){for(var e=0;e<t.length;e++){var n=t[e];if(null==n)throw new Error("The requested path contains "+n+" segment at index "+e)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)},t.prototype.serializeUrl=function(t){return this.urlSerializer.serialize(t)},t.prototype.parseUrl=function(t){return this.urlSerializer.parse(t)},t.prototype.isActive=function(t,e){if(t instanceof pi)return di(this.currentUrlTree,t,e);var n=this.urlSerializer.parse(t);return di(this.currentUrlTree,n,e)},t.prototype.removeEmptyProps=function(t){return Object.keys(t).reduce(function(e,n){var r=t[n];return null!==r&&void 0!==r&&(e[n]=r),e},{})},t.prototype.processNavigations=function(){var t=this;gn.call(this.navigations,function(e){return e?(t.executeScheduledNavigation(e),e.promise.catch(function(){})):fn(null)}).subscribe(function(){})},t.prototype.scheduleNavigation=function(t,e,n){var r=this.navigations.value;if(r&&"imperative"!==e&&"imperative"===r.source&&r.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(r&&"hashchange"==e&&"popstate"===r.source&&r.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(r&&"popstate"==e&&"hashchange"===r.source&&r.rawUrl.toString()===t.toString())return Promise.resolve(!0);var i=null,o=null,a=new Promise(function(t,e){i=t,o=e}),s=++this.navigationId;return this.navigations.next({id:s,source:e,rawUrl:t,extras:n,resolve:i,reject:o,promise:a}),a.catch(function(t){return Promise.reject(t)})},t.prototype.executeScheduledNavigation=function(t){var e=this,n=t.id,r=t.rawUrl,i=t.extras,o=t.resolve,a=t.reject,s=this.urlHandlingStrategy.extract(r),c=!this.navigated||s.toString()!==this.currentUrlTree.toString();("reload"===this.onSameUrlNavigation||c)&&this.urlHandlingStrategy.shouldProcessUrl(r)?(this.events.next(new Fr(n,this.serializeUrl(s))),Promise.resolve().then(function(t){return e.runNavigate(s,r,!!i.skipLocationChange,!!i.replaceUrl,n,null)}).then(o,a)):c&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)?(this.events.next(new Fr(n,this.serializeUrl(s))),Promise.resolve().then(function(t){return e.runNavigate(s,r,!1,!1,n,Zi(s,e.rootComponentType).snapshot)}).then(o,a)):(this.rawUrlTree=r,o(null))},t.prototype.runNavigate=function(t,e,n,r,i,o){var a=this;return i!==this.navigationId?(this.events.next(new kr(i,this.serializeUrl(t),"Navigation ID "+i+" is not equal to the current navigation id "+this.navigationId)),Promise.resolve(!1)):new Promise(function(s,c){var u;if(o)u=fn({appliedUrl:t,snapshot:o});else{var l=new ki(a.ngModule.injector,a.configLoader,a.urlSerializer,t,a.config).apply();u=Sn.call(l,function(e){return _n.call(function(t,e,n,r,i){return void 0===i&&(i="emptyOnly"),new xo(t,e,n,r,i).recognize()}(a.rootComponentType,a.config,e,a.serializeUrl(e),a.paramsInheritanceStrategy),function(n){return a.events.next(new Br(i,a.serializeUrl(t),a.serializeUrl(e),n)),{appliedUrl:e,snapshot:n}})})}var h,d=Sn.call(u,function(t){return _n.call(a.hooks.beforePreactivation(t.snapshot),function(){return t})}),p=_n.call(d,function(t){var e=t.appliedUrl,n=t.snapshot;return(h=new yo(n,a.routerState.snapshot,a.ngModule.injector,function(t){return a.triggerEvent(t)})).initialize(a.rootContexts),{appliedUrl:e,snapshot:n}}),f=Sn.call(p,function(e){var n=e.appliedUrl,r=e.snapshot;return a.navigationId!==i?fn(!1):(a.triggerEvent(new zr(i,a.serializeUrl(t),n,r)),_n.call(h.checkGuards(),function(e){return a.triggerEvent(new Vr(i,a.serializeUrl(t),n,r,e)),{appliedUrl:n,snapshot:r,shouldActivate:e}}))}),m=Sn.call(f,function(e){return a.navigationId!==i?fn(!1):e.shouldActivate&&h.isActivating()?(a.triggerEvent(new Gr(i,a.serializeUrl(t),e.appliedUrl,e.snapshot)),_n.call(h.resolveData(a.paramsInheritanceStrategy),function(){return a.triggerEvent(new Hr(i,a.serializeUrl(t),e.appliedUrl,e.snapshot)),e})):fn(e)}),v=Sn.call(m,function(t){return _n.call(a.hooks.afterPreactivation(t.snapshot),function(){return t})}),g=_n.call(v,function(t){var e,n,r,i=t.appliedUrl,o=t.shouldActivate;return o?{appliedUrl:i,state:(r=function t(e,n,r){if(r&&e.shouldReuseRoute(n.value,r.value.snapshot)){(s=r.value)._futureSnapshot=n.value;var i=function(e,n,r){return n.children.map(function(n){for(var i=0,o=r.children;i<o.length;i++){var a=o[i];if(e.shouldReuseRoute(a.value.snapshot,n.value))return t(e,n,a)}return t(e,n)})}(e,n,r);return new Xi(s,i)}if(e.retrieve(n.value)){var o=e.retrieve(n.value).route;return function t(e,n){if(e.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=e.value;for(var r=0;r<e.children.length;++r)t(e.children[r],n.children[r])}(n,o),o}var a,s=new Ji(new dn((a=n.value).url),new dn(a.params),new dn(a.queryParams),new dn(a.fragment),new dn(a.data),a.outlet,a.component,a);return i=n.children.map(function(n){return t(e,n)}),new Xi(s,i)}(a.routeReuseStrategy,(e=t.snapshot)._root,(n=a.routerState)?n._root:void 0),new Yi(r,e)),shouldActivate:o}:{appliedUrl:i,state:null,shouldActivate:o}});a.activateRoutes(g,a.routerState,a.currentUrlTree,i,t,e,n,r,s,c)})},t.prototype.activateRoutes=function(t,e,n,r,i,o,a,s,c,u){var l,h=this;t.forEach(function(t){var n=t.state;if(t.shouldActivate&&r===h.navigationId){if(h.currentUrlTree=t.appliedUrl,h.rawUrlTree=h.urlHandlingStrategy.merge(h.currentUrlTree,o),h.routerState=n,!a){var i=h.urlSerializer.serialize(h.rawUrlTree);h.location.isCurrentPathEqualTo(i)||s?h.location.replaceState(i):h.location.go(i)}new Uo(h.routeReuseStrategy,n,e,function(t){return h.triggerEvent(t)}).activate(h.rootContexts),l=!0}else l=!1}).then(function(){l?(h.navigated=!0,h.events.next(new Ur(r,h.serializeUrl(i),h.serializeUrl(h.currentUrlTree))),c(!0)):(h.resetUrlToCurrentUrlTree(),h.events.next(new kr(r,h.serializeUrl(i),"")),c(!1))},function(t){if((a=t)&&a.ngNavigationCancelingError)h.navigated=!0,h.resetStateAndUrl(e,n,o),h.events.next(new kr(r,h.serializeUrl(i),t.message)),c(!1);else{h.resetStateAndUrl(e,n,o),h.events.next(new jr(r,h.serializeUrl(i),t));try{c(h.errorHandler(t))}catch(t){u(t)}}var a})},t.prototype.resetStateAndUrl=function(t,e,n){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()},t.prototype.resetUrlToCurrentUrlTree=function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree))},t}(),Uo=function(){function t(t,e,n,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=r}return t.prototype.activate=function(t){var e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),no(this.futureState.root),this.activateChildRoutes(e,n,t)},t.prototype.deactivateChildRoutes=function(t,e,n){var r=this,i=qi(e);t.children.forEach(function(t){var e=t.value.outlet;r.deactivateRoutes(t,i[e],n),delete i[e]}),ui(i,function(t,e){r.deactivateRouteAndItsChildren(t,n)})},t.prototype.deactivateRoutes=function(t,e,n){var r=t.value,i=e?e.value:null;if(r===i)if(r.component){var o=n.getContext(r.outlet);o&&this.deactivateChildRoutes(t,e,o.children)}else this.deactivateChildRoutes(t,e,n);else i&&this.deactivateRouteAndItsChildren(e,n)},t.prototype.deactivateRouteAndItsChildren=function(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)},t.prototype.detachAndStoreRouteSubtree=function(t,e){var n=e.getContext(t.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),i=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:r,route:t,contexts:i})}},t.prototype.deactivateRouteAndOutlet=function(t,e){var n=this,r=e.getContext(t.value.outlet);if(r){var i=qi(t),o=t.value.component?r.children:e;ui(i,function(t,e){return n.deactivateRouteAndItsChildren(t,o)}),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}},t.prototype.activateChildRoutes=function(t,e,n){var r=this,i=qi(e);t.children.forEach(function(t){r.activateRoutes(t,i[t.value.outlet],n),r.forwardEvent(new Jr(t.value.snapshot))}),t.children.length&&this.forwardEvent(new Yr(t.value.snapshot))},t.prototype.activateRoutes=function(t,e,n){var r=t.value,i=e?e.value:null;if(no(r),r===i)if(r.component){var o=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,o.children)}else this.activateChildRoutes(t,e,n);else if(r.component)if(o=n.getOrCreateContext(r.outlet),this.routeReuseStrategy.shouldAttach(r.snapshot)){var a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),ko(a.route)}else{var s=function(t){for(var e=r.snapshot.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(),c=s?s.module.componentFactoryResolver:null;o.route=r,o.resolver=c,o.outlet&&o.outlet.activateWith(r,c),this.activateChildRoutes(t,null,o.children)}else this.activateChildRoutes(t,null,n)},t}();function ko(t){no(t.value),t.children.forEach(ko)}var jo=function(){return function(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Bo,this.attachRef=null}}(),Bo=function(){function t(){this.contexts=new Map}return t.prototype.onChildOutletCreated=function(t,e){var n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)},t.prototype.onChildOutletDestroyed=function(t){var e=this.getContext(t);e&&(e.outlet=null)},t.prototype.onOutletDeactivated=function(){var t=this.contexts;return this.contexts=new Map,t},t.prototype.onOutletReAttached=function(t){this.contexts=t},t.prototype.getOrCreateContext=function(t){var e=this.getContext(t);return e||(e=new jo,this.contexts.set(t,e)),e},t.prototype.getContext=function(t){return this.contexts.get(t)||null},t}(),zo=function(){function t(t,e,n,r,o){this.parentContexts=t,this.location=e,this.resolver=n,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new i.l,this.deactivateEvents=new i.l,this.name=r||Qr,t.onChildOutletCreated(this.name,this)}return t.prototype.ngOnDestroy=function(){this.parentContexts.onChildOutletDestroyed(this.name)},t.prototype.ngOnInit=function(){if(!this.activated){var t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}},Object.defineProperty(t.prototype,"isActivated",{get:function(){return!!this.activated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRoute",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRouteData",{get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}},enumerable:!0,configurable:!0}),t.prototype.detach=function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var t=this.activated;return this.activated=null,this._activatedRoute=null,t},t.prototype.attach=function(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)},t.prototype.deactivate=function(){if(this.activated){var t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}},t.prototype.activateWith=function(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;var n=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new Vo(t,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)},t}(),Vo=function(){function t(t,e,n){this.route=t,this.childContexts=e,this.parent=n}return t.prototype.get=function(t,e){return t===Ji?this.route:t===Bo?this.childContexts:this.parent.get(t,e)},t}(),Go=function(){},Ho=function(){function t(){}return t.prototype.preload=function(t,e){return $n.call(e(),function(){return fn(null)})},t}(),Wo=function(){function t(){}return t.prototype.preload=function(t,e){return fn(null)},t}(),Xo=function(){function t(t,e,n,r,i){this.router=t,this.injector=r,this.preloadingStrategy=i,this.loader=new No(e,n,function(e){return t.triggerEvent(new Wr(e))},function(e){return t.triggerEvent(new Xr(e))})}return t.prototype.setUpPreloading=function(){var t=this,e=Rr.call(this.router.events,function(t){return t instanceof Ur});this.subscription=gn.call(e,function(){return t.preload()}).subscribe(function(){})},t.prototype.preload=function(){var t=this.injector.get(i.u);return this.processRoutes(t,this.router.config)},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.processRoutes=function(t,e){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];if(o.loadChildren&&!o.canLoad&&o._loadedConfig){var a=o._loadedConfig;n.push(this.processRoutes(a.module,a.routes))}else o.loadChildren&&!o.canLoad?n.push(this.preloadConfig(t,o)):o.children&&n.push(this.processRoutes(t,o.children))}return gr.call(qn(n))},t.prototype.preloadConfig=function(t,e){var n=this;return this.preloadingStrategy.preload(e,function(){var r=n.loader.load(t.injector,e);return Sn.call(r,function(t){return e._loadedConfig=t,n.processRoutes(t.module,t.routes)})})},t}(),qo=new i.n("ROUTER_CONFIGURATION"),Yo=new i.n("ROUTER_FORROOT_GUARD"),Zo=[P,{provide:yi,useClass:bi},{provide:Fo,useFactory:ea,deps:[i.g,yi,Bo,P,i.o,i.t,i.i,Oo,qo,[Lo,new i.x],[Co,new i.x]]},Bo,{provide:Ji,useFactory:na,deps:[Fo]},{provide:i.t,useClass:i.F},Xo,Wo,Ho,{provide:qo,useValue:{enableTracing:!1}}];function Jo(){return new i.v("Router",Fo)}var Qo=function(){function t(t,e){}return t.forRoot=function(e,n){return{ngModule:t,providers:[Zo,ta(e),{provide:Yo,useFactory:$o,deps:[[Fo,new i.x,new i.E]]},{provide:qo,useValue:n||{}},{provide:E,useFactory:Ko,deps:[M,[new i.m(C),new i.x],qo]},{provide:Go,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:Wo},{provide:i.v,multi:!0,useFactory:Jo},[ra,{provide:i.d,multi:!0,useFactory:ia,deps:[ra]},{provide:aa,useFactory:oa,deps:[ra]},{provide:i.b,multi:!0,useExisting:aa}]]}},t.forChild=function(e){return{ngModule:t,providers:[ta(e)]}},t}();function Ko(t,e,n){return void 0===n&&(n={}),n.useHash?new N(t,e):new L(t,e)}function $o(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function ta(t){return[{provide:i.a,multi:!0,useValue:t},{provide:Oo,multi:!0,useValue:t}]}function ea(t,e,n,r,i,o,a,s,c,u,l){void 0===c&&(c={});var h=new Fo(null,e,n,r,i,o,a,si(s));if(u&&(h.urlHandlingStrategy=u),l&&(h.routeReuseStrategy=l),c.errorHandler&&(h.errorHandler=c.errorHandler),c.enableTracing){var d=q();h.events.subscribe(function(t){d.logGroup("Router Event: "+t.constructor.name),d.log(t.toString()),d.log(t),d.logGroupEnd()})}return c.onSameUrlNavigation&&(h.onSameUrlNavigation=c.onSameUrlNavigation),c.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=c.paramsInheritanceStrategy),h}function na(t){return t.routerState.root}var ra=function(){function t(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new ln.b}return t.prototype.appInitializer=function(){var t=this;return this.injector.get(A,Promise.resolve(null)).then(function(){var e=null,n=new Promise(function(t){return e=t}),r=t.injector.get(Fo),i=t.injector.get(qo);if(t.isLegacyDisabled(i)||t.isLegacyEnabled(i))e(!0);else if("disabled"===i.initialNavigation)r.setUpLocationChangeListener(),e(!0);else{if("enabled"!==i.initialNavigation)throw new Error("Invalid initialNavigation options: '"+i.initialNavigation+"'");r.hooks.afterPreactivation=function(){return t.initNavigation?fn(null):(t.initNavigation=!0,e(!0),t.resultOfPreactivationDone)},r.initialNavigation()}return n})},t.prototype.bootstrapListener=function(t){var e=this.injector.get(qo),n=this.injector.get(Xo),r=this.injector.get(Fo),o=this.injector.get(i.g);t===o.components[0]&&(this.isLegacyEnabled(e)?r.initialNavigation():this.isLegacyDisabled(e)&&r.setUpLocationChangeListener(),n.setUpPreloading(),r.resetRootComponentType(o.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())},t.prototype.isLegacyEnabled=function(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation},t.prototype.isLegacyDisabled=function(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation},t}();function ia(t){return t.appInitializer.bind(t)}function oa(t){return t.bootstrapListener.bind(t)}var aa=new i.n("Router Initializer"),sa=function(){function t(t){this.apiHttpService=t}return t.prototype.createLobby=function(t){return void 0===t&&(t=1),this.apiHttpService.apiPost("lobby/createLobby",{playersCount:t})},t.prototype.getLobbies=function(){return this.apiHttpService.apiGet("lobby/getLobbies")},t.prototype.quickStart=function(){return this.apiHttpService.apiPost("lobby/quickStart")},t}(),ca=n("DmT9"),ua=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},la=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ha=function(){function t(){}return t.sleep=function(t){return ua(this,void 0,void 0,function(){return la(this,function(e){return[2,new Promise(function(e){setTimeout(function(){e()},t)})]})})},t.wait=function(t,e){return void 0===e&&(e=!0),ua(this,void 0,void 0,function(){return la(this,function(n){return[2,new Promise(function(n,r){setTimeout(function(){e?n():r("Rejected by timeout")},t)})]})})},t.doWithFailTimeout=function(e,n){return ua(this,void 0,void 0,function(){return la(this,function(r){return[2,Promise.race([e,t.wait(n,!1)])]})})},t}(),da=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},pa=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},fa=function(){function t(){this.host=an.BACKEND_URL,this.stepSubject=new ln.b,this.finishSubject=new ln.b}return t.prototype.connectToLobby=function(t){return da(this,void 0,void 0,function(){var e,n,r,i=this;return pa(this,function(o){switch(o.label){case 0:t.startsWith("::")&&(e=+t.substr(2),(n=an.BACKEND_URL).match(/:\d+\/?$/)&&(n=n.substr(0,n.lastIndexOf(":"))),t=n+":"+e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,ha.doWithFailTimeout(new Promise(function(e,n){var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];console.log("$%%%%% conn "+i.socket.id)},o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s(),n("disconnected")},a=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.log("$%%%%% lobbydata "+JSON.stringify(t)),s(),e()},s=function(){i.socket.off("connect",r),i.socket.off("disconnect",o),i.socket.off("addedToLobby",a)};console.log("Connecting to lobby "+t+"..."),i.socket=i.initSocket(t),i.socket.on("connect",r),i.socket.on("disconnect",o),i.socket.on("addedToLobby",a),i.socket.connect()}),1e4)];case 2:return[2,o.sent()];case 3:return r=o.sent(),this.socket?(this.socket.disconnect(),this.socket=null,[2,Promise.reject(r)]):[3,4];case 4:return[2]}})})},t.prototype.disconnect=function(){this.socket.disconnect(),this.socket=null},t.prototype.readyToStart=function(t){console.log("emitting readyToStart",JSON.stringify(t)),this.carId=t.id,this.socket.emit("readyToStart",t)},t.prototype.nextStep=function(t){console.log("emitting nextStep",JSON.stringify(t)),this.socket.emit("nextStep",t)},t.prototype.finished=function(t){console.log("emitting finished",{id:this.carId,stepsCount:t}),this.socket.emit("finished",{id:this.carId,stepsCount:t})},t.prototype.onStepComplete=function(t){console.log("stepComplete",JSON.stringify(t)),this.stepSubject.next(t)},t.prototype.onRaceFinished=function(t){console.log("raceComplete. winner?",t===this.carId),this.finishSubject.next(t===this.carId)},t.prototype.initSocket=function(t){var e=this,n=ca(t);return n.on("connect",function(){console.log("socket connected")}),n.on("disconnect",function(){console.log("socket disconnected")}),n.on("error",function(t){console.log("ERROR: ",t)}),n.on("stepComplete",function(t){return e.onStepComplete(t)}),n.on("raceFinished",function(t){return e.onRaceFinished(t)}),n},t}(),ma=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},va=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ga=function(){function t(t,e,n,r){this.loginService=t,this.lobbyDelegate=e,this.socketService=n,this.router=r}return t.prototype.onPracticeClick=function(){var t=this;this.lobbyDelegate.createLobby().subscribe(function(e){return ma(t,void 0,void 0,function(){var t;return va(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.socketService.connectToLobby(e.serverUrl)];case 1:return n.sent(),this.router.navigate(["/selectCars"]),[3,3];case 2:return t=n.sent(),console.log("Can't connect to lobby"),console.error(t),[3,3];case 3:return[2]}})})})},t.prototype.onPlayClick=function(){var t=this;this.lobbyDelegate.quickStart().subscribe(function(e){return ma(t,void 0,void 0,function(){var t;return va(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.socketService.connectToLobby(e.serverUrl)];case 1:return n.sent(),this.router.navigate(["/selectCars"]),[3,3];case 2:return t=n.sent(),console.log("Can't connect to lobby"),console.error(t),[3,3];case 3:return[2]}})})})},t.prototype.onSettingsClick=function(){},t.prototype.onExitClick=function(){this.loginService.logout()},t}(),ya=i.Z({encapsulation:0,styles:[[".button-login[_ngcontent-%COMP%]{width:60%;margin-top:20px!important;-ms-flex-item-align:end;align-self:flex-end}"]],data:{}});function ba(t){return i._18(0,[(t()(),i._1(0,0,null,null,13,"div",[],null,null,null,null,null)),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(2,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.onPlayClick()&&r),r},null,null)),(t()(),i._17(-1,null,["Play"])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(5,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.onPracticeClick()&&r),r},null,null)),(t()(),i._17(-1,null,["Practice"])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(8,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.onSettingsClick()&&r),r},null,null)),(t()(),i._17(-1,null,["Settings"])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(11,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.onExitClick()&&r),r},null,null)),(t()(),i._17(-1,null,["Exit"])),(t()(),i._17(-1,null,["\n"])),(t()(),i._17(-1,null,["\n\n"]))],null,null)}var xa=i.X("page-menu",ga,function(t){return i._18(0,[(t()(),i._1(0,0,null,null,1,"page-menu",[],null,null,null,ba,ya)),i._0(1,49152,null,0,ga,[un,sa,fa,Fo],null,null)],null,null)},{},{},[]),wa=function(){function t(t){this.apiHttpService=t}return t.prototype.getAllCars=function(){return this.apiHttpService.apiGet("car/")},t}(),_a=function(){function t(t){this.carDelegate=t}return t.prototype.loadCars=function(){return this.carDelegate.getAllCars()},t}(),Sa=function(){function t(t,e){this.carService=t,this.router=e,this.selectedCar=0,this.carsList=[]}return t.prototype.ngOnInit=function(){this.getCars()},t.prototype.getCars=function(){var t=this;this.carService.loadCars().subscribe(function(e){t.carService.cars=e,t.carsList=t.carService.cars},function(t){console.error(t)})},t.prototype.setSelectedCar=function(t){this.carService.selectedCar=t,this.router.navigate(["/game"])},t}(),Ta=i.Z({encapsulation:0,styles:[["#canvasContainer[_ngcontent-%COMP%]{width:100%;height:100%}.container[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.car-container[_ngcontent-%COMP%]   .car-image[_ngcontent-%COMP%]{margin-left:1em;height:8em;width:auto}.selected-car[_ngcontent-%COMP%]{opacity:.7}span[_ngcontent-%COMP%]{font-size:.8em}.car-info-container[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}"]],data:{}});function Ma(t){return i._18(0,[(t()(),i._1(0,0,null,null,6,"div",[["class","image-container"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n    "])),(t()(),i._1(2,0,null,null,3,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.setSelectedCar(t.context.$implicit)&&r),r},null,null)),(t()(),i._17(-1,null,["\n      "])),(t()(),i._1(4,0,null,null,0,"img",[["height","99"],["width","150"]],[[8,"src",4]],null,null,null,null)),(t()(),i._17(5,null,["\n      ","\n    "])),(t()(),i._17(-1,null,["\n  "]))],null,function(t,e){t(e,4,0,i._4(1,"",e.context.$implicit.image,"")),t(e,5,0,e.context.$implicit.name)})}function Aa(t){return i._18(0,[(t()(),i._1(0,0,null,null,4,"div",[],null,null,null,null,null)),(t()(),i._17(-1,null,["\n  "])),(t()(),i.W(16777216,null,null,1,null,Ma)),i._0(3,802816,null,0,B,[i.K,i.H,i.p],{ngForOf:[0,"ngForOf"]},null),(t()(),i._17(-1,null,["\n"])),(t()(),i._17(-1,null,["\n"]))],function(t,e){t(e,3,0,e.component.carsList)},null)}var Ea=i.X("page-car-selection",Sa,function(t){return i._18(0,[(t()(),i._1(0,0,null,null,1,"page-car-selection",[],null,null,null,Aa,Ta)),i._0(1,114688,null,0,Sa,[_a,Fo],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]),Ca=n("Ml+6"),Pa=n("qKrd"),Oa=n("Z7et"),Na=n("50uv"),La=function(){function t(){}return t.isInRange=function(t,e,n,r){return void 0===r&&(r=!0),t>e&&t<n||r&&[e,n].indexOf(t)>-1},t.toRange=function(t,e,n){return Math.min(Math.max(t,e),n)},t.toNearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log2(t)))},t}(),Ia=n("Wj7o"),Ra=PIXI.Point,Da=function(){function t(){}return t.getAngleBetweenPoints=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},t.getDistanceBetweenPoints=function(t,e){return Math.hypot(e.y-t.y,e.x-t.x)},t.getMiddlePoint=function(t,e){return new Ra((t.x+e.x)/2,(t.y+e.y)/2)},t.isPointInsidePolygon=function(t,e){return Ia([t.x,t.y],e)},t}(),Fa=function(){function t(t,e){this.r=t,this.theta=e}return Object.defineProperty(t.prototype,"cartesianPoint",{get:function(){return new Ra(this.r*Math.cos(this.theta),this.r*Math.sin(this.theta))},enumerable:!0,configurable:!0}),t.fromCartesian=function(e,n){var r=e.clone();return n&&(r.x-=n.x,r.y-=n.y),new t(Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),Math.atan2(r.y,r.x))},t}(),Ua=PIXI.Point,ka=function(){function t(t,e){this.l=t,this.c=e}return Object.defineProperty(t.prototype,"arcRadius",{get:function(){return 1/Math.abs(this.c)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"arcCenter",{get:function(){return new Ua(0,this.c>0?this.arcRadius:-this.arcRadius)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerRotation",{get:function(){return this.l*this.c},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.polarPosition.cartesianPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"polarPosition",{get:function(){return new Fa(0===this.c?this.l:2/this.c*Math.sin(this.l*this.c/2),this.l*this.c/2)},enumerable:!0,configurable:!0}),t.prototype.breakToSegments=function(e){if(void 0===e&&(e=Math.ceil(2*Math.abs(this.l))),0===this.l)return[new Ua];for(var n=[],r=this.l/e,i=1;i<=e;i++)n.push(new t(i*r,this.c).position);return n},t.prototype.clone=function(){return new t(this.l,this.c)},t.fromPolarPosition=function(e){return(e.theta>Math.PI/2||e.theta<-Math.PI/2)&&(e.theta-=Math.PI*Math.sign(e.theta),e.r=-e.r),new t(e.theta*e.r/Math.sin(e.theta),2*Math.sin(e.theta)/e.r)},t.fromCartesianPosition=function(e){return t.fromPolarPosition(Fa.fromCartesian(e))},t}(),ja=function(t){function e(n,r){void 0===n&&(n=1),void 0===r&&(r=.2);var i=t.call(this)||this;return i.strokeColor=4357620,i.areaFillColor=4301812,i.areaFillColorAlpha=.3,i._pixelsInUnit=n,i.areaWidth=e.BASE_TEXTURE_WIDTH,i.areaHeight=e.BASE_TEXTURE_HEIGHT,i.relativeCarOffset=r,i.carOffset=e.BASE_TEXTURE_WIDTH*r,i.outerStrokeWeight=Math.round(e.BASE_OUTER_STROKE_WEIGHT),i.innerStrokeWeight=Math.round(e.BASE_INNER_STROKE_WEIGHT),i}return Object(a.c)(e,t),Object.defineProperty(e.prototype,"pixelsInUnit",{get:function(){return this._pixelsInUnit},set:function(t){this._pixelsInUnit!==t&&(this._pixelsInUnit=t,this.visible&&this.redraw())},enumerable:!0,configurable:!0}),e.prototype.redraw=function(){},e.BASE_TEXTURE_WIDTH=1024,e.BASE_TEXTURE_HEIGHT=512,e.BASE_OUTER_STROKE_WEIGHT=3,e.BASE_INNER_STROKE_WEIGHT=1,e}(PIXI.Graphics),Ba=PIXI.Point,za=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.redraw=function(){t.prototype.redraw.call(this),this.drawInner()},e.prototype.draw=function(t,e,n,r){this.currentData={minDistance:t,maxDistance:e,momentumDistance:n,maxCurvature:r},this.drawInner()},e.prototype.drawInner=function(){if(this.currentData){var t=this.currentData.minDistance,e=this.currentData.maxDistance,n=this.currentData.momentumDistance,r=this.currentData.maxCurvature;e*=this.pixelsInUnit,n*=this.pixelsInUnit;var i=new ka(t*=this.pixelsInUnit,r/=this.pixelsInUnit).position,o=new ka(t,-r).position,a=new ka(e,r).position,s=new ka(e,-r).position;this.clear(),this.lineStyle(this.outerStrokeWeight,this.strokeColor,1),this.beginFill(this.areaFillColor,this.areaFillColorAlpha),this.moveTo(i.x+this.carOffset,i.y+this.areaHeight/2),i.equals(o)||this.drawCardioid(t,r,-r),this.arc(this.carOffset,-1/r+this.areaHeight/2,1/r,Fa.fromCartesian(o,new Ba(0,-1/r)).theta,Fa.fromCartesian(s,new Ba(0,-1/r)).theta,!0),this.drawCardioid(e,-r,r),this.arc(this.carOffset,1/r+this.areaHeight/2,1/r,Fa.fromCartesian(a,new Ba(0,1/r)).theta,Fa.fromCartesian(i,new Ba(0,1/r)).theta,!0),this.endFill(),this.lineStyle(this.innerStrokeWeight,this.strokeColor,1),this.drawCardioid(n,-r,r,!0)}},e.prototype.drawCardioid=function(t,e,n,r,i){var o=this;void 0===r&&(r=!1),void 0===i&&(i=new Ba(this.carOffset,this.areaHeight/2)),this.getCardiodPathPoints(t,e,n,16).forEach(function(t,e){0!==e?o.lineTo(t.x+i.x,t.y+i.y):r&&o.moveTo(t.x+i.x,t.y+i.y)})},e.prototype.getCardiodPathPoints=function(t,e,n,r){void 0===r&&(r=32);for(var i=[],o=(n-e)/r,a=0;a<=r;a++)i.push(e+a*o);return i.map(function(e){return new ka(t,e).position})},e}(ja),Va=PIXI.Point,Ga=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.draw=function(t){this.currentTrajectory=t,this.drawInner()},e.prototype.redraw=function(){t.prototype.redraw.call(this),this.drawInner()},e.prototype.drawInner=function(){if(this.currentTrajectory){var t=this.currentTrajectory.clone();t.l*=this.pixelsInUnit,t.c/=this.pixelsInUnit;var e=new Va(this.carOffset,this.areaHeight/2),n=new Va(t.position.x+this.carOffset,this.areaHeight/2-t.position.y);if(this.clear(),this.lineStyle(this.outerStrokeWeight,this.strokeColor),Math.abs(t.c)<1e-5)this.moveTo(e.x,e.y),this.lineTo(n.x,n.y);else{var r=new Va(this.carOffset,this.areaHeight/2-t.arcCenter.y);this.arc(r.x,r.y,t.arcRadius,Fa.fromCartesian(e,r).theta,Fa.fromCartesian(n,r).theta,t.l>0?t.c>0:t.c<0)}}},e}(ja),Ha=function(){function t(){}return t.getDistanceInUniformlyAcceleratedMotion=function(t,e,n){return n*(t+e*n/2)},t.getAccelerationInUniformlyAcceleratedMotion=function(t,e,n){return 2/Math.pow(n,2)*(e-t*n)},t.getSpeedInUniformlyAcceleratedMotion=function(t,e,n){return t+e*n},t.getSpeedInUniformlyAcceleratedMotionByDistance=function(e,n,r){return t.getSpeedInUniformlyAcceleratedMotion(e,t.getAccelerationInUniformlyAcceleratedMotion(e,n,r),r)},t.getAccelerationToAchieveSpeed=function(t,e,n){return(e-t)/n},t}(),Wa=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},Xa=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},qa=Na.Point,Ya=function(){function t(){this.mousePosition=new qa,this.currentStepMinDistance=0,this.currentStepMaxDistance=0,this.currentStepMomentumDistance=0,this.currentStepMaxCurvature=0,this.cameraDistance=64,this.cameraDistanceSubject=new ln.b,this.trajectorySelected=new ln.b,this.isInSelectionState=!1,this.nextStepArea=new za(1024/this.controlPlaneLength),this.nextStepArc=new Ga(1024/this.controlPlaneLength),this.controlPlaneTextureRenderer=Na.autoDetectRenderer(this.nextStepArea.areaWidth,this.nextStepArea.areaHeight,{antialias:!0,resolution:1,transparent:!0}),this.controlPlaneTextureStage=new Na.Container,this.controlPlaneTextureStage.addChild(this.nextStepArea),this.controlPlaneTextureStage.addChild(this.nextStepArc),this.controlPlaneTexture=new Ca.Texture(this.controlPlaneTextureRenderer.view),this.controlPlane=new Ca.Mesh(new Ca.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),new Ca.MeshBasicMaterial({map:this.controlPlaneTexture,side:Ca.DoubleSide,transparent:!0,depthWrite:!1})),this.controlPlane.geometry.applyMatrix((new Ca.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArc.relativeCarOffset),0,0)),this.controlSphere=new Ca.Mesh(new Ca.SphereGeometry(.5),new Ca.MeshBasicMaterial({color:this.nextStepArc.strokeColor,side:Ca.DoubleSide,transparent:!0,opacity:1})),this.controlSphere.visible=!1}return Object.defineProperty(t.prototype,"controlPlaneWidth",{get:function(){return.6*this.cameraDistance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlPlaneLength",{get:function(){return 1.2*this.cameraDistance},enumerable:!0,configurable:!0}),t.prototype.initControls=function(t,e){var n=this;this.canvas=t.controlCanvas,this.stage3d=t,this.car=e,t.addControlElement(this.controlPlane),t.addControlElement(this.controlSphere),this.canvas.addEventListener("mousemove",function(t){n.onCanvasMouseMove(t)}),this.canvas.addEventListener("click",function(t){n.onCanvasMouseClick(t)}),this.updateTrajectorySelector(),this.updateCameraDistance()},t.prototype.adjustControlPositions=function(){this.car&&this.car.mesh&&this.controlPlane&&(this.controlPlane.position.set(this.car.mesh.position.x,this.car.mesh.position.y,this.car.mesh.position.z),this.controlPlane.rotation.set(this.car.mesh.rotation.x,this.car.mesh.rotation.y,this.car.mesh.rotation.z))},t.prototype.askForSelectedPosition=function(t,e,n,r){var i=this;return new Promise(function(o){return Wa(i,void 0,void 0,function(){var i,a,s=this;return Xa(this,function(c){switch(c.label){case 0:return this.currentStepMinDistance=t,this.currentStepMaxDistance=e,this.currentStepMomentumDistance=n,this.currentStepMaxCurvature=r,this.isInSelectionState=!0,[4,this.stage3d.renderControlsOnceSync()];case 1:return c.sent(),this.showStepArea(),this.updateTrajectorySelector(),i=this.trajectorySelected.asObservable().subscribe(function(t){clearTimeout(a),i.unsubscribe(),s.isInSelectionState=!1,s.controlSphere.visible=!1,s.hideStepAreaAndCurve(),o(t)}),a=setTimeout(function(){i.unsubscribe(),s.isInSelectionState=!1,s.controlSphere.visible=!1,s.hideStepAreaAndCurve(),o(new ka(Math.max(t,0),0))},an.MOVE_TIMEOUT),[2]}})})})},t.prototype.updateCameraDistance=function(){var t=Math.max(Ha.getDistanceInUniformlyAcceleratedMotion(0,this.car.characteristics.getMaxAcceleration(0),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/720),Ha.getDistanceInUniformlyAcceleratedMotion(Math.max(this.car.speed,0),this.car.characteristics.getMaxAcceleration(Math.max(this.car.speed,0)),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/360));t!==this.cameraDistance&&(this.cameraDistance=t,this.controlPlane.geometry=new Ca.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),this.controlPlane.geometry.applyMatrix((new Ca.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArc.relativeCarOffset),0,0)),this.nextStepArea.pixelsInUnit=1024/this.controlPlaneLength,this.nextStepArc.pixelsInUnit=1024/this.controlPlaneLength,(this.nextStepArc.visible||this.nextStepArea.visible)&&this.updateControlPlaneTexture(),this.cameraDistanceSubject.next(this.cameraDistance))},t.prototype.onCanvasMouseMove=function(t){var e=this.canvas.getBoundingClientRect();this.mousePosition=new qa(t.x-e.left,t.y-e.top),this.isInSelectionState&&this.updateTrajectorySelector()},t.prototype.onCanvasMouseClick=function(t){var e=this.canvas.getBoundingClientRect();if(this.mousePosition=new qa(t.x-e.left,t.y-e.top),this.isInSelectionState){var n=this.updateTrajectorySelector();n&&this.trajectorySelected.next(n)}},t.prototype.updateTrajectorySelector=function(){var t=this.canvas.getBoundingClientRect(),e=new Ca.Raycaster;e.setFromCamera({x:this.mousePosition.x/t.width*2-1,y:-this.mousePosition.y/t.height*2+1},this.stage3d.camera);var n=e.intersectObjects([this.controlPlane]);if(0===n.length)return this.controlSphere.visible=!1,void this.hideStepCurve();var r=this.getTrajectoryFromControlPlaneIntersection(n[0]);return La.isInRange(r.l,this.currentStepMinDistance,this.currentStepMaxDistance)&&La.isInRange(r.c,-this.currentStepMaxCurvature,this.currentStepMaxCurvature)?(this.controlSphere.visible=!0,this.controlSphere.position.set(n[0].point.x,n[0].point.y,n[0].point.z),this.showStepCurve(r),r):(this.controlSphere.visible=!1,this.hideStepCurve(),null)},t.prototype.getTrajectoryFromControlPlaneIntersection=function(t){return ka.fromCartesianPosition(this.uvToLocalWorld(t.uv))},t.prototype.showStepArea=function(){this.nextStepArea.visible=!0,this.nextStepArea.draw(this.currentStepMinDistance,this.currentStepMaxDistance,this.currentStepMomentumDistance,this.currentStepMaxCurvature),this.updateControlPlaneTexture()},t.prototype.showStepCurve=function(t){this.nextStepArc.draw(t),this.nextStepArc.visible=!0,this.updateControlPlaneTexture()},t.prototype.hideStepAreaAndCurve=function(){(this.nextStepArea.visible||this.nextStepArc.visible)&&(this.nextStepArea.visible&&(this.nextStepArea.visible=!1),this.nextStepArc.visible&&(this.nextStepArc.visible=!1),this.updateControlPlaneTexture())},t.prototype.hideStepCurve=function(){this.nextStepArc.visible&&(this.nextStepArc.visible=!1,this.updateControlPlaneTexture())},t.prototype.updateControlPlaneTexture=function(){this.controlPlaneTextureRenderer.render(this.controlPlaneTextureStage),this.controlPlaneTexture.needsUpdate=!0,this.stage3d.renderControlsOnce()},t.prototype.uvToLocalWorld=function(t){return new qa((t.x-this.nextStepArc.relativeCarOffset)*this.controlPlaneLength,(t.y-.5)*this.controlPlaneWidth)},t}();void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){var e=arguments;if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var i=e[r];if(void 0!==i&&null!==i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n});var Za,Ja,Qa,Ka,$a,ts,es,ns,rs,is,os={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}(),clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*os.DEG2RAD},radToDeg:function(t){return t*os.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function as(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead.")}function ss(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}function cs(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1}function us(){}function ls(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||ls.DefaultOrder}function hs(){this.mask=1}function ds(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(as.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,o,a,s,c,u,l,h,d,p,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=c,v[6]=u,v[10]=l,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new as).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:(ts=new ss,function(t){var e=this.elements,n=t.elements,r=1/ts.setFromMatrixColumn(t,0).length(),i=1/ts.setFromMatrixColumn(t,1).length(),o=1/ts.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,this}),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),c=Math.sin(r),u=Math.cos(i),l=Math.sin(i);if("XYZ"===t.order){var h=o*u,d=o*l,p=a*u,f=a*l;e[0]=s*u,e[4]=-s*l,e[8]=c,e[1]=d+p*c,e[5]=h-f*c,e[9]=-a*s,e[2]=f-h*c,e[6]=p+d*c,e[10]=o*s}else if("YXZ"===t.order){var m=s*l,v=c*u;e[0]=(g=s*u)+(y=c*l)*a,e[4]=v*a-m,e[8]=o*c,e[1]=o*l,e[5]=o*u,e[9]=-a,e[2]=m*a-v,e[6]=y+g*a,e[10]=o*s}else if("ZXY"===t.order){var g,y;m=s*l,v=c*u,e[0]=(g=s*u)-(y=c*l)*a,e[4]=-o*l,e[8]=v+m*a,e[1]=m+v*a,e[5]=o*u,e[9]=y-g*a,e[2]=-o*c,e[6]=a,e[10]=o*s}else if("ZYX"===t.order)h=o*u,d=o*l,p=a*u,f=a*l,e[0]=s*u,e[4]=p*c-d,e[8]=h*c+f,e[1]=s*l,e[5]=f*c+h,e[9]=d*c-p,e[2]=-c,e[6]=a*s,e[10]=o*s;else if("YZX"===t.order){var b=o*s,x=o*c,w=a*s,_=a*c;e[0]=s*u,e[4]=_-b*l,e[8]=w*l+x,e[1]=l,e[5]=o*u,e[9]=-a*u,e[2]=-c*u,e[6]=x*l+w,e[10]=b-_*l}else"XZY"===t.order&&(b=o*s,x=o*c,w=a*s,_=a*c,e[0]=s*u,e[4]=-l,e[8]=c*u,e[1]=b*l+_,e[5]=o*u,e[9]=x*l-w,e[2]=w*l-x,e[6]=a*u,e[10]=_*l+b);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,n=t._x,r=t._y,i=t._z,o=t._w,a=n+n,s=r+r,c=i+i,u=n*a,l=n*s,h=n*c,d=r*s,p=r*c,f=i*c,m=o*a,v=o*s,g=o*c;return e[0]=1-(d+f),e[4]=l-g,e[8]=h+v,e[1]=l+g,e[5]=1-(u+f),e[9]=p-m,e[2]=h-v,e[6]=p+m,e[10]=1-(u+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:(Qa=new ss,Ka=new ss,$a=new ss,function(t,e,n){var r=this.elements;return $a.subVectors(t,e),0===$a.lengthSq()&&($a.z=1),$a.normalize(),Qa.crossVectors(n,$a),0===Qa.lengthSq()&&(1===Math.abs(n.z)?$a.x+=1e-4:$a.z+=1e-4,$a.normalize(),Qa.crossVectors(n,$a)),Qa.normalize(),Ka.crossVectors($a,Qa),r[0]=Qa.x,r[4]=Ka.x,r[8]=$a.x,r[1]=Qa.y,r[5]=Ka.y,r[9]=$a.y,r[2]=Qa.z,r[6]=Ka.z,r[10]=$a.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],c=n[12],u=n[1],l=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],b=n[11],x=n[15],w=r[0],_=r[4],S=r[8],T=r[12],M=r[1],A=r[5],E=r[9],C=r[13],P=r[2],O=r[6],N=r[10],L=r[14],I=r[3],R=r[7],D=r[11],F=r[15];return i[0]=o*w+a*M+s*P+c*I,i[4]=o*_+a*A+s*O+c*R,i[8]=o*S+a*E+s*N+c*D,i[12]=o*T+a*C+s*L+c*F,i[1]=u*w+l*M+h*P+d*I,i[5]=u*_+l*A+h*O+d*R,i[9]=u*S+l*E+h*N+d*D,i[13]=u*T+l*C+h*L+d*F,i[2]=p*w+f*M+m*P+v*I,i[6]=p*_+f*A+m*O+v*R,i[10]=p*S+f*E+m*N+v*D,i[14]=p*T+f*C+m*L+v*F,i[3]=g*w+y*M+b*P+x*I,i[7]=g*_+y*A+b*O+x*R,i[11]=g*S+y*E+b*N+x*D,i[15]=g*T+y*C+b*L+x*F,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new ss;return function(e){for(var n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix4(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],c=t[13],u=t[2],l=t[6],h=t[10],d=t[14];return t[3]*(+i*s*l-r*c*l-i*a*h+n*c*h+r*a*d-n*s*d)+t[7]*(+e*s*d-e*c*h+i*o*h-r*o*d+r*c*u-i*s*u)+t[11]*(+e*c*l-e*a*d-i*o*l+n*o*d+i*a*u-n*c*u)+t[15]*(-r*a*u-e*s*l+e*a*h+r*o*l-n*o*h+n*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,r=t.elements,i=r[0],o=r[1],a=r[2],s=r[3],c=r[4],u=r[5],l=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],b=r[15],x=p*y*h-g*f*h+g*l*m-u*y*m-p*l*b+u*f*b,w=v*f*h-d*y*h-v*l*m+c*y*m+d*l*b-c*f*b,_=d*g*h-v*p*h+v*u*m-c*g*m-d*u*b+c*p*b,S=v*p*l-d*g*l-v*u*f+c*g*f+d*u*y-c*p*y,T=i*x+o*w+a*_+s*S;if(0===T){var M="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return n[0]=x*A,n[1]=(g*f*s-p*y*s-g*a*m+o*y*m+p*a*b-o*f*b)*A,n[2]=(u*y*s-g*l*s+g*a*h-o*y*h-u*a*b+o*l*b)*A,n[3]=(p*l*s-u*f*s-p*a*h+o*f*h+u*a*m-o*l*m)*A,n[4]=w*A,n[5]=(d*y*s-v*f*s+v*a*m-i*y*m-d*a*b+i*f*b)*A,n[6]=(v*l*s-c*y*s-v*a*h+i*y*h+c*a*b-i*l*b)*A,n[7]=(c*f*s-d*l*s+d*a*h-i*f*h-c*a*m+i*l*m)*A,n[8]=_*A,n[9]=(v*p*s-d*g*s-v*o*m+i*g*m+d*o*b-i*p*b)*A,n[10]=(c*g*s-v*u*s+v*o*h-i*g*h-c*o*b+i*u*b)*A,n[11]=(d*u*s-c*p*s-d*o*h+i*p*h+c*o*m-i*u*m)*A,n[12]=S*A,n[13]=(d*g*a-v*p*a+v*o*f-i*g*f-d*o*y+i*p*y)*A,n[14]=(v*u*a-c*g*a-v*o*l+i*g*l+c*o*y-i*u*y)*A,n[15]=(c*p*a-d*u*a+d*o*l-i*p*l-c*o*f+i*u*f)*A,this},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,c=i*o,u=i*a;return this.set(c*o+n,c*a-r*s,c*s+r*a,0,c*a+r*s,u*a+n,u*s-r*o,0,c*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){return this.makeRotationFromQuaternion(e),this.scale(n),this.setPosition(t),this},decompose:(Za=new ss,Ja=new as,function(t,e,n){var r=this.elements,i=Za.set(r[0],r[1],r[2]).length(),o=Za.set(r[4],r[5],r[6]).length(),a=Za.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Ja.copy(this);var s=1/i,c=1/o,u=1/a;return Ja.elements[0]*=s,Ja.elements[1]*=s,Ja.elements[2]*=s,Ja.elements[4]*=c,Ja.elements[5]*=c,Ja.elements[6]*=c,Ja.elements[8]*=u,Ja.elements[9]*=u,Ja.elements[10]*=u,e.setFromRotationMatrix(Ja),n.x=i,n.y=o,n.z=a,this}),makePerspective:function(t,e,n,r,i,o){void 0===o&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),l=-(o+i)/(o-i),h=-2*o*i/(o-i);return a[0]=2*i/(e-t),a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=s,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,n,r,i,o){var a=this.elements,s=1/(e-t),c=1/(n-r),u=1/(o-i),l=(e+t)*s,h=(n+r)*c,d=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}),Object.assign(ss.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(rs=new cs,function(t){return t&&t.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(rs.setFromEuler(t))}),applyAxisAngle:function(){var t=new cs;return function(e,n){return this.applyQuaternion(t.setFromAxisAngle(e,n))}}(),applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,c=s*e+o*r-a*n,u=s*n+a*e-i*r,l=s*r+i*n-o*e,h=-i*e-o*n-a*r;return this.x=c*s+h*-i+u*-a-l*-o,this.y=u*s+h*-o+l*-i-c*-a,this.z=l*s+h*-a+c*-o-u*-i,this},project:function(){var t=new as;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new as;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:(es=new ss,ns=new ss,function(t,e){return es.set(t,t,t),ns.set(e,e,e),this.clamp(es,ns)}),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return void 0!==e?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new ss;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new ss;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(os.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(cs,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,o,a){var s=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(l!==f||s!==h||c!==d||u!==p){var m=1-a,v=s*h+c*d+u*p+l*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,v*g);m=Math.sin(m*x)/b,a=Math.sin(a*x)/b}var w=a*g;if(s=s*m+h*w,c=c*m+d*w,u=u*m+p*w,l=l*m+f*w,m===1-a){var _=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=_,c*=_,u*=_,l*=_}}t[e]=s,t[e+1]=c,t[e+2]=u,t[e+3]=l}}),Object.defineProperties(cs.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(cs.prototype,{set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,o=t.order,a=Math.cos,s=Math.sin,c=a(n/2),u=a(r/2),l=a(i/2),h=s(n/2),d=s(r/2),p=s(i/2);return"XYZ"===o?(this._x=h*u*l+c*d*p,this._y=c*d*l-h*u*p,this._z=c*u*p+h*d*l,this._w=c*u*l-h*d*p):"YXZ"===o?(this._x=h*u*l+c*d*p,this._y=c*d*l-h*u*p,this._z=c*u*p-h*d*l,this._w=c*u*l+h*d*p):"ZXY"===o?(this._x=h*u*l-c*d*p,this._y=c*d*l+h*u*p,this._z=c*u*p+h*d*l,this._w=c*u*l-h*d*p):"ZYX"===o?(this._x=h*u*l-c*d*p,this._y=c*d*l+h*u*p,this._z=c*u*p-h*d*l,this._w=c*u*l+h*d*p):"YZX"===o?(this._x=h*u*l+c*d*p,this._y=c*d*l+h*u*p,this._z=c*u*p-h*d*l,this._w=c*u*l-h*d*p):"XZY"===o&&(this._x=h*u*l-c*d*p,this._y=c*d*l-h*u*p,this._z=c*u*p+h*d*l,this._w=c*u*l+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],c=n[9],u=n[2],l=n[6],h=n[10],d=r+s+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(l-c)*e,this._y=(o-u)*e,this._z=(a-i)*e):r>s&&r>h?(e=2*Math.sqrt(1+r-s-h),this._w=(l-c)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+u)/e):s>h?(e=2*Math.sqrt(1+s-r-h),this._w=(o-u)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(c+l)/e):(e=2*Math.sqrt(1+h-r-s),this._w=(a-i)/e,this._x=(o+u)/e,this._y=(c+l)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new ss;return function(n,r){return void 0===e&&(e=new ss),(t=n.dot(r)+1)<1e-6?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,c=e._z,u=e._w;return this._x=n*u+o*a+r*c-i*s,this._y=r*u+o*s+i*a-n*c,this._z=i*u+o*c+n*s-r*a,this._w=o*u-n*a-r*s-i*c,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var c=Math.atan2(s,a),u=Math.sin((1-e)*c)/s,l=Math.sin(e*c)/s;return this._w=o*u+this._w*l,this._x=n*u+this._x*l,this._y=r*u+this._y*l,this._z=i*u+this._z*l,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(us.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t)}}}}),ls.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ls.DefaultOrder="XYZ",Object.defineProperties(ls.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(ls.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=os.clamp,i=t.elements,o=i[0],a=i[4],s=i[8],c=i[1],u=i[5],l=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o))):"ZYX"===e?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===e?(this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new as;return function(e,n,r){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,n,r)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(is=new cs,function(t){return is.setFromEuler(this),this.setFromQuaternion(is,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new ss(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(hs.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(ds.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,o,a,s,c){var u=this.elements;return u[0]=t,u[1]=r,u[2]=a,u[3]=e,u[4]=i,u[5]=s,u[6]=n,u[7]=o,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new ss;return function(e){for(var n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix3(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],s=n[6],c=n[1],u=n[4],l=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],b=r[7],x=r[2],w=r[5],_=r[8];return i[0]=o*f+a*g+s*x,i[3]=o*m+a*y+s*w,i[6]=o*v+a*b+s*_,i[1]=c*f+u*g+l*x,i[4]=c*m+u*y+l*w,i[7]=c*v+u*b+l*_,i[2]=h*f+d*g+p*x,i[5]=h*m+d*y+p*w,i[8]=h*v+d*b+p*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8];return e*o*u-e*a*c-n*i*u+n*a*s+r*i*c-r*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=t.elements,r=this.elements,i=n[0],o=n[1],a=n[2],s=n[3],c=n[4],u=n[5],l=n[6],h=n[7],d=n[8],p=d*c-u*h,f=u*l-d*s,m=h*s-c*l,v=i*p+o*f+a*m;if(0===v){var g="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=p*y,r[1]=(a*h-d*o)*y,r[2]=(u*o-a*c)*y,r[3]=f*y,r[4]=(d*i-a*l)*y,r[5]=(a*s-u*i)*y,r[6]=m*y,r[7]=(o*l-h*i)*y,r[8]=(c*i-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,o,a){var s=Math.cos(i),c=Math.sin(i);this.set(n*s,n*c,-n*(s*o+c*a)+o+t,-r*c,r*s,-r*(-c*o+s*a)+a+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],c=r[4],u=r[7];return r[0]=e*i+n*s,r[3]=e*o+n*c,r[6]=e*a+n*u,r[1]=-n*i+e*s,r[4]=-n*o+e*c,r[7]=-n*a+e*u,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var ps,fs,ms,vs,gs=0;function ys(){Object.defineProperty(this,"id",{value:gs++}),this.uuid=os.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ys.DefaultUp.clone();var t=new ss,e=new ls,n=new cs,r=new ss(1,1,1);e.onChange(function(){n.setFromEuler(e,!1)}),n.onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new as},normalMatrix:{value:new ds}}),this.matrix=new as,this.matrixWorld=new as,this.matrixAutoUpdate=ys.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new hs,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}ys.DefaultUp=new ss(0,1,0),ys.DefaultMatrixAutoUpdate=!0,ys.prototype=Object.assign(Object.create(us.prototype),{constructor:ys,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(vs=new cs,function(t,e){return vs.setFromAxisAngle(t,e),this.quaternion.multiply(vs),this}),rotateOnWorldAxis:function(){var t=new cs;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new ss(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new ss(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new ss(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new ss;return function(e,n){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translateX:function(){var t=new ss(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new ss(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new ss(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(ms=new as,function(t){return t.applyMatrix4(ms.getInverse(this.matrixWorld))}),lookAt:function(){var t=new as,e=new ss;return function(n,r,i){n.isVector3?e.copy(n):e.set(n,r,i),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){var e=arguments;if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(e[n]);return this}return t===this?(console.error("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("Object3D.add: object not an instance of Object3D.",t),this)},remove:function(t){var e=arguments;if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.remove(e[n]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("Object3D: .getWorldPosition() target is now required"),t=new ss),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(ps=new ss,fs=new ss,function(t){return void 0===t&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),t=new cs),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ps,t,fs),t}),getWorldScale:function(){var t=new ss,e=new cs;return function(n){return void 0===n&&(console.warn("Object3D: .getWorldScale() target is now required"),n=new ss),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,n),n}}(),getWorldDirection:function(){var t=new cs;return function(e){return void 0===e&&(console.warn("Object3D: .getWorldDirection() target is now required"),e=new ss),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.matrix=this.matrix.toArray(),void 0!==this.geometry){r.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,c=a.length;s<c;s++)i(t.shapes,a[s]);else i(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(s=0,c=this.material.length;s<c;s++)u.push(i(t.materials,this.material[s]));r.material=u}else r.material=i(t.materials,this.material);if(this.children.length>0)for(r.children=[],s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(t).object);if(e){var l=f(t.geometries),h=f(t.materials),d=f(t.textures),p=f(t.images);a=f(t.shapes),l.length>0&&(n.geometries=l),h.length>0&&(n.materials=h),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),a.length>0&&(n.shapes=a)}return n.object=r,n;function f(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++)this.add(t.children[n].clone());return this}});var bs,xs,ws,_s,Ss={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ts(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function Ms(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new ss,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new Ts,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}function As(t,e){this.min=void 0!==t?t:new ss(1/0,1/0,1/0),this.max=void 0!==e?e:new ss(-1/0,-1/0,-1/0)}function Es(t,e){this.center=void 0!==t?t:new ss,this.radius=void 0!==e?e:0}function Cs(t,e){this.x=t||0,this.y=e||0}Object.assign(Ts.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(){function t(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}return function(e,n,r){if(e=os.euclideanModulo(e,1),n=os.clamp(n,0,1),r=os.clamp(r,0,1),0===n)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+n):r+n-r*n,o=2*r-i;this.r=t(o,i,e+1/3),this.g=t(o,i,e),this.b=t(o,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,i=n[2];switch(n[1]){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(r[1])/360,a=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(o,a,s)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c,u=(c=n[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&t.length>0&&(void 0!==(c=Ss[t])?this.setHex(c):console.warn("Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(){var t=this.r,e=this.g,n=this.b;return this.r=t*t,this.g=e*e,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),c=(s+a)/2;if(s===a)e=0,n=0;else{var u=a-s;switch(n=c<=.5?u/(a+s):u/(2-a-s),a){case r:e=(i-o)/u+(i<o?6:0);break;case i:e=(o-r)/u+2;break;case o:e=(r-i)/u+4}e/=6}return t.h=e,t.s=n,t.l=c,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(bs={},function(t,e,n){return this.getHSL(bs),bs.h+=t,bs.s+=e,bs.l+=n,this.setHSL(bs.h,bs.s,bs.l),this}),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),Object.assign(Ms.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}),Object.assign(As.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=t.length;s<c;s+=3){var u=t[s],l=t[s+1],h=t[s+2];u<e&&(e=u),l<n&&(n=l),h<r&&(r=h),u>i&&(i=u),l>o&&(o=l),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=t.count;s<c;s++){var u=t.getX(s),l=t.getY(s),h=t.getZ(s);u<e&&(e=u),l<n&&(n=l),h<r&&(r=h),u>i&&(i=u),l>o&&(o=l),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new ss;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("Box3: .getCenter() target is now required"),t=new ss),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("Box3: .getSize() target is now required"),t=new ss),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,n,r=new ss;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(e=0,n=a.length;e<n;e++)r.copy(a[e]),r.applyMatrix4(i.matrixWorld),t.expandByPoint(r)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(e=0,n=s.count;e<n;e++)r.fromBufferAttribute(s,e).applyMatrix4(i.matrixWorld),t.expandByPoint(r)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(i),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("Box3: .getParameter() target is now required"),e=new ss),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(ws=new ss,function(t){return this.clampPoint(t.center,ws),ws.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=t.constant&&n>=t.constant},intersectsTriangle:function(){var t=new ss,e=new ss,n=new ss,r=new ss,i=new ss,o=new ss,a=new ss,s=new ss,c=new ss,u=new ss;function l(r){var i,o;for(i=0,o=r.length-3;i<=o;i+=3){a.fromArray(r,i);var s=c.x*Math.abs(a.x)+c.y*Math.abs(a.y)+c.z*Math.abs(a.z),u=t.dot(a),l=e.dot(a),h=n.dot(a);if(Math.max(-Math.max(u,l,h),Math.min(u,l,h))>s)return!1}return!0}return function(a){if(this.isEmpty())return!1;this.getCenter(s),c.subVectors(this.max,s),t.subVectors(a.a,s),e.subVectors(a.b,s),n.subVectors(a.c,s),r.subVectors(e,t),i.subVectors(n,e),o.subVectors(t,n);var h=[0,-r.z,r.y,0,-i.z,i.y,0,-o.z,o.y,r.z,0,-r.x,i.z,0,-i.x,o.z,0,-o.x,-r.y,r.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!l(h)&&!!l(h=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(r,i),l(h=[u.x,u.y,u.z]))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("Box3: .clampPoint() target is now required"),e=new ss),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new ss;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new ss;return function(e){return void 0===e&&(console.warn("Box3: .getBoundingSphere() target is now required"),e=new Es),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(xs=[new ss,new ss,new ss,new ss,new ss,new ss,new ss,new ss],function(t){return this.isEmpty()?this:(xs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),xs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),xs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),xs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),xs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),xs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),xs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),xs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(xs),this)}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Es.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(_s=new As,function(t,e){var n=this.center;void 0!==e?n.copy(e):_s.setFromPoints(t).getCenter(n);for(var r=0,i=0,o=t.length;i<o;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("Sphere: .clampPoint() target is now required"),e=new ss),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("Sphere: .getBoundingBox() target is now required"),t=new As),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.defineProperties(Cs.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Cs.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new Cs,e=new Cs;return function(n,r){return t.set(n,n),e.set(r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}});var Ps,Os,Ns=0;function Ls(){Object.defineProperty(this,"id",{value:Ns+=2}),this.uuid=os.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Is(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1}function Rs(t,e,n){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Ds(t,e,n){Rs.call(this,new Int8Array(t),e,n)}function Fs(t,e,n){Rs.call(this,new Uint8Array(t),e,n)}function Us(t,e,n){Rs.call(this,new Uint8ClampedArray(t),e,n)}function ks(t,e,n){Rs.call(this,new Int16Array(t),e,n)}function js(t,e,n){Rs.call(this,new Uint16Array(t),e,n)}function Bs(t,e,n){Rs.call(this,new Int32Array(t),e,n)}function zs(t,e,n){Rs.call(this,new Uint32Array(t),e,n)}function Vs(t,e,n){Rs.call(this,new Float32Array(t),e,n)}function Gs(t,e,n){Rs.call(this,new Float64Array(t),e,n)}function Hs(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Ls.prototype=Object.assign(Object.create(us.prototype),{constructor:Ls,isGeometry:!0,applyMatrix:function(t){for(var e=(new ds).getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(t);for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(e).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new as;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new as;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new as;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new as;return function(e,n,r){return t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new as;return function(e,n,r){return t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:(Os=new ys,function(t){Os.lookAt(t),Os.updateMatrix(),this.applyMatrix(Os.matrix)}),fromBufferGeometry:function(t){var e=this,n=null!==t.index?t.index.array:void 0,r=t.attributes,i=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,c=void 0!==r.uv2?r.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=[],l=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)e.vertices.push(new ss(i[d],i[d+1],i[d+2])),void 0!==o&&u.push(new ss(o[d],o[d+1],o[d+2])),void 0!==a&&e.colors.push(new Ts(a[d],a[d+1],a[d+2])),void 0!==s&&l.push(new Cs(s[p],s[p+1])),void 0!==c&&h.push(new Cs(c[p],c[p+1]));function f(t,n,r,i){var d=new Ms(t,n,r,void 0!==o?[u[t].clone(),u[n].clone(),u[r].clone()]:[],void 0!==a?[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()]:[],i);e.faces.push(d),void 0!==s&&e.faceVertexUvs[0].push([l[t].clone(),l[n].clone(),l[r].clone()]),void 0!==c&&e.faceVertexUvs[1].push([h[t].clone(),h[n].clone(),h[r].clone()])}var m=t.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==n?f(n[p],n[p+1],n[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==n)for(d=0;d<n.length;d+=3)f(n[d],n[d+1],n[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:(Ps=new ss,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ps).negate(),this.translate(Ps.x,Ps.y,Ps.z),this}),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new as;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new ss,e=new ss,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,n,r,i,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)a[e]=new ss;if(t){var s,c,u=new ss,l=new ss;for(r=0,i=this.faces.length;r<i;r++)s=this.vertices[(o=this.faces[r]).a],u.subVectors(this.vertices[o.c],c=this.vertices[o.b]),l.subVectors(s,c),u.cross(l),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,n=this.vertices.length;e<n;e++)a[e].normalize();for(r=0,i=this.faces.length;r<i;r++){var h=(o=this.faces[r]).vertexNormals;3===h.length?(h[0].copy(a[o.a]),h[1].copy(a[o.b]),h[2].copy(a[o.c])):(h[0]=a[o.a].clone(),h[1]=a[o.b].clone(),h[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,n;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var r=(n=this.faces[t]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new Ls;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)c=new ss,u={a:new ss,b:new ss,c:new ss},a.push(c),s.push(u)}var c,u,l=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)u=l.vertexNormals[n],(c=l.faceNormals[n]).copy((i=this.faces[n]).normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new As),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Es),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t&&t.isGeometry){var r,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,c=t.faces,u=this.faceVertexUvs[0],l=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===n&&(n=0),void 0!==e&&(r=(new ds).getNormalMatrix(e));for(var p=0,f=a.length;p<f;p++){var m=a[p].clone();void 0!==e&&m.applyMatrix4(e),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=c.length;p<f;p++){var v,g,y=c[p],b=y.vertexNormals,x=y.vertexColors;(v=new Ms(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==r&&v.normal.applyMatrix3(r).normalize();for(var w=0,_=b.length;w<_;w++)g=b[w].clone(),void 0!==r&&g.applyMatrix3(r).normalize(),v.vertexNormals.push(g);for(v.color.copy(y.color),w=0,_=x.length;w<_;w++)v.vertexColors.push(x[w].clone());v.materialIndex=y.materialIndex+n,s.push(v)}for(p=0,f=l.length;p<f;p++){var S=l[p],T=[];if(void 0!==S){for(w=0,_=S.length;w<_;w++)T.push(S[w].clone());u.push(T)}}}else console.error("Geometry.merge(): geometry not an instance of Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("Geometry.mergeMesh(): mesh not an instance of Mesh.",t)},mergeVertices:function(){var t,e,n,r,i,o,a,s,c={},u=[],l=[],h=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)t=this.vertices[n],void 0===c[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(c[e]=n,u.push(this.vertices[n]),l[n]=u.length-1):l[n]=l[c[e]];var d=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=l[i.a],i.b=l[i.b],i.c=l[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var f=d[n];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new ss(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===e&&(r=[]),a&&a.length===e&&(i=[]),n=0;n<e;n++){var s=t[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var a=[],s=[],c={},u=[],l={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=S(b=S(b=S(b=S(b=S(b=S(b=S(b=S(b,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),a.push(b),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var x=this.faceVertexUvs[0][i];a.push(A(x[0]),A(x[1]),A(x[2]))}if(m&&a.push(T(p.normal)),v){var w=p.vertexNormals;a.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&a.push(M(p.color)),y){var _=p.vertexColors;a.push(M(_[0]),M(_[1]),M(_[2]))}}function S(t,e,n){return n?t|1<<e:t&~(1<<e)}function T(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==c[e]?c[e]:(c[e]=s.length/3,s.push(t.x,t.y,t.z),c[e])}function M(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==l[e]?l[e]:(l[e]=u.length,u.push(t.getHex()),l[e])}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=r,t.data.normals=s,u.length>0&&(t.data.colors=u),h.length>0&&(t.data.uvs=[h]),t.data.faces=a,t},clone:function(){return(new Ls).copy(this)},copy:function(t){var e,n,r,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,n=s.length;e<n;e++)this.vertices.push(s[e].clone());var c=t.colors;for(e=0,n=c.length;e<n;e++)this.colors.push(c[e].clone());var u=t.faces;for(e=0,n=u.length;e<n;e++)this.faces.push(u[e].clone());for(e=0,n=t.faceVertexUvs.length;e<n;e++){var l=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),r=0,i=l.length;r<i;r++){var h=l[r],d=[];for(o=0,a=h.length;o<a;o++)d.push(h[o].clone());this.faceVertexUvs[e].push(d)}}var p=t.morphTargets;for(e=0,n=p.length;e<n;e++){var f={};if(f.name=p[e].name,void 0!==p[e].vertices)for(f.vertices=[],r=0,i=p[e].vertices.length;r<i;r++)f.vertices.push(p[e].vertices[r].clone());if(void 0!==p[e].normals)for(f.normals=[],r=0,i=p[e].normals.length;r<i;r++)f.normals.push(p[e].normals[r].clone());this.morphTargets.push(f)}var m=t.morphNormals;for(e=0,n=m.length;e<n;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],r=0,i=m[e].vertexNormals.length;r<i;r++){var g=m[e].vertexNormals[r],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],r=0,i=m[e].faceNormals.length;r<i;r++)v.faceNormals.push(m[e].faceNormals[r].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,n=b.length;e<n;e++)this.skinWeights.push(b[e].clone());var x=t.skinIndices;for(e=0,n=x.length;e<n;e++)this.skinIndices.push(x[e].clone());var w=t.lineDistances;for(e=0,n=w.length;e<n;e++)this.lineDistances.push(w[e]);var _=t.boundingBox;null!==_&&(this.boundingBox=_.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(Is.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,i,o=t.elements,a=o[0],s=o[4],c=o[8],u=o[1],l=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-u)<.01&&Math.abs(c-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+u)<.1&&Math.abs(c+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+l+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(a+1)/2,v=(l+1)/2,g=(f+1)/2,y=(s+u)/4,b=(c+d)/4,x=(h+p)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=b/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=x/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=b/(i=Math.sqrt(g)),r=x/i),this.set(n,r,i,e),this}var w=Math.sqrt((p-h)*(p-h)+(c-d)*(c-d)+(u-s)*(u-s));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(c-d)/w,this.z=(u-s)/w,this.w=Math.acos((a+l+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new Is,e=new Is),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),Object.defineProperty(Rs.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Rs.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",r),o=new Ts),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Cs),e[n++]=o.x,e[n++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new ss),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Is),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(Ds.prototype=Object.create(Rs.prototype)).constructor=Ds,(Fs.prototype=Object.create(Rs.prototype)).constructor=Fs,(Us.prototype=Object.create(Rs.prototype)).constructor=Us,(ks.prototype=Object.create(Rs.prototype)).constructor=ks,(js.prototype=Object.create(Rs.prototype)).constructor=js,(Bs.prototype=Object.create(Rs.prototype)).constructor=Bs,(zs.prototype=Object.create(Rs.prototype)).constructor=zs,(Vs.prototype=Object.create(Rs.prototype)).constructor=Vs,(Gs.prototype=Object.create(Rs.prototype)).constructor=Gs,Object.assign(Hs.prototype,{computeGroups:function(t){for(var e,n=[],r=void 0,i=t.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,n.push(e)),e={start:3*o,materialIndex:r})}void 0!==e&&(e.count=3*o-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e,n=t.faces,r=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=t.morphTargets,c=s.length;if(c>0){e=[];for(var u=0;u<c;u++)e[u]=[];this.morphTargets.position=e}var l,h=t.morphNormals,d=h.length;if(d>0){for(l=[],u=0;u<d;u++)l[u]=[];this.morphTargets.normal=l}var p=t.skinIndices,f=t.skinWeights,m=p.length===r.length,v=f.length===r.length;for(u=0;u<n.length;u++){var g=n[u];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=g.normal;this.normals.push(b,b,b)}var x,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}!0===o&&(void 0!==(x=i[0][u])?this.uvs.push(x[0],x[1],x[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Cs,new Cs,new Cs))),!0===a&&(void 0!==(x=i[1][u])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Cs,new Cs,new Cs)));for(var S=0;S<c;S++){var T=s[S].vertices;e[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[u];l[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Ws=1;function Xs(){Object.defineProperty(this,"id",{value:Ws+=2}),this.uuid=os.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function qs(t,e,n,r,i,o,a){Ls.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Ys(t,e,n,r,i,o,a)),this.mergeVertices()}function Ys(t,e,n,r,i,o,a){Xs.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var s,c,u=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),l=0,h=[],d=new ss,p=new ss,f=[],m=[],v=[],g=[];for(c=0;c<=n;c++){var y=[],b=c/n;for(s=0;s<=e;s++){var x=s/e;d.x=-t*Math.cos(r+x*i)*Math.sin(o+b*a),d.y=t*Math.cos(o+b*a),d.z=t*Math.sin(r+x*i)*Math.sin(o+b*a),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(x,1-b),y.push(l++)}h.push(y)}for(c=0;c<n;c++)for(s=0;s<e;s++){var w=h[c][s],_=h[c+1][s],S=h[c+1][s+1];(0!==c||o>0)&&f.push(h[c][s+1],w,S),(c!==n-1||u<Math.PI)&&f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new Vs(m,3)),this.addAttribute("normal",new Vs(v,3)),this.addAttribute("uv",new Vs(g,2))}Xs.prototype=Object.assign(Object.create(us.prototype),{constructor:Xs,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){this.index=Array.isArray(t)?new(function(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}(t)>65535?zs:js)(t,1):t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new Rs(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var n=this.attributes.normal;return void 0!==n&&((new ds).getNormalMatrix(t).applyToBufferAttribute(n),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new as;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new as;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new as;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new as;return function(e,n,r){return t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new as;return function(e,n,r){return t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t=new ys;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new ss;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var n=new Vs(3*e.vertices.length,3),r=new Vs(3*e.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(e.vertices)),this.addAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new Vs(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Vs(e,3)),this},updateFromObject:function(t){var e,n=t.geometry;if(t.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(n.vertices),e.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(n.normals),e.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(n.colors),e.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(n.uvs),e.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(n.lineDistances),e.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Hs).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new Rs(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.addAttribute("normal",new Rs(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(3*t.colors.length);this.addAttribute("color",new Rs(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new Rs(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new Rs(o,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var s=[],c=t.morphTargets[a],u=0,l=c.length;u<l;u++){var h=c[u],d=new Vs(3*h.length,3);s.push(d.copyVector3sArray(h))}this.morphAttributes[a]=s}if(t.skinIndices.length>0){var p=new Vs(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new Vs(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new As);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new As,e=new ss;return function(){null===this.boundingSphere&&(this.boundingSphere=new Es);var n=this.attributes.position;if(n){var r=this.boundingSphere.center;t.setFromBufferAttribute(n),t.getCenter(r);for(var i=0,o=0,a=n.count;o<a;o++)e.x=n.getX(o),e.y=n.getY(o),e.z=n.getZ(o),i=Math.max(i,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,n=this.groups;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new Rs(new Float32Array(r.length),3));else for(var i=e.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;var s,c,u,l=e.normal.array,h=new ss,d=new ss,p=new ss,f=new ss,m=new ss;if(t){var v=t.array;0===n.length&&this.addGroup(0,v.length);for(var g=0,y=n.length;g<y;++g){var b=n[g],x=b.start;for(o=x,a=x+b.count;o<a;o+=3)c=3*v[o+1],u=3*v[o+2],h.fromArray(r,s=3*v[o+0]),d.fromArray(r,c),p.fromArray(r,u),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),l[s]+=f.x,l[s+1]+=f.y,l[s+2]+=f.z,l[c]+=f.x,l[c+1]+=f.y,l[c+2]+=f.z,l[u]+=f.x,l[u+1]+=f.y,l[u+2]+=f.z}}else for(o=0,a=r.length;o<a;o+=9)h.fromArray(r,o),d.fromArray(r,o+3),p.fromArray(r,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),l[o]=f.x,l[o+1]=f.y,l[o+2]=f.z,l[o+3]=f.x,l[o+4]=f.y,l[o+5]=f.z,l[o+6]=f.x,l[o+7]=f.y,l[o+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var i=n[r].array,o=t.attributes[r],a=o.array,s=0,c=o.itemSize*e;s<a.length;s++,c++)i[c]=a[s];return this}console.error("BufferGeometry.merge(): geometry not an instance of BufferGeometry.",t)},normalizeNormals:function(){var t=new ss;return function(){for(var e=this.attributes.normal,n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.normalize(),e.setXYZ(n,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Xs,e=this.index.array,n=this.attributes;for(var r in n){for(var i=n[r],o=i.array,a=i.itemSize,s=new o.constructor(e.length*a),c=0,u=0,l=0,h=e.length;l<h;l++){c=e[l]*a;for(var d=0;d<a;d++)s[u++]=o[c++]}t.addAttribute(r,new Rs(s,a))}var p=this.groups;for(l=0,h=p.length;l<h;l++){var f=p[l];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;if(null!==r){var i=Array.prototype.slice.call(r.array);t.data.index={type:r.array.constructor.name,array:i}}var o=this.attributes;for(var n in o){var a=o[n];i=Array.prototype.slice.call(a.array),t.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:i,normalized:a.normalized}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var c=this.boundingSphere;return null!==c&&(t.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),t},clone:function(){return(new Xs).copy(this)},copy:function(t){var e,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o)this.addAttribute(e,o[e].clone());var a=t.morphAttributes;for(e in a){var s=[],c=a[e];for(n=0,r=c.length;n<r;n++)s.push(c[n].clone());this.morphAttributes[e]=s}var u=t.groups;for(n=0,r=u.length;n<r;n++){var l=u[n];this.addGroup(l.start,l.count,l.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(qs.prototype=Object.create(Ls.prototype)).constructor=qs,(Ys.prototype=Object.create(Xs.prototype)).constructor=Ys;var Zs,Js,Qs,Ks,$s,tc,ec,nc,rc,ic,oc,ac,sc=0,cc=1,uc=2,lc=0,hc=1,dc=2,pc=1,fc=100,mc=204,vc=205,gc=3,yc=0,bc=301,xc=303,wc=305,_c=1e3,Sc=1001,Tc=1002,Mc=1003,Ac=1006,Ec=1008,Cc=1009,Pc=1012,Oc=1020,Nc=1022,Lc=1023,Ic=Lc,Rc=1026,Dc=1027,Fc=2201,Uc=2300,kc=2400,jc=0,Bc=1,zc=2,Vc=3e3,Gc=3200,Hc=0;function Wc(){Object.defineProperty(this,"id",{value:Hc++}),this.uuid=os.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=pc,this.side=sc,this.flatShading=!1,this.vertexColors=lc,this.opacity=1,this.transparent=!1,this.blendSrc=mc,this.blendDst=vc,this.blendEquation=fc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=gc,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Xc(t){Wc.call(this),this.type="MeshBasicMaterial",this.color=new Ts(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function qc(t){Wc.call(this),this.type="LineBasicMaterial",this.color=new Ts(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function Yc(t,e){this.origin=void 0!==t?t:new ss,this.direction=void 0!==e?e:new ss}function Zc(t,e){this.start=void 0!==t?t:new ss,this.end=void 0!==e?e:new ss}function Jc(t,e){this.normal=void 0!==t?t:new ss(1,0,0),this.constant=void 0!==e?e:0}function Qc(t,e,n){this.a=void 0!==t?t:new ss,this.b=void 0!==e?e:new ss,this.c=void 0!==n?n:new ss}function Kc(t,e){ys.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Xs,this.material=void 0!==e?e:new Xc({color:16777215*Math.random()}),this.drawMode=jc,this.updateMorphTargets()}function $c(t,e,n){1===n&&console.error("Line: parameter LinePieces no longer supported. Created LineSegments instead."),ys.call(this),this.type="Line",this.geometry=void 0!==t?t:new Xs,this.material=void 0!==e?e:new qc({color:16777215*Math.random()})}Wc.prototype=Object.assign(Object.create(us.prototype),{constructor:Wc,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n)if("shading"!==e){var r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]="overdraw"===e?Number(n):n:console.warn(this.type+": '"+e+"' is not a property of this material.")}else console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==pc&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==sc&&(n.side=this.side),this.vertexColors!==lc&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){var i=r(t.textures),o=r(t.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,n=null;if(null!==e){var r=e.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Xc.prototype=Object.create(Wc.prototype)).constructor=Xc,Xc.prototype.isMeshBasicMaterial=!0,Xc.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},(qc.prototype=Object.create(Wc.prototype)).constructor=qc,qc.prototype.isLineBasicMaterial=!0,qc.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},Object.assign(Yc.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("Ray: .at() target is now required"),e=new ss),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new ss;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("Ray: .closestPointToPoint() target is now required"),e=new ss),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new ss;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:(Js=new ss,Qs=new ss,Ks=new ss,function(t,e,n,r){Js.copy(t).add(e).multiplyScalar(.5),Qs.copy(e).sub(t).normalize(),Ks.copy(this.origin).sub(Js);var i,o,a,s,c=.5*t.distanceTo(e),u=-this.direction.dot(Qs),l=Ks.dot(this.direction),h=-Ks.dot(Qs),d=Ks.lengthSq(),p=Math.abs(1-u*u);if(p>0)if(o=u*l-h,s=c*p,(i=u*h-l)>=0)if(o>=-s)if(o<=s){var f=1/p;a=(i*=f)*(i+u*(o*=f)+2*l)+o*(u*i+o+2*h)+d}else o=c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+d;else o=-c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+d;else o<=-s?a=-(i=Math.max(0,-(-u*c+l)))*i+(o=i>0?-c:Math.min(Math.max(-c,-h),c))*(o+2*h)+d:o<=s?(i=0,a=(o=Math.min(Math.max(-c,-h),c))*(o+2*h)+d):a=-(i=Math.max(0,-(u*c+l)))*i+(o=i>0?c:Math.min(Math.max(-c,-h),c))*(o+2*h)+d;else o=u>0?-c:c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Qs).multiplyScalar(o).add(Js),a}),intersectSphere:function(){var t=new ss;return function(e,n){t.subVectors(e.center,this.origin);var r=t.dot(this.direction),i=t.dot(t)-r*r,o=e.radius*e.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=r-a,c=r+a;return s<0&&c<0?null:this.at(s<0?c:s,n)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var n,r,i,o,a,s,c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,h=this.origin;return c>=0?(n=(t.min.x-h.x)*c,r=(t.max.x-h.x)*c):(n=(t.max.x-h.x)*c,r=(t.min.x-h.x)*c),u>=0?(i=(t.min.y-h.y)*u,o=(t.max.y-h.y)*u):(i=(t.max.y-h.y)*u,o=(t.min.y-h.y)*u),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),l>=0?(a=(t.min.z-h.z)*l,s=(t.max.z-h.z)*l):(a=(t.max.z-h.z)*l,s=(t.min.z-h.z)*l),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))},intersectsBox:(Zs=new ss,function(t){return null!==this.intersectBox(t,Zs)}),intersectTriangle:function(){var t=new ss,e=new ss,n=new ss,r=new ss;return function(i,o,a,s,c){e.subVectors(o,i),n.subVectors(a,i),r.crossVectors(e,n);var u,l=this.direction.dot(r);if(l>0){if(s)return null;u=1}else{if(!(l<0))return null;u=-1,l=-l}t.subVectors(this.origin,i);var h=u*this.direction.dot(n.crossVectors(t,n));if(h<0)return null;var d=u*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>l)return null;var p=-u*t.dot(r);return p<0?null:this.at(p/l,c)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Zc.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("Line3: .getCenter() target is now required"),t=new ss),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("Line3: .delta() target is now required"),t=new ss),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("Line3: .at() target is now required"),e=new ss),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:($s=new ss,tc=new ss,function(t,e){$s.subVectors(t,this.start),tc.subVectors(this.end,this.start);var n=tc.dot(tc),r=tc.dot($s)/n;return e&&(r=os.clamp(r,0,1)),r}),closestPointToPoint:function(t,e,n){var r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("Line3: .closestPointToPoint() target is now required"),n=new ss),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(Jc.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new ss,e=new ss;return function(n,r,i){var o=t.subVectors(i,r).cross(e.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("Plane: .projectPoint() target is now required"),e=new ss),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new ss;return function(e,n){void 0===n&&(console.warn("Plane: .intersectLine() target is now required"),n=new ss);var r=e.delta(t),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?n.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:n.copy(r).multiplyScalar(o).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("Plane: .coplanarPoint() target is now required"),t=new ss),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new ss,e=new ds;return function(n,r){var i=r||e.getNormalMatrix(n),o=this.coplanarPoint(t).applyMatrix4(n),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(Qc,{getNormal:(ec=new ss,function(t,e,n,r){void 0===r&&(console.warn("Triangle: .getNormal() target is now required"),r=new ss),r.subVectors(n,e),ec.subVectors(t,e),r.cross(ec);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}),getBarycoord:function(){var t=new ss,e=new ss,n=new ss;return function(r,i,o,a,s){t.subVectors(a,i),e.subVectors(o,i),n.subVectors(r,i);var c=t.dot(t),u=t.dot(e),l=t.dot(n),h=e.dot(e),d=e.dot(n),p=c*h-u*u;if(void 0===s&&(console.warn("Triangle: .getBarycoord() target is now required"),s=new ss),0===p)return s.set(-2,-1,-1);var f=1/p,m=(h*l-u*d)*f,v=(c*d-u*l)*f;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var t=new ss;return function(e,n,r,i){return Qc.getBarycoord(e,n,r,i,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}()}),Object.assign(Qc.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new ss,e=new ss;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("Triangle: .getMidpoint() target is now required"),t=new ss),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Qc.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("Triangle: .getPlane() target is now required"),t=new ss),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Qc.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Qc.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new Jc,e=[new Zc,new Zc,new Zc],n=new ss,r=new ss;return function(i,o){void 0===o&&(console.warn("Triangle: .closestPointToPoint() target is now required"),o=new ss);var a=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(i,n),!0===this.containsPoint(n))o.copy(n);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var s=0;s<e.length;s++){e[s].closestPointToPoint(n,!0,r);var c=n.distanceToSquared(r);c<a&&(a=c,o.copy(r))}}return o}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Kc.prototype=Object.assign(Object.create(ys.prototype),{constructor:Kc,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return ys.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)n=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{var s=r.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)n=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}},raycast:function(){var t=new as,e=new Yc,n=new Es,r=new ss,i=new ss,o=new ss,a=new ss,s=new ss,c=new ss,u=new Cs,l=new Cs,h=new Cs,d=new ss,p=new ss,f=new ss;function m(t,e,n,r,i,o,a){return Qc.getBarycoord(t,e,n,r,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),a.multiplyScalar(d.z),i.add(o).add(a),i.clone()}function v(t,e,n,r,i,o,a,s){if(null===(e.side===cc?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,e.side!==uc,s)))return null;f.copy(s),f.applyMatrix4(t.matrixWorld);var c=n.ray.origin.distanceTo(f);return c<n.near||c>n.far?null:{distance:c,point:f.clone(),object:t}}function g(t,e,n,a,s,c,d,f){r.fromBufferAttribute(a,c),i.fromBufferAttribute(a,d),o.fromBufferAttribute(a,f);var g=v(t,t.material,e,n,r,i,o,p);if(g){s&&(u.fromBufferAttribute(s,c),l.fromBufferAttribute(s,d),h.fromBufferAttribute(s,f),g.uv=m(p,r,i,o,u,l,h));var y=new Ms(c,d,f);Qc.getNormal(r,i,o,y.normal),g.face=y,g.faceIndex=c}return g}return function(d,f){var y,b=this.geometry,x=this.material,w=this.matrixWorld;if(void 0!==x&&(null===b.boundingSphere&&b.computeBoundingSphere(),n.copy(b.boundingSphere),n.applyMatrix4(w),!1!==d.ray.intersectsSphere(n)&&(t.getInverse(w),e.copy(d.ray).applyMatrix4(t),null===b.boundingBox||!1!==e.intersectsBox(b.boundingBox))))if(b.isBufferGeometry){var _,S,T,M,A,E=b.index,C=b.attributes.position,P=b.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(y=g(this,d,e,C,P,_,S,T))&&(y.faceIndex=Math.floor(M/3),f.push(y));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(y=g(this,d,e,C,P,_=M,S=M+1,T=M+2))&&(y.index=_,f.push(y))}else if(b.isGeometry){var O,N,L,I,R=Array.isArray(x),D=b.vertices,F=b.faces,U=b.faceVertexUvs[0];U.length>0&&(I=U);for(var k=0,j=F.length;k<j;k++){var B=F[k],z=R?x[B.materialIndex]:x;if(void 0!==z){if(O=D[B.a],N=D[B.b],L=D[B.c],!0===z.morphTargets){var V=b.morphTargets,G=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var q=V[H].vertices;r.addScaledVector(a.subVectors(q[B.a],O),X),i.addScaledVector(s.subVectors(q[B.b],N),X),o.addScaledVector(c.subVectors(q[B.c],L),X)}}r.add(O),i.add(N),o.add(L),O=r,N=i,L=o}if(y=v(this,z,d,e,O,N,L,p)){if(I&&I[k]){var Y=I[k];u.copy(Y[0]),l.copy(Y[1]),h.copy(Y[2]),y.uv=m(p,O,N,L,u,l,h)}y.face=B,y.faceIndex=k,f.push(y)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),$c.prototype=Object.assign(Object.create(ys.prototype),{constructor:$c,isLine:!0,computeLineDistances:(oc=new ss,ac=new ss,function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)oc.fromBufferAttribute(e,r-1),ac.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=oc.distanceTo(ac);t.addAttribute("lineDistance",new Vs(n,1))}else console.error("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;for((n=t.lineDistances)[0]=0,r=1,i=o.length;r<i;r++)n[r]=n[r-1],n[r]+=o[r-1].distanceTo(o[r])}return this}),raycast:(nc=new as,rc=new Yc,ic=new Es,function(t,e){var n=t.linePrecision,r=n*n,i=this.geometry,o=this.matrixWorld;if(null===i.boundingSphere&&i.computeBoundingSphere(),ic.copy(i.boundingSphere),ic.applyMatrix4(o),!1!==t.ray.intersectsSphere(ic)){nc.getInverse(o),rc.copy(t.ray).applyMatrix4(nc);var a=new ss,s=new ss,c=new ss,u=new ss,l=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var h=i.index,d=i.attributes.position.array;if(null!==h)for(var p=h.array,f=0,m=p.length-1;f<m;f+=l){var v=p[f+1];a.fromArray(d,3*p[f]),s.fromArray(d,3*v),rc.distanceSqToSegment(a,s,u,c)>r||(u.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(u))<t.near||b>t.far||e.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else for(f=0,m=d.length/3-1;f<m;f+=l)a.fromArray(d,3*f),s.fromArray(d,3*f+3),rc.distanceSqToSegment(a,s,u,c)>r||(u.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(u))<t.near||b>t.far||e.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else if(i.isGeometry){var g=i.vertices,y=g.length;for(f=0;f<y-1;f+=l){var b;rc.distanceSqToSegment(g[f],g[f+1],u,c)>r||(u.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(u))<t.near||b>t.far||e.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}}}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var tu=function(t){this.mesh=t,this._valid()};tu.prototype={constructor:tu,_valid:function(){for(var t=this.mesh.geometry.iks,e=this.mesh.skeleton.bones,n=0,r=t.length;n<r;n++){var i,o,a=t[n],s=a.links;i=e[a.effector];for(var c=0,u=s.length;c<u;c++)i.parent!==(o=e[s[c].index])&&console.warn("CCDIKSolver: bone "+i.name+" is not the child of bone "+o.name),i=o}},_saveOriginalBonesInfo:function(){for(var t=this.mesh.skeleton.bones,e=0,n=t.length;e<n;e++){var r=t[e];void 0===r.userData.ik&&(r.userData.ik={}),r.userData.ik.originalMatrix=r.matrix.toArray()}},update:function(t){var e=new cs,n=new ss,r=new ss,i=new ss,o=new ss,a=new ss,s=new cs,c=new ss,u=new ss,l=this.mesh.skeleton.bones,h=this.mesh.geometry.iks,d=Math;this.mesh.updateMatrixWorld(!0),!0===t&&this._saveOriginalBonesInfo();for(var p=0,f=h.length;p<f;p++){var m=h[p],v=l[m.effector];n.setFromMatrixPosition(l[m.target].matrixWorld);for(var g=m.links,y=void 0!==m.iteration?m.iteration:1,b=0;b<y;b++){for(var x=!1,w=0,_=g.length;w<_;w++){var S=l[g[w].index];if(!1===g[w].enabled)break;var T=g[w].limitation;S.matrixWorld.decompose(a,s,c),s.inverse(),i.setFromMatrixPosition(v.matrixWorld),o.subVectors(i,a),o.applyQuaternion(s),o.normalize(),r.subVectors(n,a),r.applyQuaternion(s),r.normalize();var M=r.dot(o);if(M>1?M=1:M<-1&&(M=-1),!((M=d.acos(M))<1e-5)){if(void 0!==m.minAngle&&M<m.minAngle&&(M=m.minAngle),void 0!==m.maxAngle&&M>m.maxAngle&&(M=m.maxAngle),u.crossVectors(o,r),u.normalize(),e.setFromAxisAngle(u,M),S.quaternion.multiply(e),void 0!==T){var A=S.quaternion.w;A>1&&(A=1);var E=d.sqrt(1-A*A);S.quaternion.set(T.x*E,T.y*E,T.z*E,A)}S.updateMatrixWorld(!0),x=!0}}if(!x)break}}this.mesh.updateMatrixWorld(!0)}};var eu=function(t){if(void 0===t.geometry.iks||void 0===t.skeleton)throw"CCDIKHelper requires iks in mesh.geometry and skeleton in mesh.";ys.call(this),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.sphereGeometry=new Ys(.25,16,8),this.targetSphereMaterial=new Xc({color:new Ts(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new Xc({color:new Ts(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new Xc({color:new Ts(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new qc({color:new Ts(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init(),this.update()};function nu(){ys.call(this),this.type="Bone"}function ru(t,e,n,r,i,o){Ls.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new iu(t,e,n,r,i,o)),this.mergeVertices()}function iu(t,e,n,r,i,o){Xs.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};var a=this;t=t||1,e=e||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1;var s=[],c=[],u=[],l=[],h=0,d=0;function p(t,e,n,r,i,o,p,f,m,v,g){var y,b,x=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new ss;for(b=0;b<A;b++){var O=b*w-S;for(y=0;y<M;y++)P[t]=(y*x-_)*r,P[e]=O*i,P[n]=T,c.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[n]=f>0?1:-1,u.push(P.x,P.y,P.z),l.push(y/m),l.push(1-b/v),E+=1}for(b=0;b<v;b++)for(y=0;y<m;y++){var N=h+y+M*(b+1),L=h+(y+1)+M*(b+1),I=h+(y+1)+M*b;s.push(h+y+M*b,N,I),s.push(N,L,I),C+=6}a.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,n,e,t,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,n,e,-t,o,i,1),p("x","z","y",1,1,t,n,e,r,o,2),p("x","z","y",1,-1,t,n,-e,r,o,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(s),this.addAttribute("position",new Vs(c,3)),this.addAttribute("normal",new Vs(u,3)),this.addAttribute("uv",new Vs(l,2))}function ou(t,e,n,r,i,o,a,s){Ls.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new au(t,e,n,r,i,o,a,s)),this.mergeVertices()}function au(t,e,n,r,i,o,a,s){Xs.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var c=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var u=[],l=[],h=[],d=[],p=0,f=[],m=n/2,v=0;function g(n){var i,o,f,g=new Cs,y=new ss,b=0,x=!0===n?t:e,w=!0===n?1:-1;for(o=p,i=1;i<=r;i++)l.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=r;i++){var _=i/r*s+a,S=Math.cos(_),T=Math.sin(_);y.x=x*T,y.y=m*w,y.z=x*S,l.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<r;i++){var M=o+i,A=f+i;!0===n?u.push(A,A+1,M):u.push(A+1,A,M),b+=3}c.addGroup(v,b,!0===n?1:2),v+=b}!function(){var o,g,y=new ss,b=new ss,x=0,w=(e-t)/n;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(e-t)+t;for(o=0;o<=r;o++){var M=o/r,A=M*s+a,E=Math.sin(A),C=Math.cos(A);b.x=T*E,b.y=-S*n+m,b.z=T*C,l.push(b.x,b.y,b.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<r;o++)for(g=0;g<i;g++){var P=f[g+1][o],O=f[g+1][o+1],N=f[g][o+1];u.push(f[g][o],P,N),u.push(P,O,N),x+=6}c.addGroup(v,x,0),v+=x}(),!1===o&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(u),this.addAttribute("position",new Vs(l,3)),this.addAttribute("normal",new Vs(h,3)),this.addAttribute("uv",new Vs(d,2))}(eu.prototype=Object.create(ys.prototype)).constructor=eu,eu.prototype._init=function(){var t=this,e=this.root.geometry.iks;function n(e){return new $c(function(t){var e=new Xs,n=new Float32Array(3*(2+t.links.length));return e.addAttribute("position",new Rs(n,3)),e}(e),t.lineMaterial)}for(var r=0,i=e.length;r<i;r++){var o=e[r];this.add(new Kc(t.sphereGeometry,t.targetSphereMaterial)),this.add(new Kc(t.sphereGeometry,t.effectorSphereMaterial));for(var a=0,s=o.links.length;a<s;a++)this.add(new Kc(t.sphereGeometry,t.linkSphereMaterial));this.add(n(o))}},eu.prototype.update=function(){var t=0,e=this.root,n=e.geometry.iks,r=e.skeleton.bones,i=(new as).getInverse(e.matrixWorld),o=new ss;function a(t){return o.setFromMatrixPosition(t.matrixWorld),o.applyMatrix4(i),o}function s(t,e,n){var r=a(n);t[3*e+0]=r.x,t[3*e+1]=r.y,t[3*e+2]=r.z}for(var c=0,u=n.length;c<u;c++){var l=n[c],h=r[l.target],d=r[l.effector],p=this.children[t++],f=this.children[t++];p.position.copy(a(h)),f.position.copy(a(d));for(var m=0,v=l.links.length;m<v;m++)this.children[t++].position.copy(a(r[l.links[m].index]));var g=this.children[t++],y=g.geometry.attributes.position.array;for(s(y,0,h),s(y,1,d),m=0,v=l.links.length;m<v;m++)s(y,m+2,r[l.links[m].index]);g.geometry.attributes.position.needsUpdate=!0}},nu.prototype=Object.assign(Object.create(ys.prototype),{constructor:nu,isBone:!0}),(ru.prototype=Object.create(Ls.prototype)).constructor=ru,(iu.prototype=Object.create(Xs.prototype)).constructor=iu,(ou.prototype=Object.create(Ls.prototype)).constructor=ou,(au.prototype=Object.create(Xs.prototype)).constructor=au;var su=function(t,e){void 0===e&&(e={}),this.mesh=t,this.helper=new su.ResourceHelper,this.unitStep=void 0!==e.unitStep?e.unitStep:1/65,this.maxStepNum=void 0!==e.maxStepNum?e.maxStepNum:3,this.world=void 0!==e.world?e.world:null,this.bodies=[],this.constraints=[],this.init(t)};su.prototype={constructor:su,init:function(t){var e=t.parent;null!==e&&e.remove(t);var n=this.helper,r=n.allocThreeVector3(),i=n.allocThreeEuler(),o=n.allocThreeVector3();r.copy(t.position),i.copy(t.rotation),o.copy(t.scale),t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrixWorld(!0),null===this.world&&this.initWorld(),this.initRigidBodies(),this.initConstraints(),null!==e&&e.add(t),t.position.copy(r),t.rotation.copy(i),t.scale.copy(o),t.updateMatrixWorld(!0),this.reset(),n.freeThreeVector3(r),n.freeThreeEuler(i),n.freeThreeVector3(o)},initWorld:function(){var t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),n=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver,i=new Ammo.btDiscreteDynamicsWorld(e,n,r,t);i.setGravity(new Ammo.btVector3(0,-98,0)),this.world=i},initRigidBodies:function(){for(var t=this.mesh.geometry.rigidBodies,e=0;e<t.length;e++){var n=new su.RigidBody(this.mesh,this.world,t[e],this.helper);this.bodies.push(n)}},initConstraints:function(){for(var t=this.mesh.geometry.constraints,e=0;e<t.length;e++){var n=t[e],r=new su.Constraint(this.mesh,this.world,this.bodies[n.rigidBodyIndex1],this.bodies[n.rigidBodyIndex2],n,this.helper);this.constraints.push(r)}},update:function(t){this.updateRigidBodies(),this.stepSimulation(t),this.updateBones()},stepSimulation:function(t){var e=this.unitStep,n=t,r=1+(t/e|0);n<e&&(n=e,r=1),r>this.maxStepNum&&(r=this.maxStepNum),this.world.stepSimulation(n,r,e)},updateRigidBodies:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].updateFromBone()},updateBones:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].updateBone()},reset:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].reset()},warmup:function(t){for(var e=0;e<t;e++)this.update(1/60)}},su.ResourceHelper=function(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]},su.ResourceHelper.prototype={allocThreeVector3:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new ss},freeThreeVector3:function(t){this.threeVector3s.push(t)},allocThreeMatrix4:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new as},freeThreeMatrix4:function(t){this.threeMatrix4s.push(t)},allocThreeQuaternion:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new cs},freeThreeQuaternion:function(t){this.threeQuaternions.push(t)},allocThreeEuler:function(){return this.threeEulers.length>0?this.threeEulers.pop():new ls},freeThreeEuler:function(t){this.threeEulers.push(t)},allocTransform:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform},freeTransform:function(t){this.transforms.push(t)},allocQuaternion:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(t){this.quaternions.push(t)},allocVector3:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(t){this.vector3s.push(t)},setIdentity:function(t){t.setIdentity()},getBasis:function(t){var e=this.allocQuaternion();return t.getBasis().getRotation(e),e},getBasisAsMatrix3:function(t){var e=this.getBasis(t),n=this.quaternionToMatrix3(e);return this.freeQuaternion(e),n},getOrigin:function(t){return t.getOrigin()},setOrigin:function(t,e){t.getOrigin().setValue(e.x(),e.y(),e.z())},copyOrigin:function(t,e){var n=e.getOrigin();this.setOrigin(t,n)},setBasis:function(t,e){t.setRotation(e)},setBasisFromMatrix3:function(t,e){var n=this.matrix3ToQuaternion(e);this.setBasis(t,n),this.freeQuaternion(n)},setOriginFromArray3:function(t,e){t.getOrigin().setValue(e[0],e[1],e[2])},setOriginFromThreeVector3:function(t,e){t.getOrigin().setValue(e.x,e.y,e.z)},setBasisFromArray3:function(t,e){var n=this.allocThreeQuaternion(),r=this.allocThreeEuler();r.set(e[0],e[1],e[2]),this.setBasisFromThreeQuaternion(t,n.setFromEuler(r)),this.freeThreeEuler(r),this.freeThreeQuaternion(n)},setBasisFromThreeQuaternion:function(t,e){var n=this.allocQuaternion();n.setX(e.x),n.setY(e.y),n.setZ(e.z),n.setW(e.w),this.setBasis(t,n),this.freeQuaternion(n)},multiplyTransforms:function(t,e){var n=this.allocTransform();this.setIdentity(n);var r=this.getBasisAsMatrix3(t),i=this.getBasisAsMatrix3(e),o=this.getOrigin(t),a=this.getOrigin(e),s=this.multiplyMatrix3ByVector3(r,a),c=this.addVector3(s,o);this.setOrigin(n,c);var u=this.multiplyMatrices3(r,i);return this.setBasisFromMatrix3(n,u),this.freeVector3(s),this.freeVector3(c),n},inverseTransform:function(t){var e=this.allocTransform(),n=this.getBasisAsMatrix3(t),r=this.getOrigin(t),i=this.transposeMatrix3(n),o=this.negativeVector3(r),a=this.multiplyMatrix3ByVector3(i,o);return this.setOrigin(e,a),this.setBasisFromMatrix3(e,i),this.freeVector3(o),this.freeVector3(a),e},multiplyMatrices3:function(t,e){var n=[],r=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),a=this.columnOfMatrix3(e,0),s=this.columnOfMatrix3(e,1),c=this.columnOfMatrix3(e,2);return n[0]=this.dotVectors3(r,a),n[1]=this.dotVectors3(r,s),n[2]=this.dotVectors3(r,c),n[3]=this.dotVectors3(i,a),n[4]=this.dotVectors3(i,s),n[5]=this.dotVectors3(i,c),n[6]=this.dotVectors3(o,a),n[7]=this.dotVectors3(o,s),n[8]=this.dotVectors3(o,c),this.freeVector3(r),this.freeVector3(i),this.freeVector3(o),this.freeVector3(a),this.freeVector3(s),this.freeVector3(c),n},addVector3:function(t,e){var n=this.allocVector3();return n.setValue(t.x()+e.x(),t.y()+e.y(),t.z()+e.z()),n},dotVectors3:function(t,e){return t.x()*e.x()+t.y()*e.y()+t.z()*e.z()},rowOfMatrix3:function(t,e){var n=this.allocVector3();return n.setValue(t[3*e+0],t[3*e+1],t[3*e+2]),n},columnOfMatrix3:function(t,e){var n=this.allocVector3();return n.setValue(t[e+0],t[e+3],t[e+6]),n},negativeVector3:function(t){var e=this.allocVector3();return e.setValue(-t.x(),-t.y(),-t.z()),e},multiplyMatrix3ByVector3:function(t,e){var n=this.allocVector3(),r=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),a=this.dotVectors3(r,e),s=this.dotVectors3(i,e),c=this.dotVectors3(o,e);return n.setValue(a,s,c),this.freeVector3(r),this.freeVector3(i),this.freeVector3(o),n},transposeMatrix3:function(t){var e=[];return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},quaternionToMatrix3:function(t){var e=[],n=t.x(),r=t.y(),i=t.z(),o=t.w(),a=n*n,s=r*r,c=i*i,u=n*r,l=r*i,h=i*n,d=n*o,p=r*o,f=i*o;return e[0]=1-2*(s+c),e[1]=2*(u-f),e[2]=2*(h+p),e[3]=2*(u+f),e[4]=1-2*(c+a),e[5]=2*(l-d),e[6]=2*(h-p),e[7]=2*(l+d),e[8]=1-2*(a+s),e},matrix3ToQuaternion:function(t){var e,n,r,i,o,a=t[0]+t[4]+t[8];a>0?(o=.25*(e=2*Math.sqrt(a+1)),n=(t[7]-t[5])/e,r=(t[2]-t[6])/e,i=(t[3]-t[1])/e):t[0]>t[4]&&t[0]>t[8]?(e=2*Math.sqrt(1+t[0]-t[4]-t[8]),o=(t[7]-t[5])/e,n=.25*e,r=(t[1]+t[3])/e,i=(t[2]+t[6])/e):t[4]>t[8]?(e=2*Math.sqrt(1+t[4]-t[0]-t[8]),o=(t[2]-t[6])/e,n=(t[1]+t[3])/e,r=.25*e,i=(t[5]+t[7])/e):(e=2*Math.sqrt(1+t[8]-t[0]-t[4]),o=(t[3]-t[1])/e,n=(t[2]+t[6])/e,r=(t[5]+t[7])/e,i=.25*e);var s=this.allocQuaternion();return s.setX(n),s.setY(r),s.setZ(i),s.setW(o),s}},su.RigidBody=function(t,e,n,r){this.mesh=t,this.world=e,this.params=n,this.helper=r,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this.init()},su.RigidBody.prototype={constructor:su.RigidBody,init:function(){var t=this.helper,e=this.params,n=this.mesh.skeleton.bones,r=-1===e.boneIndex?new nu:n[e.boneIndex],i=function(t){switch(t.shapeType){case 0:return new Ammo.btSphereShape(t.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(t.width,t.height,t.depth));case 2:return new Ammo.btCapsuleShape(t.width,t.height);default:throw"unknown shape type "+t.shapeType}}(e),o=0===e.type?0:e.weight,a=t.allocVector3();a.setValue(0,0,0),0!==o&&i.calculateLocalInertia(o,a);var s=t.allocTransform();t.setIdentity(s),t.setOriginFromArray3(s,e.position),t.setBasisFromArray3(s,e.rotation);var c=t.allocThreeVector3(),u=t.allocTransform();t.setIdentity(u),t.setOriginFromThreeVector3(u,r.getWorldPosition(c));var l=t.multiplyTransforms(u,s),h=new Ammo.btDefaultMotionState(l),d=new Ammo.btRigidBodyConstructionInfo(o,h,i,a);d.set_m_friction(e.friction),d.set_m_restitution(e.restitution);var p=new Ammo.btRigidBody(d);0===e.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(e.positionDamping,e.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<e.groupIndex,e.groupTarget),this.body=p,this.bone=r,this.boneOffsetForm=s,this.boneOffsetFormInverse=t.inverseTransform(s),t.freeVector3(a),t.freeTransform(l),t.freeTransform(u),t.freeThreeVector3(c)},reset:function(){this.setTransformFromBone()},updateFromBone:function(){-1!==this.params.boneIndex&&0===this.params.type&&this.setTransformFromBone()},updateBone:function(){0!==this.params.type&&-1!==this.params.boneIndex&&(this.updateBoneRotation(),1===this.params.type&&this.updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this.setPositionFromBone())},getBoneTransform:function(){var t=this.helper,e=t.allocThreeVector3(),n=t.allocThreeQuaternion();this.bone.getWorldPosition(e),this.bone.getWorldQuaternion(n);var r=t.allocTransform();t.setOriginFromThreeVector3(r,e),t.setBasisFromThreeQuaternion(r,n);var i=t.multiplyTransforms(r,this.boneOffsetForm);return t.freeTransform(r),t.freeThreeQuaternion(n),t.freeThreeVector3(e),i},getWorldTransformForBone:function(){var t=this.helper,e=t.allocTransform();this.body.getMotionState().getWorldTransform(e);var n=t.multiplyTransforms(e,this.boneOffsetFormInverse);return t.freeTransform(e),n},setTransformFromBone:function(){var t=this.helper,e=this.getBoneTransform();this.body.setCenterOfMassTransform(e),this.body.getMotionState().setWorldTransform(e),t.freeTransform(e)},setPositionFromBone:function(){var t=this.helper,e=this.getBoneTransform(),n=t.allocTransform();this.body.getMotionState().getWorldTransform(n),t.copyOrigin(n,e),this.body.setCenterOfMassTransform(n),this.body.getMotionState().setWorldTransform(n),t.freeTransform(n),t.freeTransform(e)},updateBoneRotation:function(){this.bone.updateMatrixWorld(!0);var t=this.helper,e=this.getWorldTransformForBone(),n=t.getBasis(e),r=t.allocThreeQuaternion(),i=t.allocThreeQuaternion(),o=t.allocThreeQuaternion();r.set(n.x(),n.y(),n.z(),n.w()),i.setFromRotationMatrix(this.bone.matrixWorld),i.conjugate(),i.multiply(r),o.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(i.multiply(o)),t.freeThreeQuaternion(r),t.freeThreeQuaternion(i),t.freeThreeQuaternion(o),t.freeQuaternion(n),t.freeTransform(e)},updateBonePosition:function(){var t=this.helper,e=this.getWorldTransformForBone(),n=t.allocThreeVector3(),r=t.getOrigin(e);n.set(r.x(),r.y(),r.z());var i=this.bone.worldToLocal(n);this.bone.position.add(i),t.freeThreeVector3(n),t.freeTransform(e)}},su.Constraint=function(t,e,n,r,i,o){this.mesh=t,this.world=e,this.bodyA=n,this.bodyB=r,this.params=i,this.helper=o,this.constraint=null,this.init()},su.Constraint.prototype={constructor:su.Constraint,init:function(){var t=this.helper,e=this.params,n=this.bodyA,r=this.bodyB,i=t.allocTransform();t.setIdentity(i),t.setOriginFromArray3(i,e.position),t.setBasisFromArray3(i,e.rotation);var o=t.allocTransform(),a=t.allocTransform();n.body.getMotionState().getWorldTransform(o),r.body.getMotionState().getWorldTransform(a);var s=t.inverseTransform(o),c=t.inverseTransform(a),u=t.multiplyTransforms(s,i),l=t.multiplyTransforms(c,i),h=new Ammo.btGeneric6DofSpringConstraint(n.body,r.body,u,l,!0),d=t.allocVector3(),p=t.allocVector3(),f=t.allocVector3(),m=t.allocVector3();d.setValue(e.translationLimitation1[0],e.translationLimitation1[1],e.translationLimitation1[2]),p.setValue(e.translationLimitation2[0],e.translationLimitation2[1],e.translationLimitation2[2]),f.setValue(e.rotationLimitation1[0],e.rotationLimitation1[1],e.rotationLimitation1[2]),m.setValue(e.rotationLimitation2[0],e.rotationLimitation2[1],e.rotationLimitation2[2]),h.setLinearLowerLimit(d),h.setLinearUpperLimit(p),h.setAngularLowerLimit(f),h.setAngularUpperLimit(m);for(var v=0;v<3;v++)0!==e.springPosition[v]&&(h.enableSpring(v,!0),h.setStiffness(v,e.springPosition[v]));for(v=0;v<3;v++)0!==e.springRotation[v]&&(h.enableSpring(v+3,!0),h.setStiffness(v+3,e.springRotation[v]));if(void 0!==h.setParam)for(v=0;v<6;v++)h.setParam(2,.475,v);this.world.addConstraint(h,!0),this.constraint=h,t.freeTransform(i),t.freeTransform(o),t.freeTransform(a),t.freeTransform(s),t.freeTransform(c),t.freeTransform(u),t.freeTransform(l),t.freeVector3(d),t.freeVector3(p),t.freeVector3(f),t.freeVector3(m)}};var cu=function(t){if(void 0===t.physics||void 0===t.geometry.rigidBodies)throw"MMDPhysicsHelper requires physics in mesh and rigidBodies in mesh.geometry.";ys.call(this),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new Xc({color:new Ts(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new Xc({color:new Ts(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new Xc({color:new Ts(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init(),this.update()};function uu(t,e,n,r){xu.call(this,t,e,n,r)}function lu(t,e,n){xu.call(this,t,e,n)}function hu(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function du(t,e,n,r){hu.call(this,t,e,n,r)}function pu(t,e,n,r){xu.call(this,t,e,n,r)}function fu(t,e,n,r){xu.call(this,t,e,n,r)}function mu(t,e,n,r){xu.call(this,t,e,n,r)}function vu(t,e,n,r){hu.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function gu(t,e,n,r){hu.call(this,t,e,n,r)}function yu(t,e,n,r){hu.call(this,t,e,n,r)}(cu.prototype=Object.create(ys.prototype)).constructor=cu,cu.prototype._init=function(){var t=this.root.geometry.rigidBodies;function e(t){switch(t.shapeType){case 0:return new Ys(t.width,16,8);case 1:return new iu(2*t.width,2*t.height,2*t.depth,8,8,8);case 2:return new function(t,e,n,r){var i=new au(t,t,e,16,8,!0),o=new Kc(new Ys(t,16,8,0,2*Math.PI,0,Math.PI/2)),a=new Kc(new Ys(t,16,8,0,2*Math.PI,Math.PI/2,Math.PI/2));return o.position.set(0,e/2,0),a.position.set(0,-e/2,0),o.updateMatrix(),a.updateMatrix(),i.merge(o.geometry,o.matrix),i.merge(a.geometry,a.matrix),i}(t.width,t.height,16,8);default:return null}}for(var n=0,r=t.length;n<r;n++){var i=t[n];this.add(new Kc(e(i),this.materials[i.type]))}},cu.prototype.update=function(){for(var t,e,n=(l=this.root).geometry.rigidBodies,r=l.physics.bodies,i=(new as).getInverse(l.matrixWorld),o=new ss,a=new cs,s=new cs,c=0,u=n.length;c<u;c++){var l=this.children[c],h=r[c].body.getCenterOfMassTransform();l.position.copy((e=h.getOrigin(),o.set(e.x(),e.y(),e.z()),o.applyMatrix4(i),o)),l.quaternion.copy((t=h.getRotation(),a.set(t.x(),t.y(),t.z(),t.w()),s.setFromRotationMatrix(i),s.multiply(a),s))}},uu.prototype=Object.assign(Object.create(xu.prototype),{constructor:uu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Uc,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),lu.prototype=Object.assign(Object.create(xu.prototype),{constructor:lu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Uc,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(hu.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{var o;n:{r:if(!(t<r)){for(var a=n+2;;){if(void 0===r){if(t<i)break r;return this._cachedIndex=n=e.length,this.afterEnd_(n-1,t,i)}if(n===a)break;if(i=r,t<(r=e[++n]))break e}o=e.length;break n}if(t>=i)break t;var s=e[1];for(t<s&&(n=2,i=s),a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===a)break;if(r=i,t>=(i=e[--n-1]))break e}o=n,n=0}for(;n<o;){var c=n+o>>>1;t<e[c]?o=c:n=c+1}if(r=e[n],void 0===(i=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return this._cachedIndex=n=e.length,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r,o=0;o!==r;++o)e[o]=n[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(hu.prototype,{beforeStart_:hu.prototype.copySampleValue_,afterEnd_:hu.prototype.copySampleValue_}),du.prototype=Object.assign(Object.create(hu.prototype),{constructor:du,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=(n-e)/(r-e),u=s+a;s!==u;s+=4)cs.slerpFlat(i,0,o,s-a,o,s,c);return i}}),pu.prototype=Object.assign(Object.create(xu.prototype),{constructor:pu,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new du(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),fu.prototype=Object.assign(Object.create(xu.prototype),{constructor:fu,ValueTypeName:"color"}),mu.prototype=Object.assign(Object.create(xu.prototype),{constructor:mu,ValueTypeName:"vector"}),vu.prototype=Object.assign(Object.create(hu.prototype),{constructor:vu,DefaultSettings_:{endingStart:kc,endingEnd:kc},intervalChanged_:function(t,e,n){var r=this.parameterPositions,i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=t,a=2*e-n;break;case 2402:a=e+r[i=r.length-2]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*n-e;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}var c=.5*(n-e),u=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(s-n),this._offsetPrev=i*u,this._offsetNext=o*u},interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=s-a,u=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f,x=0;x!==a;++x)i[x]=v*o[u+x]+g*o[c+x]+y*o[s+x]+b*o[l+x];return i}}),gu.prototype=Object.assign(Object.create(hu.prototype),{constructor:gu,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=s-a,u=(n-e)/(r-e),l=1-u,h=0;h!==a;++h)i[h]=o[c+h]*l+o[s+h]*u;return i}}),yu.prototype=Object.assign(Object.create(hu.prototype),{constructor:yu,interpolate_:function(t){return this.copySampleValue_(t-1)}});var bu={arraySlice:function(t,e,n){return bu.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=new Array(e),r=0;r!==e;++r)n[r]=r;return n.sort(function(e,n){return t[e]-t[n]}),n},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*e,c=0;c!==e;++c)i[a++]=t[s+c];return i},flattenJSON:function(t,e,n,r){for(var i=1,o=t[0];void 0!==o&&void 0===o[r];)o=t[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}}};function xu(t,e,n,r){if(void 0===t)throw new Error("KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=bu.convertArray(e,this.TimeBufferType),this.values=bu.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation),this.validate(),this.optimize()}function wu(t,e,n,r){xu.call(this,t,e,n,r)}function _u(t,e,n){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.uuid=os.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}Object.assign(xu,{parse:function(t){if(void 0===t.type)throw new Error("KeyframeTrack: track type undefined, can not parse");var e=xu._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var n=[],r=[];bu.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,n=t.constructor;if(void 0!==n.toJSON)e=n.toJSON(t);else{e={name:t.name,times:bu.convertArray(t.times,Array),values:bu.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(e.interpolation=r)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wu;case"vector":case"vector2":case"vector3":case"vector4":return mu;case"color":return fu;case"quaternion":return pu;case"bool":case"boolean":return lu;case"string":return uu}throw new Error("KeyframeTrack: Unsupported typeName: "+t)}}),Object.assign(xu.prototype,{constructor:xu,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new yu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new gu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new vu(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Uc:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}console.warn("KeyframeTrack:",n)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Uc;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=bu.arraySlice(n,i,o),this.values=bu.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==r&&bu.isTypedArray(r)){a=0;for(var c=r.length;a!==c;++a){var u=r[a];if(isNaN(u)){console.error("KeyframeTrack: Value is not a valid number.",this,a,u),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,n=this.getValueSize(),r=2302===this.getInterpolation(),i=1,o=t.length-1,a=1;a<o;++a){var s=!1,c=t[a];if(c!==t[a+1]&&(1!==a||c!==c[0]))if(r)s=!0;else for(var u=a*n,l=u-n,h=u+n,d=0;d!==n;++d){var p=e[u+d];if(p!==e[l+d]||p!==e[h+d]){s=!0;break}}if(s){if(a!==i){t[i]=t[a];var f=a*n,m=i*n;for(d=0;d!==n;++d)e[m+d]=e[f+d]}++i}}if(o>0){for(t[i]=t[o],f=o*n,m=i*n,d=0;d!==n;++d)e[m+d]=e[f+d];++i}return i!==t.length&&(this.times=bu.arraySlice(t,0,i),this.values=bu.arraySlice(e,0,i*n)),this}}),wu.prototype=Object.assign(Object.create(xu.prototype),{constructor:wu,ValueTypeName:"number"}),Object.assign(_u,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,o=n.length;i!==o;++i)e.push(xu.parse(n[i]).scale(r));return new _u(t.name,t.duration,e)},toJSON:function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e},i=0,o=n.length;i!==o;++i)e.push(xu.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],c=[];s.push((a+i-1)%i,a,(a+1)%i),c.push(0,1,0);var u=bu.getKeyframeOrder(s);s=bu.sortedArray(s,1,u),c=bu.sortedArray(c,1,u),r||0!==s[0]||(s.push(i),c.push(c[0])),o.push(new wu(".morphTargetInfluences["+e[a].name+"]",s,c).scale(1/n))}return new _u(t,-1,o)},findByName:function(t,e){var n=t;Array.isArray(t)||(n=t.geometry&&t.geometry.animations||t.animations);for(var r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],c=s.name.match(i);if(c&&c.length>1){var u=r[h=c[1]];u||(r[h]=u=[]),u.push(s)}}var l=[];for(var h in r)l.push(_u.CreateFromMorphTargetSequence(h,r[h],e,n));return l},parseAnimation:function(t,e){if(!t)return console.error("AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,e,n,r,i){if(0!==n.length){var o=[],a=[];bu.flattenJSON(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],c=0;c<s.length;c++){var u=s[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var l={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)l[u[h].morphTargets[d]]=-1;for(var p in l){var f=[],m=[];for(d=0;d!==u[h].morphTargets.length;++d){var v=u[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}r.push(new wu(".morphTargetInfluence["+p+"]",f,m))}o=l.length*(a||1)}else{var g=".bones["+e[c].name+"]";n(mu,g+".position",u,"pos",r),n(pu,g+".quaternion",u,"rot",r),n(mu,g+".scale",u,"scl",r)}}return 0===r.length?null:new _u(i,o,r)}}),Object.assign(_u.prototype,{resetDuration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}});var Su=function(){};function Tu(){ys.call(this),this.type="Camera",this.matrixWorldInverse=new as,this.projectionMatrix=new as}function Mu(t,e,n,r){Tu.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Au(t){Wc.call(this),this.type="MeshDepthMaterial",this.depthPacking=Gc,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function Eu(){ys.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Cu(t,e,n,r,i,o){Tu.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}Su.CreateRotationAnimation=function(t,e){return new _u(null,t,[new wu(".rotation["+(e=e||"x")+"]",[0,t],[0,360])])},Su.CreateScaleAxisAnimation=function(t,e){return new _u(null,t,[new wu(".scale["+(e=e||"x")+"]",[0,t],[0,1])])},Su.CreateShakeAnimation=function(t,e){for(var n=[],r=[],i=new ss,o=0;o<10*t;o++)n.push(o/10),i.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(e).toArray(r,r.length);return new _u(null,t,[new mu(".position",n,r)])},Su.CreatePulsationAnimation=function(t,e){for(var n=[],r=[],i=new ss,o=0;o<10*t;o++){n.push(o/10);var a=Math.random()*e;i.set(a,a,a).toArray(r,r.length)}return new _u(null,t,[new mu(".scale",n,r)])},Su.CreateVisibilityAnimation=function(t){return new _u(null,t,[new lu(".visible",[0,t/2,t],[!0,!1,!0])])},Su.CreateMaterialColorAnimation=function(t,e){for(var n=[],r=[],i=t/e.length,o=0;o<=e.length;o++)n.push(o*i),r.push(e[o%e.length]);return new _u(null,t,[new fu(".material[0].color",n,r)])},Tu.prototype=Object.assign(Object.create(ys.prototype),{constructor:Tu,isCamera:!0,copy:function(t,e){return ys.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new cs;return function(e){return void 0===e&&(console.warn("Camera: .getWorldDirection() target is now required"),e=new ss),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){ys.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Mu.prototype=Object.assign(Object.create(Tu.prototype),{constructor:Mu,isPerspectiveCamera:!0,copy:function(t,e){return Tu.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*os.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*os.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*os.RAD2DEG*Math.atan(Math.tan(.5*os.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*os.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,e-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var c=this.filmOffset;0!==c&&(i+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far)},toJSON:function(t){var e=ys.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),(Au.prototype=Object.create(Wc.prototype)).constructor=Au,Au.prototype.isMeshDepthMaterial=!0,Au.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Eu.prototype=Object.assign(Object.create(ys.prototype),{constructor:Eu,copy:function(t,e){return ys.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=ys.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),Cu.prototype=Object.assign(Object.create(Tu.prototype),{constructor:Cu,isOrthographicCamera:!0,copy:function(t,e){return Tu.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,o=n+t,a=r+e,s=r-e;if(null!==this.view&&this.view.enabled){var c=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),l=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=l*(this.view.offsetX/c))+l*(this.view.width/c),s=(a-=h*(this.view.offsetY/u))-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far)},toJSON:function(t){var e=ys.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}});var Pu=0;function Ou(t,e,n,r,i,o,a,s,c,u){Object.defineProperty(this,"id",{value:Pu++}),this.uuid=os.generateUUID(),this.name="",this.image=void 0!==t?t:Ou.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Ou.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:Sc,this.wrapT=void 0!==r?r:Sc,this.magFilter=void 0!==i?i:Ac,this.minFilter=void 0!==o?o:Ec,this.anisotropy=void 0!==c?c:1,this.format=void 0!==a?a:Lc,this.type=void 0!==s?s:Cc,this.offset=new Cs(0,0),this.repeat=new Cs(1,1),this.center=new Cs(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ds,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:Vc,this.version=0,this.onUpdate=null}function Nu(t,e,n){this.width=t,this.height=e,this.scissor=new Is(0,0,t,e),this.scissorTest=!1,this.viewport=new Is(0,0,t,e),void 0===(n=n||{}).minFilter&&(n.minFilter=Ac),this.texture=new Ou(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}Ou.DEFAULT_IMAGE=void 0,Ou.DEFAULT_MAPPING=300,Ou.prototype=Object.assign(Object.create(us.prototype),{constructor:Ou,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var r=this.image;void 0===r.uuid&&(r.uuid=os.generateUUID()),e||void 0!==t.images[r.uuid]||(t.images[r.uuid]={uuid:r.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var n=e.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(r)}),n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case _c:t.x=t.x-Math.floor(t.x);break;case Sc:t.x=t.x<0?0:1;break;case Tc:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case _c:t.y=t.y-Math.floor(t.y);break;case Sc:t.y=t.y<0?0:1;break;case Tc:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(Ou.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Nu.prototype=Object.assign(Object.create(us.prototype),{constructor:Nu,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Lu={merge:function(t){for(var e={},n=0;n<t.length;n++){var r=this.clone(t[n]);for(var i in r)e[i]=r[i]}return e},clone:function(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];e[n][r]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return e}};function Iu(t){Wc.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("ShaderMaterial: attributes should now be defined in BufferGeometry instead."),this.setValues(t))}function Ru(t,e,n,r){Ls.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new Du(t,e,n,r)),this.mergeVertices()}function Du(t,e,n,r){Xs.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};var i,o,a=(t=t||1)/2,s=(e=e||1)/2,c=Math.floor(n)||1,u=Math.floor(r)||1,l=c+1,h=u+1,d=t/c,p=e/u,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-s;for(i=0;i<l;i++)m.push(i*d-a,-y,0),v.push(0,0,1),g.push(i/c),g.push(1-o/u)}for(o=0;o<u;o++)for(i=0;i<c;i++){var b=i+l*(o+1),x=i+1+l*(o+1),w=i+1+l*o;f.push(i+l*o,b,w),f.push(b,x,w)}this.setIndex(f),this.addAttribute("position",new Vs(m,3)),this.addAttribute("normal",new Vs(v,3)),this.addAttribute("uv",new Vs(g,2))}(Iu.prototype=Object.create(Wc.prototype)).constructor=Iu,Iu.prototype.isShaderMaterial=!0,Iu.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Lu.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Iu.prototype.toJSON=function(t){var e=Wc.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},(Ru.prototype=Object.create(Ls.prototype)).constructor=Ru,(Du.prototype=Object.create(Xs.prototype)).constructor=Du;var Fu={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","float viewZ = getViewZ( getDepth( vUv ) );","float factor = ( focus + viewZ );","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},Uu=function(t,e,n,r){Mu.call(this,t,e,n,r),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4},this.material_depth=new Au,this.setLens(),this.initPostProcessing()};(Uu.prototype=Object.create(Mu.prototype)).constructor=Uu,Uu.prototype.setLens=function(t,e,n,r){void 0===t&&(t=35),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t),void 0===n&&(n=8),void 0===r&&(r=.019),this.fNumber=n,this.coc=r,this.aperture=t/this.fNumber,this.hyperFocal=t*t/(this.aperture*this.coc)},Uu.prototype.linearize=function(t){var e=this.far,n=this.near;return-e*n/(t*(e-n)-e)},Uu.prototype.smoothstep=function(t,e,n){var r=this.saturate((n-t)/(e-t));return r*r*(3-2*r)},Uu.prototype.saturate=function(t){return Math.max(0,Math.min(1,t))},Uu.prototype.focusAt=function(t){void 0===t&&(t=20);var e=this.getFocalLength();this.focus=t,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-e)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-e)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance},Uu.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new Eu,this.postprocessing.camera=new Cu(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera);var t={minFilter:Ac,magFilter:Ac,format:Nc};this.postprocessing.rtTextureDepth=new Nu(window.innerWidth,window.innerHeight,t),this.postprocessing.rtTextureColor=new Nu(window.innerWidth,window.innerHeight,t);var e=Fu;this.postprocessing.bokeh_uniforms=Lu.clone(e.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new Iu({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples}}),this.postprocessing.quad=new Kc(new Du(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)}},Uu.prototype.renderCinematic=function(t,e){this.postprocessing.enabled&&(e.clear(),t.overrideMaterial=null,e.render(t,camera,this.postprocessing.rtTextureColor,!0),t.overrideMaterial=this.material_depth,e.render(t,camera,this.postprocessing.rtTextureDepth,!0),e.render(this.postprocessing.scene,this.postprocessing.camera))};var ku={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function ju(t,e,n){var r=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this}}var Bu,zu,Vu,Gu,Hu=new ju,Wu={};function Xu(t){this.manager=void 0!==t?t:Hu}function qu(t){qc.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Yu(t){Wc.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new ss,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Zu(t){Wc.call(this),this.type="MeshLambertMaterial",this.color=new Ts(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ju(t){Wc.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Cs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Qu(t){Wc.call(this),this.type="MeshPhongMaterial",this.color=new Ts(16777215),this.specular=new Ts(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Cs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ku(t){Wc.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ts(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Cs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function $u(t){Ku.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function tl(t){Qu.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function el(t){Wc.call(this),this.type="PointsMaterial",this.color=new Ts(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function nl(t){Iu.call(this,t),this.type="RawShaderMaterial"}function rl(t){Wc.call(this),this.type="ShadowMaterial",this.color=new Ts(0),this.transparent=!0,this.setValues(t)}function il(t){Wc.call(this),this.type="SpriteMaterial",this.color=new Ts(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function ol(t){this.manager=void 0!==t?t:Hu,this.textures={}}function al(t){this.manager=void 0!==t?t:Hu}function sl(t){this.manager=void 0!==t?t:Hu}function cl(){}Object.assign(Xu.prototype,{load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=ku.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===Wu[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],c=!!a[2],u=a[3];u=window.decodeURIComponent(u),c&&(u=window.atob(u));try{var l,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),p=0;p<u.length;p++)d[p]=u.charCodeAt(p);l="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;l=f.parseFromString(u,s);break;case"json":l=JSON.parse(u);break;default:l=u}window.setTimeout(function(){e&&e(l),i.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){r&&r(e),i.manager.itemEnd(t),i.manager.itemError(t)},0)}}else{Wu[t]=[],Wu[t].push({onLoad:e,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",t,!0),m.addEventListener("load",function(e){var n=this.response;ku.add(t,n);var r=Wu[t];if(delete Wu[t],200===this.status){for(var o=0,a=r.length;o<a;o++)(s=r[o]).onLoad&&s.onLoad(n);i.manager.itemEnd(t)}else if(0===this.status){for(console.warn("FileLoader: HTTP Status 0 received."),o=0,a=r.length;o<a;o++)(s=r[o]).onLoad&&s.onLoad(n);i.manager.itemEnd(t)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)}},!1),m.addEventListener("progress",function(e){for(var n=Wu[t],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(e)}},!1),m.addEventListener("error",function(e){var n=Wu[t];delete Wu[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(t),m}Wu[t].push({onLoad:e,onProgress:n,onError:r})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),(qu.prototype=Object.create(qc.prototype)).constructor=qu,qu.prototype.isLineDashedMaterial=!0,qu.prototype.copy=function(t){return qc.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this},(Yu.prototype=Object.create(Wc.prototype)).constructor=Yu,Yu.prototype.isMeshDistanceMaterial=!0,Yu.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},(Zu.prototype=Object.create(Wc.prototype)).constructor=Zu,Zu.prototype.isMeshLambertMaterial=!0,Zu.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Ju.prototype=Object.create(Wc.prototype)).constructor=Ju,Ju.prototype.isMeshNormalMaterial=!0,Ju.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Qu.prototype=Object.create(Wc.prototype)).constructor=Qu,Qu.prototype.isMeshPhongMaterial=!0,Qu.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Ku.prototype=Object.create(Wc.prototype)).constructor=Ku,Ku.prototype.isMeshStandardMaterial=!0,Ku.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},($u.prototype=Object.create(Ku.prototype)).constructor=$u,$u.prototype.isMeshPhysicalMaterial=!0,$u.prototype.copy=function(t){return Ku.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},(tl.prototype=Object.create(Qu.prototype)).constructor=tl,tl.prototype.isMeshToonMaterial=!0,tl.prototype.copy=function(t){return Qu.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},(el.prototype=Object.create(Wc.prototype)).constructor=el,el.prototype.isPointsMaterial=!0,el.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},(nl.prototype=Object.create(Iu.prototype)).constructor=nl,nl.prototype.isRawShaderMaterial=!0,(rl.prototype=Object.create(Wc.prototype)).constructor=rl,rl.prototype.isShadowMaterial=!0,rl.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.color.copy(t.color),this},(il.prototype=Object.create(Wc.prototype)).constructor=il,il.prototype.isSpriteMaterial=!0,il.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},Object.assign(ol.prototype,{load:function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("MaterialLoader: Undefined texture",t),e[t]}var r=new{LineBasicMaterial:qc,LineDashedMaterial:qu,MeshBasicMaterial:Xc,MeshDepthMaterial:Au,MeshDistanceMaterial:Yu,MeshLambertMaterial:Zu,MeshNormalMaterial:Ju,MeshPhongMaterial:Qu,MeshPhysicalMaterial:$u,MeshStandardMaterial:Ku,MeshToonMaterial:tl,PointsMaterial:el,RawShaderMaterial:nl,ShaderMaterial:Iu,ShadowMaterial:rl,SpriteMaterial:il}[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearCoat&&(r.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(r.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(r.uniforms=t.uniforms),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(r.vertexColors=t.vertexColors),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap),r.transparent=!0),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),r.normalScale=(new Cs).fromArray(i)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),r}}),Object.assign(al.prototype,{crossOrigin:"Anonymous",load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=ku.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){ku.add(t,this),e&&e(this),i.manager.itemEnd(t)},!1),a.addEventListener("error",function(e){r&&r(e),i.manager.itemEnd(t),i.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(sl.prototype,{crossOrigin:"Anonymous",load:function(t,e,n,r){var i=new Ou,o=new al(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(n){i.image=n;var r=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?Nc:Lc,i.needsUpdate=!0,void 0!==e&&e(i)},n,r),i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),cl.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,n=0,r=e.length;n<r;n+=2){var i=e[n+1];if(e[n].test(t))return i}return null}},Object.assign(cl.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,n){for(var r=[],i=0;i<t.length;++i)r[i]=this.createMaterial(t[i],e,n);return r},createMaterial:(Bu={NoBlending:0,NormalBlending:pc,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},zu=new Ts,Vu=new sl,Gu=new ol,function(t,e,n){var r={};function i(t,i,o,a,s){var c,u=e+t,l=cl.Handlers.get(u);null!==l?c=l.load(u):(Vu.setCrossOrigin(n),c=Vu.load(u)),void 0!==i&&(c.repeat.fromArray(i),1!==i[0]&&(c.wrapS=_c),1!==i[1]&&(c.wrapT=_c)),void 0!==o&&c.offset.fromArray(o),void 0!==a&&("repeat"===a[0]&&(c.wrapS=_c),"mirror"===a[0]&&(c.wrapS=Tc),"repeat"===a[1]&&(c.wrapT=_c),"mirror"===a[1]&&(c.wrapT=Tc)),void 0!==s&&(c.anisotropy=s);var h=os.generateUUID();return r[h]=c,h}var o={uuid:os.generateUUID(),type:"MeshLambertMaterial"};for(var a in t){var s=t[a];switch(a){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":o.name=s;break;case"blending":o.blending=Bu[s];break;case"colorAmbient":case"mapAmbient":console.warn("Loader.createMaterial:",a,"is no longer supported.");break;case"colorDiffuse":o.color=zu.fromArray(s).getHex();break;case"colorSpecular":o.specular=zu.fromArray(s).getHex();break;case"colorEmissive":o.emissive=zu.fromArray(s).getHex();break;case"specularCoef":o.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(o.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(o.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(o.type="MeshStandardMaterial");break;case"mapDiffuse":o.map=i(s,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":o.emissiveMap=i(s,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":o.lightMap=i(s,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":o.aoMap=i(s,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":o.bumpMap=i(s,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":o.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":o.normalMap=i(s,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":o.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":o.specularMap=i(s,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":o.metalnessMap=i(s,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":o.roughnessMap=i(s,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":o.alphaMap=i(s,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":o.side=cc;break;case"doubleSided":o.side=uc;break;case"transparency":console.warn("Loader.createMaterial: transparency has been renamed to opacity"),o.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":o[a]=s;break;case"vertexColors":!0===s&&(o.vertexColors=dc),"face"===s&&(o.vertexColors=hc);break;default:console.error("Loader.createMaterial: Unsupported",a,s)}}return"MeshBasicMaterial"===o.type&&delete o.emissive,"MeshPhongMaterial"!==o.type&&delete o.specular,o.opacity<1&&(o.transparent=!0),Gu.setTextures(r),Gu.parse(o)})});var ul={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")}};function ll(t){"boolean"==typeof t&&(console.warn("JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Hu,this.withCredentials=!1}Object.assign(ll.prototype,{load:function(t,e,n,r){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:ul.extractUrlBase(t),a=new Xu(this.manager);a.setWithCredentials(this.withCredentials),a.load(t,function(n){var r=JSON.parse(n),a=r.metadata;if(void 0!==a){var s=a.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("JSONLoader: "+t+" should be loaded with ObjectLoader instead.")}var c=i.parse(r,o);e(c.geometry,c.materials)},n,r)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){void 0!==t.data&&(t=t.data),t.scale=void 0!==t.scale?1/t.scale:1;var n=new Ls;return function(t,e){function n(t,e){return t&1<<e}var r,i,o,a,s,c,u,l,h,d,p,f,m,v,g,y,b,x,w,_,S,T,M,A,E,C=t.faces,P=t.vertices,O=t.normals,N=t.colors,L=t.scale,I=0;if(void 0!==t.uvs){for(r=0;r<t.uvs.length;r++)t.uvs[r].length&&I++;for(r=0;r<I;r++)e.faceVertexUvs[r]=[]}for(a=0,s=P.length;a<s;)(x=new ss).x=P[a++]*L,x.y=P[a++]*L,x.z=P[a++]*L,e.vertices.push(x);for(a=0,s=C.length;a<s;)if(p=n(d=C[a++],0),f=n(d,1),m=n(d,3),v=n(d,4),g=n(d,5),y=n(d,6),b=n(d,7),p){if((_=new Ms).a=C[a],_.b=C[a+1],_.c=C[a+3],(S=new Ms).a=C[a+1],S.b=C[a+2],S.c=C[a+3],a+=4,f&&(h=C[a++],_.materialIndex=h,S.materialIndex=h),o=e.faces.length,m)for(r=0;r<I;r++)for(A=t.uvs[r],e.faceVertexUvs[r][o]=[],e.faceVertexUvs[r][o+1]=[],i=0;i<4;i++)E=new Cs(A[2*(l=C[a++])],A[2*l+1]),2!==i&&e.faceVertexUvs[r][o].push(E),0!==i&&e.faceVertexUvs[r][o+1].push(E);if(v&&(u=3*C[a++],_.normal.set(O[u++],O[u++],O[u]),S.normal.copy(_.normal)),g)for(r=0;r<4;r++)u=3*C[a++],M=new ss(O[u++],O[u++],O[u]),2!==r&&_.vertexNormals.push(M),0!==r&&S.vertexNormals.push(M);if(y&&(c=C[a++],_.color.setHex(T=N[c]),S.color.setHex(T)),b)for(r=0;r<4;r++)T=N[c=C[a++]],2!==r&&_.vertexColors.push(new Ts(T)),0!==r&&S.vertexColors.push(new Ts(T));e.faces.push(_),e.faces.push(S)}else{if((w=new Ms).a=C[a++],w.b=C[a++],w.c=C[a++],f&&(h=C[a++],w.materialIndex=h),o=e.faces.length,m)for(r=0;r<I;r++)for(A=t.uvs[r],e.faceVertexUvs[r][o]=[],i=0;i<3;i++)E=new Cs(A[2*(l=C[a++])],A[2*l+1]),e.faceVertexUvs[r][o].push(E);if(v&&(u=3*C[a++],w.normal.set(O[u++],O[u++],O[u])),g)for(r=0;r<3;r++)u=3*C[a++],M=new ss(O[u++],O[u++],O[u]),w.vertexNormals.push(M);if(y&&(c=C[a++],w.color.setHex(N[c])),b)for(r=0;r<3;r++)c=C[a++],w.vertexColors.push(new Ts(N[c]));e.faces.push(w)}}(t,n),function(t,e){var n=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var r=0,i=t.skinWeights.length;r<i;r+=n)e.skinWeights.push(new Is(t.skinWeights[r],n>1?t.skinWeights[r+1]:0,n>2?t.skinWeights[r+2]:0,n>3?t.skinWeights[r+3]:0));if(t.skinIndices)for(r=0,i=t.skinIndices.length;r<i;r+=n)e.skinIndices.push(new Is(t.skinIndices[r],n>1?t.skinIndices[r+1]:0,n>2?t.skinIndices[r+2]:0,n>3?t.skinIndices[r+3]:0));e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,n),function(t,e){var n=t.scale;if(void 0!==t.morphTargets)for(var r=0,i=t.morphTargets.length;r<i;r++){e.morphTargets[r]={},e.morphTargets[r].name=t.morphTargets[r].name,e.morphTargets[r].vertices=[];for(var o=e.morphTargets[r].vertices,a=t.morphTargets[r].vertices,s=0,c=a.length;s<c;s+=3){var u=new ss;u.x=a[s]*n,u.y=a[s+1]*n,u.z=a[s+2]*n,o.push(u)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('JSONLoader: "morphColors" no longer supported. Using them as face colors.');var l=e.faces,h=t.morphColors[0].colors;for(r=0,i=l.length;r<i;r++)l[r].color.fromArray(h,3*r)}}(t,n),function(t,e){var n=[],r=[];void 0!==t.animation&&r.push(t.animation),void 0!==t.animations&&(t.animations.length?r=r.concat(t.animations):r.push(t.animations));for(var i=0;i<r.length;i++){var o=_u.parseAnimation(r[i],e.bones);o&&n.push(o)}if(e.morphTargets){var a=_u.CreateClipsFromMorphTargetSequences(e.morphTargets,10);n=n.concat(a)}n.length>0&&(e.animations=n)}(t,n),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:n}:{geometry:n,materials:cl.prototype.initMaterials(t.materials,e,this.crossOrigin)}}});var hl=function(t){"boolean"==typeof t&&(console.warn("BinaryLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Hu};function dl(t,e,n,r){this.ray=new Yc(t,e),this.near=n||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function pl(t,e){return t.distance-e.distance}function fl(t,e,n,r){if(!1!==t.visible&&(t.raycast(e,n),!0===r))for(var i=t.children,o=0,a=i.length;o<a;o++)fl(i[o],e,n,!0)}hl.prototype={constructor:hl,crossOrigin:"Anonymous",load:function(t,e,n,r){var i=this.texturePath||ul.extractUrlBase(t),o=this.binaryPath||ul.extractUrlBase(t),a=this;new Xu(this.manager).load(t,function(t){var s=JSON.parse(t),c=o+s.buffers,u=new Xu(a.manager);u.setResponseType("arraybuffer"),u.load(c,function(t){a.parse(t,e,i,s.materials)},n,r)},n,r)},setBinaryPath:function(t){this.binaryPath=t},setCrossOrigin:function(t){this.crossOrigin=t},setTexturePath:function(t){this.texturePath=t},parse:function(t,e,n,r){var i=function(){var e,n,r,i,o,a,s,c,u,l,h,d,p,f,m,v,g,y,b,x=this,w=0,_=[],S=[];function T(t){return t%4?4-t%4:0}function M(t,e){return new Uint8Array(t,e,1)[0]}function A(t,e){return new Uint32Array(t,e,1)[0]}function E(e,n){var r,i,o,a,s,c,u,l,h=new Uint32Array(t,n,3*e);for(r=0;r<e;r++)s=S[2*(o=h[3*r+1])],u=S[2*o+1],c=S[2*(a=h[3*r+2])],l=S[2*a+1],x.faceVertexUvs[0].push([new Cs(S[2*(i=h[3*r])],S[2*i+1]),new Cs(s,u),new Cs(c,l)])}function C(e,n){var r,i,o,a,s,c,u,l,h,d,p,f=new Uint32Array(t,n,4*e);for(r=0;r<e;r++)c=S[2*(o=f[4*r+1])],h=S[2*o+1],u=S[2*(a=f[4*r+2])],d=S[2*a+1],l=S[2*(s=f[4*r+3])],p=S[2*s+1],x.faceVertexUvs[0].push([new Cs(S[2*(i=f[4*r])],S[2*i+1]),new Cs(c,h),new Cs(l,p)]),x.faceVertexUvs[0].push([new Cs(c,h),new Cs(u,d),new Cs(l,p)])}function P(e,n,r){var i,o=new Uint32Array(t,n,3*e),a=new Uint16Array(t,r,e);for(i=0;i<e;i++)x.faces.push(new Ms(o[3*i],o[3*i+1],o[3*i+2],null,null,a[i]))}function O(e,n,r){var i,o,a,s,c,u=new Uint32Array(t,n,4*e),l=new Uint16Array(t,r,e);for(i=0;i<e;i++)a=u[4*i+2],x.faces.push(new Ms(u[4*i],o=u[4*i+1],s=u[4*i+3],null,null,c=l[i])),x.faces.push(new Ms(o,a,s,null,null,c))}function N(e,n,r,i){var o,a,s,c,u,l=new Uint32Array(t,n,3*e),h=new Uint32Array(t,r,3*e),d=new Uint16Array(t,i,e);for(o=0;o<e;o++){a=d[o];var p=_[3*(c=h[3*o+1])],f=_[3*c+1],m=_[3*c+2],v=_[3*(u=h[3*o+2])],g=_[3*u+1],y=_[3*u+2];x.faces.push(new Ms(l[3*o],l[3*o+1],l[3*o+2],[new ss(_[3*(s=h[3*o])],_[3*s+1],_[3*s+2]),new ss(p,f,m),new ss(v,g,y)],null,a))}}function L(e,n,r,i){var o,a,s,c,u,l,h,d,p,f=new Uint32Array(t,n,4*e),m=new Uint32Array(t,r,4*e),v=new Uint16Array(t,i,e);for(o=0;o<e;o++){s=f[4*o+2],u=v[o];var g=_[3*(h=m[4*o+1])],y=_[3*h+1],b=_[3*h+2],w=_[3*(d=m[4*o+2])],S=_[3*d+1],T=_[3*d+2],M=_[3*(p=m[4*o+3])],A=_[3*p+1],E=_[3*p+2];x.faces.push(new Ms(f[4*o],a=f[4*o+1],c=f[4*o+3],[new ss(_[3*(l=m[4*o])],_[3*l+1],_[3*l+2]),new ss(g,y,b),new ss(M,A,E)],null,u)),x.faces.push(new Ms(a,s,c,[new ss(g,y,b),new ss(w,S,T),new ss(M,A,E)],null,u))}}Ls.call(this),w+=(e=function(t,e){return{signature:function(t,e,n){return ul.decodeText(new Uint8Array(t,e,12))}(t,e),header_bytes:M(t,e+12),vertex_coordinate_bytes:M(t,e+13),normal_coordinate_bytes:M(t,e+14),uv_coordinate_bytes:M(t,e+15),vertex_index_bytes:M(t,e+16),normal_index_bytes:M(t,e+17),uv_index_bytes:M(t,e+18),material_index_bytes:M(t,e+19),nvertices:A(t,e+20),nnormals:A(t,e+20+4),nuvs:A(t,e+20+8),ntri_flat:A(t,e+20+12),ntri_smooth:A(t,e+20+16),ntri_flat_uv:A(t,e+20+20),ntri_smooth_uv:A(t,e+20+24),nquad_flat:A(t,e+20+28),nquad_smooth:A(t,e+20+32),nquad_flat_uv:A(t,e+20+36),nquad_smooth_uv:A(t,e+20+40)}}(t,w)).header_bytes,d=e.ntri_flat*(l=3*e.vertex_index_bytes+e.material_index_bytes),p=e.ntri_smooth*(l+3*e.normal_index_bytes),f=e.ntri_flat_uv*(l+3*e.uv_index_bytes),m=e.ntri_smooth_uv*(l+3*e.normal_index_bytes+3*e.uv_index_bytes),v=e.nquad_flat*(h=4*e.vertex_index_bytes+e.material_index_bytes),g=e.nquad_smooth*(h+4*e.normal_index_bytes),y=e.nquad_flat_uv*(h+4*e.uv_index_bytes),w+=function(n){var r,i=e.nvertices,o=new Float32Array(t,w,3*i);for(r=0;r<i;r++)x.vertices.push(new ss(o[3*r],o[3*r+1],o[3*r+2]));return 3*i*Float32Array.BYTES_PER_ELEMENT}(),w+=function(n){var r=e.nnormals;if(r){var i,o=new Int8Array(t,w,3*r);for(i=0;i<r;i++)_.push(o[3*i]/127,o[3*i+1]/127,o[3*i+2]/127)}return 3*r*Int8Array.BYTES_PER_ELEMENT}(),w+=T(3*e.nnormals),u=(c=(s=(a=(o=(i=(r=(n=w+=function(n){var r=e.nuvs;if(r){var i,o=new Float32Array(t,w,2*r);for(i=0;i<r;i++)S.push(o[2*i],o[2*i+1])}return 2*r*Float32Array.BYTES_PER_ELEMENT}())+d+T(2*e.ntri_flat))+p+T(2*e.ntri_smooth))+f+T(2*e.ntri_flat_uv))+m+T(2*e.ntri_smooth_uv))+v+T(2*e.nquad_flat))+g+T(2*e.nquad_smooth))+y+T(2*e.nquad_flat_uv),function(t){var n=e.ntri_flat_uv;if(n){var r=i+n*Uint32Array.BYTES_PER_ELEMENT*3;P(n,i,r+n*Uint32Array.BYTES_PER_ELEMENT*3),E(n,r)}}(),function(t){var n=e.ntri_smooth_uv;if(n){var r=o+n*Uint32Array.BYTES_PER_ELEMENT*3,i=r+n*Uint32Array.BYTES_PER_ELEMENT*3;N(n,o,r,i+n*Uint32Array.BYTES_PER_ELEMENT*3),E(n,i)}}(),function(t){var n=e.nquad_flat_uv;if(n){var r=c+n*Uint32Array.BYTES_PER_ELEMENT*4;O(n,c,r+n*Uint32Array.BYTES_PER_ELEMENT*4),C(n,r)}}(),function(t){var n=e.nquad_smooth_uv;if(n){var r=u+n*Uint32Array.BYTES_PER_ELEMENT*4,i=r+n*Uint32Array.BYTES_PER_ELEMENT*4;L(n,u,r,i+n*Uint32Array.BYTES_PER_ELEMENT*4),C(n,i)}}(),(b=e.ntri_flat)&&P(b,n,n+b*Uint32Array.BYTES_PER_ELEMENT*3),function(t){var n=e.ntri_smooth;if(n){var i=r+n*Uint32Array.BYTES_PER_ELEMENT*3;N(n,r,i,i+n*Uint32Array.BYTES_PER_ELEMENT*3)}}(),function(t){var n=e.nquad_flat;n&&O(n,a,a+n*Uint32Array.BYTES_PER_ELEMENT*4)}(),function(t){var n=e.nquad_smooth;if(n){var r=s+n*Uint32Array.BYTES_PER_ELEMENT*4;L(n,s,r,r+n*Uint32Array.BYTES_PER_ELEMENT*4)}}(),this.computeFaceNormals()};(i.prototype=Object.create(Ls.prototype)).constructor=i,e(new i,cl.prototype.initMaterials(r,n,this.crossOrigin))}},Object.assign(dl.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){var r=n||[];return fl(t,this,r,e),r.sort(pl),r},intersectObjects:function(t,e,n){var r=n||[];if(!1===Array.isArray(t))return console.warn("Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,o=t.length;i<o;i++)fl(t[i],this,r,e);return r.sort(pl),r}});var ml=function(t,e,n){if(t instanceof Tu){console.warn("DragControls: Constructor now expects ( objects, camera, domElement )");var r=t;t=e,e=r}var i=new Jc,o=new dl,a=new Cs,s=new ss,c=new ss,u=null,l=null,h=this;function d(){n.addEventListener("mousemove",f,!1),n.addEventListener("mousedown",m,!1),n.addEventListener("mouseup",v,!1),n.addEventListener("mouseleave",v,!1),n.addEventListener("touchmove",g,!1),n.addEventListener("touchstart",y,!1),n.addEventListener("touchend",b,!1)}function p(){n.removeEventListener("mousemove",f,!1),n.removeEventListener("mousedown",m,!1),n.removeEventListener("mouseup",v,!1),n.removeEventListener("mouseleave",v,!1),n.removeEventListener("touchmove",g,!1),n.removeEventListener("touchstart",y,!1),n.removeEventListener("touchend",b,!1)}function f(r){r.preventDefault();var d=n.getBoundingClientRect();if(a.x=(r.clientX-d.left)/d.width*2-1,a.y=-(r.clientY-d.top)/d.height*2+1,o.setFromCamera(a,e),u&&h.enabled)return o.ray.intersectPlane(i,c)&&u.position.copy(c.sub(s)),void h.dispatchEvent({type:"drag",object:u});o.setFromCamera(a,e);var p=o.intersectObjects(t);if(p.length>0){var f=p[0].object;i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),f.position),l!==f&&(h.dispatchEvent({type:"hoveron",object:f}),n.style.cursor="pointer",l=f)}else null!==l&&(h.dispatchEvent({type:"hoveroff",object:l}),n.style.cursor="auto",l=null)}function m(r){r.preventDefault(),o.setFromCamera(a,e);var l=o.intersectObjects(t);l.length>0&&(u=l[0].object,o.ray.intersectPlane(i,c)&&s.copy(c).sub(u.position),n.style.cursor="move",h.dispatchEvent({type:"dragstart",object:u}))}function v(t){t.preventDefault(),u&&(h.dispatchEvent({type:"dragend",object:u}),u=null),n.style.cursor="auto"}function g(t){t.preventDefault(),t=t.changedTouches[0];var r=n.getBoundingClientRect();if(a.x=(t.clientX-r.left)/r.width*2-1,a.y=-(t.clientY-r.top)/r.height*2+1,o.setFromCamera(a,e),u&&h.enabled)return o.ray.intersectPlane(i,c)&&u.position.copy(c.sub(s)),void h.dispatchEvent({type:"drag",object:u})}function y(r){r.preventDefault(),r=r.changedTouches[0];var l=n.getBoundingClientRect();a.x=(r.clientX-l.left)/l.width*2-1,a.y=-(r.clientY-l.top)/l.height*2+1,o.setFromCamera(a,e);var d=o.intersectObjects(t);d.length>0&&(u=d[0].object,i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),u.position),o.ray.intersectPlane(i,c)&&s.copy(c).sub(u.position),n.style.cursor="move",h.dispatchEvent({type:"dragstart",object:u}))}function b(t){t.preventDefault(),u&&(h.dispatchEvent({type:"dragend",object:u}),u=null),n.style.cursor="auto"}d(),this.enabled=!0,this.activate=d,this.deactivate=p,this.dispose=function(){p()},this.setObjects=function(){console.error("DragControls: setObjects() has been removed.")},this.on=function(t,e){console.warn("DragControls: on() has been deprecated. Use addEventListener() instead."),h.addEventListener(t,e)},this.off=function(t,e){console.warn("DragControls: off() has been deprecated. Use removeEventListener() instead."),h.removeEventListener(t,e)},this.notify=function(t){console.error("DragControls: notify() has been deprecated. Use dispatchEvent() instead."),h.dispatchEvent({type:t})}};function vl(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}(ml.prototype=Object.create(us.prototype)).constructor=ml,Object.assign(vl.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(os.clamp(t.y/this.radius,-1,1))),this}});var gl=function(t,e){e=void 0!==e?e:document,this.enabled=!0,this.center=new ss,this.panSpeed=.001,this.zoomSpeed=.001,this.rotationSpeed=.005;var n=this,r=new ss,i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},o=i.NONE,a=this.center,s=new ds,c=new Cs,u=new Cs,l=new vl,h={type:"change"};function d(t){!1!==n.enabled&&(0===t.button?o=i.ROTATE:1===t.button?o=i.ZOOM:2===t.button&&(o=i.PAN),u.set(t.clientX,t.clientY),e.addEventListener("mousemove",p,!1),e.addEventListener("mouseup",f,!1),e.addEventListener("mouseout",f,!1),e.addEventListener("dblclick",f,!1))}function p(t){if(!1!==n.enabled){c.set(t.clientX,t.clientY);var e=c.x-u.x,r=c.y-u.y;o===i.ROTATE?n.rotate(new ss(-e*n.rotationSpeed,-r*n.rotationSpeed,0)):o===i.ZOOM?n.zoom(new ss(0,0,r)):o===i.PAN&&n.pan(new ss(-e,r,0)),u.set(t.clientX,t.clientY)}}function f(t){e.removeEventListener("mousemove",p,!1),e.removeEventListener("mouseup",f,!1),e.removeEventListener("mouseout",f,!1),e.removeEventListener("dblclick",f,!1),o=i.NONE}function m(t){t.preventDefault(),n.zoom(new ss(0,0,t.deltaY))}function v(t){t.preventDefault()}this.focus=function(e){var r,i=(new As).setFromObject(e);!1===i.isEmpty()?(a.copy(i.getCenter()),r=i.getBoundingSphere().radius):(a.setFromMatrixPosition(e.matrixWorld),r=.1);var o=new ss(0,0,1);o.applyQuaternion(t.quaternion),o.multiplyScalar(4*r),t.position.copy(a).add(o),n.dispatchEvent(h)},this.pan=function(e){var r=t.position.distanceTo(a);e.multiplyScalar(r*n.panSpeed),e.applyMatrix3(s.getNormalMatrix(t.matrix)),t.position.add(e),a.add(e),n.dispatchEvent(h)},this.zoom=function(e){var r=t.position.distanceTo(a);e.multiplyScalar(r*n.zoomSpeed),e.length()>r||(e.applyMatrix3(s.getNormalMatrix(t.matrix)),t.position.add(e),n.dispatchEvent(h))},this.rotate=function(e){r.copy(t.position).sub(a),l.setFromVector3(r),l.theta+=e.x,l.phi+=e.y,l.makeSafe(),r.setFromSpherical(l),t.position.copy(a).add(r),t.lookAt(a),n.dispatchEvent(h)},this.dispose=function(){e.removeEventListener("contextmenu",v,!1),e.removeEventListener("mousedown",d,!1),e.removeEventListener("wheel",m,!1),e.removeEventListener("mousemove",p,!1),e.removeEventListener("mouseup",f,!1),e.removeEventListener("mouseout",f,!1),e.removeEventListener("dblclick",f,!1),e.removeEventListener("touchstart",x,!1),e.removeEventListener("touchmove",w,!1)},e.addEventListener("contextmenu",v,!1),e.addEventListener("mousedown",d,!1),e.addEventListener("wheel",m,!1);var g=[new ss,new ss,new ss],y=[new ss,new ss,new ss],b=null;function x(t){if(!1!==n.enabled){switch(t.touches.length){case 1:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[0].pageX,t.touches[0].pageY,0);break;case 2:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[1].pageX,t.touches[1].pageY,0),b=g[0].distanceTo(g[1])}y[0].copy(g[0]),y[1].copy(g[1])}}function w(t){if(!1!==n.enabled){switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[0].pageX,t.touches[0].pageY,0),n.rotate(g[0].sub(o(g[0],y)).multiplyScalar(-n.rotationSpeed));break;case 2:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[1].pageX,t.touches[1].pageY,0);var e=g[0].distanceTo(g[1]);n.zoom(new ss(0,0,b-e)),b=e;var r=g[0].clone().sub(o(g[0],y)),i=g[1].clone().sub(o(g[1],y));r.x=-r.x,i.x=-i.x,n.pan(r.add(i).multiplyScalar(.5))}y[0].copy(g[0]),y[1].copy(g[1])}function o(t,e){var n=e[0];for(var r in e)n.distanceTo(t)>e[r].distanceTo(t)&&(n=e[r]);return n}}e.addEventListener("touchstart",x,!1),e.addEventListener("touchmove",w,!1)};(gl.prototype=Object.create(us.prototype)).constructor=gl;var yl=function(t,e){var n,r,i,o,a;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new ss,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.panningMode=bl,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),d=h.NONE},this.update=(n=new ss,r=(new cs).setFromUnitVectors(t.up,new ss(0,1,0)),i=r.clone().inverse(),o=new ss,a=new cs,function(){var t=s.object.position;return n.copy(t).sub(s.target),n.applyQuaternion(r),f.setFromVector3(n),s.autoRotate&&d===h.NONE&&P(2*Math.PI/60/60*s.autoRotateSpeed),f.theta+=m.theta,f.phi+=m.phi,f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=v,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),s.target.add(g),n.setFromSpherical(f),n.applyQuaternion(i),t.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,g.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v=1,!!(y||o.distanceToSquared(s.object.position)>p||8*(1-a.dot(s.object.quaternion))>p)&&(s.dispatchEvent(c),o.copy(s.object.position),a.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",W,!1),s.domElement.removeEventListener("mousedown",U,!1),s.domElement.removeEventListener("wheel",B,!1),s.domElement.removeEventListener("touchstart",V,!1),s.domElement.removeEventListener("touchend",H,!1),s.domElement.removeEventListener("touchmove",G,!1),document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",j,!1),window.removeEventListener("keydown",z,!1)};var s=this,c={type:"change"},u={type:"start"},l={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},d=h.NONE,p=1e-6,f=new vl,m=new vl,v=1,g=new ss,y=!1,b=new Cs,x=new Cs,w=new Cs,_=new Cs,S=new Cs,T=new Cs,M=new Cs,A=new Cs,E=new Cs;function C(){return Math.pow(.95,s.zoomSpeed)}function P(t){m.theta-=t}function O(t){m.phi-=t}var N,L=(N=new ss,function(t,e){N.setFromMatrixColumn(e,0),N.multiplyScalar(-t),g.add(N)}),I=function(){var t=new ss;return function(e,n){switch(s.panningMode){case bl:t.setFromMatrixColumn(n,1);break;case xl:t.setFromMatrixColumn(n,0),t.crossVectors(s.object.up,t)}t.multiplyScalar(e),g.add(t)}}(),R=function(){var t=new ss;return function(e,n){var r=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){t.copy(s.object.position).sub(s.target);var i=t.length();i*=Math.tan(s.object.fov/2*Math.PI/180),L(2*e*i/r.clientHeight,s.object.matrix),I(2*n*i/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(e*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),I(n*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function D(t){s.object.isPerspectiveCamera?v/=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(t){s.object.isPerspectiveCamera?v*=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function U(t){if(!1!==s.enabled){switch(t.preventDefault(),t.button){case s.mouseButtons.ORBIT:if(!1===s.enableRotate)return;!function(t){b.set(t.clientX,t.clientY)}(t),d=h.ROTATE;break;case s.mouseButtons.ZOOM:if(!1===s.enableZoom)return;!function(t){M.set(t.clientX,t.clientY)}(t),d=h.DOLLY;break;case s.mouseButtons.PAN:if(!1===s.enablePan)return;!function(t){_.set(t.clientX,t.clientY)}(t),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",j,!1),s.dispatchEvent(u))}}function k(t){if(!1!==s.enabled)switch(t.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;!function(t){x.set(t.clientX,t.clientY),w.subVectors(x,b).multiplyScalar(s.rotateSpeed);var e=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*w.x/e.clientWidth),O(2*Math.PI*w.y/e.clientHeight),b.copy(x),s.update()}(t);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(t){A.set(t.clientX,t.clientY),E.subVectors(A,M),E.y>0?D(C()):E.y<0&&F(C()),M.copy(A),s.update()}(t);break;case h.PAN:if(!1===s.enablePan)return;!function(t){S.set(t.clientX,t.clientY),T.subVectors(S,_).multiplyScalar(s.panSpeed),R(T.x,T.y),_.copy(S),s.update()}(t)}}function j(t){!1!==s.enabled&&(document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",j,!1),s.dispatchEvent(l),d=h.NONE)}function B(t){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(t.preventDefault(),t.stopPropagation(),s.dispatchEvent(u),function(t){t.deltaY<0?F(C()):t.deltaY>0&&D(C()),s.update()}(t),s.dispatchEvent(l))}function z(t){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(t){switch(t.keyCode){case s.keys.UP:R(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:R(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:R(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:R(-s.keyPanSpeed,0),s.update()}}(t)}function V(t){if(!1!==s.enabled){switch(t.touches.length){case 1:if(!1===s.enableRotate)return;!function(t){b.set(t.touches[0].pageX,t.touches[0].pageY)}(t),d=h.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);M.set(0,r)}(t),d=h.TOUCH_DOLLY;break;case 3:if(!1===s.enablePan)return;!function(t){_.set(t.touches[0].pageX,t.touches[0].pageY)}(t),d=h.TOUCH_PAN;break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(u)}}function G(t){if(!1!==s.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===s.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(t){x.set(t.touches[0].pageX,t.touches[0].pageY),w.subVectors(x,b).multiplyScalar(s.rotateSpeed);var e=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*w.x/e.clientWidth),O(2*Math.PI*w.y/e.clientHeight),b.copy(x),s.update()}(t);break;case 2:if(!1===s.enableZoom)return;if(d!==h.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);A.set(0,r),E.subVectors(A,M),E.y>0?F(C()):E.y<0&&D(C()),M.copy(A),s.update()}(t);break;case 3:if(!1===s.enablePan)return;if(d!==h.TOUCH_PAN)return;!function(t){S.set(t.touches[0].pageX,t.touches[0].pageY),T.subVectors(S,_).multiplyScalar(s.panSpeed),R(T.x,T.y),_.copy(S),s.update()}(t);break;default:d=h.NONE}}function H(t){!1!==s.enabled&&(s.dispatchEvent(l),d=h.NONE)}function W(t){!1!==s.enabled&&t.preventDefault()}s.domElement.addEventListener("contextmenu",W,!1),s.domElement.addEventListener("mousedown",U,!1),s.domElement.addEventListener("wheel",B,!1),s.domElement.addEventListener("touchstart",V,!1),s.domElement.addEventListener("touchend",H,!1),s.domElement.addEventListener("touchmove",G,!1),window.addEventListener("keydown",z,!1),this.update()};(yl.prototype=Object.create(us.prototype)).constructor=yl,Object.defineProperties(yl.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}});var bl=0,xl=1,wl=function(t,e){var n=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new ss;var i=!0,o=r.NONE,a=r.NONE,s=new ss,c=new ss,u=new ss,l=new Cs,h=new Cs,d=0,p=0,f=new Cs,m=new Cs;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var v={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};var b,x,w,_,S,T,M=(b=new Cs,function(t,e){return b.set((t-n.screen.left)/n.screen.width,(e-n.screen.top)/n.screen.height),b}),A=function(){var t=new ss,e=new ss,r=new ss;return function(i,o){r.set((i-.5*n.screen.width-n.screen.left)/n.radius,(.5*n.screen.height+n.screen.top-o)/n.radius,0);var a=r.length();return n.noRoll?r.z=a<Math.SQRT1_2?Math.sqrt(1-a*a):.5/a:a>1?r.normalize():r.z=Math.sqrt(1-a*a),s.copy(n.object.position).sub(n.target),t.copy(n.object.up).setLength(r.y),t.add(e.copy(n.object.up).cross(s).setLength(r.x)),t.add(s.setLength(r.z)),t}}();function E(t){!1!==n.enabled&&(window.removeEventListener("keydown",E),a=o,o===r.NONE&&(t.keyCode!==n.keys[r.ROTATE]||n.noRotate?t.keyCode!==n.keys[r.ZOOM]||n.noZoom?t.keyCode!==n.keys[r.PAN]||n.noPan||(o=r.PAN):o=r.ZOOM:o=r.ROTATE))}function C(t){!1!==n.enabled&&(o=a,window.addEventListener("keydown",E,!1))}function P(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),o===r.NONE&&(o=t.button),o!==r.ROTATE||n.noRotate?o!==r.ZOOM||n.noZoom?o!==r.PAN||n.noPan||(f.copy(M(t.pageX,t.pageY)),m.copy(f)):(l.copy(M(t.pageX,t.pageY)),h.copy(l)):(c.copy(A(t.pageX,t.pageY)),u.copy(c)),document.addEventListener("mousemove",O,!1),document.addEventListener("mouseup",N,!1),n.dispatchEvent(g))}function O(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),o!==r.ROTATE||n.noRotate?o!==r.ZOOM||n.noZoom?o!==r.PAN||n.noPan||m.copy(M(t.pageX,t.pageY)):h.copy(M(t.pageX,t.pageY)):u.copy(A(t.pageX,t.pageY)))}function N(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),o=r.NONE,document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",N),n.dispatchEvent(y))}function L(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),l.y+=.01*t.deltaY,n.dispatchEvent(g),n.dispatchEvent(y))}function I(t){if(!1!==n.enabled){switch(t.touches.length){case 1:o=r.TOUCH_ROTATE,c.copy(A(t.touches[0].pageX,t.touches[0].pageY)),u.copy(c);break;case 2:o=r.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=d=Math.sqrt(e*e+i*i),f.copy(M((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),m.copy(f);break;default:o=r.NONE}n.dispatchEvent(g)}}function R(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:u.copy(A(t.touches[0].pageX,t.touches[0].pageY));break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=Math.sqrt(e*e+i*i),m.copy(M((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2));break;default:o=r.NONE}}function D(t){if(!1!==n.enabled){switch(t.touches.length){case 1:u.copy(A(t.touches[0].pageX,t.touches[0].pageY)),c.copy(u);break;case 2:d=p=0,m.copy(M((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),f.copy(m)}o=r.NONE,n.dispatchEvent(y)}}function F(t){t.preventDefault()}this.rotateCamera=(x=new ss,w=new cs,function(){var t=Math.acos(c.dot(u)/c.length()/u.length());t&&(x.crossVectors(c,u).normalize(),w.setFromAxisAngle(x,-(t*=n.rotateSpeed)),s.applyQuaternion(w),n.object.up.applyQuaternion(w),u.applyQuaternion(w),n.staticMoving?c.copy(u):(w.setFromAxisAngle(x,t*(n.dynamicDampingFactor-1)),c.applyQuaternion(w)),i=!0)}),this.zoomCamera=function(){if(o===r.TOUCH_ZOOM_PAN){var t=p/d;d=p,n.object.zoom*=t,i=!0}else t=1+(h.y-l.y)*n.zoomSpeed,Math.abs(t-1)>1e-6&&t>0&&(n.object.zoom/=t,n.staticMoving?l.copy(h):l.y+=(h.y-l.y)*this.dynamicDampingFactor,i=!0)},this.panCamera=(_=new Cs,S=new ss,T=new ss,function(){if(_.copy(m).sub(f),_.lengthSq()){var t=(n.object.top-n.object.bottom)/n.object.zoom;_.x*=(n.object.right-n.object.left)/n.object.zoom,_.y*=t,T.copy(s).cross(n.object.up).setLength(_.x),T.add(S.copy(n.object.up).setLength(_.y)),n.object.position.add(T),n.target.add(T),n.staticMoving?f.copy(m):f.add(_.subVectors(m,f).multiplyScalar(n.dynamicDampingFactor)),i=!0}}),this.update=function(){s.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||(n.zoomCamera(),i&&n.object.updateProjectionMatrix()),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,s),n.object.lookAt(n.target),i&&(n.dispatchEvent(v),i=!1)},this.reset=function(){o=r.NONE,a=r.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),s.subVectors(n.object.position,n.target),n.object.left=n.left0,n.object.right=n.right0,n.object.top=n.top0,n.object.bottom=n.bottom0,n.object.lookAt(n.target),n.dispatchEvent(v),i=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",F,!1),this.domElement.removeEventListener("mousedown",P,!1),this.domElement.removeEventListener("wheel",L,!1),this.domElement.removeEventListener("touchstart",I,!1),this.domElement.removeEventListener("touchend",D,!1),this.domElement.removeEventListener("touchmove",R,!1),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",N,!1),window.removeEventListener("keydown",E,!1),window.removeEventListener("keyup",C,!1)},this.domElement.addEventListener("contextmenu",F,!1),this.domElement.addEventListener("mousedown",P,!1),this.domElement.addEventListener("wheel",L,!1),this.domElement.addEventListener("touchstart",I,!1),this.domElement.addEventListener("touchend",D,!1),this.domElement.addEventListener("touchmove",R,!1),window.addEventListener("keydown",E,!1),window.addEventListener("keyup",C,!1),this.handleResize(),this.update()};(wl.prototype=Object.create(us.prototype)).constructor=wl;var _l=function(t,e){var n=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new ss;var i=new ss,o=r.NONE,a=r.NONE,s=new ss,c=new Cs,u=new Cs,l=new ss,h=0,d=new Cs,p=new Cs,f=0,m=0,v=new Cs,g=new Cs;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},b={type:"start"},x={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};var w,_,S,T,M,A,E,C,P,O,N,L=(w=new Cs,function(t,e){return w.set((t-n.screen.left)/n.screen.width,(e-n.screen.top)/n.screen.height),w}),I=function(){var t=new Cs;return function(e,r){return t.set((e-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(n.screen.height+2*(n.screen.top-r))/n.screen.width),t}}();function R(t){!1!==n.enabled&&(window.removeEventListener("keydown",R),a=o,o===r.NONE&&(t.keyCode!==n.keys[r.ROTATE]||n.noRotate?t.keyCode!==n.keys[r.ZOOM]||n.noZoom?t.keyCode!==n.keys[r.PAN]||n.noPan||(o=r.PAN):o=r.ZOOM:o=r.ROTATE))}function D(t){!1!==n.enabled&&(o=a,window.addEventListener("keydown",R,!1))}function F(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),o===r.NONE&&(o=t.button),o!==r.ROTATE||n.noRotate?o!==r.ZOOM||n.noZoom?o!==r.PAN||n.noPan||(v.copy(L(t.pageX,t.pageY)),g.copy(v)):(d.copy(L(t.pageX,t.pageY)),p.copy(d)):(u.copy(I(t.pageX,t.pageY)),c.copy(u)),document.addEventListener("mousemove",U,!1),document.addEventListener("mouseup",k,!1),n.dispatchEvent(b))}function U(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),o!==r.ROTATE||n.noRotate?o!==r.ZOOM||n.noZoom?o!==r.PAN||n.noPan||g.copy(L(t.pageX,t.pageY)):p.copy(L(t.pageX,t.pageY)):(c.copy(u),u.copy(I(t.pageX,t.pageY))))}function k(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),o=r.NONE,document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",k),n.dispatchEvent(x))}function j(t){if(!1!==n.enabled&&!0!==n.noZoom){switch(t.preventDefault(),t.stopPropagation(),t.deltaMode){case 2:d.y-=.025*t.deltaY;break;case 1:d.y-=.01*t.deltaY;break;default:d.y-=25e-5*t.deltaY}n.dispatchEvent(b),n.dispatchEvent(x)}}function B(t){if(!1!==n.enabled){switch(t.touches.length){case 1:o=r.TOUCH_ROTATE,u.copy(I(t.touches[0].pageX,t.touches[0].pageY)),c.copy(u);break;default:o=r.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;m=f=Math.sqrt(e*e+i*i),v.copy(L((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),g.copy(v)}n.dispatchEvent(b)}}function z(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:c.copy(u),u.copy(I(t.touches[0].pageX,t.touches[0].pageY));break;default:var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY;m=Math.sqrt(e*e+r*r),g.copy(L((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2))}}function V(t){if(!1!==n.enabled){switch(t.touches.length){case 0:o=r.NONE;break;case 1:o=r.TOUCH_ROTATE,u.copy(I(t.touches[0].pageX,t.touches[0].pageY)),c.copy(u)}n.dispatchEvent(x)}}function G(t){!1!==n.enabled&&t.preventDefault()}this.rotateCamera=(S=new ss,T=new cs,M=new ss,A=new ss,E=new ss,C=new ss,function(){C.set(u.x-c.x,u.y-c.y,0),(_=C.length())?(s.copy(n.object.position).sub(n.target),M.copy(s).normalize(),A.copy(n.object.up).normalize(),E.crossVectors(A,M).normalize(),A.setLength(u.y-c.y),E.setLength(u.x-c.x),C.copy(A.add(E)),S.crossVectors(C,s).normalize(),T.setFromAxisAngle(S,_*=n.rotateSpeed),s.applyQuaternion(T),n.object.up.applyQuaternion(T),l.copy(S),h=_):!n.staticMoving&&h&&(h*=Math.sqrt(1-n.dynamicDampingFactor),s.copy(n.object.position).sub(n.target),T.setFromAxisAngle(l,h),s.applyQuaternion(T),n.object.up.applyQuaternion(T)),c.copy(u)}),this.zoomCamera=function(){var t;o===r.TOUCH_ZOOM_PAN?(t=f/m,f=m,s.multiplyScalar(t)):(1!=(t=1+(p.y-d.y)*n.zoomSpeed)&&t>0&&s.multiplyScalar(t),n.staticMoving?d.copy(p):d.y+=(p.y-d.y)*this.dynamicDampingFactor)},this.panCamera=(P=new Cs,O=new ss,N=new ss,function(){P.copy(g).sub(v),P.lengthSq()&&(P.multiplyScalar(s.length()*n.panSpeed),N.copy(s).cross(n.object.up).setLength(P.x),N.add(O.copy(n.object.up).setLength(P.y)),n.object.position.add(N),n.target.add(N),n.staticMoving?v.copy(g):v.add(P.subVectors(g,v).multiplyScalar(n.dynamicDampingFactor)))}),this.checkDistances=function(){n.noZoom&&n.noPan||(s.lengthSq()>n.maxDistance*n.maxDistance&&(n.object.position.addVectors(n.target,s.setLength(n.maxDistance)),d.copy(p)),s.lengthSq()<n.minDistance*n.minDistance&&(n.object.position.addVectors(n.target,s.setLength(n.minDistance)),d.copy(p)))},this.update=function(){s.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,s),n.checkDistances(),n.object.lookAt(n.target),i.distanceToSquared(n.object.position)>1e-6&&(n.dispatchEvent(y),i.copy(n.object.position))},this.reset=function(){o=r.NONE,a=r.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),s.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(y),i.copy(n.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",G,!1),this.domElement.removeEventListener("mousedown",F,!1),this.domElement.removeEventListener("wheel",j,!1),this.domElement.removeEventListener("touchstart",B,!1),this.domElement.removeEventListener("touchend",V,!1),this.domElement.removeEventListener("touchmove",z,!1),document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",k,!1),window.removeEventListener("keydown",R,!1),window.removeEventListener("keyup",D,!1)},this.domElement.addEventListener("contextmenu",G,!1),this.domElement.addEventListener("mousedown",F,!1),this.domElement.addEventListener("wheel",j,!1),this.domElement.addEventListener("touchstart",B,!1),this.domElement.addEventListener("touchend",V,!1),this.domElement.addEventListener("touchmove",z,!1),window.addEventListener("keydown",R,!1),window.addEventListener("keyup",D,!1),this.handleResize(),this.update()};function Sl(t,e,n,r){Ls.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new Tl(t,e,n,r)),this.mergeVertices()}function Tl(t,e,n,r){Xs.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1;var i=[],o=[];function a(t,e,n,r){var i,o,a=Math.pow(2,r),c=[];for(i=0;i<=a;i++){c[i]=[];var u=t.clone().lerp(n,i/a),l=e.clone().lerp(n,i/a),h=a-i;for(o=0;o<=h;o++)c[i][o]=0===o&&i===a?u:u.clone().lerp(l,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var d=Math.floor(o/2);o%2==0?(s(c[i][d+1]),s(c[i+1][d]),s(c[i][d])):(s(c[i][d+1]),s(c[i+1][d+1]),s(c[i+1][d]))}}function s(t){i.push(t.x,t.y,t.z)}function c(e,n){var r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function u(t,e,n,r){r<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=r/2/Math.PI+.5)}function l(t){return Math.atan2(t.z,-t.x)}!function(t){for(var n=new ss,r=new ss,i=new ss,o=0;o<e.length;o+=3)c(e[o+0],n),c(e[o+1],r),c(e[o+2],i),a(n,r,i,t)}(r=r||0),function(t){for(var e=new ss,n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){for(var t=new ss,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var n=l(t)/2/Math.PI+.5,r=(a=t,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(n,1-r)}var a;(function(){for(var t=new ss,e=new ss,n=new ss,r=new ss,a=new Cs,s=new Cs,c=new Cs,h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),c.set(o[d+4],o[d+5]),r.copy(t).add(e).add(n).divideScalar(3);var p=l(r);u(a,d+0,t,p),u(s,d+2,e,p),u(c,d+4,n,p)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],n=o[t+2],r=o[t+4],i=Math.max(e,n,r),a=Math.min(e,n,r);i>.9&&a<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),r<.2&&(o[t+4]+=1))}}()}(),this.addAttribute("position",new Vs(i,3)),this.addAttribute("normal",new Vs(i.slice(),3)),this.addAttribute("uv",new Vs(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Ml(t,e){Ls.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Al(t,e)),this.mergeVertices()}function Al(t,e){Tl.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function El(t,e,n,r,i){Ls.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new Cl(t,e,n,r,i)),this.mergeVertices()}function Cl(t,e,n,r,i){Xs.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,a,s=[],c=[],u=[],l=[],h=new ss,d=new ss,p=new ss;for(o=0;o<=n;o++)for(a=0;a<=r;a++){var f=a/r*i,m=o/n*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),c.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),u.push(p.x,p.y,p.z),l.push(a/r),l.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=r;a++){var v=(r+1)*(o-1)+a-1,g=(r+1)*(o-1)+a,y=(r+1)*o+a;s.push((r+1)*o+a-1,v,y),s.push(v,g,y)}this.setIndex(s),this.addAttribute("position",new Vs(c,3)),this.addAttribute("normal",new Vs(u,3)),this.addAttribute("uv",new Vs(l,2))}(_l.prototype=Object.create(us.prototype)).constructor=_l,(Sl.prototype=Object.create(Ls.prototype)).constructor=Sl,(Tl.prototype=Object.create(Xs.prototype)).constructor=Tl,(Ml.prototype=Object.create(Ls.prototype)).constructor=Ml,(Al.prototype=Object.create(Tl.prototype)).constructor=Al,(El.prototype=Object.create(Ls.prototype)).constructor=El,(Cl.prototype=Object.create(Xs.prototype)).constructor=Cl;var Pl=function(t){Xc.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=sc,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(Pl.prototype=Object.create(Xc.prototype)).constructor=Pl;var Ol=function(t){qc.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(Ol.prototype=Object.create(qc.prototype)).constructor=Ol;var Nl=new Pl({visible:!1,transparent:!1}),Ll=function(){this.init=function(){ys.call(this),this.handles=new ys,this.pickers=new ys,this.planes=new ys,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var t=new Du(50,50,2,2),e=new Xc({visible:!1,side:uc}),n={XY:new Kc(t,e),YZ:new Kc(t,e),XZ:new Kc(t,e),XYZE:new Kc(t,e)};for(var r in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[r].name=r,this.planes.add(n[r]),this.planes[r]=n[r];var i=function(t,e){for(var n in t)for(r=t[n].length;r--;){var i=t[n][r][0],o=t[n][r][1],a=t[n][r][2];i.name=n,i.renderOrder=1/0,o&&i.position.set(o[0],o[1],o[2]),a&&i.rotation.set(a[0],a[1],a[2]),e.add(i)}};i(this.handleGizmos,this.handles),i(this.pickerGizmos,this.pickers),this.traverse(function(t){if(t instanceof Kc){t.updateMatrix();var e=t.geometry.clone();e.applyMatrix(t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}})},this.highlight=function(t){this.traverse(function(e){e.material&&e.material.highlight&&e.material.highlight(e.name===t)})}};(Ll.prototype=Object.create(ys.prototype)).constructor=Ll,Ll.prototype.update=function(t,e){var n=new ss(0,0,0),r=new ss(0,1,0),i=new as;this.traverse(function(o){-1!==o.name.search("E")?o.quaternion.setFromRotationMatrix(i.lookAt(e,n,r)):-1===o.name.search("X")&&-1===o.name.search("Y")&&-1===o.name.search("Z")||o.quaternion.setFromEuler(t)})};var Il=function(){Ll.call(this);var t=new Ls,e=new Kc(new ou(0,.05,.2,12,1,!1));e.position.y=.5,e.updateMatrix(),t.merge(e.geometry,e.matrix);var n=new Xs;n.addAttribute("position",new Vs([0,0,0,1,0,0],3));var r=new Xs;r.addAttribute("position",new Vs([0,0,0,0,1,0],3));var i=new Xs;i.addAttribute("position",new Vs([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new Kc(t,new Pl({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new $c(n,new Ol({color:16711680}))]],Y:[[new Kc(t,new Pl({color:65280})),[0,.5,0]],[new $c(r,new Ol({color:65280}))]],Z:[[new Kc(t,new Pl({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new $c(i,new Ol({color:255}))]],XYZ:[[new Kc(new Ml(.1,0),new Pl({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new Kc(new Du(.29,.29),new Pl({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new Kc(new Du(.29,.29),new Pl({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Kc(new Du(.29,.29),new Pl({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new Kc(new au(.2,0,1,4,1,!1),Nl),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Kc(new au(.2,0,1,4,1,!1),Nl),[0,.6,0]]],Z:[[new Kc(new au(.2,0,1,4,1,!1),Nl),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Kc(new Ml(.2,0),Nl)]],XY:[[new Kc(new Du(.4,.4),Nl),[.2,.2,0]]],YZ:[[new Kc(new Du(.4,.4),Nl),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Kc(new Du(.4,.4),Nl),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(t,e){var n=new as;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"===t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"===t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"===t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===t&&(this.activePlane=this.planes.XYZE),"XY"===t&&(this.activePlane=this.planes.XY),"YZ"===t&&(this.activePlane=this.planes.YZ),"XZ"===t&&(this.activePlane=this.planes.XZ)},this.init()};(Il.prototype=Object.create(Ll.prototype)).constructor=Il;var Rl=function(){Ll.call(this);var t=function(t,e,n){var r=new Xs,i=[];n=n||1;for(var o=0;o<=64*n;++o)"x"===e&&i.push(0,Math.cos(o/32*Math.PI)*t,Math.sin(o/32*Math.PI)*t),"y"===e&&i.push(Math.cos(o/32*Math.PI)*t,0,Math.sin(o/32*Math.PI)*t),"z"===e&&i.push(Math.sin(o/32*Math.PI)*t,Math.cos(o/32*Math.PI)*t,0);return r.addAttribute("position",new Vs(i,3)),r};this.handleGizmos={X:[[new $c(new t(1,"x",.5),new Ol({color:16711680}))]],Y:[[new $c(new t(1,"y",.5),new Ol({color:65280}))]],Z:[[new $c(new t(1,"z",.5),new Ol({color:255}))]],E:[[new $c(new t(1.25,"z",1),new Ol({color:13421568}))]],XYZE:[[new $c(new t(1,"z",1),new Ol({color:7895160}))]]},this.pickerGizmos={X:[[new Kc(new Cl(1,.12,4,12,Math.PI),Nl),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Kc(new Cl(1,.12,4,12,Math.PI),Nl),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Kc(new Cl(1,.12,4,12,Math.PI),Nl),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Kc(new Cl(1.25,.12,2,24),Nl)]],XYZE:[[new Kc]]},this.setActivePlane=function(t){"E"===t&&(this.activePlane=this.planes.XYZE),"X"===t&&(this.activePlane=this.planes.YZ),"Y"===t&&(this.activePlane=this.planes.XZ),"Z"===t&&(this.activePlane=this.planes.XY)},this.update=function(t,e){Ll.prototype.update.apply(this,arguments);var n=new as,r=new ls(0,0,1),i=new cs,o=new ss(1,0,0),a=new ss(0,1,0),s=new ss(0,0,1),c=new cs,u=new cs,l=new cs,h=e.clone();r.copy(this.planes.XY.rotation),i.setFromEuler(r),n.makeRotationFromQuaternion(i).getInverse(n),h.applyMatrix4(n),this.traverse(function(t){i.setFromEuler(r),"X"===t.name&&(c.setFromAxisAngle(o,Math.atan2(-h.y,h.z)),i.multiplyQuaternions(i,c),t.quaternion.copy(i)),"Y"===t.name&&(u.setFromAxisAngle(a,Math.atan2(h.x,h.z)),i.multiplyQuaternions(i,u),t.quaternion.copy(i)),"Z"===t.name&&(l.setFromAxisAngle(s,Math.atan2(h.y,h.x)),i.multiplyQuaternions(i,l),t.quaternion.copy(i))})},this.init()};(Rl.prototype=Object.create(Ll.prototype)).constructor=Rl;var Dl=function(){Ll.call(this);var t=new Ls,e=new Kc(new ru(.125,.125,.125));e.position.y=.5,e.updateMatrix(),t.merge(e.geometry,e.matrix);var n=new Xs;n.addAttribute("position",new Vs([0,0,0,1,0,0],3));var r=new Xs;r.addAttribute("position",new Vs([0,0,0,0,1,0],3));var i=new Xs;i.addAttribute("position",new Vs([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new Kc(t,new Pl({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new $c(n,new Ol({color:16711680}))]],Y:[[new Kc(t,new Pl({color:65280})),[0,.5,0]],[new $c(r,new Ol({color:65280}))]],Z:[[new Kc(t,new Pl({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new $c(i,new Ol({color:255}))]],XYZ:[[new Kc(new iu(.125,.125,.125),new Pl({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new Kc(new au(.2,0,1,4,1,!1),Nl),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Kc(new au(.2,0,1,4,1,!1),Nl),[0,.6,0]]],Z:[[new Kc(new au(.2,0,1,4,1,!1),Nl),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Kc(new iu(.4,.4,.4),Nl)]]},this.setActivePlane=function(t,e){var n=new as;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"===t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"===t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"===t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===t&&(this.activePlane=this.planes.XYZE)},this.init()};(Dl.prototype=Object.create(Ll.prototype)).constructor=Dl;var Fl=function(t,e){ys.call(this),e=void 0!==e?e:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var n=this,r="translate",i=!1,o={translate:new Il,rotate:new Rl,scale:new Dl};for(var a in o){var s=o[a];s.visible=a===r,this.add(s)}var c={type:"change"},u={type:"mouseDown"},l={type:"mouseUp",mode:r},h={type:"objectChange"},d=new dl,p=new Cs,f=new ss,m=new ss,v=new ss,g=new ss,y=1,b=new as,x=new ss,w=new as,_=new ss,S=new cs,T=new ss(1,0,0),M=new ss(0,1,0),A=new ss(0,0,1),E=new cs,C=new cs,P=new cs,O=new cs,N=new cs,L=new ss,I=new ss,R=new as,D=new as,F=new ss,U=new ss,k=new ls,j=new as,B=new ss,z=new ls;function V(t){if(void 0!==n.object&&!0!==i&&(void 0===t.button||0===t.button)){var e=X(t.changedTouches?t.changedTouches[0]:t,o[r].pickers.children),a=null;e&&(a=e.object.name,t.preventDefault()),n.axis!==a&&(n.axis=a,n.update(),n.dispatchEvent(c))}}function G(t){if(void 0!==n.object&&!0!==i&&(void 0===t.button||0===t.button)){var e=t.changedTouches?t.changedTouches[0]:t;if(0===e.button||void 0===e.button){var a=X(e,o[r].pickers.children);if(a){t.preventDefault(),t.stopPropagation(),n.axis=a.object.name,n.dispatchEvent(u),n.update(),x.copy(B).sub(U).normalize(),o[r].setActivePlane(n.axis,x);var s=X(e,[o[r].activePlane]);s&&(L.copy(n.object.position),I.copy(n.object.scale),R.extractRotation(n.object.matrix),j.extractRotation(n.object.matrixWorld),D.extractRotation(n.object.parent.matrixWorld),F.setFromMatrixScale(w.getInverse(n.object.parent.matrixWorld)),m.copy(s.point))}}i=!0}}function H(t){if(void 0!==n.object&&null!==n.axis&&!1!==i&&(void 0===t.button||0===t.button)){var e=X(t.changedTouches?t.changedTouches[0]:t,[o[r].activePlane]);!1!==e&&(t.preventDefault(),t.stopPropagation(),f.copy(e.point),"translate"===r?(f.sub(m),f.multiply(F),"local"===n.space&&(f.applyMatrix4(w.getInverse(j)),-1===n.axis.search("X")&&(f.x=0),-1===n.axis.search("Y")&&(f.y=0),-1===n.axis.search("Z")&&(f.z=0),f.applyMatrix4(R),n.object.position.copy(L),n.object.position.add(f)),"world"!==n.space&&-1===n.axis.search("XYZ")||(-1===n.axis.search("X")&&(f.x=0),-1===n.axis.search("Y")&&(f.y=0),-1===n.axis.search("Z")&&(f.z=0),f.applyMatrix4(w.getInverse(D)),n.object.position.copy(L),n.object.position.add(f)),null!==n.translationSnap&&("local"===n.space&&n.object.position.applyMatrix4(w.getInverse(j)),-1!==n.axis.search("X")&&(n.object.position.x=Math.round(n.object.position.x/n.translationSnap)*n.translationSnap),-1!==n.axis.search("Y")&&(n.object.position.y=Math.round(n.object.position.y/n.translationSnap)*n.translationSnap),-1!==n.axis.search("Z")&&(n.object.position.z=Math.round(n.object.position.z/n.translationSnap)*n.translationSnap),"local"===n.space&&n.object.position.applyMatrix4(j))):"scale"===r?(f.sub(m),f.multiply(F),"local"===n.space&&("XYZ"===n.axis?(y=1+f.y/Math.max(I.x,I.y,I.z),n.object.scale.x=I.x*y,n.object.scale.y=I.y*y,n.object.scale.z=I.z*y):(f.applyMatrix4(w.getInverse(j)),"X"===n.axis&&(n.object.scale.x=I.x*(1+f.x/I.x)),"Y"===n.axis&&(n.object.scale.y=I.y*(1+f.y/I.y)),"Z"===n.axis&&(n.object.scale.z=I.z*(1+f.z/I.z))))):"rotate"===r&&(f.sub(U),f.multiply(F),_.copy(m).sub(U),_.multiply(F),"E"===n.axis?(f.applyMatrix4(w.getInverse(b)),_.applyMatrix4(w.getInverse(b)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(D)),N.setFromAxisAngle(x,v.z-g.z),E.setFromRotationMatrix(j),S.multiplyQuaternions(S,N),S.multiplyQuaternions(S,E),n.object.quaternion.copy(S)):"XYZE"===n.axis?(N.setFromEuler(f.clone().cross(_).normalize()),S.setFromRotationMatrix(w.getInverse(D)),C.setFromAxisAngle(N,-f.clone().angleTo(_)),E.setFromRotationMatrix(j),S.multiplyQuaternions(S,C),S.multiplyQuaternions(S,E),n.object.quaternion.copy(S)):"local"===n.space?(f.applyMatrix4(w.getInverse(j)),_.applyMatrix4(w.getInverse(j)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),E.setFromRotationMatrix(R),null!==n.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/n.rotationSnap)*n.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/n.rotationSnap)*n.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/n.rotationSnap)*n.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),"X"===n.axis&&E.multiplyQuaternions(E,C),"Y"===n.axis&&E.multiplyQuaternions(E,P),"Z"===n.axis&&E.multiplyQuaternions(E,O),n.object.quaternion.copy(E)):"world"===n.space&&(v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(D)),null!==n.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/n.rotationSnap)*n.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/n.rotationSnap)*n.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/n.rotationSnap)*n.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),E.setFromRotationMatrix(j),"X"===n.axis&&S.multiplyQuaternions(S,C),"Y"===n.axis&&S.multiplyQuaternions(S,P),"Z"===n.axis&&S.multiplyQuaternions(S,O),S.multiplyQuaternions(S,E),n.object.quaternion.copy(S))),n.update(),n.dispatchEvent(c),n.dispatchEvent(h))}}function W(t){t.preventDefault(),void 0!==t.button&&0!==t.button||(i&&null!==n.axis&&(l.mode=r,n.dispatchEvent(l)),i=!1,"TouchEvent"in window&&t instanceof TouchEvent?(n.axis=null,n.update(),n.dispatchEvent(c)):V(t))}function X(n,r){var i=e.getBoundingClientRect();p.set((n.clientX-i.left)/i.width*2-1,(n.clientY-i.top)/i.height*-2+1),d.setFromCamera(p,t);var o=d.intersectObjects(r,!0);return!!o[0]&&o[0]}e.addEventListener("mousedown",G,!1),e.addEventListener("touchstart",G,!1),e.addEventListener("mousemove",V,!1),e.addEventListener("touchmove",V,!1),e.addEventListener("mousemove",H,!1),e.addEventListener("touchmove",H,!1),e.addEventListener("mouseup",W,!1),e.addEventListener("mouseout",W,!1),e.addEventListener("touchend",W,!1),e.addEventListener("touchcancel",W,!1),e.addEventListener("touchleave",W,!1),this.dispose=function(){e.removeEventListener("mousedown",G),e.removeEventListener("touchstart",G),e.removeEventListener("mousemove",V),e.removeEventListener("touchmove",V),e.removeEventListener("mousemove",H),e.removeEventListener("touchmove",H),e.removeEventListener("mouseup",W),e.removeEventListener("mouseout",W),e.removeEventListener("touchend",W),e.removeEventListener("touchcancel",W),e.removeEventListener("touchleave",W)},this.attach=function(t){this.object=t,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return r},this.setMode=function(t){for(var e in"scale"===(r=t||r)&&(n.space="local"),o)o[e].visible=e===r;this.update(),n.dispatchEvent(c)},this.setTranslationSnap=function(t){n.translationSnap=t},this.setRotationSnap=function(t){n.rotationSnap=t},this.setSize=function(t){n.size=t,this.update(),n.dispatchEvent(c)},this.setSpace=function(t){n.space=t,this.update(),n.dispatchEvent(c)},this.update=function(){void 0!==n.object&&(n.object.updateMatrixWorld(),U.setFromMatrixPosition(n.object.matrixWorld),k.setFromRotationMatrix(w.extractRotation(n.object.matrixWorld)),t.updateMatrixWorld(),B.setFromMatrixPosition(t.matrixWorld),z.setFromRotationMatrix(w.extractRotation(t.matrixWorld)),y=U.distanceTo(B)/6*n.size,this.position.copy(U),this.scale.set(y,y,y),t instanceof Mu?x.copy(B).sub(U).normalize():t instanceof Cu&&x.copy(B).normalize(),"local"===n.space?o[r].update(k,x):"world"===n.space&&o[r].update(new ls,x),o[r].highlight(n.axis))}};(Fl.prototype=Object.create(ys.prototype)).constructor=Fl;var Ul,kl=0;function jl(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Gl,this.unassigned=new Gl,this.vertices=[]}function Bl(){this.normal=new ss,this.midpoint=new ss,this.area=0,this.constant=0,this.outside=null,this.mark=kl,this.edge=null}function zl(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function Vl(t){this.point=t,this.prev=null,this.next=null,this.face=null}function Gl(){this.head=null,this.tail=null}function Hl(t){Ls.call(this),this.fromBufferGeometry(new Wl(t)),this.mergeVertices()}function Wl(t){Xs.call(this);var e=[],n=[];void 0===jl&&console.error("ConvexBufferGeometry: ConvexBufferGeometry relies on QuickHull");for(var r=(new jl).setFromPoints(t).faces,i=0;i<r.length;i++){var o=r[i],a=o.edge;do{var s=a.head().point;e.push(s.x,s.y,s.z),n.push(o.normal.x,o.normal.y,o.normal.z),a=a.next}while(a!==o.edge)}this.addAttribute("position",new Vs(e,3)),this.addAttribute("normal",new Vs(n,3))}Object.assign(jl.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("QuickHull: Points parameter is not an array."),t.length<4&&console.error("QuickHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.vertices.push(new Vl(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse(function(t){var n,r,i,o=t.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(n=0,r=a.length;n<r;n++)(i=a[n].clone()).applyMatrix4(t.matrixWorld),e.push(i)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(n=0,r=s.count;n<r;n++)(i=new ss).fromBufferAttribute(s,n).applyMatrix4(t.matrixWorld),e.push(i)}}),this.setFromPoints(e)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(e.outside=null!==t.next&&t.next.face===e?t.next:null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,n=t.outside;null!==n.next&&n.next.face===t;)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var n=this.removeAllVerticesFromFace(t);if(void 0!==n)if(void 0===e)this.unassigned.appendChain(n);else{var r=n;do{var i=r.next;e.distanceToPoint(r.point)>this.tolerance?this.addVertexToFace(r,e):this.unassigned.append(r),r=i}while(null!==r)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var n=e.next,r=this.tolerance,i=null,o=0;o<t.length;o++){var a=t[o];if(a.mark===kl){var s=a.distanceToPoint(e.point);if(s>r&&(r=s,i=a),r>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(e,i),e=n}while(null!==e)}return this},computeExtremes:function(){var t,e,n,r=new ss,i=new ss,o=[],a=[];for(t=0;t<3;t++)o[t]=a[t]=this.vertices[0];for(r.copy(this.vertices[0].point),i.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var s=this.vertices[t],c=s.point;for(n=0;n<3;n++)c.getComponent(n)<r.getComponent(n)&&(r.setComponent(n,c.getComponent(n)),o[n]=s);for(n=0;n<3;n++)c.getComponent(n)>i.getComponent(n)&&(i.setComponent(n,c.getComponent(n)),a[n]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(i.x))+Math.max(Math.abs(r.y),Math.abs(i.y))+Math.max(Math.abs(r.z),Math.abs(i.z))),{min:o,max:a}},computeInitialHull:function(){var t,e,n;return function(){void 0===t&&(t=new Zc,e=new Jc,n=new ss);var r,i,o,a,s,c,u,l,h,d=this.vertices,p=this.computeExtremes(),f=p.min,m=p.max,v=0,g=0;for(c=0;c<3;c++)(h=m[c].point.getComponent(c)-f[c].point.getComponent(c))>v&&(v=h,g=c);for(v=0,t.set((i=f[g]).point,(o=m[g]).point),c=0,u=this.vertices.length;c<u;c++)(r=d[c])!==i&&r!==o&&(t.closestPointToPoint(r.point,!0,n),(h=n.distanceToSquared(r.point))>v&&(v=h,a=r));for(v=-1,e.setFromCoplanarPoints(i.point,o.point,a.point),c=0,u=this.vertices.length;c<u;c++)(r=d[c])!==i&&r!==o&&r!==a&&(h=Math.abs(e.distanceToPoint(r.point)))>v&&(v=h,s=r);var y=[];if(e.distanceToPoint(s.point)<0)for(y.push(Bl.create(i,o,a),Bl.create(s,o,i),Bl.create(s,a,o),Bl.create(s,i,a)),c=0;c<3;c++)l=(c+1)%3,y[c+1].getEdge(2).setTwin(y[0].getEdge(l)),y[c+1].getEdge(1).setTwin(y[l+1].getEdge(0));else for(y.push(Bl.create(i,a,o),Bl.create(s,i,o),Bl.create(s,o,a),Bl.create(s,a,i)),c=0;c<3;c++)l=(c+1)%3,y[c+1].getEdge(2).setTwin(y[0].getEdge((3-c)%3)),y[c+1].getEdge(0).setTwin(y[l+1].getEdge(1));for(c=0;c<4;c++)this.faces.push(y[c]);for(c=0,u=d.length;c<u;c++)if((r=d[c])!==i&&r!==o&&r!==a&&r!==s){v=this.tolerance;var b=null;for(l=0;l<4;l++)(h=this.faces[l].distanceToPoint(r.point))>v&&(v=h,b=this.faces[l]);null!==b&&this.addVertexToFace(r,b)}return this}}(),reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var n=this.faces[e];n.mark===kl&&t.push(n)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,n=this.assigned.first().face,r=n.outside;do{var i=n.distanceToPoint(r.point);i>e&&(e=i,t=r),r=r.next}while(null!==r&&r.face===n);return t}},computeHorizon:function(t,e,n,r){var i;this.deleteFaceVertices(n),n.mark=1,i=null===e?e=n.getEdge(0):e.next;do{var o=i.twin,a=o.face;a.mark===kl&&(a.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,o,a,r):r.push(i)),i=i.next}while(i!==e);return this},addAdjoiningFace:function(t,e){var n=Bl.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var n=null,r=null,i=0;i<e.length;i++){var o=this.addAdjoiningFace(t,e[i]);null===n?n=o:o.next.setTwin(r),this.newFaces.push(o.face),r=o}return n.next.setTwin(r),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(Bl,{create:function(t,e,n){var r=new Bl,i=new zl(t,r),o=new zl(e,r),a=new zl(n,r);return i.next=a.prev=o,o.next=i.prev=a,a.next=o.prev=i,r.edge=i,r.compute()}}),Object.assign(Bl.prototype,{getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){void 0===Ul&&(Ul=new Qc);var t=this.edge.tail(),e=this.edge.head(),n=this.edge.next.head();return Ul.set(t.point,e.point,n.point),Ul.getNormal(this.normal),Ul.getMidpoint(this.midpoint),this.area=Ul.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(zl.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(Gl.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),(Hl.prototype=Object.create(Ls.prototype)).constructor=Hl,(Wl.prototype=Object.create(Xs.prototype)).constructor=Wl;var Xl=function(t,e){this.minSizeForBreak=t||1.4,this.smallDelta=e||1e-4,this.tempLine1=new Zc,this.tempPlane1=new Jc,this.tempPlane2=new Jc,this.tempCM1=new ss,this.tempCM2=new ss,this.tempVector3=new ss,this.tempVector3_2=new ss,this.tempVector3_3=new ss,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var n=0;n<900;n++)this.segments[n]=!1};function ql(){this.type="Curve",this.arcLengthDivisions=200}function Yl(){ql.call(this)}function Zl(t){ql.call(this),this.scale=void 0===t?5:t}function Jl(t){ql.call(this),this.scale=void 0===t?70:t}function Ql(){ql.call(this)}function Kl(){ql.call(this)}function $l(t){ql.call(this),this.scale=void 0===t?10:t}function th(t){ql.call(this),this.scale=void 0===t?10:t}function eh(t){ql.call(this),this.scale=void 0===t?10:t}function nh(t){ql.call(this),this.scale=void 0===t?10:t}function rh(t){ql.call(this),this.scale=void 0===t?1:t}function ih(t){ql.call(this),this.scale=void 0===t?40:t}function oh(t){ql.call(this),this.scale=void 0===t?40:t}function ah(t){ql.call(this),this.scale=void 0===t?40:t}function sh(t){ql.call(this),this.scale=void 0===t?40:t}Xl.prototype={constructor:Xl,prepareBreakableObject:function(t,e,n,r,i){for(var o=t.geometry.vertices,a=0,s=o.length;a<s;a++)o[a].mark=0;var c=t.userData;c.mass=e,c.velocity=n.clone(),c.angularVelocity=r.clone(),c.breakable=i},subdivideByImpact:function(t,e,n,r,i,o){var a=[],s=this.tempPlane1,c=this.tempPlane2;this.tempVector3.addVectors(e,n),s.setFromCoplanarPoints(e,t.position,this.tempVector3);var u=i+r,l=this;return function i(o,h,d,p){if(Math.random()<.05*p||p>u)a.push(o);else{var f=Math.PI;0===p?(c.normal.copy(s.normal),c.constant=s.constant):p<=r?(f=(d-h)*(.2+.6*Math.random())+h,l.tempVector3_2.copy(t.position).sub(e).applyAxisAngle(n,f).add(e),c.setFromCoplanarPoints(e,l.tempVector3,l.tempVector3_2)):(f=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,l.tempVector3_2.copy(e).sub(o.position).applyAxisAngle(n,f).add(o.position),l.tempVector3_3.copy(n).add(o.position),c.setFromCoplanarPoints(o.position,l.tempVector3_3,l.tempVector3_2)),l.cutByPlane(o,c,l.tempResultObjects);var m=l.tempResultObjects.object1,v=l.tempResultObjects.object2;m&&i(m,h,f,p+1),v&&i(v,f,d,p+1)}}(t,0,2*Math.PI,0),a},cutByPlane:function(t,e,n){for(var r=t.geometry,i=r.vertices,o=r.faces,a=i.length,s=[],c=[],u=this.smallDelta,l=0;l<a;l++)i[l].mark=0;var h=a*a;for(l=0;l<h;l++)this.segments[l]=!1;l=0;for(var d=o.length-1;l<d;l++)for(var p=o[l],f=l+1,m=o.length;f<m;f++){var v=o[f];if(1-p.normal.dot(v.normal)<u){var g=p.a,y=p.b,b=p.c,x=v.a,w=v.b,_=v.c;g===x||g===w||g===_?y===x||y===w||y===_?(this.segments[g*a+y]=!0,this.segments[y*a+g]=!0):(this.segments[b*a+g]=!0,this.segments[g*a+b]=!0):y!==x&&y!==w&&y!==_||(this.segments[b*a+y]=!0,this.segments[y*a+b]=!0)}}var S=this.tempPlane1;for(t.updateMatrix(),Xl.transformPlaneToLocalSpace(e,t.matrix,S),l=0,d=o.length;l<d;l++)for(var T=o[l],M=0;M<3;M++){var A=0===M?T.a:1===M?T.b:T.c,E=0===M?T.b:1===M?T.c:T.a;if(!this.segments[A*a+E]){this.segments[A*a+E]=!0,this.segments[E*a+A]=!0;var C,P=i[A],O=i[E];if(0===P.mark)if((C=S.distanceToPoint(P))>u)P.mark=2,c.push(P);else if(C<-u)P.mark=1,s.push(P);else{P.mark=3,s.push(P);var N=P.clone();N.mark=3,c.push(N)}if(0===O.mark)if((C=S.distanceToPoint(O))>u)O.mark=2,c.push(O);else if(C<-u)O.mark=1,s.push(O);else{O.mark=3,s.push(O);var L=O.clone();L.mark=3,c.push(L)}var I=P.mark,R=O.mark;if(1===I&&2===R||2===I&&1===R){this.tempLine1.start.copy(P),this.tempLine1.end.copy(O);var D=S.intersectLine(this.tempLine1);if(void 0===D)return console.error("Internal error: segment does not intersect plane."),n.segmentedObject1=null,n.segmentedObject2=null,0;D.mark=1,s.push(D);var F=D.clone();F.mark=2,c.push(F)}}}var U=.5*t.userData.mass;this.tempCM1.set(0,0,0);var k=0,j=s.length;if(j>0){for(l=0;l<j;l++)this.tempCM1.add(s[l]);for(this.tempCM1.divideScalar(j),l=0;l<j;l++)(V=s[l]).sub(this.tempCM1),k=Math.max(k,V.x,V.y,V.z);this.tempCM1.add(t.position)}this.tempCM2.set(0,0,0);var B=0,z=c.length;if(z>0){for(l=0;l<z;l++)this.tempCM2.add(c[l]);for(this.tempCM2.divideScalar(z),l=0;l<z;l++){var V;(V=c[l]).sub(this.tempCM2),B=Math.max(B,V.x,V.y,V.z)}this.tempCM2.add(t.position)}var G=null,H=null,W=0;return j>4&&((G=new Kc(new Hl(s),t.material)).position.copy(this.tempCM1),G.quaternion.copy(t.quaternion),this.prepareBreakableObject(G,U,t.userData.velocity,t.userData.angularVelocity,2*k>this.minSizeForBreak),W++),z>4&&((H=new Kc(new Hl(c),t.material)).position.copy(this.tempCM2),H.quaternion.copy(t.quaternion),this.prepareBreakableObject(H,U,t.userData.velocity,t.userData.angularVelocity,2*B>this.minSizeForBreak),W++),n.object1=G,n.object2=H,W}},Xl.transformFreeVector=function(t,e){var n=t.x,r=t.y,i=t.z,o=e.elements;return t.x=o[0]*n+o[4]*r+o[8]*i,t.y=o[1]*n+o[5]*r+o[9]*i,t.z=o[2]*n+o[6]*r+o[10]*i,t},Xl.transformFreeVectorInverse=function(t,e){var n=t.x,r=t.y,i=t.z,o=e.elements;return t.x=o[0]*n+o[1]*r+o[2]*i,t.y=o[4]*n+o[5]*r+o[6]*i,t.z=o[8]*n+o[9]*r+o[10]*i,t},Xl.transformTiedVectorInverse=function(t,e){var n=t.x,r=t.y,i=t.z,o=e.elements;return t.x=o[0]*n+o[1]*r+o[2]*i-o[12],t.y=o[4]*n+o[5]*r+o[6]*i-o[13],t.z=o[8]*n+o[9]*r+o[10]*i-o[14],t},Xl.transformPlaneToLocalSpace=function(){var t=new ss;return new ds,function(e,n,r){r.normal.copy(e.normal),r.constant=e.constant;var i=Xl.transformTiedVectorInverse(e.coplanarPoint(t),n);Xl.transformFreeVectorInverse(r.normal,n),r.constant=-i.dot(r.normal)}}(),Object.assign(ql.prototype,{getPoint:function(){return console.warn("Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=t;n++)o+=(e=this.getPoint(n/t)).distanceTo(i),r.push(o),i=e;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n,r=this.getLengths(),i=0,o=r.length;n=e||t*r[o-1];for(var a,s=0,c=o-1;s<=c;)if((a=r[i=Math.floor(s+(c-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){c=i;break}c=i-1}if(r[i=c]===n)return i/(o-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(o-1)},getTangent:function(t){var e=t-1e-4,n=t+1e-4;e<0&&(e=0),n>1&&(n=1);var r=this.getPoint(e);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var n,r,i=new ss,o=[],a=[],s=[],c=new ss,u=new as;for(n=0;n<=t;n++)o[n]=this.getTangentAt(n/t),o[n].normalize();a[0]=new ss,s[0]=new ss;var l=Number.MAX_VALUE,h=Math.abs(o[0].x),d=Math.abs(o[0].y),p=Math.abs(o[0].z);for(h<=l&&(l=h,i.set(1,0,0)),d<=l&&(l=d,i.set(0,1,0)),p<=l&&i.set(0,0,1),c.crossVectors(o[0],i).normalize(),a[0].crossVectors(o[0],c),s[0].crossVectors(o[0],a[0]),n=1;n<=t;n++)a[n]=a[n-1].clone(),s[n]=s[n-1].clone(),c.crossVectors(o[n-1],o[n]),c.length()>Number.EPSILON&&(c.normalize(),r=Math.acos(os.clamp(o[n-1].dot(o[n]),-1,1)),a[n].applyMatrix4(u.makeRotationAxis(c,r))),s[n].crossVectors(o[n],a[n]);if(!0===e)for(r=Math.acos(os.clamp(a[0].dot(a[t]),-1,1)),r/=t,o[0].dot(c.crossVectors(a[0],a[t]))>0&&(r=-r),n=1;n<=t;n++)a[n].applyMatrix4(u.makeRotationAxis(o[n],r*n)),s[n].crossVectors(o[n],a[n]);return{tangents:o,normals:a,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),(Yl.prototype=Object.create(ql.prototype)).constructor=Yl,Yl.prototype.getPoint=function(t,e){var n=e||new ss;t=2*Math.PI*t;var r=-.22*Math.cos(t)-1.28*Math.sin(t)-.44*Math.cos(3*t)-.78*Math.sin(3*t),i=-.1*Math.cos(2*t)-.27*Math.sin(2*t)+.38*Math.cos(4*t)+.46*Math.sin(4*t),o=.7*Math.cos(3*t)-.4*Math.sin(3*t);return n.set(r,i,o).multiplyScalar(20)},(Zl.prototype=Object.create(ql.prototype)).constructor=Zl,Zl.prototype.getPoint=function(t,e){var n=e||new ss;t*=2*Math.PI;var r=16*Math.pow(Math.sin(t),3),i=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);return n.set(r,i,0).multiplyScalar(this.scale)},(Jl.prototype=Object.create(ql.prototype)).constructor=Jl,Jl.prototype.getPoint=function(t,e){var n=e||new ss;t=4*t*Math.PI;var r=this.scale/2,i=r*(1+Math.cos(t)),o=r*Math.sin(t),a=2*r*Math.sin(t/2);return n.set(i,o,a)},(Ql.prototype=Object.create(ql.prototype)).constructor=Ql,Ql.prototype.getPoint=function(t,e){var n=e||new ss;t*=2*Math.PI;var r=50*Math.sin(t),i=Math.cos(t)*(10+50*Math.cos(t)),o=Math.sin(t)*(10+50*Math.cos(t));return n.set(r,i,o)},(Kl.prototype=Object.create(ql.prototype)).constructor=Kl,Kl.prototype.getPoint=function(t,e){var n=e||new ss,r=2*Math.PI*t*150/30,i=30*Math.cos(r),o=30*Math.sin(r);return n.set(i,o,150*t)},($l.prototype=Object.create(ql.prototype)).constructor=$l,$l.prototype.getPoint=function(t,e){var n=e||new ss;t*=2*Math.PI;var r=(2+Math.cos(3*t))*Math.cos(2*t),i=(2+Math.cos(3*t))*Math.sin(2*t),o=Math.sin(3*t);return n.set(r,i,o).multiplyScalar(this.scale)},(th.prototype=Object.create(ql.prototype)).constructor=th,th.prototype.getPoint=function(t,e){var n=e||new ss;t*=2*Math.PI;var r=(2+Math.cos(4*t))*Math.cos(3*t),i=(2+Math.cos(4*t))*Math.sin(3*t),o=Math.sin(4*t);return n.set(r,i,o).multiplyScalar(this.scale)},(eh.prototype=Object.create(ql.prototype)).constructor=eh,eh.prototype.getPoint=function(t,e){var n=e||new ss;t*=2*Math.PI;var r=(2+Math.cos(5*t))*Math.cos(2*t),i=(2+Math.cos(5*t))*Math.sin(2*t),o=Math.sin(5*t);return n.set(r,i,o).multiplyScalar(this.scale)},(nh.prototype=Object.create(ql.prototype)).constructor=nh,nh.prototype.getPoint=function(t,e){var n=e||new ss;t=4*t-2;var r=Math.pow(t,3)-3*t,i=Math.pow(t,4)-4*t*t,o=.2*Math.pow(t,5)-2*t;return n.set(r,i,o).multiplyScalar(this.scale)},(rh.prototype=Object.create(ql.prototype)).constructor=rh,rh.prototype.getPoint=function(t,e){var n=e||new ss,r=.4*(t=function(t,e,n){return 8*n-4}(0,0,t))*(t*t-7)*(t*t-10),i=Math.pow(t,4)-13*t*t;return n.set(r,i,.1*t*(t*t-4)*(t*t-9)*(t*t-12)).multiplyScalar(this.scale)},(ih.prototype=Object.create(ql.prototype)).constructor=ih,ih.prototype.getPoint=function(t,e){var n=e||new ss;t*=2*Math.PI;var r=Math.cos(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),i=Math.sin(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),o=.35*Math.sin(5*t);return n.set(r,i,o).multiplyScalar(this.scale)},(oh.prototype=Object.create(ql.prototype)).constructor=oh,oh.prototype.getPoint=function(t,e){var n=e||new ss,r=t*Math.PI*2,i=Math.cos(2*r)*(1+.45*Math.cos(3*r)+.4*Math.cos(9*r)),o=Math.sin(2*r)*(1+.45*Math.cos(3*r)+.4*Math.cos(9*r)),a=.2*Math.sin(9*r);return n.set(i,o,a).multiplyScalar(this.scale)},(ah.prototype=Object.create(ql.prototype)).constructor=ah,ah.prototype.getPoint=function(t,e){var n=e||new ss,r=t*Math.PI*2,i=Math.cos(3*r)*(1+.3*Math.cos(5*r)+.5*Math.cos(10*r)),o=Math.sin(3*r)*(1+.3*Math.cos(5*r)+.5*Math.cos(10*r)),a=.2*Math.sin(20*r);return n.set(i,o,a).multiplyScalar(this.scale)},(sh.prototype=Object.create(ql.prototype)).constructor=sh,sh.prototype.getPoint=function(t,e){var n=e||new ss,r=t*Math.PI*2,i=Math.cos(4*r)*(1+.5*(Math.cos(5*r)+.4*Math.cos(20*r))),o=Math.sin(4*r)*(1+.5*(Math.cos(5*r)+.4*Math.cos(20*r))),a=.35*Math.sin(15*r);return n.set(i,o,a).multiplyScalar(this.scale)};var ch={findSpan:function(t,e,n){var r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;for(var i=t,o=r,a=Math.floor((i+o)/2);e<n[a]||e>=n[a+1];)e<n[a]?o=a:i=a,a=Math.floor((i+o)/2);return a},calcBasisFunctions:function(t,e,n,r){var i=[],o=[],a=[];i[0]=1;for(var s=1;s<=n;++s){o[s]=e-r[t+1-s],a[s]=r[t+s]-e;for(var c=0,u=0;u<s;++u){var l=a[u+1],h=o[s-u],d=i[u]/(l+h);i[u]=c+l*d,c=h*d}i[s]=c}return i},calcBSplinePoint:function(t,e,n,r){for(var i=this.findSpan(t,r,e),o=this.calcBasisFunctions(i,r,t,e),a=new Is(0,0,0,0),s=0;s<=t;++s){var c=n[i-t+s],u=o[s],l=c.w*u;a.x+=c.x*l,a.y+=c.y*l,a.z+=c.z*l,a.w+=c.w*u}return a},calcBasisFunctionDerivatives:function(t,e,n,r,i){for(var o=[],a=0;a<=n;++a)o[a]=0;var s=[];for(a=0;a<=r;++a)s[a]=o.slice(0);var c=[];for(a=0;a<=n;++a)c[a]=o.slice(0);c[0][0]=1;for(var u=o.slice(0),l=o.slice(0),h=1;h<=n;++h){u[h]=e-i[t+1-h],l[h]=i[t+h]-e;for(var d=0,p=0;p<h;++p){var f=l[p+1],m=u[h-p];c[h][p]=f+m;var v=c[p][h-1]/c[h][p];c[p][h]=d+f*v,d=m*v}c[h][h]=d}for(h=0;h<=n;++h)s[0][h]=c[h][n];for(p=0;p<=n;++p){var g=0,y=1,b=[];for(a=0;a<=n;++a)b[a]=o.slice(0);b[0][0]=1;for(var x=1;x<=r;++x){var w=0,_=p-x,S=n-x;p>=x&&(b[y][0]=b[g][0]/c[S+1][_],w=b[y][0]*c[_][S]);var T=p-1<=S?x-1:n-p;for(h=_>=-1?1:-_;h<=T;++h)b[y][h]=(b[g][h]-b[g][h-1])/c[S+1][_+h],w+=b[y][h]*c[_+h][S];p<=S&&(b[y][x]=-b[g][x-1]/c[S+1][p],w+=b[y][x]*c[p][S]),s[x][p]=w,h=g,g=y,y=h}}for(p=n,x=1;x<=r;++x){for(h=0;h<=n;++h)s[x][h]*=p;p*=n-x}return s},calcBSplineDerivatives:function(t,e,n,r,i){for(var o=i<t?i:t,a=[],s=this.findSpan(t,r,e),c=this.calcBasisFunctionDerivatives(s,r,t,o,e),u=[],l=0;l<n.length;++l){var h=(p=n[l].clone()).w;p.x*=h,p.y*=h,p.z*=h,u[l]=p}for(var d=0;d<=o;++d){for(var p=u[s-t].clone().multiplyScalar(c[d][0]),f=1;f<=t;++f)p.add(u[s-t+f].clone().multiplyScalar(c[d][f]));a[d]=p}for(d=o+1;d<=i+1;++d)a[d]=new Is(0,0,0);return a},calcKoverI:function(t,e){for(var n=1,r=2;r<=t;++r)n*=r;var i=1;for(r=2;r<=e;++r)i*=r;for(r=2;r<=t-e;++r)i*=r;return n/i},calcRationalCurveDerivatives:function(t){for(var e=t.length,n=[],r=[],i=0;i<e;++i){var o=t[i];n[i]=new ss(o.x,o.y,o.z),r[i]=o.w}for(var a=[],s=0;s<e;++s){var c=n[s].clone();for(i=1;i<=s;++i)c.sub(a[s-i].clone().multiplyScalar(this.calcKoverI(s,i)*r[i]));a[s]=c.divideScalar(r[0])}return a},calcNURBSDerivatives:function(t,e,n,r,i){var o=this.calcBSplineDerivatives(t,e,n,r,i);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(t,e,n,r,i,o,a){for(var s=this.findSpan(t,o,n),c=this.findSpan(e,a,r),u=this.calcBasisFunctions(s,o,t,n),l=this.calcBasisFunctions(c,a,e,r),h=[],d=0;d<=e;++d){h[d]=new Is(0,0,0,0);for(var p=0;p<=t;++p){var f=i[s-t+p][c-e+d].clone(),m=f.w;f.x*=m,f.y*=m,f.z*=m,h[d].add(f.multiplyScalar(u[p]))}}var v=new Is(0,0,0,0);for(d=0;d<=e;++d)v.add(h[d].multiplyScalar(l[d]));return v.divideScalar(v.w),new ss(v.x,v.y,v.z)}},uh=function(t,e,n,r,i){ql.call(this),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(var o=0;o<n.length;++o){var a=n[o];this.controlPoints[o]=new Is(a.x,a.y,a.z,a.w)}};uh.prototype=Object.create(ql.prototype),uh.prototype.constructor=uh,uh.prototype.getPoint=function(t){var e=ch.calcBSplinePoint(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!=e.w&&e.divideScalar(e.w),new ss(e.x,e.y,e.z)},uh.prototype.getTangent=function(t){var e=ch.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),1)[1].clone();return e.normalize(),e};var lh=function(t,e,n,r,i){this.degree1=t,this.degree2=e,this.knots1=n,this.knots2=r,this.controlPoints=[];for(var o=n.length-t-1,a=r.length-e-1,s=0;s<o;++s){this.controlPoints[s]=[];for(var c=0;c<a;++c){var u=i[s][c];this.controlPoints[s][c]=new Is(u.x,u.y,u.z,u.w)}}};lh.prototype={constructor:lh,getPoint:function(t,e){return ch.calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,this.knots1[0]+t*(this.knots1[this.knots1.length-1]-this.knots1[0]),this.knots2[0]+e*(this.knots2[this.knots2.length-1]-this.knots2[0]))}};var hh,dh,ph,fh,mh,vh,gh,yh,bh,xh,wh={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(t){var e,n,r;e=void 0!==(t=t||{}).parent?t.parent:document.body,n=void 0!==t.id?t.id:"oldie",(r=wh.getWebGLErrorMessage()).id=n,e.appendChild(r)}};Object.assign((function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Mu,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Mu,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}).prototype,{update:(bh=new as,xh=new as,function(t){if(hh!==this||dh!==t.focus||ph!==t.fov||fh!==t.aspect*this.aspect||mh!==t.near||vh!==t.far||gh!==t.zoom||yh!==this.eyeSep){hh=this,dh=t.focus,ph=t.fov,fh=t.aspect*this.aspect,mh=t.near,vh=t.far,gh=t.zoom;var e,n,r=t.projectionMatrix.clone(),i=(yh=this.eyeSep/2)*mh/dh,o=mh*Math.tan(os.DEG2RAD*ph*.5)/gh;xh.elements[12]=-yh,bh.elements[12]=yh,r.elements[0]=2*mh/((n=o*fh+i)-(e=-o*fh+i)),r.elements[8]=(n+e)/(n-e),this.cameraL.projectionMatrix.copy(r),r.elements[0]=2*mh/((n=o*fh-i)-(e=-o*fh-i)),r.elements[8]=(n+e)/(n-e),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(xh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(bh)})});var _h,Sh,Th,Mh,Ah,Eh,Ch,Ph,Oh,Nh={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit(  ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit(  );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance(  const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance(  const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance(  geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance(  geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance(  geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},Lh={common:{diffuse:{value:new Ts(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new ds},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Cs(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ts(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Ts(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new ds}}},Ih={basic:{uniforms:Lu.merge([Lh.common,Lh.specularmap,Lh.envmap,Lh.aomap,Lh.lightmap,Lh.fog]),vertexShader:Nh.meshbasic_vert,fragmentShader:Nh.meshbasic_frag},lambert:{uniforms:Lu.merge([Lh.common,Lh.specularmap,Lh.envmap,Lh.aomap,Lh.lightmap,Lh.emissivemap,Lh.fog,Lh.lights,{emissive:{value:new Ts(0)}}]),vertexShader:Nh.meshlambert_vert,fragmentShader:Nh.meshlambert_frag},phong:{uniforms:Lu.merge([Lh.common,Lh.specularmap,Lh.envmap,Lh.aomap,Lh.lightmap,Lh.emissivemap,Lh.bumpmap,Lh.normalmap,Lh.displacementmap,Lh.gradientmap,Lh.fog,Lh.lights,{emissive:{value:new Ts(0)},specular:{value:new Ts(1118481)},shininess:{value:30}}]),vertexShader:Nh.meshphong_vert,fragmentShader:Nh.meshphong_frag},standard:{uniforms:Lu.merge([Lh.common,Lh.envmap,Lh.aomap,Lh.lightmap,Lh.emissivemap,Lh.bumpmap,Lh.normalmap,Lh.displacementmap,Lh.roughnessmap,Lh.metalnessmap,Lh.fog,Lh.lights,{emissive:{value:new Ts(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Nh.meshphysical_vert,fragmentShader:Nh.meshphysical_frag},points:{uniforms:Lu.merge([Lh.points,Lh.fog]),vertexShader:Nh.points_vert,fragmentShader:Nh.points_frag},dashed:{uniforms:Lu.merge([Lh.common,Lh.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Nh.linedashed_vert,fragmentShader:Nh.linedashed_frag},depth:{uniforms:Lu.merge([Lh.common,Lh.displacementmap]),vertexShader:Nh.depth_vert,fragmentShader:Nh.depth_frag},normal:{uniforms:Lu.merge([Lh.common,Lh.bumpmap,Lh.normalmap,Lh.displacementmap,{opacity:{value:1}}]),vertexShader:Nh.normal_vert,fragmentShader:Nh.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Nh.cube_vert,fragmentShader:Nh.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Nh.equirect_vert,fragmentShader:Nh.equirect_frag},distanceRGBA:{uniforms:Lu.merge([Lh.common,Lh.displacementmap,{referencePosition:{value:new ss},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Nh.distanceRGBA_vert,fragmentShader:Nh.distanceRGBA_frag},shadow:{uniforms:Lu.merge([Lh.lights,Lh.fog,{color:{value:new Ts(0)},opacity:{value:1}}]),vertexShader:Nh.shadow_vert,fragmentShader:Nh.shadow_frag}};function Rh(t,e,n){var r=n||Dh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function Dh(t,e,n){this.path=e,this.parsedPath=n||Dh.parseTrackName(e),this.node=Dh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Ih.physical={uniforms:Lu.merge([Ih.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Nh.meshphysical_vert,fragmentShader:Nh.meshphysical_frag},Object.assign(Rh.prototype,{getValue:function(t,e){this.bind();var n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(Dh,{Composite:Rh,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new Dh.Composite(t,e,n):new Dh(t,e,n)},sanitizeNodeName:(Oh=new RegExp("[\\[\\]\\.:\\/]","g"),function(t){return t.replace(/\s/g,"_").replace(Oh,"")}),parseTrackName:(_h="[^\\[\\]\\.:\\/]",Sh="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Th=/((?:WC+[\/:])*)/.source.replace("WC",_h),Mh=/(WCOD+)?/.source.replace("WCOD",Sh),Ah=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_h),Eh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_h),Ch=new RegExp("^"+Th+Mh+Ah+Eh+"$"),Ph=["material","materials","bones"],function(t){var e=Ch.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Ph.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.name===e||i.uuid===e)return i;var o=r(i.children);if(o)return o}return null},i=r(t.children);if(i)return i}return null}}),Object.assign(Dh.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(t=Dh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var o=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[n])return void console.error("PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==o){if(void 0===t[o])return void console.error("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var s=t[r];if(void 0!==s){var c=this.Versioning.None;void 0!==t.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!t.geometry.morphTargets)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===i){i=a;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else console.error("PropertyBinding: Trying to update property for track: "+e.nodeName+"."+r+" but it wasn't found.",t)}else console.error("PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Dh.prototype,{_getValue_unbound:Dh.prototype.getValue,_setValue_unbound:Dh.prototype.setValue});var Fh={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},Uh={1003:Fh.NEAREST,1004:Fh.NEAREST_MIPMAP_NEAREST,1005:Fh.NEAREST_MIPMAP_LINEAR,1006:Fh.LINEAR,1007:Fh.LINEAR_MIPMAP_NEAREST,1008:Fh.LINEAR_MIPMAP_LINEAR},kh={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},jh=function(){};jh.prototype={constructor:jh,parse:function(t,e,n){(n=Object.assign({},{trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1},n)).animations.length>0&&(n.trs=!0);var r,i={asset:{version:"2.0",generator:"GLTFExporter"}},o=0,a=[],s=[],c=new Map,u=[],l={},h={materials:new Map,textures:new Map};function d(t,e){return t.length===e.length&&t.every(function(t,n){return t===e[n]})}function p(t){return 4*Math.ceil(t/4)}function f(t,e){e=e||0;var n=p(t.byteLength);if(n!==t.byteLength){var r=new Uint8Array(n);if(r.set(new Uint8Array(t)),0!==e)for(var i=t.byteLength;i<n;i++)r[i]=e;return r.buffer}return t}function m(t){return i.buffers||(i.buffers=[{byteLength:0}]),a.push(t),0}function v(t,e,r,a){var s;if(i.accessors||(i.accessors=[]),t.array.constructor===Float32Array)s=Fh.FLOAT;else if(t.array.constructor===Uint32Array)s=Fh.UNSIGNED_INT;else{if(t.array.constructor!==Uint16Array)throw new Error("GLTFExporter: Unsupported bufferAttribute component type.");s=Fh.UNSIGNED_SHORT}if(void 0===r&&(r=0),void 0===a&&(a=t.count),n.truncateDrawRange&&void 0!==e&&null===e.index){var c=r+a,u=e.drawRange.count===1/0?t.count:e.drawRange.start+e.drawRange.count;r=Math.max(r,e.drawRange.start),(a=Math.min(c,u)-r)<0&&(a=0)}var l,h=function(t,e,n){for(var r={min:new Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)},i=e;i<e+n;i++)for(var o=0;o<t.itemSize;o++){var a=t.array[i*t.itemSize+o];r.min[o]=Math.min(r.min[o],a),r.max[o]=Math.max(r.max[o],a)}return r}(t,r,a);void 0!==e&&(l=t===e.index?Fh.ELEMENT_ARRAY_BUFFER:Fh.ARRAY_BUFFER);var d=function(t,e,n,r,a){i.bufferViews||(i.bufferViews=[]);for(var s=e===Fh.UNSIGNED_SHORT?2:4,c=p(r*t.itemSize*s),u=new DataView(new ArrayBuffer(c)),l=0,h=n;h<n+r;h++)for(var d=0;d<t.itemSize;d++){var f=t.array[h*t.itemSize+d];e===Fh.FLOAT?u.setFloat32(l,f,!0):e===Fh.UNSIGNED_INT?u.setUint32(l,f,!0):e===Fh.UNSIGNED_SHORT&&u.setUint16(l,f,!0),l+=s}var v={buffer:m(u.buffer),byteOffset:o,byteLength:c};return void 0!==a&&(v.target=a),a===Fh.ARRAY_BUFFER&&(v.byteStride=t.itemSize*s),o+=c,i.bufferViews.push(v),{id:i.bufferViews.length-1,byteLength:0}}(t,s,r,a,l);return i.accessors.push({bufferView:d.id,byteOffset:d.byteOffset,componentType:s,count:a,max:h.max,min:h.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[t.itemSize]}),i.accessors.length-1}function g(t){if(h.textures.has(t))return h.textures.get(t);i.textures||(i.textures=[]);var e={sampler:function(t){return i.samplers||(i.samplers=[]),i.samplers.push({magFilter:Uh[t.magFilter],minFilter:Uh[t.minFilter],wrapS:Uh[t.wrapS],wrapT:Uh[t.wrapT]}),i.samplers.length-1}(t),source:function(t){i.images||(i.images=[]);var e,a=t.format===Lc?"image/png":"image/jpeg",c={mimeType:a};if(n.embedImages){var u=r=r||document.createElement("canvas");u.width=t.image.width,u.height=t.image.height,!n.forcePowerOfTwoTextures||os.isPowerOfTwo((e=t.image).width)&&os.isPowerOfTwo(e.height)||(console.warn("GLTFExporter: Resized non-power-of-two image.",t.image),u.width=os.floorPowerOfTwo(u.width),u.height=os.floorPowerOfTwo(u.height));var l=u.getContext("2d");!0===t.flipY&&(l.translate(0,u.height),l.scale(1,-1)),l.drawImage(t.image,0,0,u.width,u.height),!0===n.binary?s.push(new Promise(function(t){u.toBlob(function(e){(function(t){return i.bufferViews||(i.bufferViews=[]),new Promise(function(e){var n=new window.FileReader;n.readAsArrayBuffer(t),n.onloadend=function(){var t=f(n.result),r={buffer:m(t),byteOffset:o,byteLength:t.byteLength};o+=t.byteLength,i.bufferViews.push(r),e(i.bufferViews.length-1)}})})(e).then(function(e){c.bufferView=e,t()})},a)})):c.uri=u.toDataURL(a)}else c.uri=t.image.src;return i.images.push(c),i.images.length-1}(t)};i.textures.push(e);var a=i.textures.length-1;return h.textures.set(t,a),a}function y(t){if(h.materials.has(t))return h.materials.get(t);if(i.materials||(i.materials=[]),t.isShaderMaterial)return console.warn("GLTFExporter: ShaderMaterial not supported."),null;var e={pbrMetallicRoughness:{}};t.isMeshBasicMaterial?(e.extensions={KHR_materials_unlit:{}},l.KHR_materials_unlit=!0):t.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var n=t.color.toArray().concat([t.opacity]);if(d(n,[1,1,1,1])||(e.pbrMetallicRoughness.baseColorFactor=n),t.isMeshStandardMaterial?(e.pbrMetallicRoughness.metallicFactor=t.metalness,e.pbrMetallicRoughness.roughnessFactor=t.roughness):t.isMeshBasicMaterial?(e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9):(e.pbrMetallicRoughness.metallicFactor=.5,e.pbrMetallicRoughness.roughnessFactor=.5),(t.metalnessMap||t.roughnessMap)&&(t.metalnessMap===t.roughnessMap?e.pbrMetallicRoughness.metallicRoughnessTexture={index:g(t.metalnessMap)}:console.warn("GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.")),t.map&&(e.pbrMetallicRoughness.baseColorTexture={index:g(t.map)}),t.isMeshBasicMaterial||t.isLineBasicMaterial||t.isPointsMaterial);else{var r=t.emissive.clone().multiplyScalar(t.emissiveIntensity).toArray();d(r,[0,0,0])||(e.emissiveFactor=r),t.emissiveMap&&(e.emissiveTexture={index:g(t.emissiveMap)})}t.normalMap&&(e.normalTexture={index:g(t.normalMap)},-1!==t.normalScale.x&&(t.normalScale.x!==t.normalScale.y&&console.warn("GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),e.normalTexture.scale=t.normalScale.x)),t.aoMap&&(e.occlusionTexture={index:g(t.aoMap)},1!==t.aoMapIntensity&&(e.occlusionTexture.strength=t.aoMapIntensity)),(t.transparent||t.alphaTest>0)&&(e.alphaMode=t.opacity<1?"BLEND":"MASK",t.alphaTest>0&&.5!==t.alphaTest&&(e.alphaCutoff=t.alphaTest)),t.side===uc&&(e.doubleSided=!0),""!==t.name&&(e.name=t.name),i.materials.push(e);var o=i.materials.length-1;return h.materials.set(t,o),o}function b(t,e){i.animations||(i.animations=[]);for(var n=[],r=[],o=0;o<t.tracks.length;++o){var a=t.tracks[o],s=Dh.parseTrackName(a.name),u=Dh.findNode(e,s.nodeName),l=kh[s.propertyName];if("bones"===s.objectName&&(u=!0===u.isSkinnedMesh?u.skeleton.getBoneByName(s.objectIndex):void 0),!u||!l)return console.warn('GLTFExporter: Could not export animation track "%s".',a.name),null;var h,d=a.values.length/a.times.length;l===kh.morphTargetInfluences&&(d/=u.morphTargetInfluences.length),!0===a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=a.getInterpolation()===Uc?"STEP":"LINEAR",r.push({input:v(new Rs(a.times,1)),output:v(new Rs(a.values,d)),interpolation:h}),n.push({sampler:r.length-1,target:{node:c.get(u),path:l}})}return i.animations.push({name:t.name||"clip_"+i.animations.length,samplers:r,channels:n}),i.animations.length-1}function x(t){var e=i.nodes[c.get(t)],n=t.skeleton,r=t.skeleton.bones[0];if(void 0===r)return null;for(var o=[],a=new Float32Array(16*n.bones.length),s=0;s<n.bones.length;++s)o.push(c.get(n.bones[s])),n.boneInverses[s].toArray(a,16*s);return void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:v(new Rs(a,16)),joints:o,skeleton:c.get(r)}),e.skin=i.skins.length-1}function w(t){if(t.isLight)return console.warn("GLTFExporter: Unsupported node type:",t.constructor.name),null;i.nodes||(i.nodes=[]);var e={};if(n.trs){var r=t.quaternion.toArray(),o=t.position.toArray(),a=t.scale.toArray();d(r,[0,0,0,1])||(e.rotation=r),d(o,[0,0,0])||(e.translation=o),d(a,[1,1,1])||(e.scale=a)}else t.updateMatrix(),d(t.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(e.matrix=t.matrix.elements);if(""!==t.name&&(e.name=String(t.name)),t.userData&&Object.keys(t.userData).length>0)try{e.extras=JSON.parse(JSON.stringify(t.userData))}catch(t){throw new Error("GLTFExporter: userData can't be serialized")}if(t.isMesh||t.isLine||t.isPoints?e.mesh=function(t){i.meshes||(i.meshes=[]);var e,r=t.geometry;if(t.isLineSegments)e=Fh.LINES;else if(t.isLineLoop)e=Fh.LINE_LOOP;else if(t.isLine)e=Fh.LINE_STRIP;else if(t.isPoints)e=Fh.POINTS;else{if(!r.isBufferGeometry){var o=new Xs;o.fromGeometry(r),r=o}t.drawMode===zc?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),e=Fh.TRIANGLE_FAN):e=t.drawMode===Bc?t.material.wireframe?Fh.LINE_STRIP:Fh.TRIANGLE_STRIP:t.material.wireframe?Fh.LINES:Fh.TRIANGLES}var a={},s={},c=[],u=[],l={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"};for(var h in r.attributes){var d=r.attributes[h];"MORPH"!==(h=l[h]||h.toUpperCase()).substr(0,5)&&(s[h]=v(d,r))}if(void 0!==t.morphTargetInfluences&&t.morphTargetInfluences.length>0){var p=[],f=[],m={};if(void 0!==t.morphTargetDictionary)for(var g in t.morphTargetDictionary)m[t.morphTargetDictionary[g]]=g;for(var b=0;b<t.morphTargetInfluences.length;++b){var x={},w=!1;for(var h in r.morphAttributes)if("position"===h||"normal"===h){for(var _=r.attributes[h],S=(d=r.morphAttributes[h][b]).clone(),T=0,M=d.count;T<M;T++)S.setXYZ(T,d.getX(T)-_.getX(T),d.getY(T)-_.getY(T),d.getZ(T)-_.getZ(T));x[h.toUpperCase()]=v(S,r)}else w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);u.push(x),p.push(t.morphTargetInfluences[b]),void 0!==t.morphTargetDictionary&&f.push(m[b])}a.weights=p,f.length>0&&(a.extras={},a.extras.targetNames=f)}var A=n.forceIndices,E=Array.isArray(t.material);!A&&null===r.index&&E&&(console.warn("GLTFExporter: Creating index for non-indexed multi-material mesh."),A=!0);var C=!1;if(null===r.index&&A){for(var P=[],O=(b=0,r.attributes.position.count);b<O;b++)P[b]=b;r.setIndex(P),C=!0}var N=E?t.material:[t.material],L=E?t.geometry.groups:[{materialIndex:0,start:void 0,count:void 0}];for(b=0,O=L.length;b<O;b++){var I={mode:e,attributes:s};u.length>0&&(I.targets=u);var R=y(N[L[b].materialIndex]);null!==R&&(I.material=R),null!==r.index&&(I.indices=v(r.index,r,L[b].start,L[b].count)),c.push(I)}return C&&r.setIndex(null),a.primitives=c,i.meshes.push(a),i.meshes.length-1}(t):t.isCamera&&(e.camera=function(t){i.cameras||(i.cameras=[]);var e=t.isOrthographicCamera,n={type:e?"orthographic":"perspective"};return e?n.orthographic={xmag:2*t.right,ymag:2*t.top,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:n.perspective={aspectRatio:t.aspect,yfov:os.degToRad(t.fov)/t.aspect,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},""!==t.name&&(n.name=t.type),i.cameras.push(n),i.cameras.length-1}(t)),t.isSkinnedMesh&&u.push(t),t.children.length>0){for(var s=[],l=0,h=t.children.length;l<h;l++){var p=t.children[l];if(p.visible||!1===n.onlyVisible){var f=w(p);null!==f&&s.push(f)}}s.length>0&&(e.children=s)}i.nodes.push(e);var m=i.nodes.length-1;return c.set(t,m),m}function _(t){i.scenes||(i.scenes=[],i.scene=0);var e={nodes:[]};""!==t.name&&(e.name=t.name),i.scenes.push(e);for(var r=[],o=0,a=t.children.length;o<a;o++){var s=t.children[o];if(s.visible||!1===n.onlyVisible){var c=w(s);null!==c&&r.push(c)}}r.length>0&&(e.nodes=r)}!function(t){t=t instanceof Array?t:[t];for(var e=[],r=0;r<t.length;r++)t[r]instanceof Eu?_(t[r]):e.push(t[r]);for(e.length>0&&function(t){var e=new Eu;e.name="AuxScene";for(var n=0;n<t.length;n++)e.children.push(t[n]);_(e)}(e),r=0;r<u.length;++r)x(u[r]);for(r=0;r<n.animations.length;++r)b(n.animations[r],t[0])}(t),Promise.all(s).then(function(){var t=new Blob(a,{type:"application/octet-stream"}),r=Object.keys(l);if(r.length>0&&(i.extensionsUsed=r),i.buffers&&i.buffers.length>0){i.buffers[0].byteLength=t.size;var o=new window.FileReader;!0===n.binary?(o.readAsArrayBuffer(t),o.onloadend=function(){var t=f(o.result),n=new DataView(new ArrayBuffer(8));n.setUint32(0,t.byteLength,!0),n.setUint32(4,5130562,!0);var r=f(function(t){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(t).buffer;for(var e=new Uint8Array(new ArrayBuffer(t.length)),n=0,r=t.length;n<r;n++){var i=t.charCodeAt(n);e[n]=i>255?32:i}return e.buffer}(JSON.stringify(i)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,r.byteLength,!0),a.setUint32(4,1313821514,!0);var s=new ArrayBuffer(12),c=new DataView(s);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0),c.setUint32(8,12+a.byteLength+r.byteLength+n.byteLength+t.byteLength,!0);var u=new Blob([s,a,r,n,t],{type:"application/octet-stream"}),l=new window.FileReader;l.readAsArrayBuffer(u),l.onloadend=function(){e(l.result)}}):(o.readAsDataURL(t),o.onloadend=function(){i.buffers[0].uri=o.result,e(i)})}else e(i)})}};var Bh=function(){};Bh.prototype={constructor:Bh,parse:function(t){var e,n,r,i,o,a="",s=0,c=0,u=0,l=new ss,h=new ss,d=new Cs,p=[];return t.traverse(function(t){t instanceof Kc&&function(t){var r=0,f=0,m=0,v=t.geometry,g=new ds;if(v instanceof Ls&&(v=(new Xs).setFromObject(t)),v instanceof Xs){var y=v.getAttribute("position"),b=v.getAttribute("normal"),x=v.getAttribute("uv"),w=v.getIndex();if(a+="o "+t.name+"\n",t.material&&t.material.name&&(a+="usemtl "+t.material.name+"\n"),void 0!==y)for(e=0,i=y.count;e<i;e++,r++)l.x=y.getX(e),l.y=y.getY(e),l.z=y.getZ(e),l.applyMatrix4(t.matrixWorld),a+="v "+l.x+" "+l.y+" "+l.z+"\n";if(void 0!==x)for(e=0,i=x.count;e<i;e++,m++)d.x=x.getX(e),d.y=x.getY(e),a+="vt "+d.x+" "+d.y+"\n";if(void 0!==b)for(g.getNormalMatrix(t.matrixWorld),e=0,i=b.count;e<i;e++,f++)h.x=b.getX(e),h.y=b.getY(e),h.z=b.getZ(e),h.applyMatrix3(g),a+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==w)for(e=0,i=w.count;e<i;e+=3){for(o=0;o<3;o++)n=w.getX(e+o)+1,p[o]=s+n+(b||x?"/"+(x?c+n:"")+(b?"/"+(u+n):""):"");a+="f "+p.join(" ")+"\n"}else for(e=0,i=y.count;e<i;e+=3){for(o=0;o<3;o++)p[o]=s+(n=e+o+1)+(b||x?"/"+(x?c+n:"")+(b?"/"+(u+n):""):"");a+="f "+p.join(" ")+"\n"}}else console.warn("OBJExporter.parseMesh(): geometry type unsupported",v);s+=r,c+=m,u+=f}(t),t instanceof $c&&function(t){var o=0,c=t.geometry,u=t.type;if(c instanceof Ls&&(c=(new Xs).setFromObject(t)),c instanceof Xs){var h=c.getAttribute("position");if(a+="o "+t.name+"\n",void 0!==h)for(e=0,i=h.count;e<i;e++,o++)l.x=h.getX(e),l.y=h.getY(e),l.z=h.getZ(e),l.applyMatrix4(t.matrixWorld),a+="v "+l.x+" "+l.y+" "+l.z+"\n";if("Line"===u){for(a+="l ",n=1,i=h.count;n<=i;n++)a+=s+n+" ";a+="\n"}if("LineSegments"===u)for(r=1+(n=1),i=h.count;n<i;r=(n+=2)+1)a+="l "+(s+n)+" "+(s+r)+"\n"}else console.warn("OBJExporter.parseLine(): geometry type unsupported",c);s+=o}(t)}),a}};var zh=function(){};zh.prototype={constructor:zh,parse:function(t,e){!0!==Array.isArray(e)&&(e=[]);var n=-1===e.indexOf("normal"),r=-1===e.indexOf("color"),i=-1===e.indexOf("uv"),o=0,a=0,s="",c="",u=new ss,l=new ds;t.traverse(function(t){if(t instanceof Kc){var e=t,h=e.geometry;if(h instanceof Ls&&(h=(new Xs).setFromObject(e)),h instanceof Xs){var d=h.getAttribute("position"),p=h.getAttribute("normal"),f=h.getAttribute("uv"),m=h.getAttribute("color"),v=h.getIndex();if(l.getNormalMatrix(e.matrixWorld),void 0===d)return;for(y=0,b=d.count;y<b;y++){u.x=d.getX(y),u.y=d.getY(y),u.z=d.getZ(y),u.applyMatrix4(e.matrixWorld);var g=u.x+" "+u.y+" "+u.z;!0===n&&(void 0!==p?(u.x=p.getX(y),u.y=p.getY(y),u.z=p.getZ(y),u.applyMatrix3(l),g+=" "+u.x+" "+u.y+" "+u.z):g+=" 0 0 0"),!0===i&&(void 0!==f?g+=" "+f.getX(y)+" "+f.getY(y):!1!==i&&(g+=" 0 0")),!0===r&&(g+=void 0!==m?" "+Math.floor(m.getX(y))+" "+Math.floor(m.getY(y))+" "+Math.floor(m.getZ(y)):" 255 255 255"),s+=g+"\n"}if(null!==v)for(y=0,b=v.count;y<b;y+=3)c+="3 "+(v.getX(y+0)+o),c+=" "+(v.getX(y+1)+o),c+=" "+(v.getX(y+2)+o)+"\n";else for(var y=0,b=d.count;y<b;y+=3)c+="3 "+(o+y)+" "+(o+y+1)+" "+(o+y+2)+"\n";o+=d.count,a+=v?v.count/3:d.count/3}}});var h="ply\nformat ascii 1.0\nelement vertex "+o+"\nproperty float x\nproperty float y\nproperty float z\n";return!0===n&&(h+="property float nx\nproperty float ny\nproperty float nz\n"),!0===i&&(h+="property float s\nproperty float t\n"),!0===r&&(h+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),h+"element face "+a+"\nproperty list uchar int vertex_index\nend_header\n"+s+"\n"+c+"\n"}};var Vh=function(){};Vh.prototype={constructor:Vh,parse:function(){var t=new ss,e=new ds;return function(n){var r=[],i=0;n.traverse(function(t){if(t instanceof Kc){var e=t.geometry;e instanceof Xs&&(e=(new Ls).fromBufferGeometry(e)),e instanceof Ls&&(i+=e.faces.length,r.push({geometry:e,matrix:t.matrixWorld}))}});var o=80,a=new ArrayBuffer(2*i+3*i*4*4+80+4),s=new DataView(a);return s.setUint32(o,i,!0),o+=4,r.forEach(function(n){var r=n.geometry.vertices,i=n.geometry.faces;e.getNormalMatrix(n.matrix);for(var a=0,c=i.length;a<c;a++){var u=i[a];t.copy(u.normal).applyMatrix3(e).normalize(),s.setFloat32(o,t.x,!0),s.setFloat32(o+=4,t.y,!0),s.setFloat32(o+=4,t.z,!0),o+=4;for(var l=[u.a,u.b,u.c],h=0;h<3;h++)t.copy(r[l[h]]).applyMatrix4(n.matrix),s.setFloat32(o,t.x,!0),s.setFloat32(o+=4,t.y,!0),s.setFloat32(o+=4,t.z,!0),o+=4;s.setUint16(o,0,!0),o+=2}}),s}}()};var Gh=function(){};Gh.prototype={constructor:Gh,parse:function(){var t=new ss,e=new ds;return function(n){var r="";return r+="solid exported\n",n.traverse(function(n){if(n instanceof Kc){var i=n.geometry,o=n.matrixWorld;if(i instanceof Xs&&(i=(new Ls).fromBufferGeometry(i)),i instanceof Ls){var a=i.vertices,s=i.faces;e.getNormalMatrix(o);for(var c=0,u=s.length;c<u;c++){var l=s[c];t.copy(l.normal).applyMatrix3(e).normalize(),r+="\tfacet normal "+t.x+" "+t.y+" "+t.z+"\n",r+="\t\touter loop\n";for(var h=[l.a,l.b,l.c],d=0;d<3;d++)t.copy(a[h[d]]).applyMatrix4(o),r+="\t\t\tvertex "+t.x+" "+t.y+" "+t.z+"\n";r+="\t\tendloop\n",r+="\tendfacet\n"}}}}),r+="endsolid exported\n"}}()};var Hh=function(){};function Wh(t,e,n,r){Xs.call(this);var i=[],o=[],a=[],s=new ss,c=new as;c.makeRotationFromEuler(n),c.setPosition(e);var u=(new as).getInverse(c);function l(e,n,r){n.applyMatrix4(t.matrix),n.applyMatrix4(u),e.push(new Xh(n.clone(),r.clone()))}function h(t,e){for(var n=[],i=.5*Math.abs(r.dot(e)),o=0;o<t.length;o+=3){var a,s,c,u,l,h,p,f=t[o+0].position.dot(e)-i;switch(s=t[o+1].position.dot(e)-i>0,c=t[o+2].position.dot(e)-i>0,((a=f>0)?1:0)+(s?1:0)+(c?1:0)){case 0:n.push(t[o]),n.push(t[o+1]),n.push(t[o+2]);break;case 1:if(a&&(l=t[o+2],h=d(t[o],u=t[o+1],e,i),p=d(t[o],l,e,i)),s){l=t[o+2],h=d(t[o+1],u=t[o],e,i),p=d(t[o+1],l,e,i),n.push(h),n.push(l.clone()),n.push(u.clone()),n.push(l.clone()),n.push(h.clone()),n.push(p);break}c&&(l=t[o+1],h=d(t[o+2],u=t[o],e,i),p=d(t[o+2],l,e,i)),n.push(u.clone()),n.push(l.clone()),n.push(h),n.push(p),n.push(h.clone()),n.push(l.clone());break;case 2:a||(l=d(u=t[o].clone(),t[o+1],e,i),h=d(u,t[o+2],e,i),n.push(u),n.push(l),n.push(h)),s||(l=d(u=t[o+1].clone(),t[o+2],e,i),h=d(u,t[o],e,i),n.push(u),n.push(l),n.push(h)),c||(l=d(u=t[o+2].clone(),t[o],e,i),h=d(u,t[o+1],e,i),n.push(u),n.push(l),n.push(h))}}return n}function d(t,e,n,r){var i=t.position.dot(n)-r,o=i/(i-(e.position.dot(n)-r));return new Xh(new ss(t.position.x+o*(e.position.x-t.position.x),t.position.y+o*(e.position.y-t.position.y),t.position.z+o*(e.position.z-t.position.z)),new ss(t.normal.x+o*(e.normal.x-t.normal.x),t.normal.y+o*(e.normal.y-t.normal.y),t.normal.z+o*(e.normal.z-t.normal.z)))}!function(){var e,n=new Xs,u=[],d=new ss,p=new ss;t.geometry.isGeometry?n.fromGeometry(t.geometry):n.copy(t.geometry);var f=n.attributes.position,m=n.attributes.normal;if(null!==n.index){var v=n.index;for(e=0;e<v.count;e++)d.fromBufferAttribute(f,v.getX(e)),p.fromBufferAttribute(m,v.getX(e)),l(u,d,p)}else for(e=0;e<f.count;e++)d.fromBufferAttribute(f,e),p.fromBufferAttribute(m,e),l(u,d,p);for(u=h(u=h(u=h(u=h(u=h(u=h(u,s.set(1,0,0)),s.set(-1,0,0)),s.set(0,1,0)),s.set(0,-1,0)),s.set(0,0,1)),s.set(0,0,-1)),e=0;e<u.length;e++){var g=u[e];a.push(.5+g.position.x/r.x,.5+g.position.y/r.y),g.position.applyMatrix4(c),i.push(g.position.x,g.position.y,g.position.z),o.push(g.normal.x,g.normal.y,g.normal.z)}}(),this.addAttribute("position",new Vs(i,3)),this.addAttribute("normal",new Vs(o,3)),this.addAttribute("uv",new Vs(a,2))}function Xh(t,e){this.position=t,this.normal=e}Hh.prototype={constructor:Hh,parse:function(t){var e={metadata:{version:4,type:"TypedGeometry",generator:"TypedGeometryExporter"}},n=["vertices","normals","uvs"];for(var r in n){for(var i=n[r],o=t[i],a=[],s=0,c=o.length;s<c;s++)a[s]=o[s];e[i]=a}var u=t.boundingSphere;return null!==u&&(e.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}},(Wh.prototype=Object.create(Xs.prototype)).constructor=Wh,Xh.prototype.clone=function(){return new Xh(this.position.clone(),this.normal.clone())};var qh=function(t,e,n,r,i,o,a){var s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],c=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];Xs.call(this),t=t||50,e=void 0!==e?Math.max(2,Math.floor(e)||10):10,n=void 0===n||n,r=void 0===r||r,i=void 0===i||i,o=void 0===o||o;var u=3.15*((a=void 0===a||a)?1:1.3)/2,l=t/u,h=n?(8*e-4)*e:0;h+=r?(16*e-4)*e:0,h+=i?40*e*e:0;var d=new Uint32Array(3*h),p=n?4:0;p+=r?8:0,p+=i?20:0,p*=(e+1)*(e+1);var f=new Float32Array(3*p),m=new Float32Array(3*p),v=new Float32Array(2*p),g=new as;g.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var y,b,x,w,_,S,T,M,A,E,C,P,O,N,L,I,R=[],D=[],F=[],U=[],k=[],j=[],B=[],z=[],V=[],G=new ss,H=0,W=0,X=new ss,q=new as,Y=new as,Z=new Is,J=new Is,Q=new Is,K=new Is,$=new ss,tt=new ss,et=g.clone();et.transpose();var nt=function(t,e,n){return!(f[3*t]===f[3*e]&&f[3*t+1]===f[3*e+1]&&f[3*t+2]===f[3*e+2]||f[3*t]===f[3*n]&&f[3*t+1]===f[3*n+1]&&f[3*t+2]===f[3*n+2]||f[3*e]===f[3*n]&&f[3*e+1]===f[3*n+1]&&f[3*e+2]===f[3*n+2])};for(y=0;y<3;y++)j[y]=new as;var rt=n?32:28;T=e+1;for(var it=0,ot=0,at=0,st=0,ct=0,ut=i?0:20;ut<rt;ut++)if(r||ut<20||ut>=28){for(y=0;y<3;y++){for(b=0;b<4;b++)for(x=0;x<4;x++)R[4*x+b]=c[3*s[16*ut+4*b+x]+y],o&&ut>=20&&ut<28&&2!==y&&(R[4*x+b]*=1.077),a||2!==y||(R[4*x+b]*=1.3);q.set(R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7],R[8],R[9],R[10],R[11],R[12],R[13],R[14],R[15]),Y.multiplyMatrices(q,g),j[y].multiplyMatrices(et,Y)}for(_=0;_<=e;_++)for(M=_/e,S=0;S<=e;S++){for(A=S/e,P=4,E=C=1;P--;)D[P]=E,F[P]=C,E*=M,C*=A,3===P?(U[P]=k[P]=0,H=W=1):(U[P]=H*(3-P),k[P]=W*(3-P),H*=M,W*=A);for(Z.fromArray(D),J.fromArray(F),Q.fromArray(U),K.fromArray(k),y=0;y<3;y++)(w=Z.clone()).applyMatrix4(j[y]),B[y]=w.dot(J),(w=Q.clone()).applyMatrix4(j[y]),z[y]=w.dot(J),(w=Z.clone()).applyMatrix4(j[y]),V[y]=w.dot(K);$.fromArray(z),tt.fromArray(V),G.crossVectors(tt,$),G.normalize(),0===B[0]&&0===B[1]?X.set(0,B[2]>u?1:-1,0):X.set(G.x,G.z,-G.y),f[ot++]=l*B[0],f[ot++]=l*(B[2]-u),f[ot++]=-l*B[1],m[at++]=X.x,m[at++]=X.y,m[at++]=X.z,v[st++]=1-A,v[st++]=1-M}for(_=0;_<e;_++)for(S=0;S<e;S++)I=(O=it*T*T+_*T+S)+T,nt(O,N=O+1,L=N+T)&&(d[ct++]=O,d[ct++]=N,d[ct++]=L),nt(O,L,I)&&(d[ct++]=O,d[ct++]=L,d[ct++]=I);it++}this.setIndex(new Rs(d,1)),this.addAttribute("position",new Rs(f,3)),this.addAttribute("normal",new Rs(m,3)),this.addAttribute("uv",new Rs(v,2)),this.computeBoundingSphere()};function Yh(t,e,n,r,i,o,a,s,c,u,l,h){Ou.call(this,null,o,a,s,c,u,r,i,l,h),this.image={data:t,width:e,height:n},this.magFilter=void 0!==c?c:Mc,this.minFilter=void 0!==u?u:Mc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Zh(t,e){ys.call(this),this.type="Points",this.geometry=void 0!==t?t:new Xs,this.material=void 0!==e?e:new el({color:16777215*Math.random()})}(qh.prototype=Object.create(Xs.prototype)).constructor=qh,(Yh.prototype=Object.create(Ou.prototype)).constructor=Yh,Yh.prototype.isDataTexture=!0,Zh.prototype=Object.assign(Object.create(ys.prototype),{constructor:Zh,isPoints:!0,raycast:function(){var t=new as,e=new Yc,n=new Es;return function(r,i){var o=this,a=this.geometry,s=this.matrixWorld,c=r.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(s),n.radius+=c,!1!==r.ray.intersectsSphere(n)){t.getInverse(s),e.copy(r.ray).applyMatrix4(t);var u=c/((this.scale.x+this.scale.y+this.scale.z)/3),l=u*u,h=new ss,d=new ss;if(a.isBufferGeometry){var p=a.index,f=a.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var b=f.length/3;v<b;v++)h.fromArray(f,3*v),w(h,v)}}else{var x=a.vertices;for(v=0,b=x.length;v<b;v++)w(x[v],v)}}function w(t,n){var a=e.distanceSqToPoint(t);if(a<l){e.closestPointToPoint(t,d),d.applyMatrix4(s);var c=r.ray.origin.distanceTo(d);if(c<r.near||c>r.far)return;i.push({distance:c,distanceToRay:Math.sqrt(a),point:d.clone(),index:n,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Jh=function(t){ys.apply(this,arguments),this.PARTICLE_COUNT=(t=t||{}).maxParticles||1e6,this.PARTICLE_CONTAINERS=t.containerCount||1,this.PARTICLE_NOISE_TEXTURE=t.particleNoiseTex||null,this.PARTICLE_SPRITE_TEXTURE=t.particleSpriteTex||null,this.PARTICLES_PER_CONTAINER=Math.ceil(this.PARTICLE_COUNT/this.PARTICLE_CONTAINERS),this.PARTICLE_CURSOR=0,this.time=0,this.particleContainers=[],this.rand=[];var e,n={vertexShader:["uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec3 positionStart;","attribute float startTime;","attribute vec3 velocity;","attribute float turbulence;","attribute vec3 color;","attribute float size;","attribute float lifeTime;","varying vec4 vColor;","varying float lifeLeft;","void main() {","\tvColor = vec4( color, 1.0 );","\tvec3 newPosition;","\tvec3 v;","\tfloat timeElapsed = uTime - startTime;","\tlifeLeft = 1.0 - ( timeElapsed / lifeTime );","\tgl_PointSize = ( uScale * size ) * lifeLeft;","\tv.x = ( velocity.x - 0.5 ) * 3.0;","\tv.y = ( velocity.y - 0.5 ) * 3.0;","\tv.z = ( velocity.z - 0.5 ) * 3.0;","\tnewPosition = positionStart + ( v * 10.0 ) * timeElapsed;","\tvec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;","\tvec3 noiseVel = ( noise.rgb - 0.5 ) * 30.0;","\tnewPosition = mix( newPosition, newPosition + vec3( noiseVel * ( turbulence * 5.0 ) ), ( timeElapsed / lifeTime ) );","\tif( v.y > 0. && v.y < .05 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( v.x < - 1.45 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( timeElapsed > 0.0 ) {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","\t} else {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\t\tlifeLeft = 0.0;","\t\tgl_PointSize = 0.;","\t}","}"].join("\n"),fragmentShader:["float scaleLinear( float value, vec2 valueDomain ) {","\treturn ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );","}","float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {","\treturn mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","\tfloat alpha = 0.;","\tif( lifeLeft > 0.995 ) {","\t\talpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );","\t} else {","\t\talpha = lifeLeft * 0.75;","\t}","\tvec4 tex = texture2D( tSprite, gl_PointCoord );","\tgl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")};for(e=1e5;e>0;e--)this.rand.push(Math.random()-.5);this.random=function(){return++e>=this.rand.length?this.rand[e=1]:this.rand[e]};var r=new sl;this.particleNoiseTex=this.PARTICLE_NOISE_TEXTURE||r.load("textures/perlin-512.png"),this.particleNoiseTex.wrapS=this.particleNoiseTex.wrapT=_c,this.particleSpriteTex=this.PARTICLE_SPRITE_TEXTURE||r.load("textures/particle2.png"),this.particleSpriteTex.wrapS=this.particleSpriteTex.wrapT=_c,this.particleShaderMat=new Iu({transparent:!0,depthWrite:!1,uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:this.particleNoiseTex},tSprite:{value:this.particleSpriteTex}},blending:2,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.particleShaderMat.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0],this.particleShaderMat.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0],this.init=function(){for(var t=0;t<this.PARTICLE_CONTAINERS;t++){var e=new Qh(this.PARTICLES_PER_CONTAINER,this);this.particleContainers.push(e),this.add(e)}},this.spawnParticle=function(t){this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=1),this.particleContainers[Math.floor(this.PARTICLE_CURSOR/this.PARTICLES_PER_CONTAINER)].spawnParticle(t)},this.update=function(t){for(var e=0;e<this.PARTICLE_CONTAINERS;e++)this.particleContainers[e].update(t)},this.dispose=function(){this.particleShaderMat.dispose(),this.particleNoiseTex.dispose(),this.particleSpriteTex.dispose();for(var t=0;t<this.PARTICLE_CONTAINERS;t++)this.particleContainers[t].dispose()},this.init()};(Jh.prototype=Object.create(ys.prototype)).constructor=Jh;var Qh=function(t,e){ys.apply(this,arguments),this.PARTICLE_COUNT=t||1e5,this.PARTICLE_CURSOR=0,this.time=0,this.offset=0,this.count=0,this.DPR=window.devicePixelRatio,this.GPUParticleSystem=e,this.particleUpdate=!1,this.particleShaderGeo=new Xs,this.particleShaderGeo.addAttribute("position",new Rs(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("positionStart",new Rs(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("startTime",new Rs(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("velocity",new Rs(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("turbulence",new Rs(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("color",new Rs(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("size",new Rs(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("lifeTime",new Rs(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderMat=this.GPUParticleSystem.particleShaderMat;var n=new ss,r=new ss,i=new Ts;this.spawnParticle=function(t){var o=this.particleShaderGeo.getAttribute("positionStart"),a=this.particleShaderGeo.getAttribute("startTime"),s=this.particleShaderGeo.getAttribute("velocity"),c=this.particleShaderGeo.getAttribute("turbulence"),u=this.particleShaderGeo.getAttribute("color"),l=this.particleShaderGeo.getAttribute("size"),h=this.particleShaderGeo.getAttribute("lifeTime");n=void 0!==(t=t||{}).position?n.copy(t.position):n.set(0,0,0),r=void 0!==t.velocity?r.copy(t.velocity):r.set(0,0,0),i=i.set(void 0!==t.color?t.color:16777215);var d=void 0!==t.positionRandomness?t.positionRandomness:0,p=void 0!==t.velocityRandomness?t.velocityRandomness:0,f=void 0!==t.colorRandomness?t.colorRandomness:1,m=void 0!==t.turbulence?t.turbulence:1,v=void 0!==t.lifetime?t.lifetime:5,g=void 0!==t.size?t.size:10,y=void 0!==t.sizeRandomness?t.sizeRandomness:0,b=void 0!==t.smoothPosition&&t.smoothPosition;void 0!==this.DPR&&(g*=this.DPR);var x=this.PARTICLE_CURSOR;o.array[3*x+0]=n.x+e.random()*d,o.array[3*x+1]=n.y+e.random()*d,o.array[3*x+2]=n.z+e.random()*d,!0===b&&(o.array[3*x+0]+=-r.x*e.random(),o.array[3*x+1]+=-r.y*e.random(),o.array[3*x+2]+=-r.z*e.random());var w=r.x+e.random()*p,_=r.y+e.random()*p,S=r.z+e.random()*p;w=os.clamp((w- -2)/4,0,1),_=os.clamp((_- -2)/4,0,1),S=os.clamp((S- -2)/4,0,1),s.array[3*x+0]=w,s.array[3*x+1]=_,s.array[3*x+2]=S,i.r=os.clamp(i.r+e.random()*f,0,1),i.g=os.clamp(i.g+e.random()*f,0,1),i.b=os.clamp(i.b+e.random()*f,0,1),u.array[3*x+0]=i.r,u.array[3*x+1]=i.g,u.array[3*x+2]=i.b,c.array[x]=m,l.array[x]=g+e.random()*y,h.array[x]=v,a.array[x]=this.time+.02*e.random(),0===this.offset&&(this.offset=this.PARTICLE_CURSOR),this.count++,this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=0),this.particleUpdate=!0},this.init=function(){this.particleSystem=new Zh(this.particleShaderGeo,this.particleShaderMat),this.particleSystem.frustumCulled=!1,this.add(this.particleSystem)},this.update=function(t){this.time=t,this.particleShaderMat.uniforms.uTime.value=t,this.geometryUpdate()},this.geometryUpdate=function(){if(!0===this.particleUpdate){this.particleUpdate=!1;var t=this.particleShaderGeo.getAttribute("positionStart"),e=this.particleShaderGeo.getAttribute("startTime"),n=this.particleShaderGeo.getAttribute("velocity"),r=this.particleShaderGeo.getAttribute("turbulence"),i=this.particleShaderGeo.getAttribute("color"),o=this.particleShaderGeo.getAttribute("size"),a=this.particleShaderGeo.getAttribute("lifeTime");this.offset+this.count<this.PARTICLE_COUNT?(t.updateRange.offset=this.offset*t.itemSize,e.updateRange.offset=this.offset*e.itemSize,n.updateRange.offset=this.offset*n.itemSize,r.updateRange.offset=this.offset*r.itemSize,i.updateRange.offset=this.offset*i.itemSize,o.updateRange.offset=this.offset*o.itemSize,a.updateRange.offset=this.offset*a.itemSize,t.updateRange.count=this.count*t.itemSize,e.updateRange.count=this.count*e.itemSize,n.updateRange.count=this.count*n.itemSize,r.updateRange.count=this.count*r.itemSize,i.updateRange.count=this.count*i.itemSize,o.updateRange.count=this.count*o.itemSize,a.updateRange.count=this.count*a.itemSize):(t.updateRange.offset=0,e.updateRange.offset=0,n.updateRange.offset=0,r.updateRange.offset=0,i.updateRange.offset=0,o.updateRange.offset=0,a.updateRange.offset=0,t.updateRange.count=-1,e.updateRange.count=-1,n.updateRange.count=-1,r.updateRange.count=-1,i.updateRange.count=-1,o.updateRange.count=-1,a.updateRange.count=-1),t.needsUpdate=!0,e.needsUpdate=!0,n.needsUpdate=!0,r.needsUpdate=!0,i.needsUpdate=!0,o.needsUpdate=!0,a.needsUpdate=!0,this.offset=0,this.count=0}},this.dispose=function(){this.particleShaderGeo.dispose()},this.init()};Qh.prototype=Object.create(ys.prototype),Qh.prototype.constructor=Qh;var Kh,$h,td,ed,nd,rd,id=function(){ys.call(this)};function od(){Xs.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function ad(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function sd(t,e,n){ad.call(this,t,e),this.meshPerAttribute=n||1}function cd(t,e,n,r){this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function ud(t){Xs.call(this),this.type="WireframeGeometry";var e,n,r,i,o,a,s,c,u,l,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,r=m.length;e<r;e++){var v=m[e];for(n=0;n<3;n++)s=v[f[n]],c=v[f[(n+1)%3]],d[0]=Math.min(s,c),d[1]=Math.max(s,c),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]})}for(u in p)h.push((l=t.vertices[(a=p[u]).index1]).x,l.y,l.z),h.push((l=t.vertices[a.index2]).x,l.y,l.z)}else if(t&&t.isBufferGeometry){var g,y,b,x,w;if(l=new ss,null!==t.index){for(g=t.attributes.position,y=t.index,0===(b=t.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),i=0,o=b.length;i<o;++i)for(e=w=(x=b[i]).start,r=w+x.count;e<r;e+=3)for(n=0;n<3;n++)s=y.getX(e+n),c=y.getX(e+(n+1)%3),d[0]=Math.min(s,c),d[1]=Math.max(s,c),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]});for(u in p)l.fromBufferAttribute(g,(a=p[u]).index1),h.push(l.x,l.y,l.z),l.fromBufferAttribute(g,a.index2),h.push(l.x,l.y,l.z)}else for(e=0,r=(g=t.attributes.position).count/3;e<r;e++)for(n=0;n<3;n++)l.fromBufferAttribute(g,3*e+n),h.push(l.x,l.y,l.z),l.fromBufferAttribute(g,3*e+(n+1)%3),h.push(l.x,l.y,l.z)}this.addAttribute("position",new Vs(h,3))}(id.prototype=Object.create(ys.prototype)).constructor=id,id.prototype.updateMatrixWorld=(Kh=new ss,$h=new cs,td=new ss,ed=new ss,nd=new cs,rd=new ss,function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(ed,nd,rd),this.matrix.decompose(Kh,$h,td),this.matrixWorld.compose(ed,$h,rd)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;e<n;e++)this.children[e].updateMatrixWorld(t)}),od.prototype=Object.assign(Object.create(Xs.prototype),{constructor:od,isInstancedBufferGeometry:!0,copy:function(t){return Xs.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperty(ad.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(ad.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),sd.prototype=Object.assign(Object.create(ad.prototype),{constructor:sd,isInstancedInterleavedBuffer:!0,copy:function(t){return ad.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.defineProperties(cd.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(cd.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}}),(ud.prototype=Object.create(Xs.prototype)).constructor=ud;var ld=function(){od.call(this),this.type="LineSegmentsGeometry",new Xs,this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.addAttribute("position",new Vs([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.addAttribute("uv",new Vs([0,1,1,1,0,.5,1,.5,0,.5,1,.5,0,0,1,0],2))};ld.prototype=Object.assign(Object.create(od.prototype),{constructor:ld,isLineSegmentsGeometry:!0,applyMatrix:function(t){var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(t.applyToBufferAttribute(e),t.applyToBufferAttribute(n),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new sd(e,6,1);return this.addAttribute("instanceStart",new cd(n,3,0)),this.addAttribute("instanceEnd",new cd(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new sd(e,6,1);return this.addAttribute("instanceColorStart",new cd(n,3,0)),this.addAttribute("instanceColorEnd",new cd(n,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new ud(t.geometry)),this},fromLineSegements:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},computeBoundingBox:function(){var t=new As;return function(){null===this.boundingBox&&(this.boundingBox=new As);var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;void 0!==e&&void 0!==n&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(n),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new ss;return function(){null===this.boundingSphere&&(this.boundingSphere=new Es),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==e&&void 0!==n){var r=this.boundingSphere.center;this.boundingBox.getCenter(r);for(var i=0,o=0,a=e.count;o<a;o++)t.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(t)),t.fromBufferAttribute(n,o),i=Math.max(i,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},clone:function(){},copy:function(t){return this}}),Lh.line={linewidth:{value:1},resolution:{value:new Cs(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Ih.line={uniforms:Lu.merge([Lh.common,Lh.fog,Lh.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) {\n\n\t\t\t\tfloat a = vUv.x - 0.5;\n\t\t\t\tfloat b = vUv.y - 0.5;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 0.25 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var hd=function(t){Iu.call(this,{type:"LineMaterial",uniforms:Lu.clone(Ih.line.uniforms),vertexShader:Ih.line.vertexShader,fragmentShader:Ih.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};(hd.prototype=Object.create(Iu.prototype)).constructor=hd,hd.prototype.isLineMaterial=!0,hd.prototype.copy=function(t){return Iu.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.resolution=t.resolution,this};var dd=function(t,e){Kc.call(this),this.type="LineSegments2",this.geometry=void 0!==t?t:new ld,this.material=void 0!==e?e:new hd({color:16777215*Math.random()})};dd.prototype=Object.assign(Object.create(Kc.prototype),{constructor:dd,isLineSegments2:!0,computeLineDistances:function(){var t=new ss,e=new ss;return function(){for(var n=this.geometry,r=n.attributes.instanceStart,i=n.attributes.instanceEnd,o=new Float32Array(2*r.data.count),a=0,s=0,c=r.data.count;a<c;a++,s+=2)t.fromBufferAttribute(r,a),e.fromBufferAttribute(i,a),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+t.distanceTo(e);var u=new sd(o,2,1);return n.addAttribute("instanceDistanceStart",new cd(u,1,0)),n.addAttribute("instanceDistanceEnd",new cd(u,1,1)),this}}(),copy:function(t){return this}});var pd=function(){ld.call(this),this.type="LineGeometry"};pd.prototype=Object.assign(Object.create(ld.prototype),{constructor:pd,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,n=new Float32Array(2*e),r=0;r<e;r+=3)n[2*r]=t[r],n[2*r+1]=t[r+1],n[2*r+2]=t[r+2],n[2*r+3]=t[r+3],n[2*r+4]=t[r+4],n[2*r+5]=t[r+5];return ld.prototype.setPositions.call(this,n),this},setColors:function(t){for(var e=t.length-3,n=new Float32Array(2*e),r=0;r<e;r+=3)n[2*r]=t[r],n[2*r+1]=t[r+1],n[2*r+2]=t[r+2],n[2*r+3]=t[r+3],n[2*r+4]=t[r+4],n[2*r+5]=t[r+5];return ld.prototype.setColors.call(this,n),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},copy:function(t){return this}});var fd=function(t,e){dd.call(this),this.type="Line2",this.geometry=void 0!==t?t:new pd,this.material=void 0!==e?e:new hd({color:16777215*Math.random()})};fd.prototype=Object.assign(Object.create(dd.prototype),{constructor:fd,isLine2:!0,copy:function(t){return this}});var md=function(t,e){Kc.call(this),this.type="Wireframe",this.geometry=void 0!==t?t:new ld,this.material=void 0!==e?e:new hd({color:16777215*Math.random()})};md.prototype=Object.assign(Object.create(Kc.prototype),{constructor:md,isWireframe:!0,computeLineDistances:function(){var t=new ss,e=new ss;return function(){for(var n=this.geometry,r=n.attributes.instanceStart,i=n.attributes.instanceEnd,o=new Float32Array(2*r.data.count),a=0,s=0,c=r.data.count;a<c;a++,s+=2)t.fromBufferAttribute(r,a),e.fromBufferAttribute(i,a),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+t.distanceTo(e);var u=new sd(o,2,1);return n.addAttribute("instanceDistanceStart",new cd(u,1,0)),n.addAttribute("instanceDistanceEnd",new cd(u,1,1)),this}}(),copy:function(t){return this}});var vd=function(t){ld.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new ud(t))};function gd(){ys.call(this),this.type="Group"}vd.prototype=Object.assign(Object.create(ld.prototype),{constructor:vd,isWireframeGeometry2:!0,copy:function(t){return this}}),gd.prototype=Object.assign(Object.create(ys.prototype),{constructor:gd,isGroup:!0});var yd=function(t){this.manager=void 0!==t?t:Hu,this.availableExtensions=[]};yd.prototype={constructor:yd,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){var e=this;function n(t){var e={type:t.getAttribute("type")},n=t.getAttribute("id");n&&(e.id=n);var r=t.getAttribute("pid");r&&(e.pid=r);var i=t.getAttribute("pindex");i&&(e.pindex=i);var o=t.getAttribute("thumbnail");o&&(e.thumbnail=o);var a=t.getAttribute("partnumber");a&&(e.partnumber=a);var s=t.getAttribute("name");s&&(e.name=s);var c=t.querySelector("mesh");return c&&(e.mesh=function(t,e){for(var n={},r=[],i=t.querySelectorAll("vertices vertex"),o=0;o<i.length;o++){var a=i[o],s=a.getAttribute("x"),c=a.getAttribute("y"),u=a.getAttribute("z");r.push(parseFloat(s),parseFloat(c),parseFloat(u))}for(n.vertices=new Float32Array(r.length),o=0;o<r.length;o++)n.vertices[o]=r[o];var l=[],h=[],d=t.querySelectorAll("triangles triangle");for(o=0;o<d.length;o++){var p=d[o],f=p.getAttribute("v1"),m=p.getAttribute("v2"),v=p.getAttribute("v3"),g=p.getAttribute("p1"),y=p.getAttribute("p2"),b=p.getAttribute("p3"),x=p.getAttribute("pid");h.push(parseInt(f,10),parseInt(m,10),parseInt(v,10));var w={};g&&(w.p1=parseInt(g,10)),y&&(w.p2=parseInt(y,10)),b&&(w.p3=parseInt(b,10)),x&&(w.pid=x),0<Object.keys(w).length&&l.push(w)}for(n.triangleProperties=l,n.triangles=new Uint32Array(h.length),o=0;o<h.length;o++)n.triangles[o]=h[o];return n}(c)),t.querySelector("components")&&(e.components=void 0),e}function r(t){var e={unit:t.getAttribute("unit")||"millimeter"},r=t.querySelectorAll("metadata");r&&(e.metadata=function(t){for(var e={},n=0;n<t.length;n++){var r=t[n],i=r.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(e[i]=r.textContent)}return e}(r));var i=t.querySelector("resources");i&&(e.resources=function(t){var e={};t.querySelector("basematerials")&&(e.basematerial=void 0),e.object={};for(var r=t.querySelectorAll("object"),i=0;i<r.length;i++){var o=n(r[i]);e.object[o.id]=o}return e}(i));var o=t.querySelector("build");return o&&(e.build=function(t){for(var e=[],n=t.querySelectorAll("item"),r=0;r<n.length;r++){var i=n[r],o={objectid:i.getAttribute("objectid")},a=i.getAttribute("transform");if(a){var s=[];a.split(" ").forEach(function(t){s.push(parseFloat(t))});var c=new as;o.transform=c.set(s[0],s[3],s[6],s[9],s[1],s[4],s[7],s[10],s[2],s[5],s[8],s[11],0,0,0,1)}e.push(o)}return e}(o)),e}function i(t,e){var n=new Xs;n.setIndex(new Rs(t.triangles,1)),n.addAttribute("position",new Rs(t.vertices,3)),t.colors&&n.addAttribute("color",new Rs(t.colors,3)),n.computeBoundingSphere();var r={flatShading:!0};return t.colors&&0<t.colors.length?r.vertexColors=dc:r.color=11184895,new Kc(n,new Qu(r))}function o(t,n,r,i){if(t){for(var o=[],a=Object.keys(t),s=0;s<a.length;s++)for(var c=a[s],u=0;u<e.availableExtensions.length;u++)(l=e.availableExtensions[u]).ns===c&&o.push(l);for(s=0;s<o.length;s++){var l;(l=o[s]).apply(r,t[l.ns],n)}}}var a=function(t){var e,n,i=null,o=null,a=[],s=[],c={},u={};try{i=new JSZip(t)}catch(t){if(t instanceof ReferenceError)return console.error("ThreeMFLoader: jszip missing and file is compressed."),null}for(o in i.files)o.match(/\.rels$/)?e=o:o.match(/^3D\/.*\.model$/)?a.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)||(o.match(/^3D\/Textures\/.*/)?s.push(o):o.match(/^3D\/Other\/.*/));var l=new Uint8Array(i.file(e).asArrayBuffer());n=function(t){var e=(new DOMParser).parseFromString(t,"application/xml").querySelector("Relationship");return{target:e.getAttribute("Target"),id:e.getAttribute("Id"),type:e.getAttribute("Type")}}(ul.decodeText(l));for(var h=0;h<a.length;h++){var d=a[h],p=new Uint8Array(i.file(d).asArrayBuffer()),f=ul.decodeText(p),m=(new DOMParser).parseFromString(f,"application/xml");"model"!==m.documentElement.nodeName.toLowerCase()&&console.error("ThreeMFLoader: Error loading 3MF - no 3MF document found: ",d);var v=m.querySelector("model"),g={};for(h=0;h<v.attributes.length;h++){var y=v.attributes[h];y.name.match(/^xmlns:(.+)$/)&&(g[y.value]=RegExp.$1)}var b=r(v);b.xml=v,0<Object.keys(g).length&&(b.extensions=g),c[d]=b}for(h=0;h<s.length;h++){var x=s[h];u[x]=i.file(x).asBinary()}return{rels:n,model:c,printTicket:{},texture:u,other:{}}}(t);return function(t,e,n){for(var r=new gd,i=n.model[e.target.substring(1)].build,o=0;o<i.length;o++){var a=i[o],s=t[a.objectid];a.transform&&s.geometry.applyMatrix(a.transform),r.add(s)}return r}(function(t){for(var e=t.model,n={},r=Object.keys(e),a=0;a<r.length;a++)for(var s=e[r[a]],c=s.xml,u=s.extensions,l=Object.keys(s.resources.object),h=0;h<l.length;h++){var d=l[h],p=s.resources.object[d].mesh;o(u,p,c),n[d]=i(p)}return n}(a),a.rels,a)},addExtension:function(t){this.availableExtensions.push(t)}};var bd=function(t){this.manager=void 0!==t?t:Hu};bd.prototype={constructor:bd,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){function e(t){for(var e="AMF Material",r=t.attributes.id.textContent,i={r:1,g:1,b:1,a:1},o=null,a=0;a<t.childNodes.length;a++){var s=t.childNodes[a];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(e=s.textContent):"color"===s.nodeName&&(i=n(s))}return o=new Qu({flatShading:!0,color:new Ts(i.r,i.g,i.b),name:e}),1!==i.a&&(o.transparent=!0,o.opacity=i.a),{id:r,material:o}}function n(t){for(var e={r:1,g:1,b:1,a:1},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];"r"===r.nodeName?e.r=r.textContent:"g"===r.nodeName?e.g=r.textContent:"b"===r.nodeName?e.b=r.textContent:"a"===r.nodeName&&(e.a=r.textContent)}return e}function r(t){var e={name:"",triangles:[],materialid:null},n=t.firstElementChild;for(void 0!==t.attributes.materialid&&(e.materialId=t.attributes.materialid.nodeValue);n;){if("metadata"===n.nodeName)void 0!==n.attributes.type&&"name"===n.attributes.type.value&&(e.name=n.textContent);else if("triangle"===n.nodeName){var r=n.getElementsByTagName("v1")[0].textContent,i=n.getElementsByTagName("v2")[0].textContent,o=n.getElementsByTagName("v3")[0].textContent;e.triangles.push(r,i,o)}n=n.nextElementSibling}return e}function i(t){for(var e=[],n=[],r=t.firstElementChild;r;){if("vertex"===r.nodeName)for(var i=r.firstElementChild;i;){if("coordinates"===i.nodeName){var o=i.getElementsByTagName("x")[0].textContent,a=i.getElementsByTagName("y")[0].textContent,s=i.getElementsByTagName("z")[0].textContent;e.push(o,a,s)}else if("normal"===i.nodeName){var c=i.getElementsByTagName("nx")[0].textContent,u=i.getElementsByTagName("ny")[0].textContent,l=i.getElementsByTagName("nz")[0].textContent;n.push(c,u,l)}i=i.nextElementSibling}r=r.nextElementSibling}return{vertices:e,normals:n}}function o(t){for(var e=t.attributes.id.textContent,o={name:"amfobject",meshes:[]},a=null,s=t.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(o.name=s.textContent);else if("color"===s.nodeName)a=n(s);else if("mesh"===s.nodeName){for(var c=s.firstElementChild,u={vertices:[],normals:[],volumes:[],color:a};c;){if("vertices"===c.nodeName){var l=i(c);u.normals=u.normals.concat(l.normals),u.vertices=u.vertices.concat(l.vertices)}else"volume"===c.nodeName&&u.volumes.push(r(c));c=c.nextElementSibling}o.meshes.push(u)}s=s.nextElementSibling}return{id:e,obj:o}}var a,s,c=function(t){var e=new DataView(t);if("PK"===String.fromCharCode(e.getUint8(0),e.getUint8(1))){var n=null,r=null;console.log("AMFLoader: Loading Zip");try{n=new JSZip(t)}catch(t){if(t instanceof ReferenceError)return console.log("AMFLoader: jszip missing and file is compressed."),null}for(r in n.files)if(".amf"===r.toLowerCase().substr(-4))break;console.log("AMFLoader: Trying to load file asset: "+r),e=new DataView(n.file(r).asArrayBuffer())}var i=ul.decodeText(e),o=(new DOMParser).parseFromString(i,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("AMFLoader: Error loading AMF - no AMF document found."),null):o}(t),u="",l="",h=function(t){var e=1,n="millimeter";void 0!==c.documentElement.attributes.unit&&(n=c.documentElement.attributes.unit.value.toLowerCase());var r={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==r[n]&&(e=r[n]),console.log("AMFLoader: Unit scale: "+e),e}(),d={},p={},f=c.documentElement.childNodes;for(a=0;a<f.length;a++){var m=f[a];if("metadata"===m.nodeName)void 0!==m.attributes.type&&("name"===m.attributes.type.value?u=m.textContent:"author"===m.attributes.type.value&&(l=m.textContent));else if("material"===m.nodeName){var v=e(m);d[v.id]=v.material}else if("object"===m.nodeName){var g=o(m);p[g.id]=g.obj}}var y=new gd,b=new Qu({color:11184895,flatShading:!0});for(var x in y.name=u,y.userData.author=l,y.userData.loader="AMF",p){var w=p[x],_=w.meshes,S=new gd;for(S.name=w.name||"",a=0;a<_.length;a++){var T=b,M=_[a],A=new Vs(M.vertices,3),E=null;if(M.normals.length&&(E=new Vs(M.normals,3)),M.color){var C=M.color;(T=b.clone()).color=new Ts(C.r,C.g,C.b),1!==C.a&&(T.transparent=!0,T.opacity=C.a)}var P=M.volumes;for(s=0;s<P.length;s++){var O=P[s],N=new Xs,L=T;N.setIndex(O.triangles),N.addAttribute("position",A.clone()),E&&N.addAttribute("normal",E.clone()),void 0!==d[O.materialId]&&(L=d[O.materialId]),N.scale(h,h,h),S.add(new Kc(N,L.clone()))}}y.add(S)}return y}};var xd,wd,_d=function(t){this.manager=void 0!==t?t:Hu};function Sd(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new as)}}function Td(t,e){Kc.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new as,this.bindMatrixInverse=new as;var n=new Sd(this.initBones());this.bind(n,this.matrixWorld),this.normalizeSkinWeights()}_d.prototype={constructor:_d,crossOrigin:"Anonymous",load:function(t,e,n,r){var i=this,o=ul.extractUrlBase(t);new Xu(this.manager).load(t,function(t){var n=JSON.parse(t),a=n.__metadata__;if("undefined"!=typeof a){if("assimp2json"!==a.format)return void r("AssimpJSONLoader: Not an assimp2json scene.");if(a.version<100&&a.version>=200)return void r("AssimpJSONLoader: Unsupported assimp2json file format version.")}e(i.parse(n,o))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){function n(t,e){for(var n=new Array(t.length),r=0;r<t.length;++r)n[r]=e.call(this,t[r]);return n}var r=new sl(this.manager);r.setPath(e).setCrossOrigin(this.crossOrigin);var i=n(t.meshes,function(t){var e,n,r,i=new Xs,o=[],a=t.vertices||[],s=t.normals||[],c=t.texturecoords||[],u=t.colors||[];for(c=c[0]||[],e=0,n=t.faces.length;e<n;e++)o.push((r=t.faces[e])[0],r[1],r[2]);return i.setIndex(o),i.addAttribute("position",new Vs(a,3)),s.length>0&&i.addAttribute("normal",new Vs(s,3)),c.length>0&&i.addAttribute("uv",new Vs(c,2)),u.length>0&&i.addAttribute("color",new Vs(u,3)),i.computeBoundingSphere(),i}),o=n(t.materials,function(t){var e=new Qu;for(var n in t.properties){var i=t.properties[n],o=i.value;switch(i.key){case"$tex.file":var a=i.semantic;if(1===a||2===a||5===a||6===a){var s;switch(a){case 1:s="map";break;case 2:s="specularMap";break;case 5:s="bumpMap";break;case 6:s="normalMap"}var c=r.load(o);c.wrapS=c.wrapT=_c,e[s]=c}break;case"?mat.name":e.name=o;break;case"$clr.diffuse":e.color.fromArray(o);break;case"$clr.specular":e.specular.fromArray(o);break;case"$clr.emissive":e.emissive.fromArray(o);break;case"$mat.shininess":e.shininess=o;break;case"$mat.shadingm":e.flatShading=1===o;break;case"$mat.opacity":o<1&&(e.opacity=o,e.transparent=!0)}}return e});return function t(e,n,r,i){var o,a,s=new ys;for(s.name=n.name||"",s.matrix=(new as).fromArray(n.transformation).transpose(),s.matrix.decompose(s.position,s.quaternion,s.scale),o=0;n.meshes&&o<n.meshes.length;o++)s.add(new Kc(r[a=n.meshes[o]],i[e.meshes[a].materialindex]));for(o=0;n.children&&o<n.children.length;o++)s.add(t(e,n.children[o],r,i));return s}(t,t.rootnode,i,o)}},Object.assign(Sd.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new as;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n;for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(xd=new as,wd=new as,function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=t.length;i<o;i++)xd.multiplyMatrices(t[i]?t[i].matrixWorld:wd,e[i]),xd.toArray(n,16*i);void 0!==r&&(r.needsUpdate=!0)}),clone:function(){return new Sd(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}}}),Td.prototype=Object.assign(Object.create(Kc.prototype),{constructor:Td,isSkinnedMesh:!0,initBones:function(){var t,e,n,r,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(n=0,r=this.geometry.bones.length;n<r;n++)e=this.geometry.bones[n],t=new nu,i.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(n=0,r=this.geometry.bones.length;n<r;n++)-1!==(e=this.geometry.bones[n]).parent&&null!==e.parent&&void 0!==i[e.parent]?i[e.parent].add(i[n]):this.add(i[n])}return this.updateMatrixWorld(!0),i},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var n=this.geometry.skinWeights[e];(t=1/n.manhattanLength())!=1/0?n.multiplyScalar(t):n.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var r=new Is,i=this.geometry.attributes.skinWeight;for(e=0;e<i.count;e++)r.x=i.getX(e),r.y=i.getY(e),r.z=i.getZ(e),r.w=i.getW(e),(t=1/r.manhattanLength())!=1/0?r.multiplyScalar(t):r.set(1,0,0,0),i.setXYZW(e,r.x,r.y,r.z,r.w)}},updateMatrixWorld:function(t){Kc.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Md=function(t){this.manager=void 0!==t?t:Hu};function Ad(){this.id=0,this.data=null}function Ed(){}Md.prototype={constructor:Md,crossOrigin:"Anonymous",load:function(t,e,n,r){var i=this,o=ul.extractUrlBase(t),a=new Xu(this.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){e(i.parse(t,o))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var n=new sl(this.manager);n.setPath(e).setCrossOrigin(this.crossOrigin);var r={KeyFrame:function(t,e){this.time=t,this.matrix=e.clone(),this.position=new ss,this.quaternion=new cs,this.scale=new ss(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new r.KeyFrame(this.time,this.matrix)},this.lerp=function(t,e){var n=(e-=this.time)/(t.time-this.time),i=1-n,o=this.position,a=this.quaternion,s=t.position,c=t.quaternion;return r.KeyFrame.tempAniPos.x=o.x*i+s.x*n,r.KeyFrame.tempAniPos.y=o.y*i+s.y*n,r.KeyFrame.tempAniPos.z=o.z*i+s.z*n,r.KeyFrame.tempAniQuat.set(a.x,a.y,a.z,a.w),r.KeyFrame.tempAniQuat.slerp(c,n),r.KeyFrame.tempAniMatrix.compose(r.KeyFrame.tempAniPos,r.KeyFrame.tempAniQuat,r.KeyFrame.tempAniScale)}}};r.KeyFrame.tempAniPos=new ss,r.KeyFrame.tempAniQuat=new cs,r.KeyFrame.tempAniScale=new ss(1,1,1),r.KeyFrame.tempAniMatrix=new as,r.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(t){this.keys.push(t)},this.init=function(){if(this.sortKeys(),this.length=this.keys.length>0?this.keys[this.keys.length-1].time:0,this.fps)for(var t=0;t<this.length*this.fps;t++)for(var e=0;e<this.keys.length;e++){if(this.keys[e].time==t){this._accelTable[t]=e;break}if(this.keys[e].time<t/this.fps&&this.keys[e+1]&&this.keys[e+1].time>=t/this.fps){this._accelTable[t]=e;break}}},this.parseFromThree=function(t){var e=t.fps;this.target=t.node;for(var n=t.hierarchy[0].keys,i=0;i<n.length;i++)this.addKey(new r.KeyFrame(i/e||n[i].time,n[i].targets[0].data));this.init()},this.parseFromCollada=function(t){for(var e=t.keys,n=this.fps,i=0;i<e.length;i++)this.addKey(new r.KeyFrame(i/n||e[i].time,e[i].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(t,e){return t.time-e.time},this.clone=function(){var t=new r.KeyFrameTrack;t.target=this.target,t.time=this.time,t.length=this.length;for(var e=0;e<this.keys.length;e++)t.addKey(this.keys[e].clone());return t.init(),t},this.reTarget=function(t,e){e||(e=r.TrackTargetNodeNameCompare),this.target=e(t,this.target)},this.keySearchAccel=function(t){return t*=this.fps,t=Math.floor(t),this._accelTable[t]||0},this.setTime=function(t){t=Math.abs(t),this.length&&(t=t%this.length+.05);for(var e=null,n=null,r=this.keySearchAccel(t);r<this.keys.length;r++){if(this.keys[r].time==t){e=this.keys[r],n=this.keys[r];break}if(this.keys[r].time<t&&this.keys[r+1]&&this.keys[r+1].time>t){e=this.keys[r],n=this.keys[r+1];break}if(this.keys[r].time<t&&r==this.keys.length-1){e=this.keys[r],(n=this.keys[0].clone()).time+=this.length+.05;break}}return e&&n&&e!==n?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.lerp(n,t)),void(this.target.matrixWorldNeedsUpdate=!0)):e&&n&&e==n?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},r.TrackTargetNodeNameCompare=function(t,e){return function t(e,n){if(e.name==n)return e;for(var r=0;r<e.children.length;r++){var i=t(e.children[r],n);if(i)return i}return null}(t,e.name)},r.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(t){this.tracks.push(t),this.length=Math.max(t.length,this.length)},this.setTime=function(t){this.time=t;for(var e=0;e<this.tracks.length;e++)this.tracks[e].setTime(t)},this.clone=function(t,e){e||(e=r.TrackTargetNodeNameCompare);var n=new r.Animation;n.target=t;for(var i=0;i<this.tracks.length;i++){var o=this.tracks[i].clone();o.reTarget(t,e),n.addTrack(o)}return n}};var i=4660,o=4661,a=4662,s=4663,c=4664,u=4665,l=4666,h=4667,d=4668,p=4669,f=4670,m=1,v=2,g=4,y=256,b=65536,x=1,w=4,_=1,S=3,T=1,M=6,A=8,E=10,C=4;function P(t){return y<<t}function O(t){return b<<t}function N(t,e){var n=new nu;for(var r in n.matrix.copy(t.matrix),n.matrixWorld.copy(t.matrixWorld),n.position.copy(t.position),n.quaternion.copy(t.quaternion),n.scale.copy(t.scale),e.nodeCount++,n.name="bone_"+t.name+e.nodeCount.toString(),e.nodeToBoneMap[t.name]||(e.nodeToBoneMap[t.name]=[]),e.nodeToBoneMap[t.name].push(n),t.children){var i=N(t.children[r],e);i&&n.add(i)}return n}function L(t,e){for(var n=[],r=0;r<t.length;r++)n.push({i:t[r],w:e[r]});for(n.sort(function(t,e){return e.w-t.w});n.length<4;)n.push({i:0,w:0});n.length>4&&(n.length=4);var i=0;for(r=0;r<4;r++)i+=n[r].w*n[r].w;for(i=Math.sqrt(i),r=0;r<4;r++)n[r].w=n[r].w/i,t[r]=n[r].i,e[r]=n[r].w}function I(t,e){if(0==t.name.indexOf("bone_"+e))return t;for(var n in t.children){var r=I(t.children[n],e);if(r)return r}}function R(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(t,e){if(0!=this.mBones.length){for(var n=[],r=[],i=t.findNode(this.mBones[0].mName);i.mParent&&i.mParent.isBone;)i=i.mParent;var o=N(i.toTHREE(t),t);this.threeNode.add(o);for(var a=0;a<this.mBones.length;a++)if(s=I(o,this.mBones[a].mName))n.push(s),r.push(this.mBones[a].mOffsetMatrix.toTHREE());else{if(!(i=t.findNode(this.mBones[a].mName)))return;o=N(i.toTHREE(t),t),this.threeNode.add(o);var s=I(o,this.mBones[a].mName);n.push(s),r.push(this.mBones[a].mOffsetMatrix.toTHREE())}var c=new Sd(n,r);this.threeNode.bind(c,new as),this.threeNode.material.skinning=!0}},this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var e,n,r=new Xs;if(e=t.mMaterials[this.mMaterialIndex]?t.mMaterials[this.mMaterialIndex].toTHREE(t):new Zu,r.setIndex(new Rs(new Uint32Array(this.mIndexArray),1)),r.addAttribute("position",new Rs(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&r.addAttribute("normal",new Rs(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&r.addAttribute("color",new Rs(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&r.addAttribute("uv",new Rs(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&r.addAttribute("uv1",new Rs(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&r.addAttribute("tangents",new Rs(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&r.addAttribute("bitangents",new Rs(this.mBitangentBuffer,3)),this.mBones.length>0){for(var i=[],o=[],a=0;a<this.mBones.length;a++)for(var s=0;s<this.mBones[a].mWeights.length;s++){var c=this.mBones[a].mWeights[s];c&&(i[c.mVertexId]||(i[c.mVertexId]=[]),o[c.mVertexId]||(o[c.mVertexId]=[]),i[c.mVertexId].push(c.mWeight),o[c.mVertexId].push(parseInt(a)))}for(var a in o)L(o[a],i[a]);var u=[],l=[];for(a=0;a<i.length;a++)for(s=0;s<4;s++)i[a]&&o[a]?(u.push(i[a][s]),l.push(o[a][s])):(u.push(0),l.push(0));r.addAttribute("skinWeight",new Rs(new Float32Array(u),C)),r.addAttribute("skinIndex",new Rs(new Float32Array(l),C))}return 0==this.mBones.length&&(n=new Kc(r,e)),this.mBones.length>0&&(n=new Td(r,e)),this.threeNode=n,n}}function D(){this.mNumIndices=0,this.mIndices=[]}function F(){this.data=[],this.toString=function(){var t="";return this.data.forEach(function(e){t+=String.fromCharCode(e)}),t.replace(/[^\x20-\x7E]+/g,"")}}function U(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var e=new ys;e.name=this.mName,e.matrix=this.mTransformation.toTHREE();for(var n=0;n<this.mChildren.length;n++)e.add(this.mChildren[n].toTHREE(t));for(n=0;n<this.mMeshes.length;n++)e.add(t.mMeshes[this.mMeshes[n]].toTHREE(t));return this.threeNode=e,e.matrix.decompose(e.position,e.quaternion,e.scale),e}}function k(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function j(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var t=new Uint8Array(this.mData).buffer,e=new DataView(t);return new Ts(e.getFloat32(0,!0),e.getFloat32(4,!0),e.getFloat32(8,!0))},this.dataAsFloat=function(){var t=new Uint8Array(this.mData).buffer;return new DataView(t).getFloat32(0,!0)},this.dataAsBool=function(){var t=new Uint8Array(this.mData).buffer;return!!new DataView(t).getFloat32(0,!0)},this.dataAsString=function(){var t=new F;return t.data=this.mData,t.toString()},this.dataAsMap=function(){var t=new F;t.data=this.mData;var e=t.toString();return-1!=(e=e.replace(/\\/g,"/")).indexOf("/")&&(e=e.substr(e.lastIndexOf("/")+1)),n.load(e)}}var B={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},z={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function V(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(t){this.mProperties[0].dataAsString();for(var e=new Qu,n=0;n<this.mProperties.length;n++)if("float"==z[this.mProperties[n].mKey]&&(e[B[this.mProperties[n].mKey]]=this.mProperties[n].dataAsFloat()),"color"==z[this.mProperties[n].mKey]&&(e[B[this.mProperties[n].mKey]]=this.mProperties[n].dataAsColor()),"bool"==z[this.mProperties[n].mKey]&&(e[B[this.mProperties[n].mKey]]=this.mProperties[n].dataAsBool()),"string"==z[this.mProperties[n].mKey]&&(e[B[this.mProperties[n].mKey]]=this.mProperties[n].dataAsString()),"map"==z[this.mProperties[n].mKey]){var r=this.mProperties[n];r.mSemantic==T&&(e.map=this.mProperties[n].dataAsMap()),r.mSemantic==M&&(e.normalMap=this.mProperties[n].dataAsMap()),r.mSemantic==E&&(e.lightMap=this.mProperties[n].dataAsMap()),r.mSemantic==A&&(e.alphaMap=this.mProperties[n].dataAsMap())}return e.ambient.r=.53,e.ambient.g=.53,e.ambient.b=.53,e.color.r=1,e.color.g=1,e.color.b=1,e}}function G(t,e,n){var r=new ss,i=1-n;return r.x=t.x*n+e.x*i,r.y=t.y*n+e.y*i,r.z=t.z*n+e.z*i,r}function H(t,e,n){return t.clone().slerp(e,1-n)}function W(t,e,n,r){if(1==t.length)return t[0].mValue.toTHREE();for(var i=1/0,o=null,a=null,s=0;s<t.length;s++){var c=Math.abs(t[s].mTime-e);c<i&&t[s].mTime<=e&&(i=c,o=t[s],a=t[s+1])}if(o){if(a){var u=(o.mTime-e)/(a.mTime-o.mTime);return r(o.mValue.toTHREE(),a.mValue.toTHREE(),u)}return(a=t[0].clone()).mTime+=n,u=(o.mTime-e)/(a.mTime-o.mTime),r(o.mValue.toTHREE(),a.mValue.toTHREE(),u)}return null}function X(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(t){function e(e){e.mTime/=t}t||(t=1),this.mPositionKeys.forEach(e),this.mRotationKeys.forEach(e),this.mScalingKeys.forEach(e)},this.sortKeys=function(){function t(t,e){return t.mTime-e.mTime}this.mPositionKeys.sort(t),this.mRotationKeys.sort(t),this.mScalingKeys.sort(t)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(t){return t.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(t){return t.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(t){return t.mTime})))},this.toTHREE=function(t,e){this.sortKeys();for(var n=this.getLength(),i=new r.KeyFrameTrack,o=0;o<n;o+=.05){var a=new as,s=o,c=W(this.mPositionKeys,s,n,G),u=W(this.mScalingKeys,s,n,G),l=W(this.mRotationKeys,s,n,H);a.compose(c,l,u);var h=new r.KeyFrame(s,a);i.addKey(h)}i.target=t.findNode(this.mNodeName).toTHREE();var d=[i];if(t.nodeToBoneMap[this.mNodeName])for(o=0;o<t.nodeToBoneMap[this.mNodeName].length;o++){var p=i.clone();p.target=t.nodeToBoneMap[this.mNodeName][o],d.push(p)}return d}}function q(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(t){var e=new r.Animation;for(var n in this.mChannels){this.mChannels[n].init(this.mTicksPerSecond);var i=this.mChannels[n].toTHREE(t);for(var o in i)i[o].init(),e.addTrack(i[o])}return e.length=Math.max.apply(null,e.tracks.map(function(t){return t.length})),e}}function Y(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function Z(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function J(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}var Q=!0;function K(t){var e=t.getFloat32(t.readOffset,Q);return t.readOffset+=4,e}function $(t){var e=t.getFloat64(t.readOffset,Q);return t.readOffset+=8,e}function tt(t){var e=t.getUint16(t.readOffset,Q);return t.readOffset+=2,e}function et(t){var e=t.getUint32(t.readOffset,Q);return t.readOffset+=4,e}function nt(t){var e=t.getUint32(t.readOffset,Q);return t.readOffset+=4,e}function rt(t){var e=new function(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new ss(this.x,this.y,this.z)}};return e.x=K(t),e.y=K(t),e.z=K(t),e}function it(t){var e=new function(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new Ts(this.r,this.g,this.b,1)}};return e.r=K(t),e.g=K(t),e.b=K(t),e}function ot(t){var e=new F,n=et(t);return t.ReadBytes(e.data,1,n),e.toString()}function at(t){var e=new function(){this.mVertexId=0,this.mWeight=0};return e.mVertexId=et(t),e.mWeight=K(t),e}function st(t){for(var e=new function(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var t=new as,e=0;e<4;++e)for(var n=0;n<4;++n)t.elements[4*e+n]=this.elements[n][e];return t}},n=0;n<4;++n)for(var r=0;r<4;++r)e.elements[n][r]=K(t);return e}function ct(t){var e=new function(){this.mTime=0,this.mValue=null};return e.mTime=$(t),e.mValue=rt(t),e}function ut(t){var e=new function(){this.mTime=0,this.mValue=null};return e.mTime=$(t),e.mValue=function(t){var e=new function(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new cs(this.x,this.y,this.z,this.w)}};return e.w=K(t),e.x=K(t),e.y=K(t),e.z=K(t),e}(t),e}function lt(t,e,n){for(var r=0;r<n;r++)e[r]=ct(t)}function ht(t,e,n){return t.Seek(sizeof(e)*n,Mt)}function dt(t){if(!t)throw"asset failed"}function pt(t,e){return dt(nt(t)==l),nt(t),e.mName=ot(t),e.mNumWeights=et(t),e.mOffsetMatrix=st(t),St?ht(t,e.mWeights,e.mNumWeights):(e.mWeights=[],function(t,e,n){for(var r=0;r<n;r++)e[r]=at(t)}(t,e.mWeights,e.mNumWeights)),e}function ft(t,e){dt(nt(t)==s),nt(t),e.mPrimitiveTypes=et(t),e.mNumVertices=et(t),e.mNumFaces=et(t),e.mNumBones=et(t),e.mMaterialIndex=et(t),e.mNumUVComponents=[];var n=et(t);n&m&&(St?ht(t,e.mVertices,e.mNumVertices):(e.mVertices=[],e.mVertexBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,Mt))),n&v&&(St?ht(t,e.mNormals,e.mNumVertices):(e.mNormals=[],e.mNormalBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,Mt))),n&g&&(St?(ht(t,e.mTangents,e.mNumVertices),ht(t,e.mBitangents,e.mNumVertices)):(e.mTangents=[],e.mTangentBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,Mt),e.mBitangents=[],e.mBitangentBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,Mt)));for(var r=0;r<x&&n&O(r);++r)St?ht(t,e.mColors[r],e.mNumVertices):(e.mColors[r]=[],e.mColorBuffer=t.subArray32(t.readOffset,t.readOffset+4*e.mNumVertices*4),t.Seek(4*e.mNumVertices*4,Mt));for(e.mTexCoordsBuffers=[],r=0;r<w&&n&P(r);++r)if(e.mNumUVComponents[r]=et(t),St)ht(t,e.mTextureCoords[r],e.mNumVertices);else{e.mTextureCoords[r]=[],e.mTexCoordsBuffers[r]=[];for(var i=0;i<e.mNumVertices;i++)e.mTexCoordsBuffers[r].push(K(t)),e.mTexCoordsBuffers[r].push(K(t)),K(t)}if(St)et(t);else{e.mFaces=[],e.mIndexArray=[];for(var o=0;o<e.mNumFaces;++o){var a=e.mFaces[o]=new D;a.mNumIndices=tt(t),a.mIndices=[];for(var c=0;c<a.mNumIndices;++c)a.mIndices[c]=e.mNumVertices<65536?tt(t):et(t);if(3===a.mNumIndices)e.mIndexArray.push(a.mIndices[0]),e.mIndexArray.push(a.mIndices[1]),e.mIndexArray.push(a.mIndices[2]);else{if(4!==a.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");e.mIndexArray.push(a.mIndices[0]),e.mIndexArray.push(a.mIndices[1]),e.mIndexArray.push(a.mIndices[2]),e.mIndexArray.push(a.mIndices[2]),e.mIndexArray.push(a.mIndices[3]),e.mIndexArray.push(a.mIndices[0])}}}if(e.mNumBones)for(e.mBones=[],c=0;c<e.mNumBones;++c)e.mBones[c]=new k,pt(t,e.mBones[c])}function mt(t,e){dt(nt(t)==f),nt(t),e.mKey=ot(t),e.mSemantic=et(t),e.mIndex=et(t),e.mDataLength=et(t),e.mType=et(t),e.mData=[],t.ReadBytes(e.mData,1,e.mDataLength)}function vt(t,e){if(dt(nt(t)==p),nt(t),e.mNumAllocated=e.mNumProperties=et(t),e.mNumProperties){e.mProperties&&delete e.mProperties,e.mProperties=[];for(var n=0;n<e.mNumProperties;++n)e.mProperties[n]=new j,mt(t,e.mProperties[n])}}function gt(t,e){dt(nt(t)==c),nt(t),e.mNodeName=ot(t),e.mNumPositionKeys=et(t),e.mNumRotationKeys=et(t),e.mNumScalingKeys=et(t),e.mPreState=et(t),e.mPostState=et(t),e.mNumPositionKeys&&(St?ht(t,e.mPositionKeys,e.mNumPositionKeys):(e.mPositionKeys=[],lt(t,e.mPositionKeys,e.mNumPositionKeys))),e.mNumRotationKeys&&(St?ht(t,e.mRotationKeys,e.mNumRotationKeys):(e.mRotationKeys=[],function(t,e,n){for(var r=0;r<n;r++)e[r]=ut(t)}(t,e.mRotationKeys,e.mNumRotationKeys))),e.mNumScalingKeys&&(St?ht(t,e.mScalingKeys,e.mNumScalingKeys):(e.mScalingKeys=[],lt(t,e.mScalingKeys,e.mNumScalingKeys)))}function yt(t,e){if(dt(nt(t)==h),nt(t),e.mName=ot(t),e.mDuration=$(t),e.mTicksPerSecond=$(t),e.mNumChannels=et(t),e.mNumChannels){e.mChannels=[];for(var n=0;n<e.mNumChannels;++n)e.mChannels[n]=new X,gt(t,e.mChannels[n])}}function bt(t,e){dt(nt(t)==a),nt(t),e.mWidth=et(t),e.mHeight=et(t),t.ReadBytes(e.achFormatHint,1,4),St||(e.mHeight?(e.pcData=[],t.ReadBytes(e.pcData,1,e.mWidth*e.mHeight*4)):(e.pcData=[],t.ReadBytes(e.pcData,1,e.mWidth)))}function xt(t,e){dt(nt(t)==o),nt(t),e.mName=ot(t),e.mType=et(t),e.mType!=_&&(e.mAttenuationConstant=K(t),e.mAttenuationLinear=K(t),e.mAttenuationQuadratic=K(t)),e.mColorDiffuse=it(t),e.mColorSpecular=it(t),e.mColorAmbient=it(t),e.mType==S&&(e.mAngleInnerCone=K(t),e.mAngleOuterCone=K(t))}function wt(t,e){dt(nt(t)==i),nt(t),e.mName=ot(t),e.mPosition=rt(t),e.mLookAt=rt(t),e.mUp=rt(t),e.mHorizontalFOV=K(t),e.mClipPlaneNear=K(t),e.mClipPlaneFar=K(t),e.mAspect=K(t)}function _t(t,e){if(dt(nt(t)==u),nt(t),e.mFlags=et(t),e.mNumMeshes=et(t),e.mNumMaterials=et(t),e.mNumAnimations=et(t),e.mNumTextures=et(t),e.mNumLights=et(t),e.mNumCameras=et(t),e.mRootNode=new U,e.mRootNode=function t(e,n,r){dt(nt(e)==d),nt(e);var i=new U;if(i.mParent=n,i.mDepth=r,i.mName=ot(e),i.mTransformation=st(e),i.mNumChildren=et(e),i.mNumMeshes=et(e),i.mNumMeshes){i.mMeshes=[];for(var o=0;o<i.mNumMeshes;++o)i.mMeshes[o]=et(e)}if(i.mNumChildren)for(i.mChildren=[],o=0;o<i.mNumChildren;++o){var a=t(e,i,r++);i.mChildren[o]=a}return i}(t,null,0),e.mNumMeshes){e.mMeshes=[];for(var n=0;n<e.mNumMeshes;++n)e.mMeshes[n]=new R,ft(t,e.mMeshes[n])}if(e.mNumMaterials)for(e.mMaterials=[],n=0;n<e.mNumMaterials;++n)e.mMaterials[n]=new V,vt(t,e.mMaterials[n]);if(e.mNumAnimations)for(e.mAnimations=[],n=0;n<e.mNumAnimations;++n)e.mAnimations[n]=new q,yt(t,e.mAnimations[n]);if(e.mNumTextures)for(e.mTextures=[],n=0;n<e.mNumTextures;++n)e.mTextures[n]=new Y,bt(t,e.mTextures[n]);if(e.mNumLights)for(e.mLights=[],n=0;n<e.mNumLights;++n)e.mLights[n]=new Z,xt(t,e.mLights[n]);if(e.mNumCameras)for(e.mCameras=[],n=0;n<e.mNumCameras;++n)e.mCameras[n]=new J,wt(t,e.mCameras[n])}var St,Tt,Mt=0;return function(t){var e=new function(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(t,e){if(e||(e=this.mRootNode),e.mName==t)return e;for(var n=0;n<e.mChildren.length;n++){var r=this.findNode(t,e.mChildren[n]);if(r)return r}return null},this.toTHREE=function(){this.nodeCount=0,function(t){for(var e in t.mMeshes){var n=t.mMeshes[e];for(var r in n.mBones){var i=t.findNode(n.mBones[r].mName);i&&(i.isBone=!0)}}}(this);var t=this.mRootNode.toTHREE(this);for(var e in this.mMeshes)this.mMeshes[e].hookupSkeletons(this,t);if(this.mAnimations.length>0)var n=this.mAnimations[0].toTHREE(this);return{object:t,animation:n}}},n=new DataView(t);if(function(t){t.readOffset=0,t.Seek=function(e,n){n==Mt&&(t.readOffset+=e),1==n&&(t.readOffset=e)},t.ReadBytes=function(t,e,n){for(var r,i,o=e*n,a=0;a<o;a++)t[a]=(i=(r=this).getUint8(r.readOffset),r.readOffset+=1,i)},t.subArray32=function(t,e){var n=this.buffer.slice(t,e);return new Float32Array(n)},t.subArrayUint16=function(t,e){var n=this.buffer.slice(t,e);return new Uint16Array(n)},t.subArrayUint8=function(t,e){var n=this.buffer.slice(t,e);return new Uint8Array(n)},t.subArrayUint32=function(t,e){var n=this.buffer.slice(t,e);return new Uint32Array(n)}}(n),n.Seek(44,Mt),et(n),et(n),et(n),et(n),St=tt(n)>0,Tt=tt(n)>0,St)throw"Shortened binaries are not supported!";if(n.Seek(256,Mt),n.Seek(128,Mt),n.Seek(64,Mt),!Tt)return _t(n,e),e.toTHREE();var r=nt(n),i=n.FileSize()-n.Tell(),o=[];n.Read(o,1,i);var a=[];uncompress(a,r,o,i),_t(new ArrayBuffer(a),e)}(t)}},Ed.prototype={set:function(t,e){this[t]=e},get:function(t,e){return this.hasOwnProperty(t)?this[t]:e}};var Cd=function(t){this.manager=void 0!==t?t:Hu,this.trunk=new ys,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new Ad],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1};function Pd(t,e){ys.call(this),this.type="Light",this.color=new Ts(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Od(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Cs(512,512),this.map=null,this.matrix=new as}function Nd(t,e,n,r){Pd.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Od(new Mu(90,1,.5,500))}function Ld(){Od.call(this,new Cu(-5,5,5,-5,.5,500))}function Id(t,e){Pd.call(this,t,e),this.type="DirectionalLight",this.position.copy(ys.DefaultUp),this.updateMatrix(),this.target=new ys,this.shadow=new Ld}function Rd(){Od.call(this,new Mu(50,1,.5,500))}function Dd(t,e,n,r,i,o){Pd.call(this,t,e),this.type="SpotLight",this.position.copy(ys.DefaultUp),this.updateMatrix(),this.target=new ys,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Rd}function Fd(t,e,n){Pd.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ys.DefaultUp),this.updateMatrix(),this.groundColor=new Ts(e)}Cd.prototype={constructor:Cd,load:function(t,e,n,r){var i=this;this._url=t,this._baseDir=t.substr(0,t.lastIndexOf("/")+1);var o=new Xu(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){var e=t.byteLength;for(this._ptr=0,this._data=new DataView(t),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==t.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,e-this._ptr);this._ptr<e;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var t,e,n=this.readU32(),r=(this.readU8(),this.readU8()),i=(this.readU8(),this.readU32());switch(r){case 1:t=this.parseMeshData(i);break;case 22:t=this.parseContainer(i);break;case 23:t=this.parseMeshInstance(i);break;case 81:t=this.parseMaterial(i);break;case 82:t=this.parseTexture(i);break;case 101:t=this.parseSkeleton(i);break;case 112:t=this.parseMeshPoseAnimation(i,!1);break;case 113:t=this.parseVertexAnimationSet(i);break;case 102:t=this.parseSkeletonPose(i);break;case 103:t=this.parseSkeletonAnimation(i);break;case 122:t=this.parseAnimatorSet(i);break;default:this._ptr+=i}this._blocks[n]=e=new Ad,e.data=t,e.id=n},_parseHeader:function(){var t=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");t[0]=this.readU8(),t[1]=this.readU8();var e=this.readU16();this._streaming=1==(1&e),2===t[0]&&1===t[1]&&(this._accuracyMatrix=2==(2&e),this._accuracyGeo=4==(4&e),this._accuracyProps=8==(8&e)),this._geoNrType=this._accuracyGeo?8:7,this._matrixNrType=this._accuracyMatrix?8:7,this._propsNrType=this._accuracyProps?8:7,this._optimized_for_accuracy=2==(2&e),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(t){var e=new ys,n=this.readU32(),r=this.parseMatrix4();return e.name=this.readUTF(),e.applyMatrix(r),(this._blocks[n].data||this.trunk).add(e),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:4}),e.extra=this.parseUserAttributes(),e},parseMeshInstance:function(t){var e,n,r,i,o,a,s,c,u,l,h,d,p;for(a=this.readU32(),c=this.parseMatrix4(),e=this.readUTF(),s=this.readU32(),d=this.readU16(),r=this.getBlock(s),u=[],p=0;p<d;p++)h=this.readU32(),l=this.getBlock(h),u.push(l);if(o=[],(i=r.length)>1)for(n=new ys,p=0;p<i;p++){var f=new Kc(r[p]);o.push(f),n.add(f)}else n=new Kc(r[0]),o.push(n);n.applyMatrix(c),n.name=e,(this.getBlock(a)||this.trunk).add(n);var m=u.length,v=Math.max(i,m);for(p=0;p<v;p++)o[p%i].material=u[p%m];return this.parseProperties(null),n.extra=this.parseUserAttributes(),n},parseMaterial:function(t){var e,n,r,i,o,a;for(e=this.readUTF(),n=this.readU8(),a=this.readU8(),r=this.parseProperties({1:3,2:23,11:21,12:7,13:21});0<a;)this.readU16(),this.parseProperties(null),this.parseUserAttributes();if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(i=this.materialFactory(e)))return i;if(i=new Qu,1===n)i.color.setHex(r.get(1,13421772));else if(2===n){var s=r.get(2,0);i.map=this.getBlock(s)}return i.extra=o,i.alphaThreshold=r.get(12,0),i.repeat=r.get(13,!1),i},parseTexture:function(t){var e,n;if(this.readUTF(),0===this.readU8()){n=this.readU32();var r=this.readUTFBytes(n);console.log(r),e=this.loadTexture(r)}return this.parseProperties(null),this.parseUserAttributes(),e},loadTexture:function(t){var e=new Ou;return new al(this.manager).load(this._baseDir+t,function(t){e.image=t,e.needsUpdate=!0}),e},parseSkeleton:function(t){this.readUTF();var e=this.readU16(),n=[],r=0;for(this.parseProperties(null);r<e;){var i,o;this.readU16(),(i=new nu).parent=this.readU16()-1,i.name=this.readUTF(),o=this.parseMatrix4(),i.skinMatrix=o,this.parseProperties(null),this.parseUserAttributes(),n.push(i),r++}return this.parseUserAttributes(),n},parseSkeletonPose:function(t){this.readUTF();var e=this.readU16();this.parseProperties(null);for(var n=[],r=0;r<e;){var i;i=1===this.readU8()?this.parseMatrix4():new as,n[r]=i,r++}return this.parseUserAttributes(),n},parseSkeletonAnimation:function(t){this.readUTF();var e,n,r=[],i=this.readU16();this.parseProperties(null);for(var o=0;o<i;)n=this.readU32(),e=this.readU16(),r.push({pose:this._blocks[n].data,duration:e}),o++;if(0!==r.length)return this.parseUserAttributes(),r},parseVertexAnimationSet:function(t){this.readUTF();for(var e,n=this.readU16(),r=(this.parseProperties({1:5}),0),i=[];r<n;)e=this.readU32(),i.push(this._blocks[e].data),r++;return this.parseUserAttributes(),i},parseAnimatorSet:function(t){this.readUTF();var e,n=this.readU16(),r=this.parseProperties({1:23});e=this.readU32();for(var i=this.readU16(),o=[],a=0;a<i;a++)o.push(this.readU32());this.readU16(),Boolean(this.readU8()),this.parseUserAttributes(),this.parseUserAttributes();var s,c=[];for(a=0;a<o.length;a++)c.push(this._blocks[o[a]].data);for(1==n&&(s={animationSet:this._blocks[e].data,skeleton:this._blocks[r.get(1,0)].data}),a=0;a<c.length;a++)c[a].animator=s;return s},parseMeshData:function(t){var e,n,r=this.readUTF(),i=this.readU16(),o=0,a=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});o<i;){var s,c,u;for((e=new Xs).name=r,a.push(e),s=this.readU32(),c=this._ptr+s,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<c;){var l=0,h=this.readU8(),d=(this.readU8(),this.readU32()),p=d+this._ptr;if(1===h)for(u=new Rs(n=new Float32Array(d/12*3),3),e.addAttribute("position",u),l=0;this._ptr<p;)n[l]=-this.readF32(),n[l+1]=this.readF32(),n[l+2]=this.readF32(),l+=3;else if(2===h)for(u=new Rs(n=new Uint16Array(d/2),1),e.setIndex(u),l=0;this._ptr<p;)n[l+1]=this.readU16(),n[l]=this.readU16(),n[l+2]=this.readU16(),l+=3;else if(3===h)for(u=new Rs(n=new Float32Array(d/8*2),2),e.addAttribute("uv",u),l=0;this._ptr<p;)n[l]=this.readF32(),n[l+1]=1-this.readF32(),l+=2;else if(4===h)for(u=new Rs(n=new Float32Array(d/12*3),3),e.addAttribute("normal",u),l=0;this._ptr<p;)n[l]=-this.readF32(),n[l+1]=this.readF32(),n[l+2]=this.readF32(),l+=3;else this._ptr=p}this.parseUserAttributes(),e.computeBoundingSphere(),o++}return this.parseUserAttributes(),a},parseMeshPoseAnimation:function(t,e){var n,r,i,o,a,s,c,u,l,h=1,d=0,p={},f=[],m=(this.readUTF(),this.readU32()),v=this.getBlock(m);if(null!==v){for((s=v.geometry).morphTargets=[],e||(h=this.readU16()),n=this.readU16(),c=this.readU16(),u=0;u<c;)f.push(this.readU16()),u++;for(l=this.parseProperties({1:21,2:21}),p.looping=l.get(1,!0),p.stitchFinalFrame=l.get(2,!1),r=0;r<h;){for(this.readU16(),i=0;i<n;)for(u=0,o=this.readU32(),a=this._ptr+o;u<c;){if(1===f[u]){var g=new Float32Array(o/4);for(s.morphTargets.push({array:g}),d=0;this._ptr<a;)g[d]=this.readF32(),g[d+1]=this.readF32(),g[d+2]=this.readF32(),d+=3;i++}else this._ptr=a;u++}r++}return this.parseUserAttributes(),null}console.log("parseMeshPoseAnimation target mesh not found at:",m)},getBlock:function(t){return this._blocks[t].data},parseMatrix4:function(){var t=new as,e=t.elements;return e[0]=this.readF32(),e[1]=this.readF32(),e[2]=this.readF32(),e[3]=0,e[4]=this.readF32(),e[5]=this.readF32(),e[6]=this.readF32(),e[7]=0,e[8]=this.readF32(),e[9]=this.readF32(),e[10]=this.readF32(),e[11]=0,e[12]=-this.readF32(),e[13]=this.readF32(),e[14]=this.readF32(),e[15]=1,t},parseProperties:function(t){var e=this.readU32(),n=this._ptr+e,r=new Ed;if(t)for(;this._ptr<n;){var i=this.readU16(),o=this.readU32();t.hasOwnProperty(i)?r.set(i,this.parseAttrValue(t[i],o)):this._ptr+=o}return r},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(t,e){var n,r;switch(t){case 1:n=1,r=this.readI8;break;case 2:n=2,r=this.readI16;break;case 3:n=4,r=this.readI32;break;case 21:case 4:n=1,r=this.readU8;break;case 5:n=2,r=this.readU16;break;case 6:case 23:n=4,r=this.readU32;break;case 7:n=4,r=this.readF32;break;case 8:n=8,r=this.readF64;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:n=8,r=this.readF64}if(n<e){var i,o,a;for(i=[],o=0,a=e/n;o<a;)i.push(r.call(this)),o++;return i}return r.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var t=this._data.getUint16(this._ptr,!0);return this._ptr+=2,t},readI16:function(){var t=this._data.getInt16(this._ptr,!0);return this._ptr+=2,t},readU32:function(){var t=this._data.getUint32(this._ptr,!0);return this._ptr+=4,t},readI32:function(){var t=this._data.getInt32(this._ptr,!0);return this._ptr+=4,t},readF32:function(){var t=this._data.getFloat32(this._ptr,!0);return this._ptr+=4,t},readF64:function(){var t=this._data.getFloat64(this._ptr,!0);return this._ptr+=8,t},readUTF:function(){var t=this.readU16();return this.readUTFBytes(t)},readUTFBytes:function(t){for(var e=[],n=0;e.length<t;){var r=this._data.getUint8(this._ptr++,!0);if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){var i=this._data.getUint8(this._ptr++,!0);e[n++]=String.fromCharCode((31&r)<<6|63&i)}else{i=this._data.getUint8(this._ptr++,!0);var o=this._data.getUint8(this._ptr++,!0);e[n++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return e.join("")}},Pd.prototype=Object.assign(Object.create(ys.prototype),{constructor:Pd,isLight:!0,copy:function(t){return ys.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ys.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Object.assign(Od.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Nd.prototype=Object.assign(Object.create(Pd.prototype),{constructor:Nd,isPointLight:!0,copy:function(t){return Pd.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Ld.prototype=Object.assign(Object.create(Od.prototype),{constructor:Ld}),Id.prototype=Object.assign(Object.create(Pd.prototype),{constructor:Id,isDirectionalLight:!0,copy:function(t){return Pd.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Rd.prototype=Object.assign(Object.create(Od.prototype),{constructor:Rd,isSpotLightShadow:!0,update:function(t){var e=this.camera,n=2*os.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix())}}),Dd.prototype=Object.assign(Object.create(Pd.prototype),{constructor:Dd,isSpotLight:!0,copy:function(t){return Pd.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Fd.prototype=Object.assign(Object.create(Pd.prototype),{constructor:Fd,isHemisphereLight:!0,copy:function(t){return Pd.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}});var Ud=function(t){this.manager=void 0!==t?t:Hu};Ud.prototype={constructor:Ud,load:function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},parse:function(t){function e(t){var e=new Xs,n=t.positions,r=t.normals,i=t.uvs;e.setIndex(t.indices);for(var o=2,a=n.length;o<a;o+=3)n[o]=-n[o];if(e.addAttribute("position",new Vs(n,3)),r){for(o=2,a=r.length;o<a;o+=3)r[o]=-r[o];e.addAttribute("normal",new Vs(r,3))}i&&e.addAttribute("uv",new Vs(i,2));var s=t.subMeshes;if(s)for(o=0,a=s.length;o<a;o++){var c=s[o];e.addGroup(c.indexStart,c.indexCount)}return e}return function(t,n){for(var r={},i=new Eu,o=t.cameras,a=0,s=o.length;a<s;a++){var c=new Mu((d=o[a]).fov/Math.PI*180,1.33,d.minZ,d.maxZ);c.name=d.name,c.position.fromArray(d.position),d.rotation&&c.rotation.fromArray(d.rotation),r[d.id]=c}var u=t.lights;for(a=0,s=u.length;a<s;a++){var l;switch((d=u[a]).type){case 0:l=new Nd;break;case 1:l=new Id;break;case 2:l=new Dd;break;case 3:l=new Fd}l.name=d.name,d.position&&l.position.set(d.position[0],d.position[1],-d.position[2]),l.color.fromArray(d.diffuse),d.groundColor&&l.groundColor.fromArray(d.groundColor),d.intensity&&(l.intensity=d.intensity),r[d.id]=l,i.add(l)}var h=t.meshes;for(a=0,s=h.length;a<s;a++){var d,p;(p=(d=h[a]).indices?new Kc(e(d),n[d.materialId]):new gd).name=d.name,p.position.set(d.position[0],d.position[1],-d.position[2]),p.rotation.fromArray(d.rotation),d.rotationQuaternion&&p.quaternion.fromArray(d.rotationQuaternion),p.scale.fromArray(d.scaling),d.parentId?r[d.parentId].add(p):i.add(p),r[d.id]=p}return i}(t,function(t){for(var e={},n=0,r=t.materials.length;n<r;n++){var i=t.materials[n],o=new Qu;o.name=i.name,o.color.fromArray(i.diffuse),o.emissive.fromArray(i.emissive),o.specular.fromArray(i.specular),o.shininess=i.specularPower,o.opacity=i.alpha,e[i.id]=o}if(t.multiMaterials)for(n=0,r=t.multiMaterials.length;n<r;n++)i=t.multiMaterials[n],console.warn("BabylonLoader: Multi materials not yet supported."),e[i.id]=new Qu;return e}(t))}};var kd=function(t){this.manager=void 0!==t?t:Hu,this.animateBonePositions=!0,this.animateBoneRotations=!0};function jd(t,e){Pd.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Bd(t,e){$c.call(this,t,e),this.type="LineSegments"}kd.prototype={constructor:kd,load:function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){function e(t,n,r){if("ENDSITE"!==r.type){var i={time:n,position:new ss,rotation:new cs};r.frames.push(i);for(var o=new cs,a=new ss(1,0,0),s=new ss(0,1,0),c=new ss(0,0,1),u=0;u<r.channels.length;u++)switch(r.channels[u]){case"Xposition":i.position.x=parseFloat(t.shift().trim());break;case"Yposition":i.position.y=parseFloat(t.shift().trim());break;case"Zposition":i.position.z=parseFloat(t.shift().trim());break;case"Xrotation":o.setFromAxisAngle(a,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(s,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(c,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;default:console.warn("BVHLoader: Invalid channel type.")}for(u=0;u<r.children.length;u++)e(t,n,r.children[u])}}function n(t){for(var e;0===(e=t.shift().trim()).length;);return e}var r=this,i=function(t){"HIERARCHY"!==n(t)&&console.error("BVHLoader: HIERARCHY expected.");var r=[],i=function t(e,r,i){var o={name:"",type:"",frames:[]};i.push(o);var a=r.split(/[\s]+/);"END"===a[0].toUpperCase()&&"SITE"===a[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=a[1],o.type=a[0].toUpperCase()),"{"!==n(e)&&console.error("BVHLoader: Expected opening { after type & name"),"OFFSET"!==(a=n(e).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected OFFSET but got: "+a[0]),4!==a.length&&console.error("BVHLoader: Invalid number of values for OFFSET.");var s=new ss(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));if((isNaN(s.x)||isNaN(s.y)||isNaN(s.z))&&console.error("BVHLoader: Invalid values of OFFSET."),o.offset=s,"ENDSITE"!==o.type){"CHANNELS"!==(a=n(e).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected CHANNELS definition.");var c=parseInt(a[1]);o.channels=a.splice(2,c),o.children=[]}for(;;){var u=n(e);if("}"===u)return o;o.children.push(t(e,u,i))}}(t,n(t),r);"MOTION"!==n(t)&&console.error("BVHLoader: MOTION expected.");var o=n(t).split(/[\s]+/),a=parseInt(o[1]);isNaN(a)&&console.error("BVHLoader: Failed to read number of frames."),o=n(t).split(/[\s]+/);var s=parseFloat(o[2]);isNaN(s)&&console.error("BVHLoader: Failed to read frame time.");for(var c=0;c<a;c++)e(o=n(t).split(/[\s]+/),c*s,i);return r}(t.split(/[\r\n]+/g)),o=[];!function t(e,n){var r=new nu;if(n.push(r),r.position.add(e.offset),r.name=e.name,"ENDSITE"!==e.type)for(var i=0;i<e.children.length;i++)r.add(t(e.children[i],n));return r}(i[0],o);var a=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];if("ENDSITE"!==i.type){for(var o=[],a=[],s=[],c=0;c<i.frames.length;c++){var u=i.frames[c];o.push(u.time),a.push(u.position.x+i.offset.x),a.push(u.position.y+i.offset.y),a.push(u.position.z+i.offset.z),s.push(u.rotation.x),s.push(u.rotation.y),s.push(u.rotation.z),s.push(u.rotation.w)}r.animateBonePositions&&e.push(new mu(".bones["+i.name+"].position",o,a)),r.animateBoneRotations&&e.push(new pu(".bones["+i.name+"].quaternion",o,s))}}return new _u("animation",-1,e)}(i);return{skeleton:new Sd(o),clip:a}}},jd.prototype=Object.assign(Object.create(Pd.prototype),{constructor:jd,isAmbientLight:!0}),Bd.prototype=Object.assign(Object.create($c.prototype),{constructor:Bd,isLineSegments:!0,computeLineDistances:function(){var t=new ss,e=new ss;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var r=n.attributes.position,i=[],o=0,a=r.count;o<a;o+=2)t.fromBufferAttribute(r,o),e.fromBufferAttribute(r,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e);n.addAttribute("lineDistance",new Vs(i,1))}else console.warn("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var s=n.vertices;for(i=n.lineDistances,o=0,a=s.length;o<a;o+=2)t.copy(s[o]),e.copy(s[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e)}return this}}()});var zd=function(t){this.manager=void 0!==t?t:Hu};function Vd(t,e,n,r,i,o,a,s,c,u,l,h){Ou.call(this,null,o,a,s,c,u,r,i,l,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Gd(t){this.manager=void 0!==t?t:Hu,this._parser=null}zd.prototype={constructor:zd,crossOrigin:"Anonymous",load:function(t,e,n,r){var i=this,o=void 0===i.path?ul.extractUrlBase(t):i.path;new Xu(i.manager).load(t,function(t){e(i.parse(t,o))},n,r)},setPath:function(t){this.path=t},options:{set convertUpAxis(t){console.warn("ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){function n(t,e){for(var n=[],r=t.childNodes,i=0,o=r.length;i<o;i++){var a=r[i];a.nodeName===e&&n.push(a)}return n}function r(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=e[r];return n}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseFloat(e[r]);return n}function o(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseInt(e[r]);return n}function a(t){return t.substring(1)}function s(t){return 0===Object.keys(t).length}function c(t,e,r,i){var o=n(t,e)[0];if(void 0!==o)for(var a=n(o,r),s=0;s<a.length;s++)i(a[s])}function u(t,e){for(var n in t)t[n].build=e(t[n])}function l(t,e){return void 0!==t.build?t.build:(t.build=e(t),t.build)}function h(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=a(i.getAttribute("source")),s=i.getAttribute("semantic");e.inputs[s]=o}}return e}function d(t){var e={},n=t.getAttribute("target").split("/"),r=n.shift(),i=n.shift(),o=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)i=(n=i.split(".")).shift(),e.member=n.shift();else if(o){var c=i.split("(");i=c.shift();for(var u=0;u<c.length;u++)c[u]=parseInt(c[u].replace(/\)/,""));e.indices=c}return e.id=r,e.sid=i,e.arraySyntax=o,e.memberSyntax=s,e.sampler=a(t.getAttribute("source")),e}function p(t){var e=[],n=t.channels,r=t.samplers,i=t.sources;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o],s=r[a.sampler];b(m(a,i[s.inputs.INPUT],i[s.inputs.OUTPUT]),e)}return e}function f(t){return l(Bt.animations[t],p)}function m(t,e,n){var r,i,o,a,s,c,u=Bt.nodes[t.id],l=Ct(u.id),h=u.transforms[t.sid],d=u.matrix.clone().transpose(),p={};switch(h){case"matrix":for(o=0,a=e.array.length;o<a;o++)if(i=o*n.stride,void 0===p[r=e.array[o]]&&(p[r]={}),!0===t.arraySyntax)p[r][t.indices[0]+4*t.indices[1]]=n.array[i];else for(s=0,c=n.stride;s<c;s++)p[r][s]=n.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var f=function(t,e){var n=[];for(var r in t)n.push({time:parseFloat(r),value:t[r]});n.sort(function(t,e){return t.time-e.time});for(var i=0;i<16;i++)x(n,i,e.elements[i]);return n}(p,d);return{name:l.uuid,keyframes:f}}var v=new ss,g=new ss,y=new cs;function b(t,e){for(var n=t.keyframes,r=t.name,i=[],o=[],a=[],s=[],c=0,u=n.length;c<u;c++){var l=n[c],h=l.time;bt.fromArray(l.value).transpose(),bt.decompose(v,y,g),i.push(h),o.push(v.x,v.y,v.z),a.push(y.x,y.y,y.z,y.w),s.push(g.x,g.y,g.z)}return o.length>0&&e.push(new mu(r+".position",i,o)),a.length>0&&e.push(new pu(r+".quaternion",i,a)),s.length>0&&e.push(new mu(r+".scale",i,s)),e}function x(t,e,n){var r,i,o,a=!0;for(i=0,o=t.length;i<o;i++)void 0===(r=t[i]).value[e]?r.value[e]=null:a=!1;if(!0===a)for(i=0,o=t.length;i<o;i++)(r=t[i]).value[e]=n;else!function(t,e){for(var n,r,i=0,o=t.length;i<o;i++){var a=t[i];if(null===a.value[e]){if(n=w(t,i,e),r=_(t,i,e),null===n){a.value[e]=r.value[e];continue}if(null===r){a.value[e]=n.value[e];continue}S(a,n,r,e)}}}(t,e)}function w(t,e,n){for(;e>=0;){var r=t[e];if(null!==r.value[n])return r;e--}return null}function _(t,e,n){for(;e<t.length;){var r=t[e];if(null!==r.value[n])return r;e++}return null}function S(t,e,n,r){t.value[r]=n.time-e.time!=0?(t.time-e.time)*(n.value[r]-e.value[r])/(n.time-e.time)+e.value[r]:e.value[r]}function T(t){for(var e=[],n=t.name,r=t.end-t.start||-1,i=t.animations,o=0,a=i.length;o<a;o++)for(var s=f(i[o]),c=0,u=s.length;c<u;c++)e.push(s[c]);return new _u(n,r,e)}function M(t){return l(Bt.clips[t],T)}function A(t){for(var e={sources:{}},n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=i(o.textContent);break;case"source":var a=o.getAttribute("id");e.sources[a]=nt(o);break;case"joints":e.joints=E(o);break;case"vertex_weights":e.vertexWeights=C(o)}}return e}function E(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),s=a(i.getAttribute("source"));e.inputs[o]=s}}return e}function C(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),c=a(i.getAttribute("source")),u=parseInt(i.getAttribute("offset"));e.inputs[s]={id:c,offset:u};break;case"vcount":e.vcount=o(i.textContent);break;case"v":e.v=o(i.textContent)}}return e}function P(t){var e={id:t.id},n=Bt.geometries[e.id];return void 0!==t.skin&&(e.skin=function(t){var e,n,r,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=t.vertexWeights,a=o.vcount,s=o.v,c=o.inputs.JOINT.offset,u=o.inputs.WEIGHT.offset,l=t.sources[t.joints.inputs.JOINT],h=t.sources[t.joints.inputs.INV_BIND_MATRIX],d=t.sources[o.inputs.WEIGHT.id].array,p=0;for(e=0,r=a.length;e<r;e++){var f=a[e],m=[];for(n=0;n<f;n++)m.push({index:s[p+c],weight:d[s[p+u]]}),p+=2;for(m.sort(b),n=0;n<4;n++){var v=m[n];void 0!==v?(i.indices.array.push(v.index),i.weights.array.push(v.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(i.bindMatrix=(new as).fromArray(t.bindShapeMatrix).transpose(),e=0,r=l.array.length;e<r;e++){var g=l.array[e],y=(new as).fromArray(h.array,e*h.stride).transpose();i.joints.push({name:g,boneInverse:y})}return i;function b(t,e){return e.weight-t.weight}}(t.skin),n.sources.skinIndices=e.skin.indices,n.sources.skinWeights=e.skin.weights),e}function O(t){return void 0!==t.build?t.build:t.init_from}function N(t){return l(Bt.images[t],O)}function L(t){for(var e={surfaces:{},samplers:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":I(i,e);break;case"technique":e.technique=F(i);break;case"extra":e.extra=V(i)}}return e}function I(t,e){for(var n=t.getAttribute("sid"),r=0,i=t.childNodes.length;r<i;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":e.surfaces[n]=R(o);break;case"sampler2D":e.samplers[n]=D(o)}}}function R(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"init_from":e.init_from=i.textContent}}return e}function D(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"source":e.source=i.textContent}}return e}function F(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=i.nodeName,e.parameters=U(i)}}return e}function U(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":e[i.nodeName]=k(i);break;case"transparent":e[i.nodeName]={opaque:i.getAttribute("opaque"),data:k(i)}}}return e}function k(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":e[o.nodeName]=i(o.textContent);break;case"float":e[o.nodeName]=parseFloat(o.textContent);break;case"texture":e[o.nodeName]={id:o.getAttribute("texture"),extra:j(o)}}}return e}function j(t){for(var e={technique:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"extra":B(i,e)}}return e}function B(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":z(i,e)}}}function z(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":e.technique[i.nodeName]="TRUE"===i.textContent.toUpperCase()?1:"FALSE"===i.textContent.toUpperCase()?0:parseInt(i.textContent)}}}function V(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":e.technique=G(i)}}return e}function G(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":e[i.nodeName]=parseInt(i.textContent)}}return e}function H(t){return t}function W(t){var e,n=l(Bt.effects[t.url],H),r=n.profile.technique,i=n.profile.extra;switch(r.type){case"phong":case"blinn":e=new Qu;break;case"lambert":e=new Zu;break;default:e=new Xc}function o(t){var e,r=n.profile.samplers[t.id];if(void 0!==r?e=N(n.profile.surfaces[r.source].init_from):(console.warn("ColladaLoader: Undefined sampler. Access image directly (see #12530)."),e=N(t.id)),void 0!==e){var i=Ft.load(e),o=t.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var a=o.technique;i.wrapS=a.wrapU?_c:Sc,i.wrapT=a.wrapV?_c:Sc,i.offset.set(a.offsetU||0,a.offsetV||0),i.repeat.set(a.repeatU||1,a.repeatV||1)}else i.wrapS=_c,i.wrapT=_c;return i}return console.error("ColladaLoader: Unable to load texture with ID:",t.id),null}e.name=t.name;var a=r.parameters;for(var c in a){var u=a[c];switch(c){case"diffuse":u.color&&e.color.fromArray(u.color),u.texture&&(e.map=o(u.texture));break;case"specular":u.color&&e.specular&&e.specular.fromArray(u.color),u.texture&&(e.specularMap=o(u.texture));break;case"shininess":u.float&&e.shininess&&(e.shininess=u.float);break;case"emission":u.color&&e.emissive&&e.emissive.fromArray(u.color)}}var h=a.transparent,d=a.transparency;if(void 0===d&&h&&(d={float:1}),void 0===h&&d&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&d)if(h.data.texture)e.alphaMap=o(h.data.texture),e.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":e.opacity=p[3]*d.float;break;case"RGB_ZERO":e.opacity=1-p[0]*d.float;break;case"A_ZERO":e.opacity=1-p[3]*d.float;break;case"RGB_ONE":e.opacity=p[0]*d.float;break;default:console.warn('ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}e.opacity<1&&(e.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(e.side=uc),e}function X(t){return l(Bt.materials[t],W)}function q(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"technique_common":return Y(n)}}return{}}function Y(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":e.technique=r.nodeName,e.parameters=Z(r)}}return e}function Z(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[r.nodeName]=parseFloat(r.textContent)}}return e}function J(t){var e;switch(t.optics.technique){case"perspective":e=new Mu(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var n=t.optics.parameters.ymag,r=t.optics.parameters.xmag,i=t.optics.parameters.aspect_ratio;r=void 0===r?n*i:r,n=void 0===n?r/i:n,e=new Cu(-(r*=.5),r,n*=.5,-n,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new Mu}return e.name=t.name,e}function Q(t){var e=Bt.cameras[t];return void 0!==e?l(e,J):(console.warn("ColladaLoader: Couldn't find camera with ID:",t),null)}function K(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=i.nodeName,e.parameters=$(i)}}return e}function $(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":var a=i(o.textContent);e.color=(new Ts).fromArray(a);break;case"falloff_angle":e.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);e.distance=s?Math.sqrt(1/s):0}}return e}function tt(t){var e;switch(t.technique){case"directional":e=new Id;break;case"point":e=new Nd;break;case"spot":e=new Dd;break;case"ambient":e=new jd}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function et(t){var e=Bt.lights[t];return void 0!==e?l(e,tt):(console.warn("ColladaLoader: Couldn't find light with ID:",t),null)}function nt(t){for(var e={array:[],stride:3},o=0;o<t.childNodes.length;o++){var a=t.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"float_array":e.array=i(a.textContent);break;case"Name_array":e.array=r(a.textContent);break;case"technique_common":var s=n(a,"accessor")[0];void 0!==s&&(e.stride=parseInt(s.getAttribute("stride")))}}return e}function rt(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];1===r.nodeType&&(e[r.getAttribute("semantic")]=a(r.getAttribute("source")))}return e}function it(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var s=a(i.getAttribute("source")),c=i.getAttribute("semantic"),u=parseInt(i.getAttribute("offset"));e.inputs[c]={id:s,offset:u},e.stride=Math.max(e.stride,u+1),"TEXCOORD"===c&&(e.hasUV=!0);break;case"vcount":e.vcount=o(i.textContent);break;case"p":e.p=o(i.textContent)}}return e}function ot(t){for(var e=0,n=0,r=t.length;n<r;n++)!0===t[n].hasUV&&e++;e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function at(t){var e={},n=t.sources,r=t.vertices,i=t.primitives;if(0===i.length)return{};var o=function(t){for(var e={},n=0;n<t.length;n++){var r=t[n];void 0===e[r.type]&&(e[r.type]=[]),e[r.type].push(r)}return e}(i);for(var a in o){var s=o[a];ot(s),e[a]=st(s,n,r)}return e}function st(t,e,n){for(var r={},i={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},c=[],u=[],l=new Xs,h=[],d=0,p=0,f=0;f<t.length;f++){var m=t[f],v=m.inputs,g=1;for(var y in m.vcount&&4===m.vcount[0]&&(g=2),l.addGroup(d,p="lines"===m.type||"linestrips"===m.type?2*m.count:3*m.count*g,f),d+=p,m.material&&h.push(m.material),v){var b=v[y];switch(y){case"VERTEX":for(var x in n){var w=n[x];switch(x){case"POSITION":var _=i.array.length;if(ct(m,e[w],b.offset,i.array),i.stride=e[w].stride,e.skinWeights&&e.skinIndices&&(ct(m,e.skinIndices,b.offset,c),ct(m,e.skinWeights,b.offset,u)),!1===m.hasUV&&!0===t.uvsNeedsFix){p=(i.array.length-_)/i.stride;for(var S=0;S<p;S++)a.array.push(0,0)}break;case"NORMAL":ct(m,e[w],b.offset,o.array),o.stride=e[w].stride;break;case"COLOR":ct(m,e[w],b.offset,s.array),s.stride=e[w].stride;break;case"TEXCOORD":ct(m,e[w],b.offset,a.array),a.stride=e[w].stride;break;default:console.warn('ColladaLoader: Semantic "%s" not handled in geometry build process.',x)}}break;case"NORMAL":ct(m,e[b.id],b.offset,o.array),o.stride=e[b.id].stride;break;case"COLOR":ct(m,e[b.id],b.offset,s.array),s.stride=e[b.id].stride;break;case"TEXCOORD":ct(m,e[b.id],b.offset,a.array),a.stride=e[b.id].stride}}}return i.array.length>0&&l.addAttribute("position",new Vs(i.array,i.stride)),o.array.length>0&&l.addAttribute("normal",new Vs(o.array,o.stride)),s.array.length>0&&l.addAttribute("color",new Vs(s.array,s.stride)),a.array.length>0&&l.addAttribute("uv",new Vs(a.array,a.stride)),c.length>0&&l.addAttribute("skinIndex",new Vs(c,4)),u.length>0&&l.addAttribute("skinWeight",new Vs(u,4)),r.data=l,r.type=t[0].type,r.materialKeys=h,r}function ct(t,e,n,r){var i=t.p,o=t.stride,a=t.vcount;function s(t){for(var e=i[t+n]*l,o=e+l;e<o;e++)r.push(u[e])}var c=0,u=e.array,l=e.stride;if(void 0!==t.vcount){for(var h=0,d=0,p=a.length;d<p;d++){var f=a[d];if(4===f){var m=h+1*o,v=h+2*o,g=h+3*o;s(h+0*o),s(m),s(g),s(m),s(v),s(g)}else 3===f?(m=h+1*o,v=h+2*o,s(h+0*o),s(m),s(v)):c=Math.max(c,f);h+=o*f}c>0&&console.log("ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(d=0,p=i.length;d<p;d+=o)s(d)}function ut(t){return l(Bt.geometries[t],at)}function lt(t){return void 0!==t.build?t.build:t}function ht(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":e.joints[r.getAttribute("sid")]=dt(r);break;case"link":e.links.push(ft(r))}}}function dt(t){for(var e,n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":e=pt(r)}}return e}function pt(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new ss,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var o=i(r.textContent);e.axis.fromArray(o);break;case"limits":var a=r.getElementsByTagName("max")[0],s=r.getElementsByTagName("min")[0];e.limits.max=parseFloat(a.textContent),e.limits.min=parseFloat(s.textContent)}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function ft(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":e.attachments.push(mt(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(vt(r))}}return e}function mt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":e.links.push(ft(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(vt(r))}}return e}function vt(t){var e={type:t.nodeName},n=i(t.textContent);switch(e.type){case"matrix":e.obj=new as,e.obj.fromArray(n).transpose();break;case"translate":e.obj=new ss,e.obj.fromArray(n);break;case"rotate":e.obj=new ss,e.obj.fromArray(n),e.angle=os.degToRad(n[3])}return e}function gt(t){for(var e={target:t.getAttribute("target").split("/").pop()},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var i=r.getElementsByTagName("param")[0];e.axis=i.textContent;var o=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=o.substr(0,o.length-1)}}return e}function yt(t){return void 0!==t.build?t.build:t}var bt=new as,xt=new ss;function wt(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new as,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"node":e.nodes.push(r.getAttribute("id")),wt(r);break;case"instance_camera":e.instanceCameras.push(a(r.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(_t(r));break;case"instance_light":e.instanceLights.push(a(r.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(_t(r));break;case"instance_node":e.instanceNodes.push(a(r.getAttribute("url")));break;case"matrix":var o=i(r.textContent);e.matrix.multiply(bt.fromArray(o).transpose()),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":o=i(r.textContent),xt.fromArray(o),e.matrix.multiply(bt.makeTranslation(xt.x,xt.y,xt.z)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":o=i(r.textContent);var s=os.degToRad(o[3]);e.matrix.multiply(bt.makeRotationAxis(xt.fromArray(o),s)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":o=i(r.textContent),e.matrix.scale(xt.fromArray(o)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return Bt.nodes[e.id]=e,e}function _t(t){for(var e={id:a(t.getAttribute("url")),materials:{},skeletons:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"bind_material":for(var i=r.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var s=i[o],c=s.getAttribute("symbol"),u=s.getAttribute("target");e.materials[c]=a(u)}break;case"skeleton":e.skeletons.push(a(r.textContent))}}return e}function St(t,e){var n,r,i=[],o=[];for(n=0;n<t.length;n++){var a=t[n];if(void 0!==Bt.nodes[a])Tt(Ct(a),e,i);else if(Ot(a))for(var s=Bt.visualScenes[a].children,c=0;c<s.length;c++){var u=s[c];"JOINT"===u.type&&Tt(Ct(u.id),e,i)}else console.error("ColladaLoader: Unable to find root bone of skeleton with ID:",a)}for(n=0;n<e.length;n++)for(c=0;c<i.length;c++)if((r=i[c]).bone.name===e[n].name){o[n]=r,r.processed=!0;break}for(n=0;n<i.length;n++)!1===(r=i[n]).processed&&(o.push(r),r.processed=!0);var l=[],h=[];for(n=0;n<o.length;n++)l.push((r=o[n]).bone),h.push(r.boneInverse);return new Sd(l,h)}function Tt(t,e,n){t.traverse(function(t){if(!0===t.isBone){for(var r,i=0;i<e.length;i++){var o=e[i];if(o.name===t.name){r=o.boneInverse;break}}void 0===r&&(r=new as),n.push({bone:t,boneInverse:r,processed:!1})}})}function Mt(t){for(var e=[],n=t.matrix,r=t.nodes,i=t.type,o=t.instanceCameras,a=t.instanceControllers,s=t.instanceLights,c=t.instanceGeometries,u=t.instanceNodes,h=0,d=r.length;h<d;h++)e.push(Ct(r[h]));for(h=0,d=o.length;h<d;h++){var p=Q(o[h]);null!==p&&e.push(p.clone())}for(h=0,d=a.length;h<d;h++)for(var f=l(Bt.controllers[(w=a[h]).id],P),m=Et(ut(f.id),w.materials),v=St(w.skeletons,f.skin.joints),g=0,y=m.length;g<y;g++){var b;(b=m[g]).isSkinnedMesh&&(b.bind(v,f.skin.bindMatrix),b.normalizeSkinWeights()),e.push(b)}for(h=0,d=s.length;h<d;h++){var x=et(s[h]);null!==x&&e.push(x.clone())}for(h=0,d=c.length;h<d;h++){var w;for(g=0,y=(m=Et(ut((w=c[h]).id),w.materials)).length;g<y;g++)e.push(m[g])}for(h=0,d=u.length;h<d;h++)e.push(Ct(u[h]).clone());if(0===r.length&&1===e.length)b=e[0];else for(b="JOINT"===i?new nu:new gd,h=0;h<e.length;h++)b.add(e[h]);return""===b.name&&(b.name="JOINT"===i?t.sid:t.name),b.matrix.copy(n),b.matrix.decompose(b.position,b.quaternion,b.scale),b}function At(t,e){for(var n=[],r=0,i=t.length;r<i;r++)n.push(X(e[t[r]]));return n}function Et(t,e){var n=[];for(var r in t){var i=t[r],o=At(i.materialKeys,e);0===o.length&&o.push("lines"===r||"linestrips"===r?new qc:new Qu);var a=void 0!==i.data.attributes.skinIndex;if(a)for(var s=0,c=o.length;s<c;s++)o[s].skinning=!0;var u,l=1===o.length?o[0]:o;switch(r){case"lines":u=new Bd(i.data,l);break;case"linestrips":u=new $c(i.data,l);break;case"triangles":case"polylist":u=a?new Td(i.data,l):new Kc(i.data,l)}n.push(u)}return n}function Ct(t){return l(Bt.nodes[t],Mt)}function Pt(t){var e=new gd;e.name=t.name;for(var n=t.children,r=0;r<n.length;r++)e.add(Ct(n[r].id));return e}function Ot(t){return void 0!==Bt.visualScenes[t]}function Nt(t){return l(Bt.visualScenes[t],Pt)}if(console.time("ColladaLoader"),0===t.length)return{scene:new Eu};console.time("ColladaLoader: DOMParser");var Lt=(new DOMParser).parseFromString(t,"application/xml");console.timeEnd("ColladaLoader: DOMParser");var It=n(Lt,"COLLADA")[0],Rt=It.getAttribute("version");console.log("ColladaLoader: File version",Rt);var Dt=function(t){return{unit:function(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}(n(t,"unit")[0]),upAxis:function(t){return void 0!==t?t.textContent:"Y_UP"}(n(t,"up_axis")[0])}}(n(It,"asset")[0]),Ft=new sl(this.manager);Ft.setPath(e).setCrossOrigin(this.crossOrigin);var Ut=[],kt={},jt=0,Bt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("ColladaLoader: Parse"),c(It,"library_animations","animation",function(t){for(var e={sources:{},samplers:{},channels:{}},n=0,r=t.childNodes.length;n<r;n++){var i,o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"source":i=o.getAttribute("id"),e.sources[i]=nt(o);break;case"sampler":i=o.getAttribute("id"),e.samplers[i]=h(o);break;case"channel":i=o.getAttribute("target"),e.channels[i]=d(o);break;default:console.log(o)}}Bt.animations[t.getAttribute("id")]=e}),c(It,"library_animation_clips","animation_clip",function(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":e.animations.push(a(i.getAttribute("url")))}}Bt.clips[t.getAttribute("id")]=e}),c(It,"library_controllers","controller",function(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":e.id=a(i.getAttribute("source")),e.skin=A(i);break;case"morph":e.id=a(i.getAttribute("source")),console.warn("ColladaLoader: Morph target animation not supported yet.")}}Bt.controllers[t.getAttribute("id")]=e}),c(It,"library_images","image",function(t){var e={init_from:n(t,"init_from")[0].textContent};Bt.images[t.getAttribute("id")]=e}),c(It,"library_effects","effect",function(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":e.profile=L(i)}}Bt.effects[t.getAttribute("id")]=e}),c(It,"library_materials","material",function(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":e.url=a(i.getAttribute("url"))}}Bt.materials[t.getAttribute("id")]=e}),c(It,"library_cameras","camera",function(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"optics":e.optics=q(i)}}Bt.cameras[t.getAttribute("id")]=e}),c(It,"library_lights","light",function(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique_common":e=K(i)}}Bt.lights[t.getAttribute("id")]=e}),c(It,"library_geometries","geometry",function(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(t,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":e.sources[a]=nt(o);break;case"vertices":e.vertices=rt(o);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(it(o));break;default:console.log(o)}}}Bt.geometries[t.getAttribute("id")]=e}}),c(It,"library_nodes","node",wt),c(It,"library_visual_scenes","visual_scene",function(t){var e={name:t.getAttribute("name"),children:[]};!function(t){for(var e=t.getElementsByTagName("node"),n=0;n<e.length;n++){var r=e[n];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+jt++)}}(t);for(var r=n(t,"node"),i=0;i<r.length;i++)e.children.push(wt(r[i]));Bt.visualScenes[t.getAttribute("id")]=e}),c(It,"library_kinematics_models","kinematics_model",function(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":ht(r,e)}}Bt.kinematicsModels[t.getAttribute("id")]=e}),c(It,"scene","instance_kinematics_scene",function(t){for(var e={bindJointAxis:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":e.bindJointAxis.push(gt(r))}}Bt.kinematicsScenes[a(t.getAttribute("url"))]=e}),console.timeEnd("ColladaLoader: Parse"),console.time("ColladaLoader: Build"),u(Bt.animations,p),u(Bt.clips,T),u(Bt.controllers,P),u(Bt.images,O),u(Bt.effects,H),u(Bt.materials,W),u(Bt.cameras,J),u(Bt.lights,tt),u(Bt.geometries,at),u(Bt.visualScenes,Pt),console.timeEnd("ColladaLoader: Build"),function(){var t=Bt.clips;if(!0===s(t)){if(!1===s(Bt.animations)){var e=[];for(var n in Bt.animations)for(var r=f(n),i=0,o=r.length;i<o;i++)e.push(r[i]);Ut.push(new _u("default",-1,e))}}else for(var n in t)Ut.push(M(n))}(),function(){var t=Object.keys(Bt.kinematicsModels)[0],e=Object.keys(Bt.kinematicsScenes)[0],n=Object.keys(Bt.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var r=l(Bt.kinematicsModels[t],lt),o=l(Bt.kinematicsScenes[e],yt),a=Nt(n),s=o.bindJointAxis,c={},u=0,h=s.length;u<h;u++){var d=s[u],p=It.querySelector('[sid="'+d.target+'"]');p&&m(d.jointIndex,p.parentElement)}var f=new as;kt={joints:r&&r.joints,getJointValue:function(t){var e=c[t];if(e)return e.position;console.warn("ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var n=c[t];if(n){var r=n.joint;if(e>r.limits.max||e<r.limits.min)console.warn("ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("ColladaLoader: Joint "+t+" is static.");else{var i=n.object,o=r.axis,a=n.transforms;bt.identity();for(var s=0;s<a.length;s++){var u=a[s];if(u.sid&&-1!==u.sid.indexOf(t))switch(r.type){case"revolute":bt.multiply(f.makeRotationAxis(o,os.degToRad(e)));break;case"prismatic":bt.multiply(f.makeTranslation(o.x*e,o.y*e,o.z*e));break;default:console.warn("ColladaLoader: Unknown joint type: "+r.type)}else switch(u.type){case"matrix":bt.multiply(u.obj);break;case"translate":bt.multiply(f.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":bt.scale(u.obj);break;case"rotate":bt.multiply(f.makeRotationAxis(u.obj,u.angle))}}i.matrix.copy(bt),i.matrix.decompose(i.position,i.quaternion,i.scale),c[t].position=e}}else console.log("ColladaLoader: "+t+" does not exist.")}}}function m(t,e){var n=e.getAttribute("name"),o=r.joints[t];a.traverse(function(r){r.name===n&&(c[t]={object:r,transforms:function(t){for(var n=[],r=It.querySelector('[id="'+e.id+'"]'),o=0;o<r.childNodes.length;o++){var a=r.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"matrix":var s=i(a.textContent),c=(new as).fromArray(s).transpose();n.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:c});break;case"translate":case"scale":s=i(a.textContent);var u=(new ss).fromArray(s);n.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:u});break;case"rotate":s=i(a.textContent),u=(new ss).fromArray(s);var l=os.degToRad(s[3]);n.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:u,angle:l})}}return n}(),joint:o,position:o.zeroPosition})})}}();var zt=Nt(a(n(n(It,"scene")[0],"instance_visual_scene")[0].getAttribute("url")));return"Z_UP"===Dt.upAxis&&zt.quaternion.setFromEuler(new ls(-Math.PI/2,0,0)),zt.scale.multiplyScalar(Dt.unit),console.timeEnd("ColladaLoader"),{animations:Ut,kinematics:kt,library:Bt,scene:zt}}},(Vd.prototype=Object.create(Ou.prototype)).constructor=Vd,Vd.prototype.isCompressedTexture=!0,Object.assign(Gd.prototype,{load:function(t,e,n,r){var i=this,o=[],a=new Vd;a.image=o;var s=new Xu(this.manager);function c(c){s.load(t[c],function(t){var n=i._parser(t,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(u+=1)&&(1===n.mipmapCount&&(a.minFilter=Ac),a.format=n.format,a.needsUpdate=!0,e&&e(a))},n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var u=0,l=0,h=t.length;l<h;++l)c(l);else s.load(t,function(t){var n=i._parser(t,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var c=0;c<n.mipmapCount;c++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+c]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=Ac),a.format=n.format,a.needsUpdate=!0,e&&e(a)},n,r);return a},setPath:function(t){return this.path=t,this}});var Hd=function(){this._parser=Hd.parse};function Wd(t,e){$c.call(this,t,e),this.type="LineLoop"}Hd.prototype=Object.create(Gd.prototype),Hd.prototype.constructor=Hd,Hd.parse=function(t,e){var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function i(t,e,n,r){for(var i=n*r*4,o=new Uint8Array(t,e,i),a=new Uint8Array(i),s=0,c=0,u=0;u<r;u++)for(var l=0;l<n;l++){var h=o[c],d=o[++c],p=o[++c],f=o[++c];c++,a[s]=p,a[++s]=d,a[++s]=h,a[++s]=f,s++}return a}var o,a=r("DXT1"),s=r("DXT3"),c=r("DXT5"),u=r("ETC1"),l=new Int32Array(t,0,31);if(542327876!==l[0])return console.error("DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!l[20])return console.error("DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var h,d=l[21],p=!1;switch(d){case a:o=8,n.format=33776;break;case s:o=16,n.format=33778;break;case c:o=16,n.format=33779;break;case u:o=8,n.format=36196;break;default:if(!(32===l[22]&&16711680&l[23]&&65280&l[24]&&255&l[25]&&4278190080&l[26]))return console.error("DDSLoader.parse: Unsupported FourCC code ",(h=d,String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255))),n;p=!0,o=64,n.format=Lc}n.mipmapCount=1,131072&l[2]&&!1!==e&&(n.mipmapCount=Math.max(1,l[7]));var f=l[28];if(n.isCubemap=!!(512&f),n.isCubemap&&(!(1024&f)||!(2048&f)||!(4096&f)||!(8192&f)||!(16384&f)||!(32768&f)))return console.error("DDSLoader.parse: Incomplete cubemap faces"),n;n.width=l[4],n.height=l[3];for(var m=l[1]+4,v=n.isCubemap?6:1,g=0;g<v;g++)for(var y=n.width,b=n.height,x=0;x<n.mipmapCount;x++){if(p)var w=(_=i(t,m,y,b)).length;else{w=Math.max(4,y)/4*Math.max(4,b)/4*o;var _=new Uint8Array(t,m,w)}n.mipmaps.push({data:_,width:y,height:b}),m+=w,y=Math.max(y>>1,1),b=Math.max(b>>1,1)}return n},Wd.prototype=Object.assign(Object.create($c.prototype),{constructor:Wd,isLineLoop:!0}),function(){function t(t){this.manager=void 0!==t?t:Hu}function e(t,e){var n={},r=t.material.uniforms;for(var i in r){var o=r[i];if(o.semantic){var a=o.node,s=t;a&&(s=e[a]),n[i]={semantic:o.semantic,sourceNode:s,targetNode:t,uniform:o}}}this.boundUniforms=n,this._m4=new as}t.prototype={constructor:t,crossOrigin:"Anonymous",load:function(t,e,n,r){var i=this,o=this.path&&"string"==typeof this.path?this.path:ul.extractUrlBase(t),a=new Xu(i.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){i.parse(t,o,e)},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},setPath:function(t){this.path=t},parse:function(t,e,i){var a,s={};ul.decodeText(new Uint8Array(t,0,4))===r.magic?(s[n.KHR_BINARY_GLTF]=new o(t),a=s[n.KHR_BINARY_GLTF].content):a=ul.decodeText(new Uint8Array(t));var c=JSON.parse(a);c.extensionsUsed&&c.extensionsUsed.indexOf(n.KHR_MATERIALS_COMMON)>=0&&(s[n.KHR_MATERIALS_COMMON]=new function(t){this.name=n.KHR_MATERIALS_COMMON,this.lights={};var e=(t.extensions&&t.extensions[n.KHR_MATERIALS_COMMON]||{}).lights||{};for(var r in e){var i,o=e[r],a=o[o.type],s=(new Ts).fromArray(a.color);switch(o.type){case"directional":(i=new Id(s)).position.set(0,0,1);break;case"point":i=new Nd(s);break;case"spot":(i=new Dd(s)).position.set(0,0,1);break;case"ambient":i=new jd(s)}i&&(this.lights[r]=i)}}(c)),console.time("LegacyGLTFLoader"),new T(c,s,{path:e||this.path,crossOrigin:this.crossOrigin}).parse(function(t,e,n,r){console.timeEnd("LegacyGLTFLoader"),i({scene:t,scenes:e,cameras:n,animations:r})})}},t.Shaders={update:function(){console.warn("LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},e.prototype.update=function(t,e){var n=this.boundUniforms;for(var r in n){var i=n[r];switch(i.semantic){case"MODELVIEW":i.uniform.value.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var o=i.uniform.value;this._m4.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld),o.getNormalMatrix(this._m4);break;case"PROJECTION":i.uniform.value.copy(e.projectionMatrix);break;case"JOINTMATRIX":for(var a=i.uniform.value,s=0;s<a.length;s++)a[s].getInverse(i.sourceNode.matrixWorld).multiply(i.targetNode.skeleton.bones[s].matrixWorld).multiply(i.targetNode.skeleton.boneInverses[s]).multiply(i.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+i.semantic)}}},t.Animations={update:function(){console.warn("LegacyGLTFLoader.Animation has been deprecated. Use AnimationMixer instead.")}};var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"},r={magic:"glTF",version:1,contentFormat:0},i=20;function o(t){this.name=n.KHR_BINARY_GLTF;var e=new DataView(t,0,i),o={magic:ul.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0),contentLength:e.getUint32(12,!0),contentFormat:e.getUint32(16,!0)};for(var a in r){var s=r[a];if(o[a]!==s)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',a,s)}var c=new Uint8Array(t,i,o.contentLength);this.header=o,this.content=ul.decodeText(c),this.body=t.slice(i+o.contentLength,o.length)}o.prototype.loadShader=function(t,e){var r=new Uint8Array(e[t.extensions[n.KHR_BINARY_GLTF].bufferView]);return ul.decodeText(r)};var a={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},s={5126:Number,35675:ds,35676:as,35664:Cs,35665:ss,35666:Is,35678:Ou},c={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},u={9728:Mc,9729:Ac,9984:1004,9985:1007,9986:1005,9987:Ec},l={33071:Sc,33648:Tc,10497:_c},h={6406:1021,6407:Nc,6408:Lc,6409:1024,6410:1025},d={5121:Cc,32819:1017,32820:1018,33635:1019},p={1028:cc,1029:sc},f={512:0,513:2,514:4,515:gc,516:5,517:7,518:5,519:1},m={32774:fc,32778:101,32779:102},v={0:200,1:201,768:202,769:203,770:mc,771:vc,772:206,773:207,774:208,775:209,776:210},g={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={scale:"scale",translation:"position",rotation:"quaternion"},b={LINEAR:2301,STEP:Uc},x={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function w(t,e,n){var r;if(!t)return Promise.resolve();var i=[];if("[object Array]"===Object.prototype.toString.call(t)){r=[];for(var o=t.length,a=0;a<o;a++)(c=e.call(n||this,t[a],a))&&(i.push(c),c instanceof Promise?c.then((function(t,e){r[t]=e}).bind(this,a)):r[a]=c)}else for(var s in r={},t){var c;t.hasOwnProperty(s)&&(c=e.call(n||this,t[s],s))&&(i.push(c),c instanceof Promise?c.then((function(t,e){r[t]=e}).bind(this,s)):r[s]=c)}return Promise.all(i).then(function(){return r})}function _(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:(e||"")+t}function S(t){this.isDeferredShaderMaterial=!0,this.params=t}function T(t,e,n){this.json=t||{},this.extensions=e||{},this.options=n||{},this.cache=new function(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}},update:function(e,n){for(var r in t){var i=t[r];i.update&&i.update(e,n)}}}}}S.prototype.create=function(){var t=Lu.clone(this.params.uniforms);for(var e in this.params.uniforms){var n=this.params.uniforms[e];n.value instanceof Ou&&(t[e].value=n.value,t[e].value.needsUpdate=!0),t[e].semantic=n.semantic,t[e].node=n.node}return this.params.uniforms=t,new nl(this.params)},T.prototype._withDependencies=function(t){for(var e={},n=0;n<t.length;n++){var r=t[n],i="load"+r.charAt(0).toUpperCase()+r.slice(1),o=this.cache.get(r);if(void 0!==o)e[r]=o;else if(this[i]){var a=this[i]();this.cache.add(r,a),e[r]=a}}return w(e,function(t){return t})},T.prototype.parse=function(t){var e=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(n){var r=[];for(var i in n.scenes)r.push(n.scenes[i]);var o=void 0!==e.scene?n.scenes[e.scene]:r[0],a=[];for(var i in n.cameras)a.push(n.cameras[i]);var s=[];for(var i in n.animations)s.push(n.animations[i]);t(o,r,a,s)})},T.prototype.loadShaders=function(){var t=this.json,e=this.extensions,r=this.options;return this._withDependencies(["bufferViews"]).then(function(i){return w(t.shaders,function(t){return t.extensions&&t.extensions[n.KHR_BINARY_GLTF]?e[n.KHR_BINARY_GLTF].loadShader(t,i.bufferViews):new Promise(function(e){var n=new Xu;n.setResponseType("text"),n.load(_(t.uri,r.path),function(t){e(t)})})})})},T.prototype.loadBuffers=function(){var t=this.extensions,e=this.options;return w(this.json.buffers,function(r,i){return"binary_glTF"===i?t[n.KHR_BINARY_GLTF].body:"arraybuffer"===r.type||void 0===r.type?new Promise(function(t){var n=new Xu;n.setResponseType("arraybuffer"),n.load(_(r.uri,e.path),function(e){t(e)})}):void console.warn("LegacyGLTFLoader: "+r.type+" buffer type is not supported")})},T.prototype.loadBufferViews=function(){var t=this.json;return this._withDependencies(["buffers"]).then(function(e){return w(t.bufferViews,function(t){return e.buffers[t.buffer].slice(t.byteOffset,t.byteOffset+(void 0!==t.byteLength?t.byteLength:0))})})},T.prototype.loadAccessors=function(){var t=this.json;return this._withDependencies(["bufferViews"]).then(function(e){return w(t.accessors,function(t){var n=e.bufferViews[t.bufferView],r=g[t.type],i=c[t.componentType],o=i.BYTES_PER_ELEMENT;if(t.byteStride&&t.byteStride!==o*r){var a=new i(n);return new cd(new ad(a,t.byteStride/o),r,t.byteOffset/o)}return new Rs(a=new i(n,t.byteOffset,t.count*r),r)})})},T.prototype.loadTextures=function(){var t=this.json,e=this.options;return this._withDependencies(["bufferViews"]).then(function(r){return w(t.textures,function(i){if(i.source)return new Promise(function(o){var a=t.images[i.source],s=a.uri,c=!1;if(a.extensions&&a.extensions[n.KHR_BINARY_GLTF]){var p=a.extensions[n.KHR_BINARY_GLTF],f=new Blob([r.bufferViews[p.bufferView]],{type:p.mimeType});s=URL.createObjectURL(f),c=!0}var m=cl.Handlers.get(s);null===m&&(m=new sl),m.setCrossOrigin(e.crossOrigin),m.load(_(s,e.path),function(e){if(c&&URL.revokeObjectURL(s),e.flipY=!1,void 0!==i.name&&(e.name=i.name),e.format=void 0!==i.format?h[i.format]:Lc,void 0!==i.internalFormat&&e.format!==h[i.internalFormat]&&console.warn("LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==i.type?d[i.type]:Cc,i.sampler){var n=t.samplers[i.sampler];e.magFilter=u[n.magFilter]||Ac,e.minFilter=u[n.minFilter]||1005,e.wrapS=l[n.wrapS]||_c,e.wrapT=l[n.wrapT]||_c}o(e)},void 0,function(){c&&URL.revokeObjectURL(s),o()})})})})},T.prototype.loadMaterials=function(){var t=this.json;return this._withDependencies(["shaders","textures"]).then(function(e){return w(t.materials,function(r){var i,o,c={},u={};if(r.extensions&&r.extensions[n.KHR_MATERIALS_COMMON]&&(o=r.extensions[n.KHR_MATERIALS_COMMON]),o){var l=["ambient","emission","transparent","transparency","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":i=Qu,l.push("diffuse","specular","shininess");break;case"LAMBERT":i=Zu,l.push("diffuse");break;case"CONSTANT":default:i=Xc}l.forEach(function(t){void 0!==o.values[t]&&(c[t]=o.values[t])}),(o.doubleSided||c.doubleSided)&&(u.side=uc),(o.transparent||c.transparent)&&(u.transparent=!0,u.opacity=void 0!==c.transparency?c.transparency:1)}else if(void 0===r.technique)i=Qu,Object.assign(c,r.values);else{i=S;var h=t.techniques[r.technique];u.uniforms={};var d=t.programs[h.program];if(d){u.fragmentShader=e.shaders[d.fragmentShader],u.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",d.fragmentShader),i=Qu);var g=e.shaders[d.vertexShader];g||(console.warn("ERROR: Missing vertex shader definition:",d.vertexShader),i=Qu),u.vertexShader=function(t,e){var n={};for(var r in e.attributes)n[r]={type:(u=e.parameters[c=e.attributes[r]]).type,semantic:l=u.semantic};var i=e.parameters,o=e.attributes,a={};for(var r in n){var s=i[c=o[r]];(l=s.semantic)&&(a[r]=s)}for(var c in a){var u,l=(u=a[c]).semantic,h=new RegExp("\\b"+c+"\\b","g");switch(l){case"POSITION":t=t.replace(h,"position");break;case"NORMAL":t=t.replace(h,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":t=t.replace(h,"uv");break;case"TEXCOORD_1":t=t.replace(h,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":t=t.replace(h,"color");break;case"WEIGHT":t=t.replace(h,"skinWeight");break;case"JOINT":t=t.replace(h,"skinIndex")}}return t}(g,h);var y=h.uniforms;for(var b in y){var w=y[b],_=h.parameters[w],T=_.type;if(!s[T])throw new Error("Unknown shader uniform param type: "+T);var M,A=_.count;void 0!==r.values&&(M=r.values[w]);var E=new s[T],C=_.semantic,P=_.node;switch(T){case a.FLOAT:E=_.value,"transparency"==w&&(u.transparent=!0),void 0!==M&&(E=M);break;case a.FLOAT_VEC2:case a.FLOAT_VEC3:case a.FLOAT_VEC4:case a.FLOAT_MAT3:_&&_.value&&E.fromArray(_.value),M&&E.fromArray(M);break;case a.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case a.FLOAT_MAT4:if(A){E=new Array(A);for(var O=0;O<A;O++)E[O]=new s[T];_&&_.value&&E.fromArray(_.value),M&&E.fromArray(M)}else _&&_.value&&E.fromArray(_.value),M&&E.fromArray(M);break;case a.SAMPLER_2D:E=void 0!==M?e.textures[M]:void 0!==_.value?e.textures[_.value]:null}u.uniforms[b]={value:E,semantic:C,node:P}}for(var N=h.states||{},L=N.enable||[],I=N.functions||{},R=!1,D=!1,F=!1,U=0,k=L.length;U<k;U++){var j=L[U];switch(x[j]){case"CULL_FACE":R=!0;break;case"DEPTH_TEST":D=!0;break;case"BLEND":F=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+j)}}u.side=R?void 0!==I.cullFace?p[I.cullFace]:sc:uc,u.depthTest=D,u.depthFunc=void 0!==I.depthFunc?f[I.depthFunc]:2,u.depthWrite=void 0===I.depthMask||I.depthMask[0],u.blending=F?5:0,u.transparent=F;var B=I.blendEquationSeparate;void 0!==B?(u.blendEquation=m[B[0]],u.blendEquationAlpha=m[B[1]]):(u.blendEquation=fc,u.blendEquationAlpha=fc);var z=I.blendFuncSeparate;void 0!==z?(u.blendSrc=v[z[0]],u.blendDst=v[z[1]],u.blendSrcAlpha=v[z[2]],u.blendDstAlpha=v[z[3]]):(u.blendSrc=201,u.blendDst=200,u.blendSrcAlpha=201,u.blendDstAlpha=200)}}Array.isArray(c.diffuse)?u.color=(new Ts).fromArray(c.diffuse):"string"==typeof c.diffuse&&(u.map=e.textures[c.diffuse]),delete u.diffuse,"string"==typeof c.reflective&&(u.envMap=e.textures[c.reflective]),"string"==typeof c.bump&&(u.bumpMap=e.textures[c.bump]),Array.isArray(c.emission)?i===Xc?u.color=(new Ts).fromArray(c.emission):u.emissive=(new Ts).fromArray(c.emission):"string"==typeof c.emission&&(i===Xc?u.map=e.textures[c.emission]:u.emissiveMap=e.textures[c.emission]),Array.isArray(c.specular)?u.specular=(new Ts).fromArray(c.specular):"string"==typeof c.specular&&(u.specularMap=e.textures[c.specular]),void 0!==c.shininess&&(u.shininess=c.shininess);var V=new i(u);return void 0!==r.name&&(V.name=r.name),V})})},T.prototype.loadMeshes=function(){var t=this.json;return this._withDependencies(["accessors","materials"]).then(function(e){return w(t.meshes,function(n){var r=new gd;void 0!==n.name&&(r.name=n.name),n.extras&&(r.userData=n.extras);var i=n.primitives||[];for(var o in i){var s=i[o];if(s.mode===a.TRIANGLES||void 0===s.mode){var c=new Xs,u=s.attributes;for(var l in u){if(!(f=u[l]))return;var h=e.accessors[f];switch(l){case"POSITION":c.addAttribute("position",h);break;case"NORMAL":c.addAttribute("normal",h);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":c.addAttribute("uv",h);break;case"TEXCOORD_1":c.addAttribute("uv2",h);break;case"COLOR_0":case"COLOR0":case"COLOR":c.addAttribute("color",h);break;case"WEIGHT":c.addAttribute("skinWeight",h);break;case"JOINT":c.addAttribute("skinIndex",h);break;default:if(!s.material)break;if(!(v=t.materials[s.material]).technique)break;var d=t.techniques[v.technique].parameters||{};for(var p in d)d[p].semantic===l&&c.addAttribute(p,h)}}s.indices&&c.setIndex(e.accessors[s.indices]),(m=new Kc(c,v=void 0!==e.materials?e.materials[s.material]:new Qu({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:sc}))).castShadow=!0,m.name="0"===o?r.name:r.name+o,s.extras&&(m.userData=s.extras),r.add(m)}else if(s.mode===a.LINES){for(var l in c=new Xs,u=s.attributes){var f;if(!(f=u[l]))return;switch(h=e.accessors[f],l){case"POSITION":c.addAttribute("position",h);break;case"COLOR_0":case"COLOR0":case"COLOR":c.addAttribute("color",h)}}var m,v=e.materials[s.material];s.indices?(c.setIndex(e.accessors[s.indices]),m=new Bd(c,v)):m=new $c(c,v),m.name="0"===o?r.name:r.name+o,s.extras&&(m.userData=s.extras),r.add(m)}else console.warn("Only triangular and line primitives are supported")}return r})})},T.prototype.loadCameras=function(){return w(this.json.cameras,function(t){if("perspective"==t.type&&t.perspective){var e=void 0!==t.perspective.aspectRatio?t.perspective.aspectRatio:1,n=new Mu(os.radToDeg(t.perspective.yfov*e),e,t.perspective.znear||1,t.perspective.zfar||2e6);return void 0!==t.name&&(n.name=t.name),t.extras&&(n.userData=t.extras),n}if("orthographic"==t.type&&t.orthographic)return n=new Cu(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,t.orthographic.znear,t.orthographic.zfar),void 0!==t.name&&(n.name=t.name),t.extras&&(n.userData=t.extras),n})},T.prototype.loadSkins=function(){var t=this.json;return this._withDependencies(["accessors"]).then(function(e){return w(t.skins,function(t){var n=new as;return void 0!==t.bindShapeMatrix&&n.fromArray(t.bindShapeMatrix),{bindShapeMatrix:n,jointNames:t.jointNames,inverseBindMatrices:e.accessors[t.inverseBindMatrices]}})})},T.prototype.loadAnimations=function(){var t=this.json;return this._withDependencies(["accessors","nodes"]).then(function(e){return w(t.animations,function(t,n){var r=[];for(var i in t.channels){var o=t.channels[i],a=t.samplers[o.sampler];if(a){var s=o.target,c=s.id,u=e.accessors[void 0!==t.parameters?t.parameters[a.input]:a.input],l=e.accessors[void 0!==t.parameters?t.parameters[a.output]:a.output],h=e.nodes[c];if(h){h.updateMatrix(),h.matrixAutoUpdate=!0;var d=void 0!==a.interpolation?b[a.interpolation]:2301;r.push(new(y[s.path]===y.rotation?pu:mu)((h.name?h.name:h.uuid)+"."+y[s.path],bu.arraySlice(u.array,0),bu.arraySlice(l.array,0),d))}}}return new _u(c=void 0!==t.name?t.name:"animation_"+n,void 0,r)})})},T.prototype.loadNodes=function(){var t=this.json,e=this.extensions,r=this;return w(t.nodes,function(t){var e,n=new as;return t.jointName?((e=new nu).name=void 0!==t.name?t.name:t.jointName,e.jointName=t.jointName):(e=new ys,void 0!==t.name&&(e.name=t.name)),t.extras&&(e.userData=t.extras),void 0!==t.matrix?(n.fromArray(t.matrix),e.applyMatrix(n)):(void 0!==t.translation&&e.position.fromArray(t.translation),void 0!==t.rotation&&e.quaternion.fromArray(t.rotation),void 0!==t.scale&&e.scale.fromArray(t.scale)),e}).then(function(i){return r._withDependencies(["meshes","skins","cameras"]).then(function(r){return w(i,function(o,a){var s=t.nodes[a];if(void 0!==s.meshes)for(var c in s.meshes){var u=s.meshes[c],l=r.meshes[u];if(void 0!==l)for(var h in l.children){var d,p=l.children[h],f=p.material,m=p.geometry,v=p.userData,g=p.name;switch(f.isDeferredShaderMaterial?f=y=f.create():y=f,p.type){case"LineSegments":p=new Bd(m,y);break;case"LineLoop":p=new Wd(m,y);break;case"Line":p=new $c(m,y);break;default:p=new Kc(m,y)}if(p.castShadow=!0,p.userData=v,p.name=g,s.skin&&(d=r.skins[s.skin]),d){var y,b=function(t){for(var e=Object.keys(i),n=0,r=e.length;n<r;n++){var o=i[e[n]];if(o.jointName===t)return o}return null},x=m;(y=f).skinning=!0,(p=new Td(x,y)).castShadow=!0,p.userData=v,p.name=g;for(var w=[],_=[],S=0,T=d.jointNames.length;S<T;S++){var M=d.jointNames[S],A=b(M);if(A){w.push(A);var E=d.inverseBindMatrices.array,C=(new as).fromArray(E,16*S);_.push(C)}else console.warn("WARNING: joint: '"+M+"' could not be found")}p.bind(new Sd(w,_),d.bindShapeMatrix);var P=function(e,n,r){var o=e[r];if(void 0!==o)for(var a=0,s=o.length;a<s;a++){var c=o[a],u=i[c],l=t.nodes[c];void 0!==u&&!0===u.isBone&&void 0!==l&&(n.add(u),P(l,u,"children"))}};P(s,p,"skeletons")}o.add(p)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+u+'".')}return void 0!==s.camera&&o.add(r.cameras[s.camera]),s.extensions&&s.extensions[n.KHR_MATERIALS_COMMON]&&s.extensions[n.KHR_MATERIALS_COMMON].light&&o.add(e[n.KHR_MATERIALS_COMMON].lights[s.extensions[n.KHR_MATERIALS_COMMON].light]),o})})})},T.prototype.loadScenes=function(){var t=this.json;function n(e,r,i){var o=i[e];r.add(o);var a=t.nodes[e];if(a.children)for(var s=a.children,c=0,u=s.length;c<u;c++)n(s[c],o,i)}return this._withDependencies(["nodes"]).then(function(r){return w(t.scenes,function(t){var i=new Eu;void 0!==t.name&&(i.name=t.name),t.extras&&(i.userData=t.extras);for(var o=t.nodes||[],a=0,s=o.length;a<s;a++)n(o[a],i,r.nodes);return i.traverse(function(t){t.material&&t.material.isRawShaderMaterial&&(t.gltfShader=new e(t,r.nodes),t.onBeforeRender=function(t,e,n){this.gltfShader.update(e,n)})}),i})})}}();var Xd=function(t){this.timeLoaded=0,this.manager=t||Hu,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=jc,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}};function qd(t){this.manager=void 0!==t?t:Hu,this._parser=null}function Yd(t){var e,n=t.Content,r=t.RelativeFilename||t.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof n)return"data:"+e+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:e}))}function Zd(t,e,n,r){var i=function(t,e,n,r){var i,o=e.path,a=r.get(t.id).children;void 0!==a&&a.length>0&&void 0!==n[a[0].ID]&&(0!==(i=n[a[0].ID]).indexOf("blob:")&&0!==i.indexOf("data:")||e.setPath(void 0));var s=e.load(i);return e.setPath(o),s}(t,e,n,r);i.ID=t.id,i.name=t.attrName;var o=t.WrapModeU,a=t.WrapModeV,s=void 0!==a?a.value:0;if(i.wrapS=0===(void 0!==o?o.value:0)?_c:Sc,i.wrapT=0===s?_c:Sc,"Scaling"in t){var c=t.Scaling.value;i.repeat.x=c[0],i.repeat.y=c[1]}return i}function Jd(t,e,n,r){var i=e.id,o=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!r.has(i))return null;var s,c=function(t,e,n,r,i){var o={};return e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new Ts).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(o.color=(new Ts).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Specular?o.specular=(new Ts).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.emissive=(new Ts).fromArray(e.SpecularColor.value)),e.Shininess&&(o.shininess=e.Shininess.value),e.Emissive?o.emissive=(new Ts).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(o.emissive=(new Ts).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),i.get(r).children.forEach(function(e){var r=e.relationship;switch(r){case"Bump":o.bumpMap=n.get(e.ID);break;case"DiffuseColor":o.map=Qd(t,n,e.ID,i);break;case"DisplacementColor":o.displacementMap=Qd(t,n,e.ID,i);break;case"EmissiveColor":o.emissiveMap=Qd(t,n,e.ID,i);break;case"NormalMap":o.normalMap=Qd(t,n,e.ID,i);break;case"ReflectionColor":o.envMap=Qd(t,n,e.ID,i),o.envMap.mapping=xc;break;case"SpecularColor":o.specularMap=Qd(t,n,e.ID,i);break;case"TransparentColor":o.alphaMap=Qd(t,n,e.ID,i),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),o}(t,e,n,i,r);switch(a.toLowerCase()){case"phong":s=new Qu;break;case"lambert":s=new Zu;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),s=new Qu({color:3342591})}return s.setValues(c),s.name=o,s}function Qd(t,e,n,r){return"LayeredTexture"in t.Objects&&n in t.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=r.get(n).children[0].ID),e.get(n)}function Kd(t,e){var n=[];return t.children.forEach(function(t){var r=e[t.ID];if("Cluster"===r.attrType){var i={ID:t.ID,indices:[],weights:[],transform:(new as).fromArray(r.Transform.a),transformLink:(new as).fromArray(r.TransformLink.a),linkMode:r.Mode};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}}),{rawBones:n,bones:[]}}function $d(t,e,n,r){switch(n.attrType){case"Mesh":return function(t,e,n,r){var i=e.parents.map(function(e){return t.Objects.Model[e.ID]});if(0!==i.length){var o=e.children.reduce(function(t,e){return void 0!==r[e.ID]&&(t=r[e.ID]),t},null),a=new as,s=i[0];if("GeometricRotation"in s){var c=s.GeometricRotation.value.map(os.degToRad);c[3]="ZYX",a.makeRotationFromEuler((new ls).fromArray(c))}return"GeometricTranslation"in s&&a.setPosition((new ss).fromArray(s.GeometricTranslation.value)),"GeometricScaling"in s&&a.scale((new ss).fromArray(s.GeometricScaling.value)),function(t,e,n,r,i){var o,a,s,c=n.Vertices.a,u=n.PolygonVertexIndex.a,l=[],h=[],d=[],p=[],f=[],m=[],v=[];if(n.LayerElementColor)var g=(s=[],"IndexToDirect"===(a=(o=n.LayerElementColor[0]).ReferenceInformationType)&&(s=o.ColorIndex.a),{dataSize:4,buffer:o.Colors.a,indices:s,mappingType:o.MappingInformationType,referenceType:a});if(n.LayerElementMaterial)var y=function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=t.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:e,referenceType:n}}(n.LayerElementMaterial[0]);if(n.LayerElementNormal)var b=function(t){var e=t.ReferenceInformationType,n=[];return"IndexToDirect"===e&&("NormalIndex"in t?n=t.NormalIndex.a:"NormalsIndex"in t&&(n=t.NormalsIndex.a)),{dataSize:3,buffer:t.Normals.a,indices:n,mappingType:t.MappingInformationType,referenceType:e}}(n.LayerElementNormal[0]);if(n.LayerElementUV)for(var x=[],w=0;n.LayerElementUV[w];)x.push(tp(n.LayerElementUV[w])),w++;var _={};null!==r&&r.rawBones.forEach(function(t,e){t.indices.forEach(function(n,r){void 0===_[n]&&(_[n]=[]),_[n].push({id:e,weight:t.weights[r]})})});var S=0,T=0,M=!1,A=[],E=[],C=[],P=[],O=[],N=[];u.forEach(function(t,e){var n=!1;t<0&&(u[e]=t^=-1,n=!0);var i=[],o=[];if(A.push(3*t,3*t+1,3*t+2),g){var a=rp(e,S,t,g);C.push(a[0],a[1],a[2])}if(r){if(void 0!==_[t]&&_[t].forEach(function(t){o.push(t.weight),i.push(t.id)}),o.length>4){M||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),M=!0);var s=[0,0,0,0],w=[0,0,0,0];o.forEach(function(t,e){var n=t,r=i[e];w.forEach(function(t,e,i){if(n>t){i[e]=n,n=t;var o=s[e];s[e]=r,r=o}})}),i=s,o=w}for(;o.length<4;)o.push(0),i.push(0);for(var L=0;L<4;++L)O.push(o[L]),N.push(i[L])}if(b&&(a=rp(e,S,t,b),E.push(a[0],a[1],a[2])),y&&"AllSame"!==y.mappingType)var I=rp(e,S,t,y)[0];if(x&&x.forEach(function(n,r){var i=rp(e,S,t,n);void 0===P[r]&&(P[r]=[]),P[r].push(i[0]),P[r].push(i[1])}),T++,n){for(L=2;L<T;L++)l.push(c[A[0]]),l.push(c[A[1]]),l.push(c[A[2]]),l.push(c[A[3*(L-1)]]),l.push(c[A[3*(L-1)+1]]),l.push(c[A[3*(L-1)+2]]),l.push(c[A[3*L]]),l.push(c[A[3*L+1]]),l.push(c[A[3*L+2]]),r&&(m.push(O[0]),m.push(O[1]),m.push(O[2]),m.push(O[3]),m.push(O[4*(L-1)]),m.push(O[4*(L-1)+1]),m.push(O[4*(L-1)+2]),m.push(O[4*(L-1)+3]),m.push(O[4*L]),m.push(O[4*L+1]),m.push(O[4*L+2]),m.push(O[4*L+3]),v.push(N[0]),v.push(N[1]),v.push(N[2]),v.push(N[3]),v.push(N[4*(L-1)]),v.push(N[4*(L-1)+1]),v.push(N[4*(L-1)+2]),v.push(N[4*(L-1)+3]),v.push(N[4*L]),v.push(N[4*L+1]),v.push(N[4*L+2]),v.push(N[4*L+3])),g&&(d.push(C[0]),d.push(C[1]),d.push(C[2]),d.push(C[3*(L-1)]),d.push(C[3*(L-1)+1]),d.push(C[3*(L-1)+2]),d.push(C[3*L]),d.push(C[3*L+1]),d.push(C[3*L+2])),y&&"AllSame"!==y.mappingType&&(f.push(I),f.push(I),f.push(I)),b&&(h.push(E[0]),h.push(E[1]),h.push(E[2]),h.push(E[3*(L-1)]),h.push(E[3*(L-1)+1]),h.push(E[3*(L-1)+2]),h.push(E[3*L]),h.push(E[3*L+1]),h.push(E[3*L+2])),x&&x.forEach(function(t,e){void 0===p[e]&&(p[e]=[]),p[e].push(P[e][0]),p[e].push(P[e][1]),p[e].push(P[e][2*(L-1)]),p[e].push(P[e][2*(L-1)+1]),p[e].push(P[e][2*L]),p[e].push(P[e][2*L+1])});S++,T=0,A=[],E=[],C=[],P=[],O=[],N=[]}});var L=new Xs;L.name=n.name;var I=new Vs(l,3);if(i.applyToBufferAttribute(I),L.addAttribute("position",I),d.length>0&&L.addAttribute("color",new Vs(d,3)),r&&(L.addAttribute("skinIndex",new Vs(v,4)),L.addAttribute("skinWeight",new Vs(m,4)),L.FBX_Deformer=r),h.length>0){var R=new Vs(h,3);(new ds).getNormalMatrix(i).applyToBufferAttribute(R),L.addAttribute("normal",R)}if(p.forEach(function(t,e){var n="uv"+(e+1).toString();0===e&&(n="uv"),L.addAttribute(n,new Vs(p[e],2))}),y&&"AllSame"!==y.mappingType){var D=f[0],F=0;if(f.forEach(function(t,e){t!==D&&(L.addGroup(F,e-F,D),D=t,F=e)}),L.groups.length>0){var U=L.groups[L.groups.length-1],k=U.start+U.count;k!==f.length&&L.addGroup(k,f.length-k,D)}0===L.groups.length&&L.addGroup(0,f.length,f[0])}return L}(0,0,n,o,a)}}(t,e,n,r);case"NurbsCurve":return function(t){if(void 0===uh)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Xs;var e=parseInt(t.Order);if(isNaN(e))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new Xs;for(var n,r,i=e-1,o=t.KnotVector.a,a=[],s=t.Points.a,c=0,u=s.length;c<u;c+=4)a.push((new Is).fromArray(s,c));if("Closed"===t.Form)a.push(a[0]);else if("Periodic"===t.Form)for(r=o.length-1-(n=i),c=0;c<i;++c)a.push(a[c]);var l=new uh(i,o,a,n,r).getPoints(7*a.length),h=new Float32Array(3*l.length);l.forEach(function(t,e){t.toArray(h,3*e)});var d=new Xs;return d.addAttribute("position",new Rs(h,3)),d}(n)}}function tp(t){var e=t.ReferenceInformationType,n=[];return"IndexToDirect"===e&&(n=t.UVIndex.a),{dataSize:2,buffer:t.UV.a,indices:n,mappingType:t.MappingInformationType,referenceType:e}}Xd.prototype={constructor:Xd,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.load(t,function(t){i.decodeDracoFile(t,e)},n,r)},setPath:function(t){this.path=t},setCrossOrigin:function(t){this.crossOrigin=t},setVerbosity:function(t){this.verbosity=t},setDrawMode:function(t){this.drawMode=t},setSkipDequantization:function(t,e){var n=!0;"undefined"!=typeof e&&(n=e),this.getAttributeOptions(t).skipDequantization=n},decodeDracoFile:function(t,e,n){var r=this;Xd.getDecoderModule().then(function(i){r.decodeDracoFileInternal(t,i.decoder,e,n||{})})},decodeDracoFileInternal:function(t,e,n,r){var i=new e.DecoderBuffer;i.Init(new Int8Array(t),t.byteLength);var o=new e.Decoder,a=o.GetEncodedGeometryType(i);if(a==e.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(a!=e.POINT_CLOUD){var s="DRACOLoader: Unknown geometry type.";throw console.error(s),new Error(s)}this.verbosity>0&&console.log("Loaded a point cloud.")}n(this.convertDracoGeometryTo3JS(e,o,a,i,r))},addAttributeToGeometry:function(t,e,n,r,i,o,a){if(0===i.ptr){var s="DRACOLoader: No attribute "+r;throw console.error(s),new Error(s)}var c=i.num_components(),u=new t.DracoFloat32Array;e.GetAttributeFloatForAllPoints(n,i,u);var l=n.num_points()*c;a[r]=new Float32Array(l);for(var h=0;h<l;h++)a[r][h]=u.GetValue(h);o.addAttribute(r,new Vs(a[r],c)),t.destroy(u)},convertDracoGeometryTo3JS:function(t,e,n,r,i){var o,a;!0===this.getAttributeOptions("position").skipDequantization&&e.SkipAttributeTransform(t.POSITION);var s=performance.now();if(n===t.TRIANGULAR_MESH?(o=new t.Mesh,a=e.DecodeBufferToMesh(r,o)):(o=new t.PointCloud,a=e.DecodeBufferToPointCloud(r,o)),!a.ok()||0==o.ptr){var c="DRACOLoader: Decoding failed: ";throw c+=a.error_msg(),console.error(c),t.destroy(e),t.destroy(o),new Error(c)}var u,l=performance.now();t.destroy(r),n==t.TRIANGULAR_MESH?(u=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+u.toString())):u=0;var h=o.num_points(),d=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+h.toString()),console.log("Number of attributes loaded: "+d.toString()));var p=e.GetAttributeId(o,t.POSITION);if(-1==p)throw c="DRACOLoader: No position attribute found.",console.error(c),t.destroy(e),t.destroy(o),new Error(c);var f=e.GetAttribute(o,p),m={},v=new Xs;for(var g in this.nativeAttributeMap)if(void 0===i[g]){var y=e.GetAttributeId(o,t[this.nativeAttributeMap[g]]);if(-1!==y){this.verbosity>0&&console.log("Loaded "+g+" attribute.");var b=e.GetAttribute(o,y);this.addAttributeToGeometry(t,e,o,g,b,v,m)}}for(var g in i)b=e.GetAttributeByUniqueId(o,i[g]),this.addAttributeToGeometry(t,e,o,g,b,v,m);if(n==t.TRIANGULAR_MESH)if(this.drawMode===Bc){var x=new t.DracoInt32Array;e.GetTriangleStripsFromMesh(o,x),m.indices=new Uint32Array(x.size());for(var w=0;w<x.size();++w)m.indices[w]=x.GetValue(w);t.destroy(x)}else{m.indices=new Uint32Array(3*u);var _=new t.DracoInt32Array;for(w=0;w<u;++w){e.GetFaceFromMesh(o,w,_);var S=3*w;m.indices[S]=_.GetValue(0),m.indices[S+1]=_.GetValue(1),m.indices[S+2]=_.GetValue(2)}t.destroy(_)}v.drawMode=this.drawMode,n==t.TRIANGULAR_MESH&&v.setIndex(new(m.indices.length>65535?zs:js)(m.indices,1));var T=new t.AttributeQuantizationTransform;if(T.InitFromAttribute(f))for(v.attributes.position.isQuantized=!0,v.attributes.position.maxRange=T.range(),v.attributes.position.numQuantizationBits=T.quantization_bits(),v.attributes.position.minValues=new Float32Array(3),w=0;w<3;++w)v.attributes.position.minValues[w]=T.min_value(w);return t.destroy(T),t.destroy(e),t.destroy(o),this.decode_time=l-s,this.import_time=performance.now()-l,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),v},isVersionSupported:function(t,e){Xd.getDecoderModule().then(function(n){e(n.decoder.isVersionSupported(t))})},getAttributeOptions:function(t){return"undefined"==typeof this.attributeOptions[t]&&(this.attributeOptions[t]={}),this.attributeOptions[t]}},Xd.decoderPath="./",Xd.decoderConfig={},Xd.decoderModulePromise=null,Xd.setDecoderPath=function(t){Xd.decoderPath=t},Xd.setDecoderConfig=function(t){var e=Xd.decoderConfig.wasmBinary;Xd.decoderConfig=t||{},Xd.releaseDecoderModule(),e&&(Xd.decoderConfig.wasmBinary=e)},Xd.releaseDecoderModule=function(){Xd.decoderModulePromise=null},Xd.getDecoderModule=function(){var t=this,e=Xd.decoderPath,n=Xd.decoderConfig,r=Xd.decoderModulePromise;return r||("undefined"!=typeof DracoDecoderModule?r=Promise.resolve():"object"!=typeof WebAssembly||"js"===n.type?r=Xd._loadScript(e+"draco_decoder.js"):(n.wasmBinaryFile=e+"draco_decoder.wasm",r=Xd._loadScript(e+"draco_wasm_wrapper.js").then(function(){return Xd._loadArrayBuffer(n.wasmBinaryFile)}).then(function(t){n.wasmBinary=t})),r=r.then(function(){return new Promise(function(e){n.onModuleLoaded=function(n){t.timeLoaded=performance.now(),e({decoder:n})},DracoDecoderModule(n)})}),Xd.decoderModulePromise=r,r)},Xd._loadScript=function(t){var e=document.getElementById("decoder_script");null!==e&&e.parentNode.removeChild(e);var n=document.getElementsByTagName("head")[0],r=document.createElement("script");return r.id="decoder_script",r.type="text/javascript",r.src=t,new Promise(function(t){r.onload=t,n.appendChild(r)})},Xd._loadArrayBuffer=function(t){var e=new Xu;return e.setResponseType("arraybuffer"),new Promise(function(n,r){e.load(t,n,void 0,r)})},Object.assign(qd.prototype,{load:function(t,e,n,r){var i=this,o=new Yh,a=new Xu(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){var n=i._parser(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:Sc,o.wrapT=void 0!==n.wrapT?n.wrapT:Sc,o.magFilter=void 0!==n.magFilter?n.magFilter:Ac,o.minFilter=void 0!==n.minFilter?n.minFilter:Ec,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps),1===n.mipmapCount&&(o.minFilter=Ac),o.needsUpdate=!0,e&&e(o,n))},n,r),o}}),((function(t){this.manager=void 0!==t?t:Hu}).prototype=Object.create(qd.prototype))._parser=function(t){var e=65536,n=e>>3,r=14,i=65537,o=1<<r,a=o-1,s=59,c=63,u=2+c-s,l=8,h=4,d=4,p=2,f=1,m={l:0,c:0,lc:0};function v(t,e,n,r,i){for(;n<t;)e=e<<8|L(r,i),n+=8;m.l=e>>(n-=t)&(1<<t)-1,m.c=e,m.lc=n}var g=new Array(59);function y(t){return 63&t}function b(t){return t>>6}var x={c:0,lc:0};function w(t,e,n,r){t=t<<8|L(n,r),e+=8,x.c=t,x.lc=e}var _={c:0,lc:0};function S(t,e,n,r,i,o,a,s,c,u){if(t==e){r<8&&(w(n,r,i,a),n=x.c,r=x.lc);var l=n>>(r-=8);if(out+l>oe)throw"Issue with getCode";for(var h=out[-1];l-- >0;)s[c.value++]=h}else{if(!(c.value<u))throw"Issue with getCode";s[c.value++]=t}_.c=n,_.lc=r}function T(t){var e=function(t){return 65535&t}(t);return e>32767?e-65536:e}var M={a:0,b:0};function A(t,e){var n=T(t),r=T(e),i=n+(1&r)+(r>>1),o=i-r;M.a=i,M.b=o}function E(t,e,n,r,i,o,a){for(var s,c=n>i?i:n,u=1;u<=c;)u<<=1;for(s=u>>=1,u>>=1;u>=1;){for(var l,h,d,p=0,f=p+o*(i-s),m=o*u,v=o*s,g=r*u,y=r*s;p<=f;p+=v){for(var b=p,x=p+r*(n-s);b<=x;b+=y){var w,_=b+g,S=(w=b+m)+g;A(e[b+t],e[w+t]),l=M.a,h=M.b,A(e[_+t],e[S+t]),d=M.b,A(l,M.a),e[b+t]=M.a,e[_+t]=M.b,A(h,d),e[w+t]=M.a,e[S+t]=M.b}n&u&&(A(e[b+t],e[(w=b+m)+t]),l=M.a,e[w+t]=M.b,e[b+t]=l)}if(i&u)for(b=p,x=p+r*(n-s);b<=x;b+=y)A(e[b+t],e[(_=b+g)+t]),l=M.a,e[_+t]=M.b,e[b+t]=l;s=u,u>>=1}return p}function C(t,l,h,d,p,f,T,M,A,C){var P=new Uint8Array(n),O=F(d,p),L=F(d,p);if(L>=n)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(O<=L)for(var R=0;R<L-O+1;R++)P[R+O]=I(d,p);var D=new Uint16Array(e);!function(t,n){for(var r=0,i=0;i<e;++i)(0==i||t[i>>3]&1<<(7&i))&&(n[r++]=i);for(;r<e;)n[r++]=0}(P,D),function(t,e,n,l,h,d,p){var f=n.value,T=N(e,n),M=N(e,n);n.value+=4;var A=N(e,n);if(n.value+=4,T<0||T>=i||M<0||M>=i)throw"Something wrong with HUF_ENCSIZE";var E=new Array(i),C=new Array(o);if(function(t){for(var e=0;e<o;e++)t[e]={},t[e].len=0,t[e].lit=0,t[e].p=null}(C),function(t,e,n,r,o,a,l){for(var h=n,d=0,p=0;o<=a;o++){if(h.value-n.value>r)return!1;v(6,d,p,t,h);var f=m.l;if(d=m.c,p=m.lc,l[o]=f,f==c){if(h.value-n.value>r)throw"Something wrong with hufUnpackEncTable";if(v(8,d,p,t,h),d=m.c,p=m.lc,o+(y=m.l+u)>a+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)l[o++]=0;o--}else if(f>=s){var y;if(o+(y=f-s+2)>a+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)l[o++]=0;o--}}!function(t){for(var e=0;e<=58;++e)g[e]=0;for(e=0;e<i;++e)g[t[e]]+=1;var n=0;for(e=58;e>0;--e){var r=n+g[e]>>1;g[e]=n,n=r}for(e=0;e<i;++e){var o=t[e];o>0&&(t[e]=o|g[o]++<<6)}}(l)}(t,0,n,l-(n.value-f),T,M,E),A>8*(l-(n.value-f)))throw"Something wrong with hufUncompress";!function(t,e,n,i){for(;e<=n;e++){var o=b(t[e]),a=y(t[e]);if(o>>a)throw"Invalid table entry";if(a>r){if((l=i[o>>a-r]).len)throw"Invalid table entry";if(l.lit++,l.p){var s=l.p;l.p=new Array(l.lit);for(var c=0;c<l.lit-1;++c)l.p[c]=s[c]}else l.p=new Array(1);l.p[l.lit-1]=e}else if(a){var u=0;for(c=1<<r-a;c>0;c--){var l;if((l=i[(o<<r-a)+u]).len||l.p)throw"Invalid table entry";l.len=a,l.lit=e,u++}}}}(E,T,M,C),function(t,e,n,i,o,s,c,u,l,h){for(var d=0,f=0,m=p,v=Math.trunc(o.value+(s+7)/8);o.value<v;)for(w(d,f,n,o),d=x.c,f=x.lc;f>=r;)if((A=e[d>>f-r&a]).len)S(A.lit,c,d,f-=A.len,n,0,o,l,h,m),d=_.c,f=_.lc;else{if(!A.p)throw"hufDecode issues";var g;for(g=0;g<A.lit;g++){for(var T=y(t[A.p[g]]);f<T&&o.value<v;)w(d,f,n,o),d=x.c,f=x.lc;if(f>=T&&b(t[A.p[g]])==(d>>f-T&(1<<T)-1)){S(A.p[g],c,d,f-=T,n,0,o,l,h,m),d=_.c,f=_.lc;break}}if(g==A.lit)throw"hufDecode issues"}var M=8-s&7;for(d>>=M,f-=M;f>0;){var A;if(!(A=e[d<<r-f&a]).len)throw"hufDecode issues";S(A.lit,c,d,f-=A.len,n,0,o,l,h,m),d=_.c,f=_.lc}}(E,C,t,0,n,A,M,0,h,d)}(h,d,p,N(d,p),t,l,f);var U=new Array(T),k=0;for(R=0;R<T;R++)U[R]={},U[R].start=k,U[R].end=U[R].start,U[R].nx=A,U[R].ny=C,U[R].size=1,k+=U[R].nx*U[R].ny*U[R].size;var j=0;for(R=0;R<T;R++)for(var B=0;B<U[R].size;++B)j+=E(B+j,t,U[R].nx,U[R].size,U[R].ny,U[R].nx*U[R].size);return function(t,e,n){for(var r=0;r<n;++r)e[r]=t[e[r]]}(D,t,k),!0}function P(t,e){for(var n=new Uint8Array(t),r=0;0!=n[e.value+r];)r+=1;var i=(new TextDecoder).decode(n.slice(e.value,e.value+r));return e.value=e.value+r+1,i}function O(t,e){var n=t.getUint32(0,!0);return e.value=e.value+l,n}function N(t,e){var n=t.getUint32(e.value,!0);return e.value=e.value+d,n}function L(t,e){var n=t[e.value];return e.value=e.value+f,n}function I(t,e){var n=t.getUint8(e.value);return e.value=e.value+f,n}function R(t,e){var n=t.getFloat32(e.value,!0);return e.value+=h,n}function D(t){var e=(31744&t)>>10,n=1023&t;return(t>>15?-1:1)*(e?31===e?n?NaN:1/0:Math.pow(2,e-15)*(1+n/1024):n/1024*6103515625e-14)}function F(t,e){var n=t.getUint16(e.value,!0);return e.value+=p,n}function U(t,e){return D(F(t,e))}function k(t,e,n,r,i){if("string"==r||"iccProfile"==r)return function(t,e,n){var r=(new TextDecoder).decode(new Uint8Array(t).slice(e.value,e.value+n));return e.value=e.value+n,r}(e,n,i);if("chlist"==r)return function(t,e,n,r){for(var i=n.value,o=[];n.value<i+r-1;){var a=P(e,n),s=N(t,n),c=I(t,n);n.value+=3;var u=N(t,n),l=N(t,n);o.push({name:a,pixelType:s,pLinear:c,xSampling:u,ySampling:l})}return n.value+=1,o}(t,e,n,i);if("chromaticities"==r)return function(t,e){return{redX:R(t,e),redY:R(t,e),greenX:R(t,e),greenY:R(t,e),blueX:R(t,e),blueY:R(t,e),whiteX:R(t,e),whiteY:R(t,e)}}(e,n);if("compression"==r)return function(t,e){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION"][I(t,e)]}(t,n);if("box2i"==r)return function(t,e){return{xMin:N(t,e),yMin:N(t,e),xMax:N(t,e),yMax:N(t,e)}}(t,n);if("lineOrder"==r)return function(t,e){return["INCREASING_Y"][I(t,e)]}(t,n);if("float"==r)return R(t,n);if("v2f"==r)return function(t,e){return[R(t,e),R(t,e)]}(t,n);throw"Cannot parse value for unsupported type: "+r}for(var j=new DataView(t),B=new Uint8Array(t),z={},V=(j.getUint32(0,!0),j.getUint8(4,!0),j.getUint8(5,!0),{value:8}),G=!0;G;){var H=P(t,V);if(0==H)G=!1;else{var W=k(j,t,V,P(t,V),N(j,V));z[H]=W}}var X=1;"PIZ_COMPRESSION"==z.compression&&(X=32);for(var q=(z.dataWindow.yMax+1)/X,Y=0;Y<q;Y++)O(j,V);var Z=z.dataWindow.xMax-z.dataWindow.xMin+1,J=z.dataWindow.yMax-z.dataWindow.yMin+1,Q=z.channels.length,K=new Float32Array(Z*J*Q),$={R:0,G:1,B:2,A:3};if("NO_COMPRESSION"==z.compression)for(var tt=0;tt<J;tt++)for(var et=N(t,V),nt=(N(t,V),0);nt<z.channels.length;nt++){var rt=$[z.channels[nt].name];if(1!=z.channels[nt].pixelType)throw"Only supported pixel format is HALF";for(var it=0;it<Z;it++){var ot=U(t,V);K[J*Q*(Z-et)+it*Q+rt]=ot}}else{if("PIZ_COMPRESSION"!=z.compression)throw"Cannot decompress unsupported compression";for(var at=0;at<J/X;at++){N(j,V),N(j,V);var st=Z*X*(2*z.channels.length),ct=new Uint16Array(st);C(ct,{value:0},B,j,V,st,Q,0,Z,X);for(var ut=0;ut<X;ut++)for(nt=0;nt<z.channels.length;nt++){if(rt=$[z.channels[nt].name],1!=z.channels[nt].pixelType)throw"Only supported pixel format is HALF";for(it=0;it<Z;it++)ot=D(ct[nt*(X*Z)+ut*Z+it]),K[Z*Q*(J-(ut+at*X))+it*Q+rt]=ot}}}return{header:z,width:Z,height:J,data:K,format:Nc,type:1015}},Object.assign((function(t){this.manager=void 0!==t?t:Hu}).prototype,{load:function(t,e,n,r){var i=this,o=ul.extractUrlBase(t),a=new Xu(this.manager);a.setResponseType("arraybuffer"),a.load(t,function(n){try{var a=i.parse(n,o);e(a)}catch(e){window.setTimeout(function(){r&&r(e),i.manager.itemError(t)},0)}},n,r)},parse:function(t,e){var n,r,i;if((r=t).byteLength>=(i="Kaydara FBX Binary  \0").length&&i===wp(r,0,i.length))n=(new mp).parse(t);else{var o=wp(t);if(!function(t){for(var e,n,r=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0,o=0;o<r.length;++o)if(n=t[(e=1)-1],t=t.slice(i+e),i++,n===r[o])return!1;return!0}(o))throw new Error("FBXLoader: Unknown format.");if(yp(o)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+yp(o));n=(new fp).parse(o)}var a=function(t){var e=new Map;return"Connections"in t&&t.Connections.connections.forEach(function(t){var n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};e.get(n).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};e.get(r).children.push(a)}),e}(n),s=function(t){var e={},n={};if("Video"in t.Objects){var r=t.Objects.Video;for(var i in r){var o=r[i];if(e[s=parseInt(i)]=o.Filename,"Content"in o&&(o.Content instanceof ArrayBuffer&&o.Content.byteLength>0||"string"==typeof o.Content&&""!==o.Content)){var a=Yd(r[i]);n[o.Filename]=a}}}for(var s in e){var c=e[s];e[s]=void 0!==n[c]?n[c]:e[s].split("\\").pop()}return e}(n),c=function(t,e,n){var r=new Map;if("Material"in t.Objects){var i=t.Objects.Material;for(var o in i){var a=Jd(t,i[o],e,n);null!==a&&r.set(parseInt(o),a)}}return r}(n,function(t,e,n,r){var i=new Map;if("Texture"in t.Objects){var o=t.Objects.Texture;for(var a in o){var s=Zd(o[a],e,n,r);i.set(parseInt(a),s)}}return i}(n,new sl(this.manager).setPath(e),s,a),a),u=function(t,e){var n={};if("Deformer"in t.Objects){var r=t.Objects.Deformer;for(var i in r)if("Skin"===r[i].attrType){var o=e.get(parseInt(i)),a=Kd(o,r);a.ID=i,o.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,n[i]=a}}return n}(n,a);return function(t,e,n,r,i){var o=new gd,a=function(t,e,n,r,i){var o=new Map,a=t.Objects.Model;for(var s in a){var c=parseInt(s),u=a[s],l=i.get(c),h=ip(l,e,c,u.attrName);if(!h){switch(u.attrType){case"Camera":h=op(t,l);break;case"Light":h=ap(t,l);break;case"Mesh":h=sp(0,l,n,r);break;case"NurbsCurve":h=cp(l,n);break;case"LimbNode":case"Null":default:h=new gd}h.name=Dh.sanitizeNodeName(u.attrName),h.ID=c}up(0,h,u),o.set(c,h)}return o}(t,n,r,i,e),s=t.Objects.Model;return a.forEach(function(n){!function(t,e,n,r,i){"LookAtProperty"in n&&r.get(e.ID).children.forEach(function(n){if("LookAtProperty"===n.relationship){var r=t.Objects.Model[n.ID];if("Lcl_Translation"in r){var o=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(o),i.add(e.target)):e.lookAt((new ss).fromArray(o))}}})}(t,n,s[n.ID],e,o),e.get(n.ID).parents.forEach(function(t){var e=a.get(t.ID);void 0!==e&&e.add(n)}),null===n.parent&&o.add(n)}),function(t,e,n,r,i){var o=function(t){var e={};if("Pose"in t.Objects){var n=t.Objects.Pose;for(var r in n)if("BindPose"===n[r].attrType){var i=n[r].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=(new as).fromArray(t.Matrix.a)}):e[i.Node]=(new as).fromArray(i.Matrix.a)}}return e}(t);for(var a in e){var s=e[a];i.get(parseInt(s.ID)).parents.forEach(function(t){n.has(t.ID)&&i.get(t.ID).parents.forEach(function(t){r.has(t.ID)&&r.get(t.ID).bind(new Sd(s.bones),o[t.ID])})})}}(t,n,r,a,e),function(t,e,n){n.animations=[];var r=function(t,e){if(void 0!==t.Objects.AnimationCurve){var n=function(t){var e=t.Objects.AnimationCurveNode,n=new Map;for(var r in e){var i=e[r];if(null!==i.attrName.match(/S|R|T/)){var o={id:i.id,attr:i.attrName,curves:{}};n.set(o.id,o)}}return n}(t);return function(t,e,n){var r=t.Objects.AnimationCurve;for(var i in r){var o={id:r[i].id,times:r[i].KeyTime.a.map(bp),values:r[i].KeyValueFloat.a},a=e.get(o.id);if(void 0!==a){var s=a.parents[0].ID,c=a.parents[0].relationship,u="";if(c.match(/X/))u="x";else if(c.match(/Y/))u="y";else{if(!c.match(/Z/))continue;u="z"}n.get(s).curves[u]=o}}}(t,e,n),function(t,e,n){var r=t.Objects.AnimationStack,i={};for(var o in r){var a=e.get(parseInt(o)).children;a.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=n.get(a[0].ID);i[o]={name:r[o].attrName,layer:s}}return i}(t,e,function(t,e,n){var r=t.Objects.AnimationLayer,i=new Map;for(var o in r){var a=[],s=e.get(parseInt(o));void 0!==s&&(s.children.forEach(function(r,i){if(n.has(r.ID)){var o=n.get(r.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===a[i]){var s;e.get(r.ID).parents.forEach(function(t){void 0!==t.relationship&&(s=t.ID)});var c=t.Objects.Model[s.toString()],u={modelName:Dh.sanitizeNodeName(c.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in c&&(u.initialPosition=c.Lcl_Translation.value),"Lcl_Rotation"in c&&(u.initialRotation=c.Lcl_Rotation.value),"Lcl_Scaling"in c&&(u.initialScale=c.Lcl_Scaling.value),"PreRotation"in c&&(u.preRotations=c.PreRotation.value),a[i]=u}a[i][o.attr]=o}}}),i.set(parseInt(o),a))}return i}(t,e,n))}}(t,e);if(void 0!==r)for(var i in r){var o=lp(r[i]);n.animations.push(o)}}(t,e,o),function(t,e){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var n=t.GlobalSettings.AmbientColor.value,r=n[0],i=n[1],o=n[2];if(0!==r||0!==i||0!==o){var a=new Ts(r,i,o);e.add(new jd(a,1))}}}(t,o),o}(n,a,u,function(t,e,n){var r=new Map;if("Geometry"in t.Objects){var i=t.Objects.Geometry;for(var o in i){var a=$d(t,e.get(parseInt(o)),i[o],n);r.set(parseInt(o),a)}}return r}(n,a,u),c)}});var ep=[],np={ByPolygonVertex:{Direct:function(t,e,n,r){return _p(ep,r.buffer,t*r.dataSize,t*r.dataSize+r.dataSize)},IndexToDirect:function(t,e,n,r){var i=r.indices[t];return _p(ep,r.buffer,i*r.dataSize,i*r.dataSize+r.dataSize)}},ByPolygon:{Direct:function(t,e,n,r){return _p(ep,r.buffer,e*r.dataSize,e*r.dataSize+r.dataSize)},IndexToDirect:function(t,e,n,r){var i=r.indices[e];return _p(ep,r.buffer,i*r.dataSize,i*r.dataSize+r.dataSize)}},ByVertice:{Direct:function(t,e,n,r){return _p(ep,r.buffer,n*r.dataSize,n*r.dataSize+r.dataSize)}},AllSame:{IndexToDirect:function(t,e,n,r){return _p(ep,r.buffer,r.indices[0]*r.dataSize,r.indices[0]*r.dataSize+r.dataSize)}}};function rp(t,e,n,r){return np[r.mappingType][r.referenceType](t,e,n,r)}function ip(t,e,n,r){var i=null;return t.parents.forEach(function(t){for(var o in e){var a=e[o];a.rawBones.forEach(function(e,o){if(e.ID===t.ID){var s=i;(i=new nu).matrixWorld.copy(e.transformLink),i.name=Dh.sanitizeNodeName(r),i.ID=n,a.bones[o]=i,null!==s&&i.add(s)}})}}),i}function op(t,e){var n,r;if(e.children.forEach(function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(r=n)}),void 0===r)n=new ys;else{var i=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(i=1);var o=1;void 0!==r.NearPlane&&(o=r.NearPlane.value/1e3);var a=1e3;void 0!==r.FarPlane&&(a=r.FarPlane.value/1e3);var s=window.innerWidth,c=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(s=r.AspectWidth.value,c=r.AspectHeight.value);var u=s/c,l=45;void 0!==r.FieldOfView&&(l=r.FieldOfView.value);var h=r.FocalLength?r.FocalLength.value:null;switch(i){case 0:n=new Mu(l,u,o,a),null!==h&&n.setFocalLength(h);break;case 1:n=new Cu(-s/2,s/2,c/2,-c/2,o,a);break;default:console.warn("FBXLoader: Unknown camera type "+i+"."),n=new ys}}return n}function ap(t,e){var n,r;if(e.children.forEach(function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(r=n)}),void 0===r)n=new ys;else{var i;i=void 0===r.LightType?0:r.LightType.value;var o=16777215;void 0!==r.Color&&(o=(new Ts).fromArray(r.Color.value));var a=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(a=0);var s=0;switch(void 0!==r.FarAttenuationEnd&&(s=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),i){case 0:n=new Nd(o,a,s,1);break;case 1:n=new Id(o,a);break;case 2:var c=Math.PI/3;void 0!==r.InnerAngle&&(c=os.degToRad(r.InnerAngle.value));var u=0;void 0!==r.OuterAngle&&(u=os.degToRad(r.OuterAngle.value),u=Math.max(u,1)),n=new Dd(o,a,s,c,u,1);break;default:console.warn("FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new Nd(o,a)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n}function sp(t,e,n,r){var i,o=null,a=null,s=[];return e.children.forEach(function(t){n.has(t.ID)&&(o=n.get(t.ID)),r.has(t.ID)&&s.push(r.get(t.ID))}),s.length>1?a=s:s.length>0?a=s[0]:(a=new Qu({color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach(function(t){t.vertexColors=dc}),o.FBX_Deformer?(s.forEach(function(t){t.skinning=!0}),i=new Td(o,a)):i=new Kc(o,a),i}function cp(t,e){return new $c(t.children.reduce(function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t},null),new qc({color:3342591,linewidth:1}))}function up(t,e,n){if("RotationOrder"in n){var r=parseInt(n.RotationOrder.value,10);r>0&&r<6?console.warn("FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"][r]):6===r&&console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in n&&e.position.fromArray(n.Lcl_Translation.value),"Lcl_Rotation"in n){var i=n.Lcl_Rotation.value.map(os.degToRad);i.push("ZYX"),e.quaternion.setFromEuler((new ls).fromArray(i))}if("Lcl_Scaling"in n&&e.scale.fromArray(n.Lcl_Scaling.value),"PreRotation"in n){var o=n.PreRotation.value.map(os.degToRad);o[3]="ZYX";var a=(new ls).fromArray(o);a=(new cs).setFromEuler(a),e.quaternion.premultiply(a)}}function lp(t){var e=[];return t.layer.forEach(function(t){e=e.concat(function(t){var e=[];if(void 0!==t.T&&Object.keys(t.T.curves).length>0){var n=hp(t.modelName,t.T.curves,t.initialPosition,"position");void 0!==n&&e.push(n)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var r=function(t,e,n,r){void 0!==e.x&&(e.x.values=e.x.values.map(os.degToRad)),void 0!==e.y&&(e.y.values=e.y.values.map(os.degToRad)),void 0!==e.z&&(e.z.values=e.z.values.map(os.degToRad));var i=pp(e),o=dp(i,e,n);void 0!==r&&((r=r.map(os.degToRad)).push("ZYX"),r=(new ls).fromArray(r),r=(new cs).setFromEuler(r));for(var a=new cs,s=new ls,c=[],u=0;u<o.length;u+=3)s.set(o[u],o[u+1],o[u+2],"ZYX"),a.setFromEuler(s),void 0!==r&&a.premultiply(r),a.toArray(c,u/3*4);return new pu(t+".quaternion",i,c)}(t.modelName,t.R.curves,t.initialRotation,t.preRotations);void 0!==r&&e.push(r)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var i=hp(t.modelName,t.S.curves,t.initialScale,"scale");void 0!==i&&e.push(i)}return e}(t))}),new _u(t.name,-1,e)}function hp(t,e,n,r){var i=pp(e);return new mu(t+"."+r,i,dp(i,e,n))}function dp(t,e,n){var r=n,i=[],o=-1,a=-1,s=-1;return t.forEach(function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==o){var n=e.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==a){var c=e.y.values[a];i.push(c),r[1]=c}else i.push(r[1]);if(-1!==s){var u=e.z.values[s];i.push(u),r[2]=u}else i.push(r[2])}),i}function pp(t){var e=[];return void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e.sort(function(t,e){return t-e}).filter(function(t,e,n){return n.indexOf(t)==e})}function fp(){}function mp(){}function vp(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function gp(){}function yp(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function bp(t){return t/46186158e3}function xp(t){return t.split(",").map(function(t){return parseFloat(t)})}function wp(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),ul.decodeText(new Uint8Array(t,e,n))}function _p(t,e,n,r){for(var i=n,o=0;i<r;i++,o++)t[o]=e[i];return t}Object.assign(fp.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new gp,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,n=t.split("\n");return n.forEach(function(t,r){var i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!i&&!o){var a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,n[++r]):c?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}}),this.allNodes},parseNodeBegin:function(t,e){var n=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map(function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in a?("PoseNode"===n?a.PoseNode.push(i):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=i)):"number"==typeof o.id?(a[n]={},a[n][o.id]=i):"Properties70"!==n&&(a[n]="PoseNode"===n?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var n="",r="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),r=t[2]),{id:e,name:n,type:r}},parseNodeProperty:function(t,e,n){var r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var a=i.split(",").slice(1),s=parseInt(a[0]),c=parseInt(a[1]),u=i.split(",").slice(3);r="connections",function(t,e){for(var n=0,r=t.length,i=e.length;n<i;n++,r++)t[r]=e[n]}(i=[s,c],u=u.map(function(t){return t.trim().replace(/^"/,"")})),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=xp(i))}else this.parseNodeSpecialProperty(t,r,i)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=xp(e.a))},parseNodeSpecialProperty:function(t,e,n){var r=n.split('",').map(function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=r[0],o=r[1],a=r[2],s=r[3],c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=xp(c)}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),i)}}),Object.assign(mp.prototype,{parse:function(t){var e=new vp(t);e.skip(23);var n=e.getUint32();console.log("FBXLoader: FBX binary version: "+n);for(var r=new gp;!this.endOfContent(e);){var i=this.parseNode(e,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var n={},r=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32(),o=(e>=7500?t.getUint64():t.getUint32(),t.getUint8()),a=t.getString(o);if(0===r)return null;for(var s=[],c=0;c<i;c++)s.push(this.parseProperty(t));var u=s.length>0?s[0]:"",l=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(n.singleProperty=1===i&&t.getOffset()===r;r>t.getOffset();){var d=this.parseNode(t,e);null!==d&&this.parseSubNode(a,n,d)}return n.propertyList=s,"number"==typeof u&&(n.id=u),""!==l&&(n.attrName=l),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n},parseSubNode:function(t,e,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(e[n.name]=n,n.a=r):e[n.name]=r}else if("Connections"===t&&"C"===n.name){var i=[];n.propertyList.forEach(function(t,e){0!==e&&i.push(t)}),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===n.name)Object.keys(n).forEach(function(t){e[t]=n[t]});else if("Properties70"===t&&"P"===n.name){var o,a=n.propertyList[0],s=n.propertyList[1],c=n.propertyList[2],u=n.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[a]={type:s,type2:c,flag:u,value:o}}else void 0===e[n.name]?"number"==typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var n=t.getUint32();return t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=t.getUint32(),i=t.getUint32(),o=t.getUint32();if(0===i)switch(e){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}void 0===window.Zlib&&console.error("FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new vp(new Zlib.Inflate(new Uint8Array(t.getArrayBuffer(o))).decompress().buffer);switch(e){case"b":case"c":return a.getBooleanArray(r);case"d":return a.getFloat64Array(r);case"f":return a.getFloat32Array(r);case"i":return a.getInt32Array(r);case"l":return a.getInt64Array(r)}default:throw new Error("FBXLoader: Unknown property type "+e)}}}),Object.assign(vp.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295==(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t},getInt64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=new Uint8Array(t),n=0;n<t;n++)e[n]=this.getUint8();var r=e.indexOf(0);return r>=0&&(e=e.slice(0,r)),ul.decodeText(e)}}),Object.assign(gp.prototype,{add:function(t,e){this[t]=e}});var Sp=function(t){this.manager=void 0!==t?t:Hu,this.splitLayer=!1};function Tp(t,e,n,r,i,o,a,s,c,u){Ou.call(this,t=void 0!==t?t:[],e=void 0!==e?e:bc,n,r,i,o,a,s,c,u),this.flipY=!1}Sp.prototype.load=function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(t))},n,r)},Sp.prototype.parse=function(t){var e={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},n=[],r=void 0,i=new qc({color:16711680});i.name="path";var o=new qc({color:65280});function a(t){n.push(r={vertex:[],pathVertex:[],z:t.z})}function s(t,n){return e.relative?n:n-t}function c(t,n){return e.relative?t+n:n}o.name="extruded";for(var u,l,h=t.replace(/;.+/g,"").split("\n"),d=0;d<h.length;d++){var p=h[d].split(" "),f=p[0].toUpperCase(),m={};if(p.splice(1).forEach(function(t){if(void 0!==t[0]){var e=t[0].toLowerCase(),n=parseFloat(t.substring(1));m[e]=n}}),"G0"===f||"G1"===f){var v={x:void 0!==m.x?c(e.x,m.x):e.x,y:void 0!==m.y?c(e.y,m.y):e.y,z:void 0!==m.z?c(e.z,m.z):e.z,e:void 0!==m.e?c(e.e,m.e):e.e,f:void 0!==m.f?c(e.f,m.f):e.f};s(e.e,v.e)>0&&(v.extruding=s(e.e,v.e)>0,void 0!=r&&v.z==r.z||a(v)),u=e,l=v,void 0===r&&a(u),v.extruding?(r.vertex.push(u.x,u.y,u.z),r.vertex.push(l.x,l.y,l.z)):(r.pathVertex.push(u.x,u.y,u.z),r.pathVertex.push(l.x,l.y,l.z)),e=v}else"G2"===f||"G3"===f?console.warn("GCodeLoader: Arc command not supported"):"G90"===f?e.relative=!1:"G91"===f?e.relative=!0:"G92"===f?((v=e).x=void 0!==m.x?m.x:v.x,v.y=void 0!==m.y?m.y:v.y,v.z=void 0!==m.z?m.z:v.z,v.e=void 0!==m.e?m.e:v.e,e=v):console.warn("GCodeLoader: Command not supported:"+f)}function g(t,e){var n=new Xs;n.addAttribute("position",new Vs(t,3));var r=new Bd(n,e?o:i);r.name="layer"+d,y.add(r)}var y=new gd;if(y.name="gcode",this.splitLayer)for(d=0;d<n.length;d++)g((w=n[d]).vertex,!0),g(w.pathVertex,!1);else{var b=[],x=[];for(d=0;d<n.length;d++){var w;b=b.concat((w=n[d]).vertex),x=x.concat(w.pathVertex)}g(b,!0),g(x,!1)}return y.quaternion.setFromEuler(new ls(-Math.PI/2,0,0)),y},function(){function t(t){this.manager=void 0!==t?t:Hu,this.dracoLoader=null}t.prototype={constructor:t,crossOrigin:"Anonymous",load:function(t,e,n,r){var i=this,o=void 0!==this.path?this.path:ul.extractUrlBase(t),a=new Xu(i.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){try{i.parse(t,o,e,r)}catch(t){if(void 0===r)throw t;r(t)}},n,r)},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setDRACOLoader:function(t){return this.dracoLoader=t,this},parse:function(t,s,c,u){var l,h={};if("string"==typeof t)l=t;else if(ul.decodeText(new Uint8Array(t,0,4))===r){try{h[e.KHR_BINARY_GLTF]=new function(t){this.name=e.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,i);if(this.header={magic:ul.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==r)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var a=new DataView(t,i),s=0;s<a.byteLength;){var c=a.getUint32(s,!0),u=a.getUint32(s+=4,!0);if(s+=4,u===o.JSON){var l=new Uint8Array(t,i+s,c);this.content=ul.decodeText(l)}else if(u===o.BIN){var h=i+s;this.body=t.slice(h,h+c)}s+=c}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")}(t)}catch(t){return void(u&&u(t))}l=h[e.KHR_BINARY_GLTF].content}else l=ul.decodeText(new Uint8Array(t));var d=JSON.parse(l);void 0===d.asset||d.asset.version[0]<2?u&&u(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")):(d.extensionsUsed&&(d.extensionsUsed.indexOf(e.KHR_LIGHTS)>=0&&(h[e.KHR_LIGHTS]=new function(t){this.name=e.KHR_LIGHTS,this.lights={};var n=(t.extensions&&t.extensions[e.KHR_LIGHTS]||{}).lights||{};for(var r in n){var i,o=n[r],a=(new Ts).fromArray(o.color);switch(o.type){case"directional":(i=new Id(a)).position.set(0,0,1);break;case"point":i=new Nd(a);break;case"spot":(i=new Dd(a)).position.set(0,0,1);break;case"ambient":i=new jd(a)}i&&(void 0!==o.constantAttenuation&&(i.intensity=o.constantAttenuation),void 0!==o.linearAttenuation&&(i.distance=1/o.linearAttenuation),void 0!==o.quadraticAttenuation&&(i.decay=o.quadraticAttenuation),void 0!==o.fallOffAngle&&(i.angle=o.fallOffAngle),void 0!==o.fallOffExponent&&console.warn("GLTFLoader:: light.fallOffExponent not currently supported."),i.name=o.name||"light_"+r,this.lights[r]=i)}}(d)),d.extensionsUsed.indexOf(e.KHR_MATERIALS_UNLIT)>=0&&(h[e.KHR_MATERIALS_UNLIT]=new n(d)),d.extensionsUsed.indexOf(e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(h[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new function(){return{name:e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return Iu},extendParams:function(t,e,n){var r=e.extensions[this.name],i=Ih.standard,o=Lu.clone(i.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),c=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=i.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",c).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",l);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new Ts).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},t.vertexShader=i.vertexShader,t.fragmentShader=h,t.uniforms=o,t.defines={STANDARD:""},t.color=new Ts(1,1,1),t.opacity=1;var d=[];if(Array.isArray(r.diffuseFactor)){var p=r.diffuseFactor;t.color.fromArray(p),t.opacity=p[3]}if(void 0!==r.diffuseTexture&&d.push(n.assignTexture(t,"map",r.diffuseTexture.index)),t.emissive=new Ts(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new Ts(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var f=r.specularGlossinessTexture.index;d.push(n.assignTexture(t,"glossinessMap",f)),d.push(n.assignTexture(t,"specularMap",f))}return Promise.all(d)},createMaterial:function(t){var e=new Iu({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return e.isGLTFSpecularGlossinessMaterial=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e.extensions.derivatives=!0,e},cloneMaterial:function(t){var e=t.clone();e.isGLTFSpecularGlossinessMaterial=!0;for(var n=this.specularGlossinessParams,r=0,i=n.length;r<i;r++)e[n[r]]=t[n[r]];return e},refreshUniforms:function(t,e,n,r,i,o){if(!0===i.isGLTFSpecularGlossinessMaterial){var a,s,c,u=i.uniforms,l=i.defines;if(u.opacity.value=i.opacity,u.diffuse.value.copy(i.color),u.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),u.map.value=i.map,u.specularMap.value=i.specularMap,u.alphaMap.value=i.alphaMap,u.lightMap.value=i.lightMap,u.lightMapIntensity.value=i.lightMapIntensity,u.aoMap.value=i.aoMap,u.aoMapIntensity.value=i.aoMapIntensity,i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.glossinessMap?a=i.glossinessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap&&(a=i.emissiveMap),void 0!==a)if(a.isWebGLRenderTarget&&(a=a.texture),void 0!==a.matrix){if(!0===a.matrixAutoUpdate){var h=a.center;a.matrix.setUvTransform((s=a.offset).x,s.y,(c=a.repeat).x,c.y,a.rotation,h.x,h.y)}u.uvTransform.value.copy(a.matrix)}else u.offsetRepeat.value.set((s=a.offset).x,s.y,(c=a.repeat).x,c.y);u.envMap.value=i.envMap,u.envMapIntensity.value=i.envMapIntensity,u.flipEnvMap.value=i.envMap&&i.envMap.isCubeTexture?-1:1,u.refractionRatio.value=i.refractionRatio,u.specular.value.copy(i.specular),u.glossiness.value=i.glossiness,u.glossinessMap.value=i.glossinessMap,u.emissiveMap.value=i.emissiveMap,u.bumpMap.value=i.bumpMap,u.normalMap.value=i.normalMap,u.displacementMap.value=i.displacementMap,u.displacementScale.value=i.displacementScale,u.displacementBias.value=i.displacementBias,null!==u.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===u.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}),d.extensionsUsed.indexOf(e.KHR_DRACO_MESH_COMPRESSION)>=0&&(h[e.KHR_DRACO_MESH_COMPRESSION]=new a(this.dracoLoader))),console.time("GLTFLoader"),new _(d,h,{path:s||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(t,e,n,r,i){console.timeEnd("GLTFLoader"),c({scene:t,scenes:e,cameras:n,animations:r,asset:i})},u))}};var e={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit"};function n(t){this.name=e.KHR_MATERIALS_UNLIT}n.prototype.getMaterialType=function(t){return Xc},n.prototype.extendParams=function(t,e,n){var r=[];t.color=new Ts(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(t,"map",i.baseColorTexture.index))}return Promise.all(r)};var r="glTF",i=12,o={JSON:1313821514,BIN:5130562};function a(t){if(!t)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=e.KHR_DRACO_MESH_COMPRESSION,this.dracoLoader=t}function s(t,e,n,r){hu.call(this,t,e,n,r)}a.prototype.decodePrimitive=function(t,e){var n=this.dracoLoader,r=t.extensions[this.name].bufferView,i=t.extensions[this.name].attributes,o={};for(var a in i)a in f&&(o[f[a]]=i[a]);return e.getDependency("bufferView",r).then(function(t){return new Promise(function(e){n.decodeDracoFile(t,e,o)})})},(s.prototype=Object.create(hu.prototype)).constructor=s,s.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,c=3*a,u=r-e,l=(n-e)/u,h=l*l,d=h*l,p=t*c,f=p-c,m=2*d-3*h+1,v=d-2*h+l,g=-2*d+3*h,y=d-h,b=0;b!==a;b++)i[b]=m*o[f+b+a]+v*(o[f+b+s]*u)+g*o[p+b+a]+y*(o[p+b]*u);return i};var c={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},u={9728:Mc,9729:Ac,9984:1004,9985:1007,9986:1005,9987:Ec},l={33071:Sc,33648:Tc,10497:_c},h={6406:1021,6407:Nc,6408:Lc,6409:1024,6410:1025},d={5121:Cc,32819:1017,32820:1018,33635:1019},p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},f={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},m={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},v={CUBICSPLINE:2302,LINEAR:2301,STEP:Uc};function g(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:/^blob:.*$/i.test(t)?t:e+t}function y(t,e,n,r){var i=t.geometry,o=t.material,a=n.targets,s=i.morphAttributes;s.position=[],s.normal=[],o.morphTargets=!0;for(var c=0,u=a.length;c<u;c++){var l,h,d=a[c],p="morphTarget"+c;if(void 0!==d.POSITION){l=w(r[d.POSITION]);for(var f=i.attributes.position,m=0,v=l.count;m<v;m++)l.setXYZ(m,l.getX(m)+f.getX(m),l.getY(m)+f.getY(m),l.getZ(m)+f.getZ(m))}else i.attributes.position&&(l=w(i.attributes.position));if(void 0!==l&&(l.name=p,s.position.push(l)),void 0!==d.NORMAL){o.morphNormals=!0,h=w(r[d.NORMAL]);var g=i.attributes.normal;for(m=0,v=h.count;m<v;m++)h.setXYZ(m,h.getX(m)+g.getX(m),h.getY(m)+g.getY(m),h.getZ(m)+g.getZ(m))}else void 0!==i.attributes.normal&&(h=w(i.attributes.normal));void 0!==h&&(h.name=p,s.normal.push(h))}if(t.updateMorphTargets(),void 0!==e.weights)for(c=0,u=e.weights.length;c<u;c++)t.morphTargetInfluences[c]=e.weights[c];if(e.extras&&Array.isArray(e.extras.targetNames))for(c=0,u=e.extras.targetNames.length;c<u;c++)t.morphTargetDictionary[e.extras.targetNames[c]]=c}function b(t,e){if(t.indices!==e.indices)return!1;var n=t.attributes||{},r=e.attributes||{},i=Object.keys(n),o=Object.keys(r);if(i.length!==o.length)return!1;for(var a=0,s=i.length;a<s;a++){var c=i[a];if(n[c]!==r[c])return!1}return!0}function x(t,e){for(var n=0,r=t.length;n<r;n++){var i=t[n];if(b(i.primitive,e))return i.promise}return null}function w(t){if(t.isInterleavedBufferAttribute){for(var e=t.count,n=t.itemSize,r=t.array.slice(0,e*n),i=0;i<e;++i)r[i]=t.getX(i),n>=2&&(r[i+1]=t.getY(i)),n>=3&&(r[i+2]=t.getZ(i)),n>=4&&(r[i+3]=t.getW(i));return new Rs(r,n,t.normalized)}return t.clone()}function _(t,e,n){this.json=t||{},this.extensions=e||{},this.options=n||{},this.cache=new function(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}},this.primitiveCache=[],this.textureLoader=new sl(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new Xu(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function S(t,e,n){var r=e.attributes;for(var i in r){var o=f[i];o&&(o in t.attributes||t.addAttribute(o,n[r[i]]))}void 0===e.indices||t.index||t.setIndex(n[e.indices])}_.prototype.parse=function(t,e){var n=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(e){var r=e.scenes||[];t(r[n.scene||0],r,e.cameras||[],e.animations||[],n.asset)}).catch(e)},_.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r={},i={},o=0,a=e.length;o<a;o++)for(var s=e[o].joints,c=0,u=s.length;c<u;c++)t[s[c]].isBone=!0;for(var l=0,h=t.length;l<h;l++){var d=t[l];void 0!==d.mesh&&(void 0===r[d.mesh]&&(r[d.mesh]=i[d.mesh]=0),r[d.mesh]++,void 0!==d.skin&&(n[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=i},_.prototype.getDependency=function(t,e){var n=t+":"+e,r=this.cache.get(n);return r||(r=this["load"+t.charAt(0).toUpperCase()+t.slice(1)](e),this.cache.add(n,r)),r},_.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this;e=Promise.all((this.json[t+("mesh"===t?"es":"s")]||[]).map(function(e,r){return n.getDependency(t,r)})),this.cache.add(t,e)}return e},_.prototype.getMultiDependencies=function(t){for(var e={},n=[],r=0,i=t.length;r<i;r++){var o=t[r],a=this.getDependencies(o);a=a.then((function(t,n){e[t]=n}).bind(this,o+("mesh"===o?"es":"s"))),n.push(a)}return Promise.all(n).then(function(){return e})},_.prototype.loadBuffer=function(t){var n=this.json.buffers[t],r=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===t)return Promise.resolve(this.extensions[e.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(t,e){r.load(g(n.uri,i.path),t,void 0,function(){e(new Error('GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})},_.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){var n=e.byteOffset||0;return t.slice(n,n+(e.byteLength||0))})},_.prototype.loadAccessor=function(t){var e=this,n=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return null;var i=[];return i.push(void 0!==r.bufferView?this.getDependency("bufferView",r.bufferView):null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(t){var i,o=t[0],a=p[r.type],s=c[r.componentType],u=s.BYTES_PER_ELEMENT,l=r.byteOffset||0,h=n.bufferViews[r.bufferView].byteStride,d=!0===r.normalized;if(h&&h!==u*a){var f="InterleavedBuffer:"+r.bufferView+":"+r.componentType,m=e.cache.get(f);m||(m=new ad(new s(o),h/u),e.cache.add(f,m)),i=new cd(m,a,l/u,d)}else i=new Rs(null===o?new s(r.count*a):new s(o,l,r.count*a),a,d);if(void 0!==r.sparse){var v=r.sparse.values.byteOffset||0,g=new(0,c[r.sparse.indices.componentType])(t[1],r.sparse.indices.byteOffset||0,r.sparse.count*p.SCALAR),y=new s(t[2],v,r.sparse.count*a);null!==o&&i.setArray(i.array.slice());for(var b=0,x=g.length;b<x;b++){var w=g[b];if(i.setX(w,y[b*a]),a>=2&&i.setY(w,y[b*a+1]),a>=3&&i.setZ(w,y[b*a+2]),a>=4&&i.setW(w,y[b*a+3]),a>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},_.prototype.loadTexture=function(t){var e=this.json,n=this.options,r=this.textureLoader,i=window.URL||window.webkitURL,o=e.textures[t],a=e.images[o.source],s=a.uri,c=!1;return void 0!==a.bufferView&&(s=this.getDependency("bufferView",a.bufferView).then(function(t){c=!0;var e=new Blob([t],{type:a.mimeType});return s=i.createObjectURL(e)})),Promise.resolve(s).then(function(t){var e=cl.Handlers.get(t)||r;return new Promise(function(r,i){e.load(g(t,n.path),r,void 0,i)})}).then(function(t){!0===c&&i.revokeObjectURL(s),t.flipY=!1,void 0!==o.name&&(t.name=o.name),t.format=void 0!==o.format?h[o.format]:Lc,void 0!==o.internalFormat&&t.format!==h[o.internalFormat]&&console.warn("GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==o.type?d[o.type]:Cc;var n=(e.samplers||{})[o.sampler]||{};return t.magFilter=u[n.magFilter]||Ac,t.minFilter=u[n.minFilter]||Ec,t.wrapS=l[n.wrapS]||_c,t.wrapT=l[n.wrapT]||_c,t})},_.prototype.assignTexture=function(t,e,n){return this.getDependency("texture",n).then(function(n){t[e]=n})},_.prototype.loadMaterial=function(t){var n,r=this.extensions,i=this.json.materials[t],o={},a=i.extensions||{},s=[];if(a[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=r[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];n=c.getMaterialType(i),s.push(c.extendParams(o,i,this))}else if(a[e.KHR_MATERIALS_UNLIT]){var u=r[e.KHR_MATERIALS_UNLIT];n=u.getMaterialType(i),s.push(u.extendParams(o,i,this))}else if(void 0!==i.pbrMetallicRoughness){n=Ku;var l=i.pbrMetallicRoughness;if(o.color=new Ts(1,1,1),o.opacity=1,Array.isArray(l.baseColorFactor)){var h=l.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}if(void 0!==l.baseColorTexture&&s.push(this.assignTexture(o,"map",l.baseColorTexture.index)),o.metalness=void 0!==l.metallicFactor?l.metallicFactor:1,o.roughness=void 0!==l.roughnessFactor?l.roughnessFactor:1,void 0!==l.metallicRoughnessTexture){var d=l.metallicRoughnessTexture.index;s.push(this.assignTexture(o,"metalnessMap",d)),s.push(this.assignTexture(o,"roughnessMap",d))}}else n=Qu;!0===i.doubleSided&&(o.side=uc);var p=i.alphaMode||"OPAQUE";return"BLEND"===p?o.transparent=!0:(o.transparent=!1,"MASK"===p&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&n!==Xc&&(s.push(this.assignTexture(o,"normalMap",i.normalTexture.index)),o.normalScale=new Cs(1,1),void 0!==i.normalTexture.scale&&o.normalScale.set(i.normalTexture.scale,i.normalTexture.scale)),void 0!==i.occlusionTexture&&n!==Xc&&(s.push(this.assignTexture(o,"aoMap",i.occlusionTexture.index)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&n!==Xc&&(o.emissive=(new Ts).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&n!==Xc&&s.push(this.assignTexture(o,"emissiveMap",i.emissiveTexture.index)),Promise.all(s).then(function(){var t;return t=n===Iu?r[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new n(o),void 0!==i.name&&(t.name=i.name),t.normalScale&&(t.normalScale.x=-t.normalScale.x),t.map&&(t.map.encoding=3001),t.emissiveMap&&(t.emissiveMap.encoding=3001),i.extras&&(t.userData=i.extras),t})},_.prototype.loadGeometries=function(t){var n=this,r=this.extensions,i=this.primitiveCache;return this.getDependencies("accessor").then(function(o){for(var a=[],s=[],c=0,u=t.length;c<u;c++){var l,h=t[c],d=x(i,h);if(d)s.push(d.then(function(t){a.push(t)}));else if(h.extensions&&h.extensions[e.KHR_DRACO_MESH_COMPRESSION]){var p=r[e.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(h,n).then(function(t){return S(t,h,o),a.push(t),t});i.push({primitive:h,promise:p}),s.push(p)}else S(l=new Xs,h,o),i.push({primitive:h,promise:Promise.resolve(l)}),a.push(l)}return Promise.all(s).then(function(){return a})})},_.prototype.loadMesh=function(t){var n=this,r=this.extensions,i=this.json.meshes[t];return this.getMultiDependencies(["accessor","material"]).then(function(o){var a=new gd,s=i.primitives;return n.loadGeometries(s).then(function(c){for(var u=0,l=s.length;u<l;u++){var h=s[u],d=c[u],p=void 0===h.material?new Ku({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:sc}):o.materials[h.material];p.aoMap&&void 0===d.attributes.uv2&&void 0!==d.attributes.uv&&(console.log("GLTFLoader: Duplicating UVs to support aoMap."),d.addAttribute("uv2",new Rs(d.attributes.uv.array,2)));var f,m=void 0!==d.attributes.color,v=void 0===d.attributes.normal,g=!0===i.isSkinnedMesh,b=void 0!==h.targets;if((m||v||g||b)&&(p=p.isGLTFSpecularGlossinessMaterial?r[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(p):p.clone()),m&&(p.vertexColors=dc,p.needsUpdate=!0),v&&(p.flatShading=!0),4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)g?(f=new Td(d,p),p.skinning=!0):f=new Kc(d,p),5===h.mode?f.drawMode=Bc:6===h.mode&&(f.drawMode=zc);else if(1===h.mode||3===h.mode||2===h.mode){var x=n.cache.get(w="LineBasicMaterial:"+p.uuid);x||(x=new qc,Wc.prototype.copy.call(x,p),x.color.copy(p.color),x.lights=!1,n.cache.add(w,x)),p=x,f=1===h.mode?new Bd(d,p):3===h.mode?new $c(d,p):new Wd(d,p)}else{if(0!==h.mode)throw new Error("GLTFLoader: Primitive mode unsupported: "+h.mode);var w,_=n.cache.get(w="PointsMaterial:"+p.uuid);_||(_=new el,Wc.prototype.copy.call(_,p),_.color.copy(p.color),_.map=p.map,_.lights=!1,n.cache.add(w,_)),f=new Zh(d,p=_)}if(f.name=i.name||"mesh_"+t,b&&y(f,i,h,o.accessors),void 0!==i.extras&&(f.userData=i.extras),void 0!==h.extras&&(f.geometry.userData=h.extras),!0===p.isGLTFSpecularGlossinessMaterial&&(f.onBeforeRender=r[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),!(s.length>1))return f;f.name+="_"+u,a.add(f)}return a})})},_.prototype.loadCamera=function(t){var e,n=this.json.cameras[t],r=n[n.type];if(r){if("perspective"===n.type){var i=r.aspectRatio||1;e=new Mu(os.radToDeg(r.yfov*i),i,r.znear||1,r.zfar||2e6)}else"orthographic"===n.type&&(e=new Cu(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar));return void 0!==n.name&&(e.name=n.name),n.extras&&(e.userData=n.extras),Promise.resolve(e)}console.warn("GLTFLoader: Missing camera parameters.")},_.prototype.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then(function(t){return n.inverseBindMatrices=t,n})},_.prototype.loadAnimation=function(t){var e=this.json.animations[t];return this.getMultiDependencies(["accessor","node"]).then(function(n){for(var r=[],i=0,o=e.channels.length;i<o;i++){var a=e.channels[i],c=e.samplers[a.sampler];if(c){var u=a.target,l=void 0!==u.node?u.node:u.id,h=n.accessors[void 0!==e.parameters?e.parameters[c.input]:c.input],d=n.accessors[void 0!==e.parameters?e.parameters[c.output]:c.output],p=n.nodes[l];if(p){var f;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,m[u.path]){case m.weights:f=wu;break;case m.rotation:f=pu;break;case m.position:case m.scale:default:f=mu}var g=p.name?p.name:p.uuid,y=void 0!==c.interpolation?v[c.interpolation]:2301,b=[];m[u.path]===m.weights?p.traverse(function(t){!0===t.isMesh&&!0===t.material.morphTargets&&b.push(t.name?t.name:t.uuid)}):b.push(g);for(var x=0,w=b.length;x<w;x++){var _=new f(b[x]+"."+m[u.path],bu.arraySlice(h.array,0),bu.arraySlice(d.array,0),y);"CUBICSPLINE"===c.interpolation&&(_.createInterpolant=function(t){return new s(this.times,this.values,this.getValueSize()/3,t)},_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),r.push(_)}}}}return new _u(l=void 0!==e.name?e.name:"animation_"+t,void 0,r)})},_.prototype.loadNode=function(t){var n=this.extensions,r=this.json.meshReferences,i=this.json.meshUses,o=this.json.nodes[t];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(t){var a;if(!0===o.isBone)a=new nu;else if(void 0!==o.mesh){var s=t.meshes[o.mesh];if(a=s.clone(),!0===s.isGroup)for(var c=0,u=s.children.length;c<u;c++){var l=s.children[c];l.material&&!0===l.material.isGLTFSpecularGlossinessMaterial&&(a.children[c].onBeforeRender=l.onBeforeRender)}else s.material&&!0===s.material.isGLTFSpecularGlossinessMaterial&&(a.onBeforeRender=s.onBeforeRender);r[o.mesh]>1&&(a.name+="_instance_"+i[o.mesh]++)}else a=void 0!==o.camera?t.cameras[o.camera]:o.extensions&&o.extensions[e.KHR_LIGHTS]&&void 0!==o.extensions[e.KHR_LIGHTS].light?n[e.KHR_LIGHTS].lights[o.extensions[e.KHR_LIGHTS].light]:new ys;if(void 0!==o.name&&(a.name=Dh.sanitizeNodeName(o.name)),o.extras&&(a.userData=o.extras),void 0!==o.matrix){var h=new as;h.fromArray(o.matrix),a.applyMatrix(h)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return a})},_.prototype.loadScene=function(){function t(e,n,r,i,o){var a=i[e],s=r.nodes[e];if(void 0!==s.skin)for(var c=!0===a.isGroup?a.children:[a],u=0,l=c.length;u<l;u++){for(var h=c[u],d=o[s.skin],p=[],f=[],m=0,v=d.joints.length;m<v;m++){var g=d.joints[m],y=i[g];if(y){p.push(y);var b=new as;void 0!==d.inverseBindMatrices&&b.fromArray(d.inverseBindMatrices.array,16*m),f.push(b)}else console.warn('GLTFLoader: Joint "%s" could not be found.',g)}h.bind(new Sd(p,f),h.matrixWorld)}if(n.add(a),s.children){var x=s.children;for(u=0,l=x.length;u<l;u++)t(x[u],a,r,i,o)}}return function(n){var r=this.json,i=this.extensions,o=this.json.scenes[n];return this.getMultiDependencies(["node","skin"]).then(function(n){var a=new Eu;void 0!==o.name&&(a.name=o.name),o.extras&&(a.userData=o.extras);for(var s=o.nodes||[],c=0,u=s.length;c<u;c++)t(s[c],a,r,n.nodes,n.skins);return o.extensions&&o.extensions[e.KHR_LIGHTS]&&void 0!==o.extensions[e.KHR_LIGHTS].light&&a.add(i[e.KHR_LIGHTS].lights[o.extensions[e.KHR_LIGHTS].light]),a})}}()}(),((function(t){this.manager=void 0!==t?t:Hu}).prototype=Object.create(qd.prototype))._parser=function(t){var e=function(t,e){switch(t){case 1:console.error("RGBELoader Read Error: "+(e||""));break;case 2:console.error("RGBELoader Write Error: "+(e||""));break;case 3:console.error("RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("RGBELoader: Error: "+(e||""))}return-1},n=function(t,e,n){e=e||1024;for(var r=t.pos,i=-1,o=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(t.subarray(r,r+128)));0>(i=s.indexOf("\n"))&&o<e&&r<t.byteLength;)a+=s,o+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(r,r+128)));return-1<i&&(!1!==n&&(t.pos+=o+i+1),a+s.slice(0,i))},r=new Uint8Array(t);r.pos=0;var i=function(t){var r,i,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,c=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(t.pos>=t.byteLength||!(r=n(t)))return e(1,"no header found");if(!(i=r.match(/^#\?(\S+)$/)))return e(3,"bad initial token");for(u.valid|=1,u.programtype=i[1],u.string+=r+"\n";!1!==(r=n(t));)if(u.string+=r+"\n","#"!==r.charAt(0)){if((i=r.match(o))&&(u.gamma=parseFloat(i[1],10)),(i=r.match(a))&&(u.exposure=parseFloat(i[1],10)),(i=r.match(s))&&(u.valid|=2,u.format=i[1]),(i=r.match(c))&&(u.valid|=4,u.height=parseInt(i[1],10),u.width=parseInt(i[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=r+"\n";return 2&u.valid?4&u.valid?u:e(3,"missing image size specifier"):e(3,"missing format specifier")}(r);if(-1!==i){var o=i.width,a=i.height,s=function(t,n,r){var i,o,a,s,c,u,l,h,d,p,f,m,v,g=n,y=r;if(g<8||g>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(g!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");if(!(i=new Uint8Array(4*n*r))||!i.length)return e(4,"unable to allocate buffer space");for(o=0,a=0,h=4*g,v=new Uint8Array(4),u=new Uint8Array(h);y>0&&a<t.byteLength;){if(a+4>t.byteLength)return e(1);if(v[0]=t[a++],v[1]=t[a++],v[2]=t[a++],v[3]=t[a++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return e(3,"bad rgbe scanline format");for(l=0;l<h&&a<t.byteLength;){if((m=(s=t[a++])>128)&&(s-=128),0===s||l+s>h)return e(3,"bad scanline data");if(m)for(c=t[a++],d=0;d<s;d++)u[l++]=c;else u.set(t.subarray(a,a+s),l),l+=s,a+=s}for(p=g,d=0;d<p;d++)i[o]=u[d+(f=0)],i[o+1]=u[d+(f+=g)],i[o+2]=u[d+(f+=g)],i[o+3]=u[d+(f+=g)],o+=4;y--}return i}(r.subarray(r.pos),o,a);if(-1!==s)return{width:o,height:a,data:s,header:i.string,gamma:i.gamma,exposure:i.exposure,format:Ic,type:Cc}}return null},(Tp.prototype=Object.create(Ou.prototype)).constructor=Tp,Tp.prototype.isCubeTexture=!0,Object.defineProperty(Tp.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var Mp=function(t){this.manager=void 0!==t?t:Hu};Mp.prototype={constructor:Mp,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){var e=new JSZip(t);function n(t){var n=decodeURI(t.init_from);n=n.replace("../","");var r=new RegExp(n+"$"),i=e.file(r);if(i.length){var o=new Blob([i[0].asArrayBuffer()],{type:"application/octet-binary"});t.build.src=URL.createObjectURL(o)}}var r=e.file(/dae$/i);if(r.length){var i=r[0],o=(new zd).parse(i.asText()),a=o.library.images;for(var s in a)n(a[s]);return o}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new gd}}};var Ap=function(){this._parser=Ap.parse};Ap.prototype=Object.create(Gd.prototype),Ap.prototype.constructor=Ap,Ap.parse=function(t,e){var n=new Ep(t,1);return{mipmaps:n.mipmaps(e),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:6===n.numberOfFaces,mipmapCount:n.numberOfMipmapLevels}};var Ep=function(){function t(e,n,r,i){this.arrayBuffer=e;var o=new Uint8Array(this.arrayBuffer,0,12);if(171===o[0]&&75===o[1]&&84===o[2]&&88===o[3]&&32===o[4]&&49===o[5]&&49===o[6]&&187===o[7]&&13===o[8]&&10===o[9]&&26===o[10]&&10===o[11]){var a=new Int32Array(this.arrayBuffer,12,13),s=16909060===a[0];this.glType=s?this.switchEndainness(a[1]):a[1],this.glTypeSize=s?this.switchEndainness(a[2]):a[2],this.glFormat=s?this.switchEndainness(a[3]):a[3],this.glInternalFormat=s?this.switchEndainness(a[4]):a[4],this.glBaseInternalFormat=s?this.switchEndainness(a[5]):a[5],this.pixelWidth=s?this.switchEndainness(a[6]):a[6],this.pixelHeight=s?this.switchEndainness(a[7]):a[7],this.pixelDepth=s?this.switchEndainness(a[8]):a[8],this.numberOfArrayElements=s?this.switchEndainness(a[9]):a[9],this.numberOfFaces=s?this.switchEndainness(a[10]):a[10],this.numberOfMipmapLevels=s?this.switchEndainness(a[11]):a[11],this.bytesOfKeyValueData=s?this.switchEndainness(a[12]):a[12],0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===n?this.loadType=t.COMPRESSED_2D:console.warn("number of faces expected"+n+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}else console.error("texture missing KTX identifier")}return t.prototype.switchEndainness=function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255},t.prototype.mipmaps=function(e){for(var n=[],r=t.HEADER_LEN+this.bytesOfKeyValueData,i=this.pixelWidth,o=this.pixelHeight,a=e?this.numberOfMipmapLevels:1,s=0;s<a;s++){for(var c=new Int32Array(this.arrayBuffer,r,1)[0],u=0;u<this.numberOfFaces;u++){var l=new Uint8Array(this.arrayBuffer,r+4,c);n.push({data:l,width:i,height:o}),r+=c+4,r+=3-(c+3)%4}i=Math.max(1,.5*i),o=Math.max(1,.5*o)}return n},t.HEADER_LEN=64,t.COMPRESSED_2D=0,t.COMPRESSED_3D=1,t.TEX_2D=2,t.TEX_3D=3,t}(),Cp={Validator:{isValid:function(t){return null!==t&&void 0!==t},verifyInput:function(t,e){return null===t||void 0===t?e:t}}};Cp.Callbacks=function(){var t=Cp.Validator;function e(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}return e.prototype.setCallbackOnProgress=function(e){this.onProgress=t.verifyInput(e,this.onProgress)},e.prototype.setCallbackOnMeshAlter=function(e){this.onMeshAlter=t.verifyInput(e,this.onMeshAlter)},e.prototype.setCallbackOnLoad=function(e){this.onLoad=t.verifyInput(e,this.onLoad)},e.prototype.setCallbackOnLoadMaterials=function(e){this.onLoadMaterials=t.verifyInput(e,this.onLoadMaterials)},e}(),Cp.LoadedMeshUserOverride=function(){function t(t,e){this.disregardMesh=!0===t,this.alteredMesh=!0===e,this.meshes=[]}return t.prototype.addMesh=function(t){this.meshes.push(t),this.alteredMesh=!0},t.prototype.isDisregardMesh=function(){return this.disregardMesh},t.prototype.providesAlteredMeshes=function(){return this.alteredMesh},t}(),Cp.ResourceDescriptor=function(){var t=Cp.Validator;function e(e,n){var r=e.split("/");r.length<2?(this.path=null,this.name=e,this.url=e):(this.path=t.verifyInput(r.slice(0,r.length-1).join("/")+"/",null),this.name=t.verifyInput(r[r.length-1],null),this.url=e),this.extension=t.verifyInput(n,"default"),this.extension=this.extension.trim(),this.content=null}return e.prototype.setContent=function(e){this.content=t.verifyInput(e,null)},e}(),Cp.PrepData=function(){var t=Cp.Validator;function e(e){this.logging={enabled:!0,debug:!1},this.modelName=t.verifyInput(e,""),this.resources=[],this.callbacks=new Cp.Callbacks}return e.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},e.prototype.getCallbacks=function(){return this.callbacks},e.prototype.addResource=function(t){this.resources.push(t)},e.prototype.clone=function(){var t,e,n=new Cp.PrepData(this.modelName);for(t in n.logging.enabled=this.logging.enabled,n.logging.debug=this.logging.debug,n.resources=this.resources,n.callbacks=this.callbacks,this)e=this[t],n.hasOwnProperty(t)||"function"==typeof this[t]||(n[t]=e);return n},e.prototype.checkResourceDescriptorFiles=function(e,n){var r,i,o,a,s={};for(var c in e)if(a=!1,t.isValid((r=e[c]).name))if(t.isValid(r.content)){for(o=0;o<n.length&&!a;o++)if(i=n[o],r.extension.toLowerCase()===i.ext.toLowerCase())if(i.ignore)a=!0;else if("ArrayBuffer"===i.type){if(!(r.content instanceof ArrayBuffer||r.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";s[i.ext]=r,a=!0}else if("String"===i.type){if(!("string"==typeof r.content||r.content instanceof String))throw"Provided  content is not of type String! Aborting...";s[i.ext]=r,a=!0}if(!a)throw'Unidentified resource "'+r.name+'": '+r.url}else{if(!("string"==typeof r.name||r.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(o=0;o<n.length&&!a;o++)i=n[o],r.extension.toLowerCase()===i.ext.toLowerCase()&&(i.ignore||(s[i.ext]=r),a=!0);if(!a)throw'Unidentified resource "'+r.name+'": '+r.url}return s},e}(),Cp.MeshBuilder=function(){var t="1.2.0",e=Cp.Validator;function n(){console.info("Using LoaderSupport.MeshBuilder version: "+t),this.logging={enabled:!0,debug:!1},this.callbacks=new Cp.Callbacks,this.materials=[]}return n.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},n.prototype.init=function(){var t=new Ku({color:14479871});t.name="defaultMaterial";var e=new Ku({color:14479871});e.name="defaultVertexColorMaterial",e.vertexColors=dc;var n=new qc;n.name="defaultLineMaterial";var r=new el({size:1});r.name="defaultPointMaterial";var i={};i[t.name]=t,i[e.name]=e,i[n.name]=n,i[r.name]=r,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:i}})},n.prototype.setMaterials=function(t){var n={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:e.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(t):t}};this.updateMaterials(n)},n.prototype._setCallbacks=function(t){e.isValid(t.onProgress)&&this.callbacks.setCallbackOnProgress(t.onProgress),e.isValid(t.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(t.onMeshAlter),e.isValid(t.onLoad)&&this.callbacks.setCallbackOnLoad(t.onLoad),e.isValid(t.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(t.onLoadMaterials)},n.prototype.processPayload=function(t){return"meshData"===t.cmd?this.buildMeshes(t):"materialData"===t.cmd?(this.updateMaterials(t),null):void 0},n.prototype.buildMeshes=function(t){var n,r,i=t.params.meshName,o=new Xs;o.addAttribute("position",new Rs(new Float32Array(t.buffers.vertices),3)),e.isValid(t.buffers.indices)&&o.setIndex(new Rs(new Uint32Array(t.buffers.indices),1)),e.isValid(t.buffers.colors)&&o.addAttribute("color",new Rs(new Float32Array(t.buffers.colors),3)),e.isValid(t.buffers.normals)?o.addAttribute("normal",new Rs(new Float32Array(t.buffers.normals),3)):o.computeVertexNormals(),e.isValid(t.buffers.uvs)&&o.addAttribute("uv",new Rs(new Float32Array(t.buffers.uvs),2));var a=t.materials.materialNames,s=t.materials.multiMaterial,c=[];for(r in a)n=this.materials[a[r]],s&&c.push(n);if(s){n=c;var u,l=t.materials.materialGroups;for(r in l)o.addGroup((u=l[r]).start,u.count,u.index)}var h,d,p,f=[],m=this.callbacks.onMeshAlter,v=!0,g=e.verifyInput(t.geometryType,0);if(e.isValid(m)&&(d=m({detail:{meshName:i,bufferGeometry:o,material:n,geometryType:g}}),e.isValid(d))){if(!d.isDisregardMesh()&&d.providesAlteredMeshes())for(var y in d.meshes)f.push(d.meshes[y]);v=!1}if(v&&(t.computeBoundingSphere&&o.computeBoundingSphere(),(h=0===g?new Kc(o,n):1===g?new Bd(o,n):new Zh(o,n)).name=i,f.push(h)),e.isValid(f)&&f.length>0){var b=[];for(var y in f)b[y]=(h=f[y]).name;p="Adding mesh(es) ("+b.length+": "+b+") from input mesh: "+i,p+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)"}else p="Not adding mesh: "+i,p+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)";var x=this.callbacks.onProgress;return e.isValid(x)&&x(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:t.params.meshName,text:p,numericalValue:t.progress.numericalValue}})),f},n.prototype.updateMaterials=function(t){var n,r,i=t.materials.materialCloneInstructions;if(e.isValid(i)){var o=i.materialNameOrg,a=this.materials[o];if(e.isValid(o)){(n=a.clone()).name=r=i.materialName;var s=i.materialProperties;for(var c in s)n.hasOwnProperty(c)&&s.hasOwnProperty(c)&&(n[c]=s[c]);this.materials[r]=n}else console.warn('Requested material "'+o+'" is not available!')}var u=t.materials.serializedMaterials;if(e.isValid(u)&&Object.keys(u).length>0){var l,h=new ol;for(r in u)e.isValid(l=u[r])&&(n=h.parse(l),this.logging.enabled&&console.info('De-serialized material with name "'+r+'" will be added.'),this.materials[r]=n)}if(e.isValid(u=t.materials.runtimeMaterials)&&Object.keys(u).length>0)for(r in u)n=u[r],this.logging.enabled&&console.info('Material with name "'+r+'" will be added.'),this.materials[r]=n},n.prototype.getMaterialsJSON=function(){var t={};for(var e in this.materials)t[e]=this.materials[e].toJSON();return t},n.prototype.getMaterials=function(){return this.materials},n}(),Cp.WorkerRunnerRefImpl=function(){function t(){var t=this;self.addEventListener("message",function(e){t.processMessage(e.data)},!1)}return t.prototype.applyProperties=function(t,e){var n,r,i;for(n in e)r="set"+n.substring(0,1).toLocaleUpperCase()+n.substring(1),i=e[n],"function"==typeof t[r]?t[r](i):t.hasOwnProperty(n)&&(t[n]=i)},t.prototype.processMessage=function(t){if("run"===t.cmd){var e={callbackMeshBuilder:function(t){self.postMessage(t)},callbackProgress:function(e){t.logging.enabled&&t.logging.debug&&console.debug("WorkerRunner: progress: "+e)}},n=new Parser;"function"==typeof n.setLogging&&n.setLogging(t.logging.enabled,t.logging.debug),this.applyProperties(n,t.params),this.applyProperties(n,t.materials),this.applyProperties(n,e),n.workerScope=self,n.parse(t.data.input,t.data.options),t.logging.enabled&&console.log("WorkerRunner: Run complete!"),e.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+t.cmd)},t}(),Cp.WorkerSupport=function(){var t="2.2.0",e=Cp.Validator,n=function(){function t(){this._reset()}return t.prototype._reset=function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},t.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},t.prototype.setForceCopy=function(t){this.forceCopy=!0===t},t.prototype.initWorker=function(t,e){this.runnerImplName=e;var n=new Blob([t],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(n)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},t.prototype._receiveWorkerMessage=function(t){var e=t.data;switch(e.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(e);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(e.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+e.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(e.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+e.cmd)}},t.prototype.setCallbacks=function(t,n){this.callbacks.meshBuilder=e.verifyInput(t,this.callbacks.meshBuilder),this.callbacks.onLoad=e.verifyInput(n,this.callbacks.onLoad)},t.prototype.run=function(t){if(e.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=t,this.started=!0,!e.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!e.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==t.cmd&&(t.cmd="run"),e.isValid(t.logging)?(t.logging.enabled=!0===t.logging.enabled,t.logging.debug=!0===t.logging.debug):t.logging={enabled:!0,debug:!1},this._postMessage()}},t.prototype._postMessage=function(){var t;e.isValid(this.queuedMessage)&&e.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(t=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[t])):this.worker.postMessage(this.queuedMessage))},t.prototype.setTerminateRequested=function(t){this.terminateRequested=!0===t,this.terminateRequested&&e.isValid(this.worker)&&!e.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},t.prototype._terminate=function(){this.worker.terminate(),this._reset()},t}();function r(){if(console.info("Using LoaderSupport.WorkerSupport version: "+t),this.logging={enabled:!0,debug:!1},void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this.loaderWorker=new n}r.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},r.prototype.setForceWorkerDataCopy=function(t){this.loaderWorker.setForceCopy(t)},r.prototype.validate=function(t,n,r,a,s){if(!e.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),e.isValid(s)?this.logging.enabled&&console.info('WorkerSupport: Using "'+s.name+'" as Runner class for worker.'):(s=Cp.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.'));var c=t(i,o);c+="var Parser = "+n+";\n\n",c+=o(s.name,s),c+="new "+s.name+"();\n\n";var u=this;if(e.isValid(r)&&r.length>0){var l="",h=function(t,e){if(0===e.length)u.loaderWorker.initWorker(l+c,s.name),u.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var n=new Xu;n.setPath(t),n.setResponseType("text"),n.load(e[0],function(n){l+=n,h(t,e)}),e.shift()}};h(a,r)}else this.loaderWorker.initWorker(c,s.name),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},r.prototype.setCallbacks=function(t,e){this.loaderWorker.setCallbacks(t,e)},r.prototype.run=function(t){this.loaderWorker.run(t)},r.prototype.setTerminateRequested=function(t){this.loaderWorker.setTerminateRequested(t)};var i=function(t,e){var n,r=t+" = {\n";for(var i in e)"string"==typeof(n=e[i])||n instanceof String?r+="\t"+i+': "'+(n=(n=n.replace("\n","\\n")).replace("\r","\\r"))+'",\n':n instanceof Array?r+="\t"+i+": ["+n+"],\n":Number.isInteger(n)?r+="\t"+i+": "+n+",\n":"function"==typeof n&&(r+="\t"+i+": "+n+",\n");return r+"}\n\n"},o=function(t,n,r,i,o){var a,s,c="",u=e.isValid(r)?r:n.name;for(var l in o=e.verifyInput(o,[]),n.prototype)a=n.prototype[l],"constructor"===l?s="\tfunction "+u+a.toString().replace("function","")+";\n\n":"function"==typeof a&&o.indexOf(l)<0&&(c+="\t"+u+".prototype."+l+" = "+a.toString()+";\n\n");c+="\treturn "+u+";\n",c+="})();\n\n";var h="";return e.isValid(i)&&(h+="\n",h+=u+".prototype = Object.create( "+i+".prototype );\n",h+=u+".constructor = "+u+";\n",h+="\n"),e.isValid(s)?c=t+" = (function () {\n\n"+h+s+c:(s=t+" = (function () {\n\n",c=(s+=h+"\t"+n.prototype.constructor.toString()+"\n\n")+c),c};return r}(),Cp.WorkerDirector=function(){var t="2.2.0",e=Cp.Validator,n=16,r=8192;function i(i){if(console.info("Using LoaderSupport.WorkerDirector version: "+t),this.logging={enabled:!0,debug:!1},this.maxQueueSize=r,this.maxWebWorkers=n,this.crossOrigin=null,!e.isValid(i))throw"Provided invalid classDef: "+i;this.workerDescription={classDef:i,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}return i.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},i.prototype.getMaxQueueSize=function(){return this.maxQueueSize},i.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},i.prototype.setCrossOrigin=function(t){this.crossOrigin=t},i.prototype.setForceWorkerDataCopy=function(t){this.workerDescription.forceWorkerDataCopy=!0===t},i.prototype.prepareWorkers=function(t,i,o){e.isValid(t)&&(this.workerDescription.globalCallbacks=t),this.maxQueueSize=Math.min(i,r),this.maxWebWorkers=Math.min(o,n),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var a=0;a<this.maxWebWorkers;a++){var s=new Cp.WorkerSupport;s.setLogging(this.logging.enabled,this.logging.debug),s.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[a]={instanceNo:a,inUse:!1,terminateRequested:!1,workerSupport:s,loader:null}}},i.prototype.enqueueForRun=function(t){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(t)},i.prototype.isRunning=function(){var t=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||t.length>0},i.prototype.processQueue=function(){var t;for(var e in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[e]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(this._kickWorkerRun(this.instructionQueue[this.instructionQueuePointer],t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},i.prototype._kickWorkerRun=function(t,n){n.inUse=!0,n.workerSupport.setTerminateRequested(n.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var r=this,i=t.getCallbacks(),o=this.workerDescription.globalCallbacks;n.loader=this._buildLoader(n.instanceNo);var a=new Cp.Callbacks;a.setCallbackOnLoad(function(t){e.isValid(o.onLoad)&&o.onLoad(t),e.isValid(i.onLoad)&&i.onLoad(t),r.objectsCompleted++,n.inUse=!1,r.processQueue()}),a.setCallbackOnProgress(function(t){e.isValid(o.onProgress)&&o.onProgress(t),e.isValid(i.onProgress)&&i.onProgress(t)}),a.setCallbackOnMeshAlter(function(t){e.isValid(o.onMeshAlter)&&o.onMeshAlter(t),e.isValid(i.onMeshAlter)&&i.onMeshAlter(t)}),t.callbacks=a,n.loader.run(t,n.workerSupport)},i.prototype._buildLoader=function(t){var n=this.workerDescription.classDef,r=Object.create(n.prototype);if(n.call(r,Hu),!r.hasOwnProperty("instanceNo"))throw n.name+' has no property "instanceNo".';if(r.instanceNo=t,!r.hasOwnProperty("workerSupport"))throw n.name+' has no property "workerSupport".';if("function"!=typeof r.run)throw n.name+' has no function "run".';return r.hasOwnProperty("callbacks")&&e.isValid(r.callbacks)||(console.warn(n.name+' has an invalid property "callbacks". Will change to "LoaderSupport.Callbacks"'),r.callbacks=new Cp.Callbacks),r},i.prototype._deregister=function(t){if(e.isValid(t)){t.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+t.instanceNo+".");var n=t.loader.callbacks;e.isValid(n.onProgress)&&n.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[t.instanceNo]}},i.prototype.tearDown=function(t){for(var n in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=e.verifyInput(t,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[n].terminateRequested=!0},i}();var Pp,Op,Np=function(t){this.manager=void 0!==t?t:Hu};Np.prototype={constructor:Np,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:(Pp=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]],function(t){console.time("MD2Loader");for(var e=new DataView(t),n={},r=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],i=0;i<r.length;i++)n[r[i]]=e.getInt32(4*i,!0);if(844121161===n.ident&&8===n.version){if(n.offset_end===e.byteLength){for(var o=new Ls,a=[],s=n.offset_st,c=(i=0,n.num_st);i<c;i++){var u=e.getInt16(s+0,!0),l=e.getInt16(s+2,!0);a.push(new Cs(u/n.skinwidth,1-l/n.skinheight)),s+=4}for(s=n.offset_tris,i=0,c=n.num_tris;i<c;i++){var h=e.getUint16(s+0,!0),d=e.getUint16(s+2,!0),p=e.getUint16(s+4,!0);o.faces.push(new Ms(h,d,p)),o.faceVertexUvs[0].push([a[e.getUint16(s+6,!0)],a[e.getUint16(s+8,!0)],a[e.getUint16(s+10,!0)]]),s+=12}var f=new ss,m=new ss,v=[];for(s=n.offset_frames,i=0,c=n.num_frames;i<c;i++){m.set(e.getFloat32(s+0,!0),e.getFloat32(s+4,!0),e.getFloat32(s+8,!0)),f.set(e.getFloat32(s+12,!0),e.getFloat32(s+16,!0),e.getFloat32(s+20,!0)),s+=24;for(var g=0;g<16;g++){var y=e.getUint8(s+g,!0);if(0===y)break;v[g]=y}var b={name:String.fromCharCode.apply(null,v),vertices:[],normals:[]};for(s+=16,g=0;g<n.num_vertices;g++){var x=e.getUint8(s++,!0),w=e.getUint8(s++,!0),_=e.getUint8(s++,!0),S=Pp[e.getUint8(s++,!0)],T=new ss(x*m.x+f.x,_*m.z+f.z,w*m.y+f.y),M=new ss(S[0],S[2],S[1]);b.vertices.push(T),b.normals.push(M)}o.morphTargets.push(b)}o.vertices=o.morphTargets[0].vertices;for(var A=o.morphTargets[0],E=(g=0,o.faces.length);g<E;g++)(P=o.faces[g]).vertexNormals=[A.normals[P.a],A.normals[P.b],A.normals[P.c]];for(i=0,c=o.morphTargets.length;i<c;i++){A=o.morphTargets[i];var C=[];for(g=0,E=o.faces.length;g<E;g++){var P;C.push({a:A.normals[(P=o.faces[g]).a],b:A.normals[P.b],c:A.normals[P.c]})}o.morphNormals.push({vertexNormals:C})}return o.animations=_u.CreateClipsFromMorphTargetSequences(o.morphTargets,10),console.timeEnd("MD2Loader"),o}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")})};var Lp={getContext:function(){return void 0===Op&&(Op=new(window.AudioContext||window.webkitAudioContext)),Op},setContext:function(t){Op=t}};function Ip(){ys.call(this),this.type="AudioListener",this.context=Lp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Rp(t){ys.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Dp(t){this.manager=void 0!==t?t:Hu}Ip.prototype=Object.assign(Object.create(ys.prototype),{constructor:Ip,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new ss,e=new cs,n=new ss,r=new ss;return function(i){ys.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(t,e,n),r.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(r.x,this.context.currentTime),o.forwardY.setValueAtTime(r.y,this.context.currentTime),o.forwardZ.setValueAtTime(r.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(r.x,r.y,r.z,a.x,a.y,a.z))}}()}),Rp.prototype=Object.assign(Object.create(ys.prototype),{constructor:Rp,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}console.warn("Audio: this Audio has no playback control.")}else console.warn("Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),Object.assign(Dp.prototype,{load:function(t,e,n,r){var i=new Xu(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){Lp.getContext().decodeAudioData(t,function(t){e(t)})},n,r)}});var Fp=function(t){this.manager=void 0!==t?t:Hu};function Up(t,e,n){this._mixer=t,this._clip=e,this._localRoot=n||null;for(var r=e.tracks,i=r.length,o=new Array(i),a={endingStart:kc,endingEnd:kc},s=0;s!==i;++s){var c=r[s].createInterpolant(null);o[s]=c,c.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Fc,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function kp(t,e,n){this.binding=t,this.valueSize=n;var r,i=Float64Array;switch(e){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function jp(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Fp.prototype={constructor:Fp,load:function(t,e,n,r){var i=this,o=new Ou,a=new Xu(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){o.image=i.parse(t),o.needsUpdate=!0,void 0!==e&&e(o)},n,r),o},parse:function(t){t.length<19&&console.error("TGALoader: Not enough data to contain header.");var e=new Uint8Array(t),n=0,r={id_length:e[n++],colormap_type:e[n++],image_type:e[n++],colormap_index:e[n++]|e[n++]<<8,colormap_length:e[n++]|e[n++]<<8,colormap_size:e[n++],origin:[e[n++]|e[n++]<<8,e[n++]|e[n++]<<8],width:e[n++]|e[n++]<<8,height:e[n++]|e[n++]<<8,pixel_size:e[n++],flags:e[n++]};!function(t){switch(t.image_type){case 1:case 9:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:t.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',t.image_type)}(t.width<=0||t.height<=0)&&console.error("TGALoader: Invalid image size."),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',t.pixel_size)}(r),r.id_length+n>t.length&&console.error("TGALoader: No data."),n+=r.id_length;var i=!1,o=!1,a=!1;switch(r.image_type){case 9:i=!0,o=!0;break;case 1:o=!0;break;case 10:i=!0;break;case 2:break;case 11:i=!0,a=!0;break;case 3:a=!0}var s=document.createElement("canvas");s.width=r.width,s.height=r.height;var c=s.getContext("2d"),u=c.createImageData(r.width,r.height),l=function(t,e,n,r,i){var o,a,s,c;if(s=n.width*n.height*(a=n.pixel_size>>3),e&&(c=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),t){var u,l,h;o=new Uint8Array(s);for(var d=0,p=new Uint8Array(a);d<s;)if(l=1+(127&(u=i[r++])),128&u){for(h=0;h<a;++h)p[h]=i[r++];for(h=0;h<l;++h)o.set(p,d+h*a);d+=a*l}else{for(l*=a,h=0;h<l;++h)o[d+h]=i[r++];d+=l}}else o=i.subarray(r,r+=e?n.width*n.height:s);return{pixel_data:o,palettes:c}}(i,o,r,n,e);return function(t,e,n,i,o){var s,c,u,l,h,d;switch((48&r.flags)>>4){default:case 2:s=0,u=1,h=e,c=0,l=1,d=n;break;case 0:s=0,u=1,h=e,c=n-1,l=-1,d=-1;break;case 3:s=e-1,u=-1,h=-1,c=0,l=1,d=n;break;case 1:s=e-1,u=-1,h=-1,c=n-1,l=-1,d=-1}if(a)switch(r.pixel_size){case 8:!function(t,e,n,i,o,a,s,c){var u,l,h,d=0,p=r.width;for(h=e;h!==i;h+=n)for(l=o;l!==s;l+=a,d++)t[4*(l+p*h)+0]=u=c[d],t[4*(l+p*h)+1]=u,t[4*(l+p*h)+2]=u,t[4*(l+p*h)+3]=255}(t,c,l,d,s,u,h,i);break;case 16:!function(t,e,n,i,o,a,s,c){var u,l,h=0,d=r.width;for(l=e;l!==i;l+=n)for(u=o;u!==s;u+=a,h+=2)t[4*(u+d*l)+0]=c[h+0],t[4*(u+d*l)+1]=c[h+0],t[4*(u+d*l)+2]=c[h+0],t[4*(u+d*l)+3]=c[h+1]}(t,c,l,d,s,u,h,i);break;default:console.error("TGALoader: Format not supported.")}else switch(r.pixel_size){case 8:!function(t,e,n,i,a,s,c,u,l){var h,d,p,f=o,m=0,v=r.width;for(p=e;p!==i;p+=n)for(d=a;d!==c;d+=s,m++)h=u[m],t[4*(d+v*p)+3]=255,t[4*(d+v*p)+2]=f[3*h+0],t[4*(d+v*p)+1]=f[3*h+1],t[4*(d+v*p)+0]=f[3*h+2]}(t,c,l,d,s,u,h,i);break;case 16:!function(t,e,n,i,o,a,s,c){var u,l,h,d=0,p=r.width;for(h=e;h!==i;h+=n)for(l=o;l!==s;l+=a,d+=2)t[4*(l+p*h)+0]=(31744&(u=c[d+0]+(c[d+1]<<8)))>>7,t[4*(l+p*h)+1]=(992&u)>>2,t[4*(l+p*h)+2]=(31&u)>>3,t[4*(l+p*h)+3]=32768&u?0:255}(t,c,l,d,s,u,h,i);break;case 24:!function(t,e,n,i,o,a,s,c){var u,l,h=0,d=r.width;for(l=e;l!==i;l+=n)for(u=o;u!==s;u+=a,h+=3)t[4*(u+d*l)+3]=255,t[4*(u+d*l)+2]=c[h+0],t[4*(u+d*l)+1]=c[h+1],t[4*(u+d*l)+0]=c[h+2]}(t,c,l,d,s,u,h,i);break;case 32:!function(t,e,n,i,o,a,s,c){var u,l,h=0,d=r.width;for(l=e;l!==i;l+=n)for(u=o;u!==s;u+=a,h+=4)t[4*(u+d*l)+2]=c[h+0],t[4*(u+d*l)+1]=c[h+1],t[4*(u+d*l)+0]=c[h+2],t[4*(u+d*l)+3]=c[h+3]}(t,c,l,d,s,u,h,i);break;default:console.error("TGALoader: Format not supported.")}}(u.data,r.width,r.height,l.pixel_data,l.palettes),c.putImageData(u,0,0),s}},Object.assign(Up.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,i=t._clip.duration,o=r/i;t.warp(1,i/r,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,c=o.sampleValues;return s[0]=i,s[1]=i+n,c[0]=t/a,c[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*n;if(o<0||0===n)return;this._startTime=null,e=n*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var c=this._interpolants,u=this._propertyBindings,l=0,h=c.length;l!==h;++l)c[l].evaluate(a),u[l].accumulate(r,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var n=this._clip.duration,r=this.loop,i=this._loopCount;if(2200===r){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=n)e=n;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=2202===r;if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=n||e<0){var a=Math.floor(e/n);e-=n*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var c=t<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&i))return this.time=e,n-e}return this.time=e,e},_setEndings:function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:kc:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:kc:2402)},_scheduleFading:function(t,e,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=n,this}}),Object.assign(kp.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valueSize,i=t*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=e}else this._mixBufferRegion(n,i,0,e/(o+=e),r);this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.binding;this.cumulativeWeight=0,i<1&&this._mixBufferRegion(n,r,3*e,1-i,e);for(var a=e,s=e+e;a!==s;++a)if(n[a]!==n[a+e]){o.setValue(n,r);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,n=3*e;this.binding.getValue(t,n);for(var r=e,i=n;r!==i;++r)t[r]=t[n+r%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)t[e+o]=t[n+o]},_slerp:function(t,e,n,r){cs.slerpFlat(t,e,t,e,t,n,r)},_lerp:function(t,e,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*r}}}),jp.prototype=Object.assign(Object.create(us.prototype),{constructor:jp,_bindAction:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,c=this._bindingsByRootAndName,u=c[s];void 0===u&&(c[s]=u={});for(var l=0;l!==i;++l){var h=r[l],d=h.name,p=u[d];if(void 0!==p)o[l]=p;else{if(void 0!==(p=o[l])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}++(p=new kp(Dh.create(n,d,e&&e._propertyBindings[l].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[l]=p}a[l].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){var r=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,c=s[s.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){var r=this._bindingsByRootAndName,i=r[e],o=this._bindings;void 0===i&&(r[e]=i={}),i[n]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=e[e.length-1],c=t._cacheIndex;s._cacheIndex=c,e[c]=s,e.pop(),delete a[i];t:{for(var u in a)break t;delete o[r]}},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new gu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?_u.findByName(n,t):t,o=null!==i?i.uuid:t,a=this._actionsByClip[o],s=null;if(void 0!==a){var c=a.actionByRoot[r];if(void 0!==c)return c;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new Up(this,i,e);return this._bindAction(u,s),this._addInactiveAction(u,o,r),u},existingAction:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?_u.findByName(n,t):t,o=this._actionsByClip[i?i.uuid:t];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(t){for(var e=this._actions,n=this._nActiveActions,r=this.time+=t*=this.timeScale,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a)e[a]._update(r,t,i,o);var s=this._bindings,c=this._nActiveBindings;for(a=0;a!==c;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var c=o[a];this._deactivateAction(c);var u=c._cacheIndex,l=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=u,e[u]=l,e.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}},uncacheRoot:function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});var Bp=function(t){cl.call(this),this.manager=void 0!==t?t:Hu,this.parser=new MMDParser.Parser,this.textureCrossOrigin=null};(Bp.prototype=Object.create(cl.prototype)).constructor=Bp,Bp.prototype.defaultToonTextures=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],Bp.prototype.setTextureCrossOrigin=function(t){this.textureCrossOrigin=t},Bp.prototype.load=function(t,e,n,r,i){var o=this;this.loadModel(t,function(t){o.loadVmds(e,function(e){o.pourVmdIntoModel(t,e),n(t)},r,i)},r,i)},Bp.prototype.loadModel=function(t,e,n,r){var i=this,o=ul.extractUrlBase(t),a=this.extractExtension(t);this.loadFileAsBuffer(t,function(t){e(i.createModel(t,a,o,n,r))},n,r)},Bp.prototype.createModel=function(t,e,n,r,i){return this.createMesh(this.parseModel(t,e),n,r,i)},Bp.prototype.loadVmd=function(t,e,n,r){var i=this;this.loadFileAsBuffer(t,function(t){e(i.parseVmd(t))},n,r)},Bp.prototype.loadVmds=function(t,e,n,r){var i=this,o=[];t=t.slice(),function a(){var s=t.shift();i.loadVmd(s,function(n){o.push(n),t.length>0?a():e(i.mergeVmds(o))},n,r)}()},Bp.prototype.loadAudio=function(t,e,n,r){var i=new Ip,o=new Rp(i);new Dp(this.manager).load(t,function(t){o.setBuffer(t),e(o,i)},n,r)},Bp.prototype.loadVpd=function(t,e,n,r,i){var o=this;(i&&"unicode"===i.charcode?this.loadFileAsText:this.loadFileAsShiftJISText).bind(this)(t,function(t){e(o.parseVpd(t))},n,r)},Bp.prototype.parseModel=function(t,e){switch(e.toLowerCase()){case"pmd":return this.parsePmd(t);case"pmx":return this.parsePmx(t);default:throw"extension "+e+" is not supported."}},Bp.prototype.parsePmd=function(t){return this.parser.parsePmd(t,!0)},Bp.prototype.parsePmx=function(t){return this.parser.parsePmx(t,!0)},Bp.prototype.parseVmd=function(t){return this.parser.parseVmd(t,!0)},Bp.prototype.parseVpd=function(t){return this.parser.parseVpd(t,!0)},Bp.prototype.mergeVmds=function(t){return this.parser.mergeVmds(t)},Bp.prototype.pourVmdIntoModel=function(t,e,n){this.createAnimation(t,e,n)},Bp.prototype.pourVmdIntoCamera=function(t,e,n){var r=new Bp.DataCreationHelper;!function(){for(var i,o,a=r.createOrderedMotionArray(e.cameras),s=[],c=[],u=[],l=[],h=[],d=[],p=[],f=[],m=[],v=new cs,g=new ls,y=new ss,b=new ss,x=function(t,e){t.push(e.x),t.push(e.y),t.push(e.z)},w=function(t,e,n){t.push(e[4*n+0]/127),t.push(e[4*n+1]/127),t.push(e[4*n+2]/127),t.push(e[4*n+3]/127)},_=function(t,e,n,r,i){if(n.length>2){n=n.slice(),r=r.slice(),i=i.slice();for(var o=r.length/n.length,a=3===o?12:4,s=1,c=2,u=n.length;c<u;c++){for(var l=0;l<o;l++)if(r[s*o+l]!==r[(s-1)*o+l]||r[s*o+l]!==r[c*o+l]){s++;break}if(c>s){for(n[s]=n[c],l=0;l<o;l++)r[s*o+l]=r[c*o+l];for(l=0;l<a;l++)i[s*a+l]=i[c*a+l]}}n.length=s+1,r.length=(s+1)*o,i.length=(s+1)*a}return new Bp[e](t,n,r,i)},S=0;S<a.length;S++){var T=a[S],M=T.frameNum/30,A=T.position,E=T.rotation,C=T.fov,P=T.interpolation;y.set(0,0,-T.distance),b.set(A[0],A[1],A[2]),g.set(-E[0],-E[1],-E[2]),v.setFromEuler(g),y.add(b),y.applyQuaternion(v),s.length>0&&M<s[s.length-1]+.05&&(s[s.length-1]=M-1e-13),s.push(M),x(c,b),(i=u).push((o=v).x),i.push(o.y),i.push(o.z),i.push(o.w),x(l,y),h.push(C);for(var O=0;O<3;O++)w(d,P,O);for(w(p,P,3),O=0;O<3;O++)w(f,P,4);w(m,P,5)}if(0!==s.length){var N=[];N.push(_(".center","VectorKeyframeTrackEx",s,c,d)),N.push(_(".quaternion","QuaternionKeyframeTrackEx",s,u,p)),N.push(_(".position","VectorKeyframeTrackEx",s,l,f)),N.push(_(".fov","NumberKeyframeTrackEx",s,h,m));var L=new _u(void 0===n?os.generateUUID():n,-1,N);void 0===t.center&&(t.center=new ss(0,0,0)),void 0===t.animations&&(t.animations=[]),t.animations.push(L)}}()},Bp.prototype.extractExtension=function(t){var e=t.lastIndexOf(".");return e<0?null:t.slice(e+1)},Bp.prototype.loadFile=function(t,e,n,r,i,o){var a=new Xu(this.manager);return void 0!==o&&a.setMimeType(o),a.setResponseType(i),a.load(t,function(t){e(t)},n,r)},Bp.prototype.loadFileAsBuffer=function(t,e,n,r){this.loadFile(t,e,n,r,"arraybuffer")},Bp.prototype.loadFileAsText=function(t,e,n,r){this.loadFile(t,e,n,r,"text")},Bp.prototype.loadFileAsShiftJISText=function(t,e,n,r){this.loadFile(t,e,n,r,"text","text/plain; charset=shift_jis")},Bp.prototype.createMesh=function(t,e,n,r){var i=this,o=new Xs,a=[],s={vertices:[],uvs:[],normals:[],skinIndices:[],skinWeights:[],indices:[]};return function(){for(var e=0;e<t.metadata.vertexCount;e++){for(var n=t.vertices[e],r=0,i=n.position.length;r<i;r++)s.vertices.push(n.position[r]);for(r=0,i=n.normal.length;r<i;r++)s.normals.push(n.normal[r]);for(r=0,i=n.uv.length;r<i;r++)s.uvs.push(n.uv[r]);for(r=0;r<4;r++)s.skinIndices.push(n.skinIndices.length-1>=r?n.skinIndices[r]:0);for(r=0;r<4;r++)s.skinWeights.push(n.skinWeights.length-1>=r?n.skinWeights[r]:0)}}(),function(){for(var e=0;e<t.metadata.faceCount;e++)for(var n=t.faces[e],r=0,i=n.indices.length;r<i;r++)s.indices.push(n.indices[r])}(),function(){for(var e=[],n=t.rigidBodies,r={},i=0,a=n.length;i<a;i++){var s=n[i],c=r[s.boneIndex];c=void 0===c?s.type:Math.max(s.type,c),r[s.boneIndex]=c}for(i=0;i<t.metadata.boneCount;i++){var u={},l=t.bones[i];u.parent=l.parentIndex,u.name=l.name,u.pos=[l.position[0],l.position[1],l.position[2]],u.rotq=[0,0,0,1],u.scl=[1,1,1],-1!==u.parent&&(u.pos[0]-=t.bones[u.parent].position[0],u.pos[1]-=t.bones[u.parent].position[1],u.pos[2]-=t.bones[u.parent].position[2]),u.rigidBodyType=void 0!==r[i]?r[i]:-1,e.push(u)}o.bones=e}(),function(){var e=[];if("pmd"===t.metadata.format)for(var n=0;n<t.metadata.ikCount;n++){(a={}).target=(i=t.iks[n]).target,a.effector=i.effector,a.iteration=i.iteration,a.maxAngle=4*i.maxAngle,a.links=[];for(var r=0;r<i.links.length;r++)(s={}).index=i.links[r].index,t.bones[s.index].name.indexOf("\u3072\u3056")>=0&&(s.limitation=new ss(1,0,0)),a.links.push(s);e.push(a)}else for(n=0;n<t.metadata.boneCount;n++){var i;if(void 0!==(i=t.bones[n].ik)){var a;for((a={}).target=n,a.effector=i.effector,a.iteration=i.iteration,a.maxAngle=i.maxAngle,a.links=[],r=0;r<i.links.length;r++){var s;(s={}).index=i.links[r].index,s.enabled=!0,1===i.links[r].angleLimitation&&(s.limitation=new ss(1,0,0)),a.links.push(s)}e.push(a)}}o.iks=e}(),function(){if("pmd"!==t.metadata.format){for(var e=[],n=0;n<t.metadata.boneCount;n++){var r=t.bones[n],i=r.grant;if(void 0!==i){var a={};a.index=n,a.parentIndex=i.parentIndex,a.ratio=i.ratio,a.isLocal=i.isLocal,a.affectRotation=i.affectRotation,a.affectPosition=i.affectPosition,a.transformationClass=r.transformationClass,e.push(a)}}e.sort(function(t,e){return t.transformationClass-e.transformationClass}),o.grants=e}}(),function(){function e(t,e,n,r){t.array[3*e+0]+=n.position[0]*r,t.array[3*e+1]+=n.position[1]*r,t.array[3*e+2]+=n.position[2]*r}function n(n,r,i){for(var o=0;o<r.elementCount;o++){var a=r.elements[o];e(n,"pmd"===t.metadata.format?t.morphs[0].elements[a.index].index:a.index,a,i)}}for(var r=[],i=[],a=0;a<t.metadata.morphCount;a++){var c=t.morphs[a],u={name:c.name},l=new Vs(3*t.metadata.vertexCount,3);l.name=c.name;for(var h=0;h<3*t.metadata.vertexCount;h++)l.array[h]=s.vertices[h];if("pmd"===t.metadata.format)0!==a&&n(l,c,1);else if(0===c.type)for(h=0;h<c.elementCount;h++){var d=t.morphs[c.elements[h].index];1===d.type&&n(l,d,c.elements[h].ratio)}else 1===c.type&&n(l,c,1);r.push(u),i.push(l)}o.morphTargets=r,o.morphAttributes.position=i}(),function(){var s={},c=new sl(i.manager),u=new Fp(i.manager),l=document.createElement("canvas"),h=l.getContext("2d"),d=0,p=[];function f(t,o){var a;if(void 0===o&&(o={}),!0===o.defaultTexturePath)try{a=i.defaultToonTextures[parseInt(t.match("toon([0-9]{2}).bmp$")[1])]}catch(e){console.warn("MMDLoader: "+t+" seems like not right default texture path. Using toon00.bmp instead."),a=i.defaultToonTextures[0]}else a=e+t;if(void 0!==s[a])return a;var d=cl.Handlers.get(a);null===d&&(d=t.indexOf(".tga")>=0?u:c);var p=d.load(a,function(t){if(!0===o.isToonTexture){var e=t.image,n=e.width,r=e.height;l.width=n,l.height=r,h.clearRect(0,0,n,r),h.translate(n/2,r/2),h.rotate(.5*Math.PI),h.translate(-n/2,-r/2),h.drawImage(e,0,0),t.image=h.getImageData(0,0,n,r)}t.flipY=!1,t.wrapS=_c,t.wrapT=_c;for(var i=0;i<p.readyCallbacks.length;i++)p.readyCallbacks[i](p);delete p.readyCallbacks},n,r);return!0===o.sphericalReflectionMapping&&(p.mapping=wc),p.readyCallbacks=[],s[a]=p,a}function m(t,e){return void 0===e[t]&&console.warn("MMDLoader: Undefined texture",t),e[t]}null!==i.textureCrossOrigin&&c.setCrossOrigin(i.textureCrossOrigin);for(var v=0;v<t.metadata.materialCount;v++){var g,y=t.materials[v],b={};if(b.faceOffset=d,b.faceNum=y.faceCount,d+=y.faceCount,b.name=y.name,b.color=new Ts(y.diffuse[0],y.diffuse[1],y.diffuse[2]),b.opacity=y.diffuse[3],b.specular=new Ts(y.specular[0],y.specular[1],y.specular[2]),b.shininess=y.shininess,1===b.opacity?(b.side=sc,b.transparent=!1):(b.side=uc,b.transparent=!0),"pmd"===t.metadata.format){if(y.fileName){var x=y.fileName,w=[],_=x.lastIndexOf("*");_>=0?(w.push(x.slice(0,_)),w.push(x.slice(_+1))):w.push(x);for(var S=0;S<w.length;S++)(g=w[S]).indexOf(".sph")>=0||g.indexOf(".spa")>=0?(b.envMap=f(g,{sphericalReflectionMapping:!0}),b.envMapType=g.indexOf(".sph")>=0?yc:2):b.map=f(g)}}else-1!==y.textureIndex&&(b.map=f(g=t.textures[y.textureIndex])),-1===y.envTextureIndex||1!==y.envFlag&&2!=y.envFlag||(b.envMap=f(g=t.textures[y.envTextureIndex],{sphericalReflectionMapping:!0}),b.envMapType=1===y.envFlag?yc:2);var T=void 0===b.map?1:.2;b.emissive=new Ts(y.ambient[0]*T,y.ambient[1]*T,y.ambient[2]*T),p.push(b)}for(v=0;v<p.length;v++){var M=p[v],A=t.materials[v];if(y=new tl,o.addGroup(3*M.faceOffset,3*M.faceNum,v),void 0!==M.name&&(y.name=M.name),y.skinning=o.bones.length>0,y.morphTargets=o.morphTargets.length>0,y.lights=!0,y.side="pmx"===t.metadata.format&&1==(1&A.flag)?uc:M.side,y.transparent=M.transparent,y.fog=!0,y.blending=5,y.blendSrc=mc,y.blendDst=vc,y.blendSrcAlpha=mc,y.blendDstAlpha=206,void 0!==M.map){function E(t){t.map.readyCallbacks.push(function(e){function n(t,e){var n=t.width,r=t.height,i=Math.round(e.x*n)%n,o=Math.round(e.y*r)%r;return i<0&&(i+=n),o<0&&(o+=r),t.data[4*(o*n+i)+3]}var r=void 0!==e.image.data?e.image:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,e.width,e.height)}(e.image),i=o.index.array.slice(3*t.faceOffset,3*t.faceOffset+3*t.faceNum);(function(t,e,r){if(t.data.length/(t.width*t.height)!=4)return!1;for(var i=0;i<r.length;i+=3){for(var o={x:0,y:0},a=0;a<3;a++){var s=r[3*i+a],c={x:e[2*s+0],y:e[2*s+1]};if(n(t,c)<253)return!0;o.x+=c.x,o.y+=c.y}if(o.x/=3,o.y/=3,n(t,o)<253)return!0}return!1})(r,o.attributes.uv.array,i)&&(t.transparent=!0),delete t.faceOffset,delete t.faceNum})}y.faceOffset=M.faceOffset,y.faceNum=M.faceNum,y.map=m(M.map,s),E(y)}if(void 0!==M.envMap&&(y.envMap=m(M.envMap,s),y.combine=M.envMapType),y.opacity=M.opacity,y.color=M.color,void 0!==M.emissive&&(y.emissive=M.emissive),y.specular=M.specular,y.shininess=Math.max(M.shininess,1e-4),"pmd"===t.metadata.format){function C(t){return 10===t.length&&null!==t.match(/toon(10|0[0-9]).bmp/)}y.outlineParameters={thickness:1===A.edgeFlag?.003:0,color:new Ts(0,0,0),alpha:1},0===y.outlineParameters.thickness&&(y.outlineParameters.visible=!1);var P=f(O=-1===A.toonIndex?"toon00.bmp":t.toonTextures[A.toonIndex].fileName,{isToonTexture:!0,defaultTexturePath:C(O)});y.gradientMap=m(P,s)}else{var O,N;if(y.outlineParameters={thickness:A.edgeSize/300,color:new Ts(A.edgeColor[0],A.edgeColor[1],A.edgeColor[2]),alpha:A.edgeColor[3]},0!=(16&A.flag)&&0!==y.outlineParameters.thickness||(y.outlineParameters.visible=!1),-1===A.toonIndex||0!==A.toonFlag){var L=A.toonIndex+1;O="toon"+(L<10?"0"+L:L)+".bmp",N=!0}else O=t.textures[A.toonIndex],N=!1;P=f(O,{isToonTexture:!0,defaultTexturePath:N}),y.gradientMap=m(P,s)}a.push(y)}if("pmx"===t.metadata.format){function I(t,e){if(8===t.type)for(var n=0;n<e.length;n++){var r=e[n];if(-1!==r.index){var i=a[r.index];i.opacity!==r.diffuse[3]&&(i.transparent=!0)}}}for(v=0;v<t.morphs.length;v++){var R=t.morphs[v],D=R.elements;if(0===R.type)for(S=0;S<D.length;S++){var F=t.morphs[D[S].index];I(F,F.elements)}else I(R,D)}}}(),function(){for(var e=[],n=[],r=0;r<t.metadata.rigidBodyCount;r++){for(var i=t.rigidBodies[r],a=Object.keys(i),s={},c=0;c<a.length;c++)s[h=a[c]]=i[h];if("pmx"===t.metadata.format&&-1!==s.boneIndex){var u=t.bones[s.boneIndex];s.position[0]-=u.position[0],s.position[1]-=u.position[1],s.position[2]-=u.position[2]}e.push(s)}for(r=0;r<t.metadata.constraintCount;r++){var l=t.constraints[r];for(a=Object.keys(l),s={},c=0;c<a.length;c++){var h;s[h=a[c]]=l[h]}var d=e[s.rigidBodyIndex1],p=e[s.rigidBodyIndex2];0!==d.type&&2===p.type&&-1!==d.boneIndex&&-1!==p.boneIndex&&t.bones[p.boneIndex].parentIndex===d.boneIndex&&(p.type=1),n.push(s)}o.rigidBodies=e,o.constraints=n}(),o.setIndex(s.indices),o.addAttribute("position",new Vs(s.vertices,3)),o.addAttribute("normal",new Vs(s.normals,3)),o.addAttribute("uv",new Vs(s.uvs,2)),o.addAttribute("skinIndex",new js(s.skinIndices,4)),o.addAttribute("skinWeight",new Vs(s.skinWeights,4)),o.computeBoundingSphere(),o.mmdFormat=t.metadata.format,new Td(o,a)},Bp.prototype.createAnimation=function(t,e,n){var r=new Bp.DataCreationHelper;!function(){if(0!==e.metadata.motionCount){for(var i=t.geometry.bones,o=r.createOrderedMotionArrays(i,e.motions,"boneName"),a=[],s=function(t,e,n){t.push(e[n+0]/127),t.push(e[n+8]/127),t.push(e[n+4]/127),t.push(e[n+12]/127)},c=0;c<o.length;c++){for(var u=[],l=[],h=[],d=[],p=[],f=i[c],m=o[c],v=0;v<m.length;v++){var g=m[v].position,y=m[v].rotation,b=m[v].interpolation;u.push(m[v].frameNum/30);for(var x=0;x<3;x++)l.push(f.pos[x]+g[x]);for(x=0;x<4;x++)h.push(y[x]);for(x=0;x<3;x++)s(d,b,x);s(p,b,3)}if(0!==u.length){var w=".bones["+f.name+"]";a.push(new Bp.VectorKeyframeTrackEx(w+".position",u,l,d)),a.push(new Bp.QuaternionKeyframeTrackEx(w+".quaternion",u,h,p))}}var _=new _u(void 0===n?os.generateUUID():n,-1,a);void 0===t.geometry.animations&&(t.geometry.animations=[]),t.geometry.animations.push(_)}}(),function(){if(0!==e.metadata.morphCount){for(var i=r.createOrderedMotionArrays(t.geometry.morphTargets,e.morphs,"morphName"),o=[],a=0;a<i.length;a++){for(var s=[],c=[],u=i[a],l=0;l<u.length;l++)s.push(u[l].frameNum/30),c.push(u[l].weight);0!==s.length&&o.push(new wu(".morphTargetInfluences["+a+"]",s,c))}var h=new _u(void 0===n?os.generateUUID():n+"Morph",-1,o);void 0===t.geometry.animations&&(t.geometry.animations=[]),t.geometry.animations.push(h)}}()},(Bp.DataCreationHelper=function(){}).prototype={constructor:Bp.DataCreationHelper,toCharcodeStrings:function(t){for(var e="",n=0;n<t.length;n++)e+="0x"+("0000"+t[n].charCodeAt().toString(16)).substr(-4);return e},createDictionary:function(t){for(var e={},n=0;n<t.length;n++)e[t[n].name]=n;return e},initializeMotionArrays:function(t){for(var e=[],n=0;n<t.length;n++)e[n]=[];return e},sortMotionArray:function(t){t.sort(function(t,e){return t.frameNum-e.frameNum})},sortMotionArrays:function(t){for(var e=0;e<t.length;e++)this.sortMotionArray(t[e])},createMotionArray:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},createMotionArrays:function(t,e,n,r){for(var i=0;i<t.length;i++){var o=t[i],a=n[o[r]];void 0!==a&&e[a].push(o)}},createOrderedMotionArray:function(t){var e=this.createMotionArray(t);return this.sortMotionArray(e),e},createOrderedMotionArrays:function(t,e,n){var r=this.createDictionary(t),i=this.initializeMotionArrays(t);return this.createMotionArrays(e,i,r,n),this.sortMotionArrays(i),i}},((Bp.VectorKeyframeTrackEx=function(t,e,n,r){this.interpolationParameters=new Float32Array(r),mu.call(this,t,e,n)}).prototype=Object.create(mu.prototype)).constructor=Bp.VectorKeyframeTrackEx,Bp.VectorKeyframeTrackEx.prototype.TimeBufferType=Float64Array,Bp.VectorKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new Bp.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},Bp.VectorKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((Bp.QuaternionKeyframeTrackEx=function(t,e,n,r){this.interpolationParameters=new Float32Array(r),pu.call(this,t,e,n)}).prototype=Object.create(pu.prototype)).constructor=Bp.QuaternionKeyframeTrackEx,Bp.QuaternionKeyframeTrackEx.prototype.TimeBufferType=Float64Array,Bp.QuaternionKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new Bp.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},Bp.QuaternionKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((Bp.NumberKeyframeTrackEx=function(t,e,n,r){this.interpolationParameters=new Float32Array(r),wu.call(this,t,e,n)}).prototype=Object.create(wu.prototype)).constructor=Bp.NumberKeyframeTrackEx,Bp.NumberKeyframeTrackEx.prototype.TimeBufferType=Float64Array,Bp.NumberKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new Bp.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},Bp.NumberKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((Bp.CubicBezierInterpolation=function(t,e,n,r,i){hu.call(this,t,e,n,r),this.params=i}).prototype=Object.create(gu.prototype)).constructor=Bp.CubicBezierInterpolation,Bp.CubicBezierInterpolation.prototype.interpolate_=function(t,e,n,r){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=s-a,u=(n-e)/(r-e);if(4===a){var l=this._calculate(this.params[4*t+0],this.params[4*t+1],this.params[4*t+2],this.params[4*t+3],u);cs.slerpFlat(i,0,o,c,o,s,l)}else if(3===a)for(var h=0;h!==a;++h)l=this._calculate(this.params[12*t+4*h+0],this.params[12*t+4*h+1],this.params[12*t+4*h+2],this.params[12*t+4*h+3],u),i[h]=o[c+h]*(1-l)+o[s+h]*l;else l=this._calculate(this.params[4*t+0],this.params[4*t+1],this.params[4*t+2],this.params[4*t+3],u),i[0]=o[c]*(1-l)+o[s]*l;return i},Bp.CubicBezierInterpolation.prototype._calculate=function(t,e,n,r,i){for(var o,a,s,c=.5,u=c,l=1-u,h=Math,d=0;d<15;d++){var p=(o=3*l*l*u)*t+(a=3*l*u*u)*e+(s=u*u*u)-i;if(h.abs(p)<1e-5)break;c/=2,l=1-(u+=p<0?c:-c)}return o*n+a*r+s};var zp=function(t,e,n){var r=null===n||void 0===n?{}:n;this.audio=t,this.listener=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==r.delayTime?r.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime};zp.prototype={constructor:zp,control:function(t){this.elapsed+=t,this.currentTime+=t,this.checkIfStopAudio()&&this.audio.stop(),this.checkIfStartAudio()&&this.audio.play()},checkIfStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime||(this.audio.startTime=this.currentTime-this.delayTime,0))},checkIfStopAudio:function(){return!!this.audio.isPlaying&&this.currentTime>=this.duration}};var Vp=function(t){this.mesh=t};Vp.prototype={constructor:Vp,update:function(){var t=new cs;return function(){for(var e=0;e<this.mesh.geometry.grants.length;e++){var n=this.mesh.geometry.grants[e],r=this.mesh.skeleton.bones[n.index],i=this.mesh.skeleton.bones[n.parentIndex];n.isLocal||n.affectRotation&&(t.set(0,0,0,1),t.slerp(i.quaternion,n.ratio),r.quaternion.multiply(t))}}}()};var Gp=function(){this.meshes=[],this.doAnimation=!0,this.doIk=!0,this.doGrant=!0,this.doPhysics=!0,this.doCameraAnimation=!0,this.sharedPhysics=!1,this.masterPhysics=null,this.audioManager=null,this.camera=null};Gp.prototype={constructor:Gp,add:function(t){if(!(t instanceof Td))throw new Error("MMDHelper.add() accepts only SkinnedMesh instance.");void 0===t.mixer&&(t.mixer=null),void 0===t.ikSolver&&(t.ikSolver=null),void 0===t.grantSolver&&(t.grantSolver=null),void 0===t.physics&&(t.physics=null),void 0===t.looped&&(t.looped=!1),this.meshes.push(t),this.initBackupBones(t)},setAudio:function(t,e,n){this.audioManager=new zp(t,e,n)},setCamera:function(t){t.mixer=null,this.camera=t},setPhysicses:function(t){for(var e=0;e<this.meshes.length;e++)this.setPhysics(this.meshes[e],t)},setPhysics:function(t,e){if(void 0===(e=void 0===e?{}:Object.assign({},e)).world&&this.sharedPhysics){var n=this.getMasterPhysics();null!==n&&(e.world=n.world)}var r=void 0!==e.warmup?e.warmup:60,i=new su(t,e);null!==t.mixer&&void 0!==t.mixer&&!0!==e.preventAnimationWarmup&&(this.animateOneMesh(0,t),i.reset()),i.warmup(r),this.updateIKParametersDependingOnPhysicsEnabled(t,!0),t.physics=i},getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var t=0,e=this.meshes.length;t<e;t++){var n=this.meshes[t].physics;if(void 0!==n&&null!==n)return this.masterPhysics=n,this.masterPhysics}return null},enablePhysics:function(t){this.doPhysics=!0===t;for(var e=0,n=this.meshes.length;e<n;e++)this.updateIKParametersDependingOnPhysicsEnabled(this.meshes[e],t)},updateIKParametersDependingOnPhysicsEnabled:function(t,e){for(var n=t.geometry.iks,r=t.geometry.bones,i=0,o=n.length;i<o;i++)for(var a=n[i].links,s=0,c=a.length;s<c;s++){var u=a[s];u.enabled=!0!==e||!(r[u.index].rigidBodyType>0)}},setAnimations:function(){for(var t=0;t<this.meshes.length;t++)this.setAnimation(this.meshes[t])},setAnimation:function(t){if(void 0!==t.geometry.animations){t.mixer=new jp(t),t.mixer.addEventListener("loop",function(t){t.action._clip.tracks.length>0&&0!==t.action._clip.tracks[0].name.indexOf(".bones")||(t.target._root.looped=!0)});for(var e=!1,n=!1,r=0;r<t.geometry.animations.length;r++){var i=t.geometry.animations[r],o=t.mixer.clipAction(i);i.tracks.length>0&&0===i.tracks[0].name.indexOf(".morphTargetInfluences")?n||(o.play(),n=!0):e||(o.play(),e=!0)}e&&(t.ikSolver=new tu(t),void 0!==t.geometry.grants&&(t.grantSolver=new Vp(t)))}},setCameraAnimation:function(t){void 0!==t.animations&&(t.mixer=new jp(t),t.mixer.clipAction(t.animations[0]).play())},unifyAnimationDuration:function(t){t=void 0===t?{}:t;for(var e=0,n=this.camera,r=this.audioManager,i=0;i<this.meshes.length;i++)if(null!==(s=this.meshes[i].mixer))for(var o=0;o<s._actions.length;o++){var a=s._actions[o];e=Math.max(e,a._clip.duration)}if(null!==n&&null!==n.mixer){var s=n.mixer;for(i=0;i<s._actions.length;i++)a=s._actions[i],e=Math.max(e,a._clip.duration)}for(null!==r&&(e=Math.max(e,r.duration)),void 0!==t.afterglow&&(e+=t.afterglow),i=0;i<this.meshes.length;i++)if(null!==(s=this.meshes[i].mixer))for(o=0;o<s._actions.length;o++)(a=s._actions[o])._clip.duration=e;if(null!==n&&null!==n.mixer)for(s=n.mixer,i=0;i<s._actions.length;i++)(a=s._actions[i])._clip.duration=e;null!==r&&(r.duration=e)},controlAudio:function(t){null!==this.audioManager&&this.audioManager.control(t)},animate:function(t){this.controlAudio(t);for(var e=0;e<this.meshes.length;e++)this.animateOneMesh(t,this.meshes[e]);this.sharedPhysics&&this.updateSharedPhysics(t),this.animateCamera(t)},animateOneMesh:function(t,e){var n=e.mixer,r=e.ikSolver,i=e.grantSolver,o=e.physics;null!==n&&!0===this.doAnimation&&(this.restoreBones(e),n.update(t),this.backupBones(e)),null!==r&&!0===this.doIk&&r.update(),null!==i&&!0===this.doGrant&&i.update(),!0===e.looped&&(null!==o&&o.reset(),e.looped=!1),null!==o&&this.doPhysics&&!this.sharedPhysics&&o.update(t)},updateSharedPhysics:function(t){if(0!==this.meshes.length&&this.doPhysics&&this.sharedPhysics){var e=this.getMasterPhysics();if(null!==e){for(var n=0,r=this.meshes.length;n<r;n++)null!==(i=this.meshes[n].physics)&&void 0!==i&&i.updateRigidBodies();for(e.stepSimulation(t),n=0,r=this.meshes.length;n<r;n++){var i;null!==(i=this.meshes[n].physics)&&void 0!==i&&i.updateBones()}}}},animateCamera:function(t){if(null!==this.camera){var e=this.camera.mixer;null!==e&&void 0!==this.camera.center&&!0===this.doCameraAnimation&&(e.update(t),this.camera.updateProjectionMatrix(),this.camera.up.set(0,1,0),this.camera.up.applyQuaternion(this.camera.quaternion),this.camera.lookAt(this.camera.center))}},poseAsVpd:function(t,e,n){void 0===n&&(n={}),!0!==n.preventResetPose&&t.pose();for(var r=t.skeleton.bones,i=e.bones,o={},a=0;a<r.length;a++)o[r[a].name]=a;var s=new ss,c=new cs;for(a=0;a<i.length;a++){var u=i[a],l=o[u.name];if(void 0!==l){var h=r[l],d=u.translation,p=u.quaternion;s.set(d[0],d[1],d[2]),c.set(p[0],p[1],p[2],p[3]),h.position.add(s),h.quaternion.multiply(c)}}t.updateMatrixWorld(!0),!0!==n.preventIk&&new tu(t).update(n.saveOriginalBonesBeforeIK),!0!==n.preventGrant&&void 0!==t.geometry.grants&&new Vp(t).update()},initBackupBones:function(t){t.skeleton.backupBones=[];for(var e=0;e<t.skeleton.bones.length;e++)t.skeleton.backupBones.push(t.skeleton.bones[e].clone())},backupBones:function(t){t.skeleton.backupBoneIsSaved=!0;for(var e=0;e<t.skeleton.bones.length;e++){var n=t.skeleton.backupBones[e],r=t.skeleton.bones[e];n.position.copy(r.position),n.quaternion.copy(r.quaternion)}},restoreBones:function(t){if(!0===t.skeleton.backupBoneIsSaved){t.skeleton.backupBoneIsSaved=!1;for(var e=0;e<t.skeleton.bones.length;e++){var n=t.skeleton.bones[e],r=t.skeleton.backupBones[e];n.position.copy(r.position),n.quaternion.copy(r.quaternion)}}}};var Hp=function(t){this.manager=void 0!==t?t:Hu};Hp.prototype={constructor:Hp,load:function(t,e,n,r){var i=this,o=new Xu(this.manager);o.setPath(this.path),o.load(t,function(t){e(i.parse(t))},n,r)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn("MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split("\n"),n={},r=/\s+/,i={},o=0;o<e.length;o++){var a=e[o];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var s=a.indexOf(" "),c=s>=0?a.substring(0,s):a;c=c.toLowerCase();var u=s>=0?a.substring(s+1):"";if(u=u.trim(),"newmtl"===c)i[u]=n={name:u};else if(n)if("ka"===c||"kd"===c||"ks"===c){var l=u.split(r,3);n[c]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else n[c]=u}}var h=new Hp.MaterialCreator(this.texturePath||this.path,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(i),h}},(Hp.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:sc,this.wrap=this.options&&this.options.wrap?this.options.wrap:_c}).prototype={constructor:Hp.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var n in t){var r=t[n],i={};for(var o in e[n]=i,r){var a=!0,s=r[o],c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1)}a&&(i[c]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,n=this.materialsInfo[t],r={name:t,side:this.side};function i(t,n){if(!r[t]){var i,o,a=e.getTextureParams(n,r),s=e.loadTexture((i=e.baseUrl,"string"!=typeof(o=a.url)||""===o?"":/^https?:\/\//i.test(o)?o:i+o));s.repeat.copy(a.scale),s.offset.copy(a.offset),s.wrapS=e.wrap,s.wrapT=e.wrap,r[t]=s}}for(var o in n){var a,s=n[o];if(""!==s)switch(o.toLowerCase()){case"kd":r.color=(new Ts).fromArray(s);break;case"ks":r.specular=(new Ts).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"ns":r.shininess=parseFloat(s);break;case"d":(a=parseFloat(s))<1&&(r.opacity=a,r.transparent=!0);break;case"tr":a=parseFloat(s),this.options&&this.options.invertTrProperty&&(a=1-a),a<1&&(r.opacity=a,r.transparent=!0)}}return this.materials[t]=new Qu(r),this.materials[t]},getTextureParams:function(t,e){var n,r={scale:new Cs(1,1),offset:new Cs(0,0)},i=t.split(/\s+/);return(n=i.indexOf("-bm"))>=0&&(e.bumpScale=parseFloat(i[n+1]),i.splice(n,2)),(n=i.indexOf("-s"))>=0&&(r.scale.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),(n=i.indexOf("-o"))>=0&&(r.offset.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),r.url=i.join(" ").trim(),r},loadTexture:function(t,e,n,r,i){var o,a=cl.Handlers.get(t);return null===a&&(a=new sl(void 0!==this.manager?this.manager:Hu)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin),o=a.load(t,n,r,i),void 0!==e&&(o.mapping=e),o}};var Wp=function(t){this.uuid=os.generateUUID(),this.name="",this.allows={},this.type=t,this.userData={}};Wp.prototype.isNode=!0,Wp.prototype.parse=function(t,e){e=e||{},t.parsing=!0;var n=t.material;this.build(t.addCache(e.cache,e.requires).addSlot(e.slot),"v4"),n.clearVertexNode(),n.clearFragmentNode(),t.removeCache().removeSlot(),t.parsing=!1},Wp.prototype.parseAndBuildCode=function(t,e,n){return this.parse(t,n=n||{}),this.buildCode(t,e,n)},Wp.prototype.buildCode=function(t,e,n){var r=t.material,i={result:this.build(t.addCache((n=n||{}).cache,n.requires).addSlot(n.slot),e)};return i.code=t.isShader("vertex")?r.clearVertexNode():r.clearFragmentNode(),t.removeCache().removeSlot(),i},Wp.prototype.build=function(t,e,n){e=e||this.getType(t,e);var r=t.material,i=r.getDataNode(n||this.uuid);if(t.parsing&&this.appendDepsNode(t,i,e),!1===this.allows[t.shader])throw new Error("Shader "+shader+" is not compatible with this node.");return-1===r.nodes.indexOf(this)&&r.nodes.push(this),void 0!==this.updateFrame&&-1===r.updaters.indexOf(this)&&r.updaters.push(this),this.generate(t,e,n)},Wp.prototype.appendDepsNode=function(t,e,n){e.deps=(e.deps||0)+1;var r=t.getFormatLength(n);(r>(e.outputMax||0)||this.getType(t,n))&&(e.outputMax=r,e.output=n)},Wp.prototype.getType=function(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type},Wp.prototype.getJSONNode=function(t){if(void 0!==t&&"string"!=typeof t&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]},Wp.prototype.createJSONNode=function(t){var e=void 0===t||"string"==typeof t,n={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return n.uuid=this.uuid,n.type=this.nodeType+"Node",""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.nodes[this.uuid]=n),n},Wp.prototype.toJSON=function(t){return this.getJSONNode(t)||this.createJSONNode(t)};var Xp=function(t,e){Wp.call(this,t),this.shared=void 0===(e=e||{}).shared||e.shared,this.unique=void 0!==e.unique&&e.unique};(Xp.prototype=Object.create(Wp.prototype)).constructor=Xp,Xp.prototype.build=function(t,e,n,r){e=e||this.getType(t);var i=t.material;if(this.isShared(t,e)){var o=this.isUnique(t,e);o&&void 0===this.constructor.uuid&&(this.constructor.uuid=os.generateUUID()),n=t.getUuid(n||this.getUuid(),!o);var a=i.getDataNode(n);if(t.parsing)return a.deps?(this.appendDepsNode(t,a,e),this.generate(t,c,n)):Wp.prototype.build.call(this,t,e,n);if(o)return a.name=a.name||Wp.prototype.build.call(this,t,e,n),a.name;if(!t.optimize||1==a.deps)return Wp.prototype.build.call(this,t,e,n);n=this.getUuid(!1);var s=this.getTemp(t,n),c=a.output||this.getType(t);if(s)return t.format(s,c,e);s=Xp.prototype.generate.call(this,t,e,n,a.output,r);var u=this.generate(t,c,n);return t.isShader("vertex")?i.addVertexNode(s+"="+u+";"):i.addFragmentNode(s+"="+u+";"),t.format(s,c,e)}return Wp.prototype.build.call(this,t,e,n)},Xp.prototype.isShared=function(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared},Xp.prototype.isUnique=function(t,e){return this.unique},Xp.prototype.getUuid=function(t){var e=(t||void 0==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e},Xp.prototype.getTemp=function(t,e){e=e||this.uuid;var n=t.material;return t.isShader("vertex")&&n.vertexTemps[e]?n.vertexTemps[e].name:n.fragmentTemps[e]?n.fragmentTemps[e].name:void 0},Xp.prototype.generate=function(t,e,n,r,i){return this.isShared(t,e)||console.error("TempNode is not shared!"),n=n||this.uuid,t.isShader("vertex")?t.material.getVertexTemp(n,r||this.getType(t),i).name:t.material.getFragmentTemp(n,r||this.getType(t),i).name};var qp=function(t,e,n,r){t=t||"",this.isMethod="string"!=typeof e,this.useKeywords=!0,Xp.call(this,this.isMethod?null:e),this.isMethod?this.eval(t,e,n,r):this.eval(t,n,r)};qp.rDeclaration=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\((.*?)\)/i,qp.rProperties=/[a-z_0-9]+/gi,(qp.prototype=Object.create(Xp.prototype)).constructor=qp,qp.prototype.eval=function(t,e,n,r){if(t=(t||"").trim(),this.includes=e||[],this.extensions=n||{},this.keywords=r||{},this.isMethod){var i=t.match(qp.rDeclaration);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var o=i[3].match(qp.rProperties);if(o)for(var a=0;a<o.length;){var s,c,u=o[a++];"in"==u||"out"==u||"inout"==u?s=o[a++]:(s=u,u=""),c=o[a++],this.inputs.push({name:c,type:s,qualifier:u})}}else this.type="",this.name=""}this.value=t};var Yp={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,e,n){this.keywords[t]={callback:e,cache:n=void 0===n||n}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,e){return this.keywords[t].callback.call(this,e)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!=this.nodes[t]},containsKeyword:function(t){return void 0!=this.keywords[t]}},Zp=function(t){Xp.call(this,"v2",{shared:!1}),this.index=t||0};Zp.vertexDict=["uv","uv2"],Zp.fragmentDict=["vUv","vUv2"],(Zp.prototype=Object.create(Xp.prototype)).constructor=Zp,Zp.prototype.nodeType="UV",Zp.prototype.generate=function(t,e){var n;return t.material.requires.uv[this.index]=!0,n=t.isShader("vertex")?Zp.vertexDict[this.index]:Zp.fragmentDict[this.index],t.format(n,this.getType(t),e)},Zp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e};var Jp=function(t){Xp.call(this,"v3"),this.scope=t||Jp.LOCAL};Jp.LOCAL="local",Jp.WORLD="world",Jp.VIEW="view",Jp.PROJECTION="projection",Jp.prototype=Object.create(Xp.prototype),Jp.prototype.constructor=Jp,Jp.prototype.nodeType="Position",Jp.prototype.getType=function(t){switch(this.scope){case Jp.PROJECTION:return"v4"}return this.type},Jp.prototype.isShared=function(t){switch(this.scope){case Jp.LOCAL:case Jp.WORLD:return!1}return!0},Jp.prototype.generate=function(t,e){var n,r=t.material;switch(this.scope){case Jp.LOCAL:r.requires.position=!0,n=t.isShader("vertex")?"transformed":"vPosition";break;case Jp.WORLD:r.requires.worldPosition=!0,t.isShader("vertex"),n="vWPosition";break;case Jp.VIEW:n=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Jp.PROJECTION:n=t.isShader("vertex")?"(projectionMatrix * modelViewMatrix * vec4( position, 1.0 ))":"vec4( 0.0 )"}return t.format(n,this.getType(t),e)},Jp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Qp=function(t){Xp.call(this,"v3"),this.scope=t||Qp.LOCAL};Qp.LOCAL="local",Qp.WORLD="world",Qp.VIEW="view",Qp.prototype=Object.create(Xp.prototype),Qp.prototype.constructor=Qp,Qp.prototype.nodeType="Normal",Qp.prototype.isShared=function(t){switch(this.scope){case Qp.WORLD:return!0}return!1},Qp.prototype.generate=function(t,e){var n,r=t.material;switch(this.scope){case Qp.LOCAL:r.requires.normal=!0,n=t.isShader("vertex")?"normal":"vObjectNormal";break;case Qp.WORLD:r.requires.worldNormal=!0,n=t.isShader("vertex")?"( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz":"vWNormal";break;case Qp.VIEW:n="vNormal"}return t.format(n,this.getType(t),e)},Qp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Kp=function(t,e){(e=e||{}).shared=void 0!==e.shared&&e.shared,Xp.call(this,t,e),this.readonly=!1};(Kp.prototype=Object.create(Xp.prototype)).constructor=Kp,Kp.prototype.isReadonly=function(t){return this.readonly},Kp.prototype.generate=function(t,e,n,r,i,o){var a=t.material;n=t.getUuid(n||this.getUuid()),r=r||this.getType(t);var s=a.getDataNode(n);return this.isReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,e,n,r,i,o):t.isShader("vertex")?(s.vertex||(s.vertex=a.createVertexUniform(r,this.value,i,o)),t.format(s.vertex.name,r,e)):(s.fragment||(s.fragment=a.createFragmentUniform(r,this.value,i,o)),t.format(s.fragment.name,r,e))};var $p=function(t){Kp.call(this,"fv1"),this.value=[t||0]};($p.prototype=Object.create(Kp.prototype)).constructor=$p,$p.prototype.nodeType="Float",Object.defineProperties($p.prototype,{number:{get:function(){return this.value[0]},set:function(t){this.value[0]=t}}}),$p.prototype.generateReadonly=function(t,e,n,r,i,o){var a=this.number;return t.format(Math.floor(a)!==a?a:a+".0",r,e)},$p.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).number=this.number,!0===this.readonly&&(e.readonly=!0)),e};var tf=function(t,e){$p.call(this),this.scale=void 0!==t?t:1,this.scope=e||tf.GLOBAL,this.timeScale=1!==this.scale};tf.GLOBAL="global",tf.LOCAL="local",tf.DELTA="delta",tf.prototype=Object.create($p.prototype),tf.prototype.constructor=tf,tf.prototype.nodeType="Timer",tf.prototype.isReadonly=function(t){return!1},tf.prototype.isUnique=function(t){return this.timeScale&&(this.scope===tf.GLOBAL||this.scope===tf.DELTA)},tf.prototype.updateFrame=function(t){var e=this.timeScale?this.scale:1;switch(this.scope){case tf.LOCAL:this.number+=t.delta*e;break;case tf.DELTA:this.number=t.delta*e;break;default:this.number=t.time*e}},tf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale),e};var ef=function(t,e){Xp.call(this),this.eval(t||ef.PI,e)};ef.PI="PI",ef.PI2="PI2",ef.RECIPROCAL_PI="RECIPROCAL_PI",ef.RECIPROCAL_PI2="RECIPROCAL_PI2",ef.LOG2="LOG2",ef.EPSILON="EPSILON",ef.prototype=Object.create(Xp.prototype),ef.prototype.constructor=ef,ef.prototype.nodeType="Const",ef.prototype.getType=function(t){return t.getTypeByFormat(this.type)},ef.prototype.eval=function(t,e){var n,r,i="",o=(t=(t||"").trim()).match(/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i);this.useDefine=e,o&&o.length>1?(r=o[1],n=o[2],i=o[3]):(n=t,r="fv1"),this.name=n,this.type=r,this.value=i},ef.prototype.build=function(t,e){return"source"!==e?(t.include(this),t.format(this.name,this.getType(t),e)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":void 0},ef.prototype.generate=function(t,e){return t.format(this.name,this.getType(t),e)},ef.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).name=this.name,e.out=this.type,this.value&&(e.value=this.value),!0===e.useDefine&&(e.useDefine=!0)),e},Yp.addKeyword("uv",function(){return new Zp}),Yp.addKeyword("uv2",function(){return new Zp(1)}),Yp.addKeyword("position",function(){return new Jp}),Yp.addKeyword("worldPosition",function(){return new Jp(Jp.WORLD)}),Yp.addKeyword("normal",function(){return new Qp}),Yp.addKeyword("worldNormal",function(){return new Qp(Qp.WORLD)}),Yp.addKeyword("viewPosition",function(){return new Jp(Qp.VIEW)}),Yp.addKeyword("viewNormal",function(){return new Qp(Qp.VIEW)}),Yp.addKeyword("time",function(){return new tf}),Yp.add(new ef("vec3 LUMA vec3(0.2125, 0.7154, 0.0721)")),Yp.add(new qp(["vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 mUv, vec2 scale ) {","\tvec3 q0 = dFdx( eye_pos );","\tvec3 q1 = dFdy( eye_pos );","\tvec2 st0 = dFdx( mUv.st );","\tvec2 st1 = dFdy( mUv.st );","\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );","\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );","\tvec3 N = normalize( surf_norm );","\tvec3 mapN = map * 2.0 - 1.0;","\tmapN.xy = scale * mapN.xy;","\tmat3 tsn = mat3( S, T, N );","\treturn normalize( tsn * mapN );","}"].join("\n"),null,{derivatives:!0})),Yp.add(new qp(["float snoise(vec2 co) {","\treturn fract( sin( dot(co.xy, vec2(12.9898,78.233) ) ) * 43758.5453 );","}"].join("\n"))),Yp.add(new qp(["vec3 hue_rgb(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n"))),Yp.add(new qp(["vec3 saturation_rgb(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3(dot(rgb, LUMA));","\treturn mix(intensity, rgb, adjustment);","}"].join("\n"))),Yp.add(new qp(["float luminance_rgb(vec3 rgb) {","\treturn dot(rgb, LUMA);","}"].join("\n"))),Yp.add(new qp(["vec3 vibrance_rgb(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))),qp.prototype.isShared=function(t,e){return!this.isMethod},qp.prototype.getType=function(t){return t.getTypeByFormat(this.type)},qp.prototype.getInputByName=function(t){for(var e=this.inputs.length;e--;)if(this.inputs[e].name===t)return this.inputs[e]},qp.prototype.getIncludeByName=function(t){for(var e=this.includes.length;e--;)if(this.includes[e].name===t)return this.includes[e]},qp.prototype.generate=function(t,e){for(var n,r=0,i=this.value,o=0;o<this.includes.length;o++)t.include(this.includes[o],this);for(var a in this.extensions)t.material.extensions[a]=!0;for(;n=qp.rProperties.exec(this.value);){var s=n[0],c=!this.isMethod||!this.getInputByName(s),u=s;if(this.keywords[s]||this.useKeywords&&c&&Yp.containsKeyword(s)){var l=this.keywords[s];if(!l){var h=Yp.getKeywordData(s);h.cache&&(l=t.keywords[s]),l=l||Yp.getKeyword(s,t),h.cache&&(t.keywords[s]=l)}u=l.build(t)}s!=u&&(i=i.substring(0,n.index+r)+u+i.substring(n.index+s.length+r),r+=u.length-s.length),void 0===this.getIncludeByName(u)&&Yp.contains(u)&&t.include(Yp.get(u))}return"source"===e?i:this.isMethod?(t.include(this,!1,i),this.name):t.format("("+i+")",this.getType(t),e)};var nf=function(t,e){Xp.call(this,"v3"),this.setScope(t||nf.POSITION),this.setCamera(e)};nf.fDepthColor=new qp(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n")),nf.POSITION="position",nf.DEPTH="depth",nf.TO_VERTEX="toVertex",nf.prototype=Object.create(Xp.prototype),nf.prototype.constructor=nf,nf.prototype.nodeType="Camera",nf.prototype.setCamera=function(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0},nf.prototype.setScope=function(t){switch(this.scope){case nf.DEPTH:delete this.near,delete this.far}switch(this.scope=t,t){case nf.DEPTH:var e=this.camera;this.near=new $p(e?e.near:1),this.far=new $p(e?e.far:1200)}},nf.prototype.getType=function(t){switch(this.scope){case nf.DEPTH:return"fv1"}return this.type},nf.prototype.isUnique=function(t){switch(this.scope){case nf.DEPTH:case nf.TO_VERTEX:return!0}return!1},nf.prototype.isShared=function(t){switch(this.scope){case nf.POSITION:return!1}return!0},nf.prototype.generate=function(t,e){var n;switch(this.scope){case nf.POSITION:n="cameraPosition";break;case nf.DEPTH:var r=nf.fDepthColor;t.include(r),n=r.name+"("+this.near.build(t,"fv1")+","+this.far.build(t,"fv1")+")";break;case nf.TO_VERTEX:n="normalize( "+new Jp(Jp.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(n,this.getType(t),e)},nf.prototype.onUpdateFrame=function(t){switch(this.scope){case nf.DEPTH:var e=this.camera;this.near.number=e.near,this.far.number=e.far}},nf.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e)switch((e=this.createJSONNode(t)).scope=this.scope,this.camera&&(e.camera=this.camera.uuid),this.scope){case nf.DEPTH:e.near=this.near.number,e.far=this.far.number}return e},Object.assign((function(t,e){this.manager=void 0!==t?t:Hu,this.nodes={},this.materials={},this.passes={},this.names={},this.library=e||{}}).prototype,{load:function(t,e,n,r){var i=this;return new Xu(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r),this},getObjectByName:function(t){return this.names[t]},getObjectById:function(t){return this.library[t]||this.nodes[t]||this.names[t]},getNode:function(t){var e=this.getObjectById(t);return e||console.warn('Node "'+t+'" not found.'),e},parse:function(t){var e,n,r,i,o;for(e in t.nodes)n=t.nodes[e],r=new THREE[n.type],n.name?(r.name=n.name,this.names[r.name]=r):r.readonly=!0,void 0!==n.readonly&&(r.readonly=n.readonly),this.nodes[e]=r;for(e in t.materials)n=t.materials[e],r=new THREE[n.type],n.name&&(r.name=n.name,this.names[r.name]=r),this.materials[e]=r;for(e in t.passes)n=t.passes[e],r=new THREE[n.type],n.name&&(r.name=n.name,this.names[r.name]=r),this.passes[e]=r;for(e in t.material&&(this.material=this.materials[e]),t.pass&&(this.pass=this.passes[e]),t.nodes)switch(r=this.nodes[e],(n=t.nodes[e]).type){case"FloatNode":r.number=n.number;break;case"ColorNode":r.value.copy(n);break;case"Vector2Node":r.x=n.x,r.y=n.y;break;case"Vector3Node":r.x=n.x,r.y=n.y,r.z=n.z;break;case"Vector4Node":r.x=n.x,r.y=n.y,r.z=n.z,r.w=n.w;break;case"Matrix3Node":case"Matrix4Node":r.value.fromArray(n.elements);break;case"OperatorNode":r.a=this.getNode(n.a),r.b=this.getNode(n.b),r.op=n.op;break;case"Math1Node":r.a=this.getNode(n.a),r.method=n.method;break;case"Math2Node":r.a=this.getNode(n.a),r.b=this.getNode(n.b),r.method=n.method;break;case"Math3Node":r.a=this.getNode(n.a),r.b=this.getNode(n.b),r.c=this.getNode(n.c),r.method=n.method;break;case"UVNode":case"ColorsNode":r.index=n.index;break;case"LuminanceNode":r.rgb=this.getNode(n.rgb);break;case"PositionNode":case"NormalNode":case"ReflectNode":case"LightNode":r.scope=n.scope;break;case"SwitchNode":r.node=this.getNode(n.node),r.components=n.components;break;case"JoinNode":for(i in n.inputs)r[i]=this.getNode(n.inputs[i]);break;case"CameraNode":switch(r.setScope(n.scope),n.camera&&r.setCamera(this.getNode(n.camera)),n.scope){case nf.DEPTH:r.near.number=n.near,r.far.number=n.far}break;case"ColorAdjustmentNode":r.rgb=this.getNode(n.rgb),r.adjustment=this.getNode(n.adjustment),r.method=n.method;break;case"UVTransformNode":r.uv=this.getNode(n.uv),r.transform=this.getNode(n.transform);break;case"BumpNode":r.value=this.getNode(n.value),r.coord=this.getNode(n.coord),r.scale=this.getNode(n.scale);break;case"BlurNode":r.value=this.getNode(n.value),r.coord=this.getNode(n.coord),r.scale=this.getNode(n.scale),r.value=this.getNode(n.value),r.coord=this.getNode(n.coord),r.radius=this.getNode(n.radius),void 0!==n.size&&(r.size=new Cs(n.size.x,n.size.y)),r.blurX=n.blurX,r.blurY=n.blurY;break;case"ResolutionNode":r.renderer=this.getNode(n.renderer);break;case"ScreenUVNode":r.resolution=this.getNode(n.resolution);break;case"VelocityNode":n.target&&r.setTarget(this.getNode(n.target)),r.setParams(n.params);break;case"TimerNode":r.scope=n.scope,r.scale=n.scale;break;case"ConstNode":r.name=n.name,r.type=n.out,r.value=n.value,r.useDefine=!0===n.useDefine;break;case"AttributeNode":case"VarNode":r.type=n.out;break;case"ReflectorNode":r.setMirror(this.getNode(n.mirror)),n.offset&&(r.offset=this.getNode(n.offset));break;case"NoiseNode":r.coord=this.getNode(n.coord);break;case"FunctionNode":for(i in r.isMethod=n.isMethod,r.useKeywords=n.useKeywords,r.extensions=n.extensions,r.keywords={},n.keywords)r.keywords[i]=this.getNode(n.keywords[i]);if(n.includes)for(o=0;o<n.includes.length;o++)r.includes.push(this.getNode(n.includes[o]));r.eval(n.src,r.includes,r.extensions,r.keywords),r.isMethod||(r.type=n.out);break;case"FunctionCallNode":for(i in n.inputs)r.inputs[i]=this.getNode(n.inputs[i]);r.value=this.getNode(n.value);break;case"TextureNode":case"CubeTextureNode":case"ScreenNode":n.value&&(r.value=this.getNode(n.value)),r.coord=this.getNode(n.coord),n.bias&&(r.bias=this.getNode(n.bias)),void 0!==r.project&&(r.project=n.project);break;case"RoughnessToBlinnExponentNode":break;case"RawNode":r.value=this.getNode(n.value);break;case"StandardNode":case"PhongNode":case"SpriteNode":r.color=this.getNode(n.color),n.alpha&&(r.alpha=this.getNode(n.alpha)),n.specular&&(r.specular=this.getNode(n.specular)),n.shininess&&(r.shininess=this.getNode(n.shininess)),n.roughness&&(r.roughness=this.getNode(n.roughness)),n.metalness&&(r.metalness=this.getNode(n.metalness)),n.reflectivity&&(r.reflectivity=this.getNode(n.reflectivity)),n.clearCoat&&(r.clearCoat=this.getNode(n.clearCoat)),n.clearCoatRoughness&&(r.clearCoatRoughness=this.getNode(n.clearCoatRoughness)),n.normal&&(r.normal=this.getNode(n.normal)),n.normalScale&&(r.normalScale=this.getNode(n.normalScale)),n.emissive&&(r.emissive=this.getNode(n.emissive)),n.ambient&&(r.ambient=this.getNode(n.ambient)),n.shadow&&(r.shadow=this.getNode(n.shadow)),n.light&&(r.light=this.getNode(n.light)),n.ao&&(r.ao=this.getNode(n.ao)),n.environment&&(r.environment=this.getNode(n.environment)),n.environmentAlpha&&(r.environmentAlpha=this.getNode(n.environmentAlpha)),n.transform&&(r.transform=this.getNode(n.transform)),!1===n.spherical&&(r.spherical=!1);break;default:console.warn(n.type,"not supported.")}for(e in t.materials)r=this.materials[e],void 0!==(n=t.materials[e]).name&&(r.name=n.name),void 0!==n.blending&&(r.blending=n.blending),void 0!==n.flatShading&&(r.flatShading=n.flatShading),void 0!==n.side&&(r.side=n.side),r.depthFunc=n.depthFunc,r.depthTest=n.depthTest,r.depthWrite=n.depthWrite,void 0!==n.wireframe&&(r.wireframe=n.wireframe),void 0!==n.wireframeLinewidth&&(r.wireframeLinewidth=n.wireframeLinewidth),void 0!==n.wireframeLinecap&&(r.wireframeLinecap=n.wireframeLinecap),void 0!==n.wireframeLinejoin&&(r.wireframeLinejoin=n.wireframeLinejoin),void 0!==n.skinning&&(r.skinning=n.skinning),void 0!==n.morphTargets&&(r.morphTargets=n.morphTargets),void 0!==n.visible&&(r.visible=n.visible),void 0!==n.userData&&(r.userData=n.userData),r.vertex=this.getNode(n.vertex),r.fragment=this.getNode(n.fragment),r.vertex===r.fragment&&(r.node=r.vertex),r.build(),void 0!==n.fog&&(r.fog=n.fog),void 0!==n.lights&&(r.lights=n.lights),void 0!==n.transparent&&(r.transparent=n.transparent);for(e in t.passes)(r=this.passes[e]).value=this.getNode((n=t.passes[e]).value),r.build();return this.material||this.pass||this}}),function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,n=/^usemtl /;function r(t){this.manager=void 0!==t?t:Hu,this.materials=null}r.prototype={constructor:r,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setPath(this.path),o.load(t,function(t){e(i.parse(t))},n,r)},setPath:function(t){this.path=t},setMaterials:function(t){return this.materials=t,this},parse:function(r){console.time("OBJLoader");var i=new function(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addColor:function(t,e,n){var r=this.colors,i=this.object.geometry.colors;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addUV:function(t,e,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[t+0],r[t+1]),i.push(r[e+0],r[e+1]),i.push(r[n+0],r[n+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,r,i,o,a,s,c){var u=this.vertices.length,l=this.parseVertexIndex(t,u),h=this.parseVertexIndex(e,u),d=this.parseVertexIndex(n,u);if(this.addVertex(l,h,d),void 0!==r&&""!==r){var p=this.uvs.length;l=this.parseUVIndex(r,p),h=this.parseUVIndex(i,p),d=this.parseUVIndex(o,p),this.addUV(l,h,d)}if(void 0!==a&&""!==a){var f=this.normals.length;l=this.parseNormalIndex(a,f),h=a===s?l:this.parseNormalIndex(s,f),d=a===c?l:this.parseNormalIndex(c,f),this.addNormal(l,h,d)}this.colors.length>0&&this.addColor(l,h,d)},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,n=0,r=t.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(t[n],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,i=0,o=t.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(t[i],n));var a=0;for(o=e.length;a<o;a++)this.addUVLine(this.parseUVIndex(e[a],r))}};return t.startObject("",!1),t};-1!==r.indexOf("\r\n")&&(r=r.replace(/\r\n/g,"\n")),-1!==r.indexOf("\\\n")&&(r=r.replace(/\\\n/g,""));for(var o=r.split("\n"),a="",s="",c=[],u="function"==typeof"".trimLeft,l=0,h=o.length;l<h;l++)if(a=o[l],0!==(a=u?a.trimLeft():a.trim()).length&&"#"!==(s=a.charAt(0)))if("v"===s){var d=a.split(/\s+/);switch(d[0]){case"v":i.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&i.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":i.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":i.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===s){for(var p=a.substr(1).trim().split(/\s+/),f=[],m=0,v=p.length;m<v;m++){var g=p[m];if(g.length>0){var y=g.split("/");f.push(y)}}var b=f[0];for(m=1,v=f.length-1;m<v;m++){var x=f[m],w=f[m+1];i.addFace(b[0],x[0],w[0],b[1],x[1],w[1],b[2],x[2],w[2])}}else if("l"===s){var _=a.substring(1).trim().split(" "),S=[],T=[];if(-1===a.indexOf("/"))S=_;else for(var M=0,A=_.length;M<A;M++){var E=_[M].split("/");""!==E[0]&&S.push(E[0]),""!==E[1]&&T.push(E[1])}i.addLineGeometry(S,T)}else if("p"===s){var C=a.substr(1).trim().split(" ");i.addPointGeometry(C)}else if(null!==(c=t.exec(a))){var P=(" "+c[0].substr(1).trim()).substr(1);i.startObject(P)}else if(n.test(a))i.object.startMaterial(a.substring(7).trim(),i.materialLibraries);else if(e.test(a))i.materialLibraries.push(a.substring(7).trim());else{if("s"!==s){if("\0"===a)continue;throw new Error('OBJLoader: Unexpected line: "'+a+'"')}if((c=a.split(" ")).length>1){var O=c[1].trim().toLowerCase();i.object.smooth="0"!==O&&"off"!==O}else i.object.smooth=!0;(H=i.object.currentMaterial())&&(H.smooth=i.object.smooth)}i.finalize();var N=new gd;for(N.materialLibraries=[].concat(i.materialLibraries),l=0,h=i.objects.length;l<h;l++){var L=i.objects[l],I=L.geometry,R=L.materials,D="Line"===I.type,F="Points"===I.type,U=!1;if(0!==I.vertices.length){var k=new Xs;k.addAttribute("position",new Vs(I.vertices,3)),I.normals.length>0?k.addAttribute("normal",new Vs(I.normals,3)):k.computeVertexNormals(),I.colors.length>0&&(U=!0,k.addAttribute("color",new Vs(I.colors,3))),I.uvs.length>0&&k.addAttribute("uv",new Vs(I.uvs,2));for(var j,B=[],z=0,V=R.length;z<V;z++){var G=R[z],H=void 0;if(null!==this.materials)if(H=this.materials.create(G.name),!D||!H||H instanceof qc){if(F&&H&&!(H instanceof el)){var W=new el({size:10,sizeAttenuation:!1});X.copy(H),H=W}}else{var X=new qc;X.copy(H),X.lights=!1,H=X}H||((H=D?new qc:F?new el({size:1,sizeAttenuation:!1}):new Qu).name=G.name),H.flatShading=!G.smooth,H.vertexColors=U?dc:lc,B.push(H)}if(B.length>1){for(z=0,V=R.length;z<V;z++)k.addGroup((G=R[z]).groupStart,G.groupCount,z);j=D?new Bd(k,B):F?new Zh(k,B):new Kc(k,B)}else j=D?new Bd(k,B[0]):F?new Zh(k,B[0]):new Kc(k,B[0]);j.name=L.name,N.add(j)}}return console.timeEnd("OBJLoader"),N}}}(),void 0===Cp&&console.error('"LoaderSupport" is not available. "OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.'),function(){var t="2.4.0",e=Cp.Validator;function n(n){console.info("Using OBJLoader2 version: "+t),this.manager=e.verifyInput(n,Hu),this.logging={enabled:!0,debug:!1},this.modelName="",this.instanceNo=0,this.path="",this.useIndices=!1,this.disregardNormals=!1,this.materialPerSmoothingGroup=!1,this.loaderRootNode=new gd,this.meshBuilder=new Cp.MeshBuilder,this.callbacks=new Cp.Callbacks,this.workerSupport=new Cp.WorkerSupport,this.terminateWorkerOnLoad=!0}n.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e,this.meshBuilder.setLogging(this.logging.enabled,this.logging.debug)},n.prototype.setModelName=function(t){this.modelName=e.verifyInput(t,this.modelName)},n.prototype.setPath=function(t){this.path=e.verifyInput(t,this.path)},n.prototype.setStreamMeshesTo=function(t){this.loaderRootNode=e.verifyInput(t,this.loaderRootNode)},n.prototype.setMaterials=function(t){this.meshBuilder.setMaterials(t)},n.prototype.setUseIndices=function(t){this.useIndices=!0===t},n.prototype.setDisregardNormals=function(t){this.disregardNormals=!0===t},n.prototype.setMaterialPerSmoothingGroup=function(t){this.materialPerSmoothingGroup=!0===t},n.prototype._setCallbacks=function(t){e.isValid(t.onProgress)&&this.callbacks.setCallbackOnProgress(t.onProgress),e.isValid(t.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(t.onMeshAlter),e.isValid(t.onLoad)&&this.callbacks.setCallbackOnLoad(t.onLoad),e.isValid(t.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(t.onLoadMaterials),this.meshBuilder._setCallbacks(this.callbacks)},n.prototype.onProgress=function(t,n,r){var i=e.isValid(n)?n:"",o={detail:{type:t,modelName:this.modelName,instanceNo:this.instanceNo,text:i,numericalValue:r}};e.isValid(this.callbacks.onProgress)&&this.callbacks.onProgress(o),this.logging.enabled&&this.logging.debug&&console.debug(i)},n.prototype._onError=function(t){var e="Error occurred while downloading!";throw t.currentTarget&&null!==t.currentTarget.statusText&&(e+="\nurl: "+t.currentTarget.responseURL+"\nstatus: "+t.currentTarget.statusText),this.onProgress("error",e,-1),e},n.prototype.load=function(t,e,n,r,i,o){var a=new Cp.ResourceDescriptor(t,"OBJ");this._loadObj(a,e,n,r,i,o)},n.prototype._loadObj=function(t,n,r,i,o,a){e.isValid(i)||(i=this._onError),e.isValid(t)||i("An invalid ResourceDescriptor was provided. Unable to continue!");var s=this,c=function(e){if(t.content=e,a)s.parseAsync(e,n);else{var r=new Cp.Callbacks;r.setCallbackOnMeshAlter(o),s._setCallbacks(r),n({detail:{loaderRootNode:s.parse(e),modelName:s.modelName,instanceNo:s.instanceNo}})}};if(!e.isValid(t.url)||e.isValid(t.content))c(e.isValid(t.content)?t.content:null);else{if(!e.isValid(r)){var u=0,l=0;r=function(e){if(e.lengthComputable&&(l=e.loaded/e.total)>u){u=l;var n='Download of "'+t.url+'": '+(100*l).toFixed(2)+"%";s.onProgress("progressLoad",n,l)}}}var h=new Xu(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(t.url,c,r,i)}},n.prototype.run=function(t,n){this._applyPrepData(t);var r=t.checkResourceDescriptorFiles(t.resources,[{ext:"obj",type:"ArrayBuffer",ignore:!1},{ext:"mtl",type:"String",ignore:!1},{ext:"zip",type:"String",ignore:!0}]);e.isValid(n)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=n,this.logging.enabled=this.workerSupport.logging.enabled,this.logging.debug=this.workerSupport.logging.debug);var i=this;this._loadMtl(r.mtl,function(e){null!==e&&i.meshBuilder.setMaterials(e),i._loadObj(r.obj,i.callbacks.onLoad,null,null,i.callbacks.onMeshAlter,t.useAsync)},t.crossOrigin,t.materialOptions)},n.prototype._applyPrepData=function(t){e.isValid(t)&&(this.setLogging(t.logging.enabled,t.logging.debug),this.setModelName(t.modelName),this.setStreamMeshesTo(t.streamMeshesTo),this.meshBuilder.setMaterials(t.materials),this.setUseIndices(t.useIndices),this.setDisregardNormals(t.disregardNormals),this.setMaterialPerSmoothingGroup(t.materialPerSmoothingGroup),this._setCallbacks(t.getCallbacks()))},n.prototype.parse=function(t){if(!e.isValid(t))return console.warn("Provided content is not a valid ArrayBuffer or String."),this.loaderRootNode;this.logging.enabled&&console.time("OBJLoader2 parse: "+this.modelName),this.meshBuilder.init();var n=new r;n.setLogging(this.logging.enabled,this.logging.debug),n.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),n.setUseIndices(this.useIndices),n.setDisregardNormals(this.disregardNormals),n.setMaterials(this.meshBuilder.getMaterials());var i=this;if(n.setCallbackMeshBuilder(function(t){var e=i.meshBuilder.processPayload(t);for(var n in e)i.loaderRootNode.add(e[n])}),n.setCallbackProgress(function(t,e){i.onProgress("progressParse",t,e)}),t instanceof ArrayBuffer||t instanceof Uint8Array)this.logging.enabled&&console.info("Parsing arrayBuffer..."),n.parse(t);else{if(!("string"==typeof t||t instanceof String))throw"Provided content was neither of type String nor Uint8Array! Aborting...";this.logging.enabled&&console.info("Parsing text..."),n.parseText(t)}return this.logging.enabled&&console.timeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},n.prototype.parseAsync=function(t,n){var i=this,o=!1,a=function(){n({detail:{loaderRootNode:i.loaderRootNode,modelName:i.modelName,instanceNo:i.instanceNo}}),o&&i.logging.enabled&&console.timeEnd("OBJLoader2 parseAsync: "+i.modelName)};e.isValid(t)?o=!0:(console.warn("Provided content is not a valid ArrayBuffer."),a()),o&&this.logging.enabled&&console.time("OBJLoader2 parseAsync: "+this.modelName),this.meshBuilder.init(),this.workerSupport.validate(function(t,n){var i="";return i+="\n\n",i+="var LoaderSupport = {};\n\n",(i+=t("LoaderSupport.Validator",e))+n("Parser",r)},"Parser"),this.workerSupport.setCallbacks(function(t){var e=i.meshBuilder.processPayload(t);for(var n in e)i.loaderRootNode.add(e[n])},a),i.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var s={},c=this.meshBuilder.getMaterials();for(var u in c)s[u]=u;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logging:{enabled:this.logging.enabled,debug:this.logging.debug},materials:{materials:s},data:{input:t,options:null}})};var r=function(){function t(){this.callbackProgress=null,this.callbackMeshBuilder=null,this.contentRef=null,this.legacyMode=!1,this.materials={},this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0},this.logging={enabled:!0,debug:!1}}return t.prototype.resetRawMesh=function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this.pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},t.prototype.setUseAsync=function(t){this.useAsync=t},t.prototype.setMaterialPerSmoothingGroup=function(t){this.materialPerSmoothingGroup=t},t.prototype.setUseIndices=function(t){this.useIndices=t},t.prototype.setDisregardNormals=function(t){this.disregardNormals=t},t.prototype.setMaterials=function(t){this.materials=Cp.Validator.verifyInput(t,this.materials),this.materials=Cp.Validator.verifyInput(this.materials,{})},t.prototype.setCallbackMeshBuilder=function(t){if(!Cp.Validator.isValid(t))throw'Unable to run as no "MeshBuilder" callback is set.';this.callbackMeshBuilder=t},t.prototype.setCallbackProgress=function(t){this.callbackProgress=t},t.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},t.prototype.configure=function(){if(this.pushSmoothingGroup(1),this.logging.enabled){var t=Object.keys(this.materials),e=t.length>0?"\n\tmaterialNames:\n\t\t- "+t.join("\n\t\t- "):"\n\tmaterialNames: None";console.info("OBJLoader2.Parser configuration:"+e+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackMeshBuilderName: "+this.callbackMeshBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name)}},t.prototype.parse=function(t){this.logging.enabled&&console.time("OBJLoader2.Parser.parse"),this.configure();var e=new Uint8Array(t);this.contentRef=e;var n=e.byteLength;this.globalCounts.totalBytes=n;for(var r,i=new Array(128),o="",a=0,s=0,c=0;c<n;c++)switch(r=e[c]){case 32:o.length>0&&(i[a++]=o),o="";break;case 47:o.length>0&&(i[a++]=o),s++,o="";break;case 10:o.length>0&&(i[a++]=o),o="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=c,this.processLine(i,a,s),a=0,s=0;break;case 13:break;default:o+=String.fromCharCode(r)}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parse")},t.prototype.parseText=function(t){this.logging.enabled&&console.time("OBJLoader2.Parser.parseText"),this.configure(),this.legacyMode=!0,this.contentRef=t;var e=t.length;this.globalCounts.totalBytes=e;for(var n,r=new Array(128),i="",o=0,a=0,s=0;s<e;s++)switch(n=t[s]){case" ":i.length>0&&(r[o++]=i),i="";break;case"/":i.length>0&&(r[o++]=i),a++,i="";break;case"\n":i.length>0&&(r[o++]=i),i="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=s,this.processLine(r,o,a),o=0,a=0;break;case"\r":break;default:i+=n}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parseText")},t.prototype.processLine=function(t,e,n){if(!(e<1)){var r,i,o,a,s=function(t,e,n,r){var i="";if(r>n){var o;if(e)for(o=n;o<r;o++)i+=t[o];else for(o=n;o<r;o++)i+=String.fromCharCode(t[o]);i=i.trim()}return i};switch(a=t[0]){case"v":this.vertices.push(parseFloat(t[1])),this.vertices.push(parseFloat(t[2])),this.vertices.push(parseFloat(t[3])),e>4&&(this.colors.push(parseFloat(t[4])),this.colors.push(parseFloat(t[5])),this.colors.push(parseFloat(t[6])));break;case"vt":this.uvs.push(parseFloat(t[1])),this.uvs.push(parseFloat(t[2]));break;case"vn":this.normals.push(parseFloat(t[1])),this.normals.push(parseFloat(t[2])),this.normals.push(parseFloat(t[3]));break;case"f":if(r=e-1,0===n)for(this.checkFaceType(0),o=2,i=r;o<i;o++)this.buildFace(t[1]),this.buildFace(t[o]),this.buildFace(t[o+1]);else if(r===2*n)for(this.checkFaceType(1),o=3,i=r-2;o<i;o+=2)this.buildFace(t[1],t[2]),this.buildFace(t[o],t[o+1]),this.buildFace(t[o+2],t[o+3]);else if(2*r==3*n)for(this.checkFaceType(2),o=4,i=r-3;o<i;o+=3)this.buildFace(t[1],t[2],t[3]),this.buildFace(t[o],t[o+1],t[o+2]),this.buildFace(t[o+3],t[o+4],t[o+5]);else for(this.checkFaceType(3),o=3,i=r-2;o<i;o+=2)this.buildFace(t[1],void 0,t[2]),this.buildFace(t[o],void 0,t[o+1]),this.buildFace(t[o+2],void 0,t[o+3]);break;case"l":case"p":if((r=e-1)==2*n)for(this.checkFaceType(4),o=1,i=r+1;o<i;o+=2)this.buildFace(t[o],t[o+1]);else for(this.checkFaceType("l"===a?5:6),o=1,i=r+1;o<i;o++)this.buildFace(t[o]);break;case"s":this.pushSmoothingGroup(t[1]);break;case"g":this.processCompletedMesh(),this.rawMesh.groupName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.rawMesh.objectName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var c=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==c&&this.rawMesh.activeMtlName!==c&&(this.rawMesh.activeMtlName=c,this.rawMesh.counts.mtlCount++,this.checkSubGroup())}}},t.prototype.pushSmoothingGroup=function(t){var e=parseInt(t);isNaN(e)&&(e="off"===t?0:1);var n=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?e:0===e?0:1,this.rawMesh.smoothingGroup.real=e,n!==e&&(this.rawMesh.counts.smoothingGroupCount++,this.checkSubGroup())},t.prototype.checkFaceType=function(t){this.rawMesh.faceType!==t&&(this.processCompletedMesh(),this.rawMesh.faceType=t,this.checkSubGroup())},t.prototype.checkSubGroup=function(){var t=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[t],Cp.Validator.isValid(this.rawMesh.subGroupInUse)||(this.rawMesh.subGroupInUse={index:t,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[t]=this.rawMesh.subGroupInUse)},t.prototype.buildFace=function(t,e,n){this.disregardNormals&&(n=void 0);var r=this,i=function(){var i=parseInt(t),o=3*(i>0?i-1:i+r.vertices.length/3),a=r.rawMesh.subGroupInUse.vertices;a.push(r.vertices[o++]),a.push(r.vertices[o++]),a.push(r.vertices[o]);var s=r.colors.length>0?o:null;if(null!==s){var c=r.rawMesh.subGroupInUse.colors;c.push(r.colors[s++]),c.push(r.colors[s++]),c.push(r.colors[s])}if(e){var u=parseInt(e),l=2*(u>0?u-1:u+r.uvs.length/2),h=r.rawMesh.subGroupInUse.uvs;h.push(r.uvs[l++]),h.push(r.uvs[l])}if(n){var d=parseInt(n),p=3*(d>0?d-1:d+r.normals.length/3),f=r.rawMesh.subGroupInUse.normals;f.push(r.normals[p++]),f.push(r.normals[p++]),f.push(r.normals[p])}};if(this.useIndices){var o=t+(e?"_"+e:"_n")+(n?"_"+n:"_n"),a=this.rawMesh.subGroupInUse.indexMappings[o];Cp.Validator.isValid(a)?this.rawMesh.counts.doubleIndicesCount++:(a=this.rawMesh.subGroupInUse.vertices.length/3,i(),this.rawMesh.subGroupInUse.indexMappings[o]=a,this.rawMesh.subGroupInUse.indexMappingsCount++),this.rawMesh.subGroupInUse.indices.push(a)}else i();this.rawMesh.counts.faceCount++},t.prototype.createRawMeshReport=function(t){return"Input Object number: "+t+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},t.prototype.finalizeRawMesh=function(){var t,e,n=[],r=0,i=0,o=0,a=0,s=0,c=0;for(var u in this.rawMesh.subGroups)if((t=this.rawMesh.subGroups[u]).vertices.length>0){if((e=t.indices).length>0&&i>0)for(var l in e)e[l]=e[l]+i;n.push(t),r+=t.vertices.length,i+=t.indexMappingsCount,o+=t.indices.length,a+=t.colors.length,c+=t.uvs.length,s+=t.normals.length}var h=null;return n.length>0&&(h={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:n,absoluteVertexCount:r,absoluteIndexCount:o,absoluteColorCount:a,absoluteNormalCount:s,absoluteUvCount:c,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),h},t.prototype.processCompletedMesh=function(){var t=this.finalizeRawMesh();if(Cp.Validator.isValid(t)){if(this.colors.length>0&&this.colors.length!==this.vertices.length)throw"Vertex Colors were detected, but vertex count and color count do not match!";this.logging.enabled&&this.logging.debug&&console.debug(this.createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(t);var e=this.globalCounts.currentByte/this.globalCounts.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*e).toFixed(2)+"%",e),this.resetRawMesh(),!0}return!1},t.prototype.buildMesh=function(t){var e=t.subGroups,n=new Float32Array(t.absoluteVertexCount);this.globalCounts.vertices+=t.absoluteVertexCount/3,this.globalCounts.faces+=t.faceCount,this.globalCounts.doubleIndicesCount+=t.doubleIndicesCount;var r,i,o,a,s,c,u=t.absoluteIndexCount>0?new Uint32Array(t.absoluteIndexCount):null,l=t.absoluteColorCount>0?new Float32Array(t.absoluteColorCount):null,h=t.absoluteNormalCount>0?new Float32Array(t.absoluteNormalCount):null,d=t.absoluteUvCount>0?new Float32Array(t.absoluteUvCount):null,p=Cp.Validator.isValid(l),f=[],m=e.length>1,v=0,g=[],y=[],b=0,x=0,w=0,_=0,S=0,T=0,M=0;for(var A in e)if(e.hasOwnProperty(A)){if(c=(r=e[A]).materialName,a=this.materials[s=this.rawMesh.faceType<4?c+(p?"_vertexColor":"")+(0===r.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial"],!Cp.Validator.isValid(o=this.materials[c])&&!Cp.Validator.isValid(a)){var E=p?"defaultVertexColorMaterial":"defaultMaterial";o=this.materials[E],this.logging.enabled&&console.warn('object_group "'+r.objectName+"_"+r.groupName+'" was defined with unresolvable material "'+c+'"! Assigning "'+E+'".'),(c=E)===s&&(a=o,s=E)}if(!Cp.Validator.isValid(a)){var C={materialNameOrg:c,materialName:s,materialProperties:{vertexColors:p?2:0,flatShading:0===r.smoothingGroup}};this.callbackMeshBuilder({cmd:"materialData",materials:{materialCloneInstructions:C}}),this.useAsync&&(this.materials[s]=C)}if(m?((i=g[s])||(i=v,g[s]=v,f.push(s),v++),y.push({start:T,count:M=this.useIndices?r.indices.length:r.vertices.length/3,index:i}),T+=M):f.push(s),n.set(r.vertices,b),b+=r.vertices.length,u&&(u.set(r.indices,x),x+=r.indices.length),l&&(l.set(r.colors,w),w+=r.colors.length),h&&(h.set(r.normals,_),_+=r.normals.length),d&&(d.set(r.uvs,S),S+=r.uvs.length),this.logging.enabled&&this.logging.debug){var P=Cp.Validator.isValid(i)?"\n\t\tmaterialIndex: "+i:"";console.debug("\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+r.groupName+"\n\t\tIndex: "+r.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+r.materialName+"\n\t\tsmoothingGroup: "+r.smoothingGroup+P+"\n\t\tobjectName: "+r.objectName+"\n\t\t#vertices: "+r.vertices.length/3+"\n\t\t#indices: "+r.indices.length+"\n\t\t#colors: "+r.colors.length/3+"\n\t\t#uvs: "+r.uvs.length/2+"\n\t\t#normals: "+r.normals.length/3)}}this.outputObjectCount++,this.callbackMeshBuilder({cmd:"meshData",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:t.name},materials:{multiMaterial:m,materialNames:f,materialGroups:y},buffers:{vertices:n,indices:u,colors:l,normals:h,uvs:d},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[n.buffer],Cp.Validator.isValid(u)?[u.buffer]:null,Cp.Validator.isValid(l)?[l.buffer]:null,Cp.Validator.isValid(h)?[h.buffer]:null,Cp.Validator.isValid(d)?[d.buffer]:null)},t.prototype.finalizeParsing=function(){this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this.processCompletedMesh()&&this.logging.enabled&&console.info("Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount)},t}();n.prototype.loadMtl=function(t,e,n,r,i){var o=new Cp.ResourceDescriptor(t,"MTL");o.setContent(e),this._loadMtl(o,n,r,i)},n.prototype._loadMtl=function(t,n,r,i){void 0===Hp&&console.error('"MTLLoader" is not available. "OBJLoader2" requires it for loading MTL files.'),e.isValid(t)&&this.logging.enabled&&console.time("Loading MTL: "+t.name);var o=[],a=this,s=function(r){var i=[];if(e.isValid(r))for(var s in r.preload(),i=r.materials)i.hasOwnProperty(s)&&(o[s]=i[s]);e.isValid(t)&&a.logging.enabled&&console.timeEnd("Loading MTL: "+t.name),n(o,r)};if(e.isValid(t)&&(e.isValid(t.content)||e.isValid(t.url))){var c=new Hp(this.manager);r=e.verifyInput(r,"anonymous"),c.setCrossOrigin(r),c.setPath(t.path),e.isValid(i)&&c.setMaterialOptions(i),e.isValid(t.content)?s(e.isValid(t.content)?c.parse(t.content):null):e.isValid(t.url)&&new Xu(this.manager).load(t.url,function(e){t.content=e,s(c.parse(e))},this._onProgress,this._onError)}else s()}}();var rf=function(t){this.manager=void 0!==t?t:Hu,this.littleEndian=!0};rf.prototype={constructor:rf,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(n){e(i.parse(n,t))},n,r)},parse:function(t,e){var n=ul.decodeText(t),r=function(t){var e={},n=t.search(/[\r\n]DATA\s(\S*)\s/i),r=/[\r\n]DATA\s(\S*)\s/i.exec(t.substr(n-1));if(e.data=r[1],e.headerLen=r[0].length+n,e.str=t.substr(0,e.headerLen),e.str=e.str.replace(/\#.*/gi,""),e.version=/VERSION (.*)/i.exec(e.str),e.fields=/FIELDS (.*)/i.exec(e.str),e.size=/SIZE (.*)/i.exec(e.str),e.type=/TYPE (.*)/i.exec(e.str),e.count=/COUNT (.*)/i.exec(e.str),e.width=/WIDTH (.*)/i.exec(e.str),e.height=/HEIGHT (.*)/i.exec(e.str),e.viewpoint=/VIEWPOINT (.*)/i.exec(e.str),e.points=/POINTS (.*)/i.exec(e.str),null!==e.version&&(e.version=parseFloat(e.version[1])),null!==e.fields&&(e.fields=e.fields[1].split(" ")),null!==e.type&&(e.type=e.type[1].split(" ")),null!==e.width&&(e.width=parseInt(e.width[1])),null!==e.height&&(e.height=parseInt(e.height[1])),null!==e.viewpoint&&(e.viewpoint=e.viewpoint[1]),null!==e.points&&(e.points=parseInt(e.points[1],10)),null===e.points&&(e.points=e.width*e.height),null!==e.size&&(e.size=e.size[1].split(" ").map(function(t){return parseInt(t,10)})),null!==e.count)e.count=e.count[1].split(" ").map(function(t){return parseInt(t,10)});else{e.count=[];for(var i=0,o=e.fields.length;i<o;i++)e.count.push(1)}e.offset={};var a=0;for(i=0,o=e.fields.length;i<o;i++)"ascii"===e.data?e.offset[e.fields[i]]=i:(e.offset[e.fields[i]]=a,a+=e.size[i]);return e.rowSize=a,e}(n),i=[],o=[],a=[];if("ascii"===r.data)for(var s=r.offset,c=n.substr(r.headerLen).split("\n"),u=0,l=c.length;u<l;u++){var h=c[u].split(" ");if(void 0!==s.x&&(i.push(parseFloat(h[s.x])),i.push(parseFloat(h[s.y])),i.push(parseFloat(h[s.z]))),void 0!==s.rgb){var d=new Float32Array([parseFloat(h[s.rgb])]),p=new DataView(d.buffer,0);a.push(p.getUint8(0)/255),a.push(p.getUint8(1)/255),a.push(p.getUint8(2)/255)}void 0!==s.normal_x&&(o.push(parseFloat(h[s.normal_x])),o.push(parseFloat(h[s.normal_y])),o.push(parseFloat(h[s.normal_z])))}if("binary_compressed"!==r.data){if("binary"===r.data){p=new DataView(t,r.headerLen),s=r.offset,u=0;for(var f=0;u<r.points;u++,f+=r.rowSize)void 0!==s.x&&(i.push(p.getFloat32(f+s.x,this.littleEndian)),i.push(p.getFloat32(f+s.y,this.littleEndian)),i.push(p.getFloat32(f+s.z,this.littleEndian))),void 0!==s.rgb&&(a.push(p.getUint8(f+s.rgb+0)/255),a.push(p.getUint8(f+s.rgb+1)/255),a.push(p.getUint8(f+s.rgb+2)/255)),void 0!==s.normal_x&&(o.push(p.getFloat32(f+s.normal_x,this.littleEndian)),o.push(p.getFloat32(f+s.normal_y,this.littleEndian)),o.push(p.getFloat32(f+s.normal_z,this.littleEndian)))}var m=new Xs;i.length>0&&m.addAttribute("position",new Vs(i,3)),o.length>0&&m.addAttribute("normal",new Vs(o,3)),a.length>0&&m.addAttribute("color",new Vs(a,3)),m.computeBoundingSphere();var v=new el({size:.005});a.length>0?v.vertexColors=!0:v.color.setHex(16777215*Math.random());var g=new Zh(m,v),y=e.split("").reverse().join("");return y=(y=/([^\/]*)/.exec(y))[1].split("").reverse().join(""),g.name=y,g}console.error("PCDLoader: binary_compressed files are not supported")}};var of=function(t){this.manager=void 0!==t?t:Hu};of.prototype={constructor:of,load:function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){function e(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function n(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}function r(t,e){var n,r,i=parseInt(p[f].substr(t,e));if(i){var o=(n=v,r=i,"s"+Math.min(n,r)+"e"+Math.max(n,r));void 0===d[o]&&(h.push([v-1,i-1,1]),d[o]=h.length-1)}}for(var i,o,a,s,c,u={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},l=[],h=[],d={},p=t.split("\n"),f=0,m=p.length;f<m;f++)if("ATOM"===p[f].substr(0,4)||"HETATM"===p[f].substr(0,6))i=parseFloat(p[f].substr(30,7)),o=parseFloat(p[f].substr(38,7)),a=parseFloat(p[f].substr(46,7)),s=parseInt(p[f].substr(6,5))-1,""===(c=e(p[f].substr(76,2)).toLowerCase())&&(c=e(p[f].substr(12,2)).toLowerCase()),l[s]=[i,o,a,u[c],n(c)];else if("CONECT"===p[f].substr(0,6)){var v=parseInt(p[f].substr(6,5));r(11,5),r(16,5),r(21,5),r(26,5)}return function(){var t,e,n={geometryAtoms:new Xs,geometryBonds:new Xs,json:{atoms:l,bonds:h}},r=n.geometryAtoms,i=n.geometryBonds,o=[],a=[],s=[];for(t=0,e=l.length;t<e;t++){var c=l[t];o.push(c[0],c[1],c[2]),a.push(c[3][0]/255,c[3][1]/255,c[3][2]/255)}for(t=0,e=h.length;t<e;t++){var u=h[t],d=u[0],p=u[1];s.push(o[3*d+0]),s.push(o[3*d+1]),s.push(o[3*d+2]),s.push(o[3*p+0]),s.push(o[3*p+1]),s.push(o[3*p+2])}return r.addAttribute("position",new Vs(o,3)),r.addAttribute("color",new Vs(a,3)),i.addAttribute("position",new Vs(s,3)),n}()}};var af=function(t){this.manager=void 0!==t?t:Hu};af.prototype={constructor:af,load:function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},parse:function(t){function e(t){var e={};for(var n in t){var r,i=t[n],o=i.type,a=i.components;switch(o){case"float32":r=new Vs(i.data,a);break;case"uint8":r=new Fs(i.data,a);break;case"uint16":r=new js(i.data,a);break;default:console.log('PlayCanvasLoader: Array type "%s" not yet supported.',o)}e[n]=r}t._attributes=e}function n(t){var e=new Xs;e.setIndex(t.indices);var n=s.vertices[t.vertices]._attributes;for(var r in n){var i=n[r];"texCoord0"===r&&(r="uv"),e.addAttribute(r,i)}t._geometry=e}function r(t){var e=new gd,n=t._geometries;if(void 0!==n)for(var r=new Qu,i=0,o=n.length;i<o;i++)e.add(new Kc(n[i],r));for(i=0,o=t.rotation.length;i<o;i++)t.rotation[i]*=Math.PI/180;e.name=t.name,e.position.fromArray(t.position),e.quaternion.setFromEuler((new ls).fromArray(t.rotation)),e.scale.fromArray(t.scale),t._object=e}for(var i,o,a,s=t.model,c=0,u=s.vertices.length;c<u;c++)e(s.vertices[c]);for(c=0,u=s.meshes.length;c<u;c++)n(s.meshes[c]);for(c=0,u=s.meshInstances.length;c<u;c++)o=void 0,a=s.meshes[(i=s.meshInstances[c]).mesh],void 0===(o=s.nodes[i.node])._geometries&&(o._geometries=[]),o._geometries.push(a._geometry);for(c=0,u=s.nodes.length;c<u;c++)r(s.nodes[c]);for(c=0,u=s.parents.length;c<u;c++){var l=s.parents[c];-1!==l&&s.nodes[l]._object.add(s.nodes[c]._object)}return s.nodes[0]._object}};var sf=function(t){this.manager=void 0!==t?t:Hu,this.propertyNameMapping={}};sf.prototype={constructor:sf,load:function(t,e,n,r){var i=this,o=new Xu(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},setPropertyNameMapping:function(t){this.propertyNameMapping=t},parse:function(t){function e(t){var e="",n=0,r=/ply([\s\S]*)end_header\s/.exec(t);null!==r&&(e=r[1],n=r[0].length);for(var i,o,a,s,c,u,h={comments:[],elements:[],headerLength:n},d=e.split("\n"),p=0;p<d.length;p++){var f=d[p];if(""!==(f=f.trim()))switch(o=(a=f.split(/\s+/)).shift(),f=a.join(" "),o){case"format":h.format=a[0],h.version=a[1];break;case"comment":h.comments.push(f);break;case"element":void 0!==i&&h.elements.push(i),(i={}).name=a[0],i.count=parseInt(a[1]),i.properties=[];break;case"property":i.properties.push((c=l.propertyNameMapping,u=void 0,"list"===(u={type:(s=a)[0]}).type?(u.name=s[3],u.countType=s[1],u.itemType=s[2]):u.name=s[1],u.name in c&&(u.name=c[u.name]),u));break;default:console.log("unhandled",o,a)}}return void 0!==i&&h.elements.push(i),h}function n(t,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(t);case"float":case"double":case"float32":case"float64":return parseFloat(t)}}function r(t,e){for(var r=e.split(/\s+/),i={},o=0;o<t.length;o++)if("list"===t[o].type){for(var a=[],s=n(r.shift(),t[o].countType),c=0;c<s;c++)a.push(n(r.shift(),t[o].itemType));i[t[o].name]=a}else i[t[o].name]=n(r.shift(),t[o].type);return i}function i(t,e){var n,i={indices:[],vertices:[],normals:[],uvs:[],colors:[]},s="";null!==(n=/end_header\s([\s\S]*)$/.exec(t))&&(s=n[1]);for(var c=s.split("\n"),u=0,l=0,h=0;h<c.length;h++){var d=c[h];if(""!==(d=d.trim())){l>=e.elements[u].count&&(u++,l=0);var p=r(e.elements[u].properties,d);a(i,e.elements[u].name,p),l++}}return o(i)}function o(t){var e=new Xs;return t.indices.length>0&&e.setIndex(t.indices),e.addAttribute("position",new Vs(t.vertices,3)),t.normals.length>0&&e.addAttribute("normal",new Vs(t.normals,3)),t.uvs.length>0&&e.addAttribute("uv",new Vs(t.uvs,2)),t.colors.length>0&&e.addAttribute("color",new Vs(t.colors,3)),e.computeBoundingSphere(),e}function a(t,e,n){if("vertex"===e)t.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&t.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&t.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&t.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===e){var r=n.vertex_indices||n.vertex_index;3===r.length?t.indices.push(r[0],r[1],r[2]):4===r.length&&(t.indices.push(r[0],r[1],r[3]),t.indices.push(r[1],r[2],r[3]))}}function s(t,e,n,r){switch(n){case"int8":case"char":return[t.getInt8(e),1];case"uint8":case"uchar":return[t.getUint8(e),1];case"int16":case"short":return[t.getInt16(e,r),2];case"uint16":case"ushort":return[t.getUint16(e,r),2];case"int32":case"int":return[t.getInt32(e,r),4];case"uint32":case"uint":return[t.getUint32(e,r),4];case"float32":case"float":return[t.getFloat32(e,r),4];case"float64":case"double":return[t.getFloat64(e,r),8]}}function c(t,e,n,r){for(var i,o={},a=0,c=0;c<n.length;c++)if("list"===n[c].type){var u=[],l=(i=s(t,e+a,n[c].countType,r))[0];a+=i[1];for(var h=0;h<l;h++)i=s(t,e+a,n[c].itemType,r),u.push(i[0]),a+=i[1];o[n[c].name]=u}else i=s(t,e+a,n[c].type,r),o[n[c].name]=i[0],a+=i[1];return[o,a]}var u,l=this;if(t instanceof ArrayBuffer){var h=ul.decodeText(new Uint8Array(t)),d=e(h);u="ascii"===d.format?i(h,d):function(t,e){for(var n,r={indices:[],vertices:[],normals:[],uvs:[],colors:[]},i="binary_little_endian"===e.format,s=new DataView(t,e.headerLength),u=0,l=0;l<e.elements.length;l++)for(var h=0;h<e.elements[l].count;h++)u+=(n=c(s,u,e.elements[l].properties,i))[1],a(r,e.elements[l].name,n[0]);return o(r)}(t,d)}else u=i(t,e(t));return u}};var cf=null;function uf(){if(null===cf){var t=new ArrayBuffer(2),e=new Uint8Array(t),n=new Uint16Array(t);e[0]=170,e[1]=187,cf=43707===n[0]}return cf}var lf=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],hf={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function df(t,e,n,r,i){var o,a=e.BYTES_PER_ELEMENT;if(i===uf()||1===a)o=new e(t,n,r);else{var s=new DataView(t,n,r*a),c=hf[e.name],u=!i,l=0;for(o=new e(r);l<r;l++)o[l]=s[c](l*a,u)}return o}var pf=function(t){this.manager=void 0!==t?t:Hu};pf.prototype={constructor:pf,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),t=t.replace(/\*/g,uf()?"be":"le"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){console.time("PRWMLoader");var e,n,r=function(t){var e=new Uint8Array(t),n=e[0],r=e[1],i=!!(r>>7&1),o=r>>6&1,a=1==(r>>5&1),s=31&r,c=0,u=0;if(a?(c=(e[2]<<16)+(e[3]<<8)+e[4],u=(e[5]<<16)+(e[6]<<8)+e[7]):(c=e[2]+(e[3]<<8)+(e[4]<<16),u=e[5]+(e[6]<<8)+(e[7]<<16)),0===n)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==n)throw new Error("PRWM decoder: Unsupported format version: "+n);if(!i){if(0!==o)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==u)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var l,h,d,p,f,m,v,g,y=8,b={};for(g=0;g<s;g++){for(l="";y<e.length&&(h=e[y],y++,0!==h);)l+=String.fromCharCode(h);d=(r=e[y])>>7&1,p=1+(r>>4&3),y++,m=df(t,f=lf[15&r],y=4*Math.ceil(y/4),p*c,a),y+=f.BYTES_PER_ELEMENT*p*c,b[l]={type:d,cardinality:p,values:m}}return y=4*Math.ceil(y/4),v=null,i&&(v=df(t,1===o?Uint32Array:Uint16Array,y,u,a)),{version:n,attributes:b,indices:v}}(t),i=Object.keys(r.attributes),o=new Xs;for(n=0;n<i.length;n++)o.addAttribute(i[n],new Rs((e=r.attributes[i[n]]).values,e.cardinality,e.normalized));return null!==r.indices&&o.setIndex(new Rs(r.indices,1)),console.timeEnd("PRWMLoader"),o}},pf.isBigEndianPlatform=function(){return uf()};var ff=function(t){this.manager=void 0!==t?t:Hu,this._parser=ff.parse};ff.prototype=Object.create(Gd.prototype),ff.prototype.constructor=ff,ff.parse=function(t,e){var n=new Uint32Array(t,0,13),r={buffer:t,header:n,loadMipmaps:e};return 55727696===n[0]?ff._parseV3(r):559044176===n[11]?ff._parseV2(r):void console.error("PVRLoader: Unknown PVR format.")},ff._parseV3=function(t){var e,n,r=t.header,i=r[12],o=r[2],a=r[6],s=r[7],c=r[10],u=r[11];switch(o){case 0:e=2,n=35841;break;case 1:e=2,n=35843;break;case 2:e=4,n=35840;break;case 3:e=4,n=35842;break;default:console.error("PVRLoader: Unsupported PVR format:",o)}return t.dataPtr=52+i,t.bpp=e,t.format=n,t.width=s,t.height=a,t.numSurfaces=c,t.numMipmaps=u,t.isCubemap=6===c,ff._extract(t)},ff._parseV2=function(t){var e,n,r=t.header,i=r[0],o=r[1],a=r[2],s=r[3],c=r[12],u=255&r[4],l=r[10]>0;return 25===u?(n=l?35842:35840,e=4):24===u?(n=l?35843:35841,e=2):console.error("PVRLoader: Unknown PVR format:",u),t.dataPtr=i,t.bpp=e,t.format=n,t.width=a,t.height=o,t.numSurfaces=c,t.numMipmaps=s+1,t.isCubemap=6===c,ff._extract(t)},ff._extract=function(t){var e,n={mipmaps:[],width:t.width,height:t.height,format:t.format,mipmapCount:t.numMipmaps,isCubemap:t.isCubemap},r=t.buffer,i=t.dataPtr,o=t.bpp,a=t.numSurfaces,s=0,c=0,u=0,l=0,h=0;2===o?(c=8,u=4):(c=4,u=4),e=c*u*o/8,n.mipmaps.length=t.numMipmaps*a;for(var d=0;d<t.numMipmaps;){var p=t.width>>d,f=t.height>>d;h=f/u,(l=p/c)<2&&(l=2),h<2&&(h=2),s=l*h*e;for(var m=0;m<a;m++){var v=new Uint8Array(r,i,s);n.mipmaps[m*t.numMipmaps+d]={data:v,width:p,height:f},i+=s}d++}return n};var mf=function(t){this.manager=void 0!==t?t:Hu};mf.prototype={constructor:mf,load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){try{e(i.parse(t))}catch(t){r&&r(t)}},n,r)},parse:function(t){var e,n=function(t){if("string"==typeof t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=255&t.charCodeAt(n);return e.buffer||e}return t}(t);return function(t){var e;if(84+50*(e=new DataView(n)).getUint32(80,!0)===e.byteLength)return!0;for(var r=[115,111,108,105,100],i=0;i<5;i++)if(r[i]!=e.getUint8(i,!1))return!0;return!1}()?function(t){for(var e,r,i,o,a,s,c,u,l=new DataView(n),h=l.getUint32(80,!0),d=!1,p=0;p<70;p++)1129270351==l.getUint32(p,!1)&&82==l.getUint8(p+4)&&61==l.getUint8(p+5)&&(d=!0,o=[],a=l.getUint8(p+6)/255,s=l.getUint8(p+7)/255,c=l.getUint8(p+8)/255,u=l.getUint8(p+9)/255);for(var f=new Xs,m=[],v=[],g=0;g<h;g++){var y=84+50*g,b=l.getFloat32(y,!0),x=l.getFloat32(y+4,!0),w=l.getFloat32(y+8,!0);if(d){var _=l.getUint16(y+48,!0);0==(32768&_)?(e=(31&_)/31,r=(_>>5&31)/31,i=(_>>10&31)/31):(e=a,r=s,i=c)}for(var S=1;S<=3;S++){var T=y+12*S;m.push(l.getFloat32(T,!0)),m.push(l.getFloat32(T+4,!0)),m.push(l.getFloat32(T+8,!0)),v.push(b,x,w),d&&o.push(e,r,i)}}return f.addAttribute("position",new Rs(new Float32Array(m),3)),f.addAttribute("normal",new Rs(new Float32Array(v),3)),d&&(f.addAttribute("color",new Rs(new Float32Array(o),3)),f.hasColors=!0,f.alpha=u),f}():function(t){for(var e,n=new Xs,r=/facet([\s\S]*?)endfacet/g,i=0,o=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+o+o+o,"g"),s=new RegExp("normal"+o+o+o,"g"),c=[],u=[],l=new ss;null!==(e=r.exec(t));){for(var h=0,d=0,p=e[0];null!==(e=s.exec(p));)l.x=parseFloat(e[1]),l.y=parseFloat(e[2]),l.z=parseFloat(e[3]),d++;for(;null!==(e=a.exec(p));)c.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),u.push(l.x,l.y,l.z),h++;1!==d&&console.error("STLLoader: Something isn't right with the normal of face number "+i),3!==h&&console.error("STLLoader: Something isn't right with the vertices of face number "+i),i++}return n.addAttribute("position",new Vs(c,3)),n.addAttribute("normal",new Vs(u,3)),n}("string"!=typeof(e=t)?ul.decodeText(new Uint8Array(e)):e)}};var vf=function(t){this.manager=void 0!==t?t:Hu};vf.prototype={constructor:vf,load:function(t,e,n,r){var i=new DOMParser;new Xu(this.manager).load(t,function(t){var n=i.parseFromString(t,"image/svg+xml");e(n.documentElement)},n,r)}};var gf=function(t){this.manager=void 0!==t?t:Hu,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]};gf.prototype={constructor:gf,load:function(t,e,n,r){var i=this,o=void 0!==this.path?this.path:ul.extractUrlBase(t),a=new Xu(this.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){e(i.parse(t,o))},n,r)},parse:function(t,e){this.group=new gd,this.position=0,this.materials=[],this.meshes=[],this.readFile(t,e);for(var n=0;n<this.meshes.length;n++)this.group.add(this.meshes[n]);return this.group},readFile:function(t,e){var n=new DataView(t),r=this.readChunk(n);if(r.id===bf||r.id===xf||r.id===yf)for(var i=this.nextChunk(n,r);0!==i;){if(i===wf){var o=this.readDWord(n);this.debugMessage("3DS file version: "+o)}else i===Af?(this.resetPosition(n),this.readMeshData(n,e)):this.debugMessage("Unknown main chunk: "+i.toString(16));i=this.nextChunk(n,r)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(t,e){for(var n=this.readChunk(t),r=this.nextChunk(t,n);0!==r;){if(r===Ef){var i=+this.readDWord(t);this.debugMessage("Mesh Version: "+i)}else if(r===Cf){var o=this.readFloat(t);this.debugMessage("Master scale: "+o),this.group.scale.set(o,o,o)}else r===Yf?(this.debugMessage("Named Object"),this.resetPosition(t),this.readNamedObject(t)):r===Pf?(this.debugMessage("Material"),this.resetPosition(t),this.readMaterialEntry(t,e)):this.debugMessage("Unknown MDATA chunk: "+r.toString(16));r=this.nextChunk(t,n)}},readNamedObject:function(t){var e=this.readChunk(t),n=this.readString(t,64);e.cur=this.position;for(var r=this.nextChunk(t,e);0!==r;){if(r===Zf){this.resetPosition(t);var i=this.readMesh(t);i.name=n,this.meshes.push(i)}else this.debugMessage("Unknown named object chunk: "+r.toString(16));r=this.nextChunk(t,e)}this.endChunk(e)},readMaterialEntry:function(t,e){for(var n=this.readChunk(t),r=this.nextChunk(t,n),i=new Qu;0!==r;){if(r===Of)i.name=this.readString(t,64),this.debugMessage("   Name: "+i.name);else if(r===Uf)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(r===kf){var o=this.readByte(t);i.wireframeLinewidth=o,this.debugMessage("   Wireframe Thickness: "+o)}else if(r===Df)i.side=uc,this.debugMessage("   DoubleSided");else if(r===Ff)this.debugMessage("   Additive Blending"),i.blending=2;else if(r===Lf)this.debugMessage("   Diffuse Color"),i.color=this.readColor(t);else if(r===If)this.debugMessage("   Specular Color"),i.specular=this.readColor(t);else if(r===Nf)this.debugMessage("   Ambient color"),i.color=this.readColor(t);else if(r===Rf){var a=this.readWord(t);i.shininess=a,this.debugMessage("   Shininess : "+a)}else r===jf?(this.debugMessage("   ColorMap"),this.resetPosition(t),i.map=this.readMap(t,e)):r===zf?(this.debugMessage("   BumpMap"),this.resetPosition(t),i.bumpMap=this.readMap(t,e)):r===Bf?(this.debugMessage("   OpacityMap"),this.resetPosition(t),i.alphaMap=this.readMap(t,e)):r===Vf?(this.debugMessage("   SpecularMap"),this.resetPosition(t),i.specularMap=this.readMap(t,e)):this.debugMessage("   Unknown material chunk: "+r.toString(16));r=this.nextChunk(t,n)}this.endChunk(n),this.materials[i.name]=i},readMesh:function(t){var e=this.readChunk(t),n=this.nextChunk(t,e),r=null,i=[],o=new Kc(r=new Ls,new Qu);for(o.name="mesh";0!==n;){if(n===Jf){var a=this.readWord(t);this.debugMessage("   Vertex: "+a);for(var s=0;s<a;s++)r.vertices.push(new ss(this.readFloat(t),this.readFloat(t),this.readFloat(t)))}else if(n===Qf)this.resetPosition(t),this.readFaceArray(t,o);else if(n===$f){var c=this.readWord(t);for(this.debugMessage("   UV: "+c),i=[],s=0;s<c;s++)i.push(new Cs(this.readFloat(t),this.readFloat(t)))}else if(n===tm){this.debugMessage("   Tranformation Matrix (TODO)");var u=[];for(s=0;s<12;s++)u[s]=this.readFloat(t);var l=new as;l.elements[0]=u[0],l.elements[1]=u[6],l.elements[2]=u[3],l.elements[3]=u[9],l.elements[4]=u[2],l.elements[5]=u[8],l.elements[6]=u[5],l.elements[7]=u[11],l.elements[8]=u[1],l.elements[9]=u[7],l.elements[10]=u[4],l.elements[11]=u[10],l.elements[12]=0,l.elements[13]=0,l.elements[14]=0,l.elements[15]=1,l.transpose();var h=new as;h.getInverse(l,!0),r.applyMatrix(h),l.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+n.toString(16));n=this.nextChunk(t,e)}if(this.endChunk(e),i.length>0){var d=[];for(s=0;s<r.faces.length;s++)d.push([i[r.faces[s].a],i[r.faces[s].b],i[r.faces[s].c]]);r.faceVertexUvs[0]=d}return r.computeVertexNormals(),o},readFaceArray:function(t,e){var n=this.readChunk(t),r=this.readWord(t);this.debugMessage("   Faces: "+r);for(var i=0;i<r;++i)e.geometry.faces.push(new Ms(this.readWord(t),this.readWord(t),this.readWord(t))),this.readWord(t);for(;this.position<n.end;){if((n=this.readChunk(t)).id===Kf){this.debugMessage("      Material Group"),this.resetPosition(t);var o=this.readMaterialGroup(t),a=this.materials[o.name];void 0!==a&&(e.material=a,""===a.name&&(a.name=e.name))}else this.debugMessage("      Unknown face array chunk: "+n.toString(16));this.endChunk(n)}this.endChunk(n)},readMap:function(t,e){var n=this.readChunk(t),r=this.nextChunk(t,n),i={},o=new sl(this.manager);for(o.setPath(e);0!==r;){if(r===Gf){var a=this.readString(t,128);i=o.load(a),this.debugMessage("      File: "+e+a)}else r===Xf?(i.offset.x=this.readFloat(t),this.debugMessage("      OffsetX: "+i.offset.x)):r===qf?(i.offset.y=this.readFloat(t),this.debugMessage("      OffsetY: "+i.offset.y)):r===Hf?(i.repeat.x=this.readFloat(t),this.debugMessage("      RepeatX: "+i.repeat.x)):r===Wf?(i.repeat.y=this.readFloat(t),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+r.toString(16));r=this.nextChunk(t,n)}return this.endChunk(n),i},readMaterialGroup:function(t){this.readChunk(t);var e=this.readString(t,64),n=this.readWord(t);this.debugMessage("         Name: "+e),this.debugMessage("         Faces: "+n);for(var r=[],i=0;i<n;++i)r.push(this.readWord(t));return{name:e,index:r}},readColor:function(t){var e=this.readChunk(t),n=new Ts;if(e.id===Sf||e.id===Tf){var r=this.readByte(t),i=this.readByte(t),o=this.readByte(t);n.setRGB(r/255,i/255,o/255),this.debugMessage("      Color: "+n.r+", "+n.g+", "+n.b)}else e.id===_f||e.id===Mf?(r=this.readFloat(t),i=this.readFloat(t),o=this.readFloat(t),n.setRGB(r,i,o),this.debugMessage("      Color: "+n.r+", "+n.g+", "+n.b)):this.debugMessage("      Unknown color chunk: "+e.toString(16));return this.endChunk(e),n},readChunk:function(t){var e={};return e.cur=this.position,e.id=this.readWord(t),e.size=this.readDWord(t),e.end=e.cur+e.size,e.cur+=6,e},endChunk:function(t){this.position=t.end},nextChunk:function(t,e){if(e.cur>=e.end)return 0;this.position=e.cur;try{var n=this.readChunk(t);return e.cur+=n.size,n.id}catch(t){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(t){var e=t.getUint8(this.position,!0);return this.position+=1,e},readFloat:function(t){try{var e=t.getFloat32(this.position,!0);return this.position+=4,e}catch(e){this.debugMessage(e+" "+this.position+" "+t.byteLength)}},readInt:function(t){var e=t.getInt32(this.position,!0);return this.position+=4,e},readShort:function(t){var e=t.getInt16(this.position,!0);return this.position+=2,e},readDWord:function(t){var e=t.getUint32(this.position,!0);return this.position+=4,e},readWord:function(t){var e=t.getUint16(this.position,!0);return this.position+=2,e},readString:function(t,e){for(var n="",r=0;r<e;r++){var i=this.readByte(t);if(!i)break;n+=String.fromCharCode(i)}return n},setPath:function(t){return this.path=t,this},debugMessage:function(t){this.debug&&console.log(t)}};var yf=19789,bf=15786,xf=49725,wf=2,_f=16,Sf=17,Tf=18,Mf=19,Af=15677,Ef=15678,Cf=256,Pf=45055,Of=40960,Nf=40976,Lf=40992,If=41008,Rf=41024,Df=41089,Ff=41091,Uf=41093,kf=41095,jf=41472,Bf=41488,zf=41520,Vf=41476,Gf=41728,Hf=41812,Wf=41814,Xf=41816,qf=41818,Yf=16384,Zf=16640,Jf=16656,Qf=16672,Kf=16688,$f=16704,tm=16736,em=function(t){this.manager=void 0!==t?t:Hu,this.reversed=!1};em.prototype={constructor:em,load:function(t,e,n,r){var i=this,o=new Xu(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){function e(t){var e,n=[];t.forEach(function(t){"m"===t.type.toLowerCase()?n.push(e=[t]):"z"!==t.type.toLowerCase()&&e.push(t)});var r=[];return n.forEach(function(t){r.push(i={type:"m",x:t[t.length-1].x,y:t[t.length-1].y});for(var e=t.length-1;e>0;e--){var n=t[e],i={type:n.type};void 0!==n.x2&&void 0!==n.y2?(i.x1=n.x2,i.y1=n.y2,i.x2=n.x1,i.y2=n.y1):void 0!==n.x1&&void 0!==n.y1&&(i.x1=n.x1,i.y1=n.y1),i.x=t[e-1].x,i.y=t[e-1].y,r.push(i)}}),r}return"undefined"==typeof opentype?(console.warn("TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(t,n){for(var r=Math.round,i={},o=1e5/(72*(t.unitsPerEm||2048)),a=0;a<t.glyphs.length;a++){var s=t.glyphs.glyphs[a];if(void 0!==s.unicode){var c={ha:r(s.advanceWidth*o),x_min:r(s.xMin*o),x_max:r(s.xMax*o),o:""};n&&(s.path.commands=e(s.path.commands)),s.path.commands.forEach(function(t,e){"c"===t.type.toLowerCase()&&(t.type="b"),c.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(c.o+=r(t.x*o)+" "+r(t.y*o)+" "),void 0!==t.x1&&void 0!==t.y1&&(c.o+=r(t.x1*o)+" "+r(t.y1*o)+" "),void 0!==t.x2&&void 0!==t.y2&&(c.o+=r(t.x2*o)+" "+r(t.y2*o)+" ")}),i[String.fromCharCode(s.unicode)]=c}}return{glyphs:i,familyName:t.familyName,ascender:r(t.ascender*o),descender:r(t.descender*o),underlinePosition:t.tables.post.underlinePosition,underlineThickness:t.tables.post.underlineThickness,boundingBox:{xMin:t.tables.head.xMin,xMax:t.tables.head.xMax,yMin:t.tables.head.yMin,yMax:t.tables.head.yMax},resolution:1e3,original_font_information:t.tables.name}}(opentype.parse(t),this.reversed)}};var nm=function(){};nm.prototype.load=function(t,e,n){this.downloadModelJson(t,e,n)},(nm.BufferGeometryCreator=function(){}).prototype.create=function(t,e){var n,r,i=e.length/3,o=new Xs,a=new Float32Array(3*i*3),s=new Float32Array(3*i*3),c=new Float32Array(3*i*2),u=t.length;for(r=0,n=0;n<u;n+=8)a[r++]=t[n],a[r++]=t[n+1],a[r++]=t[n+2];for(r=0,n=3;n<u;n+=8)c[r++]=t[n],c[r++]=t[n+1];for(r=0,n=5;n<u;n+=8)s[r++]=t[n],s[r++]=t[n+1],s[r++]=t[n+2];return o.setIndex(new Rs(e,1)),o.addAttribute("position",new Rs(a,3)),o.addAttribute("normal",new Rs(s,3)),o.addAttribute("uv",new Rs(c,2)),o.computeBoundingSphere(),o};var rm={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};function im(t,e,n){(new Xu).load(t,e,n)}nm.prototype.decompressAttribsInner_=function(t,e,n,r,i,o,a,s){for(var c=0,u=e;u<n;u++){var l=t.charCodeAt(u);r[i]=s*((c+=l>>1^-(1&l))+a),i+=o}},nm.prototype.decompressIndices_=function(t,e,n,r,i){for(var o=0,a=0;a<n;a++){var s=t.charCodeAt(e++);r[i++]=o-s,0===s&&o++}},nm.prototype.decompressAABBs_=function(t,e,n,r,i){for(var o=6*n,a=e+o,s=0,c=new Float32Array(o),u=e;u<a;u+=6){var l=t.charCodeAt(u+0)+r[0],h=t.charCodeAt(u+1)+r[1],d=t.charCodeAt(u+2)+r[2],p=t.charCodeAt(u+3)+1>>1,f=t.charCodeAt(u+4)+1>>1,m=t.charCodeAt(u+5)+1>>1;c[s++]=i[0]*(l+p),c[s++]=i[1]*(h+f),c[s++]=i[2]*(d+m),c[s++]=i[0]*p,c[s++]=i[1]*f,c[s++]=i[2]*m}return c},nm.prototype.decompressMesh=function(t,e,n,r,i,o){for(var a=n.decodeScales.length,s=n.decodeOffsets,c=n.decodeScales,u=e.attribRange[1],l=e.attribRange[0],h=new Float32Array(a*u),d=0;d<a;d++){var p=l+u,f=c[d];f&&this.decompressAttribsInner_(t,l,p,h,d,a,s[d],f),l=p}var m=3*e.indexRange[1],v=new Uint16Array(m);this.decompressIndices_(t,l,m,v,0);var g=void 0,y=e.bboxes;y&&(g=this.decompressAABBs_(t,y,e.names.length,s,c)),o(r,i,h,v,g,e)},nm.prototype.copyAttrib=function(t,e,n,r){for(var i=0;i<t;i++)n[i]=e[t*r+i]},nm.prototype.decodeAttrib2=function(t,e,n,r,i,o,a,s,c,u){for(var l=0;l<5;l++){var h=t.charCodeAt(i+o*l+u);c[l]+=h>>1^-(1&h),s[e*u+l]=c[l],a[e*u+l]=r[l]*(c[l]+n[l])}},nm.prototype.accumulateNormal=function(t,e,n,r,i){var o=r[8*t],a=r[8*t+1],s=r[8*t+2],c=r[8*e],u=r[8*e+1],l=r[8*e+2],h=r[8*n],d=r[8*n+1],p=r[8*n+2];u-=a,d-=a,a=(l-=s)*(h-=o)-(c-=o)*(p-=s),s=c*d-u*h,i[3*t]+=o=u*p-l*d,i[3*t+1]+=a,i[3*t+2]+=s,i[3*e]+=o,i[3*e+1]+=a,i[3*e+2]+=s,i[3*n]+=o,i[3*n+1]+=a,i[3*n+2]+=s},nm.prototype.decompressMesh2=function(t,e,n,r,i,o){for(var a=n.decodeScales.length,s=n.decodeOffsets,c=n.decodeScales,u=e.attribRange[0],l=e.attribRange[1],h=e.codeRange[0],d=3*e.codeRange[2],p=new Uint16Array(d),f=new Int32Array(3*l),m=new Uint16Array(a),v=new Uint16Array(a*l),g=new Float32Array(a*l),y=0,b=0,x=0;x<d;x+=3){var w=t.charCodeAt(h++),_=Math.min(x,96);if(w<_){var S,T,M,A=w%3,E=x-(w-A);switch(A){case 0:S=p[E+2],T=p[E+1],M=p[E+0];break;case 1:S=p[E+0],T=p[E+2],M=p[E+1];break;case 2:S=p[E+1],T=p[E+0],M=p[E+2]}p[b++]=S,p[b++]=T;var C=y-(w=t.charCodeAt(h++));if(p[b++]=C,0===w){for(var P=0;P<5;P++){var O=t.charCodeAt(u+l*P+y),N=(O>>1^-(1&O))+v[a*S+P]+v[a*T+P]-v[a*M+P];m[P]=N,v[a*y+P]=N,g[a*y+P]=c[P]*(N+s[P])}y++}else this.copyAttrib(a,v,m,C);this.accumulateNormal(S,T,C,v,f)}else{var L=y-(w-_);p[b++]=L,w===_?this.decodeAttrib2(t,a,s,c,u,l,g,v,m,y++):this.copyAttrib(a,v,m,L);var I=y-(w=t.charCodeAt(h++));p[b++]=I,0===w?this.decodeAttrib2(t,a,s,c,u,l,g,v,m,y++):this.copyAttrib(a,v,m,I);var R=y-(w=t.charCodeAt(h++));if(p[b++]=R,0===w){for(P=0;P<5;P++)m[P]=(v[a*L+P]+v[a*I+P])/2;this.decodeAttrib2(t,a,s,c,u,l,g,v,m,y++)}else this.copyAttrib(a,v,m,R);this.accumulateNormal(L,I,R,v,f)}}for(x=0;x<l;x++){var D=f[3*x],F=f[3*x+1],U=f[3*x+2],k=511/Math.sqrt(D*D+F*F+U*U),j=t.charCodeAt(u+5*l+x),B=t.charCodeAt(u+6*l+x),z=t.charCodeAt(u+7*l+x);g[a*x+5]=k*D+(j>>1^-(1&j)),g[a*x+6]=k*F+(B>>1^-(1&B)),g[a*x+7]=k*U+(z>>1^-(1&z))}o(r,i,g,p,void 0,e)},nm.prototype.downloadMesh=function(t,e,n,r,i){var o=this,a=0;im(t,function(t){!function(t){for(;a<n.length;){var s=n[a],c=s.indexRange;if(c){if(t.length<c[0]+3*c[1])break;o.decompressMesh(t,s,r,e,a,i)}else{var u=s.codeRange;if(t.length<u[0]+u[1])break;o.decompressMesh2(t,s,r,e,a,i)}++a}}(t)})},nm.prototype.downloadMeshes=function(t,e,n,r){for(var i in e)this.downloadMesh(t+i,i,e[i],n,r)},nm.prototype.createMeshCallback=function(t,e,n){var r=0,i=0,o={},a={},s={},c=e.urls;for(var u in c)o[u]=c[u].length,a[u]=0,i++,s[u]=new ys;var l=new ys,h=new Hp.MaterialCreator(t,e.options);h.setMaterials(e.materials),h.preload();var d=new nm.BufferGeometryCreator;return function(t,e,c,u,p,f){var m=new Kc(d.create(c,u),h.create(f.material));s[t].add(m),a[t]++,a[t]===o[t]&&(r++,l.add(s[t]),r===i&&n(l))}},nm.prototype.downloadModel=function(t,e,n,r){var i=this.createMeshCallback(e,n,r);this.downloadMeshes(t,n.urls,n.decodeParams,i)},nm.prototype.downloadModelJson=function(t,e,n){var r,i;r=t,i=(function(r){r.decodeParams||(r.decodeParams=n&&n.decodeParams?n.decodeParams:rm),r.options=n;var i=t.substr(0,t.lastIndexOf("/")+1),o=i;n&&n.geometryBase&&"/"!==(i=n.geometryBase).charAt(i.length-1)&&(i+="/"),n&&n.materialBase&&"/"!==(o=n.materialBase).charAt(o.length-1)&&(o+="/"),this.downloadModel(i,o,r,e)}).bind(this),im(r,function(t){i(JSON.parse(t))},function(){})};var om=function(t){this.manager=void 0!==t?t:Hu};function am(t){ys.call(this),this.material=t,this.render=function(){}}om.prototype={constructor:om,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,crossOrigin:"Anonymous",load:function(t,e,n,r){var i=this;new Xu(this.manager).load(t,function(t){e(i.parse(t))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=this.texturePath||"",n=new sl(this.manager);n.setCrossOrigin(this.crossOrigin);for(var r=new Eu,i=t.split("\n"),o=i.length-1;o>-1;o--){var a=i[o];if(/{.*[{\[]/.test(a))(s=a.split("{").join("{\n").split("\n")).unshift(1),s.unshift(o),i.splice.apply(i,s);else if(/\].*}/.test(a)){var s;(s=a.split("]").join("]\n").split("\n")).unshift(1),s.unshift(o),i.splice.apply(i,s)}/}.*}/.test(a)&&((s=a.split("}").join("}\n").split("\n")).unshift(1),s.unshift(o),i.splice.apply(i,s)),/^\b[^\s]+\b$/.test(a.trim())?(i[o+1]=a+" "+i[o+1].trim(),i.splice(o,1)):a.indexOf("coord")>-1&&a.indexOf("[")<0&&a.indexOf("{")<0&&(i[o]+=" Coordinate {}")}var c=i.shift();return/V1.0/.exec(c)?console.warn("VRMLLoader: V1.0 not supported yet."):/V2.0/.exec(c)&&function(t,r){var i={},o=/(\b|\-|\+)([\d\.e]+)/,a=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,s=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g;function c(t,e,n,r,i){for(var o=!0===i?1:-1,a=[],s={},c={},u=0;u<n.length;u++){var l={x:o*(Math.cos(n[u])*e),y:o*(Math.sin(n[u])*e)};a.push(l)}for(var h=t.index,d=t.attributes.position,p=new Rs(new Float32Array(3*t.attributes.position.count),3),f=new ss,m=new Ts,v=0;v<h.count;v++){var g=h.getX(v);f.fromBufferAttribute(d,g);for(var y=0;y<r.length;y++)if(0===y?(s.x=0,s.y=!0===i?e:-1*e):(s.x=a[y-1].x,s.y=a[y-1].y),void 0!==(c=a[y]))if(1==(!0===i?f.y<=s.y&&f.y>c.y:f.y>=s.y&&f.y<c.y)){var b=r[y],x=r[y+1],w=Math.abs(f.y-s.y)/(s.y-c.y);m.copy(b).lerp(x,w),p.setXYZ(g,m.r,m.g,m.b)}else{var _=r[!0===i?r.length-1:0];p.setXYZ(g,_.r,_.g,_.b)}}t.addAttribute("color",p)}var u=[];function l(t,e){for(var n,r,i,c=[],l={},h=/[^\s,\[\]]+/g;null!==(n=h.exec(e));)c.push(n[0]);switch(r=c[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=r,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=r,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=r,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":case"texCoordIndex":this.recordingFieldname=r,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(c.length>0)for(var d=0;d<c.length;d++)/(-?\d+)/.test(c[d])&&("-1"===c[d]?(u.length>0&&this.indexes.push(u),u=[]):u.push(parseInt(c[d])));/]/.exec(e)&&(u.length>0&&this.indexes.push(u),u=[],this.isRecordingFaces=!1,t[this.recordingFieldname]=this.indexes)}else if(this.isRecordingPoints){if("Coordinate"==t.nodeType)for(;null!==(c=s.exec(e));)i={x:parseFloat(c[1]),y:parseFloat(c[2]),z:parseFloat(c[3])},this.points.push(i);if("TextureCoordinate"==t.nodeType)for(;null!==(c=a.exec(e));)i={x:parseFloat(c[1]),y:parseFloat(c[2])},this.points.push(i);/]/.exec(e)&&(this.isRecordingPoints=!1,t.points=this.points)}else if(this.isRecordingAngles){if(c.length>0)for(d=0;d<c.length;d++)o.test(c[d])&&this.angles.push(parseFloat(c[d]));/]/.exec(e)&&(this.isRecordingAngles=!1,t[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(;null!==(c=s.exec(e));){var p={r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3])};this.colors.push(p)}/]/.exec(e)&&(this.isRecordingColors=!1,t[this.recordingFieldname]=this.colors)}else if("NULL"!==c[c.length-1]&&"children"!==r){switch(r){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!==c.length){console.warn("VRMLLoader: Invalid color format detected for %s.",r);break}l={r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3])};break;case"location":case"direction":case"translation":case"scale":case"size":if(4!==c.length){console.warn("VRMLLoader: Invalid vector format detected for %s.",r);break}l={x:parseFloat(c[1]),y:parseFloat(c[2]),z:parseFloat(c[3])};break;case"intensity":case"cutOffAngle":case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!==c.length){console.warn("VRMLLoader: Invalid single float value specification detected for %s.",r);break}l=parseFloat(c[1]);break;case"rotation":if(5!==c.length){console.warn("VRMLLoader: Invalid quaternion format detected for %s.",r);break}l={x:parseFloat(c[1]),y:parseFloat(c[2]),z:parseFloat(c[3]),w:parseFloat(c[4])};break;case"on":case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!==c.length){console.warn("VRMLLoader: Invalid format detected for %s.",r);break}l="TRUE"===c[1]}t[r]=l}return l}!function t(o,a){var s;if("string"!=typeof o){s=a,o.string.indexOf("AmbientLight")>-1&&"PointLight"===o.nodeType&&(o.nodeType="AmbientLight");var u=void 0===o.on||o.on,l=void 0!==o.intensity?o.intensity:1,h=new Ts;if(o.color&&h.copy(o.color),"AmbientLight"===o.nodeType)(s=new jd(h,l)).visible=u,a.add(s);else if("PointLight"===o.nodeType){var d=0;void 0!==o.radius&&o.radius<1e3&&(d=o.radius),(s=new Nd(h,l,d)).visible=u,a.add(s)}else if("SpotLight"===o.nodeType){l=1,d=0;var p=Math.PI/3;u=!0,void 0!==o.radius&&o.radius<1e3&&(d=o.radius),void 0!==o.cutOffAngle&&(p=o.cutOffAngle),(s=new Dd(h,l,d,p,0)).visible=u,a.add(s)}else if("Transform"===o.nodeType||"Group"===o.nodeType){if(s=new ys,/DEF/.exec(o.string)&&(s.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[s.name]=s),void 0!==o.translation&&s.position.set((G=o.translation).x,G.y,G.z),void 0!==o.rotation){var f=o.rotation;s.quaternion.setFromAxisAngle(new ss(f.x,f.y,f.z),f.w)}void 0!==o.scale&&s.scale.set((j=o.scale).x,j.y,j.z),a.add(s)}else if("Shape"===o.nodeType)s=new Kc,/DEF/.exec(o.string)&&(s.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[s.name]=s),a.add(s);else if("Background"===o.nodeType){var m=2e4,v=new Ys(m,20,20),g=new Xc({fog:!1,side:cc});if(o.skyColor.length>1)c(v,m,o.skyAngle,o.skyColor,!0),g.vertexColors=dc;else{var y=o.skyColor[0];g.color.setRGB(y.r,y.b,y.g)}if(r.add(new Kc(v,g)),void 0!==o.groundColor){var b=new Ys(m=12e3,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),x=new Xc({fog:!1,side:cc,vertexColors:dc});c(b,m,o.groundAngle,o.groundColor,!1),r.add(new Kc(b,x))}}else{if(/geometry/.exec(o.string)){if("Box"===o.nodeType)a.geometry=new iu((j=o.size).x,j.y,j.z);else if("Cylinder"===o.nodeType)a.geometry=new au(o.radius,o.radius,o.height);else if("Cone"===o.nodeType)a.geometry=new au(o.topRadius,o.bottomRadius,o.height);else if("Sphere"===o.nodeType)a.geometry=new Ys(o.radius);else if("IndexedFaceSet"===o.nodeType){var w,_,S,T,M,A=new Xs,E=[],C=[];for(U=0,S=o.children.length;U<S;U++){if("TextureCoordinate"===(k=o.children[U]).nodeType&&k.points)for(T=0,M=k.points.length;T<M;T++)C.push((_=k.points[T]).x,_.y);if("Coordinate"===k.nodeType){if(k.points)for(T=0,M=k.points.length;T<M;T++)E.push((w=k.points[T]).x,w.y,w.z);if(k.string.indexOf("DEF")>-1){var P=/DEF\s+([^\s]+)/.exec(k.string)[1];i[P]=E.slice(0)}k.string.indexOf("USE")>-1&&(X=/USE\s+([^\s]+)/.exec(k.string)[1],E=i[X])}}var O=0;if(o.coordIndex){var N=[],L=[];for(w=new ss,_=new Cs,U=0,S=o.coordIndex.length;U<S;U++){var I=o.coordIndex[U];for(O=0;I.length>=3&&O<I.length-2;){void 0===o.ccw&&(o.ccw=!0);var R=I[0],D=I[O+(o.ccw?1:2)],F=I[O+(o.ccw?2:1)];w.fromArray(E,3*R),_.fromArray(C,2*R),N.push(w.x,w.y,w.z),L.push(_.x,_.y),w.fromArray(E,3*D),_.fromArray(C,2*D),N.push(w.x,w.y,w.z),L.push(_.x,_.y),w.fromArray(E,3*F),_.fromArray(C,2*F),N.push(w.x,w.y,w.z),L.push(_.x,_.y),O++}}E=N,C=L}else a.parent.remove(a);!1===o.solid&&(a.material.side=uc),A.solid=o.solid,A.addAttribute("position",new Vs(E,3)),C.length>0&&A.addAttribute("uv",new Vs(C,2)),A.computeVertexNormals(),A.computeBoundingSphere(),/DEF/.exec(o.string)&&(A.name=/DEF ([^\s]+)/.exec(o.string)[1],i[A.name]=A),a.geometry=A}return}if(/appearance/.exec(o.string)){for(var U=0;U<o.children.length;U++){var k;if("Material"===(k=o.children[U]).nodeType){var j,B=new Qu;if(void 0!==k.diffuseColor){var z=k.diffuseColor;B.color.setRGB(z.r,z.g,z.b)}if(void 0!==k.emissiveColor){var V=k.emissiveColor;B.emissive.setRGB(V.r,V.g,V.b)}if(void 0!==k.specularColor&&B.specular.setRGB((j=k.specularColor).r,j.g,j.b),void 0!==k.transparency){var G=k.transparency;B.opacity=Math.abs(1-G),B.transparent=!0}/DEF/.exec(o.string)&&(B.name=/DEF ([^\s]+)/.exec(o.string)[1],i[B.name]=B),a.material=B}if("ImageTexture"===k.nodeType){var H=/"([^"]+)"/.exec(k.children[0]);H&&(a.material.name=H[1],a.material.map=n.load(e+H[1]))}}return}}U=0;for(var W=o.children.length;U<W;U++)t(o.children[U],s)}else if(/USE/.exec(o)){var X=/USE\s+?([^\s]+)/.exec(o)[1];void 0==i[X]?console.warn("VRMLLoader: %s is not defined.",X):/appearance/.exec(o)&&X?a.material=i[X].clone():/geometry/.exec(o)&&X?(a.geometry=i[X].clone(),void 0!==i[X].solid&&!1===i[X].solid&&(a.geometry.solid=!1,a.material.side=uc)):X&&(s=i[X].clone(),a.add(s))}}(function(t){for(var e,n,r={string:"Scene",children:[]},i=r,o=0;o<t.length;o++){var a="",s=t[o];if(null===/^\s+?$/g.exec(s)&&""!==(s=s.trim())){if(/#/.exec(s)){var c=s.split("#");s=c[0],a=c[1]}if(e=/([^\s]*){1}(?:\s+)?{/.exec(s)){var u={nodeType:e[1],string:s,parent:i,children:[],comment:a};i.children.push(u),i=u,/}/.exec(s)&&(n=/{(.*)}/.exec(s)[1],u.children.push(n),l(i,n),i=i.parent)}else/}/.exec(s)?i=i.parent:""!==s&&(l(i,s),i.children.push(s))}}return r}(t),r)}(i,r),r}},Object.assign((function(t){this.manager=void 0!==t?t:Hu}).prototype,us.prototype,{load:function(t,e,n,r){var i=this,o=new Xu(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},n,r)},parse:function(t){function e(t,e){var n=t.length,r=new Int32Array(n+e.length);return r.set(t),r.set(e,n),r}function n(t){for(var e="",n=new Uint8Array(t),r=0,i=n.length;i--;)e+=String.fromCharCode(n[r++]);return e}var r=ul.decodeText(new Uint8Array(t,0,250)).split("\n");return-1!==r[0].indexOf("xml")?function(t){function n(t){var e,n,r,i,o,a,s="undefined"!=typeof Uint8Array?Uint8Array:Array,c=[],u=[],l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=l.length;for(e=0;e<h;e++)c[e]=l[e];for(e=0;e<h;++e)u[l.charCodeAt(e)]=e;if(u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63,(h=t.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a=new s(3*h/4-(o="="===t[h-2]?2:"="===t[h-1]?1:0)),r=o>0?h-4:h;var d=0;for(e=0,n=0;e<r;e+=4,n+=3)i=u[t.charCodeAt(e)]<<18|u[t.charCodeAt(e+1)]<<12|u[t.charCodeAt(e+2)]<<6|u[t.charCodeAt(e+3)],a[d++]=(16711680&i)>>16,a[d++]=(65280&i)>>8,a[d++]=255&i;return 2===o?(i=u[t.charCodeAt(e)]<<2|u[t.charCodeAt(e+1)]>>4,a[d++]=255&i):1===o&&(i=u[t.charCodeAt(e)]<<10|u[t.charCodeAt(e+1)]<<4|u[t.charCodeAt(e+2)]>>2,a[d++]=i>>8&255,a[d++]=255&i),a}function r(t,r){var i,a,s,c,u=0;if("UInt64"===o.attributes.header_type?u=8:"UInt32"===o.attributes.header_type&&(u=4),"binary"===t.attributes.format&&r){var l,h,d,p,f,m;if("Float32"===t.attributes.type)var v=new Float32Array;else"Int64"===t.attributes.type&&(v=new Int32Array);h=(l=n(t["#text"]))[0];for(var g=1;g<u-1;g++)h|=l[g]<<g*u;for(p=(h+3)*u,(f=[]).push(m=p+=p%3>0?3-p%3:0),d=3*u,g=0;g<h;g++){for(var y=l[g*u+d],b=1;b<u-1;b++)y|=l[g*u+d+b]<<8*b;f.push(m+=y)}for(g=0;g<f.length-1;g++)x=(x=new Zlib.Inflate(l.slice(f[g],f[g+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===t.attributes.type?(a=x=new Float32Array(x),c=void 0,s=(i=v).length,(c=new Float32Array(s+a.length)).set(i),c.set(a,s),v=c):"Int64"===t.attributes.type&&(v=e(v,x=new Int32Array(x)));delete t["#text"],"Float32"===t.attributes.type?"binary"===t.attributes.format&&(r||(v=v.filter(function(t,e){if(0!==e)return!0}))):"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(r||(v=v.filter(function(t,e){if(0!==e)return!0})),v=v.filter(function(t,e){if(e%2!=1)return!0}))}else{if("binary"!==t.attributes.format||r)if(t["#text"])var x=t["#text"].split(/\s+/).filter(function(t){if(""!==t)return t});else x=new Int32Array(0).buffer;else x=(x=n(t["#text"])).slice(u).buffer;delete t["#text"],"Float32"===t.attributes.type?v=new Float32Array(x):"Int32"===t.attributes.type?v=new Int32Array(x):"Int64"===t.attributes.type&&(v=new Int32Array(x),"binary"===t.attributes.format&&(v=v.filter(function(t,e){if(e%2!=1)return!0})))}return v}var i=null;if(window.DOMParser)try{i=(new DOMParser).parseFromString(t,"text/xml")}catch(t){i=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((i=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!i.loadXML())throw new Error(i.parseError.reason+i.parseError.srcText)}catch(t){i=null}}var o=function t(e){var n={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){n.attributes={};for(var r=0;r<e.attributes.length;r++){var i=e.attributes.item(r);n.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===e.nodeType&&(n=e.nodeValue.trim());if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var a,s=e.childNodes.item(o),c=s.nodeName;"undefined"==typeof n[c]?""!==(a=t(s))&&(n[c]=a):("undefined"==typeof n[c].push&&(n[c]=[n[c]]),""!==(a=t(s))&&n[c].push(a))}return n}(i.documentElement),a=[],s=[],c=[];if(o.PolyData){for(var u=o.PolyData.Piece,l=o.attributes.hasOwnProperty("compressor"),h=["PointData","Points","Strips","Polys"],d=0,p=h.length;d<p;){var f=u[h[d]];if(f&&f.DataArray){if("[object Array]"===Object.prototype.toString.call(f.DataArray))var m=f.DataArray;else m=[f.DataArray];for(var v=0,g=m.length;v<g;)"#text"in m[v]&&m[v]["#text"].length>0&&(m[v].text=r(m[v],l)),v++;switch(h[d]){case"PointData":var y=parseInt(u.attributes.NumberOfPoints),b=f.attributes.Normals;if(y>0)for(var x=0,w=m.length;x<w;x++)if(b===m[x].attributes.Name){var _=m[x].attributes.NumberOfComponents;(s=new Float32Array(y*_)).set(m[x].text,0)}break;case"Points":(y=parseInt(u.attributes.NumberOfPoints))>0&&(_=f.DataArray.attributes.NumberOfComponents,(a=new Float32Array(y*_)).set(f.DataArray.text,0));break;case"Strips":var S=parseInt(u.attributes.NumberOfStrips);if(S>0){var T=new Int32Array(f.DataArray[0].text.length),M=new Int32Array(f.DataArray[1].text.length);T.set(f.DataArray[0].text,0),M.set(f.DataArray[1].text,0);var A=S+T.length;c=new Uint32Array(3*A-9*S);var E=0;for(x=0,w=S;x<w;x++){for(var C=[],P=0,O=M[x],N=0;P<O-N;P++)C.push(T[P]),x>0&&(N=M[x-1]);var L=0;for(O=M[x],N=0;L<O-N-2;L++)L%2?(c[E++]=C[L],c[E++]=C[L+2],c[E++]=C[L+1]):(c[E++]=C[L],c[E++]=C[L+1],c[E++]=C[L+2]),x>0&&(N=M[x-1])}}break;case"Polys":var I=parseInt(u.attributes.NumberOfPolys);if(I>0){T=new Int32Array(f.DataArray[0].text.length),M=new Int32Array(f.DataArray[1].text.length),T.set(f.DataArray[0].text,0),M.set(f.DataArray[1].text,0),A=I+T.length,c=new Uint32Array(3*A-9*I),E=0;var R=0;for(x=0,w=I,N=0;x<w;){var D=[];for(P=0,O=M[x];P<O-N;)D.push(T[R++]),P++;for(L=1;L<O-N-1;)c[E++]=D[0],c[E++]=D[L],c[E++]=D[L+1],L++;N=M[++x-1]}}}}d++}var F=new Xs;return F.setIndex(new Rs(c,1)),F.addAttribute("position",new Rs(a,3)),s.length===a.length&&F.addAttribute("normal",new Rs(s,3)),F}}(n(t)):r[2].includes("ASCII")?function(t){var e,n,r=[],i=[],o=[],a=[],s=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,c=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,l=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,p=/^CELL_DATA[ ]+(\d+)/,f=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,g=!1,y=!1,b=!1,x=!1,w=!1,_=!1,S=t.split("\n");for(var T in S){var M=S[T];if(v)for(;null!==(e=s.exec(M));){var A=parseFloat(e[1]),E=parseFloat(e[2]),C=parseFloat(e[3]);i.push(A,E,C)}else if(g){if(null!==(e=c.exec(M))){var P=parseInt(e[1]),O=e[2].split(/\s+/);if(P>=3)for(var N=parseInt(O[0]),L=1,I=0;I<P-2;++I)R=parseInt(O[L]),D=parseInt(O[L+1]),r.push(N,R,D),L++}}else if(y){if(null!==(e=c.exec(M))){var R,D;if(P=parseInt(e[1]),O=e[2].split(/\s+/),P>=3)for(I=0;I<P-2;I++)I%2==1?(N=parseInt(O[I]),R=parseInt(O[I+2]),D=parseInt(O[I+1]),r.push(N,R,D)):(N=parseInt(O[I]),R=parseInt(O[I+1]),D=parseInt(O[I+2]),r.push(N,R,D))}}else if(b||x)if(w)for(;null!==(e=s.exec(M));){var F=parseFloat(e[1]),U=parseFloat(e[2]),k=parseFloat(e[3]);o.push(F,U,k)}else if(_)for(;null!==(e=s.exec(M));){var j=parseFloat(e[1]),B=parseFloat(e[2]),z=parseFloat(e[3]);a.push(j,B,z)}null!==l.exec(M)?(g=!0,v=!1,y=!1):null!==u.exec(M)?(g=!1,v=!0,y=!1):null!==h.exec(M)?(g=!1,v=!1,y=!0):null!==d.exec(M)?(b=!0,v=!1,g=!1,y=!1):null!==p.exec(M)?(x=!0,v=!1,g=!1,y=!1):null!==f.exec(M)?(w=!0,_=!1,v=!1,g=!1,y=!1):null!==m.exec(M)&&(_=!0,w=!1,v=!1,g=!1,y=!1)}var V="point";if(o.length===r.length&&(V="cell"),"point"===V)(n=new Xs).setIndex(new Rs(new Uint32Array(r),1)),n.addAttribute("position",new Rs(new Float32Array(i),3)),o.length===i.length&&n.addAttribute("color",new Rs(new Float32Array(o),3)),a.length===i.length&&n.addAttribute("normal",new Rs(new Float32Array(a),3));else{n=new Ls;var G=r.length/3,H=i.length/3;for(I=0;I<H;++I)n.vertices.push(new ss(A=i[3*I+0],E=i[3*I+1],C=i[3*I+2]));for(T=0;T<G;++T)n.faces.push(new Ms(r[3*T+0],r[3*T+1],r[3*T+2]));if(o.length===3*G)for(T=0;T<G;++T)F=o[3*T+0],U=o[3*T+1],k=o[3*T+2],n.faces[T].color=(new Ts).setRGB(F,U,k)}return n}(n(t)):function(t){var e,n,r,i,o,a,s,c=new Uint8Array(t),u=new DataView(t),l=[],h=[],d=[],p=0;function f(t,e){for(var n=e,r=t[n],i=[];10!==r;)i.push(String.fromCharCode(r)),r=t[++n];return{start:e,end:n,next:n+1,parsedString:i.join("")}}for(;;){if(0===(s=(a=f(c,p)).parsedString).indexOf("POINTS")){for(e=4*(i=parseInt(s.split(" ")[1],10))*3,l=new Float32Array(3*i),n=a.next,r=0;r<i;r++)l[3*r]=u.getFloat32(n,!1),l[3*r+1]=u.getFloat32(n+4,!1),l[3*r+2]=u.getFloat32(n+8,!1),n+=12;a.next=a.next+e+1}else if(0===s.indexOf("TRIANGLE_STRIPS")){var m=parseInt(s.split(" ")[1],10);e=4*(x=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*x-9*m);var v=0;for(n=a.next,r=0;r<m;r++){var g=u.getInt32(n,!1),y=[];for(n+=4,o=0;o<g;o++)y.push(u.getInt32(n,!1)),n+=4;for(var b=0;b<g-2;b++)b%2?(d[v++]=y[b],d[v++]=y[b+2],d[v++]=y[b+1]):(d[v++]=y[b],d[v++]=y[b+1],d[v++]=y[b+2])}a.next=a.next+e+1}else if(0===s.indexOf("POLYGONS")){var x;for(m=parseInt(s.split(" ")[1],10),e=4*(x=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*x-9*m),v=0,n=a.next,r=0;r<m;r++){for(g=u.getInt32(n,!1),y=[],n+=4,o=0;o<g;o++)y.push(u.getInt32(n,!1)),n+=4;for(b=1;b<g-1;b++)d[v++]=y[0],d[v++]=y[b],d[v++]=y[b+1]}a.next=a.next+e+1}else if(0===s.indexOf("POINT_DATA")){for(i=parseInt(s.split(" ")[1],10),a=f(c,a.next),e=4*i*3,h=new Float32Array(3*i),n=a.next,r=0;r<i;r++)h[3*r]=u.getFloat32(n,!1),h[3*r+1]=u.getFloat32(n+4,!1),h[3*r+2]=u.getFloat32(n+8,!1),n+=12;a.next=a.next+e}if((p=a.next)>=c.byteLength)break}var w=new Xs;return w.setIndex(new Rs(d,1)),w.addAttribute("position",new Rs(l,3)),h.length===l.length&&w.addAttribute("normal",new Rs(h,3)),w}(t)}}),(am.prototype=Object.create(ys.prototype)).constructor=am,am.prototype.isImmediateRenderObject=!0;var sm=function(t,e,n,r){am.call(this,e);var i=this,o=new Float32Array(36),a=new Float32Array(36);function s(t,e,n){return t+(e-t)*n}function c(t,e,n,r,c,u,l,h){var d=(n-l)/(h-l),p=i.normal_cache;o[e+0]=r+d*i.delta,o[e+1]=c,o[e+2]=u,a[e+0]=s(p[t+0],p[t+3],d),a[e+1]=s(p[t+1],p[t+4],d),a[e+2]=s(p[t+2],p[t+5],d)}function u(t,e,n,r,c,u,l,h){var d=(n-l)/(h-l),p=i.normal_cache;o[e+0]=r,o[e+1]=c+d*i.delta,o[e+2]=u;var f=t+3*i.yd;a[e+0]=s(p[t+0],p[f+0],d),a[e+1]=s(p[t+1],p[f+1],d),a[e+2]=s(p[t+2],p[f+2],d)}function l(t,e,n,r,c,u,l,h){var d=(n-l)/(h-l),p=i.normal_cache;o[e+0]=r,o[e+1]=c,o[e+2]=u+d*i.delta;var f=t+3*i.zd;a[e+0]=s(p[t+0],p[f+0],d),a[e+1]=s(p[t+1],p[f+1],d),a[e+2]=s(p[t+2],p[f+2],d)}function h(t){var e=3*t;0===i.normal_cache[e]&&(i.normal_cache[e+0]=i.field[t-1]-i.field[t+1],i.normal_cache[e+1]=i.field[t-i.yd]-i.field[t+i.yd],i.normal_cache[e+2]=i.field[t-i.zd]-i.field[t+i.zd])}function d(t,e,n,r,s,d){var f=r+1,m=r+i.yd,v=r+i.zd,g=f+i.yd,y=f+i.zd,b=r+i.yd+i.zd,x=f+i.yd+i.zd,w=0,_=i.field[r],S=i.field[f],T=i.field[m],M=i.field[g],A=i.field[v],E=i.field[y],C=i.field[b],P=i.field[x];_<s&&(w|=1),S<s&&(w|=2),T<s&&(w|=8),M<s&&(w|=4),A<s&&(w|=16),E<s&&(w|=32),C<s&&(w|=128),P<s&&(w|=64);var O=hm[w];if(0===O)return 0;var N=i.delta,L=t+N,I=e+N,R=n+N;1&O&&(h(r),h(f),c(3*r,0,s,t,e,n,_,S)),2&O&&(h(f),h(g),u(3*f,3,s,L,e,n,S,M)),4&O&&(h(m),h(g),c(3*m,6,s,t,I,n,T,M)),8&O&&(h(r),h(m),u(3*r,9,s,t,e,n,_,T)),16&O&&(h(v),h(y),c(3*v,12,s,t,e,R,A,E)),32&O&&(h(y),h(x),u(3*y,15,s,L,e,R,E,P)),64&O&&(h(b),h(x),c(3*b,18,s,t,I,R,C,P)),128&O&&(h(v),h(b),u(3*v,21,s,t,e,R,A,C)),256&O&&(h(r),h(v),l(3*r,24,s,t,e,n,_,A)),512&O&&(h(f),h(y),l(3*f,27,s,L,e,n,S,E)),1024&O&&(h(g),h(x),l(3*g,30,s,L,I,n,M,P)),2048&O&&(h(m),h(b),l(3*m,33,s,t,I,n,T,C)),w<<=4;for(var D,F=0,U=0;-1!=dm[w+U];)p(o,a,3*dm[D=w+U],3*dm[D+1],3*dm[D+2],d),U+=3,F++;return F}function p(t,e,n,r,o,a){var s=3*i.count;if(i.positionArray[s+0]=t[n],i.positionArray[s+1]=t[n+1],i.positionArray[s+2]=t[n+2],i.positionArray[s+3]=t[r],i.positionArray[s+4]=t[r+1],i.positionArray[s+5]=t[r+2],i.positionArray[s+6]=t[o],i.positionArray[s+7]=t[o+1],i.positionArray[s+8]=t[o+2],i.normalArray[s+0]=e[n],i.normalArray[s+1]=e[n+1],i.normalArray[s+2]=e[n+2],i.normalArray[s+3]=e[r],i.normalArray[s+4]=e[r+1],i.normalArray[s+5]=e[r+2],i.normalArray[s+6]=e[o],i.normalArray[s+7]=e[o+1],i.normalArray[s+8]=e[o+2],i.enableUvs){var c=2*i.count;i.uvArray[c+0]=t[n],i.uvArray[c+1]=t[n+2],i.uvArray[c+2]=t[r],i.uvArray[c+3]=t[r+2],i.uvArray[c+4]=t[o],i.uvArray[c+5]=t[o+2]}i.enableColors&&(i.colorArray[s+0]=t[n],i.colorArray[s+1]=t[n+1],i.colorArray[s+2]=t[n+2],i.colorArray[s+3]=t[r],i.colorArray[s+4]=t[r+1],i.colorArray[s+5]=t[r+2],i.colorArray[s+6]=t[o],i.colorArray[s+7]=t[o+1],i.colorArray[s+8]=t[o+2]),i.count+=3,i.count>=i.maxCount-3&&(i.hasPositions=!0,i.hasNormals=!0,i.enableUvs&&(i.hasUvs=!0),i.enableColors&&(i.hasColors=!0),a(i))}this.enableUvs=void 0!==n&&n,this.enableColors=void 0!==r&&r,this.init=function(t){this.resolution=t,this.isolation=80,this.size=t,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(t){if(0!==this.count){for(var e=3*this.count;e<this.positionArray.length;e++)this.positionArray[e]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),t(this)}},this.addBall=function(t,e,n,r,i){var o=Math.sign(r);r=Math.abs(r);var a=this.size*Math.sqrt(r/i),s=n*this.size,c=e*this.size,u=t*this.size,l=Math.floor(s-a);l<1&&(l=1);var h=Math.floor(s+a);h>this.size-1&&(h=this.size-1);var d=Math.floor(c-a);d<1&&(d=1);var p=Math.floor(c+a);p>this.size-1&&(p=this.size-1);var f=Math.floor(u-a);f<1&&(f=1);var m,v,g,y,b,x,w,_,S,T,M,A=Math.floor(u+a);for(A>this.size-1&&(A=this.size-1),g=l;g<h;g++)for(b=this.size2*g,S=(_=g/this.size-n)*_,v=d;v<p;v++)for(y=b+this.size*v,T=(w=v/this.size-e)*w,m=f;m<A;m++)(M=r/(1e-6+(x=m/this.size-t)*x+T+S)-i)>0&&(this.field[y+m]+=M*o)},this.addPlaneX=function(t,e){var n,r,i,o,a,s,c=this.size,u=this.yd,l=this.zd,h=this.field,d=c*Math.sqrt(t/e);for(d>c&&(d=c),n=0;n<d;n++)if((o=t/(1e-4+(a=n/c)*a)-e)>0)for(r=0;r<c;r++)for(s=n+r*u,i=0;i<c;i++)h[l*i+s]+=o},this.addPlaneY=function(t,e){var n,r,i,o,a,s,c,u=this.size,l=this.yd,h=this.zd,d=this.field,p=u*Math.sqrt(t/e);for(p>u&&(p=u),r=0;r<p;r++)if((o=t/(1e-4+(a=r/u)*a)-e)>0)for(s=r*l,n=0;n<u;n++)for(c=s+n,i=0;i<u;i++)d[h*i+c]+=o},this.addPlaneZ=function(t,e){var n,r,i,o,a,s,c,u=this.size,l=this.yd,h=this.zd,d=this.field,p=u*Math.sqrt(t/e);for(p>u&&(p=u),i=0;i<p;i++)if((o=t/(1e-4+(a=i/u)*a)-e)>0)for(s=h*i,r=0;r<u;r++)for(c=s+r*l,n=0;n<u;n++)d[c+n]+=o},this.reset=function(){var t;for(t=0;t<this.size3;t++)this.normal_cache[3*t]=0,this.field[t]=0},this.render=function(t){this.begin();for(var e=this.size-2,n=1;n<e;n++)for(var r=this.size2*n,i=(n-this.halfsize)/this.halfsize,o=1;o<e;o++)for(var a=r+this.size*o,s=(o-this.halfsize)/this.halfsize,c=1;c<e;c++)d((c-this.halfsize)/this.halfsize,s,i,a+c,this.isolation,t);this.end(t)},this.generateGeometry=function(){var t=0,e=new Ls,n=[];return this.render(function(r){for(var i=0;i<r.count;i++){var o=(new ss).fromArray(r.positionArray,3*i),a=(new ss).fromArray(r.normalArray,3*i);e.vertices.push(o),n.push(a)}var s=r.count/3;for(i=0;i<s;i++){var c=3*(t+i),u=c+1,l=c+2,h=new Ms(c,u,l,[n[c],n[u],n[l]]);e.faces.push(h)}t+=s,r.count=0}),e},this.init(t)};(sm.prototype=Object.create(am.prototype)).constructor=sm;var cm,um,lm,hm=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),dm=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);function pm(t,e,n,r,i,o,a,s,c){Ou.call(this,t,e,n,r,i,o,a,s,c),this.needsUpdate=!0}function fm(t){ys.call(this),this.type="Sprite",this.material=void 0!==t?t:new il,this.center=new Cs(.5,.5)}(pm.prototype=Object.create(Ou.prototype)).constructor=pm,fm.prototype=Object.assign(Object.create(ys.prototype),{constructor:fm,isSprite:!0,raycast:(cm=new ss,um=new ss,lm=new ss,function(t,e){um.setFromMatrixPosition(this.matrixWorld),t.ray.closestPointToPoint(um,cm),lm.setFromMatrixScale(this.matrixWorld);var n=lm.x*lm.y/4;if(!(um.distanceToSquared(cm)>n)){var r=t.ray.origin.distanceTo(cm);r<t.near||r>t.far||e.push({distance:r,point:cm.clone(),face:null,object:this})}}),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return ys.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var mm=function(t,e){this.lut=[],this.map=vm[t],this.n=e,this.mapname=t;for(var n=1/this.n,r=0;r<=1;r+=n)for(var i=0;i<this.map.length-1;i++)if(r>=this.map[i][0]&&r<this.map[i+1][0]){var o=this.map[i][0],a=this.map[i+1][0],s=new Ts(16777215).setHex(this.map[i][1]),c=new Ts(16777215).setHex(this.map[i+1][1]),u=s.lerp(c,(r-o)/(a-o));this.lut.push(u)}return this.set(this)};mm.prototype={constructor:mm,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(t){return t instanceof mm&&this.copy(t),this},setMin:function(t){return this.minV=t,this},setMax:function(t){return this.maxV=t,this},changeNumberOfColors:function(t){return this.n=t,new mm(this.mapname,this.n)},changeColorMap:function(t){return this.mapname=t,new mm(this.mapname,this.n)},copy:function(t){return this.lut=t.lut,this.mapname=t.mapname,this.map=t.map,this.n=t.n,this.minV=t.minV,this.maxV=t.maxV,this},getColor:function(t){t<=this.minV?t=this.minV:t>=this.maxV&&(t=this.maxV),t=(t-this.minV)/(this.maxV-this.minV);var e=Math.round(t*this.n);return e==this.n&&(e-=1),this.lut[e]},addColorMap:function(t,e){vm[t]=e},setLegendOn:function(t){void 0===t&&(t={}),this.legend={},this.legend.layout=t.hasOwnProperty("layout")?t.layout:"vertical",this.legend.position=t.hasOwnProperty("position")?t.position:{x:21.5,y:8,z:5},this.legend.dimensions=t.hasOwnProperty("dimensions")?t.dimensions:{width:.5,height:3},this.legend.canvas=document.createElement("canvas"),this.legend.canvas.setAttribute("id","legend"),this.legend.canvas.setAttribute("hidden",!0),document.body.appendChild(this.legend.canvas),this.legend.ctx=this.legend.canvas.getContext("2d"),this.legend.canvas.setAttribute("width",1),this.legend.canvas.setAttribute("height",this.n),this.legend.texture=new Ou(this.legend.canvas);var e=this.legend.ctx.getImageData(0,0,1,this.n),n=e.data;this.map=vm[this.mapname];for(var r=0,i=1/this.n,o=1;o>=0;o-=i)for(var a=this.map.length-1;a>=0;a--)if(o<this.map[a][0]&&o>=this.map[a-1][0]){var s=this.map[a-1][0],c=this.map[a][0],u=new Ts(16777215).setHex(this.map[a-1][1]),l=new Ts(16777215).setHex(this.map[a][1]),h=u.lerp(l,(o-s)/(c-s));n[4*r]=Math.round(255*h.r),n[4*r+1]=Math.round(255*h.g),n[4*r+2]=Math.round(255*h.b),n[4*r+3]=255,r+=1}return this.legend.ctx.putImageData(e,0,0),this.legend.texture.needsUpdate=!0,this.legend.legendGeometry=new Du(this.legend.dimensions.width,this.legend.dimensions.height),this.legend.legendMaterial=new Xc({map:this.legend.texture,side:uc}),this.legend.mesh=new Kc(this.legend.legendGeometry,this.legend.legendMaterial),"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh.position.copy(this.legend.position),this.legend.mesh},setLegendOff:function(){return this.legend=null,this.legend},setLegendLayout:function(t){return!!this.legend&&this.legend.layout!=t&&("horizontal"==t||"vertical"==t)&&(this.layout=t,"horizontal"==t&&(this.legend.mesh.rotation.z=Math.PI/180*90),"vertical"==t&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh)},setLegendPosition:function(t){return this.legend.position=new ss(t.x,t.y,t.z),this.legend},setLegendLabels:function(t,e){if(!this.legend)return!1;"function"==typeof t&&(e=t),void 0===t&&(t={}),this.legend.labels={},this.legend.labels.fontsize=t.hasOwnProperty("fontsize")?t.fontsize:24,this.legend.labels.fontface=t.hasOwnProperty("fontface")?t.fontface:"Arial",this.legend.labels.title=t.hasOwnProperty("title")?t.title:"",this.legend.labels.um=t.hasOwnProperty("um")?" [ "+t.um+" ]":"",this.legend.labels.ticks=t.hasOwnProperty("ticks")?t.ticks:0,this.legend.labels.decimal=t.hasOwnProperty("decimal")?t.decimal:2,this.legend.labels.notation=t.hasOwnProperty("notation")?t.notation:"standard";var n=document.createElement("canvas"),r=n.getContext("2d");r.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface,r.measureText(this.legend.labels.title.toString()+this.legend.labels.um.toString()),r.fillStyle="rgba(255,100,100,0.8)",r.strokeStyle="rgba(255,0,0,1)",r.lineWidth=4,r.fillStyle="rgba( 0, 0, 0, 1.0 )",r.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);var i=new pm(n);i.minFilter=Ac;var o=new fm(new il({map:i}));if(o.scale.set(2,1,1),"vertical"==this.legend.layout&&o.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z),"horizontal"==this.legend.layout&&o.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z),this.legend.labels.ticks>0){var a={},s={};if("vertical"==this.legend.layout)var c=this.legend.position.y+.36*this.legend.dimensions.height,u=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var l=this.legend.position.x+.75*this.legend.dimensions.height,h=this.legend.position.x-1.2*this.legend.dimensions.width;for(var d=0;d<this.legend.labels.ticks;d++){var p=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*d+this.minV;p=e?e(p):"scientific"==this.legend.labels.notation?p.toExponential(this.legend.labels.decimal):p.toFixed(this.legend.labels.decimal);var f=document.createElement("canvas"),m=f.getContext("2d");m.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface,m.measureText(p.toString()),m.fillStyle="rgba(255,100,100,0.8)",m.strokeStyle="rgba(255,0,0,1)",m.lineWidth=4,m.fillStyle="rgba( 0, 0, 0, 1.0 )",m.fillText(p.toString(),4,this.legend.labels.fontsize+4);var v=new pm(f);v.minFilter=Ac;var g=new fm(new il({map:v}));if(g.scale.set(2,1,1),"vertical"==this.legend.layout&&g.position.set(this.legend.position.x+2.7*this.legend.dimensions.width,y=u+(p-this.minV)/(this.maxV-this.minV)*(c-u),this.legend.position.z),"horizontal"==this.legend.layout){var y=h+(p-this.minV)/(this.maxV-this.minV)*(l-h);if(this.legend.labels.ticks>5)if(d%2==0)var b=1.7;else b=2.1;else b=1.7;g.position.set(y,this.legend.position.y-this.legend.dimensions.width*b,this.legend.position.z)}var x,w=new qc({color:0,linewidth:2}),_=[];"vertical"==this.legend.layout&&(_.push(new ss(this.legend.position.x+.55*this.legend.dimensions.width,x=this.legend.position.y-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((p-this.minV)/(this.maxV-this.minV)*.99),this.legend.position.z)),_.push(new ss(this.legend.position.x+.7*this.legend.dimensions.width,x,this.legend.position.z))),"horizontal"==this.legend.layout&&(_.push(new ss(x=this.legend.position.x-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((p-this.minV)/(this.maxV-this.minV)*.99),this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),_.push(new ss(x,this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z)));var S=new $c((new Xs).setFromPoints(_),w);s[d]=S,a[d]=g}}return{title:o,ticks:a,lines:s}}};var vm={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]},gm=function(t,e){Kc.call(this,t,e),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)};gm.prototype=Object.assign(Object.create(Kc.prototype),{constructor:gm,createAnimation:function(t,e,n,r){var i={start:e,end:n,length:n-e+1,fps:r,duration:(n-e)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=i,this.animationsList.push(i)},autoCreateAnimations:function(t){for(var e,n=/([a-z]+)_?(\d+)/i,r={},i=this.geometry,o=0,a=i.morphTargets.length;o<a;o++){var s=i.morphTargets[o].name.match(n);s&&s.length>1&&(r[c=s[1]]||(r[c]={start:1/0,end:-1/0}),o<(u=r[c]).start&&(u.start=o),o>u.end&&(u.end=o),e||(e=c))}for(var c in r){var u;this.createAnimation(c,(u=r[c]).start,u.end,t)}this.firstAnimation=e},setAnimationDirectionForward:function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},setAnimationDirectionBackward:function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},setAnimationFPS:function(t,e){var n=this.animationsMap[t];n&&(n.fps=e,n.duration=(n.end-n.start)/n.fps)},setAnimationDuration:function(t,e){var n=this.animationsMap[t];n&&(n.duration=e,n.fps=(n.end-n.start)/n.duration)},setAnimationWeight:function(t,e){var n=this.animationsMap[t];n&&(n.weight=e)},setAnimationTime:function(t,e){var n=this.animationsMap[t];n&&(n.time=e)},getAnimationTime:function(t){var e=0,n=this.animationsMap[t];return n&&(e=n.time),e},getAnimationDuration:function(t){var e=-1,n=this.animationsMap[t];return n&&(e=n.duration),e},playAnimation:function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},stopAnimation:function(t){var e=this.animationsMap[t];e&&(e.active=!1)},update:function(t){for(var e=0,n=this.animationsList.length;e<n;e++){var r=this.animationsList[e];if(r.active){var i=r.duration/r.length;r.time+=r.direction*t,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.start+os.clamp(Math.floor(r.time/i),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var s=r.time%i/i;r.directionBackwards&&(s=1-s),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=s*a,this.morphTargetInfluences[r.lastFrame]=(1-s)*a):this.morphTargetInfluences[r.currentFrame]=a}}}}),Ms.prototype.set=function(t,e,n){this.a=t,this.b=e,this.c=n};var ym=function(t,e,n,r,i,o){this.array_type=r,this.register_type=n,this.unit_size=i,this.accessors=o,this.buffer=new r(t*i),this.register=[],this.length=0,this.real_length=t,this.available_registers=e;for(var a=0;a<e;a++)this.register.push(new n)};ym.prototype={constructor:ym,index_to_register:function(t,e,n){var r=t*this.unit_size;if(e>=this.available_registers)throw new Error("BufferSubdivisionModifier: Not enough registers in TypedArrayHelper.");if(t>this.length)throw new Error("BufferSubdivisionModifier: Index is out of range in TypedArrayHelper.");for(var i=0;i<this.unit_size;i++)this.register[e][this.accessors[i]]=this.buffer[r+i]},resize:function(t){var e;0===t&&(t=8),t<this.length?this.buffer=this.buffer.subarray(0,this.length*this.unit_size):this.buffer.length<t*this.unit_size?((e=new this.array_type(t*this.unit_size)).set(this.buffer),this.buffer=e,this.real_length=t):((e=new this.array_type(t*this.unit_size)).set(this.buffer.subarray(0,this.length*this.unit_size)),this.buffer=e,this.real_length=t)},from_existing:function(t){this.buffer=new this.array_type(t.length),this.buffer.set(t),this.length=t.length/this.unit_size,this.real_length=this.length},push_element:function(t){this.length+1>this.real_length&&this.resize(2*this.real_length);for(var e=this.length*this.unit_size,n=0;n<this.unit_size;n++)this.buffer[e+n]=t[this.accessors[n]];this.length++},trim_size:function(){this.length<this.real_length&&this.resize(this.length)}};var bm=function(t){this.subdivisions=void 0===t?1:t};bm.prototype.modify=function(t){t instanceof Ls?(t.mergeVertices(),"undefined"==typeof t.normals&&(t.normals=[]),t=function(t){for(var e=new Xs,n=new ym(t.vertices.length,0,ss,Float32Array,3,["x","y","z"]),r=new ym(t.faces.length,0,Ms,Uint32Array,3,["a","b","c"]),i=new ym(3*t.faceVertexUvs[0].length*3,0,Cs,Float32Array,2,["x","y"]),o=0,a=t.vertices.length;o<a;o++)n.push_element(t.vertices[o]);for(o=0,a=t.faces.length;o<a;o++)r.push_element(t.faces[o]);for(o=0,a=t.faceVertexUvs[0].length;o<a;o++)i.push_element(t.faceVertexUvs[0][o][0]),i.push_element(t.faceVertexUvs[0][o][1]),i.push_element(t.faceVertexUvs[0][o][2]);return r.trim_size(),n.trim_size(),i.trim_size(),e.setIndex(new Rs(r.buffer,3)),e.addAttribute("position",new Rs(n.buffer,3)),e.addAttribute("uv",new Rs(i.buffer,2)),e}(t)):t instanceof Xs||console.error("BufferSubdivisionModifier: Geometry is not an instance of BufferGeometry or Geometry");for(var e=this.subdivisions;e-- >0;)this.smooth(t);return function(t){var e=["x","y","z"],n=["x","y"],r=new ym(0,3,ss,Float32Array,3,e),i=new ym(0,3,Ms,Uint32Array,3,["a","b","c"]),o=new ym(0,3,Cs,Float32Array,2,n),a=new ym(0,3,ss,Float32Array,3,e);r.from_existing(t.getAttribute("position").array),i.from_existing(t.index.array),o.from_existing(t.getAttribute("uv").array),function(t){var e=["x","y","z"],n=new ym(0,5,ss,Float32Array,3,e),r=new ym(0,3,Ms,Uint32Array,3,["a","b","c"]);n.from_existing(t.getAttribute("position").array);var i,o=new ym(3*n.length,4,ss,Float32Array,3,e),a=new ym(n.length,1,function(){this.x=0},Float32Array,1,["x"]);o.length=n.length,r.from_existing(t.index.array);for(var s=[0,0,0],c=0,u=r.length;c<u;c++)r.index_to_register(c,0),n.index_to_register(r.register[0].a,0),n.index_to_register(r.register[0].b,1),n.index_to_register(r.register[0].c,2),o.register[0].subVectors(n.register[1],n.register[0]),o.register[1].subVectors(n.register[2],n.register[1]),o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),a.buffer[r.register[0].a]+=i,a.buffer[r.register[0].b]+=i,a.buffer[r.register[0].c]+=i;for(c=0,u=r.length;c<u;c++)r.index_to_register(c,0),n.index_to_register(r.register[0].a,0),n.index_to_register(r.register[0].b,1),n.index_to_register(r.register[0].c,2),o.register[0].subVectors(n.register[1],n.register[0]),o.register[1].subVectors(n.register[2],n.register[0]),o.register[3].set(0,0,0),o.register[3].x=o.register[0].y*o.register[1].z-o.register[0].z*o.register[1].y,o.register[3].y=o.register[0].z*o.register[1].x-o.register[0].x*o.register[1].z,o.register[3].z=o.register[0].x*o.register[1].y-o.register[0].y*o.register[1].x,o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),s[0]=i/a.buffer[r.register[0].a],s[1]=i/a.buffer[r.register[0].b],s[2]=i/a.buffer[r.register[0].c],o.buffer[3*r.register[0].a+0]+=o.register[3].x*s[0],o.buffer[3*r.register[0].a+1]+=o.register[3].y*s[0],o.buffer[3*r.register[0].a+2]+=o.register[3].z*s[0],o.buffer[3*r.register[0].b+0]+=o.register[3].x*s[1],o.buffer[3*r.register[0].b+1]+=o.register[3].y*s[1],o.buffer[3*r.register[0].b+2]+=o.register[3].z*s[1],o.buffer[3*r.register[0].c+0]+=o.register[3].x*s[2],o.buffer[3*r.register[0].c+1]+=o.register[3].y*s[2],o.buffer[3*r.register[0].c+2]+=o.register[3].z*s[2];o.trim_size(),t.addAttribute("normal",new Rs(o.buffer,3))}(t),a.from_existing(t.getAttribute("normal").array);for(var s=new ym(3*i.length,3,ss,Float32Array,3,e),c=new ym(3*i.length,3,ss,Float32Array,3,e),u=new ym(3*i.length,3,Cs,Float32Array,2,n),l=0,h=i.length;l<h;l++)i.index_to_register(l,0),r.index_to_register(i.register[0].a,0),r.index_to_register(i.register[0].b,1),r.index_to_register(i.register[0].c,2),s.push_element(r.register[0]),s.push_element(r.register[1]),s.push_element(r.register[2]),0!==o.length&&(o.index_to_register(3*l+0,0),o.index_to_register(3*l+1,1),o.index_to_register(3*l+2,2),u.push_element(o.register[0]),u.push_element(o.register[1]),u.push_element(o.register[2])),a.index_to_register(i.register[0].a,0),a.index_to_register(i.register[0].b,1),a.index_to_register(i.register[0].c,2),c.push_element(a.register[0]),c.push_element(a.register[1]),c.push_element(a.register[2]);return s.trim_size(),u.trim_size(),c.trim_size(),t.index=null,t.addAttribute("position",new Rs(s.buffer,3)),t.addAttribute("normal",new Rs(c.buffer,3)),0!==u.length&&t.addAttribute("uv",new Rs(u.buffer,2)),t}(t)};var xm=function(t,e){this.a=t,this.b=e,this.faces=[],this.newEdge=null};!function(){var t=["a","b","c"],e=["x","y","z"],n=["x","y"];function r(t,e,n){return n[Math.min(t,e)+"_"+Math.max(t,e)]}function i(t,e,n,r,i,o){var a,s=Math.min(t,e),c=Math.max(t,e),u=s+"_"+c;u in r?a=r[u]:(a=new xm(s,c),r[u]=a),a.faces.push(i),o[t].edges.push(a),o[e].edges.push(a)}function o(t,e){t.push_element(e)}function a(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function s(t,e,n,r){t.push_element(e),t.push_element(n),t.push_element(r)}bm.prototype.smooth=function(c){var u,l,h,d,p,f,m,v,g,y,b,x,w;u=new ym(0,3,ss,Float32Array,3,e),l=new ym(0,3,Ms,Uint32Array,3,t),h=new ym(0,3,Cs,Float32Array,2,n),u.from_existing(c.getAttribute("position").array),l.from_existing(c.index.array),h.from_existing(c.getAttribute("uv").array);var _,S,T,M,A,E,C,P=!1;"undefined"!=typeof h&&0!==h.length&&(P=!0),function(t,e,n,r){var o,a,s;for(o=0,a=t.length;o<a;o++)n[o]={edges:[]};for(o=0,a=e.length;o<a;o++)e.index_to_register(o,0),i((s=e.register[0]).a,s.b,0,r,o,n),i(s.b,s.c,0,r,o,n),i(s.c,s.a,0,r,o,n)}(u,l,x=new Array(u.length),w={});var O=(d=new ym(2*c.getAttribute("position").array.length/3,2,ss,Float32Array,3,e)).register[1];for(v in w){for(T=d.register[0],A=3/8,E=1/8,2!==(C=(S=w[v]).faces.length)&&(A=.5,E=0),u.index_to_register(S.a,0),u.index_to_register(S.b,1),T.addVectors(u.register[0],u.register[1]).multiplyScalar(A),O.set(0,0,0),y=0;y<C;y++){for(l.index_to_register(S.faces[y],0),M=l.register[0],b=0;b<3&&(u.index_to_register(M[t[b]],2),_=u.register[2],M[t[b]]===S.a||M[t[b]]===S.b);b++);O.add(_)}O.multiplyScalar(E),T.add(O),S.newEdge=d.length,d.push_element(T)}var N,L,I,R,D,F,U,k,j,B=d.length;for(v=0,g=u.length;v<g;v++){for(u.index_to_register(v,0,e),3===(m=(D=x[v].edges).length)?N=3/16:m>3&&(N=3/(8*m)),L=1-m*N,I=N,m<=2&&2===m&&(L=.75,I=1/8),F=u.register[0].multiplyScalar(L),O.set(0,0,0),y=0;y<m;y++)u.index_to_register(_=(R=D[y]).a!==v?R.a:R.b,1,e),O.add(u.register[1]);O.multiplyScalar(I),F.add(O),d.push_element(F,e)}p=new ym(4*c.index.array.length/3,1,Ms,Float32Array,3,t);var z=(f=new ym(4*c.getAttribute("uv").array.length/2,3,Cs,Float32Array,2,n)).register[0],V=f.register[1],G=f.register[2],H=p.register[0];for(v=0,g=l.length;v<g;v++)if(l.index_to_register(v,0),U=r((M=l.register[0]).a,M.b,w).newEdge,k=r(M.b,M.c,w).newEdge,j=r(M.c,M.a,w).newEdge,H.set(U,k,j),o(p,H),H.set(M.a+B,U,j),o(p,H),H.set(M.b+B,k,U),o(p,H),H.set(M.c+B,j,k),o(p,H),!0===P){h.index_to_register(3*v+0,0),h.index_to_register(3*v+1,1),h.index_to_register(3*v+2,2);var W=h.register[0],X=h.register[1],q=h.register[2];z.set(a(W.x,X.x),a(W.y,X.y)),V.set(a(X.x,q.x),a(X.y,q.y)),G.set(a(W.x,q.x),a(W.y,q.y)),s(f,z,V,G),s(f,W,z,G),s(f,X,V,z),s(f,q,G,V)}p.trim_size(),d.trim_size(),f.trim_size(),c.setIndex(new Rs(p.buffer,3)),c.addAttribute("position",new Rs(d.buffer,3)),c.addAttribute("uv",new Rs(f.buffer,2))}}(),function(){var t=new ss,e=new ss;function n(t,e,n,r,i,o){this.a=r,this.b=i,this.c=o,this.v1=t,this.v2=e,this.v3=n,this.normal=new ss,this.computeNormal(),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(n),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(n),n.faces.push(this),n.addUniqueNeighbor(t),n.addUniqueNeighbor(e)}function r(t,e){this.position=t,this.id=e,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}n.prototype.computeNormal=function(){var n=this.v1.position,r=this.v2.position;t.subVectors(this.v3.position,r),e.subVectors(n,r),t.cross(e).normalize(),this.normal.copy(t)},n.prototype.hasVertex=function(t){return t===this.v1||t===this.v2||t===this.v3},n.prototype.replaceVertex=function(t,e){var n,r;t===this.v1?this.v1=e:t===this.v2?this.v2=e:t===this.v3&&(this.v3=e),(r=(n=t.faces).indexOf(this))>-1&&n.splice(r,1),e.faces.push(this),t.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(t),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},r.prototype.addUniqueNeighbor=function(t){var e,n;-1===(e=this.neighbors).indexOf(n=t)&&e.push(n)},r.prototype.removeIfNonNeighbor=function(t){var e=this.neighbors,n=this.faces,r=e.indexOf(t);if(-1!==r){for(var i=0;i<n.length;i++)if(n[i].hasVertex(t))return;e.splice(r,1)}}}();var wm=function(t){this.subdivisions=void 0===t?1:t};wm.prototype.modify=function(t){for(var e=this.subdivisions;e-- >0;)this.smooth(t);t.computeFaceNormals(),t.computeVertexNormals()},function(){var t=["a","b","c"];function e(t,e,n){return n[Math.min(t,e)+"_"+Math.max(t,e)]}function n(t,e,n,r,i,o){var a,s=Math.min(t,e),c=Math.max(t,e),u=s+"_"+c;u in r?a=r[u]:r[u]=a={a:n[s],b:n[c],newEdge:null,faces:[]},a.faces.push(i),o[t].edges.push(a),o[e].edges.push(a)}function r(t,e,n,r){t.push(new Ms(e,n,r))}function i(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function o(t,e,n,r){t.push([e.clone(),n.clone(),r.clone()])}wm.prototype.smooth=function(a){var s,c,u,l,h,d,p,f,m,v,g,y,b,x,w=new ss,_=[];s=a.vertices,c=a.faces;var S,T,M,A,E,C,P,O,N,L,I,R,D,F,U=void 0!==(u=a.faceVertexUvs[0])&&u.length>0;for(p in function(t,e,r,i){var o,a,s;for(o=0,a=t.length;o<a;o++)r[o]={edges:[]};for(o=0,a=e.length;o<a;o++)n((s=e[o]).a,s.b,t,i,s,r),n(s.b,s.c,t,i,s,r),n(s.c,s.a,t,i,s,r)}(s,c,g=new Array(s.length),y={}),b=[],y){for(T=y[p],M=new ss,E=3/8,C=1/8,2!=(P=T.faces.length)&&(E=.5,C=0),M.addVectors(T.a,T.b).multiplyScalar(E),w.set(0,0,0),m=0;m<P;m++){for(A=T.faces[m],v=0;v<3&&((S=s[A[t[v]]])===T.a||S===T.b);v++);w.add(S)}w.multiplyScalar(C),M.add(w),T.newEdge=b.length,b.push(M)}for(x=[],p=0,f=s.length;p<f;p++){for(D=s[p],3==(d=(R=g[p].edges).length)?O=3/16:d>3&&(O=3/(8*d)),N=1-d*O,L=O,d<=2&&2==d&&(N=.75,L=1/8),F=D.clone().multiplyScalar(N),w.set(0,0,0),m=0;m<d;m++)w.add(S=(I=R[m]).a!==D?I.a:I.b);w.multiplyScalar(L),F.add(w),x.push(F)}l=x.concat(b);var k,j,B,z,V,G,H,W=x.length;h=[];var X=new Cs,q=new Cs,Y=new Cs;for(p=0,f=c.length;p<f;p++)r(h,k=e((A=c[p]).a,A.b,y).newEdge+W,j=e(A.b,A.c,y).newEdge+W,B=e(A.c,A.a,y).newEdge+W),r(h,A.a,k,B),r(h,A.b,j,k),r(h,A.c,B,j),U&&(H=(z=u[p])[2],X.set(i((V=z[0]).x,(G=z[1]).x),i(V.y,G.y)),q.set(i(G.x,H.x),i(G.y,H.y)),Y.set(i(V.x,H.x),i(V.y,H.y)),o(_,X,q,Y),o(_,V,X,Y),o(_,G,q,X),o(_,H,Y,q));a.vertices=l,a.faces=h,U&&(a.faceVertexUvs[0]=_)}}();var _m=function(t,e){Kc.call(this,t,e),this.type="MorphAnimMesh",this.mixer=new jp(this),this.activeAction=null};(_m.prototype=Object.create(Kc.prototype)).constructor=_m,_m.prototype.setDirectionForward=function(){this.mixer.timeScale=1},_m.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},_m.prototype.playAnimation=function(t,e){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var n=_u.findByName(this,t);if(!n)throw new Error("MorphAnimMesh: animations["+t+"] undefined in .playAnimation()");var r=this.mixer.clipAction(n);r.timeScale=n.tracks.length*e/n.duration,this.activeAction=r.play()},_m.prototype.updateAnimation=function(t){this.mixer.update(t)},_m.prototype.copy=function(t){return Kc.prototype.copy.call(this,t),this.mixer=new jp(this),this};var Sm=function(t){Xp.call(this,"v4",{shared:!1}),this.index=t||0};Sm.vertexDict=["color","color2"],Sm.fragmentDict=["vColor","vColor2"],(Sm.prototype=Object.create(Xp.prototype)).constructor=Sm,Sm.prototype.generate=function(t,e){var n;return t.material.requires.color[this.index]=!0,n=t.isShader("vertex")?Sm.vertexDict[this.index]:Sm.fragmentDict[this.index],t.format(n,this.getType(t),e)},Sm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e};var Tm=function(t){Xp.call(this,"v3",{shared:!1}),this.scope=t||Tm.TOTAL};Tm.TOTAL="total",Tm.prototype=Object.create(Xp.prototype),Tm.prototype.constructor=Tm,Tm.prototype.nodeType="Light",Tm.prototype.generate=function(t,e){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.getType(t),e):(console.warn('LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.getType(t),e))},Tm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Mm=function(t){Xp.call(this,"v3",{unique:!0}),this.scope=t||Mm.CUBE};Mm.CUBE="cube",Mm.SPHERE="sphere",Mm.VECTOR="vector",Mm.prototype=Object.create(Xp.prototype),Mm.prototype.constructor=Mm,Mm.prototype.nodeType="Reflect",Mm.prototype.getType=function(t){switch(this.scope){case Mm.SPHERE:return"v2"}return this.type},Mm.prototype.generate=function(t,e){var n;switch(this.scope){case Mm.VECTOR:t.material.addFragmentNode("vec3 reflectVec = inverseTransformDirection( reflect( -normalize( vViewPosition ), normal ), viewMatrix );"),n="reflectVec";break;case Mm.CUBE:var r=new Mm(Mm.VECTOR).build(t,"v3");t.material.addFragmentNode("vec3 reflectCubeVec = vec3( -1.0 * "+r+".x, "+r+".yz );"),n="reflectCubeVec";break;case Mm.SPHERE:r=new Mm(Mm.VECTOR).build(t,"v3"),t.material.addFragmentNode("vec2 reflectSphereVec = normalize((viewMatrix * vec4("+r+", 0.0 )).xyz + vec3(0.0,0.0,1.0)).xy * 0.5 + 0.5;"),n="reflectSphereVec"}return t.format(n,this.getType(this.type),e)},Mm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Am=function(t){Xp.call(this,"v2"),this.resolution=t};(Am.prototype=Object.create(Xp.prototype)).constructor=Am,Am.prototype.nodeType="ScreenUV",Am.prototype.generate=function(t,e){var n;return t.isShader("fragment")?n="(gl_FragCoord.xy/"+this.resolution.build(t,"v2")+")":(console.warn("ScreenUVNode is not compatible with "+t.shader+" shader."),n="vec2( 0.0 )"),t.format(n,this.getType(t),e)},Am.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).resolution=this.resolution.toJSON(t).uuid),e};var Em=function(t,e){Wp.call(this,e),this.name=t};(Em.prototype=Object.create(Wp.prototype)).constructor=Em,Em.prototype.nodeType="Attribute",Em.prototype.getAttributeType=function(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type},Em.prototype.getType=function(t){var e=this.getAttributeType(t);return t.getTypeByFormat(e)},Em.prototype.generate=function(t,e){var n=this.getAttributeType(t),r=t.material.getAttribute(this.name,n);return t.format(t.isShader("vertex")?this.name:r.varying.name,this.getType(t),e)},Em.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).out=this.type),e};var Cm=function(t,e){Xp.call(this),this.setFunction(t,e)};(Cm.prototype=Object.create(Xp.prototype)).constructor=Cm,Cm.prototype.nodeType="FunctionCall",Cm.prototype.setFunction=function(t,e){this.value=t,this.inputs=e||[]},Cm.prototype.getFunction=function(){return this.value},Cm.prototype.getType=function(t){return this.value.getType(t)},Cm.prototype.generate=function(t,e){for(var n=this.getType(t),r=this.value,i=r.build(t,e)+"(",o=[],a=0;a<r.inputs.length;a++){var s=r.inputs[a];o.push((this.inputs[a]||this.inputs[s.name]).build(t,t.getTypeByFormat(s.type)))}return i+=o.join(",")+")",t.format(i,n,e)},Cm.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){var n=this.value;if((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,n.inputs.length){e.inputs={};for(var r=0;r<n.inputs.length;r++){var i=n.inputs[r];e.inputs[i.name]=(this.inputs[r]||this.inputs[i.name]).toJSON(t).uuid}}}return e};var Pm=function(t){Wp.call(this,"v4"),this.value=t};(Pm.prototype=Object.create(Wp.prototype)).constructor=Pm,Pm.prototype.nodeType="Raw",Pm.prototype.generate=function(t){var e=this.value.parseAndBuildCode(t,this.type);return e.code+"\n"+("vertex"==t.shader?"gl_Position = "+e.result+";":"gl_FragColor = "+e.result+";")},Pm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),e};var Om=function(t){this.material=t,this.caches=[],this.slots=[],this.keywords={},this.parsing=!1,this.optimize=!0,this.update()};Om.type={float:"fv1",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"iv1"},Om.constructors=["float","vec2","vec3","vec4"],Om.elements=["x","y","z","w"],Om.prototype={constructor:Om,addCache:function(t,e){return this.caches.push({name:t||"",requires:e||{}}),this.update()},removeCache:function(){return this.caches.pop(),this.update()},addSlot:function(t){return this.slots.push({name:t||""}),this.update()},removeSlot:function(){return this.slots.pop(),this.update()},isCache:function(t){for(var e=this.caches.length;e--;)if(this.caches[e].name==t)return!0;return!1},isSlot:function(t){for(var e=this.slots.length;e--;)if(this.slots[e].name==t)return!0;return!1},update:function(){var t=this.caches[this.caches.length-1],e=this.slots[this.slots.length-1];return this.slot=e?e.name:"",this.cache=t?t.name:"",this.requires=t?t.requires:{},this},require:function(t,e){return this.requires[t]=e,this},include:function(t,e,n){return this.material.include(this,t,e,n),this},colorToVector:function(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},getConstructorFromLength:function(t){return Om.constructors[t-1]},getFormatName:function(t){return t.replace(/c/g,"v3").replace(/fv1/g,"v1").replace(/iv1/g,"i")},isFormatMatrix:function(t){return/^m/.test(t)},getFormatLength:function(t){return parseInt(this.getFormatName(t).substr(1))},getFormatFromLength:function(t){return 1==t?"fv1":"v"+t},format:function(t,e,n){switch(this.getFormatName(n+"="+e)){case"v1=v2":case"v1=v3":case"v1=v4":return t+".x";case"v1=i":return"float("+t+")";case"v2=v1":return"vec2("+t+")";case"v2=v3":case"v2=v4":return t+".xy";case"v2=i":return"vec2(float("+t+"))";case"v3=v1":return"vec3("+t+")";case"v3=v2":return"vec3("+t+",0.0)";case"v3=v4":return t+".xyz";case"v3=i":return"vec2(float("+t+"))";case"v4=v1":return"vec4("+t+")";case"v4=v2":return"vec4("+t+",0.0,1.0)";case"v4=v3":return"vec4("+t+",1.0)";case"v4=i":return"vec4(float("+t+"))";case"i=v1":return"int("+t+")";case"i=v2":case"i=v3":case"i=v4":return"int("+t+".x)"}return t},getTypeByFormat:function(t){return Om.type[t]||t},getUuid:function(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t},getElementByIndex:function(t){return Om.elements[t]},getIndexByElement:function(t){return Om.elements.indexOf(t)},isShader:function(t){return this.shader==t},setShader:function(t){return this.shader=t,this}};var Nm=function(t,e){Iu.call(this),this.vertex=t||new Pm(new Jp(Jp.PROJECTION)),this.fragment=e||new Pm(new Lm(16711680)),this.updaters=[]};Nm.types={t:"sampler2D",tc:"samplerCube",bv1:"bool",iv1:"int",fv1:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"},Nm.addShortcuts=function(t,e,n){function r(t,e){return{get:function(){return this[t][e]},set:function(n){this[t][e]=n}}}return function(){for(var i={},o=0;o<n.length;++o){var a=n[o];i[a]=r(e,a)}Object.defineProperties(t,i)}()},(Nm.prototype=Object.create(Iu.prototype)).constructor=Nm,Nm.prototype.type="NodeMaterial",Nm.prototype.updateFrame=function(t){for(var e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])},Nm.prototype.build=function(){var t,e;this.nodes=[],this.defines={},this.uniforms={},this.attributes={},this.extensions={},this.nodeData={},this.vertexUniform=[],this.fragmentUniform=[],this.vars=[],this.vertexTemps=[],this.fragmentTemps=[],this.uniformList=[],this.consts=[],this.functions=[],this.updaters=[],this.requires={uv:[],color:[],lights:this.lights,fog:this.fog},this.vertexPars="",this.fragmentPars="",this.vertexCode="",this.fragmentCode="",this.vertexNode="",this.fragmentNode="",this.prefixCode=["#ifdef GL_EXT_shader_texture_lod","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>"].join("\n");var n=new Om(this);return t=this.vertex.build(n.setShader("vertex"),"v4"),e=this.fragment.build(n.setShader("fragment"),"v4"),this.requires.uv[0]&&(this.addVertexPars("varying vec2 vUv;"),this.addFragmentPars("varying vec2 vUv;"),this.addVertexCode("vUv = uv;")),this.requires.uv[1]&&(this.addVertexPars("varying vec2 vUv2; attribute vec2 uv2;"),this.addFragmentPars("varying vec2 vUv2;"),this.addVertexCode("vUv2 = uv2;")),this.requires.color[0]&&(this.addVertexPars("varying vec4 vColor; attribute vec4 color;"),this.addFragmentPars("varying vec4 vColor;"),this.addVertexCode("vColor = color;")),this.requires.color[1]&&(this.addVertexPars("varying vec4 vColor2; attribute vec4 color2;"),this.addFragmentPars("varying vec4 vColor2;"),this.addVertexCode("vColor2 = color2;")),this.requires.position&&(this.addVertexPars("varying vec3 vPosition;"),this.addFragmentPars("varying vec3 vPosition;"),this.addVertexCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVertexPars("varying vec3 vWPosition;"),this.addFragmentPars("varying vec3 vWPosition;"),this.addVertexCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVertexPars("varying vec3 vObjectNormal;"),this.addFragmentPars("varying vec3 vObjectNormal;"),this.addVertexCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVertexPars("varying vec3 vWNormal;"),this.addFragmentPars("varying vec3 vWNormal;"),this.addVertexCode("vWNormal = ( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz;")),this.fog=this.requires.fog,this.lights=this.requires.lights,this.transparent=this.requires.transparent||this.blending>pc,this.vertexShader=[this.prefixCode,this.vertexPars,this.getCodePars(this.vertexUniform,"uniform"),this.getIncludes(this.consts.vertex),this.getIncludes(this.functions.vertex),"void main(){",this.getCodePars(this.vertexTemps),t,this.vertexCode,"}"].join("\n"),this.fragmentShader=[this.prefixCode,this.fragmentPars,this.getCodePars(this.fragmentUniform,"uniform"),this.getIncludes(this.consts.fragment),this.getIncludes(this.functions.fragment),"void main(){",this.getCodePars(this.fragmentTemps),this.fragmentCode,e,"}"].join("\n"),this.needsUpdate=!0,this.dispose(),this},Nm.prototype.define=function(t,e){this.defines[t]=void 0==e?1:e},Nm.prototype.isDefined=function(t){return void 0!=this.defines[t]},Nm.prototype.mergeUniform=function(t){for(var e in t)this.uniforms[e]=t[e]},Nm.prototype.createUniform=function(t,e,n,r){var i={type:t,value:e,name:n||"nVu"+this.uniformList.length,needsUpdate:r};return this.uniformList.push(i),i},Nm.prototype.getVertexTemp=function(t,e,n){var r=this.vertexTemps[t];return r||(this.vertexTemps.push(r={name:n||"nVt"+this.vertexTemps.length,type:e}),this.vertexTemps[t]=r),r},Nm.prototype.getFragmentTemp=function(t,e,n){var r=this.fragmentTemps[t];return r||(this.fragmentTemps.push(r={name:n||"nVt"+this.fragmentTemps.length,type:e}),this.fragmentTemps[t]=r),r},Nm.prototype.getVar=function(t,e,n){var r=this.vars[t];if(!r){var i=n||"nVv"+this.vars.length;this.vars.push(r={name:i,type:e}),this.vars[t]=r,this.addVertexPars("varying "+e+" "+i+";"),this.addFragmentPars("varying "+e+" "+i+";")}return r},Nm.prototype.getAttribute=function(t,e){if(!this.attributes[t]){var n=this.getVar(t,e);this.addVertexPars("attribute "+e+" "+t+";"),this.addVertexCode(n.name+" = "+t+";"),this.attributes[t]={varying:n,name:t,type:e}}return this.attributes[t]},Nm.prototype.getIncludes=function(){function t(t,e){return t.deps.length-e.deps.length}return function(e){if(!e)return"";for(var n="",r=(e=e.sort(t),0);r<e.length;r++)e[r].src&&(n+=e[r].src+"\n");return n}}(),Nm.prototype.addVertexPars=function(t){this.vertexPars+=t+"\n"},Nm.prototype.addFragmentPars=function(t){this.fragmentPars+=t+"\n"},Nm.prototype.addVertexCode=function(t){this.vertexCode+=t+"\n"},Nm.prototype.addFragmentCode=function(t){this.fragmentCode+=t+"\n"},Nm.prototype.addVertexNode=function(t){this.vertexNode+=t+"\n"},Nm.prototype.clearVertexNode=function(){var t=this.vertexNode;return this.vertexNode="",t},Nm.prototype.addFragmentNode=function(t){this.fragmentNode+=t+"\n"},Nm.prototype.clearFragmentNode=function(){var t=this.fragmentNode;return this.fragmentNode="",t},Nm.prototype.getCodePars=function(t,e){e=e||"";for(var n="",r=0,i=t.length;r<i;++r){var o=t[r].type,a=t[r].name;"t"==o&&t[r].value instanceof Tp&&(o="tc");var s=Nm.types[o];if(void 0==s)throw new Error("Node pars "+o+" not found.");n+=e+" "+s+" "+a+";\n"}return n},Nm.prototype.createVertexUniform=function(t,e,n,r){var i=this.createUniform(t,e,n,r);return this.vertexUniform.push(i),this.vertexUniform[i.name]=i,this.uniforms[i.name]=i,i},Nm.prototype.createFragmentUniform=function(t,e,n,r){var i=this.createUniform(t,e,n,r);return this.fragmentUniform.push(i),this.fragmentUniform[i.name]=i,this.uniforms[i.name]=i,i},Nm.prototype.getDataNode=function(t){return this.nodeData[t]=this.nodeData[t]||{}},Nm.prototype.include=function(t,e,n,r){var i;(e="string"==typeof e?Yp.get(e):e)instanceof qp?i=this.functions[t.shader]=this.functions[t.shader]||[]:e instanceof ef&&(i=this.consts[t.shader]=this.consts[t.shader]||[]);var o=i[e.name];if(o||(o=i[e.name]={node:e,deps:[]},i.push(o),o.src=e.build(t,"source")),e instanceof qp&&n&&i[n.name]&&-1==i[n.name].deps.indexOf(e)&&(i[n.name].deps.push(e),e.includes&&e.includes.length)){var a=0;do{this.include(t,e.includes[a++],n)}while(a<e.includes.length)}r&&(o.src=r)},Nm.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var e={};e.uuid=this.uuid,e.type=this.type,t.materials[e.uuid]=e,""!==this.name&&(e.name=this.name),this.blending!==pc&&(e.blending=this.blending),!0===this.flatShading&&(e.flatShading=this.flatShading),this.side!==sc&&(e.side=this.side),!0===this.transparent&&(e.transparent=this.transparent),e.depthFunc=this.depthFunc,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(e.morphTargets=!0),!0===this.skinning&&(e.skinning=!0),e.fog=this.fog,e.lights=this.lights,!1===this.visible&&(e.visible=!1),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.vertex=this.vertex.toJSON(t).uuid,e.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t};var Lm=function(t){Kp.call(this,"c"),this.value=new Ts(t||0)};Lm.prototype=Object.create(Kp.prototype),Lm.prototype.constructor=Lm,Lm.prototype.nodeType="Color",Nm.addShortcuts(Lm.prototype,"value",["r","g","b"]),Lm.prototype.generateReadonly=function(t,e,n,r,i,o){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",r,e)},Lm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).r=this.r,e.g=this.g,e.b=this.b,!0===this.readonly&&(e.readonly=!0)),e};var Im=function(t,e,n){Kp.call(this,"v4",{shared:!0}),this.value=t,this.coord=e||new Mm,this.bias=n};(Im.prototype=Object.create(Kp.prototype)).constructor=Im,Im.prototype.nodeType="CubeTexture",Im.prototype.getTexture=function(t,e){return Kp.prototype.generate.call(this,t,e,this.value.uuid,"t")},Im.prototype.generate=function(t,e){if("samplerCube"===e)return this.getTexture(t,e);var n,r=this.getTexture(t,e),i=this.coord.build(t,"v3"),o=this.bias?this.bias.build(t,"fv1"):void 0;return void 0==o&&t.requires.bias&&(o=t.requires.bias.build(t,"fv1")),n=o?"texCubeBias("+r+","+i+","+o+")":"texCube("+r+","+i+")",t.isSlot("color")?n="mapTexelToLinear("+n+")":t.isSlot("emissive")?n="emissiveMapTexelToLinear("+n+")":t.isSlot("environment")&&(n="envMapTexelToLinear("+n+")"),t.format(n,this.type,e)},Im.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.coord=this.coord.toJSON(t).uuid,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e};var Rm=function(t){Kp.call(this,"iv1"),this.value=[Math.floor(t||0)]};(Rm.prototype=Object.create(Kp.prototype)).constructor=Rm,Rm.prototype.nodeType="Int",Object.defineProperties(Rm.prototype,{number:{get:function(){return this.value[0]},set:function(t){this.value[0]=Math.floor(t)}}}),Rm.prototype.generateReadonly=function(t,e,n,r,i,o){return t.format(this.number,r,e)},Rm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).number=this.number,!0===this.readonly&&(e.readonly=!0)),e};var Dm=function(t){Kp.call(this,"m3"),this.value=t||new ds};(Dm.prototype=Object.create(Kp.prototype)).constructor=Dm,Dm.prototype.nodeType="Matrix3",Dm.prototype.generateReadonly=function(t,e,n,r,i,o){return t.format("mat3( "+this.value.elements.join(", ")+" )",r,e)},Dm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat(),!0===this.readonly&&(e.readonly=!0)),e};var Fm=function(t){Kp.call(this,"m4"),this.value=t||new as};(Fm.prototype=Object.create(Kp.prototype)).constructor=Fm,Fm.prototype.nodeType="Matrix4",Fm.prototype.generateReadonly=function(t,e,n,r,i,o){return t.format("mat4( "+this.value.elements.join(", ")+" )",r,e)},Fm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat(),!0===this.readonly&&(e.readonly=!0)),e};var Um=function(t,e,n){Xp.call(this),this.a=t,this.b=e,this.op=n||Um.ADD};Um.ADD="+",Um.SUB="-",Um.MUL="*",Um.DIV="/",Um.prototype=Object.create(Xp.prototype),Um.prototype.constructor=Um,Um.prototype.nodeType="Operator",Um.prototype.getType=function(t){var e=this.a.getType(t),n=this.b.getType(t);return t.isFormatMatrix(e)?"v4":t.getFormatLength(n)>t.getFormatLength(e)?n:e},Um.prototype.generate=function(t,e){t.material.getDataNode(this.uuid);var n=this.getType(t),r=this.a.build(t,n),i=this.b.build(t,n);return t.format("("+r+this.op+i+")",n,e)},Um.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op),e};var km=function(t,e,n,r){Kp.call(this,"v4",{shared:!0}),this.value=t,this.coord=e||new Zp,this.bias=n,this.project=void 0!==r&&r};(km.prototype=Object.create(Kp.prototype)).constructor=km,km.prototype.nodeType="Texture",km.prototype.getTexture=function(t,e){return Kp.prototype.generate.call(this,t,e,this.value.uuid,"t")},km.prototype.generate=function(t,e){if("sampler2D"===e)return this.getTexture(t,e);var n,r,i=this.getTexture(t,e),o=this.coord.build(t,this.project?"v4":"v2"),a=this.bias?this.bias.build(t,"fv1"):void 0;return void 0==a&&t.requires.bias&&(a=t.requires.bias.build(t,"fv1")),n=this.project?"texture2DProj":a?"tex2DBias":"tex2D",r=a?n+"("+i+","+o+","+a+")":n+"("+i+","+o+")",t.isSlot("color")?r="mapTexelToLinear("+r+")":t.isSlot("emissive")?r="emissiveMapTexelToLinear("+r+")":t.isSlot("environment")&&(r="envMapTexelToLinear("+r+")"),t.format(r,this.type,e)},km.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.value&&(e.value=this.value.uuid),e.coord=this.coord.toJSON(t).uuid,e.project=this.project,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e};var jm=function(t){Xp.call(this,"v4"),t&&this.setMirror(t)};(jm.prototype=Object.create(Xp.prototype)).constructor=jm,jm.prototype.nodeType="Reflector",jm.prototype.setMirror=function(t){this.mirror=t,this.textureMatrix=new Fm(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new Jp(Jp.LOCAL),this.coord=new Um(this.textureMatrix,this.localPosition,Um.MUL),this.coordResult=new Um(null,this.coord,Um.ADD),this.texture=new km(this.mirror.material.uniforms.tDiffuse.value,this.coord,null,!0)},jm.prototype.generate=function(t,e){return t.isShader("fragment")?(this.coordResult.a=this.offset,this.texture.coord=this.offset?this.coordResult:this.coord,"sampler2D"===e?this.texture.build(t,e):t.format(this.texture.build(t,this.type),this.type,e)):(console.warn("ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4(0.0)",this.type,e))},jm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).mirror=this.mirror.uuid,this.offset&&(e.offset=this.offset.toJSON(t).uuid)),e};var Bm=function(t){km.call(this,void 0,t)};(Bm.prototype=Object.create(km.prototype)).constructor=Bm,Bm.prototype.nodeType="Screen",Bm.prototype.isUnique=function(){return!0},Bm.prototype.getTexture=function(t,e){return Kp.prototype.generate.call(this,t,e,this.getUuid(),"t","renderTexture")};var zm=function(t,e){Kp.call(this,"v2"),this.value=new Cs(t,e)};(zm.prototype=Object.create(Kp.prototype)).constructor=zm,zm.prototype.nodeType="Vector2",Nm.addShortcuts(zm.prototype,"value",["x","y"]),zm.prototype.generateReadonly=function(t,e,n,r,i,o){return t.format("vec2( "+this.x+", "+this.y+" )",r,e)},zm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,!0===this.readonly&&(e.readonly=!0)),e};var Vm=function(t,e,n){Kp.call(this,"v3"),this.type="v3",this.value=new ss(t,e,n)};(Vm.prototype=Object.create(Kp.prototype)).constructor=Vm,Vm.prototype.nodeType="Vector3",Nm.addShortcuts(Vm.prototype,"value",["x","y","z"]),Vm.prototype.generateReadonly=function(t,e,n,r,i,o){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",r,e)},Vm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,!0===this.readonly&&(e.readonly=!0)),e};var Gm=function(t,e,n,r){Kp.call(this,"v4"),this.value=new Is(t,e,n,r)};(Gm.prototype=Object.create(Kp.prototype)).constructor=Gm,Gm.prototype.nodeType="Vector4",Nm.addShortcuts(Gm.prototype,"value",["x","y","z","w"]),Gm.prototype.generateReadonly=function(t,e,n,r,i,o){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",r,e)},Gm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,!0===this.readonly&&(e.readonly=!0)),e};var Hm=function(){Wp.call(this),this.color=new Lm(15658734),this.specular=new Lm(1118481),this.shininess=new $p(30)};(Hm.prototype=Object.create(Wp.prototype)).constructor=Hm,Hm.prototype.nodeType="Phong",Hm.prototype.build=function(t){var e,n=t.material;if(n.define("PHONG"),n.define("ALPHATEST","0.0"),n.requires.lights=!0,t.isShader("vertex")){var r=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;n.mergeUniform(Lu.merge([Lh.fog,Lh.lights])),n.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];r&&i.push(r.code,"transformed = "+r.result+";"),i.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>"),e=i.join("\n")}else{this.color.parse(t,{slot:"color"}),this.specular.parse(t),this.shininess.parse(t),this.alpha&&this.alpha.parse(t),this.normal&&this.normal.parse(t),this.normalScale&&this.normal&&this.normalScale.parse(t),this.light&&this.light.parse(t,{cache:"light"}),this.ao&&this.ao.parse(t),this.ambient&&this.ambient.parse(t),this.shadow&&this.shadow.parse(t),this.emissive&&this.emissive.parse(t,{slot:"emissive"}),this.environment&&this.environment.parse(t,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.parse(t);var o=this.color.buildCode(t,"c",{slot:"color"}),a=this.specular.buildCode(t,"c"),s=this.shininess.buildCode(t,"fv1"),c=this.alpha?this.alpha.buildCode(t,"fv1"):void 0,u=this.normal?this.normal.buildCode(t,"v3"):void 0,l=this.normalScale&&this.normal?this.normalScale.buildCode(t,"v2"):void 0,h=this.light?this.light.buildCode(t,"v3",{cache:"light"}):void 0,d=this.ao?this.ao.buildCode(t,"fv1"):void 0,p=this.ambient?this.ambient.buildCode(t,"c"):void 0,f=this.shadow?this.shadow.buildCode(t,"c"):void 0,m=this.emissive?this.emissive.buildCode(t,"c",{slot:"emissive"}):void 0,v=this.environment?this.environment.buildCode(t,"c",{slot:"environment"}):void 0,g=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(t,"fv1"):void 0;n.requires.transparent=void 0!=c,n.addFragmentPars(["#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n")),i=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;",o.code,"\tvec3 diffuseColor = "+o.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",a.code,"\tvec3 specular = "+a.result+";",s.code,"\tfloat shininess = max(0.0001,"+s.result+");","\tfloat specularStrength = 1.0;"],c&&i.push(c.code,"if ( "+c.result+" <= ALPHATEST ) discard;"),u&&(t.include("perturbNormal2Arb"),i.push(u.code),l&&i.push(l.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+u.result+","+(new Zp).build(t,"v2")+","+(l?l.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(h?"vec3( 1.0 )":"diffuseColor")+";"),i.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h&&(i.push(h.code,"reflectedLight.directDiffuse = "+h.result+";"),i.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),d&&i.push(d.code,"reflectedLight.indirectDiffuse *= "+d.result+";"),p&&i.push(p.code,"reflectedLight.indirectDiffuse += "+p.result+";"),f&&i.push(f.code,"reflectedLight.directDiffuse *= "+f.result+";","reflectedLight.directSpecular *= "+f.result+";"),m&&i.push(m.code,"reflectedLight.directDiffuse += "+m.result+";"),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),v&&(i.push(v.code),g?i.push(g.code,"outgoingLight = mix( outgoingLight, "+v.result+", "+g.result+" );"):i.push("outgoingLight = "+v.result+";")),i.push(c?"gl_FragColor = vec4( outgoingLight, "+c.result+" );":"gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),e=i.join("\n")}return e},Hm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.specular=this.specular.toJSON(t).uuid,e.shininess=this.shininess.toJSON(t).uuid,this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.normalScale&&(e.normalScale=this.normalScale.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(e.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),e};var Wm=function(){this.node=new Hm,Nm.call(this,this.node,this.node),this.type="PhongNodeMaterial"};(Wm.prototype=Object.create(Nm.prototype)).constructor=Wm,Nm.addShortcuts(Wm.prototype,"node",["color","alpha","specular","shininess","normal","normalScale","emissive","ambient","light","shadow","ao","environment","environmentAlpha","transform"]);var Xm=function(){Wp.call(this),this.color=new Lm(15658734),this.spherical=!0};(Xm.prototype=Object.create(Wp.prototype)).constructor=Xm,Xm.prototype.nodeType="Sprite",Xm.prototype.build=function(t){var e,n=t.material;if(n.define("SPRITE"),n.requires.lights=!1,n.requires.transparent=void 0!=this.alpha,t.isShader("vertex")){var r=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;n.mergeUniform(Lu.merge([Lh.fog])),n.addVertexPars(["#include <fog_pars_vertex>"].join("\n")),e=["#include <begin_vertex>"],r&&e.push(r.code,"transformed = "+r.result+";"),e.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||e.push("modelMtx[1][1] = 1.0;"),e.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&e.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),e.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );")}else{n.addFragmentPars(["#include <fog_pars_fragment>"].join("\n")),this.color.parse(t,{slot:"color"}),this.alpha&&this.alpha.parse(t);var i=this.color.buildCode(t,"c",{slot:"color"}),o=this.alpha?this.alpha.buildCode(t,"fv1"):void 0;e=[i.code],o?e.push(o.code,"gl_FragColor = vec4( "+i.result+", "+o.result+" );"):e.push("gl_FragColor = vec4( "+i.result+", 1.0 );"),e.push("#include <fog_fragment>")}return e.join("\n")},Xm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,!1===this.spherical&&(e.spherical=!1),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid)),e};var qm=function(){this.node=new Xm,Nm.call(this,this.node,this.node),this.type="SpriteNodeMaterial"};(qm.prototype=Object.create(Nm.prototype)).constructor=qm,Nm.addShortcuts(qm.prototype,"node",["color","alpha","transform","spherical"]);var Ym=function(){Xp.call(this,"fv1")};Ym.getSpecularMIPLevel=new qp(["float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {","\tfloat maxMIPLevelScalar = float( maxMIPLevel );","\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n")),(Ym.prototype=Object.create(Xp.prototype)).constructor=Ym,Ym.prototype.nodeType="RoughnessToBlinnExponent",Ym.prototype.generate=function(t,e){var n=t.material;return t.isShader("fragment")?n.isDefined("PHYSICAL")?(t.include(Ym.getSpecularMIPLevel),t.isCache("clearCoat")?t.format("getSpecularMIPLevel( Material_ClearCoat_BlinnShininessExponent( material ), 8 )",this.type,e):t.format("getSpecularMIPLevel( Material_BlinnShininessExponent( material ), 8 )",this.type,e)):(console.warn("RoughnessToBlinnExponentNode is only compatible with PhysicalMaterial."),t.format("0.0",this.type,e)):(console.warn("RoughnessToBlinnExponentNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,e))};var Zm=function(){Wp.call(this),this.color=new Lm(15658734),this.roughness=new $p(.5),this.metalness=new $p(.5)};(Zm.prototype=Object.create(Wp.prototype)).constructor=Zm,Zm.prototype.nodeType="Standard",Zm.prototype.build=function(t){var e,n=t.material;if(n.define("PHYSICAL"),this.clearCoat||this.clearCoatRoughness||n.define("STANDARD"),n.define("ALPHATEST","0.0"),n.requires.lights=!0,n.extensions.shaderTextureLOD=!0,t.isShader("vertex")){var r=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;n.mergeUniform(Lu.merge([Lh.fog,Lh.lights])),n.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];r&&i.push(r.code,"transformed = "+r.result+";"),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),e=i.join("\n")}else{var o={bias:new Ym,offsetU:0,offsetV:0},a=!n.isDefined("STANDARD");this.color.parse(t,{slot:"color"}),this.roughness.parse(t),this.metalness.parse(t),this.alpha&&this.alpha.parse(t),this.normal&&this.normal.parse(t),this.normalScale&&this.normal&&this.normalScale.parse(t),this.clearCoat&&this.clearCoat.parse(t),this.clearCoatRoughness&&this.clearCoatRoughness.parse(t),this.reflectivity&&this.reflectivity.parse(t),this.light&&this.light.parse(t,{cache:"light"}),this.ao&&this.ao.parse(t),this.ambient&&this.ambient.parse(t),this.shadow&&this.shadow.parse(t),this.emissive&&this.emissive.parse(t,{slot:"emissive"}),this.environment&&this.environment.parse(t,{cache:"env",requires:o,slot:"environment"});var s=this.color.buildCode(t,"c",{slot:"color"}),c=this.roughness.buildCode(t,"fv1"),u=this.metalness.buildCode(t,"fv1"),l=this.alpha?this.alpha.buildCode(t,"fv1"):void 0,h=this.normal?this.normal.buildCode(t,"v3"):void 0,d=this.normalScale&&this.normal?this.normalScale.buildCode(t,"v2"):void 0,p=this.clearCoat?this.clearCoat.buildCode(t,"fv1"):void 0,f=this.clearCoatRoughness?this.clearCoatRoughness.buildCode(t,"fv1"):void 0,m=this.reflectivity?this.reflectivity.buildCode(t,"fv1"):void 0,v=this.light?this.light.buildCode(t,"v3",{cache:"light"}):void 0,g=this.ao?this.ao.buildCode(t,"fv1"):void 0,y=this.ambient?this.ambient.buildCode(t,"c"):void 0,b=this.shadow?this.shadow.buildCode(t,"c"):void 0,x=this.emissive?this.emissive.buildCode(t,"c",{slot:"emissive"}):void 0,w=this.environment?this.environment.buildCode(t,"c",{cache:"env",requires:o,slot:"environment"}):void 0,_=a&&w?this.environment.buildCode(t,"c",{cache:"clearCoat",requires:o,slot:"environment"}):void 0;n.requires.transparent=void 0!=l,n.addFragmentPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_vertex>"].join("\n")),i=["\t#include <normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );",s.code,"\tvec3 diffuseColor = "+s.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",c.code,"\tfloat roughnessFactor = "+c.result+";",u.code,"\tfloat metalnessFactor = "+u.result+";"],l&&i.push(l.code,"if ( "+l.result+" <= ALPHATEST ) discard;"),h&&(t.include("perturbNormal2Arb"),i.push(h.code),d&&i.push(d.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+h.result+","+(new Zp).build(t,"v2")+","+(d?d.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(v?"vec3( 1.0 )":"diffuseColor * (1.0 - metalnessFactor)")+";"),i.push("material.specularRoughness = clamp( roughnessFactor, DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"),p?i.push(p.code,"material.clearCoat = saturate( "+p.result+" );"):a&&i.push("material.clearCoat = 0.0;"),f?i.push(f.code,"material.clearCoatRoughness = clamp( "+f.result+", DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"):a&&i.push("material.clearCoatRoughness = 0.0;"),m?i.push(m.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+m.result+" ) ), diffuseColor, metalnessFactor );"):i.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),i.push("#include <lights_fragment_begin>","#include <lights_fragment_end>"),v&&(i.push(v.code,"reflectedLight.directDiffuse = "+v.result+";"),i.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),g&&i.push(g.code,"reflectedLight.indirectDiffuse *= "+g.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+g.result+", material.specularRoughness );"),y&&i.push(y.code,"reflectedLight.indirectDiffuse += "+y.result+";"),b&&i.push(b.code,"reflectedLight.directDiffuse *= "+b.result+";","reflectedLight.directSpecular *= "+b.result+";"),x&&i.push(x.code,"reflectedLight.directDiffuse += "+x.result+";"),w&&(i.push(w.code),_&&i.push(_.code,"clearCoatRadiance += "+_.result+";"),i.push("RE_IndirectSpecular("+w.result+", clearCoatRadiance, geometry, material, reflectedLight );")),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),i.push(l?"gl_FragColor = vec4( outgoingLight, "+l.result+" );":"gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),e=i.join("\n")}return e},Zm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.roughness=this.roughness.toJSON(t).uuid,e.metalness=this.metalness.toJSON(t).uuid,this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.normalScale&&(e.normalScale=this.normalScale.toJSON(t).uuid),this.clearCoat&&(e.clearCoat=this.clearCoat.toJSON(t).uuid),this.clearCoatRoughness&&(e.clearCoatRoughness=this.clearCoatRoughness.toJSON(t).uuid),this.reflectivity&&(e.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid)),e};var Jm=function(){this.node=new Zm,Nm.call(this,this.node,this.node),this.type="StandardNodeMaterial"};(Jm.prototype=Object.create(Nm.prototype)).constructor=Jm,Nm.addShortcuts(Jm.prototype,"node",["color","alpha","roughness","metalness","reflectivity","clearCoat","clearCoatRoughness","normal","normalScale","emissive","ambient","light","shadow","ao","environment","transform"]);var Qm=function(t,e){Xp.call(this),this.a=t,this.method=e||Qm.SIN};Qm.RAD="radians",Qm.DEG="degrees",Qm.EXP="exp",Qm.EXP2="exp2",Qm.LOG="log",Qm.LOG2="log2",Qm.SQRT="sqrt",Qm.INV_SQRT="inversesqrt",Qm.FLOOR="floor",Qm.CEIL="ceil",Qm.NORMALIZE="normalize",Qm.FRACT="fract",Qm.SAT="saturate",Qm.SIN="sin",Qm.COS="cos",Qm.TAN="tan",Qm.ASIN="asin",Qm.ACOS="acos",Qm.ARCTAN="atan",Qm.ABS="abs",Qm.SIGN="sign",Qm.LENGTH="length",Qm.NEGATE="negate",Qm.INVERT="invert",Qm.prototype=Object.create(Xp.prototype),Qm.prototype.constructor=Qm,Qm.prototype.nodeType="Math1",Qm.prototype.getType=function(t){switch(this.method){case Qm.LENGTH:return"fv1"}return this.a.getType(t)},Qm.prototype.generate=function(t,e){var n=this.getType(t),r=this.a.build(t,n);switch(this.method){case Qm.NEGATE:r="(-"+r+")";break;case Qm.INVERT:r="(1.0-"+r+")";break;default:r=this.method+"("+r+")"}return t.format(r,n,e)},Qm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.method=this.method),e};var Km=function(t,e,n){Xp.call(this),this.a=t,this.b=e,this.method=n||Km.DISTANCE};Km.MIN="min",Km.MAX="max",Km.MOD="mod",Km.STEP="step",Km.REFLECT="reflect",Km.DISTANCE="distance",Km.DOT="dot",Km.CROSS="cross",Km.POW="pow",Km.prototype=Object.create(Xp.prototype),Km.prototype.constructor=Km,Km.prototype.nodeType="Math2",Km.prototype.getInputType=function(t){return t.getFormatLength(this.b.getType(t))>t.getFormatLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)},Km.prototype.getType=function(t){switch(this.method){case Km.DISTANCE:case Km.DOT:return"fv1";case Km.CROSS:return"v3"}return this.getInputType(t)},Km.prototype.generate=function(t,e){var n,r,i=this.getInputType(t),o=t.getFormatLength(this.a.getType(t)),a=t.getFormatLength(this.b.getType(t));switch(this.method){case Km.CROSS:n=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case Km.STEP:n=this.a.build(t,1==o?"fv1":i),r=this.b.build(t,i);break;case Km.MIN:case Km.MAX:case Km.MOD:n=this.a.build(t,i),r=this.b.build(t,1==a?"fv1":i);break;default:n=this.a.build(t,i),r=this.b.build(t,i)}return t.format(this.method+"("+n+","+r+")",this.getType(t),e)},Km.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.method=this.method),e};var $m=function(t,e,n,r){Xp.call(this),this.a=t,this.b=e,this.c=n,this.method=r||$m.MIX};$m.MIX="mix",$m.REFRACT="refract",$m.SMOOTHSTEP="smoothstep",$m.FACEFORWARD="faceforward",$m.prototype=Object.create(Xp.prototype),$m.prototype.constructor=$m,$m.prototype.nodeType="Math3",$m.prototype.getType=function(t){var e=t.getFormatLength(this.a.getType(t)),n=t.getFormatLength(this.b.getType(t)),r=t.getFormatLength(this.c.getType(t));return e>n&&e>r?this.a.getType(t):n>r?this.b.getType(t):this.c.getType(t)},$m.prototype.generate=function(t,e){var n,r,i,o=this.getType(t),a=(t.getFormatLength(this.a.getType(t)),t.getFormatLength(this.b.getType(t)),t.getFormatLength(this.c.getType(t)));switch(this.method){case $m.REFRACT:n=this.a.build(t,o),r=this.b.build(t,o),i=this.c.build(t,"fv1");break;case $m.MIX:n=this.a.build(t,o),r=this.b.build(t,o),i=this.c.build(t,1==a?"fv1":o);break;default:n=this.a.build(t,o),r=this.b.build(t,o),i=this.c.build(t,o)}return t.format(this.method+"("+n+","+r+","+i+")",o,e)},$m.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.c=this.c.toJSON(t).uuid,e.method=this.method),e};var tv=function(t){this.time=void 0!==t?t:0,this.frameId=0};tv.prototype.update=function(t){return++this.frameId,this.time+=t,this.delta=t,this},tv.prototype.updateNode=function(t){return t.frameId===this.frameId?this:(t.updateFrame(this),t.frameId=this.frameId,this)};var ev=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(ev.prototype,{setSize:function(t,e){},render:function(t,e,n,r,i){console.error("Pass: .render() must be implemented in derived pass.")}});var nv=function(t,e){ev.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof Iu?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Lu.clone(t.uniforms),this.material=new Iu({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};nv.prototype=Object.assign(Object.create(ev.prototype),{constructor:nv,render:function(t,e,n,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var rv=function(){nv.call(this),this.name="",this.uuid=os.generateUUID(),this.userData={},this.textureID="renderTexture",this.fragment=new Pm(new Bm),this.node=new Nm,this.node.fragment=this.fragment,this.build()};(rv.prototype=Object.create(nv.prototype)).constructor=rv,Nm.addShortcuts(rv.prototype,"fragment",["value"]),rv.prototype.build=function(){this.node.build(),this.uniforms=this.node.uniforms,this.material=this.node},rv.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.passes&&(t.passes={}),!t.passes[this.uuid]){var e={};e.uuid=this.uuid,e.type="NodePass",t.passes[this.uuid]=e,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.value=this.value.toJSON(t).uuid}return t.pass=this.uuid,t};var iv=function(t,e,n,r){Xp.call(this,"v4"),this.value=t,this.coord=e||new Zp,this.radius=new zm(1,1),this.size=r,this.blurX=!0,this.blurY=!0,this.horizontal=new $p(1/64),this.vertical=new $p(1/64)};iv.fBlurX=new qp(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum;","}"].join("\n")),iv.fBlurY=new qp(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum;","}"].join("\n")),(iv.prototype=Object.create(Xp.prototype)).constructor=iv,iv.prototype.nodeType="Blur",iv.prototype.updateFrame=function(t){if(this.size)this.horizontal.number=this.radius.x/this.size.x,this.vertical.number=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var e=this.value.value.image;this.horizontal.number=this.radius.x/e.width,this.vertical.number=this.radius.y/e.height}},iv.prototype.generate=function(t,e){var n=iv.fBlurX,r=iv.fBlurY;if(t.include(n),t.include(r),t.isShader("fragment")){var i,o=[];return this.blurX&&o.push(n.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.horizontal.build(t,"fv1")+")"),this.blurY&&o.push(r.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.vertical.build(t,"fv1")+")"),i=2==o.length?"("+o.join("+")+"/2.0)":o.length?"("+o[0]+")":"vec4( 0.0 )",t.format(i,this.getType(t),e)}return console.warn("BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)},iv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.coord=this.coord.toJSON(t).uuid,e.radius=this.radius.toJSON(t).uuid,this.size&&(e.size={x:this.size.x,y:this.size.y}),e.blurX=this.blurX,e.blurY=this.blurY),e};var ov=function(t,e,n){Xp.call(this,"v3"),this.value=t,this.coord=e||new Zp,this.scale=n||new zm(1,1)};ov.fBumpToNormal=new qp(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, vec2 scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 + ( dBx * scale.x ), .5 + ( dBy * scale.y ), 1.0 );","}"].join("\n"),null,{derivatives:!0}),(ov.prototype=Object.create(Xp.prototype)).constructor=ov,ov.prototype.nodeType="Bump",ov.prototype.generate=function(t,e){var n=ov.fBumpToNormal;return t.include(n),t.isShader("fragment")?t.format(n.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.scale.build(t,"v2")+")",this.getType(t),e):(console.warn("BumpNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e))},ov.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.coord=this.coord.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e};var av=function(t,e,n){Xp.call(this,"v3"),this.rgb=t,this.adjustment=e,this.method=n||av.SATURATION};av.SATURATION="saturation",av.HUE="hue",av.VIBRANCE="vibrance",av.BRIGHTNESS="brightness",av.CONTRAST="contrast",av.prototype=Object.create(Xp.prototype),av.prototype.constructor=av,av.prototype.nodeType="ColorAdjustment",av.prototype.generate=function(t,e){var n,r=this.rgb.build(t,"v3"),i=this.adjustment.build(t,"fv1");switch(this.method){case av.SATURATION:n="saturation_rgb";break;case av.HUE:n="hue_rgb";break;case av.VIBRANCE:n="vibrance_rgb";break;case av.BRIGHTNESS:return t.format("("+r+"+"+i+")",this.getType(t),e);case av.CONTRAST:return t.format("("+r+"*"+i+")",this.getType(t),e)}return t.include(n),t.format(n+"("+r+","+i+")",this.getType(t),e)},av.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e};var sv=function(t,e,n,r){Xp.call(this,"fv1"),this.x=t,this.y=e,this.z=n,this.w=r};sv.inputs=["x","y","z","w"],(sv.prototype=Object.create(Xp.prototype)).constructor=sv,sv.prototype.nodeType="Join",sv.prototype.getNumElements=function(){for(var t=sv.inputs,e=t.length;e--;)if(void 0!==this[t[e]]){++e;break}return Math.max(e,2)},sv.prototype.getType=function(t){return t.getFormatFromLength(this.getNumElements())},sv.prototype.generate=function(t,e){for(var n=this.getType(t),r=this.getNumElements(),i=sv.inputs,o=[],a=0;a<r;a++){var s=this[i[a]];o.push(s?s.build(t,"fv1"):"0.")}var c=(r>1?t.getConstructorFromLength(r):"")+"("+o.join(",")+")";return t.format(c,n,e)},sv.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){(e=this.createJSONNode(t)).inputs={};for(var n=this.getNumElements(),r=sv.inputs,i=0;i<n;i++){var o=this[r[i]];o&&(e.inputs[r[i]]=o.toJSON(t).uuid)}}return e};var cv=function(t){Xp.call(this,"fv1"),this.rgb=t};(cv.prototype=Object.create(Xp.prototype)).constructor=cv,cv.prototype.nodeType="Luminance",cv.prototype.generate=function(t,e){return t.include("luminance_rgb"),t.format("luminance_rgb("+this.rgb.build(t,"v3")+")",this.getType(t),e)},cv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid),e};var uv=function(t){Xp.call(this,"fv1"),this.coord=t};(uv.prototype=Object.create(Xp.prototype)).constructor=uv,uv.prototype.nodeType="Noise",uv.prototype.generate=function(t,e){return t.include("snoise"),t.format("snoise("+this.coord.build(t,"v2")+")",this.getType(t),e)},uv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).coord=this.coord.toJSON(t).uuid),e};var lv=function(t,e,n,r,i){Xp.call(this,"v3"),this.value=t,this.scale=n||new $p(1),this.normal=r||new Qp(Qp.LOCAL),this.position=i||new Jp(Qp.VIEW)};(lv.prototype=Object.create(Xp.prototype)).constructor=lv,lv.prototype.nodeType="NormalMap",lv.prototype.generate=function(t,e){return t.include("perturbNormal2Arb"),t.isShader("fragment")?t.format("perturbNormal2Arb(-"+this.position.build(t,"v3")+","+this.normal.build(t,"v3")+","+this.value.build(t,"v3")+","+this.value.coord.build(t,"v2")+","+this.scale.build(t,"v2")+")",this.getType(t),e):(console.warn("NormalMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e))},lv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.scale=this.scale.toJSON(t).uuid,e.normal=this.normal.toJSON(t).uuid,e.position=this.position.toJSON(t).uuid),e};var hv=function(t){zm.call(this),this.renderer=t};(hv.prototype=Object.create(zm.prototype)).constructor=hv,hv.prototype.nodeType="Resolution",hv.prototype.updateFrame=function(t){var e=this.renderer.getSize(),n=this.renderer.getPixelRatio();this.x=e.width*n,this.y=e.height*n},hv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).renderer=this.renderer.uuid),e};var dv=function(t,e){Wp.call(this),this.node=t,this.components=e||"x"};(dv.prototype=Object.create(Wp.prototype)).constructor=dv,dv.prototype.nodeType="Switch",dv.prototype.getType=function(t){return t.getFormatFromLength(this.components.length)},dv.prototype.generate=function(t,e){var n=this.node.getType(t),r=t.getFormatLength(n)-1,i=this.node.build(t,n);if(r>0){var o,a=0,s=t.colorToVector(this.components),c=s.length;for(o=0;o<c;o++)a=Math.max(a,t.getIndexByElement(s.charAt(o)));for(a>r&&(a=r),i+=".",o=0;o<c;o++){s.charAt(o);var u=t.getIndexByElement(s.charAt(o));u>a&&(u=a),i+=t.getElementByIndex(u)}return t.format(i,this.getType(t),e)}return t.format(i,n,e)},dv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).node=this.node.toJSON(t).uuid,e.components=this.components),e};var pv=function(){qp.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=new Zp,this.transform=new Dm};(pv.prototype=Object.create(qp.prototype)).constructor=pv,pv.prototype.nodeType="UVTransform",pv.prototype.generate=function(t,e){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.transform,qp.prototype.generate.call(this,t,e)},pv.prototype.setUvTransform=function(t,e,n,r,i,o,a){this.transform.value.setUvTransform(t,e,n,r,i,o=void 0!==o?o:.5,a=void 0!==a?a:.5)},pv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.transform=this.transform.toJSON(t).uuid),e};var fv=function(t,e){Vm.call(this),this.params={},this.velocity=new ss,this.setTarget(t),this.setParams(e)};(fv.prototype=Object.create(Vm.prototype)).constructor=fv,fv.prototype.nodeType="Velocity",fv.prototype.isReadonly=function(t){return!1},fv.prototype.setParams=function(t){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=t||{},this.params.type){case"elastic":this.moment=new ss,this.speed=new ss,this.springVelocity=new ss,this.lastVelocity=new ss}},fv.prototype.setTarget=function(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(),this.oldPosition=this.position.clone())},fv.prototype.updateFrameVelocity=function(t){this.target&&(this.position=this.target.getWorldPosition(),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},fv.prototype.updateFrame=function(t){switch(this.updateFrameVelocity(t),this.params.type){case"elastic":var e=t.delta*(this.params.fps||60),n=Math.pow(this.params.spring,e),r=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(r).multiplyScalar(1-n)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(n),this.moment.add(this.springVelocity),this.moment.multiplyScalar(r),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},fv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params))),e};var mv=function(t){Wp.call(this,t)};function vv(t,e){this.min=void 0!==t?t:new Cs(1/0,1/0),this.max=void 0!==e?e:new Cs(-1/0,-1/0)}(mv.prototype=Object.create(Wp.prototype)).constructor=mv,mv.prototype.nodeType="Var",mv.prototype.getType=function(t){return t.getTypeByFormat(this.type)},mv.prototype.generate=function(t,e){var n=t.material.getVar(this.uuid,this.type);return t.format(n.name,this.getType(t),e)},mv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).out=this.type),e},Object.assign(vv.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Cs;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("Box2: .getCenter() target is now required"),t=new Cs),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("Box2: .getSize() target is now required"),t=new Cs),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("Box2: .getParameter() target is now required"),e=new Cs),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("Box2: .clampPoint() target is now required"),e=new Cs),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Cs;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var gv=function(){Kc.call(this,gv.Geometry,new Xc({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var t=new ss,e=new Yh(new Uint8Array(768),16,16,Nc);e.minFilter=Mc,e.magFilter=Mc,e.wrapS=Sc,e.wrapT=Sc,e.needsUpdate=!0;var n=new Yh(new Uint8Array(768),16,16,Nc);n.minFilter=Mc,n.magFilter=Mc,n.wrapS=Sc,n.wrapT=Sc,n.needsUpdate=!0;var r=gv.Geometry,i=new nl({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),o=new nl({uniforms:{map:{value:e},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),a=new Kc(r,i),s=[],c=xv.Shader,u=new nl({uniforms:{map:{value:null},occlusionMap:{value:n},color:{value:new Ts(16777215)},scale:{value:new Cs},screenPosition:{value:new ss}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:2,transparent:!0,depthWrite:!1}),l=new Kc(r,u);this.addElement=function(t){s.push(t)};var h=new Cs,d=new Cs,p=new vv,f=new Is;this.onBeforeRender=function(c,m,v){f.copy(c.getCurrentViewport());var g=f.z/2,y=f.w/2;if(h.set((T=16/f.w)*(f.w/f.z),T),p.min.set(f.x,f.y),p.max.set(f.x+(f.z-16),f.y+(f.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(v.matrixWorldInverse),t.applyMatrix4(v.projectionMatrix),d.x=f.x+t.x*g+g-8,d.y=f.y+t.y*y+y-8,p.containsPoint(d)){c.copyFramebufferToTexture(d,e),(S=i.uniforms).scale.value=h,S.screenPosition.value=t,c.renderBufferDirect(v,null,r,i,a,null),c.copyFramebufferToTexture(d,n),(S=o.uniforms).scale.value=h,S.screenPosition.value=t,c.renderBufferDirect(v,null,r,o,a,null);for(var b=2*-t.x,x=2*-t.y,w=0,_=s.length;w<_;w++){var S,T,M=s[w];(S=u.uniforms).color.value.copy(M.color),S.map.value=M.texture,S.screenPosition.value.x=t.x+b*M.distance,S.screenPosition.value.y=t.y+x*M.distance,S.scale.value.set((T=M.size/f.w)*(f.w/f.z),T),u.uniformsNeedUpdate=!0,c.renderBufferDirect(v,null,r,u,l,null)}}},this.dispose=function(){i.dispose(),o.dispose(),u.dispose(),e.dispose(),n.dispose();for(var t=0,r=s.length;t<r;t++)s[t].texture.dispose()}};gv.prototype=Object.create(Kc.prototype),gv.prototype.constructor=gv,gv.prototype.isLensflare=!0;var yv,bv,xv=function(t,e,n,r){this.texture=t,this.size=e||1,this.distance=n||0,this.color=r||new Ts(16777215)};xv.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},gv.Geometry=(yv=new Xs,bv=new ad(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5),yv.setIndex([0,1,2,0,2,3]),yv.addAttribute("position",new cd(bv,3,0,!1)),yv.addAttribute("uv",new cd(bv,2,3,!1)),yv);var wv=function(t,e){Kc.call(this,t),this.type="Reflector";var n=this,r=new Ts(void 0!==(e=e||{}).color?e.color:8355711),i=e.textureWidth||512,o=e.textureHeight||512,a=e.clipBias||0,s=e.shader||wv.ReflectorShader,c=void 0!==e.recursion?e.recursion:0,u=new Jc,l=new ss,h=new ss,d=new ss,p=new as,f=new ss(0,0,-1),m=new Is,v=new Is,g=new ss,y=new ss,b=new Is,x=new as,w=new Mu,_=new Nu(i,o,{minFilter:Ac,magFilter:Ac,format:Nc,stencilBuffer:!1});os.isPowerOfTwo(i)&&os.isPowerOfTwo(o)||(_.texture.generateMipmaps=!1);var S=new Iu({uniforms:Lu.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});S.uniforms.tDiffuse.value=_.texture,S.uniforms.color.value=r,S.uniforms.textureMatrix.value=x,this.material=S,this.onBeforeRender=function(t,e,r){if("recursion"in r.userData){if(r.userData.recursion===c)return;r.userData.recursion++}if(h.setFromMatrixPosition(n.matrixWorld),d.setFromMatrixPosition(r.matrixWorld),p.extractRotation(n.matrixWorld),l.set(0,0,1),l.applyMatrix4(p),g.subVectors(h,d),!(g.dot(l)>0)){g.reflect(l).negate(),g.add(h),p.extractRotation(r.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),y.subVectors(h,f),y.reflect(l).negate(),y.add(h),w.position.copy(g),w.up.set(0,1,0),w.up.applyMatrix4(p),w.up.reflect(l),w.lookAt(y),w.far=r.far,w.updateMatrixWorld(),w.projectionMatrix.copy(r.projectionMatrix),w.userData.recursion=0,x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(w.projectionMatrix),x.multiply(w.matrixWorldInverse),x.multiply(n.matrixWorld),u.setFromNormalAndCoplanarPoint(l,h),u.applyMatrix4(w.matrixWorldInverse),m.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var i=w.projectionMatrix;b.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],b.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],b.z=-1,b.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(b)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-a,i.elements[14]=m.w,n.visible=!1;var o=t.getRenderTarget(),s=t.vr.enabled,S=t.shadowMap.autoUpdate;t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(e,w,_,!0),t.vr.enabled=s,t.shadowMap.autoUpdate=S,t.setRenderTarget(o);var T=r.bounds;if(void 0!==T){var M=t.getSize(),A=t.getPixelRatio();v.x=T.x*M.width*A,v.y=T.y*M.height*A,v.z=T.z*M.width*A,v.w=T.w*M.height*A,t.state.viewport(v)}n.visible=!0}},this.getRenderTarget=function(){return _}};wv.prototype=Object.create(Kc.prototype),wv.prototype.constructor=wv,wv.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},Object.create(wv.prototype);var _v=function(t,e){Kc.call(this,t),this.type="Refractor";var n=this,r=new Ts(void 0!==(e=e||{}).color?e.color:8355711),i=e.textureWidth||512,o=e.textureHeight||512,a=e.clipBias||0,s=e.shader||_v.RefractorShader,c=new Mu;c.matrixAutoUpdate=!1,c.userData.refractor=!0;var u=new Jc,l=new as,h=new Nu(i,o,{minFilter:Ac,magFilter:Ac,format:Nc,stencilBuffer:!1});os.isPowerOfTwo(i)&&os.isPowerOfTwo(o)||(h.texture.generateMipmaps=!1),this.material=new Iu({uniforms:Lu.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=h.texture,this.material.uniforms.textureMatrix.value=l;var d,p,f,m,v,g,y,b,x,w=(d=new ss,p=new ss,f=new as,m=new ss,v=new ss,function(t){return d.setFromMatrixPosition(n.matrixWorld),p.setFromMatrixPosition(t.matrixWorld),m.subVectors(d,p),f.extractRotation(n.matrixWorld),v.set(0,0,1),v.applyMatrix4(f),m.dot(v)<0}),_=function(){var t=new ss,e=new ss,r=new cs,i=new ss;return function(){n.matrixWorld.decompose(e,r,i),t.set(0,0,1).applyQuaternion(r).normalize(),t.negate(),u.setFromNormalAndCoplanarPoint(t,e)}}(),S=(g=new Jc,y=new Is,b=new Is,function(t){c.matrixWorld.copy(t.matrixWorld),c.matrixWorldInverse.getInverse(c.matrixWorld),c.projectionMatrix.copy(t.projectionMatrix),c.far=t.far,g.copy(u),g.applyMatrix4(c.matrixWorldInverse),y.set(g.normal.x,g.normal.y,g.normal.z,g.constant);var e=c.projectionMatrix;b.x=(Math.sign(y.x)+e.elements[8])/e.elements[0],b.y=(Math.sign(y.y)+e.elements[9])/e.elements[5],b.z=-1,b.w=(1+e.elements[10])/e.elements[14],y.multiplyScalar(2/y.dot(b)),e.elements[2]=y.x,e.elements[6]=y.y,e.elements[10]=y.z+1-a,e.elements[14]=y.w}),T=(x=new Is,function(t,e,r){n.visible=!1;var i=t.getRenderTarget(),o=t.vr.enabled,a=t.shadowMap.autoUpdate;t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(e,c,h,!0),t.vr.enabled=o,t.shadowMap.autoUpdate=a,t.setRenderTarget(i);var s=r.bounds;if(void 0!==s){var u=t.getSize(),l=t.getPixelRatio();x.x=s.x*u.width*l,x.y=s.y*u.height*l,x.z=s.z*u.width*l,x.w=s.w*u.height*l,t.state.viewport(x)}n.visible=!0});this.onBeforeRender=function(t,e,r){!0!==r.userData.refractor&&1!=!w(r)&&(_(),function(t){l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(t.projectionMatrix),l.multiply(t.matrixWorldInverse),l.multiply(n.matrixWorld)}(r),S(r),T(t,e,r))},this.getRenderTarget=function(){return h}};_v.prototype=Object.create(Kc.prototype),_v.prototype.constructor=_v,_v.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Sv,Tv=function(t){var e=new Xc({color:0,transparent:!0,opacity:.6,depthWrite:!1});Kc.call(this,t.geometry,e),this.meshMatrix=t.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1};(Tv.prototype=Object.create(Kc.prototype)).constructor=Tv,Tv.prototype.update=(Sv=new as,function(t,e){var n=t.normal.x*e.x+t.normal.y*e.y+t.normal.z*e.z+-t.constant*e.w,r=Sv.elements;r[0]=n-e.x*t.normal.x,r[4]=-e.x*t.normal.y,r[8]=-e.x*t.normal.z,r[12]=-e.x*-t.constant,r[1]=-e.y*t.normal.x,r[5]=n-e.y*t.normal.y,r[9]=-e.y*t.normal.z,r[13]=-e.y*-t.constant,r[2]=-e.z*t.normal.x,r[6]=-e.z*t.normal.y,r[10]=n-e.z*t.normal.z,r[14]=-e.z*-t.constant,r[3]=-e.w*t.normal.x,r[7]=-e.w*t.normal.y,r[11]=-e.w*t.normal.z,r[15]=n-e.w*-t.constant,this.matrix.multiplyMatrices(Sv,this.meshMatrix)});var Mv=function(){var t=Mv.SkyShader,e=new Iu({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:Lu.clone(t.uniforms),side:cc});Kc.call(this,new iu(1,1,1),e)};Mv.prototype=Object.create(Kc.prototype),Mv.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new ss}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var Av=function(t,e){Kc.call(this,t);var n=this,r=void 0!==(e=e||{}).textureWidth?e.textureWidth:512,i=void 0!==e.textureHeight?e.textureHeight:512,o=void 0!==e.clipBias?e.clipBias:0,a=void 0!==e.alpha?e.alpha:1,s=void 0!==e.time?e.time:0,c=void 0!==e.waterNormals?e.waterNormals:null,u=void 0!==e.sunDirection?e.sunDirection:new ss(.70707,.70707,0),l=new Ts(void 0!==e.sunColor?e.sunColor:16777215),h=new Ts(void 0!==e.waterColor?e.waterColor:8355711),d=void 0!==e.eye?e.eye:new ss(0,0,0),p=void 0!==e.distortionScale?e.distortionScale:20,f=void 0!==e.side?e.side:sc,m=void 0!==e.fog&&e.fog,v=new Jc,g=new ss,y=new ss,b=new ss,x=new as,w=new ss(0,0,-1),_=new Is,S=new ss,T=new ss,M=new Is,A=new as,E=new Mu,C=new Nu(r,i,{minFilter:Ac,magFilter:Ac,format:Nc,stencilBuffer:!1});os.isPowerOfTwo(r)&&os.isPowerOfTwo(i)||(C.texture.generateMipmaps=!1);var P={uniforms:Lu.merge([Lh.fog,Lh.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new as},sunColor:{value:new Ts(8355711)},sunDirection:{value:new ss(.70707,.70707,0)},eye:{value:new ss},waterColor:{value:new Ts(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",Nh.fog_pars_vertex,Nh.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Nh.fog_vertex,Nh.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",Nh.common,Nh.packing,Nh.bsdfs,Nh.fog_pars_fragment,Nh.lights_pars_begin,Nh.shadowmap_pars_fragment,Nh.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",Nh.tonemapping_fragment,Nh.fog_fragment,"}"].join("\n")},O=new Iu({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:Lu.clone(P.uniforms),transparent:!0,lights:!0,side:f,fog:m});O.uniforms.mirrorSampler.value=C.texture,O.uniforms.textureMatrix.value=A,O.uniforms.alpha.value=a,O.uniforms.time.value=s,O.uniforms.normalSampler.value=c,O.uniforms.sunColor.value=l,O.uniforms.waterColor.value=h,O.uniforms.sunDirection.value=u,O.uniforms.distortionScale.value=p,O.uniforms.eye.value=d,n.material=O,n.onBeforeRender=function(t,e,r){if(y.setFromMatrixPosition(n.matrixWorld),b.setFromMatrixPosition(r.matrixWorld),x.extractRotation(n.matrixWorld),g.set(0,0,1),g.applyMatrix4(x),S.subVectors(y,b),!(S.dot(g)>0)){S.reflect(g).negate(),S.add(y),x.extractRotation(r.matrixWorld),w.set(0,0,-1),w.applyMatrix4(x),w.add(b),T.subVectors(y,w),T.reflect(g).negate(),T.add(y),E.position.copy(S),E.up.set(0,1,0),E.up.applyMatrix4(x),E.up.reflect(g),E.lookAt(T),E.far=r.far,E.updateMatrixWorld(),E.projectionMatrix.copy(r.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(E.projectionMatrix),A.multiply(E.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(g,y),v.applyMatrix4(E.matrixWorldInverse),_.set(v.normal.x,v.normal.y,v.normal.z,v.constant);var i=E.projectionMatrix;M.x=(Math.sign(_.x)+i.elements[8])/i.elements[0],M.y=(Math.sign(_.y)+i.elements[9])/i.elements[5],M.z=-1,M.w=(1+i.elements[10])/i.elements[14],_.multiplyScalar(2/_.dot(M)),i.elements[2]=_.x,i.elements[6]=_.y,i.elements[10]=_.z+1-o,i.elements[14]=_.w,d.setFromMatrixPosition(r.matrixWorld);var a=t.getRenderTarget(),s=t.vr.enabled,c=t.shadowMap.autoUpdate;n.visible=!1,t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(e,E,C,!0),n.visible=!0,t.vr.enabled=s,t.shadowMap.autoUpdate=c,t.setRenderTarget(a)}}};function Ev(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Cv(t,e){Kc.call(this,t),this.type="Water2";var n=this,r=new Ts(void 0!==(e=e||{}).color?e.color:16777215),i=e.textureWidth||512,o=e.textureHeight||512,a=e.clipBias||0,s=e.flowDirection||new Cs(1,0),c=e.flowSpeed||.03,u=e.reflectivity||.02,l=e.scale||1,h=e.shader||Cv.Water2Shader,d=new sl,p=e.flowMap||void 0,f=e.normalMap0||d.load("textures/water/Water2_1_M_Normal.jpg"),m=e.normalMap1||d.load("textures/water/Water2_2_M_Normal.jpg"),v=new as,g=new Ev;if(void 0!==wv)if(void 0!==_v){var y=new wv(t,{textureWidth:i,textureHeight:o,clipBias:a}),b=new _v(t,{textureWidth:i,textureHeight:o,clipBias:a});y.matrixAutoUpdate=!1,b.matrixAutoUpdate=!1,this.material=new Iu({uniforms:Lu.merge([Lh.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==p?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:p}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=_c,m.wrapS=m.wrapT=_c,this.material.uniforms.tReflectionMap.value=y.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=b.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=v,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=l,this.onBeforeRender=function(t,e,r){var i,o;!function(t){v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(t.projectionMatrix),v.multiply(t.matrixWorldInverse),v.multiply(n.matrixWorld)}(r),i=g.getDelta(),(o=n.material.uniforms.config).value.x+=c*i,o.value.y=o.value.x+.075,o.value.x>=.15?(o.value.x=0,o.value.y=.075):o.value.y>=.15&&(o.value.y=o.value.y-.15),n.visible=!1,y.matrixWorld.copy(n.matrixWorld),b.matrixWorld.copy(n.matrixWorld),y.onBeforeRender(t,e,r),b.onBeforeRender(t,e,r),n.visible=!0}}else console.error("Water2: Required component Refractor not found.");else console.error("Water2: Required component Reflector not found.")}(Av.prototype=Object.create(Kc.prototype)).constructor=Av,Object.assign(Ev.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),(Cv.prototype=Object.create(Kc.prototype)).constructor=Cv,Cv.Water2Shader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new Is}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")};var Pv=function(t,e,n,r){function i(t,e){return void 0!==t?t:e}this.changed=!0,this.initial=!0,this.oceanCamera=new Cu,this.oceanCamera.position.z=1,this.renderer=t,this.renderer.clearColor(16777215),this.scene=new Eu,this.clearColor=i((r=r||{}).CLEAR_COLOR,[1,1,1,0]),this.geometryOrigin=i(r.GEOMETRY_ORIGIN,[-1e3,-1e3]),this.sunDirectionX=i(r.SUN_DIRECTION[0],-1),this.sunDirectionY=i(r.SUN_DIRECTION[1],1),this.sunDirectionZ=i(r.SUN_DIRECTION[2],1),this.oceanColor=i(r.OCEAN_COLOR,new ss(.004,.016,.047)),this.skyColor=i(r.SKY_COLOR,new ss(3.2,9.6,12.8)),this.exposure=i(r.EXPOSURE,.35),this.geometryResolution=i(r.GEOMETRY_RESOLUTION,32),this.geometrySize=i(r.GEOMETRY_SIZE,2e3),this.resolution=i(r.RESOLUTION,64),this.floatSize=i(r.SIZE_OF_FLOAT,4),this.windX=i(r.INITIAL_WIND[0],10),this.windY=i(r.INITIAL_WIND[1],10),this.size=i(r.INITIAL_SIZE,250),this.choppiness=i(r.INITIAL_CHOPPINESS,1.5),this.matrixNeedsUpdate=!1;var o=i(r.USE_HALF_FLOAT,!1)?1016:1015,a={minFilter:Ac,magFilter:Ac,wrapS:Sc,wrapT:Sc,format:Lc,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o},s={minFilter:Mc,magFilter:Mc,wrapS:Sc,wrapT:Sc,format:Lc,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o};this.initialSpectrumFramebuffer=new Nu(this.resolution,this.resolution,{minFilter:Mc,magFilter:Mc,wrapS:_c,wrapT:_c,format:Lc,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o}),this.spectrumFramebuffer=new Nu(this.resolution,this.resolution,s),this.pingPhaseFramebuffer=new Nu(this.resolution,this.resolution,s),this.pongPhaseFramebuffer=new Nu(this.resolution,this.resolution,s),this.pingTransformFramebuffer=new Nu(this.resolution,this.resolution,s),this.pongTransformFramebuffer=new Nu(this.resolution,this.resolution,s),this.displacementMapFramebuffer=new Nu(this.resolution,this.resolution,a),this.normalMapFramebuffer=new Nu(this.resolution,this.resolution,a);var c=Ih.ocean_sim_vertex,u=Ih.ocean_subtransform,l=Lu.clone(u.uniforms);this.materialOceanHorizontal=new Iu({uniforms:l,vertexShader:c.vertexShader,fragmentShader:"#define HORIZONTAL \n"+u.fragmentShader}),this.materialOceanHorizontal.uniforms.u_transformSize={value:this.resolution},this.materialOceanHorizontal.uniforms.u_subtransformSize={value:null},this.materialOceanHorizontal.uniforms.u_input={value:null},this.materialOceanHorizontal.depthTest=!1;var h=Ih.ocean_subtransform,d=Lu.clone(h.uniforms);this.materialOceanVertical=new Iu({uniforms:d,vertexShader:c.vertexShader,fragmentShader:h.fragmentShader}),this.materialOceanVertical.uniforms.u_transformSize={value:this.resolution},this.materialOceanVertical.uniforms.u_subtransformSize={value:null},this.materialOceanVertical.uniforms.u_input={value:null},this.materialOceanVertical.depthTest=!1;var p=Ih.ocean_initial_spectrum,f=Lu.clone(p.uniforms);this.materialInitialSpectrum=new Iu({uniforms:f,vertexShader:c.vertexShader,fragmentShader:p.fragmentShader}),this.materialInitialSpectrum.uniforms.u_wind={value:new Cs},this.materialInitialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialInitialSpectrum.depthTest=!1;var m=Ih.ocean_phase,v=Lu.clone(m.uniforms);this.materialPhase=new Iu({uniforms:v,vertexShader:c.vertexShader,fragmentShader:m.fragmentShader}),this.materialPhase.uniforms.u_resolution={value:this.resolution},this.materialPhase.depthTest=!1;var g=Ih.ocean_spectrum,y=Lu.clone(g.uniforms);this.materialSpectrum=new Iu({uniforms:y,vertexShader:c.vertexShader,fragmentShader:g.fragmentShader}),this.materialSpectrum.uniforms.u_initialSpectrum={value:null},this.materialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialSpectrum.depthTest=!1;var b=Ih.ocean_normals,x=Lu.clone(b.uniforms);this.materialNormal=new Iu({uniforms:x,vertexShader:c.vertexShader,fragmentShader:b.fragmentShader}),this.materialNormal.uniforms.u_displacementMap={value:null},this.materialNormal.uniforms.u_resolution={value:this.resolution},this.materialNormal.depthTest=!1;var w=Ih.ocean_main,_=Lu.clone(w.uniforms);this.materialOcean=new Iu({uniforms:_,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}),this.materialOcean.uniforms.u_geometrySize={value:this.resolution},this.materialOcean.uniforms.u_displacementMap={value:this.displacementMapFramebuffer.texture},this.materialOcean.uniforms.u_normalMap={value:this.normalMapFramebuffer.texture},this.materialOcean.uniforms.u_oceanColor={value:this.oceanColor},this.materialOcean.uniforms.u_skyColor={value:this.skyColor},this.materialOcean.uniforms.u_sunDirection={value:new ss(this.sunDirectionX,this.sunDirectionY,this.sunDirectionZ)},this.materialOcean.uniforms.u_exposure={value:this.exposure},this.materialOceanHorizontal.blending=0,this.materialOceanVertical.blending=0,this.materialInitialSpectrum.blending=0,this.materialPhase.blending=0,this.materialSpectrum.blending=0,this.materialNormal.blending=0,this.materialOcean.blending=0,this.screenQuad=new Kc(new Du(2,2)),this.scene.add(this.screenQuad),this.generateSeedPhaseTexture(),this.generateMesh()};function Ov(t,e){this.object=t,void 0===e&&(e=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Xs;i.setIndex(new Rs(n,1)),i.addAttribute("position",new Rs(r,3)),Bd.call(this,i,new qc({color:e})),this.matrixAutoUpdate=!1,this.update()}function Nv(t){return!isNaN(t)&&isFinite(t)}function Lv(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}Pv.prototype.generateMesh=function(){var t=new Du(this.geometrySize,this.geometrySize,this.geometryResolution,this.geometryResolution);t.rotateX(-Math.PI/2),this.oceanMesh=new Kc(t,this.materialOcean)},Pv.prototype.render=function(){this.scene.overrideMaterial=null,this.changed&&this.renderInitialSpectrum(),this.renderWavePhase(),this.renderSpectrum(),this.renderSpectrumFFT(),this.renderNormalMap(),this.scene.overrideMaterial=null},Pv.prototype.generateSeedPhaseTexture=function(){this.pingPhase=!0;for(var t=new window.Float32Array(this.resolution*this.resolution*4),e=0;e<this.resolution;e++)for(var n=0;n<this.resolution;n++)t[e*this.resolution*4+4*n]=2*Math.random()*Math.PI,t[e*this.resolution*4+4*n+1]=0,t[e*this.resolution*4+4*n+2]=0,t[e*this.resolution*4+4*n+3]=0;this.pingPhaseTexture=new Yh(t,this.resolution,this.resolution,Lc),this.pingPhaseTexture.wrapS=Sc,this.pingPhaseTexture.wrapT=Sc,this.pingPhaseTexture.type=1015,this.pingPhaseTexture.needsUpdate=!0},Pv.prototype.renderInitialSpectrum=function(){this.scene.overrideMaterial=this.materialInitialSpectrum,this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX,this.windY),this.materialInitialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.initialSpectrumFramebuffer,!0)},Pv.prototype.renderWavePhase=function(){this.scene.overrideMaterial=this.materialPhase,this.screenQuad.material=this.materialPhase,this.initial?(this.materialPhase.uniforms.u_phases.value=this.pingPhaseTexture,this.initial=!1):this.materialPhase.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialPhase.uniforms.u_deltaTime.value=this.deltaTime,this.materialPhase.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.pingPhase?this.pongPhaseFramebuffer:this.pingPhaseFramebuffer),this.pingPhase=!this.pingPhase},Pv.prototype.renderSpectrum=function(){this.scene.overrideMaterial=this.materialSpectrum,this.materialSpectrum.uniforms.u_initialSpectrum.value=this.initialSpectrumFramebuffer.texture,this.materialSpectrum.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialSpectrum.uniforms.u_choppiness.value=this.choppiness,this.materialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.spectrumFramebuffer)},Pv.prototype.renderSpectrumFFT=function(){var t=Math.log(this.resolution)/Math.log(2);this.scene.overrideMaterial=this.materialOceanHorizontal;for(var e=0;e<t;e++)0===e?(this.materialOceanHorizontal.uniforms.u_input.value=this.spectrumFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer)):e%2==1?(this.materialOceanHorizontal.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanHorizontal.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer));for(this.scene.overrideMaterial=this.materialOceanVertical,e=t;e<2*t;e++)e===2*t-1?(this.materialOceanVertical.uniforms.u_input.value=t%2==0?this.pingTransformFramebuffer.texture:this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.displacementMapFramebuffer)):e%2==1?(this.materialOceanVertical.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanVertical.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer))},Pv.prototype.renderNormalMap=function(){this.scene.overrideMaterial=this.materialNormal,this.changed&&(this.materialNormal.uniforms.u_size.value=this.size),this.materialNormal.uniforms.u_displacementMap.value=this.displacementMapFramebuffer.texture,this.renderer.render(this.scene,this.oceanCamera,this.normalMapFramebuffer,!0)},(Ov.prototype=Object.create(Bd.prototype)).constructor=Ov,Ov.prototype.update=function(){var t=new As;return function(e){if(void 0!==e&&console.warn("BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var n=t.min,r=t.max,i=this.geometry.attributes.position,o=i.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=n.x,o[4]=r.y,o[5]=r.z,o[6]=n.x,o[7]=n.y,o[8]=r.z,o[9]=r.x,o[10]=n.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=n.z,o[15]=n.x,o[16]=r.y,o[17]=n.z,o[18]=n.x,o[19]=n.y,o[20]=n.z,o[21]=r.x,o[22]=n.y,o[23]=n.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Ov.prototype.setFromObject=function(t){return this.object=t,this.update(),this};var Iv=function(t){if((t=t||{}).tree=this,this.nodeCount=0,this.INDEX_INSIDE_CROSS=-1,this.INDEX_OUTSIDE_OFFSET=2,this.INDEX_OUTSIDE_POS_X=Nv(t.INDEX_OUTSIDE_POS_X)?t.INDEX_OUTSIDE_POS_X:0,this.INDEX_OUTSIDE_NEG_X=Nv(t.INDEX_OUTSIDE_NEG_X)?t.INDEX_OUTSIDE_NEG_X:1,this.INDEX_OUTSIDE_POS_Y=Nv(t.INDEX_OUTSIDE_POS_Y)?t.INDEX_OUTSIDE_POS_Y:2,this.INDEX_OUTSIDE_NEG_Y=Nv(t.INDEX_OUTSIDE_NEG_Y)?t.INDEX_OUTSIDE_NEG_Y:3,this.INDEX_OUTSIDE_POS_Z=Nv(t.INDEX_OUTSIDE_POS_Z)?t.INDEX_OUTSIDE_POS_Z:4,this.INDEX_OUTSIDE_NEG_Z=Nv(t.INDEX_OUTSIDE_NEG_Z)?t.INDEX_OUTSIDE_NEG_Z:5,this.INDEX_OUTSIDE_MAP=[],this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1},this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1,this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1,this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1,this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1,this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1,this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1,this.utilVec31Search=new ss,this.utilVec32Search=new ss,this.scene=t.scene,this.scene){var e=new Ov(new Kc(new ru(1,1,1)),16711782);this.visualGeometry=e.geometry,this.visualMaterial=e.material}this.objects=[],this.objectsMap={},this.objectsData=[],this.objectsDeferred=[],this.depthMax=Nv(t.depthMax)?t.depthMax:1/0,this.objectsThreshold=Nv(t.objectsThreshold)?t.objectsThreshold:8,this.overlapPct=Nv(t.overlapPct)?t.overlapPct:.15,this.undeferred=t.undeferred||!1,this.root=t.root instanceof Dv?t.root:new Dv(t)};Iv.prototype={update:function(){if(this.objectsDeferred.length>0){for(var t=0,e=this.objectsDeferred.length;t<e;t++){var n=this.objectsDeferred[t];this.addDeferred(n.object,n.options)}this.objectsDeferred.length=0}},add:function(t,e){this.undeferred?(this.updateObject(t),this.addDeferred(t,e)):this.objectsDeferred.push({object:t,options:e})},addDeferred:function(t,e){var n,r,i,o,a,s;if(t instanceof Rv&&(t=t.object),t.uuid||(t.uuid=os.generateUUID()),!this.objectsMap[t.uuid])if(this.objects.push(t),this.objectsMap[t.uuid]=t,e&&(o=e.useFaces,s=e.useVertices),!0===s)for(n=0,r=(a=t.geometry.vertices).length;n<r;n++)this.addObjectData(t,a[n]);else if(!0===o)for(n=0,r=(i=t.geometry.faces).length;n<r;n++)this.addObjectData(t,i[n]);else this.addObjectData(t)},addObjectData:function(t,e){var n=new Rv(t,e);this.objectsData.push(n),this.root.addObject(n)},remove:function(t){var e,n,r,i,o=t;if(t instanceof Rv&&(t=t.object),this.objectsMap[t.uuid]){if(this.objectsMap[t.uuid]=void 0,-1!==(r=Lv(this.objects,t)))for(this.objects.splice(r,1),e=0,n=(i=this.root.removeObject(o)).length;e<n;e++)-1!==(r=Lv(this.objectsData,o=i[e]))&&this.objectsData.splice(r,1)}else this.objectsDeferred.length>0&&-1!==(r=function(t,e,n){for(var r=0,i=t.length;r<i;r++)if(t[r].object===n)return r;return-1}(this.objectsDeferred,0,t))&&this.objectsDeferred.splice(r,1)},extend:function(t){var e,n,r,i;if(t instanceof Iv)for(e=0,n=(r=t.objectsData).length;e<n;e++)this.add(i=r[e],{useFaces:i.faces,useVertices:i.vertices})},rebuild:function(){var t,e,n,r,i,o=[];for(t=0,e=this.objectsData.length;t<e;t++)n=(r=this.objectsData[t]).node,r.update(),n instanceof Dv&&!r.positionLast.equals(r.position)&&(i=r.indexOctant,n.getOctantIndex(r)!==i&&o.push(r));for(t=0,e=o.length;t<e;t++)(r=o[t]).node.removeObject(r),this.root.addObject(r)},updateObject:function(t){var e,n,r,i,o=[t];for(r=t.parent;r;)o.push(r),r=r.parent;for(e=0,n=o.length;e<n;e++)!0===(r=o[e]).matrixWorldNeedsUpdate&&(i=r);"undefined"!=typeof i&&i.updateMatrixWorld()},search:function(t,e,n,r){var i,o,a,s,c,u,l,h,d,p;for(a=[].concat(this.root.objects),e>0||(e=Number.MAX_VALUE),r instanceof ss&&(r=this.utilVec31Search.copy(r).normalize(),p=this.utilVec32Search.set(1,1,1).divide(r)),i=0,o=this.root.nodesIndices.length;i<o;i++)a=this.root.nodesByIndex[this.root.nodesIndices[i]].search(t,e,a,r,p);if(!0===n)for(u=[],h=[],i=0,o=a.length;i<o;i++)-1===(d=Lv(h,c=(s=a[i]).object))?(u.push(l={object:c,faces:[],vertices:[]}),h.push(c)):l=u[d],s.faces?l.faces.push(s.faces):s.vertices&&l.vertices.push(s.vertices);else u=a;return u},setRoot:function(t){t instanceof Dv&&(this.root=t,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};var Rv=function(t,e){this.object=t,e instanceof Ms?(this.faces=e,this.face3=!0,this.utilVec31FaceBounds=new ss):e instanceof ss&&(this.vertices=e),this.radius=0,this.position=new ss,this.object instanceof ys&&this.update(),this.positionLast=this.position.clone()};Rv.prototype={update:function(){this.face3?(this.radius=this.getFace3BoundingRadius(this.object,this.faces),this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.vertices?(this.radius=this.object.material.size||1,this.position.copy(this.vertices).applyMatrix4(this.object.matrixWorld)):this.object.geometry?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius,this.position.copy(this.object.geometry.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):(this.radius=this.object.boundRadius,this.position.setFromMatrixPosition(this.object.matrixWorld)),this.radius=this.radius*Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)},getFace3BoundingRadius:function(t,e){void 0===e.centroid&&(e.centroid=new ss);var n=(t.geometry||t).vertices,r=e.centroid,i=n[e.a],o=n[e.b],a=n[e.c],s=this.utilVec31FaceBounds;return r.addVectors(i,o).add(a).divideScalar(3),Math.max(s.subVectors(r,i).length(),s.subVectors(r,o).length(),s.subVectors(r,a).length())}};var Dv=function(t){this.utilVec31Branch=new ss,this.utilVec31Expand=new ss,this.utilVec31Ray=new ss,(t=t||{}).tree instanceof Iv?this.tree=t.tree:t.parent instanceof Dv!=1&&(t.root=this,this.tree=new Iv(t)),this.id=this.tree.nodeCount++,this.position=t.position instanceof ss?t.position:new ss,this.radius=t.radius>0?t.radius:1,this.indexOctant=t.indexOctant,this.depth=0,this.reset(),this.setParent(t.parent),this.overlap=this.radius*this.tree.overlapPct,this.radiusOverlap=this.radius+this.overlap,this.left=this.position.x-this.radiusOverlap,this.right=this.position.x+this.radiusOverlap,this.bottom=this.position.y-this.radiusOverlap,this.top=this.position.y+this.radiusOverlap,this.back=this.position.z-this.radiusOverlap,this.front=this.position.z+this.radiusOverlap,this.tree.scene&&(this.visual=new Bd(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual))};Dv.prototype={setParent:function(t){t!==this&&this.parent!==t&&(this.parent=t,this.updateProperties())},updateProperties:function(){var t,e;for(this.parent instanceof Dv?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0,t=0,e=this.nodesIndices.length;t<e;t++)this.nodesByIndex[this.nodesIndices[t]].updateProperties()},reset:function(t,e){var n,r,i,o=this.nodesIndices||[],a=this.nodesByIndex;for(this.objects=[],this.nodesIndices=[],this.nodesByIndex={},n=0,r=o.length;n<r;n++)(i=a[o[n]]).setParent(void 0),!0===t&&i.reset(t,e);!0===e&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(t,e){t.indexOctant=e,-1===Lv(this.nodesIndices,e)&&this.nodesIndices.push(e),this.nodesByIndex[e]=t,t.parent!==this&&t.setParent(this)},removeNode:function(t){var e,n;e=Lv(this.nodesIndices,t),this.nodesIndices.splice(e,1),n=n||this.nodesByIndex[t],delete this.nodesByIndex[t],n.parent===this&&n.setParent(void 0)},addObject:function(t){var e;(e=this.getOctantIndex(t))>-1&&this.nodesIndices.length>0?this.branch(e).addObject(t):e<-1&&this.parent instanceof Dv?this.parent.addObject(t):(-1===Lv(this.objects,t)&&this.objects.push(t),t.node=this,this.checkGrow())},addObjectWithoutCheck:function(t){var e,n,r;for(e=0,n=t.length;e<n;e++)this.objects.push(r=t[e]),r.node=this},removeObject:function(t){var e,n,r,i;if((r=(i=this.removeObjectRecursive(t,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]})).nodesRemovedFrom).length>0)for(e=0,n=r.length;e<n;e++)r[e].shrink();return i.objectsDataRemoved},removeObjectRecursive:function(t,e){var n,r,i,o,a=-1;if(t instanceof Rv)-1!==(a=Lv(this.objects,t))&&(this.objects.splice(a,1),t.node=void 0,e.objectsDataRemoved.push(t),e.searchComplete=o=!0);else for(n=this.objects.length-1;n>=0;n--)if((i=this.objects[n]).object===t&&(this.objects.splice(n,1),i.node=void 0,e.objectsDataRemoved.push(i),o=!0,!i.faces&&!i.vertices)){e.searchComplete=!0;break}if(!0===o&&e.nodesRemovedFrom.push(this),!0!==e.searchComplete)for(n=0,r=this.nodesIndices.length;n<r&&!0!==(e=this.nodesByIndex[this.nodesIndices[n]].removeObjectRecursive(t,e)).searchComplete;n++);return e},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&this.tree.objectsThreshold>0&&this.grow()},grow:function(){var t,e,n,r,i=[],o=[],a=[],s=[],c=[];for(n=0,r=this.objects.length;n<r;n++)(t=this.getOctantIndex(e=this.objects[n]))>-1?(a.push(e),s.push(t)):t<-1?(i.push(e),o.push(t)):c.push(e);a.length>0&&(c=c.concat(this.split(a,s))),i.length>0&&(c=c.concat(this.expand(i,o))),this.objects=c,this.checkMerge()},split:function(t,e){var n,r,i,o,a;if(this.depth<this.tree.depthMax){for(t=t||this.objects,e=e||[],a=[],n=0,r=t.length;n<r;n++)o=t[n],(i=e[n])>-1?this.branch(i).addObject(o):a.push(o);t===this.objects&&(this.objects=a)}else a=this.objects;return a},branch:function(t){var e,n,r,i,o;return this.nodesByIndex[t]instanceof Dv?e=this.nodesByIndex[t]:(r=(n=.5*this.radiusOverlap)-n*this.tree.overlapPct,i=this.utilVec31Branch.set(1&t?r:-r,2&t?r:-r,4&t?r:-r),o=(new ss).addVectors(this.position,i),e=new Dv({tree:this.tree,parent:this,position:o,radius:n,indexOctant:t}),this.addNode(e,t)),e},expand:function(t,e){var n,r,i,o,a,s,c,u,l,h,d,p,f,m,v,g,y,b,x,w,_,S,T,M,A,E,C,P=this.tree.INDEX_OUTSIDE_MAP,O=this.utilVec31Expand;if(this.tree.root.getDepthEnd()<this.tree.depthMax){for(t=t||this.objects,e=e||[],o=[],a=[],n=0,r=P.length;n<r;n++)P[n].count=0;for(n=0,r=t.length;n<r;n++)i=t[n],(s=e[n])<-1?((c=-s-this.tree.INDEX_OUTSIDE_OFFSET)&this.tree.FLAG_POS_X?P[this.tree.INDEX_OUTSIDE_POS_X].count++:c&this.tree.FLAG_NEG_X&&P[this.tree.INDEX_OUTSIDE_NEG_X].count++,c&this.tree.FLAG_POS_Y?P[this.tree.INDEX_OUTSIDE_POS_Y].count++:c&this.tree.FLAG_NEG_Y&&P[this.tree.INDEX_OUTSIDE_NEG_Y].count++,c&this.tree.FLAG_POS_Z?P[this.tree.INDEX_OUTSIDE_POS_Z].count++:c&this.tree.FLAG_NEG_Z&&P[this.tree.INDEX_OUTSIDE_NEG_Z].count++,a.push(i)):o.push(i);if(a.length>0)for((l=P.slice(0)).sort(function(t,e){return e.count-t.count}),g=l[2],m=1|(d=(1|(v=l[1]).index)!=(f=1|(h=l[0]).index)?v:g).index,b=1|(g=l[3]).index,s=this.getOctantIndexFromPosition(x=h.x+d.x+(p=(y=1|(v=l[2]).index)!==f&&y!==m?v:b!==f&&b!==m?g:l[4]).x,w=h.y+d.y+p.y,_=h.z+d.z+p.z),u=this.getOctantIndexFromPosition(-x,-w,-_),S=this.overlap,T=this.radius,M=(A=this.tree.overlapPct>0?S/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*T)+A*this.tree.overlapPct-(T+S),O.set(1&s?M:-M,2&s?M:-M,4&s?M:-M),E=(new ss).addVectors(this.position,O),(C=new Dv({tree:this.tree,position:E,radius:A})).addNode(this,u),this.tree.setRoot(C),n=0,r=a.length;n<r;n++)this.tree.root.addObject(a[n]);t===this.objects&&(this.objects=o)}else o=t;return o},shrink:function(){this.checkMerge(),this.tree.root.checkContract()},checkMerge:function(){for(var t,e=this;e.parent instanceof Dv&&e.getObjectCountEnd()<this.tree.objectsThreshold;)t=e,e=e.parent;e!==this&&e.merge(t)},merge:function(t){var e,n,r,i;for(e=0,n=(i=t,t=i?!0!==function(t){return"[object Array]"===Object.prototype.toString.call(t)}(i)?[i]:i:[]).length;e<n;e++)this.addObjectWithoutCheck((r=t[e]).getObjectsEnd()),r.reset(!0,!0),this.removeNode(r.indexOctant,r);this.checkMerge()},checkContract:function(){var t,e,n,r,i,o,a;if(this.nodesIndices.length>0){for(o=0,a=this.objects.length,t=0,e=this.nodesIndices.length;t<e;t++)a+=r=(n=this.nodesByIndex[this.nodesIndices[t]]).getObjectCountEnd(),(i instanceof Dv==0||r>o)&&(i=n,o=r);(a-=o)<this.tree.objectsThreshold&&i instanceof Dv&&this.contract(i)}},contract:function(t){var e,n,r;for(e=0,n=this.nodesIndices.length;e<n;e++)(r=this.nodesByIndex[this.nodesIndices[e]])!==t&&(t.addObjectWithoutCheck(r.getObjectsEnd()),r.reset(!0,!0));t.addObjectWithoutCheck(this.objects),this.reset(!1,!0),this.tree.setRoot(t),t.checkContract()},getOctantIndex:function(t){var e,n,r,i,o,a,s,c,u=this.position,l=this.radiusOverlap,h=this.overlap,d=0;if(t instanceof Rv?(n=t.radius,t.positionLast.copy(e=t.position)):t instanceof Dv&&(e=t.position,n=0),r=e.x-u.x,i=e.y-u.y,o=e.z-u.z,a=Math.abs(r),s=Math.abs(i),c=Math.abs(o),Math.max(a,s,c)+n>l)return a+n>l&&(d^=r>0?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),s+n>l&&(d^=i>0?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),c+n>l&&(d^=o>0?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),t.indexOctant=-d-this.tree.INDEX_OUTSIDE_OFFSET,t.indexOctant;if(r-n>-h)d|=1;else if(!(r+n<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;if(i-n>-h)d|=2;else if(!(i+n<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;if(o-n>-h)d|=4;else if(!(o+n<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;return t.indexOctant=d,t.indexOctant},getOctantIndexFromPosition:function(t,e,n){var r=0;return t>0&&(r|=1),e>0&&(r|=2),n>0&&(r|=4),r},search:function(t,e,n,r,i){var o,a;if(!0===(r?this.intersectRay(t,r,e,i):this.intersectSphere(t,e)))for(n=n.concat(this.objects),o=0,a=this.nodesIndices.length;o<a;o++)n=this.nodesByIndex[this.nodesIndices[o]].search(t,e,n,r);return n},intersectSphere:function(t,e){var n=e*e,r=t.x,i=t.y,o=t.z;return r<this.left?n-=Math.pow(r-this.left,2):r>this.right&&(n-=Math.pow(r-this.right,2)),i<this.bottom?n-=Math.pow(i-this.bottom,2):i>this.top&&(n-=Math.pow(i-this.top,2)),o<this.back?n-=Math.pow(o-this.back,2):o>this.front&&(n-=Math.pow(o-this.front,2)),n>=0},intersectRay:function(t,e,n,r){"undefined"==typeof r&&(r=this.utilVec31Ray.set(1,1,1).divide(e));var i,o=(this.left-t.x)*r.x,a=(this.right-t.x)*r.x,s=(this.bottom-t.y)*r.y,c=(this.top-t.y)*r.y,u=(this.back-t.z)*r.z,l=(this.front-t.z)*r.z,h=Math.min(Math.min(Math.max(o,a),Math.max(s,c)),Math.max(u,l));return!(h<0||(i=Math.max(Math.max(Math.min(o,a),Math.min(s,c)),Math.min(u,l)))>h||i>n)},getDepthEnd:function(t){var e,n;if(this.nodesIndices.length>0)for(e=0,n=this.nodesIndices.length;e<n;e++)t=this.nodesByIndex[this.nodesIndices[e]].getDepthEnd(t);else t=!t||this.depth>t?this.depth:t;return t},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var t,e,n=this.nodesIndices.length;for(t=0,e=this.nodesIndices.length;t<e;t++)n+=this.nodesByIndex[this.nodesIndices[t]].getNodeCountRecursive();return n},getObjectsEnd:function(t){var e,n;for(t=(t||[]).concat(this.objects),e=0,n=this.nodesIndices.length;e<n;e++)t=this.nodesByIndex[this.nodesIndices[e]].getObjectsEnd(t);return t},getObjectCountEnd:function(){var t,e,n=this.objects.length;for(t=0,e=this.nodesIndices.length;t<e;t++)n+=this.nodesByIndex[this.nodesIndices[t]].getObjectCountEnd();return n},getObjectCountStart:function(){for(var t=this.objects.length,e=this.parent;e instanceof Dv;)t+=e.objects.length,e=e.parent;return t},toConsole:function(t){var e,n;for(t="string"==typeof t?t:"   ",console.log(this.parent?t+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth),console.log(this.parent?t+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects),console.log(this.parent?t+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex),e=0,n=this.nodesIndices.length;e<n;e++)this.nodesByIndex[this.nodesIndices[e]].toConsole(t+"   ")}},dl.prototype.intersectOctreeObject=function(t,e){var n,r,i,o;return t.object instanceof ys?(i=(t=(r=t).object).geometry.faces,(o=r.faces).length>0&&(t.geometry.faces=o),n=this.intersectObject(t,e),o.length>0&&(t.geometry.faces=i)):n=this.intersectObject(t,e),n},dl.prototype.intersectOctreeObjects=function(t,e){var n,r,i=[];for(n=0,r=t.length;n<r;n++)i=i.concat(this.intersectOctreeObject(t[n],e));return i};var Fv=function(t,e){this.cubeLods=t,this.numLods=e;var n=4*t[0].width,r=t[0].texture,i={format:r.format,magFilter:r.magFilter,minFilter:r.minFilter,type:r.type,generateMipmaps:r.generateMipmaps,anisotropy:r.anisotropy,encoding:3002===r.encoding?3005:r.encoding};3005===i.encoding&&(i.magFilter=Ac,i.minFilter=Ac),this.CubeUVRenderTarget=new Nu(n,n,i),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=306,this.camera=new Cu(.5*-n,.5*n,.5*-n,.5*n,0,1e3),this.scene=new Eu,this.scene.add(this.camera),this.objects=[];var o=[];o.push(new Cs(0,0)),o.push(new Cs(1,0)),o.push(new Cs(2,0)),o.push(new Cs(0,1)),o.push(new Cs(1,1)),o.push(new Cs(2,1));var a=n;n=t[0].width;var s=0,c=4;this.numLods=Math.log(t[0].width)/Math.log(2)-2;for(var u=0;u<this.numLods;u++){var l=.5*(a-a/c);n>16&&(c*=2);for(var h=n>16?6:1,d=0,p=0,f=n,m=0;m<h;m++){for(var v=0;v<6;v++){var g=this.getShader();g.uniforms.envMap.value=this.cubeLods[u].texture,g.envMap=this.cubeLods[u].texture,g.uniforms.faceIndex.value=v,g.uniforms.mapSize.value=f;var y=new Kc(new Ru(f,f,0),g);y.position.x=o[v].x*f-l+d,y.position.y=o[v].y*f-l+s+p,y.material.side=uc,this.scene.add(y),this.objects.push(y)}p+=1.75*f,d+=1.25*f,f/=2}s+=2*n,n>16&&(n/=2)}};function Uv(t,e,n){Nu.call(this,t,e,n),this.activeCubeFace=0,this.activeMipMapLevel=0}Fv.prototype={constructor:Fv,update:function(t){var e=t.gammaInput,n=t.gammaOutput,r=t.toneMapping,i=t.toneMappingExposure,o=t.getRenderTarget();t.gammaInput=!1,t.gammaOutput=!1,t.toneMapping=1,t.toneMappingExposure=1,t.render(this.scene,this.camera,this.CubeUVRenderTarget,!1),t.setRenderTarget(o),t.toneMapping=r,t.toneMappingExposure=i,t.gammaInput=e,t.gammaOutput=n},getShader:function(){return new Iu({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new ss(1,1,1)}},vertexShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tvoid main() {\t\t\t\t\tvUv = uv;\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\t\t\t\t}",fragmentShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform samplerCube envMap;\t\t\t\tuniform float mapSize;\t\t\t\tuniform vec3 testColor;\t\t\t\tuniform int faceIndex;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec3 sampleDirection;\t\t\t\t\tvec2 uv = vUv;\t\t\t\t\tuv = uv * 2.0 - 1.0;\t\t\t\t\tuv.y *= -1.0;\t\t\t\t\tif(faceIndex == 0) {\t\t\t\t\t\tsampleDirection = normalize(vec3(1.0, uv.y, -uv.x));\t\t\t\t\t} else if(faceIndex == 1) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, 1.0, uv.y));\t\t\t\t\t} else if(faceIndex == 2) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, uv.y, 1.0));\t\t\t\t\t} else if(faceIndex == 3) {\t\t\t\t\t\tsampleDirection = normalize(vec3(-1.0, uv.y, uv.x));\t\t\t\t\t} else if(faceIndex == 4) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));\t\t\t\t\t} else {\t\t\t\t\t\tsampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));\t\t\t\t\t}\t\t\t\t\tvec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );\t\t\t\t\tgl_FragColor = linearToOutputTexel( color );\t\t\t\t}",blending:5,premultipliedAlpha:!1,blendSrc:201,blendDst:200,blendSrcAlpha:201,blendDstAlpha:200,blendEquation:fc})}},(Uv.prototype=Object.create(Nu.prototype)).constructor=Uv,Uv.prototype.isWebGLRenderTargetCube=!0;var kv=function(t,e,n){this.sourceTexture=t,this.resolution=void 0!==n?n:256,this.samplesPerLevel=void 0!==e?e:16;var r=t.encoding===Vc||3007===t.encoding||3001===t.encoding;this.sourceTexture.minFilter=r?Ac:Mc,this.sourceTexture.magFilter=r?Ac:Mc,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&r,this.cubeLods=[];var i=this.resolution,o={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(i)/Math.log(2)-2;for(var a=0;a<this.numLods;a++){var s=new Uv(i,i,o);s.texture.name="PMREMGenerator.cube"+a,this.cubeLods.push(s),i=Math.max(16,i/2)}this.camera=new Cu(-1,1,1,-1,0,1e3),this.shader=this.getShader(),this.shader.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,this.planeMesh=new Kc(new Ru(2,2,0),this.shader),this.planeMesh.material.side=uc,this.scene=new Eu,this.scene.add(this.planeMesh),this.scene.add(this.camera),this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture};kv.prototype={constructor:kv,update:function(t){this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture;var e=t.gammaInput,n=t.gammaOutput,r=t.toneMapping,i=t.toneMappingExposure,o=t.getRenderTarget();t.toneMapping=1,t.toneMappingExposure=1,t.gammaInput=!1,t.gammaOutput=!1;for(var a=0;a<this.numLods;a++)this.shader.uniforms.roughness.value=a/(this.numLods-1)*.9,this.shader.uniforms.queryScale.value.x=0==a?-1:1,this.shader.uniforms.mapSize.value=this.cubeLods[a].width,this.renderToCubeMapTarget(t,this.cubeLods[a]),a<5&&(this.shader.uniforms.envMap.value=this.cubeLods[a].texture);t.setRenderTarget(o),t.toneMapping=r,t.toneMappingExposure=i,t.gammaInput=e,t.gammaOutput=n},renderToCubeMapTarget:function(t,e){for(var n=0;n<6;n++)this.renderToCubeMapTargetFace(t,e,n)},renderToCubeMapTargetFace:function(t,e,n){e.activeCubeFace=n,this.shader.uniforms.faceIndex.value=n,t.render(this.scene,this.camera,e,!0)},getShader:function(){return new Iu({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},queryScale:{value:new ss(1,1,1)},testColor:{value:new ss(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform vec3 testColor;\n\t\t\t\tuniform vec3 queryScale;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tmat3 vecSpace = matrixFromVector(normalize(sampleDirection * queryScale));\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap,vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:5,blendSrc:201,blendDst:200,blendSrcAlpha:201,blendDstAlpha:200,blendEquation:fc})}};var jv={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},Bv={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float l = linearToRelativeLuminance( texel.rgb );","gl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},zv={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","uniform sampler2D luminanceMap;","#else","uniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","#ifdef ADAPTED_LUMINANCE","float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","#else","float fLumAvg = averageLuminance;","#endif","float fLumPixel = linearToRelativeLuminance( vColor );","float fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","return fLumCompressed * vColor;","}","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")},Vv=function(t,e){ev.call(this),this.resolution=void 0!==e?e:256,this.needsInit=!0,this.adaptive=void 0===t||!!t,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,void 0===jv&&console.error("AdaptiveToneMappingPass relies on CopyShader");var n=jv;this.copyUniforms=Lu.clone(n.uniforms),this.materialCopy=new Iu({uniforms:this.copyUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,blending:0,depthTest:!1}),void 0===Bv&&console.error("AdaptiveToneMappingPass relies on LuminosityShader"),this.materialLuminance=new Iu({uniforms:Lu.clone(Bv.uniforms),vertexShader:Bv.vertexShader,fragmentShader:Bv.fragmentShader,blending:0}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","float fLastLum = max( minLuminance, lastLum.r );","float fCurrentLum = max( minLuminance, currentLum.r );","fCurrentLum *= fCurrentLum;","float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));","gl_FragColor.r = fAdaptedLum;","}"].join("\n")},this.materialAdaptiveLum=new Iu({uniforms:Lu.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:0}),void 0===zv&&console.error("AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new Iu({uniforms:Lu.clone(zv.uniforms),vertexShader:zv.vertexShader,fragmentShader:zv.fragmentShader,blending:0}),this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};Vv.prototype=Object.assign(Object.create(ev.prototype),{constructor:Vv,render:function(t,e,n,r,i){this.needsInit&&(this.reset(t),this.luminanceRT.texture.type=n.texture.type,this.previousLuminanceRT.texture.type=n.texture.type,this.currentLuminanceRT.texture.type=n.texture.type,this.needsInit=!1),this.adaptive&&(this.quad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=n.texture,t.render(this.scene,this.camera,this.currentLuminanceRT),this.quad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=r,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,t.render(this.scene,this.camera,this.luminanceRT),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,t.render(this.scene,this.camera,this.previousLuminanceRT)),this.quad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=n.texture,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},reset:function(t){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var e={minFilter:Ac,magFilter:Ac,format:Lc};this.luminanceRT=new Nu(this.resolution,this.resolution,e),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new Nu(this.resolution,this.resolution,e),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1,e.minFilter=Ec,this.currentLuminanceRT=new Nu(this.resolution,this.resolution,e),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.quad.material=new Xc({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},setAdaptive:function(t){t?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0},setAdaptionRate:function(t){t&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(t))},setMinLuminance:function(t){t&&(this.materialToneMap.uniforms.minLuminance.value=t,this.materialAdaptiveLum.uniforms.minLuminance.value=t)},setMaxLuminance:function(t){t&&(this.materialToneMap.uniforms.maxLuminance.value=t)},setAverageLuminance:function(t){t&&(this.materialToneMap.uniforms.averageLuminance.value=t)},setMiddleGrey:function(t){t&&(this.materialToneMap.uniforms.middleGrey.value=t)},dispose:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}});var Gv={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new Cs(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(t){function e(t,e){return Math.exp(-t*t/(2*e*e))}var n,r,i,o,a=2*Math.ceil(3*t)+1;for(a>25&&(a=25),o=.5*(a-1),r=new Array(a),i=0,n=0;n<a;++n)r[n]=e(n-o,t),i+=r[n];for(n=0;n<a;++n)r[n]/=i;return r}},Hv=function(t,e,n,r){ev.call(this),t=void 0!==t?t:1,e=void 0!==e?e:25,n=void 0!==n?n:4;var i={minFilter:Ac,magFilter:Ac,format:Lc};this.renderTargetX=new Nu(r=void 0!==r?r:256,r,i),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new Nu(r,r,i),this.renderTargetY.texture.name="BloomPass.y",void 0===jv&&console.error("BloomPass relies on CopyShader");var o=jv;this.copyUniforms=Lu.clone(o.uniforms),this.copyUniforms.opacity.value=t,this.materialCopy=new Iu({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:2,transparent:!0}),void 0===Gv&&console.error("BloomPass relies on ConvolutionShader");var a=Gv;this.convolutionUniforms=Lu.clone(a.uniforms),this.convolutionUniforms.uImageIncrement.value=Hv.blurX,this.convolutionUniforms.cKernel.value=Gv.buildKernel(n),this.materialConvolution=new Iu({uniforms:this.convolutionUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:{KERNEL_SIZE_FLOAT:e.toFixed(1),KERNEL_SIZE_INT:e.toFixed(0)}}),this.needsSwap=!1,this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};Hv.prototype=Object.assign(Object.create(ev.prototype),{constructor:Hv,render:function(t,e,n,r,i){i&&t.context.disable(t.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=n.texture,this.convolutionUniforms.uImageIncrement.value=Hv.blurX,t.render(this.scene,this.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=Hv.blurY,t.render(this.scene,this.camera,this.renderTargetY,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,n,this.clear)}}),Hv.blurX=new Cs(.001953125,0),Hv.blurY=new Cs(0,.001953125);var Wv=function(t,e,n){ev.call(this),this.scene=t,this.camera=e;var r=void 0!==n.focus?n.focus:1,i=void 0!==n.aspect?n.aspect:e.aspect,o=void 0!==n.aperture?n.aperture:.025,a=void 0!==n.maxblur?n.maxblur:1,s=n.width||window.innerWidth||1,c=n.height||window.innerHeight||1;this.renderTargetColor=new Nu(s,c,{minFilter:Ac,magFilter:Ac,format:Nc}),this.renderTargetColor.texture.name="BokehPass.color",this.renderTargetDepth=this.renderTargetColor.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new Au,this.materialDepth.depthPacking=3201,this.materialDepth.blending=0,void 0===Fu&&console.error("BokehPass relies on BokehShader");var u=Fu,l=Lu.clone(u.uniforms);l.tDepth.value=this.renderTargetDepth.texture,l.focus.value=r,l.aspect.value=i,l.aperture.value=o,l.maxblur.value=a,l.nearClip.value=e.near,l.farClip.value=e.far,this.materialBokeh=new Iu({defines:Object.assign({},u.defines),uniforms:l,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}),this.uniforms=l,this.needsSwap=!1,this.camera2=new Cu(-1,1,1,-1,0,1),this.scene2=new Eu,this.quad2=new Kc(new Du(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new Ts,this.oldClearAlpha=1};Wv.prototype=Object.assign(Object.create(ev.prototype),{constructor:Wv,render:function(t,e,n,r,i){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha(),t.autoClear=!1,t.setClearColor(16777215),t.setClearAlpha(1),t.render(this.scene,this.camera,this.renderTargetDepth,!0),this.uniforms.tColor.value=n.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?t.render(this.scene2,this.camera2):t.render(this.scene2,this.camera2,e,this.clear),this.scene.overrideMaterial=null,t.setClearColor(this.oldClearColor),t.setClearAlpha(this.oldClearAlpha),t.autoClear=this.oldAutoClear}});var Xv=function(t,e){ev.call(this),this.needsSwap=!1,this.clearColor=void 0!==t?t:0,this.clearAlpha=void 0!==e?e:0};Xv.prototype=Object.assign(Object.create(ev.prototype),{constructor:Xv,render:function(t,e,n,r,i){var o,a;this.clearColor&&(o=t.getClearColor().getHex(),a=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),t.setRenderTarget(this.renderToScreen?null:n),t.clear(),this.clearColor&&t.setClearColor(o,a)}});var qv=function(t,e,n){ev.call(this),this.camera=t,this.needsSwap=!1,this.cubeShader=Ih.cube,this.cubeMesh=new Kc(new iu(10,10,10),new Iu({uniforms:this.cubeShader.uniforms,vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:cc})),this.envMap=e,this.opacity=void 0!==n?n:1,this.cubeScene=new Eu,this.cubeCamera=new Mu,this.cubeScene.add(this.cubeMesh)};qv.prototype=Object.assign(Object.create(ev.prototype),{constructor:qv,render:function(t,e,n,r,i){var o=t.autoClear;t.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.envMap,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,t.render(this.cubeScene,this.cubeCamera,this.renderToScreen?null:n,this.clear),t.autoClear=o}});var Yv={uniforms:{tDiffuse:{value:null},tSize:{value:new Cs(256,256)},center:{value:new Cs(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},Zv=function(t,e,n){ev.call(this),void 0===Yv&&console.error("DotScreenPass relies on DotScreenShader");var r=Yv;this.uniforms=Lu.clone(r.uniforms),void 0!==t&&this.uniforms.center.value.copy(t),void 0!==e&&(this.uniforms.angle.value=e),void 0!==n&&(this.uniforms.scale.value=n),this.material=new Iu({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};Zv.prototype=Object.assign(Object.create(ev.prototype),{constructor:Zv,render:function(t,e,n,r,i){this.uniforms.tDiffuse.value=n.texture,this.uniforms.tSize.value.set(n.width,n.height),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var Jv=function(t,e){ev.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};Jv.prototype=Object.assign(Object.create(ev.prototype),{constructor:Jv,render:function(t,e,n,r,i){var o,a,s=t.context,c=t.state;c.buffers.color.setMask(!1),c.buffers.depth.setMask(!1),c.buffers.color.setLocked(!0),c.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),c.buffers.stencil.setTest(!0),c.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),c.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),c.buffers.stencil.setClear(a),t.render(this.scene,this.camera,n,this.clear),t.render(this.scene,this.camera,e,this.clear),c.buffers.color.setLocked(!1),c.buffers.depth.setLocked(!1),c.buffers.stencil.setFunc(s.EQUAL,1,4294967295),c.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP)}});var Qv=function(){ev.call(this),this.needsSwap=!1};Qv.prototype=Object.create(ev.prototype),Object.assign(Qv.prototype,{render:function(t,e,n,r,i){t.state.buffers.stencil.setTest(!1)}}),Object.assign((function(t,e){if(this.renderer=t,void 0===e){var n={minFilter:Ac,magFilter:Ac,format:Lc,stencilBuffer:!1},r=t.getDrawingBufferSize();(e=new Nu(r.width,r.height,n)).texture.name="EffectComposer.rt1"}this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===jv&&console.error("EffectComposer relies on CopyShader"),void 0===nv&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new nv(jv)}).prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t);var e=this.renderer.getDrawingBufferSize();t.setSize(e.width,e.height)},insertPass:function(t,e){this.passes.splice(e,0,t)},render:function(t){var e,n,r=!1,i=this.passes.length;for(n=0;n<i;n++)if(!1!==(e=this.passes[n]).enabled){if(e.render(this.renderer,this.writeBuffer,this.readBuffer,t,r),e.needsSwap){if(r){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Jv&&(e instanceof Jv?r=!0:e instanceof Qv&&(r=!1))}},reset:function(t){if(void 0===t){var e=this.renderer.getDrawingBufferSize();(t=this.renderTarget1.clone()).setSize(e.width,e.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this.renderTarget1.setSize(t,e),this.renderTarget2.setSize(t,e);for(var n=0;n<this.passes.length;n++)this.passes[n].setSize(t,e)}});var Kv={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},$v=function(t,e,n,r){ev.call(this),void 0===Kv&&console.error("FilmPass relies on FilmShader");var i=Kv;this.uniforms=Lu.clone(i.uniforms),this.material=new Iu({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),void 0!==r&&(this.uniforms.grayscale.value=r),void 0!==t&&(this.uniforms.nIntensity.value=t),void 0!==e&&(this.uniforms.sIntensity.value=e),void 0!==n&&(this.uniforms.sCount.value=n),this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};$v.prototype=Object.assign(Object.create(ev.prototype),{constructor:$v,render:function(t,e,n,r,i){this.uniforms.tDiffuse.value=n.texture,this.uniforms.time.value+=r,this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var tg={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")},eg=function(t){ev.call(this),void 0===tg&&console.error("GlitchPass relies on DigitalGlitch");var e=tg;this.uniforms=Lu.clone(e.uniforms),void 0==t&&(t=64),this.uniforms.tDisp.value=this.generateHeightmap(t),this.material=new Iu({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.goWild=!1,this.curF=0,this.generateTrigger()};eg.prototype=Object.assign(Object.create(ev.prototype),{constructor:eg,render:function(t,e,n,r,i){this.uniforms.tDiffuse.value=n.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=os.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=os.randFloat(-1,1),this.uniforms.seed_y.value=os.randFloat(-1,1),this.uniforms.distortion_x.value=os.randFloat(0,1),this.uniforms.distortion_y.value=os.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=os.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=os.randFloat(0,1),this.uniforms.distortion_y.value=os.randFloat(0,1),this.uniforms.seed_x.value=os.randFloat(-.3,.3),this.uniforms.seed_y.value=os.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},generateTrigger:function(){this.randX=os.randInt(120,240)},generateHeightmap:function(t){for(var e=new Float32Array(t*t*3),n=t*t,r=0;r<n;r++){var i=os.randFloat(0,1);e[3*r+0]=i,e[3*r+1]=i,e[3*r+2]=i}var o=new Yh(e,t,t,Nc,1015);return o.needsUpdate=!0,o}});var ng=function(t,e,n,r){this.renderScene=e,this.renderCamera=n,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new Ts(1,1,1),this.hiddenEdgeColor=new Ts(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,ev.call(this),this.resolution=void 0!==t?new Cs(t.x,t.y):new Cs(256,256);var i={minFilter:Ac,magFilter:Ac,format:Lc},o=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new Xc({color:16777215}),this.maskBufferMaterial.side=uc,this.renderTargetMaskBuffer=new Nu(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Au,this.depthMaterial.side=uc,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=uc,this.prepareMaskMaterial.fragmentShader=function(t,e){return t.replace(/DEPTH_TO_VIEW_Z/g,(e.isPerspectiveCamera?"perspective":"orthographic")+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new Nu(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new Nu(o,a,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new Nu(o,a,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new Nu(Math.round(o/2),Math.round(a/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new Nu(o,a,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new Nu(Math.round(o/2),Math.round(a/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Cs(o,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Cs(Math.round(o/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===jv&&console.error("OutlinePass relies on CopyShader");var s=jv;this.copyUniforms=Lu.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Iu({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Ts,this.oldClearAlpha=1,this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new Ts,this.tempPulseColor2=new Ts,this.textureMatrix=new as};ng.prototype=Object.assign(Object.create(ev.prototype),{constructor:ng,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,e){this.renderTargetMaskBuffer.setSize(t,e);var n=Math.round(t/this.downSampleRatio),r=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,r),this.renderTargetBlurBuffer1.setSize(n,r),this.renderTargetEdgeBuffer1.setSize(n,r),this.separableBlurMaterial1.uniforms.texSize.value=new Cs(n,r),n=Math.round(n/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(n,r),this.renderTargetEdgeBuffer2.setSize(n,r),this.separableBlurMaterial2.uniforms.texSize.value=new Cs(n,r)},changeVisibilityOfSelectedObjects:function(t){function e(e){e instanceof Kc&&(e.visible=t)}for(var n=0;n<this.selectedObjects.length;n++)this.selectedObjects[n].traverse(e)},changeVisibilityOfNonSelectedObjects:function(t){var e=[];function n(t){t instanceof Kc&&e.push(t)}for(var r=0;r<this.selectedObjects.length;r++)this.selectedObjects[r].traverse(n);this.renderScene.traverse(function(n){if(n instanceof Kc||n instanceof $c||n instanceof fm){for(var r=!1,i=0;i<e.length;i++)if(e[i].id===n.id){r=!0;break}if(!r){var o=n.visible;t&&!n.bVisible||(n.visible=t),n.bVisible=o}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,e,n,r,i){if(0!==this.selectedObjects.length){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,i&&t.context.disable(t.context.STENCIL_TEST),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.render(this.renderScene,this.renderCamera,this.renderTargetDepthBuffer,!0),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new Cs(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.render(this.renderScene,this.renderCamera,this.renderTargetMaskBuffer,!0),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=a,this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,!0),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Cs(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ng.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.render(this.scene,this.camera,this.renderTargetBlurBuffer1,!0),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ng.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=ng.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetBlurBuffer2,!0),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=ng.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,!0),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,n,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}},getPrepareMaskMaterial:function(){return new Iu({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Cs(.5,.5)},textureMatrix:{value:new as}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new Iu({uniforms:{maskTexture:{value:null},texSize:{value:new Cs(.5,.5)},visibleEdgeColor:{value:new ss(1,1,1)},hiddenEdgeColor:{value:new ss(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new Iu({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new Cs(.5,.5)},direction:{value:new Cs(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\t\t\t\t}"})},getOverlayMaterial:function(){return new Iu({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:2,depthTest:!1,depthWrite:!1,transparent:!0})}}),ng.BlurDirectionX=new Cs(1,0),ng.BlurDirectionY=new Cs(0,1);var rg=function(t,e,n,r,i){ev.call(this),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};function ig(t,e,n,r,i,o,a,s,c,u){if((u=void 0!==u?u:Rc)!==Rc&&u!==Dc)throw new Error("DepthTexture format must be either DepthFormat or DepthStencilFormat");void 0===n&&u===Rc&&(n=Pc),void 0===n&&u===Dc&&(n=Oc),Ou.call(this,null,r,i,o,a,s,u,n,c),this.image={width:t,height:e},this.magFilter=void 0!==a?a:Mc,this.minFilter=void 0!==s?s:Mc,this.flipY=!1,this.generateMipmaps=!1}rg.prototype=Object.assign(Object.create(ev.prototype),{constructor:rg,render:function(t,e,n,r,i){var o,a,s=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(o=t.getClearColor().getHex(),a=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.render(this.scene,this.camera,this.renderToScreen?null:n,this.clear),this.clearColor&&t.setClearColor(o,a),this.scene.overrideMaterial=null,t.autoClear=s}}),(ig.prototype=Object.create(Ou.prototype)).constructor=ig,ig.prototype.isDepthTexture=!0;var og={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},size:{type:"v2",value:new Cs(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},cameraProjectionMatrix:{type:"m4",value:new as},cameraInverseProjectionMatrix:{type:"m4",value:new as},scale:{type:"f",value:1},intensity:{type:"f",value:.1},bias:{type:"f",value:.5},minResolution:{type:"f",value:0},kernelRadius:{type:"f",value:100},randomSeed:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},ag={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new Cs(512,512)},sampleUvOffsets:{type:"v2v",value:[new Cs(0,0)]},sampleWeights:{type:"1fv",value:[1]},tDepth:{type:"t",value:null},cameraNear:{type:"f",value:10},cameraFar:{type:"f",value:1e3},depthCutoff:{type:"f",value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},sg={createSampleWeights:function(t,e){for(var n=function(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)},r=[],i=0;i<=t;i++)r.push(n(i,e));return r},createSampleOffsets:function(t,e){for(var n=[],r=0;r<=t;r++)n.push(e.clone().multiplyScalar(r));return n},configure:function(t,e,n,r){t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=sg.createSampleOffsets(e,r),t.uniforms.sampleWeights.value=sg.createSampleWeights(e,n),t.needsUpdate=!0}},cg={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},ug=function(t,e,n,r,i){ev.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==n&&n,this.supportsNormalTexture=void 0!==r&&r,this.oldClearColor=new Ts,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==i?new Cs(i.x,i.y):new Cs(256,256),this.saoRenderTarget=new Nu(this.resolution.x,this.resolution.y,{minFilter:Ac,magFilter:Ac,format:Lc}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new Nu(this.resolution.x,this.resolution.y,{minFilter:Mc,magFilter:Mc,format:Lc}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension&&((n=new ig).type=Pc,n.minFilter=Mc,n.maxFilter=Mc,this.beautyRenderTarget.depthTexture=n,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new Au,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.normalMaterial=new Ju,this.normalMaterial.blending=0,void 0===og&&console.error("SAOPass relies on SAOShader"),this.saoMaterial=new Iu({defines:Object.assign({},og.defines),fragmentShader:og.fragmentShader,vertexShader:og.vertexShader,uniforms:Lu.clone(og.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=0,void 0===ag&&console.error("SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new Iu({uniforms:Lu.clone(ag.uniforms),defines:Object.assign({},ag.defines),vertexShader:ag.vertexShader,fragmentShader:ag.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=0,this.hBlurMaterial=new Iu({uniforms:Lu.clone(ag.uniforms),defines:Object.assign({},ag.defines),vertexShader:ag.vertexShader,fragmentShader:ag.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=0,void 0===jv&&console.error("SAOPass relies on CopyShader"),this.materialCopy=new Iu({uniforms:Lu.clone(jv.uniforms),vertexShader:jv.vertexShader,fragmentShader:jv.fragmentShader,blending:0}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=5,this.materialCopy.blendSrc=208,this.materialCopy.blendDst=200,this.materialCopy.blendEquation=fc,this.materialCopy.blendSrcAlpha=206,this.materialCopy.blendDstAlpha=200,this.materialCopy.blendEquationAlpha=fc,void 0===jv&&console.error("SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new Iu({uniforms:Lu.clone(cg.uniforms),vertexShader:cg.vertexShader,fragmentShader:cg.fragmentShader,blending:0}),this.quadCamera=new Cu(-1,1,1,-1,0,1),this.quadScene=new Eu,this.quad=new Kc(new Ru(2,2),null),this.quadScene.add(this.quad)};ug.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},ug.prototype=Object.assign(Object.create(ev.prototype),{constructor:ug,render:function(t,e,n,r,i){if(this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=n.texture,this.materialCopy.needsUpdate=!0,this.renderPass(t,this.materialCopy,null)),1!==this.params.output){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.clearTarget(this.depthRenderTarget),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var a=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=a,this.hBlurMaterial.uniforms.depthCutoff.value=a,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(sg.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Cs(0,1)),sg.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Cs(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),t.setClearColor(0),t.render(this.scene,this.camera,this.beautyRenderTarget,!0),this.supportsDepthTextureExtension||this.renderOverride(t,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(t,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(t,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(t,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var s=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,s=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),s.blending=0===this.params.output?5:0,this.renderPass(t,s,this.renderToScreen?null:n),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}},renderPass:function(t,e,n,r,i){var o=t.getClearColor(),a=t.getClearAlpha(),s=t.autoClear;t.autoClear=!1;var c=void 0!==r&&null!==r;c&&(t.setClearColor(r),t.setClearAlpha(i||0)),this.quad.material=e,t.render(this.quadScene,this.quadCamera,n,c),t.autoClear=s,t.setClearColor(o),t.setClearAlpha(a)},renderOverride:function(t,e,n,r,i){var o=t.getClearColor(),a=t.getClearAlpha(),s=t.autoClear;t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i;var c=void 0!==r&&null!==r;c&&(t.setClearColor(r),t.setClearAlpha(i||0)),this.scene.overrideMaterial=e,t.render(this.scene,this.camera,n,c),this.scene.overrideMaterial=null,t.autoClear=s,t.setClearColor(o),t.setClearAlpha(a)},setSize:function(t,e){this.beautyRenderTarget.setSize(t,e),this.saoRenderTarget.setSize(t,e),this.blurIntermediateRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.depthRenderTarget.setSize(t,e),this.saoMaterial.uniforms.size.value.set(t,e),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(t,e),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(t,e),this.hBlurMaterial.needsUpdate=!0}});var lg=function(t){ev.call(this),void 0===jv&&console.error("SavePass relies on CopyShader");var e=jv;this.textureID="tDiffuse",this.uniforms=Lu.clone(e.uniforms),this.material=new Iu({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderTarget=t,void 0===this.renderTarget&&(this.renderTarget=new Nu(window.innerWidth,window.innerHeight,{minFilter:Ac,magFilter:Ac,format:Nc,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};lg.prototype=Object.assign(Object.create(ev.prototype),{constructor:lg,render:function(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.quad.material=this.material,t.render(this.scene,this.camera,this.renderTarget,this.clear)}});var hg=[{defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Cs(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","vUv = uv;","SMAAEdgeDetectionVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","vec4 delta;","vec3 C = texture2D( colorTex, texcoord ).rgb;","vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","vec3 t = abs( C - Cleft );","delta.x = max( max( t.r, t.g ), t.b );","vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","t = abs( C - Ctop );","delta.y = max( max( t.r, t.g ), t.b );","vec2 edges = step( threshold, delta.xy );","if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","discard;","vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","t = abs( C - Cright );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","t = abs( C - Cbottom );","delta.w = max( max( t.r, t.g ), t.b );","float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","t = abs( C - Cleftleft );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","t = abs( C - Ctoptop );","delta.w = max( max( t.r, t.g ), t.b );","maxDelta = max( max( maxDelta, delta.z ), delta.w );","edges.xy *= step( 0.5 * maxDelta, delta.xy );","return vec4( edges, 0.0, 0.0 );","}","void main() {","gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},{defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Cs(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","vPixcoord = texcoord / resolution;","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","vUv = uv;","SMAABlendingWeightCalculationVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","vec2 round( vec2 x ) {","return sign( x ) * floor( abs( x ) + 0.5 );","}","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","e.r = bias + e.r * scale;","return 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x += 0.25 * resolution.x;","texcoord.x += resolution.x;","texcoord.x += 2.0 * resolution.x;","texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","return texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x -= 0.25 * resolution.x;","texcoord.x -= resolution.x;","texcoord.x -= 2.0 * resolution.x;","texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","return texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y -= 0.25 * resolution.y;","texcoord.y -= resolution.y;","texcoord.y -= 2.0 * resolution.y;","texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","return texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y += 0.25 * resolution.y;","texcoord.y += resolution.y;","texcoord.y += 2.0 * resolution.y;","texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","return texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","return texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","vec2 e = texture2D( edgesTex, texcoord ).rg;","if ( e.g > 0.0 ) {","vec2 d;","vec2 coords;","coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","coords.y = offset[ 1 ].y;","d.x = coords.x;","float e1 = texture2D( edgesTex, coords, 0.0 ).r;","coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","d.y = coords.x;","d = d / resolution.x - pixcoord.x;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","}","if ( e.r > 0.0 ) {","vec2 d;","vec2 coords;","coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","coords.x = offset[ 0 ].x;","d.x = coords.y;","float e1 = texture2D( edgesTex, coords, 0.0 ).g;","coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","d.y = coords.y;","d = d / resolution.y - pixcoord.y;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","}","return weights;","}","void main() {","gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},{uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Cs(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","vUv = uv;","SMAANeighborhoodBlendingVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","vec4 a;","a.xz = texture2D( blendTex, texcoord ).xz;","a.y = texture2D( blendTex, offset[ 1 ].zw ).g;","a.w = texture2D( blendTex, offset[ 1 ].xy ).a;","if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","return texture2D( colorTex, texcoord, 0.0 );","} else {","vec2 offset;","offset.x = a.a > a.b ? a.a : -a.b;","offset.y = a.g > a.r ? -a.g : a.r;","if ( abs( offset.x ) > abs( offset.y )) {","offset.y = 0.0;","} else {","offset.x = 0.0;","}","vec4 C = texture2D( colorTex, texcoord, 0.0 );","texcoord += sign( offset ) * resolution;","vec4 Cop = texture2D( colorTex, texcoord, 0.0 );","float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","C.xyz = pow(C.xyz, vec3(2.2));","Cop.xyz = pow(Cop.xyz, vec3(2.2));","vec4 mixed = mix(C, Cop, s);","mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","return mixed;","}","}","void main() {","gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")}],dg=function(t,e){ev.call(this),this.edgesRT=new Nu(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:Ac,format:Nc}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new Nu(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:Ac,format:Lc}),this.weightsRT.texture.name="SMAAPass.weights";var n=new Image;n.src=this.getAreaTexture(),this.areaTexture=new Ou,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=n,this.areaTexture.format=Nc,this.areaTexture.minFilter=Ac,this.areaTexture.generateMipmaps=!1,this.areaTexture.needsUpdate=!0,this.areaTexture.flipY=!1;var r=new Image;r.src=this.getSearchTexture(),this.searchTexture=new Ou,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=r,this.searchTexture.magFilter=Mc,this.searchTexture.minFilter=Mc,this.searchTexture.generateMipmaps=!1,this.searchTexture.needsUpdate=!0,this.searchTexture.flipY=!1,void 0===hg&&console.error("SMAAPass relies on SMAAShader"),this.uniformsEdges=Lu.clone(hg[0].uniforms),this.uniformsEdges.resolution.value.set(1/t,1/e),this.materialEdges=new Iu({defines:Object.assign({},hg[0].defines),uniforms:this.uniformsEdges,vertexShader:hg[0].vertexShader,fragmentShader:hg[0].fragmentShader}),this.uniformsWeights=Lu.clone(hg[1].uniforms),this.uniformsWeights.resolution.value.set(1/t,1/e),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new Iu({defines:Object.assign({},hg[1].defines),uniforms:this.uniformsWeights,vertexShader:hg[1].vertexShader,fragmentShader:hg[1].fragmentShader}),this.uniformsBlend=Lu.clone(hg[2].uniforms),this.uniformsBlend.resolution.value.set(1/t,1/e),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new Iu({uniforms:this.uniformsBlend,vertexShader:hg[2].vertexShader,fragmentShader:hg[2].fragmentShader}),this.needsSwap=!1,this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};dg.prototype=Object.assign(Object.create(ev.prototype),{constructor:dg,render:function(t,e,n,r,i){this.uniformsEdges.tDiffuse.value=n.texture,this.quad.material=this.materialEdges,t.render(this.scene,this.camera,this.edgesRT,this.clear),this.quad.material=this.materialWeights,t.render(this.scene,this.camera,this.weightsRT,this.clear),this.uniformsBlend.tColor.value=n.texture,this.quad.material=this.materialBlend,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},setSize:function(t,e){this.edgesRT.setSize(t,e),this.weightsRT.setSize(t,e),this.materialEdges.uniforms.resolution.value.set(1/t,1/e),this.materialWeights.uniforms.resolution.value.set(1/t,1/e),this.materialBlend.uniforms.resolution.value.set(1/t,1/e)},getAreaTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var pg=function(t,e,n,r){ev.call(this),this.scene=t,this.camera=e,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==n?n:0,this.clearAlpha=void 0!==r?r:0,void 0===jv&&console.error("SSAARenderPass relies on CopyShader");var i=jv;this.copyUniforms=Lu.clone(i.uniforms),this.copyMaterial=new Iu({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.camera2=new Cu(-1,1,1,-1,0,1),this.scene2=new Eu,this.quad2=new Kc(new Ru(2,2),this.copyMaterial),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2)};pg.prototype=Object.assign(Object.create(ev.prototype),{constructor:pg,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(t,e){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(t,e)},render:function(t,e,n){this.sampleRenderTarget||(this.sampleRenderTarget=new Nu(n.width,n.height,{minFilter:Ac,magFilter:Ac,format:Lc}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var r=pg.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=t.autoClear;t.autoClear=!1;var o=t.getClearColor().getHex(),a=t.getClearAlpha(),s=1/r.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var c=n.width,u=n.height,l=0;l<r.length;l++){var h=r[l];this.camera.setViewOffset&&this.camera.setViewOffset(c,u,.0625*h[0],.0625*h[1],c,u);var d=s;this.unbiased&&(d+=1/32*((l+.5)/r.length-.5)),this.copyUniforms.opacity.value=d,t.setClearColor(this.clearColor,this.clearAlpha),t.render(this.scene,this.camera,this.sampleRenderTarget,!0),0===l&&t.setClearColor(0,0),t.render(this.scene2,this.camera2,this.renderToScreen?null:e,0===l)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),t.autoClear=i,t.setClearColor(o,a)}}),pg.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var fg={uniforms:{tDiffuse:{value:null},tDepth:{value:null},size:{value:new Cs(512,512)},cameraNear:{value:1},cameraFar:{value:100},radius:{value:32},onlyAO:{value:0},aoClamp:{value:.25},lumInfluence:{value:.7}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","#ifdef USE_LOGDEPTHBUF","uniform float logDepthBufFC;","#endif","uniform float radius;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","const int samples = 64;","const bool useNoise = true;","const float noiseAmount = 0.0004;","const float diffArea = 0.4;","const float gDisplace = 0.4;","#include <packing>","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );","float gg = fract( coord.t * ( size.y / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float readDepth( const in vec2 coord ) {","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","#ifdef USE_LOGDEPTHBUF","float logz = unpackRGBAToDepth( texture2D( tDepth, coord ) );","float w = pow(2.0, (logz / logDepthBufFC)) - 1.0;","float z = (logz / w) + 1.0;","#else","float z = unpackRGBAToDepth( texture2D( tDepth, coord ) );","#endif","return cameraCoef / ( cameraFarPlusNear - z * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 8.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * ( dd * dd ) / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + radius * vv;","vec2 coord2 = vUv - radius * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / size.x ) / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float ao = 0.0;","float dz = 1.0 / float( samples );","float l = 0.0;","float z = 1.0 - dz / 2.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","float pw = cos( l ) * r;","float ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},mg=function(t,e,n,r){if(void 0===fg)return console.warn("SSAOPass depends on SSAOShader"),new nv;nv.call(this,fg),this.width=void 0!==n?n:512,this.height=void 0!==r?r:256,this.renderToScreen=!1,this.camera2=e,this.scene2=t,this.depthMaterial=new Au,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.depthRenderTarget=new Nu(this.width,this.height,{minFilter:Ac,magFilter:Ac}),this.uniforms.tDepth.value=this.depthRenderTarget.texture,this.uniforms.size.value.set(this.width,this.height),this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far,this.uniforms.radius.value=4,this.uniforms.onlyAO.value=!1,this.uniforms.aoClamp.value=.25,this.uniforms.lumInfluence.value=.7,Object.defineProperties(this,{radius:{get:function(){return this.uniforms.radius.value},set:function(t){this.uniforms.radius.value=t}},onlyAO:{get:function(){return this.uniforms.onlyAO.value},set:function(t){this.uniforms.onlyAO.value=t}},aoClamp:{get:function(){return this.uniforms.aoClamp.value},set:function(t){this.uniforms.aoClamp.value=t}},lumInfluence:{get:function(){return this.uniforms.lumInfluence.value},set:function(t){this.uniforms.lumInfluence.value=t}}})};(mg.prototype=Object.create(nv.prototype)).render=function(t,e,n,r,i){this.scene2.overrideMaterial=this.depthMaterial,t.render(this.scene2,this.camera2,this.depthRenderTarget,!0),this.scene2.overrideMaterial=null,nv.prototype.render.call(this,t,e,n,r,i)},mg.prototype.setScene=function(t){this.scene2=t},mg.prototype.setCamera=function(t){this.camera2=t,this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far},mg.prototype.setSize=function(t,e){this.width=t,this.height=e,this.uniforms.size.value.set(this.width,this.height),this.depthRenderTarget.setSize(this.width,this.height)};var vg=function(t,e,n){void 0===pg&&console.error("TAARenderPass relies on SSAARenderPass"),pg.call(this,t,e,n),this.sampleLevel=0,this.accumulate=!1};vg.JitterVectors=pg.JitterVectors,vg.prototype=Object.assign(Object.create(pg.prototype),{constructor:vg,render:function(t,e,n,r){if(!this.accumulate)return pg.prototype.render.call(this,t,e,n,r),void(this.accumulateIndex=-1);var i=vg.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new Nu(n.width,n.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new Nu(n.width,n.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(pg.prototype.render.call(this,t,this.holdRenderTarget,n,r),this.accumulateIndex=0);var o=t.autoClear;t.autoClear=!1;var a=1/i.length;if(this.accumulateIndex>=0&&this.accumulateIndex<i.length){this.copyUniforms.opacity.value=a,this.copyUniforms.tDiffuse.value=e.texture;for(var s=Math.pow(2,this.sampleLevel),c=0;c<s;c++){var u=i[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(n.width,n.height,.0625*u[0],.0625*u[1],n.width,n.height),t.render(this.scene,this.camera,e,!0),t.render(this.scene2,this.camera2,this.sampleRenderTarget,0===this.accumulateIndex),this.accumulateIndex++,this.accumulateIndex>=i.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var l=this.accumulateIndex*a;l>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,t.render(this.scene2,this.camera2,e,!0)),l<1&&(this.copyUniforms.opacity.value=1-l,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,t.render(this.scene2,this.camera2,e,0===l)),t.autoClear=o}});var gg=function(t,e){ev.call(this),void 0===jv&&console.error("TexturePass relies on CopyShader");var n=jv;this.map=t,this.opacity=void 0!==e?e:1,this.uniforms=Lu.clone(n.uniforms),this.material=new Iu({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};gg.prototype=Object.assign(Object.create(ev.prototype),{constructor:gg,render:function(t,e,n,r,i){var o=t.autoClear;t.autoClear=!1,this.quad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,t.render(this.scene,this.camera,this.renderToScreen?null:n,this.clear),t.autoClear=o}});var yg,bg,xg={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new Ts(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},wg=function(t,e,n,r){ev.call(this),this.strength=void 0!==e?e:1,this.radius=n,this.threshold=r,this.resolution=void 0!==t?new Cs(t.x,t.y):new Cs(256,256);var i={minFilter:Ac,magFilter:Ac,format:Lc};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new Nu(o,a,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var c;(c=new Nu(o,a,i)).texture.name="UnrealBloomPass.h"+s,c.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(c),(c=new Nu(o,a,i)).texture.name="UnrealBloomPass.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),o=Math.round(o/2),a=Math.round(a/2)}void 0===xg&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var u=xg;this.highPassUniforms=Lu.clone(u.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Iu({uniforms:this.highPassUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var l=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new Cs(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new ss(1,1,1),new ss(1,1,1),new ss(1,1,1),new ss(1,1,1),new ss(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===jv&&console.error("BloomPass relies on CopyShader");var h=jv;this.copyUniforms=Lu.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Iu({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Ts,this.oldClearAlpha=1,this.camera=new Cu(-1,1,1,-1,0,1),this.scene=new Eu,this.basic=new Xc,this.quad=new Kc(new Du(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};function _g(t,e,n,r,i,o){this.planes=[void 0!==t?t:new Jc,void 0!==e?e:new Jc,void 0!==n?n:new Jc,void 0!==r?r:new Jc,void 0!==i?i:new Jc,void 0!==o?o:new Jc]}wg.prototype=Object.assign(Object.create(ev.prototype),{constructor:wg,dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,e){var n=Math.round(t/2),r=Math.round(e/2);this.renderTargetBright.setSize(n,r);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new Cs(n,r),n=Math.round(n/2),r=Math.round(r/2)},render:function(t,e,n,r,i){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.setClearColor(new Ts(0,0,0),0),i&&t.context.disable(t.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=n.texture,t.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,t.render(this.scene,this.camera,this.renderTargetBright,!0);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=wg.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetsHorizontal[s],!0),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=wg.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetsVertical[s],!0),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,this.renderToScreen?void 0:n,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o},getSeperableBlurMaterial:function(t){return new Iu({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new Cs(.5,.5)},direction:{value:new Cs(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(t){return new Iu({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),wg.BlurDirectionX=new Cs(1,0),wg.BlurDirectionY=new Cs(0,1),Object.assign(_g.prototype,{set:function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromMatrix:function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return e[0].setComponents(a-r,l-s,f-h,y-m).normalize(),e[1].setComponents(a+r,l+s,f+h,y+m).normalize(),e[2].setComponents(a+i,l+c,f+d,y+v).normalize(),e[3].setComponents(a-i,l-c,f-d,y-v).normalize(),e[4].setComponents(a-o,l-u,f-p,y-g).normalize(),e[5].setComponents(a+o,l+u,f+p,y+g).normalize(),this},intersectsObject:function(){var t=new Es;return function(e){var n=e.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),t.copy(n.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new Es;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(n)<r)return!1;return!0},intersectsBox:(yg=new ss,bg=new ss,function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];yg.x=r.normal.x>0?t.min.x:t.max.x,bg.x=r.normal.x>0?t.max.x:t.min.x,yg.y=r.normal.y>0?t.min.y:t.max.y,bg.y=r.normal.y>0?t.max.y:t.min.y,yg.z=r.normal.z>0?t.min.z:t.max.z,bg.z=r.normal.z>0?t.max.z:t.min.z;var i=r.distanceToPoint(yg),o=r.distanceToPoint(bg);if(i<0&&o<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});var Sg=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},Tg=function(){this.id=0,this.v1=new Mg,this.v2=new Mg,this.v3=new Mg,this.normalModel=new ss,this.vertexNormalsModel=[new ss,new ss,new ss],this.vertexNormalsLength=0,this.color=new Ts,this.material=null,this.uvs=[new Cs,new Cs,new Cs],this.z=0,this.renderOrder=0},Mg=function(){this.position=new ss,this.positionWorld=new ss,this.positionScreen=new Is,this.visible=!0};Mg.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)};var Ag=function(){this.id=0,this.v1=new Mg,this.v2=new Mg,this.vertexColors=[new Ts,new Ts],this.material=null,this.z=0,this.renderOrder=0},Eg=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Cs,this.material=null,this.renderOrder=0},Cg=function(t){Wc.call(this),this.type="SpriteCanvasMaterial",this.color=new Ts(16777215),this.program=function(){},this.setValues(t)};(Cg.prototype=Object.create(Wc.prototype)).constructor=Cg,Cg.prototype.isSpriteCanvasMaterial=!0,Cg.prototype.clone=function(){var t=new Cg;return t.copy(this),t.color.copy(this.color),t.program=this.program,t};var Pg=function(t){ys.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",function(t){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};(Pg.prototype=Object.create(ys.prototype)).constructor=Pg;var Og=function(t){ys.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};(Og.prototype=Object.create(ys.prototype)).constructor=Og;var Ng=function(t){Og.call(this,t)};(Ng.prototype=Object.create(Og.prototype)).constructor=Ng,Object.assign((function(t){console.log("RaytracingRenderer","91"),t=t||{};var e,n,r=this,i=[],o=!1,a=document.createElement("canvas"),s=a.getContext("2d",{alpha:!0===t.alpha}),c=new Ts(0);this.domElement=a,this.autoClear=!0;var u=t.workers,l=t.blockSize||64;this.randomize=t.randomize;var h,d,p,f=[],m=0,v=0;function g(t){t.postMessage({init:[e,n],worker:t.id,blockSize:l})}function y(t){if(!f.length)return o=!1,r.dispatchEvent({type:"complete"});var e=f.pop(),n=e%d*l,i=(e/d|0)*l;t.postMessage({render:!0,x:n,y:i,sceneId:v}),s.fillStyle="#"+t.color,s.fillRect(n,i,l,l)}console.log("%cSpinning off "+u+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(e){for(u=e||navigator.hardwareConcurrency||4;i.length<u;){var n=new Worker(t.workerPath);n.id=m++,n.onmessage=function(t){var e=t.data;if(e&&e.blockSize&&v==e.sceneId){var n=new ImageData(new Uint8ClampedArray(e.data),e.blockSize,e.blockSize);if(s.putImageData(n,e.blockX,e.blockY),console.log("Worker "+this.id,e.time/1e3,(Date.now()-w)/1e3+" s"),i.length>u)return i.splice(i.indexOf(this),1),this.terminate();y(this)}},n.color=(new Ts).setHSL(Math.random(),.8,.8).getHexString(),i.push(n),g(n),o&&(n.postMessage({scene:b,camera:x,annex:_,sceneId:v}),y(n))}if(!o)for(;i.length>u;)i.pop().terminate()},this.setWorkers(u),this.setClearColor=function(t,e){c.set(t)},this.setPixelRatio=function(){},this.setSize=function(t,r){a.width=t,a.height=r,e=a.width,n=a.height,s.fillStyle="white",i.forEach(g)},this.setSize(a.width,a.height),this.clear=function(){};var b,x,w,_={},S={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function T(t){var e=t.material;if(e&&!(e.uuid in _)){var n={};for(var r in S)void 0!==e[r]&&(n[r]=e[r]);_[e.uuid]=n}}this.render=function(t,a){o=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===a.parent&&a.updateMatrixWorld(),b=t.toJSON(),x=a.toJSON(),++v,t.traverse(T),i.forEach(function(t){t.postMessage({scene:b,camera:x,annex:_,sceneId:v})}),s.clearRect(0,0,e,n),w=Date.now(),d=Math.ceil(e/l),p=Math.ceil(n/l),h=d*p,f=[];for(var c=0;c<h;c++)f.push(c);if(r.randomize)for(c=0;c<h;c++){var u=Math.random()*h|0,m=f[u];f[u]=f[c],f[c]=m}i.forEach(y)}}).prototype,us.prototype);var Lg=function(t){console.log("SoftwareRenderer","91");var e,n,r,i,o,a,s,c,u,l,h,d,p,f,m,v,g=void 0!==(t=t||{}).canvas?t.canvas:document.createElement("canvas"),y=g.getContext("2d",{alpha:!0===t.alpha}),b=t.alpha,x={},w={},_=new Ts(0),S=1,T=2,M=4,A=(1<<M)-1,E=3,C=1<<E,P=1<<24,O=!1,N=new ss(0,0,1),L=new ss,I=1/0,R=1/0,D=0,F=0,U=1/0,k=1/0,j=0,B=0,z=new function(){var t,e,n,r,i,o,a,s,c,u,l,h=[],d=0,p=[],f=0,m=[],v=0,g=[],y=0,b=[],x=0,w={objects:[],lights:[],elements:[]},_=new ss,S=new Is,T=new As(new ss(-1,-1,-1),new ss(1,1,1)),M=new As,A=new Array(3),E=new as,C=new as,P=new as,O=new ds,N=new _g,L=new Is,I=new Is;this.projectVector=function(t,e){console.warn("Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("Projector: .pickingRay() is now raycaster.setFromCamera().")};var R=new function(){var t=[],e=[],r=[],o=null,s=null,c=new ds;function u(t){var e=t.positionWorld,n=t.positionScreen;e.copy(t.position).applyMatrix4(l),n.copy(e).applyMatrix4(C);var r=1/n.w;n.x*=r,n.y*=r,n.z*=r,t.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1}function h(t,e,n){return!0===t.visible||!0===e.visible||!0===n.visible||(A[0]=t.positionScreen,A[1]=e.positionScreen,A[2]=n.positionScreen,T.intersectsBox(M.setFromPoints(A)))}function d(t,e,n){return(n.positionScreen.x-t.positionScreen.x)*(e.positionScreen.y-t.positionScreen.y)-(n.positionScreen.y-t.positionScreen.y)*(e.positionScreen.x-t.positionScreen.x)<0}return{setObject:function(n){s=(o=n).material,c.getNormalMatrix(o.matrixWorld),t.length=0,e.length=0,r.length=0},projectVertex:u,checkTriangleVisibility:h,checkBackfaceCulling:d,pushVertex:function(t,e,r){(n=U()).position.set(t,e,r),u(n)},pushNormal:function(e,n,r){t.push(e,n,r)},pushColor:function(t,n,r){e.push(t,n,r)},pushUv:function(t,e){r.push(t,e)},pushLine:function(t,n){var r=p[t],i=p[n];r.positionScreen.copy(r.position).applyMatrix4(P),i.positionScreen.copy(i.position).applyMatrix4(P),!0===z(r.positionScreen,i.positionScreen)&&(r.positionScreen.multiplyScalar(1/r.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(a=j()).id=o.id,a.v1.copy(r),a.v2.copy(i),a.z=Math.max(r.positionScreen.z,i.positionScreen.z),a.renderOrder=o.renderOrder,a.material=o.material,o.material.vertexColors===dc&&(a.vertexColors[0].fromArray(e,3*t),a.vertexColors[1].fromArray(e,3*n)),w.elements.push(a))},pushTriangle:function(e,n,a){var u=arguments,l=p[e],f=p[n],m=p[a];if(!1!==h(l,f,m)&&(s.side===uc||!0===d(l,f,m))){(i=k()).id=o.id,i.v1.copy(l),i.v2.copy(f),i.v3.copy(m),i.z=(l.positionScreen.z+f.positionScreen.z+m.positionScreen.z)/3,i.renderOrder=o.renderOrder,i.normalModel.fromArray(t,3*e),i.normalModel.applyMatrix3(c).normalize();for(var v=0;v<3;v++){var g=i.vertexNormalsModel[v];g.fromArray(t,3*u[v]),g.applyMatrix3(c).normalize(),i.uvs[v].fromArray(r,2*u[v])}i.vertexNormalsLength=3,i.material=o.material,w.elements.push(i)}}}};function D(n){(t=function(){if(e===d){var t=new Sg;return h.push(t),d++,e++,t}return h[e++]}()).id=n.id,t.object=n,_.setFromMatrixPosition(n.matrixWorld),_.applyMatrix4(C),t.z=_.z,t.renderOrder=n.renderOrder,w.objects.push(t)}function F(t,e,n){var r=1/t.w;t.z*=r,t.z>=-1&&t.z<=1&&((c=function(){if(u===x){var t=new Eg;return b.push(t),x++,u++,t}return b[u++]}()).id=e.id,c.x=t.x*r,c.y=t.y*r,c.z=t.z,c.renderOrder=e.renderOrder,c.object=e,c.rotation=e.rotation,c.scale.x=e.scale.x*Math.abs(c.x-(t.x+n.projectionMatrix.elements[0])/(t.w+n.projectionMatrix.elements[12])),c.scale.y=e.scale.y*Math.abs(c.y-(t.y+n.projectionMatrix.elements[5])/(t.w+n.projectionMatrix.elements[13])),c.material=e.material,w.elements.push(c))}function U(){if(r===f){var t=new Mg;return p.push(t),f++,r++,t}return p[r++]}function k(){if(o===v){var t=new Tg;return m.push(t),v++,o++,t}return m[o++]}function j(){if(s===y){var t=new Ag;return g.push(t),y++,s++,t}return g[s++]}function B(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id!==e.id?t.id-e.id:0}function z(t,e){var n=0,r=1,i=t.z+t.w,o=e.z+e.w,a=-t.z+t.w,s=-e.z+e.w;return i>=0&&o>=0&&a>=0&&s>=0||!(i<0&&o<0||a<0&&s<0)&&(i<0?n=Math.max(n,i/(i-o)):o<0&&(r=Math.min(r,i/(i-o))),a<0?n=Math.max(n,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<n||(t.lerp(e,n),e.lerp(t,1-r),0)))}this.projectScene=function(t,n,c,h){o=0,s=0,u=0,w.elements.length=0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),E.copy(n.matrixWorldInverse),C.multiplyMatrices(n.projectionMatrix,E),N.setFromMatrix(C),e=0,w.objects.length=0,w.lights.length=0,function t(e){if(!1!==e.visible){if(e instanceof Pd)w.lights.push(e);else if(e instanceof Kc||e instanceof $c||e instanceof Zh){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===N.intersectsObject(e))return;D(e)}else if(e instanceof fm){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===N.intersectsSprite(e))return;D(e)}for(var n=e.children,r=0,i=n.length;r<i;r++)t(n[r])}}(t),!0===c&&w.objects.sort(B);for(var d=w.objects,f=0,m=d.length;f<m;f++){var v=d[f].object,g=v.geometry;if(R.setObject(v),l=v.matrixWorld,r=0,v instanceof Kc){if(g instanceof Xs){var y=g.groups;if(void 0===(xt=g.attributes).position)continue;for(var b=0,x=(wt=xt.position.array).length;b<x;b+=3)R.pushVertex(wt[b],wt[b+1],wt[b+2]);if(void 0!==xt.normal){var T=xt.normal.array;for(b=0,x=T.length;b<x;b+=3)R.pushNormal(T[b],T[b+1],T[b+2])}if(void 0!==xt.uv){var M=xt.uv.array;for(b=0,x=M.length;b<x;b+=2)R.pushUv(M[b],M[b+1])}if(null!==g.index){var A=g.index.array;if(y.length>0)for(var V=0;V<y.length;V++){var G=y[V];for(b=G.start,x=G.start+G.count;b<x;b+=3)R.pushTriangle(A[b],A[b+1],A[b+2])}else for(b=0,x=A.length;b<x;b+=3)R.pushTriangle(A[b],A[b+1],A[b+2])}else for(b=0,x=wt.length/3;b<x;b+=3)R.pushTriangle(b,b+1,b+2)}else if(g instanceof Ls){var H=g.vertices,W=g.faces,X=g.faceVertexUvs[0];O.getNormalMatrix(l);for(var q=v.material,Y=Array.isArray(q),Z=0,J=H.length;Z<J;Z++){if(_.copy(bt=H[Z]),!0===q.morphTargets)for(var Q=g.morphTargets,K=v.morphTargetInfluences,$=0,tt=Q.length;$<tt;$++){var et=K[$];if(0!==et){var nt=Q[$].vertices[Z];_.x+=(nt.x-bt.x)*et,_.y+=(nt.y-bt.y)*et,_.z+=(nt.z-bt.z)*et}}R.pushVertex(_.x,_.y,_.z)}for(var rt=0,it=W.length;rt<it;rt++){var ot=W[rt];if(void 0!==(q=!0===Y?v.material[ot.materialIndex]:v.material)){var at=q.side,st=p[ot.a],ct=p[ot.b],ut=p[ot.c];if(!1!==R.checkTriangleVisibility(st,ct,ut)){var lt=R.checkBackfaceCulling(st,ct,ut);if(at!==uc){if(at===sc&&!1===lt)continue;if(at===cc&&!0===lt)continue}(i=k()).id=v.id,i.v1.copy(st),i.v2.copy(ct),i.v3.copy(ut),i.normalModel.copy(ot.normal),!1!==lt||at!==cc&&at!==uc||i.normalModel.negate(),i.normalModel.applyMatrix3(O).normalize();for(var ht=ot.vertexNormals,dt=0,pt=Math.min(ht.length,3);dt<pt;dt++){var ft=i.vertexNormalsModel[dt];ft.copy(ht[dt]),!1!==lt||at!==cc&&at!==uc||ft.negate(),ft.applyMatrix3(O).normalize()}i.vertexNormalsLength=ht.length;var mt=X[rt];if(void 0!==mt)for(var vt=0;vt<3;vt++)i.uvs[vt].copy(mt[vt]);i.color=ot.color,i.material=q,i.z=(st.positionScreen.z+ct.positionScreen.z+ut.positionScreen.z)/3,i.renderOrder=v.renderOrder,w.elements.push(i)}}}}}else if(v instanceof $c){if(P.multiplyMatrices(C,l),g instanceof Xs){if(void 0!==(xt=g.attributes).position){for(b=0,x=(wt=xt.position.array).length;b<x;b+=3)R.pushVertex(wt[b],wt[b+1],wt[b+2]);if(void 0!==xt.color){var gt=xt.color.array;for(b=0,x=gt.length;b<x;b+=3)R.pushColor(gt[b],gt[b+1],gt[b+2])}if(null!==g.index)for(b=0,x=(A=g.index.array).length;b<x;b+=2)R.pushLine(A[b],A[b+1]);else{var yt=v instanceof Bd?2:1;for(b=0,x=wt.length/3-1;b<x;b+=yt)R.pushLine(b,b+1)}}}else if(g instanceof Ls){if(0===(H=v.geometry.vertices).length)continue;for((st=U()).positionScreen.copy(H[0]).applyMatrix4(P),yt=v instanceof Bd?2:1,Z=1,J=H.length;Z<J;Z++)(st=U()).positionScreen.copy(H[Z]).applyMatrix4(P),(Z+1)%yt>0||(ct=p[r-2],L.copy(st.positionScreen),I.copy(ct.positionScreen),!0===z(L,I)&&(L.multiplyScalar(1/L.w),I.multiplyScalar(1/I.w),(a=j()).id=v.id,a.v1.positionScreen.copy(L),a.v2.positionScreen.copy(I),a.z=Math.max(L.z,I.z),a.renderOrder=v.renderOrder,a.material=v.material,v.material.vertexColors===dc&&(a.vertexColors[0].copy(v.geometry.colors[Z]),a.vertexColors[1].copy(v.geometry.colors[Z-1])),w.elements.push(a)))}}else if(v instanceof Zh){if(P.multiplyMatrices(C,l),g instanceof Ls)for(Z=0,J=(H=v.geometry.vertices).length;Z<J;Z++){var bt;S.set((bt=H[Z]).x,bt.y,bt.z,1),S.applyMatrix4(P),F(S,v,n)}else if(g instanceof Xs){var xt,wt;if(void 0!==(xt=g.attributes).position)for(b=0,x=(wt=xt.position.array).length;b<x;b+=3)S.set(wt[b],wt[b+1],wt[b+2],1),S.applyMatrix4(P),F(S,v,n)}}else v instanceof fm&&(S.set(l.elements[12],l.elements[13],l.elements[14],1),S.applyMatrix4(C),F(S,v,n))}return!0===h&&w.elements.sort(B),w}},V=new Is,G=new Is,H=new Is,W=new Cs,X=new Cs,q=new Cs,Y=[],Z=0,J=[],Q=0,K=[],$=0;function tt(t){for(var r=e*n*4,i=0;i<r;i+=4)d[i]=255*t.r|0,d[i+1]=255*t.g|0,d[i+2]=255*t.b|0,d[i+3]=b?0:255;y.fillStyle=b?"rgba(0, 0, 0, 0)":t.getStyle(),y.fillRect(0,0,e,n)}function et(t,e){var n=0,r=0,i=255*t.color.r,o=255*t.color.g,a=255*t.color.b,s=new Uint8Array(768);if(e){for(;n<204;)s[r++]=Math.min(n*i/204,255),s[r++]=Math.min(n*o/204,255),s[r++]=Math.min(n*a/204,255),++n;for(;n<256;)s[r++]=Math.min(i+(n-204)*(255-i)/82,255),s[r++]=Math.min(o+(n-204)*(255-o)/82,255),s[r++]=Math.min(a+(n-204)*(255-a)/82,255),++n}else for(;n<256;)s[r++]=Math.min(n*i/255,255),s[r++]=Math.min(n*o/255,255),s[r++]=Math.min(n*a/255,255),++n;return s}function nt(t,e,n,r,i,o,a,s,c){var u=4*n,l=w[c.map.id];if(l.data){var h=l.width,d=h-1,p=l.data,f=4*((o*h&d)*h+(i*h&d));if(c.transparent){var m=p[f+1],v=p[f+2],g=p[f+3]*c.opacity/255,y=t[u+1],b=t[u+2];t[u]=p[f]*g+t[u]*(1-g),t[u+1]=m*g+y*(1-g),t[u+2]=v*g+b*(1-g),t[u+3]=(c.opacity<<8)-1,255==t[u+3]&&(e[n]=r)}else t[u]=p[f],t[u+1]=p[f+1],t[u+2]=p[f+2],t[u+3]=(c.opacity<<8)-1,e[n]=r}}function rt(t,e,n,r,i,o,a,s,c){var u=4*n,l=w[c.map.id];if(l.data){var h=l.width,d=3*(a>0?~~a:0),p=h-1,f=l.data,m=4*((o*h&p)*h+(i*h&p));if(c.transparent){var v=c.palette[d+1]*f[m+1],g=c.palette[d+2]*f[m+2],y=f[m+3]*c.opacity/256,b=t[u+1],x=t[u+2];t[u]=c.palette[d]*f[m]*y+t[u]*(1-y),t[u+1]=v*y+b*(1-y),t[u+2]=g*y+x*(1-y),t[u+3]=(c.opacity<<8)-1,255==t[u+3]&&(e[n]=r)}else t[u]=c.palette[d]*f[m]>>8,t[u+1]=c.palette[d+1]*f[m+1]>>8,t[u+2]=c.palette[d+2]*f[m+2]>>8,t[u+3]=(c.opacity<<8)-1,e[n]=r}}function it(t){var e=t.id,n=x[e];if(n&&t.map&&!w[t.map.id]&&delete x[e],void 0===x[e]||!0===t.needsUpdate){if(t instanceof Xc||t instanceof Zu||t instanceof Qu||t instanceof il)if(t instanceof Zu?t.palette||(t.palette=et(t,!1)):t instanceof Qu&&(t.palette||(t.palette=et(t,!0))),t.map){var r=new Lg.Texture;if(r.fromImage(t.map.image),!r.data)return;w[t.map.id]=r,n=t instanceof Xc||t instanceof il?nt:rt}else i=t.vertexColors===hc?["var colorOffset = offset * 4;","buffer[ colorOffset ] = face.color.r * 255;","buffer[ colorOffset + 1 ] = face.color.g * 255;","buffer[ colorOffset + 2 ] = face.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"):["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * 255;","buffer[ colorOffset + 1 ] = material.color.g * 255;","buffer[ colorOffset + 2 ] = material.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"),n=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i);else if(t instanceof qc){var i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * (color1.r+color2.r) * 0.5 * 255;","buffer[ colorOffset + 1 ] = material.color.g * (color1.g+color2.g) * 0.5 * 255;","buffer[ colorOffset + 2 ] = material.color.b * (color1.b+color2.b) * 0.5 * 255;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n");n=new Function("buffer, depthBuf, offset, depth, color1, color2, material",i)}else i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = u * 255;","buffer[ colorOffset + 1 ] = v * 255;","buffer[ colorOffset + 2 ] = 0;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n"),n=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i);x[e]=n,t.needsUpdate=!1}return n}function ot(t,i,h,f,g,y,b,x,w){if(!(t.z<-1||t.z>1||i.z<-1||i.z>1||h.z<-1||h.z>1)){var _=1<<M,P=t.x*o+c|0,O=i.x*o+c|0,N=h.x*o+c|0,L=t.y*a+u|0,U=i.y*a+u|0,k=h.y*a+u|0,j=x.vertexNormalsModel&&x.vertexNormalsModel.length,B=f&&g&&y,z=Math.max(Math.sqrt((P-O)*(P-O)+(L-U)*(L-U)),Math.sqrt((O-N)*(O-N)+(U-k)*(U-k)),Math.sqrt((N-P)*(N-P)+(k-L)*(k-L)));if(!(x instanceof Eg)&&z>100*_){var V,G,H,W,X,q,tt,et,nt,rt,it={vertexNormalsModel:[],color:x.color};return B&&($===K.length?(V=new Cs,K.push(V),++$,G=new Cs,K.push(G),++$,H=new Cs,K.push(H),++$):(V=K[$],G=K[++$],H=K[++$],++$),W=(1+i.z)*(i.w/t.w)/(1+t.z),V.copy(f).multiplyScalar(W).add(g).multiplyScalar(1/(W+1)),W=(1+h.z)*(h.w/i.w)/(1+i.z),G.copy(g).multiplyScalar(W).add(y).multiplyScalar(1/(W+1)),W=(1+t.z)*(t.w/h.w)/(1+h.z),H.copy(y).multiplyScalar(W).add(f).multiplyScalar(1/(W+1))),Z===Y.length?(X=new Is,Y.push(X),++Z,q=new Is,Y.push(q),++Z,tt=new Is,Y.push(tt),++Z):(X=Y[Z],q=Y[++Z],tt=Y[++Z],++Z),X.copy(t).add(i).multiplyScalar(.5),q.copy(i).add(h).multiplyScalar(.5),tt.copy(h).add(t).multiplyScalar(.5),j&&(Q===J.length?(et=new ss,J.push(et),++Q,nt=new ss,J.push(nt),++Q,rt=new ss,J.push(rt),++Q):(et=J[Q],nt=J[++Q],rt=J[++Q],++Q),et.copy(x.vertexNormalsModel[0]).add(x.vertexNormalsModel[1]).normalize(),nt.copy(x.vertexNormalsModel[1]).add(x.vertexNormalsModel[2]).normalize(),rt.copy(x.vertexNormalsModel[2]).add(x.vertexNormalsModel[0]).normalize()),j&&(it.vertexNormalsModel[0]=x.vertexNormalsModel[0],it.vertexNormalsModel[1]=et,it.vertexNormalsModel[2]=rt),ot(t,X,tt,f,V,H,b,it,w),j&&(it.vertexNormalsModel[0]=x.vertexNormalsModel[1],it.vertexNormalsModel[1]=nt,it.vertexNormalsModel[2]=et),ot(i,q,X,g,G,V,b,it,w),j&&(it.vertexNormalsModel[0]=et,it.vertexNormalsModel[1]=nt,it.vertexNormalsModel[2]=rt),ot(X,q,tt,V,G,H,b,it,w),j&&(it.vertexNormalsModel[0]=x.vertexNormalsModel[2],it.vertexNormalsModel[1]=rt,it.vertexNormalsModel[2]=nt),void ot(h,tt,q,y,H,G,b,it,w)}var at,ct,ut,lt,ht,dt,pt,ft,mt,vt=t.z*s+l|0,gt=i.z*s+l|0,yt=h.z*s+l|0;B=!1,f&&g&&y&&(B=!0,at=f.x,ct=1-f.y,ut=g.x,lt=1-g.y,ht=y.x,dt=1-y.y),j&&(pt=255*x.vertexNormalsModel[0].z,ft=255*x.vertexNormalsModel[1].z,mt=255*x.vertexNormalsModel[2].z);var bt=P-O,xt=U-L,wt=O-N,_t=k-U,St=N-P,Tt=L-k,Mt=Math.max(Math.min(P,O,N)+A>>M,0),At=Math.min(Math.max(P,O,N)+A>>M,e),Et=Math.max(Math.min(L,U,k)+A>>M,0),Ct=Math.min(Math.max(L,U,k)+A>>M,n);I=Math.min(Mt,I),D=Math.max(At,D),R=Math.min(Et,R),F=Math.max(Ct,F);var Pt=C,Ot=(Mt&=~(Pt-1))<<M,Nt=(Et&=~(Pt-1))<<M,Lt=xt*(Ot-P)+bt*(Nt-L),It=_t*(Ot-O)+wt*(Nt-U),Rt=Tt*(Ot-N)+St*(Nt-k);(xt>0||0==xt&&bt>0)&&Lt++,(_t>0||0==_t&&wt>0)&&It++,(Tt>0||0==Tt&&St>0)&&Rt++,Lt=Lt-1>>M,It=It-1>>M,Rt=Rt-1>>M;var Dt,Ft,Ut,kt,jt,Bt=vt-gt,zt=yt-vt,Vt=1/(bt*Tt-St*xt),Gt=Vt*(Bt*Tt-zt*xt),Ht=Vt*(Bt*St-bt*zt),Wt=vt+(Ot-P)*Gt+(Nt-L)*Ht|0;if(Gt=Gt*_|0,Ht=Ht*_|0,B){var Xt=at-ut,qt=ht-at,Yt=Vt*(Xt*Tt-qt*xt),Zt=Vt*(Xt*St-bt*qt),Jt=ct-lt,Qt=dt-ct;Ut=at+(Ot-P)*Yt+(Nt-L)*Zt,kt=ct+(Ot-P)*(Dt=Vt*(Jt*Tt-Qt*xt))+(Nt-L)*(Ft=Vt*(Jt*St-bt*Qt)),Yt*=_,Zt*=_,Dt*=_,Ft*=_}if(j){var Kt,$t=pt-ft,te=mt-pt,ee=Vt*($t*Tt-te*xt);jt=pt+(Ot-P)*ee+(Nt-L)*(Kt=Vt*($t*St-bt*te)),ee*=_,Kt*=_}var ne=Pt-1,re=0,ie=0,oe=0,ae=0,se=0,ce=0,ue=0,le=0;bt>=0?ie-=ne*bt:re-=ne*bt,xt>=0?ie-=ne*xt:re-=ne*xt,wt>=0?ae-=ne*wt:oe-=ne*wt,_t>=0?ae-=ne*_t:oe-=ne*_t,St>=0?ce-=ne*St:se-=ne*St,Tt>=0?ce-=ne*Tt:se-=ne*Tt,Gt>=0?le+=ne*Gt:ue+=ne*Gt,Ht>=0?le+=ne*Ht:ue+=ne*Ht;var he,de,pe,fe=e-Pt,me=Lt,ve=It,ge=Rt,ye=Wt,be=-Pt,xe=be*xt,we=be*_t,_e=be*Tt,Se=be*Gt;B&&(he=be*Yt,de=be*Dt),j&&(pe=be*ee);for(var Te=Mt,Me=Et;Me<Ct;Me+=Pt){for(;Te>=Mt&&Te<At&&me>=ie&&ve>=ae&&ge>=ce;)Te+=be,me+=xe,ve+=we,ge+=_e,ye+=Se,B&&(Ut+=he,kt+=de),j&&(jt+=pe);for(be=-be,xe=-xe,we=-we,_e=-_e,Se=-Se,B&&(he=-he,de=-de),j&&(pe=-pe);Te+=be,me+=xe,ve+=we,ge+=_e,ye+=Se,B&&(Ut+=he,kt+=de),j&&(jt+=pe),!(Te<Mt||Te>=At);)if(me<ie){if(xe<0)break}else if(ve<ae){if(we<0)break}else if(ge<ce){if(_e<0)break}else{var Ae=Te>>E,Ee=Me>>E,Ce=Ae+Ee*r;if(!(m[Ce]<ye+ue)){var Pe=v[Ce];Pe&T&&st(Ae,Ee),v[Ce]=Pe&~(S|T);var Oe=Te+Me*e;if(me>=re&&ve>=oe&&ge>=se){m[Ce]=Math.min(m[Ce],ye+le);var Ne=me,Le=ve,Ie=ye;B&&(je=Ut,Be=kt),j&&(ze=jt);for(var Re=0;Re<Pt;Re++){var De=Ne,Fe=Le,Ue=Ie;B&&(Ge=je,He=Be),j&&(We=ze);for(var ke=0;ke<Pt;ke++)(qe=Ue)<p[Oe]&&b(d,p,Oe,qe,Ge,He,We,x,w),De+=xt,Fe+=_t,Ue+=Gt,B&&(Ge+=Yt,He+=Dt),j&&(We+=ee),Oe++;Ne+=bt,Le+=wt,Ie+=Ht,B&&(je+=Zt,Be+=Ft),j&&(ze+=Kt),Oe+=fe}}else{Ne=me,Le=ve;var je,Be,ze,Ve=ge;for(Ie=ye,B&&(je=Ut,Be=kt),j&&(ze=jt),Re=0;Re<Pt;Re++){De=Ne,Fe=Le;var Ge,He,We,Xe=Ve;for(Ue=Ie,B&&(Ge=je,He=Be),j&&(We=ze),ke=0;ke<Pt;ke++){var qe;(De|Fe|Xe)>=0&&(qe=Ue)<p[Oe]&&b(d,p,Oe,qe,Ge,He,We,x,w),De+=xt,Fe+=_t,Xe+=Tt,Ue+=Gt,B&&(Ge+=Yt,He+=Dt),j&&(We+=ee),Oe++}Ne+=bt,Le+=wt,Ve+=St,Ie+=Ht,B&&(je+=Zt,Be+=Ft),j&&(ze+=Kt),Oe+=fe}}}}me+=Pt*bt,ve+=Pt*wt,ge+=Pt*St,ye+=Pt*Ht,B&&(Ut+=Pt*Zt,kt+=Pt*Ft),j&&(jt+=Pt*Kt)}}}function at(t,x,w,U,k,j){if(O||(O=!0,C=1<<(E=0),function(t,x){r=Math.floor(g.width/C),i=Math.floor(x/C);var w=1<<M;o=w*(e=r*C)/2,a=-w*(n=i*C)/2,s=P/2,c=w*e/2+.5,u=w*n/2+.5,l=P/2+.5,g.width=e,g.height=n,y.fillStyle=b?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,e,n),h=y.getImageData(0,0,e,n),d=h.data,p=new Int32Array(d.length/4),f=r*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;tt(_)}(0,g.height)),!(t.z<-1||t.z>1||x.z<-1||x.z>1)){var B=Math.floor(.5*(j.linewidth-1)),z=t.x*o+c|0,V=x.x*o+c|0,G=t.y*a+u|0,H=x.y*a+u|0,W=t.z*s+l|0,X=x.z*s+l|0,q=z-V,Y=G-H,Z=W-X,J=Math.max(Math.min(z,V)+A>>M,0),Q=Math.min(Math.max(z,V)+A>>M,e),K=Math.max(Math.min(G,H)+A>>M,0),$=Math.min(Math.max(G,H)+A>>M,n),et=Math.max(Math.min(W,X)+A>>M,0),nt=Math.max(W,X)+A>>M;I=Math.min(J,I),D=Math.max(Q,D),R=Math.min(K,R),F=Math.max($,F);var rt,it,ot,at,ct,ut=Math.sqrt(Y*Y+q*q),lt=q/ut,ht=Y/ut,dt=Z/ut;for(L.set(lt,ht,dt),L.cross(N),L.normalize();ut>0;){rt=(rt=V+ut*lt)+A>>M,it=(it=H+ut*ht)+A>>M,ct=X+ut*dt+A>>M;for(var pt=-B;pt<=B;++pt)if(ot=Math.floor(rt+L.x*pt),at=Math.floor(it+L.y*pt),!(I>=ot||D<=ot||R>=at||F<=at)){var ft=ot>>E,mt=at>>E,vt=ft+mt*r;if(!(m[vt]<et)){m[vt]=Math.min(m[vt],nt);var gt=v[vt];gt&T&&st(ft,mt),v[vt]=gt&~(S|T);var yt=ot+at*e;ct<p[yt]&&k(d,p,yt,ct,w,U,j)}}--ut}}}function st(t,n){for(var r=t*C+n*C*e,i=4*r,o=e-C,a=4*o,s=0;s<C;s++){for(var c=0;c<C;c++)p[r++]=P,d[i++]=255*_.r|0,d[i++]=255*_.g|0,d[i++]=255*_.b|0,d[i++]=b?0:255;r+=o,i+=a}}this.domElement=g,this.autoClear=!0,this.setClearColor=function(t){_.set(t),tt(_)},this.setPixelRatio=function(){},this.setSize=function(t,x){r=Math.floor(t/C),i=Math.floor(x/C);var w=1<<M;o=w*(e=r*C)/2,a=-w*(n=i*C)/2,s=P/2,c=w*e/2+.5,u=w*n/2+.5,l=P/2+.5,g.width=e,g.height=n,y.fillStyle=b?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,e,n),h=y.getImageData(0,0,e,n),d=h.data,p=new Int32Array(d.length/4),f=r*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;tt(_)},this.setSize(g.width,g.height),this.clear=function(){I=1/0,R=1/0,D=0,F=0,Z=0,Q=0,$=0;for(var t=0;t<f;t++)m[t]=P,v[t]=v[t]&S?S:T},this.render=function(t,e){this.clear();var n=t.background;n&&n.isColor&&tt(n);for(var o=z.projectScene(t,e,!1,!1).elements,a=0,s=o.length;a<s;a++){var c=o[a],u=c.material;if(p=it(u))if(c instanceof Tg)c.uvs?ot(c.v1.positionScreen,c.v2.positionScreen,c.v3.positionScreen,c.uvs[0],c.uvs[1],c.uvs[2],p,c,u):ot(c.v1.positionScreen,c.v2.positionScreen,c.v3.positionScreen,null,null,null,p,c,u);else if(c instanceof Eg){var l=.5*c.scale.x,d=.5*c.scale.y;V.copy(c),V.x-=l,V.y+=d,G.copy(c),G.x-=l,G.y-=d,H.copy(c),H.x+=l,H.y+=d,u.map?(W.set(0,1),X.set(0,0),q.set(1,1),ot(V,G,H,W,X,q,p,c,u)):ot(V,G,H,null,null,null,p,c,u),V.copy(c),V.x+=l,V.y+=d,G.copy(c),G.x-=l,G.y-=d,H.copy(c),H.x+=l,H.y-=d,u.map?(W.set(1,1),X.set(0,0),q.set(1,0),ot(V,G,H,W,X,q,p,c,u)):ot(V,G,H,null,null,null,p,c,u)}else if(c instanceof Ag){var p=it(u);at(c.v1.positionScreen,c.v2.positionScreen,c.vertexColors[0],c.vertexColors[1],p,u)}}!function(){for(var t=0,e=0;e<i;e++)for(var n=0;n<r;n++)v[t]&T&&(st(n,e),v[t]=S),t++}();var f=Math.min(I,U),m=Math.min(R,k),g=Math.max(D,j)-f,b=Math.max(F,B)-m;f!==1/0&&y.putImageData(h,0,0,f,m,g,b),U=I,k=R,j=D,B=F}};Lg.Texture=function(){var t;this.fromImage=function(e){if(!(!e||e.width<=0||e.height<=0)){void 0===t&&(t=document.createElement("canvas"));var n=e.width>e.height?e.width:e.height;n=os.ceilPowerOfTwo(n),t.width==n&&t.height==n||(t.width=n,t.height=n);var r=t.getContext("2d");r.clearRect(0,0,n,n),r.drawImage(e,0,0,n,n);var i=r.getImageData(0,0,n,n);this.data=i.data,this.width=n,this.height=n,this.srcUrl=e.src}}};var Ig=function(t){ys.call(this),this.node=t};(Ig.prototype=Object.create(ys.prototype)).constructor=Ig;var Rg=new Ou,Dg=new Tp;function Fg(){this.seq=[],this.map={}}var Ug=[],kg=[],jg=new Float32Array(16),Bg=new Float32Array(9);function zg(t,e,n){var r=t[0];if(r<=0||r>0)return t;var i=e*n,o=Ug[i];if(void 0===o&&(o=new Float32Array(i),Ug[i]=o),0!==e){r.toArray(o,0);for(var a=1,s=0;a!==e;++a)t[a].toArray(o,s+=n)}return o}function Vg(t,e){var n=kg[e];void 0===n&&(n=new Int32Array(e),kg[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocTextureUnit();return n}function Gg(t,e){t.uniform1f(this.addr,e)}function Hg(t,e){t.uniform1i(this.addr,e)}function Wg(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function Xg(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function qg(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function Yg(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function Zg(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(Bg.set(e.elements),t.uniformMatrix3fv(this.addr,!1,Bg))}function Jg(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(jg.set(e.elements),t.uniformMatrix4fv(this.addr,!1,jg))}function Qg(t,e,n){var r=n.allocTextureUnit();t.uniform1i(this.addr,r),n.setTexture2D(e||Rg,r)}function Kg(t,e,n){var r=n.allocTextureUnit();t.uniform1i(this.addr,r),n.setTextureCube(e||Dg,r)}function $g(t,e){t.uniform2iv(this.addr,e)}function ty(t,e){t.uniform3iv(this.addr,e)}function ey(t,e){t.uniform4iv(this.addr,e)}function ny(t,e){t.uniform1fv(this.addr,e)}function ry(t,e){t.uniform1iv(this.addr,e)}function iy(t,e){t.uniform2fv(this.addr,zg(e,this.size,2))}function oy(t,e){t.uniform3fv(this.addr,zg(e,this.size,3))}function ay(t,e){t.uniform4fv(this.addr,zg(e,this.size,4))}function sy(t,e){t.uniformMatrix2fv(this.addr,!1,zg(e,this.size,4))}function cy(t,e){t.uniformMatrix3fv(this.addr,!1,zg(e,this.size,9))}function uy(t,e){t.uniformMatrix4fv(this.addr,!1,zg(e,this.size,16))}function ly(t,e,n){var r=e.length,i=Vg(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.setTexture2D(e[o]||Rg,i[o])}function hy(t,e,n){var r=e.length,i=Vg(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.setTextureCube(e[o]||Dg,i[o])}function dy(t,e,n){this.id=t,this.addr=n,this.setValue=function(t){switch(e.type){case 5126:return Gg;case 35664:return Wg;case 35665:return Xg;case 35666:return qg;case 35674:return Yg;case 35675:return Zg;case 35676:return Jg;case 35678:case 36198:return Qg;case 35680:return Kg;case 5124:case 35670:return Hg;case 35667:case 35671:return $g;case 35668:case 35672:return ty;case 35669:case 35673:return ey}}()}function py(t,e,n){this.id=t,this.addr=n,this.size=e.size,this.setValue=function(t){switch(e.type){case 5126:return ny;case 35664:return iy;case 35665:return oy;case 35666:return ay;case 35674:return sy;case 35675:return cy;case 35676:return uy;case 35678:return ly;case 35680:return hy;case 5124:case 35670:return ry;case 35667:case 35671:return $g;case 35668:case 35672:return ty;case 35669:case 35673:return ey}}()}function fy(t){this.id=t,Fg.call(this)}fy.prototype.setValue=function(t,e){for(var n=this.seq,r=0,i=n.length;r!==i;++r){var o=n[r];o.setValue(t,e[o.id])}};var my=/([\w\d_]+)(\])?(\[|\.)?/g;function vy(t,e){t.seq.push(e),t.map[e.id]=e}function gy(t,e,n){var r=t.name,i=r.length;for(my.lastIndex=0;;){var o=my.exec(r),a=o[1],s=o[3];if("]"===o[2]&&(a|=0),void 0===s||"["===s&&my.lastIndex+2===i){vy(n,void 0===s?new dy(a,t,e):new py(a,t,e));break}var c=n.map[a];void 0===c&&vy(n,c=new fy(a)),n=c}}function yy(t,e,n){Fg.call(this),this.renderer=n;for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<r;++i){var o=t.getActiveUniform(e,i);gy(o,t.getUniformLocation(e,o.name),this)}}function by(t){Mu.call(this),this.cameras=t||[]}function xy(t){"string"==typeof t&&(console.warn("Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}yy.prototype.setValue=function(t,e,n){var r=this.map[e];void 0!==r&&r.setValue(t,n,this.renderer)},yy.prototype.setOptional=function(t,e,n){var r=e[n];void 0!==r&&this.setValue(t,n,r)},yy.upload=function(t,e,n,r){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,r)}},yy.seqWithValue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var o=t[r];o.id in e&&n.push(o)}return n},by.prototype=Object.assign(Object.create(Mu.prototype),{constructor:by,isArrayCamera:!0}),xy.prototype.clone=function(){return new xy(void 0===this.value.clone?this.value:this.value.clone())},new Cs(1/1024,1/512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","","","","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","","#if (FXAA_PC == 1)","","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","    #endif","","                        }","                        #endif","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n");var wy={packVector3:["float vec3_to_float( vec3 data ) {","\tconst float unit = 255.0/256.0;","\thighp float compressed = fract( data.x * unit ) + floor( data.y * unit * 255.0 ) + floor( data.z * unit * 255.0 ) * 255.0;","\treturn compressed;","}"].join("\n"),unpackFloat:["vec3 float_to_vec3( float data ) {","\tconst float unit = 255.0;","\tvec3 uncompressed;","\tuncompressed.x = fract( data );","\tfloat zInt = floor( data / unit );","\tuncompressed.z = fract( zInt / unit );","\tuncompressed.y = fract( floor( data - ( zInt * unit ) ) / unit );","\treturn uncompressed;","}"].join("\n"),packNormal:["vec2 normal_to_vec2( vec3 normal ) {","\treturn normal.xy / sqrt( normal.z * 8.0 + 8.0 ) + 0.5;","}"].join("\n"),unpackVector2:["vec3 vec2_to_normal( vec2 data ) {","\tvec2 fenc = data * 4.0 - 2.0;","\tfloat f = dot( fenc, fenc );","\tfloat g = sqrt( 1.0 - f / 4.0 );","\tvec3 normal;","\tnormal.xy = fenc * g;","\tnormal.z = 1.0 - f / 2.0;","\treturn normal;","}"].join("\n"),computeTextureCoord:["vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );"].join("\n"),packNormalDepth:["vec4 packedNormalDepth;","packedNormalDepth.xyz = normal * 0.5 + 0.5;","packedNormalDepth.w = position.z / position.w;"].join("\n"),unpackNormalDepth:["vec4 normalDepthMap = texture2D( samplerNormalDepth, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = normalDepthMap.xyz * 2.0 - 1.0;"].join("\n"),packNormalDepthShininess:["vec4 packedNormalDepthShininess;","packedNormalDepthShininess.xy = normal_to_vec2( normal );","packedNormalDepthShininess.z = shininess;","packedNormalDepthShininess.w = position.z / position.w;"].join("\n"),unpackNormalDepthShininess:["vec4 normalDepthMap = texture2D( samplerNormalDepthShininess, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = vec2_to_normal( normalDepthMap.xy );","float shininess = normalDepthMap.z;"].join("\n"),packColor:["vec4 packedColor;","packedColor.x = vec3_to_float( diffuseColor.rgb );","packedColor.y = vec3_to_float( emissiveColor );","packedColor.z = vec3_to_float( specularColor );","packedColor.w = shininess;"].join("\n"),unpackColor:["vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 diffuseColor = float_to_vec3( colorMap.x );","vec3 emissiveColor = float_to_vec3( colorMap.y );","vec3 specularColor = float_to_vec3( colorMap.z );","float shininess = colorMap.w;"].join("\n"),packLight:["vec4 packedLight;","packedLight.xyz = lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * attenuation;","packedLight.w = lightIntensity * specular * max( dot( lightVector, normal ), 0.0 ) * attenuation;"].join("\n"),computeVertexPositionVS:["vec2 xy = texCoord * 2.0 - 1.0;","vec4 vertexPositionProjected = vec4( xy, depth, 1.0 );","vec4 vertexPositionVS = matProjInverse * vertexPositionProjected;","vertexPositionVS.xyz /= vertexPositionVS.w;","vertexPositionVS.w = 1.0;"].join("\n"),computeSpecular:["vec3 halfVector = normalize( lightVector - normalize( vertexPositionVS.xyz ) );","float dotNormalHalf = max( dot( normal, halfVector ), 0.0 );","float specular = 0.31830988618 * ( shininess * 0.5 + 1.0 ) * pow( dotNormalHalf, shininess );"].join("\n"),combine:["gl_FragColor = vec4( lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * ( diffuseColor + specular * specularColor ) * attenuation, 1.0 );"].join("\n")},_y={commonUniforms:{matProjInverse:new xy(new as),viewWidth:new xy(800),viewHeight:new xy(600)}};["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",wy.packNormalDepth,"\tgl_FragColor = packedNormalDepth;","}"].join("\n"),new xy(null),new xy(new Is(0,0,1,1)),new xy(new Ts(0)),new xy(new Ts(0)),new xy(new Ts(0)),new xy(30),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","#include <uv_pars_fragment>","#include <map_pars_fragment>",wy.packVector3,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;","#include <map_fragment>",wy.packColor,"\tgl_FragColor = packedColor;","}"].join("\n"),Object.assign({samplerColor:new xy(null)},_y.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;",wy.unpackFloat,"void main() {",wy.computeTextureCoord,wy.unpackColor,"\tgl_FragColor = vec4( emissiveColor, 1.0 );","}"].join("\n"),Object.assign({samplerNormalDepth:new xy(null),samplerColor:new xy(null),lightColor:new xy(new Ts(0)),lightPositionVS:new xy(new ss(0,1,0)),lightIntensity:new xy(1),lightRadius:new xy(1)},_y.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",wy.unpackFloat,"void main() {",wy.computeTextureCoord,wy.unpackNormalDepth,wy.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",wy.unpackColor,wy.computeSpecular,"\t//float cutoff = 0.3;","\t//float denom = distance / lightRadius + 1.0;","\t//float attenuation = 1.0 / ( denom * denom );","\t//attenuation = ( attenuation - cutoff ) / ( 1.0 - cutoff );","\t//attenuation = max( attenuation, 0.0 );","\t//attenuation *= attenuation;","\t//diffuseColor *= saturate( -distance / lightRadius + 1.0 );","\t//float attenuation = 1.0;","\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",wy.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new xy(null),samplerColor:new xy(null),lightColor:new xy(new Ts(0)),lightDirectionVS:new xy(new ss(0,1,0)),lightPositionVS:new xy(new ss(0,1,0)),lightAngle:new xy(1),lightIntensity:new xy(1)},_y.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",wy.unpackFloat,"void main() {",wy.computeTextureCoord,wy.unpackNormalDepth,wy.computeVertexPositionVS,wy.unpackColor,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}","\tdiffuseColor *= spot;",wy.computeSpecular,"\tconst float attenuation = 1.0;",wy.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new xy(null),samplerColor:new xy(null),lightColor:new xy(new Ts(0)),lightDirectionVS:new xy(new ss(0,1,0)),lightIntensity:new xy(1)},_y.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",wy.unpackFloat,"void main() {",wy.computeTextureCoord,wy.unpackNormalDepth,wy.computeVertexPositionVS,wy.unpackColor,"\tvec3 lightVector = normalize( lightDirectionVS );",wy.computeSpecular,"\tconst float attenuation = 1.0;",wy.combine,"}"].join("\n"),new xy(30),["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","uniform float shininess;",wy.packNormal,"void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",wy.packNormalDepthShininess,"\tgl_FragColor = packedNormalDepthShininess;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new xy(null),lightColor:new xy(new Ts(0)),lightPositionVS:new xy(new ss(0,1,0)),lightIntensity:new xy(1),lightRadius:new xy(1)},_y.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",wy.unpackFloat,wy.unpackVector2,"void main() {",wy.computeTextureCoord,wy.unpackNormalDepthShininess,wy.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",wy.computeSpecular,"\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",wy.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new xy(null),lightColor:new xy(new Ts(0)),lightDirectionVS:new xy(new ss(0,1,0)),lightPositionVS:new xy(new ss(0,1,0)),lightAngle:new xy(1),lightIntensity:new xy(1)},_y.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",wy.unpackFloat,wy.unpackVector2,"void main() {",wy.computeTextureCoord,wy.unpackNormalDepthShininess,wy.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}",wy.computeSpecular,"\tconst float attenuation = 1.0;",wy.packLight,"\tgl_FragColor = spot * packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new xy(null),lightColor:new xy(new Ts(0)),lightDirectionVS:new xy(new ss(0,1,0)),lightIntensity:new xy(1)},_y.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",wy.unpackFloat,wy.unpackVector2,"void main() {",wy.computeTextureCoord,wy.unpackNormalDepthShininess,wy.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightDirectionVS );",wy.computeSpecular,"\tconst float attenuation = 1.0;",wy.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerLight:new xy(null),map:new xy(null),offsetRepeat:new xy(new Is(0,0,1,1)),diffuse:new xy(new Ts(0)),emissive:new xy(new Ts(0)),specular:new xy(new Ts(0)),shininess:new xy(30)},_y.commonUniforms),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform sampler2D samplerLight;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float viewHeight;","uniform float viewWidth;","#include <uv_pars_fragment>","#include <map_pars_fragment>",wy.unpackFloat,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;",wy.computeTextureCoord,"\tvec4 light = texture2D( samplerLight, texCoord );","#include <map_fragment>","\tvec3 diffuseFinal = diffuseColor.rgb * light.rgb;","\tvec3 emissiveFinal = emissiveColor;","\tvec3 specularFinal = specularColor * light.rgb * light.a;","\tgl_FragColor = vec4( diffuseFinal + emissiveFinal + specularFinal, 1.0 );","}"].join("\n"),new xy(null),["varying vec2 texCoord;","void main() {","\tvec4 pos = vec4( sign( position.xy ), 0.0, 1.0 );","\ttexCoord = pos.xy * vec2( 0.5 ) + 0.5;","\tgl_Position = pos;","}"].join("\n"),["varying vec2 texCoord;","uniform sampler2D samplerResult;","void main() {","\tgl_FragColor = texture2D( samplerResult, texCoord );","}"].join("\n"),Object.create(Xs.prototype),Object.create(Xs.prototype),Object.create(Xs.prototype),Object.create(Xs.prototype),Object.create(Xs.prototype),new Cs(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n"),new Cs(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n"),new Cs(.5,.5),new Ts(16772608),new Ts(0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n"),["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n"),new Cs,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if (depthblur) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n"),new ss(2,2,2),new ss(1,1,1),new ss(0,0,0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n"),new Ts(16777215),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n"),new Cs(512,512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n"),["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float angle = hue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (saturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","}","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","vec2 p = vUv;","if (side == 0){","if (p.x > 0.5) p.x = 1.0 - p.x;","}else if (side == 1){","if (p.x < 0.5) p.x = 1.0 - p.x;","}else if (side == 2){","if (p.y < 0.5) p.y = 1.0 - p.y;","}else if (side == 3){","if (p.y > 0.5) p.y = 1.0 - p.y;","} ","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n"),new Cs(512,512),new Cs(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n"),["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","vec2 parallaxMap( in vec3 V ) {","float initialHeight = texture2D( bumpMap, vUv ).r;","vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","return vUv - texCoordOffset;","}","#else","vec2 parallaxMap( in vec3 V ) {","float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","float layerHeight = 1.0 / numLayers;","float currentLayerHeight = 0.0;","vec2 dtex = parallaxScale * V.xy / V.z / numLayers;","vec2 currentTextureCoords = vUv;","float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","for ( int i = 0; i < 30; i += 1 ) {","if ( heightFromTexture <= currentLayerHeight ) {","break;","}","currentLayerHeight += layerHeight;","currentTextureCoords -= dtex;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","}","#ifdef USE_STEEP_PARALLAX","return currentTextureCoords;","#elif defined( USE_RELIEF_PARALLAX )","vec2 deltaTexCoord = dtex / 2.0;","float deltaHeight = layerHeight / 2.0;","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","const int numSearches = 5;","for ( int i = 0; i < numSearches; i += 1 ) {","deltaTexCoord /= 2.0;","deltaHeight /= 2.0;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","if( heightFromTexture > currentLayerHeight ) {","currentTextureCoords -= deltaTexCoord;","currentLayerHeight += deltaHeight;","} else {","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","}","}","return currentTextureCoords;","#elif defined( USE_OCLUSION_PARALLAX )","vec2 prevTCoords = currentTextureCoords + dtex;","float nextH = heightFromTexture - currentLayerHeight;","float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;","float weight = nextH / ( nextH - prevH );","return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","#else","return vUv;","#endif","}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","vec2 texDx = dFdx( vUv );","vec2 texDy = dFdy( vUv );","vec3 vSigmaX = dFdx( surfPosition );","vec3 vSigmaY = dFdy( surfPosition );","vec3 vR1 = cross( vSigmaY, surfNormal );","vec3 vR2 = cross( surfNormal, vSigmaX );","float fDet = dot( vSigmaX, vR1 );","vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","vec3 vProjVtex;","vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","vProjVtex.z = dot( surfNormal, viewPosition );","return parallaxMap( vProjVtex );","}","void main() {","vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","gl_FragColor = texture2D( map, mapUv );","}"].join("\n"),["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float pixelSize;","uniform vec2 resolution;","varying highp vec2 vUv;","void main(){","vec2 dxy = pixelSize / resolution;","vec2 coord = dxy * floor( vUv / dxy );","gl_FragColor = texture2D(tDiffuse, coord);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n"),new Cs,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","gl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","gl_FragColor = newTex;","}"].join("\n"),new Cs(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = rand( vUv );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n"),["uniform mat4 textureMatrix;","varying vec2 vUv;","varying vec4 vUvRefraction;","void main() {","\tvUv = uv;","\tvUvRefraction = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform float time;","uniform sampler2D tDiffuse;","uniform sampler2D tDudv;","varying vec2 vUv;","varying vec4 vUvRefraction;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );","}","void main() {"," float waveStrength = 0.1;"," float waveSpeed = 0.03;","\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;","\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );","\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;"," vec4 uv = vec4( vUvRefraction );"," uv.xy += distortion;","\tvec4 base = texture2DProj( tDiffuse, uv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n"),Lu.merge([Lh.fog,Lh.lights,{enableBump:{value:0},enableSpecular:{value:0},tDiffuse:{value:null},tBeckmann:{value:null},diffuse:{value:new Ts(15658734)},specular:{value:new Ts(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75},bumpMap:{value:null},bumpScale:{value:1},specularMap:{value:null},offsetRepeat:{value:new Is(0,0,1,1)},uWrapRGB:{value:new ss(.75,.375,.1875)}}]),["#define USE_BUMPMAP","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Nh.common,Nh.bsdfs,Nh.packing,Nh.lights_pars_begin,Nh.shadowmap_pars_fragment,Nh.fog_pars_fragment,Nh.bumpmap_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","diffuseColor = diffuseColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewerDirection = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 totalSpecularLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += pointLight[ i ].color * ( pointDiffuseWeight * attenuation );","totalSpecularLight += pointLight[ i ].color * specular * ( pointSpecularWeight * specularStrength * attenuation );","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * ( dirSpecularWeight * specularStrength );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewerDirection, uRoughness, uSpecularBrightness );","vec3 hemiSpecularColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","totalSpecularLight += hemiSpecularColor * specular * ( hemiSpecularWeight * specularStrength );","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor * diffuse ) + totalSpecularLight;","gl_FragColor = linearToOutputTexel( vec4( outgoingLight, diffuseColor.a ) );",Nh.fog_fragment,"}"].join("\n"),["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Nh.common,Nh.lights_pars_begin,Nh.shadowmap_pars_vertex,Nh.fog_pars_vertex,"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",Nh.shadowmap_vertex,Nh.fog_vertex,"}"].join("\n"),Lu.merge([Lh.fog,Lh.lights,{passID:{value:0},tDiffuse:{value:null},tNormal:{value:null},tBlur1:{value:null},tBlur2:{value:null},tBlur3:{value:null},tBlur4:{value:null},tBeckmann:{value:null},uNormalScale:{value:1},diffuse:{value:new Ts(15658734)},specular:{value:new Ts(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Nh.common,Nh.lights_pars_begin,Nh.fog_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 mSpecular = vec4( specular, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","diffuseColor *= colDiffuse;","vec4 posAndU = vec4( -vViewPosition, vUv.x );","vec4 posAndU_dx = dFdx( posAndU ),  posAndU_dy = dFdy( posAndU );","vec3 tangent = posAndU_dx.w * posAndU_dx.xyz + posAndU_dy.w * posAndU_dy.xyz;","vec3 normal = normalize( vNormal );","vec3 binormal = normalize( cross( tangent, normal ) );","tangent = cross( normal, binormal );","mat3 tsb = mat3( tangent, binormal, normal );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec3 finalNormal = tsb * normalTex;","normal = normalize( finalNormal );","vec3 viewerDirection = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( pointLights[ i ].direction );","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","totalDiffuseLight += pointLightColor[ i ] * ( pointDiffuseWeight * attenuation );","if ( passID == 1 ) {","float pointSpecularWeight = KS_Skin_Specular( normal, pointVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += pointLightColor[ i ] * mSpecular.xyz * ( pointSpecularWeight * attenuation );","}","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","if ( passID == 1 ) {","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += directionalLights[ i ].color * mSpecular.xyz * dirSpecularWeight;","}","}","#endif","outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalSpecularLight );","if ( passID == 0 ) {","outgoingLight = sqrt( outgoingLight );","} else if ( passID == 1 ) {","#ifdef VERSION1","vec3 nonblurColor = sqrt(outgoingLight );","#else","vec3 nonblurColor = outgoingLight;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;","outgoingLight = vec3( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color );","outgoingLight *= sqrt( colDiffuse.xyz );","outgoingLight += ambientLightColor * diffuse * colDiffuse.xyz + totalSpecularLight;","#ifndef VERSION1","outgoingLight = sqrt( outgoingLight );","#endif","}","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",Nh.fog_fragment,"}"].join("\n"),["#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Nh.common,Nh.fog_pars_vertex,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif",Nh.fog_vertex,"}"].join("\n"),["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Nh.common,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {","return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n"),Lu.merge([Lh.fog,Lh.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new Ts(15658734)},specular:{value:new Ts(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new Cs(1,1)},uRepeatOverlay:{value:new Cs(1,1)},uOffset:{value:new Cs(0,0)}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Nh.common,Nh.bsdfs,Nh.lights_pars_begin,Nh.shadowmap_pars_fragment,Nh.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",Nh.fog_fragment,"}"].join("\n"),["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Nh.shadowmap_pars_vertex,Nh.fog_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",Nh.shadowmap_vertex,Nh.fog_vertex,"}"].join("\n"),new ss,new Ts(15658734),new Ts(328965),new Ts(16777215),["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n"),new ss,new Ts(15658734),new Ts(328965),new Ts(15658734),new Ts(8421504),new Ts(0),new Ts(0),new Ts(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n"),new ss,new Ts(15658734),new Ts(328965),new Ts(16777215),new Ts(0),new Ts(0),new Ts(0),new Ts(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n"),new ss,new Ts(15658734),new Ts(328965),new Ts(16777215),new Ts(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n");var Sy=function(t){void 0==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());for(this.perm=[],e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};Sy.prototype.dot=function(t,e,n){return t[0]*e+t[1]*n},Sy.prototype.dot3=function(t,e,n,r){return t[0]*e+t[1]*n+t[2]*r},Sy.prototype.dot4=function(t,e,n,r,i){return t[0]*e+t[1]*n+t[2]*r+t[3]*i},Sy.prototype.noise=function(t,e){var n,r,i=(t+e)*(.5*(Math.sqrt(3)-1)),o=Math.floor(t+i),a=Math.floor(e+i),s=(3-Math.sqrt(3))/6,c=(o+a)*s,u=t-(o-c),l=e-(a-c);u>l?(n=1,r=0):(n=0,r=1);var h=u-n+s,d=l-r+s,p=u-1+2*s,f=l-1+2*s,m=255&o,v=255&a,g=this.perm[m+n+this.perm[v+r]]%12,y=this.perm[m+1+this.perm[v+1]]%12,b=.5-u*u-l*l,x=.5-h*h-d*d,w=.5-p*p-f*f;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[this.perm[m+this.perm[v]]%12],u,l))+(x<0?0:(x*=x)*x*this.dot(this.grad3[g],h,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[y],p,f)))},Sy.prototype.noise3d=function(t,e,n){var r,i,o,a,s,c,u=(t+e+n)*(1/3),l=Math.floor(t+u),h=Math.floor(e+u),d=Math.floor(n+u),p=(l+h+d)*(1/6),f=t-(l-p),m=e-(h-p),v=n-(d-p);f>=m?m>=v?(r=1,i=0,o=0,a=1,s=1,c=0):f>=v?(r=1,i=0,o=0,a=1,s=0,c=1):(r=0,i=0,o=1,a=1,s=0,c=1):m<v?(r=0,i=0,o=1,a=0,s=1,c=1):f<v?(r=0,i=1,o=0,a=0,s=1,c=1):(r=0,i=1,o=0,a=1,s=1,c=0);var g=f-r+1/6,y=m-i+1/6,b=v-o+1/6,x=f-a+1/6*2,w=m-s+1/6*2,_=v-c+1/6*2,S=f-1+.5,T=m-1+.5,M=v-1+.5,A=255&l,E=255&h,C=255&d,P=this.perm[A+r+this.perm[E+i+this.perm[C+o]]]%12,O=this.perm[A+a+this.perm[E+s+this.perm[C+c]]]%12,N=this.perm[A+1+this.perm[E+1+this.perm[C+1]]]%12,L=.6-f*f-m*m-v*v,I=.6-g*g-y*y-b*b,R=.6-x*x-w*w-_*_,D=.6-S*S-T*T-M*M;return 32*((L<0?0:(L*=L)*L*this.dot3(this.grad3[this.perm[A+this.perm[E+this.perm[C]]]%12],f,m,v))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[P],g,y,b))+(R<0?0:(R*=R)*R*this.dot3(this.grad3[O],x,w,_))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[N],S,T,M)))},Sy.prototype.noise4d=function(t,e,n,r){var i,o,a,s,c,u,l,h,d,p,f,m,v=this.grad4,g=this.simplex,y=this.perm,b=(Math.sqrt(5)-1)/4,x=(5-Math.sqrt(5))/20,w=(t+e+n+r)*b,_=Math.floor(t+w),S=Math.floor(e+w),T=Math.floor(n+w),M=Math.floor(r+w),A=(_+S+T+M)*x,E=t-(_-A),C=e-(S-A),P=n-(T-A),O=r-(M-A),N=(E>C?32:0)+(E>P?16:0)+(C>P?8:0)+(E>O?4:0)+(C>O?2:0)+(P>O?1:0),L=E-(i=g[N][0]>=3?1:0)+x,I=C-(o=g[N][1]>=3?1:0)+x,R=P-(a=g[N][2]>=3?1:0)+x,D=O-(s=g[N][3]>=3?1:0)+x,F=E-(c=g[N][0]>=2?1:0)+2*x,U=C-(u=g[N][1]>=2?1:0)+2*x,k=P-(l=g[N][2]>=2?1:0)+2*x,j=O-(h=g[N][3]>=2?1:0)+2*x,B=E-(d=g[N][0]>=1?1:0)+3*x,z=C-(p=g[N][1]>=1?1:0)+3*x,V=P-(f=g[N][2]>=1?1:0)+3*x,G=O-(m=g[N][3]>=1?1:0)+3*x,H=E-1+4*x,W=C-1+4*x,X=P-1+4*x,q=O-1+4*x,Y=255&_,Z=255&S,J=255&T,Q=255&M,K=y[Y+i+y[Z+o+y[J+a+y[Q+s]]]]%32,$=y[Y+c+y[Z+u+y[J+l+y[Q+h]]]]%32,tt=y[Y+d+y[Z+p+y[J+f+y[Q+m]]]]%32,et=y[Y+1+y[Z+1+y[J+1+y[Q+1]]]]%32,nt=.6-E*E-C*C-P*P-O*O,rt=.6-L*L-I*I-R*R-D*D,it=.6-F*F-U*U-k*k-j*j,ot=.6-B*B-z*z-V*V-G*G,at=.6-H*H-W*W-X*X-q*q;return 27*((nt<0?0:(nt*=nt)*nt*this.dot4(v[y[Y+y[Z+y[J+y[Q]]]]%32],E,C,P,O))+(rt<0?0:(rt*=rt)*rt*this.dot4(v[K],L,I,R,D))+(it<0?0:(it*=it)*it*this.dot4(v[$],F,U,k,j))+(ot<0?0:(ot*=ot)*ot*this.dot4(v[tt],B,z,V,G))+(at<0?0:(at*=at)*at*this.dot4(v[et],H,W,X,q)))};var Ty=function(t,e,n){this._scene=t,this._trackInfo=e,this._onUpdate=n,this._mixer=new jp(t),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]};Ty.prototype={constructor:Ty,init:function(t){for(var e=[],n=this._trackInfo,r=0,i=n.length;r!==i;++r){var o=n[r];e.push(this._addTrack(o.type,o.propertyPath,o.initialValue,o.interpolation))}this._clip=new _u("editclip",0,e),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(t){this._action.time=t,this._mixer.update(0),this._onUpdate()},setDuration:function(t){this._clip.duration=t},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(t){return this._tracks[t].times},setKeyframe:function(t,e){var n=this._tracks[t],r=n.times,i=Timeliner.binarySearch(r,e),o=n.values,a=n.getValueSize(),s=i*a;if(i<0){s=(i=~i)*a;for(var c=o.length+a,u=r.length+1-1;u!==i;--u)r[u]=r[u-1];u=c-1;for(var l=s+a-1;u!==l;--u)o[u]=o[u-a]}r[i]=e,this._propRefs[t].getValue(o,s)},delKeyframe:function(t,e){var n=this._tracks[t],r=n.times,i=Timeliner.binarySearch(r,e);if(r.length>1&&i>=0){for(var o=r.length-1,a=n.values,s=n.getValueSize(),c=a.length-s,u=i;u!==o;++u)r[u]=r[u+1];r.pop();for(var l=i*s;l!==c;++l)a[l]=a[l+s];a.length=c}},moveKeyframe:function(t,e,n,r){var i=this._tracks[t],o=i.times,a=Timeliner.binarySearch(o,e);if(a>=0){for(var s=r?o.length:a+1,c=o[a-1]<=e||!r&&e>=o[a+1];a!==s;)o[a++]+=n;c&&this._sort(i)}},serialize:function(){for(var t={duration:this._clip.duration,channels:{}},e=this._channelNames,n=this._tracks,r=t.channels,i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a];r[a]={times:s.times,values:s.values}}return t},deserialize:function(t){var e=this._channelNames,n=this._tracks,r=t.channels;this.setDuration(t.duration);for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a],c=r[a];this._setArray(s.times,c.times),this._setArray(s.values,c.values)}this.setDisplayTime(this._mixer.time)},_sort:function(t){var e=t.times,n=bu.getKeyframeOrder(e);this._setArray(e,bu.sortedArray(e,1,n));var r=t.values,i=t.getValueSize();this._setArray(r,bu.sortedArray(r,i,n))},_setArray:function(t,e){t.length=0,t.push.apply(t,e)},_addTrack:function(t,e,n,r){var i=new t(e,[0],n,r);return i.times=Array.prototype.slice.call(i.times),i.values=Array.prototype.slice.call(i.values),this._channelNames.push(e),this._tracks[e]=i,this._propRefs[e]=new Dh(this._scene,e),i}};var My={quicksortIP:function(t,e,n){for(var r,i,o=[],a=-1,s=0,c=t.length/e-1,u=0,l=0,h=0,d=function(n,r){for(n*=e,r*=e,h=0;h<e;h++)u=t[n+h],t[n+h]=t[r+h],t[r+h]=u},p=new Float32Array(e),f=new Float32Array(e);;)if(c-s<=25){for(i=s+1;i<=c;i++){for(l=0;l<e;l++)p[l]=t[i*e+l];for(r=i-1;r>=s&&t[r*e+n]>p[n];){for(l=0;l<e;l++)t[(r+1)*e+l]=t[r*e+l];r--}for(l=0;l<e;l++)t[(r+1)*e+l]=p[l]}if(-1==a)break;c=o[a--],s=o[a--]}else{for(i=c,d(s+c>>1,r=s+1),t[s*e+n]>t[c*e+n]&&d(s,c),t[r*e+n]>t[c*e+n]&&d(r,c),t[s*e+n]>t[r*e+n]&&d(s,r),l=0;l<e;l++)f[l]=t[r*e+l];for(;;){do{r++}while(t[r*e+n]<f[n]);do{i--}while(t[i*e+n]>f[n]);if(i<r)break;d(r,i)}for(l=0;l<e;l++)t[(s+1)*e+l]=t[i*e+l],t[i*e+l]=f[l];c-r+1>=i-s?(o[++a]=r,o[++a]=c,c=i-1):(o[++a]=s,o[++a]=i-1,s=r)}return t},Kdtree:function(t,e,n){var r=this,i=0,o=function(t,e){return t.subarray(e*n,e*n+n)};this.root=function t(e,a,s,c){var u,l,h=a%n,d=e.length/n;return a>i&&(i=a),0===d?null:1===d?new r.Node(o(e,0),a,s,c):(My.quicksortIP(e,n,h),u=Math.floor(d/2),(l=new r.Node(o(e,u),a,s,u+c)).left=t(e.subarray(0,u*n),a+1,l,c),l.right=t(e.subarray((u+1)*n,e.length),a+1,l,c+u+1),l)}(t,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(t,i,o){var a,s,c;if(c=new My.Kdtree.BinaryHeap(function(t){return-t[1]}),o)for(a=0;a<i;a+=1)c.push([null,o]);for(function r(o){var a,s,u,l,h=o.depth%n,d=e(t,o.obj),p=[];function f(t,e){c.push([t,e]),c.size()>i&&c.pop()}for(l=0;l<n;l+=1)p[l]=l===o.depth%n?t[l]:o.obj[l];s=e(p,o.obj),null!==o.right||null!==o.left?(r(a=null===o.right?o.left:null===o.left?o.right:t[h]<o.obj[h]?o.left:o.right),(c.size()<i||d<c.peek()[1])&&f(o,d),(c.size()<i||Math.abs(s)<c.peek()[1])&&null!==(u=a===o.left?o.right:o.left)&&r(u)):(c.size()<i||d<c.peek()[1])&&f(o,d)}(r.root),s=[],a=0;a<i;a+=1)c.content[a][0]&&s.push([c.content[a][0],c.content[a][1]]);return s}}};My.Kdtree.prototype.Node=function(t,e,n,r){this.obj=t,this.left=null,this.right=null,this.parent=n,this.depth=e,this.pos=r},My.Kdtree.BinaryHeap=function(t){this.content=[],this.scoreFunction=t},My.Kdtree.BinaryHeap.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var r=this.content.pop();return void(n!=e-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i=2*(t+1),o=i-1,a=null;if(o<e){var s=this.scoreFunction(this.content[o]);s<r&&(a=o)}if(i<e&&this.scoreFunction(this.content[i])<(null===a?r:s)&&(a=i),null===a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}};var Ay,Ey,Cy={merge:function(t,e,n){var r;console.warn("GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e instanceof Kc&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},randomPointInTriangle:function(){var t=new ss;return function(e,n,r){var i=new ss,o=Math.random(),a=Math.random();o+a>1&&(o=1-o,a=1-a);var s=1-o-a;return i.copy(e),i.multiplyScalar(o),t.copy(n),t.multiplyScalar(a),i.add(t),t.copy(r),t.multiplyScalar(s),i.add(t),i}}(),randomPointInFace:function(t,e){return Cy.randomPointInTriangle(e.vertices[t.a],e.vertices[t.b],e.vertices[t.c])},randomPointsInGeometry:function(t,e){var n,r,i=t.faces,o=t.vertices,a=i.length,s=0,c=[];for(r=0;r<a;r++)(n=i[r])._area=Cy.triangleArea(o[n.a],o[n.b],o[n.c]),c[r]=s+=n._area;var u,l,h=[];for(r=0;r<e;r++)l=Math.random()*s,u=function t(e,n){if(n<e)return e;var r=e+Math.floor((n-e)/2);return c[r]>l?t(e,r-1):c[r]<l?t(r+1,n):r}(0,c.length-1),h[r]=Cy.randomPointInFace(i[u],t);return h},randomPointsInBufferGeometry:function(t,e){var n,r,i,o,a=t.attributes.position.array,s=0,c=[];r=new ss,i=new ss,o=new ss;var u=a.length/9;for(n=0;n<u;n++)r.set(a[9*n+0],a[9*n+1],a[9*n+2]),i.set(a[9*n+3],a[9*n+4],a[9*n+5]),o.set(a[9*n+6],a[9*n+7],a[9*n+8]),s+=Cy.triangleArea(r,i,o),c.push(s);var l,h,d=[];for(n=0;n<e;n++)h=Math.random()*s,l=function t(e,n){if(n<e)return e;var r=e+Math.floor((n-e)/2);return c[r]>h?t(e,r-1):c[r]<h?t(r+1,n):r}(0,c.length-1),r.set(a[9*l+0],a[9*l+1],a[9*l+2]),i.set(a[9*l+3],a[9*l+4],a[9*l+5]),o.set(a[9*l+6],a[9*l+7],a[9*l+8]),d[n]=Cy.randomPointInTriangle(r,i,o);return d},triangleArea:(Ay=new ss,Ey=new ss,function(t,e,n){return Ay.subVectors(e,t),Ey.subVectors(n,t),Ay.cross(Ey),.5*Ay.length()}),center:function(t){return console.warn("GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},Py=function(t){var e,n=this,r=void 0!==t.name&&""!==t.name,i=new Cu(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);i.position.set(0,0,2);var o,a,s=new Eu,c=cg,u=new Lu.clone(c.uniforms),l=new Iu({uniforms:u,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),h=new Kc(new Du(256,256),l);if(s.add(h),r){var d=(o=document.createElement("canvas")).getContext("2d");d.font="Bold 20px Arial";var p=d.measureText(t.name).width;o.width=p,o.height=25,d.font="Bold 20px Arial",d.fillStyle="rgba( 255, 0, 0, 1 )",d.fillText(t.name,0,20);var f=new Ou(o);f.magFilter=Ac,f.minFilter=Ac,f.needsUpdate=!0;var m=new Xc({map:f,side:uc});m.transparent=!0;var v=new Du(o.width,o.height);a=new Kc(v,m),s.add(a)}this.enabled=!0,this.size={width:256,height:256,set:function(t,e){this.width=t,this.height=e,h.scale.set(this.width/256,this.height/256,1),n.position.set(n.position.x,n.position.y)}},this.position={x:10,y:10,set:function(t,e){this.x=t,this.y=e,h.position.set(-window.innerWidth/2+n.size.width/2+this.x,window.innerHeight/2-n.size.height/2-this.y,0),r&&a.position.set(h.position.x,h.position.y-n.size.height/2+o.height/2,0)}},this.render=function(n){this.enabled&&(u.tDiffuse.value=t.shadow.map.texture,e=n.autoClear,n.autoClear=!1,n.clearDepth(),n.render(s,i),n.autoClear=e)},this.updateForWindowResize=function(){this.enabled&&(i.left=window.innerWidth/-2,i.right=window.innerWidth/2,i.top=window.innerHeight/2,i.bottom=window.innerHeight/-2,i.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()};Py.prototype.constructor=Py;var Oy=function(t,e,n){var r=this;this.volume=t,e=e||0,Object.defineProperty(this,"index",{get:function(){return e},set:function(t){return e=t,r.geometryNeedsUpdate=!0,e}}),this.axis=n||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new Ou(this.canvas);i.minFilter=Ac,i.wrapS=i.wrapT=Sc;var o=new Xc({map:i,side:uc,transparent:!0});this.mesh=new Kc(this.geometry,o),this.geometryNeedsUpdate=!0,this.repaint()};Oy.prototype={constructor:Oy,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var t=this.iLength,e=this.jLength,n=this.sliceAccess,r=this.volume,i=this.canvasBuffer,o=this.ctxBuffer,a=o.getImageData(0,0,t,e),s=a.data,c=r.data,u=r.upperThreshold,l=r.lowerThreshold,h=r.windowLow,d=r.windowHigh,p=0;if("label"===r.dataType)for(var f=0;f<e;f++)for(var m=0;m<t;m++){var v=c[n(m,f)],g=this.colorMap[v=v>=this.colorMap.length?v%this.colorMap.length+1:v];s[4*p]=g>>24&255,s[4*p+1]=g>>16&255,s[4*p+2]=g>>8&255,s[4*p+3]=255&g,p++}else for(f=0;f<e;f++)for(m=0;m<t;m++){var y=c[n(m,f)],b=255;b=u>=y&&l<=y?b:0,y=Math.floor(255*(y-h)/(d-h)),s[4*p]=y=y>255?255:y<0?0:0|y,s[4*p+1]=y,s[4*p+2]=y,s[4*p+3]=b,p++}o.putImageData(a,0,0),this.ctx.drawImage(i,0,0,t,e,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var t=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=t.sliceAccess,this.jLength=t.jLength,this.iLength=t.iLength,this.matrix=t.matrix,this.canvas.width=t.planeWidth,this.canvas.height=t.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry=new Ru(t.planeWidth,t.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix=(new as).identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}};var Ny=function(){ys.call(this);var t,e=this,n=[0,0],r=!1,i=new ss;this.matrixAutoUpdate=!1,this.getGamepad=function(){return t},this.getTouchpadState=function(){return r},this.update=function(){if(void 0!==(t=function(){for(var t=navigator.getGamepads&&navigator.getGamepads(),e=0;e<4;e++){var n=t[e];if(n&&"Daydream Controller"===n.id)return n}}())&&void 0!==t.pose){var o=t.pose;if(null===o)return;null!==o.orientation&&e.quaternion.fromArray(o.orientation),e.updateMatrix(),e.visible=!0,null===o.angularVelocity||i.equals(o.angularVelocity)||(i.fromArray(o.angularVelocity),e.dispatchEvent({type:"angularvelocitychanged",angularVelocity:i})),n[0]===t.axes[0]&&n[1]===t.axes[1]||(n[0]=t.axes[0],n[1]=t.axes[1],e.dispatchEvent({type:"axischanged",axes:n})),r!==t.buttons[0].pressed&&e.dispatchEvent({type:(r=t.buttons[0].pressed)?"touchpaddown":"touchpadup"})}else e.visible=!1},this.getTouchPadState=function(){return console.warn("DaydreamController: getTouchPadState() is now getTouchpadState()"),r}};(Ny.prototype=Object.create(ys.prototype)).constructor=Ny;var Ly=function(){ys.call(this);var t,e=this,n=[0,0],r=!1,i=!1,o=new ss;this.matrixAutoUpdate=!0,this.getGamepad=function(){return t},this.getTouchpadState=function(){return r},this.update=function(){if(void 0!==(t=function(){for(var t=navigator.getGamepads&&navigator.getGamepads(),e=0;e<4;e++){var n=t[e];if(n&&"Gear VR Controller"===n.id)return n}}())&&void 0!==t.pose){var a=t.pose;if(null===a)return;null!==a.orientation&&e.quaternion.fromArray(a.orientation),e.updateMatrix(),e.visible=!0,null===a.angularVelocity||o.equals(a.angularVelocity)||(o.fromArray(a.angularVelocity),e.dispatchEvent({type:"angularvelocitychanged",angularVelocity:o})),n[0]===t.axes[0]&&n[1]===t.axes[1]||(n[0]=t.axes[0],n[1]=t.axes[1],e.dispatchEvent({type:"axischanged",axes:n})),r!==t.buttons[0].pressed&&e.dispatchEvent({type:(r=t.buttons[0].pressed)?"touchpaddown":"touchpadup",axes:n}),i!==t.buttons[1].pressed&&e.dispatchEvent({type:(i=t.buttons[1].pressed)?"triggerdown":"triggerup"})}else e.visible=!1},this.getTouchPadState=function(){return console.warn("GearVRController: getTouchPadState() is now getTouchpadState()"),r},this.setHand=function(){console.warn("GearVRController: setHand() has been removed.")}};(Ly.prototype=Object.create(ys.prototype)).constructor=Ly;var Iy=function(t){ys.call(this);var e,n=this,r=[0,0],i=!1,o=!1,a=!1,s=!1;this.matrixAutoUpdate=!1,this.standingMatrix=new as,this.getGamepad=function(){return e},this.getButtonState=function(t){return"thumbpad"===t?i:"trigger"===t?o:"grips"===t?a:"menu"===t?s:void 0},this.update=function(){if(void 0!==(e=function(t){for(var e=navigator.getGamepads&&navigator.getGamepads(),n=0,r=0;n<e.length;n++){var i=e[n];if(i&&("OpenVR Gamepad"===i.id||i.id.startsWith("Oculus Touch")||i.id.startsWith("Spatial Controller"))){if(r===t)return i;r++}}}(t))&&void 0!==e.pose){if(null===e.pose)return;var c=e.pose;null!==c.position&&n.position.fromArray(c.position),null!==c.orientation&&n.quaternion.fromArray(c.orientation),n.matrix.compose(n.position,n.quaternion,n.scale),n.matrix.premultiply(n.standingMatrix),n.matrixWorldNeedsUpdate=!0,n.visible=!0,r[0]===e.axes[0]&&r[1]===e.axes[1]||(r[0]=e.axes[0],r[1]=e.axes[1],n.dispatchEvent({type:"axischanged",axes:r})),i!==e.buttons[0].pressed&&n.dispatchEvent({type:(i=e.buttons[0].pressed)?"thumbpaddown":"thumbpadup",axes:r}),o!==e.buttons[1].pressed&&n.dispatchEvent({type:(o=e.buttons[1].pressed)?"triggerdown":"triggerup"}),a!==e.buttons[2].pressed&&n.dispatchEvent({type:(a=e.buttons[2].pressed)?"gripsdown":"gripsup"}),s!==e.buttons[3].pressed&&n.dispatchEvent({type:(s=e.buttons[3].pressed)?"menudown":"menuup"})}else n.visible=!1}};function Ry(t,e,n,r){Ls.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new Dy(t,e,n,r)),this.mergeVertices()}function Dy(t,e,n,r){Xs.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o,a=[],s=[],c=[],u=[],l=new ss,h=new Cs;for(s.push(0,0,0),c.push(0,0,1),u.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var d=n+o/e*r;l.x=t*Math.cos(d),l.y=t*Math.sin(d),s.push(l.x,l.y,l.z),c.push(0,0,1),h.x=(s[i]/t+1)/2,h.y=(s[i+1]/t+1)/2,u.push(h.x,h.y)}for(i=1;i<=e;i++)a.push(i,i+1,0);this.setIndex(a),this.addAttribute("position",new Vs(s,3)),this.addAttribute("normal",new Vs(c,3)),this.addAttribute("uv",new Vs(u,2))}function Fy(t,e){Ls.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Uy(t,e)),this.mergeVertices()}function Uy(t,e){var n=(1+Math.sqrt(5))/2;Tl.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ky(t,e,n,r,i,o,a,s){ql.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function jy(t,e,n,r,i,o){ky.call(this,t,e,n,n,r,i,o),this.type="ArcCurve"}function By(){var t=0,e=0,n=0,r=0;function i(i,o,a,s){t=i,e=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,a,s){var c=(e-t)/o-(n-t)/(o+a)+(n-e)/a,u=(n-e)/a-(r-e)/(a+s)+(r-n)/s;i(e,n,c*=a,u*=a)},calc:function(i){var o=i*i;return t+e*i+n*o+r*(o*i)}}}(Iy.prototype=Object.create(ys.prototype)).constructor=Iy,(Ry.prototype=Object.create(Ls.prototype)).constructor=Ry,(Dy.prototype=Object.create(Xs.prototype)).constructor=Dy,(Fy.prototype=Object.create(Ls.prototype)).constructor=Fy,(Uy.prototype=Object.create(Tl.prototype)).constructor=Uy,(ky.prototype=Object.create(ql.prototype)).constructor=ky,ky.prototype.isEllipseCurve=!0,ky.prototype.getPoint=function(t,e){for(var n=e||new Cs,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,d=c-this.aY;s=h*u-d*l+this.aX,c=h*l+d*u+this.aY}return n.set(s,c)},ky.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ky.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},ky.prototype.fromJSON=function(t){return ql.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},(jy.prototype=Object.create(ky.prototype)).constructor=jy,jy.prototype.isArcCurve=!0;var zy=new ss,Vy=new By,Gy=new By,Hy=new By;function Wy(t,e,n,r){ql.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Xy(t,e,n,r,i){var o=.5*(r-e),a=.5*(i-n),s=t*t;return(2*n-2*r+o+a)*(t*s)+(-3*n+3*r-2*o-a)*s+o*t+n}function qy(t,e,n,r){return function(t,n){var r=1-t;return r*r*e}(t)+function(t,e){return 2*(1-t)*t*n}(t)+function(t,e){return t*t*r}(t)}function Yy(t,e,n,r,i){return function(t,n){var r=1-t;return r*r*r*e}(t)+function(t,e){var r=1-t;return 3*r*r*t*n}(t)+function(t,e){return 3*(1-t)*t*t*r}(t)+function(t,e){return t*t*t*i}(t)}function Zy(t,e,n,r){ql.call(this),this.type="CubicBezierCurve",this.v0=t||new Cs,this.v1=e||new Cs,this.v2=n||new Cs,this.v3=r||new Cs}function Jy(t,e,n,r){ql.call(this),this.type="CubicBezierCurve3",this.v0=t||new ss,this.v1=e||new ss,this.v2=n||new ss,this.v3=r||new ss}function Qy(t,e){ql.call(this),this.type="LineCurve",this.v1=t||new Cs,this.v2=e||new Cs}function Ky(t,e){ql.call(this),this.type="LineCurve3",this.v1=t||new ss,this.v2=e||new ss}function $y(t,e,n){ql.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Cs,this.v1=e||new Cs,this.v2=n||new Cs}function tb(t,e,n){ql.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new ss,this.v1=e||new ss,this.v2=n||new ss}function eb(t){ql.call(this),this.type="SplineCurve",this.points=t||[]}(Wy.prototype=Object.create(ql.prototype)).constructor=Wy,Wy.prototype.isCatmullRomCurve3=!0,Wy.prototype.getPoint=function(t,e){var n,r,i,o,a=e||new ss,s=this.points,c=s.length,u=(c-(this.closed?0:1))*t,l=Math.floor(u),h=u-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s.length)+1)*s.length:0===h&&l===c-1&&(l=c-2,h=1),this.closed||l>0?n=s[(l-1)%c]:(zy.subVectors(s[0],s[1]).add(s[0]),n=zy),r=s[l%c],i=s[(l+1)%c],this.closed||l+2<c?o=s[(l+2)%c]:(zy.subVectors(s[c-1],s[c-2]).add(s[c-1]),o=zy),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(n.distanceToSquared(r),d),f=Math.pow(r.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Vy.initNonuniformCatmullRom(n.x,r.x,i.x,o.x,p,f,m),Gy.initNonuniformCatmullRom(n.y,r.y,i.y,o.y,p,f,m),Hy.initNonuniformCatmullRom(n.z,r.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(Vy.initCatmullRom(n.x,r.x,i.x,o.x,this.tension),Gy.initCatmullRom(n.y,r.y,i.y,o.y,this.tension),Hy.initCatmullRom(n.z,r.z,i.z,o.z,this.tension));return a.set(Vy.calc(h),Gy.calc(h),Hy.calc(h)),a},Wy.prototype.copy=function(t){ql.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Wy.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Wy.prototype.fromJSON=function(t){ql.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new ss).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},(Zy.prototype=Object.create(ql.prototype)).constructor=Zy,Zy.prototype.isCubicBezierCurve=!0,Zy.prototype.getPoint=function(t,e){var n=e||new Cs,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Yy(t,r.x,i.x,o.x,a.x),Yy(t,r.y,i.y,o.y,a.y)),n},Zy.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Zy.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Zy.prototype.fromJSON=function(t){return ql.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(Jy.prototype=Object.create(ql.prototype)).constructor=Jy,Jy.prototype.isCubicBezierCurve3=!0,Jy.prototype.getPoint=function(t,e){var n=e||new ss,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Yy(t,r.x,i.x,o.x,a.x),Yy(t,r.y,i.y,o.y,a.y),Yy(t,r.z,i.z,o.z,a.z)),n},Jy.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Jy.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Jy.prototype.fromJSON=function(t){return ql.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(Qy.prototype=Object.create(ql.prototype)).constructor=Qy,Qy.prototype.isLineCurve=!0,Qy.prototype.getPoint=function(t,e){var n=e||new Cs;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Qy.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Qy.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Qy.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Qy.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Qy.prototype.fromJSON=function(t){return ql.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(Ky.prototype=Object.create(ql.prototype)).constructor=Ky,Ky.prototype.isLineCurve3=!0,Ky.prototype.getPoint=function(t,e){var n=e||new ss;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Ky.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Ky.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ky.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ky.prototype.fromJSON=function(t){return ql.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},($y.prototype=Object.create(ql.prototype)).constructor=$y,$y.prototype.isQuadraticBezierCurve=!0,$y.prototype.getPoint=function(t,e){var n=e||new Cs,r=this.v0,i=this.v1,o=this.v2;return n.set(qy(t,r.x,i.x,o.x),qy(t,r.y,i.y,o.y)),n},$y.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},$y.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},$y.prototype.fromJSON=function(t){return ql.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(tb.prototype=Object.create(ql.prototype)).constructor=tb,tb.prototype.isQuadraticBezierCurve3=!0,tb.prototype.getPoint=function(t,e){var n=e||new ss,r=this.v0,i=this.v1,o=this.v2;return n.set(qy(t,r.x,i.x,o.x),qy(t,r.y,i.y,o.y),qy(t,r.z,i.z,o.z)),n},tb.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},tb.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},tb.prototype.fromJSON=function(t){return ql.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(eb.prototype=Object.create(ql.prototype)).constructor=eb,eb.prototype.isSplineCurve=!0,eb.prototype.getPoint=function(t,e){var n=e||new Cs,r=this.points,i=(r.length-1)*t,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return n.set(Xy(a,s.x,c.x,u.x,l.x),Xy(a,s.y,c.y,u.y,l.y)),n},eb.prototype.copy=function(t){ql.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this},eb.prototype.toJSON=function(){var t=ql.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t},eb.prototype.fromJSON=function(t){ql.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new Cs).fromArray(r))}return this};var nb={ArcCurve:jy,CatmullRomCurve3:Wy,CubicBezierCurve:Zy,CubicBezierCurve3:Jy,EllipseCurve:ky,LineCurve:Qy,LineCurve3:Ky,QuadraticBezierCurve:$y,QuadraticBezierCurve3:tb,SplineCurve:eb};function rb(){ql.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function ib(t){rb.call(this),this.type="Path",this.currentPoint=new Cs,t&&this.setFromPoints(t)}function ob(t){ib.call(this,t),this.uuid=os.generateUUID(),this.type="Shape",this.holes=[]}function ab(t,e,n,r,i){var o,a;if(i===function(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Tb(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Tb(o,t[o],t[o+1],a);return a&&xb(a,a.next)&&(Mb(a),a=a.next),a}function sb(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!xb(r,r.next)&&0!==bb(r.prev,r,r.next))r=r.next;else{if(Mb(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function cb(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=mb(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,c,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(t,r,i,o);for(var s,c,u=t;t.prev!==t.next;)if(s=t.prev,c=t.next,o?lb(t,r,i,o):ub(t))e.push(s.i/n),e.push(t.i/n),e.push(c.i/n),Mb(t),t=c.next,u=c.next;else if((t=c)===u){a?1===a?cb(t=hb(t,e,n),e,n,r,i,o,2):2===a&&db(t,e,n,r,i,o):cb(sb(t),e,n,r,i,o,1);break}}}function ub(t){var e=t.prev,n=t,r=t.next;if(bb(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(gb(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&bb(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function lb(t,e,n,r){var i=t.prev,o=t,a=t.next;if(bb(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=mb(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),l=mb(s,c,e,n,r),h=t.nextZ;h&&h.z<=l;){if(h!==t.prev&&h!==t.next&&gb(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&bb(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(h=t.prevZ;h&&h.z>=u;){if(h!==t.prev&&h!==t.next&&gb(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&bb(h.prev,h,h.next)>=0)return!1;h=h.prevZ}return!0}function hb(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!xb(i,o)&&wb(i,r,r.next,o)&&_b(i,o)&&_b(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Mb(r),Mb(r.next),r=t=o),r=r.next}while(r!==t);return r}function db(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&yb(a,s)){var c=Sb(a,s);return a=sb(a,a.next),c=sb(c,c.next),cb(a,e,n,r,i,o),void cb(c,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function pb(t,e){return t.x-e.x}function fb(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var c,u=n,l=n.x,h=n.y,d=1/0;for(r=n.next;r!==u;)i>=r.x&&r.x>=l&&i!==r.x&&gb(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&((c=Math.abs(o-r.y)/(i-r.x))<d||c===d&&r.x>n.x)&&_b(r,t)&&(n=r,d=c),r=r.next;return n}(t,e)){var n=Sb(e,t);sb(n,n.next)}}function mb(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vb(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function gb(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function yb(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&wb(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&_b(t,e)&&_b(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function bb(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function xb(t,e){return t.x===e.x&&t.y===e.y}function wb(t,e,n,r){return!!(xb(t,e)&&xb(n,r)||xb(t,r)&&xb(n,e))||bb(t,e,n)>0!=bb(t,e,r)>0&&bb(n,r,t)>0!=bb(n,r,e)>0}function _b(t,e){return bb(t.prev,t,t.next)<0?bb(t,e,t.next)>=0&&bb(t,t.prev,e)>=0:bb(t,e,t.prev)<0||bb(t,t.next,e)<0}function Sb(t,e){var n=new Ab(t.i,t.x,t.y),r=new Ab(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Tb(t,e,n,r){var i=new Ab(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Mb(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ab(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}rb.prototype=Object.assign(Object.create(ql.prototype),{constructor:rb,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new nb.LineCurve(e,t))},getPoint:function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=e){var i=n[r]-e,o=this.curves[r],a=o.getLength();return o.getPointAt(0===a?0:1-i/a)}r++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o.getPoints(o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t),s=0;s<a.length;s++){var c=a[s];e&&e.equals(c)||(n.push(c),e=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){ql.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=ql.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){ql.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push((new nb[r.type]).fromJSON(r))}return this}}),ib.prototype=Object.assign(Object.create(rb.prototype),{constructor:ib,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var n=new Qy(this.currentPoint.clone(),new Cs(t,e));this.curves.push(n),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,n,r){var i=new $y(this.currentPoint.clone(),new Cs(t,e),new Cs(n,r));this.curves.push(i),this.currentPoint.set(n,r)},bezierCurveTo:function(t,e,n,r,i,o){var a=new Zy(this.currentPoint.clone(),new Cs(t,e),new Cs(n,r),new Cs(i,o));this.curves.push(a),this.currentPoint.set(i,o)},splineThru:function(t){var e=new eb([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,n,r,i,o){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o)},absarc:function(t,e,n,r,i,o){this.absellipse(t,e,n,n,r,i,o)},ellipse:function(t,e,n,r,i,o,a,s){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o,a,s)},absellipse:function(t,e,n,r,i,o,a,s){var c=new ky(t,e,n,r,i,o,a,s);if(this.curves.length>0){var u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);var l=c.getPoint(1);this.currentPoint.copy(l)},copy:function(t){return rb.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=rb.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return rb.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),ob.prototype=Object.assign(Object.create(ib.prototype),{constructor:ob,getPointsHoles:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){ib.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=ib.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){ib.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push((new ib).fromJSON(r))}return this}});var Eb={area:function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return Eb.area(t)<0},triangulateShape:function(t,e){var n=[],r=[],i=[];Cb(t),Pb(n,t);var o=t.length;e.forEach(Cb);for(var a=0;a<e.length;a++)r.push(o),o+=e[a].length,Pb(n,e[a]);var s=function(t,e,n){n=n||2;var r,i,o,a,s,c,u,l=e&&e.length,h=l?e[0]*n:t.length,d=ab(t,0,h,n,!0),p=[];if(!d)return p;if(l&&(d=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=ab(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(vb(a));for(s.sort(pb),i=0;i<s.length;i++)fb(s[i],n),n=sb(n,n.next);return n}(t,e,d,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var f=n;f<h;f+=n)c=t[f+1],(s=t[f])<r&&(r=s),c<i&&(i=c),s>o&&(o=s),c>a&&(a=c);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return cb(d,p,n,r,i,u),p}(n,r);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function Cb(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Pb(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function Ob(t,e){Ls.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Nb(t,e)),this.mergeVertices()}function Nb(t,e){Xs.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var n=[],r=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(t))u(t);else for(var c=0;c<t.length;c++)u(t[c]),this.addGroup(a,s,c),a+=s,s=0;function u(t){var a,c,u,l=r.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;if(!1===Eb.isClockWise(d))for(d=d.reverse(),a=0,c=p.length;a<c;a++)!0===Eb.isClockWise(u=p[a])&&(p[a]=u.reverse());var f=Eb.triangulateShape(d,p);for(a=0,c=p.length;a<c;a++)d=d.concat(u=p[a]);for(a=0,c=d.length;a<c;a++){var m=d[a];r.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,c=f.length;a<c;a++){var v=f[a];n.push(v[0]+l,v[1]+l,v[2]+l),s+=3}}this.setIndex(n),this.addAttribute("position",new Vs(r,3)),this.addAttribute("normal",new Vs(i,3)),this.addAttribute("uv",new Vs(o,2))}function Lb(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++)e.shapes.push(t[n].uuid);else e.shapes.push(t.uuid);return e}(Ob.prototype=Object.create(Ls.prototype)).constructor=Ob,Ob.prototype.toJSON=function(){var t=Ls.prototype.toJSON.call(this);return Lb(this.parameters.shapes,t)},(Nb.prototype=Object.create(Xs.prototype)).constructor=Nb,Nb.prototype.toJSON=function(){var t=Xs.prototype.toJSON.call(this);return Lb(this.parameters.shapes,t)};var Ib,Rb,Db,Fb,Ub=function(t){Iy.call(this,t);var e=2*Math.PI,n=0,r=new Ts(1,1,1),i=1,o=new Kc(a=new Ry(1,32),l=new Xc({map:function(){var t=document.createElement("canvas");t.width=256,t.height=256;for(var n=t.getContext("2d"),r=n.getImageData(0,0,256,256),i=r.data,o=new Ts,a=0,s=0;a<i.length;a+=4,s++){var c=s%256/256-.5,u=Math.floor(s/256)/256-.5;o.setHSL(Math.atan2(u,c)/e,1,2*(.5-Math.sqrt(c*c+u*u))),i[a+0]=256*o.r,i[a+1]=256*o.g,i[a+2]=256*o.b,i[a+3]=256}return n.putImageData(r,0,0),new pm(t)}()}));o.position.set(0,.005,.0495),o.rotation.x=-1.45,o.scale.setScalar(.02),this.add(o);var a=new Fy(.1,2);(l=new Xc).color=r;var s=new Kc(a,l);o.add(s);var c=new gd;c.position.set(0,.005,.0495),c.rotation.x=-1.45,c.scale.setScalar(.02),this.add(c);var u=new ob;u.moveTo(0,-1),u.lineTo(1,1),u.lineTo(-1,1);var l,h=new Kc(a=new Ob(u),l=new Xc({color:2236962,wireframe:!0}));h.position.z=.001,p(h.geometry,1),c.add(h),a=new Ob(u),(l=new Xc({side:uc})).color=r;var d=new Kc(a,l);function p(t,e){var n=Math.atan(.25),r=1.5*e,i=Math.tan(n)*r*2;t.vertices[0].set(0,-.75,0),t.vertices[1].set(0+i/2,-.75+r,0),t.vertices[2].set(0-i/2,-.75+r,0),t.verticesNeedUpdate=!0}d.position.z=.0011,p(d.geometry,.5),c.add(d),c.visible=!1,this.getColor=function(){return r},this.getSize=function(){return i},this.addEventListener("axischanged",function(t){if(!1!==this.getButtonState("thumbpad")){var o=t.axes[0]/2,a=-t.axes[1]/2;if(0===n&&(r.setHSL(Math.atan2(a,o)/e,1,2*(.5-Math.sqrt(o*o+a*a))),s.position.set(t.axes[0],t.axes[1],0)),1===n){var c=.5-a;i=2*c,p(d.geometry,c)}}}),this.addEventListener("gripsdown",function(t){return 0===n?(n=1,o.visible=!1,void(c.visible=!0)):1===n?(n=0,o.visible=!0,void(c.visible=!1)):void 0})};function kb(t){Rp.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function jb(t,e,n){ys.call(this),this.type="CubeCamera";var r=new Mu(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new ss(1,0,0)),this.add(r);var i=new Mu(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new ss(-1,0,0)),this.add(i);var o=new Mu(90,1,t,e);o.up.set(0,0,1),o.lookAt(new ss(0,1,0)),this.add(o);var a=new Mu(90,1,t,e);a.up.set(0,0,-1),a.lookAt(new ss(0,-1,0)),this.add(a);var s=new Mu(90,1,t,e);s.up.set(0,-1,0),s.lookAt(new ss(0,0,1)),this.add(s);var c=new Mu(90,1,t,e);c.up.set(0,-1,0),c.lookAt(new ss(0,0,-1)),this.add(c),this.renderTarget=new Uv(n,n,{format:Nc,magFilter:Ac,minFilter:Ac}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,n.activeCubeFace=0,t.render(e,r,n),n.activeCubeFace=1,t.render(e,i,n),n.activeCubeFace=2,t.render(e,o,n),n.activeCubeFace=3,t.render(e,a,n),n.activeCubeFace=4,t.render(e,s,n),n.texture.generateMipmaps=u,n.activeCubeFace=5,t.render(e,c,n),t.setRenderTarget(null)},this.clear=function(t,e,n,r){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,t.setRenderTarget(i),t.clear(e,n,r);t.setRenderTarget(null)}}function Bb(t,e,n){Rs.call(this,t,e),this.meshPerAttribute=n||1}function zb(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function Vb(t){this.type="Font",this.data=t}function Gb(t,e,n,r,i,o){var a=o.glyphs[t]||o.glyphs["?"];if(a){var s,c,u,l,h,d,p,f,m=new zb;if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,y=v.length;g<y;)switch(v[g++]){case"m":s=v[g++]*n+r,c=v[g++]*n+i,m.moveTo(s,c);break;case"l":s=v[g++]*n+r,c=v[g++]*n+i,m.lineTo(s,c);break;case"q":u=v[g++]*n+r,l=v[g++]*n+i,h=v[g++]*n+r,d=v[g++]*n+i,m.quadraticCurveTo(h,d,u,l);break;case"b":u=v[g++]*n+r,l=v[g++]*n+i,h=v[g++]*n+r,d=v[g++]*n+i,p=v[g++]*n+r,f=v[g++]*n+i,m.bezierCurveTo(h,d,p,f,u,l)}return{offsetX:a.ha*n,path:m}}}function Hb(t,e,n,r,i,o,a){ou.call(this,0,t,e,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function Wb(t,e,n,r,i,o,a){au.call(this,0,t,e,n,r,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function Xb(t,e){Ls.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new qb(t,e)),this.mergeVertices()}function qb(t,e){var n=(1+Math.sqrt(5))/2,r=1/n;Tl.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Yb(t,e){Xs.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var n,r,i,o,a=[],s=Math.cos(os.DEG2RAD*e),c=[0,0],u={},l=["a","b","c"];t.isBufferGeometry?(o=new Ls).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)n=m[l[v]],r=m[l[(v+1)%3]],c[0]=Math.min(n,r),c[1]=Math.max(n,r),void 0===u[i=c[0]+","+c[1]]?u[i]={index1:c[0],index2:c[1],face1:p,face2:void 0}:u[i].face2=p;for(i in u){var g=u[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];a.push(y.x,y.y,y.z),a.push((y=h[g.index2]).x,y.y,y.z)}}this.addAttribute("position",new Vs(a,3))}function Zb(t,e){Ls.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Jb(t,e)),this.mergeVertices()}function Jb(t,e){"undefined"!=typeof t&&(Xs.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function Qb(t,e,n,r){Ls.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new Kb(t,e,n,r)),this.mergeVertices()}function Kb(t,e,n,r){Xs.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e)||12,n=n||0,r=r||2*Math.PI,r=os.clamp(r,0,2*Math.PI);var i,o,a,s=[],c=[],u=[],l=1/e,h=new ss,d=new Cs;for(o=0;o<=e;o++){var p=n+o*l*r,f=Math.sin(p),m=Math.cos(p);for(a=0;a<=t.length-1;a++)h.x=t[a].x*f,h.y=t[a].y,h.z=t[a].x*m,c.push(h.x,h.y,h.z),d.x=o/e,d.y=a/(t.length-1),u.push(d.x,d.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var v=(i=a+o*t.length)+t.length,g=i+t.length+1,y=i+1;s.push(i,v,y),s.push(v,g,y)}if(this.setIndex(s),this.addAttribute("position",new Vs(c,3)),this.addAttribute("uv",new Vs(u,2)),this.computeVertexNormals(),r===2*Math.PI){var b=this.attributes.normal.array,x=new ss,w=new ss,_=new ss;for(i=e*t.length*3,o=0,a=0;o<t.length;o++,a+=3)x.x=b[a+0],x.y=b[a+1],x.z=b[a+2],w.x=b[i+a+0],w.y=b[i+a+1],w.z=b[i+a+2],_.addVectors(x,w).normalize(),b[a+0]=b[i+a+0]=_.x,b[a+1]=b[i+a+1]=_.y,b[a+2]=b[i+a+2]=_.z}}function $b(t,e,n){Ls.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new tx(t,e,n)),this.mergeVertices()}function tx(t,e,n){Xs.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};var r,i,o=[],a=[],s=[],c=[],u=new ss,l=new ss,h=new ss,d=new ss,p=new ss,f=e+1;for(r=0;r<=n;r++){var m=r/n;for(i=0;i<=e;i++){var v=i/e;t(v,m,l),a.push(l.x,l.y,l.z),v-1e-5>=0?(t(v-1e-5,m,h),d.subVectors(l,h)):(t(v+1e-5,m,h),d.subVectors(h,l)),m-1e-5>=0?(t(v,m-1e-5,h),p.subVectors(l,h)):(t(v,m+1e-5,h),p.subVectors(h,l)),u.crossVectors(d,p).normalize(),s.push(u.x,u.y,u.z),c.push(v,m)}}for(r=0;r<n;r++)for(i=0;i<e;i++){var g=r*f+i+1,y=(r+1)*f+i+1,b=(r+1)*f+i;o.push(r*f+i,g,b),o.push(g,y,b)}this.setIndex(o),this.addAttribute("position",new Vs(a,3)),this.addAttribute("normal",new Vs(s,3)),this.addAttribute("uv",new Vs(c,2))}function ex(t,e,n,r,i,o){Ls.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new nx(t,e,n,r,i,o)),this.mergeVertices()}function nx(t,e,n,r,i,o){Xs.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,c,u=[],l=[],h=[],d=[],p=t,f=(e-t)/(r=void 0!==r?Math.max(1,r):1),m=new ss,v=new Cs;for(s=0;s<=r;s++){for(c=0;c<=n;c++)a=i+c/n*o,m.x=p*Math.cos(a),m.y=p*Math.sin(a),l.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/e+1)/2,v.y=(m.y/e+1)/2,d.push(v.x,v.y);p+=f}for(s=0;s<r;s++){var g=s*(n+1);for(c=0;c<n;c++){var y=(a=c+g)+n+1,b=a+n+2,x=a+1;u.push(a,y,x),u.push(y,b,x)}}this.setIndex(u),this.addAttribute("position",new Vs(l,3)),this.addAttribute("normal",new Vs(h,3)),this.addAttribute("uv",new Vs(d,2))}function rx(t,e){Ls.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ix(t,e)),this.mergeVertices()}function ix(t,e){Tl.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ox(t,e){Ls.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new ax(t,e)),this.mergeVertices()}function ax(t,e){var n=(e=e||{}).font;if(!n||!n.isFont)return console.error("TextGeometry: font parameter is not an instance of Font."),new Ls;var r=n.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Jb.call(this,r,e),this.type="TextBufferGeometry"}function sx(t,e,n,r,i,o,a){Ls.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==a&&console.warn("TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new cx(t,e,n,r,i,o)),this.mergeVertices()}function cx(t,e,n,r,i,o){Xs.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var a,s,c=[],u=[],l=[],h=[],d=new ss,p=new ss,f=new ss,m=new ss,v=new ss,g=new ss,y=new ss;for(a=0;a<=n;++a){var b=a/n*i*Math.PI*2;for(A(b,i,o,t,f),A(b+.01,i,o,t,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=r;++s){var x=s/r*Math.PI*2,w=-e*Math.cos(x),_=e*Math.sin(x);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),u.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),l.push(p.x,p.y,p.z),h.push(a/n),h.push(s/r)}}for(s=1;s<=n;s++)for(a=1;a<=r;a++){var S=(r+1)*s+(a-1),T=(r+1)*s+a,M=(r+1)*(s-1)+a;c.push((r+1)*(s-1)+(a-1),S,M),c.push(S,T,M)}function A(t,e,n,r,i){var o=Math.cos(t),a=Math.sin(t),s=n/e*t,c=Math.cos(s);i.x=r*(2+c)*.5*o,i.y=r*(2+c)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(c),this.addAttribute("position",new Vs(u,3)),this.addAttribute("normal",new Vs(l,3)),this.addAttribute("uv",new Vs(h,2))}function ux(t,e,n,r,i,o){Ls.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("TubeGeometry: taper has been removed.");var a=new lx(t,e,n,r,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function lx(t,e,n,r,i){Xs.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},e=e||64,n=n||1,r=r||8;var o=t.computeFrenetFrames(e,i=i||!1);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,c=new ss,u=new ss,l=new Cs,h=new ss,d=[],p=[],f=[],m=[];function v(i){h=t.getPointAt(i/e,h);var a=o.normals[i],l=o.binormals[i];for(s=0;s<=r;s++){var f=s/r*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);u.x=v*a.x+m*l.x,u.y=v*a.y+m*l.y,u.z=v*a.z+m*l.z,u.normalize(),p.push(u.x,u.y,u.z),c.x=h.x+n*u.x,c.y=h.y+n*u.y,c.z=h.z+n*u.z,d.push(c.x,c.y,c.z)}}!function(){for(a=0;a<e;a++)v(a);v(!1===i?e:0),function(){for(a=0;a<=e;a++)for(s=0;s<=r;s++)l.x=a/e,l.y=s/r,f.push(l.x,l.y)}(),function(){for(s=1;s<=e;s++)for(a=1;a<=r;a++){var t=(r+1)*s+(a-1),n=(r+1)*s+a,i=(r+1)*(s-1)+a;m.push((r+1)*(s-1)+(a-1),t,i),m.push(t,n,i)}}()}(),this.setIndex(m),this.addAttribute("position",new Vs(d,3)),this.addAttribute("normal",new Vs(p,3)),this.addAttribute("uv",new Vs(f,2))}function hx(t,e,n,r,i,o){ys.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===Ib&&((Ib=new Xs).addAttribute("position",new Vs([0,0,0,0,1,0],3)),(Rb=new au(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new $c(Ib,new qc({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Kc(Rb,new Xc({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,o)}function dx(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Xs;n.addAttribute("position",new Vs(e,3)),n.addAttribute("color",new Vs([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new qc({vertexColors:dc});Bd.call(this,n,r)}function px(t,e){this.type="Box3Helper",this.box=t;var n=void 0!==e?e:16776960,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Xs;i.setIndex(new Rs(r,1)),i.addAttribute("position",new Vs([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Bd.call(this,i,new qc({color:n})),this.geometry.computeBoundingSphere()}function fx(t){var e=new Xs,n=new qc({color:16777215,vertexColors:hc}),r=[],i=[],o={},a=new Ts(16755200),s=new Ts(16711680),c=new Ts(43775),u=new Ts(16777215),l=new Ts(3355443);function h(t,e,n){d(t,n),d(e,n)}function d(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(r.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",u),h("p","c",l),h("cn1","cn2",l),h("cn3","cn4",l),h("cf1","cf2",l),h("cf3","cf4",l),e.addAttribute("position",new Vs(r,3)),e.addAttribute("color",new Vs(i,3)),Bd.call(this,e,n),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function mx(t,e,n){ys.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);var r=new Xs;r.addAttribute("position",new Vs([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new qc({fog:!1});this.lightPlane=new $c(r,i),this.add(this.lightPlane),(r=new Xs).addAttribute("position",new Vs([0,0,0,0,0,1],3)),this.targetLine=new $c(r,i),this.add(this.targetLine),this.update()}function vx(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==n?n:16776960,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("FaceNormalsHelper: only Geometry is supported. Use VertexNormalsHelper, instead.");var c=new Xs,u=new Vs(2*a*3,3);c.addAttribute("position",u),Bd.call(this,c,new qc({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function gx(t,e,n,r){t=t||10,e=e||10,n=new Ts(void 0!==n?n:4473924),r=new Ts(void 0!==r?r:8947848);for(var i=e/2,o=t/e,a=t/2,s=[],c=[],u=0,l=0,h=-a;u<=e;u++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var d=u===i?n:r;d.toArray(c,l),d.toArray(c,l+=3),d.toArray(c,l+=3),d.toArray(c,l+=3),l+=3}var p=new Xs;p.addAttribute("position",new Vs(s,3)),p.addAttribute("color",new Vs(c,3));var f=new qc({vertexColors:dc});Bd.call(this,p,f)}function yx(t,e,n){ys.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new Al(e);r.rotateY(.5*Math.PI),this.material=new Xc({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=dc);var i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.addAttribute("color",new Rs(o,3)),this.add(new Kc(r,this.material)),this.update()}function bx(t,e,n){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var r=void 0!==n?n:16776960,i=new Xs;i.addAttribute("position",new Vs([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),$c.call(this,i,new qc({color:r}));var o=new Xs;o.addAttribute("position",new Vs([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Kc(o,new Xc({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}function xx(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;var r=new Ys(e,4,2),i=new Xc({wireframe:!0,fog:!1});Kc.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function wx(t,e,n,r,i,o){t=t||10,e=e||16,n=n||8,r=r||64,i=new Ts(void 0!==i?i:4473924),o=new Ts(void 0!==o?o:8947848);var a,s,c,u,l,h,d,p=[],f=[];for(u=0;u<=e;u++)c=u/e*(2*Math.PI),a=Math.sin(c)*t,s=Math.cos(c)*t,p.push(0,0,0),p.push(a,0,s),f.push((d=1&u?i:o).r,d.g,d.b),f.push(d.r,d.g,d.b);for(u=0;u<=n;u++)for(d=1&u?i:o,h=t-t/n*u,l=0;l<r;l++)c=l/r*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,p.push(a,0,s),f.push(d.r,d.g,d.b),c=(l+1)/r*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,p.push(a,0,s),f.push(d.r,d.g,d.b);var m=new Xs;m.addAttribute("position",new Vs(p,3)),m.addAttribute("color",new Vs(f,3));var v=new qc({vertexColors:dc});Bd.call(this,m,v)}function _x(t,e){ys.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var n=new qc({fog:!1}),r=new Xs;r.addAttribute("position",new Rs(new Float32Array(15),3)),this.line=new $c(r,n),this.add(this.line),this.update()}function Sx(t){for(var e=function t(e){var n=[];e&&e.isBone&&n.push(e);for(var r=0;r<e.children.length;r++)n.push.apply(n,t(e.children[r]));return n}(t),n=new Xs,r=[],i=[],o=new Ts(0,0,1),a=new Ts(0,1,0),s=0;s<e.length;s++){var c=e[s];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.addAttribute("position",new Vs(r,3)),n.addAttribute("color",new Vs(i,3));var u=new qc({vertexColors:dc,depthTest:!1,depthWrite:!1,transparent:!0});Bd.call(this,n,u),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Tx(t,e){ys.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var n=new Xs,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}n.addAttribute("position",new Vs(r,3));var c=new qc({fog:!1});this.cone=new Bd(n,c),this.add(this.cone),this.update()}function Mx(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==n?n:16711680,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var c=new Xs,u=new Vs(2*a*3,3);c.addAttribute("position",u),Bd.call(this,c,new qc({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Ax(t,e,n,r){Pd.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function Ex(t){this.manager=void 0!==t?t:Hu}(Ub.prototype=Object.create(Iy.prototype)).constructor=Ub,Object.assign((function(){var t=arguments;this.uuid=os.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var n=0,r=arguments.length;n!==r;++n)e[t[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}).prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=arguments,e=this._objects,n=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,o=this._paths,a=this._parsedPaths,s=this._bindings,c=s.length,u=void 0,l=0,h=arguments.length;l!==h;++l){var d=t[l],p=d.uuid,f=i[p];if(void 0===f){f=n++,i[p]=f,e.push(d);for(var m=0,v=c;m!==v;++m)s[m].push(new Dh(d,o[m],a[m]))}else if(f<r){u=e[f];var g=--r,y=e[g];for(i[y.uuid]=f,e[f]=y,i[p]=g,e[g]=d,m=0,v=c;m!==v;++m){var b=s[m],x=b[f];b[f]=b[g],void 0===x&&(x=new Dh(d,o[m],a[m])),b[g]=x}}else e[f]!==u&&console.error("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=arguments,e=this._objects,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var c=t[a],u=c.uuid,l=r[u];if(void 0!==l&&l>=n){var h=n++,d=e[h];r[d.uuid]=l,e[l]=d,r[u]=h,e[h]=c;for(var p=0,f=o;p!==f;++p){var m=i[p],v=m[l];m[l]=m[h],m[h]=v}}}this.nCachedObjects_=n},uncache:function(){for(var t=arguments,e=this._objects,n=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,o=this._bindings,a=o.length,s=0,c=arguments.length;s!==c;++s){var u=t[s].uuid,l=i[u];if(void 0!==l)if(delete i[u],l<r){var h=--r,d=e[h],p=e[g=--n];i[d.uuid]=l,e[l]=d,i[p.uuid]=h,e[h]=p,e.pop();for(var f=0,m=a;f!==m;++f){var v=(y=o[f])[g];y[l]=y[h],y[h]=v,y.pop()}}else{var g;for(i[(p=e[g=--n]).uuid]=l,e[l]=p,e.pop(),f=0,m=a;f!==m;++f){var y;(y=o[f])[l]=y[g],y.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,c=this.nCachedObjects_,u=new Array(s.length);n[t]=r=i.length,o.push(t),a.push(e),i.push(u);for(var l=c,h=s.length;l!==h;++l)u[l]=new Dh(s[l],t,e);return u},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}),Object.assign((function(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}).prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length}}),kb.prototype=Object.assign(Object.create(Rp.prototype),{constructor:kb,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new ss;return function(e){ys.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),(jb.prototype=Object.create(ys.prototype)).constructor=jb,Bb.prototype=Object.assign(Object.create(Rs.prototype),{constructor:Bb,isInstancedBufferAttribute:!0,copy:function(t){return Rs.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(zb.prototype,{moveTo:function(t,e){this.currentPath=new ib,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,n,r){this.currentPath.quadraticCurveTo(t,e,n,r)},bezierCurveTo:function(t,e,n,r,i,o){this.currentPath.bezierCurveTo(t,e,n,r,i,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],o=new ob;o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=e[i],s=e[o],c=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=e[o],c=-c,s=e[i],u=-u),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var l=u*(t.x-a.x)-c*(t.y-a.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return r}var i=Eb.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);var a,s,c,u=[];if(1===o.length)return s=o[0],(c=new ob).curves=s.curves,u.push(c),u;var l=!i(o[0].getPoints());l=t?!l:l;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(h=(s=o[g]).getPoints()),(a=t?!a:a)?(!l&&f[v]&&v++,f[v]={s:new ob,p:h},f[v].s.curves=s.curves,l&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!f[0])return n(o);if(f.length>1){for(var b=!1,x=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)r(M.p,f[E].p)&&(w!==E&&x.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):b=!0);A&&p[w].push(M)}x.length>0&&(b||(m=p))}g=0;for(var C=f.length;g<C;g++){u.push(c=f[g].s);for(var P=0,O=(d=m[g]).length;P<O;P++)c.holes.push(d[P].h)}return u}}),Object.assign(Vb.prototype,{isFont:!0,generateShapes:function(t,e,n){void 0===e&&(e=100),void 0===n&&(n=4);for(var r=[],i=function(t,e,n,r){for(var i=String(t).split(""),o=e/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*o,s=[],c=0,u=0,l=0;l<i.length;l++){var h=i[l];if("\n"===h)c=0,u-=a;else{var d=Gb(h,0,o,c,u,r);c+=d.offsetX,s.push(d.path)}}return s}(t,e,0,this.data),o=0,a=i.length;o<a;o++)Array.prototype.push.apply(r,i[o].toShapes());return r}}),(Hb.prototype=Object.create(ou.prototype)).constructor=Hb,(Wb.prototype=Object.create(au.prototype)).constructor=Wb,(Xb.prototype=Object.create(Ls.prototype)).constructor=Xb,(qb.prototype=Object.create(Tl.prototype)).constructor=qb,(Yb.prototype=Object.create(Xs.prototype)).constructor=Yb,(Zb.prototype=Object.create(Ls.prototype)).constructor=Zb,(Jb.prototype=Object.create(Xs.prototype)).constructor=Jb,Jb.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],n=this.getAttribute("uv"),r=n?Array.prototype.slice.call(n.array):[],i=this.index;return{position:e,uv:r,index:i?Array.prototype.slice.call(i.array):[]}},Jb.prototype.addShapeList=function(t,e){var n=t.length;e.arrays=this.getArrays();for(var r=0;r<n;r++)this.addShape(t[r],e);this.setIndex(e.arrays.index),this.addAttribute("position",new Vs(e.arrays.position,3)),this.addAttribute("uv",new Vs(e.arrays.uv,2))},Jb.prototype.addShape=function(t,e){var n,r,i,o,a,s,c,u,l=e.arrays?e.arrays:this.getArrays(),h=l.position,d=l.index,p=l.uv,f=[],m=void 0!==e.amount?e.amount:100,v=void 0!==e.bevelThickness?e.bevelThickness:6,g=void 0!==e.bevelSize?e.bevelSize:v-2,y=void 0!==e.bevelSegments?e.bevelSegments:3,b=void 0===e.bevelEnabled||e.bevelEnabled,x=void 0!==e.curveSegments?e.curveSegments:12,w=void 0!==e.steps?e.steps:1,_=e.extrudePath,S=!1,T=void 0!==e.UVGenerator?e.UVGenerator:Zb.WorldUVGenerator;_&&(n=_.getSpacedPoints(w),S=!0,b=!1,r=void 0!==e.frames?e.frames:_.computeFrenetFrames(w,!1),i=new ss,o=new ss,a=new ss),b||(y=0,v=0,g=0);var M=this,A=t.extractPoints(x),E=A.shape,C=A.holes;if(!Eb.isClockWise(E))for(E=E.reverse(),c=0,u=C.length;c<u;c++)Eb.isClockWise(s=C[c])&&(C[c]=s.reverse());var P=Eb.triangulateShape(E,C),O=E;for(c=0,u=C.length;c<u;c++)E=E.concat(s=C[c]);function N(t,e,n){return e||console.error("ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}var L,I,R,D,F,U,k=E.length,j=P.length;function B(t,e,n){var r,i,o,a=t.x-e.x,s=t.y-e.y,c=n.x-t.x,u=n.y-t.y,l=a*a+s*s;if(Math.abs(a*u-s*c)>Number.EPSILON){var h=Math.sqrt(l),d=Math.sqrt(c*c+u*u),p=e.x-s/h,f=e.y+a/h,m=((n.x-u/d-p)*u-(n.y+c/d-f)*c)/(a*u-s*c),v=(r=p+a*m-t.x)*r+(i=f+s*m-t.y)*i;if(v<=2)return new Cs(r,i);o=Math.sqrt(v/2)}else{var g=!1;a>Number.EPSILON?c>Number.EPSILON&&(g=!0):a<-Number.EPSILON?c<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(u)&&(g=!0),g?(r=-s,i=a,o=Math.sqrt(l)):(r=a,i=s,o=Math.sqrt(l/2))}return new Cs(r/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=B(O[V],O[H],O[W]);var X,q,Y=[],Z=z.concat();for(c=0,u=C.length;c<u;c++){for(X=[],H=(G=(s=C[c]).length)-1,W=1+(V=0);V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=B(s[V],s[H],s[W]);Y.push(X),Z=Z.concat(X)}for(L=0;L<y;L++){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,-D);for(c=0,u=C.length;c<u;c++)for(X=Y[c],V=0,G=(s=C[c]).length;V<G;V++)Q((F=N(s[V],X[V],I)).x,F.y,-D)}for(I=g,V=0;V<k;V++)F=b?N(E[V],Z[V],I):E[V],S?(o.copy(r.normals[0]).multiplyScalar(F.x),i.copy(r.binormals[0]).multiplyScalar(F.y),a.copy(n[0]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,0);for(q=1;q<=w;q++)for(V=0;V<k;V++)F=b?N(E[V],Z[V],I):E[V],S?(o.copy(r.normals[q]).multiplyScalar(F.x),i.copy(r.binormals[q]).multiplyScalar(F.y),a.copy(n[q]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,m/w*q);for(L=y-1;L>=0;L--){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,m+D);for(c=0,u=C.length;c<u;c++)for(X=Y[c],V=0,G=(s=C[c]).length;V<G;V++)F=N(s[V],X[V],I),S?Q(F.x,F.y+n[w-1].y,n[w-1].x+D):Q(F.x,F.y,m+D)}function J(t,e){var n,r;for(V=t.length;--V>=0;){n=V,(r=V-1)<0&&(r=t.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var a=k*i,s=k*(i+1);$(e+n+a,e+r+a,e+r+s,e+n+s)}}}function Q(t,e,n){f.push(t),f.push(e),f.push(n)}function K(t,e,n){tt(t),tt(e),tt(n);var r=h.length/3,i=T.generateTopUV(M,h,r-3,r-2,r-1);et(i[0]),et(i[1]),et(i[2])}function $(t,e,n,r){tt(t),tt(e),tt(r),tt(e),tt(n),tt(r);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);et(o[0]),et(o[1]),et(o[3]),et(o[1]),et(o[2]),et(o[3])}function tt(t){d.push(h.length/3),h.push(f[3*t+0]),h.push(f[3*t+1]),h.push(f[3*t+2])}function et(t){p.push(t.x),p.push(t.y)}!function(){var t=h.length/3;if(b){var e=0,n=k*e;for(V=0;V<j;V++)K((U=P[V])[2]+n,U[1]+n,U[0]+n);for(n=k*(e=w+2*y),V=0;V<j;V++)K((U=P[V])[0]+n,U[1]+n,U[2]+n)}else{for(V=0;V<j;V++)K((U=P[V])[2],U[1],U[0]);for(V=0;V<j;V++)K((U=P[V])[0]+k*w,U[1]+k*w,U[2]+k*w)}M.addGroup(t,h.length/3-t,0)}(),function(){var t=h.length/3,e=0;for(J(O,e),e+=O.length,c=0,u=C.length;c<u;c++)J(s=C[c],e),e+=s.length;M.addGroup(t,h.length/3-t,1)}(),e.arrays||(this.setIndex(d),this.addAttribute("position",new Vs(h,3)),this.addAttribute("uv",new Vs(p,2)))},Zb.WorldUVGenerator={generateTopUV:function(t,e,n,r,i){var o=e[3*r],a=e[3*r+1],s=e[3*i],c=e[3*i+1];return[new Cs(e[3*n],e[3*n+1]),new Cs(o,a),new Cs(s,c)]},generateSideWallUV:function(t,e,n,r,i,o){var a=e[3*n],s=e[3*n+1],c=e[3*n+2],u=e[3*r],l=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],v=e[3*o+1],g=e[3*o+2];return Math.abs(s-l)<.01?[new Cs(a,1-c),new Cs(u,1-h),new Cs(d,1-f),new Cs(m,1-g)]:[new Cs(s,1-c),new Cs(l,1-h),new Cs(p,1-f),new Cs(v,1-g)]}},(Qb.prototype=Object.create(Ls.prototype)).constructor=Qb,(Kb.prototype=Object.create(Xs.prototype)).constructor=Kb,($b.prototype=Object.create(Ls.prototype)).constructor=$b,(tx.prototype=Object.create(Xs.prototype)).constructor=tx,(ex.prototype=Object.create(Ls.prototype)).constructor=ex,(nx.prototype=Object.create(Xs.prototype)).constructor=nx,(rx.prototype=Object.create(Ls.prototype)).constructor=rx,(ix.prototype=Object.create(Tl.prototype)).constructor=ix,(ox.prototype=Object.create(Ls.prototype)).constructor=ox,(ax.prototype=Object.create(Jb.prototype)).constructor=ax,(sx.prototype=Object.create(Ls.prototype)).constructor=sx,(cx.prototype=Object.create(Xs.prototype)).constructor=cx,(ux.prototype=Object.create(Ls.prototype)).constructor=ux,(lx.prototype=Object.create(Xs.prototype)).constructor=lx,(hx.prototype=Object.create(ys.prototype)).constructor=hx,hx.prototype.setDirection=(Fb=new ss,function(t){t.y>.99999?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(Fb.set(t.z,0,-t.x).normalize(),Db=Math.acos(t.y),this.quaternion.setFromAxisAngle(Fb,Db))}),hx.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},hx.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(dx.prototype=Object.create(Bd.prototype)).constructor=dx,(px.prototype=Object.create(Bd.prototype)).constructor=px,px.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),ys.prototype.updateMatrixWorld.call(this,t))},(fx.prototype=Object.create(Bd.prototype)).constructor=fx,fx.prototype.update=function(){var t,e,n=new ss,r=new Tu;function i(i,o,a,s){n.set(o,a,s).unproject(r);var c=e[i];if(void 0!==c)for(var u=t.getAttribute("position"),l=0,h=c.length;l<h;l++)u.setXYZ(c[l],n.x,n.y,n.z)}return function(){t=this.geometry,e=this.pointMap,r.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(mx.prototype=Object.create(ys.prototype)).constructor=mx,mx.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},mx.prototype.update=function(){var t=new ss,e=new ss,n=new ss;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(e,t),this.lightPlane.lookAt(n),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(n),this.targetLine.scale.z=n.length()}}(),(vx.prototype=Object.create(Bd.prototype)).constructor=vx,vx.prototype.update=function(){var t=new ss,e=new ss,n=new ds;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,c=0,u=0,l=s.length;u<l;u++){var h=s[u],d=h.normal;t.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(r),e.copy(d).applyMatrix3(n).normalize().multiplyScalar(this.size).add(t),i.setXYZ(c,t.x,t.y,t.z),i.setXYZ(c+=1,e.x,e.y,e.z),c+=1}i.needsUpdate=!0}}(),(gx.prototype=Object.create(Bd.prototype)).constructor=gx,(yx.prototype=Object.create(ys.prototype)).constructor=yx,yx.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},yx.prototype.update=function(){var t=new ss,e=new Ts,n=new Ts;return function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=r.geometry.getAttribute("color");e.copy(this.light.color),n.copy(this.light.groundColor);for(var o=0,a=i.count;o<a;o++){var s=o<a/2?e:n;i.setXYZ(o,s.r,s.g,s.b)}i.needsUpdate=!0}r.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(bx.prototype=Object.create($c.prototype)).constructor=bx,bx.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),ys.prototype.updateMatrixWorld.call(this,t)},(xx.prototype=Object.create(Kc.prototype)).constructor=xx,xx.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},xx.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(wx.prototype=Object.create(Bd.prototype)).constructor=wx,(_x.prototype=Object.create(ys.prototype)).constructor=_x,_x.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},_x.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,n=this.line.geometry.attributes.position,r=n.array;r[0]=t,r[1]=-e,r[2]=0,r[3]=t,r[4]=e,r[5]=0,r[6]=-t,r[7]=e,r[8]=0,r[9]=-t,r[10]=-e,r[11]=0,r[12]=t,r[13]=-e,r[14]=0,n.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Sx.prototype=Object.create(Bd.prototype)).constructor=Sx,Sx.prototype.updateMatrixWorld=function(){var t=new ss,e=new as,n=new as;return function(r){var i=this.bones,o=this.geometry,a=o.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var s=0,c=0;s<i.length;s++){var u=i[s];u.parent&&u.parent.isBone&&(e.multiplyMatrices(n,u.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(c,t.x,t.y,t.z),e.multiplyMatrices(n,u.parent.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(c+1,t.x,t.y,t.z),c+=2)}o.getAttribute("position").needsUpdate=!0,ys.prototype.updateMatrixWorld.call(this,r)}}(),(Tx.prototype=Object.create(ys.prototype)).constructor=Tx,Tx.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Tx.prototype.update=function(){var t=new ss,e=new ss;return function(){this.light.updateMatrixWorld();var n=this.light.distance?this.light.distance:1e3,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(Mx.prototype=Object.create(Bd.prototype)).constructor=Mx,Mx.prototype.update=function(){var t=new ss,e=new ss,n=new ds;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,c=a.faces,u=0,l=0,h=c.length;l<h;l++)for(var d=c[l],p=0,f=d.vertexNormals.length;p<f;p++){var m=d.vertexNormals[p];t.copy(s[d[r[p]]]).applyMatrix4(i),e.copy(m).applyMatrix3(n).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),o.setXYZ(u+=1,e.x,e.y,e.z),u+=1}else if(a&&a.isBufferGeometry){var v=a.attributes.position,g=a.attributes.normal;for(u=0,p=0,f=v.count;p<f;p++)t.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),e.set(g.getX(p),g.getY(p),g.getZ(p)),e.applyMatrix3(n).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),o.setXYZ(u+=1,e.x,e.y,e.z),u+=1}o.needsUpdate=!0}}(),Ax.prototype=Object.assign(Object.create(Pd.prototype),{constructor:Ax,isRectAreaLight:!0,copy:function(t){return Pd.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Pd.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign((function(t){this.manager=void 0!==t?t:Hu}).prototype,{load:function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},parse:function(t,e){for(var n=[],r=0;r<t.length;r++){var i=_u.parse(t[r]);n.push(i)}e(n)}}),Object.assign(Ex.prototype,{load:function(t,e,n,r){var i=this;new Xu(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},parse:function(t){var e=new Xs,n=t.data.index;if(void 0!==n){var r=new Px[n.type](n.array);e.setIndex(new Rs(r,1))}var i=t.data.attributes;for(var o in i){var a=i[o];r=new Px[a.type](a.array),e.addAttribute(o,new Rs(r,a.itemSize,a.normalized))}var s=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==s)for(var c=0,u=s.length;c!==u;++c){var l=s[c];e.addGroup(l.start,l.count,l.materialIndex)}var h=t.data.boundingSphere;if(void 0!==h){var d=new ss;void 0!==h.center&&d.fromArray(h.center),e.boundingSphere=new Es(d,h.radius)}return e}});var Cx,Px={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ox(t){"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:Hu,this.options=void 0}function Nx(){ys.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Lx(t,e,n){this.name="",this.color=new Ts(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function Ix(t,e){this.name="",this.color=new Ts(t),this.density=void 0!==e?e:25e-5}Object.assign((function(t){this.manager=void 0!==t?t:Hu}).prototype,{crossOrigin:"Anonymous",load:function(t,e,n,r){var i=new Tp,o=new al(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(t[n],function(t){i.images[n]=t,6==++a&&(i.needsUpdate=!0,e&&e(i))},void 0,r)}for(var c=0;c<t.length;++c)s(c);return i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign((function(t){this.manager=void 0!==t?t:Hu}).prototype,{load:function(t,e,n,r){var i=this,o=new Xu(this.manager);o.setPath(this.path),o.load(t,function(t){var n;try{n=JSON.parse(t)}catch(e){console.warn("FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}var r=i.parse(n);e&&e(r)},n,r)},parse:function(t){return new Vb(t)},setPath:function(t){return this.path=t,this}}),Ox.prototype={constructor:Ox,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var i=this,o=ku.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,i.options)}).then(function(n){ku.add(t,n),e&&e(n),i.manager.itemEnd(t)}).catch(function(e){r&&r(e),i.manager.itemEnd(t),i.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Nx.prototype=Object.assign(Object.create(ys.prototype),{constructor:Nx,copy:function(t){ys.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,r=e.length;n<r;n++){var i=e[n];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var n=this.levels,r=0;r<n.length&&!(e<n[r].distance);r++);n.splice(r,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object},raycast:(Cx=new ss,function(t,e){Cx.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(Cx);this.getObjectForDistance(n).raycast(t,e)}),update:function(){var t=new ss,e=new ss;return function(n){var r=this.levels;if(r.length>1){t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var i=t.distanceTo(e);r[0].object.visible=!0;for(var o=1,a=r.length;o<a&&i>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<a;o++)r[o].object.visible=!1}}}(),toJSON:function(t){var e=ys.prototype.toJSON.call(this,t);e.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Lx.prototype.isFog=!0,Lx.prototype.clone=function(){return new Lx(this.color.getHex(),this.near,this.far)},Lx.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Ix.prototype.isFogExp2=!0,Ix.prototype.clone=function(){return new Ix(this.color.getHex(),this.density)},Ix.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};var Rx={WireframeGeometry:ud,TetrahedronGeometry:rx,TetrahedronBufferGeometry:ix,OctahedronGeometry:Ml,OctahedronBufferGeometry:Al,IcosahedronGeometry:Fy,IcosahedronBufferGeometry:Uy,DodecahedronGeometry:Xb,DodecahedronBufferGeometry:qb,PolyhedronGeometry:Sl,PolyhedronBufferGeometry:Tl,TubeGeometry:ux,TubeBufferGeometry:lx,TorusKnotGeometry:sx,TorusGeometry:El,TorusBufferGeometry:Cl,TextGeometry:ox,TextBufferGeometry:ax,SphereGeometry:qs,SphereBufferGeometry:Ys,RingGeometry:ex,RingBufferGeometry:nx,PlaneGeometry:Ru,PlaneBufferGeometry:Du,LatheGeometry:Qb,LatheBufferGeometry:Kb,ShapeGeometry:Ob,ShapeBufferGeometry:Nb,ExtrudeGeometry:Zb,ExtrudeBufferGeometry:Jb,EdgesGeometry:Yb,ConeGeometry:Hb,ConeBufferGeometry:Wb,CylinderGeometry:ou,CylinderBufferGeometry:au,CircleGeometry:Ry,CircleBufferGeometry:Dy,BoxGeometry:ru,BoxBufferGeometry:iu};Object.assign((function(t){this.manager=void 0!==t?t:Hu,this.texturePath=""}).prototype,{load:function(t,e,n,r){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var i=this;new Xu(i.manager).load(t,function(n){var o=null;try{o=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,e):console.error("ObjectLoader: Can't load "+t+". Use JSONLoader instead.")},n,r)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var n=this.parseShape(t.shapes),r=this.parseGeometries(t.geometries,n),i=this.parseImages(t.images,function(){void 0!==e&&e(s)}),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,r,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new ob).fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var n={};if(void 0!==t)for(var r=new ll,i=new Ex,o=0,a=t.length;o<a;o++){var s,c=t[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Rx[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Rx[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Rx[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Rx[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Rx[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Rx[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Rx[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Rx[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Rx[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Rx[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Rx[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Rx[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var u=[];for(o=0,a=c.shapes.length;o<a;o++)u.push(e[c.shapes[o]]);s=new Rx[c.type](u,c.curveSegments);break;case"BufferGeometry":s=i.parse(c);break;case"Geometry":s=r.parse(c,this.texturePath).geometry;break;default:console.warn('ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),n[c.uuid]=s}return n},parseMaterials:function(t,e){var n={};if(void 0!==t){var r=new ol;r.setTextures(e);for(var i=0,o=t.length;i<o;i++){var a=t[i];if("MultiMaterial"===a.type){for(var s=[],c=0;c<a.materials.length;c++)s.push(r.parse(a.materials[c]));n[a.uuid]=s}else n[a.uuid]=r.parse(a)}}return n},parseAnimations:function(t){for(var e=[],n=0;n<t.length;n++){var r=_u.parse(t[n]);e.push(r)}return e},parseImages:function(t,e){var n=this,r={};function i(t){return n.manager.itemStart(t),o.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemEnd(t),n.manager.itemError(t)})}if(void 0!==t&&t.length>0){var o=new al(new ju(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var c=t[a],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.texturePath+c.url;r[c.uuid]=i(u)}}return r},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var r={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];void 0===a.image&&console.warn('ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("ObjectLoader: Undefined image",a.image);var s=new Ou(e[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=n(a.mapping,Dx)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=n(a.wrap[0],Fx),s.wrapT=n(a.wrap[1],Fx)),void 0!==a.format&&(s.format=a.format),void 0!==a.minFilter&&(s.minFilter=n(a.minFilter,Ux)),void 0!==a.magFilter&&(s.magFilter=n(a.magFilter,Ux)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),r[a.uuid]=s}return r},parseObject:function(t,e,n){var r;function i(t){return void 0===e[t]&&console.warn("ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var o=t[r];void 0===n[o]&&console.warn("ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":r=new Eu,void 0!==t.background&&Number.isInteger(t.background)&&(r.background=new Ts(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new Lx(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new Ix(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new Mu(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new Cu(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new jd(t.color,t.intensity);break;case"DirectionalLight":r=new Id(t.color,t.intensity);break;case"PointLight":r=new Nd(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new Ax(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new Dd(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new Fd(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(t.geometry),s=o(t.material);r=a.bones&&a.bones.length>0?new Td(a,s):new Kc(a,s);break;case"LOD":r=new Nx;break;case"Line":r=new $c(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":r=new Wd(i(t.geometry),o(t.material));break;case"LineSegments":r=new Bd(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":r=new Zh(i(t.geometry),o(t.material));break;case"Sprite":r=new fm(o(t.material));break;case"Group":r=new gd;break;default:r=new ys}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var c=t.children,u=0;u<c.length;u++)r.add(this.parseObject(c[u],e,n));if("LOD"===t.type)for(var l=t.levels,h=0;h<l.length;h++){var d=l[h],p=r.getObjectByProperty("uuid",d.object);void 0!==p&&r.addLevel(p,d.distance)}return r}});var Dx={UVMapping:300,CubeReflectionMapping:bc,CubeRefractionMapping:302,EquirectangularReflectionMapping:xc,EquirectangularRefractionMapping:304,SphericalReflectionMapping:wc,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Fx={RepeatWrapping:_c,ClampToEdgeWrapping:Sc,MirroredRepeatWrapping:Tc},Ux={NearestFilter:Mc,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:Ac,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:Ec};function kx(t,e,n,r,i,o,a,s,c){Ou.call(this,t,e,n,r,i,o,a,s,c),this.generateMipmaps=!1}Object.assign((function(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}).prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),kx.prototype=Object.assign(Object.create(Ou.prototype),{constructor:kx,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});var jx=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},Bx=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},zx=Pa(Ca),Vx=function(){function t(t){var e=this;this.controlService=t,this.isOrbitControlEnabled=!1,this.beforeWorldRenderSubject=new ln.b,this.afterWorldRenderSubject=new ln.b,this.beforeControlRenderSubject=new ln.b,this.afterControlRenderSubject=new ln.b,this.renderWorldLoopEnabled=!1,this.fieldOfView=45,this.nearClippingPane=1,this.farClippingPane=1e4,this.cameraDistance=64,this.sunLightPhi=.9,this.sunLightTheta=2.5,this.seaLevel=58,t.cameraDistanceSubject.subscribe(function(t){if(e.cameraDistance=t,e.sunDirectLight){var n=1.5*e.cameraDistance;e.sunDirectLight.shadow.camera.bottom=-n,e.sunDirectLight.shadow.camera.top=n,e.sunDirectLight.shadow.camera.left=-n,e.sunDirectLight.shadow.camera.right=n,e.sunDirectLight.shadow.camera.far=4*e.cameraDistance}})}return Object.defineProperty(t.prototype,"worldCanvas",{get:function(){return this.worldCanvasRef.nativeElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlCanvas",{get:function(){return this.controlCanvasRef.nativeElement},enumerable:!0,configurable:!0}),t.prototype.animateCamera=function(){this.camera&&this.car&&this.car.mesh&&(this.camera.position.x=this.car.mesh.position.x+Math.cos(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.y=this.car.mesh.position.y+Math.sin(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.z=this.cameraDistance,this.isOrbitControlEnabled&&(this.camera.position.y-=.5),this.camera.up=this.isOrbitControlEnabled?new Ca.Vector3(0,0,1):new Ca.Vector3(0,1,0),this.camera.lookAt(new Ca.Vector3(this.car.mesh.position.x+Math.cos(this.car.rotation)*this.car.speed/2,this.car.mesh.position.y+Math.sin(this.car.rotation)*this.car.speed/2,this.car.mesh.position.z)),this.sunDirectLight.position.set(this.car.mesh.position.x+this.cameraDistance*Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.car.mesh.position.y+this.cameraDistance*Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.car.mesh.position.z+this.cameraDistance*Math.cos(this.sunLightPhi)),this.sunDirectLight.target.position.set(this.car.mesh.position.x,this.car.mesh.position.y,this.car.mesh.position.z),this.isOrbitControlEnabled&&this.orbitControls&&this.orbitControls.update())},t.prototype.resizeCanvas=function(t,e){this.worldCanvas.width=t,this.worldCanvas.height=e,this.controlCanvas.width=t,this.controlCanvas.height=e,this.camera.aspect=this.worldCanvas.width/this.worldCanvas.height,this.camera.updateProjectionMatrix(),this.worldRenderer&&this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer&&this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height),this.isOrbitControlEnabled&&this.orbitControls&&this.orbitControls.update(),this.renderWorldLoopEnabled||this.renderWorldOnce(),this.renderControlsOnce()},t.prototype.addCar=function(t,e){void 0===e&&(e=!1),e&&(this.car=t),this.scene.add(t.mesh)},t.prototype.addMap=function(t,e){t.traverse(function(t){t instanceof Ca.Mesh&&(t.castShadow=e,t.receiveShadow=e)}),this.scene.add(t)},t.prototype.addControlElement=function(t){this.controlScene.add(t)},t.prototype.createScene=function(){var t=this;this.scene=new Ca.Scene,this.controlScene=new Ca.Scene,this.camera=new Ca.PerspectiveCamera(this.fieldOfView,this.worldCanvas.width/this.worldCanvas.height,this.nearClippingPane,this.farClippingPane),this.isOrbitControlEnabled&&(this.orbitControls=new zx(this.camera)),this.sunAmbientLight=new Ca.HemisphereLight(12303359,8949920,.85),this.sunAmbientLight.position.set(0,0,1),this.scene.add(this.sunAmbientLight),this.sunDirectLight=new Ca.DirectionalLight(16777215,1.5),this.sunDirectLight.castShadow=!0;var e=1.5*this.cameraDistance;this.sunDirectLight.shadow.camera.bottom=-e,this.sunDirectLight.shadow.camera.top=e,this.sunDirectLight.shadow.camera.left=-e,this.sunDirectLight.shadow.camera.right=e,this.sunDirectLight.shadow.mapSize.width=2048,this.sunDirectLight.shadow.mapSize.height=2048,this.sunDirectLight.shadow.camera.near=0,this.sunDirectLight.shadow.camera.far=4*this.cameraDistance,this.scene.add(this.sunDirectLight),this.scene.add(this.sunDirectLight.target),console.log(this.sunDirectLight);var n=new Ca.Vector3(Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.cos(this.sunLightPhi));this.sky=new Oa,this.sky.scale.setScalar(8e3),this.sky.up=new Ca.Vector3(0,0,1),this.sky.material.fragmentShader=this.sky.material.fragmentShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.vertexShader=this.sky.material.vertexShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.uniforms.turbidity.value=10,this.sky.material.uniforms.rayleigh.value=2,this.sky.material.uniforms.luminance.value=1,this.sky.material.uniforms.mieCoefficient.value=.005,this.sky.material.uniforms.mieDirectionalG.value=.8,this.sky.material.uniforms.sunPosition.value=n.clone(),this.scene.add(this.sky),this.water=new Av(new Ca.PlaneBufferGeometry(1e4,1e4),{textureWidth:128,textureHeight:128,waterNormals:(new Ca.TextureLoader).load("assets/models/maps/common/textures/waternormals.jpg",function(t){t.wrapS=t.wrapT=Ca.RepeatWrapping}),alpha:1,sunDirection:n.clone(),sunColor:16777215,waterColor:13365,distortionScale:3.7}),this.water.material.uniforms.size.value=3,this.water.position.z=-this.seaLevel,this.water.material.fragmentShader=this.water.material.fragmentShader.replace("getNoise( worldPosition.xz * size );","getNoise( worldPosition.xy * size );"),this.water.material.fragmentShader=this.water.material.fragmentShader.replace("vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","vec3 surfaceNormal = normalize( noise.xyz * vec3( 1.5, 1.0, 1.5 ) );"),this.water.material.fragmentShader=this.water.material.fragmentShader.replace("vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","vec2 distortion = surfaceNormal.xy * ( 0.001 + 1.0 / distance ) * distortionScale;"),this.scene.add(this.water),this.beforeWorldRenderSubject.subscribe(function(){t.water.material.uniforms.time.value+=1/60})},t.prototype.initCanvases=function(){this.worldRenderer=new Ca.WebGLRenderer({canvas:this.worldCanvas,antialias:!0,transparent:!0}),this.worldRenderer.shadowMap.enabled=!0,this.worldRenderer.shadowMapType=Ca.PCFSoftShadowMap,this.worldRenderer.setPixelRatio(devicePixelRatio),this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer=new Ca.WebGLRenderer({canvas:this.controlCanvas,antialias:!0,alpha:!0}),this.controlRenderer.setPixelRatio(devicePixelRatio),this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height)},t.prototype.ngAfterViewInit=function(){this.resizeCanvas(window.innerWidth,window.innerHeight),this.initCanvases()},t.prototype.ngOnInit=function(){this.createScene()},t.prototype.renderWorldOnce=function(){requestAnimationFrame(this._renderWorldSceneRoutine.bind(this))},t.prototype.startWorldRenderingLoop=function(){this.renderWorldLoopEnabled=!0,this.renderWorldOnce()},t.prototype.stopWorldRenderingLoop=function(){this.renderWorldLoopEnabled=!1},t.prototype.renderControlsOnce=function(){requestAnimationFrame(this._renderControlSceneRoutine.bind(this))},t.prototype.renderControlsOnceSync=function(){return jx(this,void 0,void 0,function(){var t=this;return Bx(this,function(e){return[2,new Promise(function(e){var n=t.afterControlRenderSubject.subscribe(function(){n.unsubscribe(),e()});t.renderControlsOnce()})]})})},t.prototype._renderWorldSceneRoutine=function(){this.beforeWorldRenderSubject.next(),this.worldRenderer.clear(),this.worldRenderer.render(this.scene,this.camera),this.renderWorldLoopEnabled&&requestAnimationFrame(this._renderWorldSceneRoutine.bind(this)),this.afterWorldRenderSubject.next()},t.prototype._renderControlSceneRoutine=function(){this.beforeControlRenderSubject.next(),this.controlRenderer.clear(),this.controlRenderer.render(this.controlScene,this.camera),this.afterControlRenderSubject.next()},t}(),Gx=i.Z({encapsulation:0,styles:[["stage-3d[_ngcontent-%COMP%]{width:100%;height:100%}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}"]],data:{}});function Hx(t){return i._18(0,[i._15(402653184,1,{worldCanvasRef:0}),i._15(402653184,2,{controlCanvasRef:0}),(t()(),i._1(2,0,[[1,0],["worldCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n"])),(t()(),i._1(4,0,[[2,0],["controlCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n"]))],null,null)}var Wx=n("GK6M"),Xx=n("fKB6"),qx=n("VwZZ"),Yx=function(t){function e(){t.apply(this,arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}return Object(a.c)(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),qx.a.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),qx.a.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},e}(ln.b);function Zx(t){var e=t.subject;e.next(t.value),e.complete()}function Jx(t){t.subject.error(t.err)}function Qx(t){var e=this,n=t.source,r=t.subscriber,i=t.context,o=n.callbackFunc,a=n.args,s=n.scheduler,c=n.subject;if(!c){c=n.subject=new Yx;var u=function t(){for(var n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];var i=t.source,o=i.selector,a=i.subject,c=n.shift();if(c)e.add(s.schedule($x,0,{err:c,subject:a}));else if(o){var u=Object(Wx.a)(o).apply(this,n);e.add(u===Xx.a?s.schedule($x,0,{err:Xx.a.e,subject:a}):s.schedule(Kx,0,{value:u,subject:a}))}else e.add(s.schedule(Kx,0,{value:n.length<=1?n[0]:n,subject:a}))};u.source=n,Object(Wx.a)(o).apply(i,a.concat(u))===Xx.a&&e.add(s.schedule($x,0,{err:Xx.a.e,subject:c}))}e.add(c.subscribe(r))}function Kx(t){var e=t.subject;e.next(t.value),e.complete()}function $x(t){t.subject.error(t.err)}T.a.bindCallback=function(t){function e(e,n,r,i,o){t.call(this),this.callbackFunc=e,this.selector=n,this.args=r,this.context=i,this.scheduler=o}return Object(a.c)(e,t),e.create=function(t,n,r){return void 0===n&&(n=void 0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];return new e(t,n,i,this,r)}},e.prototype._subscribe=function(t){var n=this.callbackFunc,r=this.args,i=this.scheduler,o=this.subject;if(i)return i.schedule(e.dispatch,0,{source:this,subscriber:t,context:this.context});if(!o){o=this.subject=new Yx;var a=function t(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];var r=t.source,i=r.selector,o=r.subject;if(i){var a=Object(Wx.a)(i).apply(this,e);a===Xx.a?o.error(Xx.a.e):(o.next(a),o.complete())}else o.next(e.length<=1?e[0]:e),o.complete()};a.source=this,Object(Wx.a)(n).apply(this.context,r.concat(a))===Xx.a&&o.error(Xx.a.e)}return o.subscribe(t)},e.dispatch=function(t){var e=this,n=t.source,r=t.subscriber,i=t.context,o=n.callbackFunc,a=n.args,s=n.scheduler,c=n.subject;if(!c){c=n.subject=new Yx;var u=function t(){for(var n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];var i=t.source,o=i.selector,a=i.subject;if(o){var c=Object(Wx.a)(o).apply(this,n);e.add(c===Xx.a?s.schedule(Jx,0,{err:Xx.a.e,subject:a}):s.schedule(Zx,0,{value:c,subject:a}))}else e.add(s.schedule(Zx,0,{value:n.length<=1?n[0]:n,subject:a}))};u.source=n,Object(Wx.a)(o).apply(i,a.concat(u))===Xx.a&&c.error(Xx.a.e)}e.add(c.subscribe(r))},e}(T.a).create,T.a.bindNodeCallback=function(t){function e(e,n,r,i,o){t.call(this),this.callbackFunc=e,this.selector=n,this.args=r,this.context=i,this.scheduler=o}return Object(a.c)(e,t),e.create=function(t,n,r){return void 0===n&&(n=void 0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];return new e(t,n,i,this,r)}},e.prototype._subscribe=function(t){var e=this.callbackFunc,n=this.args,r=this.scheduler,i=this.subject;if(r)return r.schedule(Qx,0,{source:this,subscriber:t,context:this.context});if(!i){i=this.subject=new Yx;var o=function t(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];var r=t.source,i=r.selector,o=r.subject,a=e.shift();if(a)o.error(a);else if(i){var s=Object(Wx.a)(i).apply(this,e);s===Xx.a?o.error(Xx.a.e):(o.next(s),o.complete())}else o.next(e.length<=1?e[0]:e),o.complete()};o.source=this,Object(Wx.a)(e).apply(this.context,n.concat(o))===Xx.a&&i.error(Xx.a.e)}return i.subscribe(t)},e}(T.a).create;var tw=n("1Q68"),ew={};function nw(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=null;return"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&Object(Tn.a)(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(new pn.a([e].concat(t)),new rw(n))}}var rw=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new iw(t,this.project))},t}(),iw=function(t){function e(e,n){t.call(this,e),this.project=n,this.active=0,this.values=[],this.observables=[]}return Object(a.c)(e,t),e.prototype._next=function(t){this.values.push(ew),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(Object(Zn.a)(this,r,r,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.values,a=this.toRespond?o[n]===ew?--this.toRespond:this.toRespond:0;o[n]=e,0===a&&(this.project?this._tryProject(o):this.destination.next(o.slice()))},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Yn.a);function ow(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 1===t.length||2===t.length&&Object(tw.a)(t[1])?qn(t[0]):er()(fn.apply(void 0,t))}T.a.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=null,r=null;return Object(tw.a)(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&Object(Tn.a)(t[0])&&(t=t[0]),new pn.a(t,r).lift(new rw(n))},T.a.concat=ow;var aw=function(t){function e(e){t.call(this),this.observableFactory=e}return Object(a.c)(e,t),e.create=function(t){return new e(t)},e.prototype._subscribe=function(t){return new sw(t,this.observableFactory)},e}(T.a),sw=function(t){function e(e,n){t.call(this,e),this.factory=n,this.tryDefer()}return Object(a.c)(e,t),e.prototype.tryDefer=function(){try{this._callFactory()}catch(t){this._error(t)}},e.prototype._callFactory=function(){var t=this.factory();t&&this.add(Object(Zn.a)(this,t))},e}(Yn.a);T.a.defer=aw.create,T.a.empty=kn.a.create;var cw=function(t){function e(e,n){t.call(this),this.sources=e,this.resultSelector=n}return Object(a.c)(e,t),e.create=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];if(null===t||0===arguments.length)return new kn.a;var r=null;return"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&Object(Tn.a)(t[0])&&(t=t[0]),0===t.length?new kn.a:new e(t,r)},e.prototype._subscribe=function(t){return new uw(t,this.sources,this.resultSelector)},e}(T.a),uw=function(t){function e(e,n,r){t.call(this,e),this.sources=n,this.resultSelector=r,this.completed=0,this.haveValues=0;var i=n.length;this.total=i,this.values=new Array(i);for(var o=0;o<i;o++){var a=n[o],s=Object(Zn.a)(this,a,null,o);s&&(s.outerIndex=o,this.add(s))}}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.values[n]=e,i._hasValue||(i._hasValue=!0,this.haveValues++)},e.prototype.notifyComplete=function(t){var e=this.destination,n=this.haveValues,r=this.resultSelector,i=this.values,o=i.length;if(t._hasValue){if(this.completed++,this.completed===o){if(n===o){var a=r?r.apply(this,i):i;e.next(a)}e.complete()}}else e.complete()},e}(Yn.a);T.a.forkJoin=cw.create,T.a.from=qn;var lw=n("/iUD"),hw=Object.prototype.toString;T.a.fromEvent=function(t){function e(e,n,r,i){t.call(this),this.sourceObj=e,this.eventName=n,this.selector=r,this.options=i}return Object(a.c)(e,t),e.create=function(t,n,r,i){return Object(lw.a)(r)&&(i=r,r=void 0),new e(t,n,i,r)},e.setupSubscription=function(t,n,r,i,o){var a;if(function(t){return!!t&&"[object NodeList]"===hw.call(t)}(t)||function(t){return!!t&&"[object HTMLCollection]"===hw.call(t)}(t))for(var s=0,c=t.length;s<c;s++)e.setupSubscription(t[s],n,r,i,o);else if(function(t){return!!t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){var u=t;t.addEventListener(n,r,o),a=function(){return u.removeEventListener(n,r,o)}}else if(function(t){return!!t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){var l=t;t.on(n,r),a=function(){return l.off(n,r)}}else{if(!function(t){return!!t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t))throw new TypeError("Invalid event target");var h=t;t.addListener(n,r),a=function(){return h.removeListener(n,r)}}i.add(new qx.a(a))},e.prototype._subscribe=function(t){var n=this.selector;e.setupSubscription(this.sourceObj,this.eventName,n?function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var i=Object(Wx.a)(n).apply(void 0,e);i===Xx.a?t.error(Xx.a.e):t.next(i)}:function(e){return t.next(e)},t,this.options)},e}(T.a).create,T.a.fromEventPattern=function(t){function e(e,n,r){t.call(this),this.addHandler=e,this.removeHandler=n,this.selector=r}return Object(a.c)(e,t),e.create=function(t,n,r){return new e(t,n,r)},e.prototype._subscribe=function(t){var e=this,n=this.removeHandler,r=this.selector?function(){for(var n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];e._callSelector(t,n)}:function(e){t.next(e)},i=this._callAddHandler(r,t);Object(lw.a)(n)&&t.add(new qx.a(function(){n(r,i)}))},e.prototype._callSelector=function(t,e){try{var n=this.selector.apply(this,e);t.next(n)}catch(e){t.error(e)}},e.prototype._callAddHandler=function(t,e){try{return this.addHandler(t)||null}catch(t){e.error(t)}},e}(T.a).create,T.a.fromPromise=cr;var dw=function(t){return t};T.a.generate=function(t){function e(e,n,r,i,o){t.call(this),this.initialState=e,this.condition=n,this.iterate=r,this.resultSelector=i,this.scheduler=o}return Object(a.c)(e,t),e.create=function(t,n,r,i,o){return 1==arguments.length?new e(t.initialState,t.condition,t.iterate,t.resultSelector||dw,t.scheduler):void 0===i||Object(tw.a)(i)?new e(t,n,r,dw,i):new e(t,n,r,i,o)},e.prototype._subscribe=function(t){var n=this.initialState;if(this.scheduler)return this.scheduler.schedule(e.dispatch,0,{subscriber:t,iterate:this.iterate,condition:this.condition,resultSelector:this.resultSelector,state:n});for(var r=this.condition,i=this.resultSelector,o=this.iterate;;){if(r){var a=void 0;try{a=r(n)}catch(e){return void t.error(e)}if(!a){t.complete();break}}var s=void 0;try{s=i(n)}catch(e){return void t.error(e)}if(t.next(s),t.closed)break;try{n=o(n)}catch(e){return void t.error(e)}}},e.dispatch=function(t){var e=t.subscriber,n=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(n){var r=void 0;try{r=n(t.state)}catch(t){return void e.error(t)}if(!r)return void e.complete();if(e.closed)return}var i;try{i=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(i),!e.closed))return this.schedule(t)}},e}(T.a).create;var pw=function(t){function e(e,n,r){t.call(this),this.condition=e,this.thenSource=n,this.elseSource=r}return Object(a.c)(e,t),e.create=function(t,n,r){return new e(t,n,r)},e.prototype._subscribe=function(t){return new fw(t,this.condition,this.thenSource,this.elseSource)},e}(T.a),fw=function(t){function e(e,n,r,i){t.call(this,e),this.condition=n,this.thenSource=r,this.elseSource=i,this.tryIf()}return Object(a.c)(e,t),e.prototype.tryIf=function(){var t=this.condition,e=this.thenSource,n=this.elseSource;try{var r=t()?e:n;r?this.add(Object(Zn.a)(this,r)):this._complete()}catch(t){this._error(t)}},e}(Yn.a);function mw(t){return!Object(Tn.a)(t)&&t-parseFloat(t)+1>=0}T.a.if=pw.create;var vw=function(t){function e(e,n){t.call(this,e,n),this.scheduler=e,this.work=n,this.pending=!1}return Object(a.c)(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t,this.pending=!0;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),En.a.setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;En.a.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){t.call(this)}return Object(a.c)(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(qx.a)),gw=function(t){function e(){t.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return Object(a.c)(e,t),e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=Date.now?Date.now:function(){return+new Date},t}()),yw=new gw(vw);T.a.interval=function(t){function e(e,n){void 0===e&&(e=0),void 0===n&&(n=yw),t.call(this),this.period=e,this.scheduler=n,(!mw(e)||e<0)&&(this.period=0),n&&"function"==typeof n.schedule||(this.scheduler=yw)}return Object(a.c)(e,t),e.create=function(t,n){return void 0===t&&(t=0),void 0===n&&(n=yw),new e(t,n)},e.dispatch=function(t){var e=t.subscriber,n=t.period;e.next(t.index),e.closed||(t.index+=1,this.schedule(t,n))},e.prototype._subscribe=function(t){var n=this.period;t.add(this.scheduler.schedule(e.dispatch,n,{index:0,subscriber:t,period:n}))},e}(T.a).create;var bw=n("/nXB");function xw(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(1===t.length){if(!Object(Tn.a)(t[0]))return t[0];t=t[0]}return new pn.a(t).lift(new ww)}T.a.merge=bw.a;var ww=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new _w(t))},t}(),_w=function(t){function e(e){t.call(this,e),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}return Object(a.c)(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var r=t[n],i=Object(Zn.a)(this,r,r,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},e.prototype.notifyNext=function(t,e,n,r,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==n){var a=this.subscriptions[o];a.unsubscribe(),this.remove(a)}this.subscriptions=null}this.destination.next(e)},e}(Yn.a);T.a.race=xw;var Sw=n("gIN1");function Tw(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 1===t.length&&Object(Tn.a)(t[0])&&(t=t[0]),function(e){return e.lift(new Mw(t))}}T.a.never=function(t){function e(){t.call(this)}return Object(a.c)(e,t),e.create=function(){return new e},e.prototype._subscribe=function(t){Object(Sw.a)()},e}(T.a).create,T.a.of=fn;var Mw=function(){function t(t){this.nextSources=t}return t.prototype.call=function(t,e){return e.subscribe(new Aw(t,this.nextSources))},t}(),Aw=function(t){function e(e,n){t.call(this,e),this.destination=e,this.nextSources=n}return Object(a.c)(e,t),e.prototype.notifyError=function(t,e){this.subscribeToNextSource()},e.prototype.notifyComplete=function(t){this.subscribeToNextSource()},e.prototype._error=function(t){this.subscribeToNextSource()},e.prototype._complete=function(){this.subscribeToNextSource()},e.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();t?this.add(Object(Zn.a)(this,t)):this.destination.complete()},e}(Yn.a);function Ew(t){var e=t.index,n=t.subscriber;if(e!==t.length){var r=t.keys[e];n.next([r,t.obj[r]]),t.index=e+1,this.schedule(t)}else n.complete()}T.a.onErrorResumeNext=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n;return 1===t.length&&Object(Tn.a)(t[0])&&(t=t[0]),n=t.shift(),new Xn(n,null).lift(new Mw(t))},T.a.pairs=function(t){function e(e,n){t.call(this),this.obj=e,this.scheduler=n,this.keys=Object.keys(e)}return Object(a.c)(e,t),e.create=function(t,n){return new e(t,n)},e.prototype._subscribe=function(t){var e=this.keys,n=this.scheduler,r=e.length;if(n)return n.schedule(Ew,0,{obj:this.obj,keys:e,length:r,index:0,subscriber:t});for(var i=0;i<r;i++){var o=e[i];t.next([o,this.obj[o]])}t.complete()},e}(T.a).create,T.a.range=function(t){function e(e,n,r){t.call(this),this.start=e,this._count=n,this.scheduler=r}return Object(a.c)(e,t),e.create=function(t,n,r){return void 0===t&&(t=0),void 0===n&&(n=0),new e(t,n,r)},e.dispatch=function(t){var e=t.start,n=t.index,r=t.subscriber;n>=t.count?r.complete():(r.next(e),r.closed||(t.index=n+1,t.start=e+1,this.schedule(t)))},e.prototype._subscribe=function(t){var n=0,r=this.start,i=this._count,o=this.scheduler;if(o)return o.schedule(e.dispatch,0,{index:n,count:i,start:r,subscriber:t});for(;;){if(n++>=i){t.complete();break}if(t.next(r++),t.closed)break}},e}(T.a).create;var Cw=function(t){function e(e,n){t.call(this),this.resourceFactory=e,this.observableFactory=n}return Object(a.c)(e,t),e.create=function(t,n){return new e(t,n)},e.prototype._subscribe=function(t){var e,n=this.resourceFactory,r=this.observableFactory;try{return e=n(),new Pw(t,e,r)}catch(e){t.error(e)}},e}(T.a),Pw=function(t){function e(e,n,r){t.call(this,e),this.resource=n,this.observableFactory=r,e.add(n),this.tryUse()}return Object(a.c)(e,t),e.prototype.tryUse=function(){try{var t=this.observableFactory.call(this,this.resource);t&&this.add(Object(Zn.a)(this,t))}catch(t){this._error(t)}},e}(Yn.a);function Ow(t){return t instanceof Date&&!isNaN(+t)}T.a.using=Cw.create,T.a.throw=function(t){function e(e,n){t.call(this),this.error=e,this.scheduler=n}return Object(a.c)(e,t),e.create=function(t,n){return new e(t,n)},e.dispatch=function(t){t.subscriber.error(t.error)},e.prototype._subscribe=function(t){var n=this.error,r=this.scheduler;if(t.syncErrorThrowable=!0,r)return r.schedule(e.dispatch,0,{error:n,subscriber:t});t.error(n)},e}(T.a).create;var Nw=function(t){function e(e,n,r){void 0===e&&(e=0),t.call(this),this.period=-1,this.dueTime=0,mw(n)?this.period=Number(n)<1?1:Number(n):Object(tw.a)(n)&&(r=n),Object(tw.a)(r)||(r=yw),this.scheduler=r,this.dueTime=Ow(e)?+e-this.scheduler.now():e}return Object(a.c)(e,t),e.create=function(t,n,r){return void 0===t&&(t=0),new e(t,n,r)},e.dispatch=function(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}},e.prototype._subscribe=function(t){return this.scheduler.schedule(e.dispatch,this.dueTime,{index:0,period:this.period,subscriber:t})},e}(T.a).create;function Lw(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){return e.lift.call(Iw.apply(void 0,[e].concat(t)))}}function Iw(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=t[t.length-1];return"function"==typeof n&&t.pop(),new pn.a(t).lift(new Rw(n))}T.a.timer=Nw;var Rw=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Dw(t,this.project))},t}(),Dw=function(t){function e(e,n,r){void 0===r&&(r=Object.create(null)),t.call(this,e),this.iterators=[],this.active=0,this.project="function"==typeof n?n:null,this.values=r}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.iterators;Object(Tn.a)(t)?e.push(new Uw(t)):e.push("function"==typeof t[Nn.a]?new Fw(t[Nn.a]()):new kw(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(0!==e){this.active=e;for(var n=0;n<e;n++){var r=t[n];r.stillUnsubscribed?this.add(r.subscribe(r,n)):this.active--}}else this.destination.complete()},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,r=0;r<e;r++)if("function"==typeof(a=t[r]).hasValue&&!a.hasValue())return;var i=!1,o=[];for(r=0;r<e;r++){var a,s=(a=t[r]).next();if(a.hasCompleted()&&(i=!0),s.done)return void n.complete();o.push(s.value)}this.project?this._tryProject(o):n.next(o),i&&n.complete()},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(yn.a),Fw=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return t&&t.done},t}(),Uw=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[Nn.a]=function(){return this},t.prototype.next=function(t){var e=this.index++;return e<this.length?{value:this.array[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),kw=function(t){function e(e,n,r){t.call(this,e),this.parent=n,this.observable=r,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}return Object(a.c)(e,t),e.prototype[Nn.a]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return this.buffer.length>0},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){this.buffer.push(e),this.parent.checkIterators()},e.prototype.subscribe=function(t,e){return Object(Zn.a)(this,this.observable,this,e)},e}(Yn.a);function jw(t,e){return void 0===e&&(e=null),new Xw({method:"GET",url:t,headers:e})}function Bw(t,e,n){return new Xw({method:"POST",url:t,body:e,headers:n})}function zw(t,e){return new Xw({method:"DELETE",url:t,headers:e})}function Vw(t,e,n){return new Xw({method:"PUT",url:t,body:e,headers:n})}function Gw(t,e,n){return new Xw({method:"PATCH",url:t,body:e,headers:n})}T.a.zip=Iw;var Hw=bn(function(t,e){return t.response});function Ww(t,e){return Hw(new Xw({method:"GET",url:t,responseType:"json",headers:e}))}var Xw=function(t){function e(e){t.call(this);var n={async:!0,createXHR:function(){return this.crossDomain?(function(){if(En.a.XMLHttpRequest)return new En.a.XMLHttpRequest;if(En.a.XDomainRequest)return new En.a.XDomainRequest;throw new Error("CORS is not supported by your browser")}).call(this):function(){if(En.a.XMLHttpRequest)return new En.a.XMLHttpRequest;var t=void 0;try{for(var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(new En.a.ActiveXObject(t=e[n]))break}catch(t){}return new En.a.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof e)n.url=e;else for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);this.request=n}var n;return Object(a.c)(e,t),e.prototype._subscribe=function(t){return new qw(t,this.request)},e.create=((n=function(t){return new e(t)}).get=jw,n.post=Bw,n.delete=zw,n.put=Vw,n.patch=Gw,n.getJSON=Ww,n),e}(T.a),qw=function(t){function e(e,n){t.call(this,e),this.request=n,this.done=!1;var r=n.headers=n.headers||{};n.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in r||En.a.FormData&&n.body instanceof En.a.FormData||"undefined"==typeof n.body||(r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=this.serializeBody(n.body,n.headers["Content-Type"]),this.send()}return Object(a.c)(e,t),e.prototype.next=function(t){this.done=!0;var e=this.destination,n=new Yw(t,this.xhr,this.request);e.next(n)},e.prototype.send=function(){var t=this.request,e=this.request,n=e.user,r=e.method,i=e.url,o=e.async,a=e.password,s=e.headers,c=e.body,u=t.createXHR,l=Object(Wx.a)(u).call(t);if(l===Xx.a)this.error(Xx.a.e);else{if(this.xhr=l,this.setupEvents(l,t),(n?Object(Wx.a)(l.open).call(l,r,i,o,n,a):Object(Wx.a)(l.open).call(l,r,i,o))===Xx.a)return this.error(Xx.a.e),null;if(o&&(l.timeout=t.timeout,l.responseType=t.responseType),"withCredentials"in l&&(l.withCredentials=!!t.withCredentials),this.setHeaders(l,s),(c?Object(Wx.a)(l.send).call(l,c):Object(Wx.a)(l.send).call(l))===Xx.a)return this.error(Xx.a.e),null}return l},e.prototype.serializeBody=function(t,e){if(!t||"string"==typeof t)return t;if(En.a.FormData&&t instanceof En.a.FormData)return t;if(e){var n=e.indexOf(";");-1!==n&&(e=e.substring(0,n))}switch(e){case"application/x-www-form-urlencoded":return Object.keys(t).map(function(e){return encodeURI(e)+"="+encodeURI(t[e])}).join("&");case"application/json":return JSON.stringify(t);default:return t}},e.prototype.setHeaders=function(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setRequestHeader(n,e[n])},e.prototype.setupEvents=function(t,e){var n,r,i=e.progressSubscriber;function o(t){var e=o.subscriber,n=o.progressSubscriber,r=o.request;n&&n.error(t),e.error(new Qw(this,r))}function a(t){var e=a.subscriber,n=a.progressSubscriber,r=a.request;if(4===this.readyState){var i=1223===this.status?204:this.status;0===i&&(i=("text"===this.responseType?this.response||this.responseText:this.response)?200:0),200<=i&&i<300?(n&&n.complete(),e.next(t),e.complete()):(n&&n.error(t),e.error(new Zw("ajax error "+i,this,r)))}}t.ontimeout=o,o.request=e,o.subscriber=this,o.progressSubscriber=i,t.upload&&"withCredentials"in t&&(i&&(n=function(t){n.progressSubscriber.next(t)},En.a.XDomainRequest?t.onprogress=n:t.upload.onprogress=n,n.progressSubscriber=i),t.onerror=r=function(t){var e=r.progressSubscriber,n=r.subscriber,i=r.request;e&&e.error(t),n.error(new Zw("ajax error",this,i))},r.request=e,r.subscriber=this,r.progressSubscriber=i),t.onreadystatechange=a,a.subscriber=this,a.progressSubscriber=i,a.request=e},e.prototype.unsubscribe=function(){var e=this.xhr;!this.done&&e&&4!==e.readyState&&"function"==typeof e.abort&&e.abort(),t.prototype.unsubscribe.call(this)},e}(yn.a),Yw=function(){return function(t,e,n){this.originalEvent=t,this.xhr=e,this.request=n,this.status=e.status,this.responseType=e.responseType||n.responseType,this.response=Jw(this.responseType,e)}}(),Zw=function(t){function e(e,n,r){t.call(this,e),this.message=e,this.xhr=n,this.request=r,this.status=n.status,this.responseType=n.responseType||r.responseType,this.response=Jw(this.responseType,n)}return Object(a.c)(e,t),e}(Error);function Jw(t,e){switch(t){case"json":return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null");case"xml":return e.responseXML;case"text":default:return"response"in e?e.response:e.responseText}}var Qw=function(t){function e(e,n){t.call(this,"ajax timeout",e,n)}return Object(a.c)(e,t),e}(Zw);T.a.ajax=Xw.create;var Kw=function(t){function e(e,n){t.call(this,e,n),this.scheduler=e,this.work=n}return Object(a.c)(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(vw),$w=new(function(t){function e(){t.apply(this,arguments)}return Object(a.c)(e,t),e}(gw))(Kw),t_=n("1Bqh"),e_=function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY),t.call(this),this.scheduler=r,this._events=[],this._bufferSize=e<1?1:e,this._windowTime=n<1?1:n}return Object(a.c)(e,t),e.prototype.next=function(e){var n=this._getNow();this._events.push(new n_(n,e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._trimBufferThenGetEvents(),r=this.scheduler;if(this.closed)throw new hn.a;this.hasError?e=qx.a.EMPTY:this.isStopped?e=qx.a.EMPTY:(this.observers.push(t),e=new t_.a(this,t)),r&&t.add(t=new Gn(t,r));for(var i=n.length,o=0;o<i&&!t.closed;o++)t.next(n[o].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||$w).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r},e}(ln.b),n_=function(t,e){this.time=t,this.value=e};function r_(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e.length,i=0;i<r;i++){var o=e[i];for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])}return t}var i_=function(t){return En.a.Object.assign||r_}();function o_(t){return function(e){return e.lift(new a_(t))}}T.a.webSocket=function(t){function e(e,n){if(e instanceof T.a)t.call(this,n,e);else{if(t.call(this),this.WebSocketCtor=En.a.WebSocket,this._output=new ln.b,"string"==typeof e?this.url=e:i_(this,e),!this.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new e_}}return Object(a.c)(e,t),e.prototype.resultSelector=function(t){return JSON.parse(t.data)},e.create=function(t){return new e(t)},e.prototype.lift=function(t){var n=new e(this,this.destination);return n.operator=t,n},e.prototype._resetState=function(){this.socket=null,this.source||(this.destination=new e_),this._output=new ln.b},e.prototype.multiplex=function(t,e,n){var r=this;return new T.a(function(i){var o=Object(Wx.a)(t)();o===Xx.a?i.error(Xx.a.e):r.next(o);var a=r.subscribe(function(t){var e=Object(Wx.a)(n)(t);e===Xx.a?i.error(Xx.a.e):e&&i.next(t)},function(t){return i.error(t)},function(){return i.complete()});return function(){var t=Object(Wx.a)(e)();t===Xx.a?i.error(Xx.a.e):r.next(t),a.unsubscribe()}})},e.prototype._connectSocket=function(){var t=this,e=this.WebSocketCtor,n=this._output,r=null;try{r=this.protocol?new e(this.url,this.protocol):new e(this.url),this.socket=r,this.binaryType&&(this.socket.binaryType=this.binaryType)}catch(t){return void n.error(t)}var i=new qx.a(function(){t.socket=null,r&&1===r.readyState&&r.close()});r.onopen=function(e){var o=t.openObserver;o&&o.next(e);var a=t.destination;t.destination=yn.a.create(function(t){return 1===r.readyState&&r.send(t)},function(e){var i=t.closingObserver;i&&i.next(void 0),e&&e.code?r.close(e.code,e.reason):n.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),t._resetState()},function(){var e=t.closingObserver;e&&e.next(void 0),r.close(),t._resetState()}),a&&a instanceof e_&&i.add(a.subscribe(t.destination))},r.onerror=function(e){t._resetState(),n.error(e)},r.onclose=function(e){t._resetState();var r=t.closeObserver;r&&r.next(e),e.wasClean?n.complete():n.error(e)},r.onmessage=function(e){var r=Object(Wx.a)(t.resultSelector)(e);r===Xx.a?n.error(Xx.a.e):n.next(r)}},e.prototype._subscribe=function(t){var e=this,n=this.source;if(n)return n.subscribe(t);this.socket||this._connectSocket();var r=new qx.a;return r.add(this._output.subscribe(t)),r.add(function(){var t=e.socket;0===e._output.observers.length&&(t&&1===t.readyState&&t.close(),e._resetState())}),r},e.prototype.unsubscribe=function(){var e=this.source,n=this.socket;n&&1===n.readyState&&(n.close(),this._resetState()),t.prototype.unsubscribe.call(this),e||(this.destination=new e_)},e}(ln.a).create;var a_=function(){function t(t){this.closingNotifier=t}return t.prototype.call=function(t,e){return e.subscribe(new s_(t,this.closingNotifier))},t}(),s_=function(t){function e(e,n){t.call(this,e),this.buffer=[],this.add(Object(Zn.a)(this,n))}return Object(a.c)(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.buffer;this.buffer=[],this.destination.next(o)},e}(Yn.a);function c_(t,e){return void 0===e&&(e=null),function(n){return n.lift(new u_(t,e))}}T.a.prototype.buffer=function(t){return o_(t)(this)};var u_=function(){function t(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?h_:l_}return t.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},t}(),l_=function(t){function e(e,n){t.call(this,e),this.bufferSize=n,this.buffer=[]}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},e.prototype._complete=function(){var e=this.buffer;e.length>0&&this.destination.next(e),t.prototype._complete.call(this)},e}(yn.a),h_=function(t){function e(e,n,r){t.call(this,e),this.bufferSize=n,this.startBufferEvery=r,this.buffers=[],this.count=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.bufferSize,n=this.startBufferEvery,r=this.buffers,i=this.count;this.count++,i%n==0&&r.push([]);for(var o=r.length;o--;){var a=r[o];a.push(t),a.length===e&&(r.splice(o,1),this.destination.next(a))}},e.prototype._complete=function(){for(var e=this.buffers,n=this.destination;e.length>0;){var r=e.shift();r.length>0&&n.next(r)}t.prototype._complete.call(this)},e}(yn.a);function d_(t){var e=arguments.length,n=yw;Object(tw.a)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],e--);var r=null;e>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),function(e){return e.lift(new p_(t,r,i,n))}}T.a.prototype.bufferCount=function(t,e){return void 0===e&&(e=null),c_(t,e)(this)};var p_=function(){function t(t,e,n,r){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new f_(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},t}(),f_=function(t){function e(e,n,r,i,o){t.call(this,e),this.bufferTimeSpan=n,this.bufferCreationInterval=r,this.maxBufferSize=i,this.scheduler=o,this.contexts=[];var a=this.openContext();if(this.timespanOnly=null==r||r<0,this.timespanOnly)this.add(a.closeAction=o.schedule(m_,n,{subscriber:this,context:a,bufferTimeSpan:n}));else{var s={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:this,scheduler:o};this.add(a.closeAction=o.schedule(g_,n,{subscriber:this,context:a})),this.add(o.schedule(v_,r,s))}}return Object(a.c)(e,t),e.prototype._next=function(t){for(var e,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],a=o.buffer;a.push(t),a.length==this.maxBufferSize&&(e=o)}e&&this.onBufferFull(e)},e.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts,n=this.destination;e.length>0;){var r=e.shift();n.next(r.buffer)}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.contexts=null},e.prototype.onBufferFull=function(t){this.closeContext(t);var e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();var n=this.bufferTimeSpan;this.add(t.closeAction=this.scheduler.schedule(m_,n,{subscriber:this,context:t,bufferTimeSpan:n}))}},e.prototype.openContext=function(){var t=new function(){this.buffer=[]};return this.contexts.push(t),t},e.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)},e}(yn.a);function m_(t){var e=t.subscriber,n=t.context;n&&e.closeContext(n),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function v_(t){var e=t.bufferCreationInterval,n=t.bufferTimeSpan,r=t.subscriber,i=t.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(g_,n,{subscriber:r,context:o})),this.schedule(t,e))}function g_(t){t.subscriber.closeContext(t.context)}function y_(t,e){return function(n){return n.lift(new b_(t,e))}}T.a.prototype.bufferTime=function(t){var e=arguments.length,n=yw;Object(tw.a)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],e--);var r=null;e>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),d_(t,r,i,n)(this)};var b_=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new x_(t,this.openings,this.closingSelector))},t}(),x_=function(t){function e(e,n,r){t.call(this,e),this.openings=n,this.closingSelector=r,this.contexts=[],this.add(Object(Zn.a)(this,n))}return Object(a.c)(e,t),e.prototype._next=function(t){for(var e=this.contexts,n=e.length,r=0;r<n;r++)e[r].buffer.push(t)},e.prototype._error=function(e){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts;e.length>0;){var n=e.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,i){t?this.closeBuffer(t):this.openBuffer(e)},e.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},e.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},e.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var n=t.subscription;this.destination.next(t.buffer),e.splice(e.indexOf(t),1),this.remove(n),n.unsubscribe()}},e.prototype.trySubscribe=function(t){var e=this.contexts,n=new qx.a,r={buffer:[],subscription:n};e.push(r);var i=Object(Zn.a)(this,t,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},e}(Yn.a);function w_(t){return function(e){return e.lift(new __(t))}}T.a.prototype.bufferToggle=function(t,e){return y_(t,e)(this)};var __=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new S_(t,this.closingSelector))},t}(),S_=function(t){function e(e,n){t.call(this,e),this.closingSelector=n,this.subscribing=!1,this.openBuffer()}return Object(a.c)(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},e.prototype.notifyNext=function(t,e,n,r,i){this.openBuffer()},e.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},e.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe()),this.buffer&&this.destination.next(this.buffer),this.buffer=[];var e=Object(Wx.a)(this.closingSelector)();e===Xx.a?this.error(Xx.a.e):(t=new qx.a,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(Object(Zn.a)(this,e)),this.subscribing=!1)},e}(Yn.a);function T_(t){return function(e){return e.lift(new rw(t))}}function M_(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){return e.lift.call(ow.apply(void 0,[e].concat(t)))}}function A_(t,e){return vn(function(){return t},e)}function E_(t){return function(e){return e.lift(new C_(t,e))}}T.a.prototype.bufferWhen=function(t){return w_(t)(this)},T.a.prototype.catch=$n,T.a.prototype._catch=$n,T.a.prototype.combineAll=function(t){return T_(t)(this)},T.a.prototype.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return nw.apply(void 0,t)(this)},T.a.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return M_.apply(void 0,t)(this)},T.a.prototype.concatAll=nr,T.a.prototype.concatMap=gn,T.a.prototype.concatMapTo=function(t,e){return A_(t,e)(this)};var C_=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new P_(t,this.predicate,this.source))},t}(),P_=function(t){function e(e,n,r){t.call(this,e),this.predicate=n,this.source=r,this.count=0,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},e.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++},e.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},e}(yn.a);function O_(){return function(t){return t.lift(new N_)}}T.a.prototype.count=function(t){return E_(t)(this)};var N_=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new L_(t))},t}(),L_=function(t){function e(e){t.call(this,e)}return Object(a.c)(e,t),e.prototype._next=function(t){t.observe(this.destination)},e}(yn.a);function I_(t){return function(e){return e.lift(new R_(t))}}T.a.prototype.dematerialize=function(){return O_()(this)};var R_=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new D_(t,this.durationSelector))},t}(),D_=function(t){function e(e,n){t.call(this,e),this.durationSelector=n,this.hasValue=!1,this.durationSubscription=null}return Object(a.c)(e,t),e.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.emitValue(),this.destination.complete()},e.prototype._tryNext=function(t,e){var n=this.durationSubscription;this.value=t,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=Object(Zn.a)(this,e)).closed||this.add(this.durationSubscription=n)},e.prototype.notifyNext=function(t,e,n,r,i){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){if(this.hasValue){var e=this.value,n=this.durationSubscription;n&&(this.durationSubscription=null,n.unsubscribe(),this.remove(n)),this.value=null,this.hasValue=!1,t.prototype._next.call(this,e)}},e}(Yn.a);function F_(t,e){return void 0===e&&(e=yw),function(n){return n.lift(new U_(t,e))}}T.a.prototype.debounce=function(t){return I_(t)(this)};var U_=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new k_(t,this.dueTime,this.scheduler))},t}(),k_=function(t){function e(e,n,r){t.call(this,e),this.dueTime=n,this.scheduler=r,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}return Object(a.c)(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(j_,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){this.clearDebounce(),this.hasValue&&(this.destination.next(this.lastValue),this.lastValue=null,this.hasValue=!1)},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}(yn.a);function j_(t){t.debouncedNext()}function B_(t,e){void 0===e&&(e=yw);var n=Ow(t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new z_(n,e))}}T.a.prototype.debounceTime=function(t,e){return void 0===e&&(e=yw),F_(t,e)(this)},T.a.prototype.defaultIfEmpty=function(t){return void 0===t&&(t=null),Mr(t)(this)};var z_=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new V_(t,this.delay,this.scheduler))},t}(),V_=function(t){function e(e,n,r){t.call(this,e),this.delay=n,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}return Object(a.c)(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(t,o)}else e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new G_(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(Bn.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t)},e.prototype._complete=function(){this.scheduleNotification(Bn.createComplete())},e}(yn.a),G_=function(t,e){this.time=t,this.notification=e};function H_(t,e){return e?function(n){return new q_(n,e).lift(new W_(t))}:function(e){return e.lift(new W_(t))}}T.a.prototype.delay=function(t,e){return void 0===e&&(e=yw),B_(t,e)(this)};var W_=function(){function t(t){this.delayDurationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new X_(t,this.delayDurationSelector))},t}(),X_=function(t){function e(e,n){t.call(this,e),this.delayDurationSelector=n,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},e.prototype._next=function(t){try{var e=this.delayDurationSelector(t);e&&this.tryDelay(e,t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete()},e.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t),n=null;return-1!==e&&(n=this.values[e],this.delayNotifierSubscriptions.splice(e,1),this.values.splice(e,1)),n},e.prototype.tryDelay=function(t,e){var n=Object(Zn.a)(this,t,e);n&&!n.closed&&(this.add(n),this.delayNotifierSubscriptions.push(n)),this.values.push(e)},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},e}(Yn.a),q_=function(t){function e(e,n){t.call(this),this.source=e,this.subscriptionDelay=n}return Object(a.c)(e,t),e.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new Y_(t,this.source))},e}(T.a),Y_=function(t){function e(e,n){t.call(this),this.parent=e,this.source=n,this.sourceSubscribed=!1}return Object(a.c)(e,t),e.prototype._next=function(t){this.subscribeToSource()},e.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},e.prototype._complete=function(){this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(yn.a);T.a.prototype.delayWhen=function(t,e){return H_(t,e)(this)};var Z_=En.a.Set||function(){return function(){function t(){this._values=[]}return t.prototype.add=function(t){this.has(t)||this._values.push(t)},t.prototype.has=function(t){return-1!==this._values.indexOf(t)},Object.defineProperty(t.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._values.length=0},t}()}();function J_(t,e){return function(n){return n.lift(new Q_(t,e))}}var Q_=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new K_(t,this.keySelector,this.flushes))},t}(),K_=function(t){function e(e,n,r){t.call(this,e),this.keySelector=n,this.values=new Z_,r&&this.add(Object(Zn.a)(this,r))}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.values.clear()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e,n=this.destination;try{e=this.keySelector(t)}catch(t){return void n.error(t)}this._finalizeNext(e,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))},e}(Yn.a);function $_(t,e){return function(n){return n.lift(new tS(t,e))}}T.a.prototype.distinct=function(t,e){return J_(t,e)(this)};var tS=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new eS(t,this.compare,this.keySelector))},t}(),eS=function(t){function e(e,n,r){t.call(this,e),this.keySelector=r,this.hasKey=!1,"function"==typeof n&&(this.compare=n)}return Object(a.c)(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e=t;if(this.keySelector&&(e=Object(Wx.a)(this.keySelector)(t))===Xx.a)return this.destination.error(Xx.a.e);var n=!1;if(this.hasKey){if((n=Object(Wx.a)(this.compare)(this.key,e))===Xx.a)return this.destination.error(Xx.a.e)}else this.hasKey=!0;!1===Boolean(n)&&(this.key=e,this.destination.next(t))},e}(yn.a);function nS(t,e){return $_(function(n,r){return e?e(n[t],r[t]):n[t]===r[t]})}function rS(t,e,n){return function(r){return r.lift(new iS(t,e,n))}}T.a.prototype.distinctUntilChanged=function(t,e){return $_(t,e)(this)},T.a.prototype.distinctUntilKeyChanged=function(t,e){return nS(t,e)(this)};var iS=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new oS(t,this.nextOrObserver,this.error,this.complete))},t}(),oS=function(t){function e(e,n,r,i){t.call(this,e);var o=new yn.a(n,r,i);o.syncErrorThrowable=!0,this.add(o),this.safeSubscriber=o}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.safeSubscriber;e.next(t),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.next(t)},e.prototype._error=function(t){var e=this.safeSubscriber;e.error(t),this.destination.error(e.syncErrorThrown?e.syncErrorValue:t)},e.prototype._complete=function(){var t=this.safeSubscriber;t.complete(),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.complete()},e}(yn.a);function aS(t,e,n){return rS(t,e,n)(this)}function sS(){return function(t){return t.lift(new cS)}}T.a.prototype.do=aS,T.a.prototype._do=aS;var cS=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new uS(t))},t}(),uS=function(t){function e(e){t.call(this,e),this.hasCompleted=!1,this.hasSubscription=!1}return Object(a.c)(e,t),e.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add(Object(Zn.a)(this,t)))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},e.prototype.notifyComplete=function(t){this.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(Yn.a);function lS(t,e){return function(n){return n.lift(new hS(t,e))}}T.a.prototype.exhaust=function(){return sS()(this)};var hS=function(){function t(t,e){this.project=t,this.resultSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new dS(t,this.project,this.resultSelector))},t}(),dS=function(t){function e(e,n,r){t.call(this,e),this.project=n,this.resultSelector=r,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},e.prototype.tryNext=function(t){var e=this.index++,n=this.destination;try{var r=this.project(t,e);this.hasSubscription=!0,this.add(Object(Zn.a)(this,r,t,e))}catch(t){n.error(t)}},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.destination;this.resultSelector?this.trySelectResult(t,e,n,r):o.next(e)},e.prototype.trySelectResult=function(t,e,n,r){var i=this.resultSelector,o=this.destination;try{var a=i(t,e,n,r);o.next(a)}catch(t){o.error(t)}},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(Yn.a);function pS(t,e,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),e=(e||0)<1?Number.POSITIVE_INFINITY:e,function(r){return r.lift(new fS(t,e,n))}}T.a.prototype.exhaustMap=function(t,e){return lS(t,e)(this)};var fS=function(){function t(t,e,n){this.project=t,this.concurrent=e,this.scheduler=n}return t.prototype.call=function(t,e){return e.subscribe(new mS(t,this.project,this.concurrent,this.scheduler))},t}(),mS=function(t){function e(e,n,r,i){t.call(this,e),this.project=n,this.concurrent=r,this.scheduler=i,this.index=0,this.active=0,this.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(this.buffer=[])}return Object(a.c)(e,t),e.dispatch=function(t){t.subscriber.subscribeToProjection(t.result,t.value,t.index)},e.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(t);var i=Object(Wx.a)(this.project)(t,r);i===Xx.a?n.error(Xx.a.e):this.scheduler?this.add(this.scheduler.schedule(e.dispatch,0,{subscriber:this,result:i,value:t,index:r})):this.subscribeToProjection(i,t,r)}else this.buffer.push(t)}},e.prototype.subscribeToProjection=function(t,e,n){this.active++,this.add(Object(Zn.a)(this,t,e,n))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){this._next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},e}(Yn.a);function vS(t,e){return function(n){return n.lift(new gS(t,e))}}T.a.prototype.expand=function(t,e,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),pS(t,e=(e||0)<1?Number.POSITIVE_INFINITY:e,n)(this)};var gS=function(){function t(t,e){if(this.index=t,this.defaultValue=e,t<0)throw new wr}return t.prototype.call=function(t,e){return e.subscribe(new yS(t,this.index,this.defaultValue))},t}(),yS=function(t){function e(e,n,r){t.call(this,e),this.index=n,this.defaultValue=r}return Object(a.c)(e,t),e.prototype._next=function(t){0==this.index--&&(this.destination.next(t),this.destination.complete())},e.prototype._complete=function(){var t=this.destination;this.index>=0&&("undefined"!=typeof this.defaultValue?t.next(this.defaultValue):t.error(new wr)),t.complete()},e}(yn.a);function bS(t){return function(e){return e.lift(new xS(t))}}T.a.prototype.elementAt=function(t,e){return vS(t,e)(this)},T.a.prototype.filter=Rr;var xS=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new wS(t,this.callback))},t}(),wS=function(t){function e(e,n){t.call(this,e),this.add(new qx.a(n))}return Object(a.c)(e,t),e}(yn.a);function _S(t){return bS(t)(this)}function SS(t,e){if("function"!=typeof t)throw new TypeError("predicate is not a function");return function(n){return n.lift(new TS(t,n,!1,e))}}T.a.prototype.finally=_S,T.a.prototype._finally=_S;var TS=function(){function t(t,e,n,r){this.predicate=t,this.source=e,this.yieldIndex=n,this.thisArg=r}return t.prototype.call=function(t,e){return e.subscribe(new MS(t,this.predicate,this.source,this.yieldIndex,this.thisArg))},t}(),MS=function(t){function e(e,n,r,i,o){t.call(this,e),this.predicate=n,this.source=r,this.yieldIndex=i,this.thisArg=o,this.index=0}return Object(a.c)(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype._next=function(t){var e=this.predicate,n=this.thisArg,r=this.index++;try{e.call(n||this,t,r,this.source)&&this.notifyComplete(this.yieldIndex?r:t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},e}(yn.a);function AS(t,e){return function(n){return n.lift(new TS(t,n,!0,e))}}T.a.prototype.find=function(t,e){return SS(t,e)(this)},T.a.prototype.findIndex=function(t,e){return AS(t,e)(this)},T.a.prototype.first=sr;var ES=function(){function t(){this.size=0,this._values=[],this._keys=[]}return t.prototype.get=function(t){var e=this._keys.indexOf(t);return-1===e?void 0:this._values[e]},t.prototype.set=function(t,e){var n=this._keys.indexOf(t);return-1===n?(this._keys.push(t),this._values.push(e),this.size++):this._values[n]=e,this},t.prototype.delete=function(t){var e=this._keys.indexOf(t);return-1!==e&&(this._values.splice(e,1),this._keys.splice(e,1),this.size--,!0)},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},t.prototype.forEach=function(t,e){for(var n=0;n<this.size;n++)t.call(e,this._values[n],this._keys[n])},t}(),CS=En.a.Map||function(){return ES}(),PS=function(){function t(){this.values={}}return t.prototype.delete=function(t){return this.values[t]=null,!0},t.prototype.set=function(t,e){return this.values[t]=e,this},t.prototype.get=function(t){return this.values[t]},t.prototype.forEach=function(t,e){var n=this.values;for(var r in n)n.hasOwnProperty(r)&&null!==n[r]&&t.call(e,n[r],r)},t.prototype.clear=function(){this.values={}},t}();function OS(t,e,n,r){return function(i){return i.lift(new NS(t,e,n,r))}}var NS=function(){function t(t,e,n,r){this.keySelector=t,this.elementSelector=e,this.durationSelector=n,this.subjectSelector=r}return t.prototype.call=function(t,e){return e.subscribe(new LS(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},t}(),LS=function(t){function e(e,n,r,i,o){t.call(this,e),this.keySelector=n,this.elementSelector=r,this.durationSelector=i,this.subjectSelector=o,this.groups=null,this.attemptedToUnsubscribe=!1,this.count=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups="string"==typeof e?new PS:new CS);var r,i=n.get(e);if(this.elementSelector)try{r=this.elementSelector(t)}catch(t){this.error(t)}else r=t;if(!i){i=this.subjectSelector?this.subjectSelector():new ln.b,n.set(e,i);var o=new RS(e,i,this);if(this.destination.next(o),this.durationSelector){var a=void 0;try{a=this.durationSelector(new RS(e,i))}catch(t){return void this.error(t)}this.add(a.subscribe(new IS(e,i,this)))}}i.closed||i.next(r)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach(function(e,n){e.error(t)}),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach(function(t,e){t.complete()}),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))},e}(yn.a),IS=function(t){function e(e,n,r){t.call(this,n),this.key=e,this.group=n,this.parent=r}return Object(a.c)(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(yn.a),RS=function(t){function e(e,n,r){t.call(this),this.key=e,this.groupSubject=n,this.refCountSubscription=r}return Object(a.c)(e,t),e.prototype._subscribe=function(t){var e=new qx.a,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&e.add(new DS(n)),e.add(r.subscribe(t)),e},e}(T.a),DS=function(t){function e(e){t.call(this),this.parent=e,e.count++}return Object(a.c)(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),e.count-=1,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(qx.a);function FS(){return function(t){return t.lift(new US)}}T.a.prototype.groupBy=function(t,e,n,r){return OS(t,e,n,r)(this)};var US=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new kS(t))},t}(),kS=function(t){function e(){t.apply(this,arguments)}return Object(a.c)(e,t),e.prototype._next=function(t){Object(Sw.a)()},e}(yn.a);function jS(){return function(t){return t.lift(new BS)}}T.a.prototype.ignoreElements=function(){return FS()(this)};var BS=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new zS(t))},t}(),zS=function(t){function e(e){t.call(this,e)}return Object(a.c)(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype._next=function(t){this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(yn.a);function VS(t){return function(e){return e.lift(new GS(t))}}T.a.prototype.isEmpty=function(){return jS()(this)};var GS=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new HS(t,this.durationSelector))},t}(),HS=function(t){function e(e,n){t.call(this,e),this.durationSelector=n,this.hasValue=!1}return Object(a.c)(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=Object(Wx.a)(this.durationSelector)(t);if(e===Xx.a)this.destination.error(Xx.a.e);else{var n=Object(Zn.a)(this,e);n.closed?this.clearThrottle():this.add(this.throttled=n)}}},e.prototype.clearThrottle=function(){var t=this.value,e=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),e&&(this.value=null,this.hasValue=!1,this.destination.next(t))},e.prototype.notifyNext=function(t,e,n,r){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()},e}(Yn.a);function WS(t,e){return void 0===e&&(e=yw),VS(function(){return Nw(t,e)})}function XS(t){return t(this)}function qS(t){return function(e){return e.lift(new YS(t))}}T.a.prototype.audit=function(t){return VS(t)(this)},T.a.prototype.auditTime=function(t,e){return void 0===e&&(e=yw),WS(t,e)(this)},T.a.prototype.last=vr,T.a.prototype.let=XS,T.a.prototype.letBind=XS,T.a.prototype.every=dr,T.a.prototype.map=_n;var YS=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new ZS(t,this.value))},t}(),ZS=function(t){function e(e,n){t.call(this,e),this.value=n}return Object(a.c)(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(yn.a);function JS(){return function(t){return t.lift(new QS)}}T.a.prototype.mapTo=function(t){return qS(t)(this)};var QS=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new KS(t))},t}(),KS=function(t){function e(e){t.call(this,e)}return Object(a.c)(e,t),e.prototype._next=function(t){this.destination.next(Bn.createNext(t))},e.prototype._error=function(t){var e=this.destination;e.next(Bn.createError(t)),e.complete()},e.prototype._complete=function(){var t=this.destination;t.next(Bn.createComplete()),t.complete()},e}(yn.a);function $S(t){return Pr("function"==typeof t?function(e,n){return t(e,n)>0?e:n}:function(t,e){return t>e?t:e})}function tT(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){return e.lift.call(bw.a.apply(void 0,[e].concat(t)))}}function eT(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"number"==typeof e&&(n=e,e=null),function(r){return r.lift(new nT(t,e,n))}}T.a.prototype.materialize=function(){return JS()(this)},T.a.prototype.max=function(t){return $S(t)(this)},T.a.prototype.merge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return tT.apply(void 0,t)(this)},T.a.prototype.mergeAll=gr,T.a.prototype.mergeMap=Sn,T.a.prototype.flatMap=Sn;var nT=function(){function t(t,e,n){void 0===n&&(n=Number.POSITIVE_INFINITY),this.ish=t,this.resultSelector=e,this.concurrent=n}return t.prototype.call=function(t,e){return e.subscribe(new rT(t,this.ish,this.resultSelector,this.concurrent))},t}(),rT=function(t){function e(e,n,r,i){void 0===i&&(i=Number.POSITIVE_INFINITY),t.call(this,e),this.ish=n,this.resultSelector=r,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){if(this.active<this.concurrent){var e=this.resultSelector,n=this.index++,r=this.ish,i=this.destination;this.active++,this._innerSub(r,i,e,t,n)}else this.buffer.push(t)},e.prototype._innerSub=function(t,e,n,r,i){this.add(Object(Zn.a)(this,t,r,i))},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.destination;this.resultSelector?this.trySelectResult(t,e,n,r):o.next(e)},e.prototype.trySelectResult=function(t,e,n,r){var i,o=this.resultSelector,a=this.destination;try{i=o(t,e,n,r)}catch(t){return void a.error(t)}a.next(i)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(Yn.a);function iT(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),eT(t,e,n)(this)}function oT(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new aT(t,e,n))}}T.a.prototype.flatMapTo=iT,T.a.prototype.mergeMapTo=iT;var aT=function(){function t(t,e,n){this.accumulator=t,this.seed=e,this.concurrent=n}return t.prototype.call=function(t,e){return e.subscribe(new sT(t,this.accumulator,this.seed,this.concurrent))},t}(),sT=function(t){function e(e,n,r,i){t.call(this,e),this.accumulator=n,this.acc=r,this.concurrent=i,this.hasValue=!1,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,n=Object(Wx.a)(this.accumulator)(this.acc,t);n===Xx.a?this.destination.error(Xx.a.e):(this.active++,this._innerSub(n,t,e))}else this.buffer.push(t)},e.prototype._innerSub=function(t,e,n){this.add(Object(Zn.a)(this,t,e,n))},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.destination;this.acc=e,this.hasValue=!0,o.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},e}(Yn.a);function cT(t){return Pr("function"==typeof t?function(e,n){return t(e,n)<0?e:n}:function(t,e){return t<e?t:e})}T.a.prototype.mergeScan=function(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),oT(t,e,n)(this)},T.a.prototype.min=function(t){return cT(t)(this)};var uT=n("Jwyl");function lT(){return function(t){return t.lift(new hT)}}T.a.prototype.multicast=function(t,e){return Object(uT.a)(t,e)(this)},T.a.prototype.observeOn=function(t,e){return void 0===e&&(e=0),zn(t,e)(this)},T.a.prototype.onErrorResumeNext=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return Tw.apply(void 0,t)(this)};var hT=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new dT(t))},t}(),dT=function(t){function e(e){t.call(this,e),this.hasPrev=!1}return Object(a.c)(e,t),e.prototype._next=function(t){this.hasPrev?this.destination.next([this.prev,t]):this.hasPrev=!0,this.prev=t},e}(yn.a);function pT(t,e){return function(n){return[Nr(t,e)(n),Nr(function(e,n){function r(){return!r.pred.apply(r.thisArg,arguments)}return r.pred=t,r.thisArg=n,r}(0,e))(n)]}}function fT(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=t.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(e){return bn(function(t,e){return function(n){for(var r=n,i=0;i<e;i++){var o=r[t[i]];if("undefined"==typeof o)return;r=o}return r}}(t,n))(e)}}function mT(t){return t?Object(uT.a)(function(){return new ln.b},t):Object(uT.a)(new ln.b)}function vT(t){return function(e){return Object(uT.a)(new dn(t))(e)}}function gT(t,e,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,o=new e_(t,e,r);return function(t){return Object(uT.a)(function(){return o},i)(t)}}function yT(){return function(t){return Object(uT.a)(new Yx)(t)}}function bT(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){return 1===t.length&&Object(Tn.a)(t[0])&&(t=t[0]),e.lift.call(xw.apply(void 0,[e].concat(t)))}}function xT(t){return void 0===t&&(t=-1),function(e){return 0===t?new kn.a:e.lift(new wT(t<0?-1:t-1,e))}}T.a.prototype.pairwise=function(){return lT()(this)},T.a.prototype.partition=function(t,e){return pT(t,e)(this)},T.a.prototype.pluck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return fT.apply(void 0,t)(this)},T.a.prototype.publish=function(t){return mT(t)(this)},T.a.prototype.publishBehavior=function(t){return vT(t)(this)},T.a.prototype.publishReplay=function(t,e,n,r){return gT(t,e,n,r)(this)},T.a.prototype.publishLast=function(){return yT()(this)},T.a.prototype.race=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return bT.apply(void 0,t)(this)},T.a.prototype.reduce=Or;var wT=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new _T(t,this.count,this.source))},t}(),_T=function(t){function e(e,n,r){t.call(this,e),this.count=n,this.source=r}return Object(a.c)(e,t),e.prototype.complete=function(){if(!this.isStopped){var e=this.source,n=this.count;if(0===n)return t.prototype.complete.call(this);n>-1&&(this.count=n-1),e.subscribe(this._unsubscribeAndRecycle())}},e}(yn.a);function ST(t){return function(e){return e.lift(new TT(t))}}T.a.prototype.repeat=function(t){return void 0===t&&(t=-1),xT(t)(this)};var TT=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new MT(t,this.notifier,e))},t}(),MT=function(t){function e(e,n,r){t.call(this,e),this.notifier=n,this.source=r,this.sourceIsBeingSubscribedTo=!0}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},e.prototype.notifyComplete=function(e){if(!1===this.sourceIsBeingSubscribedTo)return t.prototype.complete.call(this)},e.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return t.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},e.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},e.prototype._unsubscribeAndRecycle=function(){var e=this.notifications,n=this.retries,r=this.retriesSubscription;return this.notifications=null,this.retries=null,this.retriesSubscription=null,t.prototype._unsubscribeAndRecycle.call(this),this.notifications=e,this.retries=n,this.retriesSubscription=r,this},e.prototype.subscribeToRetries=function(){this.notifications=new ln.b;var e=Object(Wx.a)(this.notifier)(this.notifications);if(e===Xx.a)return t.prototype.complete.call(this);this.retries=e,this.retriesSubscription=Object(Zn.a)(this,e)},e}(Yn.a);function AT(t){return void 0===t&&(t=-1),function(e){return e.lift(new ET(t,e))}}T.a.prototype.repeatWhen=function(t){return ST(t)(this)};var ET=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new CT(t,this.count,this.source))},t}(),CT=function(t){function e(e,n,r){t.call(this,e),this.count=n,this.source=r}return Object(a.c)(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return t.prototype.error.call(this,e);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},e}(yn.a);function PT(t){return function(e){return e.lift(new OT(t,e))}}T.a.prototype.retry=function(t){return void 0===t&&(t=-1),AT(t)(this)};var OT=function(){function t(t,e){this.notifier=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new NT(t,this.notifier,this.source))},t}(),NT=function(t){function e(e,n,r){t.call(this,e),this.notifier=n,this.source=r}return Object(a.c)(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(n=new ln.b,(r=Object(Wx.a)(this.notifier)(n))===Xx.a)return t.prototype.error.call(this,Xx.a.e);i=Object(Zn.a)(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.errors,a=this.retries,s=this.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=o,this.retries=a,this.retriesSubscription=s,this.source.subscribe(this)},e}(Yn.a);function LT(t){return function(e){return e.lift(new IT(t))}}T.a.prototype.retryWhen=function(t){return PT(t)(this)};var IT=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new RT(t),r=e.subscribe(n);return r.add(Object(Zn.a)(n,this.notifier)),r},t}(),RT=function(t){function e(){t.apply(this,arguments),this.hasValue=!1}return Object(a.c)(e,t),e.prototype._next=function(t){this.value=t,this.hasValue=!0},e.prototype.notifyNext=function(t,e,n,r,i){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},e}(Yn.a);function DT(t,e){return void 0===e&&(e=yw),function(n){return n.lift(new FT(t,e))}}T.a.prototype.sample=function(t){return LT(t)(this)};var FT=function(){function t(t,e){this.period=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new UT(t,this.period,this.scheduler))},t}(),UT=function(t){function e(e,n,r){t.call(this,e),this.period=n,this.scheduler=r,this.hasValue=!1,this.add(r.schedule(kT,n,{subscriber:this,period:n}))}return Object(a.c)(e,t),e.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},e}(yn.a);function kT(t){var e=t.period;t.subscriber.notifyNext(),this.schedule(t,e)}function jT(t,e){return function(n){return n.lift(new BT(t,e))}}T.a.prototype.sampleTime=function(t,e){return void 0===e&&(e=yw),DT(t,e)(this)},T.a.prototype.scan=function(t,e){return arguments.length>=2?yr(t,e)(this):yr(t)(this)};var BT=function(){function t(t,e){this.compareTo=t,this.comparor=e}return t.prototype.call=function(t,e){return e.subscribe(new zT(t,this.compareTo,this.comparor))},t}(),zT=function(t){function e(e,n,r){t.call(this,e),this.compareTo=n,this.comparor=r,this._a=[],this._b=[],this._oneComplete=!1,this.add(n.subscribe(new VT(e,this)))}return Object(a.c)(e,t),e.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},e.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},e.prototype.checkValues=function(){for(var t=this._a,e=this._b,n=this.comparor;t.length>0&&e.length>0;){var r=t.shift(),i=e.shift(),o=!1;n?(o=Object(Wx.a)(n)(r,i))===Xx.a&&this.destination.error(Xx.a.e):o=r===i,o||this.emit(!1)}},e.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},e}(yn.a),VT=function(t){function e(e,n){t.call(this,e),this.parent=n}return Object(a.c)(e,t),e.prototype._next=function(t){this.parent.nextB(t)},e.prototype._error=function(t){this.parent.error(t)},e.prototype._complete=function(){this.parent._complete()},e}(yn.a);T.a.prototype.sequenceEqual=function(t,e){return jT(t,e)(this)};var GT=n("Rf9G");function HT(t,e,n){return function(r){return r.lift(function(t,e,n){var r,i,o=0,a=!1,s=!1;return function(c){o++,r&&!a||(a=!1,r=new e_(t,e,n),i=c.subscribe({next:function(t){r.next(t)},error:function(t){a=!0,r.error(t)},complete:function(){s=!0,r.complete()}}));var u=r.subscribe(this);return function(){o--,u.unsubscribe(),i&&0===o&&s&&i.unsubscribe()}}}(t,e,n))}}function WT(t){return function(e){return e.lift(new XT(t,e))}}T.a.prototype.share=GT.a,T.a.prototype.shareReplay=function(t,e,n){return HT(t,e,n)(this)};var XT=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new qT(t,this.predicate,this.source))},t}(),qT=function(t){function e(e,n,r){t.call(this,e),this.predicate=n,this.source=r,this.seenValue=!1,this.index=0}return Object(a.c)(e,t),e.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},e.prototype._next=function(t){var e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)},e.prototype.tryNext=function(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){var t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new rr)},e}(yn.a);function YT(t){return function(e){return e.lift(new ZT(t))}}T.a.prototype.single=function(t){return WT(t)(this)};var ZT=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new JT(t,this.total))},t}(),JT=function(t){function e(e,n){t.call(this,e),this.total=n,this.count=0}return Object(a.c)(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(yn.a);function QT(t){return function(e){return e.lift(new KT(t))}}T.a.prototype.skip=function(t){return YT(t)(this)};var KT=function(){function t(t){if(this._skipCount=t,this._skipCount<0)throw new wr}return t.prototype.call=function(t,e){return e.subscribe(0===this._skipCount?new yn.a(t):new $T(t,this._skipCount))},t}(),$T=function(t){function e(e,n){t.call(this,e),this._skipCount=n,this._count=0,this._ring=new Array(n)}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this._skipCount,n=this._count++;if(n<e)this._ring[n]=t;else{var r=n%e,i=this._ring,o=i[r];i[r]=t,this.destination.next(o)}},e}(yn.a);function tM(t){return function(e){return e.lift(new eM(t))}}T.a.prototype.skipLast=function(t){return QT(t)(this)};var eM=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new nM(t,this.notifier))},t}(),nM=function(t){function e(e,n){t.call(this,e),this.hasValue=!1,this.isInnerStopped=!1,this.add(Object(Zn.a)(this,n))}return Object(a.c)(e,t),e.prototype._next=function(e){this.hasValue&&t.prototype._next.call(this,e)},e.prototype._complete=function(){this.isInnerStopped?t.prototype._complete.call(this):this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,i){this.hasValue=!0},e.prototype.notifyComplete=function(){this.isInnerStopped=!0,this.isStopped&&t.prototype._complete.call(this)},e}(Yn.a);function rM(t){return function(e){return e.lift(new iM(t))}}T.a.prototype.skipUntil=function(t){return tM(t)(this)};var iM=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new oM(t,this.predicate))},t}(),oM=function(t){function e(e,n){t.call(this,e),this.predicate=n,this.skipping=!0,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},e.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}},e}(yn.a);function aM(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){var n=t[t.length-1];Object(tw.a)(n)?t.pop():n=null;var r=t.length;return ow(1===r?new Un.a(t[0],n):r>1?new pn.a(t,n):new kn.a(n),e)}}T.a.prototype.skipWhile=function(t){return rM(t)(this)},T.a.prototype.startWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return aM.apply(void 0,t)(this)};var sM=new(function(){function t(t){if(this.root=t,t.setImmediate&&"function"==typeof t.setImmediate)this.setImmediate=t.setImmediate.bind(t),this.clearImmediate=t.clearImmediate.bind(t);else{this.nextHandle=1,this.tasksByHandle={},this.currentlyRunningATask=!1,this.setImmediate=this.canUseProcessNextTick()?this.createProcessNextTickSetImmediate():this.canUsePostMessage()?this.createPostMessageSetImmediate():this.canUseMessageChannel()?this.createMessageChannelSetImmediate():this.canUseReadyStateChange()?this.createReadyStateChangeSetImmediate():this.createSetTimeoutSetImmediate();var e=function t(e){delete t.instance.tasksByHandle[e]};e.instance=this,this.clearImmediate=e}}return t.prototype.identify=function(t){return this.root.Object.prototype.toString.call(t)},t.prototype.canUseProcessNextTick=function(){return"[object process]"===this.identify(this.root.process)},t.prototype.canUseMessageChannel=function(){return Boolean(this.root.MessageChannel)},t.prototype.canUseReadyStateChange=function(){var t=this.root.document;return Boolean(t&&"onreadystatechange"in t.createElement("script"))},t.prototype.canUsePostMessage=function(){var t=this.root;if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}return!1},t.prototype.partiallyApplied=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=function t(){var e=t.handler;"function"==typeof e?e.apply(void 0,t.args):new Function(""+e)()};return r.handler=t,r.args=e,r},t.prototype.addFromSetImmediateArguments=function(t){return this.tasksByHandle[this.nextHandle]=this.partiallyApplied.apply(void 0,t),this.nextHandle++},t.prototype.createProcessNextTickSetImmediate=function(){var t=function t(){var e=t.instance,n=e.addFromSetImmediateArguments(arguments);return e.root.process.nextTick(e.partiallyApplied(e.runIfPresent,n)),n};return t.instance=this,t},t.prototype.createPostMessageSetImmediate=function(){var t=this.root,e="setImmediate$"+t.Math.random()+"$",n=function n(r){var i=n.instance;r.source===t&&"string"==typeof r.data&&0===r.data.indexOf(e)&&i.runIfPresent(+r.data.slice(e.length))};n.instance=this,t.addEventListener("message",n,!1);var r=function t(){var e=t.messagePrefix,n=t.instance,r=n.addFromSetImmediateArguments(arguments);return n.root.postMessage(e+r,"*"),r};return r.instance=this,r.messagePrefix=e,r},t.prototype.runIfPresent=function(t){if(this.currentlyRunningATask)this.root.setTimeout(this.partiallyApplied(this.runIfPresent,t),0);else{var e=this.tasksByHandle[t];if(e){this.currentlyRunningATask=!0;try{e()}finally{this.clearImmediate(t),this.currentlyRunningATask=!1}}}},t.prototype.createMessageChannelSetImmediate=function(){var t=this,e=new this.root.MessageChannel;e.port1.onmessage=function(e){t.runIfPresent(e.data)};var n=function t(){var e=t.channel,n=t.instance.addFromSetImmediateArguments(arguments);return e.port2.postMessage(n),n};return n.channel=e,n.instance=this,n},t.prototype.createReadyStateChangeSetImmediate=function(){var t=function t(){var e=t.instance,n=e.root.document,r=n.documentElement,i=e.addFromSetImmediateArguments(arguments),o=n.createElement("script");return o.onreadystatechange=function(){e.runIfPresent(i),o.onreadystatechange=null,r.removeChild(o),o=null},r.appendChild(o),i};return t.instance=this,t},t.prototype.createSetTimeoutSetImmediate=function(){var t=function t(){var e=t.instance,n=e.addFromSetImmediateArguments(arguments);return e.root.setTimeout(e.partiallyApplied(e.runIfPresent,n),0),n};return t.instance=this,t},t}())(En.a),cM=function(t){function e(e,n){t.call(this,e,n),this.scheduler=e,this.work=n}return Object(a.c)(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=sM.setImmediate(e.flush.bind(e,null))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(sM.clearImmediate(n),e.scheduled=void 0)},e}(vw),uM=new(function(t){function e(){t.apply(this,arguments)}return Object(a.c)(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(gw))(cM),lM=function(t){function e(e,n,r){void 0===n&&(n=0),void 0===r&&(r=uM),t.call(this),this.source=e,this.delayTime=n,this.scheduler=r,(!mw(n)||n<0)&&(this.delayTime=0),r&&"function"==typeof r.schedule||(this.scheduler=uM)}return Object(a.c)(e,t),e.create=function(t,n,r){return void 0===n&&(n=0),void 0===r&&(r=uM),new e(t,n,r)},e.dispatch=function(t){return this.add(t.source.subscribe(t.subscriber))},e.prototype._subscribe=function(t){return this.scheduler.schedule(e.dispatch,this.delayTime,{source:this.source,subscriber:t})},e}(T.a),hM=function(){function t(t,e){this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return new lM(e,this.delay,this.scheduler).subscribe(t)},t}();function dM(t,e){return function(n){return n.lift(new pM(t,e))}}T.a.prototype.subscribeOn=function(t,e){return void 0===e&&(e=0),function(t,e){return void 0===e&&(e=0),function(n){return n.lift(new hM(t,e))}}(t,e)(this)};var pM=function(){function t(t,e){this.project=t,this.resultSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new fM(t,this.project,this.resultSelector))},t}(),fM=function(t){function e(e,n,r){t.call(this,e),this.project=n,this.resultSelector=r,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=this.innerSubscription;r&&r.unsubscribe(),this.add(this.innerSubscription=Object(Zn.a)(this,t,e,n))},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,i){this.resultSelector?this._tryNotifyNext(t,e,n,r):this.destination.next(e)},e.prototype._tryNotifyNext=function(t,e,n,r){var i;try{i=this.resultSelector(t,e,n,r)}catch(t){return void this.destination.error(t)}this.destination.next(i)},e}(Yn.a),mM=n("lAP5");function vM(){return dM(mM.a)}function gM(){return vM()(this)}function yM(t,e){return function(n){return n.lift(new bM(t,e))}}T.a.prototype.switch=gM,T.a.prototype._switch=gM,T.a.prototype.switchMap=function(t,e){return dM(t,e)(this)};var bM=function(){function t(t,e){this.observable=t,this.resultSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new xM(t,this.observable,this.resultSelector))},t}(),xM=function(t){function e(e,n,r){t.call(this,e),this.inner=n,this.resultSelector=r,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.innerSubscription;e&&e.unsubscribe(),this.add(this.innerSubscription=Object(Zn.a)(this,this.inner,t,this.index++))},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.destination;this.resultSelector?this.tryResultSelector(t,e,n,r):o.next(e)},e.prototype.tryResultSelector=function(t,e,n,r){var i,o=this.resultSelector,a=this.destination;try{i=o(t,e,n,r)}catch(t){return void a.error(t)}a.next(i)},e}(Yn.a);function wM(t){return function(e){return 0===t?new kn.a:e.lift(new _M(t))}}T.a.prototype.switchMapTo=function(t,e){return yM(t,e)(this)};var _M=function(){function t(t){if(this.total=t,this.total<0)throw new wr}return t.prototype.call=function(t,e){return e.subscribe(new SM(t,this.total))},t}(),SM=function(t){function e(e,n){t.call(this,e),this.total=n,this.count=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(yn.a);function TM(t){return function(e){return e.lift(new MM(t))}}T.a.prototype.take=function(t){return wM(t)(this)},T.a.prototype.takeLast=function(t){return _r(t)(this)};var MM=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new AM(t,this.notifier))},t}(),AM=function(t){function e(e,n){t.call(this,e),this.notifier=n,this.add(Object(Zn.a)(this,n))}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.complete()},e.prototype.notifyComplete=function(){},e}(Yn.a);function EM(t){return function(e){return e.lift(new CM(t))}}T.a.prototype.takeUntil=function(t){return TM(t)(this)};var CM=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new PM(t,this.predicate))},t}(),PM=function(t){function e(e,n){t.call(this,e),this.predicate=n,this.index=0}return Object(a.c)(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):n.complete()},e}(yn.a);T.a.prototype.takeWhile=function(t){return EM(t)(this)};var OM={leading:!0,trailing:!1};function NM(t,e){return void 0===e&&(e=OM),function(n){return n.lift(new LM(t,e.leading,e.trailing))}}var LM=function(){function t(t,e,n){this.durationSelector=t,this.leading=e,this.trailing=n}return t.prototype.call=function(t,e){return e.subscribe(new IM(t,this.durationSelector,this.leading,this.trailing))},t}(),IM=function(t){function e(e,n,r,i){t.call(this,e),this.destination=e,this.durationSelector=n,this._leading=r,this._trailing=i,this._hasTrailingValue=!1}return Object(a.c)(e,t),e.prototype._next=function(t){if(this.throttled)this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=t);else{var e=this.tryDurationSelector(t);e&&this.add(this.throttled=Object(Zn.a)(this,e)),this._leading&&(this.destination.next(t),this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=t))}},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype._unsubscribe=function(){var t=this.throttled;this._trailingValue=null,this._hasTrailingValue=!1,t&&(this.remove(t),this.throttled=null,t.unsubscribe())},e.prototype._sendTrailing=function(){var t=this;t.throttled&&t._trailing&&t._hasTrailingValue&&(t.destination.next(t._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1)},e.prototype.notifyNext=function(t,e,n,r,i){this._sendTrailing(),this._unsubscribe()},e.prototype.notifyComplete=function(){this._sendTrailing(),this._unsubscribe()},e}(Yn.a);function RM(t,e,n){return void 0===e&&(e=yw),void 0===n&&(n=OM),function(r){return r.lift(new DM(t,e,n.leading,n.trailing))}}T.a.prototype.throttle=function(t,e){return void 0===e&&(e=OM),NM(t,e)(this)};var DM=function(){function t(t,e,n,r){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=r}return t.prototype.call=function(t,e){return e.subscribe(new FM(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),FM=function(t){function e(e,n,r,i,o){t.call(this,e),this.duration=n,this.scheduler=r,this.leading=i,this.trailing=o,this._hasTrailingValue=!1,this._trailingValue=null}return Object(a.c)(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(UM,this.duration,{subscriber:this})),this.leading&&this.destination.next(t))},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(yn.a);function UM(t){t.subscriber.clearThrottle()}function kM(t){return void 0===t&&(t=yw),function(e){return e.lift(new jM(t))}}T.a.prototype.throttleTime=function(t,e,n){return void 0===e&&(e=yw),void 0===n&&(n=OM),RM(t,e,n)(this)};var jM=function(){function t(t){this.scheduler=t}return t.prototype.call=function(t,e){return e.subscribe(new BM(t,this.scheduler))},t}(),BM=function(t){function e(e,n){t.call(this,e),this.scheduler=n,this.lastTime=0,this.lastTime=n.now()}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.scheduler.now(),n=e-this.lastTime;this.lastTime=e,this.destination.next(new function(t,e){this.value=t,this.interval=e}(t,n))},e}(yn.a);T.a.prototype.timeInterval=function(t){return void 0===t&&(t=yw),kM(t)(this)};var zM=function(t){function e(){var e=t.call(this,"Timeout has occurred");this.name=e.name="TimeoutError",this.stack=e.stack,this.message=e.message}return Object(a.c)(e,t),e}(Error);function VM(t,e){void 0===e&&(e=yw);var n=Ow(t),r=n?+t-e.now():Math.abs(t);return function(t){return t.lift(new GM(r,n,e,new zM))}}var GM=function(){function t(t,e,n,r){this.waitFor=t,this.absoluteTimeout=e,this.scheduler=n,this.errorInstance=r}return t.prototype.call=function(t,e){return e.subscribe(new HM(t,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))},t}(),HM=function(t){function e(e,n,r,i,o){t.call(this,e),this.absoluteTimeout=n,this.waitFor=r,this.scheduler=i,this.errorInstance=o,this.action=null,this.scheduleTimeout()}return Object(a.c)(e,t),e.dispatchTimeout=function(t){t.error(t.errorInstance)},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.errorInstance=null},e}(yn.a);function WM(t,e,n){return void 0===n&&(n=yw),function(r){var i=Ow(t),o=i?+t-n.now():Math.abs(t);return r.lift(new XM(o,i,e,n))}}T.a.prototype.timeout=function(t,e){return void 0===e&&(e=yw),VM(t,e)(this)};var XM=function(){function t(t,e,n,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new qM(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),qM=function(t){function e(e,n,r,i,o){t.call(this,e),this.absoluteTimeout=n,this.waitFor=r,this.withObservable=i,this.scheduler=o,this.action=null,this.scheduleTimeout()}return Object(a.c)(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(Object(Zn.a)(t,e))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},e}(Yn.a);function YM(t){return void 0===t&&(t=yw),bn(function(e){return new ZM(e,t.now())})}T.a.prototype.timeoutWith=function(t,e,n){return void 0===n&&(n=yw),WM(t,e,n)(this)};var ZM=function(t,e){this.value=t,this.timestamp=e};function JM(t,e,n){return 0===n?[e]:(t.push(e),t)}function QM(){return Pr(JM,[])}function KM(t){return function(e){return e.lift(new $M(t))}}T.a.prototype.timestamp=function(t){return void 0===t&&(t=yw),YM(t)(this)},T.a.prototype.toArray=function(){return QM()(this)},n("EN1B");var $M=function(){function t(t){this.windowBoundaries=t}return t.prototype.call=function(t,e){var n=new tA(t),r=e.subscribe(n);return r.closed||n.add(Object(Zn.a)(n,this.windowBoundaries)),r},t}(),tA=function(t){function e(e){t.call(this,e),this.window=new ln.b,e.next(this.window)}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.openWindow()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){this._complete()},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t)},e.prototype._complete=function(){this.window.complete(),this.destination.complete()},e.prototype._unsubscribe=function(){this.window=null},e.prototype.openWindow=function(){var t=this.window;t&&t.complete();var e=this.destination,n=this.window=new ln.b;e.next(n)},e}(Yn.a);function eA(t,e){return void 0===e&&(e=0),function(n){return n.lift(new nA(t,e))}}T.a.prototype.window=function(t){return KM(t)(this)};var nA=function(){function t(t,e){this.windowSize=t,this.startWindowEvery=e}return t.prototype.call=function(t,e){return e.subscribe(new rA(t,this.windowSize,this.startWindowEvery))},t}(),rA=function(t){function e(e,n,r){t.call(this,e),this.destination=e,this.windowSize=n,this.startWindowEvery=r,this.windows=[new ln.b],this.count=0,e.next(this.windows[0])}return Object(a.c)(e,t),e.prototype._next=function(t){for(var e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,a=0;a<o&&!this.closed;a++)i[a].next(t);var s=this.count-r+1;if(s>=0&&s%e==0&&!this.closed&&i.shift().complete(),++this.count%e==0&&!this.closed){var c=new ln.b;i.push(c),n.next(c)}},e.prototype._error=function(t){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},e.prototype._unsubscribe=function(){this.count=0,this.windows=null},e}(yn.a);function iA(t){var e=yw,n=null,r=Number.POSITIVE_INFINITY;return Object(tw.a)(arguments[3])&&(e=arguments[3]),Object(tw.a)(arguments[2])?e=arguments[2]:mw(arguments[2])&&(r=arguments[2]),Object(tw.a)(arguments[1])?e=arguments[1]:mw(arguments[1])&&(n=arguments[1]),function(i){return i.lift(new oA(t,n,r,e))}}T.a.prototype.windowCount=function(t,e){return void 0===e&&(e=0),eA(t,e)(this)};var oA=function(){function t(t,e,n,r){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new sA(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},t}(),aA=function(t){function e(){t.apply(this,arguments),this._numberOfNextedValues=0}return Object(a.c)(e,t),e.prototype.next=function(e){this._numberOfNextedValues++,t.prototype.next.call(this,e)},Object.defineProperty(e.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),e}(ln.b),sA=function(t){function e(e,n,r,i,o){t.call(this,e),this.destination=e,this.windowTimeSpan=n,this.windowCreationInterval=r,this.maxWindowSize=i,this.scheduler=o,this.windows=[];var a=this.openWindow();if(null!==r&&r>=0){var s={windowTimeSpan:n,windowCreationInterval:r,subscriber:this,scheduler:o};this.add(o.schedule(lA,n,{subscriber:this,window:a,context:null})),this.add(o.schedule(uA,r,s))}else this.add(o.schedule(cA,n,{subscriber:this,window:a,windowTimeSpan:n}))}return Object(a.c)(e,t),e.prototype._next=function(t){for(var e=this.windows,n=e.length,r=0;r<n;r++){var i=e[r];i.closed||(i.next(t),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},e.prototype._error=function(t){for(var e=this.windows;e.length>0;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){for(var t=this.windows;t.length>0;){var e=t.shift();e.closed||e.complete()}this.destination.complete()},e.prototype.openWindow=function(){var t=new aA;return this.windows.push(t),this.destination.next(t),t},e.prototype.closeWindow=function(t){t.complete();var e=this.windows;e.splice(e.indexOf(t),1)},e}(yn.a);function cA(t){var e=t.subscriber,n=t.windowTimeSpan,r=t.window;r&&e.closeWindow(r),t.window=e.openWindow(),this.schedule(t,n)}function uA(t){var e=t.windowTimeSpan,n=t.subscriber,r=t.scheduler,i=t.windowCreationInterval,o=n.openWindow(),a={action:this,subscription:null};a.subscription=r.schedule(lA,e,{subscriber:n,window:o,context:a}),this.add(a.subscription),this.schedule(t,i)}function lA(t){var e=t.subscriber,n=t.window,r=t.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),e.closeWindow(n)}function hA(t,e){return function(n){return n.lift(new dA(t,e))}}T.a.prototype.windowTime=function(t){var e=yw,n=null,r=Number.POSITIVE_INFINITY;return Object(tw.a)(arguments[3])&&(e=arguments[3]),Object(tw.a)(arguments[2])?e=arguments[2]:mw(arguments[2])&&(r=arguments[2]),Object(tw.a)(arguments[1])?e=arguments[1]:mw(arguments[1])&&(n=arguments[1]),iA(t,n,r,e)(this)};var dA=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new pA(t,this.openings,this.closingSelector))},t}(),pA=function(t){function e(e,n,r){t.call(this,e),this.openings=n,this.closingSelector=r,this.contexts=[],this.add(this.openSubscription=Object(Zn.a)(this,n,n))}return Object(a.c)(e,t),e.prototype._next=function(t){var e=this.contexts;if(e)for(var n=e.length,r=0;r<n;r++)e[r].window.next(t)},e.prototype._error=function(e){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(e),o.subscription.unsubscribe()}t.prototype._error.call(this,e)},e.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var n=e.length,r=-1;++r<n;){var i=e[r];i.window.complete(),i.subscription.unsubscribe()}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,n=-1;++n<e;){var r=t[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},e.prototype.notifyNext=function(t,e,n,r,i){if(t===this.openings){var o=this.closingSelector,a=Object(Wx.a)(o)(e);if(a===Xx.a)return this.error(Xx.a.e);var s=new ln.b,c=new qx.a,u={window:s,subscription:c};this.contexts.push(u);var l=Object(Zn.a)(this,a,u);l.closed?this.closeWindow(this.contexts.length-1):(l.context=u,c.add(l)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(t))},e.prototype.notifyError=function(t){this.error(t)},e.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},e.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,n=e[t],r=n.window,i=n.subscription;e.splice(t,1),r.complete(),i.unsubscribe()}},e}(Yn.a);function fA(t){return function(e){return e.lift(new mA(t))}}T.a.prototype.windowToggle=function(t,e){return hA(t,e)(this)};var mA=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new vA(t,this.closingSelector))},t}(),vA=function(t){function e(e,n){t.call(this,e),this.destination=e,this.closingSelector=n,this.openWindow()}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.openWindow(i)},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){this.openWindow(t)},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},e.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},e.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},e.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var e=this.window;e&&e.complete();var n=this.window=new ln.b;this.destination.next(n);var r=Object(Wx.a)(this.closingSelector)();if(r===Xx.a){var i=Xx.a.e;this.destination.error(i),this.window.error(i)}else this.add(this.closingNotification=Object(Zn.a)(this,r))},e}(Yn.a);function gA(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){var n;return"function"==typeof t[t.length-1]&&(n=t.pop()),e.lift(new yA(t,n))}}T.a.prototype.windowWhen=function(t){return fA(t)(this)};var yA=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new bA(t,this.observables,this.project))},t}(),bA=function(t){function e(e,n,r){t.call(this,e),this.observables=n,this.project=r,this.toRespond=[];var i=n.length;this.values=new Array(i);for(var o=0;o<i;o++)this.toRespond.push(o);for(o=0;o<i;o++){var a=n[o];this.add(Object(Zn.a)(this,a,a,o))}}return Object(a.c)(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.values[n]=e;var o=this.toRespond;if(o.length>0){var a=o.indexOf(n);-1!==a&&o.splice(a,1)}},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Yn.a);function xA(t){return function(e){return e.lift(new Rw(t))}}T.a.prototype.withLatestFrom=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return gA.apply(void 0,t)(this)},T.a.prototype.zip=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return Lw.apply(void 0,t)(this)},T.a.prototype.zipAll=function(t){return xA(t)(this)},n("NO/a"),n("oCQ5"),new function(t){t.requestAnimationFrame?(this.cancelAnimationFrame=t.cancelAnimationFrame.bind(t),this.requestAnimationFrame=t.requestAnimationFrame.bind(t)):t.mozRequestAnimationFrame?(this.cancelAnimationFrame=t.mozCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.mozRequestAnimationFrame.bind(t)):t.webkitRequestAnimationFrame?(this.cancelAnimationFrame=t.webkitCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.webkitRequestAnimationFrame.bind(t)):t.msRequestAnimationFrame?(this.cancelAnimationFrame=t.msCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.msRequestAnimationFrame.bind(t)):t.oRequestAnimationFrame?(this.cancelAnimationFrame=t.oCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.oRequestAnimationFrame.bind(t)):(this.cancelAnimationFrame=t.clearTimeout.bind(t),this.requestAnimationFrame=function(e){return t.setTimeout(e,1e3/60)})}(En.a),n("tLDX");var wA=n("0P3J"),_A=n("3a3m"),SA=function(){function t(){}return t.prototype.getEngineForce=function(){return this.engineForce},t.prototype.getBrakingForce=function(){return this.brakingForce},t.prototype.getSteeringMaxCurvature=function(e){return 1/(t.DORMANT_TURN_RADIUS+Math.pow(e,2)/this.steeringFactor)},t.prototype.getDragForce=function(t){return this.dragConstant*Math.pow(t,2)},t.prototype.getWheelFrictionForce=function(t){return this.wheelFrictionConstant*Math.abs(t)},t.prototype.getMaxAcceleration=function(t){return(this.getEngineForce()-this.getDragForce(t)-this.getWheelFrictionForce(t))/this.mass},t.prototype.getMaxDeceleration=function(t){var e=-Ha.getAccelerationToAchieveSpeed(t,0,1);return Math.min(e,(this.getBrakingForce()+this.getDragForce(t)+this.getWheelFrictionForce(t))/this.mass)},t.fromDTO=function(e){var n=new t;return n.steeringFactor=e.steering,n.dragConstant=e.dragConstant,n.wheelFrictionConstant=e.wheelFrictionConstant,n.engineForce=e.engineForce,n.brakingForce=e.brakingForce,n.mass=e.mass,n},t.DORMANT_TURN_RADIUS=5.5,t}(),TA=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},MA=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},AA=Na.Point,EA=function(){function t(t,e,n,r,i,o,a){void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),this.id=t,this.model=e,this.characteristics=n,this.x=r,this.y=i,this.rotation=o,this.speed=a,this.ready=!1,this.positionChangedSubject=new ln.b}return t.prototype.initMesh=function(t,e){return void 0===e&&(e=!0),TA(this,void 0,void 0,function(){var n;return MA(this,function(r){switch(r.label){case 0:return n=this,[4,t.loadCar("BMW_M3_MW")];case 1:return n.mesh=r.sent(),this.mesh.position.x=this.x,this.mesh.position.y=this.y,this.mesh.position.z=0,this.mesh.rotation.z=this.rotation,this.mesh.traverse(function(t){t instanceof Ca.Mesh&&(t.castShadow=e,t.receiveShadow=e)}),this.ready=!0,[2]}})})},t.prototype.setX=function(t){t!=this.x&&(this.x=t,this.ready&&(this.mesh.position.x=this.x),this.positionChangedSubject.next(this.getPosition()))},t.prototype.setY=function(t){t!=this.y&&(this.y=t,this.ready&&(this.mesh.position.y=this.y),this.positionChangedSubject.next(this.getPosition()))},t.prototype.getPosition=function(){return new AA(this.x,this.y)},t.prototype.setPosition=function(t){this.x==t.x&&this.y==t.y||(this.x=t.x,this.y=t.y,this.ready&&this.mesh.position.set(t.x,t.y,0),this.positionChangedSubject.next(this.getPosition()))},t.prototype.setRotation=function(t){t!=this.rotation&&(this.rotation=t,this.ready&&(this.mesh.rotation.z=this.rotation))},t.prototype.clone=function(){return new t(5*(this.id+1),this.model,this.characteristics,this.x,this.y,this.rotation)},t.fromDTO=function(e){return new t(Math.round(1e3*Math.random()),"BMW_M3_MW",SA.fromDTO(e))},t}(),CA=n("mHjp"),PA=PIXI.Point,OA=function(){function t(){}return t.prototype.getPosition=function(){return new PA(this.x,this.y)},t.fromDummyObject=function(e){var n=new t,r=e.colladaId.match(this.NODE_NAME_REGEX);if(!r)throw new Error("Invalid checkpoint dummy");return n.x=e.position.x,n.y=e.position.y,n.radius=+r[2],n},t.NODE_NAME_REGEX=/^node-maphelper_checkpoint_(\d+)_r(\d+)$/,t}(),NA=function(){function t(){this.outerPolygon=[[-2048,-2048],[2048,-2048],[2048,2048],[-2048,2048]],this.innerPolygons=[]}return t.prototype.isContainingPoint=function(t){if(!Da.isPointInsidePolygon(t,this.outerPolygon))return!1;for(var e=0,n=this.innerPolygons;e<n.length;e++)if(Da.isPointInsidePolygon(t,n[e]))return!1;return!0},t.prototype.getLinePolygonIntersection=function(t,e){for(var n=this.isContainingPoint(t)?t:e,r=n===t?e:t;Da.getDistanceBetweenPoints(n,r)>.05;){var i=Da.getMiddlePoint(n,r);this.isContainingPoint(i)?n=i:r=i}return Da.getMiddlePoint(n,r)},t.fromDummyObject=function(e){return new t},t}(),LA=function(t,e){this.position=t,this.rotation=e},IA=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},RA=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},DA=PIXI.Point,FA=function(){function t(t){this.http=t}return t.prototype.loadCar=function(e){return IA(this,void 0,void 0,function(){var n,r;return RA(this,function(i){switch(i.label){case 0:return(n=t.CARS_CACHE.get(e))?(console.log("Car loaded from cache"),[2,n.clone()]):[4,this.loadColladaScene("cars/"+e+"/","body")];case 1:return r=i.sent(),t.CARS_CACHE.set(e,r.scene),[2,r.scene]}})})},t.prototype.loadMap=function(e){return IA(this,void 0,void 0,function(){var n,r,i,o,a,s,c,u,l,h,d;return RA(this,function(p){switch(p.label){case 0:return[4,this.loadColladaScene("maps/"+e+"/","scene")];case 1:for(n=p.sent(),r=[],i=new NA,o=[],s=0;s<n.scene.children.length;s++)c=!1,(u=n.scene.children[s]).colladaId?((l=u.colladaId.match(OA.NODE_NAME_REGEX))&&(r[+l[1]]=OA.fromDummyObject(u),c=!0),(h=u.colladaId.match(t.POSITION_NODE_REGEX))&&(o[+h[1]]=new LA(new Ca.Vector2(u.position.x,u.position.y),u.rotation.z),c=!0),u.colladaId.match(t.ROAD_CENTER_NODE_REGEX)&&(a=this.parseSpline(u).map(function(t){return new DA(t.x,t.y)}),c=!0),(d=u.colladaId.match(t.POLYGON_NODE_REGEX))&&("outer"===d[1]?i.outerPolygon=this.parseSpline(u).map(function(t){return[t.x,t.y]}):"inner"===d[1]&&i.innerPolygons.push(this.parseSpline(u).map(function(t){return[t.x,t.y]})),c=!0)):c=!0,c&&(n.scene.remove(u),s--);return n.scene.traverse(function(t){t instanceof Ca.Mesh&&(t.parent&&"cliffs"===t.parent.name?(t.material.color=new Ca.Color(.68,.67,.65),t.material.bumpScale=.3):t.parent&&"tonnels_arc"===t.parent.name?(t.material.color=new Ca.Color(.68,.67,.65),t.material.bumpScale=.25):t.parent&&"bridge01"===t.parent.name&&(t.material.color=new Ca.Color(.76,.76,.66),t.material.specular=new Ca.Color(0,0,0),t.material.bumpScale=.1))}),[2,new function(t,e,n,r,i){this.scene=t,this.checkpoints=e,this.polygon=n,this.roadCenterSpline=r,this.startPositions=i}(n.scene,r,i,a,o)]}})})},t.prototype.parseSpline=function(t){for(var e=new Ca.Vector3,n=t;n&&!n.geometry;)n.position&&e.add(n.position),n=n.children[0];return n.position&&e.add(n.position),n.geometry.vertices.map(function(t){var n=t.clone();return n.add(e),n})},t.prototype.loadColladaScene=function(e,n){return void 0===n&&(n="scene"),IA(this,void 0,void 0,function(){var r=this;return RA(this,function(i){return[2,new Promise(function(i,o){setTimeout(function(){return IA(r,void 0,void 0,function(){var r=this;return RA(this,function(o){return CA().load(""+t.PREFIX+e+n+".dae",function(t){return IA(r,void 0,void 0,function(){return RA(this,function(e){switch(e.label){case 0:return[4,this.waitForAllContentLoaded()];case 1:return e.sent(),i(t),[2]}})})}),[2]})})},15)})]})})},t.prototype.waitForAllContentLoaded=function(){return IA(this,void 0,void 0,function(){return RA(this,function(t){return[2,new Promise(function(t,e){Ca.DefaultLoadingManager.onProgress=function(e,n,r){n===r&&t()},Ca.DefaultLoadingManager.onError=function(t,n,r){e()}})]})})},t.PREFIX="assets/models/",t.CARS_CACHE=new Map,t.POLYGON_NODE_REGEX=/^node-maphelper_polygon_(outer|inner)$/,t.POSITION_NODE_REGEX=/^node-maphelper_player-position_(\d+)$/,t.ROAD_CENTER_NODE_REGEX=/^node-maphelper_road-center$/,t}(),UA=function(){function t(t){this.http=t}return t.prototype.setMyCar=function(t){this.myCar=t},t.prototype.createCanvas=function(t){var e=this;return this.renderer=Na.autoDetectRenderer(window.innerWidth,window.innerHeight,{antialias:!0,resolution:1,transparent:!0}),this.canvasWidth=window.innerWidth,this.canvasHeight=window.innerHeight,this.renderer.view.style.position="absolute",this.renderer.view.style.display="block",t.nativeElement.appendChild(this.renderer.view),this.canvasStage=new Na.Container,setInterval(function(){e.renderer.render(e.canvasStage)},1e3/an.FPS),this.renderer.view},t.prototype.resizeCanvas=function(t,e){this.canvasStage&&this.renderer&&(this.canvasWidth!=t||this.canvasHeight!=e)&&(this.renderer.resize(t,e),this.canvasWidth=t,this.canvasHeight=e)},t.prototype.addChild=function(t){this.canvasStage.addChild(t)},t}(),kA=PIXI.Graphics,jA=PIXI.Point,BA=function(t){function e(e,n){var r=t.call(this)||this;return r.mapData=e,r.scalingSquare=n,r}return Object(a.c)(e,t),e.prototype.draw=function(){var t=this;this.clear(),this.lineStyle(8,16777215);var e=this.mapData.roadCenterSpline.map(function(e){return new jA(300*(e.x-t.scalingSquare.x)/t.scalingSquare.width,300*(t.scalingSquare.y-e.y)/t.scalingSquare.height+300)});e.push(e[0]),this.drawPolygon(e);var n=(Da.getAngleBetweenPoints(e[0],e[1])+Da.getAngleBetweenPoints(e[e.length-2],e[0]))/2;this.lineStyle(4,16777215),this.moveTo(e[0].x+16*Math.cos(n+Math.PI/2),e[0].y+16*Math.sin(n+Math.PI/2)),this.lineTo(e[0].x-16*Math.cos(n+Math.PI/2),e[0].y-16*Math.sin(n+Math.PI/2))},e}(kA),zA=PIXI.Container,VA=PIXI.Rectangle,GA=PIXI.Point,HA=PIXI.Graphics,WA=function(t){function e(e){var n=t.call(this)||this;n.cars=[],n.mapData=e;var r=new HA;return r.lineStyle(2,16777215),r.beginFill(0,.3),r.drawRect(0,0,300,300),r.endFill(),n.addChildAt(r,0),n.calculateScalingSquare(),n.graphics=new BA(n.mapData,n.scalingSquare),n.graphics.width=300,n.graphics.height=300,n.graphics.draw(),n.addChild(n.graphics),n}return Object(a.c)(e,t),e.prototype.calculateScalingSquare=function(){var t=new GA(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),e=new GA(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);this.mapData.roadCenterSpline.forEach(function(n){t.x=Math.min(t.x,n.x),t.y=Math.min(t.y,n.y),e.x=Math.max(e.x,n.x),e.y=Math.max(e.y,n.y)});var n=new GA(e.x-t.x,e.y-t.y);this.scalingSquare=new VA(t.x-.1*n.x,t.y-.1*n.y,1.2*n.x,1.2*n.y),this.scalingSquare.width/this.scalingSquare.height>1?(this.scalingSquare.y-=(this.scalingSquare.width-this.scalingSquare.height)/2,this.scalingSquare.height+=this.scalingSquare.width-this.scalingSquare.height):(this.scalingSquare.x-=(this.scalingSquare.height-this.scalingSquare.width)/2,this.scalingSquare.width+=this.scalingSquare.height-this.scalingSquare.width)},e.prototype.addCar=function(t,n){var r=this;void 0===n&&(n=!1);var i=new HA;i.lineStyle(1,0),i.beginFill(e.CAR_COLORS[Math.floor(Math.random()*e.CAR_COLORS.length)]),i.drawCircle(0,0,n?8:5),i.endFill();var o=t.getPosition();i.x=300*(o.x-this.scalingSquare.x)/this.scalingSquare.width,i.y=300*(this.scalingSquare.y-o.y)/this.scalingSquare.height+300,this.addChild(i),t.positionChangedSubject.subscribe(function(t){i.x=300*(t.x-r.scalingSquare.x)/r.scalingSquare.width,i.y=300*(r.scalingSquare.y-t.y)/r.scalingSquare.height+300})},e.CAR_COLORS=[4357620,12465647,14679099,14679099,14679099,49775,16583698,8375620],e}(zA),XA=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},qA=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},YA=function(){function t(t,e,n,r,i,o,a,s){var c=this;this.http=t,this.canvasService=e,this.socketService=n,this.loginService=r,this.carService=i,this.ngZone=o,this.modelLoaderService=a,this.controlService=s,window.onresize=function(t){c.ngZone.run(function(){c.resizeCanvas(window.innerWidth,window.innerHeight)})}}return t.prototype.resizeCanvas=function(t,e){this.canvasService.resizeCanvas(t,e),this.stage3d.resizeCanvas(t,e)},t.prototype.initGameplay=function(t,e,n){return XA(this,void 0,void 0,function(){var r;return qA(this,function(i){switch(i.label){case 0:return this.isWaitingPlayers=!0,this.isLoadingMap=!0,this.stage3d=e,this.cars=new Map,this.myCarId=n.id,this.stepsCount=0,n.ready?[3,2]:[4,n.initMesh(this.modelLoaderService,!0)];case 1:i.sent(),i.label=2;case 2:return[4,this.modelLoaderService.loadMap("default-map")];case 3:return r=i.sent(),console.log(r),this.cars.set(n.id,n),this.canvasService.createCanvas(t),this.canvasService.setMyCar(n),this.stage3d.addCar(n,!0),this.stage3d.addMap(r.scene,!0),this.controlService.initControls(this.stage3d,n),this.mapPolygon=r.polygon,this.checkpoints=r.checkpoints,this.miniMap=new WA(r),this.miniMap.addCar(n,!0),this.canvasService.addChild(this.miniMap),this.isLoadingMap=!1,[2]}})})},t.prototype.startGame=function(){return XA(this,void 0,void 0,function(){var t,e=this;return qA(this,function(n){return t=this.loginService.currentUser,this.socketService.stepSubject.subscribe(function(t){return e.onStepComplete(t.map(function(t){return t.trajectory&&(t.trajectory=new ka(t.trajectory.l,t.trajectory.c)),t}))}),this.socketService.readyToStart({id:this.myCarId,name:t?t.login:"ANONYMOUS"}),[2]})})},t.prototype.onStepComplete=function(t){return XA(this,void 0,void 0,function(){return qA(this,function(e){switch(e.label){case 0:return this.stepsCount++,this.stepsCount>1?(this.stage3d.startWorldRenderingLoop(),[4,this.playAnimations(t)]):[3,2];case 1:e.sent(),this.stage3d.stopWorldRenderingLoop(),e.label=2;case 2:return this.startNewIteration(t).then(),[2]}})})},t.prototype.playAnimations=function(t){return XA(this,void 0,void 0,function(){var e,n,r,i,o,a,s,c=this;return qA(this,function(u){for(e=new Map,n=new Map,r=0,i=t;r<i.length;r++)(a=this.cars.get((o=i[r]).id))&&o.trajectory&&e.set(o.id,{rotation:a.rotation,position:a.getPosition(),speed:a.speed});return s=(new Date).getTime(),[2,new Promise(function(r){var i=c.stage3d.beforeWorldRenderSubject.subscribe(function(){(new Date).getTime();var o=((new Date).getTime()-s)/1e3;if(o>=1)i.unsubscribe(),r();else{for(var a=0,u=t;a<u.length;a++){var l=u[a];if(!n.has(l.id)){var h=c.cars.get(l.id),d=e.get(l.id);if(h&&l.trajectory&&d){var p=new ka(Ha.getDistanceInUniformlyAcceleratedMotion(d.speed,l.acceleration,o),l.trajectory.c);if(Math.abs(p.l)>=Math.abs(l.trajectory.l))n.set(l.id,!0),h.setPosition(l.finalCarProperties.position),h.setRotation(l.finalCarProperties.rotation),h.speed=l.finalCarProperties.speed;else{var f=p.polarPosition;f.theta+=d.rotation;var m=f.cartesianPoint;m.x+=d.position.x,m.y+=d.position.y,h.setPosition(m),h.setRotation(d.rotation+p.pointerRotation),h.speed=l.trajectory.l<0?0:Ha.getSpeedInUniformlyAcceleratedMotion(d.speed,l.acceleration,o)}}}}c.controlService.updateCameraDistance()}c.stage3d.animateCamera()})})]})})},t.prototype.startNewIteration=function(t){return XA(this,void 0,void 0,function(){var e,n,r,i,o,a,s,c,u,l=this;return qA(this,function(h){switch(h.label){case 0:if(!this.myCarId&&0!==this.myCarId||!this.cars.get(this.myCarId))return console.log('Don\'t have "myCar" for arc functionality :('),[2];this.isWaitingPlayers&&(this.isWaitingPlayers=!1),e=0,n=t,h.label=1;case 1:return e<n.length?(i=this.cars.get((r=n[e]).id))?[3,3]:[4,(i=new EA(r.id,"lambo",new SA,r.finalCarProperties.position.x,r.finalCarProperties.position.y,r.finalCarProperties.rotation,r.finalCarProperties.speed)).initMesh(this.modelLoaderService,!0)]:[3,5];case 2:return h.sent(),this.stage3d.addCar(i),this.miniMap.addCar(i),this.cars.set(i.id,i),[3,4];case 3:i.setPosition(r.finalCarProperties.position),i.setRotation(r.finalCarProperties.rotation),i.speed=r.finalCarProperties.speed,h.label=4;case 4:return e++,[3,1];case 5:return o=this.cars.get(this.myCarId),c=0,this.mapPolygon.isContainingPoint(o.getPosition())?(a=Math.max(0,this.getMinDistanceOnNextStep(o)),s=this.getMaxDistanceOnNextStep(o),c=o.speed,u=o.characteristics.getSteeringMaxCurvature(o.speed)):(a=0,s=this.getMaxDistanceOnNextStep(o,0),c=0,u=o.characteristics.getSteeringMaxCurvature(0)),console.log("####"),console.log("min speed: "+a+" m/s; "+3.6*a+" km/h"),console.log("max speed: "+s+" m/s; "+3.6*s+" km/h"),console.log("cur speed: "+c+" m/s; "+3.6*c+" km/h"),console.log("maxSteeringCurvature: "+u),Math.abs(c)<.25&&(a=-s+Math.abs(c)),this.controlService.updateCameraDistance(),this.controlService.adjustControlPositions(),this.stage3d.animateCamera(),this.stage3d.renderWorldOnce(),this.controlService.askForSelectedPosition(a,s,c,u).then(function(t){var e=t.polarPosition;e.theta+=o.rotation;var n=e.cartesianPoint;n.x+=o.x,n.y+=o.y;for(var r={id:o.id,finalCarProperties:{position:o.getPosition(),rotation:o.rotation,speed:o.speed},trajectory:t,acceleration:Ha.getAccelerationInUniformlyAcceleratedMotion(o.speed,t.l,1)},i=t.breakToSegments().map(function(t){var e=Fa.fromCartesian(t);return e.theta+=o.rotation,(t=e.cartesianPoint).x+=o.x,t.y+=o.y,t}),a=0;a<i.length;a++){var s=i[a];if(!l.mapPolygon.isContainingPoint(s)){var c=l.mapPolygon.getLinePolygonIntersection(a>0?i[a-1]:o.getPosition(),i[a]),u=Math.min(.1,Da.getDistanceBetweenPoints(o.getPosition(),c)),h=Da.getAngleBetweenPoints(c,o.getPosition());return r.finalCarProperties.speed=0,r.finalCarProperties.position.x=c.x+Math.cos(h)*u,r.finalCarProperties.position.y=c.y+Math.sin(h)*u,Da.getDistanceBetweenPoints(o.getPosition(),r.finalCarProperties.position)>.01?(r.finalCarProperties.rotation+=a*(t.pointerRotation/i.length),r.trajectory=new ka(t.l*a/i.length,t.c)):r.trajectory=new ka(0,0),void l.socketService.nextStep(r)}if(l.checkpoints&&l.checkpoints.length>0&&Da.getDistanceBetweenPoints(s,l.checkpoints[0].getPosition())<l.checkpoints[0].radius&&(l.checkpoints.shift(),0==l.checkpoints.length))return void l.socketService.finished(l.stepsCount)}r.finalCarProperties.speed=Math.max(0,Ha.getSpeedInUniformlyAcceleratedMotionByDistance(o.speed,t.l,1)),r.finalCarProperties.rotation+=t.pointerRotation,r.finalCarProperties.position=n,l.socketService.nextStep(r)}),[2]}})})},t.prototype.getMinDistanceOnNextStep=function(t,e){return void 0===e&&(e=t.speed),Ha.getDistanceInUniformlyAcceleratedMotion(e,-t.characteristics.getMaxDeceleration(e),1)},t.prototype.getMaxDistanceOnNextStep=function(t,e){return void 0===e&&(e=t.speed),Ha.getDistanceInUniformlyAcceleratedMotion(e,t.characteristics.getMaxAcceleration(e),1)},t.prototype.setRaceResults=function(t){this.raceResults=t},t.prototype.getLastRaceResults=function(){return this.raceResults},t}(),ZA=function(){function t(t,e,n,r,i){this.http=t,this.gameplayService=e,this.router=n,this.socketService=r,this.carService=i}return t.prototype.ngOnInit=function(){var t=this,e=this.carService.selectedCar;e||(console.log("car is not selected"),this.router.navigate(["selectCars"]));var n=EA.fromDTO(e);this.gameplayService.initGameplay(this.canvasContainer,this.stage3d,n).then(function(){t.gameplayService.startGame(),t.socketService.finishSubject.subscribe(function(e){t.gameplayService.setRaceResults(e),t.router.navigate(["finish"])})})},t.prototype.checkIfLoadingMap=function(){return this.gameplayService.isLoadingMap},t.prototype.chechIfWaitingPlayers=function(){return this.gameplayService.isWaitingPlayers},t}(),JA=i.Z({encapsulation:0,styles:[[".screen-centered-container[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:0;left:0;right:0;bottom:0}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}.click-through[_ngcontent-%COMP%]{pointer-events:none}.loading-h[_ngcontent-%COMP%]{text-align:center}.invisible[_ngcontent-%COMP%]{display:none}"]],data:{}});function QA(t){return i._18(0,[(t()(),i._1(0,0,null,null,7,"div",[["class","screen-centered-container"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n    "])),(t()(),i._1(2,0,null,null,4,"div",[],null,null,null,null,null)),(t()(),i._17(-1,null,["\n      "])),(t()(),i._1(4,0,null,null,1,"h1",[["class","loading-h"]],null,null,null,null,null)),(t()(),i._17(5,null,["\n        ","\n      "])),(t()(),i._17(-1,null,["\n    "])),(t()(),i._17(-1,null,["\n  "]))],null,function(t,e){t(e,5,0,e.component.checkIfLoadingMap()?"Loading map":"Waiting other players")})}function KA(t){return i._18(0,[i._15(402653184,1,{canvasContainer:0}),i._15(402653184,2,{stage3d:0}),(t()(),i._1(2,0,null,null,14,"div",[],null,null,null,null,null)),(t()(),i._17(-1,null,["\n  "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(5,0,null,null,2,"stage-3d",[["class","full-screen"]],[[2,"invisible",null]],null,null,Hx,Gx)),i._0(6,4308992,[[2,4],["stage3d",4]],0,Vx,[Ya],null,null),(t()(),i._17(-1,null,["\n  "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(10,0,[[1,0],["canvasContainer",1]],null,1,"div",[["class","full-screen click-through"]],[[2,"invisible",null]],null,null,null,null)),(t()(),i._17(-1,null,["\n  "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i.W(16777216,null,null,1,null,QA)),i._0(15,16384,null,0,V,[i.K,i.H],{ngIf:[0,"ngIf"]},null),(t()(),i._17(-1,null,["\n"])),(t()(),i._17(-1,null,["\n"]))],function(t,e){var n=e.component;t(e,6,0),t(e,15,0,n.checkIfLoadingMap()||n.chechIfWaitingPlayers())},function(t,e){var n=e.component;t(e,5,0,n.checkIfLoadingMap()||n.chechIfWaitingPlayers()),t(e,10,0,n.checkIfLoadingMap()||n.chechIfWaitingPlayers())})}var $A=i.X("page-gameplay",ZA,function(t){return i._18(0,[(t()(),i._1(0,0,null,null,1,"page-gameplay",[],null,null,null,KA,JA)),i._0(1,114688,null,0,ZA,[en,YA,Fo,fa,_a],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]),tE=function(){function t(t,e){this.router=t,this.gameplayService=e,this.messageText=e.getLastRaceResults()?"Congratulations! You won the race!":"Good luck next time!"}return t.prototype.tryAgain=function(){this.router.navigate(["menu"])},t}(),eE=i.Z({encapsulation:0,styles:[["finish-screen[_ngcontent-%COMP%]{background-color:#fff}.finish-content[_ngcontent-%COMP%]{width:500px;height:70%;margin:0 auto;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.finish-message[_ngcontent-%COMP%]{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.finish-text[_ngcontent-%COMP%]{color:gray}.finish-button[_ngcontent-%COMP%]{width:60%;margin:20px auto!important;-ms-flex-pack:distribute;justify-content:space-around;-ms-flex-item-align:center;align-self:center;display:-webkit-box;display:-ms-flexbox;display:flex}"]],data:{}});function nE(t){return i._18(0,[(t()(),i._1(0,0,null,null,13,"div",[],null,null,null,null,null)),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(2,0,null,null,10,"div",[["class","finish-content"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n    "])),(t()(),i._1(4,0,null,null,7,"div",[["class","finish-message"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n      "])),(t()(),i._1(6,0,null,null,1,"h1",[["class","finish-text"]],null,null,null,null,null)),(t()(),i._17(7,null,["",""])),(t()(),i._17(-1,null,["\n      "])),(t()(),i._1(9,0,null,null,1,"button",[["class","finish-button"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.tryAgain()&&r),r},null,null)),(t()(),i._17(-1,null,["Race again"])),(t()(),i._17(-1,null,["\n    "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._17(-1,null,["\n"])),(t()(),i._17(-1,null,["\n\n"]))],null,function(t,e){t(e,7,0,e.component.messageText)})}var rE=i.X("finish-screen",tE,function(t){return i._18(0,[(t()(),i._1(0,0,null,null,1,"finish-screen",[],null,null,null,nE,eE)),i._0(1,49152,null,0,tE,[Fo,YA],null,null)],null,null)},{},{},[]),iE=function(){function t(t,e,n,r){this.loginService=t,this.carService=e,this.fb=n,this.router=r}return t.prototype.onLoginClick=function(t,e){var n=this;this.loginService.login(t,e).subscribe(function(t){n.router.navigate(["/menu"])},function(t){console.error(t)})},t.prototype.onFacebookLoginClick=function(){this.fb.login().then(function(t){return console.log(t)}).catch(function(t){return console.error(t)})},t.prototype.onSignupClick=function(t,e){console.log(t,e),this.loginService.createUser(t,e).subscribe(function(t){console.log(JSON.stringify(t))},function(t){console.error(t)})},t}(),oE=i.Z({encapsulation:0,styles:[["page-login[_ngcontent-%COMP%]{background-color:#fff}.login[_ngcontent-%COMP%]{width:300px;height:70%;margin:0 auto;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.login-form[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.button-login[_ngcontent-%COMP%]{width:60%;margin-top:20px!important;-ms-flex-item-align:end;align-self:flex-end}"]],data:{}});function aE(t){return i._18(0,[(t()(),i._1(0,0,null,null,14,"div",[["class","login"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n\n  "])),(t()(),i._1(2,0,[["username",1]],null,0,"input",[["id","username"],["placeholder","Username"],["type","text"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n\n  "])),(t()(),i._1(4,0,[["pass",1]],null,0,"input",[["id","pass"],["placeholder","Password"],["type","password"]],null,null,null,null,null)),(t()(),i._17(-1,null,["\n\n  "])),(t()(),i._1(6,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.onLoginClick(i._12(t,2).value,i._12(t,4).value)&&r),r},null,null)),(t()(),i._17(-1,null,["\n    Log in\n  "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(9,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.onFacebookLoginClick()&&r),r},null,null)),(t()(),i._17(-1,null,["\n    Log in with facebook\n  "])),(t()(),i._17(-1,null,["\n  "])),(t()(),i._1(12,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.onSignupClick(i._12(t,2).value,i._12(t,4).value)&&r),r},null,null)),(t()(),i._17(-1,null,["\n    Sign Up\n  "])),(t()(),i._17(-1,null,["\n\n"])),(t()(),i._17(-1,null,["\n"]))],null,null)}var sE=i.X("page-login",iE,function(t){return i._18(0,[(t()(),i._1(0,0,null,null,1,"page-login",[],null,null,null,aE,oE)),i._0(1,49152,null,0,iE,[un,_a,w,Fo],null,null)],null,null)},{},{},[]),cE=i.Z({encapsulation:0,styles:[[""]],data:{}});function uE(t){return i._18(0,[(t()(),i._1(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),i._0(1,212992,null,0,zo,[Bo,i.K,i.j,[8,null],i.h],null,null),(t()(),i._17(-1,null,["\n"]))],function(t,e){t(e,1,0)},null)}var lE=i.X("app-root",S,function(t){return i._18(0,[(t()(),i._1(0,0,null,null,1,"app-root",[],null,null,null,uE,cE)),i._0(1,49152,null,0,S,[w],null,null)],null,null)},{},{},[]),hE=function(){function t(){this._accessors=[]}return t.prototype.add=function(t,e){this._accessors.push([t,e])},t.prototype.remove=function(t){for(var e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return void this._accessors.splice(e,1)},t.prototype.select=function(t){var e=this;this._accessors.forEach(function(n){e._isSameGroup(n,t)&&n[1]!==t&&n[1].fireUncheck(t.value)})},t.prototype._isSameGroup=function(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name},t}(),dE=function(){},pE=function(){},fE=function(t){function e(){var e=t.call(this)||this;return e.withCredentials=!0,e}return Object(a.c)(e,t),e}(Xe),mE=i.Y(o,[S],function(t){return i._9([i._10(512,i.j,i.U,[[8,[xa,Ea,$A,rE,sE,lE]],[3,i.j],i.u]),i._10(5120,i.r,i._14,[[3,i.r]]),i._10(4608,U,k,[i.r,[2,F]]),i._10(5120,i.c,i._3,[]),i._10(5120,i.p,i._11,[]),i._10(5120,i.q,i._13,[]),i._10(4608,pe,fe,[W]),i._10(6144,i.C,null,[pe]),i._10(4608,jt,Bt,[]),i._10(5120,dt,function(t,e,n,r,i){return[new Ut(t,e),new Ht(n),new zt(r,i)]},[W,i.w,W,W,jt]),i._10(4608,pt,pt,[dt,i.w]),i._10(135680,vt,vt,[W]),i._10(4608,St,St,[pt,vt]),i._10(6144,i.A,null,[St]),i._10(6144,mt,null,[vt]),i._10(4608,i.I,i.I,[i.w]),i._10(4608,it,it,[W]),i._10(4608,ct,ct,[W]),i._10(4608,hE,hE,[]),i._10(4608,Me,Me,[]),i._10(4608,Ne,Le,[]),i._10(5120,Ie,nn,[]),i._10(4608,He,He,[Me,Ne,Ie]),i._10(4608,We,fE,[]),i._10(5120,en,rn,[He,We]),i._10(5120,Ji,na,[Fo]),i._10(4608,Wo,Wo,[]),i._10(6144,Go,null,[Wo]),i._10(135680,Xo,Xo,[Fo,i.t,i.i,i.o,Go]),i._10(4608,Ho,Ho,[]),i._10(5120,aa,oa,[ra]),i._10(5120,i.b,function(t){return[t]},[aa]),i._10(4608,w,w,[]),i._10(4608,sn,sn,[en]),i._10(4608,cn,cn,[sn]),i._10(4608,un,un,[cn]),i._10(4608,wa,wa,[sn]),i._10(4608,_a,_a,[wa]),i._10(4608,UA,UA,[en]),i._10(4608,fa,fa,[]),i._10(4608,FA,FA,[en]),i._10(4608,Ya,Ya,[]),i._10(4608,YA,YA,[en,UA,fa,un,_a,i.w,FA,Ya]),i._10(4608,sa,sa,[sn]),i._10(1024,Yo,$o,[[3,Fo]]),i._10(1024,i.k,Se,[]),i._10(1024,i.v,function(){return[Jo()]},[]),i._10(512,ra,ra,[i.o]),i._10(1024,i.d,function(t,e){return[(n=t,ut("probe",ht),ut("coreTokens",Object(a.a)({},lt,(n||[]).reduce(function(t,e){return t[e.name]=e.token,t},{}))),function(){return ht}),ia(e)];var n},[[2,i.v],ra]),i._10(512,i.e,i.e,[[2,i.d]]),i._10(131584,i.g,i.g,[i.w,i.V,i.o,i.k,i.j,i.e]),i._10(512,yi,bi,[]),i._10(512,Bo,Bo,[]),i._10(256,qo,{},[]),i._10(1024,E,Ko,[M,[2,C],qo]),i._10(512,P,P,[E]),i._10(512,i.i,i.i,[]),i._10(512,i.t,i.F,[i.i,[2,i.G]]),i._10(1024,Oo,function(){return[[{path:"menu",component:ga},{path:"selectCars",component:Sa},{path:"game",component:ZA},{path:"finish",component:tE},{path:"login",component:iE},{path:"**",redirectTo:"menu"}]]},[]),i._10(1024,Fo,ea,[i.g,yi,Bo,P,i.o,i.t,i.i,Oo,qo,[2,Lo],[2,Co]]),i._10(512,Qo,Qo,[[2,Yo],[2,Fo]]),i._10(512,_,_,[]),i._10(512,H,H,[]),i._10(512,i.f,i.f,[i.g]),i._10(512,Te,Te,[[3,Te]]),i._10(512,dE,dE,[]),i._10(512,pE,pE,[]),i._10(512,on,on,[]),i._10(512,o,o,[])])});Object(i.O)(),_e().bootstrapModuleFactory(mE)},x6VL:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("TToO"),i=function(t){function e(){var e=t.call(this,"object unsubscribed");this.name=e.name="ObjectUnsubscribedError",this.stack=e.stack,this.message=e.message}return Object(r.c)(e,t),e}(Error)},xaZU:function(t,e,n){"use strict";var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,s){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?o(a(t),function(a){var s=encodeURIComponent(r(a))+n;return i(t[a])?o(t[a],function(t){return s+encodeURIComponent(r(t))}).join(e):s+encodeURIComponent(r(t[a]))}).join(e):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var a=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},yMAt:function(t,e,n){"use strict";e.__esModule=!0;var r,i=n("8QNu"),o=n("FjAT"),a=(r=n("EoU7"))&&r.__esModule?r:{default:r},s=n("aH6o"),c=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.gl=e.gl,this._managedTextures=[]}return t.prototype.bindTexture=function(){},t.prototype.getTexture=function(){},t.prototype.updateTexture=function(t,e){var n=this.gl,r=!!t._glRenderTargets;if(!t.hasLoaded)return null;var s=this.renderer.boundTextures;if(void 0===e){e=0;for(var c=0;c<s.length;++c)if(s[c]===t){e=c;break}}s[e]=t,n.activeTexture(n.TEXTURE0+e);var u=t._glTextures[this.renderer.CONTEXT_UID];if(u)r?t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width,t.height):u.upload(t.source);else{if(r){var l=new a.default(this.gl,t.width,t.height,t.scaleMode,t.resolution);l.resize(t.width,t.height),t._glRenderTargets[this.renderer.CONTEXT_UID]=l,u=l.texture}else(u=new i.GLTexture(this.gl,null,null,null,null)).bind(e),u.premultiplyAlpha=!0,u.upload(t.source);t._glTextures[this.renderer.CONTEXT_UID]=u,t.on("update",this.updateTexture,this),t.on("dispose",this.destroyTexture,this),this._managedTextures.push(t),t.isPowerOfTwo?(t.mipmap&&u.enableMipmap(),t.wrapMode===o.WRAP_MODES.CLAMP?u.enableWrapClamp():t.wrapMode===o.WRAP_MODES.REPEAT?u.enableWrapRepeat():u.enableWrapMirrorRepeat()):u.enableWrapClamp(),t.scaleMode===o.SCALE_MODES.NEAREST?u.enableNearestScaling():u.enableLinearScaling()}return u},t.prototype.destroyTexture=function(t,e){if((t=t.baseTexture||t).hasLoaded){var n=this.renderer.CONTEXT_UID,r=t._glTextures,i=t._glRenderTargets;if(r[n]&&(this.renderer.unbindTexture(t),r[n].destroy(),t.off("update",this.updateTexture,this),t.off("dispose",this.destroyTexture,this),delete r[n],!e)){var o=this._managedTextures.indexOf(t);-1!==o&&(0,s.removeItems)(this._managedTextures,o,1)}i&&i[n]&&(i[n].destroy(),delete i[n])}},t.prototype.removeAll=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];e._glTextures[this.renderer.CONTEXT_UID]&&delete e._glTextures[this.renderer.CONTEXT_UID]}},t.prototype.destroy=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];this.destroyTexture(e,!0),e.off("update",this.updateTexture,this),e.off("dispose",this.destroyTexture,this)}this._managedTextures=null},t}();e.default=c},z1Av:function(t,e,n){"use strict";e.__esModule=!0,e.Ticker=e.shared=void 0;var r,i=(r=n("+4Qc"))&&r.__esModule?r:{default:r},o=new i.default;o.autoStart=!0,o.destroy=function(){},e.shared=o,e.Ticker=i.default},zFUS:function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=n}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copy=function(t){this.set(t.x,t.y)},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},t}();e.default=r},zqJT:function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}}},[0]);