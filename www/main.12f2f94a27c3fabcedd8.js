(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+HqX":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(r("bY+x")),o=r("pQYt"),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.a=e,this.b=r,this.c=n,this.d=i,this.tx=o,this.ty=a,this.array=null}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,r,n,i,o){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(t,e){e=e||new i.default;var r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new i.default;var r=1/(this.a*this.d+this.c*-this.b),n=t.x,o=t.y;return e.x=this.d*r*n+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*o+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.a,i=this.c,o=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=i*e-this.d*r,this.d=i*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this},t.prototype.append=function(t){var e=this.a,r=this.b,n=this.c,i=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*i,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*i,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*i+this.ty,this},t.prototype.setTransform=function(t,e,r,n,i,o,a,s,l){return this.a=Math.cos(a+l)*i,this.b=Math.sin(a+l)*i,this.c=-Math.sin(a-s)*o,this.d=Math.cos(a-s)*o,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,r=this.b,n=this.c,i=this.d,a=-Math.atan2(-n,i),s=Math.atan2(r,e),l=Math.abs(a+s);return l<1e-5||Math.abs(o.PI_2-l)<1e-5?(t.rotation=s,e<0&&i>=0&&(t.rotation+=t.rotation<=0?Math.PI:-Math.PI),t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=s),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+i*i),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},n(t,null,[{key:"IDENTITY",get:function(){return new t}},{key:"TEMP_MATRIX",get:function(){return new t}}]),t}();e.default=a},"+SKG":function(t,e){t.exports=function(t){return r&&global.Buffer.isBuffer(t)||n&&(t instanceof global.ArrayBuffer||i(t))};var r="function"==typeof global.Buffer&&"function"==typeof global.Buffer.isBuffer,n="function"==typeof global.ArrayBuffer,i=n&&"function"==typeof global.ArrayBuffer.isView?global.ArrayBuffer.isView:function(t){return t.buffer instanceof global.ArrayBuffer}},"/HYg":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=t.width,r=t.height,n=t.getContext("2d"),i=n.getImageData(0,0,e,r).data,o=i.length,a={top:null,left:null,right:null,bottom:null},s=void 0,l=void 0,c=void 0;for(s=0;s<o;s+=4)0!==i[s+3]&&(l=s/4%e,c=~~(s/4/e),null===a.top&&(a.top=c),null===a.left?a.left=l:l<a.left&&(a.left=l),null===a.right?a.right=l+1:a.right<l&&(a.right=l+1),null===a.bottom?a.bottom=c:a.bottom<c&&(a.bottom=c));var u=n.getImageData(a.left,a.top,e=a.right-a.left,r=a.bottom-a.top+1);return{height:r,width:e,data:u}}},"/UP7":function(t,e,r){"use strict";e.__esModule=!0;var n=r("qp2T"),i={getTintedTexture:function(t,e){var r=t._texture,n="#"+("00000"+(0|(e=i.roundColor(e))).toString(16)).substr(-6);r.tintCache=r.tintCache||{};var o=r.tintCache[n],a=void 0;if(o){if(o.tintId===r._updateID)return r.tintCache[n];a=r.tintCache[n]}else a=i.canvas||document.createElement("canvas");if(i.tintMethod(r,e,a),a.tintId=r._updateID,i.convertTintToImage){var s=new Image;s.src=a.toDataURL(),r.tintCache[n]=s}else r.tintCache[n]=a,i.canvas=null;return a},tintWithMultiply:function(t,e,r){var n=r.getContext("2d"),i=t._frame.clone(),o=t.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithOverlay:function(t,e,r){var n=r.getContext("2d"),i=t._frame.clone(),o=t.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithPerPixel:function(t,e,r){var i=r.getContext("2d"),o=t._frame.clone(),a=t.baseTexture.resolution;o.x*=a,o.y*=a,o.width*=a,o.height*=a,r.width=Math.ceil(o.width),r.height=Math.ceil(o.height),i.save(),i.globalCompositeOperation="copy",i.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),i.restore();for(var s=(0,n.hex2rgb)(e),l=s[0],c=s[1],u=s[2],h=i.getImageData(0,0,o.width,o.height),d=h.data,p=0;p<d.length;p+=4)d[p+0]*=l,d[p+1]*=c,d[p+2]*=u;i.putImageData(h,0,0)},roundColor:function(t){var e=i.cacheStepsPerColorChannel,r=(0,n.hex2rgb)(t);return r[0]=Math.min(255,r[0]/e*e),r[1]=Math.min(255,r[1]/e*e),r[2]=Math.min(255,r[2]/e*e),(0,n.rgb2hex)(r)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:(0,function(t){return t&&t.__esModule?t:{default:t}}(r("g57C")).default)(),tintMethod:0};i.tintMethod=i.canUseMultiply?i.tintWithMultiply:i.tintWithPerPixel,e.default=i},"/msk":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.uploadHookHelper=n.renderer,n.registerFindHook(s),n.registerUploadHook(o),n.registerUploadHook(a),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("meNg")).default);function o(t,e){return e instanceof n.BaseTexture&&(e._glTextures[t.CONTEXT_UID]||t.textureManager.updateTexture(e),!0)}function a(t,e){return e instanceof n.Graphics&&((e.dirty||e.clearDirty||!e._webGL[t.plugins.graphics.CONTEXT_UID])&&t.plugins.graphics.updateGraphics(e),!0)}function s(t,e){return t instanceof n.Graphics&&(e.push(t),!0)}e.default=i,n.WebGLRenderer.registerPlugin("prepare",i)},"/zO6":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("+HqX")),i=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],o=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],a=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],s=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],l=[],c=[];function u(t){return t<0?-1:t>0?1:0}!function(){for(var t=0;t<16;t++){var e=[];c.push(e);for(var r=0;r<16;r++)for(var h=u(i[t]*i[r]+a[t]*o[r]),d=u(o[t]*i[r]+s[t]*o[r]),p=u(i[t]*a[r]+a[t]*s[r]),f=u(o[t]*a[r]+s[t]*s[r]),m=0;m<16;m++)if(i[m]===h&&o[m]===d&&a[m]===p&&s[m]===f){e.push(m);break}}for(var v=0;v<16;v++){var g=new n.default;g.set(i[v],o[v],a[v],s[v],0,0),l.push(g)}}();var h={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(t){return i[t]},uY:function(t){return o[t]},vX:function(t){return a[t]},vY:function(t){return s[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return c[t][e]},sub:function(t,e){return c[t][h.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?h.S:h.N:2*Math.abs(e)<=Math.abs(t)?t>0?h.E:h.W:e>0?t>0?h.SE:h.SW:t>0?h.NE:h.NW},matrixAppendRotationInv:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=l[h.inv(e)];i.tx=r,i.ty=n,t.append(i)}};e.default=h},"0DWY":function(t,e){t.exports=function(t,e){return"precision"!==t.substring(0,9)?"precision "+e+" float;\n"+t:t}},"0HXk":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=s(r("9a93")),o=s(r("l8vz")),a=r("qp2T");function s(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return i.shader=null,i.indexBuffer=null,i.properties=null,i.tempMatrix=new n.Matrix,i.CONTEXT_UID=0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new i.default(t),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:!0,uploadFunction:this.uploadTint,offset:0}]},e.prototype.start=function(){this.renderer.bindShader(this.shader)},e.prototype.render=function(t){var e=t.children,r=t._maxSize,i=t._batchSize,o=this.renderer,a=e.length;if(0!==a){a>r&&(a=r);var s=t._glBuffers[o.CONTEXT_UID];s||(s=t._glBuffers[o.CONTEXT_UID]=this.generateBuffers(t));var l=e[0]._texture.baseTexture;this.renderer.setBlendMode(n.utils.correctBlendMode(t.blendMode,l.premultipliedAlpha));var c=o.gl,u=t.worldTransform.copy(this.tempMatrix);u.prepend(o._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=u.toArray(!0),this.shader.uniforms.uColor=n.utils.premultiplyRgba(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,l.premultipliedAlpha),this.shader.uniforms.uSampler=o.bindTexture(l);for(var h=!1,d=0,p=0;d<a;d+=i,p+=1){var f=a-d;if(f>i&&(f=i),p>=s.length){if(!t.autoResize)break;s.push(this._generateOneMoreBuffer(t))}var m=s[p];m.uploadDynamic(e,d,f),(h=h||m._updateID<(t._bufferUpdateIDs[d]||0))&&(m._updateID=t._updateID,m.uploadStatic(e,d,f)),o.bindVao(m.vao),m.vao.draw(c.TRIANGLES,6*f)}}},e.prototype.generateBuffers=function(t){for(var e=this.renderer.gl,r=[],n=t._maxSize,i=t._batchSize,a=t._properties,s=0;s<n;s+=i)r.push(new o.default(e,this.properties,a,i));return r},e.prototype._generateOneMoreBuffer=function(t){return new o.default(this.renderer.gl,this.properties,t._properties,t._batchSize)},e.prototype.uploadVertices=function(t,e,r,n,i,o){for(var a=0,s=0,l=0,c=0,u=0;u<r;++u){var h=t[e+u],d=h._texture,p=h.scale.x,f=h.scale.y,m=d.trim,v=d.orig;m?(a=(s=m.x-h.anchor.x*v.width)+m.width,l=(c=m.y-h.anchor.y*v.height)+m.height):(a=v.width*(1-h.anchor.x),s=v.width*-h.anchor.x,l=v.height*(1-h.anchor.y),c=v.height*-h.anchor.y),n[o]=s*p,n[o+1]=c*f,n[o+i]=a*p,n[o+i+1]=c*f,n[o+2*i]=a*p,n[o+2*i+1]=l*f,n[o+3*i]=s*p,n[o+3*i+1]=l*f,o+=4*i}},e.prototype.uploadPosition=function(t,e,r,n,i,o){for(var a=0;a<r;a++){var s=t[e+a].position;n[o]=s.x,n[o+1]=s.y,n[o+i]=s.x,n[o+i+1]=s.y,n[o+2*i]=s.x,n[o+2*i+1]=s.y,n[o+3*i]=s.x,n[o+3*i+1]=s.y,o+=4*i}},e.prototype.uploadRotation=function(t,e,r,n,i,o){for(var a=0;a<r;a++){var s=t[e+a].rotation;n[o]=s,n[o+i]=s,n[o+2*i]=s,n[o+3*i]=s,o+=4*i}},e.prototype.uploadUvs=function(t,e,r,n,i,o){for(var a=0;a<r;++a){var s=t[e+a]._texture._uvs;s?(n[o]=s.x0,n[o+1]=s.y0,n[o+i]=s.x1,n[o+i+1]=s.y1,n[o+2*i]=s.x2,n[o+2*i+1]=s.y2,n[o+3*i]=s.x3,n[o+3*i+1]=s.y3,o+=4*i):(n[o]=0,n[o+1]=0,n[o+i]=0,n[o+i+1]=0,n[o+2*i]=0,n[o+2*i+1]=0,n[o+3*i]=0,n[o+3*i+1]=0,o+=4*i)}},e.prototype.uploadTint=function(t,e,r,n,i,o){for(var s=0;s<r;++s){var l=t[e+s],c=l.alpha,u=c<1&&l._texture.baseTexture.premultipliedAlpha?(0,a.premultiplyTint)(l._tintRGB,c):l._tintRGB+(255*c<<24);n[o]=u,n[o+i]=u,n[o+2*i]=u,n[o+3*i]=u,o+=4*i}},e.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),t.prototype.destroy.call(this),this.shader.destroy(),this.indices=null,this.tempMatrix=null},e}(n.ObjectRenderer);e.default=l,n.WebGLRenderer.registerPlugin("particle",l)},"0QlW":function(t,e,r){"use strict";t.exports=function(t,e,r){var n,i=t.length;if(!(e>=i||0===r)){var o=i-(r=e+r>i?i-e:r);for(n=e;n<o;++n)t[n]=t[n+r];t.length=o}}},"0z79":function(t,e,r){var n=r("AdPF"),i=r("CUme"),o=r("cpc2"),a=r("Yvos"),s=r("NOtv")("engine.io-client:polling-xhr");function l(){}function c(t){if(i.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,global.location){var e="https:"===location.protocol,r=location.port;r||(r=e?443:80),this.xd=t.hostname!==global.location.hostname||r!==t.port,this.xs=t.secure!==e}}function u(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function h(){for(var t in u.requests)u.requests.hasOwnProperty(t)&&u.requests[t].abort()}t.exports=c,t.exports.Request=u,a(c,i),c.prototype.supportsBinary=!0,c.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new u(t)},c.prototype.doWrite=function(t,e){var r=this.request({method:"POST",data:t,isBinary:"string"!=typeof t&&void 0!==t}),n=this;r.on("success",e),r.on("error",function(t){n.onError("xhr post error",t)}),this.sendXhr=r},c.prototype.doPoll=function(){s("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},o(u.prototype),u.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new n(t),r=this;try{s("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&e.setRequestHeader(i,this.extraHeaders[i])}catch(t){}if("POST"===this.method)try{e.setRequestHeader("Content-type",this.isBinary?"application/octet-stream":"text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=!0),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){r.onLoad()},e.onerror=function(){r.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===t&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?r.onLoad():setTimeout(function(){r.onError(e.status)},0))},s("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout(function(){r.onError(t)},0)}global.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},u.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},u.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=l:this.xhr.onreadystatechange=l,t)try{this.xhr.abort()}catch(t){}global.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},u.prototype.hasXDR=function(){return void 0!==global.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},u.requestsCount=0,u.requests={},global.document&&(global.attachEvent?global.attachEvent("onunload",h):global.addEventListener&&global.addEventListener("beforeunload",h,!1))},"14A5":function(t,e){var r=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}();function o(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=i.buffer}t[e]=n}}}t.exports=n?i?global.Blob:function(t,e){return o(t),new Blob(t,e||{})}:r&&r.prototype.append&&r.prototype.getBlob?function(t,e){e=e||{};var n=new r;o(t);for(var i=0;i<t.length;i++)n.append(t[i]);return e.type?n.getBlob(e.type):n.getBlob()}:void 0},"1Ceu":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return i.points=n,i.vertices=new Float32Array(4*n.length),i.uvs=new Float32Array(4*n.length),i.colors=new Float32Array(2*n.length),i.indices=new Uint16Array(2*n.length),i.autoUpdate=!0,i.refresh(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._refresh=function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){this.vertices.length/4!==t.length&&(this.vertices=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length));var e=this.uvs,r=this.indices,n=this.colors;e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,r[0]=0,r[1]=1;for(var i=t.length,o=1;o<i;o++){var a=4*o,s=o/(i-1);e[a]=s,e[a+1]=0,e[a+2]=s,e[a+3]=1,n[a=2*o]=1,n[a+1]=1,r[a=2*o]=a,r[a+1]=a+1}this.dirty++,this.indexDirty++,this.multiplyUvs(),this.refreshVertices()}},e.prototype.refreshVertices=function(){var t=this.points;if(!(t.length<1))for(var e=t[0],r=void 0,n=0,i=0,o=this.vertices,a=t.length,s=0;s<a;s++){var l=t[s],c=4*s;i=-((r=s<t.length-1?t[s+1]:l).x-e.x),n=r.y-e.y;var u=10*(1-s/(a-1));u>1&&(u=1);var h=Math.sqrt(n*n+i*i),d=this._texture.height/2;n/=h,i/=h,i*=d,o[c]=l.x+(n*=d),o[c+1]=l.y+i,o[c+2]=l.x-n,o[c+3]=l.y-i,e=l}},e.prototype.updateTransform=function(){this.autoUpdate&&this.refreshVertices(),this.containerUpdateTransform()},e}(function(t){return t&&t.__esModule?t:{default:t}}(r("sBhT")).default);e.default=n},"1eSL":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,r,n){void 0===r&&(r=!1),i(this,t),this._fn=e,this._once=r,this._thisArg=n,this._next=this._prev=this._owner=null}return n(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function a(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var s=function(){function t(){i(this,t),this._head=this._tail=void 0}return n(t,[{key:"handlers",value:function(){var t=this._head;if(!(arguments.length<=0||void 0===arguments[0])&&arguments[0])return!!t;for(var e=[];t;)e.push(t),t=t._next;return e}},{key:"has",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return a(this,new o(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return a(this,new o(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();s.MiniSignalBinding=o,e.default=s,t.exports=e.default},"1gqn":function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},"1td8":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0},t.prototype.reset=function(){this.stopped=!1,this.currentTarget=null,this.target=null},t}();e.default=n},"26zZ":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=new n.Rectangle,o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,e.extract=this}return t.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},t.prototype.base64=function(t){return this.canvas(t).toDataURL()},t.prototype.canvas=function(t){var e=this.renderer,r=void 0,o=void 0,a=void 0,s=void 0;t&&(s=t instanceof n.RenderTexture?t:e.generateTexture(t)),s?(r=s.baseTexture._canvasRenderTarget.context,o=s.baseTexture._canvasRenderTarget.resolution,a=s.frame):(r=e.rootContext,(a=i).width=this.renderer.width,a.height=this.renderer.height);var l=a.width*o,c=a.height*o,u=new n.CanvasRenderTarget(l,c),h=r.getImageData(a.x*o,a.y*o,l,c);return u.context.putImageData(h,0,0),u.canvas},t.prototype.pixels=function(t){var e=this.renderer,r=void 0,o=void 0,a=void 0,s=void 0;return t&&(s=t instanceof n.RenderTexture?t:e.generateTexture(t)),s?(r=s.baseTexture._canvasRenderTarget.context,o=s.baseTexture._canvasRenderTarget.resolution,a=s.frame):(r=e.rootContext,(a=i).width=e.width,a.height=e.height),r.getImageData(0,0,a.width*o,a.height*o).data},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t}();e.default=o,n.CanvasRenderer.registerPlugin("extract",o)},"2AE7":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=a(r("G9Ht")),o=a(r("bx0q"));function a(t){return t&&t.__esModule?t:{default:t}}n.utils.mixins.delayMixin(n.DisplayObject.prototype,o.default);var s=100,l=0,c=0,u=2,h=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),!i.default.tablet&&!i.default.phone||navigator.isCocoonJS||this.createTouchHook();var r=document.createElement("div");r.style.width=s+"px",r.style.height=s+"px",r.style.position="absolute",r.style.top=l+"px",r.style.left=c+"px",r.style.zIndex=u,this.div=r,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessabillity=!1,window.addEventListener("keydown",this._onKeyDown,!1)}return t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2,e.style.backgroundColor="#FF0000",e.title="HOOK DIV",e.addEventListener("focus",function(){t.isMobileAccessabillity=!0,t.activate(),document.body.removeChild(e)}),document.body.appendChild(e)},t.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},t.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,r=e.length-1;r>=0;r--)this.updateAccessibleObjects(e[r])}},t.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,r=t.height/this.renderer.height,i=this.div;i.style.left=t.left+"px",i.style.top=t.top+"px",i.style.width=this.renderer.width+"px",i.style.height=this.renderer.height+"px";for(var o=0;o<this.children.length;o++){var a=this.children[o];if(a.renderId!==this.renderId)a._accessibleActive=!1,n.utils.removeItems(this.children,o,1),this.div.removeChild(a._accessibleDiv),this.pool.push(a._accessibleDiv),a._accessibleDiv=null,o--,0===this.children.length&&this.deactivate();else{i=a._accessibleDiv;var s=a.hitArea,l=a.worldTransform;a.hitArea?(i.style.left=(l.tx+s.x*l.a)*e+"px",i.style.top=(l.ty+s.y*l.d)*r+"px",i.style.width=s.width*l.a*e+"px",i.style.height=s.height*l.d*r+"px"):(s=a.getBounds(),this.capHitArea(s),i.style.left=s.x*e+"px",i.style.top=s.y*r+"px",i.style.width=s.width*e+"px",i.style.height=s.height*r+"px")}}this.renderId++}},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width=s+"px",e.style.height=s+"px",e.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=u,e.style.borderStyle="none",e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleTitle||t.accessibleHint||(e.title="displayObject "+this.tabIndex),t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData)},t.prototype._onFocus=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},t.prototype._onFocusOut=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(){this.deactivate()},t.prototype.destroy=function(){this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();e.default=h,n.WebGLRenderer.registerPlugin("accessibility",h),n.CanvasRenderer.registerPlugin("accessibility",h)},"2Dig":function(t,e){t.exports=function(t,e,r){return t.on(e,r),{destroy:function(){t.removeListener(e,r)}}}},"2IYi":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=h(r("uhBA")),o=r("pQYt"),a=h(r("Yd/J")),s=h(r("gl4O")),l=h(r("YnQD")),c=h(r("sAjT")),u=r("d07J");function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this)),n=a.default.TRANSFORM_MODE===o.TRANSFORM_MODE.STATIC?s.default:l.default;return r.tempDisplayObjectParent=null,r.transform=new n,r.alpha=1,r.visible=!0,r.renderable=!0,r.parent=null,r.worldAlpha=1,r.filterArea=null,r._filters=null,r._enabledFilters=null,r._bounds=new c.default,r._boundsID=0,r._lastBoundsID=-1,r._boundsRect=null,r._localBoundsRect=null,r._mask=null,r._destroyed=!1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),e||(this._boundsRect||(this._boundsRect=new u.Rectangle),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){var e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new u.Rectangle),t=this._localBoundsRect);var n=this.getBounds(!1,t);return this.parent=r,this.transform=e,n},e.prototype.toGlobal=function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)},e.prototype.renderWebGL=function(t){},e.prototype.renderCanvas=function(t){},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.position.x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this.position.y=t,this.scale.x=e||1,this.scale.y=r||1,this.rotation=n,this.skew.x=i,this.skew.y=o,this.pivot.x=a,this.pivot.y=s,this},e.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},n(e,[{key:"_tempDisplayObjectParent",get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new e),this.tempDisplayObjectParent}},{key:"x",get:function(){return this.position.x},set:function(t){this.transform.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.transform.position.y=t}},{key:"worldTransform",get:function(){return this.transform.worldTransform}},{key:"localTransform",get:function(){return this.transform.localTransform}},{key:"position",get:function(){return this.transform.position},set:function(t){this.transform.position.copy(t)}},{key:"scale",get:function(){return this.transform.scale},set:function(t){this.transform.scale.copy(t)}},{key:"pivot",get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copy(t)}},{key:"skew",get:function(){return this.transform.skew},set:function(t){this.transform.skew.copy(t)}},{key:"rotation",get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t}},{key:"worldVisible",get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}},{key:"mask",get:function(){return this._mask},set:function(t){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)}},{key:"filters",get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}]),e}(i.default);e.default=d,d.prototype.displayObjectUpdateTransform=d.prototype.updateTransform},"2U8Y":function(t,e,r){"use strict";var n="win32"===process.platform,i=r("MCLT");function o(t,e){for(var r=[],n=0;n<t.length;n++){var i=t[n];i&&"."!==i&&(".."===i?r.length&&".."!==r[r.length-1]?r.pop():e&&r.push(".."):r.push(i))}return r}function a(t){for(var e=t.length-1,r=0;r<=e&&!t[r];r++);for(var n=e;n>=0&&!t[n];n--);return 0===r&&n===e?t:r>n?[]:t.slice(r,n+1)}var s=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,l=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,c={};function u(t){var e=s.exec(t),r=(e[1]||"")+(e[2]||""),n=l.exec(e[3]||"");return[r,n[1],n[2],n[3]]}function h(t){var e=s.exec(t),r=e[1]||"",n=!!r&&":"!==r[1];return{device:r,isUnc:n,isAbsolute:n||!!e[2],tail:e[3]}}function d(t){return"\\\\"+t.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}c.resolve=function(){for(var t="",e="",r=!1,n=arguments.length-1;n>=-1;n--){var a;if(n>=0?a=arguments[n]:t?(a=process.env["="+t])&&a.substr(0,3).toLowerCase()===t.toLowerCase()+"\\"||(a=t+"\\"):a=process.cwd(),!i.isString(a))throw new TypeError("Arguments to path.resolve must be strings");if(a){var s=h(a),l=s.device,c=s.isUnc,u=s.isAbsolute,p=s.tail;if((!l||!t||l.toLowerCase()===t.toLowerCase())&&(t||(t=l),r||(e=p+"\\"+e,r=u),t&&r))break}}return c&&(t=d(t)),e=o(e.split(/[\\\/]+/),!r).join("\\"),t+(r?"\\":"")+e||"."},c.normalize=function(t){var e=h(t),r=e.device,n=e.isUnc,i=e.isAbsolute,a=e.tail,s=/[\\\/]$/.test(a);return(a=o(a.split(/[\\\/]+/),!i).join("\\"))||i||(a="."),a&&s&&(a+="\\"),n&&(r=d(r)),r+(i?"\\":"")+a},c.isAbsolute=function(t){return h(t).isAbsolute},c.join=function(){for(var t=[],e=0;e<arguments.length;e++){var r=arguments[e];if(!i.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&t.push(r)}var n=t.join("\\");return/^[\\\/]{2}[^\\\/]/.test(t[0])||(n=n.replace(/^[\\\/]{2,}/,"\\")),c.normalize(n)},c.relative=function(t,e){t=c.resolve(t),e=c.resolve(e);for(var r=t.toLowerCase(),n=e.toLowerCase(),i=a(e.split("\\")),o=a(r.split("\\")),s=a(n.split("\\")),l=Math.min(o.length,s.length),u=l,h=0;h<l;h++)if(o[h]!==s[h]){u=h;break}if(0==u)return e;var d=[];for(h=u;h<o.length;h++)d.push("..");return(d=d.concat(i.slice(u))).join("\\")},c._makeLong=function(t){if(!i.isString(t))return t;if(!t)return"";var e=c.resolve(t);return/^[a-zA-Z]\:\\/.test(e)?"\\\\?\\"+e:/^\\\\[^?.]/.test(e)?"\\\\?\\UNC\\"+e.substring(2):t},c.dirname=function(t){var e=u(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},c.basename=function(t,e){var r=u(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},c.extname=function(t){return u(t)[3]},c.format=function(t){if(!i.isObject(t))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof t);if(!i.isString(t.root||""))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof t.root);var e=t.dir,r=t.base||"";return e?e[e.length-1]===c.sep?e+r:e+c.sep+r:r},c.parse=function(t){if(!i.isString(t))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof t);var e=u(t);if(!e||4!==e.length)throw new TypeError("Invalid path '"+t+"'");return{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}},c.sep="\\",c.delimiter=";";var p=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f={};function m(t){return p.exec(t).slice(1)}f.resolve=function(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var n=r>=0?arguments[r]:process.cwd();if(!i.isString(n))throw new TypeError("Arguments to path.resolve must be strings");n&&(t=n+"/"+t,e="/"===n[0])}return t=o(t.split("/"),!e).join("/"),(e?"/":"")+t||"."},f.normalize=function(t){var e=f.isAbsolute(t),r=t&&"/"===t[t.length-1];return(t=o(t.split("/"),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},f.isAbsolute=function(t){return"/"===t.charAt(0)},f.join=function(){for(var t="",e=0;e<arguments.length;e++){var r=arguments[e];if(!i.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&(t+=t?"/"+r:r)}return f.normalize(t)},f.relative=function(t,e){t=f.resolve(t).substr(1),e=f.resolve(e).substr(1);for(var r=a(t.split("/")),n=a(e.split("/")),i=Math.min(r.length,n.length),o=i,s=0;s<i;s++)if(r[s]!==n[s]){o=s;break}var l=[];for(s=o;s<r.length;s++)l.push("..");return(l=l.concat(n.slice(o))).join("/")},f._makeLong=function(t){return t},f.dirname=function(t){var e=m(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},f.basename=function(t,e){var r=m(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},f.extname=function(t){return m(t)[3]},f.format=function(t){if(!i.isObject(t))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof t);if(!i.isString(t.root||""))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof t.root);return(t.dir?t.dir+f.sep:"")+(t.base||"")},f.parse=function(t){if(!i.isString(t))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof t);var e=m(t);if(!e||4!==e.length)throw new TypeError("Invalid path '"+t+"'");return e[1]=e[1]||"",e[2]=e[2]||"",e[3]=e[3]||"",{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}},f.sep="/",f.delimiter=":",t.exports=n?c:f,t.exports.posix=f,t.exports.win32=c},"2pII":function(t,e,r){var n=r("akSB"),i=r("cpc2"),o=r("NOtv")("engine.io-client:socket"),a=r("7jRU"),s=r("Wm4p"),l=r("Uxeu"),c=r("TypT");function u(t,e){if(!(this instanceof u))return new u(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=l(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=l(e.host).host),this.secure=null!=e.secure?e.secure:global.location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||(global.location?location.hostname:"localhost"),this.port=e.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode;var r="object"==typeof global&&global;r.global===r&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=u,u.priorWebsocketSuccess=!1,i(u.prototype),u.protocol=s.protocol,u.Socket=u,u.Transport=r("Gbct"),u.transports=r("akSB"),u.parser=r("Wm4p"),u.prototype.createTransport=function(t){o('creating transport "%s"',t);var e=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}(this.query);e.EIO=s.protocol,e.transport=t;var r=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new n[t]({query:e,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0})},u.prototype.open=function(){var t;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},u.prototype.setTransport=function(t){o("setting transport %s",t.name);var e=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},u.prototype.probe=function(t){o('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),r=!1,n=this;function i(){n.onlyBinaryUpgrades&&(r=r||!this.supportsBinary&&n.transport.supportsBinary),r||(o('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),!e)return;u.priorWebsocketSuccess="websocket"===e.name,o('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){r||"closed"!==n.readyState&&(o("changing transport and sending upgrade packet"),d(),n.setTransport(e),e.send([{type:"upgrade"}]),n.emit("upgrade",e),e=null,n.upgrading=!1,n.flush())})}else{o('probe transport "%s" failed',t);var a=new Error("probe error");a.transport=e.name,n.emit("upgradeError",a)}}))}function a(){r||(r=!0,d(),e.close(),e=null)}function s(r){var i=new Error("probe error: "+r);i.transport=e.name,a(),o('probe transport "%s" failed because of error: %s',t,r),n.emit("upgradeError",i)}function l(){s("transport closed")}function c(){s("socket closed")}function h(t){e&&t.name!==e.name&&(o('"%s" works - aborting "%s"',t.name,e.name),a())}function d(){e.removeListener("open",i),e.removeListener("error",s),e.removeListener("close",l),n.removeListener("close",c),n.removeListener("upgrading",h)}u.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",s),e.once("close",l),this.once("close",c),this.once("upgrading",h),e.open()},u.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},u.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else o('packet received with socket readyState "%s"',this.readyState)},u.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},u.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},u.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(t,e,r){return this.sendPacket("message",t,e,r),this},u.prototype.sendPacket=function(t,e,r,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:t,data:e,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},u.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}function e(){t.onClose("forced close"),o("socket closing - telling transport to close"),t.transport.close()}function r(){t.removeListener("upgrade",r),t.removeListener("upgradeError",r),e()}function n(){t.once("upgrade",r),t.once("upgradeError",r)}return this},u.prototype.onError=function(t){o("socket error %j",t),u.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},u.prototype.onClose=function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(o('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},u.prototype.filterUpgrades=function(t){for(var e=[],r=0,n=t.length;r<n;r++)~a(this.transports,t[r])&&e.push(t[r]);return e}},3:function(t,e){},"3AcN":function(t,e,r){"use strict";e.__esModule=!0,e.autoDetectRenderer=e.Application=e.Filter=e.SpriteMaskFilter=e.Quad=e.RenderTarget=e.ObjectRenderer=e.WebGLManager=e.Shader=e.CanvasRenderTarget=e.TextureUvs=e.VideoBaseTexture=e.BaseRenderTexture=e.RenderTexture=e.BaseTexture=e.TextureMatrix=e.Texture=e.Spritesheet=e.CanvasGraphicsRenderer=e.GraphicsRenderer=e.GraphicsData=e.Graphics=e.TextMetrics=e.TextStyle=e.Text=e.SpriteRenderer=e.CanvasTinter=e.CanvasSpriteRenderer=e.Sprite=e.TransformBase=e.TransformStatic=e.Transform=e.Container=e.DisplayObject=e.Bounds=e.glCore=e.WebGLRenderer=e.CanvasRenderer=e.ticker=e.utils=e.settings=void 0;var n=r("pQYt");Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var i=r("d07J");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=r("yI/K");Object.defineProperty(e,"glCore",{enumerable:!0,get:function(){return Y(o).default}});var a=r("sAjT");Object.defineProperty(e,"Bounds",{enumerable:!0,get:function(){return Y(a).default}});var s=r("2IYi");Object.defineProperty(e,"DisplayObject",{enumerable:!0,get:function(){return Y(s).default}});var l=r("a/Ns");Object.defineProperty(e,"Container",{enumerable:!0,get:function(){return Y(l).default}});var c=r("YnQD");Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return Y(c).default}});var u=r("gl4O");Object.defineProperty(e,"TransformStatic",{enumerable:!0,get:function(){return Y(u).default}});var h=r("KByU");Object.defineProperty(e,"TransformBase",{enumerable:!0,get:function(){return Y(h).default}});var d=r("jQCb");Object.defineProperty(e,"Sprite",{enumerable:!0,get:function(){return Y(d).default}});var p=r("LNIn");Object.defineProperty(e,"CanvasSpriteRenderer",{enumerable:!0,get:function(){return Y(p).default}});var f=r("/UP7");Object.defineProperty(e,"CanvasTinter",{enumerable:!0,get:function(){return Y(f).default}});var m=r("4o2V");Object.defineProperty(e,"SpriteRenderer",{enumerable:!0,get:function(){return Y(m).default}});var v=r("Z0PJ");Object.defineProperty(e,"Text",{enumerable:!0,get:function(){return Y(v).default}});var g=r("vUM4");Object.defineProperty(e,"TextStyle",{enumerable:!0,get:function(){return Y(g).default}});var y=r("TR3/");Object.defineProperty(e,"TextMetrics",{enumerable:!0,get:function(){return Y(y).default}});var x=r("5dPP");Object.defineProperty(e,"Graphics",{enumerable:!0,get:function(){return Y(x).default}});var b=r("APSF");Object.defineProperty(e,"GraphicsData",{enumerable:!0,get:function(){return Y(b).default}});var w=r("7JTu");Object.defineProperty(e,"GraphicsRenderer",{enumerable:!0,get:function(){return Y(w).default}});var _=r("t/7c");Object.defineProperty(e,"CanvasGraphicsRenderer",{enumerable:!0,get:function(){return Y(_).default}});var S=r("TF/P");Object.defineProperty(e,"Spritesheet",{enumerable:!0,get:function(){return Y(S).default}});var T=r("xJsK");Object.defineProperty(e,"Texture",{enumerable:!0,get:function(){return Y(T).default}});var M=r("4fju");Object.defineProperty(e,"TextureMatrix",{enumerable:!0,get:function(){return Y(M).default}});var A=r("3Jm9");Object.defineProperty(e,"BaseTexture",{enumerable:!0,get:function(){return Y(A).default}});var E=r("eIHw");Object.defineProperty(e,"RenderTexture",{enumerable:!0,get:function(){return Y(E).default}});var C=r("WJwb");Object.defineProperty(e,"BaseRenderTexture",{enumerable:!0,get:function(){return Y(C).default}});var P=r("s1PF");Object.defineProperty(e,"VideoBaseTexture",{enumerable:!0,get:function(){return Y(P).default}});var O=r("963y");Object.defineProperty(e,"TextureUvs",{enumerable:!0,get:function(){return Y(O).default}});var N=r("pDOs");Object.defineProperty(e,"CanvasRenderTarget",{enumerable:!0,get:function(){return Y(N).default}});var L=r("N0WC");Object.defineProperty(e,"Shader",{enumerable:!0,get:function(){return Y(L).default}});var I=r("Bjwz");Object.defineProperty(e,"WebGLManager",{enumerable:!0,get:function(){return Y(I).default}});var R=r("4FaX");Object.defineProperty(e,"ObjectRenderer",{enumerable:!0,get:function(){return Y(R).default}});var D=r("8WrO");Object.defineProperty(e,"RenderTarget",{enumerable:!0,get:function(){return Y(D).default}});var F=r("PuCZ");Object.defineProperty(e,"Quad",{enumerable:!0,get:function(){return Y(F).default}});var U=r("he9Y");Object.defineProperty(e,"SpriteMaskFilter",{enumerable:!0,get:function(){return Y(U).default}});var k=r("Wr15");Object.defineProperty(e,"Filter",{enumerable:!0,get:function(){return Y(k).default}});var B=r("zLIK");Object.defineProperty(e,"Application",{enumerable:!0,get:function(){return Y(B).default}});var j=r("uc/I");Object.defineProperty(e,"autoDetectRenderer",{enumerable:!0,get:function(){return j.autoDetectRenderer}});var z=X(r("qp2T")),V=X(r("8g3p")),G=Y(r("Yd/J")),H=Y(r("pVcz")),W=Y(r("pV5o"));function X(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Y(t){return t&&t.__esModule?t:{default:t}}e.settings=G.default,e.utils=z,e.ticker=V,e.CanvasRenderer=H.default,e.WebGLRenderer=W.default},"3Gzo":function(t,e,r){"use strict";e.__esModule=!0;var n=r("nWIE");Object.defineProperty(e,"ParticleContainer",{enumerable:!0,get:function(){return o(n).default}});var i=r("0HXk");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"ParticleRenderer",{enumerable:!0,get:function(){return o(i).default}})},"3Jm9":function(t,e,r){"use strict";e.__esModule=!0;var n=r("qp2T"),i=l(r("Yd/J")),o=l(r("uhBA")),a=l(r("ad8U")),s=l(r("pIo5"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r,o,a){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return s.uid=(0,n.uid)(),s.touched=0,s.resolution=a||i.default.RESOLUTION,s.width=100,s.height=100,s.realWidth=100,s.realHeight=100,s.scaleMode=void 0!==o?o:i.default.SCALE_MODE,s.hasLoaded=!1,s.isLoading=!1,s.source=null,s.origSource=null,s.imageType=null,s.sourceScale=1,s.premultipliedAlpha=!0,s.imageUrl=null,s.isPowerOfTwo=!1,s.mipmap=i.default.MIPMAP_TEXTURES,s.wrapMode=i.default.WRAP_MODE,s._glTextures={},s._enabled=0,s._virtalBoundId=-1,s._destroyed=!1,s.textureCacheIds=[],r&&s.loadSource(r),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.update=function(){"svg"!==this.imageType&&(this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height,this._updateDimensions()),this.emit("update",this)},e.prototype._updateDimensions=function(){this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=s.default.isPow2(this.realWidth)&&s.default.isPow2(this.realHeight)},e.prototype.loadSource=function(t){var e=this.isLoading;this.hasLoaded=!1,this.isLoading=!1,e&&this.source&&(this.source.onload=null,this.source.onerror=null);var r=!this.source;if(this.source=t,(t.src&&t.complete||t.getContext)&&t.width&&t.height)this._updateImageType(),"svg"===this.imageType?this._loadSvgSource():this._sourceLoaded(),r&&this.emit("loaded",this);else if(!t.getContext){this.isLoading=!0;var n=this;if(t.onload=function(){n._updateImageType(),t.onload=null,t.onerror=null,n.isLoading&&(n.isLoading=!1,n._sourceLoaded(),"svg"!==n.imageType?n.emit("loaded",n):n._loadSvgSource())},t.onerror=function(){t.onload=null,t.onerror=null,n.isLoading&&(n.isLoading=!1,n.emit("error",n))},t.complete&&t.src){if(t.onload=null,t.onerror=null,"svg"===n.imageType)return void n._loadSvgSource();this.isLoading=!1,t.width&&t.height?(this._sourceLoaded(),e&&this.emit("loaded",this)):e&&this.emit("error",this)}}},e.prototype._updateImageType=function(){if(this.imageUrl){var t=(0,n.decomposeDataUri)(this.imageUrl),e=void 0;if(t&&"image"===t.mediaType){var r=t.subType.split("+")[0];if(!(e=(0,n.getUrlFileExtension)("."+r)))throw new Error("Invalid image type in data URI.")}else(e=(0,n.getUrlFileExtension)(this.imageUrl))||(e="png");this.imageType=e}},e.prototype._loadSvgSource=function(){if("svg"===this.imageType){var t=(0,n.decomposeDataUri)(this.imageUrl);t?this._loadSvgSourceUsingDataUri(t):this._loadSvgSourceUsingXhr()}},e.prototype._loadSvgSourceUsingDataUri=function(t){var e=void 0;if("base64"===t.encoding){if(!atob)throw new Error("Your browser doesn't support base64 conversions.");e=atob(t.data)}else e=t.data;this._loadSvgSourceUsingString(e)},e.prototype._loadSvgSourceUsingXhr=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){if(e.readyState!==e.DONE||200!==e.status)throw new Error("Failed to load SVG using XHR.");t._loadSvgSourceUsingString(e.response)},e.onerror=function(){return t.emit("error",t)},e.open("GET",this.imageUrl,!0),e.send()},e.prototype._loadSvgSourceUsingString=function(t){var r=(0,n.getSvgSize)(t),i=r.width,o=r.height;if(!i||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");this.realWidth=Math.round(i*this.sourceScale),this.realHeight=Math.round(o*this.sourceScale),this._updateDimensions();var a=document.createElement("canvas");a.width=this.realWidth,a.height=this.realHeight,a._pixiId="canvas_"+(0,n.uid)(),a.getContext("2d").drawImage(this.source,0,0,i,o,0,0,this.realWidth,this.realHeight),this.origSource=this.source,this.source=a,e.addToCache(this,a._pixiId),this.isLoading=!1,this._sourceLoaded(),this.emit("loaded",this)},e.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},e.prototype.destroy=function(){this.imageUrl&&(delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")),this.source=null,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this._destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.updateSourceImage=function(t){this.source.src=t,this.loadSource(this.source)},e.fromImage=function(t,r,i,o){var s=n.BaseTextureCache[t];if(!s){var l=new Image;void 0===r&&0!==t.indexOf("data:")?l.crossOrigin=(0,a.default)(t):r&&(l.crossOrigin="string"==typeof r?r:"anonymous"),(s=new e(l,i)).imageUrl=t,o&&(s.sourceScale=o),s.resolution=(0,n.getResolutionOfUrl)(t),l.src=t,e.addToCache(s,t)}return s},e.fromCanvas=function(t,r){t._pixiId||(t._pixiId=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas")+"_"+(0,n.uid)());var i=n.BaseTextureCache[t._pixiId];return i||(i=new e(t,r),e.addToCache(i,t._pixiId)),i},e.from=function(t,r,i){if("string"==typeof t)return e.fromImage(t,void 0,r,i);if(t instanceof HTMLImageElement){var o=t.src,a=n.BaseTextureCache[o];return a||((a=new e(t,r)).imageUrl=o,i&&(a.sourceScale=i),a.resolution=(0,n.getResolutionOfUrl)(o),e.addToCache(a,o)),a}return t instanceof HTMLCanvasElement?e.fromCanvas(t,r):t},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),n.BaseTextureCache[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),n.BaseTextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=n.BaseTextureCache[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete n.BaseTextureCache[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)delete n.BaseTextureCache[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},e}(o.default);e.default=c},"3LRy":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.vertices=new ArrayBuffer(e),this.float32View=new Float32Array(this.vertices),this.uint32View=new Uint32Array(this.vertices)}return t.prototype.destroy=function(){this.vertices=null,this.positions=null,this.uvs=null,this.colors=null},t}();e.default=n},"3Ym4":function(t,e,r){"use strict";r("M0IJ"),r("sEJ7"),r("xnYG"),r("a7XB"),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array)},"3hGs":function(t,e,r){var n=r("Womt");t.exports=function(){var t,e,r,i,o,a,s,l,c,u=null,h=null,d=null,p={},f={},m={},v={},g={},y={},x={},b={},w={},_=n.SmoothShading,S={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},T=1,M="Y",A=null;function E(p,_,E){if(u=(new DOMParser).parseFromString(p,"text/xml"),_=_||d,void 0!==E){var P=E.split("/");P.pop(),s=(P.length<1?".":P.join("/"))+"/"}!function(){var t=u.querySelectorAll("asset")[0];if(t&&t.childNodes)for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"unit":var n=r.getAttribute("meter");n&&(T=parseFloat(n));break;case"up_axis":M=r.textContent.charAt(0)}}}(),function(){if(!0!==S.convertUpAxis||M===S.upAxis)A=null;else switch(M){case"X":A="Y"===S.upAxis?"XtoY":"XtoZ";break;case"Y":A="X"===S.upAxis?"YtoX":"YtoZ";break;case"Z":A="X"===S.upAxis?"ZtoX":"ZtoY"}}(),f=C("library_images image",k,"image"),y=C("library_materials material",it,"material"),x=C("library_effects effect",ct,"effect"),g=C("library_geometries geometry",q,"geometry"),b=C("library_cameras camera",mt,"camera"),w=C("library_lights light",gt,"light"),v=C("library_controllers controller",B,"controller"),m=C("library_animations animation",ht,"animation"),o=C("library_visual_scenes visual_scene",V,"visual_scene"),a=C("library_kinematics_models kinematics_model",xt,"kinematics_model"),l=[],c=[],t=function(){var t=u.querySelectorAll("scene instance_visual_scene")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return o[e.length>0?e:"visual_scene0"]}return null}(),h=new n.Group;for(var O=0;O<t.nodes.length;O++)h.add(I(t.nodes[O]));h.scale.multiplyScalar(T),r=[],function e(n){var i=t.getChildById(n.colladaId,!0),o=null;if(i&&i.keys){r.push(o={fps:60,hierarchy:[{node:i,keys:i.keys,sids:i.sids}],node:n,name:"animation_"+n.name,length:0});for(var a=0,s=i.keys.length;a<s;a++)o.length=Math.max(o.length,i.keys[a].time)}else o={hierarchy:[{keys:[],sids:[]}]};for(a=0,s=n.children.length;a<s;a++)for(var l=0,c=e(n.children[a]).hierarchy.length;l<c;l++)o.hierarchy.push({keys:[],sids:[]});return o}(h),e=function(){var t=u.querySelectorAll("instance_kinematics_model")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return a[e.length>0?e:"kinematics_model0"]}return null}(),function(){if(e&&0===e.joints.length)i=void 0;else{var r={},o=function(n,i){var o=i.getAttribute("id"),a=t.getChildById(o,!0),s=e.joints[n];h.traverse(function(t){t.colladaId==o&&(r[n]={node:t,transforms:a.transforms,joint:s,position:s.zeroPosition})})};i={joints:e&&e.joints,getJointValue:function(t){var e=r[t];if(e)return e.position;console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue:function(t,e){var i=r[t];if(i){var o=i.joint;if(e>o.limits.max||e<o.limits.min)console.log("setJointValue: joint "+t+" value "+e+" outside of limits (min: "+o.limits.min+", max: "+o.limits.max+")");else if(o.static)console.log("setJointValue: joint "+t+" is static");else{var a=i.node,l=o.axis,c=i.transforms,u=new n.Matrix4;for(s=0;s<c.length;s++){var h=c[s];if(h.sid&&-1!==h.sid.indexOf("joint"+t))switch(o.type){case"revolute":u.multiply(d.makeRotationAxis(l,n.Math.degToRad(e)));break;case"prismatic":u.multiply(d.makeTranslation(l.x*e,l.y*e,l.z*e));break;default:console.warn("setJointValue: unknown joint type: "+o.type)}else{var d=new n.Matrix4;switch(h.type){case"matrix":u.multiply(h.obj);break;case"translate":u.multiply(d.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"rotate":u.multiply(d.makeRotationAxis(h.obj,h.angle))}}}var p=Array.prototype.slice.call(u.elements);a.matrix.set.apply(a.matrix,[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]]),a.matrix.decompose(a.position,a.quaternion,a.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};var a=u.querySelector("scene instance_kinematics_scene");if(a)for(var s=0;s<a.childNodes.length;s++){var l=a.childNodes[s];if(1==l.nodeType)switch(l.nodeName){case"bind_joint_axis":var c=l.getAttribute("target").split("/").pop(),d=l.querySelector("axis param").textContent,p=parseInt(d.split("joint").pop().split(".")[0]),f=u.querySelector('[sid="'+c+'"]');f&&o(p,f.parentElement)}}}}();var N={scene:h,morphs:l,skins:c,animations:r,kinematics:i,dae:{images:f,materials:y,cameras:b,lights:w,effects:x,geometries:g,controllers:v,animations:m,visualScenes:o,visualScene:t,scene:t,kinematicsModels:a,kinematicsModel:e}};return _&&_(N),N}function C(t,e,r){for(var n=u.querySelectorAll(t),i={},o=0,a=n.length,s=0;s<a;s++){var l=n[s],c=(new e).parse(l);c.id&&0!==c.id.length||(c.id=r+o++),i[c.id]=c}return i}function P(t,e){var r=e instanceof W?v[e.url]:e;if(r&&r.morph){for(var n=r.morph,i=0;i<n.targets.length;i++){var o=g[n.targets[i]];if(o.mesh&&o.mesh.primitives&&o.mesh.primitives.length){var a=o.mesh.primitives[0].geometry;a.vertices.length===t.vertices.length&&t.morphTargets.push({name:"target_1",vertices:a.vertices})}}t.morphTargets.push({name:"target_Z",vertices:t.vertices})}else console.log("could not find morph controller!")}function O(t,e,r,i){if(t.world=t.world||new n.Matrix4,t.localworld=t.localworld||new n.Matrix4,t.world.copy(t.matrix),t.localworld.copy(t.matrix),t.channels&&t.channels.length){var o=t.channels[0].sampler.output[r];o instanceof n.Matrix4&&(t.world.copy(o),t.localworld.copy(o),0===r&&t.matrix.copy(o))}i&&t.world.multiplyMatrices(i,t.world),e.push(t);for(var a=0;a<t.nodes.length;a++)O(t.nodes[a],e,r,t.world)}function N(t,e){for(var r=0;r<t.length;r++){var i=t[r],o=-1;if("JOINT"==i.type){for(var a=0;a<e.joints.length;a++)if(i.sid===e.joints[a]){o=a;break}if(o>=0){var s=e.invBindMatrices[o];for(i.invBindMatrix=s,i.skinningMatrix=new n.Matrix4,i.skinningMatrix.multiplyMatrices(i.world,s),i.animatrix=new n.Matrix4,i.animatrix.copy(i.localworld),i.weights=[],a=0;a<e.weights.length;a++)for(var l=0;l<e.weights[a].length;l++){var c=e.weights[a][l];c.joint===o&&i.weights.push(c)}}else console.warn("ColladaLoader: Could not find joint '"+i.sid+"'."),i.skinningMatrix=new n.Matrix4,i.weights=[]}}}function L(e,r,i){var o=v[r.url];if(i=void 0!==i?i:40,o&&o.skin)if(r.skeleton&&r.skeleton.length){for(var a=function(){var t,e=1e6,r=-e,n=0;for(var i in m){var o=m[i];t=t||o.id;for(var a=0;a<o.sampler.length;a++){var s=o.sampler[a];s.create(),e=Math.min(e,s.startTime),r=Math.max(r,s.endTime),n=Math.max(n,s.input.length)}}return{start:e,end:r,frames:n,ID:t}}(),s=t.getChildById(r.skeleton[0],!0)||t.getChildBySid(r.skeleton[0],!0),l=function(t){var e=[],r=function(t,e,i){var o={};o.name=e.sid,o.parent=t,o.matrix=e.matrix;var a=[new n.Vector3,new n.Quaternion,new n.Vector3];for(var s in o.matrix.decompose(a[0],a[1],a[2]),o.pos=[a[0].x,a[0].y,a[0].z],o.scl=[a[2].x,a[2].y,a[2].z],o.rotq=[a[1].x,a[1].y,a[1].z,a[1].w],i.push(o),e.nodes)r(e.sid,e.nodes[s],i)};return r(-1,t,e),e}(s),c=o.skin.joints,u=[],h=0;h<c.length;h++)for(var d=0;d<l.length;d++)l[d].name===c[h]&&(u[h]=l[d]);for(h=0;h<u.length;h++)for(d=0;d<u.length;d++)u[h].parent===u[d].name&&(u[h].parent=d);for(new n.Vector3,h=0;h<e.vertices.length;h++)e.vertices[h].applyMatrix4(o.skin.bindShapeMatrix);var p=[],f=[],g=o.skin.weights;for(h=0;h<g.length;h++){var y=new n.Vector4(g[h][0]?g[h][0].joint:0,g[h][1]?g[h][1].joint:0,g[h][2]?g[h][2].joint:0,g[h][3]?g[h][3].joint:0),x=new n.Vector4(g[h][0]?g[h][0].weight:0,g[h][1]?g[h][1].weight:0,g[h][2]?g[h][2].weight:0,g[h][3]?g[h][3].weight:0);p.push(y),f.push(x)}e.skinIndices=p,e.skinWeights=f,e.bones=u;var b={name:a.ID,fps:30,length:a.frames/30,hierarchy:[]};for(d=0;d<u.length;d++)b.hierarchy.push({parent:u[d].parent,name:u[d].name,keys:[]});for(console.log("ColladaLoader:",a.ID+" has "+u.length+" bones."),function(t,e,r){var i=[];O(e,i,-1),N(i,r.skin);for(var o=new n.Vector3,a=[],s=0;s<t.vertices.length;s++)a.push(new n.Vector3);for(s=0;s<i.length;s++)if("JOINT"==i[s].type)for(var l=0;l<i[s].weights.length;l++){var c=i[s].weights[l],u=c.index,h=c.weight,d=t.vertices[u],p=a[u];o.x=d.x,o.y=d.y,o.z=d.z,o.applyMatrix4(i[s].skinningMatrix),p.x+=o.x*h,p.y+=o.y*h,p.z+=o.z*h}for(s=0;s<t.vertices.length;s++)t.vertices[s]=a[s]}(e,s,o),i=0;i<a.frames;i++){var w=[];for(O(s,w,i),N(w,o.skin),h=0;h<w.length;h++)for(d=0;d<b.hierarchy.length;d++)if(b.hierarchy[d].name===w[h].sid){var _={};_.time=i/30,_.matrix=w[h].animatrix,0===i&&(w[h].matrix=_.matrix);var S=[new n.Vector3,new n.Quaternion,new n.Vector3];_.matrix.decompose(S[0],S[1],S[2]),_.pos=[S[0].x,S[0].y,S[0].z],_.scl=[S[2].x,S[2].y,S[2].z],_.rot=S[1],b.hierarchy[d].keys.push(_)}e.animation=b}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function I(t,e){var r,i,o,a,s=new n.Object3D;for(o=0;o<t.controllers.length;o++){var u=v[t.controllers[o].url];switch(u.type){case"skin":if(g[u.skin.source])(d=new Y).url=u.skin.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d),r=t.controllers[o];else if(v[u.skin.source]){var h=v[u.skin.source];i=h,h.morph&&g[h.morph.source]&&((d=new Y).url=h.morph.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d))}break;case"morph":var d;g[u.morph.source]&&((d=new Y).url=u.morph.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d),i=t.controllers[o]),console.log("ColladaLoader: Morph-controller partially supported.")}}var p={};for(o=0;o<t.geometries.length;o++){var f,m=t.geometries[o],_=m.instance_material,T=g[m.url],M={},A=[],E=0;if(T){if(!T.mesh||!T.mesh.primitives)continue;if(0===s.name.length&&(s.name=T.id),_)for(a=0;a<_.length;a++){var C=_[a],O=y[C.target],N=x[O.instance_effect.url].shader.material;if(T.doubleSided){if(!(C.symbol in p)){var R=N.clone();R.side=n.DoubleSide,p[C.symbol]=R}N=p[C.symbol]}N.opacity=N.opacity?N.opacity:1,M[C.symbol]=E,A.push(N),(f=N).name=null===O.name||""===O.name?O.id:O.name,E++}var D,F=f||new n.MeshLambertMaterial({color:14540253,side:T.doubleSided?n.DoubleSide:n.FrontSide}),U=T.mesh.geometry3js;E>1&&(F=new n.MultiMaterial(A)),void 0!==r?(L(U,r),U.morphTargets.length>0?(F.morphTargets=!0,F.skinning=!1):(F.morphTargets=!1,F.skinning=!0),(D=new n.SkinnedMesh(U,F,!1)).name="skin_"+c.length,c.push(D)):void 0!==i?(P(U,i),F.morphTargets=!0,(D=new n.Mesh(U,F)).name="morph_"+l.length,l.push(D)):D=!0===U.isLineStrip?new n.Line(U):new n.Mesh(U,F),s.add(D)}}for(o=0;o<t.cameras.length;o++){var k=b[t.cameras[o].url],B=new n.PerspectiveCamera(k.yfov,parseFloat(k.aspect_ratio),parseFloat(k.znear),parseFloat(k.zfar));s.add(B)}for(o=0;o<t.lights.length;o++){var j=null,z=w[t.lights[o].url];if(z&&z.technique){var V=z.color.getHex(),G=z.intensity,H=z.distance,W=z.falloff_angle;switch(z.technique){case"directional":(j=new n.DirectionalLight(V,G,H)).position.set(0,0,1);break;case"point":j=new n.PointLight(V,G,H);break;case"spot":(j=new n.SpotLight(V,G,H,W)).position.set(0,0,1);break;case"ambient":j=new n.AmbientLight(V)}}j&&s.add(j)}if(s.name=t.name||t.id||"",s.colladaId=t.id||"",s.layer=t.layer||"",s.matrix=t.matrix,s.matrix.decompose(s.position,s.quaternion,s.scale),S.centerGeometry&&s.geometry){var X=s.geometry.center();X.multiply(s.scale),X.applyQuaternion(s.quaternion),s.position.sub(X)}for(o=0;o<t.nodes.length;o++)s.add(I(t.nodes[o]));return s}function R(t){for(var e=u.querySelectorAll("library_nodes node"),r=0;r<e.length;r++){var n=e[r].attributes.getNamedItem("id");if(n&&n.value===t)return e[r]}}function D(t,e){for(var r=null,n=0,i=t.length;n<i&&null===r;n++){var o=t[n];if(o.time===e)r=o;else if(o.time>e)break}return r}function F(t,e){for(var r=-1,n=0,i=t.length;n<i&&-1===r;n++)t[n].time>=e&&(r=n);return r}function U(t,e,r,n){var i=function(t,e,r){for(r=r>=0?r:r+t.length;r>=0;r--){var n=t[r];if(n.hasTarget(e))return n}return null}(t,n,r?r-1:0),o=function(t,e,r){for(;r<t.length;r++){var n=t[r];if(n.hasTarget(e))return n}return null}(t,n,r+1);if(i&&o){var a,s=(e.time-i.time)/(o.time-i.time),l=i.getTarget(n),c=o.getTarget(n).data,u=l.data;if("matrix"===l.type)a=u;else if(u.length){a=[];for(var h=0;h<u.length;++h)a[h]=u[h]+(c[h]-u[h])*s}else a=u+(c-u)*s;e.addTarget(n,l.transform,l.member,a)}}function k(){this.id="",this.init_from=""}function B(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function j(){this.method=null,this.source=null,this.targets=null,this.weights=null}function z(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function V(){this.id="",this.name="",this.nodes=[],this.scene=new n.Group}function G(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new n.Matrix4}function H(){this.sid="",this.type="",this.data=[],this.obj=null}function W(){this.url="",this.skeleton=[],this.instance_material=[]}function X(){this.symbol="",this.target=""}function Y(){this.url="",this.instance_material=[]}function q(){this.id="",this.mesh=null}function J(t){this.geometry=t.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function Z(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new n.Geometry}function Q(){Z.call(this),this.vcount=[]}function K(){Z.call(this),this.vcount=1}function $(){Z.call(this),this.vcount=3}function tt(){this.source="",this.count=0,this.stride=0,this.params=[]}function et(){this.input={}}function rt(){this.semantic="",this.offset=0,this.source="",this.set=0}function nt(t){this.id=t,this.type=null}function it(){this.id="",this.name="",this.instance_effect=null}function ot(){this.color=new n.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function at(t,e){this.type=t,this.effect=e,this.material=null}function st(t){this.effect=t,this.init_from=null,this.format=null}function lt(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function ct(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function ut(){this.url=""}function ht(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function dt(t){this.animation=t,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function pt(t){this.id="",this.animation=t,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function ft(t){this.targets=[],this.time=t}function mt(){this.id="",this.name="",this.technique=""}function vt(){this.url=""}function gt(){this.id="",this.name="",this.technique=""}function yt(){this.url=""}function xt(){this.id="",this.name="",this.joints=[],this.links=[]}function bt(){this.sid="",this.name="",this.axis=new n.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function wt(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function _t(){this.joint="",this.transforms=[],this.links=[]}function St(t){var e=t.getAttribute("id");return void 0!=p[e]?p[e]:(p[e]=new nt(e).parse(t),p[e])}function Tt(t){for(var e=Et(t),r=[],n=0,i=e.length;n<i;n++)r.push("true"===e[n]||"1"===e[n]);return r}function Mt(t){for(var e=Et(t),r=[],n=0,i=e.length;n<i;n++)r.push(parseFloat(e[n]));return r}function At(t){for(var e=Et(t),r=[],n=0,i=e.length;n<i;n++)r.push(parseInt(e[n],10));return r}function Et(t){return t.length>0?function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}(t).split(/\s+/):[]}function Ct(t,e,r){return t.hasAttribute(e)?parseInt(t.getAttribute(e),10):r}function Pt(t,e){(new n.ImageLoader).load(e,function(e){t.image=e,t.needsUpdate=!0})}function Ot(t,e){t.doubleSided=!1;var r=e.querySelectorAll("extra double_sided")[0];r&&r&&1===parseInt(r.textContent,10)&&(t.doubleSided=!0)}function Nt(t,e){if(!0===S.convertUpAxis&&M!==S.upAxis)switch(A){case"XtoY":var r=t[0];t[0]=e*t[1],t[1]=r;break;case"XtoZ":r=t[2],t[2]=t[1],t[1]=t[0],t[0]=r;break;case"YtoX":r=t[0],t[0]=t[1],t[1]=e*r;break;case"YtoZ":r=t[1],t[1]=e*t[2],t[2]=r;break;case"ZtoX":r=t[0],t[0]=t[1],t[1]=t[2],t[2]=r;break;case"ZtoY":r=t[1],t[1]=t[2],t[2]=e*r}}function Lt(t,e){var r=[t[e],t[e+1],t[e+2]];return Nt(r,-1),new n.Vector3(r[0],r[1],r[2])}function It(t){if(S.convertUpAxis){var e=[t[0],t[4],t[8]];Nt(e,-1),t[0]=e[0],t[4]=e[1],t[8]=e[2],Nt(e=[t[1],t[5],t[9]],-1),t[1]=e[0],t[5]=e[1],t[9]=e[2],Nt(e=[t[2],t[6],t[10]],-1),t[2]=e[0],t[6]=e[1],t[10]=e[2],Nt(e=[t[0],t[1],t[2]],-1),t[0]=e[0],t[1]=e[1],t[2]=e[2],Nt(e=[t[4],t[5],t[6]],-1),t[4]=e[0],t[5]=e[1],t[6]=e[2],Nt(e=[t[8],t[9],t[10]],-1),t[8]=e[0],t[9]=e[1],t[10]=e[2],Nt(e=[t[3],t[7],t[11]],-1),t[3]=e[0],t[7]=e[1],t[11]=e[2]}return(new n.Matrix4).set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Rt(t){return t>-1&&t<3&&(t={X:0,Y:1,Z:2}[t=Dt(["X","Y","Z"][t])]),t}function Dt(t){if(S.convertUpAxis)switch(t){case"X":switch(A){case"XtoY":case"XtoZ":case"YtoX":t="Y";break;case"ZtoX":t="Z"}break;case"Y":switch(A){case"XtoY":case"YtoX":case"ZtoX":t="X";break;case"XtoZ":case"YtoZ":case"ZtoY":t="Z"}break;case"Z":switch(A){case"XtoZ":t="X";break;case"YtoZ":case"ZtoX":case"ZtoY":t="Y"}}return t}return k.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];"init_from"===r.nodeName&&(this.init_from=r.textContent)}return this},B.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.type="none";for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"skin":this.skin=(new z).parse(r),this.type=r.nodeName;break;case"morph":this.morph=(new j).parse(r),this.type=r.nodeName}}return this},j.prototype.parse=function(t){var e,r={},n=[];for(this.method=t.getAttribute("method"),this.source=t.getAttribute("source").replace(/^#/,""),e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":r[(a=(new nt).parse(i)).id]=a;break;case"targets":n=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(e=0;e<n.length;e++){var o=n[e],a=r[o.source];switch(o.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read()}}return this},j.prototype.parseInputs=function(t){for(var e=[],r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":e.push((new rt).parse(n))}}return e},z.prototype.parse=function(t){var e,r,n={};this.source=t.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var a=Mt(o.textContent);this.bindShapeMatrix=It(a);break;case"source":var s=(new nt).parse(o);n[s.id]=s;break;case"joints":e=o;break;case"vertex_weights":r=o;break;default:console.log(o.nodeName)}}return this.parseJoints(e,n),this.parseWeights(r,n),this},z.prototype.parseJoints=function(t,e){for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":var i=(new rt).parse(n),o=e[i.source];"JOINT"===i.semantic?this.joints=o.read():"INV_BIND_MATRIX"===i.semantic&&(this.invBindMatrices=o.read())}}},z.prototype.parseWeights=function(t,e){for(var r,n,i=[],o=0;o<t.childNodes.length;o++){var a=t.childNodes[o];if(1==a.nodeType)switch(a.nodeName){case"input":i.push((new rt).parse(a));break;case"v":r=At(a.textContent);break;case"vcount":n=At(a.textContent)}}var s=0;for(o=0;o<n.length;o++){for(var l=n[o],c=[],u=0;u<l;u++){for(var h={},d=0;d<i.length;d++){var p=i[d],f=r[s+p.offset];switch(p.semantic){case"JOINT":h.joint=f;break;case"WEIGHT":h.weight=e[p.source].data[f]}}c.push(h),s+=i.length}for(u=0;u<c.length;u++)c[u].index=o;this.weights.push(c)}},V.prototype.getChildById=function(t,e){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(t,e);if(n)return n}return null},V.prototype.getChildBySid=function(t,e){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(t,e);if(n)return n}return null},V.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.nodes=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new G).parse(r))}}return this},G.prototype.getChannelForTransform=function(t){for(var e=0;e<this.channels.length;e++){var r,n=this.channels[e],i=n.target.split("/"),o=(i.shift(),i.shift()),a=o.indexOf(".")>=0,s=o.indexOf("(")>=0;if(a)o=(i=o.split(".")).shift(),i.shift();else if(s){o=(r=o.split("(")).shift();for(var l=0;l<r.length;l++)r[l]=parseInt(r[l].replace(/\)/,""))}if(o===t)return n.info={sid:o,dotSyntax:a,arrSyntax:s,arrIndices:r},n}return null},G.prototype.getChildById=function(t,e){if(this.id===t)return this;if(e)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(t,e);if(n)return n}return null},G.prototype.getChildBySid=function(t,e){if(this.sid===t)return this;if(e)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(t,e);if(n)return n}return null},G.prototype.getTransformBySid=function(t){for(var e=0;e<this.transforms.length;e++)if(this.transforms[e].sid===t)return this.transforms[e];return null},G.prototype.parse=function(t){this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.layer=t.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new n.Matrix4;for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new G).parse(r));break;case"instance_camera":this.cameras.push((new vt).parse(r));break;case"instance_controller":this.controllers.push((new W).parse(r));break;case"instance_geometry":this.geometries.push((new Y).parse(r));break;case"instance_light":this.lights.push((new yt).parse(r));break;case"instance_node":var i=R(r.getAttribute("url").replace(/^#/,""));i&&this.nodes.push((new G).parse(i));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new H).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=function(t){var e=[],r=1e6,n=-1e6;for(var i in m)for(var o=m[i],a=0;a<o.channel.length;a++){var s=o.channel[a],l=o.sampler[a];(i=s.target.split("/")[0])==t.id&&(l.create(),s.sampler=l,r=Math.min(r,l.startTime),n=Math.max(n,l.endTime),e.push(s))}return e.length&&(t.startTime=r,t.endTime=n),e}(this),function(t){if(t.channels&&t.channels.length){for(var e=[],r=[],n=0,i=t.channels.length;n<i;n++){var o,a=t.channels[n],s=a.fullSid,l=a.sampler,c=l.input,u=t.getTransformBySid(a.sid);if(a.arrIndices){o=[];for(var h=0,d=a.arrIndices.length;h<d;h++)o[h]=Rt(a.arrIndices[h])}else o=Dt(a.member);if(u)for(-1===r.indexOf(s)&&r.push(s),h=0,d=c.length;h<d;h++){var p=c[h],f=l.getData(u.type,h,o);if(!(g=D(e,p))){g=new ft(p);var m=F(e,p);e.splice(-1===m?e.length:m,0,g)}g.addTarget(s,u,o,f)}else console.log('Could not find transform "'+a.sid+'" in node '+t.id)}for(n=0;n<r.length;n++){var v=r[n];for(h=0;h<e.length;h++){var g;(g=e[h]).hasTarget(v)||U(e,g,h,v)}}t.keys=e,t.sids=r}}(this),this.updateMatrix(),this},G.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},H.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=Mt(t.textContent),this.convert(),this},H.prototype.convert=function(){switch(this.type){case"matrix":this.obj=It(this.data);break;case"rotate":this.angle=n.Math.degToRad(this.data[3]);case"translate":Nt(this.data,-1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Nt(this.data,1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},H.prototype.apply=function(){var t=new n.Matrix4;return function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}}(),H.prototype.update=function(t,e){var r=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else 2===e.length?this.obj["n"+(e[0]+1)+(e[1]+1)]=t:console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=r[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=r[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=n.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=n.Math.degToRad(t[3])}}},W.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1===r.nodeType)switch(r.nodeName){case"skeleton":this.skeleton.push(r.textContent.replace(/^#/,""));break;case"bind_material":for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new X).parse(o))}}}return this},X.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},Y.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType&&"bind_material"===r.nodeName){for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new X).parse(o))}break}}return this},q.prototype.parse=function(t){this.id=t.getAttribute("id"),Ot(this,t);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"mesh":this.mesh=new J(this).parse(r)}}return this},J.prototype.parse=function(t){this.primitives=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"source":St(r);break;case"vertices":this.vertices=(new et).parse(r);break;case"linestrips":this.primitives.push((new K).parse(r));break;case"triangles":this.primitives.push((new $).parse(r));break;case"polygons":this.primitives.push((new Z).parse(r));break;case"polylist":this.primitives.push((new Q).parse(r))}}if(this.geometry3js=new n.Geometry,null===this.vertices)return this;var i=p[this.vertices.input.POSITION.source].data;for(e=0;e<i.length;e+=3)this.geometry3js.vertices.push(Lt(i,e).clone());for(e=0;e<this.primitives.length;e++){var o=this.primitives[e];o.setVertices(this.vertices),this.handlePrimitive(o,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},J.prototype.handlePrimitive=function(t,e){if(t instanceof K)e.isLineStrip=!0;else{var r,i,o,a,s,l,c,u=t.p,h=t.inputs,d=0,f=3,m=0,v=[];for(r=0;r<h.length;r++){var g=(o=h[r]).offset+1;switch(m=m<g?g:m,o.semantic){case"TEXCOORD":v.push(o.set)}}for(var y=0;y<u.length;++y)for(var x=u[y],b=0;b<x.length;){var w=[],_=[],T=null,M=[];for(f=t.vcount?t.vcount.length?t.vcount[d++]:t.vcount:x.length/m,r=0;r<f;r++)for(i=0;i<h.length;i++)switch(s=(a=x[b+r*m+(o=h[i]).offset])*(c=(l=p[o.source]).accessor.params.length),o.semantic){case"VERTEX":w.push(a);break;case"NORMAL":_.push(Lt(l.data,s));break;case"TEXCOORD":void 0===(T=T||{})[o.set]&&(T[o.set]=[]),T[o.set].push(new n.Vector2(l.data[s],l.data[s+1]));break;case"COLOR":M.push((new n.Color).setRGB(l.data[s],l.data[s+1],l.data[s+2]))}if(0===_.length)if(o=this.vertices.input.NORMAL){c=(l=p[o.source]).accessor.params.length;for(var A=0,E=w.length;A<E;A++)_.push(Lt(l.data,w[A]*c))}else e.calcNormals=!0;if(!T&&(T={},o=this.vertices.input.TEXCOORD))for(v.push(o.set),c=(l=p[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)s=w[A]*c,void 0===T[o.set]&&(T[o.set]=[]),T[o.set].push(new n.Vector2(l.data[s],1-l.data[s+1]));if(0===M.length&&(o=this.vertices.input.COLOR))for(c=(l=p[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)s=w[A]*c,M.push((new n.Color).setRGB(l.data[s],l.data[s+1],l.data[s+2]));var C,P,O=null,N=[];if(3===f)N.push(new n.Face3(w[0],w[1],w[2],_,M.length?M:new n.Color));else if(4===f)N.push(new n.Face3(w[0],w[1],w[3],_.length?[_[0].clone(),_[1].clone(),_[3].clone()]:[],M.length?[M[0],M[1],M[3]]:new n.Color)),N.push(new n.Face3(w[1],w[2],w[3],_.length?[_[1].clone(),_[2].clone(),_[3].clone()]:[],M.length?[M[1],M[2],M[3]]:new n.Color));else if(f>4&&S.subdivideFaces){var L=M.length?M:new n.Color;for(i=1;i<f-1;)N.push(new n.Face3(w[0],w[i],w[i+1],_.length?[_[0].clone(),_[i++].clone(),_[i].clone()]:[],L))}if(N.length)for(A=0,E=N.length;A<E;A++)for((O=N[A]).daeMaterial=t.material,e.faces.push(O),i=0;i<v.length;i++)C=T[v[i]],P=f>4?[C[0],C[A+1],C[A+2]]:4===f?0===A?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],void 0===e.faceVertexUvs[i]&&(e.faceVertexUvs[i]=[]),e.faceVertexUvs[i].push(P);else console.log("dropped face with vcount "+f+" for geometry with id: "+e.id);b+=m*f}}},Z.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source===t.id&&(this.inputs[e].source=t.input.POSITION.source)},Z.prototype.parse=function(t){this.material=t.getAttribute("material"),this.count=Ct(t,"count",0);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"input":this.inputs.push((new rt).parse(t.childNodes[e]));break;case"vcount":this.vcount=At(r.textContent);break;case"p":this.p.push(At(r.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},(Q.prototype=Object.create(Z.prototype)).constructor=Q,(K.prototype=Object.create(Z.prototype)).constructor=K,($.prototype=Object.create(Z.prototype)).constructor=$,tt.prototype.parse=function(t){this.params=[],this.source=t.getAttribute("source"),this.count=Ct(t,"count",0),this.stride=Ct(t,"stride",0);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if("param"===r.nodeName){var n={};n.name=r.getAttribute("name"),n.type=r.getAttribute("type"),this.params.push(n)}}return this},et.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++)if("input"===t.childNodes[e].nodeName){var r=(new rt).parse(t.childNodes[e]);this.input[r.semantic]=r}return this},rt.prototype.parse=function(t){return this.semantic=t.getAttribute("semantic"),this.source=t.getAttribute("source").replace(/^#/,""),this.set=Ct(t,"set",-1),this.offset=Ct(t,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},nt.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"bool_array":this.data=Tt(r.textContent),this.type=r.nodeName;break;case"float_array":this.data=Mt(r.textContent),this.type=r.nodeName;break;case"int_array":this.data=At(r.textContent),this.type=r.nodeName;break;case"IDREF_array":case"Name_array":this.data=Et(r.textContent),this.type=r.nodeName;break;case"technique_common":for(var n=0;n<r.childNodes.length;n++)if("accessor"===r.childNodes[n].nodeName){this.accessor=(new tt).parse(r.childNodes[n]);break}}}return this},nt.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var r=0;r<this.data.length;r+=16){var n=It(this.data.slice(r,r+16));t.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},it.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"===t.childNodes[e].nodeName){this.instance_effect=(new ut).parse(t.childNodes[e]);break}return this},ot.prototype.isColor=function(){return null===this.texture},ot.prototype.isTexture=function(){return null!=this.texture},ot.prototype.parse=function(t){"transparent"===t.nodeName&&(this.opaque=t.getAttribute("opaque"));for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"color":var i=Mt(r.textContent);this.color=new n.Color,this.color.setRGB(i[0],i[1],i[2]),this.color.a=i[3];break;case"texture":this.texture=r.getAttribute("texture"),this.texcoord=r.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(r)}}return this},ot.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&(t=t.childNodes[1]).childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":this.texOpts[r.nodeName]="TRUE"===r.textContent.toUpperCase()?1:parseInt(r.textContent);break;default:this.texOpts[r.nodeName]=r.textContent}}return this},at.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[r.nodeName]=(new ot).parse(r);break;case"bump":var n=r.getAttribute("bumptype");n?"heightfield"===n.toLowerCase()?this.bump=(new ot).parse(r):"normalmap"===n.toLowerCase()?this.normal=(new ot).parse(r):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+n+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new ot).parse(r)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new ot).parse(r));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var i=r.querySelectorAll("float");i.length>0&&(this[r.nodeName]=parseFloat(i[0].textContent))}}return this.create(),this},at.prototype.create=function(){var t={},e=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var r=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;r>0&&(e=!0,t.transparent=!0,t.opacity=1-r)}var i={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var o in this)switch(o){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var a=this[o];if(a instanceof ot)if(a.isTexture()){var l=this.effect.sampler[a.texture];if(void 0!==l&&void 0!==l.source){var c=this.effect.surface[l.source];if(void 0!==c){var u=f[c.init_from];if(u){var h,d=s+u.init_from,p=n.Loader.Handlers.get(d);null!==p?h=p.load(d):Pt(h=new n.Texture,d),h.wrapS=a.texOpts.wrapU?n.RepeatWrapping:n.ClampToEdgeWrapping,h.wrapT=a.texOpts.wrapV?n.RepeatWrapping:n.ClampToEdgeWrapping,h.offset.x=a.texOpts.offsetU,h.offset.y=a.texOpts.offsetV,h.repeat.x=a.texOpts.repeatU,h.repeat.y=a.texOpts.repeatV,t[i[o]]=h,"emission"===o&&(t.emissive=16777215)}}}}else"diffuse"!==o&&e||("emission"===o?t.emissive=a.color.getHex():t[o]=a.color.getHex());break;case"shininess":t[o]=this[o];break;case"reflectivity":t[o]=this[o],t[o]>0&&(t.envMap=S.defaultEnvMap),t.combine=n.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[o],1!==this[o]&&(t.envMap=S.defaultEnvMap)}switch(t.shading=_,t.side=this.effect.doubleSided?n.DoubleSide:n.FrontSide,void 0!==t.diffuse&&(t.color=t.diffuse,delete t.diffuse),this.type){case"constant":void 0!=t.emissive&&(t.color=t.emissive),this.material=new n.MeshBasicMaterial(t);break;case"phong":case"blinn":this.material=new n.MeshPhongMaterial(t);break;case"lambert":default:this.material=new n.MeshLambertMaterial(t)}return this.material},st.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"init_from":this.init_from=r.textContent;break;case"format":this.format=r.textContent;break;default:console.log("unhandled Surface prop: "+r.nodeName)}}return this},lt.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"source":this.source=r.textContent;break;case"minfilter":this.minfilter=r.textContent;break;case"magfilter":this.magfilter=r.textContent;break;case"mipfilter":this.mipfilter=r.textContent;break;case"wrap_s":this.wrap_s=r.textContent;break;case"wrap_t":this.wrap_t=r.textContent;break;default:console.log("unhandled Sampler2D prop: "+r.nodeName)}}return this},ct.prototype.create=function(){if(null===this.shader)return null},ct.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),Ot(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(r))}}return this},ct.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"surface":this.surface[e]=new st(this).parse(n);break;case"sampler2D":this.sampler[e]=new lt(this).parse(n);break;case"extra":break;default:console.log(n.nodeName)}}},ct.prototype.parseProfileCOMMON=function(t){for(var e,r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseProfileCOMMON(n);break;case"technique":e=n;break;case"newparam":this.parseNewparam(n);break;case"image":var i=(new k).parse(n);f[i.id]=i;break;case"extra":break;default:console.log(n.nodeName)}}return e},ct.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new at(r.nodeName,this).parse(r);break;case"extra":this.parseExtra(r)}}},ct.prototype.parseExtra=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"technique":this.parseExtraTechnique(r)}}},ct.prototype.parseExtraTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"bump":this.shader.parse(t)}}},ut.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},ht.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.source={};for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"animation":var n=(new ht).parse(r);for(var i in n.source)this.source[i]=n.source[i];for(var o=0;o<n.channel.length;o++)this.channel.push(n.channel[o]),this.sampler.push(n.sampler[o]);break;case"source":i=(new nt).parse(r),this.source[i.id]=i;break;case"sampler":this.sampler.push(new pt(this).parse(r));break;case"channel":this.channel.push(new dt(this).parse(r))}}return this},dt.prototype.parse=function(t){this.source=t.getAttribute("source").replace(/^#/,""),this.target=t.getAttribute("target");var e=this.target.split("/"),r=(e.shift(),e.shift()),n=r.indexOf(".")>=0,i=r.indexOf("(")>=0;if(n)e=r.split("."),this.sid=e.shift(),this.member=e.shift();else if(i){var o=r.split("(");this.sid=o.shift();for(var a=0;a<o.length;a++)o[a]=parseInt(o[a].replace(/\)/,""));this.arrIndices=o}else this.sid=r;return this.fullSid=r,this.dotSyntax=n,this.arrSyntax=i,this},pt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.inputs=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"input":this.inputs.push((new rt).parse(r))}}return this},pt.prototype.create=function(){for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],r=this.animation.source[e.source];switch(e.semantic){case"INPUT":this.input=r.read();break;case"OUTPUT":this.output=r.read(),this.strideOut=r.accessor.stride;break;case"INTERPOLATION":this.interpolation=r.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(e.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){for(this.startTime=1e8,this.endTime=-1e8,t=0;t<this.input.length;t++)this.startTime=Math.min(this.startTime,this.input[t]),this.endTime=Math.max(this.endTime,this.input[t]);this.duration=this.endTime-this.startTime}},pt.prototype.getData=function(t,e,r){var n;if("matrix"===t&&16===this.strideOut)n=this.output[e];else if(this.strideOut>1){n=[],e*=this.strideOut;for(var i=0;i<this.strideOut;++i)n[i]=this.output[e+i];if(3===this.strideOut)switch(t){case"rotate":case"translate":Nt(n,-1);break;case"scale":Nt(n,1)}else 4===this.strideOut&&"matrix"===t&&Nt(n,-1)}else n=this.output[e],r&&"translate"===t&&(n=function(t,e){if(!0!==S.convertUpAxis||M===S.upAxis)return e;switch(t){case"X":e="XtoY"===A?-1*e:e;break;case"Y":e="YtoZ"===A||"YtoX"===A?-1*e:e;break;case"Z":e="ZtoY"===A?-1*e:e}return e}(r,n));return n},ft.prototype.addTarget=function(t,e,r,n){this.targets.push({sid:t,member:r,transform:e,data:n})},ft.prototype.apply=function(t){for(var e=0;e<this.targets.length;++e){var r=this.targets[e];t&&r.sid!==t||r.transform.update(r.data,r.member)}},ft.prototype.getTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return this.targets[e];return null},ft.prototype.hasTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return!0;return!1},ft.prototype.interpolate=function(t,e){for(var r=0,n=this.targets.length;r<n;r++){var i,o=this.targets[r],a=t.getTarget(o.sid);if("matrix"!==o.transform.type&&a){var s=(e-this.time)/(t.time-this.time),l=a.data,c=o.data;if(s<0&&(s=0),s>1&&(s=1),c.length){i=[];for(var u=0;u<c.length;++u)i[u]=c[u]+(l[u]-c[u])*s}else i=c+(l-c)*s}else i=o.data;o.transform.update(i,o.member)}},mt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"optics":this.parseOptics(r)}}return this},mt.prototype.parseOptics=function(t){for(var e=0;e<t.childNodes.length;e++)if("technique_common"===t.childNodes[e].nodeName)for(var r=t.childNodes[e],n=0;n<r.childNodes.length;n++)if(this.technique=r.childNodes[n].nodeName,"perspective"===this.technique)for(var i=r.childNodes[n],o=0;o<i.childNodes.length;o++)switch((s=i.childNodes[o]).nodeName){case"yfov":this.yfov=s.textContent;break;case"xfov":this.xfov=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}else if("orthographic"===this.technique){var a=r.childNodes[n];for(o=0;o<a.childNodes.length;o++){var s;switch((s=a.childNodes[o]).nodeName){case"xmag":this.xmag=s.textContent;break;case"ymag":this.ymag=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}}}return this},vt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},gt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r);break;case"technique":this.parseTechnique(r)}}return this},gt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++)switch(t.childNodes[e].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=t.childNodes[e].nodeName;for(var r=t.childNodes[e],i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];switch(o.nodeName){case"color":var a=Mt(o.textContent);this.color=new n.Color(0),this.color.setRGB(a[0],a[1],a[2]),this.color.a=a[3];break;case"falloff_angle":this.falloff_angle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);this.distance=s?Math.sqrt(1/s):0}}}return this},gt.prototype.parseTechnique=function(t){this.profile=t.getAttribute("profile");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"intensity":this.intensity=parseFloat(r.textContent)}}return this},yt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},xt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.joints=[],this.links=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r)}}return this},xt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(t.childNodes[e].nodeName){case"joint":this.joints.push((new bt).parse(r));break;case"link":this.links.push((new wt).parse(r))}}return this},bt.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.axis=new n.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var e=Mt(t.querySelector("axis").textContent);this.axis=Lt(e,0);var r=t.querySelector("limits min")?parseFloat(t.querySelector("limits min").textContent):-360,i=t.querySelector("limits max")?parseFloat(t.querySelector("limits max").textContent):360;this.limits={min:r,max:i};for(var o=["prismatic","revolute"],a=0;a<o.length;a++){var s=o[a];t.querySelector(s)&&(this.type=s)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},wt.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.transforms=[],this.attachments=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"attachment_full":this.attachments.push((new _t).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new H).parse(r))}}return this},_t.prototype.parse=function(t){this.joint=t.getAttribute("joint").split("/").pop(),this.links=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"link":this.links.push((new wt).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new H).parse(r))}}return this},{load:function(t,e,r,n){var i=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState?0!==o.status&&200!==o.status||(o.response?(d=e,E(o.response,void 0,t)):n?n():console.error("ColladaLoader: Empty or non-existing file ("+t+")")):3===o.readyState&&r&&(0===i&&(i=o.getResponseHeader("Content-Length")),r({total:i,loaded:o.responseText.length}))},o.open("GET",t,!0),o.send(null)}else alert("Don't know how to parse XML!")},parse:E,setPreferredShading:function(t){_=t},applySkin:L,geometries:g,options:S}}},"3r+V":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r[0]instanceof i.Texture?r[0]:r[0].texture));return o._textures=null,o._durations=null,o.textures=r,o._autoUpdate=!1!==n,o.animationSpeed=1,o.loop=!0,o.onComplete=null,o.onFrameChange=null,o.onLoop=null,o._currentTime=0,o.playing=!1,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&i.ticker.shared.remove(this.update,this))},e.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.HIGH))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){var e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=e/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r?this.onLoop():this.animationSpeed<0&&this.currentFrame>r&&this.onLoop()),this.updateTexture())},e.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this.cachedTint=16777215,this.onFrameChange&&this.onFrameChange(this.currentFrame)},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e)},e.fromFrames=function(t){for(var r=[],n=0;n<t.length;++n)r.push(i.Texture.fromFrame(t[n]));return new e(r)},e.fromImages=function(t){for(var r=[],n=0;n<t.length;++n)r.push(i.Texture.fromImage(t[n]));return new e(r)},n(e,[{key:"totalFrames",get:function(){return this._textures.length}},{key:"textures",get:function(){return this._textures},set:function(t){if(t[0]instanceof i.Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this.gotoAndStop(0),this.updateTexture()}},{key:"currentFrame",get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}}]),e}(i.Sprite);e.default=o},4:function(t,e,r){t.exports=r("zUnb")},"45ci":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.global=new i.Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return t.prototype.getLocalPosition=function(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)},t.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},n(t,[{key:"pointerId",get:function(){return this.identifier}}]),t}();e.default=o},"49sm":function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},"4FaX":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.start=function(){},e.prototype.stop=function(){this.flush()},e.prototype.flush=function(){},e.prototype.render=function(t){},e}(function(t){return t&&t.__esModule?t:{default:t}}(r("Bjwz")).default);e.default=n},"4I2B":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=function(t){return t&&t.__esModule?t:{default:t}}(r("sBhT")),o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=this.renderer,r=e.context,n=t.worldTransform,o=e.resolution;e.roundPixels?r.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o|0,n.ty*o|0):r.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o,n.ty*o),e.context.globalAlpha=t.worldAlpha,e.setBlendMode(t.blendMode),t.drawMode===i.default.DRAW_MODES.TRIANGLE_MESH?this._renderTriangleMesh(t):this._renderTriangles(t)},t.prototype._renderTriangleMesh=function(t){for(var e=t.vertices.length/2,r=0;r<e-2;r++){var n=2*r;this._renderDrawTriangle(t,n,n+2,n+4)}},t.prototype._renderTriangles=function(t){for(var e=t.indices,r=e.length,n=0;n<r;n+=3)this._renderDrawTriangle(t,2*e[n],2*e[n+1],2*e[n+2])},t.prototype._renderDrawTriangle=function(t,e,r,n){var i=this.renderer.context,o=t.uvs,a=t.vertices,s=t._texture;if(s.valid){var l=s.baseTexture,c=l.source,u=l.width,h=l.height,d=void 0,p=void 0,f=void 0,m=void 0,v=void 0,g=void 0;if(t.uploadUvTransform){var y=t._uvTransform.mapCoord;d=(o[e]*y.a+o[e+1]*y.c+y.tx)*l.width,p=(o[r]*y.a+o[r+1]*y.c+y.tx)*l.width,f=(o[n]*y.a+o[n+1]*y.c+y.tx)*l.width,m=(o[e]*y.b+o[e+1]*y.d+y.ty)*l.height,v=(o[r]*y.b+o[r+1]*y.d+y.ty)*l.height,g=(o[n]*y.b+o[n+1]*y.d+y.ty)*l.height}else d=o[e]*l.width,p=o[r]*l.width,f=o[n]*l.width,m=o[e+1]*l.height,v=o[r+1]*l.height,g=o[n+1]*l.height;var x=a[e],b=a[r],w=a[n],_=a[e+1],S=a[r+1],T=a[n+1],M=t.canvasPadding/this.renderer.resolution;if(M>0){var A=M/Math.abs(t.worldTransform.a),E=M/Math.abs(t.worldTransform.d),C=(x+b+w)/3,P=(_+S+T)/3,O=x-C,N=_-P,L=Math.sqrt(O*O+N*N);x=C+O/L*(L+A),_=P+N/L*(L+E),N=S-P,b=C+(O=b-C)/(L=Math.sqrt(O*O+N*N))*(L+A),S=P+N/L*(L+E),N=T-P,w=C+(O=w-C)/(L=Math.sqrt(O*O+N*N))*(L+A),T=P+N/L*(L+E)}i.save(),i.beginPath(),i.moveTo(x,_),i.lineTo(b,S),i.lineTo(w,T),i.closePath(),i.clip();var I=d*v+m*f+p*g-v*f-m*p-d*g;i.transform((x*v+m*w+b*g-v*w-m*b-x*g)/I,(_*v+m*T+S*g-v*T-m*S-_*g)/I,(d*b+x*f+p*w-b*f-x*p-d*w)/I,(d*S+_*f+p*T-S*f-_*p-d*T)/I,(d*v*w+m*b*f+x*p*g-x*v*f-m*p*w-d*b*g)/I,(d*v*T+m*S*f+_*p*g-_*v*f-m*p*T-d*S*g)/I),i.drawImage(c,0,0,u*l.resolution,h*l.resolution,0,0,u,h),i.restore(),this.renderer.invalidateBlendMode()}},t.prototype.renderMeshFlat=function(t){var e=this.renderer.context,r=t.vertices,n=r.length/2;e.beginPath();for(var i=1;i<n-2;++i){var o=2*i,a=r[o+2],s=r[o+3],l=r[o+4],c=r[o+5];e.moveTo(r[o],r[o+1]),e.lineTo(a,s),e.lineTo(l,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},t.prototype.destroy=function(){this.renderer=null},t}();e.default=o,n.CanvasRenderer.registerPlugin("mesh",o)},"4fju":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(r("+HqX")),o=new i.default,a=function(){function t(e,r){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._texture=e,this.mapCoord=new i.default,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._lastTextureID=-1,this.clampOffset=0,this.clampMargin=void 0===r?.5:r}return t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var r=this.mapCoord,n=0;n<t.length;n+=2){var i=t[n],o=t[n+1];e[n]=i*r.a+o*r.c+r.tx,e[n+1]=i*r.b+o*r.d+r.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._lastTextureID===e._updateID)return!1;this._lastTextureID=e._updateID;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=e.orig,i=e.trim;i&&(o.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(o));var a=e.baseTexture,s=this.uClampFrame,l=this.clampMargin/a.resolution,c=this.clampOffset;return s[0]=(e._frame.x+l+c)/a.width,s[1]=(e._frame.y+l+c)/a.height,s[2]=(e._frame.x+e._frame.width-l+c)/a.width,s[3]=(e._frame.y+e._frame.height-l+c)/a.height,this.uClampOffset[0]=c/a.realWidth,this.uClampOffset[1]=c/a.realHeight,!0},n(t,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._lastTextureID=-1}}]),t}();e.default=a},"4miC":function(t,e,r){"use strict";e.__esModule=!0,e.default={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0}},"4o2V":function(t,e,r){"use strict";e.__esModule=!0;var n=p(r("4FaX")),i=p(r("pV5o")),o=p(r("TyRm")),a=p(r("xD7H")),s=p(r("TRZq")),l=p(r("3LRy")),c=p(r("Yd/J")),u=r("qp2T"),h=p(r("yI/K")),d=p(r("pIo5"));function p(t){return t&&t.__esModule?t:{default:t}}var f=0,m=0,v=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));n.vertSize=5,n.vertByteSize=4*n.vertSize,n.size=c.default.SPRITE_BATCH_SIZE,n.buffers=[];for(var i=1;i<=d.default.nextPow2(n.size);i*=2)n.buffers.push(new l.default(4*i*n.vertByteSize));n.indices=(0,o.default)(n.size),n.shader=null,n.currentIndex=0,n.groups=[];for(var a=0;a<n.size;a++)n.groups[a]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};return n.sprites=[],n.vertexBuffers=[],n.vaos=[],n.vaoMax=2,n.vertexCount=0,n.renderer.on("prerender",n.onPrerender,n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.renderer.legacy?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c.default.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=(0,s.default)(this.MAX_TEXTURES,t)),this.shader=(0,a.default)(t,this.MAX_TEXTURES),this.indexBuffer=h.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.renderer.bindVao(null);for(var e=this.shader.attributes,r=0;r<this.vaoMax;r++){var n=this.vertexBuffers[r]=h.default.GLBuffer.createVertexBuffer(t,null,t.STREAM_DRAW),i=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(n,e.aVertexPosition,t.FLOAT,!1,this.vertByteSize,0).addAttribute(n,e.aTextureCoord,t.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(n,e.aColor,t.UNSIGNED_BYTE,!0,this.vertByteSize,12);e.aTextureId&&i.addAttribute(n,e.aTextureId,t.FLOAT,!1,this.vertByteSize,16),this.vaos[r]=i}this.vao=this.vaos[0],this.currentBlendMode=99999,this.boundTextures=new Array(this.MAX_TEXTURES)},e.prototype.onPrerender=function(){this.vertexCount=0},e.prototype.render=function(t){this.currentIndex>=this.size&&this.flush(),t._texture._uvs&&(this.sprites[this.currentIndex++]=t)},e.prototype.flush=function(){if(0!==this.currentIndex){var t=this.renderer.gl,e=this.MAX_TEXTURES,r=d.default.nextPow2(this.currentIndex),n=d.default.log2(r),i=this.buffers[n],o=this.sprites,a=this.groups,s=i.float32View,l=i.uint32View,p=this.boundTextures,v=this.renderer.boundTextures,g=this.renderer.textureGC.count,y=0,x=void 0,b=void 0,w=1,_=0,S=a[0],T=void 0,M=void 0,A=u.premultiplyBlendMode[o[0]._texture.baseTexture.premultipliedAlpha?1:0][o[0].blendMode];S.textureCount=0,S.start=0,S.blend=A,f++;var E=void 0;for(E=0;E<e;++E){var C=v[E];C._enabled!==f?(p[E]=C,C._virtalBoundId=E,C._enabled=f):p[E]=this.renderer.emptyTextures[E]}for(f++,E=0;E<this.currentIndex;++E){var P=o[E];x=P._texture.baseTexture;var O=u.premultiplyBlendMode[Number(x.premultipliedAlpha)][P.blendMode];if(A!==O&&(A=O,b=null,_=e,f++),b!==x&&(b=x,x._enabled!==f)){if(_===e&&(f++,S.size=E-S.start,_=0,(S=a[w++]).blend=A,S.textureCount=0,S.start=E),x.touched=g,-1===x._virtalBoundId)for(var N=0;N<e;++N){var L=(N+m)%e,I=p[L];if(I._enabled!==f){m++,I._virtalBoundId=-1,x._virtalBoundId=L,p[L]=x;break}}x._enabled=f,S.textureCount++,S.ids[_]=x._virtalBoundId,S.textures[_++]=x}if(T=P.vertexData,M=P._texture._uvs.uvsUint32,this.renderer.roundPixels){var R=this.renderer.resolution;s[y]=(T[0]*R|0)/R,s[y+1]=(T[1]*R|0)/R,s[y+5]=(T[2]*R|0)/R,s[y+6]=(T[3]*R|0)/R,s[y+10]=(T[4]*R|0)/R,s[y+11]=(T[5]*R|0)/R,s[y+15]=(T[6]*R|0)/R,s[y+16]=(T[7]*R|0)/R}else s[y]=T[0],s[y+1]=T[1],s[y+5]=T[2],s[y+6]=T[3],s[y+10]=T[4],s[y+11]=T[5],s[y+15]=T[6],s[y+16]=T[7];l[y+2]=M[0],l[y+7]=M[1],l[y+12]=M[2],l[y+17]=M[3];var D=Math.min(P.worldAlpha,1),F=D<1&&x.premultipliedAlpha?(0,u.premultiplyTint)(P._tintRGB,D):P._tintRGB+(255*D<<24);l[y+3]=l[y+8]=l[y+13]=l[y+18]=F,s[y+4]=s[y+9]=s[y+14]=s[y+19]=x._virtalBoundId,y+=20}if(S.size=E-S.start,c.default.CAN_UPLOAD_SAME_BUFFER)this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!0);else{if(this.vaoMax<=this.vertexCount){this.vaoMax++;var U=this.shader.attributes,k=this.vertexBuffers[this.vertexCount]=h.default.GLBuffer.createVertexBuffer(t,null,t.STREAM_DRAW),B=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(k,U.aVertexPosition,t.FLOAT,!1,this.vertByteSize,0).addAttribute(k,U.aTextureCoord,t.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(k,U.aColor,t.UNSIGNED_BYTE,!0,this.vertByteSize,12);U.aTextureId&&B.addAttribute(k,U.aTextureId,t.FLOAT,!1,this.vertByteSize,16),this.vaos[this.vertexCount]=B}this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!1),this.vertexCount++}for(E=0;E<e;++E)v[E]._virtalBoundId=-1;for(E=0;E<w;++E){for(var j=a[E],z=j.textureCount,V=0;V<z;V++)v[j.ids[V]]!==(b=j.textures[V])&&this.renderer.bindTexture(b,j.ids[V],!0),b._virtalBoundId=-1;this.renderer.state.setBlendMode(j.blend),t.drawElements(t.TRIANGLES,6*j.size,t.UNSIGNED_SHORT,6*j.start*2)}this.currentIndex=0}},e.prototype.start=function(){this.renderer.bindShader(this.shader),c.default.CAN_UPLOAD_SAME_BUFFER&&(this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].bind())},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this.vaoMax;e++)this.vertexBuffers[e]&&this.vertexBuffers[e].destroy(),this.vaos[e]&&this.vaos[e].destroy();this.indexBuffer&&this.indexBuffer.destroy(),this.renderer.off("prerender",this.onPrerender,this),t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null;for(var r=0;r<this.buffers.length;++r)this.buffers[r].destroy()},e}(n.default);e.default=v,i.default.registerPlugin("sprite",v)},"5OzF":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){t.nativeLines?function(t,e){var n=0,o=t.points;if(0!==o.length){var a=r.points,s=o.length/2,l=(0,i.hex2rgb)(t.lineColor),c=t.lineAlpha,u=l[0]*c,h=l[1]*c,d=l[2]*c;for(n=1;n<s;n++){var p=o[2*n],f=o[2*n+1];a.push(o[2*(n-1)],o[2*(n-1)+1]),a.push(u,h,d,c),a.push(p,f),a.push(u,h,d,c)}}}(t):function(t,e){var r=t.points;if(0!==r.length){var o=new n.Point(r[0],r[1]),a=new n.Point(r[r.length-2],r[r.length-1]);if(o.x===a.x&&o.y===a.y){(r=r.slice()).pop(),r.pop();var s=(a=new n.Point(r[r.length-2],r[r.length-1])).x+.5*(o.x-a.x),l=a.y+.5*(o.y-a.y);r.unshift(s,l),r.push(s,l)}var c=e.points,u=e.indices,h=r.length/2,d=r.length,p=c.length/6,f=t.lineWidth/2,m=(0,i.hex2rgb)(t.lineColor),v=t.lineAlpha,g=m[0]*v,y=m[1]*v,x=m[2]*v,b=r[0],w=r[1],_=r[2],S=r[3],T=0,M=0,A=-(w-S),E=b-_,C=0,P=0,O=0,N=0,L=Math.sqrt(A*A+E*E);A/=L,E/=L,c.push(b-(A*=f),w-(E*=f),g,y,x,v),c.push(b+A,w+E,g,y,x,v);for(var I=1;I<h-1;++I){T=r[2*(I+1)],M=r[2*(I+1)+1],A=-((w=r[2*(I-1)+1])-(S=r[2*I+1])),E=(b=r[2*(I-1)])-(_=r[2*I]),A/=L=Math.sqrt(A*A+E*E),E/=L,A*=f,E*=f,C=-(S-M),P=_-T,C/=L=Math.sqrt(C*C+P*P),P/=L;var R=-E+w-(-E+S),D=-A+_-(-A+b),F=(-A+b)*(-E+S)-(-A+_)*(-E+w),U=-(P*=f)+M-(-P+S),k=-(C*=f)+_-(-C+T),B=(-C+T)*(-P+S)-(-C+_)*(-P+M),j=R*k-U*D;if(Math.abs(j)<.1)j+=10.1,c.push(_-A,S-E,g,y,x,v),c.push(_+A,S+E,g,y,x,v);else{var z=(D*B-k*F)/j,V=(U*F-R*B)/j;(z-_)*(z-_)+(V-S)*(V-S)>196*f*f?(O=A-C,N=E-P,O/=L=Math.sqrt(O*O+N*N),N/=L,c.push(_-(O*=f),S-(N*=f)),c.push(g,y,x,v),c.push(_+O,S+N),c.push(g,y,x,v),c.push(_-O,S-N),c.push(g,y,x,v),d++):(c.push(z,V),c.push(g,y,x,v),c.push(_-(z-_),S-(V-S)),c.push(g,y,x,v))}}A=-((w=r[2*(h-2)+1])-(S=r[2*(h-1)+1])),E=(b=r[2*(h-2)])-(_=r[2*(h-1)]),A/=L=Math.sqrt(A*A+E*E),E/=L,c.push(_-(A*=f),S-(E*=f)),c.push(g,y,x,v),c.push(_+A,S+E),c.push(g,y,x,v),u.push(p);for(var G=0;G<d;++G)u.push(p++);u.push(p-1)}}(t,e)};var n=r("d07J"),i=r("qp2T")},"5dPP":function(t,e,r){"use strict";e.__esModule=!0;var n=f(r("a/Ns")),i=f(r("eIHw")),o=f(r("xJsK")),a=f(r("APSF")),s=f(r("jQCb")),l=r("d07J"),c=r("qp2T"),u=r("pQYt"),h=f(r("sAjT")),d=f(r("jE0j")),p=f(r("pVcz"));function f(t){return t&&t.__esModule?t:{default:t}}var m=void 0,v=new l.Matrix,g=new l.Point,y=new Float32Array(4),x=new Float32Array(4),b=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n.fillAlpha=1,n.lineWidth=0,n.nativeLines=r,n.lineColor=0,n.graphicsData=[],n.tint=16777215,n._prevTint=16777215,n.blendMode=u.BLEND_MODES.NORMAL,n.currentPath=null,n._webGL={},n.isMask=!1,n.boundsPadding=0,n._localBounds=new h.default,n.dirty=0,n.fastRectDirty=-1,n.clearDirty=0,n.boundsDirty=-1,n.cachedSpriteDirty=!1,n._spriteRect=null,n._fastRect=!1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.clone=function(){var t=new e;t.renderable=this.renderable,t.fillAlpha=this.fillAlpha,t.lineWidth=this.lineWidth,t.lineColor=this.lineColor,t.tint=this.tint,t.blendMode=this.blendMode,t.isMask=this.isMask,t.boundsPadding=this.boundsPadding,t.dirty=0,t.cachedSpriteDirty=this.cachedSpriteDirty;for(var r=0;r<this.graphicsData.length;++r)t.graphicsData.push(this.graphicsData[r].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t.updateLocalBounds(),t},e.prototype.lineStyle=function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.lineWidth=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this.lineColor=t,this.lineAlpha=e,this.currentPath)if(this.currentPath.shape.points.length){var r=new l.Polygon(this.currentPath.shape.points.slice(-2));r.closed=!1,this.drawShape(r)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},e.prototype.moveTo=function(t,e){var r=new l.Polygon([t,e]);return r.closed=!1,this.drawShape(r),this},e.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty++,this},e.prototype.quadraticCurveTo=function(t,e,r,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var i=this.currentPath.shape.points,o=0,a=0;0===i.length&&this.moveTo(0,0);for(var s=i[i.length-2],l=i[i.length-1],c=1;c<=20;++c){var u=c/20;i.push((o=s+(t-s)*u)+(t+(r-t)*u-o)*u,(a=l+(e-l)*u)+(e+(n-e)*u-a)*u)}return this.dirty++,this},e.prototype.bezierCurveTo=function(t,e,r,n,i,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var a=this.currentPath.shape.points,s=a[a.length-2],l=a[a.length-1];return a.length-=2,(0,d.default)(s,l,t,e,r,n,i,o,a),this.dirty++,this},e.prototype.arcTo=function(t,e,r,n,i){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var o=this.currentPath.shape.points,a=o[o.length-1]-e,s=o[o.length-2]-t,l=n-e,c=r-t,u=Math.abs(a*c-s*l);if(u<1e-8||0===i)o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e);else{var h=a*a+s*s,d=l*l+c*c,p=a*l+s*c,f=i*Math.sqrt(h)/u,m=i*Math.sqrt(d)/u,v=f*p/h,g=m*p/d,y=f*c+m*s,x=f*l+m*a,b=c*(f+g),w=l*(f+g),_=Math.atan2(a*(m+v)-x,s*(m+v)-y),S=Math.atan2(w-x,b-y);this.arc(y+t,x+e,i,_,S,s*l>c*a)}return this.dirty++,this},e.prototype.arc=function(t,e,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(n===i)return this;!o&&i<=n?i+=u.PI_2:o&&n<=i&&(n+=u.PI_2);var a=i-n,s=40*Math.ceil(Math.abs(a)/u.PI_2);if(0===a)return this;var l=t+Math.cos(n)*r,c=e+Math.sin(n)*r,h=this.currentPath?this.currentPath.shape.points:null;h?h[h.length-2]===l&&h[h.length-1]===c||h.push(l,c):(this.moveTo(l,c),h=this.currentPath.shape.points);for(var d=a/(2*s),p=2*d,f=Math.cos(d),m=Math.sin(d),v=s-1,g=v%1/v,y=0;y<=v;++y){var x=d+n+p*(y+g*y),b=Math.cos(x),w=-Math.sin(x);h.push((f*b+m*w)*r+t,(f*-w+m*b)*r+e)}return this.dirty++,this},e.prototype.beginFill=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.filling=!0,this.fillColor=t,this.fillAlpha=e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},e.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},e.prototype.drawRect=function(t,e,r,n){return this.drawShape(new l.Rectangle(t,e,r,n)),this},e.prototype.drawRoundedRect=function(t,e,r,n,i){return this.drawShape(new l.RoundedRectangle(t,e,r,n,i)),this},e.prototype.drawCircle=function(t,e,r){return this.drawShape(new l.Circle(t,e,r)),this},e.prototype.drawEllipse=function(t,e,r,n){return this.drawShape(new l.Ellipse(t,e,r,n)),this},e.prototype.drawPolygon=function(t){var e=t,r=!0;if(e instanceof l.Polygon&&(r=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(var n=0;n<e.length;++n)e[n]=arguments[n]}var i=new l.Polygon(e);return i.closed=r,this.drawShape(i),this},e.prototype.drawStar=function(t,e,r,n,i){i=i||n/2;for(var o=-1*Math.PI/2+(arguments.length>5&&void 0!==arguments[5]?arguments[5]:0),a=2*r,s=u.PI_2/a,l=[],c=0;c<a;c++){var h=c%2?i:n,d=c*s+o;l.push(t+h*Math.cos(d),e+h*Math.sin(d))}return this.drawPolygon(l)},e.prototype.clear=function(){return(this.lineWidth||this.filling||this.graphicsData.length>0)&&(this.lineWidth=0,this.filling=!1,this.boundsDirty=-1,this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this._spriteRect=null,this},e.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===u.SHAPES.RECT&&!this.graphicsData[0].lineWidth},e.prototype._renderWebGL=function(t){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect()),this._fastRect?this._renderSpriteRect(t):(t.setObjectRenderer(t.plugins.graphics),t.plugins.graphics.render(this))},e.prototype._renderSpriteRect=function(t){var e=this.graphicsData[0].shape;this._spriteRect||(this._spriteRect=new s.default(new o.default(o.default.WHITE)));var r=this._spriteRect;if(16777215===this.tint)r.tint=this.graphicsData[0].fillColor;else{var n=y,i=x;(0,c.hex2rgb)(this.graphicsData[0].fillColor,n),(0,c.hex2rgb)(this.tint,i),n[0]*=i[0],n[1]*=i[1],n[2]*=i[2],r.tint=(0,c.rgb2hex)(n)}r.alpha=this.graphicsData[0].fillAlpha,r.worldAlpha=this.worldAlpha*r.alpha,r.blendMode=this.blendMode,r._texture._frame.width=e.width,r._texture._frame.height=e.height,r.transform.worldTransform=this.transform.worldTransform,r.anchor.set(-e.x/e.width,-e.y/e.height),r._onAnchorUpdate(),r._renderWebGL(t)},e.prototype._renderCanvas=function(t){!0!==this.isMask&&t.plugins.graphics.render(this)},e.prototype._calculateBounds=function(){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.cachedSpriteDirty=!0);var t=this._localBounds;this._bounds.addFrame(this.transform,t.minX,t.minY,t.maxX,t.maxY)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,g);for(var e=this.graphicsData,r=0;r<e.length;++r){var n=e[r];if(n.fill&&n.shape&&n.shape.contains(g.x,g.y)){if(n.holes)for(var i=0;i<n.holes.length;i++)if(n.holes[i].contains(g.x,g.y))return!1;return!0}}return!1},e.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,r=1/0,n=-1/0;if(this.graphicsData.length)for(var i=0,o=0,a=0,s=0,l=0,c=0;c<this.graphicsData.length;c++){var h=this.graphicsData[c],d=h.type,p=h.lineWidth;if(i=h.shape,d===u.SHAPES.RECT||d===u.SHAPES.RREC)a=i.y-p/2,s=i.width+p,l=i.height+p,t=(o=i.x-p/2)<t?o:t,e=o+s>e?o+s:e,r=a<r?a:r,n=a+l>n?a+l:n;else if(d===u.SHAPES.CIRC)a=i.y,l=i.radius+p/2,t=(o=i.x)-(s=i.radius+p/2)<t?o-s:t,e=o+s>e?o+s:e,r=a-l<r?a-l:r,n=a+l>n?a+l:n;else if(d===u.SHAPES.ELIP)a=i.y,l=i.height+p/2,t=(o=i.x)-(s=i.width+p/2)<t?o-s:t,e=o+s>e?o+s:e,r=a-l<r?a-l:r,n=a+l>n?a+l:n;else for(var f=i.points,m=0,v=0,g=0,y=0,x=0,b=0,w=0,_=0,S=0;S+2<f.length;S+=2)o=f[S],a=f[S+1],m=f[S+2],v=f[S+3],g=Math.abs(m-o),y=Math.abs(v-a),l=p,(s=Math.sqrt(g*g+y*y))<1e-9||(b=(l/s*g+y)/2,_=(v+a)/2,t=(w=(m+o)/2)-(x=(l/s*y+g)/2)<t?w-x:t,e=w+x>e?w+x:e,r=_-b<r?_-b:r,n=_+b>n?_+b:n)}else t=0,e=0,r=0,n=0;var T=this.boundsPadding;this._localBounds.minX=t-T,this._localBounds.maxX=e+T,this._localBounds.minY=r-T,this._localBounds.maxY=n+T},e.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new a.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,t);return this.graphicsData.push(e),e.type===u.SHAPES.POLY&&(e.shape.closed=e.shape.closed||this.filling,this.currentPath=e),this.dirty++,e},e.prototype.generateCanvasTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=this.getLocalBounds(),n=i.default.create(r.width,r.height,t,e);m||(m=new p.default),this.transform.updateLocalTransform(),this.transform.localTransform.copy(v),v.invert(),v.tx-=r.x,v.ty-=r.y,m.render(this,n,!0,v);var a=o.default.fromCanvas(n.baseTexture._canvasRenderTarget.canvas,t,"graphics");return a.baseTexture.resolution=e,a.baseTexture.update(),a},e.prototype.closePath=function(){var t=this.currentPath;return t&&t.shape&&t.shape.close(),this},e.prototype.addHole=function(){var t=this.graphicsData.pop();return this.currentPath=this.graphicsData[this.graphicsData.length-1],this.currentPath.addHole(t.shape),this.currentPath=null,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e);for(var r=0;r<this.graphicsData.length;++r)this.graphicsData[r].destroy();for(var n in this._webgl)for(var i=0;i<this._webgl[n].data.length;++i)this._webgl[n].data[i].destroy();this._spriteRect&&this._spriteRect.destroy(),this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null},e}(n.default);e.default=b,b._SPRITE_TEXTURE=null},"5ekA":function(t,e,r){"use strict";e.__esModule=!0;var n=r("Tt2x");Object.defineProperty(e,"webgl",{enumerable:!0,get:function(){return o(n).default}});var i=r("26zZ");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"canvas",{enumerable:!0,get:function(){return o(i).default}})},"6MUB":function(t,e,r){"use strict";var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,r,i){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(i){var o=encodeURIComponent(n(i))+r;return Array.isArray(t[i])?t[i].map(function(t){return o+encodeURIComponent(n(t))}).join(e):o+encodeURIComponent(n(t[i]))}).join(e):i?encodeURIComponent(n(i))+r+encodeURIComponent(n(t)):""}},"7AYe":function(t,e,r){var n=r("koBt"),i=r("ujOt"),o=function(t,e,r,n){gl.vertexAttribPointer(this.location,this.size,t||gl.FLOAT,e||!1,r||0,n||0)};t.exports=function(t,e){for(var r={},a=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s=0;s<a;s++){var l=t.getActiveAttrib(e,s),c=n(t,l.type);r[l.name]={type:c,size:i(c),location:t.getAttribLocation(e,l.name),pointer:o}}return r}},"7JTu":function(t,e,r){"use strict";e.__esModule=!0;var n=r("qp2T"),i=r("pQYt"),o=p(r("4FaX")),a=p(r("pV5o")),s=p(r("fOGm")),l=p(r("DuEz")),c=p(r("KvbZ")),u=p(r("MjLO")),h=p(r("yY4z")),d=p(r("aq8N"));function p(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.graphicsDataPool=[],n.primitiveShader=null,n.gl=r.gl,n.CONTEXT_UID=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.primitiveShader=new l.default(this.gl)},e.prototype.destroy=function(){o.default.prototype.destroy.call(this);for(var t=0;t<this.graphicsDataPool.length;++t)this.graphicsDataPool[t].destroy();this.graphicsDataPool=null},e.prototype.render=function(t){var e=this.renderer,r=e.gl,i=void 0,o=t._webGL[this.CONTEXT_UID];o&&t.dirty===o.dirty||(this.updateGraphics(t),o=t._webGL[this.CONTEXT_UID]),e.bindShader(this.primitiveShader),e.state.setBlendMode(t.blendMode);for(var a=0,s=o.data.length;a<s;a++){var l=(i=o.data[a]).shader;e.bindShader(l),l.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),l.uniforms.tint=(0,n.hex2rgb)(t.tint),l.uniforms.alpha=t.worldAlpha,e.bindVao(i.vao),i.nativeLines?r.drawArrays(r.LINES,0,i.points.length/6):i.vao.draw(r.TRIANGLE_STRIP,i.indices.length)}},e.prototype.updateGraphics=function(t){var e=t._webGL[this.CONTEXT_UID];if(e||(e=t._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:this.renderer.gl,clearDirty:-1,dirty:-1}),e.dirty=t.dirty,t.clearDirty!==e.clearDirty){e.clearDirty=t.clearDirty;for(var r=0;r<e.data.length;r++)this.graphicsDataPool.push(e.data[r]);e.data.length=0,e.lastIndex=0}for(var n=void 0,o=void 0,a=e.lastIndex;a<t.graphicsData.length;a++){var s=t.graphicsData[a];n=this.getWebGLData(e,0),s.nativeLines&&s.lineWidth&&(o=this.getWebGLData(e,0,!0),e.lastIndex++),s.type===i.SHAPES.POLY&&(0,c.default)(s,n,o),s.type===i.SHAPES.RECT?(0,u.default)(s,n,o):s.type===i.SHAPES.CIRC||s.type===i.SHAPES.ELIP?(0,d.default)(s,n,o):s.type===i.SHAPES.RREC&&(0,h.default)(s,n,o),e.lastIndex++}this.renderer.bindVao(null);for(var l=0;l<e.data.length;l++)(n=e.data[l]).dirty&&n.upload()},e.prototype.getWebGLData=function(t,e,r){var n=t.data[t.data.length-1];return(!n||n.nativeLines!==r||n.points.length>32e4)&&((n=this.graphicsDataPool.pop()||new s.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState)).nativeLines=r,n.reset(e),t.data.push(n)),n.dirty=!0,n},e}(o.default);e.default=f,a.default.registerPlugin("graphics",f)},"7jRU":function(t,e){var r=[].indexOf;t.exports=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}},"8WrO":function(t,e,r){"use strict";e.__esModule=!0;var n=r("d07J"),i=r("pQYt"),o=function(t){return t&&t.__esModule?t:{default:t}}(r("Yd/J")),a=r("yI/K"),s=function(){function t(e,r,s,l,c,u){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.frameBuffer=null,this.texture=null,this.clearColor=[0,0,0,0],this.size=new n.Rectangle(0,0,1,1),this.resolution=c||o.default.RESOLUTION,this.projectionMatrix=new n.Matrix,this.transform=null,this.frame=null,this.defaultFrame=new n.Rectangle,this.destinationFrame=null,this.sourceFrame=null,this.stencilBuffer=null,this.stencilMaskStack=[],this.filterData=null,this.scaleMode=void 0!==l?l:o.default.SCALE_MODE,this.root=u,this.root?(this.frameBuffer=new a.GLFramebuffer(e,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=a.GLFramebuffer.createRGBA(e,100,100),this.scaleMode===i.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture),this.setFrame(),this.resize(r,s)}return t.prototype.clear=function(t){var e=t||this.clearColor;this.frameBuffer.clear(e[0],e[1],e[2],e[3])},t.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()},t.prototype.setFrame=function(t,e){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||this.destinationFrame},t.prototype.activate=function(){var t=this.gl;this.frameBuffer.bind(),this.calculateProjection(this.destinationFrame,this.sourceFrame),this.transform&&this.projectionMatrix.append(this.transform),this.destinationFrame!==this.sourceFrame?(t.enable(t.SCISSOR_TEST),t.scissor(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):t.disable(t.SCISSOR_TEST),t.viewport(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)},t.prototype.calculateProjection=function(t,e){var r=this.projectionMatrix;e=e||t,r.identity(),this.root?(r.a=1/t.width*2,r.d=-1/t.height*2,r.tx=-1-e.x*r.a,r.ty=1-e.y*r.d):(r.a=1/t.width*2,r.d=1/t.height*2,r.tx=-1-e.x*r.a,r.ty=-1-e.y*r.d)},t.prototype.resize=function(t,e){e|=0,(this.size.width!==(t|=0)||this.size.height!==e)&&(this.size.width=t,this.size.height=e,this.defaultFrame.width=t,this.defaultFrame.height=e,this.frameBuffer.resize(t*this.resolution,e*this.resolution),this.calculateProjection(this.frame||this.size))},t.prototype.destroy=function(){this.frameBuffer.destroy(),this.frameBuffer=null,this.texture=null},t}();e.default=s},"8eTQ":function(t,e,r){"use strict";var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN"));n.DisplayObject.prototype.getGlobalPosition=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n.Point;return this.parent?this.parent.toGlobal(this.position,t,arguments.length>1&&void 0!==arguments[1]&&arguments[1]):(t.x=this.position.x,t.y=this.position.y),t}},"8g3p":function(t,e,r){"use strict";e.__esModule=!0,e.Ticker=e.shared=void 0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("NO7c")),i=new n.default;i.autoStart=!0,i.destroy=function(){},e.shared=i,e.Ticker=n.default},"963y":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("/zO6")),i=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsUint32=new Uint32Array(4)}return t.prototype.set=function(t,e,r){var i=e.width,o=e.height;if(r){var a=t.width/2/i,s=t.height/2/o,l=t.x/i+a,c=t.y/o+s;r=n.default.add(r,n.default.NW),this.x0=l+a*n.default.uX(r),this.y0=c+s*n.default.uY(r),r=n.default.add(r,2),this.x1=l+a*n.default.uX(r),this.y1=c+s*n.default.uY(r),r=n.default.add(r,2),this.x2=l+a*n.default.uX(r),this.y2=c+s*n.default.uY(r),r=n.default.add(r,2),this.x3=l+a*n.default.uX(r),this.y3=c+s*n.default.uY(r)}else this.x0=t.x/i,this.y0=t.y/o,this.x1=(t.x+t.width)/i,this.y1=t.y/o,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/o,this.x3=t.x/i,this.y3=(t.y+t.height)/o;this.uvsUint32[0]=(65535*this.y0&65535)<<16|65535*this.x0&65535,this.uvsUint32[1]=(65535*this.y1&65535)<<16|65535*this.x1&65535,this.uvsUint32[2]=(65535*this.y2&65535)<<16|65535*this.x2&65535,this.uvsUint32[3]=(65535*this.y3&65535)<<16|65535*this.x3&65535},t}();e.default=i},"984s":function(t,e,r){var n=r("koBt"),i=r("rI9z");t.exports=function(t,e){for(var r={},o=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),a=0;a<o;a++){var s=t.getActiveUniform(e,a),l=s.name.replace(/\[.*?\]/,""),c=n(t,s.type);r[l]={type:c,size:s.size,location:t.getUniformLocation(e,l),value:i(c,s.size)}}return r}},"9I6j":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}},"9PbN":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("Bjwz")),i=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.stencilMaskStack=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setMaskStack=function(t){this.stencilMaskStack=t;var e=this.renderer.gl;0===t.length?e.disable(e.STENCIL_TEST):e.enable(e.STENCIL_TEST)},e.prototype.pushStencil=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.renderer._activeRenderTarget.attachStencilBuffer();var e=this.renderer.gl,r=this.stencilMaskStack.length;0===r&&e.enable(e.STENCIL_TEST),this.stencilMaskStack.push(t),e.colorMask(!1,!1,!1,!1),e.stencilFunc(e.EQUAL,r,this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.INCR),this.renderer.plugins.graphics.render(t),this._useCurrent()},e.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var t=this.renderer.gl,e=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(t.disable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(0)):(t.colorMask(!1,!1,!1,!1),t.stencilOp(t.KEEP,t.KEEP,t.DECR),this.renderer.plugins.graphics.render(e),this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},e.prototype.destroy=function(){n.default.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},e}(n.default);e.default=i},"9a93":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(r){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   vec2 v = vec2(x, y);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  gl_FragColor = color;","}"].join("\n")))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("N0WC")).default);e.default=n},APSF:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e,r,n,i,o,a,s,l){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.lineWidth=e,this.nativeLines=s,this.lineColor=r,this.lineAlpha=n,this._lineTint=r,this.fillColor=i,this.fillAlpha=o,this._fillTint=i,this.fill=a,this.holes=[],this.shape=l,this.type=l.type}return t.prototype.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape)},t.prototype.addHole=function(t){this.holes.push(t)},t.prototype.destroy=function(){this.shape=null,this.holes=null},t}();e.default=n},ASAs:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=l(r("c/UO")),a=l(r("p6KW")),s=l(r("FLfE"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r,n,s,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=(0,o.default)(l=l||5,!1),u=(0,a.default)(l),h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,c,u));return h.resolution=s||i.settings.RESOLUTION,h._quality=0,h.quality=n||4,h.strength=r||8,h.firstRun=!0,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r,n){if(this.firstRun){var i=(0,s.default)(t.renderer.gl);this.vertexSrc=(0,o.default)(i,!1),this.fragmentSrc=(0,a.default)(i),this.firstRun=!1}if(this.uniforms.strength=1/r.size.height*(r.size.height/e.size.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{for(var l=t.getRenderTarget(!0),c=e,u=l,h=0;h<this.passes-1;h++){t.applyFilter(this,c,u,!0);var d=u;u=c,c=d}t.applyFilter(this,c,r,n),t.returnRenderTarget(l)}},n(e,[{key:"blur",get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}]),e}(i.Filter);e.default=c},AdPF:function(t,e,r){var n=r("yeub");t.exports=function(t){var e=t.xdomain,r=t.xscheme,i=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||n))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(t){}if(!e)try{return new(global[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}},Aplp:function(t,e,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,a={},s=0,l=0;function c(t){var e="";do{e=i[t%o]+e,t=Math.floor(t/o)}while(t>0);return e}function u(){var t=c(+new Date);return t!==n?(s=0,n=t):t+"."+c(s++)}for(;l<o;l++)a[i[l]]=l;u.encode=c,u.decode=function(t){var e=0;for(l=0;l<t.length;l++)e=e*o+a[t.charAt(l)];return e},t.exports=u},B7f1:function(t,e){var r=function(t,e,r,n,i){this.gl=t,this.texture=t.createTexture(),this.mipmap=!1,this.premultiplyAlpha=!1,this.width=e||-1,this.height=r||-1,this.format=n||t.RGBA,this.type=i||t.UNSIGNED_BYTE};r.prototype.upload=function(t){this.bind();var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var r=t.videoWidth||t.width,n=t.videoHeight||t.height;n!==this.height||r!==this.width?e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,t):e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.format,this.type,t),this.width=r,this.height=n};var n=!1;r.prototype.uploadData=function(t,e,r){this.bind();var i=this.gl;if(t instanceof Float32Array){if(!n){if(!i.getExtension("OES_texture_float"))throw new Error("floating point textures not available");n=!0}this.type=i.FLOAT}else this.type=this.type||i.UNSIGNED_BYTE;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e!==this.width||r!==this.height?i.texImage2D(i.TEXTURE_2D,0,this.format,e,r,0,this.format,this.type,t||null):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e,r,this.format,this.type,t||null),this.width=e,this.height=r},r.prototype.bind=function(t){var e=this.gl;void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},r.prototype.unbind=function(){var t=this.gl;t.bindTexture(t.TEXTURE_2D,null)},r.prototype.minFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.mipmap?t?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST:t?e.LINEAR:e.NEAREST)},r.prototype.magFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t?e.LINEAR:e.NEAREST)},r.prototype.enableMipmap=function(){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_2D)},r.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},r.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},r.prototype.enableWrapClamp=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)},r.prototype.enableWrapRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)},r.prototype.enableWrapMirrorRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)},r.prototype.destroy=function(){this.gl.deleteTexture(this.texture)},r.fromSource=function(t,e,n){var i=new r(t);return i.premultiplyAlpha=n||!1,i.upload(e),i},r.fromData=function(t,e,n,i){var o=new r(t);return o.uploadData(e,n,i),o},t.exports=r},Bjwz:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.renderer.on("context",this.onContextChange,this)}return t.prototype.onContextChange=function(){},t.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null},t}();e.default=n},BzvT:function(t,e,r){"use strict";e.__esModule=!0;var n=r("yI/K"),i=r("pQYt"),o=function(t){return t&&t.__esModule?t:{default:t}}(r("8WrO")),a=r("qp2T"),s=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.gl=e.gl,this._managedTextures=[]}return t.prototype.bindTexture=function(){},t.prototype.getTexture=function(){},t.prototype.updateTexture=function(t,e){var r=this.gl,a=!!t._glRenderTargets;if(!t.hasLoaded)return null;var s=this.renderer.boundTextures;if(void 0===e){e=0;for(var l=0;l<s.length;++l)if(s[l]===t){e=l;break}}s[e]=t,r.activeTexture(r.TEXTURE0+e);var c=t._glTextures[this.renderer.CONTEXT_UID];if(c)a?t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width,t.height):c.upload(t.source);else{if(a){var u=new o.default(this.gl,t.width,t.height,t.scaleMode,t.resolution);u.resize(t.width,t.height),t._glRenderTargets[this.renderer.CONTEXT_UID]=u,c=u.texture}else(c=new n.GLTexture(this.gl,null,null,null,null)).bind(e),c.premultiplyAlpha=!0,c.upload(t.source);t._glTextures[this.renderer.CONTEXT_UID]=c,t.on("update",this.updateTexture,this),t.on("dispose",this.destroyTexture,this),this._managedTextures.push(t),t.isPowerOfTwo?(t.mipmap&&c.enableMipmap(),t.wrapMode===i.WRAP_MODES.CLAMP?c.enableWrapClamp():t.wrapMode===i.WRAP_MODES.REPEAT?c.enableWrapRepeat():c.enableWrapMirrorRepeat()):c.enableWrapClamp(),t.scaleMode===i.SCALE_MODES.NEAREST?c.enableNearestScaling():c.enableLinearScaling()}return c},t.prototype.destroyTexture=function(t,e){if((t=t.baseTexture||t).hasLoaded){var r=this.renderer.CONTEXT_UID,n=t._glTextures,i=t._glRenderTargets;if(n[r]&&(this.renderer.unbindTexture(t),n[r].destroy(),t.off("update",this.updateTexture,this),t.off("dispose",this.destroyTexture,this),delete n[r],!e)){var o=this._managedTextures.indexOf(t);-1!==o&&(0,a.removeItems)(this._managedTextures,o,1)}i&&i[r]&&(i[r].destroy(),delete i[r])}},t.prototype.removeAll=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];e._glTextures[this.renderer.CONTEXT_UID]&&delete e._glTextures[this.renderer.CONTEXT_UID]}},t.prototype.destroy=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];this.destroyTexture(e,!0),e.off("update",this.updateTexture,this),e.off("dispose",this.destroyTexture,this)}this._managedTextures=null},t}();e.default=s},C2QD:function(t,e){function r(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-r:t+r}return 0|Math.min(t,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(t){this.ms=t},r.prototype.setMax=function(t){this.max=t},r.prototype.setJitter=function(t){this.jitter=t}},CIKq:function(t,e,r){var n,i=r("Gbct"),o=r("Wm4p"),a=r("TypT"),s=r("Yvos"),l=r("Aplp"),c=r("NOtv")("engine.io-client:websocket"),u=global.WebSocket||global.MozWebSocket;if("undefined"==typeof window)try{n=r(3)}catch(t){}var h=u;function d(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=u&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(h=n),i.call(this,t)}h||"undefined"!=typeof window||(h=n),t.exports=d,s(d,i),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?e?new h(t,e):new h(t):new h(t,e,r)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},d.prototype.write=function(t){var e=this;this.writable=!1;for(var r=t.length,n=0,i=r;n<i;n++)!function(t){o.encodePacket(t,e.supportsBinary,function(n){if(!e.usingBrowserWebSocket){var i={};t.options&&(i.compress=t.options.compress),e.perMessageDeflate&&("string"==typeof n?global.Buffer.byteLength(n):n.length)<e.perMessageDeflate.threshold&&(i.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(n):e.ws.send(n,i)}catch(t){c("websocket closed before onclose event")}--r||(e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0))})}(t[n])},d.prototype.onClose=function(){i.prototype.onClose.call(this)},d.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},d.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",r="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=l()),this.supportsBinary||(t.b64=1),(t=a.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t},d.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===d.prototype.name)}},CUme:function(t,e,r){var n=r("Gbct"),i=r("TypT"),o=r("Wm4p"),a=r("Yvos"),s=r("Aplp"),l=r("NOtv")("engine.io-client:polling");t.exports=u;var c=null!=new(r("AdPF"))({xdomain:!1}).responseType;function u(t){c&&!(t&&t.forceBase64)||(this.supportsBinary=!1),n.call(this,t)}a(u,n),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(t){var e=this;function r(){l("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(l("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){l("pre-pause polling complete"),--n||r()})),this.writable||(l("we are currently writing - waiting to pause"),n++,this.once("drain",function(){l("pre-pause writing complete"),--n||r()}))}else r()},u.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(t){var e=this;l("polling got data %s",t),o.decodePayload(t,this.socket.binaryType,function(t,r,n){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var t=this;function e(){l("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(l("transport open - closing"),e()):(l("transport not open - deferring close"),this.once("open",e))},u.prototype.write=function(t){var e=this;this.writable=!1;var r=function(){e.writable=!0,e.emit("drain")};o.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,r)})},u.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(t[this.timestampParam]=s()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(r=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t}},Cl5A:function(t,e,r){var n=r("CUme"),i=r("Yvos");t.exports=c;var o,a=/\n/g,s=/\\n/g;function l(){}function c(t){n.call(this,t),this.query=this.query||{},o||(global.___eio||(global.___eio=[]),o=global.___eio),this.index=o.length;var e=this;o.push(function(t){e.onData(t)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=l)},!1)}i(c,n),c.prototype.supportsBinary=!1,c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},c.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},c.prototype.doWrite=function(t,e){var r=this;if(!this.form){var n,i=document.createElement("form"),o=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=l,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function c(){u(),e()}function u(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{n=document.createElement('<iframe src="javascript:0" name="'+r.iframeId+'">')}catch(t){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),u(),t=t.replace(s,"\\\n"),this.area.value=t.replace(a,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&c()}:this.iframe.onload=c}},CxY0:function(t,e,r){"use strict";var n=r("rWzI"),i=r("Nehr");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=x,e.resolve=function(t,e){return x(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?x(t,!1,!0).resolveObject(e):e},e.format=function(t){return i.isString(t)&&(t=x(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=r("r8II");function x(t,e,r){if(t&&i.isObject(t)&&t instanceof o)return t;var n=new o;return n.parse(t,e,r),n}o.prototype.parse=function(t,e,r){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),s=-1!==o&&o<t.indexOf("#")?"?":"#",c=t.split(s);c[0]=c[0].replace(/\\/g,"/");var x=t=c.join(s);if(x=x.trim(),!r&&1===t.split("#").length){var b=l.exec(x);if(b)return this.path=x,this.href=x,this.pathname=b[1],b[2]?(this.search=b[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=a.exec(x);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,x=x.substr(w.length)}if(r||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===x.substr(0,2);!S||w&&v[w]||(x=x.substr(2),this.slashes=!0)}if(!v[w]&&(S||w&&!g[w])){for(var T,M,A=-1,E=0;E<d.length;E++)-1!==(C=x.indexOf(d[E]))&&(-1===A||C<A)&&(A=C);for(-1!==(M=-1===A?x.lastIndexOf("@"):x.lastIndexOf("@",A))&&(T=x.slice(0,M),x=x.slice(M+1),this.auth=decodeURIComponent(T)),A=-1,E=0;E<h.length;E++){var C;-1!==(C=x.indexOf(h[E]))&&(-1===A||C<A)&&(A=C)}-1===A&&(A=x.length),this.host=x.slice(0,A),x=x.slice(A),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var O=this.hostname.split(/\./),N=(E=0,O.length);E<N;E++){var L=O[E];if(L&&!L.match(p)){for(var I="",R=0,D=L.length;R<D;R++)L.charCodeAt(R)>127?I+="x":I+=L[R];if(!I.match(p)){var F=O.slice(0,E),U=O.slice(E+1),k=L.match(f);k&&(F.push(k[1]),U.unshift(k[2])),U.length&&(x="/"+U.join(".")+x),this.hostname=F.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),P||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"";this.host=(this.hostname||"")+B,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==x[0]&&(x="/"+x))}if(!m[_])for(E=0,N=u.length;E<N;E++){var j=u[E];if(-1!==x.indexOf(j)){var z=encodeURIComponent(j);z===j&&(z=escape(j)),x=x.split(j).join(z)}}var V=x.indexOf("#");-1!==V&&(this.hash=x.substr(V),x=x.slice(0,V));var G=x.indexOf("?");return-1!==G?(this.search=x.substr(G),this.query=x.substr(G+1),e&&(this.query=y.parse(this.query)),x=x.slice(0,G)):e&&(this.search="",this.query={}),x&&(this.pathname=x),g[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(B=this.pathname||"")+(this.search||"")),this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,a="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=y.stringify(this.query));var s=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),e+o+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+n},o.prototype.resolve=function(t){return this.resolveObject(x(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var r=new o,n=Object.keys(this),a=0;a<n.length;a++){var s=n[a];r[s]=this[s]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var l=Object.keys(t),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(r[u]=t[u])}return g[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!g[t.protocol]){for(var h=Object.keys(t),d=0;d<h.length;d++){var p=h[d];r[p]=t[p]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||v[t.protocol])r.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}return r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,(r.pathname||r.search)&&(r.path=(r.pathname||"")+(r.search||"")),r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=y||m||r.host&&t.pathname,b=x,w=r.pathname&&r.pathname.split("/")||[],_=(f=t.pathname&&t.pathname.split("/")||[],r.protocol&&!g[r.protocol]);if(_&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),x=x&&(""===f[0]||""===w[0])),y)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,w=f;else if(f.length)w||(w=[]),w.pop(),w=w.concat(f),r.search=t.search,r.query=t.query;else if(!i.isNullOrUndefined(t.search))return _&&(r.hostname=r.host=w.shift(),(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.host=r.hostname=E.shift())),r.search=t.search,r.query=t.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!w.length)return r.pathname=null,r.path=r.search?"/"+r.search:null,r.href=r.format(),r;for(var S=w.slice(-1)[0],T=(r.host||t.host||w.length>1)&&("."===S||".."===S)||""===S,M=0,A=w.length;A>=0;A--)"."===(S=w[A])?w.splice(A,1):".."===S?(w.splice(A,1),M++):M&&(w.splice(A,1),M--);if(!x&&!b)for(;M--;M)w.unshift("..");!x||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),T&&"/"!==w.join("/").substr(-1)&&w.push("");var E,C=""===w[0]||w[0]&&"/"===w[0].charAt(0);return _&&(r.hostname=r.host=C?"":w.length?w.shift():"",(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.host=r.hostname=E.shift())),(x=x||r.host&&w.length)&&!C&&w.unshift(""),w.length?r.pathname=w.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},Cxr2:function(t,e){var r=function(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log(t.getShaderInfoLog(n)),null)};t.exports=function(t,e,n,i){var o=r(t,t.VERTEX_SHADER,e),a=r(t,t.FRAGMENT_SHADER,n),s=t.createProgram();if(t.attachShader(s,o),t.attachShader(s,a),i)for(var l in i)t.bindAttribLocation(s,i[l],l);return t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(s,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(s)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(s)),t.deleteProgram(s),s=null),t.deleteShader(o),t.deleteShader(a),s}},"D+IV":function(t,e,r){"use strict";e.__esModule=!0;var n=u(r("Bjwz")),i=u(r("8WrO")),o=u(r("PuCZ")),a=r("d07J"),s=u(r("N0WC")),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("rUHO")),c=u(r("pIo5"));function u(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var d=function t(){h(this,t),this.renderTarget=null,this.sourceFrame=new a.Rectangle,this.destinationFrame=new a.Rectangle,this.filters=[],this.target=null,this.resolution=1},p=function(t){function e(r){h(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.gl=n.renderer.gl,n.quad=new o.default(n.gl,r.state.attribState),n.shaderCache={},n.pool={},n.filterData=null,n.managedFilters=[],n.renderer.on("prerender",n.onPrerender,n),n._screenWidth=r.view.width,n._screenHeight=r.view.height,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.pushFilter=function(t,e){var r=this.renderer,n=this.filterData;if(!n){n=this.renderer._activeRenderTarget.filterStack;var i=new d;i.sourceFrame=i.destinationFrame=this.renderer._activeRenderTarget.size,i.renderTarget=r._activeRenderTarget,this.renderer._activeRenderTarget.filterData=n={index:0,stack:[i]},this.filterData=n}var o=n.stack[++n.index],a=n.stack[0].destinationFrame;o||(o=n.stack[n.index]=new d);var s=t.filterArea&&0===t.filterArea.x&&0===t.filterArea.y&&t.filterArea.width===r.screen.width&&t.filterArea.height===r.screen.height,l=e[0].resolution,c=0|e[0].padding,u=s?r.screen:t.filterArea||t.getBounds(!0),h=o.sourceFrame,p=o.destinationFrame;h.x=(u.x*l|0)/l,h.y=(u.y*l|0)/l,h.width=(u.width*l|0)/l,h.height=(u.height*l|0)/l,s||(n.stack[0].renderTarget.transform||e[0].autoFit&&h.fit(a),h.pad(c)),p.width=h.width,p.height=h.height;var f=this.getPotRenderTarget(r.gl,h.width,h.height,l);o.target=t,o.filters=e,o.resolution=l,o.renderTarget=f,f.setFrame(p,h),r.bindRenderTarget(f),f.clear()},e.prototype.popFilter=function(){var t=this.filterData,e=t.stack[t.index-1],r=t.stack[t.index];this.quad.map(r.renderTarget.size,r.sourceFrame).upload();var n=r.filters;if(1===n.length)n[0].apply(this,r.renderTarget,e.renderTarget,!1,r),this.freePotRenderTarget(r.renderTarget);else{var i=r.renderTarget,o=this.getPotRenderTarget(this.renderer.gl,r.sourceFrame.width,r.sourceFrame.height,r.resolution);o.setFrame(r.destinationFrame,r.sourceFrame),o.clear();var a=0;for(a=0;a<n.length-1;++a){n[a].apply(this,i,o,!0,r);var s=i;i=o,o=s}n[a].apply(this,i,e.renderTarget,!1,r),this.freePotRenderTarget(i),this.freePotRenderTarget(o)}t.index--,0===t.index&&(this.filterData=null)},e.prototype.applyFilter=function(t,e,r,n){var i=this.renderer,o=i.gl,a=t.glShaders[i.CONTEXT_UID];a||(t.glShaderKey?(a=this.shaderCache[t.glShaderKey])||(a=new s.default(this.gl,t.vertexSrc,t.fragmentSrc),t.glShaders[i.CONTEXT_UID]=this.shaderCache[t.glShaderKey]=a,this.managedFilters.push(t)):(a=t.glShaders[i.CONTEXT_UID]=new s.default(this.gl,t.vertexSrc,t.fragmentSrc),this.managedFilters.push(t)),i.bindVao(null),this.quad.initVao(a)),i.bindVao(this.quad.vao),i.bindRenderTarget(r),n&&(o.disable(o.SCISSOR_TEST),i.clear(),o.enable(o.SCISSOR_TEST)),r===i.maskManager.scissorRenderTarget&&i.maskManager.pushScissorMask(null,i.maskManager.scissorData),i.bindShader(a);var l=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=l,this.syncUniforms(a,t),i.state.setBlendMode(t.blendMode),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.texture.texture),this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0),o.bindTexture(o.TEXTURE_2D,l._glTextures[this.renderer.CONTEXT_UID].texture)},e.prototype.syncUniforms=function(t,e){var r=e.uniformData,n=e.uniforms,i=1,o=void 0;if(t.uniforms.filterArea){var a=t.uniforms.filterArea;a[0]=(o=this.filterData.stack[this.filterData.index]).renderTarget.size.width,a[1]=o.renderTarget.size.height,a[2]=o.sourceFrame.x,a[3]=o.sourceFrame.y,t.uniforms.filterArea=a}if(t.uniforms.filterClamp){o=o||this.filterData.stack[this.filterData.index];var s=t.uniforms.filterClamp;s[0]=0,s[1]=0,s[2]=(o.sourceFrame.width-1)/o.renderTarget.size.width,s[3]=(o.sourceFrame.height-1)/o.renderTarget.size.height,t.uniforms.filterClamp=s}for(var l in r){var c=r[l].type;if("sampler2d"===c&&0!==n[l]){if(n[l].baseTexture)t.uniforms[l]=this.renderer.bindTexture(n[l].baseTexture,i);else{t.uniforms[l]=i;var u=this.renderer.gl;this.renderer.boundTextures[i]=this.renderer.emptyTextures[i],u.activeTexture(u.TEXTURE0+i),n[l].texture.bind()}i++}else if("mat3"===c)t.uniforms[l]=void 0!==n[l].a?n[l].toArray(!0):n[l];else if("vec2"===c)if(void 0!==n[l].x){var h=t.uniforms[l]||new Float32Array(2);h[0]=n[l].x,h[1]=n[l].y,t.uniforms[l]=h}else t.uniforms[l]=n[l];else"float"===c?t.uniforms.data[l].value!==r[l]&&(t.uniforms[l]=n[l]):t.uniforms[l]=n[l]}},e.prototype.getRenderTarget=function(t,e){var r=this.filterData.stack[this.filterData.index],n=this.getPotRenderTarget(this.renderer.gl,r.sourceFrame.width,r.sourceFrame.height,e||r.resolution);return n.setFrame(r.destinationFrame,r.sourceFrame),n},e.prototype.returnRenderTarget=function(t){this.freePotRenderTarget(t)},e.prototype.calculateScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return l.calculateScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size)},e.prototype.calculateNormalizedScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return l.calculateNormalizedScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size,e.destinationFrame)},e.prototype.calculateSpriteMatrix=function(t,e){var r=this.filterData.stack[this.filterData.index];return l.calculateSpriteMatrix(t,r.sourceFrame,r.renderTarget.size,e)},e.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.renderer,r=this.managedFilters;e.off("prerender",this.onPrerender,this);for(var n=0;n<r.length;n++)t||r[n].glShaders[e.CONTEXT_UID].destroy(),delete r[n].glShaders[e.CONTEXT_UID];this.shaderCache={},t?this.pool={}:this.emptyPool()},e.prototype.getPotRenderTarget=function(t,e,r,n){var o="screen";r*=n,(e*=n)===this._screenWidth&&r===this._screenHeight||(o=(65535&(e=c.default.nextPow2(e)))<<16|65535&(r=c.default.nextPow2(r))),this.pool[o]||(this.pool[o]=[]);var a=this.pool[o].pop();if(!a){var s=this.renderer.boundTextures[0];t.activeTexture(t.TEXTURE0),a=new i.default(t,e,r,null,1),t.bindTexture(t.TEXTURE_2D,s._glTextures[this.renderer.CONTEXT_UID].texture)}return a.resolution=n,a.defaultFrame.width=a.size.width=e/n,a.defaultFrame.height=a.size.height=r/n,a},e.prototype.emptyPool=function(){for(var t in this.pool){var e=this.pool[t];if(e)for(var r=0;r<e.length;r++)e[r].destroy(!0)}this.pool={}},e.prototype.freePotRenderTarget=function(t){var e=t.size.width*t.resolution,r=t.size.height*t.resolution,n="screen";e===this._screenWidth&&r===this._screenHeight||(n=(65535&e)<<16|65535&r),this.pool[n].push(t)},e.prototype.onPrerender=function(){if(this._screenWidth!==this.renderer.view.width||this._screenHeight!==this.renderer.view.height){this._screenWidth=this.renderer.view.width,this._screenHeight=this.renderer.view.height;var t=this.pool.screen;if(t)for(var e=0;e<t.length;e++)t[e].destroy(!0);this.pool.screen=[]}},e}(n.default);e.default=p},"Dn+6":function(t,e,r){"use strict";e.__esModule=!0;var n=r("sBhT");Object.defineProperty(e,"Mesh",{enumerable:!0,get:function(){return c(n).default}});var i=r("p85+");Object.defineProperty(e,"MeshRenderer",{enumerable:!0,get:function(){return c(i).default}});var o=r("4I2B");Object.defineProperty(e,"CanvasMeshRenderer",{enumerable:!0,get:function(){return c(o).default}});var a=r("Eu4P");Object.defineProperty(e,"Plane",{enumerable:!0,get:function(){return c(a).default}});var s=r("SJFq");Object.defineProperty(e,"NineSlicePlane",{enumerable:!0,get:function(){return c(s).default}});var l=r("1Ceu");function c(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Rope",{enumerable:!0,get:function(){return c(l).default}})},DuEz:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(r){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("N0WC")).default);e.default=n},Eu4P:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("sBhT")),i=function(t){function e(r,i,o){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return a._ready=!0,a.verticesX=i||10,a.verticesY=o||10,a.drawMode=n.default.DRAW_MODES.TRIANGLES,a.refresh(),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._refresh=function(){for(var t=this._texture,e=this.verticesX*this.verticesY,r=[],n=[],i=[],o=this.verticesX-1,a=this.verticesY-1,s=t.width/o,l=t.height/a,c=0;c<e;c++){var u=c%this.verticesX,h=c/this.verticesX|0;r.push(u*s,h*l),n.push(u/o,h/a)}for(var d=o*a,p=0;p<d;p++){var f=p%o,m=p/o|0,v=m*this.verticesX+f+1,g=(m+1)*this.verticesX+f,y=(m+1)*this.verticesX+f+1;i.push(m*this.verticesX+f,v,g),i.push(v,y,g)}this.vertices=new Float32Array(r),this.uvs=new Float32Array(n),this.colors=new Float32Array([]),this.indices=new Uint16Array(i),this.dirty++,this.indexDirty++,this.multiplyUvs()},e.prototype._onTextureUpdate=function(){n.default.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},e}(n.default);e.default=i},FGiv:function(t,e){var r=1e3,n=6e4,i=36e5,o=24*i;function a(t,e,r){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}t.exports=function(t,e){e=e||{};var s=typeof t;if("string"===s&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(t);if("number"===s&&!1===isNaN(t))return e.long?function(t){return a(t,o,"day")||a(t,i,"hour")||a(t,n,"minute")||a(t,r,"second")||t+" ms"}(t):function(t){return t>=o?Math.round(t/o)+"d":t>=i?Math.round(t/i)+"h":t>=n?Math.round(t/n)+"m":t>=r?Math.round(t/r)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},"FI+O":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("qp2T"),o=r("d07J"),a=r("pQYt"),s=h(r("Yd/J")),l=h(r("a/Ns")),c=h(r("eIHw")),u=h(r("uhBA"));function h(t){return t&&t.__esModule?t:{default:t}}var d=new o.Matrix,p=function(t){function e(r,n,c,u){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return(0,i.sayHello)(r),"number"==typeof n&&(n=Object.assign({width:n,height:c||s.default.RENDER_OPTIONS.height},u)),n=Object.assign({},s.default.RENDER_OPTIONS,n),h.options=n,h.type=a.RENDERER_TYPE.UNKNOWN,h.screen=new o.Rectangle(0,0,n.width,n.height),h.view=n.view||document.createElement("canvas"),h.resolution=n.resolution||s.default.RESOLUTION,h.transparent=n.transparent,h.autoResize=n.autoResize||!1,h.blendModes=null,h.preserveDrawingBuffer=n.preserveDrawingBuffer,h.clearBeforeRender=n.clearBeforeRender,h.roundPixels=n.roundPixels,h._backgroundColor=0,h._backgroundColorRgba=[0,0,0,0],h._backgroundColorString="#000000",h.backgroundColor=n.backgroundColor||h._backgroundColor,h._tempDisplayObjectParent=new l.default,h._lastObjectRendered=h._tempDisplayObjectParent,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoResize&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},e.prototype.generateTexture=function(t,e,r,n){n=n||t.getLocalBounds();var i=c.default.create(0|n.width,0|n.height,e,r);return d.tx=-n.x,d.ty=-n.y,this.render(t,i,!1,d,!0),i},e.prototype.destroy=function(t){t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=a.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},n(e,[{key:"width",get:function(){return this.view.width}},{key:"height",get:function(){return this.view.height}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=(0,i.hex2string)(t),(0,i.hex2rgb)(t,this._backgroundColorRgba)}}]),e}(u.default);e.default=p},FLfE:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){for(var e=t.getParameter(t.MAX_VARYING_VECTORS),r=15;r>e;)r-=2;return r}},FNZ9:function(t,e,r){var n=r("B7f1"),i=function(t,e,r){this.gl=t,this.framebuffer=t.createFramebuffer(),this.stencil=null,this.texture=null,this.width=e||100,this.height=r||100};i.prototype.enableTexture=function(t){var e=this.gl;this.texture=t||new n(e),this.texture.bind(),this.bind(),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.texture,0)},i.prototype.enableStencil=function(){if(!this.stencil){var t=this.gl;this.stencil=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencil),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height)}},i.prototype.clear=function(t,e,r,n){this.bind();var i=this.gl;i.clearColor(t,e,r,n),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},i.prototype.bind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer)},i.prototype.unbind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},i.prototype.resize=function(t,e){var r=this.gl;this.width=t,this.height=e,this.texture&&this.texture.uploadData(null,t,e),this.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,this.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t,e))},i.prototype.destroy=function(){var t=this.gl;this.texture&&this.texture.destroy(),t.deleteFramebuffer(this.framebuffer),this.gl=null,this.stencil=null,this.texture=null},i.createRGBA=function(t,e,r,o){var a=n.fromData(t,null,e,r);a.enableNearestScaling(),a.enableWrapClamp();var s=new i(t,e,r);return s.enableTexture(a),s.unbind(),s},i.createFloat32=function(t,e,r,o){var a=new n.fromData(t,o,e,r);a.enableNearestScaling(),a.enableWrapClamp();var s=new i(t,e,r);return s.enableTexture(a),s.unbind(),s},t.exports=i},G9Ht:function(t,e,r){var n,i,o;!function(r){var a=/iPhone/i,s=/iPod/i,l=/iPad/i,c=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,u=/Android/i,h=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,d=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,p=/Windows Phone/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,m=/BlackBerry/i,v=/BB10/i,g=/Opera Mini/i,y=/(CriOS|Chrome)(?=.*\bMobile\b)/i,x=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,b=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),w=function(t,e){return t.test(e)},_=function(t){var e=t||navigator.userAgent,r=e.split("[FBAN");if(void 0!==r[1]&&(e=r[0]),void 0!==(r=e.split("Twitter"))[1]&&(e=r[0]),this.apple={phone:w(a,e),ipod:w(s,e),tablet:!w(a,e)&&w(l,e),device:w(a,e)||w(s,e)||w(l,e)},this.amazon={phone:w(h,e),tablet:!w(h,e)&&w(d,e),device:w(h,e)||w(d,e)},this.android={phone:w(h,e)||w(c,e),tablet:!w(h,e)&&!w(c,e)&&(w(d,e)||w(u,e)),device:w(h,e)||w(d,e)||w(c,e)||w(u,e)},this.windows={phone:w(p,e),tablet:w(f,e),device:w(p,e)||w(f,e)},this.other={blackberry:w(m,e),blackberry10:w(v,e),opera:w(g,e),firefox:w(x,e),chrome:w(y,e),device:w(m,e)||w(v,e)||w(g,e)||w(x,e)||w(y,e)},this.seven_inch=w(b,e),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},S=function(){var t=new _;return t.Class=_,t};void 0!==t&&t.exports&&"undefined"==typeof window?t.exports=_:void 0!==t&&t.exports&&"undefined"!=typeof window?t.exports=S():(i=[],n=r.isMobile=S(),void 0===(o="function"==typeof n?n.apply(e,i):n)||(t.exports=o))}(this)},Gbct:function(t,e,r){var n=r("Wm4p"),i=r("cpc2");function o(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=o,i(o.prototype),o.prototype.onError=function(t,e){var r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(t){var e=n.decodePacket(t,this.socket.binaryType);this.onPacket(e)},o.prototype.onPacket=function(t){this.emit("packet",t)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},H9sp:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=16,o=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.uploadHookHelper=n,n.canvas=document.createElement("canvas"),n.canvas.width=i,n.canvas.height=i,n.ctx=n.canvas.getContext("2d"),n.registerUploadHook(a),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.ctx=null,this.canvas=null},e}(function(t){return t&&t.__esModule?t:{default:t}}(r("meNg")).default);function a(t,e){if(e instanceof n.BaseTexture){var r=e.source,i=0===r.width?t.canvas.width:Math.min(t.canvas.width,r.width),o=0===r.height?t.canvas.height:Math.min(t.canvas.height,r.height);return t.ctx.drawImage(r,0,0,i,o,0,0,t.canvas.width,t.canvas.height),!0}return!1}e.default=o,n.CanvasRenderer.registerPlugin("prepare",o)},HNzc:function(t,e){var r=new ArrayBuffer(0),n=function(t,e,n,i){this.gl=t,this.buffer=t.createBuffer(),this.type=e||t.ARRAY_BUFFER,this.drawType=i||t.STATIC_DRAW,this.data=r,n&&this.upload(n),this._updateID=0};n.prototype.upload=function(t,e,r){r||this.bind();var n=this.gl;t=t||this.data,e=e||0,this.data.byteLength>=t.byteLength?n.bufferSubData(this.type,e,t):n.bufferData(this.type,t,this.drawType),this.data=t},n.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},n.createVertexBuffer=function(t,e,r){return new n(t,t.ARRAY_BUFFER,e,r)},n.createIndexBuffer=function(t,e,r){return new n(t,t.ELEMENT_ARRAY_BUFFER,e,r)},n.create=function(t,e,r,i){return new n(t,e,r,i)},n.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},t.exports=n},HP7h:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._x=n,this._y=i,this.cb=e,this.scope=r}return t.prototype.set=function(t,e){var r=t||0,n=e||(0!==e?r:0);this._x===r&&this._y===n||(this._x=r,this._y=n,this.cb.call(this.scope))},t.prototype.copy=function(t){this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope))},n(t,[{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}]),t}();e.default=i},I42F:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=l(r("c/UO")),a=l(r("p6KW")),s=l(r("FLfE"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r,n,s,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=(0,o.default)(l=l||5,!0),u=(0,a.default)(l),h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,c,u));return h.resolution=s||i.settings.RESOLUTION,h._quality=0,h.quality=n||4,h.strength=r||8,h.firstRun=!0,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r,n){if(this.firstRun){var i=(0,s.default)(t.renderer.gl);this.vertexSrc=(0,o.default)(i,!0),this.fragmentSrc=(0,a.default)(i),this.firstRun=!1}if(this.uniforms.strength=1/r.size.width*(r.size.width/e.size.width),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{for(var l=t.getRenderTarget(!0),c=e,u=l,h=0;h<this.passes-1;h++){t.applyFilter(this,c,u,!0);var d=u;u=c,c=d}t.applyFilter(this,c,r,n),t.returnRenderTarget(l)}},n(e,[{key:"blur",get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}]),e}(i.Filter);e.default=c},Is4P:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN"));r("2U8Y");var o=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));return i.noise=r,i.seed=n,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"noise",get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t}},{key:"seed",get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t}}]),e}(i.Filter);e.default=o},JLJ9:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){return!(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))}},JUUD:function(t,e){t.exports=function(t,e,r){var n;if(r){var i=r.tempAttribState,o=r.attribState;for(n=0;n<i.length;n++)i[n]=!1;for(n=0;n<e.length;n++)i[e[n].attribute.location]=!0;for(n=0;n<o.length;n++)o[n]!==i[n]&&(o[n]=i[n],r.attribState[n]?t.enableVertexAttribArray(n):t.disableVertexAttribArray(n))}else for(n=0;n<e.length;n++)t.enableVertexAttribArray(e[n].attribute.location)}},JehY:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN"));r("2U8Y");var i=function(t){function e(){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(n.Filter);e.default=i},JkEu:function(t,e,r){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=c(r("1eSL")),a=c(r("u62O")),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("UdPh")),l=c(r("Xwh9"));function c(t){return t&&t.__esModule?t:{default:t}}var u=/(#[\w-]+)?$/,h=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.baseUrl=r,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,r){return e._loadResource(t,r)},this._queue=s.queue(this._boundLoadResource,n),this._queue.pause(),this.resources={},this.onProgress=new o.default,this.onError=new o.default,this.onLoad=new o.default,this.onStart=new o.default,this.onComplete=new o.default}return t.prototype.add=function(t,e,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;++o)this.add(t[o]);return this}if("object"===(void 0===t?"undefined":n(t))&&(i=e||t.callback||t.onComplete,r=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(i=r,r=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(i=r,r=null),this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new l.default(t,e,r),"function"==typeof i&&this.resources[t].onAfterMiddleware.once(i),this.loading){for(var a=r.parentResource,s=[],c=0;c<a.children.length;++c)a.children[c].isComplete||s.push(a.children[c]);var u=a.progressChunk*(s.length+1)/(s.length+2);a.children.push(this.resources[t]),a.progressChunk=u;for(var h=0;h<s.length;++h)s[h].progressChunk=u;this.resources[t].progressChunk=u}return this._queue.push(this.resources[t]),this},t.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},t.prototype.use=function(t){return this._afterMiddleware.push(t),this},t.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},t.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},t.prototype._prepareUrl=function(t){var e=(0,a.default)(t,{strictMode:!0}),r=void 0;if(r=e.protocol||!e.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var n=u.exec(r)[0];-1!==(r=r.substr(0,r.length-n.length)).indexOf("?")?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=n}return r},t.prototype._loadResource=function(t,e){var r=this;t._dequeue=e,s.eachSeries(this._beforeMiddleware,function(e,n){e.call(r,t,function(){n(t.isComplete?{}:null)})},function(){t.isComplete?r._onLoad(t):(t._onLoadBinding=t.onComplete.once(r._onLoad,r),t.load())},!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),s.eachSeries(this._afterMiddleware,function(r,n){r.call(e,t,n)},function(){t.onAfterMiddleware.dispatch(t),e.progress+=t.progressChunk,e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()},!0)},i(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();e.default=h},K9TQ:function(t,e){t.exports=function(t,e){var r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!r)throw new Error("This browser does not support webGL. Try using the canvas renderer");return r}},KByU:function(t,e,r){"use strict";e.__esModule=!0;var n=r("d07J"),i=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.worldTransform=new n.Matrix,this.localTransform=new n.Matrix,this._worldID=0,this._parentID=0}return t.prototype.updateLocalTransform=function(){},t.prototype.updateTransform=function(t){var e=t.worldTransform,r=this.worldTransform,n=this.localTransform;r.a=n.a*e.a+n.b*e.c,r.b=n.a*e.b+n.b*e.d,r.c=n.c*e.a+n.d*e.c,r.d=n.c*e.b+n.d*e.d,r.tx=n.tx*e.a+n.ty*e.c+e.tx,r.ty=n.tx*e.b+n.ty*e.d+e.ty,this._worldID++},t}();e.default=i,i.prototype.updateWorldTransform=i.prototype.updateTransform,i.IDENTITY=new i},KFGy:function(t,e,r){var n=r("Vo14"),i=r("cpc2"),o=r("kSER"),a=r("2Dig"),s=r("QN7Q"),l=r("NOtv")("socket.io-client:socket"),c=r("TypT"),u=r("WLGk");t.exports=p;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=i.prototype.emit;function p(t,e,r){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[a(t,"open",s(this,"onopen")),a(t,"packet",s(this,"onpacket")),a(t,"close",s(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var t=o(arguments);return t.unshift("message"),this.emit.apply(this,t),this},p.prototype.emit=function(t){if(h.hasOwnProperty(t))return d.apply(this,arguments),this;var e=o(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:u(e))?n.BINARY_EVENT:n.EVENT,data:e,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},p.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},p.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?c.encode(this.query):this.query;l("sending connect packet with query %s",t),this.packet({type:n.CONNECT,query:t})}else this.packet({type:n.CONNECT})},p.prototype.onclose=function(t){l("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},p.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},p.prototype.onevent=function(t){var e=t.data||[];l("emitting event %j",e),null!=t.id&&(l("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?d.apply(this,e):this.receiveBuffer.push(e)},p.prototype.ack=function(t){var e=this,r=!1;return function(){if(!r){r=!0;var i=o(arguments);l("sending ack %j",i),e.packet({type:u(i)?n.BINARY_ACK:n.ACK,id:t,data:i})}}},p.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(l("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):l("bad ack %s",t.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)d.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(t){return this.flags.compress=t,this},p.prototype.binary=function(t){return this.flags.binary=t,this}},KKCa:function(t,e){t.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},KvbZ:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){t.points=t.shape.points.slice();var a=t.points;if(t.fill&&a.length>=6){for(var s=[],l=t.holes,c=0;c<l.length;c++){var u=l[c];s.push(a.length/2),a=a.concat(u.points)}var h=e.points,d=e.indices,p=a.length/2,f=(0,i.hex2rgb)(t.fillColor),m=t.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,x=(0,o.default)(a,s,2);if(!x)return;for(var b=h.length/6,w=0;w<x.length;w+=3)d.push(x[w]+b),d.push(x[w]+b),d.push(x[w+1]+b),d.push(x[w+2]+b),d.push(x[w+2]+b);for(var _=0;_<p;_++)h.push(a[2*_],a[2*_+1],v,g,y,m)}t.lineWidth>0&&(0,n.default)(t,e,r)};var n=a(r("5OzF")),i=r("qp2T"),o=a(r("VmRL"));function a(t){return t&&t.__esModule?t:{default:t}}},LNIn:function(t,e,r){"use strict";e.__esModule=!0;var n=s(r("pVcz")),i=r("pQYt"),o=r("d07J"),a=s(r("/UP7"));function s(t){return t&&t.__esModule?t:{default:t}}var l=new o.Matrix,c=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=t._texture,r=this.renderer,n=e._frame.width,s=e._frame.height,c=t.transform.worldTransform,u=0,h=0;if(!(e.orig.width<=0||e.orig.height<=0)&&e.baseTexture.source&&(r.setBlendMode(t.blendMode),e.valid)){r.context.globalAlpha=t.worldAlpha;var d=e.baseTexture.scaleMode===i.SCALE_MODES.LINEAR;r.smoothProperty&&r.context[r.smoothProperty]!==d&&(r.context[r.smoothProperty]=d),e.trim?(u=e.trim.width/2+e.trim.x-t.anchor.x*e.orig.width,h=e.trim.height/2+e.trim.y-t.anchor.y*e.orig.height):(u=(.5-t.anchor.x)*e.orig.width,h=(.5-t.anchor.y)*e.orig.height),e.rotate&&(c.copy(l),o.GroupD8.matrixAppendRotationInv(c=l,e.rotate,u,h),u=0,h=0),u-=n/2,h-=s/2,r.roundPixels?(r.context.setTransform(c.a,c.b,c.c,c.d,c.tx*r.resolution|0,c.ty*r.resolution|0),u|=0,h|=0):r.context.setTransform(c.a,c.b,c.c,c.d,c.tx*r.resolution,c.ty*r.resolution);var p=e.baseTexture.resolution;16777215!==t.tint?(t.cachedTint===t.tint&&t.tintedTexture.tintId===t._texture._updateID||(t.cachedTint=t.tint,t.tintedTexture=a.default.getTintedTexture(t,t.tint)),r.context.drawImage(t.tintedTexture,0,0,n*p,s*p,u*r.resolution,h*r.resolution,n*r.resolution,s*r.resolution)):r.context.drawImage(e.baseTexture.source,e._frame.x*p,e._frame.y*p,n*p,s*p,u*r.resolution,h*r.resolution,n*r.resolution,s*r.resolution)}},t.prototype.destroy=function(){this.renderer=null},t}();e.default=c,n.default.registerPlugin("sprite",c)},M0IJ:function(t,e,r){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(r("MgzW"));Object.assign||(Object.assign=n.default)},M6Jp:function(t,e,r){"use strict";e.__esModule=!0;var n=r("/msk");Object.defineProperty(e,"webgl",{enumerable:!0,get:function(){return l(n).default}});var i=r("H9sp");Object.defineProperty(e,"canvas",{enumerable:!0,get:function(){return l(i).default}});var o=r("meNg");Object.defineProperty(e,"BasePrepare",{enumerable:!0,get:function(){return l(o).default}});var a=r("QNV1");Object.defineProperty(e,"CountLimiter",{enumerable:!0,get:function(){return l(a).default}});var s=r("fsTW");function l(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"TimeLimiter",{enumerable:!0,get:function(){return l(s).default}})},MCLT:function(t,e,r){var n=/%[sdj%]/g;e.format=function(t){if(!v(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(a(arguments[r]));return e.join(" ")}r=1;for(var i=arguments,o=i.length,s=String(t).replace(n,function(t){if("%%"===t)return"%";if(r>=o)return t;switch(t){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(t){return"[Circular]"}default:return t}}),l=i[r];r<o;l=i[++r])f(l)||!x(l)?s+=" "+l:s+=" "+a(l);return s},e.deprecate=function(t,r){if(g(global.process))return function(){return e.deprecate(t,r).apply(this,arguments)};if(!0===process.noDeprecation)return t;var n=!1;return function(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return t.apply(this,arguments)}};var i,o={};function a(t,r){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&e._extend(n,r),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=s),c(n,t,n.depth)}function s(t,e){var r=a.styles[e];return r?"\x1b["+a.colors[r][0]+"m"+t+"\x1b["+a.colors[r][1]+"m":t}function l(t,e){return t}function c(t,r,n){if(t.customInspect&&r&&_(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,t);return v(i)||(i=c(t,i,n)),i}var o=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(v(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return m(e)?t.stylize(""+e,"number"):p(e)?t.stylize(""+e,"boolean"):f(e)?t.stylize("null","null"):void 0}(t,r);if(o)return o;var a=Object.keys(r),s=function(t){var e={};return a.forEach(function(t,r){e[t]=!0}),e}();if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),w(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return u(r);if(0===a.length){if(_(r))return t.stylize("[Function"+(r.name?": "+r.name:"")+"]","special");if(y(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(b(r))return t.stylize(Date.prototype.toString.call(r),"date");if(w(r))return u(r)}var l,x="",S=!1,T=["{","}"];return d(r)&&(S=!0,T=["[","]"]),_(r)&&(x=" [Function"+(r.name?": "+r.name:"")+"]"),y(r)&&(x=" "+RegExp.prototype.toString.call(r)),b(r)&&(x=" "+Date.prototype.toUTCString.call(r)),w(r)&&(x=" "+u(r)),0!==a.length||S&&0!=r.length?n<0?y(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),l=S?function(t,e,r,n,i){for(var o=[],a=0,s=e.length;a<s;++a)A(e,String(a))?o.push(h(t,e,r,n,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(t,e,r,n,i,!0))}),o}(t,r,n,s,a):a.map(function(e){return h(t,r,n,s,e,S)}),t.seen.pop(),function(t,e,r){return t.reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}(l,x,T)):T[0]+x+T[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,r,n,i,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?s=t.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),A(n,i)||(a="["+i+"]"),s||(t.seen.indexOf(l.value)<0?(s=f(r)?c(t,l.value,null):c(t,l.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),g(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function d(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function f(t){return null===t}function m(t){return"number"==typeof t}function v(t){return"string"==typeof t}function g(t){return void 0===t}function y(t){return x(t)&&"[object RegExp]"===S(t)}function x(t){return"object"==typeof t&&null!==t}function b(t){return x(t)&&"[object Date]"===S(t)}function w(t){return x(t)&&("[object Error]"===S(t)||t instanceof Error)}function _(t){return"function"==typeof t}function S(t){return Object.prototype.toString.call(t)}function T(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(g(i)&&(i=process.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(i)){var r=process.pid;o[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,r,n)}}else o[t]=function(){};return o[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=p,e.isNull=f,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=v,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=y,e.isObject=x,e.isDate=b,e.isError=w,e.isFunction=_,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r("1gqn");var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",function(){var t=new Date,e=[T(t.getHours()),T(t.getMinutes()),T(t.getSeconds())].join(":");return[t.getDate(),M[t.getMonth()],e].join(" ")}(),e.format.apply(e,arguments))},e.inherits=r("KKCa"),e._extend=function(t,e){if(!e||!x(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}},MgzW:function(t,e,r){"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,a,s=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),l=1;l<arguments.length;l++){for(var c in r=Object(arguments[l]))i.call(r,c)&&(s[c]=r[c]);if(n){a=n(r);for(var u=0;u<a.length;u++)o.call(r,a[u])&&(s[a[u]]=r[a[u]])}}return s}},MjLO:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var o=t.shape,a=o.x,s=o.y,l=o.width,c=o.height;if(t.fill){var u=(0,i.hex2rgb)(t.fillColor),h=t.fillAlpha,d=u[0]*h,p=u[1]*h,f=u[2]*h,m=e.points,v=e.indices,g=m.length/6;m.push(a,s),m.push(d,p,f,h),m.push(a+l,s),m.push(d,p,f,h),m.push(a,s+c),m.push(d,p,f,h),m.push(a+l,s+c),m.push(d,p,f,h),v.push(g,g,g+1,g+2,g+3,g+3)}if(t.lineWidth){var y=t.points;t.points=[a,s,a+l,s,a+l,s+c,a,s+c,a,s],(0,n.default)(t,e,r),t.points=y}};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("5OzF")),i=r("qp2T")},N0WC:function(t,e,r){"use strict";e.__esModule=!0;var n=r("yI/K"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("Yd/J"));function o(t,e){if(t instanceof Array){if("precision"!==t[0].substring(0,9)){var r=t.slice(0);return r.unshift("precision "+e+" float;"),r}}else if("precision"!==t.trim().substring(0,9))return"precision "+e+" float;\n"+t;return t}var a=function(t){function e(r,n,a,s,l){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,o(n,l||i.default.PRECISION_VERTEX),o(a,l||i.default.PRECISION_FRAGMENT),void 0,s))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(n.GLShader);e.default=a},NE8l:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("Bjwz")),i=o(r("he9Y"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.scissor=!1,n.scissorData=null,n.scissorRenderTarget=null,n.enableScissor=!0,n.alphaMaskPool=[],n.alphaMaskIndex=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.pushMask=function(t,e){if(e.texture)this.pushSpriteMask(t,e);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&e.isFastRect()){var r=e.worldTransform,n=Math.atan2(r.b,r.a);(n=Math.round(n*(180/Math.PI)))%90?this.pushStencilMask(e):this.pushScissorMask(t,e)}else this.pushStencilMask(e)},e.prototype.popMask=function(t,e){e.texture?this.popSpriteMask(t,e):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(t,e):this.popStencilMask(t,e)},e.prototype.pushSpriteMask=function(t,e){var r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new i.default(e)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=e,t.filterArea=e.getBounds(!0),this.renderer.filterManager.pushFilter(t,r),this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filterManager.popFilter(),this.alphaMaskIndex--},e.prototype.pushStencilMask=function(t){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.pushStencil(t)},e.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.popStencil()},e.prototype.pushScissorMask=function(t,e){e.renderable=!0;var r=this.renderer._activeRenderTarget,n=e.getBounds();n.fit(r.size),e.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var i=this.renderer.resolution;this.renderer.gl.scissor(n.x*i,(r.root?r.size.height-n.y-n.height:n.y)*i,n.width*i,n.height*i),this.scissorRenderTarget=r,this.scissorData=e,this.scissor=!0},e.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var t=this.renderer.gl;t.disable(t.SCISSOR_TEST)},e}(n.default);e.default=a},NO7c:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=s(r("Yd/J")),o=r("pQYt"),a=s(r("xXZ/"));function s(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){var e=this;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._head=new a.default(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/i.default.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e){return this._addListener(new a.default(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL))},t.prototype.addOnce=function(t,e){return this._addListener(new a.default(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL,!0))},t.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var r=this._head.next;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null},t.prototype.update=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),e=void 0;if(t>this.lastTime){(e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),this.deltaTime=e*i.default.TARGET_FPMS*this.speed;for(var r=this._head,n=r.next;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.elapsedMS=0;this.lastTime=t},n(t,[{key:"FPS",get:function(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(Math.max(0,t)/1e3,i.default.TARGET_FPMS);this._maxElapsedMS=1/e}}]),t}();e.default=l},NOtv:function(t,e,r){function n(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=r("lv48")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var r=this.useColors;if(t[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+t[0]+(r?"%c ":" ")+"+"+e.humanize(this.diff),r){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&"%c"===t&&(o=++i)}),t.splice(o,0,n)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=n,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(n())},Nehr:function(t,e,r){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},Nv7N:function(t,e,r){"use strict";e.__esModule=!0;var n=r("pQYt"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("Yd/J")),o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=i.default.GC_MAX_IDLE,this.checkCountMax=i.default.GC_MAX_CHECK_COUNT,this.mode=i.default.GC_MODE}return t.prototype.update=function(){this.count++,this.mode!==n.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},t.prototype.run=function(){for(var t=this.renderer.textureManager,e=t._managedTextures,r=!1,n=0;n<e.length;n++){var i=e[n];!i._glRenderTargets&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[n]=null,r=!0)}if(r){for(var o=0,a=0;a<e.length;a++)null!==e[a]&&(e[o++]=e[a]);e.length=o}},t.prototype.unload=function(t){t._texture&&t._texture._glRenderTargets&&this.renderer.textureManager.destroyTexture(t._texture,!0);for(var e=t.children.length-1;e>=0;e--)this.unload(t.children[e])},t}();e.default=o},Nx1p:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){return function(t,e){var r=t.name+"_image";if(t.data&&t.type===n.Resource.TYPE.JSON&&t.data.frames&&!this.resources[r]){var i={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},s=a(t,this.baseUrl);this.add(r,s,i,function(r){if(r.error)e(r.error);else{var n=new o.Spritesheet(r.texture.baseTexture,t.data,t.url);n.parse(function(){t.spritesheet=n,t.textures=n.textures,e()})}})}else e()}},e.getResourcePath=a;var n=r("z+eP"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("CxY0")),o=r("3AcN");function a(t,e){return t.isDataUrl?t.data.meta.image:i.default.resolve(t.url.replace(e,""),t.data.meta.image)}},OKgQ:function(t,e,r){var n=r("Womt");Sky=function(){var t=Sky.SkyShader,e=new n.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:n.UniformsUtils.clone(t.uniforms),side:n.BackSide});n.Mesh.call(this,new n.SphereBufferGeometry(1,32,15),e)},Sky.prototype=Object.create(n.Mesh.prototype),Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new n.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},t.exports=Sky},P2LE:function(t,e,r){var n=r("Cxr2"),i=r("7AYe"),o=r("984s"),a=r("0DWY"),s=r("hy2w"),l=function(t,e,r,l,c){this.gl=t,l&&(e=a(e,l),r=a(r,l)),this.program=n(t,e,r,c),this.attributes=i(t,this.program),this.uniformData=o(t,this.program),this.uniforms=s(t,this.uniformData)};l.prototype.bind=function(){return this.gl.useProgram(this.program),this},l.prototype.destroy=function(){this.attributes=null,this.uniformData=null,this.uniforms=null,this.gl.deleteProgram(this.program)},t.exports=l},PuCZ:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("yI/K")),i=o(r("TyRm"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e,r){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.interleaved=new Float32Array(16);for(var o=0;o<4;o++)this.interleaved[4*o]=this.vertices[2*o],this.interleaved[4*o+1]=this.vertices[2*o+1],this.interleaved[4*o+2]=this.uvs[2*o],this.interleaved[4*o+3]=this.uvs[2*o+1];this.indices=(0,i.default)(1),this.vertexBuffer=n.default.GLBuffer.createVertexBuffer(e,this.interleaved,e.STATIC_DRAW),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.vao=new n.default.VertexArrayObject(e,r)}return t.prototype.initVao=function(t){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,t.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,t.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)},t.prototype.map=function(t,e){var r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,n=e.y,this.vertices[0]=r=e.x,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this},t.prototype.upload=function(){for(var t=0;t<4;t++)this.interleaved[4*t]=this.vertices[2*t],this.interleaved[4*t+1]=this.vertices[2*t+1],this.interleaved[4*t+2]=this.uvs[2*t],this.interleaved[4*t+3]=this.uvs[2*t+1];return this.vertexBuffer.upload(this.interleaved),this},t.prototype.destroy=function(){var t=this.gl;t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer)},t}();e.default=a},QLbY:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=l(r("HP7h")),a=r("qp2T"),s=l(r("Yd/J"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return i._textWidth=0,i._textHeight=0,i._glyphs=[],i._font={tint:void 0!==n.tint?n.tint:16777215,align:n.align||"left",name:null,size:0},i.font=n.font,i._text=r,i._maxWidth=0,i._maxLineHeight=0,i._anchor=new o.default(function(){i.dirty=!0},i,0,0),i.dirty=!1,i.updateText(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateText=function(){for(var t=e.fonts[this._font.name],r=this._font.size/t.size,n=new i.Point,o=[],a=[],s=null,l=0,c=0,u=0,h=-1,d=0,p=0,f=0,m=0;m<this.text.length;m++){var v=this.text.charCodeAt(m);if(/(\s)/.test(this.text.charAt(m))&&(h=m,d=l),/(?:\r\n|\r|\n)/.test(this.text.charAt(m)))a.push(l),c=Math.max(c,l),u++,n.x=0,n.y+=t.lineHeight,s=null;else if(-1!==h&&this._maxWidth>0&&n.x*r>this._maxWidth)i.utils.removeItems(o,h-p,m-h),m=h,h=-1,++p,a.push(d),c=Math.max(c,d),u++,n.x=0,n.y+=t.lineHeight,s=null;else{var g=t.chars[v];g&&(s&&g.kerning[s]&&(n.x+=g.kerning[s]),o.push({texture:g.texture,line:u,charCode:v,position:new i.Point(n.x+g.xOffset,n.y+g.yOffset)}),l=n.x+(g.texture.width+g.xOffset),n.x+=g.xAdvance,f=Math.max(f,g.yOffset+g.texture.height),s=v)}}a.push(l),c=Math.max(c,l);for(var y=[],x=0;x<=u;x++){var b=0;"right"===this._font.align?b=c-a[x]:"center"===this._font.align&&(b=(c-a[x])/2),y.push(b)}for(var w=o.length,_=this.tint,S=0;S<w;S++){var T=this._glyphs[S];T?T.texture=o[S].texture:(T=new i.Sprite(o[S].texture),this._glyphs.push(T)),T.position.x=(o[S].position.x+y[o[S].line])*r,T.position.y=o[S].position.y*r,T.scale.x=T.scale.y=r,T.tint=_,T.parent||this.addChild(T)}for(var M=w;M<this._glyphs.length;++M)this.removeChild(this._glyphs[M]);if(this._textWidth=c*r,this._textHeight=(n.y+t.lineHeight)*r,0!==this.anchor.x||0!==this.anchor.y)for(var A=0;A<w;A++)this._glyphs[A].x-=this._textWidth*this.anchor.x,this._glyphs[A].y-=this._textHeight*this.anchor.y;this._maxLineHeight=f*r},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},e.registerFont=function(t,r){var n={},o=t.getElementsByTagName("info")[0],l=t.getElementsByTagName("common")[0],c=t.getElementsByTagName("page")[0].getAttribute("file"),u=(0,a.getResolutionOfUrl)(c,s.default.RESOLUTION);n.font=o.getAttribute("face"),n.size=parseInt(o.getAttribute("size"),10),n.lineHeight=parseInt(l.getAttribute("lineHeight"),10)/u,n.chars={};for(var h=t.getElementsByTagName("char"),d=0;d<h.length;d++){var p=h[d],f=parseInt(p.getAttribute("id"),10),m=new i.Rectangle(parseInt(p.getAttribute("x"),10)/u+r.frame.x/u,parseInt(p.getAttribute("y"),10)/u+r.frame.y/u,parseInt(p.getAttribute("width"),10)/u,parseInt(p.getAttribute("height"),10)/u);n.chars[f]={xOffset:parseInt(p.getAttribute("xoffset"),10)/u,yOffset:parseInt(p.getAttribute("yoffset"),10)/u,xAdvance:parseInt(p.getAttribute("xadvance"),10)/u,kerning:{},texture:new i.Texture(r.baseTexture,m)}}for(var v=t.getElementsByTagName("kerning"),g=0;g<v.length;g++){var y=v[g],x=parseInt(y.getAttribute("first"),10)/u,b=parseInt(y.getAttribute("second"),10)/u,w=parseInt(y.getAttribute("amount"),10)/u;n.chars[b]&&(n.chars[b].kerning[x]=w)}return e.fonts[n.font]=n,n},n(e,[{key:"tint",get:function(){return this._font.tint},set:function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0}},{key:"align",get:function(){return this._font.align},set:function(t){this._font.align=t||"left",this.dirty=!0}},{key:"anchor",get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copy(t)}},{key:"font",get:function(){return this._font},set:function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):e.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)}},{key:"text",get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}},{key:"maxLineHeight",get:function(){return this.validate(),this._maxLineHeight}},{key:"textWidth",get:function(){return this.validate(),this._textWidth}},{key:"textHeight",get:function(){return this.validate(),this._textHeight}}]),e}(i.Container);e.default=c,c.fonts={}},QN7Q:function(t,e){var r=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return e.apply(t,n.concat(r.call(arguments)))}}},QNV1:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.maxItemsPerFrame=e,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();e.default=n},R2qm:function(t,e,r){"use strict";var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=s(r("xJsK")),o=s(r("3Jm9")),a=r("qp2T");function s(t){return t&&t.__esModule?t:{default:t}}var l=n.DisplayObject,c=new n.Matrix;l.prototype._cacheAsBitmap=!1,l.prototype._cacheData=!1,Object.defineProperties(l.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap!==t){this._cacheAsBitmap=t;var e=void 0;t?(this._cacheData||(this._cacheData=new function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.textureCacheId=null,this.originalRenderWebGL=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null}),(e=this._cacheData).originalRenderWebGL=this.renderWebGL,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this._calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=e.originalRenderWebGL,this.renderCanvas=e.originalRenderCanvas,this._calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}}),l.prototype._renderCachedWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite._transformID=-1,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(t))},l.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.currentRenderer.flush();var r=this.getLocalBounds().clone();this._filters&&r.pad(this._filters[0].padding);var s=t._activeRenderTarget,l=t.filterManager.filterStack,u=n.RenderTexture.create(0|r.width,0|r.height),h="cacheAsBitmap_"+(0,a.uid)();this._cacheData.textureCacheId=h,o.default.addToCache(u.baseTexture,h),i.default.addToCache(u,h);var d=c;d.tx=-r.x,d.ty=-r.y,this.transform.worldTransform.identity(),this.renderWebGL=this._cacheData.originalRenderWebGL,t.render(this,u,!0,d,!0),t.bindRenderTarget(s),t.filterManager.filterStack=l,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this._mask=null,this.filterArea=null;var p=new n.Sprite(u);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-r.x/r.width,p.anchor.y=-r.y/r.height,p.alpha=e,p._bounds=this._bounds,this._calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=p.containsPoint.bind(p)}},l.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite.renderCanvas(t))},l.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),r=this.alpha;this.alpha=1;var s=t.context,l=n.RenderTexture.create(0|e.width,0|e.height),u="cacheAsBitmap_"+(0,a.uid)();this._cacheData.textureCacheId=u,o.default.addToCache(l.baseTexture,u),i.default.addToCache(l,u);var h=c;this.transform.localTransform.copy(h),h.invert(),h.tx-=e.x,h.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,l,!0,h,!1),t.context=s,this.renderCanvas=this._renderCachedCanvas,this._calculateBounds=this._calculateCachedBounds,this._mask=null,this.filterArea=null;var d=new n.Sprite(l);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-e.x/e.width,d.anchor.y=-e.y/e.height,d._bounds=this._bounds,d.alpha=r,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.updateTransform=this.displayObjectUpdateTransform,this._cacheData.sprite=d,this.containsPoint=d.containsPoint.bind(d)}},l.prototype._calculateCachedBounds=function(){this._cacheData.sprite._calculateBounds()},l.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},l.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,o.default.removeFromCache(this._cacheData.textureCacheId),i.default.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},l.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)}},SJFq:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=10,o=function(t){function e(r,n,o,a,s){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,4,4));return l._origWidth=r.orig.width,l._origHeight=r.orig.height,l._width=l._origWidth,l._height=l._origHeight,l.leftWidth=void 0!==n?n:i,l.rightWidth=void 0!==a?a:i,l.topHeight=void 0!==o?o:i,l.bottomHeight=void 0!==s?s:i,l.refresh(!0),l}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateHorizontalVertices=function(){var t=this.vertices;t[9]=t[11]=t[13]=t[15]=this._topHeight,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices;t[2]=t[10]=t[18]=t[26]=this._leftWidth,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._renderCanvas=function(t){var e=t.context;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode);var r=this.worldTransform,n=t.resolution;t.roundPixels?e.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n|0,r.ty*n|0):e.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n,r.ty*n);var i=this._texture.baseTexture,o=i.source,a=i.width*i.resolution,s=i.height*i.resolution;this.drawSegment(e,o,a,s,0,1,10,11),this.drawSegment(e,o,a,s,2,3,12,13),this.drawSegment(e,o,a,s,4,5,14,15),this.drawSegment(e,o,a,s,8,9,18,19),this.drawSegment(e,o,a,s,10,11,20,21),this.drawSegment(e,o,a,s,12,13,22,23),this.drawSegment(e,o,a,s,16,17,26,27),this.drawSegment(e,o,a,s,18,19,28,29),this.drawSegment(e,o,a,s,20,21,30,31)},e.prototype.drawSegment=function(t,e,r,n,i,o,a,s){var l=this.uvs,c=this.vertices,u=(l[a]-l[i])*r,h=(l[s]-l[o])*n,d=c[a]-c[i],p=c[s]-c[o];u<1&&(u=1),h<1&&(h=1),d<1&&(d=1),p<1&&(p=1),t.drawImage(e,l[i]*r,l[o]*n,u,h,c[i],c[o],d,p)},e.prototype._refresh=function(){t.prototype._refresh.call(this);var e=this.uvs,r=this._texture;this._origWidth=r.orig.width,this._origHeight=r.orig.height;var n=1/this._origWidth,i=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=n*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-n*this._rightWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.dirty++,this.multiplyUvs()},n(e,[{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._refresh()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._refresh()}},{key:"leftWidth",get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()}},{key:"rightWidth",get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()}},{key:"topHeight",get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()}},{key:"bottomHeight",get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("Eu4P")).default);e.default=o},SLIe:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){return function(t,e){t.data&&t.type===n.Resource.TYPE.IMAGE&&(t.texture=i.default.fromLoader(t.data,t.url,t.name)),e()}};var n=r("z+eP"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("xJsK"))},"TF/P":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("3AcN"),o=r("qp2T"),a=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.baseTexture=e,this.textures={},this.data=r,this.resolution=this._updateResolution(n||this.baseTexture.imageUrl),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return n(t,null,[{key:"BATCH_SIZE",get:function(){return 1e3}}]),t.prototype._updateResolution=function(t){var e=this.data.meta.scale,r=(0,o.getResolutionOfUrl)(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&(this.baseTexture.resolution=r,this.baseTexture.update()),r},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var r=e,n=t.BATCH_SIZE,o=this.baseTexture.sourceScale;r-e<n&&r<this._frameKeys.length;){var a=this._frameKeys[r],s=this._frames[a],l=s.frame;if(l){var c,u=null,h=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,d=new i.Rectangle(0,0,Math.floor(h.w*o)/this.resolution,Math.floor(h.h*o)/this.resolution);c=s.rotated?new i.Rectangle(Math.floor(l.x*o)/this.resolution,Math.floor(l.y*o)/this.resolution,Math.floor(l.h*o)/this.resolution,Math.floor(l.w*o)/this.resolution):new i.Rectangle(Math.floor(l.x*o)/this.resolution,Math.floor(l.y*o)/this.resolution,Math.floor(l.w*o)/this.resolution,Math.floor(l.h*o)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(u=new i.Rectangle(Math.floor(s.spriteSourceSize.x*o)/this.resolution,Math.floor(s.spriteSourceSize.y*o)/this.resolution,Math.floor(l.w*o)/this.resolution,Math.floor(l.h*o)/this.resolution)),this.textures[a]=new i.Texture(this.baseTexture,c,d,u,s.rotated?2:0),i.Texture.addToCache(this.textures[a],a)}r++}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():e._parseComplete()},0)},t.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},t}();e.default=a},"TR3/":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e,r,n,i,o,a,s,l,c){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.text=e,this.style=r,this.width=n,this.height=i,this.lines=o,this.lineWidths=a,this.lineHeight=s,this.maxLineWidth=l,this.fontProperties=c}return t.measureText=function(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t._canvas;n=n||r.wordWrap;var o=r.toFontString(),a=t.measureFont(o),s=i.getContext("2d");s.font=o;for(var l=(n?t.wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),c=new Array(l.length),u=0,h=0;h<l.length;h++){var d=s.measureText(l[h]).width+(l[h].length-1)*r.letterSpacing;c[h]=d,u=Math.max(u,d)}var p=u+r.strokeThickness;r.dropShadow&&(p+=r.dropShadowDistance);var f=r.lineHeight||a.fontSize+r.strokeThickness,m=Math.max(f,a.fontSize+r.strokeThickness)+(l.length-1)*(f+r.leading);return r.dropShadow&&(m+=r.dropShadowDistance),new t(e,r,p,m,l,c,f+r.leading,u,a)},t.wordWrap=function(e,r){for(var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t._canvas).getContext("2d"),i="",o=0,a="",s={},l=r.letterSpacing,c=r.wordWrapWidth+r.letterSpacing,u=t.getFromCache(" ",l,s,n),h=e.split(" "),d=0;d<h.length;d++){var p=h[d],f=t.getFromCache(p,l,s,n);if(f>c)if(r.breakWords)for(var m=(i.length>0?" "+p:p).split(""),v=0;v<m.length;v++){var g=m[v],y=t.getFromCache(g,l,s,n);y+o>c&&(a+=t.addLine(i),i="",o=0),i+=g,o+=y}else i.length>0&&(a+=t.addLine(i),i="",o=0),a+=t.addLine(p),i="",o=0;else f+o>c&&(a+=t.addLine(i),i="",o=0),i+=i.length>0?" "+p:p,o+=f+u}return a+t.addLine(i,!1)},t.addLine=function(t){return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?t:t+"\n"},t.getFromCache=function(t,e,r,n){var i=r[t];if(void 0===i){var o=t.length*e;i=n.measureText(t).width+o,r[t]=i}return i},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var r={},n=t._canvas,i=t._context;i.font=e;var o=Math.ceil(i.measureText("|M\xc9q").width),a=Math.ceil(i.measureText("M").width),s=2*a;a=1.4*a|0,n.width=o,n.height=s,i.fillStyle="#f00",i.fillRect(0,0,o,s),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|M\xc9q",0,a);var l=i.getImageData(0,0,o,s).data,c=l.length,u=4*o,h=0,d=0,p=!1;for(h=0;h<a;++h){for(var f=0;f<u;f+=4)if(255!==l[d+f]){p=!0;break}if(p)break;d+=u}for(r.ascent=a-h,d=c-u,p=!1,h=s;h>a;--h){for(var m=0;m<u;m+=4)if(255!==l[d+m]){p=!0;break}if(p)break;d-=u}return r.descent=h-a,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r},t}();e.default=n;var i=document.createElement("canvas");i.width=i.height=10,n._canvas=i,n._context=i.getContext("2d"),n._fonts={}},TRZq:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e){var r=!e;if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");if(r){var a=document.createElement("canvas");a.width=1,a.height=1,e=n.default.createContext(a)}for(var s=e.createShader(e.FRAGMENT_SHADER);;){var l=i.replace(/%forloop%/gi,o(t));if(e.shaderSource(s,l),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))break;t=t/2|0}return r&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),t};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("yI/K")),i=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function o(t){for(var e="",r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+="if(test == "+r+".0){}");return e}},TXE8:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("pQYt"),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=Number(e),this.y=Number(r),this.width=Number(n),this.height=Number(o),this.type=i.SHAPES.RECT}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},t.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},t.prototype.fit=function(t){this.x<t.x&&(this.width+=this.x,this.width<0&&(this.width=0),this.x=t.x),this.y<t.y&&(this.height+=this.y,this.height<0&&(this.height=0),this.y=t.y),this.x+this.width>t.x+t.width&&(this.width=t.width-this.x,this.width<0&&(this.width=0)),this.y+this.height>t.y+t.height&&(this.height=t.height-this.y,this.height<0&&(this.height=0))},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.width=r-e,this.y=n,this.height=i-n},n(t,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"EMPTY",get:function(){return new t(0,0,0,0)}}]),t}();e.default=o},Tt2x:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=new n.Rectangle,o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,e.extract=this}return t.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},t.prototype.base64=function(t){return this.canvas(t).toDataURL()},t.prototype.canvas=function(t){var e=this.renderer,r=void 0,o=void 0,a=void 0,s=!1,l=void 0,c=!1;t&&(t instanceof n.RenderTexture?l=t:(l=this.renderer.generateTexture(t),c=!0)),l?(o=(r=l.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,a=l.frame,s=!1):(o=(r=this.renderer.rootRenderTarget).resolution,s=!0,(a=i).width=r.size.width,a.height=r.size.height);var u=a.width*o,h=a.height*o,d=new n.CanvasRenderTarget(u,h);if(r){e.bindRenderTarget(r);var p=new Uint8Array(4*u*h),f=e.gl;f.readPixels(a.x*o,a.y*o,u,h,f.RGBA,f.UNSIGNED_BYTE,p);var m=d.context.getImageData(0,0,u,h);m.data.set(p),d.context.putImageData(m,0,0),s&&(d.context.scale(1,-1),d.context.drawImage(d.canvas,0,-h))}return c&&l.destroy(!0),d.canvas},t.prototype.pixels=function(t){var e=this.renderer,r=void 0,o=void 0,a=void 0,s=void 0,l=!1;t&&(t instanceof n.RenderTexture?s=t:(s=this.renderer.generateTexture(t),l=!0)),s?(o=(r=s.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,a=s.frame):(o=(r=this.renderer.rootRenderTarget).resolution,(a=i).width=r.size.width,a.height=r.size.height);var c=a.width*o,u=a.height*o,h=new Uint8Array(4*c*u);if(r){e.bindRenderTarget(r);var d=e.gl;d.readPixels(a.x*o,a.y*o,c,u,d.RGBA,d.UNSIGNED_BYTE,h)}return l&&s.destroy(!0),h},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t}();e.default=o,n.WebGLRenderer.registerPlugin("extract",o)},TyRm:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){for(var e=6*t,r=new Uint16Array(e),n=0,i=0;n<e;n+=6,i+=4)r[n+0]=i+0,r[n+1]=i+1,r[n+2]=i+2,r[n+3]=i+0,r[n+4]=i+2,r[n+5]=i+3;return r}},TypT:function(t,e){e.encode=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e},e.decode=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}},UdPh:function(t,e,r){"use strict";function n(){}function i(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}e.__esModule=!0,e.eachSeries=function(t,e,r,n){var i=0,o=t.length;!function a(s){s||i===o?r&&r(s):n?setTimeout(function(){e(t[i++],a)},1):e(t[i++],a)}()},e.queue=function(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var r=0,o={_tasks:[],concurrency:e,saturated:n,unsaturated:n,buffer:e/4,empty:n,drain:n,error:n,started:!1,paused:!1,push:function(t,e){a(t,!1,e)},kill:function(){r=0,o.drain=n,o.started=!1,o._tasks=[]},unshift:function(t,e){a(t,!0,e)},process:function(){for(;!o.paused&&r<o.concurrency&&o._tasks.length;){var e=o._tasks.shift();0===o._tasks.length&&o.empty(),(r+=1)===o.concurrency&&o.saturated(),t(e.data,i(s(e)))}},length:function(){return o._tasks.length},running:function(){return r},idle:function(){return o._tasks.length+r===0},pause:function(){!0!==o.paused&&(o.paused=!0)},resume:function(){if(!1!==o.paused){o.paused=!1;for(var t=1;t<=o.concurrency;t++)o.process()}}};function a(t,e,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(o.started=!0,null==t&&o.idle())setTimeout(function(){return o.drain()},1);else{var i={data:t,callback:"function"==typeof r?r:n};e?o._tasks.unshift(i):o._tasks.push(i),setTimeout(function(){return o.process()},1)}}function s(t){return function(){r-=1,t.callback.apply(t,arguments),null!=arguments[0]&&o.error(arguments[0],t.data),r<=o.concurrency-o.buffer&&o.unsaturated(),o.idle()&&o.drain(),o.process()}}return o}},Uxeu:function(t,e){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),o=t.indexOf("]");-1!=i&&-1!=o&&(t=t.substring(0,i)+t.substring(i,o).replace(/:/g,";")+t.substring(o,t.length));for(var a=r.exec(t||""),s={},l=14;l--;)s[n[l]]=a[l]||"";return-1!=i&&-1!=o&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},VAGf:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("lsi7")),i=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.activeState=new Uint8Array(16),this.defaultState=new Uint8Array(16),this.defaultState[0]=1,this.stackIndex=0,this.stack=[],this.gl=e,this.maxAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)},this.blendModes=(0,n.default)(e),this.nativeVaoExtension=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object")}return t.prototype.push=function(){var t=this.stack[this.stackIndex];t||(t=this.stack[this.stackIndex]=new Uint8Array(16)),++this.stackIndex;for(var e=0;e<this.activeState.length;e++)t[e]=this.activeState[e]},t.prototype.pop=function(){var t=this.stack[--this.stackIndex];this.setState(t)},t.prototype.setState=function(t){this.setBlend(t[0]),this.setDepthTest(t[1]),this.setFrontFace(t[2]),this.setCullFace(t[3]),this.setBlendMode(t[4])},t.prototype.setBlend=function(t){this.activeState[0]!==(t=t?1:0)&&(this.activeState[0]=t,this.gl[t?"enable":"disable"](this.gl.BLEND))},t.prototype.setBlendMode=function(t){if(t!==this.activeState[4]){this.activeState[4]=t;var e=this.blendModes[t];2===e.length?this.gl.blendFunc(e[0],e[1]):this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3])}},t.prototype.setDepthTest=function(t){this.activeState[1]!==(t=t?1:0)&&(this.activeState[1]=t,this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST))},t.prototype.setCullFace=function(t){this.activeState[3]!==(t=t?1:0)&&(this.activeState[3]=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE))},t.prototype.setFrontFace=function(t){this.activeState[2]!==(t=t?1:0)&&(this.activeState[2]=t,this.gl.frontFace(this.gl[t?"CW":"CCW"]))},t.prototype.resetAttributes=function(){for(var t=0;t<this.attribState.tempAttribState.length;t++)this.attribState.tempAttribState[t]=0;for(var e=0;e<this.attribState.attribState.length;e++)this.attribState.attribState[e]=0;for(var r=1;r<this.maxAttribs;r++)this.gl.disableVertexAttribArray(r)},t.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null),this.resetAttributes();for(var t=0;t<this.activeState.length;++t)this.activeState[t]=32;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.setState(this.defaultState)},t}();e.default=i},VmRL:function(t,e,r){"use strict";function n(t,e,r){r=r||2;var n,s,l,c,u,p,m,v=e&&e.length,g=v?e[0]*r:t.length,y=i(t,0,g,r,!0),x=[];if(!y)return x;if(v&&(y=function(t,e,r,n){var a,s,l,c=[];for(a=0,s=e.length;a<s;a++)(l=i(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n,!1))===l.next&&(l.steiner=!0),c.push(f(l));for(c.sort(h),a=0;a<c.length;a++)d(c[a],r),r=o(r,r.next);return r}(t,e,y,r)),t.length>80*r){n=l=t[0],s=c=t[1];for(var b=r;b<g;b+=r)p=t[b+1],(u=t[b])<n&&(n=u),p<s&&(s=p),u>l&&(l=u),p>c&&(c=p);m=0!==(m=Math.max(l-n,c-s))?1/m:0}return a(y,x,r,n,s,m),x}function i(t,e,r,n,i){var o,a;if(i===M(t,e,r,n)>0)for(o=e;o<r;o+=n)a=_(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=_(o,t[o],t[o+1],a);return a&&y(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!y(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(S(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function a(t,e,r,n,i,h,d){if(t){!d&&h&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,c=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(a>1)}(i)}(t,n,i,h);for(var f,m,v=t;t.prev!==t.next;)if(f=t.prev,m=t.next,h?l(t,n,i,h):s(t))e.push(f.i/r),e.push(t.i/r),e.push(m.i/r),S(t),t=m.next,v=m.next;else if((t=m)===v){d?1===d?a(t=c(t,e,r),e,r,n,i,h,2):2===d&&u(t,e,r,n,i,h):a(o(t),e,r,n,i,h,1);break}}}function s(t){var e=t.prev,r=t,n=t.next;if(g(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(m(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(t,e,r,n){var i=t.prev,o=t,a=t.next;if(g(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=p(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),u=p(s,l,e,r,n),h=t.prevZ,d=t.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function c(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!y(i,o)&&x(i,n,n.next,o)&&b(i,o)&&b(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),S(n),S(n.next),n=t=o),n=n.next}while(n!==t);return n}function u(t,e,r,n,i,s){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var u=w(l,c);return l=o(l,l.next),u=o(u,u.next),a(l,e,r,n,i,s),void a(u,e,r,n,i,s)}c=c.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&m(o<h?i:a,o,u,h,o<h?a:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&b(n,t)&&(r=n,d=l),n=n.next;return r}(t,e)){var r=w(e,t);o(r,r.next)}}function p(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function m(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&x(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,r,n){return!!(y(t,e)&&y(r,n)||y(t,n)&&y(r,e))||g(t,e,r)>0!=g(t,e,n)>0&&g(r,n,t)>0!=g(r,n,e)>0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var r=new T(t.i,t.x,t.y),n=new T(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function _(t,e,r,n){var i=new T(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=n,t.exports.default=n,n.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(M(t,0,i?e[0]*r:t.length,r));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(M(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r));var l=0;for(a=0;a<n.length;a+=3){var c=n[a]*r,u=n[a+1]*r,h=n[a+2]*r;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&r.holes.push(n+=t[i-1].length)}return r}},Vo14:function(t,e,r){var n=r("NOtv")("socket.io-parser"),i=r("cpc2"),o=r("cD5x"),a=r("49sm"),s=r("+SKG");function l(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=l,e.Decoder=h;var c=e.ERROR+'"encode error"';function u(t){var r=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(r+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(r+=t.nsp+","),null!=t.id&&(r+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return c;r+=i}return n("encoded %j as %s",t,r),r}function h(){this.reconstructor=null}function d(t){this.reconPack=t,this.buffers=[]}function p(t){return{type:e.ERROR,data:"parser error: "+t}}l.prototype.encode=function(t,r){n("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?function(t,e){o.removeBlobs(t,function(t){var r=o.deconstructPacket(t),n=u(r.packet),i=r.buffers;i.unshift(n),e(i)})}(t,r):r([u(t)])},i(h.prototype),h.prototype.add=function(t){var r;if("string"==typeof t)r=function(t){var r=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return p("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var o="";"-"!==t.charAt(++r)&&(o+=t.charAt(r),r!=t.length););if(o!=Number(o)||"-"!==t.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===t.charAt(r+1))for(i.nsp="";++r&&","!==(l=t.charAt(r))&&(i.nsp+=l,r!==t.length););else i.nsp="/";var s=t.charAt(r+1);if(""!==s&&Number(s)==s){for(i.id="";++r;){var l;if(null==(l=t.charAt(r))||Number(l)!=l){--r;break}if(i.id+=t.charAt(r),r===t.length)break}i.id=Number(i.id)}if(t.charAt(++r)){var c=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(r));if(!1===c||i.type!==e.ERROR&&!a(c))return p("invalid payload");i.data=c}return n("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type?(this.reconstructor=new d(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!s(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",r))}},h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},W3bV:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("TXE8")),i=r("pQYt"),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r,this.radius=n,this.type=i.SHAPES.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.x-t,n=this.y-e;return(r*=r)+(n*=n)<=this.radius*this.radius},t.prototype.getBounds=function(){return new n.default(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t}();e.default=o},WJwb:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("3Jm9")),i=o(r("Yd/J"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments[2],a=arguments[3];!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,null,o));return s.resolution=a||i.default.RESOLUTION,s.width=Math.ceil(r),s.height=Math.ceil(n),s.realWidth=s.width*s.resolution,s.realHeight=s.height*s.resolution,s.scaleMode=void 0!==o?o:i.default.SCALE_MODE,s.hasLoaded=!0,s._glRenderTargets={},s._canvasRenderTarget=null,s.valid=!1,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this))},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.renderer=null},e}(n.default);e.default=a},WLGk:function(t,e,r){var n=r("49sm"),i=Object.prototype.toString,o="function"==typeof global.Blob||"[object BlobConstructor]"===i.call(global.Blob),a="function"==typeof global.File||"[object FileConstructor]"===i.call(global.File);t.exports=function t(e){if(!e||"object"!=typeof e)return!1;if(n(e)){for(var r=0,i=e.length;r<i;r++)if(t(e[r]))return!0;return!1}if("function"==typeof global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(e)||"function"==typeof global.ArrayBuffer&&e instanceof ArrayBuffer||o&&e instanceof Blob||a&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return!0;return!1}},Wm4p:function(t,e,r){var n,i=r("dkv/"),o=r("WLGk"),a=r("ypnn"),s=r("zMFY"),l=r("oIG/");global&&global.ArrayBuffer&&(n=r("g5Dd"));var c="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),h=c||u;e.protocol=3;var d=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=i(d),f={type:"error",data:"parser error"},m=r("14A5");function v(t,e,r){for(var n=new Array(t.length),i=s(t.length,r),o=function(t,r,i){e(r,function(e,r){n[t]=r,i(e,n)})},a=0;a<t.length;a++)o(a,t[a],i)}e.encodePacket=function(t,r,n,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof n&&(i=n,n=null);var o=void 0===t.data?void 0:t.data.buffer||t.data;if(global.ArrayBuffer&&o instanceof ArrayBuffer)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=t.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=d[t.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return n(a.buffer)}(t,r,i);if(m&&o instanceof global.Blob)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);if(h)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=new FileReader;return i.onload=function(){t.data=i.result,e.encodePacket(t,r,!0,n)},i.readAsArrayBuffer(t.data)}(t,r,n);var i=new Uint8Array(1);return i[0]=d[t.type],n(new m([i.buffer,t.data]))}(t,r,i);if(o&&o.base64)return function(t,r){return r("b"+e.packets[t.type]+t.data.data)}(t,i);var a=d[t.type];return void 0!==t.data&&(a+=n?l.encode(String(t.data),{strict:!1}):String(t.data)),i(""+a)},e.encodeBase64Packet=function(t,r){var n,i="b"+e.packets[t.type];if(m&&t.data instanceof global.Blob){var o=new FileReader;return o.onload=function(){var t=o.result.split(",")[1];r(i+t)},o.readAsDataURL(t.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var a=new Uint8Array(t.data),s=new Array(a.length),l=0;l<a.length;l++)s[l]=a[l];n=String.fromCharCode.apply(null,s)}return i+=global.btoa(n),r(i)},e.decodePacket=function(t,r,n){if(void 0===t)return f;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),r);if(n&&!1===(t=function(t){try{t=l.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return f;var i=t.charAt(0);return Number(i)==i&&p[i]?t.length>1?{type:p[i],data:t.substring(1)}:{type:p[i]}:f}i=new Uint8Array(t)[0];var o=a(t,1);return m&&"blob"===r&&(o=new m([o])),{type:p[i],data:o}},e.decodeBase64Packet=function(t,e){var r=p[t.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:t.substr(1)}};var i=n.decode(t.substr(1));return"blob"===e&&m&&(i=new m([i])),{type:r,data:i}},e.encodePayload=function(t,r,n){"function"==typeof r&&(n=r,r=null);var i=o(t);return r&&i?m&&!h?e.encodePayloadAsBlob(t,n):e.encodePayloadAsArrayBuffer(t,n):t.length?void v(t,function(t,n){e.encodePacket(t,!!i&&r,!1,function(t){n(null,function(t){return t.length+":"+t}(t))})},function(t,e){return n(e.join(""))}):n("0:")},e.decodePayload=function(t,r,n){if("string"!=typeof t)return e.decodePayloadAsBinary(t,r,n);var i;if("function"==typeof r&&(n=r,r=null),""===t)return n(f,0,1);for(var o,a,s="",l=0,c=t.length;l<c;l++){var u=t.charAt(l);if(":"===u){if(""===s||s!=(o=Number(s)))return n(f,0,1);if(s!=(a=t.substr(l+1,o)).length)return n(f,0,1);if(a.length){if(i=e.decodePacket(a,r,!1),f.type===i.type&&f.data===i.data)return n(f,0,1);if(!1===n(i,l+o,c))return}l+=o,s=""}else s+=u}return""!==s?n(f,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,r){if(!t.length)return r(new ArrayBuffer(0));v(t,function(t,r){e.encodePacket(t,!0,!0,function(t){return r(null,t)})},function(t,e){var n=e.reduce(function(t,e){var r;return t+(r="string"==typeof e?e.length:e.byteLength).toString().length+r+2},0),i=new Uint8Array(n),o=0;return e.forEach(function(t){var e="string"==typeof t,r=t;if(e){for(var n=new Uint8Array(t.length),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);r=n.buffer}i[o++]=e?0:1;var s=r.byteLength.toString();for(a=0;a<s.length;a++)i[o++]=parseInt(s[a]);for(i[o++]=255,n=new Uint8Array(r),a=0;a<n.length;a++)i[o++]=n[a]}),r(i.buffer)})},e.encodePayloadAsBlob=function(t,r){v(t,function(t,r){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);t=n.buffer,e[0]=0}var o=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),a=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)a[i]=parseInt(o[i]);if(a[o.length]=255,m){var s=new m([e.buffer,a.buffer,t]);r(null,s)}})},function(t,e){return r(new m(e))})},e.decodePayloadAsBinary=function(t,r,n){"function"==typeof r&&(n=r,r=null);for(var i=t,o=[];i.byteLength>0;){for(var s=new Uint8Array(i),l=0===s[0],c="",u=1;255!==s[u];u++){if(c.length>310)return n(f,0,1);c+=s[u]}i=a(i,2+c.length),c=parseInt(c);var h=a(i,0,c);if(l)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var d=new Uint8Array(h);for(h="",u=0;u<d.length;u++)h+=String.fromCharCode(d[u])}o.push(h),i=a(i,c)}var p=o.length;o.forEach(function(t,i){n(e.decodePacket(t,r,!0),i,p)})}},Womt:function(t,e,r){"use strict";function n(){}r.r(e),r.d(e,"WebGLRenderTargetCube",function(){return We}),r.d(e,"WebGLRenderTarget",function(){return He}),r.d(e,"WebGLRenderer",function(){return Xn}),r.d(e,"ShaderLib",function(){return rr}),r.d(e,"UniformsLib",function(){return er}),r.d(e,"UniformsUtils",function(){return Ke}),r.d(e,"ShaderChunk",function(){return Qe}),r.d(e,"FogExp2",function(){return Yn}),r.d(e,"Fog",function(){return qn}),r.d(e,"Scene",function(){return Jn}),r.d(e,"Sprite",function(){return Qn}),r.d(e,"LOD",function(){return Kn}),r.d(e,"SkinnedMesh",function(){return ei}),r.d(e,"Skeleton",function(){return $n}),r.d(e,"Bone",function(){return ti}),r.d(e,"Mesh",function(){return Ur}),r.d(e,"LineSegments",function(){return ii}),r.d(e,"LineLoop",function(){return oi}),r.d(e,"Line",function(){return ni}),r.d(e,"Points",function(){return si}),r.d(e,"Group",function(){return li}),r.d(e,"VideoTexture",function(){return ci}),r.d(e,"DataTexture",function(){return Xe}),r.d(e,"CompressedTexture",function(){return ui}),r.d(e,"CubeTexture",function(){return Br}),r.d(e,"CanvasTexture",function(){return zn}),r.d(e,"DepthTexture",function(){return hi}),r.d(e,"Texture",function(){return Ve}),r.d(e,"CompressedTextureLoader",function(){return ko}),r.d(e,"DataTextureLoader",function(){return Bo}),r.d(e,"CubeTextureLoader",function(){return zo}),r.d(e,"TextureLoader",function(){return Vo}),r.d(e,"ObjectLoader",function(){return Va}),r.d(e,"MaterialLoader",function(){return Fa}),r.d(e,"BufferGeometryLoader",function(){return Ua}),r.d(e,"DefaultLoadingManager",function(){return Do}),r.d(e,"LoadingManager",function(){return Ro}),r.d(e,"JSONLoader",function(){return za}),r.d(e,"ImageLoader",function(){return jo}),r.d(e,"ImageBitmapLoader",function(){return Ya}),r.d(e,"FontLoader",function(){return Qa}),r.d(e,"FileLoader",function(){return Uo}),r.d(e,"Loader",function(){return Ba}),r.d(e,"LoaderUtils",function(){return ja}),r.d(e,"Cache",function(){return Io}),r.d(e,"AudioLoader",function(){return es}),r.d(e,"SpotLightShadow",function(){return ma}),r.d(e,"SpotLight",function(){return va}),r.d(e,"PointLight",function(){return ga}),r.d(e,"RectAreaLight",function(){return wa}),r.d(e,"HemisphereLight",function(){return pa}),r.d(e,"DirectionalLightShadow",function(){return ya}),r.d(e,"DirectionalLight",function(){return xa}),r.d(e,"AmbientLight",function(){return ba}),r.d(e,"LightShadow",function(){return fa}),r.d(e,"Light",function(){return da}),r.d(e,"StereoCamera",function(){return rs}),r.d(e,"PerspectiveCamera",function(){return Gn}),r.d(e,"OrthographicCamera",function(){return lr}),r.d(e,"CubeCamera",function(){return ns}),r.d(e,"ArrayCamera",function(){return Hn}),r.d(e,"Camera",function(){return sr}),r.d(e,"AudioListener",function(){return is}),r.d(e,"PositionalAudio",function(){return as}),r.d(e,"AudioContext",function(){return ts}),r.d(e,"AudioAnalyser",function(){return ss}),r.d(e,"Audio",function(){return os}),r.d(e,"VectorKeyframeTrack",function(){return Ra}),r.d(e,"StringKeyframeTrack",function(){return _a}),r.d(e,"QuaternionKeyframeTrack",function(){return Aa}),r.d(e,"NumberKeyframeTrack",function(){return Ca}),r.d(e,"ColorKeyframeTrack",function(){return Ea}),r.d(e,"BooleanKeyframeTrack",function(){return Sa}),r.d(e,"PropertyMixer",function(){return ls}),r.d(e,"PropertyBinding",function(){return us}),r.d(e,"KeyframeTrack",function(){return Ia}),r.d(e,"AnimationUtils",function(){return La}),r.d(e,"AnimationObjectGroup",function(){return hs}),r.d(e,"AnimationMixer",function(){return ps}),r.d(e,"AnimationClip",function(){return Da}),r.d(e,"Uniform",function(){return fs}),r.d(e,"InstancedBufferGeometry",function(){return ms}),r.d(e,"BufferGeometry",function(){return Mr}),r.d(e,"Geometry",function(){return hr}),r.d(e,"InterleavedBufferAttribute",function(){return vs}),r.d(e,"InstancedInterleavedBuffer",function(){return ys}),r.d(e,"InterleavedBuffer",function(){return gs}),r.d(e,"InstancedBufferAttribute",function(){return xs}),r.d(e,"Face3",function(){return cr}),r.d(e,"Object3D",function(){return ar}),r.d(e,"Raycaster",function(){return bs}),r.d(e,"Layers",function(){return ir}),r.d(e,"EventDispatcher",function(){return n}),r.d(e,"Clock",function(){return Ss}),r.d(e,"QuaternionLinearInterpolant",function(){return Ma}),r.d(e,"LinearInterpolant",function(){return Oa}),r.d(e,"DiscreteInterpolant",function(){return Na}),r.d(e,"CubicInterpolant",function(){return Pa}),r.d(e,"Interpolant",function(){return Ta}),r.d(e,"Triangle",function(){return Fr}),r.d(e,"Math",function(){return De}),r.d(e,"Spherical",function(){return Ts}),r.d(e,"Cylindrical",function(){return Ms}),r.d(e,"Plane",function(){return Je}),r.d(e,"Frustum",function(){return Ze}),r.d(e,"Sphere",function(){return qe}),r.d(e,"Ray",function(){return Rr}),r.d(e,"Matrix4",function(){return Ue}),r.d(e,"Matrix3",function(){return je}),r.d(e,"Box3",function(){return Ye}),r.d(e,"Box2",function(){return As}),r.d(e,"Line3",function(){return Dr}),r.d(e,"Euler",function(){return nr}),r.d(e,"Vector4",function(){return Ge}),r.d(e,"Vector3",function(){return Be}),r.d(e,"Vector2",function(){return Fe}),r.d(e,"Quaternion",function(){return ke}),r.d(e,"Color",function(){return tr}),r.d(e,"ImmediateRenderObject",function(){return Es}),r.d(e,"VertexNormalsHelper",function(){return Cs}),r.d(e,"SpotLightHelper",function(){return Ps}),r.d(e,"SkeletonHelper",function(){return Os}),r.d(e,"PointLightHelper",function(){return Ns}),r.d(e,"RectAreaLightHelper",function(){return Ls}),r.d(e,"HemisphereLightHelper",function(){return Is}),r.d(e,"GridHelper",function(){return Rs}),r.d(e,"PolarGridHelper",function(){return Ds}),r.d(e,"FaceNormalsHelper",function(){return Fs}),r.d(e,"DirectionalLightHelper",function(){return Us}),r.d(e,"CameraHelper",function(){return ks}),r.d(e,"BoxHelper",function(){return Bs}),r.d(e,"Box3Helper",function(){return js}),r.d(e,"PlaneHelper",function(){return zs}),r.d(e,"ArrowHelper",function(){return Vs}),r.d(e,"AxesHelper",function(){return Gs}),r.d(e,"Shape",function(){return ha}),r.d(e,"Path",function(){return ua}),r.d(e,"ShapePath",function(){return qa}),r.d(e,"Font",function(){return Ja}),r.d(e,"CurvePath",function(){return ca}),r.d(e,"Curve",function(){return Go}),r.d(e,"ShapeUtils",function(){return Ki}),r.d(e,"WebGLUtils",function(){return Vn}),r.d(e,"WireframeGeometry",function(){return di}),r.d(e,"ParametricGeometry",function(){return pi}),r.d(e,"ParametricBufferGeometry",function(){return fi}),r.d(e,"TetrahedronGeometry",function(){return gi}),r.d(e,"TetrahedronBufferGeometry",function(){return yi}),r.d(e,"OctahedronGeometry",function(){return xi}),r.d(e,"OctahedronBufferGeometry",function(){return bi}),r.d(e,"IcosahedronGeometry",function(){return wi}),r.d(e,"IcosahedronBufferGeometry",function(){return _i}),r.d(e,"DodecahedronGeometry",function(){return Si}),r.d(e,"DodecahedronBufferGeometry",function(){return Ti}),r.d(e,"PolyhedronGeometry",function(){return mi}),r.d(e,"PolyhedronBufferGeometry",function(){return vi}),r.d(e,"TubeGeometry",function(){return Mi}),r.d(e,"TubeBufferGeometry",function(){return Ai}),r.d(e,"TorusKnotGeometry",function(){return Ei}),r.d(e,"TorusKnotBufferGeometry",function(){return Ci}),r.d(e,"TorusGeometry",function(){return Pi}),r.d(e,"TorusBufferGeometry",function(){return Oi}),r.d(e,"TextGeometry",function(){return no}),r.d(e,"TextBufferGeometry",function(){return io}),r.d(e,"SphereGeometry",function(){return oo}),r.d(e,"SphereBufferGeometry",function(){return ao}),r.d(e,"RingGeometry",function(){return so}),r.d(e,"RingBufferGeometry",function(){return lo}),r.d(e,"PlaneGeometry",function(){return Cr}),r.d(e,"PlaneBufferGeometry",function(){return Pr}),r.d(e,"LatheGeometry",function(){return co}),r.d(e,"LatheBufferGeometry",function(){return uo}),r.d(e,"ShapeGeometry",function(){return ho}),r.d(e,"ShapeBufferGeometry",function(){return po}),r.d(e,"ExtrudeGeometry",function(){return eo}),r.d(e,"ExtrudeBufferGeometry",function(){return ro}),r.d(e,"EdgesGeometry",function(){return mo}),r.d(e,"ConeGeometry",function(){return yo}),r.d(e,"ConeBufferGeometry",function(){return xo}),r.d(e,"CylinderGeometry",function(){return vo}),r.d(e,"CylinderBufferGeometry",function(){return go}),r.d(e,"CircleGeometry",function(){return bo}),r.d(e,"CircleBufferGeometry",function(){return wo}),r.d(e,"BoxGeometry",function(){return Ar}),r.d(e,"BoxBufferGeometry",function(){return Er}),r.d(e,"ShadowMaterial",function(){return So}),r.d(e,"SpriteMaterial",function(){return Zn}),r.d(e,"RawShaderMaterial",function(){return To}),r.d(e,"ShaderMaterial",function(){return Ir}),r.d(e,"PointsMaterial",function(){return ai}),r.d(e,"MeshPhysicalMaterial",function(){return Ao}),r.d(e,"MeshStandardMaterial",function(){return Mo}),r.d(e,"MeshPhongMaterial",function(){return Eo}),r.d(e,"MeshToonMaterial",function(){return Co}),r.d(e,"MeshNormalMaterial",function(){return Po}),r.d(e,"MeshLambertMaterial",function(){return Oo}),r.d(e,"MeshDepthMaterial",function(){return kn}),r.d(e,"MeshDistanceMaterial",function(){return Bn}),r.d(e,"MeshBasicMaterial",function(){return Lr}),r.d(e,"LineDashedMaterial",function(){return No}),r.d(e,"LineBasicMaterial",function(){return ri}),r.d(e,"Material",function(){return Nr}),r.d(e,"Float64BufferAttribute",function(){return wr}),r.d(e,"Float32BufferAttribute",function(){return br}),r.d(e,"Uint32BufferAttribute",function(){return xr}),r.d(e,"Int32BufferAttribute",function(){return yr}),r.d(e,"Uint16BufferAttribute",function(){return gr}),r.d(e,"Int16BufferAttribute",function(){return vr}),r.d(e,"Uint8ClampedBufferAttribute",function(){return mr}),r.d(e,"Uint8BufferAttribute",function(){return fr}),r.d(e,"Int8BufferAttribute",function(){return pr}),r.d(e,"BufferAttribute",function(){return dr}),r.d(e,"ArcCurve",function(){return Wo}),r.d(e,"CatmullRomCurve3",function(){return Qo}),r.d(e,"CubicBezierCurve",function(){return ea}),r.d(e,"CubicBezierCurve3",function(){return ra}),r.d(e,"EllipseCurve",function(){return Ho}),r.d(e,"LineCurve",function(){return na}),r.d(e,"LineCurve3",function(){return ia}),r.d(e,"QuadraticBezierCurve",function(){return oa}),r.d(e,"QuadraticBezierCurve3",function(){return aa}),r.d(e,"SplineCurve",function(){return sa}),r.d(e,"REVISION",function(){return i}),r.d(e,"MOUSE",function(){return o}),r.d(e,"CullFaceNone",function(){return a}),r.d(e,"CullFaceBack",function(){return s}),r.d(e,"CullFaceFront",function(){return l}),r.d(e,"CullFaceFrontBack",function(){return c}),r.d(e,"FrontFaceDirectionCW",function(){return u}),r.d(e,"FrontFaceDirectionCCW",function(){return h}),r.d(e,"BasicShadowMap",function(){return d}),r.d(e,"PCFShadowMap",function(){return p}),r.d(e,"PCFSoftShadowMap",function(){return f}),r.d(e,"FrontSide",function(){return m}),r.d(e,"BackSide",function(){return v}),r.d(e,"DoubleSide",function(){return g}),r.d(e,"FlatShading",function(){return y}),r.d(e,"SmoothShading",function(){return x}),r.d(e,"NoColors",function(){return b}),r.d(e,"FaceColors",function(){return w}),r.d(e,"VertexColors",function(){return _}),r.d(e,"NoBlending",function(){return S}),r.d(e,"NormalBlending",function(){return T}),r.d(e,"AdditiveBlending",function(){return M}),r.d(e,"SubtractiveBlending",function(){return A}),r.d(e,"MultiplyBlending",function(){return E}),r.d(e,"CustomBlending",function(){return C}),r.d(e,"AddEquation",function(){return P}),r.d(e,"SubtractEquation",function(){return O}),r.d(e,"ReverseSubtractEquation",function(){return N}),r.d(e,"MinEquation",function(){return L}),r.d(e,"MaxEquation",function(){return I}),r.d(e,"ZeroFactor",function(){return R}),r.d(e,"OneFactor",function(){return D}),r.d(e,"SrcColorFactor",function(){return F}),r.d(e,"OneMinusSrcColorFactor",function(){return U}),r.d(e,"SrcAlphaFactor",function(){return k}),r.d(e,"OneMinusSrcAlphaFactor",function(){return B}),r.d(e,"DstAlphaFactor",function(){return j}),r.d(e,"OneMinusDstAlphaFactor",function(){return z}),r.d(e,"DstColorFactor",function(){return V}),r.d(e,"OneMinusDstColorFactor",function(){return G}),r.d(e,"SrcAlphaSaturateFactor",function(){return H}),r.d(e,"NeverDepth",function(){return W}),r.d(e,"AlwaysDepth",function(){return X}),r.d(e,"LessDepth",function(){return Y}),r.d(e,"LessEqualDepth",function(){return q}),r.d(e,"EqualDepth",function(){return J}),r.d(e,"GreaterEqualDepth",function(){return Z}),r.d(e,"GreaterDepth",function(){return Q}),r.d(e,"NotEqualDepth",function(){return K}),r.d(e,"MultiplyOperation",function(){return $}),r.d(e,"MixOperation",function(){return tt}),r.d(e,"AddOperation",function(){return et}),r.d(e,"NoToneMapping",function(){return rt}),r.d(e,"LinearToneMapping",function(){return nt}),r.d(e,"ReinhardToneMapping",function(){return it}),r.d(e,"Uncharted2ToneMapping",function(){return ot}),r.d(e,"CineonToneMapping",function(){return at}),r.d(e,"UVMapping",function(){return st}),r.d(e,"CubeReflectionMapping",function(){return lt}),r.d(e,"CubeRefractionMapping",function(){return ct}),r.d(e,"EquirectangularReflectionMapping",function(){return ut}),r.d(e,"EquirectangularRefractionMapping",function(){return ht}),r.d(e,"SphericalReflectionMapping",function(){return dt}),r.d(e,"CubeUVReflectionMapping",function(){return pt}),r.d(e,"CubeUVRefractionMapping",function(){return ft}),r.d(e,"RepeatWrapping",function(){return mt}),r.d(e,"ClampToEdgeWrapping",function(){return vt}),r.d(e,"MirroredRepeatWrapping",function(){return gt}),r.d(e,"NearestFilter",function(){return yt}),r.d(e,"NearestMipMapNearestFilter",function(){return xt}),r.d(e,"NearestMipMapLinearFilter",function(){return bt}),r.d(e,"LinearFilter",function(){return wt}),r.d(e,"LinearMipMapNearestFilter",function(){return _t}),r.d(e,"LinearMipMapLinearFilter",function(){return St}),r.d(e,"UnsignedByteType",function(){return Tt}),r.d(e,"ByteType",function(){return Mt}),r.d(e,"ShortType",function(){return At}),r.d(e,"UnsignedShortType",function(){return Et}),r.d(e,"IntType",function(){return Ct}),r.d(e,"UnsignedIntType",function(){return Pt}),r.d(e,"FloatType",function(){return Ot}),r.d(e,"HalfFloatType",function(){return Nt}),r.d(e,"UnsignedShort4444Type",function(){return Lt}),r.d(e,"UnsignedShort5551Type",function(){return It}),r.d(e,"UnsignedShort565Type",function(){return Rt}),r.d(e,"UnsignedInt248Type",function(){return Dt}),r.d(e,"AlphaFormat",function(){return Ft}),r.d(e,"RGBFormat",function(){return Ut}),r.d(e,"RGBAFormat",function(){return kt}),r.d(e,"LuminanceFormat",function(){return Bt}),r.d(e,"LuminanceAlphaFormat",function(){return jt}),r.d(e,"RGBEFormat",function(){return zt}),r.d(e,"DepthFormat",function(){return Vt}),r.d(e,"DepthStencilFormat",function(){return Gt}),r.d(e,"RGB_S3TC_DXT1_Format",function(){return Ht}),r.d(e,"RGBA_S3TC_DXT1_Format",function(){return Wt}),r.d(e,"RGBA_S3TC_DXT3_Format",function(){return Xt}),r.d(e,"RGBA_S3TC_DXT5_Format",function(){return Yt}),r.d(e,"RGB_PVRTC_4BPPV1_Format",function(){return qt}),r.d(e,"RGB_PVRTC_2BPPV1_Format",function(){return Jt}),r.d(e,"RGBA_PVRTC_4BPPV1_Format",function(){return Zt}),r.d(e,"RGBA_PVRTC_2BPPV1_Format",function(){return Qt}),r.d(e,"RGB_ETC1_Format",function(){return Kt}),r.d(e,"RGBA_ASTC_4x4_Format",function(){return $t}),r.d(e,"RGBA_ASTC_5x4_Format",function(){return te}),r.d(e,"RGBA_ASTC_5x5_Format",function(){return ee}),r.d(e,"RGBA_ASTC_6x5_Format",function(){return re}),r.d(e,"RGBA_ASTC_6x6_Format",function(){return ne}),r.d(e,"RGBA_ASTC_8x5_Format",function(){return ie}),r.d(e,"RGBA_ASTC_8x6_Format",function(){return oe}),r.d(e,"RGBA_ASTC_8x8_Format",function(){return ae}),r.d(e,"RGBA_ASTC_10x5_Format",function(){return se}),r.d(e,"RGBA_ASTC_10x6_Format",function(){return le}),r.d(e,"RGBA_ASTC_10x8_Format",function(){return ce}),r.d(e,"RGBA_ASTC_10x10_Format",function(){return ue}),r.d(e,"RGBA_ASTC_12x10_Format",function(){return he}),r.d(e,"RGBA_ASTC_12x12_Format",function(){return de}),r.d(e,"LoopOnce",function(){return pe}),r.d(e,"LoopRepeat",function(){return fe}),r.d(e,"LoopPingPong",function(){return me}),r.d(e,"InterpolateDiscrete",function(){return ve}),r.d(e,"InterpolateLinear",function(){return ge}),r.d(e,"InterpolateSmooth",function(){return ye}),r.d(e,"ZeroCurvatureEnding",function(){return xe}),r.d(e,"ZeroSlopeEnding",function(){return be}),r.d(e,"WrapAroundEnding",function(){return we}),r.d(e,"TrianglesDrawMode",function(){return _e}),r.d(e,"TriangleStripDrawMode",function(){return Se}),r.d(e,"TriangleFanDrawMode",function(){return Te}),r.d(e,"LinearEncoding",function(){return Me}),r.d(e,"sRGBEncoding",function(){return Ae}),r.d(e,"GammaEncoding",function(){return Ee}),r.d(e,"RGBEEncoding",function(){return Ce}),r.d(e,"LogLuvEncoding",function(){return Pe}),r.d(e,"RGBM7Encoding",function(){return Oe}),r.d(e,"RGBM16Encoding",function(){return Ne}),r.d(e,"RGBDEncoding",function(){return Le}),r.d(e,"BasicDepthPacking",function(){return Ie}),r.d(e,"RGBADepthPacking",function(){return Re}),r.d(e,"CubeGeometry",function(){return Ar}),r.d(e,"Face4",function(){return Hs}),r.d(e,"LineStrip",function(){return Ws}),r.d(e,"LinePieces",function(){return Xs}),r.d(e,"MeshFaceMaterial",function(){return Ys}),r.d(e,"MultiMaterial",function(){return qs}),r.d(e,"PointCloud",function(){return Js}),r.d(e,"Particle",function(){return Zs}),r.d(e,"ParticleSystem",function(){return Qs}),r.d(e,"PointCloudMaterial",function(){return Ks}),r.d(e,"ParticleBasicMaterial",function(){return $s}),r.d(e,"ParticleSystemMaterial",function(){return tl}),r.d(e,"Vertex",function(){return el}),r.d(e,"DynamicBufferAttribute",function(){return rl}),r.d(e,"Int8Attribute",function(){return nl}),r.d(e,"Uint8Attribute",function(){return il}),r.d(e,"Uint8ClampedAttribute",function(){return ol}),r.d(e,"Int16Attribute",function(){return al}),r.d(e,"Uint16Attribute",function(){return sl}),r.d(e,"Int32Attribute",function(){return ll}),r.d(e,"Uint32Attribute",function(){return cl}),r.d(e,"Float32Attribute",function(){return ul}),r.d(e,"Float64Attribute",function(){return hl}),r.d(e,"ClosedSplineCurve3",function(){return dl}),r.d(e,"SplineCurve3",function(){return pl}),r.d(e,"Spline",function(){return fl}),r.d(e,"AxisHelper",function(){return ml}),r.d(e,"BoundingBoxHelper",function(){return vl}),r.d(e,"EdgesHelper",function(){return gl}),r.d(e,"WireframeHelper",function(){return yl}),r.d(e,"XHRLoader",function(){return xl}),r.d(e,"BinaryTextureLoader",function(){return bl}),r.d(e,"GeometryUtils",function(){return wl}),r.d(e,"ImageUtils",function(){return _l}),r.d(e,"Projector",function(){return Sl}),r.d(e,"CanvasRenderer",function(){return Tl}),r.d(e,"SceneUtils",function(){return Ml}),r.d(e,"LensFlare",function(){return Al}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}),Object.assign(n.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}});var i="91",o={LEFT:0,MIDDLE:1,RIGHT:2},a=0,s=1,l=2,c=3,u=0,h=1,d=0,p=1,f=2,m=0,v=1,g=2,y=1,x=2,b=0,w=1,_=2,S=0,T=1,M=2,A=3,E=4,C=5,P=100,O=101,N=102,L=103,I=104,R=200,D=201,F=202,U=203,k=204,B=205,j=206,z=207,V=208,G=209,H=210,W=0,X=1,Y=2,q=3,J=4,Z=5,Q=6,K=7,$=0,tt=1,et=2,rt=0,nt=1,it=2,ot=3,at=4,st=300,lt=301,ct=302,ut=303,ht=304,dt=305,pt=306,ft=307,mt=1e3,vt=1001,gt=1002,yt=1003,xt=1004,bt=1005,wt=1006,_t=1007,St=1008,Tt=1009,Mt=1010,At=1011,Et=1012,Ct=1013,Pt=1014,Ot=1015,Nt=1016,Lt=1017,It=1018,Rt=1019,Dt=1020,Ft=1021,Ut=1022,kt=1023,Bt=1024,jt=1025,zt=kt,Vt=1026,Gt=1027,Ht=33776,Wt=33777,Xt=33778,Yt=33779,qt=35840,Jt=35841,Zt=35842,Qt=35843,Kt=36196,$t=37808,te=37809,ee=37810,re=37811,ne=37812,ie=37813,oe=37814,ae=37815,se=37816,le=37817,ce=37818,ue=37819,he=37820,de=37821,pe=2200,fe=2201,me=2202,ve=2300,ge=2301,ye=2302,xe=2400,be=2401,we=2402,_e=0,Se=1,Te=2,Me=3e3,Ae=3001,Ee=3007,Ce=3002,Pe=3003,Oe=3004,Ne=3005,Le=3006,Ie=3200,Re=3201,De={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}(),clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*De.DEG2RAD},radToDeg:function(t){return t*De.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Fe(t,e){this.x=t||0,this.y=e||0}function Ue(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function ke(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}function Be(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}function je(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Fe.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Fe.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new Fe,e=new Fe;return function(r,n){return t.set(r,r),e.set(n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*r-o*n+t.x,this.y=i*n+o*r+t.y,this}}),Object.assign(Ue.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,o,a,s,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Ue).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new Be;return function(e){var r=this.elements,n=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),a=1/t.setFromMatrixColumn(e,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*a,r[9]=n[9]*a,r[10]=n[10]*a,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){var h=o*c,d=o*u,p=a*c,f=a*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=d+p*l,e[5]=h-f*l,e[9]=-a*s,e[2]=f-h*l,e[6]=p+d*l,e[10]=o*s}else if("YXZ"===t.order){var m=s*u,v=l*c;e[0]=(g=s*c)+(y=l*u)*a,e[4]=v*a-m,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-a,e[2]=m*a-v,e[6]=y+g*a,e[10]=o*s}else if("ZXY"===t.order){var g,y;m=s*u,v=l*c,e[0]=(g=s*c)-(y=l*u)*a,e[4]=-o*u,e[8]=v+m*a,e[1]=m+v*a,e[5]=o*c,e[9]=y-g*a,e[2]=-o*l,e[6]=a,e[10]=o*s}else if("ZYX"===t.order)h=o*c,d=o*u,p=a*c,f=a*u,e[0]=s*c,e[4]=p*l-d,e[8]=h*l+f,e[1]=s*u,e[5]=f*l+h,e[9]=d*l-p,e[2]=-l,e[6]=a*s,e[10]=o*s;else if("YZX"===t.order){var x=o*s,b=o*l,w=a*s,_=a*l;e[0]=s*c,e[4]=_-x*u,e[8]=w*u+b,e[1]=u,e[5]=o*c,e[9]=-a*c,e[2]=-l*c,e[6]=b*u+w,e[10]=x-_*u}else"XZY"===t.order&&(x=o*s,b=o*l,w=a*s,_=a*l,e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=x*u+_,e[5]=o*c,e[9]=b*u-w,e[2]=w*u-b,e[6]=a*c,e[10]=_*u+x);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,r=t._x,n=t._y,i=t._z,o=t._w,a=r+r,s=n+n,l=i+i,c=r*a,u=r*s,h=r*l,d=n*s,p=n*l,f=i*l,m=o*a,v=o*s,g=o*l;return e[0]=1-(d+f),e[4]=u-g,e[8]=h+v,e[1]=u+g,e[5]=1-(c+f),e[9]=p-m,e[2]=h-v,e[6]=p+m,e[10]=1-(c+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new Be,e=new Be,r=new Be;return function(n,i,o){var a=this.elements;return r.subVectors(n,i),0===r.lengthSq()&&(r.z=1),r.normalize(),t.crossVectors(o,r),0===t.lengthSq()&&(1===Math.abs(o.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),t.crossVectors(o,r)),t.normalize(),e.crossVectors(r,t),a[0]=t.x,a[4]=e.x,a[8]=r.x,a[1]=t.y,a[5]=e.y,a[9]=r.y,a[2]=t.z,a[6]=e.z,a[10]=r.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=n[0],_=n[4],S=n[8],T=n[12],M=n[1],A=n[5],E=n[9],C=n[13],P=n[2],O=n[6],N=n[10],L=n[14],I=n[3],R=n[7],D=n[11],F=n[15];return i[0]=o*w+a*M+s*P+l*I,i[4]=o*_+a*A+s*O+l*R,i[8]=o*S+a*E+s*N+l*D,i[12]=o*T+a*C+s*L+l*F,i[1]=c*w+u*M+h*P+d*I,i[5]=c*_+u*A+h*O+d*R,i[9]=c*S+u*E+h*N+d*D,i[13]=c*T+u*C+h*L+d*F,i[2]=p*w+f*M+m*P+v*I,i[6]=p*_+f*A+m*O+v*R,i[10]=p*S+f*E+m*N+v*D,i[14]=p*T+f*C+m*L+v*F,i[3]=g*w+y*M+x*P+b*I,i[7]=g*_+y*A+x*O+b*R,i[11]=g*S+y*E+x*N+b*D,i[15]=g*T+y*C+x*L+b*F,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new Be;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix4(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*s*u-n*l*u-i*a*h+r*l*h+n*a*d-r*s*d)+t[7]*(+e*s*d-e*l*h+i*o*h-n*o*d+n*l*c-i*s*c)+t[11]*(+e*l*u-e*a*d-i*o*u+r*o*d+i*a*c-r*l*c)+t[15]*(-n*a*c-e*s*u+e*a*h+n*o*u-r*o*h+r*s*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],b=p*y*h-g*f*h+g*u*m-c*y*m-p*u*x+c*f*x,w=v*f*h-d*y*h-v*u*m+l*y*m+d*u*x-l*f*x,_=d*g*h-v*p*h+v*c*m-l*g*m-d*c*x+l*p*x,S=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,T=i*b+o*w+a*_+s*S;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return r[0]=b*A,r[1]=(g*f*s-p*y*s-g*a*m+o*y*m+p*a*x-o*f*x)*A,r[2]=(c*y*s-g*u*s+g*a*h-o*y*h-c*a*x+o*u*x)*A,r[3]=(p*u*s-c*f*s-p*a*h+o*f*h+c*a*m-o*u*m)*A,r[4]=w*A,r[5]=(d*y*s-v*f*s+v*a*m-i*y*m-d*a*x+i*f*x)*A,r[6]=(v*u*s-l*y*s-v*a*h+i*y*h+l*a*x-i*u*x)*A,r[7]=(l*f*s-d*u*s+d*a*h-i*f*h-l*a*m+i*u*m)*A,r[8]=_*A,r[9]=(v*p*s-d*g*s-v*o*m+i*g*m+d*o*x-i*p*x)*A,r[10]=(l*g*s-v*c*s+v*o*h-i*g*h-l*o*x+i*c*x)*A,r[11]=(d*c*s-l*p*s-d*o*h+i*p*h+l*o*m-i*c*m)*A,r[12]=S*A,r[13]=(d*g*a-v*p*a+v*o*f-i*g*f-d*o*y+i*p*y)*A,r[14]=(v*c*a-l*g*a-v*o*u+i*g*u+l*o*y-i*c*y)*A,r[15]=(l*p*a-d*c*a+d*o*u-i*p*u-l*o*f+i*c*f)*A,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,o=t.x,a=t.y,s=t.z,l=i*o,c=i*a;return this.set(l*o+r,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+r,c*s-n*o,0,l*s-n*a,c*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:function(){var t=new Be,e=new Ue;return function(r,n,i){var o=this.elements,a=t.set(o[0],o[1],o[2]).length(),s=t.set(o[4],o[5],o[6]).length(),l=t.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),r.x=o[12],r.y=o[13],r.z=o[14],e.copy(this);var c=1/a,u=1/s,h=1/l;return e.elements[0]*=c,e.elements[1]*=c,e.elements[2]*=c,e.elements[4]*=u,e.elements[5]*=u,e.elements[6]*=u,e.elements[8]*=h,e.elements[9]*=h,e.elements[10]*=h,n.setFromRotationMatrix(e),i.x=a,i.y=s,i.z=l,this}}(),makePerspective:function(t,e,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(r-n),l=(e+t)/(e-t),c=(r+n)/(r-n),u=-(o+i)/(o-i),h=-2*o*i/(o-i);return a[0]=2*i/(e-t),a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=s,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,r,n,i,o){var a=this.elements,s=1/(e-t),l=1/(r-n),c=1/(o-i),u=(e+t)*s,h=(r+n)*l,d=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}),Object.assign(ke,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,o,a){var s=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||s!==h||l!==d||c!==p){var m=1-a,v=s*h+l*d+c*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,a=Math.sin(a*b)/x}var w=a*g;if(s=s*m+h*w,l=l*m+d*w,c=c*m+p*w,u=u*m+f*w,m===1-a){var _=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=_,l*=_,c*=_,u*=_}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u}}),Object.defineProperties(ke.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(ke.prototype,{set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,o=t.order,a=Math.cos,s=Math.sin,l=a(r/2),c=a(n/2),u=a(i/2),h=s(r/2),d=s(n/2),p=s(i/2);return"XYZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===o&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+s+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-l)*e,this._y=(o-c)*e,this._z=(a-i)*e):n>s&&n>h?(e=2*Math.sqrt(1+n-s-h),this._w=(u-l)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+c)/e):s>h?(e=2*Math.sqrt(1+s-n-h),this._w=(o-c)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(l+u)/e):(e=2*Math.sqrt(1+h-n-s),this._w=(a-i)/e,this._x=(o+c)/e,this._y=(l+u)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new Be;return function(r,n){return void 0===e&&(e=new Be),(t=r.dot(n)+1)<1e-6?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,o=t._w,a=e._x,s=e._y,l=e._z,c=e._w;return this._x=r*c+o*a+n*l-i*s,this._y=n*c+o*s+i*a-r*l,this._z=i*c+o*l+r*s-n*a,this._w=o*c-r*a-n*s-i*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*t._w+r*t._x+n*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var l=Math.atan2(s,a),c=Math.sin((1-e)*l)/s,u=Math.sin(e*l)/s;return this._w=o*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Be.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new ke;return function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new ke;return function(e,r){return this.applyQuaternion(t.setFromAxisAngle(e,r))}}(),applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,o=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,s=t.w,l=s*e+o*n-a*r,c=s*r+a*e-i*n,u=s*n+i*r-o*e,h=-i*e-o*r-a*n;return this.x=l*s+h*-i+c*-a-u*-o,this.y=c*s+h*-o+u*-i-l*-a,this.z=u*s+h*-a+l*-o-c*-i,this},project:function(){var t=new Ue;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new Ue;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new Be,e=new Be;return function(r,n){return t.set(r,r,r),e.set(n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new Be;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new Be;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(De.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(je.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,o,a,s,l){var c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Be;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix3(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return i[0]=o*f+a*g+s*b,i[3]=o*m+a*y+s*w,i[6]=o*v+a*x+s*_,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*w,i[7]=l*v+c*x+u*_,i[2]=h*f+d*g+p*b,i[5]=h*m+d*y+p*w,i[8]=h*v+d*x+p*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8];return e*o*c-e*a*l-r*i*c+r*a*s+n*i*l-n*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,n=this.elements,i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,v=i*p+o*f+a*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(a*h-d*o)*y,n[2]=(c*o-a*l)*y,n[3]=f*y,n[4]=(d*i-a*u)*y,n[5]=(a*s-c*i)*y,n[6]=m*y,n[7]=(o*u-h*i)*y,n[8]=(l*i-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,o,a){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*o+l*a)+o+t,-n*l,n*s,-n*(-l*o+s*a)+a+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],o=n[3],a=n[6],s=n[1],l=n[4],c=n[7];return n[0]=e*i+r*s,n[3]=e*o+r*l,n[6]=e*a+r*c,n[1]=-r*i+e*s,n[4]=-r*o+e*l,n[7]=-r*a+e*c,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var ze=0;function Ve(t,e,r,n,i,o,a,s,l,c){Object.defineProperty(this,"id",{value:ze++}),this.uuid=De.generateUUID(),this.name="",this.image=void 0!==t?t:Ve.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Ve.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:vt,this.wrapT=void 0!==n?n:vt,this.magFilter=void 0!==i?i:wt,this.minFilter=void 0!==o?o:St,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:kt,this.type=void 0!==s?s:Tt,this.offset=new Fe(0,0),this.repeat=new Fe(1,1),this.center=new Fe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new je,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Me,this.version=0,this.onUpdate=null}function Ge(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function He(t,e,r){this.width=t,this.height=e,this.scissor=new Ge(0,0,t,e),this.scissorTest=!1,this.viewport=new Ge(0,0,t,e),void 0===(r=r||{}).minFilter&&(r.minFilter=wt),this.texture=new Ve(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function We(t,e,r){He.call(this,t,e,r),this.activeCubeFace=0,this.activeMipMapLevel=0}function Xe(t,e,r,n,i,o,a,s,l,c,u,h){Ve.call(this,null,o,a,s,l,c,n,i,u,h),this.image={data:t,width:e,height:r},this.magFilter=void 0!==l?l:yt,this.minFilter=void 0!==c?c:yt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Ye(t,e){this.min=void 0!==t?t:new Be(1/0,1/0,1/0),this.max=void 0!==e?e:new Be(-1/0,-1/0,-1/0)}function qe(t,e){this.center=void 0!==t?t:new Be,this.radius=void 0!==e?e:0}function Je(t,e){this.normal=void 0!==t?t:new Be(1,0,0),this.constant=void 0!==e?e:0}function Ze(t,e,r,n,i,o){this.planes=[void 0!==t?t:new Je,void 0!==e?e:new Je,void 0!==r?r:new Je,void 0!==n?n:new Je,void 0!==i?i:new Je,void 0!==o?o:new Je]}Ve.DEFAULT_IMAGE=void 0,Ve.DEFAULT_MAPPING=st,Ve.prototype=Object.assign(Object.create(n.prototype),{constructor:Ve,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=De.generateUUID()),e||void 0!==t.images[n.uuid]||(t.images[n.uuid]={uuid:n.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var r=e.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(n)}),r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===st){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case mt:t.x=t.x-Math.floor(t.x);break;case vt:t.x=t.x<0?0:1;break;case gt:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case mt:t.y=t.y-Math.floor(t.y);break;case vt:t.y=t.y<0?0:1;break;case gt:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(Ve.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ge.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,o=t.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(a+1)/2,v=(u+1)/2,g=(f+1)/2,y=(s+c)/4,x=(l+d)/4,b=(h+p)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=x/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(g)),n=b/i),this.set(r,n,i,e),this}var w=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-d)/w,this.z=(c-s)/w,this.w=Math.acos((a+u+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(r,n){return void 0===t&&(t=new Ge,e=new Ge),t.set(r,r,r,r),e.set(n,n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),He.prototype=Object.assign(Object.create(n.prototype),{constructor:He,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(We.prototype=Object.create(He.prototype)).constructor=We,We.prototype.isWebGLRenderTargetCube=!0,(Xe.prototype=Object.create(Ve.prototype)).constructor=Xe,Xe.prototype.isDataTexture=!0,Object.assign(Ye.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var c=t[s],u=t[s+1],h=t[s+2];c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var c=t.getX(s),u=t.getY(s),h=t.getZ(s);c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Be;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Be),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Be),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,r,n=new Be;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(e=0,r=a.length;e<r;e++)n.copy(a[e]),n.applyMatrix4(i.matrixWorld),t.expandByPoint(n)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(e=0,r=s.count;e<r;e++)n.fromBufferAttribute(s,e).applyMatrix4(i.matrixWorld),t.expandByPoint(n)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(i),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Be),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new Be;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=t.constant&&r>=t.constant},intersectsTriangle:function(){var t=new Be,e=new Be,r=new Be,n=new Be,i=new Be,o=new Be,a=new Be,s=new Be,l=new Be,c=new Be;function u(n){var i,o;for(i=0,o=n.length-3;i<=o;i+=3){a.fromArray(n,i);var s=l.x*Math.abs(a.x)+l.y*Math.abs(a.y)+l.z*Math.abs(a.z),c=t.dot(a),u=e.dot(a),h=r.dot(a);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)return!1}return!0}return function(a){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),t.subVectors(a.a,s),e.subVectors(a.b,s),r.subVectors(a.c,s),n.subVectors(e,t),i.subVectors(r,e),o.subVectors(t,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-o.z,o.y,n.z,0,-n.x,i.z,0,-i.x,o.z,0,-o.x,-n.y,n.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!u(h)&&!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(n,i),u(h=[c.x,c.y,c.z]))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Be),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Be;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new Be;return function(e){return void 0===e&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),e=new qe),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new Be,new Be,new Be,new Be,new Be,new Be,new Be,new Be];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(qe.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new Ye;return function(e,r){var n=this.center;void 0!==r?n.copy(r):t.setFromPoints(e).getCenter(n);for(var i=0,o=0,a=e.length;o<a;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Be),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ye),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(Je.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Be,e=new Be;return function(r,n,i){var o=t.subVectors(i,n).cross(e.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Be),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Be;return function(e,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Be);var n=e.delta(t),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:r.copy(n).multiplyScalar(o).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Be),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Be,e=new je;return function(r,n){var i=n||e.getNormalMatrix(r),o=this.coplanarPoint(t).applyMatrix4(r),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(Ze.prototype,{set:function(t,e,r,n,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return e[0].setComponents(a-n,u-s,f-h,y-m).normalize(),e[1].setComponents(a+n,u+s,f+h,y+m).normalize(),e[2].setComponents(a+i,u+l,f+d,y+v).normalize(),e[3].setComponents(a-i,u-l,f-d,y-v).normalize(),e[4].setComponents(a-o,u-c,f-p,y-g).normalize(),e[5].setComponents(a+o,u+c,f+p,y+g).normalize(),this},intersectsObject:function(){var t=new qe;return function(e){var r=e.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),t.copy(r.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new qe;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:function(){var t=new Be,e=new Be;return function(r){for(var n=this.planes,i=0;i<6;i++){var o=n[i];t.x=o.normal.x>0?r.min.x:r.max.x,e.x=o.normal.x>0?r.max.x:r.min.x,t.y=o.normal.y>0?r.min.y:r.max.y,e.y=o.normal.y>0?r.max.y:r.min.y,t.z=o.normal.z>0?r.min.z:r.max.z,e.z=o.normal.z>0?r.max.z:r.min.z;var a=o.distanceToPoint(t),s=o.distanceToPoint(e);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var Qe={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},Ke={merge:function(t){for(var e={},r=0;r<t.length;r++){var n=this.clone(t[r]);for(var i in n)e[i]=n[i]}return e},clone:function(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];e[r][n]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return e}},$e={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function tr(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}Object.assign(tr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(){function t(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}return function(e,r,n){if(e=De.euclideanModulo(e,1),r=De.clamp(r,0,1),n=De.clamp(n,0,1),0===r)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+r):n+r-n*r,o=2*n-i;this.r=t(o,i,e+1/3),this.g=t(o,i,e),this.b=t(o,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[2];switch(r[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(n[1])/360,a=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(o,a,s)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,c=(l=r[1]).length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&t.length>0&&(void 0!==(l=$e[t])?this.setHex(l):console.warn("THREE.Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(){var t=this.r,e=this.g,r=this.b;return this.r=t*t,this.g=e*e,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,o=this.b,a=Math.max(n,i,o),s=Math.min(n,i,o),l=(s+a)/2;if(s===a)e=0,r=0;else{var c=a-s;switch(r=l<=.5?c/(a+s):c/(2-a-s),a){case n:e=(i-o)/c+(i<o?6:0);break;case i:e=(o-n)/c+2;break;case o:e=(n-i)/c+4}e/=6}return t.h=e,t.s=r,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var t={};return function(e,r,n){return this.getHSL(t),t.h+=e,t.s+=r,t.l+=n,this.setHSL(t.h,t.s,t.l),this}}(),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var er={common:{diffuse:{value:new tr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new je},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Fe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tr(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new tr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new je}}},rr={basic:{uniforms:Ke.merge([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.fog]),vertexShader:Qe.meshbasic_vert,fragmentShader:Qe.meshbasic_frag},lambert:{uniforms:Ke.merge([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.fog,er.lights,{emissive:{value:new tr(0)}}]),vertexShader:Qe.meshlambert_vert,fragmentShader:Qe.meshlambert_frag},phong:{uniforms:Ke.merge([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.bumpmap,er.normalmap,er.displacementmap,er.gradientmap,er.fog,er.lights,{emissive:{value:new tr(0)},specular:{value:new tr(1118481)},shininess:{value:30}}]),vertexShader:Qe.meshphong_vert,fragmentShader:Qe.meshphong_frag},standard:{uniforms:Ke.merge([er.common,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.bumpmap,er.normalmap,er.displacementmap,er.roughnessmap,er.metalnessmap,er.fog,er.lights,{emissive:{value:new tr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Qe.meshphysical_vert,fragmentShader:Qe.meshphysical_frag},points:{uniforms:Ke.merge([er.points,er.fog]),vertexShader:Qe.points_vert,fragmentShader:Qe.points_frag},dashed:{uniforms:Ke.merge([er.common,er.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qe.linedashed_vert,fragmentShader:Qe.linedashed_frag},depth:{uniforms:Ke.merge([er.common,er.displacementmap]),vertexShader:Qe.depth_vert,fragmentShader:Qe.depth_frag},normal:{uniforms:Ke.merge([er.common,er.bumpmap,er.normalmap,er.displacementmap,{opacity:{value:1}}]),vertexShader:Qe.normal_vert,fragmentShader:Qe.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Qe.cube_vert,fragmentShader:Qe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qe.equirect_vert,fragmentShader:Qe.equirect_frag},distanceRGBA:{uniforms:Ke.merge([er.common,er.displacementmap,{referencePosition:{value:new Be},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qe.distanceRGBA_vert,fragmentShader:Qe.distanceRGBA_frag},shadow:{uniforms:Ke.merge([er.lights,er.fog,{color:{value:new tr(0)},opacity:{value:1}}]),vertexShader:Qe.shadow_vert,fragmentShader:Qe.shadow_frag}};function nr(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||nr.DefaultOrder}function ir(){this.mask=1}rr.physical={uniforms:Ke.merge([rr.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Qe.meshphysical_vert,fragmentShader:Qe.meshphysical_frag},nr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],nr.DefaultOrder="XYZ",Object.defineProperties(nr.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(nr.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=De.clamp,i=t.elements,o=i[0],a=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===e?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new Ue;return function(e,r,n){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,r,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new ke;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Be(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(ir.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var or=0;function ar(){Object.defineProperty(this,"id",{value:or++}),this.uuid=De.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ar.DefaultUp.clone();var t=new Be,e=new nr,r=new ke,n=new Be(1,1,1);e.onChange(function(){r.setFromEuler(e,!1)}),r.onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new Ue},normalMatrix:{value:new je}}),this.matrix=new Ue,this.matrixWorld=new Ue,this.matrixAutoUpdate=ar.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ir,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function sr(){ar.call(this),this.type="Camera",this.matrixWorldInverse=new Ue,this.projectionMatrix=new Ue}function lr(t,e,r,n,i,o){sr.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function cr(t,e,r,n,i,o){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new Be,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new tr,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}ar.DefaultUp=new Be(0,1,0),ar.DefaultMatrixAutoUpdate=!0,ar.prototype=Object.assign(Object.create(n.prototype),{constructor:ar,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new ke;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.multiply(t),this}}(),rotateOnWorldAxis:function(){var t=new ke;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new Be(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new Be(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new Be(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new Be;return function(e,r){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(r)),this}}(),translateX:function(){var t=new Be(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new Be(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new Be(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new Ue;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new Ue,e=new Be;return function(r,n,i){r.isVector3?e.copy(r):e.set(r,n,i),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Be),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new Be,e=new Be;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),r=new ke),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,e),r}}(),getWorldScale:function(){var t=new Be,e=new ke;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Be),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new ke;return function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Be),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++)i(t.shapes,a[s]);else i(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(i(t.materials,this.material[s]));n.material=c}else n.material=i(t.materials,this.material);if(this.children.length>0)for(n.children=[],s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(t).object);if(e){var u=f(t.geometries),h=f(t.materials),d=f(t.textures),p=f(t.images);a=f(t.shapes),u.length>0&&(r.geometries=u),h.length>0&&(r.materials=h),d.length>0&&(r.textures=d),p.length>0&&(r.images=p),a.length>0&&(r.shapes=a)}return r.object=n,r;function f(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}),sr.prototype=Object.assign(Object.create(ar.prototype),{constructor:sr,isCamera:!0,copy:function(t,e){return ar.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new ke;return function(e){return void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Be),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){ar.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),lr.prototype=Object.assign(Object.create(sr.prototype),{constructor:lr,isOrthographicCamera:!0,copy:function(t,e){return sr.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,o=r+t,a=n+e,s=n-e;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(a-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far)},toJSON:function(t){var e=ar.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Object.assign(cr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var ur=0;function hr(){Object.defineProperty(this,"id",{value:ur+=2}),this.uuid=De.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function dr(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function pr(t,e,r){dr.call(this,new Int8Array(t),e,r)}function fr(t,e,r){dr.call(this,new Uint8Array(t),e,r)}function mr(t,e,r){dr.call(this,new Uint8ClampedArray(t),e,r)}function vr(t,e,r){dr.call(this,new Int16Array(t),e,r)}function gr(t,e,r){dr.call(this,new Uint16Array(t),e,r)}function yr(t,e,r){dr.call(this,new Int32Array(t),e,r)}function xr(t,e,r){dr.call(this,new Uint32Array(t),e,r)}function br(t,e,r){dr.call(this,new Float32Array(t),e,r)}function wr(t,e,r){dr.call(this,new Float64Array(t),e,r)}function _r(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Sr(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}hr.prototype=Object.assign(Object.create(n.prototype),{constructor:hr,isGeometry:!0,applyMatrix:function(t){for(var e=(new je).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(t);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new Ue;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Ue;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Ue;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Ue;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new Ue;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new ar;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,n=t.attributes,i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)e.vertices.push(new Be(i[d],i[d+1],i[d+2])),void 0!==o&&c.push(new Be(o[d],o[d+1],o[d+2])),void 0!==a&&e.colors.push(new tr(a[d],a[d+1],a[d+2])),void 0!==s&&u.push(new Fe(s[p],s[p+1])),void 0!==l&&h.push(new Fe(l[p],l[p+1]));function f(t,r,n,i){var d=new cr(t,r,n,void 0!==o?[c[t].clone(),c[r].clone(),c[n].clone()]:[],void 0!==a?[e.colors[t].clone(),e.colors[r].clone(),e.colors[n].clone()]:[],i);e.faces.push(d),void 0!==s&&e.faceVertexUvs[0].push([u[t].clone(),u[r].clone(),u[n].clone()]),void 0!==l&&e.faceVertexUvs[1].push([h[t].clone(),h[r].clone(),h[n].clone()])}var m=t.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==r?f(r[p],r[p+1],r[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==r)for(d=0;d<r.length;d+=3)f(r[d],r[d+1],r[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){var t=new Be;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,n=new Ue;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new Be,e=new Be,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)a[e]=new Be;if(t){var s,l,c=new Be,u=new Be;for(n=0,i=this.faces.length;n<i;n++)s=this.vertices[(o=this.faces[n]).a],c.subVectors(this.vertices[o.c],l=this.vertices[o.b]),u.subVectors(s,l),c.cross(u),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,r=this.vertices.length;e<r;e++)a[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var h=(o=this.faces[n]).vertexNormals;3===h.length?(h[0].copy(a[o.a]),h[1].copy(a[o.b]),h[2].copy(a[o.c])):(h[0]=a[o.a].clone(),h[1]=a[o.b].clone(),h[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new hr;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Be,c={a:new Be,b:new Be,c:new Be},a.push(l),s.push(c)}var l,c,u=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)c=u.vertexNormals[r],(l=u.faceNormals[r]).copy((i=this.faces[r]).normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ye),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new qe),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,l=t.faces,c=this.faceVertexUvs[0],u=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new je).getNormalMatrix(e));for(var p=0,f=a.length;p<f;p++){var m=a[p].clone();void 0!==e&&m.applyMatrix4(e),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,g,y=l[p],x=y.vertexNormals,b=y.vertexColors;(v=new cr(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var w=0,_=x.length;w<_;w++)g=x[w].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);for(v.color.copy(y.color),w=0,_=b.length;w<_;w++)v.vertexColors.push(b[w].clone());v.materialIndex=y.materialIndex+r,s.push(v)}for(p=0,f=u.length;p<f;p++){var S=u[p],T=[];if(void 0!==S){for(w=0,_=S.length;w<_;w++)T.push(S[w].clone());c.push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],void 0===l[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(l[e]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[e]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new Be(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===e&&(n=[]),a&&a.length===e&&(i=[]),r=0;r<e;r++){var s=t[r]._id;n&&n.push(o[s]),i&&i.push(a[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),a.push(x),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var b=this.faceVertexUvs[0][i];a.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&a.push(T(p.normal)),v){var w=p.vertexNormals;a.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&a.push(M(p.color)),y){var _=p.vertexColors;a.push(M(_[0]),M(_[1]),M(_[2]))}}function S(t,e,r){return r?t|1<<e:t&~(1<<e)}function T(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]?l[e]:(l[e]=s.length/3,s.push(t.x,t.y,t.z),l[e])}function M(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==u[e]?u[e]:(u[e]=c.length,c.push(t.getHex()),u[e])}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=n,t.data.normals=s,c.length>0&&(t.data.colors=c),h.length>0&&(t.data.uvs=[h]),t.data.faces=a,t},clone:function(){return(new hr).copy(this)},copy:function(t){var e,r,n,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var l=t.colors;for(e=0,r=l.length;e<r;e++)this.colors.push(l[e].clone());var c=t.faces;for(e=0,r=c.length;e<r;e++)this.faces.push(c[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var u=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(o=0,a=h.length;o<a;o++)d.push(h[o].clone());this.faceVertexUvs[e].push(d)}}var p=t.morphTargets;for(e=0,r=p.length;e<r;e++){var f={};if(f.name=p[e].name,void 0!==p[e].vertices)for(f.vertices=[],n=0,i=p[e].vertices.length;n<i;n++)f.vertices.push(p[e].vertices[n].clone());if(void 0!==p[e].normals)for(f.normals=[],n=0,i=p[e].normals.length;n<i;n++)f.normals.push(p[e].normals[n].clone());this.morphTargets.push(f)}var m=t.morphNormals;for(e=0,r=m.length;e<r;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],n=0,i=m[e].vertexNormals.length;n<i;n++){var g=m[e].vertexNormals[n],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],n=0,i=m[e].faceNormals.length;n<i;n++)v.faceNormals.push(m[e].faceNormals[n].clone());this.morphNormals.push(v)}var x=t.skinWeights;for(e=0,r=x.length;e<r;e++)this.skinWeights.push(x[e].clone());var b=t.skinIndices;for(e=0,r=b.length;e<r;e++)this.skinIndices.push(b[e].clone());var w=t.lineDistances;for(e=0,r=w.length;e<r;e++)this.lineDistances.push(w[e]);var _=t.boundingBox;null!==_&&(this.boundingBox=_.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(dr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(dr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new tr),e[r++]=o.r,e[r++]=o.g,e[r++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Fe),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new Be),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Ge),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z,e[r++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(pr.prototype=Object.create(dr.prototype)).constructor=pr,(fr.prototype=Object.create(dr.prototype)).constructor=fr,(mr.prototype=Object.create(dr.prototype)).constructor=mr,(vr.prototype=Object.create(dr.prototype)).constructor=vr,(gr.prototype=Object.create(dr.prototype)).constructor=gr,(yr.prototype=Object.create(dr.prototype)).constructor=yr,(xr.prototype=Object.create(dr.prototype)).constructor=xr,(br.prototype=Object.create(dr.prototype)).constructor=br,(wr.prototype=Object.create(dr.prototype)).constructor=wr,Object.assign(_r.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,r.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=t.morphTargets,l=s.length;if(l>0){e=[];for(var c=0;c<l;c++)e[c]=[];this.morphTargets.position=e}var u,h=t.morphNormals,d=h.length;if(d>0){for(u=[],c=0;c<d;c++)u[c]=[];this.morphTargets.normal=u}var p=t.skinIndices,f=t.skinWeights,m=p.length===n.length,v=f.length===n.length;for(c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}!0===o&&(void 0!==(b=i[0][c])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Fe,new Fe,new Fe))),!0===a&&(void 0!==(b=i[1][c])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Fe,new Fe,new Fe)));for(var S=0;S<l;S++){var T=s[S].vertices;e[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[c];u[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Tr=1;function Mr(){Object.defineProperty(this,"id",{value:Tr+=2}),this.uuid=De.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Ar(t,e,r,n,i,o){hr.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Er(t,e,r,n,i,o)),this.mergeVertices()}function Er(t,e,r,n,i,o){Mr.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var a=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var s=[],l=[],c=[],u=[],h=0,d=0;function p(t,e,r,n,i,o,p,f,m,v,g){var y,x,b=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new Be;for(x=0;x<A;x++){var O=x*w-S;for(y=0;y<M;y++)P[t]=(y*b-_)*n,P[e]=O*i,P[r]=T,l.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[r]=f>0?1:-1,c.push(P.x,P.y,P.z),u.push(y/m),u.push(1-x/v),E+=1}for(x=0;x<v;x++)for(y=0;y<m;y++){var N=h+y+M*(x+1),L=h+(y+1)+M*(x+1),I=h+(y+1)+M*x;s.push(h+y+M*x,N,I),s.push(N,L,I),C+=6}a.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,r,e,t,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,r,e,-t,o,i,1),p("x","z","y",1,1,t,r,e,n,o,2),p("x","z","y",1,-1,t,r,-e,n,o,3),p("x","y","z",1,-1,t,e,r,n,i,4),p("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(s),this.addAttribute("position",new br(l,3)),this.addAttribute("normal",new br(c,3)),this.addAttribute("uv",new br(u,2))}function Cr(t,e,r,n){hr.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Pr(t,e,r,n)),this.mergeVertices()}function Pr(t,e,r,n){Mr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,o,a=(t=t||1)/2,s=(e=e||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=t/l,p=e/c,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-s;for(i=0;i<u;i++)m.push(i*d-a,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/c)}for(o=0;o<c;o++)for(i=0;i<l;i++){var x=i+u*(o+1),b=i+1+u*(o+1),w=i+1+u*o;f.push(i+u*o,x,w),f.push(x,b,w)}this.setIndex(f),this.addAttribute("position",new br(m,3)),this.addAttribute("normal",new br(v,3)),this.addAttribute("uv",new br(g,2))}Mr.prototype=Object.assign(Object.create(n.prototype),{constructor:Mr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){this.index=Array.isArray(t)?new(Sr(t)>65535?xr:gr)(t,1):t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new dr(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var r=this.attributes.normal;return void 0!==r&&((new je).getNormalMatrix(t).applyToBufferAttribute(r),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new Ue;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Ue;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Ue;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Ue;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new Ue;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new ar;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new Be;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new br(3*e.vertices.length,3),n=new br(3*e.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new br(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new br(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new _r).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new dr(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.addAttribute("normal",new dr(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new dr(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new dr(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new dr(o,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var s=[],l=t.morphTargets[a],c=0,u=l.length;c<u;c++){var h=l[c],d=new br(3*h.length,3);s.push(d.copyVector3sArray(h))}this.morphAttributes[a]=s}if(t.skinIndices.length>0){var p=new br(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new br(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ye);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new Ye,e=new Be;return function(){null===this.boundingSphere&&(this.boundingSphere=new qe);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;t.setFromBufferAttribute(r),t.getCenter(n);for(var i=0,o=0,a=r.count;o<a;o++)e.x=r.getX(o),e.y=r.getY(o),e.z=r.getZ(o),i=Math.max(i,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,r=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new dr(new Float32Array(n.length),3));else for(var i=e.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;var s,l,c,u=e.normal.array,h=new Be,d=new Be,p=new Be,f=new Be,m=new Be;if(t){var v=t.array;0===r.length&&this.addGroup(0,v.length);for(var g=0,y=r.length;g<y;++g){var x=r[g],b=x.start;for(o=b,a=b+x.count;o<a;o+=3)l=3*v[o+1],c=3*v[o+2],h.fromArray(n,s=3*v[o+0]),d.fromArray(n,l),p.fromArray(n,c),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z}}else for(o=0,a=n.length;o<a;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==t.attributes[n])for(var i=r[n].array,o=t.attributes[n],a=o.array,s=0,l=o.itemSize*e;s<a.length;s++,l++)i[l]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){var t=new Be;return function(){for(var e=this.attributes.normal,r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.normalize(),e.setXYZ(r,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Mr,e=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],o=i.array,a=i.itemSize,s=new o.constructor(e.length*a),l=0,c=0,u=0,h=e.length;u<h;u++){l=e[u]*a;for(var d=0;d<a;d++)s[c++]=o[l++]}t.addAttribute(n,new dr(s,a))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var a=o[r];i=Array.prototype.slice.call(a.array),t.data.attributes[r]={itemSize:a.itemSize,type:a.array.constructor.name,array:i,normalized:a.normalized}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),t},clone:function(){return(new Mr).copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o)this.addAttribute(e,o[e].clone());var a=t.morphAttributes;for(e in a){var s=[],l=a[e];for(r=0,n=l.length;r<n;r++)s.push(l[r].clone());this.morphAttributes[e]=s}var c=t.groups;for(r=0,n=c.length;r<n;r++){var u=c[r];this.addGroup(u.start,u.count,u.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Ar.prototype=Object.create(hr.prototype)).constructor=Ar,(Er.prototype=Object.create(Mr.prototype)).constructor=Er,(Cr.prototype=Object.create(hr.prototype)).constructor=Cr,(Pr.prototype=Object.create(Mr.prototype)).constructor=Pr;var Or=0;function Nr(){Object.defineProperty(this,"id",{value:Or++}),this.uuid=De.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=T,this.side=m,this.flatShading=!1,this.vertexColors=b,this.opacity=1,this.transparent=!1,this.blendSrc=k,this.blendDst=B,this.blendEquation=P,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=q,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Lr(t){Nr.call(this),this.type="MeshBasicMaterial",this.color=new tr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Ir(t){Nr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Rr(t,e){this.origin=void 0!==t?t:new Be,this.direction=void 0!==e?e:new Be}function Dr(t,e){this.start=void 0!==t?t:new Be,this.end=void 0!==e?e:new Be}function Fr(t,e,r){this.a=void 0!==t?t:new Be,this.b=void 0!==e?e:new Be,this.c=void 0!==r?r:new Be}function Ur(t,e){ar.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Mr,this.material=void 0!==e?e:new Lr({color:16777215*Math.random()}),this.drawMode=_e,this.updateMorphTargets()}function kr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Br(t,e,r,n,i,o,a,s,l,c){Ve.call(this,t=void 0!==t?t:[],e=void 0!==e?e:lt,r,n,i,o,a,s,l,c),this.flipY=!1}Nr.prototype=Object.assign(Object.create(n.prototype),{constructor:Nr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]="overdraw"===e?Number(r):r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===y;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==T&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==m&&(r.side=this.side),this.vertexColors!==b&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var i=n(t.textures),o=n(t.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Lr.prototype=Object.create(Nr.prototype)).constructor=Lr,Lr.prototype.isMeshBasicMaterial=!0,Lr.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},(Ir.prototype=Object.create(Nr.prototype)).constructor=Ir,Ir.prototype.isShaderMaterial=!0,Ir.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ke.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Ir.prototype.toJSON=function(t){var e=Nr.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Object.assign(Rr.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Be),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new Be;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Be),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new Be;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new Be,e=new Be,r=new Be;return function(n,i,o,a){t.copy(n).add(i).multiplyScalar(.5),e.copy(i).sub(n).normalize(),r.copy(this.origin).sub(t);var s,l,c,u,h=.5*n.distanceTo(i),d=-this.direction.dot(e),p=r.dot(this.direction),f=-r.dot(e),m=r.lengthSq(),v=Math.abs(1-d*d);if(v>0)if(l=d*p-f,u=h*v,(s=d*f-p)>=0)if(l>=-u)if(l<=u){var g=1/v;c=(s*=g)*(s+d*(l*=g)+2*p)+l*(d*s+l+2*f)+m}else l=h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l=-h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l<=-u?c=-(s=Math.max(0,-(-d*h+p)))*s+(l=s>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(s=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(s=Math.max(0,-(d*h+p)))*s+(l=s>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=d>0?-h:h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(e).multiplyScalar(l).add(t),c}}(),intersectSphere:function(){var t=new Be;return function(e,r){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),i=t.dot(t)-n*n,o=e.radius*e.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=n-a,l=n+a;return s<0&&l<0?null:this.at(s<0?l:s,r)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),u>=0?(a=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(a=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),r>s||a>n?null:((a>r||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(){var t=new Be;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new Be,e=new Be,r=new Be,n=new Be;return function(i,o,a,s,l){e.subVectors(o,i),r.subVectors(a,i),n.crossVectors(e,r);var c,u=this.direction.dot(n);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}t.subVectors(this.origin,i);var h=c*this.direction.dot(r.crossVectors(t,r));if(h<0)return null;var d=c*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>u)return null;var p=-c*t.dot(n);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Dr.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Be),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Be),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Be),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new Be,e=new Be;return function(r,n){t.subVectors(r,this.start),e.subVectors(this.end,this.start);var i=e.dot(e),o=e.dot(t)/i;return n&&(o=De.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Be),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(Fr,{getNormal:function(){var t=new Be;return function(e,r,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Be),i.subVectors(n,r),t.subVectors(e,r),i.cross(t);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}}(),getBarycoord:function(){var t=new Be,e=new Be,r=new Be;return function(n,i,o,a,s){t.subVectors(a,i),e.subVectors(o,i),r.subVectors(n,i);var l=t.dot(t),c=t.dot(e),u=t.dot(r),h=e.dot(e),d=e.dot(r),p=l*h-c*c;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Be),0===p)return s.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,v=(l*d-c*u)*f;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var t=new Be;return function(e,r,n,i){return Fr.getBarycoord(e,r,n,i,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}()}),Object.assign(Fr.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new Be,e=new Be;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Be),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Fr.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Be),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Fr.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Fr.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new Je,e=[new Dr,new Dr,new Dr],r=new Be,n=new Be;return function(i,o){void 0===o&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new Be);var a=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(i,r),!0===this.containsPoint(r))o.copy(r);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var s=0;s<e.length;s++){e[s].closestPointToPoint(r,!0,n);var l=r.distanceToSquared(n);l<a&&(a=l,o.copy(n))}}return o}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Ur.prototype=Object.assign(Object.create(ar.prototype),{constructor:Ur,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return ar.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)r=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}},raycast:function(){var t=new Ue,e=new Rr,r=new qe,n=new Be,i=new Be,o=new Be,a=new Be,s=new Be,l=new Be,c=new Fe,u=new Fe,h=new Fe,d=new Be,p=new Be,f=new Be;function m(t,e,r,n,i,o,a){return Fr.getBarycoord(t,e,r,n,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),a.multiplyScalar(d.z),i.add(o).add(a),i.clone()}function y(t,e,r,n,i,o,a,s){if(null===(e.side===v?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,e.side!==g,s)))return null;f.copy(s),f.applyMatrix4(t.matrixWorld);var l=r.ray.origin.distanceTo(f);return l<r.near||l>r.far?null:{distance:l,point:f.clone(),object:t}}function x(t,e,r,a,s,l,d,f){n.fromBufferAttribute(a,l),i.fromBufferAttribute(a,d),o.fromBufferAttribute(a,f);var v=y(t,t.material,e,r,n,i,o,p);if(v){s&&(c.fromBufferAttribute(s,l),u.fromBufferAttribute(s,d),h.fromBufferAttribute(s,f),v.uv=m(p,n,i,o,c,u,h));var g=new cr(l,d,f);Fr.getNormal(n,i,o,g.normal),v.face=g,v.faceIndex=l}return v}return function(d,f){var v,g=this.geometry,b=this.material,w=this.matrixWorld;if(void 0!==b&&(null===g.boundingSphere&&g.computeBoundingSphere(),r.copy(g.boundingSphere),r.applyMatrix4(w),!1!==d.ray.intersectsSphere(r)&&(t.getInverse(w),e.copy(d.ray).applyMatrix4(t),null===g.boundingBox||!1!==e.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var _,S,T,M,A,E=g.index,C=g.attributes.position,P=g.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(v=x(this,d,e,C,P,_,S,T))&&(v.faceIndex=Math.floor(M/3),f.push(v));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(v=x(this,d,e,C,P,_=M,S=M+1,T=M+2))&&(v.index=_,f.push(v))}else if(g.isGeometry){var O,N,L,I,R=Array.isArray(b),D=g.vertices,F=g.faces,U=g.faceVertexUvs[0];U.length>0&&(I=U);for(var k=0,B=F.length;k<B;k++){var j=F[k],z=R?b[j.materialIndex]:b;if(void 0!==z){if(O=D[j.a],N=D[j.b],L=D[j.c],!0===z.morphTargets){var V=g.morphTargets,G=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var Y=V[H].vertices;n.addScaledVector(a.subVectors(Y[j.a],O),X),i.addScaledVector(s.subVectors(Y[j.b],N),X),o.addScaledVector(l.subVectors(Y[j.c],L),X)}}n.add(O),i.add(N),o.add(L),O=n,N=i,L=o}if(v=y(this,z,d,e,O,N,L,p)){if(I&&I[k]){var q=I[k];c.copy(q[0]),u.copy(q[1]),h.copy(q[2]),v.uv=m(p,O,N,L,c,u,h)}v.face=j,v.faceIndex=k,f.push(v)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(Br.prototype=Object.create(Ve.prototype)).constructor=Br,Br.prototype.isCubeTexture=!0,Object.defineProperty(Br.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var jr=new Ve,zr=new Br;function Vr(){this.seq=[],this.map={}}var Gr=[],Hr=[],Wr=new Float32Array(16),Xr=new Float32Array(9);function Yr(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,o=Gr[i];if(void 0===o&&(o=new Float32Array(i),Gr[i]=o),0!==e){n.toArray(o,0);for(var a=1,s=0;a!==e;++a)t[a].toArray(o,s+=r)}return o}function qr(t,e){var r=Hr[e];void 0===r&&(r=new Int32Array(e),Hr[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocTextureUnit();return r}function Jr(t,e){t.uniform1f(this.addr,e)}function Zr(t,e){t.uniform1i(this.addr,e)}function Qr(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function Kr(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function $r(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function tn(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function en(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(Xr.set(e.elements),t.uniformMatrix3fv(this.addr,!1,Xr))}function rn(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(Wr.set(e.elements),t.uniformMatrix4fv(this.addr,!1,Wr))}function nn(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTexture2D(e||jr,n)}function on(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTextureCube(e||zr,n)}function an(t,e){t.uniform2iv(this.addr,e)}function sn(t,e){t.uniform3iv(this.addr,e)}function ln(t,e){t.uniform4iv(this.addr,e)}function cn(t,e){t.uniform1fv(this.addr,e)}function un(t,e){t.uniform1iv(this.addr,e)}function hn(t,e){t.uniform2fv(this.addr,Yr(e,this.size,2))}function dn(t,e){t.uniform3fv(this.addr,Yr(e,this.size,3))}function pn(t,e){t.uniform4fv(this.addr,Yr(e,this.size,4))}function fn(t,e){t.uniformMatrix2fv(this.addr,!1,Yr(e,this.size,4))}function mn(t,e){t.uniformMatrix3fv(this.addr,!1,Yr(e,this.size,9))}function vn(t,e){t.uniformMatrix4fv(this.addr,!1,Yr(e,this.size,16))}function gn(t,e,r){var n=e.length,i=qr(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTexture2D(e[o]||jr,i[o])}function yn(t,e,r){var n=e.length,i=qr(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTextureCube(e[o]||zr,i[o])}function xn(t,e,r){this.id=t,this.addr=r,this.setValue=function(t){switch(e.type){case 5126:return Jr;case 35664:return Qr;case 35665:return Kr;case 35666:return $r;case 35674:return tn;case 35675:return en;case 35676:return rn;case 35678:case 36198:return nn;case 35680:return on;case 5124:case 35670:return Zr;case 35667:case 35671:return an;case 35668:case 35672:return sn;case 35669:case 35673:return ln}}()}function bn(t,e,r){this.id=t,this.addr=r,this.size=e.size,this.setValue=function(t){switch(e.type){case 5126:return cn;case 35664:return hn;case 35665:return dn;case 35666:return pn;case 35674:return fn;case 35675:return mn;case 35676:return vn;case 35678:return gn;case 35680:return yn;case 5124:case 35670:return un;case 35667:case 35671:return an;case 35668:case 35672:return sn;case 35669:case 35673:return ln}}()}function wn(t){this.id=t,Vr.call(this)}wn.prototype.setValue=function(t,e){for(var r=this.seq,n=0,i=r.length;n!==i;++n){var o=r[n];o.setValue(t,e[o.id])}};var _n=/([\w\d_]+)(\])?(\[|\.)?/g;function Sn(t,e){t.seq.push(e),t.map[e.id]=e}function Tn(t,e,r){var n=t.name,i=n.length;for(_n.lastIndex=0;;){var o=_n.exec(n),a=o[1],s=o[3];if("]"===o[2]&&(a|=0),void 0===s||"["===s&&_n.lastIndex+2===i){Sn(r,void 0===s?new xn(a,t,e):new bn(a,t,e));break}var l=r.map[a];void 0===l&&Sn(r,l=new wn(a)),r=l}}function Mn(t,e,r){Vr.call(this),this.renderer=r;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<n;++i){var o=t.getActiveUniform(e,i);Tn(o,t.getUniformLocation(e,o.name),this)}}function An(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(r)),n}Mn.prototype.setValue=function(t,e,r){var n=this.map[e];void 0!==n&&n.setValue(t,r,this.renderer)},Mn.prototype.setOptional=function(t,e,r){var n=e[r];void 0!==n&&this.setValue(t,r,n)},Mn.upload=function(t,e,r,n){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,n)}},Mn.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var o=t[n];o.id in e&&r.push(o)}return r};var En=0;function Cn(t){switch(t){case Me:return["Linear","( value )"];case Ae:return["sRGB","( value )"];case Ce:return["RGBE","( value )"];case Oe:return["RGBM","( value, 7.0 )"];case Ne:return["RGBM","( value, 16.0 )"];case Le:return["RGBD","( value, 256.0 )"];case Ee:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function Pn(t,e){var r=Cn(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function On(t){return""!==t}function Nn(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Ln(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function In(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(t,e){var r=Qe[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return In(r)})}function Rn(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,r,n){for(var i="",o=parseInt(e);o<parseInt(r);o++)i+=n.replace(/\[ i \]/g,"[ "+o+" ]");return i})}function Dn(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Fn(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}var Un=0;function kn(t){Nr.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ie,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function Bn(t){Nr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Be,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function jn(t,e,r){for(var n=new Ze,i=new Ue,o=new Fe,a=new Fe(r,r),s=new Be,l=new Be,c=1,u=2,h=1+(c|u),d=new Array(h),f=new Array(h),y={},x={0:v,1:m,2:g},b=[new Be(1,0,0),new Be(-1,0,0),new Be(0,0,1),new Be(0,0,-1),new Be(0,1,0),new Be(0,-1,0)],w=[new Be(0,1,0),new Be(0,1,0),new Be(0,1,0),new Be(0,1,0),new Be(0,0,1),new Be(0,0,-1)],_=[new Ge,new Ge,new Ge,new Ge,new Ge,new Ge],S=0;S!==h;++S){var T=0!=(S&c),M=0!=(S&u),A=new kn({depthPacking:Re,morphTargets:T,skinning:M});d[S]=A;var E=new Bn({morphTargets:T,skinning:M});f[S]=E}var C=this;function P(e,r,n,i,o,a){var s=e.geometry,l=null,h=d,p=e.customDepthMaterial;if(n&&(h=f,p=e.customDistanceMaterial),p)l=p;else{var m=!1;r.morphTargets&&(s&&s.isBufferGeometry?m=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(m=s.morphTargets&&s.morphTargets.length>0)),e.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var v=0;m&&(v|=c),e.isSkinnedMesh&&r.skinning&&(v|=u),l=h[v]}if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var g=l.uuid,b=r.uuid,w=y[g];void 0===w&&(y[g]=w={});var _=w[b];void 0===_&&(_=l.clone(),w[b]=_),l=_}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:x[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=o,l.farDistance=a),l}function O(r,i,o,a){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);var s=e.update(r),c=r.material;if(Array.isArray(c))for(var u=s.groups,h=0,d=u.length;h<d;h++){var p=u[h],f=c[p.materialIndex];if(f&&f.visible){var m=P(r,f,a,l,o.near,o.far);t.renderBufferDirect(o,null,s,m,r,p)}}else c.visible&&(m=P(r,c,a,l,o.near,o.far),t.renderBufferDirect(o,null,s,m,r,null))}for(var v=r.children,g=0,y=v.length;g<y;g++)O(v[g],i,o,a)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=p,this.render=function(e,r,c){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==e.length){var u,h=t.state;h.disable(t.context.BLEND),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(var d=0,p=e.length;d<p;d++){var f=e[d],m=f.shadow,v=f&&f.isPointLight;if(void 0!==m){var g=m.camera;if(o.copy(m.mapSize),o.min(a),v){var y=o.x,x=o.y;_[0].set(2*y,x,y,x),_[1].set(0,x,y,x),_[2].set(3*y,x,y,x),_[3].set(y,x,y,x),_[4].set(3*y,0,y,x),_[5].set(y,0,y,x),o.x*=4,o.y*=2}null===m.map&&(m.map=new He(o.x,o.y,{minFilter:yt,magFilter:yt,format:kt}),m.map.texture.name=f.name+".shadowMap",g.updateProjectionMatrix()),m.isSpotLightShadow&&m.update(f);var S=m.map,T=m.matrix;l.setFromMatrixPosition(f.matrixWorld),g.position.copy(l),v?(u=6,T.makeTranslation(-l.x,-l.y,-l.z)):(u=1,s.setFromMatrixPosition(f.target.matrixWorld),g.lookAt(s),g.updateMatrixWorld(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(g.projectionMatrix),T.multiply(g.matrixWorldInverse)),t.setRenderTarget(S),t.clear();for(var M=0;M<u;M++)v&&(s.copy(g.position),s.add(b[M]),g.up.copy(w[M]),g.lookAt(s),g.updateMatrixWorld(),h.viewport(_[M])),i.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),n.setFromMatrix(i),O(r,c,g,v)}else console.warn("THREE.WebGLShadowMap:",f,"has no shadow.")}C.needsUpdate=!1}}}function zn(t,e,r,n,i,o,a,s,l){Ve.call(this,t,e,r,n,i,o,a,s,l),this.needsUpdate=!0}function Vn(t,e){return{convert:function(r){var n;if(r===mt)return t.REPEAT;if(r===vt)return t.CLAMP_TO_EDGE;if(r===gt)return t.MIRRORED_REPEAT;if(r===yt)return t.NEAREST;if(r===xt)return t.NEAREST_MIPMAP_NEAREST;if(r===bt)return t.NEAREST_MIPMAP_LINEAR;if(r===wt)return t.LINEAR;if(r===_t)return t.LINEAR_MIPMAP_NEAREST;if(r===St)return t.LINEAR_MIPMAP_LINEAR;if(r===Tt)return t.UNSIGNED_BYTE;if(r===Lt)return t.UNSIGNED_SHORT_4_4_4_4;if(r===It)return t.UNSIGNED_SHORT_5_5_5_1;if(r===Rt)return t.UNSIGNED_SHORT_5_6_5;if(r===Mt)return t.BYTE;if(r===At)return t.SHORT;if(r===Et)return t.UNSIGNED_SHORT;if(r===Ct)return t.INT;if(r===Pt)return t.UNSIGNED_INT;if(r===Ot)return t.FLOAT;if(r===Nt&&null!==(n=e.get("OES_texture_half_float")))return n.HALF_FLOAT_OES;if(r===Ft)return t.ALPHA;if(r===Ut)return t.RGB;if(r===kt)return t.RGBA;if(r===Bt)return t.LUMINANCE;if(r===jt)return t.LUMINANCE_ALPHA;if(r===Vt)return t.DEPTH_COMPONENT;if(r===Gt)return t.DEPTH_STENCIL;if(r===P)return t.FUNC_ADD;if(r===O)return t.FUNC_SUBTRACT;if(r===N)return t.FUNC_REVERSE_SUBTRACT;if(r===R)return t.ZERO;if(r===D)return t.ONE;if(r===F)return t.SRC_COLOR;if(r===U)return t.ONE_MINUS_SRC_COLOR;if(r===k)return t.SRC_ALPHA;if(r===B)return t.ONE_MINUS_SRC_ALPHA;if(r===j)return t.DST_ALPHA;if(r===z)return t.ONE_MINUS_DST_ALPHA;if(r===V)return t.DST_COLOR;if(r===G)return t.ONE_MINUS_DST_COLOR;if(r===H)return t.SRC_ALPHA_SATURATE;if((r===Ht||r===Wt||r===Xt||r===Yt)&&null!==(n=e.get("WEBGL_compressed_texture_s3tc"))){if(r===Ht)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Wt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Xt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Yt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===qt||r===Jt||r===Zt||r===Qt)&&null!==(n=e.get("WEBGL_compressed_texture_pvrtc"))){if(r===qt)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Jt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Zt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Qt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===Kt&&null!==(n=e.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((r===$t||r===te||r===ee||r===re||r===ne||r===ie||r===oe||r===ae||r===se||r===le||r===ce||r===ue||r===he||r===de)&&null!==(n=e.get("WEBGL_compressed_texture_astc")))return r;if((r===L||r===I)&&null!==(n=e.get("EXT_blend_minmax"))){if(r===L)return n.MIN_EXT;if(r===I)return n.MAX_EXT}return r===Dt&&null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:0}}}function Gn(t,e,r,n){sr.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Hn(t){Gn.call(this),this.cameras=t||[]}function Wn(t){var e=this,r=null,n=null,i=null,o=new Ue,a=new Ue;"undefined"!=typeof window&&"VRFrameData"in window&&(n=new window.VRFrameData);var s=new Ue,l=new ke,c=new Be,u=new Gn;u.bounds=new Ge(0,0,.5,1),u.layers.enable(1);var h=new Gn;h.bounds=new Ge(.5,0,.5,1),h.layers.enable(2);var d,p,f=new Hn([u,h]);function m(){if(null!==r&&r.isPresenting){var n=r.getEyeParameters("left"),i=n.renderWidth,o=n.renderHeight;p=t.getPixelRatio(),d=t.getSize(),t.setDrawingBufferSize(2*i,o,1)}else e.enabled&&t.setDrawingBufferSize(d.width,d.height,p)}f.layers.enable(1),f.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",m,!1),this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return r},this.setDevice=function(t){void 0!==t&&(r=t)},this.setPoseTarget=function(t){void 0!==t&&(i=t)},this.getCamera=function(t){if(null===r)return t;r.depthNear=t.near,r.depthFar=t.far,r.getFrameData(n);var d=r.stageParameters;d?o.fromArray(d.sittingToStandingTransform):o.makeTranslation(0,e.userHeight,0);var p=n.pose,m=null!==i?i:t;if(m.matrix.copy(o),m.matrix.decompose(m.position,m.quaternion,m.scale),null!==p.orientation&&(l.fromArray(p.orientation),m.quaternion.multiply(l)),null!==p.position&&(l.setFromRotationMatrix(o),c.fromArray(p.position),c.applyQuaternion(l),m.position.add(c)),m.updateMatrixWorld(),!1===r.isPresenting)return t;u.near=t.near,h.near=t.near,u.far=t.far,h.far=t.far,f.matrixWorld.copy(t.matrixWorld),f.matrixWorldInverse.copy(t.matrixWorldInverse),u.matrixWorldInverse.fromArray(n.leftViewMatrix),h.matrixWorldInverse.fromArray(n.rightViewMatrix),a.getInverse(o),u.matrixWorldInverse.multiply(a),h.matrixWorldInverse.multiply(a);var v=m.parent;null!==v&&(s.getInverse(v.matrixWorld),u.matrixWorldInverse.multiply(s),h.matrixWorldInverse.multiply(s)),u.matrixWorld.getInverse(u.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),u.projectionMatrix.fromArray(n.leftProjectionMatrix),h.projectionMatrix.fromArray(n.rightProjectionMatrix),f.projectionMatrix.copy(u.projectionMatrix);var g=r.getLayers();if(g.length){var y=g[0];null!==y.leftBounds&&4===y.leftBounds.length&&u.bounds.fromArray(y.leftBounds),null!==y.rightBounds&&4===y.rightBounds.length&&h.bounds.fromArray(y.rightBounds)}return f},this.getStandingMatrix=function(){return o},this.submitFrame=function(){r&&r.isPresenting&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",m)}}function Xn(t){console.log("THREE.WebGLRenderer",i);var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,o=void 0===t.depth||t.depth,c=void 0===t.stencil||t.stencil,u=void 0!==t.antialias&&t.antialias,h=void 0===t.premultipliedAlpha||t.premultipliedAlpha,d=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,m=void 0!==t.powerPreference?t.powerPreference:"default",y=null,x=null;this.domElement=e,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=nt,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var w,_,P,O,N,L,I,R,D,F,U,k,B,j,z,V,G,H,st,mt=this,gt=!1,_t=null,St=null,Mt=-1,At="",Ct=null,Lt=null,It=new Ge,Rt=new Ge,Ft=null,Bt=0,jt=e.width,zt=e.height,Ht=1,Wt=new Ge(0,0,jt,zt),Xt=new Ge(0,0,jt,zt),Yt=!1,qt=new Ze,Jt=new function(){var t=this,e=null,r=0,n=!1,i=!1,o=new Je,a=new je,s={value:null,needsUpdate:!1};function l(){s.value!==e&&(s.value=e,s.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,r,n,i){var l=null!==e?e.length:0,c=null;if(0!==l){if(c=s.value,!0!==i||null===c){var u=n+4*l,h=r.matrixWorldInverse;a.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,p=n;d!==l;++d,p+=4)o.copy(e[d]).applyMatrix4(h,a),o.normal.toArray(c,p),c[p+3]=o.constant}s.value=c,s.needsUpdate=!0}return t.numPlanes=l,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,o){var a=0!==t.length||i||0!==r||n;return n=i,e=c(t,o,0),r=t.length,a},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(t,o,a,u,h,d){if(!n||null===t||0===t.length||i&&!a)i?c(null):l();else{var p=i?0:r,f=4*p,m=h.clippingState||null;s.value=m,m=c(t,u,f,d);for(var v=0;v!==f;++v)m[v]=e[v];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}},Zt=!1,Qt=!1,Kt=new Ue,$t=new Be;function te(){return null===_t?Ht:1}try{var ee={alpha:n,depth:o,stencil:c,antialias:u,premultipliedAlpha:h,preserveDrawingBuffer:d,powerPreference:m};if(e.addEventListener("webglcontextlost",oe,!1),e.addEventListener("webglcontextrestored",ae,!1),null===(w=r||e.getContext("webgl",ee)||e.getContext("experimental-webgl",ee)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===w.getShaderPrecisionFormat&&(w.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){console.error("THREE.WebGLRenderer: "+t.message)}function re(){(_=new function(t){var e={};return{get:function(r){if(void 0!==e[r])return e[r];var n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=t.getExtension("WEBGL_compressed_texture_etc1");break;default:n=t.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=n,n}}}(w)).get("WEBGL_depth_texture"),_.get("OES_texture_float"),_.get("OES_texture_float_linear"),_.get("OES_texture_half_float"),_.get("OES_texture_half_float_linear"),_.get("OES_standard_derivatives"),_.get("OES_element_index_uint"),_.get("ANGLE_instanced_arrays"),st=new Vn(w,_),P=new function(t,e,r){var n;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o=void 0!==r.precision?r.precision:"highp",a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);var s=!0===r.logarithmicDepthBuffer,l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_TEXTURE_SIZE),h=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),d=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),f=t.getParameter(t.MAX_VARYING_VECTORS),m=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=c>0,g=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==n)return n;var r=e.get("EXT_texture_filter_anisotropic");return n=null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:s,maxTextures:l,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:h,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:g,floatVertexTextures:v&&g}}(w,_,t),(O=new function(t,e,r){var n=new function(){var e=!1,r=new Ge,n=null,i=new Ge(0,0,0,0);return{setMask:function(r){n===r||e||(t.colorMask(r,r,r,r),n=r)},setLocked:function(t){e=t},setClear:function(e,n,o,a,s){!0===s&&(e*=a,n*=a,o*=a),r.set(e,n,o,a),!1===i.equals(r)&&(t.clearColor(e,n,o,a),i.copy(r))},reset:function(){e=!1,n=null,i.set(-1,0,0,0)}}},i=new function(){var e=!1,r=null,n=null,i=null;return{setTest:function(e){e?et(t.DEPTH_TEST):rt(t.DEPTH_TEST)},setMask:function(n){r===n||e||(t.depthMask(n),r=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case W:t.depthFunc(t.NEVER);break;case X:t.depthFunc(t.ALWAYS);break;case Y:t.depthFunc(t.LESS);break;case q:t.depthFunc(t.LEQUAL);break;case J:t.depthFunc(t.EQUAL);break;case Z:t.depthFunc(t.GEQUAL);break;case Q:t.depthFunc(t.GREATER);break;case K:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,r=null,n=null,i=null}}},o=new function(){var e=!1,r=null,n=null,i=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){e?et(t.STENCIL_TEST):rt(t.STENCIL_TEST)},setMask:function(n){r===n||e||(t.stencilMask(n),r=n)},setFunc:function(e,r,a){n===e&&i===r&&o===a||(t.stencilFunc(e,r,a),n=e,i=r,o=a)},setOp:function(e,r,n){a===e&&s===r&&l===n||(t.stencilOp(e,r,n),a=e,s=r,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,r=null,n=null,i=null,o=null,a=null,s=null,l=null,c=null}}},c=t.getParameter(t.MAX_VERTEX_ATTRIBS),u=new Uint8Array(c),h=new Uint8Array(c),d=new Uint8Array(c),p={},f=null,m=null,y=null,x=null,b=null,w=null,_=null,P=null,O=null,N=!1,L=null,I=null,R=null,D=null,F=null,U=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),k=!1,B=0,j=t.getParameter(t.VERSION);-1!==j.indexOf("WebGL")?(B=parseFloat(/^WebGL\ ([0-9])/.exec(j)[1]),k=B>=1):-1!==j.indexOf("OpenGL ES")&&(B=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(j)[1]),k=B>=2);var z=null,V={},G=new Ge,H=new Ge;function $(e,r,n){var i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var a=0;a<n;a++)t.texImage2D(r+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i);return o}var tt={};function et(e){!0!==p[e]&&(t.enable(e),p[e]=!0)}function rt(e){!1!==p[e]&&(t.disable(e),p[e]=!1)}function nt(e,n,i,o,a,s,l,c){if(e!==S?et(t.BLEND):rt(t.BLEND),e!==C){if(e!==y||c!==N)switch(e){case M:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE));break;case A:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR));break;case E:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR));break;default:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA))}x=null,b=null,w=null,_=null,P=null,O=null}else a=a||n,s=s||i,l=l||o,n===x&&a===_||(t.blendEquationSeparate(r.convert(n),r.convert(a)),x=n,_=a),i===b&&o===w&&s===P&&l===O||(t.blendFuncSeparate(r.convert(i),r.convert(o),r.convert(s),r.convert(l)),b=i,w=o,P=s,O=l);y=e,N=c}function it(e){L!==e&&(t.frontFace(e?t.CW:t.CCW),L=e)}function ot(e){e!==a?(et(t.CULL_FACE),e!==I&&t.cullFace(e===s?t.BACK:e===l?t.FRONT:t.FRONT_AND_BACK)):rt(t.CULL_FACE),I=e}function at(e,r,n){e?(et(t.POLYGON_OFFSET_FILL),D===r&&F===n||(t.polygonOffset(r,n),D=r,F=n)):rt(t.POLYGON_OFFSET_FILL)}function st(e){void 0===e&&(e=t.TEXTURE0+U-1),z!==e&&(t.activeTexture(e),z=e)}return tt[t.TEXTURE_2D]=$(t.TEXTURE_2D,t.TEXTURE_2D,1),tt[t.TEXTURE_CUBE_MAP]=$(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),i.setClear(1),o.setClear(0),et(t.DEPTH_TEST),i.setFunc(q),it(!1),ot(s),et(t.CULL_FACE),et(t.BLEND),nt(T),{buffers:{color:n,depth:i,stencil:o},initAttributes:function(){for(var t=0,e=u.length;t<e;t++)u[t]=0},enableAttribute:function(r){u[r]=1,0===h[r]&&(t.enableVertexAttribArray(r),h[r]=1),0!==d[r]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,0),d[r]=0)},enableAttributeAndDivisor:function(r,n){u[r]=1,0===h[r]&&(t.enableVertexAttribArray(r),h[r]=1),d[r]!==n&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,n),d[r]=n)},disableUnusedAttributes:function(){for(var e=0,r=h.length;e!==r;++e)h[e]!==u[e]&&(t.disableVertexAttribArray(e),h[e]=0)},enable:et,disable:rt,getCompressedTextureFormats:function(){if(null===f&&(f=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")||e.get("WEBGL_compressed_texture_astc")))for(var r=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<r.length;n++)f.push(r[n]);return f},useProgram:function(e){return m!==e&&(t.useProgram(e),m=e,!0)},setBlending:nt,setMaterial:function(e,r){e.side===g?rt(t.CULL_FACE):et(t.CULL_FACE);var o=e.side===v;r&&(o=!o),it(o),!0===e.transparent?nt(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):nt(S),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),n.setMask(e.colorWrite),at(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:it,setCullFace:ot,setLineWidth:function(e){e!==R&&(k&&t.lineWidth(e),R=e)},setPolygonOffset:at,setScissorTest:function(e){e?et(t.SCISSOR_TEST):rt(t.SCISSOR_TEST)},activeTexture:st,bindTexture:function(e,r){null===z&&st();var n=V[z];void 0===n&&(V[z]=n={type:void 0,texture:void 0}),n.type===e&&n.texture===r||(t.bindTexture(e,r||tt[e]),n.type=e,n.texture=r)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===G.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),G.copy(e))},viewport:function(e){!1===H.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),H.copy(e))},reset:function(){for(var e=0;e<h.length;e++)1===h[e]&&(t.disableVertexAttribArray(e),h[e]=0);p={},f=null,z=null,V={},m=null,y=null,L=null,I=null,n.reset(),i.reset(),o.reset()}}}(w,_,st)).scissor(Rt.copy(Xt).multiplyScalar(Ht)),O.viewport(It.copy(Wt).multiplyScalar(Ht)),N=new function(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(r,n,i){switch(i=i||1,e.calls++,n){case t.TRIANGLES:e.triangles+=i*(r/3);break;case t.TRIANGLE_STRIP:case t.TRIANGLE_FAN:e.triangles+=i*(r-2);break;case t.LINES:e.lines+=i*(r/2);break;case t.LINE_STRIP:e.lines+=i*(r-1);break;case t.LINE_LOOP:e.lines+=i*r;break;case t.POINTS:e.points+=i*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}(w),L=new function(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return void 0===r&&t.set(e,r={}),r},remove:function(e){t.delete(e)},update:function(e,r,n){t.get(e)[r]=n},dispose:function(){t=new WeakMap}}},I=new function(t,e,r,n,i,o,a){var s,l="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,c={};function u(t,e){if(t.width>e||t.height>e){if("data"in t)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+t.width+"x"+t.height+").");var r=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(t.width*r),n.height=Math.floor(t.height*r),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function h(t){return De.isPowerOfTwo(t.width)&&De.isPowerOfTwo(t.height)}function d(t,e){return t.generateMipmaps&&e&&t.minFilter!==yt&&t.minFilter!==wt}function p(e,r,i,o){t.generateMipmap(e),n.get(r).__maxMipLevel=Math.log2(Math.max(i,o))}function f(e){return e===yt||e===xt||e===bt?t.NEAREST:t.LINEAR}function m(e){var r=e.target;r.removeEventListener("dispose",m),function(e){var r=n.get(e);if(e.image&&r.__image__webglTextureCube)t.deleteTexture(r.__image__webglTextureCube);else{if(void 0===r.__webglInit)return;t.deleteTexture(r.__webglTexture)}n.remove(e)}(r),r.isVideoTexture&&delete c[r.id],a.memory.textures--}function v(e){var r=e.target;r.removeEventListener("dispose",v),function(e){var r=n.get(e),i=n.get(e.texture);if(e){if(void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(var o=0;o<6;o++)t.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[o]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(e.texture),n.remove(e)}}(r),a.memory.textures--}function g(e,f){var v=n.get(e);if(e.isVideoTexture&&function(t){var e=t.id,r=a.render.frame;c[e]!==r&&(c[e]=r,t.update())}(e),e.version>0&&v.__version!==e.version){var g=e.image;if(void 0===g)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else{if(!1!==g.complete)return void function(e,n,c){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",m),e.__webglTexture=t.createTexture(),a.memory.textures++),r.activeTexture(t.TEXTURE0+c),r.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment);var f=u(n.image,i.maxTextureSize);(function(t){return t.wrapS!==vt||t.wrapT!==vt||t.minFilter!==yt&&t.minFilter!==wt})(n)&&!1===h(f)&&(f=function(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap?(void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=De.floorPowerOfTwo(t.width),s.height=De.floorPowerOfTwo(t.height),s.getContext("2d").drawImage(t,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+s.width+"x"+s.height,t),s):t}(f));var v=h(f),g=o.convert(n.format),x=o.convert(n.type);y(t.TEXTURE_2D,n,v);var b,w=n.mipmaps;if(n.isDepthTexture){var _=t.DEPTH_COMPONENT;if(n.type===Ot){if(!l)throw new Error("Float Depth Texture only supported in WebGL2.0");_=t.DEPTH_COMPONENT32F}else l&&(_=t.DEPTH_COMPONENT16);n.format===Vt&&_===t.DEPTH_COMPONENT&&n.type!==Et&&n.type!==Pt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Et,x=o.convert(n.type)),n.format===Gt&&(_=t.DEPTH_STENCIL,n.type!==Dt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Dt,x=o.convert(n.type))),r.texImage2D(t.TEXTURE_2D,0,_,f.width,f.height,0,g,x,null)}else if(n.isDataTexture)if(w.length>0&&v){for(var S=0,T=w.length;S<T;S++)r.texImage2D(t.TEXTURE_2D,S,g,(b=w[S]).width,b.height,0,g,x,b.data);n.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else r.texImage2D(t.TEXTURE_2D,0,g,f.width,f.height,0,g,x,f.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(S=0,T=w.length;S<T;S++)b=w[S],n.format!==kt&&n.format!==Ut?r.getCompressedTextureFormats().indexOf(g)>-1?r.compressedTexImage2D(t.TEXTURE_2D,S,g,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(t.TEXTURE_2D,S,g,b.width,b.height,0,g,x,b.data);e.__maxMipLevel=w.length-1}else if(w.length>0&&v){for(S=0,T=w.length;S<T;S++)r.texImage2D(t.TEXTURE_2D,S,g,g,x,b=w[S]);n.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else r.texImage2D(t.TEXTURE_2D,0,g,g,x,f),e.__maxMipLevel=0;d(n,v)&&p(t.TEXTURE_2D,n,f.width,f.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(v,e,f);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e)}}r.activeTexture(t.TEXTURE0+f),r.bindTexture(t.TEXTURE_2D,v.__webglTexture)}function y(r,a,s){var l;if(s?(t.texParameteri(r,t.TEXTURE_WRAP_S,o.convert(a.wrapS)),t.texParameteri(r,t.TEXTURE_WRAP_T,o.convert(a.wrapT)),t.texParameteri(r,t.TEXTURE_MAG_FILTER,o.convert(a.magFilter)),t.texParameteri(r,t.TEXTURE_MIN_FILTER,o.convert(a.minFilter))):(t.texParameteri(r,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(r,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),a.wrapS===vt&&a.wrapT===vt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",a),t.texParameteri(r,t.TEXTURE_MAG_FILTER,f(a.magFilter)),t.texParameteri(r,t.TEXTURE_MIN_FILTER,f(a.minFilter)),a.minFilter!==yt&&a.minFilter!==wt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",a)),l=e.get("EXT_texture_filter_anisotropic")){if(a.type===Ot&&null===e.get("OES_texture_float_linear"))return;if(a.type===Nt&&null===e.get("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(t.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function x(e,i,a,s){var l=o.convert(i.texture.format),c=o.convert(i.texture.type);r.texImage2D(s,0,l,i.width,i.height,0,l,c,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,a,s,n.get(i.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function b(e,r){t.bindRenderbuffer(t.RENDERBUFFER,e),r.depthBuffer&&!r.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r.width,r.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):r.depthBuffer&&r.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,r.width,r.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,r.width,r.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}this.setTexture2D=g,this.setTextureCube=function(e,s){var l=n.get(e);if(6===e.image.length)if(e.version>0&&l.__version!==e.version){l.__image__webglTextureCube||(e.addEventListener("dispose",m),l.__image__webglTextureCube=t.createTexture(),a.memory.textures++),r.activeTexture(t.TEXTURE0+s),r.bindTexture(t.TEXTURE_CUBE_MAP,l.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var c=e&&e.isCompressedTexture,f=e.image[0]&&e.image[0].isDataTexture,v=[],g=0;g<6;g++)v[g]=c||f?f?e.image[g].image:e.image[g]:u(e.image[g],i.maxCubemapSize);var x=v[0],b=h(x),w=o.convert(e.format),_=o.convert(e.type);for(y(t.TEXTURE_CUBE_MAP,e,b),g=0;g<6;g++)if(c)for(var S,T=v[g].mipmaps,M=0,A=T.length;M<A;M++)S=T[M],e.format!==kt&&e.format!==Ut?r.getCompressedTextureFormats().indexOf(w)>-1?r.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,w,_,S.data);else f?r.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,v[g].width,v[g].height,0,w,_,v[g].data):r.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,w,_,v[g]);l.__maxMipLevel=c?T.length-1:0,d(e,b)&&p(t.TEXTURE_CUBE_MAP,e,x.width,x.height),l.__version=e.version,e.onUpdate&&e.onUpdate(e)}else r.activeTexture(t.TEXTURE0+s),r.bindTexture(t.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,i){r.activeTexture(t.TEXTURE0+i),r.bindTexture(t.TEXTURE_CUBE_MAP,n.get(e).__webglTexture)},this.setupRenderTarget=function(e){var i=n.get(e),o=n.get(e.texture);e.addEventListener("dispose",v),o.__webglTexture=t.createTexture(),a.memory.textures++;var s=!0===e.isWebGLRenderTargetCube,l=h(e);if(s){i.__webglFramebuffer=[];for(var c=0;c<6;c++)i.__webglFramebuffer[c]=t.createFramebuffer()}else i.__webglFramebuffer=t.createFramebuffer();if(s){for(r.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture),y(t.TEXTURE_CUBE_MAP,e.texture,l),c=0;c<6;c++)x(i.__webglFramebuffer[c],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+c);d(e.texture,l)&&p(t.TEXTURE_CUBE_MAP,e.texture,e.width,e.height),r.bindTexture(t.TEXTURE_CUBE_MAP,null)}else r.bindTexture(t.TEXTURE_2D,o.__webglTexture),y(t.TEXTURE_2D,e.texture,l),x(i.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),d(e.texture,l)&&p(t.TEXTURE_2D,e.texture,e.width,e.height),r.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&function(e){var r=n.get(e),i=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),g(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Vt)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,i,0);else{if(r.depthTexture.format!==Gt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,i,0)}}(r.__webglFramebuffer,e)}else if(i){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=t.createRenderbuffer(),b(r.__webglDepthbuffer[o],e)}else t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),b(r.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}(e)},this.updateRenderTargetMipmap=function(e){var i=e.texture;if(d(i,h(e))){var o=e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,a=n.get(i).__webglTexture;r.bindTexture(o,a),p(o,i,e.width,e.height),r.bindTexture(o,null)}}}(w,_,O,L,P,st,N),R=new function(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=e.get(r);n&&(t.deleteBuffer(n.buffer),e.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=e.get(r);void 0===i?e.set(r,function(e,r){var n=e.array,i=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,o=t.createBuffer();t.bindBuffer(r,o),t.bufferData(r,n,i),e.onUploadCallback();var a=t.FLOAT;return n instanceof Float32Array?a=t.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?a=t.UNSIGNED_SHORT:n instanceof Int16Array?a=t.SHORT:n instanceof Uint32Array?a=t.UNSIGNED_INT:n instanceof Int32Array?a=t.INT:n instanceof Int8Array?a=t.BYTE:n instanceof Uint8Array&&(a=t.UNSIGNED_BYTE),{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(r,n)):i.version<r.version&&(function(e,r,n){var o=r.array,a=r.updateRange;t.bindBuffer(n,i.buffer),!1===r.dynamic?t.bufferData(n,o,t.STATIC_DRAW):-1===a.count?t.bufferSubData(n,0,o):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(0,r,n),i.version=r.version)}}}(w),D=new function(t,e,r){var n={},i={};function o(t){var a=t.target,s=n[a.id];for(var l in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[l]);a.removeEventListener("dispose",o),delete n[a.id];var c=i[a.id];c&&(e.remove(c),delete i[a.id]),(c=i[s.id])&&(e.remove(c),delete i[s.id]),r.memory.geometries--}return{get:function(t,e){var i=n[e.id];return i||(e.addEventListener("dispose",o),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Mr).setFromObject(t)),i=e._bufferGeometry),n[e.id]=i,r.memory.geometries++,i)},update:function(r){var n=r.index,i=r.attributes;for(var o in null!==n&&e.update(n,t.ELEMENT_ARRAY_BUFFER),i)e.update(i[o],t.ARRAY_BUFFER);var a=r.morphAttributes;for(var o in a)for(var s=a[o],l=0,c=s.length;l<c;l++)e.update(s[l],t.ARRAY_BUFFER)},getWireframeAttribute:function(r){var n=i[r.id];if(n)return n;var o,a=[],s=r.index,l=r.attributes;if(null!==s)for(var c=0,u=(o=s.array).length;c<u;c+=3)a.push(h=o[c+0],d=o[c+1],d,p=o[c+2],p,h);else for(c=0,u=(o=l.position.array).length/3-1;c<u;c+=3){var h,d,p;a.push(h=c+0,d=c+1,d,p=c+2,p,h)}return n=new(Sr(a)>65535?xr:gr)(a,1),e.update(n,t.ELEMENT_ARRAY_BUFFER),i[r.id]=n,n}}}(w,R,N),F=new function(t,e){var r={};return{update:function(n){var i=e.render.frame,o=n.geometry,a=t.get(n,o);return r[a.id]!==i&&(o.isGeometry&&a.updateFromObject(n),t.update(a),r[a.id]=i),a},dispose:function(){r={}}}}(D,N),z=new function(t){var e={},r=new Float32Array(8);return{update:function(n,i,o,a){var s=n.morphTargetInfluences,l=s.length,c=e[i.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];e[i.id]=c}var h=o.morphTargets&&i.morphAttributes.position,d=o.morphNormals&&i.morphAttributes.normal;for(u=0;u<l;u++)0!==(p=c[u])[1]&&(h&&i.removeAttribute("morphTarget"+u),d&&i.removeAttribute("morphNormal"+u));for(u=0;u<l;u++)(p=c[u])[0]=u,p[1]=s[u];for(c.sort(kr),u=0;u<8;u++){var p;if(p=c[u]){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+u,h[f]),d&&i.addAttribute("morphNormal"+u,d[f]),r[u]=m;continue}}r[u]=0}a.getUniforms().setValue(t,"morphTargetInfluences",r)}}}(w),U=new function(t,e,r){var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function a(t,e){var r;return t?t.isTexture?r=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=t.texture.encoding):r=Me,r===Me&&e&&(r=Ee),r}this.getParameters=function(e,n,o,s,l,c,u){var h=i[e.type],d=u.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(r.floatVertexTextures)return 1024;var n=Math.floor((r.maxVertexUniforms-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}(u):0,p=r.precision;null!==e.precision&&(p=r.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",p,"instead.");var f=t.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:r.vertexTextures,outputEncoding:a(f?f.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:a(e.map,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:a(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===pt||e.envMap.mapping===ft),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:a(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!s,useFog:e.fog,fogExp:s&&s.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:e.skinning&&d>0,maxBones:d,useVertexTexture:r.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&u.receiveShadow&&o.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===g,flipSided:e.side===v,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)n.push(i),n.push(e.defines[i]);for(var a=0;a<o.length;a++)n.push(r[o[a]]);return n.push(e.onBeforeCompile.toString()),n.push(t.gammaOutput),n.join()},this.acquireProgram=function(r,i,o,a){for(var s,l=0,c=n.length;l<c;l++){var u=n[l];if(u.code===a){++(s=u).usedTimes;break}}return void 0===s&&(s=new function(t,e,r,n,i,o){var a=t.context,s=n.defines,l=i.vertexShader,c=i.fragmentShader,u="SHADOWMAP_TYPE_BASIC";o.shadowMapType===p?u="SHADOWMAP_TYPE_PCF":o.shadowMapType===f&&(u="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case lt:case ct:h="ENVMAP_TYPE_CUBE";break;case pt:case ft:h="ENVMAP_TYPE_CUBE_UV";break;case ut:case ht:h="ENVMAP_TYPE_EQUIREC";break;case dt:h="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case ct:case ht:d="ENVMAP_MODE_REFRACTION"}switch(n.combine){case $:m="ENVMAP_BLENDING_MULTIPLY";break;case tt:m="ENVMAP_BLENDING_MIX";break;case et:m="ENVMAP_BLENDING_ADD"}}var v,g,y=t.gammaFactor>0?t.gammaFactor:1,x=function(t,e,r){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(On).join("\n")}(n.extensions,o,e),b=function(t){var e=[];for(var r in t){var n=t[r];!1!==n&&e.push("#define "+r+" "+n)}return e.join("\n")}(s),w=a.createProgram();n.isRawShaderMaterial?((v=[b].filter(On).join("\n")).length>0&&(v+="\n"),(g=[x,b].filter(On).join("\n")).length>0&&(g+="\n")):(v=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+u:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(On).join("\n"),g=[x,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+y,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+h:"",o.envMap?"#define "+d:"",o.envMap?"#define "+m:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+u:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&e.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==rt?"#define TONE_MAPPING":"",o.toneMapping!==rt?Qe.tonemapping_pars_fragment:"",o.toneMapping!==rt?function(t,e){var r;switch(e){case nt:r="Linear";break;case it:r="Reinhard";break;case ot:r="Uncharted2";break;case at:r="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 toneMapping( vec3 color ) { return "+r+"ToneMapping( color ); }"}(0,o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?Qe.encodings_pars_fragment:"",o.mapEncoding?Pn("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?Pn("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Pn("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function(t,e){var r=Cn(o.outputEncoding);return"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}():"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(On).join("\n")),l=Ln(l=Nn(l=In(l),o),o),c=Ln(c=Nn(c=In(c),o),o),l=Rn(l);var _=g+(c=Rn(c)),S=An(a,a.VERTEX_SHADER,v+l),T=An(a,a.FRAGMENT_SHADER,_);a.attachShader(w,S),a.attachShader(w,T),void 0!==n.index0AttributeName?a.bindAttribLocation(w,0,n.index0AttributeName):!0===o.morphTargets&&a.bindAttribLocation(w,0,"position"),a.linkProgram(w);var M,A,E=a.getProgramInfoLog(w).trim(),C=a.getShaderInfoLog(S).trim(),P=a.getShaderInfoLog(T).trim(),O=!0,N=!0;return!1===a.getProgramParameter(w,a.LINK_STATUS)?(O=!1,console.error("THREE.WebGLProgram: shader error: ",a.getError(),"gl.VALIDATE_STATUS",a.getProgramParameter(w,a.VALIDATE_STATUS),"gl.getProgramInfoLog",E,C,P)):""!==E?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",E):""!==C&&""!==P||(N=!1),N&&(this.diagnostics={runnable:O,material:n,programLog:E,vertexShader:{log:C,prefix:v},fragmentShader:{log:P,prefix:g}}),a.deleteShader(S),a.deleteShader(T),this.getUniforms=function(){return void 0===M&&(M=new Mn(a,w,t)),M},this.getAttributes=function(){return void 0===A&&(A=function(t,e){for(var r={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var o=t.getActiveAttrib(e,i).name;r[o]=t.getAttribLocation(e,o)}return r}(a,w)),A},this.destroy=function(){a.deleteProgram(w),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=En++,this.code=r,this.usedTimes=1,this.program=w,this.vertexShader=S,this.fragmentShader=T,this}(t,e,a,r,i,o),n.push(s)),s},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}(mt,_,P),k=new function(){var t={};return{get:function(e,r){var n=e.id+","+r.id,i=t[n];return void 0===i&&(i=new function(){var t=[],e=0,r=[],n=[];return{opaque:r,transparent:n,init:function(){e=0,r.length=0,n.length=0},push:function(i,o,a,s,l){var c=t[e];void 0===c?t[e]=c={id:i.id,object:i,geometry:o,material:a,program:a.program,renderOrder:i.renderOrder,z:s,group:l}:(c.id=i.id,c.object=i,c.geometry=o,c.material=a,c.program=a.program,c.renderOrder=i.renderOrder,c.z=s,c.group=l),(!0===a.transparent?n:r).push(c),e++},sort:function(){r.length>1&&r.sort(Dn),n.length>1&&n.sort(Fn)}}},t[n]=i),i},dispose:function(){t={}}}},B=new function(){var t={};return{get:function(e,r){var n=e.id+","+r.id,i=t[n];return void 0===i&&(i=new function(){var t=new function(){var t=new function(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new Be,color:new tr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"SpotLight":r={position:new Be,direction:new Be,color:new tr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"PointLight":r={position:new Be,color:new tr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Fe,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Be,skyColor:new tr,groundColor:new tr};break;case"RectAreaLight":r={color:new tr,position:new Be,halfWidth:new Be,halfHeight:new Be}}return t[e.id]=r,r}}},e={id:Un++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new Be,n=new Ue,i=new Ue;return{setup:function(o,a,s){for(var l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,v=s.matrixWorldInverse,g=0,y=o.length;g<y;g++){var x=o[g],b=x.color,w=x.intensity,_=x.distance,S=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)l+=b.r*w,c+=b.g*w,u+=b.b*w;else if(x.isDirectionalLight)(M=t.get(x)).color.copy(x.color).multiplyScalar(x.intensity),M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(v),M.shadow=x.castShadow,x.castShadow&&(M.shadowBias=(T=x.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),e.directionalShadowMap[h]=S,e.directionalShadowMatrix[h]=x.shadow.matrix,e.directional[h]=M,h++;else if(x.isSpotLight)(M=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),M.color.copy(b).multiplyScalar(w),M.distance=_,M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(v),M.coneCos=Math.cos(x.angle),M.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),M.decay=0===x.distance?0:x.decay,M.shadow=x.castShadow,x.castShadow&&(M.shadowBias=(T=x.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),e.spotShadowMap[p]=S,e.spotShadowMatrix[p]=x.shadow.matrix,e.spot[p]=M,p++;else if(x.isRectAreaLight)(M=t.get(x)).color.copy(b).multiplyScalar(w),M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),i.identity(),n.copy(x.matrixWorld),n.premultiply(v),i.extractRotation(n),M.halfWidth.set(.5*x.width,0,0),M.halfHeight.set(0,.5*x.height,0),M.halfWidth.applyMatrix4(i),M.halfHeight.applyMatrix4(i),e.rectArea[f]=M,f++;else if(x.isPointLight){var T;(M=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),M.color.copy(x.color).multiplyScalar(x.intensity),M.distance=x.distance,M.decay=0===x.distance?0:x.decay,M.shadow=x.castShadow,x.castShadow&&(M.shadowBias=(T=x.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize,M.shadowCameraNear=T.camera.near,M.shadowCameraFar=T.camera.far),e.pointShadowMap[d]=S,e.pointShadowMatrix[d]=x.shadow.matrix,e.point[d]=M,d++}else if(x.isHemisphereLight){var M;(M=t.get(x)).direction.setFromMatrixPosition(x.matrixWorld),M.direction.transformDirection(v),M.direction.normalize(),M.skyColor.copy(x.color).multiplyScalar(w),M.groundColor.copy(x.groundColor).multiplyScalar(w),e.hemi[m]=M,m++}}e.ambient[0]=l,e.ambient[1]=c,e.ambient[2]=u,e.directional.length=h,e.spot.length=p,e.rectArea.length=f,e.point.length=d,e.hemi.length=m,e.hash=e.id+","+h+","+d+","+p+","+f+","+m+","+a.length},state:e}},e=[],r=[],n=[];return{init:function(){e.length=0,r.length=0,n.length=0},state:{lightsArray:e,shadowsArray:r,spritesArray:n,lights:t},setupLights:function(n){t.setup(e,r,n)},pushLight:function(t){e.push(t)},pushShadow:function(t){r.push(t)},pushSprite:function(t){n.push(t)}}},t[n]=i),i},dispose:function(){t={}}}},j=new function(t,e,r,n){var i,o,a,s=new tr(0),l=0;function c(t,r){e.buffers.color.setClear(t.r,t.g,t.b,r,n)}return{getClearColor:function(){return s},setClearColor:function(t,e){s.set(t),c(s,l=void 0!==e?e:1)},getClearAlpha:function(){return l},setClearAlpha:function(t){c(s,l=t)},render:function(e,n,u,h){var d=n.background;null===d?c(s,l):d&&d.isColor&&(c(d,1),h=!0),(t.autoClear||h)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),d&&d.isCubeTexture?(void 0===a&&((a=new Ur(new Er(1,1,1),new Ir({uniforms:rr.cube.uniforms,vertexShader:rr.cube.vertexShader,fragmentShader:rr.cube.fragmentShader,side:v,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},r.update(a.geometry)),a.material.uniforms.tCube.value=d,e.push(a,a.geometry,a.material,0,null)):d&&d.isTexture&&(void 0===i&&(i=new lr(-1,1,1,-1,0,1),o=new Ur(new Pr(2,2),new Lr({depthTest:!1,depthWrite:!1,fog:!1})),r.update(o.geometry)),o.material.map=d,t.renderBufferDirect(i,null,o.geometry,o.material,o,null))}}}(mt,O,D,h),V=new function(t,e,r){var n;this.setMode=function(t){n=t},this.render=function(e,i){t.drawArrays(n,e,i),r.update(i,n)},this.renderInstances=function(t,i,o){var a=e.get("ANGLE_instanced_arrays");if(null!==a){var s=t.attributes.position;s.isInterleavedBufferAttribute?a.drawArraysInstancedANGLE(n,0,o=s.data.count,t.maxInstancedCount):a.drawArraysInstancedANGLE(n,i,o,t.maxInstancedCount),r.update(o,n,t.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(w,_,N),G=new function(t,e,r){var n,i,o;this.setMode=function(t){n=t},this.setIndex=function(t){i=t.type,o=t.bytesPerElement},this.render=function(e,a){t.drawElements(n,a,i,e*o),r.update(a,n)},this.renderInstances=function(t,a,s){var l=e.get("ANGLE_instanced_arrays");null!==l?(l.drawElementsInstancedANGLE(n,s,i,a*o,t.maxInstancedCount),r.update(s,n,t.maxInstancedCount)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(w,_,N),H=new function(t,e,r,n,i){var o,a,s,l,c,u,h=new Be,d=new ke,p=new Be;function f(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(m,v,g){if(0!==m.length){void 0===s&&function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),r=new Uint16Array([0,1,2,0,2,3]);o=e.createBuffer(),a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW),s=function(){var t=e.createProgram(),r=e.createShader(e.VERTEX_SHADER),n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(r,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),e.shaderSource(n,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),e.compileShader(r),e.compileShader(n),e.attachShader(t,r),e.attachShader(t,n),e.linkProgram(t),t}(),l={position:e.getAttribLocation(s,"position"),uv:e.getAttribLocation(s,"uv")},c={uvOffset:e.getUniformLocation(s,"uvOffset"),uvScale:e.getUniformLocation(s,"uvScale"),rotation:e.getUniformLocation(s,"rotation"),center:e.getUniformLocation(s,"center"),scale:e.getUniformLocation(s,"scale"),color:e.getUniformLocation(s,"color"),map:e.getUniformLocation(s,"map"),opacity:e.getUniformLocation(s,"opacity"),modelViewMatrix:e.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(s,"projectionMatrix"),fogType:e.getUniformLocation(s,"fogType"),fogDensity:e.getUniformLocation(s,"fogDensity"),fogNear:e.getUniformLocation(s,"fogNear"),fogFar:e.getUniformLocation(s,"fogFar"),fogColor:e.getUniformLocation(s,"fogColor"),fogDepth:e.getUniformLocation(s,"fogDepth"),alphaTest:e.getUniformLocation(s,"alphaTest")};var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=8,n.height=8;var h=n.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),u=new zn(n)}(),r.useProgram(s),r.initAttributes(),r.enableAttribute(l.position),r.enableAttribute(l.uv),r.disableUnusedAttributes(),r.disable(e.CULL_FACE),r.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(l.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(l.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.uniformMatrix4fv(c.projectionMatrix,!1,g.projectionMatrix.elements),r.activeTexture(e.TEXTURE0),e.uniform1i(c.map,0);var y=0,x=0,b=v.fog;b?(e.uniform3f(c.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(e.uniform1f(c.fogNear,b.near),e.uniform1f(c.fogFar,b.far),e.uniform1i(c.fogType,1),y=1,x=1):b.isFogExp2&&(e.uniform1f(c.fogDensity,b.density),e.uniform1i(c.fogType,2),y=2,x=2)):(e.uniform1i(c.fogType,0),y=0,x=0);for(var w=0,_=m.length;w<_;w++)(M=m[w]).modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,M.matrixWorld),M.z=-M.modelViewMatrix.elements[14];m.sort(f);var S=[],T=[];for(w=0,_=m.length;w<_;w++){var M,A=(M=m[w]).material;if(!1!==A.visible){M.onBeforeRender(t,v,g,void 0,A,void 0),e.uniform1f(c.alphaTest,A.alphaTest),e.uniformMatrix4fv(c.modelViewMatrix,!1,M.modelViewMatrix.elements),M.matrixWorld.decompose(h,d,p),S[0]=p.x,S[1]=p.y,T[0]=M.center.x-.5,T[1]=M.center.y-.5;var E=0;v.fog&&A.fog&&(E=x),y!==E&&(e.uniform1i(c.fogType,E),y=E),null!==A.map?(e.uniform2f(c.uvOffset,A.map.offset.x,A.map.offset.y),e.uniform2f(c.uvScale,A.map.repeat.x,A.map.repeat.y)):(e.uniform2f(c.uvOffset,0,0),e.uniform2f(c.uvScale,1,1)),e.uniform1f(c.opacity,A.opacity),e.uniform3f(c.color,A.color.r,A.color.g,A.color.b),e.uniform1f(c.rotation,A.rotation),e.uniform2fv(c.center,T),e.uniform2fv(c.scale,S),r.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst,A.blendEquationAlpha,A.blendSrcAlpha,A.blendDstAlpha,A.premultipliedAlpha),r.buffers.depth.setTest(A.depthTest),r.buffers.depth.setMask(A.depthWrite),r.buffers.color.setMask(A.colorWrite),n.setTexture2D(A.map||u,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),M.onAfterRender(t,v,g,void 0,A,void 0)}}r.enable(e.CULL_FACE),r.reset()}}}(mt,w,O,I,P),N.programs=U.programs,mt.context=w,mt.capabilities=P,mt.extensions=_,mt.properties=L,mt.renderLists=k,mt.state=O,mt.info=N}re();var ne=new Wn(mt);this.vr=ne;var ie=new jn(mt,F,P.maxTextureSize);function oe(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),gt=!0}function ae(){console.log("THREE.WebGLRenderer: Context Restored."),gt=!1,re()}function se(t){var e=t.target;e.removeEventListener("dispose",se),function(t){le(t),L.remove(t)}(e)}function le(t){var e=L.get(t).program;t.program=void 0,void 0!==e&&U.releaseProgram(e)}this.shadowMap=ie,this.getContext=function(){return w},this.getContextAttributes=function(){return w.getContextAttributes()},this.forceContextLoss=function(){var t=_.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=_.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Ht},this.setPixelRatio=function(t){void 0!==t&&(Ht=t,this.setSize(jt,zt,!1))},this.getSize=function(){return{width:jt,height:zt}},this.setSize=function(t,r,n){var i=ne.getDevice();i&&i.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(jt=t,zt=r,e.width=t*Ht,e.height=r*Ht,!1!==n&&(e.style.width=t+"px",e.style.height=r+"px"),this.setViewport(0,0,t,r))},this.getDrawingBufferSize=function(){return{width:jt*Ht,height:zt*Ht}},this.setDrawingBufferSize=function(t,r,n){jt=t,zt=r,Ht=n,e.width=t*n,e.height=r*n,this.setViewport(0,0,t,r)},this.getCurrentViewport=function(){return It},this.setViewport=function(t,e,r,n){Wt.set(t,zt-e-n,r,n),O.viewport(It.copy(Wt).multiplyScalar(Ht))},this.setScissor=function(t,e,r,n){Xt.set(t,zt-e-n,r,n),O.scissor(Rt.copy(Xt).multiplyScalar(Ht))},this.setScissorTest=function(t){O.setScissorTest(Yt=t)},this.getClearColor=function(){return j.getClearColor()},this.setClearColor=function(){j.setClearColor.apply(j,arguments)},this.getClearAlpha=function(){return j.getClearAlpha()},this.setClearAlpha=function(){j.setClearAlpha.apply(j,arguments)},this.clear=function(t,e,r){var n=0;(void 0===t||t)&&(n|=w.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=w.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=w.STENCIL_BUFFER_BIT),w.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,r,n){this.setRenderTarget(t),this.clear(e,r,n)},this.dispose=function(){e.removeEventListener("webglcontextlost",oe,!1),e.removeEventListener("webglcontextrestored",ae,!1),k.dispose(),B.dispose(),L.dispose(),F.dispose(),ne.dispose(),he()},this.renderBufferImmediate=function(t,e,r){O.initAttributes();var n=L.get(t);t.hasPositions&&!n.position&&(n.position=w.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=w.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=w.createBuffer()),t.hasColors&&!n.color&&(n.color=w.createBuffer());var i=e.getAttributes();if(t.hasPositions&&(w.bindBuffer(w.ARRAY_BUFFER,n.position),w.bufferData(w.ARRAY_BUFFER,t.positionArray,w.DYNAMIC_DRAW),O.enableAttribute(i.position),w.vertexAttribPointer(i.position,3,w.FLOAT,!1,0,0)),t.hasNormals){if(w.bindBuffer(w.ARRAY_BUFFER,n.normal),!r.isMeshPhongMaterial&&!r.isMeshStandardMaterial&&!r.isMeshNormalMaterial&&!0===r.flatShading)for(var o=0,a=3*t.count;o<a;o+=9){var s=t.normalArray,l=(s[o+0]+s[o+3]+s[o+6])/3,c=(s[o+1]+s[o+4]+s[o+7])/3,u=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=l,s[o+1]=c,s[o+2]=u,s[o+3]=l,s[o+4]=c,s[o+5]=u,s[o+6]=l,s[o+7]=c,s[o+8]=u}w.bufferData(w.ARRAY_BUFFER,t.normalArray,w.DYNAMIC_DRAW),O.enableAttribute(i.normal),w.vertexAttribPointer(i.normal,3,w.FLOAT,!1,0,0)}t.hasUvs&&r.map&&(w.bindBuffer(w.ARRAY_BUFFER,n.uv),w.bufferData(w.ARRAY_BUFFER,t.uvArray,w.DYNAMIC_DRAW),O.enableAttribute(i.uv),w.vertexAttribPointer(i.uv,2,w.FLOAT,!1,0,0)),t.hasColors&&r.vertexColors!==b&&(w.bindBuffer(w.ARRAY_BUFFER,n.color),w.bufferData(w.ARRAY_BUFFER,t.colorArray,w.DYNAMIC_DRAW),O.enableAttribute(i.color),w.vertexAttribPointer(i.color,3,w.FLOAT,!1,0,0)),O.disableUnusedAttributes(),w.drawArrays(w.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,r,n,i,o){var a=i.isMesh&&i.matrixWorld.determinant()<0;O.setMaterial(n,a);var s=ge(t,e,n,i),l=r.id+"_"+s.id+"_"+(!0===n.wireframe),c=!1;l!==At&&(At=l,c=!0),i.morphTargetInfluences&&(z.update(i,r,n,s),c=!0);var u,h=r.index,d=r.attributes.position,p=1;!0===n.wireframe&&(h=D.getWireframeAttribute(r),p=2);var f=V;null!==h&&(u=R.get(h),(f=G).setIndex(u)),c&&(function(t,e,r,n){if(r&&r.isInstancedBufferGeometry&&null===_.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===n&&(n=0),O.initAttributes();var i=r.attributes,o=e.getAttributes(),a=t.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var c=i[s];if(void 0!==c){var u=c.normalized,h=c.itemSize,d=R.get(c);if(void 0===d)continue;var p=d.buffer,f=d.type,m=d.bytesPerElement;if(c.isInterleavedBufferAttribute){var v=c.data,g=v.stride,y=c.offset;v&&v.isInstancedInterleavedBuffer?(O.enableAttributeAndDivisor(l,v.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=v.meshPerAttribute*v.count)):O.enableAttribute(l),w.bindBuffer(w.ARRAY_BUFFER,p),w.vertexAttribPointer(l,h,f,u,g*m,(n*g+y)*m)}else c.isInstancedBufferAttribute?(O.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=c.meshPerAttribute*c.count)):O.enableAttribute(l),w.bindBuffer(w.ARRAY_BUFFER,p),w.vertexAttribPointer(l,h,f,u,0,n*h*m)}else if(void 0!==a){var x=a[s];if(void 0!==x)switch(x.length){case 2:w.vertexAttrib2fv(l,x);break;case 3:w.vertexAttrib3fv(l,x);break;case 4:w.vertexAttrib4fv(l,x);break;default:w.vertexAttrib1fv(l,x)}}}}O.disableUnusedAttributes()}}(n,s,r),null!==h&&w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,u.buffer));var m=1/0;null!==h?m=h.count:void 0!==d&&(m=d.count);var v=r.drawRange.start*p,g=r.drawRange.count*p,y=null!==o?o.start*p:0,x=null!==o?o.count*p:1/0,b=Math.max(v,y),S=Math.min(m,v+g,y+x)-1,T=Math.max(0,S-b+1);if(0!==T){if(i.isMesh)if(!0===n.wireframe)O.setLineWidth(n.wireframeLinewidth*te()),f.setMode(w.LINES);else switch(i.drawMode){case _e:f.setMode(w.TRIANGLES);break;case Se:f.setMode(w.TRIANGLE_STRIP);break;case Te:f.setMode(w.TRIANGLE_FAN)}else if(i.isLine){var M=n.linewidth;void 0===M&&(M=1),O.setLineWidth(M*te()),f.setMode(i.isLineSegments?w.LINES:i.isLineLoop?w.LINE_LOOP:w.LINE_STRIP)}else i.isPoints&&f.setMode(w.POINTS);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&f.renderInstances(r,b,T):f.render(b,T)}},this.compile=function(t,e){(x=B.get(t,e)).init(),t.traverse(function(t){t.isLight&&(x.pushLight(t),t.castShadow&&x.pushShadow(t))}),x.setupLights(e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var r=0;r<e.material.length;r++)ve(e.material[r],t.fog,e);else ve(e.material,t.fog,e)})};var ce=!1,ue=null;function he(){ce=!1}function de(){var t=ne.getDevice();t&&t.isPresenting?t.requestAnimationFrame(pe):window.requestAnimationFrame(pe)}function pe(t){!1!==ce&&(ue(t),de())}function fe(t,e,r,n){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,l=a.geometry,c=void 0===n?a.material:n,u=a.group;if(r.isArrayCamera){Lt=r;for(var h=r.cameras,d=0,p=h.length;d<p;d++){var f=h[d];if(s.layers.test(f.layers)){var m=f.bounds;O.viewport(It.set(m.x*jt,m.y*zt,m.z*jt,m.w*zt).multiplyScalar(Ht)),me(s,e,f,l,c,u)}}}else Lt=null,me(s,e,r,l,c,u)}}function me(t,e,r,n,i,o){if(t.onBeforeRender(mt,e,r,n,i,o),x=B.get(e,Lt||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var a=t.isMesh&&t.matrixWorld.determinant()<0;O.setMaterial(i,a);var s=ge(r,e.fog,i,t);At="",function(t,e,r){t.render(function(t){mt.renderBufferImmediate(t,e,r)})}(t,s,i)}else mt.renderBufferDirect(r,e.fog,n,i,t,o);t.onAfterRender(mt,e,r,n,i,o),x=B.get(e,Lt||r)}function ve(t,e,r){var n=L.get(t),i=x.state.lights,o=U.getParameters(t,i.state,x.state.shadowsArray,e,Jt.numPlanes,Jt.numIntersection,r),a=U.getProgramCode(t,o),s=n.program,l=!0;if(void 0===s)t.addEventListener("dispose",se);else if(s.code!==a)le(t);else if(n.lightsHash!==i.state.hash)L.update(t,"lightsHash",i.state.hash),l=!1;else{if(void 0!==o.shaderID)return;l=!1}if(l){if(o.shaderID){var c=rr[o.shaderID];n.shader={name:t.type,uniforms:Ke.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader,mt),s=U.acquireProgram(t,n.shader,o,a),n.program=s,t.program=s}var u=s.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var h=0;h<mt.maxMorphTargets;h++)u["morphTarget"+h]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals)for(t.numSupportedMorphNormals=0,h=0;h<mt.maxMorphNormals;h++)u["morphNormal"+h]>=0&&t.numSupportedMorphNormals++;var d=n.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=Jt.numPlanes,n.numIntersection=Jt.numIntersection,d.clippingPlanes=Jt.uniform),n.fog=e,n.lightsHash=i.state.hash,t.lights&&(d.ambientLightColor.value=i.state.ambient,d.directionalLights.value=i.state.directional,d.spotLights.value=i.state.spot,d.rectAreaLights.value=i.state.rectArea,d.pointLights.value=i.state.point,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotShadowMatrix.value=i.state.spotShadowMatrix,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix);var p=n.program.getUniforms(),f=Mn.seqWithValue(p.seq,d);n.uniformsList=f}function ge(t,e,r,n){Bt=0;var i=L.get(r),o=x.state.lights;Zt&&(Qt||t!==Ct)&&Jt.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,i,t===Ct&&r.id===Mt),!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==e?r.needsUpdate=!0:r.lights&&i.lightsHash!==o.state.hash?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===Jt.numPlanes&&i.numIntersection===Jt.numIntersection||(r.needsUpdate=!0)),r.needsUpdate&&(ve(r,e,n),r.needsUpdate=!1);var a=!1,s=!1,l=!1,c=i.program,u=c.getUniforms(),h=i.shader.uniforms;if(O.useProgram(c.program)&&(a=!0,s=!0,l=!0),r.id!==Mt&&(Mt=r.id,s=!0),a||t!==Ct){if(u.setValue(w,"projectionMatrix",t.projectionMatrix),P.logarithmicDepthBuffer&&u.setValue(w,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),Ct!==(Lt||t)&&(Ct=Lt||t,s=!0,l=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var d=u.map.cameraPosition;void 0!==d&&d.setValue(w,$t.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&u.setValue(w,"viewMatrix",t.matrixWorldInverse)}if(r.skinning){u.setOptional(w,n,"bindMatrix"),u.setOptional(w,n,"bindMatrixInverse");var p=n.skeleton;if(p)if(P.floatVertexTextures){if(void 0===p.boneTexture){var f=Math.sqrt(4*p.bones.length);f=De.ceilPowerOfTwo(f),f=Math.max(f,4);var m=new Float32Array(f*f*4);m.set(p.boneMatrices);var v=new Xe(m,f,f,kt,Ot);v.needsUpdate=!0,p.boneMatrices=m,p.boneTexture=v,p.boneTextureSize=f}u.setValue(w,"boneTexture",p.boneTexture),u.setValue(w,"boneTextureSize",p.boneTextureSize)}else u.setOptional(w,p,"boneMatrices")}return s&&(u.setValue(w,"toneMappingExposure",mt.toneMappingExposure),u.setValue(w,"toneMappingWhitePoint",mt.toneMappingWhitePoint),r.lights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLights.needsUpdate=e,t.pointLights.needsUpdate=e,t.spotLights.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(h,l),e&&r.fog&&function(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(h,e),r.isMeshBasicMaterial?ye(h,r):r.isMeshLambertMaterial?(ye(h,r),function(t,e){e.emissiveMap&&(h.emissiveMap.value=e.emissiveMap)}(0,r)):r.isMeshPhongMaterial?(ye(h,r),r.isMeshToonMaterial?function(t,e){xe(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(h,r):xe(h,r)):r.isMeshStandardMaterial?(ye(h,r),r.isMeshPhysicalMaterial?function(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,be(t,e)}(h,r):be(h,r)):r.isMeshDepthMaterial?(ye(h,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(h,r)):r.isMeshDistanceMaterial?(ye(h,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(h,r)):r.isMeshNormalMaterial?(ye(h,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(h,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}(h,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(h,r)):r.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*Ht,t.scale.value=.5*zt,t.map.value=e.map,null!==e.map){if(!0===e.map.matrixAutoUpdate){var r=e.map.offset,n=e.map.repeat,i=e.map.center;e.map.matrix.setUvTransform(r.x,r.y,n.x,n.y,e.map.rotation,i.x,i.y)}t.uvTransform.value.copy(e.map.matrix)}}(h,r):r.isShadowMaterial&&(h.color.value=r.color,h.opacity.value=r.opacity),void 0!==h.ltc_1&&(h.ltc_1.value=er.LTC_1),void 0!==h.ltc_2&&(h.ltc_2.value=er.LTC_2),Mn.upload(w,i.uniformsList,h,mt)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Mn.upload(w,i.uniformsList,h,mt),r.uniformsNeedUpdate=!1),u.setValue(w,"modelViewMatrix",n.modelViewMatrix),u.setValue(w,"normalMatrix",n.normalMatrix),u.setValue(w,"modelMatrix",n.matrixWorld),c}function ye(t,e){var r;if(t.opacity.value=e.opacity,e.color&&(t.diffuse.value=e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=L.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?r=e.map:e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.roughnessMap?r=e.roughnessMap:e.metalnessMap?r=e.metalnessMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap),void 0!==r){if(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate){var n=r.offset,i=r.repeat,o=r.center;r.matrix.setUvTransform(n.x,n.y,i.x,i.y,r.rotation,o.x,o.y)}t.uvTransform.value.copy(r.matrix)}}function xe(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function be(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}this.animate=function(t){null!==(ue=t)?ce||(de(),ce=!0):he()},this.render=function(t,e,r,n){if(e&&e.isCamera){if(!gt){At="",Mt=-1,Ct=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),ne.enabled&&(e=ne.getCamera(e)),(x=B.get(t,e)).init(),t.onBeforeRender(mt,t,e,r),Kt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),qt.setFromMatrix(Kt),Zt=Jt.init(this.clippingPlanes,Qt=this.localClippingEnabled,e),(y=k.get(t,e)).init(),function t(e,r,n){if(!1!==e.visible){if(e.layers.test(r.layers))if(e.isLight)x.pushLight(e),e.castShadow&&x.pushShadow(e);else if(e.isSprite)e.frustumCulled&&!qt.intersectsSprite(e)||x.pushSprite(e);else if(e.isImmediateRenderObject)n&&$t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Kt),y.push(e,null,e.material,$t.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||qt.intersectsObject(e))){n&&$t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Kt);var i=F.update(e),o=e.material;if(Array.isArray(o))for(var a=i.groups,s=0,l=a.length;s<l;s++){var c=a[s],u=o[c.materialIndex];u&&u.visible&&y.push(e,i,u,$t.z,c)}else o.visible&&y.push(e,i,o,$t.z,null)}var h=e.children;for(s=0,l=h.length;s<l;s++)t(h[s],r,n)}}(t,e,mt.sortObjects),!0===mt.sortObjects&&y.sort(),Zt&&Jt.beginShadows(),ie.render(x.state.shadowsArray,t,e),x.setupLights(e),Zt&&Jt.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),j.render(y,t,e,n);var i=y.opaque,o=y.transparent;if(t.overrideMaterial){var a=t.overrideMaterial;i.length&&fe(i,t,e,a),o.length&&fe(o,t,e,a)}else i.length&&fe(i,t,e),o.length&&fe(o,t,e);H.render(x.state.spritesArray,t,e),r&&I.updateRenderTargetMipmap(r),O.buffers.depth.setTest(!0),O.buffers.depth.setMask(!0),O.buffers.color.setMask(!0),O.setPolygonOffset(!1),t.onAfterRender(mt,t,e),ne.enabled&&ne.submitFrame(),y=null,x=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var t=Bt;return t>=P.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+t+" texture units while this GPU supports only "+P.maxTextures),Bt+=1,t},this.setTexture2D=function(){var t=!1;return function(e,r){e&&e.isWebGLRenderTarget&&(t||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),I.setTexture2D(e,r)}}(),this.setTexture=function(){var t=!1;return function(e,r){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0),I.setTexture2D(e,r)}}(),this.setTextureCube=function(){var t=!1;return function(e,r){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?I.setTextureCube(e,r):I.setTextureCubeDynamic(e,r)}}(),this.getRenderTarget=function(){return _t},this.setRenderTarget=function(t){_t=t,t&&void 0===L.get(t).__webglFramebuffer&&I.setupRenderTarget(t);var e=null,r=!1;if(t){var n=L.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(e=n[t.activeCubeFace],r=!0):e=n,It.copy(t.viewport),Rt.copy(t.scissor),Ft=t.scissorTest}else It.copy(Wt).multiplyScalar(Ht),Rt.copy(Xt).multiplyScalar(Ht),Ft=Yt;if(St!==e&&(w.bindFramebuffer(w.FRAMEBUFFER,e),St=e),O.viewport(It),O.scissor(Rt),O.setScissorTest(Ft),r){var i=L.get(t.texture);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,i.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,r,n,i,o){if(t&&t.isWebGLRenderTarget){var a=L.get(t).__webglFramebuffer;if(a){var s=!1;a!==St&&(w.bindFramebuffer(w.FRAMEBUFFER,a),s=!0);try{var l=t.texture,c=l.format,u=l.type;if(c!==kt&&st.convert(c)!==w.getParameter(w.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===Tt||st.convert(u)===w.getParameter(w.IMPLEMENTATION_COLOR_READ_TYPE)||u===Ot&&(_.get("OES_texture_float")||_.get("WEBGL_color_buffer_float"))||u===Nt&&_.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");w.checkFramebufferStatus(w.FRAMEBUFFER)===w.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-n&&r>=0&&r<=t.height-i&&w.readPixels(e,r,n,i,st.convert(c),st.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&w.bindFramebuffer(w.FRAMEBUFFER,St)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){var n=e.image.width,i=e.image.height,o=st.convert(e.format);this.setTexture2D(e,0),w.copyTexImage2D(w.TEXTURE_2D,r||0,o,t.x,t.y,n,i,0)},this.copyTextureToTexture=function(t,e,r,n){var i=e.image.width,o=e.image.height,a=st.convert(r.format),s=st.convert(r.type),l=e.isDataTexture?e.image.data:e.image;this.setTexture2D(r,0),w.texSubImage2D(w.TEXTURE_2D,n||0,t.x,t.y,i,o,a,s,l)}}function Yn(t,e){this.name="",this.color=new tr(t),this.density=void 0!==e?e:25e-5}function qn(t,e,r){this.name="",this.color=new tr(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function Jn(){ar.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Zn(t){Nr.call(this),this.type="SpriteMaterial",this.color=new tr(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Qn(t){ar.call(this),this.type="Sprite",this.material=void 0!==t?t:new Zn,this.center=new Fe(.5,.5)}function Kn(){ar.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function $n(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Ue)}}function ti(){ar.call(this),this.type="Bone"}function ei(t,e){Ur.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ue,this.bindMatrixInverse=new Ue;var r=new $n(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}function ri(t){Nr.call(this),this.type="LineBasicMaterial",this.color=new tr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function ni(t,e,r){if(1===r)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new ii(t,e);ar.call(this),this.type="Line",this.geometry=void 0!==t?t:new Mr,this.material=void 0!==e?e:new ri({color:16777215*Math.random()})}function ii(t,e){ni.call(this,t,e),this.type="LineSegments"}function oi(t,e){ni.call(this,t,e),this.type="LineLoop"}function ai(t){Nr.call(this),this.type="PointsMaterial",this.color=new tr(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function si(t,e){ar.call(this),this.type="Points",this.geometry=void 0!==t?t:new Mr,this.material=void 0!==e?e:new ai({color:16777215*Math.random()})}function li(){ar.call(this),this.type="Group"}function ci(t,e,r,n,i,o,a,s,l){Ve.call(this,t,e,r,n,i,o,a,s,l),this.generateMipmaps=!1}function ui(t,e,r,n,i,o,a,s,l,c,u,h){Ve.call(this,null,o,a,s,l,c,n,i,u,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function hi(t,e,r,n,i,o,a,s,l,c){if((c=void 0!==c?c:Vt)!==Vt&&c!==Gt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===Vt&&(r=Et),void 0===r&&c===Gt&&(r=Dt),Ve.call(this,null,n,i,o,a,s,c,r,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:yt,this.minFilter=void 0!==s?s:yt,this.flipY=!1,this.generateMipmaps=!1}function di(t){Mr.call(this),this.type="WireframeGeometry";var e,r,n,i,o,a,s,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var v=m[e];for(r=0;r<3;r++)s=v[f[r]],l=v[f[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)h.push((u=t.vertices[(a=p[c]).index1]).x,u.y,u.z),h.push((u=t.vertices[a.index2]).x,u.y,u.z)}else if(t&&t.isBufferGeometry){var g,y,x,b,w;if(u=new Be,null!==t.index){for(g=t.attributes.position,y=t.index,0===(x=t.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(e=w=(b=x[i]).start,n=w+b.count;e<n;e+=3)for(r=0;r<3;r++)s=y.getX(e+r),l=y.getX(e+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)u.fromBufferAttribute(g,(a=p[c]).index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,a.index2),h.push(u.x,u.y,u.z)}else for(e=0,n=(g=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)u.fromBufferAttribute(g,3*e+r),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,3*e+(r+1)%3),h.push(u.x,u.y,u.z)}this.addAttribute("position",new br(h,3))}function pi(t,e,r){hr.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new fi(t,e,r)),this.mergeVertices()}function fi(t,e,r){Mr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,o=[],a=[],s=[],l=[],c=new Be,u=new Be,h=new Be,d=new Be,p=new Be,f=e+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=e;i++){var v=i/e;t(v,m,u),a.push(u.x,u.y,u.z),v-1e-5>=0?(t(v-1e-5,m,h),d.subVectors(u,h)):(t(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(t(v,m-1e-5,h),p.subVectors(u,h)):(t(v,m+1e-5,h),p.subVectors(h,u)),c.crossVectors(d,p).normalize(),s.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var g=n*f+i+1,y=(n+1)*f+i+1,x=(n+1)*f+i;o.push(n*f+i,g,x),o.push(g,y,x)}this.setIndex(o),this.addAttribute("position",new br(a,3)),this.addAttribute("normal",new br(s,3)),this.addAttribute("uv",new br(l,2))}function mi(t,e,r,n){hr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new vi(t,e,r,n)),this.mergeVertices()}function vi(t,e,r,n){Mr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],o=[];function a(t,e,r,n){var i,o,a=Math.pow(2,n),l=[];for(i=0;i<=a;i++){l[i]=[];var c=t.clone().lerp(r,i/a),u=e.clone().lerp(r,i/a),h=a-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===a?c:c.clone().lerp(u,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var d=Math.floor(o/2);o%2==0?(s(l[i][d+1]),s(l[i+1][d]),s(l[i][d])):(s(l[i][d+1]),s(l[i+1][d+1]),s(l[i+1][d]))}}function s(t){i.push(t.x,t.y,t.z)}function l(e,r){var n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function c(t,e,r,n){n<0&&1===t.x&&(o[e]=t.x-1),0===r.x&&0===r.z&&(o[e]=n/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}function h(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){for(var r=new Be,n=new Be,i=new Be,o=0;o<e.length;o+=3)l(e[o+0],r),l(e[o+1],n),l(e[o+2],i),a(r,n,i,t)}(n=n||0),function(t){for(var e=new Be,r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){for(var t=new Be,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var r=u(t)/2/Math.PI+.5,n=h(t)/Math.PI+.5;o.push(r,1-n)}(function(){for(var t=new Be,e=new Be,r=new Be,n=new Be,a=new Fe,s=new Fe,l=new Fe,h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),n.copy(t).add(e).add(r).divideScalar(3);var p=u(n);c(a,d+0,t,p),c(s,d+2,e,p),c(l,d+4,r,p)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],r=o[t+2],n=o[t+4],i=Math.max(e,r,n),a=Math.min(e,r,n);i>.9&&a<.1&&(e<.2&&(o[t+0]+=1),r<.2&&(o[t+2]+=1),n<.2&&(o[t+4]+=1))}}()}(),this.addAttribute("position",new br(i,3)),this.addAttribute("normal",new br(i.slice(),3)),this.addAttribute("uv",new br(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function gi(t,e){hr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new yi(t,e)),this.mergeVertices()}function yi(t,e){vi.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function xi(t,e){hr.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new bi(t,e)),this.mergeVertices()}function bi(t,e){vi.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function wi(t,e){hr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new _i(t,e)),this.mergeVertices()}function _i(t,e){var r=(1+Math.sqrt(5))/2;vi.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Si(t,e){hr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ti(t,e)),this.mergeVertices()}function Ti(t,e){var r=(1+Math.sqrt(5))/2,n=1/r;vi.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Mi(t,e,r,n,i,o){hr.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Ai(t,e,r,n,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Ai(t,e,r,n,i){Mr.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},e=e||64,r=r||1,n=n||8;var o=t.computeFrenetFrames(e,i=i||!1);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new Be,c=new Be,u=new Fe,h=new Be,d=[],p=[],f=[],m=[];function v(i){h=t.getPointAt(i/e,h);var a=o.normals[i],u=o.binormals[i];for(s=0;s<=n;s++){var f=s/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*a.x+m*u.x,c.y=v*a.y+m*u.y,c.z=v*a.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(a=0;a<e;a++)v(a);v(!1===i?e:0),function(){for(a=0;a<=e;a++)for(s=0;s<=n;s++)u.x=a/e,u.y=s/n,f.push(u.x,u.y)}(),function(){for(s=1;s<=e;s++)for(a=1;a<=n;a++){var t=(n+1)*s+(a-1),r=(n+1)*s+a,i=(n+1)*(s-1)+a;m.push((n+1)*(s-1)+(a-1),t,i),m.push(t,r,i)}}()}(),this.setIndex(m),this.addAttribute("position",new br(d,3)),this.addAttribute("normal",new br(p,3)),this.addAttribute("uv",new br(f,2))}function Ei(t,e,r,n,i,o,a){hr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Ci(t,e,r,n,i,o)),this.mergeVertices()}function Ci(t,e,r,n,i,o){Mr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var a,s,l=[],c=[],u=[],h=[],d=new Be,p=new Be,f=new Be,m=new Be,v=new Be,g=new Be,y=new Be;for(a=0;a<=r;++a){var x=a/r*i*Math.PI*2;for(A(x,i,o,t,f),A(x+.01,i,o,t,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,w=-e*Math.cos(b),_=e*Math.sin(b);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(a/r),h.push(s/n)}}for(s=1;s<=r;s++)for(a=1;a<=n;a++){var S=(n+1)*s+(a-1),T=(n+1)*s+a,M=(n+1)*(s-1)+a;l.push((n+1)*(s-1)+(a-1),S,M),l.push(S,T,M)}function A(t,e,r,n,i){var o=Math.cos(t),a=Math.sin(t),s=r/e*t,l=Math.cos(s);i.x=n*(2+l)*.5*o,i.y=n*(2+l)*a*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new br(c,3)),this.addAttribute("normal",new br(u,3)),this.addAttribute("uv",new br(h,2))}function Pi(t,e,r,n,i){hr.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new Oi(t,e,r,n,i)),this.mergeVertices()}function Oi(t,e,r,n,i){Mr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,a,s=[],l=[],c=[],u=[],h=new Be,d=new Be,p=new Be;for(o=0;o<=r;o++)for(a=0;a<=n;a++){var f=a/n*i,m=o/r*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),l.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(a/n),u.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=n;a++){var v=(n+1)*(o-1)+a-1,g=(n+1)*(o-1)+a,y=(n+1)*o+a;s.push((n+1)*o+a-1,v,y),s.push(v,g,y)}this.setIndex(s),this.addAttribute("position",new br(l,3)),this.addAttribute("normal",new br(c,3)),this.addAttribute("uv",new br(u,2))}function Ni(t,e,r,n,i){var o,a;if(i===function(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,r,n)>0)for(o=e;o<r;o+=n)a=Ji(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=Ji(o,t[o],t[o+1],a);return a&&Wi(a,a.next)&&(Zi(a),a=a.next),a}function Li(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Wi(n,n.next)&&0!==Hi(n.prev,n,n.next))n=n.next;else{if(Zi(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Ii(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=ji(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,c=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(a>1)}(i)}(t,n,i,o);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?Di(t,n,i,o):Ri(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),Zi(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?Ii(t=Fi(t,e,r),e,r,n,i,o,2):2===a&&Ui(t,e,r,n,i,o):Ii(Li(t),e,r,n,i,o,1);break}}}function Ri(t){var e=t.prev,r=t,n=t.next;if(Hi(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Vi(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Hi(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Di(t,e,r,n){var i=t.prev,o=t,a=t.next;if(Hi(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=ji(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),u=ji(s,l,e,r,n),h=t.nextZ;h&&h.z<=u;){if(h!==t.prev&&h!==t.next&&Vi(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Hi(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(h=t.prevZ;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Vi(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Hi(h.prev,h,h.next)>=0)return!1;h=h.prevZ}return!0}function Fi(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Wi(i,o)&&Xi(i,n,n.next,o)&&Yi(i,o)&&Yi(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Zi(n),Zi(n.next),n=t=o),n=n.next}while(n!==t);return n}function Ui(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Gi(a,s)){var l=qi(a,s);return a=Li(a,a.next),l=Li(l,l.next),Ii(a,e,r,n,i,o),void Ii(l,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function ki(t,e){return t.x-e.x}function Bi(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&Vi(o<h?i:a,o,u,h,o<h?a:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&Yi(n,t)&&(r=n,d=l),n=n.next;return r}(t,e)){var r=qi(e,t);Li(r,r.next)}}function ji(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function zi(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Vi(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function Gi(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Xi(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Yi(t,e)&&Yi(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function Hi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Wi(t,e){return t.x===e.x&&t.y===e.y}function Xi(t,e,r,n){return!!(Wi(t,e)&&Wi(r,n)||Wi(t,n)&&Wi(r,e))||Hi(t,e,r)>0!=Hi(t,e,n)>0&&Hi(r,n,t)>0!=Hi(r,n,e)>0}function Yi(t,e){return Hi(t.prev,t,t.next)<0?Hi(t,e,t.next)>=0&&Hi(t,t.prev,e)>=0:Hi(t,e,t.prev)<0||Hi(t,t.next,e)<0}function qi(t,e){var r=new Qi(t.i,t.x,t.y),n=new Qi(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Ji(t,e,r,n){var i=new Qi(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Zi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qi(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}(kn.prototype=Object.create(Nr.prototype)).constructor=kn,kn.prototype.isMeshDepthMaterial=!0,kn.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},(Bn.prototype=Object.create(Nr.prototype)).constructor=Bn,Bn.prototype.isMeshDistanceMaterial=!0,Bn.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},(zn.prototype=Object.create(Ve.prototype)).constructor=zn,Gn.prototype=Object.assign(Object.create(sr.prototype),{constructor:Gn,isPerspectiveCamera:!0,copy:function(t,e){return sr.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*De.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*De.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*De.RAD2DEG*Math.atan(Math.tan(.5*De.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*De.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a,e-=o.offsetY*r/s,n*=o.width/a,r*=o.height/s}var l=this.filmOffset;0!==l&&(i+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far)},toJSON:function(t){var e=ar.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Hn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Hn,isArrayCamera:!0}),Yn.prototype.isFogExp2=!0,Yn.prototype.clone=function(){return new Yn(this.color.getHex(),this.density)},Yn.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},qn.prototype.isFog=!0,qn.prototype.clone=function(){return new qn(this.color.getHex(),this.near,this.far)},qn.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Jn.prototype=Object.assign(Object.create(ar.prototype),{constructor:Jn,copy:function(t,e){return ar.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=ar.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),(Zn.prototype=Object.create(Nr.prototype)).constructor=Zn,Zn.prototype.isSpriteMaterial=!0,Zn.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},Qn.prototype=Object.assign(Object.create(ar.prototype),{constructor:Qn,isSprite:!0,raycast:function(){var t=new Be,e=new Be,r=new Be;return function(n,i){e.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(e,t),r.setFromMatrixScale(this.matrixWorld);var o=r.x*r.y/4;if(!(e.distanceToSquared(t)>o)){var a=n.ray.origin.distanceTo(t);a<n.near||a>n.far||i.push({distance:a,point:t.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return ar.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}}),Kn.prototype=Object.assign(Object.create(ar.prototype),{constructor:Kn,copy:function(t){ar.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);r.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object},raycast:function(){var t=new Be;return function(e,r){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,r)}}(),update:function(){var t=new Be,e=new Be;return function(r){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var i=t.distanceTo(e);n[0].object.visible=!0;for(var o=1,a=n.length;o<a&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<a;o++)n[o].object.visible=!1}}}(),toJSON:function(t){var e=ar.prototype.toJSON.call(this,t);e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Object.assign($n.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new Ue;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new Ue,e=new Ue;return function(){for(var r=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture,a=0,s=r.length;a<s;a++)t.multiplyMatrices(r[a]?r[a].matrixWorld:e,n[a]),t.toArray(i,16*a);void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new $n(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}}}),ti.prototype=Object.assign(Object.create(ar.prototype),{constructor:ti,isBone:!0}),ei.prototype=Object.assign(Object.create(Ur.prototype),{constructor:ei,isSkinnedMesh:!0,initBones:function(){var t,e,r,n,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(r=0,n=this.geometry.bones.length;r<n;r++)e=this.geometry.bones[r],t=new ti,i.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(r=0,n=this.geometry.bones.length;r<n;r++)-1!==(e=this.geometry.bones[r]).parent&&null!==e.parent&&void 0!==i[e.parent]?i[e.parent].add(i[r]):this.add(i[r])}return this.updateMatrixWorld(!0),i},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var r=this.geometry.skinWeights[e];(t=1/r.manhattanLength())!=1/0?r.multiplyScalar(t):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new Ge,i=this.geometry.attributes.skinWeight;for(e=0;e<i.count;e++)n.x=i.getX(e),n.y=i.getY(e),n.z=i.getZ(e),n.w=i.getW(e),(t=1/n.manhattanLength())!=1/0?n.multiplyScalar(t):n.set(1,0,0,0),i.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){Ur.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(ri.prototype=Object.create(Nr.prototype)).constructor=ri,ri.prototype.isLineBasicMaterial=!0,ri.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},ni.prototype=Object.assign(Object.create(ar.prototype),{constructor:ni,isLine:!0,computeLineDistances:function(){var t=new Be,e=new Be;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[0],o=1,a=n.count;o<a;o++)t.fromBufferAttribute(n,o-1),e.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=t.distanceTo(e);r.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for((i=r.lineDistances)[0]=0,o=1,a=s.length;o<a;o++)i[o]=i[o-1],i[o]+=s[o-1].distanceTo(s[o])}return this}}(),raycast:function(){var t=new Ue,e=new Rr,r=new qe;return function(n,i){var o=n.linePrecision,a=o*o,s=this.geometry,l=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)){t.getInverse(l),e.copy(n.ray).applyMatrix4(t);var c=new Be,u=new Be,h=new Be,d=new Be,p=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var f=s.index,m=s.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=p){var x=v[g+1];c.fromArray(m,3*v[g]),u.fromArray(m,3*x),e.distanceSqToSegment(c,u,d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,y=m.length/3-1;g<y;g+=p)c.fromArray(m,3*g),u.fromArray(m,3*g+3),e.distanceSqToSegment(c,u,d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(s.isGeometry){var b=s.vertices,w=b.length;for(g=0;g<w-1;g+=p){var _;e.distanceSqToSegment(b[g],b[g+1],d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ii.prototype=Object.assign(Object.create(ni.prototype),{constructor:ii,isLineSegments:!0,computeLineDistances:function(){var t=new Be,e=new Be;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],o=0,a=n.count;o<a;o+=2)t.fromBufferAttribute(n,o),e.fromBufferAttribute(n,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e);r.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for(i=r.lineDistances,o=0,a=s.length;o<a;o+=2)t.copy(s[o]),e.copy(s[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e)}return this}}()}),oi.prototype=Object.assign(Object.create(ni.prototype),{constructor:oi,isLineLoop:!0}),(ai.prototype=Object.create(Nr.prototype)).constructor=ai,ai.prototype.isPointsMaterial=!0,ai.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},si.prototype=Object.assign(Object.create(ar.prototype),{constructor:si,isPoints:!0,raycast:function(){var t=new Ue,e=new Rr,r=new qe;return function(n,i){var o=this,a=this.geometry,s=this.matrixWorld,l=n.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(s),r.radius+=l,!1!==n.ray.intersectsSphere(r)){t.getInverse(s),e.copy(n.ray).applyMatrix4(t);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Be,d=new Be;if(a.isBufferGeometry){var p=a.index,f=a.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var x=f.length/3;v<x;v++)h.fromArray(f,3*v),w(h,v)}}else{var b=a.vertices;for(v=0,x=b.length;v<x;v++)w(b[v],v)}}function w(t,r){var a=e.distanceSqToPoint(t);if(a<u){e.closestPointToPoint(t,d),d.applyMatrix4(s);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(a),point:d.clone(),index:r,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),li.prototype=Object.assign(Object.create(ar.prototype),{constructor:li,isGroup:!0}),ci.prototype=Object.assign(Object.create(Ve.prototype),{constructor:ci,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(ui.prototype=Object.create(Ve.prototype)).constructor=ui,ui.prototype.isCompressedTexture=!0,(hi.prototype=Object.create(Ve.prototype)).constructor=hi,hi.prototype.isDepthTexture=!0,(di.prototype=Object.create(Mr.prototype)).constructor=di,(pi.prototype=Object.create(hr.prototype)).constructor=pi,(fi.prototype=Object.create(Mr.prototype)).constructor=fi,(mi.prototype=Object.create(hr.prototype)).constructor=mi,(vi.prototype=Object.create(Mr.prototype)).constructor=vi,(gi.prototype=Object.create(hr.prototype)).constructor=gi,(yi.prototype=Object.create(vi.prototype)).constructor=yi,(xi.prototype=Object.create(hr.prototype)).constructor=xi,(bi.prototype=Object.create(vi.prototype)).constructor=bi,(wi.prototype=Object.create(hr.prototype)).constructor=wi,(_i.prototype=Object.create(vi.prototype)).constructor=_i,(Si.prototype=Object.create(hr.prototype)).constructor=Si,(Ti.prototype=Object.create(vi.prototype)).constructor=Ti,(Mi.prototype=Object.create(hr.prototype)).constructor=Mi,(Ai.prototype=Object.create(Mr.prototype)).constructor=Ai,(Ei.prototype=Object.create(hr.prototype)).constructor=Ei,(Ci.prototype=Object.create(Mr.prototype)).constructor=Ci,(Pi.prototype=Object.create(hr.prototype)).constructor=Pi,(Oi.prototype=Object.create(Mr.prototype)).constructor=Oi;var Ki={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return Ki.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];$i(t),to(r,t);var o=t.length;e.forEach($i);for(var a=0;a<e.length;a++)n.push(o),o+=e[a].length,to(r,e[a]);var s=function(t,e,r){r=r||2;var n,i,o,a,s,l,c,u=e&&e.length,h=u?e[0]*r:t.length,d=Ni(t,0,h,r,!0),p=[];if(!d)return p;if(u&&(d=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Ni(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(zi(a));for(s.sort(ki),i=0;i<s.length;i++)Bi(s[i],r),r=Li(r,r.next);return r}(t,e,d,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)l=t[f+1],(s=t[f])<n&&(n=s),l<i&&(i=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return Ii(d,p,r,n,i,c),p}(r,n);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function $i(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function to(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function eo(t,e){hr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new ro(t,e)),this.mergeVertices()}function ro(t,e){void 0!==t&&(Mr.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function no(t,e){hr.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new io(t,e)),this.mergeVertices()}function io(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new hr;var n=r.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),ro.call(this,n,e),this.type="TextBufferGeometry"}function oo(t,e,r,n,i,o,a){hr.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new ao(t,e,r,n,i,o,a)),this.mergeVertices()}function ao(t,e,r,n,i,o,a){Mr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var s,l,c=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),u=0,h=[],d=new Be,p=new Be,f=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],x=l/r;for(s=0;s<=e;s++){var b=s/e;d.x=-t*Math.cos(n+b*i)*Math.sin(o+x*a),d.y=t*Math.cos(o+x*a),d.z=t*Math.sin(n+b*i)*Math.sin(o+x*a),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(b,1-x),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(s=0;s<e;s++){var w=h[l][s],_=h[l+1][s],S=h[l+1][s+1];(0!==l||o>0)&&f.push(h[l][s+1],w,S),(l!==r-1||c<Math.PI)&&f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new br(m,3)),this.addAttribute("normal",new br(v,3)),this.addAttribute("uv",new br(g,2))}function so(t,e,r,n,i,o){hr.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new lo(t,e,r,n,i,o)),this.mergeVertices()}function lo(t,e,r,n,i,o){Mr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,l,c=[],u=[],h=[],d=[],p=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new Be,v=new Fe;for(s=0;s<=n;s++){for(l=0;l<=r;l++)a=i+l/r*o,m.x=p*Math.cos(a),m.y=p*Math.sin(a),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/e+1)/2,v.y=(m.y/e+1)/2,d.push(v.x,v.y);p+=f}for(s=0;s<n;s++){var g=s*(r+1);for(l=0;l<r;l++){var y=(a=l+g)+r+1,x=a+r+2,b=a+1;c.push(a,y,b),c.push(y,x,b)}}this.setIndex(c),this.addAttribute("position",new br(u,3)),this.addAttribute("normal",new br(h,3)),this.addAttribute("uv",new br(d,2))}function co(t,e,r,n){hr.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new uo(t,e,r,n)),this.mergeVertices()}function uo(t,e,r,n){Mr.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=De.clamp(n,0,2*Math.PI);var i,o,a,s=[],l=[],c=[],u=1/e,h=new Be,d=new Fe;for(o=0;o<=e;o++){var p=r+o*u*n,f=Math.sin(p),m=Math.cos(p);for(a=0;a<=t.length-1;a++)h.x=t[a].x*f,h.y=t[a].y,h.z=t[a].x*m,l.push(h.x,h.y,h.z),d.x=o/e,d.y=a/(t.length-1),c.push(d.x,d.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var v=(i=a+o*t.length)+t.length,g=i+t.length+1,y=i+1;s.push(i,v,y),s.push(v,g,y)}if(this.setIndex(s),this.addAttribute("position",new br(l,3)),this.addAttribute("uv",new br(c,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,b=new Be,w=new Be,_=new Be;for(i=e*t.length*3,o=0,a=0;o<t.length;o++,a+=3)b.x=x[a+0],b.y=x[a+1],b.z=x[a+2],w.x=x[i+a+0],w.y=x[i+a+1],w.z=x[i+a+2],_.addVectors(b,w).normalize(),x[a+0]=x[i+a+0]=_.x,x[a+1]=x[i+a+1]=_.y,x[a+2]=x[i+a+2]=_.z}}function ho(t,e){hr.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new po(t,e)),this.mergeVertices()}function po(t,e){Mr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(t))c(t);else for(var l=0;l<t.length;l++)c(t[l]),this.addGroup(a,s,l),a+=s,s=0;function c(t){var a,l,c,u=n.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;if(!1===Ki.isClockWise(d))for(d=d.reverse(),a=0,l=p.length;a<l;a++)!0===Ki.isClockWise(c=p[a])&&(p[a]=c.reverse());var f=Ki.triangulateShape(d,p);for(a=0,l=p.length;a<l;a++)d=d.concat(c=p[a]);for(a=0,l=d.length;a<l;a++){var m=d[a];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var v=f[a];r.push(v[0]+u,v[1]+u,v[2]+u),s+=3}}this.setIndex(r),this.addAttribute("position",new br(n,3)),this.addAttribute("normal",new br(i,3)),this.addAttribute("uv",new br(o,2))}function fo(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++)e.shapes.push(t[r].uuid);else e.shapes.push(t.uuid);return e}function mo(t,e){Mr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,n,i,o,a=[],s=Math.cos(De.DEG2RAD*e),l=[0,0],c={},u=["a","b","c"];t.isBufferGeometry?(o=new hr).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];a.push(y.x,y.y,y.z),a.push((y=h[g.index2]).x,y.y,y.z)}}this.addAttribute("position",new br(a,3))}function vo(t,e,r,n,i,o,a,s){hr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new go(t,e,r,n,i,o,a,s)),this.mergeVertices()}function go(t,e,r,n,i,o,a,s){Mr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var c=[],u=[],h=[],d=[],p=0,f=[],m=r/2,v=0;function g(r){var i,o,f,g=new Fe,y=new Be,x=0,b=!0===r?t:e,w=!0===r?1:-1;for(o=p,i=1;i<=n;i++)u.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=n;i++){var _=i/n*s+a,S=Math.cos(_),T=Math.sin(_);y.x=b*T,y.y=m*w,y.z=b*S,u.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<n;i++){var M=o+i,A=f+i;!0===r?c.push(A,A+1,M):c.push(A+1,A,M),x+=3}l.addGroup(v,x,!0===r?1:2),v+=x}!function(){var o,g,y=new Be,x=new Be,b=0,w=(e-t)/r;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(e-t)+t;for(o=0;o<=n;o++){var M=o/n,A=M*s+a,E=Math.sin(A),C=Math.cos(A);x.x=T*E,x.y=-S*r+m,x.z=T*C,u.push(x.x,x.y,x.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<n;o++)for(g=0;g<i;g++){var P=f[g+1][o],O=f[g+1][o+1],N=f[g][o+1];c.push(f[g][o],P,N),c.push(P,O,N),b+=6}l.addGroup(v,b,0),v+=b}(),!1===o&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(c),this.addAttribute("position",new br(u,3)),this.addAttribute("normal",new br(h,3)),this.addAttribute("uv",new br(d,2))}function yo(t,e,r,n,i,o,a){vo.call(this,0,t,e,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function xo(t,e,r,n,i,o,a){go.call(this,0,t,e,r,n,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function bo(t,e,r,n){hr.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new wo(t,e,r,n)),this.mergeVertices()}function wo(t,e,r,n){Mr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,a=[],s=[],l=[],c=[],u=new Be,h=new Fe;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var d=r+o/e*n;u.x=t*Math.cos(d),u.y=t*Math.sin(d),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[i]/t+1)/2,h.y=(s[i+1]/t+1)/2,c.push(h.x,h.y)}for(i=1;i<=e;i++)a.push(i,i+1,0);this.setIndex(a),this.addAttribute("position",new br(s,3)),this.addAttribute("normal",new br(l,3)),this.addAttribute("uv",new br(c,2))}(eo.prototype=Object.create(hr.prototype)).constructor=eo,(ro.prototype=Object.create(Mr.prototype)).constructor=ro,ro.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],r=this.getAttribute("uv"),n=r?Array.prototype.slice.call(r.array):[],i=this.index;return{position:e,uv:n,index:i?Array.prototype.slice.call(i.array):[]}},ro.prototype.addShapeList=function(t,e){var r=t.length;e.arrays=this.getArrays();for(var n=0;n<r;n++)this.addShape(t[n],e);this.setIndex(e.arrays.index),this.addAttribute("position",new br(e.arrays.position,3)),this.addAttribute("uv",new br(e.arrays.uv,2))},ro.prototype.addShape=function(t,e){var r,n,i,o,a,s,l,c,u=e.arrays?e.arrays:this.getArrays(),h=u.position,d=u.index,p=u.uv,f=[],m=void 0!==e.amount?e.amount:100,v=void 0!==e.bevelThickness?e.bevelThickness:6,g=void 0!==e.bevelSize?e.bevelSize:v-2,y=void 0!==e.bevelSegments?e.bevelSegments:3,x=void 0===e.bevelEnabled||e.bevelEnabled,b=void 0!==e.curveSegments?e.curveSegments:12,w=void 0!==e.steps?e.steps:1,_=e.extrudePath,S=!1,T=void 0!==e.UVGenerator?e.UVGenerator:eo.WorldUVGenerator;_&&(r=_.getSpacedPoints(w),S=!0,x=!1,n=void 0!==e.frames?e.frames:_.computeFrenetFrames(w,!1),i=new Be,o=new Be,a=new Be),x||(y=0,v=0,g=0);var M=this,A=t.extractPoints(b),E=A.shape,C=A.holes;if(!Ki.isClockWise(E))for(E=E.reverse(),l=0,c=C.length;l<c;l++)Ki.isClockWise(s=C[l])&&(C[l]=s.reverse());var P=Ki.triangulateShape(E,C),O=E;for(l=0,c=C.length;l<c;l++)E=E.concat(s=C[l]);function N(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var L,I,R,D,F,U,k=E.length,B=P.length;function j(t,e,r){var n,i,o,a=t.x-e.x,s=t.y-e.y,l=r.x-t.x,c=r.y-t.y,u=a*a+s*s;if(Math.abs(a*c-s*l)>Number.EPSILON){var h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-s/h,f=e.y+a/h,m=((r.x-c/d-p)*c-(r.y+l/d-f)*l)/(a*c-s*l),v=(n=p+a*m-t.x)*n+(i=f+s*m-t.y)*i;if(v<=2)return new Fe(n,i);o=Math.sqrt(v/2)}else{var g=!1;a>Number.EPSILON?l>Number.EPSILON&&(g=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(c)&&(g=!0),g?(n=-s,i=a,o=Math.sqrt(u)):(n=a,i=s,o=Math.sqrt(u/2))}return new Fe(n/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=j(O[V],O[H],O[W]);var X,Y,q=[],J=z.concat();for(l=0,c=C.length;l<c;l++){for(X=[],H=(G=(s=C[l]).length)-1,W=1+(V=0);V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=j(s[V],s[H],s[W]);q.push(X),J=J.concat(X)}for(L=0;L<y;L++){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,-D);for(l=0,c=C.length;l<c;l++)for(X=q[l],V=0,G=(s=C[l]).length;V<G;V++)Q((F=N(s[V],X[V],I)).x,F.y,-D)}for(I=g,V=0;V<k;V++)F=x?N(E[V],J[V],I):E[V],S?(o.copy(n.normals[0]).multiplyScalar(F.x),i.copy(n.binormals[0]).multiplyScalar(F.y),a.copy(r[0]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,0);for(Y=1;Y<=w;Y++)for(V=0;V<k;V++)F=x?N(E[V],J[V],I):E[V],S?(o.copy(n.normals[Y]).multiplyScalar(F.x),i.copy(n.binormals[Y]).multiplyScalar(F.y),a.copy(r[Y]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,m/w*Y);for(L=y-1;L>=0;L--){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,m+D);for(l=0,c=C.length;l<c;l++)for(X=q[l],V=0,G=(s=C[l]).length;V<G;V++)F=N(s[V],X[V],I),S?Q(F.x,F.y+r[w-1].y,r[w-1].x+D):Q(F.x,F.y,m+D)}function Z(t,e){var r,n;for(V=t.length;--V>=0;){r=V,(n=V-1)<0&&(n=t.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var a=k*i,s=k*(i+1);$(e+r+a,e+n+a,e+n+s,e+r+s)}}}function Q(t,e,r){f.push(t),f.push(e),f.push(r)}function K(t,e,r){tt(t),tt(e),tt(r);var n=h.length/3,i=T.generateTopUV(M,h,n-3,n-2,n-1);et(i[0]),et(i[1]),et(i[2])}function $(t,e,r,n){tt(t),tt(e),tt(n),tt(e),tt(r),tt(n);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);et(o[0]),et(o[1]),et(o[3]),et(o[1]),et(o[2]),et(o[3])}function tt(t){d.push(h.length/3),h.push(f[3*t+0]),h.push(f[3*t+1]),h.push(f[3*t+2])}function et(t){p.push(t.x),p.push(t.y)}!function(){var t=h.length/3;if(x){var e=0,r=k*e;for(V=0;V<B;V++)K((U=P[V])[2]+r,U[1]+r,U[0]+r);for(r=k*(e=w+2*y),V=0;V<B;V++)K((U=P[V])[0]+r,U[1]+r,U[2]+r)}else{for(V=0;V<B;V++)K((U=P[V])[2],U[1],U[0]);for(V=0;V<B;V++)K((U=P[V])[0]+k*w,U[1]+k*w,U[2]+k*w)}M.addGroup(t,h.length/3-t,0)}(),function(){var t=h.length/3,e=0;for(Z(O,e),e+=O.length,l=0,c=C.length;l<c;l++)Z(s=C[l],e),e+=s.length;M.addGroup(t,h.length/3-t,1)}(),e.arrays||(this.setIndex(d),this.addAttribute("position",new br(h,3)),this.addAttribute("uv",new br(p,2)))},eo.WorldUVGenerator={generateTopUV:function(t,e,r,n,i){var o=e[3*n],a=e[3*n+1],s=e[3*i],l=e[3*i+1];return[new Fe(e[3*r],e[3*r+1]),new Fe(o,a),new Fe(s,l)]},generateSideWallUV:function(t,e,r,n,i,o){var a=e[3*r],s=e[3*r+1],l=e[3*r+2],c=e[3*n],u=e[3*n+1],h=e[3*n+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],v=e[3*o+1],g=e[3*o+2];return Math.abs(s-u)<.01?[new Fe(a,1-l),new Fe(c,1-h),new Fe(d,1-f),new Fe(m,1-g)]:[new Fe(s,1-l),new Fe(u,1-h),new Fe(p,1-f),new Fe(v,1-g)]}},(no.prototype=Object.create(hr.prototype)).constructor=no,(io.prototype=Object.create(ro.prototype)).constructor=io,(oo.prototype=Object.create(hr.prototype)).constructor=oo,(ao.prototype=Object.create(Mr.prototype)).constructor=ao,(so.prototype=Object.create(hr.prototype)).constructor=so,(lo.prototype=Object.create(Mr.prototype)).constructor=lo,(co.prototype=Object.create(hr.prototype)).constructor=co,(uo.prototype=Object.create(Mr.prototype)).constructor=uo,(ho.prototype=Object.create(hr.prototype)).constructor=ho,ho.prototype.toJSON=function(){var t=hr.prototype.toJSON.call(this);return fo(this.parameters.shapes,t)},(po.prototype=Object.create(Mr.prototype)).constructor=po,po.prototype.toJSON=function(){var t=Mr.prototype.toJSON.call(this);return fo(this.parameters.shapes,t)},(mo.prototype=Object.create(Mr.prototype)).constructor=mo,(vo.prototype=Object.create(hr.prototype)).constructor=vo,(go.prototype=Object.create(Mr.prototype)).constructor=go,(yo.prototype=Object.create(vo.prototype)).constructor=yo,(xo.prototype=Object.create(go.prototype)).constructor=xo,(bo.prototype=Object.create(hr.prototype)).constructor=bo,(wo.prototype=Object.create(Mr.prototype)).constructor=wo;var _o=Object.freeze({WireframeGeometry:di,ParametricGeometry:pi,ParametricBufferGeometry:fi,TetrahedronGeometry:gi,TetrahedronBufferGeometry:yi,OctahedronGeometry:xi,OctahedronBufferGeometry:bi,IcosahedronGeometry:wi,IcosahedronBufferGeometry:_i,DodecahedronGeometry:Si,DodecahedronBufferGeometry:Ti,PolyhedronGeometry:mi,PolyhedronBufferGeometry:vi,TubeGeometry:Mi,TubeBufferGeometry:Ai,TorusKnotGeometry:Ei,TorusKnotBufferGeometry:Ci,TorusGeometry:Pi,TorusBufferGeometry:Oi,TextGeometry:no,TextBufferGeometry:io,SphereGeometry:oo,SphereBufferGeometry:ao,RingGeometry:so,RingBufferGeometry:lo,PlaneGeometry:Cr,PlaneBufferGeometry:Pr,LatheGeometry:co,LatheBufferGeometry:uo,ShapeGeometry:ho,ShapeBufferGeometry:po,ExtrudeGeometry:eo,ExtrudeBufferGeometry:ro,EdgesGeometry:mo,ConeGeometry:yo,ConeBufferGeometry:xo,CylinderGeometry:vo,CylinderBufferGeometry:go,CircleGeometry:bo,CircleBufferGeometry:wo,BoxGeometry:Ar,BoxBufferGeometry:Er});function So(t){Nr.call(this),this.type="ShadowMaterial",this.color=new tr(0),this.transparent=!0,this.setValues(t)}function To(t){Ir.call(this,t),this.type="RawShaderMaterial"}function Mo(t){Nr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new tr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ao(t){Mo.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function Eo(t){Nr.call(this),this.type="MeshPhongMaterial",this.color=new tr(16777215),this.specular=new tr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Co(t){Eo.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function Po(t){Nr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Oo(t){Nr.call(this),this.type="MeshLambertMaterial",this.color=new tr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function No(t){ri.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}(So.prototype=Object.create(Nr.prototype)).constructor=So,So.prototype.isShadowMaterial=!0,So.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this},(To.prototype=Object.create(Ir.prototype)).constructor=To,To.prototype.isRawShaderMaterial=!0,(Mo.prototype=Object.create(Nr.prototype)).constructor=Mo,Mo.prototype.isMeshStandardMaterial=!0,Mo.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Ao.prototype=Object.create(Mo.prototype)).constructor=Ao,Ao.prototype.isMeshPhysicalMaterial=!0,Ao.prototype.copy=function(t){return Mo.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},(Eo.prototype=Object.create(Nr.prototype)).constructor=Eo,Eo.prototype.isMeshPhongMaterial=!0,Eo.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Co.prototype=Object.create(Eo.prototype)).constructor=Co,Co.prototype.isMeshToonMaterial=!0,Co.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},(Po.prototype=Object.create(Nr.prototype)).constructor=Po,Po.prototype.isMeshNormalMaterial=!0,Po.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Oo.prototype=Object.create(Nr.prototype)).constructor=Oo,Oo.prototype.isMeshLambertMaterial=!0,Oo.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(No.prototype=Object.create(ri.prototype)).constructor=No,No.prototype.isLineDashedMaterial=!0,No.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Lo=Object.freeze({ShadowMaterial:So,SpriteMaterial:Zn,RawShaderMaterial:To,ShaderMaterial:Ir,PointsMaterial:ai,MeshPhysicalMaterial:Ao,MeshStandardMaterial:Mo,MeshPhongMaterial:Eo,MeshToonMaterial:Co,MeshNormalMaterial:Po,MeshLambertMaterial:Oo,MeshDepthMaterial:kn,MeshDistanceMaterial:Bn,MeshBasicMaterial:Lr,LineDashedMaterial:No,LineBasicMaterial:ri,Material:Nr}),Io={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Ro(t,e,r){var n=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){a++,!1===i&&void 0!==n.onStart&&n.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this}}var Do=new Ro,Fo={};function Uo(t){this.manager=void 0!==t?t:Do}function ko(t){this.manager=void 0!==t?t:Do,this._parser=null}function Bo(t){this.manager=void 0!==t?t:Do,this._parser=null}function jo(t){this.manager=void 0!==t?t:Do}function zo(t){this.manager=void 0!==t?t:Do}function Vo(t){this.manager=void 0!==t?t:Do}function Go(){this.type="Curve",this.arcLengthDivisions=200}function Ho(t,e,r,n,i,o,a,s){Go.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Wo(t,e,r,n,i,o){Ho.call(this,t,e,r,r,n,i,o),this.type="ArcCurve"}function Xo(){var t=0,e=0,r=0,n=0;function i(i,o,a,s){t=i,e=a,r=-3*i+3*o-2*a-s,n=2*i-2*o+a+s}return{initCatmullRom:function(t,e,r,n,o){i(e,r,o*(r-t),o*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,o,a,s){var l=(e-t)/o-(r-t)/(o+a)+(r-e)/a,c=(r-e)/a-(n-e)/(a+s)+(n-r)/s;i(e,r,l*=a,c*=a)},calc:function(i){var o=i*i;return t+e*i+r*o+n*(o*i)}}}Object.assign(Uo.prototype,{load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Io.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===Fo[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}window.setTimeout(function(){e&&e(u),i.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},0)}}else{Fo[t]=[],Fo[t].push({onLoad:e,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",t,!0),m.addEventListener("load",function(e){var r=this.response;Io.add(t,r);var n=Fo[t];if(delete Fo[t],200===this.status){for(var o=0,a=n.length;o<a;o++)(s=n[o]).onLoad&&s.onLoad(r);i.manager.itemEnd(t)}else if(0===this.status){for(console.warn("THREE.FileLoader: HTTP Status 0 received."),o=0,a=n.length;o<a;o++)(s=n[o]).onLoad&&s.onLoad(r);i.manager.itemEnd(t)}else{for(o=0,a=n.length;o<a;o++){var s;(s=n[o]).onError&&s.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)}},!1),m.addEventListener("progress",function(e){for(var r=Fo[t],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(e)}},!1),m.addEventListener("error",function(e){var r=Fo[t];delete Fo[t];for(var n=0,o=r.length;n<o;n++){var a=r[n];a.onError&&a.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(t),m}Fo[t].push({onLoad:e,onProgress:r,onError:n})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(ko.prototype,{load:function(t,e,r,n){var i=this,o=[],a=new ui;a.image=o;var s=new Uo(this.manager);function l(l){s.load(t[l],function(t){var r=i._parser(t,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(a.minFilter=wt),a.format=r.format,a.needsUpdate=!0,e&&e(a))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)l(u);else s.load(t,function(t){var r=i._parser(t,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){o[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),o[s].format=r.format,o[s].width=r.width,o[s].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=wt),a.format=r.format,a.needsUpdate=!0,e&&e(a)},r,n);return a},setPath:function(t){return this.path=t,this}}),Object.assign(Bo.prototype,{load:function(t,e,r,n){var i=this,o=new Xe,a=new Uo(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){var r=i._parser(t);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:vt,o.wrapT=void 0!==r.wrapT?r.wrapT:vt,o.magFilter=void 0!==r.magFilter?r.magFilter:wt,o.minFilter=void 0!==r.minFilter?r.minFilter:St,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=wt),o.needsUpdate=!0,e&&e(o,r))},r,n),o}}),Object.assign(jo.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Io.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){Io.add(t,this),e&&e(this),i.manager.itemEnd(t)},!1),a.addEventListener("error",function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(zo.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new Br,o=new jo(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(r){o.load(t[r],function(t){i.images[r]=t,6==++a&&(i.needsUpdate=!0,e&&e(i))},void 0,n)}for(var l=0;l<t.length;++l)s(l);return i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Vo.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new Ve,o=new jo(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(r){i.image=r;var n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);i.format=n?Ut:kt,i.needsUpdate=!0,void 0!==e&&e(i)},r,n),i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Go.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=t;r++)o+=(e=this.getPoint(r/t)).distanceTo(i),n.push(o),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,o=n.length;r=e||t*n[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=n[i=Math.floor(s+(l-s)/2)]-r)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(o-1);var c=n[i];return(i+(r-c)/(n[i+1]-c))/(o-1)},getTangent:function(t){var e=t-1e-4,r=t+1e-4;e<0&&(e=0),r>1&&(r=1);var n=this.getPoint(e);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,n,i=new Be,o=[],a=[],s=[],l=new Be,c=new Ue;for(r=0;r<=t;r++)o[r]=this.getTangentAt(r/t),o[r].normalize();a[0]=new Be,s[0]=new Be;var u=Number.MAX_VALUE,h=Math.abs(o[0].x),d=Math.abs(o[0].y),p=Math.abs(o[0].z);for(h<=u&&(u=h,i.set(1,0,0)),d<=u&&(u=d,i.set(0,1,0)),p<=u&&i.set(0,0,1),l.crossVectors(o[0],i).normalize(),a[0].crossVectors(o[0],l),s[0].crossVectors(o[0],a[0]),r=1;r<=t;r++)a[r]=a[r-1].clone(),s[r]=s[r-1].clone(),l.crossVectors(o[r-1],o[r]),l.length()>Number.EPSILON&&(l.normalize(),n=Math.acos(De.clamp(o[r-1].dot(o[r]),-1,1)),a[r].applyMatrix4(c.makeRotationAxis(l,n))),s[r].crossVectors(o[r],a[r]);if(!0===e)for(n=Math.acos(De.clamp(a[0].dot(a[t]),-1,1)),n/=t,o[0].dot(l.crossVectors(a[0],a[t]))>0&&(n=-n),r=1;r<=t;r++)a[r].applyMatrix4(c.makeRotationAxis(o[r],n*r)),s[r].crossVectors(o[r],a[r]);return{tangents:o,normals:a,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),(Ho.prototype=Object.create(Go.prototype)).constructor=Ho,Ho.prototype.isEllipseCurve=!0,Ho.prototype.getPoint=function(t,e){for(var r=e||new Fe,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(s,l)},Ho.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Ho.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Ho.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},(Wo.prototype=Object.create(Ho.prototype)).constructor=Wo,Wo.prototype.isArcCurve=!0;var Yo=new Be,qo=new Xo,Jo=new Xo,Zo=new Xo;function Qo(t,e,r,n){Go.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function Ko(t,e,r,n,i){var o=.5*(n-e),a=.5*(i-r),s=t*t;return(2*r-2*n+o+a)*(t*s)+(-3*r+3*n-2*o-a)*s+o*t+r}function $o(t,e,r,n){return function(t,r){var n=1-t;return n*n*e}(t)+function(t,e){return 2*(1-t)*t*r}(t)+function(t,e){return t*t*n}(t)}function ta(t,e,r,n,i){return function(t,r){var n=1-t;return n*n*n*e}(t)+function(t,e){var n=1-t;return 3*n*n*t*r}(t)+function(t,e){return 3*(1-t)*t*t*n}(t)+function(t,e){return t*t*t*i}(t)}function ea(t,e,r,n){Go.call(this),this.type="CubicBezierCurve",this.v0=t||new Fe,this.v1=e||new Fe,this.v2=r||new Fe,this.v3=n||new Fe}function ra(t,e,r,n){Go.call(this),this.type="CubicBezierCurve3",this.v0=t||new Be,this.v1=e||new Be,this.v2=r||new Be,this.v3=n||new Be}function na(t,e){Go.call(this),this.type="LineCurve",this.v1=t||new Fe,this.v2=e||new Fe}function ia(t,e){Go.call(this),this.type="LineCurve3",this.v1=t||new Be,this.v2=e||new Be}function oa(t,e,r){Go.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Fe,this.v1=e||new Fe,this.v2=r||new Fe}function aa(t,e,r){Go.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Be,this.v1=e||new Be,this.v2=r||new Be}function sa(t){Go.call(this),this.type="SplineCurve",this.points=t||[]}(Qo.prototype=Object.create(Go.prototype)).constructor=Qo,Qo.prototype.isCatmullRomCurve3=!0,Qo.prototype.getPoint=function(t,e){var r,n,i,o,a=e||new Be,s=this.points,l=s.length,c=(l-(this.closed?0:1))*t,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/s.length)+1)*s.length:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=s[(u-1)%l]:(Yo.subVectors(s[0],s[1]).add(s[0]),r=Yo),n=s[u%l],i=s[(u+1)%l],this.closed||u+2<l?o=s[(u+2)%l]:(Yo.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=Yo),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),qo.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,p,f,m),Jo.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,p,f,m),Zo.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(qo.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),Jo.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),Zo.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return a.set(qo.calc(h),Jo.calc(h),Zo.calc(h)),a},Qo.prototype.copy=function(t){Go.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Qo.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Qo.prototype.fromJSON=function(t){Go.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Be).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},(ea.prototype=Object.create(Go.prototype)).constructor=ea,ea.prototype.isCubicBezierCurve=!0,ea.prototype.getPoint=function(t,e){var r=e||new Fe,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(ta(t,n.x,i.x,o.x,a.x),ta(t,n.y,i.y,o.y,a.y)),r},ea.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ea.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ea.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(ra.prototype=Object.create(Go.prototype)).constructor=ra,ra.prototype.isCubicBezierCurve3=!0,ra.prototype.getPoint=function(t,e){var r=e||new Be,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(ta(t,n.x,i.x,o.x,a.x),ta(t,n.y,i.y,o.y,a.y),ta(t,n.z,i.z,o.z,a.z)),r},ra.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ra.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ra.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(na.prototype=Object.create(Go.prototype)).constructor=na,na.prototype.isLineCurve=!0,na.prototype.getPoint=function(t,e){var r=e||new Fe;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},na.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},na.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},na.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},na.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},na.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(ia.prototype=Object.create(Go.prototype)).constructor=ia,ia.prototype.isLineCurve3=!0,ia.prototype.getPoint=function(t,e){var r=e||new Be;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},ia.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},ia.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ia.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ia.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(oa.prototype=Object.create(Go.prototype)).constructor=oa,oa.prototype.isQuadraticBezierCurve=!0,oa.prototype.getPoint=function(t,e){var r=e||new Fe,n=this.v0,i=this.v1,o=this.v2;return r.set($o(t,n.x,i.x,o.x),$o(t,n.y,i.y,o.y)),r},oa.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},oa.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},oa.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(aa.prototype=Object.create(Go.prototype)).constructor=aa,aa.prototype.isQuadraticBezierCurve3=!0,aa.prototype.getPoint=function(t,e){var r=e||new Be,n=this.v0,i=this.v1,o=this.v2;return r.set($o(t,n.x,i.x,o.x),$o(t,n.y,i.y,o.y),$o(t,n.z,i.z,o.z)),r},aa.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},aa.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},aa.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(sa.prototype=Object.create(Go.prototype)).constructor=sa,sa.prototype.isSplineCurve=!0,sa.prototype.getPoint=function(t,e){var r=e||new Fe,n=this.points,i=(n.length-1)*t,o=Math.floor(i),a=i-o,s=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set(Ko(a,s.x,l.x,c.x,u.x),Ko(a,s.y,l.y,c.y,u.y)),r},sa.prototype.copy=function(t){Go.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this},sa.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t},sa.prototype.fromJSON=function(t){Go.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Fe).fromArray(n))}return this};var la=Object.freeze({ArcCurve:Wo,CatmullRomCurve3:Qo,CubicBezierCurve:ea,CubicBezierCurve3:ra,EllipseCurve:Ho,LineCurve:na,LineCurve3:ia,QuadraticBezierCurve:oa,QuadraticBezierCurve3:aa,SplineCurve:sa});function ca(){Go.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function ua(t){ca.call(this),this.type="Path",this.currentPoint=new Fe,t&&this.setFromPoints(t)}function ha(t){ua.call(this,t),this.uuid=De.generateUUID(),this.type="Shape",this.holes=[]}function da(t,e){ar.call(this),this.type="Light",this.color=new tr(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function pa(t,e,r){da.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ar.DefaultUp),this.updateMatrix(),this.groundColor=new tr(e)}function fa(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Fe(512,512),this.map=null,this.matrix=new Ue}function ma(){fa.call(this,new Gn(50,1,.5,500))}function va(t,e,r,n,i,o){da.call(this,t,e),this.type="SpotLight",this.position.copy(ar.DefaultUp),this.updateMatrix(),this.target=new ar,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new ma}function ga(t,e,r,n){da.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new fa(new Gn(90,1,.5,500))}function ya(){fa.call(this,new lr(-5,5,5,-5,.5,500))}function xa(t,e){da.call(this,t,e),this.type="DirectionalLight",this.position.copy(ar.DefaultUp),this.updateMatrix(),this.target=new ar,this.shadow=new ya}function ba(t,e){da.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function wa(t,e,r,n){da.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function _a(t,e,r,n){Ia.call(this,t,e,r,n)}function Sa(t,e,r){Ia.call(this,t,e,r)}function Ta(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function Ma(t,e,r,n){Ta.call(this,t,e,r,n)}function Aa(t,e,r,n){Ia.call(this,t,e,r,n)}function Ea(t,e,r,n){Ia.call(this,t,e,r,n)}function Ca(t,e,r,n){Ia.call(this,t,e,r,n)}function Pa(t,e,r,n){Ta.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Oa(t,e,r,n){Ta.call(this,t,e,r,n)}function Na(t,e,r,n){Ta.call(this,t,e,r,n)}ca.prototype=Object.assign(Object.create(Go.prototype),{constructor:ca,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new na(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,o=this.curves[n],a=o.getLength();return o.getPointAt(0===a?0:1-i/a)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],a=o.getPoints(o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t),s=0;s<a.length;s++){var l=a[s];e&&e.equals(l)||(r.push(l),e=l)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Go.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=Go.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){Go.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new la[n.type]).fromJSON(n))}return this}}),ua.prototype=Object.assign(Object.create(ca.prototype),{constructor:ua,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var r=new na(this.currentPoint.clone(),new Fe(t,e));this.curves.push(r),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,r,n){var i=new oa(this.currentPoint.clone(),new Fe(t,e),new Fe(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(t,e,r,n,i,o){var a=new ea(this.currentPoint.clone(),new Fe(t,e),new Fe(r,n),new Fe(i,o));this.curves.push(a),this.currentPoint.set(i,o)},splineThru:function(t){var e=new sa([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,r,n,i,o){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o)},absarc:function(t,e,r,n,i,o){this.absellipse(t,e,r,r,n,i,o)},ellipse:function(t,e,r,n,i,o,a,s){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o,a,s)},absellipse:function(t,e,r,n,i,o,a,s){var l=new Ho(t,e,r,n,i,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(t){return ca.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=ca.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return ca.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),ha.prototype=Object.assign(Object.create(ua.prototype),{constructor:ha,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){ua.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=ua.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){ua.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new ua).fromJSON(n))}return this}}),da.prototype=Object.assign(Object.create(ar.prototype),{constructor:da,isLight:!0,copy:function(t){return ar.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ar.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),pa.prototype=Object.assign(Object.create(da.prototype),{constructor:pa,isHemisphereLight:!0,copy:function(t){return da.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(fa.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),ma.prototype=Object.assign(Object.create(fa.prototype),{constructor:ma,isSpotLightShadow:!0,update:function(t){var e=this.camera,r=2*De.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix())}}),va.prototype=Object.assign(Object.create(da.prototype),{constructor:va,isSpotLight:!0,copy:function(t){return da.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),ga.prototype=Object.assign(Object.create(da.prototype),{constructor:ga,isPointLight:!0,copy:function(t){return da.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),ya.prototype=Object.assign(Object.create(fa.prototype),{constructor:ya}),xa.prototype=Object.assign(Object.create(da.prototype),{constructor:xa,isDirectionalLight:!0,copy:function(t){return da.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),ba.prototype=Object.assign(Object.create(da.prototype),{constructor:ba,isAmbientLight:!0}),wa.prototype=Object.assign(Object.create(da.prototype),{constructor:wa,isRectAreaLight:!0,copy:function(t){return da.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=da.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),_a.prototype=Object.assign(Object.create(Ia.prototype),{constructor:_a,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ve,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Sa.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Sa,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ve,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(Ta.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var o;r:{n:if(!(t<n)){for(var a=r+2;;){if(void 0===n){if(t<i)break n;return this._cachedIndex=r=e.length,this.afterEnd_(r-1,t,i)}if(r===a)break;if(i=n,t<(n=e[++r]))break e}o=e.length;break r}if(t>=i)break t;var s=e[1];for(t<s&&(r=2,i=s),a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===a)break;if(n=i,t>=(i=e[--r-1]))break e}o=r,r=0}for(;r<o;){var l=r+o>>>1;t<e[l]?o=l:r=l+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return this._cachedIndex=r=e.length,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,o=0;o!==n;++o)e[o]=r[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ta.prototype,{beforeStart_:Ta.prototype.copySampleValue_,afterEnd_:Ta.prototype.copySampleValue_}),Ma.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Ma,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=(r-e)/(n-e),c=s+a;s!==c;s+=4)ke.slerpFlat(i,0,o,s-a,o,s,l);return i}}),Aa.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Aa,ValueTypeName:"quaternion",DefaultInterpolation:ge,InterpolantFactoryMethodLinear:function(t){return new Ma(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Ea.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Ea,ValueTypeName:"color"}),Ca.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Ca,ValueTypeName:"number"}),Pa.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Pa,DefaultSettings_:{endingStart:xe,endingEnd:xe},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,o=t+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case be:i=t,a=2*e-r;break;case we:a=e+n[i=n.length-2]-n[i+1];break;default:i=t,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case be:o=t,s=2*r-e;break;case we:o=1,s=r+n[1]-n[0];break;default:o=t-1,s=e}var l=.5*(r-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(s-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-e)/(n-e),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==a;++b)i[b]=v*o[c+b]+g*o[l+b]+y*o[s+b]+x*o[u+b];return i}}),Oa.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Oa,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=(r-e)/(n-e),u=1-c,h=0;h!==a;++h)i[h]=o[l+h]*u+o[s+h]*c;return i}}),Na.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Na,interpolate_:function(t){return this.copySampleValue_(t-1)}});var La={arraySlice:function(t,e,r){return La.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort(function(e,r){return t[e]-t[r]}),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*e,l=0;l!==e;++l)i[a++]=t[s+l];return i},flattenJSON:function(t,e,r,n){for(var i=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(e.push(o.time),r.push.apply(r,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(e.push(o.time),a.toArray(r,r.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(e.push(o.time),r.push(a)),o=t[i++]}while(void 0!==o)}}};function Ia(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=La.convertArray(e,this.TimeBufferType),this.values=La.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function Ra(t,e,r,n){Ia.call(this,t,e,r,n)}function Da(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=De.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Fa(t){this.manager=void 0!==t?t:Do,this.textures={}}function Ua(t){this.manager=void 0!==t?t:Do}Object.assign(Ia,{parse:function(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=Ia._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var r=[],n=[];La.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:La.convertArray(t.times,Array),values:La.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ca;case"vector":case"vector2":case"vector3":case"vector4":return Ra;case"color":return Ea;case"quaternion":return Aa;case"bool":case"boolean":return Sa;case"string":return _a}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}}),Object.assign(Ia.prototype,{constructor:Ia,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ge,InterpolantFactoryMethodDiscrete:function(t){return new Na(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Oa(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Pa(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case ve:e=this.InterpolantFactoryMethodDiscrete;break;case ge:e=this.InterpolantFactoryMethodLinear;break;case ye:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",r)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ve;case this.InterpolantFactoryMethodLinear:return ge;case this.InterpolantFactoryMethodSmooth:return ye}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<t;)++i;for(;-1!==o&&r[o]>e;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=La.arraySlice(r,i,o),this.values=La.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==i;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==n&&La.isTypedArray(n)){a=0;for(var l=n.length;a!==l;++a){var c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),n=this.getInterpolation()===ye,i=1,o=t.length-1,a=1;a<o;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==l[0]))if(n)s=!0;else for(var c=a*r,u=c-r,h=c+r,d=0;d!==r;++d){var p=e[c+d];if(p!==e[u+d]||p!==e[h+d]){s=!0;break}}if(s){if(a!==i){t[i]=t[a];var f=a*r,m=i*r;for(d=0;d!==r;++d)e[m+d]=e[f+d]}++i}}if(o>0){for(t[i]=t[o],f=o*r,m=i*r,d=0;d!==r;++d)e[m+d]=e[f+d];++i}return i!==t.length&&(this.times=La.arraySlice(t,0,i),this.values=La.arraySlice(e,0,i*r)),this}}),Ra.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Ra,ValueTypeName:"vector"}),Object.assign(Da,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,o=r.length;i!==o;++i)e.push(Ia.parse(r[i]).scale(n));return new Da(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e},i=0,o=r.length;i!==o;++i)e.push(Ia.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var c=La.getKeyframeOrder(s);s=La.sortedArray(s,1,c),l=La.sortedArray(l,1,c),n||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new Ca(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/r))}return new Da(t,-1,o)},findByName:function(t,e){var r=t;Array.isArray(t)||(r=t.geometry&&t.geometry.animations||t.animations);for(var n=0;n<r.length;n++)if(r[n].name===e)return r[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(i);if(l&&l.length>1){var c=n[h=l[1]];c||(n[h]=c=[]),c.push(s)}}var u=[];for(var h in n)u.push(Da.CreateFromMorphTargetSequence(h,n[h],e,r));return u},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var o=[],a=[];La.flattenJSON(r,o,a,n),0!==o.length&&i.push(new t(e,o,a))}},n=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var v=c[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new Ca(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(a||1)}else{var g=".bones["+e[l].name+"]";r(Ra,g+".position",c,"pos",n),r(Aa,g+".quaternion",c,"rot",n),r(Ra,g+".scale",c,"scl",n)}}return 0===n.length?null:new Da(i,o,n)}}),Object.assign(Da.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),Object.assign(Fa.prototype,{load:function(t,e,r,n){var i=this;new Uo(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var n=new Lo[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new Fe).fromArray(i)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),n}}),Object.assign(Ua.prototype,{load:function(t,e,r,n){var i=this;new Uo(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){var e=new Mr,r=t.data.index;if(void 0!==r){var n=new ka[r.type](r.array);e.setIndex(new dr(n,1))}var i=t.data.attributes;for(var o in i){var a=i[o];n=new ka[a.type](a.array),e.addAttribute(o,new dr(n,a.itemSize,a.normalized))}var s=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==s)for(var l=0,c=s.length;l!==c;++l){var u=s[l];e.addGroup(u.start,u.count,u.materialIndex)}var h=t.data.boundingSphere;if(void 0!==h){var d=new Be;void 0!==h.center&&d.fromArray(h.center),e.boundingSphere=new qe(d,h.radius)}return e}});var ka={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ba(){}Ba.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,r=0,n=e.length;r<n;r+=2){var i=e[r+1];if(e[r].test(t))return i}return null}},Object.assign(Ba.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,r){for(var n=[],i=0;i<t.length;++i)n[i]=this.createMaterial(t[i],e,r);return n},createMaterial:function(){var t={NoBlending:S,NormalBlending:T,AdditiveBlending:M,SubtractiveBlending:A,MultiplyBlending:E,CustomBlending:C},e=new tr,r=new Vo,n=new Fa;return function(i,o,a){var s={};function l(t,e,n,i,l){var c,u=o+t,h=Ba.Handlers.get(u);null!==h?c=h.load(u):(r.setCrossOrigin(a),c=r.load(u)),void 0!==e&&(c.repeat.fromArray(e),1!==e[0]&&(c.wrapS=mt),1!==e[1]&&(c.wrapT=mt)),void 0!==n&&c.offset.fromArray(n),void 0!==i&&("repeat"===i[0]&&(c.wrapS=mt),"mirror"===i[0]&&(c.wrapS=gt),"repeat"===i[1]&&(c.wrapT=mt),"mirror"===i[1]&&(c.wrapT=gt)),void 0!==l&&(c.anisotropy=l);var d=De.generateUUID();return s[d]=c,d}var c={uuid:De.generateUUID(),type:"MeshLambertMaterial"};for(var u in i){var h=i[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=t[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=e.fromArray(h).getHex();break;case"colorSpecular":c.specular=e.fromArray(h).getHex();break;case"colorEmissive":c.emissive=e.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(h,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(h,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(h,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(h,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(h,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(h,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(h,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(h,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(h,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(h,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=v;break;case"doubleSided":c.side=g;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=_),"face"===h&&(c.vertexColors=w);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(s),n.parse(c)}}()});var ja={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")}};function za(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Do,this.withCredentials=!1}function Va(t){this.manager=void 0!==t?t:Do,this.texturePath=""}Object.assign(za.prototype,{load:function(t,e,r,n){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:ja.extractUrlBase(t),a=new Uo(this.manager);a.setWithCredentials(this.withCredentials),a.load(t,function(r){var n=JSON.parse(r),a=n.metadata;if(void 0!==a){var s=a.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(n,o);e(l.geometry,l.materials)},r,n)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){void 0!==t.data&&(t=t.data),t.scale=void 0!==t.scale?1/t.scale:1;var r=new hr;return function(t,e){function r(t,e){return t&1<<e}var n,i,o,a,s,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C=t.faces,P=t.vertices,O=t.normals,N=t.colors,L=t.scale,I=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&I++;for(n=0;n<I;n++)e.faceVertexUvs[n]=[]}for(a=0,s=P.length;a<s;)(b=new Be).x=P[a++]*L,b.y=P[a++]*L,b.z=P[a++]*L,e.vertices.push(b);for(a=0,s=C.length;a<s;)if(p=r(d=C[a++],0),f=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),x=r(d,7),p){if((_=new cr).a=C[a],_.b=C[a+1],_.c=C[a+3],(S=new cr).a=C[a+1],S.b=C[a+2],S.c=C[a+3],a+=4,f&&(h=C[a++],_.materialIndex=h,S.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],e.faceVertexUvs[n][o+1]=[],i=0;i<4;i++)E=new Fe(A[2*(u=C[a++])],A[2*u+1]),2!==i&&e.faceVertexUvs[n][o].push(E),0!==i&&e.faceVertexUvs[n][o+1].push(E);if(v&&(c=3*C[a++],_.normal.set(O[c++],O[c++],O[c]),S.normal.copy(_.normal)),g)for(n=0;n<4;n++)c=3*C[a++],M=new Be(O[c++],O[c++],O[c]),2!==n&&_.vertexNormals.push(M),0!==n&&S.vertexNormals.push(M);if(y&&(l=C[a++],_.color.setHex(T=N[l]),S.color.setHex(T)),x)for(n=0;n<4;n++)T=N[l=C[a++]],2!==n&&_.vertexColors.push(new tr(T)),0!==n&&S.vertexColors.push(new tr(T));e.faces.push(_),e.faces.push(S)}else{if((w=new cr).a=C[a++],w.b=C[a++],w.c=C[a++],f&&(h=C[a++],w.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],i=0;i<3;i++)E=new Fe(A[2*(u=C[a++])],A[2*u+1]),e.faceVertexUvs[n][o].push(E);if(v&&(c=3*C[a++],w.normal.set(O[c++],O[c++],O[c])),g)for(n=0;n<3;n++)c=3*C[a++],M=new Be(O[c++],O[c++],O[c]),w.vertexNormals.push(M);if(y&&(l=C[a++],w.color.setHex(N[l])),x)for(n=0;n<3;n++)l=C[a++],w.vertexColors.push(new tr(N[l]));e.faces.push(w)}}(t,r),function(t,e){var r=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,i=t.skinWeights.length;n<i;n+=r)e.skinWeights.push(new Ge(t.skinWeights[n],r>1?t.skinWeights[n+1]:0,r>2?t.skinWeights[n+2]:0,r>3?t.skinWeights[n+3]:0));if(t.skinIndices)for(n=0,i=t.skinIndices.length;n<i;n+=r)e.skinIndices.push(new Ge(t.skinIndices[n],r>1?t.skinIndices[n+1]:0,r>2?t.skinIndices[n+2]:0,r>3?t.skinIndices[n+3]:0));e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,r),function(t,e){var r=t.scale;if(void 0!==t.morphTargets)for(var n=0,i=t.morphTargets.length;n<i;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var o=e.morphTargets[n].vertices,a=t.morphTargets[n].vertices,s=0,l=a.length;s<l;s+=3){var c=new Be;c.x=a[s]*r,c.y=a[s+1]*r,c.z=a[s+2]*r,o.push(c)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=e.faces,h=t.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(t,r),function(t,e){var r=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var i=0;i<n.length;i++){var o=Da.parseAnimation(n[i],e.bones);o&&r.push(o)}if(e.morphTargets){var a=Da.CreateClipsFromMorphTargetSequences(e.morphTargets,10);r=r.concat(a)}r.length>0&&(e.animations=r)}(t,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:r}:{geometry:r,materials:Ba.prototype.initMaterials(t.materials,e,this.crossOrigin)}}}),Object.assign(Va.prototype,{load:function(t,e,r,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var i=this;new Uo(i.manager).load(t,function(r){var o=null;try{o=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead.")},r,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,function(){void 0!==e&&e(s)}),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,n,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new ha).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new za,i=new Ua,o=0,a=t.length;o<a;o++){var s,l=t[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new _o[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new _o[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new _o[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new _o[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new _o[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new _o[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new _o[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new _o[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new _o[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new _o[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new _o[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new _o[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var c=[];for(o=0,a=l.shapes.length;o<a;o++)c.push(e[l.shapes[o]]);s=new _o[l.type](c,l.curveSegments);break;case"BufferGeometry":s=i.parse(l);break;case"Geometry":s=n.parse(l,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}s.uuid=l.uuid,void 0!==l.name&&(s.name=l.name),r[l.uuid]=s}return r},parseMaterials:function(t,e){var r={};if(void 0!==t){var n=new Fa;n.setTextures(e);for(var i=0,o=t.length;i<o;i++){var a=t[i];if("MultiMaterial"===a.type){for(var s=[],l=0;l<a.materials.length;l++)s.push(n.parse(a.materials[l]));r[a.uuid]=s}else r[a.uuid]=n.parse(a)}}return r},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=Da.parse(t[r]);e.push(n)}return e},parseImages:function(t,e){var r=this,n={};function i(t){return r.manager.itemStart(t),o.load(t,function(){r.manager.itemEnd(t)},void 0,function(){r.manager.itemEnd(t),r.manager.itemError(t)})}if(void 0!==t&&t.length>0){var o=new jo(new Ro(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var l=t[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=i(c)}}return n},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new Ve(e[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=r(a.mapping,Ha)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=r(a.wrap[0],Wa),s.wrapT=r(a.wrap[1],Wa)),void 0!==a.format&&(s.format=a.format),void 0!==a.minFilter&&(s.minFilter=r(a.minFilter,Xa)),void 0!==a.magFilter&&(s.magFilter=r(a.magFilter,Xa)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),n[a.uuid]=s}return n},parseObject:function(t,e,r){var n;function i(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var o=t[n];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(r[o])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":n=new Jn,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new tr(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new qn(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new Yn(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new Gn(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new lr(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new ba(t.color,t.intensity);break;case"DirectionalLight":n=new xa(t.color,t.intensity);break;case"PointLight":n=new ga(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new wa(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new va(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new pa(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(t.geometry),s=o(t.material);n=a.bones&&a.bones.length>0?new ei(a,s):new Ur(a,s);break;case"LOD":n=new Kn;break;case"Line":n=new ni(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":n=new oi(i(t.geometry),o(t.material));break;case"LineSegments":n=new ii(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new si(i(t.geometry),o(t.material));break;case"Sprite":n=new Qn(o(t.material));break;case"Group":n=new li;break;default:n=new ar}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var l=t.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],e,r));if("LOD"===t.type)for(var u=t.levels,h=0;h<u.length;h++){var d=u[h],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}return n}});var Ga,Ha={UVMapping:st,CubeReflectionMapping:lt,CubeRefractionMapping:ct,EquirectangularReflectionMapping:ut,EquirectangularRefractionMapping:ht,SphericalReflectionMapping:dt,CubeUVReflectionMapping:pt,CubeUVRefractionMapping:ft},Wa={RepeatWrapping:mt,ClampToEdgeWrapping:vt,MirroredRepeatWrapping:gt},Xa={NearestFilter:yt,NearestMipMapNearestFilter:xt,NearestMipMapLinearFilter:bt,LinearFilter:wt,LinearMipMapNearestFilter:_t,LinearMipMapLinearFilter:St};function Ya(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:Do,this.options=void 0}function qa(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function Ja(t){this.type="Font",this.data=t}function Za(t,e,r,n,i,o){var a=o.glyphs[t]||o.glyphs["?"];if(a){var s,l,c,u,h,d,p,f,m=new qa;if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,y=v.length;g<y;)switch(v[g++]){case"m":s=v[g++]*r+n,l=v[g++]*r+i,m.moveTo(s,l);break;case"l":s=v[g++]*r+n,l=v[g++]*r+i,m.lineTo(s,l);break;case"q":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,m.quadraticCurveTo(h,d,c,u);break;case"b":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,p=v[g++]*r+n,f=v[g++]*r+i,m.bezierCurveTo(h,d,p,f,c,u)}return{offsetX:a.ha*r,path:m}}}function Qa(t){this.manager=void 0!==t?t:Do}Ya.prototype={constructor:Ya,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var i=this,o=Io.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,i.options)}).then(function(r){Io.add(t,r),e&&e(r),i.manager.itemEnd(t)}).catch(function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Object.assign(qa.prototype,{moveTo:function(t,e){this.currentPath=new ua,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,r,n){this.currentPath.quadraticCurveTo(t,e,r,n)},bezierCurveTo:function(t,e,r,n,i,o){this.currentPath.bezierCurveTo(t,e,r,n,i,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],o=new ha;o.curves=i.curves,e.push(o)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=e[i],s=e[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=e[o],l=-l,s=e[i],c=-c),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var u=c*(t.x-a.x)-l*(t.y-a.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return n}var i=Ki.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return r(o);var a,s,l,c=[];if(1===o.length)return s=o[0],(l=new ha).curves=s.curves,c.push(l),c;var u=!i(o[0].getPoints());u=t?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(h=(s=o[g]).getPoints()),(a=t?!a:a)?(!u&&f[v]&&v++,f[v]={s:new ha,p:h},f[v].s.curves=s.curves,u&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var x=!1,b=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)n(M.p,f[E].p)&&(w!==E&&b.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):x=!0);A&&p[w].push(M)}b.length>0&&(x||(m=p))}g=0;for(var C=f.length;g<C;g++){c.push(l=f[g].s);for(var P=0,O=(d=m[g]).length;P<O;P++)l.holes.push(d[P].h)}return c}}),Object.assign(Ja.prototype,{isFont:!0,generateShapes:function(t,e,r){void 0===e&&(e=100),void 0===r&&(r=4);for(var n=[],i=function(t,e,r,n){for(var i=String(t).split(""),o=e/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,s=[],l=0,c=0,u=0;u<i.length;u++){var h=i[u];if("\n"===h)l=0,c-=a;else{var d=Za(h,0,o,l,c,n);l+=d.offsetX,s.push(d.path)}}return s}(t,e,0,this.data),o=0,a=i.length;o<a;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}),Object.assign(Qa.prototype,{load:function(t,e,r,n){var i=this,o=new Uo(this.manager);o.setPath(this.path),o.load(t,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(r);e&&e(n)},r,n)},parse:function(t){return new Ja(t)},setPath:function(t){return this.path=t,this}});var Ka,$a,ts={getContext:function(){return void 0===Ga&&(Ga=new(window.AudioContext||window.webkitAudioContext)),Ga},setContext:function(t){Ga=t}};function es(t){this.manager=void 0!==t?t:Do}function rs(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Gn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Gn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function ns(t,e,r){ar.call(this),this.type="CubeCamera";var n=new Gn(90,1,t,e);n.up.set(0,-1,0),n.lookAt(new Be(1,0,0)),this.add(n);var i=new Gn(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new Be(-1,0,0)),this.add(i);var o=new Gn(90,1,t,e);o.up.set(0,0,1),o.lookAt(new Be(0,1,0)),this.add(o);var a=new Gn(90,1,t,e);a.up.set(0,0,-1),a.lookAt(new Be(0,-1,0)),this.add(a);var s=new Gn(90,1,t,e);s.up.set(0,-1,0),s.lookAt(new Be(0,0,1)),this.add(s);var l=new Gn(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new Be(0,0,-1)),this.add(l),this.renderTarget=new We(r,r,{format:Ut,magFilter:wt,minFilter:wt}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,t.render(e,n,r),r.activeCubeFace=1,t.render(e,i,r),r.activeCubeFace=2,t.render(e,o,r),r.activeCubeFace=3,t.render(e,a,r),r.activeCubeFace=4,t.render(e,s,r),r.texture.generateMipmaps=c,r.activeCubeFace=5,t.render(e,l,r),t.setRenderTarget(null)},this.clear=function(t,e,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,t.setRenderTarget(i),t.clear(e,r,n);t.setRenderTarget(null)}}function is(){ar.call(this),this.type="AudioListener",this.context=ts.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function os(t){ar.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function as(t){os.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function ss(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function ls(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function cs(t,e,r){var n=r||us.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function us(t,e,r){this.path=e,this.parsedPath=r||us.parseTrackName(e),this.node=us.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function hs(){this.uuid=De.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function ds(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var n=e.tracks,i=n.length,o=new Array(i),a={endingStart:xe,endingEnd:xe},s=0;s!==i;++s){var l=n[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=fe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function ps(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function fs(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function ms(){Mr.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function vs(t,e,r,n){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function gs(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function ys(t,e,r){gs.call(this,t,e),this.meshPerAttribute=r||1}function xs(t,e,r){dr.call(this,t,e),this.meshPerAttribute=r||1}function bs(t,e,r,n){this.ray=new Rr(t,e),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ws(t,e){return t.distance-e.distance}function _s(t,e,r,n){if(!1!==t.visible&&(t.raycast(e,r),!0===n))for(var i=t.children,o=0,a=i.length;o<a;o++)_s(i[o],e,r,!0)}function Ss(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Ts(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}function Ms(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}function As(t,e){this.min=void 0!==t?t:new Fe(1/0,1/0),this.max=void 0!==e?e:new Fe(-1/0,-1/0)}function Es(t){ar.call(this),this.material=t,this.render=function(){}}function Cs(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new Mr,c=new br(2*a*3,3);l.addAttribute("position",c),ii.call(this,l,new ri({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Ps(t,e){ar.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new Mr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new br(n,3));var l=new ri({fog:!1});this.cone=new ii(r,l),this.add(this.cone),this.update()}function Os(t){for(var e=function t(e){var r=[];e&&e.isBone&&r.push(e);for(var n=0;n<e.children.length;n++)r.push.apply(r,t(e.children[n]));return r}(t),r=new Mr,n=[],i=[],o=new tr(0,0,1),a=new tr(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.addAttribute("position",new br(n,3)),r.addAttribute("color",new br(i,3));var c=new ri({vertexColors:_,depthTest:!1,depthWrite:!1,transparent:!0});ii.call(this,r,c),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Ns(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new ao(e,4,2),i=new Lr({wireframe:!0,fog:!1});Ur.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Ls(t,e){ar.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var r=new ri({fog:!1}),n=new Mr;n.addAttribute("position",new dr(new Float32Array(15),3)),this.line=new ni(n,r),this.add(this.line),this.update()}function Is(t,e,r){ar.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new bi(e);n.rotateY(.5*Math.PI),this.material=new Lr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=_);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new dr(o,3)),this.add(new Ur(n,this.material)),this.update()}function Rs(t,e,r,n){t=t||10,e=e||10,r=new tr(void 0!==r?r:4473924),n=new tr(void 0!==n?n:8947848);for(var i=e/2,o=t/e,a=t/2,s=[],l=[],c=0,u=0,h=-a;c<=e;c++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var d=c===i?r:n;d.toArray(l,u),d.toArray(l,u+=3),d.toArray(l,u+=3),d.toArray(l,u+=3),u+=3}var p=new Mr;p.addAttribute("position",new br(s,3)),p.addAttribute("color",new br(l,3));var f=new ri({vertexColors:_});ii.call(this,p,f)}function Ds(t,e,r,n,i,o){t=t||10,e=e||16,r=r||8,n=n||64,i=new tr(void 0!==i?i:4473924),o=new tr(void 0!==o?o:8947848);var a,s,l,c,u,h,d,p=[],f=[];for(c=0;c<=e;c++)l=c/e*(2*Math.PI),a=Math.sin(l)*t,s=Math.cos(l)*t,p.push(0,0,0),p.push(a,0,s),f.push((d=1&c?i:o).r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:o,h=t-t/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,p.push(a,0,s),f.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,p.push(a,0,s),f.push(d.r,d.g,d.b);var m=new Mr;m.addAttribute("position",new br(p,3)),m.addAttribute("color",new br(f,3));var v=new ri({vertexColors:_});ii.call(this,m,v)}function Fs(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Mr,c=new br(2*a*3,3);l.addAttribute("position",c),ii.call(this,l,new ri({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Us(t,e,r){ar.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var n=new Mr;n.addAttribute("position",new br([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new ri({fog:!1});this.lightPlane=new ni(n,i),this.add(this.lightPlane),(n=new Mr).addAttribute("position",new br([0,0,0,0,0,1],3)),this.targetLine=new ni(n,i),this.add(this.targetLine),this.update()}function ks(t){var e=new Mr,r=new ri({color:16777215,vertexColors:w}),n=[],i=[],o={},a=new tr(16755200),s=new tr(16711680),l=new tr(43775),c=new tr(16777215),u=new tr(3355443);function h(t,e,r){d(t,r),d(e,r)}function d(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(n.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.addAttribute("position",new br(n,3)),e.addAttribute("color",new br(i,3)),ii.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Bs(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new Mr;i.setIndex(new dr(r,1)),i.addAttribute("position",new dr(n,3)),ii.call(this,i,new ri({color:e})),this.matrixAutoUpdate=!1,this.update()}function js(t,e){this.type="Box3Helper",this.box=t;var r=void 0!==e?e:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Mr;i.setIndex(new dr(n,1)),i.addAttribute("position",new br([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),ii.call(this,i,new ri({color:r})),this.geometry.computeBoundingSphere()}function zs(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==r?r:16776960,i=new Mr;i.addAttribute("position",new br([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),ni.call(this,i,new ri({color:n}));var o=new Mr;o.addAttribute("position",new br([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Ur(o,new Lr({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Vs(t,e,r,n,i,o){ar.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===Ka&&((Ka=new Mr).addAttribute("position",new br([0,0,0,0,1,0],3)),($a=new go(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new ni(Ka,new ri({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ur($a,new Lr({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,o)}function Gs(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new Mr;r.addAttribute("position",new br(e,3)),r.addAttribute("color",new br([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new ri({vertexColors:_});ii.call(this,r,n)}function Hs(t,e,r,n,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new cr(t,e,r,i,o,a)}Object.assign(es.prototype,{load:function(t,e,r,n){var i=new Uo(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){ts.getContext().decodeAudioData(t,function(t){e(t)})},r,n)}}),Object.assign(rs.prototype,{update:function(){var t,e,r,n,i,o,a,s,l=new Ue,c=new Ue;return function(u){if(t!==this||e!==u.focus||r!==u.fov||n!==u.aspect*this.aspect||i!==u.near||o!==u.far||a!==u.zoom||s!==this.eyeSep){t=this,e=u.focus,r=u.fov,n=u.aspect*this.aspect,i=u.near,o=u.far,a=u.zoom;var h,d,p=u.projectionMatrix.clone(),f=(s=this.eyeSep/2)*i/e,m=i*Math.tan(De.DEG2RAD*r*.5)/a;c.elements[12]=-s,l.elements[12]=s,p.elements[0]=2*i/((d=m*n+f)-(h=-m*n+f)),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),p.elements[0]=2*i/((d=m*n-f)-(h=-m*n-f)),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()}),(ns.prototype=Object.create(ar.prototype)).constructor=ns,is.prototype=Object.assign(Object.create(ar.prototype),{constructor:is,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new Be,e=new ke,r=new Be,n=new Be;return function(i){ar.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(t,e,r),n.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(n.x,n.y,n.z,a.x,a.y,a.z))}}()}),os.prototype=Object.assign(Object.create(ar.prototype),{constructor:os,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),as.prototype=Object.assign(Object.create(os.prototype),{constructor:as,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new Be;return function(e){ar.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),Object.assign(ss.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(ls.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)r[i+a]=r[a];o=e}else this._mixBufferRegion(r,i,0,e/(o+=e),n);this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,o=this.binding;this.cumulativeWeight=0,i<1&&this._mixBufferRegion(r,n,3*e,1-i,e);for(var a=e,s=e+e;a!==s;++a)if(r[a]!==r[a+e]){o.setValue(r,n);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,r=3*e;this.binding.getValue(t,r);for(var n=e,i=r;n!==i;++n)t[n]=t[r+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)t[e+o]=t[r+o]},_slerp:function(t,e,r,n){ke.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[r+a]*n}}}),Object.assign(cs.prototype,{getValue:function(t,e){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(us,{Composite:cs,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new us.Composite(t,e,r):new us(t,e,r)},sanitizeNodeName:function(){var t=new RegExp("[\\[\\]\\.:\\/]","g");return function(e){return e.replace(/\s/g,"_").replace(t,"")}}(),parseTrackName:function(){var t="[^\\[\\]\\.:\\/]",e="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",t),n=/(WCOD+)?/.source.replace("WCOD",e),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t),a=new RegExp("^"+r+n+i+o+"$"),s=["material","materials","bones"];return function(t){var e=a.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==s.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}}(),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var o=n(i.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(us.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=us.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var s=t[n];if(void 0!==s){var l=this.Versioning.None;void 0!==t.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===i){i=a;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else console.error("THREE.PropertyBinding: Trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t)}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(us.prototype,{_getValue_unbound:us.prototype.getValue,_setValue_unbound:us.prototype.setValue}),Object.assign(hs.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=n[d];if(void 0===p){p=e++,n[d]=p,t.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new us(h,i[f],o[f]))}else if(p<r){l=t[p];var v=--r,g=t[v];for(n[g.uuid]=p,t[p]=g,n[d]=v,t[v]=h,f=0,m=s;f!==m;++f){var y=a[f],x=y[p];y[p]=y[v],void 0===x&&(x=new us(h,i[f],o[f])),y[v]=x}}else t[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=r[l];if(void 0!==c&&c>=e){var u=e++,h=t[u];r[h.uuid]=c,t[c]=h,r[l]=u,t[u]=s;for(var d=0,p=i;d!==p;++d){var f=n[d],m=f[c];f[c]=f[u],f[u]=m}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=n[l];if(void 0!==c)if(delete n[l],c<r){var u=--r,h=t[u],d=t[v=--e];n[h.uuid]=c,t[c]=h,n[d.uuid]=u,t[u]=d,t.pop();for(var p=0,f=o;p!==f;++p){var m=(g=i[p])[v];g[c]=g[u],g[u]=m,g.pop()}}else{var v;for(n[(d=t[v=--e]).uuid]=c,t[c]=d,t.pop(),p=0,f=o;p!==f;++p){var g;(g=i[p])[c]=g[v],g.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,c=new Array(s.length);r[t]=n=i.length,o.push(t),a.push(e),i.push(c);for(var u=l,h=s.length;u!==h;++u)c[u]=new us(s[u],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=r,o[r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}),Object.assign(ds.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,o=n/i;t.warp(1,i/n,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+r,l[0]=t/a,l[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*r;if(o<0||0===r)return;this._startTime=null,e=r*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;null!==r&&(e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var r=this._clip.duration,n=this.loop,i=this._loopCount;if(n===pe){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=n===me;if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=r||e<0){var a=Math.floor(e/r);e-=r*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&i))return this.time=e,r-e}return this.time=e,e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=be,n.endingEnd=be):(n.endingStart=t?this.zeroSlopeAtStart?be:xe:we,n.endingEnd=e?this.zeroSlopeAtEnd?be:xe:we)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=r,this}}),ps.prototype=Object.assign(Object.create(n.prototype),{constructor:ps,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,o=t._propertyBindings,a=t._interpolants,s=r.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(l[s]=c={});for(var u=0;u!==i;++u){var h=n[u],d=h.name,p=c[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}++(p=new ls(us.create(r,d,e&&e._propertyBindings[u].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[u]=p}a[u].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],o=this._bindings;void 0===i&&(n[e]=i={}),i[r]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,a=o[n],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete a[i];t:{for(var c in a)break t;delete o[n]}},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new Oa(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?Da.findByName(r,t):t,o=null!==i?i.uuid:t,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[n];if(void 0!==l)return l;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var c=new ds(this,i,e);return this._bindAction(c,s),this._addInactiveAction(c,o,n),c},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?Da.findByName(r,t):t,o=this._actionsByClip[i?i.uuid:t];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){for(var e=this._actions,r=this._nActiveActions,n=this.time+=t*=this.timeScale,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==r;++a)e[a]._update(n,t,i,o);var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),fs.prototype.clone=function(){return new fs(void 0===this.value.clone?this.value:this.value.clone())},ms.prototype=Object.assign(Object.create(Mr.prototype),{constructor:ms,isInstancedBufferGeometry:!0,copy:function(t){return Mr.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(vs.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(vs.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),Object.defineProperty(gs.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(gs.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),ys.prototype=Object.assign(Object.create(gs.prototype),{constructor:ys,isInstancedInterleavedBuffer:!0,copy:function(t){return gs.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),xs.prototype=Object.assign(Object.create(dr.prototype),{constructor:xs,isInstancedBufferAttribute:!0,copy:function(t){return dr.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(bs.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return _s(t,this,n,e),n.sort(ws),n},intersectObjects:function(t,e,r){var n=r||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=t.length;i<o;i++)_s(t[i],this,n,e);return n.sort(ws),n}}),Object.assign(Ss.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Object.assign(Ts.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(De.clamp(t.y/this.radius,-1,1))),this}}),Object.assign(Ms.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),Object.assign(As.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Fe;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Fe),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Fe),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Fe),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Fe),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Fe;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),(Es.prototype=Object.create(ar.prototype)).constructor=Es,Es.prototype.isImmediateRenderObject=!0,(Cs.prototype=Object.create(ii.prototype)).constructor=Cs,Cs.prototype.update=function(){var t=new Be,e=new Be,r=new je;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=d.vertexNormals[p];t.copy(s[d[n[p]]]).applyMatrix4(i),e.copy(m).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}else if(a&&a.isBufferGeometry){var v=a.attributes.position,g=a.attributes.normal;for(c=0,p=0,f=v.count;p<f;p++)t.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),e.set(g.getX(p),g.getY(p),g.getZ(p)),e.applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}o.needsUpdate=!0}}(),(Ps.prototype=Object.create(ar.prototype)).constructor=Ps,Ps.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ps.prototype.update=function(){var t=new Be,e=new Be;return function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(Os.prototype=Object.create(ii.prototype)).constructor=Os,Os.prototype.updateMatrixWorld=function(){var t=new Be,e=new Ue,r=new Ue;return function(n){var i=this.bones,o=this.geometry,a=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<i.length;s++){var c=i[s];c.parent&&c.parent.isBone&&(e.multiplyMatrices(r,c.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(l,t.x,t.y,t.z),e.multiplyMatrices(r,c.parent.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(l+1,t.x,t.y,t.z),l+=2)}o.getAttribute("position").needsUpdate=!0,ar.prototype.updateMatrixWorld.call(this,n)}}(),(Ns.prototype=Object.create(Ur.prototype)).constructor=Ns,Ns.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Ns.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(Ls.prototype=Object.create(ar.prototype)).constructor=Ls,Ls.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ls.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=t,n[1]=-e,n[2]=0,n[3]=t,n[4]=e,n[5]=0,n[6]=-t,n[7]=e,n[8]=0,n[9]=-t,n[10]=-e,n[11]=0,n[12]=t,n[13]=-e,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Is.prototype=Object.create(ar.prototype)).constructor=Is,Is.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Is.prototype.update=function(){var t=new Be,e=new tr,r=new tr;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");e.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,a=i.count;o<a;o++){var s=o<a/2?e:r;i.setXYZ(o,s.r,s.g,s.b)}i.needsUpdate=!0}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Rs.prototype=Object.create(ii.prototype)).constructor=Rs,(Ds.prototype=Object.create(ii.prototype)).constructor=Ds,(Fs.prototype=Object.create(ii.prototype)).constructor=Fs,Fs.prototype.update=function(){var t=new Be,e=new Be,r=new je;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,l=0,c=0,u=s.length;c<u;c++){var h=s[c],d=h.normal;t.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(n),e.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),i.setXYZ(l,t.x,t.y,t.z),i.setXYZ(l+=1,e.x,e.y,e.z),l+=1}i.needsUpdate=!0}}(),(Us.prototype=Object.create(ar.prototype)).constructor=Us,Us.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Us.prototype.update=function(){var t=new Be,e=new Be,r=new Be;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(e,t),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),(ks.prototype=Object.create(ii.prototype)).constructor=ks,ks.prototype.update=function(){var t,e,r=new Be,n=new sr;function i(i,o,a,s){r.set(o,a,s).unproject(n);var l=e[i];if(void 0!==l)for(var c=t.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],r.x,r.y,r.z)}return function(){t=this.geometry,e=this.pointMap,n.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(Bs.prototype=Object.create(ii.prototype)).constructor=Bs,Bs.prototype.update=function(){var t=new Ye;return function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var r=t.min,n=t.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Bs.prototype.setFromObject=function(t){return this.object=t,this.update(),this},(js.prototype=Object.create(ii.prototype)).constructor=js,js.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),ar.prototype.updateMatrixWorld.call(this,t))},(zs.prototype=Object.create(ni.prototype)).constructor=zs,zs.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),ar.prototype.updateMatrixWorld.call(this,t)},(Vs.prototype=Object.create(ar.prototype)).constructor=Vs,Vs.prototype.setDirection=function(){var t,e=new Be;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Math.acos(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),Vs.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},Vs.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(Gs.prototype=Object.create(ii.prototype)).constructor=Gs;var Ws=0,Xs=1;function Ys(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function qs(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Js(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new si(t,e)}function Zs(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Qn(t)}function Qs(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new si(t,e)}function Ks(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ai(t)}function $s(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ai(t)}function tl(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ai(t)}function el(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Be(t,e,r)}function rl(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new dr(t,e).setDynamic(!0)}function nl(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new pr(t,e)}function il(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new fr(t,e)}function ol(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new mr(t,e)}function al(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new vr(t,e)}function sl(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new gr(t,e)}function ll(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new yr(t,e)}function cl(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new xr(t,e)}function ul(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new br(t,e)}function hl(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new wr(t,e)}function dl(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Qo.call(this,t),this.type="catmullrom",this.closed=!0}function pl(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Qo.call(this,t),this.type="catmullrom"}function fl(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Qo.call(this,t),this.type="catmullrom"}function ml(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Gs(t)}function vl(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Bs(t,e)}function gl(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ii(new mo(t.geometry),new ri({color:void 0!==e?e:16777215}))}function yl(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ii(new di(t.geometry),new ri({color:void 0!==e?e:16777215}))}function xl(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Uo(t)}function bl(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Bo(t)}Go.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Go.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(ca.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new hr,r=0,n=t.length;r<n;r++){var i=t[r];e.vertices.push(new Be(i.x,i.y,i.z||0))}return e}}),Object.assign(ua.prototype,{fromPoints:function(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),dl.prototype=Object.create(Qo.prototype),pl.prototype=Object.create(Qo.prototype),fl.prototype=Object.create(Qo.prototype),Object.assign(fl.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Rs.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Os.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ba.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ja.extractUrlBase(t)}}),Object.assign(As.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Ye.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Dr.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(De,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),De.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),De.ceilPowerOfTwo(t)}}),Object.assign(je.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Ue.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new Be),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,o)}}),Je.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},ke.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Rr.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Fr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Fr,{barycoordFromPoint:function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Fr.getBarycoord(t,e,r,n,i)},normal:function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Fr.getNormal(t,e,r,n)}}),Object.assign(ha.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new eo(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ho(this,t)}}),Object.assign(Fe.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Be.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ge.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(hr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(ar.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(ar.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Kn.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty($n.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Go.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Gn.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(da.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(dr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Mr.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Mr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(fs.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Nr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new tr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===y}}}),Object.defineProperties(Eo.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ir.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Xn.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(Xn.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(jn.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(He.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Wn.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),os.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new es).load(t,function(t){e.setBuffer(t)}),this},ss.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ns.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var wl={merge:function(t,e,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},_l={crossOrigin:void 0,loadTexture:function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Vo;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},loadTextureCube:function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new zo;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};function Sl(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function Tl(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}var Ml={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function Al(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}},Wr15:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=l(r("Yu7f")),o=r("qp2T"),a=r("pQYt"),s=l(r("Yd/J"));function l(t){return t&&t.__esModule?t:{default:t}}var c={},u=function(){function t(e,r,n){for(var l in function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=r||t.defaultFragmentSrc,this._blendMode=a.BLEND_MODES.NORMAL,this.uniformData=n||(0,i.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler"),this.uniforms={},this.uniformData)this.uniforms[l]=this.uniformData[l].value,this.uniformData[l].type&&(this.uniformData[l].type=this.uniformData[l].type.toLowerCase());this.glShaders={},c[this.vertexSrc+this.fragmentSrc]||(c[this.vertexSrc+this.fragmentSrc]=(0,o.uid)()),this.glShaderKey=c[this.vertexSrc+this.fragmentSrc],this.padding=4,this.resolution=s.default.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0}return t.prototype.apply=function(t,e,r,n,i){t.applyFilter(this,e,r,n)},n(t,[{key:"blendMode",get:function(){return this._blendMode},set:function(t){this._blendMode=t}}],[{key:"defaultVertexSrc",get:function(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]),t}();e.default=u},Xwh9:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=a(r("u62O")),o=a(r("1eSL"));function a(t){return t&&t.__esModule?t:{default:t}}var s=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),l=null;function c(){}var u=function(){function t(e,r,n){if(function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),"string"!=typeof e||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");n=n||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=e,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===n.crossOrigin?"anonymous":n.crossOrigin,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=c,this._onLoadBinding=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this),this.onStart=new o.default,this.onProgress=new o.default,this.onComplete=new o.default,this.onAfterMiddleware=new o.default}return t.setExtensionLoadType=function(e,r){h(t._loadTypeMap,e,r)},t.setExtensionXhrType=function(e,r){h(t._xhrTypeMap,e,r)},t.prototype.complete=function(){if(this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}},t.prototype.load=function(e){var r=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout(function(){return e(r)},1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:s&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t.prototype._hasFlag=function(t){return!!(this._flags&t)},t.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},t.prototype._loadElement=function(t){this.data=this.metadata.loadElement?this.metadata.loadElement:"image"===t&&void 0!==window.Image?new Image:document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},t.prototype._loadSourceElement=function(t){if(this.data=this.metadata.loadElement?this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?new Audio:document.createElement(t),null!==this.data){if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(t,this.url[r],Array.isArray(e)?e[r]:e));else{var n=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(n)?n[0]:n))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()}else this.abort("Unsupported element: "+t)},t.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.responseType=this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?t.XHR_RESPONSE_TYPE.TEXT:this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXdrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},t.prototype._createSource=function(t,e,r){r||(r=t+"/"+this._getExtension(e));var n=document.createElement("source");return n.src=e,n.type=r,n},t.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},t.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},t.prototype._xhrOnError=function(){var t=this.xhr;this.abort(d(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},t.prototype._xhrOnAbort=function(){this.abort(d(this.xhr)+" Request was aborted by the user.")},t.prototype._xdrOnTimeout=function(){this.abort(d(this.xhr)+" Request timed out.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,r="",n=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(r=e.responseText),0===n&&(r.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?n=200:1223===n&&(n=204),2==(n/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(r,"text/xml")}else{var o=document.createElement("div");o.innerHTML=r,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||r;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},t.prototype._determineCrossOrigin=function(t,e){return 0===t.indexOf("data:")?"":(e=e||window.location,l||(l=document.createElement("a")),l.href=t,(t=(0,i.default)(l.href,{strictMode:!0})).host!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||(t.protocol?t.protocol+":":"")!==e.protocol?"anonymous":"")},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var r=t.indexOf("/");e=t.substring(r+1,t.indexOf(";",r))}else{var n=t.indexOf("?"),i=t.indexOf("#"),o=Math.min(n>-1?n:t.length,i>-1?i:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},n(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function h(t,e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=r)}function d(t){return t.toString().replace("object ","")}e.default=u,u.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},u.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},u.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},u.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},u._loadTypeMap={gif:u.LOAD_TYPE.IMAGE,png:u.LOAD_TYPE.IMAGE,bmp:u.LOAD_TYPE.IMAGE,jpg:u.LOAD_TYPE.IMAGE,jpeg:u.LOAD_TYPE.IMAGE,tif:u.LOAD_TYPE.IMAGE,tiff:u.LOAD_TYPE.IMAGE,webp:u.LOAD_TYPE.IMAGE,tga:u.LOAD_TYPE.IMAGE,svg:u.LOAD_TYPE.IMAGE,"svg+xml":u.LOAD_TYPE.IMAGE,mp3:u.LOAD_TYPE.AUDIO,ogg:u.LOAD_TYPE.AUDIO,wav:u.LOAD_TYPE.AUDIO,mp4:u.LOAD_TYPE.VIDEO,webm:u.LOAD_TYPE.VIDEO},u._xhrTypeMap={xhtml:u.XHR_RESPONSE_TYPE.DOCUMENT,html:u.XHR_RESPONSE_TYPE.DOCUMENT,htm:u.XHR_RESPONSE_TYPE.DOCUMENT,xml:u.XHR_RESPONSE_TYPE.DOCUMENT,tmx:u.XHR_RESPONSE_TYPE.DOCUMENT,svg:u.XHR_RESPONSE_TYPE.DOCUMENT,tsx:u.XHR_RESPONSE_TYPE.DOCUMENT,gif:u.XHR_RESPONSE_TYPE.BLOB,png:u.XHR_RESPONSE_TYPE.BLOB,bmp:u.XHR_RESPONSE_TYPE.BLOB,jpg:u.XHR_RESPONSE_TYPE.BLOB,jpeg:u.XHR_RESPONSE_TYPE.BLOB,tif:u.XHR_RESPONSE_TYPE.BLOB,tiff:u.XHR_RESPONSE_TYPE.BLOB,webp:u.XHR_RESPONSE_TYPE.BLOB,tga:u.XHR_RESPONSE_TYPE.BLOB,json:u.XHR_RESPONSE_TYPE.JSON,text:u.XHR_RESPONSE_TYPE.TEXT,txt:u.XHR_RESPONSE_TYPE.TEXT,ttf:u.XHR_RESPONSE_TYPE.BUFFER,otf:u.XHR_RESPONSE_TYPE.BUFFER},u.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},XypG:function(t,e){},Y12R:function(t,e,r){"use strict";e.__esModule=!0,e.BitmapText=e.TilingSpriteRenderer=e.TilingSprite=e.AnimatedSprite=void 0;var n=r("3r+V");Object.defineProperty(e,"AnimatedSprite",{enumerable:!0,get:function(){return s(n).default}});var i=r("h4Yq");Object.defineProperty(e,"TilingSprite",{enumerable:!0,get:function(){return s(i).default}});var o=r("pEa2");Object.defineProperty(e,"TilingSpriteRenderer",{enumerable:!0,get:function(){return s(o).default}});var a=r("QLbY");function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"BitmapText",{enumerable:!0,get:function(){return s(a).default}}),r("R2qm"),r("rvTR"),r("8eTQ")},Y8mV:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN"));r("2U8Y");var o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));return r.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],r.alpha=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._loadMatrix=function(t){var e=t;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this._multiply(e,this.uniforms.m,t),e=this._colorMatrix(e)),this.uniforms.m=e},e.prototype._multiply=function(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)},e.prototype.greyscale=function(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var r=Math.cos(t),n=Math.sin(t),i=1/3,o=(0,Math.sqrt)(i);this._loadMatrix([r+(1-r)*i,i*(1-r)-o*n,i*(1-r)+o*n,0,0,i*(1-r)+o*n,r+i*(1-r),i*(1-r)-o*n,0,0,i*(1-r)-o*n,i*(1-r)+o*n,r+i*(1-r),0,0,0,0,0,1,0],e)},e.prototype.contrast=function(t,e){var r=(t||0)+1,n=-.5*(r-1);this._loadMatrix([r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0],e)},e.prototype.saturate=function(){var t=2*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/3+1,e=-.5*(t-1);this._loadMatrix([t,e,e,0,0,e,t,e,0,0,e,e,t,0,0,0,0,0,1,0],arguments[1])},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,r,n,i){t=t||.2,e=e||.15;var o=((r=r||16770432)>>16&255)/255,a=(r>>8&255)/255,s=(255&r)/255,l=((n=n||3375104)>>16&255)/255,c=(n>>8&255)/255,u=(255&n)/255;this._loadMatrix([.3,.59,.11,0,0,o,a,s,t,0,l,c,u,e,0,o-l,a-c,s-u,0,0],i)},e.prototype.night=function(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)},e.prototype.predator=function(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},n(e,[{key:"matrix",get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t}},{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t}}]),e}(i.Filter);e.default=o,o.prototype.grayscale=o.prototype.greyscale},YcCt:function(t,e,r){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,r,i){e=e||"&",r=r||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e);var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var l=t.length;s>0&&l>s&&(l=s);for(var c=0;c<l;++c){var u,h,d,p,f=t[c].replace(a,"%20"),m=f.indexOf(r);m>=0?(u=f.substr(0,m),h=f.substr(m+1)):(u=f,h=""),d=decodeURIComponent(u),p=decodeURIComponent(h),n(o,d)?Array.isArray(o[d])?o[d].push(p):o[d]=[o[d],p]:o[d]=p}return o}},"Yd/J":function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("xqnD")),i=o(r("JLJ9"));function o(t){return t&&t.__esModule?t:{default:t}}e.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,n.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1,width:800,height:600,legacy:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,i.default)(),MESH_CANVAS_PADDING:0}},Yiwd:function(t,e,r){"use strict";e.__esModule=!0;var n=r("bx0q");Object.defineProperty(e,"accessibleTarget",{enumerable:!0,get:function(){return o(n).default}});var i=r("2AE7");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"AccessibilityManager",{enumerable:!0,get:function(){return o(i).default}})},YnQD:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("d07J"),o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.position=new i.Point(0,0),r.scale=new i.Point(1,1),r.skew=new i.ObservablePoint(r.updateSkew,r,0,0),r.pivot=new i.Point(0,0),r._rotation=0,r._cx=1,r._sx=0,r._cy=0,r._sy=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x)},e.prototype.updateLocalTransform=function(){var t=this.localTransform;t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d)},e.prototype.updateTransform=function(t){var e=this.localTransform;e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d);var r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._worldID++},e.prototype.setFromMatrix=function(t){t.decompose(this)},n(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("KByU")).default);e.default=o},Yu7f:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var n=i(t),o=i(e);return Object.assign(n,o)};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("yI/K")).default.shader.defaultValue;function i(t){for(var e=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"),r={},i=void 0,o=t.replace(/\s+/g," ").split(/\s*;\s*/),a=0;a<o.length;a++){var s=o[a].trim();if(s.indexOf("uniform")>-1){var l=s.split(" "),c=l[1],u=l[2],h=1;u.indexOf("[")>-1&&(u=(i=u.split(/\[|]/))[0],h*=Number(i[1])),u.match(e)||(r[u]={value:n(c,h),name:u,type:c})}}return r}},YuTi:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},Yvos:function(t,e){t.exports=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},Z0PJ:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=p(r("jQCb")),o=p(r("xJsK")),a=r("d07J"),s=r("qp2T"),l=r("pQYt"),c=p(r("Yd/J")),u=p(r("vUM4")),h=p(r("TR3/")),d=p(r("/HYg"));function p(t){return t&&t.__esModule?t:{default:t}}var f={texture:!0,children:!1,baseTexture:!0},m=function(t){function e(r,n,i){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=i||document.createElement("canvas")).width=3,i.height=3;var s=o.default.fromCanvas(i,c.default.SCALE_MODE,"text");s.orig=new a.Rectangle,s.trim=new a.Rectangle;var l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,s));return o.default.addToCache(l._texture,l._texture.baseTexture.textureCacheIds[0]),l.canvas=i,l.context=l.canvas.getContext("2d"),l.resolution=c.default.RESOLUTION,l._text=null,l._style=null,l._styleListener=null,l._font="",l.text=r,l.style=n,l.localStyleID=-1,l}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var r=this.context,n=h.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas),i=n.height,o=n.lines,a=n.lineHeight,s=n.lineWidths,l=n.maxLineWidth,c=n.fontProperties;this.canvas.width=Math.ceil((Math.max(1,n.width)+2*e.padding)*this.resolution),this.canvas.height=Math.ceil((Math.max(1,i)+2*e.padding)*this.resolution),r.scale(this.resolution,this.resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.strokeStyle=e.stroke,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;var u=void 0,d=void 0;if(e.dropShadow){r.fillStyle=e.dropShadowColor,r.globalAlpha=e.dropShadowAlpha,r.shadowBlur=e.dropShadowBlur,e.dropShadowBlur>0&&(r.shadowColor=e.dropShadowColor);for(var p=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,f=Math.sin(e.dropShadowAngle)*e.dropShadowDistance,m=0;m<o.length;m++)u=e.strokeThickness/2,d=e.strokeThickness/2+m*a+c.ascent,"right"===e.align?u+=l-s[m]:"center"===e.align&&(u+=(l-s[m])/2),e.fill&&(this.drawLetterSpacing(o[m],u+p+e.padding,d+f+e.padding),e.stroke&&e.strokeThickness&&(r.strokeStyle=e.dropShadowColor,this.drawLetterSpacing(o[m],u+p+e.padding,d+f+e.padding,!0),r.strokeStyle=e.stroke))}r.shadowBlur=0,r.globalAlpha=1,r.fillStyle=this._generateFillStyle(e,o);for(var v=0;v<o.length;v++)u=e.strokeThickness/2,d=e.strokeThickness/2+v*a+c.ascent,"right"===e.align?u+=l-s[v]:"center"===e.align&&(u+=(l-s[v])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[v],u+e.padding,d+e.padding,!0),e.fill&&this.drawLetterSpacing(o[v],u+e.padding,d+e.padding);this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this._style.letterSpacing;if(0!==i)for(var o=String.prototype.split.call(t,""),a=e,s=0,l="";s<t.length;)l=o[s++],n?this.context.strokeText(l,a,r):this.context.fillText(l,a,r),a+=this.context.measureText(l).width+i;else n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=(0,d.default)(t);t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0)}var r=this._texture,n=this._style,i=n.trim?0:n.padding,o=r.baseTexture;o.hasLoaded=!0,o.resolution=this.resolution,o.realWidth=t.width,o.realHeight=t.height,o.width=t.width/this.resolution,o.height=t.height/this.resolution,r.trim.width=r._frame.width=t.width/this.resolution,r.trim.height=r._frame.height=t.height/this.resolution,r.trim.x=-i,r.trim.y=-i,r.orig.width=r._frame.width-2*i,r.orig.height=r._frame.height-2*i,this._onTextureUpdate(),o.emit("update",o),this.dirty=!1},e.prototype.renderWebGL=function(e){this.resolution!==e.resolution&&(this.resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype.renderWebGL.call(this,e)},e.prototype._renderCanvas=function(e){this.resolution!==e.resolution&&(this.resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._renderCanvas.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._onStyleChange=function(){this.dirty=!0},e.prototype._generateFillStyle=function(t,e){if(!Array.isArray(t.fill))return t.fill;if(navigator.isCocoonJS)return t.fill[0];var r=void 0,n=void 0,i=void 0,o=this.canvas.width/this.resolution,a=this.canvas.height/this.resolution,s=t.fill.slice(),c=t.fillGradientStops.slice();if(!c.length)for(var u=s.length+1,h=1;h<u;++h)c.push(h/u);if(s.unshift(t.fill[0]),c.unshift(0),s.push(t.fill[t.fill.length-1]),c.push(1),t.fillGradientType===l.TEXT_GRADIENT.LINEAR_VERTICAL){r=this.context.createLinearGradient(o/2,0,o/2,a),n=(s.length+1)*e.length,i=0;for(var d=0;d<e.length;d++){i+=1;for(var p=0;p<s.length;p++)r.addColorStop("number"==typeof c[p]?c[p]/e.length+d/e.length:i/n,s[p]),i++}}else{r=this.context.createLinearGradient(0,a/2,o,a/2),n=s.length+1,i=1;for(var f=0;f<s.length;f++)r.addColorStop("number"==typeof c[f]?c[f]:i/n,s[f]),i++}return r},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},f,e),t.prototype.destroy.call(this,e),this.context=null,this.canvas=null,this._style=null},n(e,[{key:"width",get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=(0,s.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=(0,s.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"style",get:function(){return this._style},set:function(t){this._style=(t=t||{})instanceof u.default?t:new u.default(t),this.localStyleID=-1,this.dirty=!0}},{key:"text",get:function(){return this._text},set:function(t){t=String(""===t||null===t||void 0===t?" ":t),this._text!==t&&(this._text=t,this.dirty=!0)}}]),e}(i.default);e.default=m},"a/Ns":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("qp2T"),o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.children=[],r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onChildrenChange=function(){},e.prototype.addChild=function(t){var e=arguments.length;if(e>1)for(var r=0;r<e;r++)this.addChild(arguments[r]);else t.parent&&t.parent.removeChild(t),t.parent=this,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),t.emit("added",this);return t},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),t},e.prototype.swapChildren=function(t,e){if(t!==e){var r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(t);(0,i.removeItems)(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(t){var e=arguments.length;if(e>1)for(var r=0;r<e;r++)this.removeChild(arguments[r]);else{var n=this.children.indexOf(t);if(-1===n)return null;t.parent=null,t.transform._parentID=-1,(0,i.removeItems)(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this)}return t},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,(0,i.removeItems)(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),e},e.prototype.removeChildren=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1],r="number"==typeof e?e:this.children.length,n=r-t,i=void 0;if(n>0&&n<=r){i=this.children.splice(t,n);for(var o=0;o<i.length;++o)i[o].parent=null,i[o].transform&&(i[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var a=0;a<i.length;++a)i[a].emit("removed",this);return i}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var r=this.children[t];r.visible&&r.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.visible&&e.renderable&&(e.calculateBounds(),e._mask?(e._mask.calculateBounds(),this._bounds.addBoundsMask(e._bounds,e._mask._bounds)):e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds))}this._lastBoundsID=this._boundsID},e.prototype._calculateBounds=function(){},e.prototype.renderWebGL=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(t);else{this._renderWebGL(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].renderWebGL(t)}},e.prototype.renderAdvancedWebGL=function(t){t.flush();var e=this._filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n]);this._enabledFilters.length&&t.filterManager.pushFilter(this,this._enabledFilters)}r&&t.maskManager.pushMask(this,this._mask),this._renderWebGL(t);for(var i=0,o=this.children.length;i<o;i++)this.children[i].renderWebGL(t);t.flush(),r&&t.maskManager.popMask(this,this._mask),e&&this._enabledFilters&&this._enabledFilters.length&&t.filterManager.popFilter()},e.prototype._renderWebGL=function(t){},e.prototype._renderCanvas=function(t){},e.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.prototype.destroy=function(e){t.prototype.destroy.call(this);var r="boolean"==typeof e?e:e&&e.children,n=this.removeChildren(0,this.children.length);if(r)for(var i=0;i<n.length;++i)n[i].destroy(e)},n(e,[{key:"width",get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}},{key:"height",get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("2IYi")).default);e.default=o,o.prototype.containerUpdateTransform=o.prototype.updateTransform},a7XB:function(t,e,r){"use strict";Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t})},ad8U:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location;return 0===t.indexOf("data:")?"":(e=e||window.location,i||(i=document.createElement("a")),i.href=t,(t=n.default.parse(i.href)).hostname!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||t.protocol!==e.protocol?"anonymous":"")};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("CxY0")),i=void 0},akSB:function(t,e,r){var n=r("AdPF"),i=r("0z79"),o=r("Cl5A"),a=r("CIKq");e.polling=function(t){var e=!1,r=!1,a=!1!==t.jsonp;if(global.location){var s="https:"===location.protocol,l=location.port;l||(l=s?443:80),e=t.hostname!==location.hostname||l!==t.port,r=t.secure!==s}if(t.xdomain=e,t.xscheme=r,"open"in new n(t)&&!t.forceJSONP)return new i(t);if(!a)throw new Error("JSONP disabled");return new o(t)},e.websocket=a},aq8N:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var a=t.shape,s=a.x,l=a.y,c=void 0,u=void 0;if(t.type===i.SHAPES.CIRC?(c=a.radius,u=a.radius):(c=a.width,u=a.height),0!==c&&0!==u){var h=Math.floor(30*Math.sqrt(a.radius))||Math.floor(15*Math.sqrt(a.width+a.height)),d=2*Math.PI/h;if(t.fill){var p=(0,o.hex2rgb)(t.fillColor),f=t.fillAlpha,m=p[0]*f,v=p[1]*f,g=p[2]*f,y=e.points,x=e.indices,b=y.length/6;x.push(b);for(var w=0;w<h+1;w++)y.push(s,l,m,v,g,f),y.push(s+Math.sin(d*w)*c,l+Math.cos(d*w)*u,m,v,g,f),x.push(b++,b++);x.push(b-1)}if(t.lineWidth){var _=t.points;t.points=[];for(var S=0;S<h+1;S++)t.points.push(s+Math.sin(d*S)*c,l+Math.cos(d*S)*u);(0,n.default)(t,e,r),t.points=_}}};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("5OzF")),i=r("pQYt"),o=r("qp2T")},"bY+x":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copy=function(t){this.set(t.x,t.y)},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},t}();e.default=n},bwp9:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("bY+x")),i=r("pQYt"),o=function(){function t(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];if(function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),Array.isArray(r[0])&&(r=r[0]),r[0]instanceof n.default){for(var a=[],s=0,l=r.length;s<l;s++)a.push(r[s].x,r[s].y);r=a}this.closed=!0,this.points=r,this.type=i.SHAPES.POLY}return t.prototype.clone=function(){return new t(this.points.slice())},t.prototype.close=function(){var t=this.points;t[0]===t[t.length-2]&&t[1]===t[t.length-1]||t.push(t[0],t[1])},t.prototype.contains=function(t,e){for(var r=!1,n=this.points.length/2,i=0,o=n-1;i<n;o=i++){var a=this.points[2*i],s=this.points[2*i+1],l=this.points[2*o+1];s>e!=l>e&&t<(e-s)/(l-s)*(this.points[2*o]-a)+a&&(r=!r)}return r},t}();e.default=o},bx0q:function(t,e,r){"use strict";e.__esModule=!0,e.default={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},"c/UO":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e){var r=Math.ceil(t/2),i=n,o="",a=void 0;a=e?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<t;s++){var l=a.replace("%index%",s);o+=l=l.replace("%sampleIndex%",s-(r-1)+".0"),o+="\n"}return(i=i.replace("%blur%",o)).replace("%size%",t)};var n=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n")},cD5x:function(t,e,r){var n=r("49sm"),i=r("+SKG"),o=Object.prototype.toString,a="function"==typeof global.Blob||"[object BlobConstructor]"===o.call(global.Blob),s="function"==typeof global.File||"[object FileConstructor]"===o.call(global.File);e.deconstructPacket=function(t){var e=[],r=t;return r.data=function t(e,r){if(!e)return e;if(i(e)){var o={_placeholder:!0,num:r.length};return r.push(e),o}if(n(e)){for(var a=new Array(e.length),s=0;s<e.length;s++)a[s]=t(e[s],r);return a}if("object"==typeof e&&!(e instanceof Date)){for(var l in a={},e)a[l]=t(e[l],r);return a}return e}(t.data,e),r.attachments=e.length,{packet:r,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,r){if(!e)return e;if(e&&e._placeholder)return r[e.num];if(n(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],r);else if("object"==typeof e)for(var o in e)e[o]=t(e[o],r);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var r=0,o=t;!function t(l,c,u){if(!l)return l;if(a&&l instanceof Blob||s&&l instanceof File){r++;var h=new FileReader;h.onload=function(){u?u[c]=this.result:o=this.result,--r||e(o)},h.readAsArrayBuffer(l)}else if(n(l))for(var d=0;d<l.length;d++)t(l[d],d,l);else if("object"==typeof l&&!i(l))for(var p in l)t(l[p],p,l)}(o),r||e(o)}},cQc6:function(t,e){t.exports=function(t,e){for(var r=t[0],n=t[1],i=!1,o=0,a=e.length-1;o<e.length;a=o++){var s=e[o][0],l=e[o][1],c=e[a][1];l>n!=c>n&&r<(e[a][0]-s)*(n-l)/(c-l)+s&&(i=!i)}return i}},cpc2:function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks["$"+t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},crnd:function(t,e){function r(t){return Promise.resolve().then(function(){var e=new Error('Cannot find module "'+t+'".');throw e.code="MODULE_NOT_FOUND",e})}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id="crnd"},cva9:function(t,e,r){"use strict";e.__esModule=!0;var n=r("pQYt"),i=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.pushMask=function(t){var e=this.renderer;e.context.save();var r=t.alpha,n=t.transform.worldTransform,i=e.resolution;e.context.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*i,n.ty*i),t._texture||(this.renderGraphicsShape(t),e.context.clip()),t.worldAlpha=r},t.prototype.renderGraphicsShape=function(t){var e=this.renderer.context,r=t.graphicsData.length;if(0!==r){e.beginPath();for(var i=0;i<r;i++){var o=t.graphicsData[i],a=o.shape;if(o.type===n.SHAPES.POLY){var s=a.points;e.moveTo(s[0],s[1]);for(var l=1;l<s.length/2;l++)e.lineTo(s[2*l],s[2*l+1]);s[0]===s[s.length-2]&&s[1]===s[s.length-1]&&e.closePath()}else if(o.type===n.SHAPES.RECT)e.rect(a.x,a.y,a.width,a.height),e.closePath();else if(o.type===n.SHAPES.CIRC)e.arc(a.x,a.y,a.radius,0,2*Math.PI),e.closePath();else if(o.type===n.SHAPES.ELIP){var c=2*a.width,u=2*a.height,h=a.x-c/2,d=a.y-u/2,p=c/2*.5522848,f=u/2*.5522848,m=h+c,v=d+u,g=h+c/2,y=d+u/2;e.moveTo(h,y),e.bezierCurveTo(h,y-f,g-p,d,g,d),e.bezierCurveTo(g+p,d,m,y-f,m,y),e.bezierCurveTo(m,y+f,g+p,v,g,v),e.bezierCurveTo(g-p,v,h,y+f,h,y),e.closePath()}else if(o.type===n.SHAPES.RREC){var x=a.x,b=a.y,w=a.width,_=a.height,S=a.radius,T=Math.min(w,_)/2|0;e.moveTo(x,b+(S=S>T?T:S)),e.lineTo(x,b+_-S),e.quadraticCurveTo(x,b+_,x+S,b+_),e.lineTo(x+w-S,b+_),e.quadraticCurveTo(x+w,b+_,x+w,b+_-S),e.lineTo(x+w,b+S),e.quadraticCurveTo(x+w,b,x+w-S,b),e.lineTo(x+S,b),e.quadraticCurveTo(x,b,x,b+S),e.closePath()}}}},t.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},t.prototype.destroy=function(){},t}();e.default=i},d07J:function(t,e,r){"use strict";e.__esModule=!0;var n=r("bY+x");Object.defineProperty(e,"Point",{enumerable:!0,get:function(){return d(n).default}});var i=r("HP7h");Object.defineProperty(e,"ObservablePoint",{enumerable:!0,get:function(){return d(i).default}});var o=r("+HqX");Object.defineProperty(e,"Matrix",{enumerable:!0,get:function(){return d(o).default}});var a=r("/zO6");Object.defineProperty(e,"GroupD8",{enumerable:!0,get:function(){return d(a).default}});var s=r("W3bV");Object.defineProperty(e,"Circle",{enumerable:!0,get:function(){return d(s).default}});var l=r("qEO2");Object.defineProperty(e,"Ellipse",{enumerable:!0,get:function(){return d(l).default}});var c=r("bwp9");Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return d(c).default}});var u=r("TXE8");Object.defineProperty(e,"Rectangle",{enumerable:!0,get:function(){return d(u).default}});var h=r("iEUh");function d(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"RoundedRectangle",{enumerable:!0,get:function(){return d(h).default}})},d6Os:function(t,e,r){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.blobMiddlewareFactory=function(){return function(t,e){if(t.data){if(t.xhr&&t.xhrType===i.default.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var r=function(){var r=s.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=r,t.type=i.default.TYPE.IMAGE,t.data.onload=function(){s.revokeObjectURL(r),t.data.onload=null,e()},{v:void 0}}();if("object"===(void 0===r?"undefined":n(r)))return r.v}}else{var a=t.xhr.getResponseHeader("content-type");if(a&&0===a.indexOf("image"))return t.data=new Image,t.data.src="data:"+a+";base64,"+o.default.encodeBinary(t.xhr.responseText),t.type=i.default.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}};var i=a(r("Xwh9")),o=a(r("s1jd"));function a(t){return t&&t.__esModule?t:{default:t}}var s=window.URL||window.webkitURL},dGcs:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){for(var t=[],e=[],r=0;r<32;r++)t[r]=r,e[r]=r;t[n.BLEND_MODES.NORMAL_NPM]=n.BLEND_MODES.NORMAL,t[n.BLEND_MODES.ADD_NPM]=n.BLEND_MODES.ADD,t[n.BLEND_MODES.SCREEN_NPM]=n.BLEND_MODES.SCREEN,e[n.BLEND_MODES.NORMAL]=n.BLEND_MODES.NORMAL_NPM,e[n.BLEND_MODES.ADD]=n.BLEND_MODES.ADD_NPM,e[n.BLEND_MODES.SCREEN]=n.BLEND_MODES.SCREEN_NPM;var i=[];return i.push(e),i.push(t),i};var n=r("pQYt")},"dkv/":function(t,e){t.exports=Object.keys||function(t){var e=[],r=Object.prototype.hasOwnProperty;for(var n in t)r.call(t,n)&&e.push(n);return e}},dyai:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=s(r("I42F")),a=s(r("ASAs"));function s(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(r,n,s,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return c.blurXFilter=new o.default(r,n,s,l),c.blurYFilter=new a.default(r,n,s,l),c.padding=0,c.resolution=s||i.settings.RESOLUTION,c.quality=n||4,c.blur=r||8,c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r){var n=t.getRenderTarget(!0);this.blurXFilter.apply(t,e,n,!0),this.blurYFilter.apply(t,n,r,!1),t.returnRenderTarget(n)},n(e,[{key:"blur",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"quality",get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blendMode",get:function(){return this.blurYFilter._blendMode},set:function(t){this.blurYFilter._blendMode=t}}]),e}(i.Filter);e.default=l},e8hs:function(t,e,r){"use strict";e.__esModule=!0;var n=c(r("z+eP")),i=r("d6Os"),o=c(r("uhBA")),a=c(r("SLIe")),s=c(r("Nx1p")),l=c(r("oXL5"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,n));o.default.call(i);for(var a=0;a<e._pixiMiddleware.length;++a)i.use(e._pixiMiddleware[a]());return i.onStart.add(function(t){return i.emit("start",t)}),i.onProgress.add(function(t,e){return i.emit("progress",t,e)}),i.onError.add(function(t,e,r){return i.emit("error",t,e,r)}),i.onLoad.add(function(t,e){return i.emit("load",t,e)}),i.onComplete.add(function(t,e){return i.emit("complete",t,e)}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.addPixiMiddleware=function(t){e._pixiMiddleware.push(t)},e.prototype.destroy=function(){this.removeAllListeners(),this.reset()},e}(n.default);for(var h in e.default=u,o.default.prototype)u.prototype[h]=o.default.prototype[h];u._pixiMiddleware=[i.blobMiddlewareFactory,a.default,s.default,l.default];var d=n.default.Resource;d.setExtensionXhrType("fnt",d.XHR_RESPONSE_TYPE.DOCUMENT)},eIHw:function(t,e,r){"use strict";e.__esModule=!0;var n=i(r("WJwb"));function i(t){return t&&t.__esModule?t:{default:t}}var o=function(t){function e(r,i){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=null;if(!(r instanceof n.default)){var a=arguments[1],s=arguments[2],l=arguments[3],c=arguments[4];console.warn("Please use RenderTexture.create("+a+", "+s+") instead of the ctor directly."),o=arguments[0],i=null,r=new n.default(a,s,l,c)}var u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,i));return u.legacyRenderer=o,u.valid=!0,u._updateUvs(),u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e,r){t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,r||this.baseTexture.resize(t,e),this._updateUvs()},e.create=function(t,r,i,o){return new e(new n.default(t,r,i,o))},e}(i(r("xJsK")).default);e.default=o},eOtv:function(t,e,r){var n=r("lKxJ"),i=r("KFGy"),o=r("cpc2"),a=r("Vo14"),s=r("2Dig"),l=r("QN7Q"),c=r("NOtv")("socket.io-client:manager"),u=r("7jRU"),h=r("C2QD"),d=Object.prototype.hasOwnProperty;function p(t,e){if(!(this instanceof p))return new p(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=e.parser||a;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=p,p.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)d.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},p.prototype.updateSocketIds=function(){for(var t in this.nsps)d.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},p.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},o(p.prototype),p.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},p.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},p.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(t,e){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=s(r,"open",function(){i.onopen(),t&&t()}),a=s(r,"error",function(e){if(c("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var r=new Error("Connection error");r.data=e,t(r)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;c("connect attempt will timeout after %d",l);var u=setTimeout(function(){c("connect attempt timed out after %d",l),o.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(o),this.subs.push(a),this},p.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(s(t,"data",l(this,"ondata"))),this.subs.push(s(t,"ping",l(this,"onping"))),this.subs.push(s(t,"pong",l(this,"onpong"))),this.subs.push(s(t,"error",l(this,"onerror"))),this.subs.push(s(t,"close",l(this,"onclose"))),this.subs.push(s(this.decoder,"decoded",l(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(t){this.decoder.add(t)},p.prototype.ondecoded=function(t){this.emit("packet",t)},p.prototype.onerror=function(t){c("error",t),this.emitAll("error",t)},p.prototype.socket=function(t,e){var r=this.nsps[t];if(!r){r=new i(this,t,e),this.nsps[t]=r;var n=this;r.on("connecting",o),r.on("connect",function(){r.id=n.generateId(t)}),this.autoConnect&&o()}function o(){~u(n.connecting,r)||n.connecting.push(r)}return r},p.prototype.destroy=function(t){var e=u(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},p.prototype.packet=function(t){c("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(r){for(var n=0;n<r.length;n++)e.engine.write(r[n],t.options);e.encoding=!1,e.processPacketQueue()}))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},p.prototype.cleanup=function(){c("cleanup");for(var t=this.subs.length,e=0;e<t;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(t){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();c("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var r=setTimeout(function(){t.skipReconnect||(c("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(c("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(c("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(r)}})}},p.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},"ew+k":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e[n.DRAW_MODES.POINTS]=t.POINTS,e[n.DRAW_MODES.LINES]=t.LINES,e[n.DRAW_MODES.LINE_LOOP]=t.LINE_LOOP,e[n.DRAW_MODES.LINE_STRIP]=t.LINE_STRIP,e[n.DRAW_MODES.TRIANGLES]=t.TRIANGLES,e[n.DRAW_MODES.TRIANGLE_STRIP]=t.TRIANGLE_STRIP,e[n.DRAW_MODES.TRIANGLE_FAN]=t.TRIANGLE_FAN,e};var n=r("pQYt")},fOGm:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("yI/K")),i=function(){function t(e,r,i){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=n.default.GLBuffer.createVertexBuffer(e),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(e),this.dirty=!0,this.nativeLines=!1,this.glPoints=null,this.glIndices=null,this.shader=r,this.vao=new n.default.VertexArrayObject(e,i).addIndex(this.indexBuffer).addAttribute(this.buffer,r.attributes.aVertexPosition,e.FLOAT,!1,24,0).addAttribute(this.buffer,r.attributes.aColor,e.FLOAT,!1,24,8)}return t.prototype.reset=function(){this.points.length=0,this.indices.length=0},t.prototype.upload=function(){this.glPoints=new Float32Array(this.points),this.buffer.upload(this.glPoints),this.glIndices=new Uint16Array(this.indices),this.indexBuffer.upload(this.glIndices),this.dirty=!1},t.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.vao.destroy(),this.buffer.destroy(),this.indexBuffer.destroy(),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null},t}();e.default=i},fS4Z:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN"));r("2U8Y");var o=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=new i.Matrix;r.renderable=!1;var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));return a.maskSprite=r,a.maskMatrix=o,a.uniforms.mapSampler=r._texture,a.uniforms.filterMatrix=o,a.uniforms.scale={x:1,y:1},null!==n&&void 0!==n||(n=20),a.scale=new i.Point(n,n),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y,t.applyFilter(this,e,r)},n(e,[{key:"map",get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t}}]),e}(i.Filter);e.default=o},fsTW:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.maxMilliseconds=e,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}();e.default=n},fvlo:function(t,e,r){"use strict";e.__esModule=!0;var n=r("45ci");Object.defineProperty(e,"InteractionData",{enumerable:!0,get:function(){return l(n).default}});var i=r("leuX");Object.defineProperty(e,"InteractionManager",{enumerable:!0,get:function(){return l(i).default}});var o=r("4miC");Object.defineProperty(e,"interactiveTarget",{enumerable:!0,get:function(){return l(o).default}});var a=r("inOm");Object.defineProperty(e,"InteractionTrackingData",{enumerable:!0,get:function(){return l(a).default}});var s=r("1td8");function l(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"InteractionEvent",{enumerable:!0,get:function(){return l(s).default}})},g57C:function(t,e,r){"use strict";function n(t){var e=document.createElement("canvas");e.width=6,e.height=1;var r=e.getContext("2d");return r.fillStyle=t,r.fillRect(0,0,6,1),e}e.__esModule=!0,e.default=function(){if("undefined"==typeof document)return!1;var t=n("#ff00ff"),e=n("#ffff00"),r=document.createElement("canvas");r.width=6,r.height=1;var i=r.getContext("2d");i.globalCompositeOperation="multiply",i.drawImage(t,0,0),i.drawImage(e,2,0);var o=i.getImageData(2,0,1,1);if(!o)return!1;var a=o.data;return 255===a[0]&&0===a[1]&&0===a[2]}},g5Dd:function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<t.length;n++)r[t.charCodeAt(n)]=n;e.encode=function(e){var r,n=new Uint8Array(e),i=n.length,o="";for(r=0;r<i;r+=3)o+=t[n[r]>>2],o+=t[(3&n[r])<<4|n[r+1]>>4],o+=t[(15&n[r+1])<<2|n[r+2]>>6],o+=t[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},e.decode=function(t){var e,n,i,o,a,s=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var u=new ArrayBuffer(s),h=new Uint8Array(u);for(e=0;e<l;e+=4)n=r[t.charCodeAt(e)],i=r[t.charCodeAt(e+1)],o=r[t.charCodeAt(e+2)],a=r[t.charCodeAt(e+3)],h[c++]=n<<2|i>>4,h[c++]=(15&i)<<4|o>>2,h[c++]=(3&o)<<6|63&a;return u}}()},gFX4:function(t,e,r){var n=r("zJ60"),i=r("Vo14"),o=r("eOtv"),a=r("NOtv")("socket.io-client");t.exports=e=l;var s=e.managers={};function l(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,i=n(t),l=i.source,c=i.id;return e.forceNew||e["force new connection"]||!1===e.multiplex||s[c]&&i.path in s[c].nsps?(a("ignoring socket cache for %s",l),r=o(l,e)):(s[c]||(a("new io instance for %s",l),s[c]=o(l,e)),r=s[c]),i.query&&!e.query&&(e.query=i.query),r.socket(i.path,e)}e.protocol=i.protocol,e.connect=l,e.Manager=r("eOtv"),e.Socket=r("KFGy")},gl4O:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("d07J"),o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.position=new i.ObservablePoint(r.onChange,r,0,0),r.scale=new i.ObservablePoint(r.onChange,r,1,1),r.pivot=new i.ObservablePoint(r.onChange,r,0,0),r.skew=new i.ObservablePoint(r.updateSkew,r,0,0),r._rotation=0,r._cx=1,r._sx=0,r._cy=0,r._sy=1,r._localID=0,r._currentLocalID=0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onChange=function(){this._localID++},e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},e.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale._x,t.b=this._sx*this.scale._x,t.c=this._cy*this.scale._y,t.d=this._sy*this.scale._y,t.tx=this.position._x-(this.pivot._x*t.a+this.pivot._y*t.c),t.ty=this.position._y-(this.pivot._x*t.b+this.pivot._y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},e.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale._x,e.b=this._sx*this.scale._x,e.c=this._cy*this.scale._y,e.d=this._sy*this.scale._y,e.tx=this.position._x-(this.pivot._x*e.a+this.pivot._y*e.c),e.ty=this.position._y-(this.pivot._x*e.b+this.pivot._y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},e.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},n(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("KByU")).default);e.default=o},h4Yq:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=function(t){return t&&t.__esModule?t:{default:t}}(r("/UP7")),a=new i.Point,s=function(t){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return a.tileTransform=new i.TransformStatic,a._width=n,a._height=o,a._canvasPattern=null,a.uvTransform=r.transform||new i.TextureMatrix(r),a.pluginName="tilingSprite",a.uvRespectAnchor=!1,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._onTextureUpdate=function(){this.uvTransform&&(this.uvTransform.texture=this._texture),this.cachedTint=16777215},e.prototype._renderWebGL=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.hasLoaded){var r=t.context,n=this.worldTransform,a=t.resolution,s=e.baseTexture,l=s.resolution,c=this.tilePosition.x/this.tileScale.x%e._frame.width*l,u=this.tilePosition.y/this.tileScale.y%e._frame.height*l;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var h=new i.CanvasRenderTarget(e._frame.width,e._frame.height,l);16777215!==this.tint?(this.tintedTexture=o.default.getTintedTexture(this,this.tint),h.context.drawImage(this.tintedTexture,0,0)):h.context.drawImage(s.source,-e._frame.x*l,-e._frame.y*l),this.cachedTint=this.tint,this._canvasPattern=h.context.createPattern(h.canvas,"repeat")}r.globalAlpha=this.worldAlpha,r.setTransform(n.a*a,n.b*a,n.c*a,n.d*a,n.tx*a,n.ty*a),t.setBlendMode(this.blendMode),r.fillStyle=this._canvasPattern,r.scale(this.tileScale.x/l,this.tileScale.y/l);var d=this.anchor.x*-this._width,p=this.anchor.y*-this._height;this.uvRespectAnchor?(r.translate(c,u),r.fillRect(-c+d,-u+p,this._width/this.tileScale.x*l,this._height/this.tileScale.y*l)):(r.translate(c+d,u+p),r.fillRect(-c,-u,this._width/this.tileScale.x*l,this._height/this.tileScale.y*l))}},e.prototype._calculateBounds=function(){this._bounds.addFrame(this.transform,this._width*-this._anchor._x,this._height*-this._anchor._y,this._width*(1-this._anchor._x),this._height*(1-this._anchor._y))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._x),e||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,a);var e=this._width,r=this._height,n=-e*this.anchor._x;if(a.x>=n&&a.x<n+e){var i=-r*this.anchor._y;if(a.y>=i&&a.y<i+r)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvTransform=null},e.from=function(t,r,n){return new e(i.Texture.from(t),r,n)},e.fromFrame=function(t,r,n){var o=i.utils.TextureCache[t];if(!o)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new e(o,r,n)},e.fromImage=function(t,r,n,o,a){return new e(i.Texture.fromImage(t,o,a),r,n)},n(e,[{key:"clampMargin",get:function(){return this.uvTransform.clampMargin},set:function(t){this.uvTransform.clampMargin=t,this.uvTransform.update(!0)}},{key:"tileScale",get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copy(t)}},{key:"tilePosition",get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copy(t)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t}}]),e}(i.Sprite);e.default=s},"hN+0":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,i.default)()?(t[n.BLEND_MODES.NORMAL]="source-over",t[n.BLEND_MODES.ADD]="lighter",t[n.BLEND_MODES.MULTIPLY]="multiply",t[n.BLEND_MODES.SCREEN]="screen",t[n.BLEND_MODES.OVERLAY]="overlay",t[n.BLEND_MODES.DARKEN]="darken",t[n.BLEND_MODES.LIGHTEN]="lighten",t[n.BLEND_MODES.COLOR_DODGE]="color-dodge",t[n.BLEND_MODES.COLOR_BURN]="color-burn",t[n.BLEND_MODES.HARD_LIGHT]="hard-light",t[n.BLEND_MODES.SOFT_LIGHT]="soft-light",t[n.BLEND_MODES.DIFFERENCE]="difference",t[n.BLEND_MODES.EXCLUSION]="exclusion",t[n.BLEND_MODES.HUE]="hue",t[n.BLEND_MODES.SATURATION]="saturate",t[n.BLEND_MODES.COLOR]="color",t[n.BLEND_MODES.LUMINOSITY]="luminosity"):(t[n.BLEND_MODES.NORMAL]="source-over",t[n.BLEND_MODES.ADD]="lighter",t[n.BLEND_MODES.MULTIPLY]="source-over",t[n.BLEND_MODES.SCREEN]="source-over",t[n.BLEND_MODES.OVERLAY]="source-over",t[n.BLEND_MODES.DARKEN]="source-over",t[n.BLEND_MODES.LIGHTEN]="source-over",t[n.BLEND_MODES.COLOR_DODGE]="source-over",t[n.BLEND_MODES.COLOR_BURN]="source-over",t[n.BLEND_MODES.HARD_LIGHT]="source-over",t[n.BLEND_MODES.SOFT_LIGHT]="source-over",t[n.BLEND_MODES.DIFFERENCE]="source-over",t[n.BLEND_MODES.EXCLUSION]="source-over",t[n.BLEND_MODES.HUE]="source-over",t[n.BLEND_MODES.SATURATION]="source-over",t[n.BLEND_MODES.COLOR]="source-over",t[n.BLEND_MODES.LUMINOSITY]="source-over"),t[n.BLEND_MODES.NORMAL_NPM]=t[n.BLEND_MODES.NORMAL],t[n.BLEND_MODES.ADD_NPM]=t[n.BLEND_MODES.ADD],t[n.BLEND_MODES.SCREEN_NPM]=t[n.BLEND_MODES.SCREEN],t};var n=r("pQYt"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("g57C"))},he9Y:function(t,e,r){"use strict";e.__esModule=!0;var n=a(r("Wr15")),i=r("d07J"),o=(r("2U8Y"),a(r("4fju")));function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=new i.Matrix,o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));return r.renderable=!1,o.maskSprite=r,o.maskMatrix=n,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r){var n=this.maskSprite,i=this.maskSprite.texture;i.valid&&(i.transform||(i.transform=new o.default(i,0)),i.transform.update(),this.uniforms.mask=i,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(i.transform.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=i.transform.uClampFrame,t.applyFilter(this,e,r))},e}(n.default);e.default=s},hy2w:function(t,e){var r=function(t){return function(){return this.data[t].value}},n={float:function(t,e,r){t.uniform1f(e,r)},vec2:function(t,e,r){t.uniform2f(e,r[0],r[1])},vec3:function(t,e,r){t.uniform3f(e,r[0],r[1],r[2])},vec4:function(t,e,r){t.uniform4f(e,r[0],r[1],r[2],r[3])},int:function(t,e,r){t.uniform1i(e,r)},ivec2:function(t,e,r){t.uniform2i(e,r[0],r[1])},ivec3:function(t,e,r){t.uniform3i(e,r[0],r[1],r[2])},ivec4:function(t,e,r){t.uniform4i(e,r[0],r[1],r[2],r[3])},bool:function(t,e,r){t.uniform1i(e,r)},bvec2:function(t,e,r){t.uniform2i(e,r[0],r[1])},bvec3:function(t,e,r){t.uniform3i(e,r[0],r[1],r[2])},bvec4:function(t,e,r){t.uniform4i(e,r[0],r[1],r[2],r[3])},mat2:function(t,e,r){t.uniformMatrix2fv(e,!1,r)},mat3:function(t,e,r){t.uniformMatrix3fv(e,!1,r)},mat4:function(t,e,r){t.uniformMatrix4fv(e,!1,r)},sampler2D:function(t,e,r){t.uniform1i(e,r)}},i={float:function(t,e,r){t.uniform1fv(e,r)},vec2:function(t,e,r){t.uniform2fv(e,r)},vec3:function(t,e,r){t.uniform3fv(e,r)},vec4:function(t,e,r){t.uniform4fv(e,r)},int:function(t,e,r){t.uniform1iv(e,r)},ivec2:function(t,e,r){t.uniform2iv(e,r)},ivec3:function(t,e,r){t.uniform3iv(e,r)},ivec4:function(t,e,r){t.uniform4iv(e,r)},bool:function(t,e,r){t.uniform1iv(e,r)},bvec2:function(t,e,r){t.uniform2iv(e,r)},bvec3:function(t,e,r){t.uniform3iv(e,r)},bvec4:function(t,e,r){t.uniform4iv(e,r)},sampler2D:function(t,e,r){t.uniform1iv(e,r)}};function o(t,e){return function(r){this.data[t].value=r;var o=this.data[t].location;1===e.size?n[e.type](this.gl,o,r):i[e.type](this.gl,o,r)}}function a(t,e){for(var r=e,n=0;n<t.length-1;n++){var i=r[t[n]]||{data:{}};r[t[n]]=i,r=i}return r}t.exports=function(t,e){var n={data:{}};n.gl=t;for(var i=Object.keys(e),s=0;s<i.length;s++){var l=i[s],c=l.split("."),u=c[c.length-1],h=a(c,n),d=e[l];h.data[u]=d,h.gl=t,Object.defineProperty(h,u,{get:r(u),set:o(u,d)})}return n}},iEUh:function(t,e,r){"use strict";e.__esModule=!0;var n=r("pQYt"),i=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r,this.width=i,this.height=o,this.radius=a,this.type=n.SHAPES.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var r=t-(this.x+this.radius),n=e-(this.y+this.radius),i=this.radius*this.radius;if(r*r+n*n<=i)return!0;if((r=t-(this.x+this.width-this.radius))*r+n*n<=i)return!0;if(r*r+(n=e-(this.y+this.height-this.radius))*n<=i)return!0;if((r=t-(this.x+this.radius))*r+n*n<=i)return!0}return!1},t}();e.default=i},inOm:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},n(t,[{key:"pointerId",get:function(){return this._pointerId}},{key:"flags",get:function(){return this._flags},set:function(t){this._flags=t}},{key:"none",get:function(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},set:function(t){this._doSet(this.constructor.FLAGS.OVER,t)}},{key:"rightDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)}},{key:"leftDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)}}]),t}();e.default=i,i.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4})},jE0j:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r,n,i,o,a,s){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],c=0,u=0,h=0,d=0,p=0;l.push(t,e);for(var f=1,m=0;f<=20;++f)l.push((h=(u=(c=1-(m=f/20))*c)*c)*t+3*u*m*r+3*c*(d=m*m)*i+(p=d*m)*a,h*e+3*u*m*n+3*c*d*o+p*s);return l}},jK9F:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN"));r("2U8Y");var o=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));return n.alpha=r,n.glShaderKey="alpha",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t}}]),e}(i.Filter);e.default=o},jQCb:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("d07J"),o=r("qp2T"),a=r("pQYt"),s=c(r("xJsK")),l=c(r("a/Ns"));function c(t){return t&&t.__esModule?t:{default:t}}var u=new i.Point,h=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n._anchor=new i.ObservablePoint(n._onAnchorUpdate,n),n._texture=null,n._width=0,n._height=0,n._tint=null,n._tintRGB=null,n.tint=16777215,n.blendMode=a.BLEND_MODES.NORMAL,n.shader=null,n.cachedTint=16777215,n.texture=r||s.default.EMPTY,n.vertexData=new Float32Array(8),n.vertexTrimmedData=null,n._transformID=-1,n._textureID=-1,n._transformTrimmedID=-1,n._textureTrimmedID=-1,n.pluginName="sprite",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this.cachedTint=16777215,this._width&&(this.scale.x=(0,o.sign)(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=(0,o.sign)(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID,this._textureID=this._texture._updateID;var t=this._texture,e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,o=e.d,a=e.tx,s=e.ty,l=this.vertexData,c=t.trim,u=t.orig,h=this._anchor,d=0,p=0,f=0,m=0;c?(d=(p=c.x-h._x*u.width)+c.width,f=(m=c.y-h._y*u.height)+c.height):(d=(p=-h._x*u.width)+u.width,f=(m=-h._y*u.height)+u.height),l[0]=r*p+i*m+a,l[1]=o*m+n*p+s,l[2]=r*d+i*m+a,l[3]=o*m+n*d+s,l[4]=r*d+i*f+a,l[5]=o*f+n*d+s,l[6]=r*p+i*f+a,l[7]=o*f+n*p+s}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this.vertexTrimmedData,e=this._texture.orig,r=this._anchor,n=this.transform.worldTransform,i=n.a,o=n.b,a=n.c,s=n.d,l=n.tx,c=n.ty,u=-r._x*e.width,h=u+e.width,d=-r._y*e.height,p=d+e.height;t[0]=i*u+a*d+l,t[1]=s*d+o*u+c,t[2]=i*h+a*d+l,t[3]=s*d+o*h+c,t[4]=i*h+a*p+l,t[5]=s*p+o*h+c,t[6]=i*u+a*p+l,t[7]=s*p+o*u+c},e.prototype._renderWebGL=function(t){this.calculateVertices(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._renderCanvas=function(t){t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,u);var e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x,i=0;return u.x>=n&&u.x<n+e&&u.y>=(i=-r*this.anchor.y)&&u.y<i+r},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this._anchor=null,("boolean"==typeof e?e:e&&e.texture)&&this._texture.destroy(!!("boolean"==typeof e?e:e&&e.baseTexture)),this._texture=null,this.shader=null},e.from=function(t){return new e(s.default.from(t))},e.fromFrame=function(t){var r=o.TextureCache[t];if(!r)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return new e(r)},e.fromImage=function(t,r,n){return new e(s.default.fromImage(t,r,n))},n(e,[{key:"width",get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=(0,o.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=(0,o.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"anchor",get:function(){return this._anchor},set:function(t){this._anchor.copy(t)}},{key:"tint",get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this.cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}]),e}(l.default);e.default=h},kSER:function(t,e){t.exports=function(t,e){for(var r=[],n=(e=e||0)||0;n<t.length;n++)r[n-e]=t[n];return r}},kSzJ:function(t,e,r){"use strict";e.__esModule=!0,e.loader=e.prepare=e.particles=e.mesh=e.loaders=e.interaction=e.filters=e.extras=e.extract=e.accessibility=void 0;var n=r("3Ym4");Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var i=r("3AcN");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=function(t){return t&&t.__esModule?t:{default:t}}(r("mTg2")),a=m(r("Yiwd")),s=m(r("5ekA")),l=m(r("Y12R")),c=m(r("y/pH")),u=m(r("fvlo")),h=m(r("qllB")),d=m(r("Dn+6")),p=m(r("3Gzo")),f=m(r("M6Jp"));function m(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}i.utils.mixins.performMixins();var v=h.shared||null;e.accessibility=a,e.extract=s,e.extras=l,e.filters=c,e.interaction=u,e.loaders=h,e.mesh=d,e.particles=p,e.prepare=f,e.loader=v,"function"==typeof o.default&&(0,o.default)(e),global.PIXI=e},koBt:function(t,e){var r=null,n={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};t.exports=function(t,e){if(!r){var i=Object.keys(n);r={};for(var o=0;o<i.length;++o){var a=i[o];r[t[a]]=n[a]}}return r[e]}},l0yf:function(t,e,r){t.exports={compileProgram:r("Cxr2"),defaultValue:r("rI9z"),extractAttributes:r("7AYe"),extractUniforms:r("984s"),generateUniformAccessObject:r("hy2w"),setPrecision:r("0DWY"),mapSize:r("ujOt"),mapType:r("koBt")}},l8vz:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("yI/K")),i=o(r("TyRm"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e,r,n,i){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var o=0;o<r.length;++o){var a=r[o];a={attribute:a.attribute,size:a.size,uploadFunction:a.uploadFunction,unsignedByte:a.unsignedByte,offset:a.offset},n[o]?this.dynamicProperties.push(a):this.staticProperties.push(a)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.gl,e=0;this.indices=(0,i.default)(this.size),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var o=this.dynamicProperties[r];o.offset=e,e+=o.size,this.dynamicStride+=o.size}var a=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(a),this.dynamicDataUint32=new Uint32Array(a),this.dynamicBuffer=n.default.GLBuffer.createVertexBuffer(t,a,t.STREAM_DRAW);var s=0;this.staticStride=0;for(var l=0;l<this.staticProperties.length;++l){var c=this.staticProperties[l];c.offset=s,s+=c.size,this.staticStride+=c.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=n.default.GLBuffer.createVertexBuffer(t,u,t.STATIC_DRAW),this.vao=new n.default.VertexArrayObject(t).addIndex(this.indexBuffer);for(var h=0;h<this.dynamicProperties.length;++h){var d=this.dynamicProperties[h];d.unsignedByte?this.vao.addAttribute(this.dynamicBuffer,d.attribute,t.UNSIGNED_BYTE,!0,4*this.dynamicStride,4*d.offset):this.vao.addAttribute(this.dynamicBuffer,d.attribute,t.FLOAT,!1,4*this.dynamicStride,4*d.offset)}for(var p=0;p<this.staticProperties.length;++p){var f=this.staticProperties[p];f.unsignedByte?this.vao.addAttribute(this.staticBuffer,f.attribute,t.UNSIGNED_BYTE,!0,4*this.staticStride,4*f.offset):this.vao.addAttribute(this.staticBuffer,f.attribute,t.FLOAT,!1,4*this.staticStride,4*f.offset)}},t.prototype.uploadDynamic=function(t,e,r){for(var n=0;n<this.dynamicProperties.length;n++){var i=this.dynamicProperties[n];i.uploadFunction(t,e,r,i.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer.upload()},t.prototype.uploadStatic=function(t,e,r){for(var n=0;n<this.staticProperties.length;n++){var i=this.staticProperties[n];i.uploadFunction(t,e,r,i.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer.upload()},t.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicBuffer.destroy(),this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer.destroy(),this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null},t}();e.default=a},lKxJ:function(t,e,r){t.exports=r("2pII"),t.exports.parser=r("Wm4p")},lYZj:function(t,e,r){"use strict";var n=r(null),i=r(null);r(null);class o{constructor(t,e=Number.POSITIVE_INFINITY){this.subscribedFrame=t,this.unsubscribedFrame=e}}class a extends n.a{constructor(t,e){this.messages=t,this.subscriptions=[],this.scheduler=e}scheduleMessages(t){const e=this.messages.length;for(let r=0;r<e;r++);}}var s=r(null);class l extends s.a{constructor(t,e){this.messages=t,this.subscriptions=[],this.scheduler=e}_subscribe(t){return super._subscribe(t)}setup(){const t=this.messages.length;for(var e=0;e<t;e++);}}var c=r(null),u=r(null);class h extends u.a{constructor(t=d,e=Number.POSITIVE_INFINITY){this.maxFrames=e,this.frame=0,this.index=-1}flush(){const{actions:t,maxFrames:e}=this;let r,n;for(;(n=t.shift())&&(this.frame=n.delay)<=e&&!(r=n.execute(n.state,n.delay)););if(r){for(;n=t.shift(););throw r}}}h.frameTimeFactor=10;class d extends c.a{constructor(t,e,r=(t.index+=1)){this.scheduler=t,this.work=e,this.index=r,this.active=!0,this.index=t.index=r}schedule(t,e=0){return this.id?(this.active=!1,new d(this.scheduler,this.work).schedule(t,e)):super.schedule(t,e)}requestAsyncId(t,e,r=0){this.delay=t.frame+r;const{actions:n}=t;return!0}recycleAsyncId(t,e,r=0){}_execute(t,e){if(!0===this.active)return super._execute(t,e)}static sortActions(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1}}class p extends h{constructor(t){this.assertDeepEqual=t,this.hotObservables=[],this.coldObservables=[],this.flushTests=[],this.runMode=!1}createTime(t){const e=t.indexOf("|");if(-1===e)throw new Error('marble diagram for time should have a completion marker "|"');return e*p.frameTimeFactor}createColdObservable(t,e,r){if(-1!==t.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==t.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');return new a(p.parseMarbles(t,e,r,void 0,this.runMode),this)}createHotObservable(t,e,r){if(-1!==t.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');return new l(p.parseMarbles(t,e,r,void 0,this.runMode),this)}materializeInnerObservable(t,e){return[]}expectObservable(t,e=null){const r={actual:[],ready:!1};Number;const{runMode:n}=this;return{toBe(t,e,i){r.ready=!0,r.expected=p.parseMarbles(t,e,i,!0,n)}}}expectSubscriptions(t){const e={actual:t,ready:!1},{runMode:r}=this;return{toBe(t){const n="string"==typeof t?[t]:t;e.ready=!0,e.expected=n.map(t=>p.parseMarblesAsSubscriptions(t,r))}}}flush(){const t=this.hotObservables;for(;t.length>0;);const{flushTests:e}=this;for(let r=0,n=e.length;r<n;r++);}static parseMarblesAsSubscriptions(t,e=!1){if("string"!=typeof t)return new o(Number.POSITIVE_INFINITY);const r=t.length;let n=-1,i=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=0;for(let o=0;o<r;o++){let r=s;const l=t[o];switch(l){case" ":case"-":break;case"(":n=s;break;case")":n=-1;break;case"^":if(i!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");i=n>-1?n:s;break;case"!":if(a!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");a=n>-1?n:s;break;default:if(e&&l.match(/^[0-9]$/)&&(0===o||" "===t[o-1])){const e=t.slice(o).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(e){o+=e[0].length-1;const t=parseFloat(e[1]);let r;switch(e[2]){case"ms":r=t;break;case"s":r=1e3*t;break;case"m":r=1e3*t*60}break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+l+"'.")}s=r}return a<0?new o(i):new o(i,a)}static parseMarbles(t,e,r,n=!1,o=!1){if(-1!==t.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');const s=t.length,l=o?t.replace(/^[ ]+/,"").indexOf("^"):t.indexOf("^");let c=-1===l?0:l*-this.frameTimeFactor;const u="object"!=typeof e?t=>t:t=>n&&e[t]instanceof a?e[t].messages:e[t];let h=-1;for(let a=0;a<s;a++){let e,n=c;const s=t[a];switch(s){case" ":case"-":break;case"(":h=c;break;case")":h=-1;break;case"|":e=i.a.createComplete();break;case"^":break;case"#":e=i.a.createError(r||"error");break;default:if(o&&s.match(/^[0-9]$/)&&(0===a||" "===t[a-1])){const e=t.slice(a).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(e){a+=e[0].length-1;const t=parseFloat(e[1]);let r;switch(e[2]){case"ms":r=t;break;case"s":r=1e3*t;break;case"m":r=1e3*t*60}break}}e=i.a.createNext(u(s))}c=n}return[]}run(t){const e=p.frameTimeFactor,r=this.maxFrames;p.frameTimeFactor=1,this.maxFrames=Number.POSITIVE_INFINITY,this.runMode=!0,u.a.delegate=this;const n=t({cold:this.createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this)});return p.frameTimeFactor=e,this.maxFrames=r,this.runMode=!1,u.a.delegate=void 0,n}}r.d(e,"TestScheduler",function(){return p})},laIk:function(t,e,r){"use strict";r.r(e);var n=r(null);r.d(e,"ajax",function(){return n.a}),r(null),r.d(e,"AjaxResponse",function(){return _internal_observable_dom_AjaxObservable__WEBPACK_IMPORTED_MODULE_1__false}),r.d(e,"AjaxError",function(){return _internal_observable_dom_AjaxObservable__WEBPACK_IMPORTED_MODULE_1__false}),r.d(e,"AjaxTimeoutError",function(){return _internal_observable_dom_AjaxObservable__WEBPACK_IMPORTED_MODULE_1__false})},leuX:function(t,e,r){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=u(r("45ci")),a=u(r("1td8")),s=u(r("inOm")),l=u(r("uhBA")),c=u(r("4miC"));function u(t){return t&&t.__esModule?t:{default:t}}i.utils.mixins.delayMixin(i.DisplayObject.prototype,c.default);var h=1,d={target:null,data:{global:null}},p=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n=n||{},s.renderer=r,s.autoPreventDefault=void 0===n.autoPreventDefault||n.autoPreventDefault,s.interactionFrequency=n.interactionFrequency||10,s.mouse=new o.default,s.mouse.identifier=h,s.mouse.global.set(-999999),s.activeInteractionData={},s.activeInteractionData[h]=s.mouse,s.interactionDataPool=[],s.eventData=new a.default,s.interactionDOMElement=null,s.moveWhenInside=!1,s.eventsAdded=!1,s.mouseOverRenderer=!1,s.supportsTouchEvents="ontouchstart"in window,s.supportsPointerEvents=!!window.PointerEvent,s.onPointerUp=s.onPointerUp.bind(s),s.processPointerUp=s.processPointerUp.bind(s),s.onPointerCancel=s.onPointerCancel.bind(s),s.processPointerCancel=s.processPointerCancel.bind(s),s.onPointerDown=s.onPointerDown.bind(s),s.processPointerDown=s.processPointerDown.bind(s),s.onPointerMove=s.onPointerMove.bind(s),s.processPointerMove=s.processPointerMove.bind(s),s.onPointerOut=s.onPointerOut.bind(s),s.processPointerOverOut=s.processPointerOverOut.bind(s),s.onPointerOver=s.onPointerOver.bind(s),s.cursorStyles={default:"inherit",pointer:"pointer"},s.currentCursorMode=null,s.cursor=null,s._tempPoint=new i.Point,s.resolution=1,s.setTargetElement(s.renderer.view,s.renderer.resolution),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.hitTest=function(t,e){return d.target=null,d.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(d,e,null,!0),d.target},e.prototype.setTargetElement=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents()},e.prototype.addEvents=function(){this.interactionDOMElement&&(i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},e.prototype.removeEvents=function(){this.interactionDOMElement&&(i.ticker.shared.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},e.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var e in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var r=this.activeInteractionData[e];if(r.originalEvent&&"touch"!==r.pointerType){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(this.currentCursorMode!==(t=t||"default")){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(void 0===e?"undefined":n(e)){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,r){r.stopped||(r.currentTarget=t,r.type=e,t.emit(e,r),t[e]&&t[e](r))},e.prototype.mapPositionToPoint=function(t,e,r){var n;n=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=navigator.isCocoonJS?this.resolution:1/this.resolution;t.x=this.interactionDOMElement.width/n.width*(e-n.left)*i,t.y=this.interactionDOMElement.height/n.height*(r-n.top)*i},e.prototype.processInteractive=function(t,e,r,n,i){if(!e||!e.visible)return!1;var o=t.data.global,a=!1,s=i=e.interactive||i,l=!0;if(e.hitArea?(n&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(n=!1,l=!1)),s=!1):e._mask&&n&&(e._mask.containsPoint(o)||(n=!1,l=!1)),l&&e.interactiveChildren&&e.children)for(var c=e.children,u=c.length-1;u>=0;u--){var h=c[u],d=this.processInteractive(t,h,r,n,s);if(d){if(!h.parent)continue;s=!1,d&&(t.target&&(n=!1),a=!0)}}return i&&(n&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),r&&r(t,e,!!a))),a},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&t.preventDefault();for(var r=e.length,n=0;n<r;n++){var i=e[n],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",a),"touch"===i.pointerType?this.emit("touchstart",a):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit(2===i.button?"rightdown":"mousedown",this.eventData)}}},e.prototype.processPointerDown=function(t,e,r){var n=t.data,i=t.data.identifier;if(r)if(e.trackedPointers[i]||(e.trackedPointers[i]=new s.default(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===n.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===n.pointerType||"pen"===n.pointerType){var o=2===n.button;o?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,r){for(var n=this.normalizeToPointerData(t),i=n.length,o=t.target!==this.interactionDOMElement?"outside":"",a=0;a<i;a++){var s=n[a],l=this.getInteractionDataForPointerId(s),c=this.configureInteractionEventForDOMEvent(this.eventData,s,l);c.data.originalEvent=t,this.processInteractive(c,this.renderer._lastObjectRendered,r,e||!o),this.emit(e?"pointercancel":"pointerup"+o,c),"mouse"===s.pointerType||"pen"===s.pointerType?this.emit(2===s.button?"rightup"+o:"mouseup"+o,c):"touch"===s.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,c),this.releaseInteractionDataForPointerId(s.pointerId,l))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var r=t.data,n=t.data.identifier;void 0!==e.trackedPointers[n]&&(delete e.trackedPointers[n],this.dispatchEvent(e,"pointercancel",t),"touch"===r.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,r){var n=t.data,i=t.data.identifier,o=e.trackedPointers[i],a="touch"===n.pointerType;if("mouse"===n.pointerType||"pen"===n.pointerType){var l=2===n.button,c=s.default.FLAGS,u=void 0!==o&&o.flags&(l?c.RIGHT_DOWN:c.LEFT_DOWN);r?(this.dispatchEvent(e,l?"rightup":"mouseup",t),u&&this.dispatchEvent(e,l?"rightclick":"click",t)):u&&this.dispatchEvent(e,l?"rightupoutside":"mouseupoutside",t),o&&(l?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(e,"pointerup",t),a&&this.dispatchEvent(e,"touchend",t),o&&(this.dispatchEvent(e,"pointertap",t),a&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),a&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[i]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var r=e.length,n=0;n<r;n++){var i=e[n],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerMove,"touch"!==i.pointerType||this.moveWhenInside),this.emit("pointermove",a),"touch"===i.pointerType&&this.emit("touchmove",a),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",a)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,r){var n=t.data,i="touch"===n.pointerType,o="mouse"===n.pointerType||"pen"===n.pointerType;o&&this.processPointerOverOut(t,e,r),this.moveWhenInside&&!r||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,r);n.data.originalEvent=e,this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",n),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",n):this.releaseInteractionDataForPointerId(r.identifier)}},e.prototype.processPointerOverOut=function(t,e,r){var n=t.data,i=t.data.identifier,o="mouse"===n.pointerType||"pen"===n.pointerType,a=e.trackedPointers[i];r&&!a&&(a=e.trackedPointers[i]=new s.default(i)),void 0!==a&&(r&&this.mouseOverRenderer?(a.over||(a.over=!0,this.dispatchEvent(e,"pointerover",t),o&&this.dispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):a.over&&(a.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),a.none&&delete e.trackedPointers[i]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],r=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,r);n.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",n),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",n)},e.prototype.getInteractionDataForPointerId=function(t){var e=t.pointerId,r=void 0;return e===h||"mouse"===t.pointerType?r=this.mouse:this.activeInteractionData[e]?r=this.activeInteractionData[e]:((r=this.interactionDataPool.pop()||new o.default).identifier=e,this.activeInteractionData[e]=r),r.copyEvent(t),r},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,r){return t.data=r,this.mapPositionToPoint(r.global,e.clientX,e.clientY),navigator.isCocoonJS&&"touch"===e.pointerType&&(r.global.x=r.global.x/this.resolution,r.global.y=r.global.y/this.resolution),"touch"===e.pointerType&&(e.globalX=r.global.x,e.globalY=r.global.y),r.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var r=0,n=t.changedTouches.length;r<n;r++){var i=t.changedTouches[r];void 0===i.button&&(i.button=t.touches.length?1:0),void 0===i.buttons&&(i.buttons=t.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),i.twist=0,i.tangentialPressure=0,void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=h),void 0===t.pressure&&(t.pressure=.5),t.twist=0,t.tangentialPressure=0,t.isNormalized=!0,e.push(t));return e},e.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},e}(l.default);e.default=p,i.WebGLRenderer.registerPlugin("interaction",p),i.CanvasRenderer.registerPlugin("interaction",p)},lsi7:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e[n.BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.ADD]=[t.ONE,t.DST_ALPHA],e[n.BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR],e[n.BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.ADD_NPM]=[t.SRC_ALPHA,t.DST_ALPHA,t.ONE,t.DST_ALPHA],e[n.BLEND_MODES.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_COLOR],e};var n=r("pQYt")},lv48:function(t,e,r){function n(t){var r;function n(){if(n.enabled){var t=n,i=+new Date;t.diff=i-(r||i),t.prev=r,t.curr=i,r=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;s++;var i=e.formatters[n];return"function"==typeof i&&(r=i.call(t,o[s]),o.splice(s,1),s--),r}),e.formatArgs.call(t,o),(n.log||e.log||console.log.bind(console)).apply(t,o)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var r,n=0;for(r in t)n=(n<<5)-n+t.charCodeAt(r),n|=0;return e.colors[Math.abs(n)%e.colors.length]}(t),n.destroy=i,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var r;e.save(t),e.names=[],e.skips=[];var n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(t=n[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(r=0;r<e.instances.length;r++){var o=e.instances[r];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var r,n;for(r=0,n=e.skips.length;r<n;r++)if(e.skips[r].test(t))return!1;for(r=0,n=e.names.length;r<n;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=r("FGiv"),e.instances=[],e.names=[],e.skips=[],e.formatters={}},mTg2:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=t.mesh,r=t.particles,n=t.extras,o=t.filters,a=t.prepare,s=t.loaders,l=t.interaction;Object.defineProperties(t,{SpriteBatch:{get:function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")}},AssetLoader:{get:function(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.")}},Stage:{get:function(){return i("You do not need to use a PIXI Stage any more, you can simply render any container."),t.Container}},DisplayObjectContainer:{get:function(){return i("DisplayObjectContainer has been shortened to Container, please use Container from now on."),t.Container}},Strip:{get:function(){return i("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),e.Mesh}},Rope:{get:function(){return i("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),e.Rope}},ParticleContainer:{get:function(){return i("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."),r.ParticleContainer}},MovieClip:{get:function(){return i("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."),n.AnimatedSprite}},TilingSprite:{get:function(){return i("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),n.TilingSprite}},BitmapText:{get:function(){return i("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),n.BitmapText}},blendModes:{get:function(){return i("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),t.BLEND_MODES}},scaleModes:{get:function(){return i("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),t.SCALE_MODES}},BaseTextureCache:{get:function(){return i("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),t.utils.BaseTextureCache}},TextureCache:{get:function(){return i("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),t.utils.TextureCache}},math:{get:function(){return i("The math namespace is deprecated, please access members already accessible on PIXI."),t}},AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),t.Filter}},TransformManual:{get:function(){return i("TransformManual has been renamed to TransformBase, please update your pixi-spine"),t.TransformBase}},TARGET_FPMS:{get:function(){return i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),t.settings.TARGET_FPMS},set:function(e){i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),t.settings.TARGET_FPMS=e}},FILTER_RESOLUTION:{get:function(){return i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),t.settings.FILTER_RESOLUTION},set:function(e){i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),t.settings.FILTER_RESOLUTION=e}},RESOLUTION:{get:function(){return i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),t.settings.RESOLUTION},set:function(e){i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),t.settings.RESOLUTION=e}},MIPMAP_TEXTURES:{get:function(){return i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),t.settings.MIPMAP_TEXTURES},set:function(e){i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),t.settings.MIPMAP_TEXTURES=e}},SPRITE_BATCH_SIZE:{get:function(){return i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),t.settings.SPRITE_BATCH_SIZE},set:function(e){i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),t.settings.SPRITE_BATCH_SIZE=e}},SPRITE_MAX_TEXTURES:{get:function(){return i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),t.settings.SPRITE_MAX_TEXTURES},set:function(e){i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),t.settings.SPRITE_MAX_TEXTURES=e}},RETINA_PREFIX:{get:function(){return i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),t.settings.RETINA_PREFIX},set:function(e){i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),t.settings.RETINA_PREFIX=e}},DEFAULT_RENDER_OPTIONS:{get:function(){return i("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"),t.settings.RENDER_OPTIONS}}});for(var c=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}],u=function(e){var r=c[e];Object.defineProperty(t[r.parent],"DEFAULT",{get:function(){return i("PIXI."+r.parent+".DEFAULT has been deprecated, please use PIXI.settings."+r.target),t.settings[r.target]},set:function(e){i("PIXI."+r.parent+".DEFAULT has been deprecated, please use PIXI.settings."+r.target),t.settings[r.target]=e}})},h=0;h<c.length;h++)u(h);Object.defineProperties(t.settings,{PRECISION:{get:function(){return i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),t.settings.PRECISION_FRAGMENT},set:function(e){i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),t.settings.PRECISION_FRAGMENT=e}}}),n.AnimatedSprite&&Object.defineProperties(n,{MovieClip:{get:function(){return i("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."),n.AnimatedSprite}}}),n&&Object.defineProperties(n,{TextureTransform:{get:function(){return i("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."),t.TextureMatrix}}}),t.DisplayObject.prototype.generateTexture=function(t,e,r){return i("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"),t.generateTexture(this,e,r)},t.Graphics.prototype.generateTexture=function(t,e){return i("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"),this.generateCanvasTexture(t,e)},t.GroupD8.isSwapWidthHeight=function(e){return i("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"),t.GroupD8.isVertical(e)},t.RenderTexture.prototype.render=function(t,e,r,n){this.legacyRenderer.render(t,this,r,e,!n),i("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")},t.RenderTexture.prototype.getImage=function(t){return i("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"),this.legacyRenderer.extract.image(t)},t.RenderTexture.prototype.getBase64=function(t){return i("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"),this.legacyRenderer.extract.base64(t)},t.RenderTexture.prototype.getCanvas=function(t){return i("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"),this.legacyRenderer.extract.canvas(t)},t.RenderTexture.prototype.getPixels=function(t){return i("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"),this.legacyRenderer.pixels(t)},t.Sprite.prototype.setTexture=function(t){this.texture=t,i("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},n.BitmapText&&(n.BitmapText.prototype.setText=function(t){this.text=t,i("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")}),t.Text.prototype.setText=function(t){this.text=t,i("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},t.Text.calculateFontProperties=function(e){return i("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"),t.TextMetrics.measureFont(e)},Object.defineProperties(t.Text,{fontPropertiesCache:{get:function(){return i("Text.fontPropertiesCache is deprecated"),t.TextMetrics._fonts}},fontPropertiesCanvas:{get:function(){return i("Text.fontPropertiesCanvas is deprecated"),t.TextMetrics._canvas}},fontPropertiesContext:{get:function(){return i("Text.fontPropertiesContext is deprecated"),t.TextMetrics._context}}}),t.Text.prototype.setStyle=function(t){this.style=t,i("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},t.Text.prototype.determineFontProperties=function(e){return i("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"),t.TextMetrics.measureFont(e)},t.Text.getFontStyle=function(e){return i("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"),(e=e||{})instanceof t.TextStyle||(e=new t.TextStyle(e)),e.toFontString()},Object.defineProperties(t.TextStyle.prototype,{font:{get:function(){return i("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on"),this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+("number"==typeof this._fontSize?this._fontSize+"px":this._fontSize)+" "+this._fontFamily},set:function(t){i("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"),this._fontStyle=t.indexOf("italic")>1?"italic":t.indexOf("oblique")>-1?"oblique":"normal",this._fontVariant=t.indexOf("small-caps")>-1?"small-caps":"normal";var e=t.split(" "),r=-1;this._fontSize=26;for(var n=0;n<e.length;++n)if(e[n].match(/(px|pt|em|%)/)){r=n,this._fontSize=e[n];break}this._fontWeight="normal";for(var o=0;o<r;++o)if(e[o].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=e[o];break}if(r>-1&&r<e.length-1){this._fontFamily="";for(var a=r+1;a<e.length;++a)this._fontFamily+=e[a]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}}),t.Texture.prototype.setFrame=function(t){this.frame=t,i("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")},t.Texture.addTextureToCache=function(e,r){t.Texture.addToCache(e,r),i("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")},t.Texture.removeTextureFromCache=function(e){return i("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"),t.BaseTexture.removeFromCache(e),t.Texture.removeFromCache(e)},Object.defineProperties(o,{AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),t.AbstractFilter}},SpriteMaskFilter:{get:function(){return i("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),t.SpriteMaskFilter}},VoidFilter:{get:function(){return i("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"),o.AlphaFilter}}}),t.utils.uuid=function(){return i("utils.uuid() is deprecated, please use utils.uid() from now on."),t.utils.uid()},t.utils.canUseNewCanvasBlendModes=function(){return i("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"),t.CanvasTinter.canUseMultiply};var d=!0;if(Object.defineProperty(t.utils,"_saidHello",{set:function(t){t&&(i("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"),this.skipHello()),d=t},get:function(){return d}}),a.BasePrepare&&(a.BasePrepare.prototype.register=function(t,e){return i("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"),t&&this.registerFindHook(t),e&&this.registerUploadHook(e),this}),a.canvas&&Object.defineProperty(a.canvas,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),a.webgl&&Object.defineProperty(a.webgl,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),s.Loader){var p=s.Resource,f=s.Loader;Object.defineProperties(p.prototype,{isJson:{get:function(){return i("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."),this.type===p.TYPE.JSON}},isXml:{get:function(){return i("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."),this.type===p.TYPE.XML}},isImage:{get:function(){return i("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."),this.type===p.TYPE.IMAGE}},isAudio:{get:function(){return i("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."),this.type===p.TYPE.AUDIO}},isVideo:{get:function(){return i("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."),this.type===p.TYPE.VIDEO}}}),Object.defineProperties(f.prototype,{before:{get:function(){return i("The before() method is deprecated, please use pre()."),this.pre}},after:{get:function(){return i("The after() method is deprecated, please use use()."),this.use}}})}l.interactiveTarget&&Object.defineProperty(l.interactiveTarget,"defaultCursor",{set:function(t){i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor=t},get:function(){return i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor}}),l.InteractionManager&&(Object.defineProperty(l.InteractionManager,"defaultCursorStyle",{set:function(t){i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default=t},get:function(){return i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default}}),Object.defineProperty(l.InteractionManager,"currentCursorStyle",{set:function(t){i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode=t},get:function(){return i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode}}))};var n={};function i(t){if(!n[t]){var e=(new Error).stack;void 0===e?console.warn("Deprecation Warning: ",t):(e=e.split("\n").splice(3).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t),console.warn(e),console.groupEnd()):(console.warn("Deprecation Warning: ",t),console.warn(e))),n[t]=!0}}},meNg:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=function(t){return t&&t.__esModule?t:{default:t}}(r("QNV1")),o=n.ticker.shared;n.settings.UPLOADS_PER_FRAME=4;var a=function(){function t(e){var r=this;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.limiter=new i.default(n.settings.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){r.queue&&r.prepareItems()},this.registerFindHook(d),this.registerFindHook(p),this.registerFindHook(s),this.registerFindHook(l),this.registerFindHook(c),this.registerUploadHook(u),this.registerUploadHook(h)}return t.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,o.addOnce(this.tick,this,n.UPDATE_PRIORITY.UTILITY))):e&&e()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)o.addOnce(this.tick,this,n.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var a=this.completes.slice(0);this.completes.length=0;for(var s=0,l=a.length;s<l;s++)a[s]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof n.Container)for(var i=t.children.length-1;i>=0;i--)this.add(t.children[i]);return this},t.prototype.destroy=function(){this.ticking&&o.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function s(t,e){var r=!1;if(t&&t._textures&&t._textures.length)for(var i=0;i<t._textures.length;i++)if(t._textures[i]instanceof n.Texture){var o=t._textures[i].baseTexture;-1===e.indexOf(o)&&(e.push(o),r=!0)}return r}function l(t,e){return t instanceof n.BaseTexture&&(-1===e.indexOf(t)&&e.push(t),!0)}function c(t,e){if(t._texture&&t._texture instanceof n.Texture){var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function u(t,e){return e instanceof n.Text&&(e.updateText(!0),!0)}function h(t,e){if(e instanceof n.TextStyle){var r=e.toFontString();return n.TextMetrics.measureFont(r),!0}return!1}function d(t,e){if(t instanceof n.Text){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function p(t,e){return t instanceof n.TextStyle&&(-1===e.indexOf(t)&&e.push(t),!0)}e.default=a},ms1K:function(t,e,r){"use strict";e.__esModule=!0,e.default={mixin:function(t){!function(t){t.__plugins={},t.registerPlugin=function(e,r){t.__plugins[e]=r},t.prototype.initPlugins=function(){for(var e in this.plugins=this.plugins||{},t.__plugins)this.plugins[e]=new t.__plugins[e](this)},t.prototype.destroyPlugins=function(){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;this.plugins=null}}(t)}}},nWIE:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=r("qp2T"),a=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,n=arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16384,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return o>16384&&(o=16384),o>r&&(o=r),s._properties=[!1,!0,!1,!1,!1],s._maxSize=r,s._batchSize=o,s._glBuffers={},s._bufferUpdateIDs=[],s._updateID=0,s.interactiveChildren=!1,s.blendMode=i.BLEND_MODES.NORMAL,s.autoResize=a,s.roundPixels=!0,s.baseTexture=null,s.setProperties(n),s._tint=0,s.tintRgb=new Float32Array(4),s.tint=16777215,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},e.prototype.renderWebGL=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.hasLoaded||this.baseTexture.once("update",function(){return e.onChildrenChange(0)})),t.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},e.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,r=this.worldTransform,n=!0,i=0,o=0,a=0,s=0;t.setBlendMode(this.blendMode),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var c=this.children[l];if(c.visible){var u=c._texture.frame;if(e.globalAlpha=this.worldAlpha*c.alpha,c.rotation%(2*Math.PI)==0)n&&(e.setTransform(r.a,r.b,r.c,r.d,r.tx*t.resolution,r.ty*t.resolution),n=!1),i=c.anchor.x*(-u.width*c.scale.x)+c.position.x+.5,o=c.anchor.y*(-u.height*c.scale.y)+c.position.y+.5,a=u.width*c.scale.x,s=u.height*c.scale.y;else{n||(n=!0),c.displayObjectUpdateTransform();var h=c.worldTransform;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution|0,h.ty*t.resolution|0):e.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution,h.ty*t.resolution),i=c.anchor.x*-u.width+.5,o=c.anchor.y*-u.height+.5,a=u.width,s=u.height}var d=c._texture.baseTexture.resolution;e.drawImage(c._texture.baseTexture.source,u.x*d,u.y*d,u.width*d,u.height*d,i*t.resolution,o*t.resolution,a*t.resolution,s*t.resolution)}}}},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._buffers)for(var r=0;r<this._buffers.length;++r)this._buffers[r].destroy();this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},n(e,[{key:"tint",get:function(){return this._tint},set:function(t){this._tint=t,(0,o.hex2rgb)(t,this.tintRgb)}}]),e}(i.Container);e.default=a},nd3L:function(t,e,r){var n=r("JUUD");function i(t,e){if(this.nativeVaoExtension=null,i.FORCE_NATIVE||(this.nativeVaoExtension=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object")),this.nativeState=e,this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var r=t.getParameter(t.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(r),attribState:new Array(r)}}this.gl=t,this.attributes=[],this.indexBuffer=null,this.dirty=!1}i.prototype.constructor=i,t.exports=i,i.FORCE_NATIVE=!1,i.prototype.bind=function(){if(this.nativeVao){if(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty)return this.dirty=!1,this.activate(),this;this.indexBuffer&&this.indexBuffer.bind()}else this.activate();return this},i.prototype.unbind=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null),this},i.prototype.activate=function(){for(var t=this.gl,e=null,r=0;r<this.attributes.length;r++){var i=this.attributes[r];e!==i.buffer&&(i.buffer.bind(),e=i.buffer),t.vertexAttribPointer(i.attribute.location,i.attribute.size,i.type||t.FLOAT,i.normalized||!1,i.stride||0,i.start||0)}return n(t,this.attributes,this.nativeState),this.indexBuffer&&this.indexBuffer.bind(),this},i.prototype.addAttribute=function(t,e,r,n,i,o){return this.attributes.push({buffer:t,attribute:e,location:e.location,type:r||this.gl.FLOAT,normalized:n||!1,stride:i||0,start:o||0}),this.dirty=!0,this},i.prototype.addIndex=function(t){return this.indexBuffer=t,this.dirty=!0,this},i.prototype.clear=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.attributes.length=0,this.indexBuffer=null,this},i.prototype.draw=function(t,e,r){var n=this.gl;return this.indexBuffer?n.drawElements(t,e||this.indexBuffer.data.length,n.UNSIGNED_SHORT,2*(r||0)):n.drawArrays(t,r,e||this.getSize()),this},i.prototype.destroy=function(){this.gl=null,this.indexBuffer=null,this.attributes=null,this.nativeState=null,this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao),this.nativeVaoExtension=null,this.nativeVao=null},i.prototype.getSize=function(){var t=this.attributes[0];return t.buffer.data.length/(t.stride/4||t.attribute.size)}},"oIG/":function(t,e,r){(function(t){var n;!function(i){"object"==typeof global&&global;var o,a,s,l=String.fromCharCode;function c(t){for(var e,r,n=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function u(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function h(t,e){return l(t>>e&63|128)}function d(t,e){if(0==(4294967168&t))return l(t);var r="";return 0==(4294965248&t)?r=l(t>>6&31|192):0==(4294901760&t)?(u(t,e)||(t=65533),r=l(t>>12&15|224),r+=h(t,6)):0==(4292870144&t)&&(r=l(t>>18&7|240),r+=h(t,12),r+=h(t,6)),r+l(63&t|128)}function p(){if(s>=a)throw Error("Invalid byte index");var t=255&o[s];if(s++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function f(t){var e,r;if(s>a)throw Error("Invalid byte index");if(s==a)return!1;if(e=255&o[s],s++,0==(128&e))return e;if(192==(224&e)){if((r=(31&e)<<6|p())>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&e)){if((r=(15&e)<<12|p()<<6|p())>=2048)return u(r,t)?r:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(r=(7&e)<<18|p()<<12|p()<<6|p())>=65536&&r<=1114111)return r;throw Error("Invalid UTF-8 detected")}var m={version:"2.1.2",encode:function(t,e){for(var r=!1!==(e=e||{}).strict,n=c(t),i=n.length,o=-1,a="";++o<i;)a+=d(n[o],r);return a},decode:function(t,e){var r=!1!==(e=e||{}).strict;o=c(t),a=o.length,s=0;for(var n,i=[];!1!==(n=f(r));)i.push(n);return function(t){for(var e,r=t.length,n=-1,i="";++n<r;)(e=t[n])>65535&&(i+=l((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=l(e);return i}(i)}};void 0===(n=(function(){return m}).call(e,r,e,t))||(t.exports=n)}()}).call(this,r("YuTi")(t))},oXL5:function(t,e,r){"use strict";e.__esModule=!0,e.parse=s,e.default=function(){return function(t,e){if(t.data&&t.type===o.Resource.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var r=t.isDataUrl?"":n.dirname(t.url);t.isDataUrl&&("."===r&&(r=""),this.baseUrl&&r&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(r+="/")),(r=r.replace(this.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/");var a=r+t.data.getElementsByTagName("page")[0].getAttribute("file");i.utils.TextureCache[a]?(s(t,i.utils.TextureCache[a]),e()):this.add(t.name+"_image",a,{crossOrigin:t.crossOrigin,loadType:o.Resource.LOAD_TYPE.IMAGE,metadata:t.metadata.imageMetadata,parentResource:t},function(r){s(t,r.texture),e()})}else e();else e()}};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("2U8Y")),i=r("3AcN"),o=r("z+eP"),a=r("Y12R");function s(t,e){t.bitmapFont=a.BitmapText.registerFont(t.data,e)}},p6KW:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){for(var e=n[t],r=e.length,o=i,a="",s=void 0,l=0;l<t;l++){var c="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",l);s=l,l>=r&&(s=t-l-1),a+=c=c.replace("%value%",e[s]),a+="\n"}return(o=o.replace("%blur%",a)).replace("%size%",t)};var n={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},i=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n")},"p85+":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=a(r("yI/K")),o=a(r("sBhT"));function a(t){return t&&t.__esModule?t:{default:t}}r("2U8Y");var s=n.Matrix.IDENTITY,l=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.shader=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){this.shader=new n.Shader(this.renderer.gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")},e.prototype.render=function(t){var e=this.renderer,r=e.gl,a=t._texture;if(a.valid){var l=t._glDatas[e.CONTEXT_UID];l||(e.bindVao(null),(l={shader:this.shader,vertexBuffer:i.default.GLBuffer.createVertexBuffer(r,t.vertices,r.STREAM_DRAW),uvBuffer:i.default.GLBuffer.createVertexBuffer(r,t.uvs,r.STREAM_DRAW),indexBuffer:i.default.GLBuffer.createIndexBuffer(r,t.indices,r.STATIC_DRAW),vao:null,dirty:t.dirty,indexDirty:t.indexDirty}).vao=new i.default.VertexArrayObject(r).addIndex(l.indexBuffer).addAttribute(l.vertexBuffer,l.shader.attributes.aVertexPosition,r.FLOAT,!1,8,0).addAttribute(l.uvBuffer,l.shader.attributes.aTextureCoord,r.FLOAT,!1,8,0),t._glDatas[e.CONTEXT_UID]=l),e.bindVao(l.vao),t.dirty!==l.dirty&&(l.dirty=t.dirty,l.uvBuffer.upload(t.uvs)),t.indexDirty!==l.indexDirty&&(l.indexDirty=t.indexDirty,l.indexBuffer.upload(t.indices)),l.vertexBuffer.upload(t.vertices),e.bindShader(l.shader),l.shader.uniforms.uSampler=e.bindTexture(a),e.state.setBlendMode(n.utils.correctBlendMode(t.blendMode,a.baseTexture.premultipliedAlpha)),l.shader.uniforms.uTransform&&(l.shader.uniforms.uTransform=t.uploadUvTransform?t._uvTransform.mapCoord.toArray(!0):s.toArray(!0)),l.shader.uniforms.translationMatrix=t.worldTransform.toArray(!0),l.shader.uniforms.uColor=n.utils.premultiplyRgba(t.tintRgb,t.worldAlpha,l.shader.uniforms.uColor,a.baseTexture.premultipliedAlpha),l.vao.draw(t.drawMode===o.default.DRAW_MODES.TRIANGLE_MESH?r.TRIANGLE_STRIP:r.TRIANGLES,t.indices.length,0)}},e}(n.ObjectRenderer);e.default=l,n.WebGLRenderer.registerPlugin("mesh",l)},pDOs:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(r("Yd/J")),o=function(){function t(e,r,n){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||i.default.RESOLUTION,this.resize(e,r)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},n(t,[{key:"width",get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},{key:"height",get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}]),t}();e.default=o},pEa2:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),i=r("pQYt");r("2U8Y");var o=new n.Matrix,a=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.shader=null,n.simpleShader=null,n.quad=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.shader=new n.Shader(t,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"),this.simpleShader=new n.Shader(t,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"),this.renderer.bindVao(null),this.quad=new n.Quad(t,this.renderer.state.attribState),this.quad.initVao(this.shader)},e.prototype.render=function(t){var e=this.renderer,r=this.quad;e.bindVao(r.vao);var a=r.vertices;a[0]=a[6]=t._width*-t.anchor.x,a[1]=a[3]=t._height*-t.anchor.y,a[2]=a[4]=t._width*(1-t.anchor.x),a[5]=a[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((a=r.uvs)[0]=a[6]=-t.anchor.x,a[1]=a[3]=-t.anchor.y,a[2]=a[4]=1-t.anchor.x,a[5]=a[7]=1-t.anchor.y),r.upload();var s=t._texture,l=s.baseTexture,c=t.tileTransform.localTransform,u=t.uvTransform,h=l.isPowerOfTwo&&s.frame.width===l.width&&s.frame.height===l.height;h&&(l._glTextures[e.CONTEXT_UID]?h=l.wrapMode!==i.WRAP_MODES.CLAMP:l.wrapMode===i.WRAP_MODES.CLAMP&&(l.wrapMode=i.WRAP_MODES.REPEAT));var d=h?this.simpleShader:this.shader;e.bindShader(d);var p=s.width,f=s.height,m=t._width,v=t._height;o.set(c.a*p/m,c.b*p/v,c.c*f/m,c.d*f/v,c.tx/m,c.ty/v),o.invert(),h?o.prepend(u.mapCoord):(d.uniforms.uMapCoord=u.mapCoord.toArray(!0),d.uniforms.uClampFrame=u.uClampFrame,d.uniforms.uClampOffset=u.uClampOffset),d.uniforms.uTransform=o.toArray(!0),d.uniforms.uColor=n.utils.premultiplyTintToRgba(t.tint,t.worldAlpha,d.uniforms.uColor,l.premultipliedAlpha),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=e.bindTexture(s),e.setBlendMode(n.utils.correctBlendMode(t.blendMode,l.premultipliedAlpha)),r.vao.draw(this.renderer.gl.TRIANGLES,6,0)},e}(n.ObjectRenderer);e.default=a,n.WebGLRenderer.registerPlugin("tilingSprite",a)},pIo5:function(t,e,r){"use strict";"use restrict";function n(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,r;return e=(t>65535)<<4,e|=r=((t>>>=e)>255)<<3,e|=r=((t>>>=r)>15)<<2,(e|=r=((t>>>=r)>3)<<1)|(t>>>=r)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=n,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var i=new Array(256);!function(t){for(var e=0;e<256;++e){var r=e,n=e,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;t[e]=n<<i&255}}(i),e.reverse=function(t){return i[255&t]<<24|i[t>>>8&255]<<16|i[t>>>16&255]<<8|i[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,r){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>n(t)+1}},pQYt:function(t,e,r){"use strict";e.__esModule=!0,e.VERSION="4.7.3",e.PI_2=2*Math.PI,e.RAD_TO_DEG=180/Math.PI,e.DEG_TO_RAD=Math.PI/180,e.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2},e.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19},e.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},e.SCALE_MODES={LINEAR:0,NEAREST:1},e.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},e.GC_MODES={AUTO:0,MANUAL:1},e.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i,e.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;(charset=[\w-]+|base64))?,(.*)/i,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},e.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},e.TRANSFORM_MODE={STATIC:0,DYNAMIC:1},e.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},e.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50}},pV5o:function(t,e,r){"use strict";e.__esModule=!0;var n=y(r("FI+O")),i=y(r("NE8l")),o=y(r("9PbN")),a=y(r("D+IV")),s=y(r("8WrO")),l=y(r("4FaX")),c=y(r("BzvT")),u=y(r("3Jm9")),h=y(r("Nv7N")),d=y(r("VAGf")),p=y(r("ew+k")),f=y(r("9I6j")),m=r("qp2T"),v=y(r("yI/K")),g=r("pQYt");function y(t){return t&&t.__esModule?t:{default:t}}var x=0,b=function(t){function e(r,n,a){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"WebGL",r,n,a));return s.legacy=s.options.legacy,s.legacy&&(v.default.VertexArrayObject.FORCE_NATIVE=!0),s.type=g.RENDERER_TYPE.WEBGL,s.handleContextLost=s.handleContextLost.bind(s),s.handleContextRestored=s.handleContextRestored.bind(s),s.view.addEventListener("webglcontextlost",s.handleContextLost,!1),s.view.addEventListener("webglcontextrestored",s.handleContextRestored,!1),s._contextOptions={alpha:s.transparent,antialias:s.options.antialias,premultipliedAlpha:s.transparent&&"notMultiplied"!==s.transparent,stencil:!0,preserveDrawingBuffer:s.options.preserveDrawingBuffer,powerPreference:s.options.powerPreference},s._backgroundColorRgba[3]=s.transparent?0:1,s.maskManager=new i.default(s),s.stencilManager=new o.default(s),s.emptyRenderer=new l.default(s),s.currentRenderer=s.emptyRenderer,s.textureManager=null,s.filterManager=null,s.initPlugins(),s.options.context&&(0,f.default)(s.options.context),s.gl=s.options.context||v.default.createContext(s.view,s._contextOptions),s.CONTEXT_UID=x++,s.state=new d.default(s.gl),s.renderingToScreen=!0,s.boundTextures=null,s._activeShader=null,s._activeVao=null,s._activeRenderTarget=null,s._initContext(),s.drawModes=(0,p.default)(s.gl),s._nextTextureLocation=0,s.setBlendMode(0),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._initContext=function(){var t=this.gl;t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext();var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null,this._activeVao=null,this.boundTextures=new Array(e),this.emptyTextures=new Array(e),this.textureManager=new c.default(this),this.filterManager=new a.default(this),this.textureGC=new h.default(this),this.state.resetToDefault(),this.rootRenderTarget=new s.default(t,this.width,this.height,null,this.resolution,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget);var r=new v.default.GLTexture.fromData(t,null,1,1),n={_glTextures:{}};n._glTextures[this.CONTEXT_UID]={};for(var i=0;i<e;i++){var o=new u.default;o._glTextures[this.CONTEXT_UID]=r,this.boundTextures[i]=n,this.emptyTextures[i]=o,this.bindTexture(null,i)}this.emit("context",t),this.resize(this.screen.width,this.screen.height)},e.prototype.render=function(t,e,r,n,i){if(this.renderingToScreen=!e,this.emit("prerender"),this.gl&&!this.gl.isContextLost()){if(this._nextTextureLocation=0,e||(this._lastObjectRendered=t),!i){var o=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=o}this.bindRenderTexture(e,n),this.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this._activeRenderTarget.clear(),t.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender")}},e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.resize=function(t,e){n.default.prototype.resize.call(this,t,e),this.rootRenderTarget.resize(t,e),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},e.prototype.setBlendMode=function(t){this.state.setBlendMode(t)},e.prototype.clear=function(t){this._activeRenderTarget.clear(t)},e.prototype.setTransform=function(t){this._activeRenderTarget.transform=t},e.prototype.clearRenderTexture=function(t,e){var r=t.baseTexture._glRenderTargets[this.CONTEXT_UID];return r&&r.clear(e),this},e.prototype.bindRenderTexture=function(t,e){var r=void 0;if(t){var n=t.baseTexture;n._glRenderTargets[this.CONTEXT_UID]||this.textureManager.updateTexture(n,0),this.unbindTexture(n),(r=n._glRenderTargets[this.CONTEXT_UID]).setFrame(t.frame)}else r=this.rootRenderTarget;return r.transform=e,this.bindRenderTarget(r),this},e.prototype.bindRenderTarget=function(t){return t!==this._activeRenderTarget&&(this._activeRenderTarget=t,t.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=t.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(t.stencilMaskStack)),this},e.prototype.bindShader=function(t,e){return this._activeShader!==t&&(this._activeShader=t,t.bind(),!1!==e&&(t.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0))),this},e.prototype.bindTexture=function(t,e,r){if((t=(t=t||this.emptyTextures[e]).baseTexture||t).touched=this.textureGC.count,r)e=e||0;else{for(var n=0;n<this.boundTextures.length;n++)if(this.boundTextures[n]===t)return n;void 0===e&&(this._nextTextureLocation++,this._nextTextureLocation%=this.boundTextures.length,e=this.boundTextures.length-this._nextTextureLocation-1)}var i=this.gl,o=t._glTextures[this.CONTEXT_UID];return o?(this.boundTextures[e]=t,i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,o.texture)):this.textureManager.updateTexture(t,e),e},e.prototype.unbindTexture=function(t){var e=this.gl;t=t.baseTexture||t;for(var r=0;r<this.boundTextures.length;r++)this.boundTextures[r]===t&&(this.boundTextures[r]=this.emptyTextures[r],e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[r]._glTextures[this.CONTEXT_UID].texture));return this},e.prototype.createVao=function(){return new v.default.VertexArrayObject(this.gl,this.state.attribState)},e.prototype.bindVao=function(t){return this._activeVao===t?this:(t?t.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=t,this)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer),this.bindVao(null),this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.emptyTextures[t];return this.rootRenderTarget.activate(),this.state.resetToDefault(),this},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.textureManager.removeAll(),this.filterManager.destroy(!0),this._initContext()},e.prototype.destroy=function(e){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.textureManager.destroy(),t.prototype.destroy.call(this,e),this.uid=0,this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.maskManager=null,this.filterManager=null,this.textureManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null},e}(n.default);e.default=b,m.pluginTarget.mixin(b)},pVcz:function(t,e,r){"use strict";e.__esModule=!0;var n=u(r("FI+O")),i=u(r("cva9")),o=u(r("pDOs")),a=u(r("hN+0")),s=r("qp2T"),l=r("pQYt"),c=u(r("Yd/J"));function u(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(r,n,o){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"Canvas",r,n,o));return s.type=l.RENDERER_TYPE.CANVAS,s.rootContext=s.view.getContext("2d",{alpha:s.transparent}),s.context=s.rootContext,s.refresh=!0,s.maskManager=new i.default(s),s.smoothProperty="imageSmoothingEnabled",s.rootContext.imageSmoothingEnabled||(s.rootContext.webkitImageSmoothingEnabled?s.smoothProperty="webkitImageSmoothingEnabled":s.rootContext.mozImageSmoothingEnabled?s.smoothProperty="mozImageSmoothingEnabled":s.rootContext.oImageSmoothingEnabled?s.smoothProperty="oImageSmoothingEnabled":s.rootContext.msImageSmoothingEnabled&&(s.smoothProperty="msImageSmoothingEnabled")),s.initPlugins(),s.blendModes=(0,a.default)(),s._activeBlendMode=null,s.renderingToScreen=!1,s.resize(s.options.width,s.options.height),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.render=function(t,e,r,n,i){if(this.view){this.renderingToScreen=!e,this.emit("prerender");var a=this.resolution;e?((e=e.baseTexture||e)._canvasRenderTarget||(e._canvasRenderTarget=new o.default(e.width,e.height,e.resolution),e.source=e._canvasRenderTarget.canvas,e.valid=!0),this.context=e._canvasRenderTarget.context,this.resolution=e._canvasRenderTarget.resolution):this.context=this.rootContext;var s=this.context;if(e||(this._lastObjectRendered=t),!i){var c=t.parent,u=this._tempDisplayObjectParent.transform.worldTransform;n?(n.copy(u),this._tempDisplayObjectParent.transform._worldID=-1):u.identity(),t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=c}s.save(),s.setTransform(1,0,0,1,0,0),s.globalAlpha=1,this._activeBlendMode=l.BLEND_MODES.NORMAL,s.globalCompositeOperation=this.blendModes[l.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(s.fillStyle="black",s.clear()),(void 0!==r?r:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?s.clearRect(0,0,this.width,this.height):(s.fillStyle=this._backgroundColorString,s.fillRect(0,0,this.width,this.height)));var h=this.context;this.context=s,t.renderCanvas(this),this.context=h,s.restore(),this.resolution=a,this.emit("postrender")}},e.prototype.clear=function(t){var e=this.context;t=t||this._backgroundColorString,!this.transparent&&t?(e.fillStyle=t,e.fillRect(0,0,this.width,this.height)):e.clearRect(0,0,this.width,this.height)},e.prototype.setBlendMode=function(t){this._activeBlendMode!==t&&(this._activeBlendMode=t,this.context.globalCompositeOperation=this.blendModes[t])},e.prototype.destroy=function(e){this.destroyPlugins(),t.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},e.prototype.resize=function(e,r){t.prototype.resize.call(this,e,r),this.smoothProperty&&(this.rootContext[this.smoothProperty]=c.default.SCALE_MODE===l.SCALE_MODES.LINEAR)},e.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},e}(n.default);e.default=h,s.pluginTarget.mixin(h)},qCKp:function(t,e,r){"use strict";var n=r(null),i=(r(null),r(null),r(null)),o=r(null),a=r(null),s=r(null),l=r(null),c=r(null),u=r(null),h=r(null),d=r(null),p=r(null),f=r(null);class m extends f.a{constructor(t=v,e=Number.POSITIVE_INFINITY){this.maxFrames=e,this.frame=0,this.index=-1}flush(){const{actions:t,maxFrames:e}=this;let r,n;for(;(n=t.shift())&&(this.frame=n.delay)<=e&&!(r=n.execute(n.state,n.delay)););if(r){for(;n=t.shift(););throw r}}}m.frameTimeFactor=10;class v extends p.a{constructor(t,e,r=(t.index+=1)){this.scheduler=t,this.work=e,this.index=r,this.active=!0,this.index=t.index=r}schedule(t,e=0){return this.id?(this.active=!1,new v(this.scheduler,this.work).schedule(t,e)):super.schedule(t,e)}requestAsyncId(t,e,r=0){this.delay=t.frame+r;const{actions:n}=t;return!0}recycleAsyncId(t,e,r=0){}_execute(t,e){if(!0===this.active)return super._execute(t,e)}static sortActions(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1}}var g=r(null),y=r(null),x=r(null),b=r(null),w=r(null),_=r(null),S=r(null);function T(t){return t&&t instanceof n.a||"function"==typeof t.lift&&"function"==typeof t.subscribe}var M=r(null),A=r(null),E=r(null),C=r(null),P=r(null),O=r(null),N=r(null),L=r(null),I=r(null),R=r(null),D=r(null),F=r(null),U=r(null),k=r(null),B=r(null),j=r(null),z=r(null),V=r(null),G=r(null),H=r(null),W=r(null),X=r(null),Y=r(null),q=r(null),J=r(null),Z=r(null),Q=r(null),K=r(null),$=r(null),tt=r(null);r.d(e,"Observable",function(){return n.a}),r.d(e,"ConnectableObservable",function(){}),r.d(e,"GroupedObservable",function(){}),r.d(e,"observable",function(){return i.a}),r.d(e,"Subject",function(){return o.a}),r.d(e,"BehaviorSubject",function(){return a.a}),r.d(e,"ReplaySubject",function(){return s.a}),r.d(e,"AsyncSubject",function(){return l.a}),r.d(e,"asapScheduler",function(){return c.a}),r.d(e,"asyncScheduler",function(){return u.a}),r.d(e,"queueScheduler",function(){return h.a}),r.d(e,"animationFrameScheduler",function(){return d.a}),r.d(e,"VirtualTimeScheduler",function(){return m}),r.d(e,"VirtualAction",function(){return v}),r.d(e,"Scheduler",function(){return g.a}),r.d(e,"Subscription",function(){return y.a}),r.d(e,"Subscriber",function(){return x.a}),r.d(e,"Notification",function(){return b.a}),r.d(e,"pipe",function(){return w.b}),r.d(e,"noop",function(){return _.a}),r.d(e,"identity",function(){return S.a}),r.d(e,"isObservable",function(){return T}),r.d(e,"ArgumentOutOfRangeError",function(){return M.a}),r.d(e,"EmptyError",function(){return A.a}),r.d(e,"ObjectUnsubscribedError",function(){return E.a}),r.d(e,"UnsubscriptionError",function(){return C.a}),r.d(e,"TimeoutError",function(){return P.a}),r.d(e,"bindCallback",function(){return O.a}),r.d(e,"bindNodeCallback",function(){return N.a}),r.d(e,"combineLatest",function(){return L.b}),r.d(e,"concat",function(){return I.a}),r.d(e,"defer",function(){return R.a}),r.d(e,"empty",function(){return D.a}),r.d(e,"forkJoin",function(){return F.a}),r.d(e,"from",function(){return U.a}),r.d(e,"fromEvent",function(){return k.a}),r.d(e,"fromEventPattern",function(){return B.a}),r.d(e,"generate",function(){return j.a}),r.d(e,"iif",function(){return z.a}),r.d(e,"interval",function(){return V.a}),r.d(e,"merge",function(){return G.a}),r.d(e,"never",function(){}),r.d(e,"of",function(){return W.a}),r.d(e,"onErrorResumeNext",function(){return X.a}),r.d(e,"pairs",function(){return Y.a}),r.d(e,"race",function(){return q.a}),r.d(e,"range",function(){return J.a}),r.d(e,"throwError",function(){return Z.a}),r.d(e,"timer",function(){return Q.a}),r.d(e,"using",function(){return K.a}),r.d(e,"zip",function(){return $.b}),r.d(e,"EMPTY",function(){return D.b}),r.d(e,"NEVER",function(){return H.a}),r.d(e,"config",function(){return tt.a})},qEO2:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("TXE8")),i=r("pQYt"),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r,this.width=n,this.height=o,this.type=i.SHAPES.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,n=(e-this.y)/this.height;return(r*=r)+(n*=n)<=1},t.prototype.getBounds=function(){return new n.default(this.x-this.width,this.y-this.height,this.width,this.height)},t}();e.default=o},qllB:function(t,e,r){"use strict";e.__esModule=!0,e.shared=e.Resource=e.textureParser=e.getResourcePath=e.spritesheetParser=e.parseBitmapFontData=e.bitmapFontParser=e.Loader=void 0;var n=r("oXL5");Object.defineProperty(e,"bitmapFontParser",{enumerable:!0,get:function(){return c(n).default}}),Object.defineProperty(e,"parseBitmapFontData",{enumerable:!0,get:function(){return n.parse}});var i=r("Nx1p");Object.defineProperty(e,"spritesheetParser",{enumerable:!0,get:function(){return c(i).default}}),Object.defineProperty(e,"getResourcePath",{enumerable:!0,get:function(){return i.getResourcePath}});var o=r("SLIe");Object.defineProperty(e,"textureParser",{enumerable:!0,get:function(){return c(o).default}});var a=r("z+eP");Object.defineProperty(e,"Resource",{enumerable:!0,get:function(){return a.Resource}});var s=c(r("zLIK")),l=c(r("e8hs"));function c(t){return t&&t.__esModule?t:{default:t}}e.Loader=l.default;var u=new l.default;u.destroy=function(){},e.shared=u;var h=s.default.prototype;h._loader=null,Object.defineProperty(h,"loader",{get:function(){return this._loader||(this._loader=this._options.sharedLoader?u:new l.default),this._loader}}),h._parentDestroy=h.destroy,h.destroy=function(t){this._loader&&(this._loader.destroy(),this._loader=null),this._parentDestroy(t)}},qp2T:function(t,e,r){"use strict";e.__esModule=!0,e.premultiplyBlendMode=e.BaseTextureCache=e.TextureCache=e.earcut=e.mixins=e.pluginTarget=e.EventEmitter=e.removeItems=e.isMobile=void 0,e.uid=function(){return++f},e.hex2rgb=function(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},e.hex2string=function(t){return t=t.toString(16),"#"+("000000".substr(0,6-t.length)+t)},e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)},e.getResolutionOfUrl=function(t,e){var r=i.default.RETINA_PREFIX.exec(t);return r?parseFloat(r[1]):void 0!==e?e:1},e.decomposeDataUri=function(t){var e=n.DATA_URI.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,encoding:e[3]?e[3].toLowerCase():void 0,data:e[4]}},e.getUrlFileExtension=function(t){var e=n.URL_FILE_EXTENSION.exec(t);if(e)return e[1].toLowerCase()},e.getSvgSize=function(t){var e=n.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r},e.skipHello=function(){m=!0},e.sayHello=function(t){m||(navigator.userAgent.toLowerCase().indexOf("chrome")>-1?window.console.log.apply(console,["\n %c %c %c PixiJS "+n.VERSION+" - \u2730 "+t+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):window.console&&window.console.log("PixiJS "+n.VERSION+" - "+t+" - http://www.pixijs.com/"),m=!0)},e.isWebGLSupported=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!(!r||!r.getContextAttributes().stencil);if(r){var i=r.getExtension("WEBGL_lose_context");i&&i.loseContext()}return r=null,n}catch(t){return!1}},e.sign=function(t){return 0===t?0:t<0?-1:1},e.destroyTextureCache=function(){var t=void 0;for(t in v)v[t].destroy();for(t in g)g[t].destroy()},e.clearTextureCache=function(){var t=void 0;for(t in v)delete v[t];for(t in g)delete g[t]},e.correctBlendMode=function(t,e){return y[e?1:0][t]},e.premultiplyTint=function(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var r=t>>16&255,n=t>>8&255;return(255*e<<24)+((r=r*e+.5|0)<<16)+((n=n*e+.5|0)<<8)+((255&t)*e+.5|0)},e.premultiplyRgba=function(t,e,r,n){return r=r||new Float32Array(4),n||void 0===n?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e):(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=e,r},e.premultiplyTintToRgba=function(t,e,r,n){return(r=r||new Float32Array(4))[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,(n||void 0===n)&&(r[0]*=e,r[1]*=e,r[2]*=e),r[3]=e,r};var n=r("pQYt"),i=p(r("Yd/J")),o=p(r("uhBA")),a=p(r("ms1K")),s=d(r("uQ0E")),l=d(r("G9Ht")),c=p(r("0QlW")),u=p(r("dGcs")),h=p(r("VmRL"));function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function p(t){return t&&t.__esModule?t:{default:t}}var f=0,m=!1;e.isMobile=l,e.removeItems=c.default,e.EventEmitter=o.default,e.pluginTarget=a.default,e.mixins=s,e.earcut=h.default;var v=e.TextureCache=Object.create(null),g=e.BaseTextureCache=Object.create(null),y=e.premultiplyBlendMode=(0,u.default)()},r8II:function(t,e,r){"use strict";e.decode=e.parse=r("YcCt"),e.encode=e.stringify=r("6MUB")},rI9z:function(t,e){var r=function(t){for(var e=new Array(t),r=0;r<e.length;r++)e[r]=!1;return e};t.exports=function(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return r(2*e);case"bvec3":return r(3*e);case"bvec4":return r(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}},rUHO:function(t,e,r){"use strict";e.__esModule=!0,e.calculateScreenSpaceMatrix=function(t,e,r){var n=t.identity();return n.translate(e.x/r.width,e.y/r.height),n.scale(r.width,r.height),n},e.calculateNormalizedScreenSpaceMatrix=function(t,e,r){var n=t.identity();return n.translate(e.x/r.width,e.y/r.height),n.scale(r.width/e.width,r.height/e.height),n},e.calculateSpriteMatrix=function(t,e,r,i){var o=i._texture.orig,a=t.set(r.width,0,0,r.height,e.x,e.y),s=i.worldTransform.copy(n.Matrix.TEMP_MATRIX);return s.invert(),a.prepend(s),a.scale(1/o.width,1/o.height),a.translate(i.anchor.x,i.anchor.y),a};var n=r("d07J")},rWzI:function(t,e,r){(function(t){var n;!function(i){"object"==typeof global&&global;var o,a=2147483647,s=36,l=1,c=26,u=38,h=700,d=72,p=128,f="-",m=/^xn--/,v=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=s-l,b=Math.floor,w=String.fromCharCode;function _(t){throw RangeError(y[t])}function S(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function T(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+S((t=t.replace(g,".")).split("."),e).join(".")}function M(t){for(var e,r,n=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function A(t){return S(t,function(t){var e="";return t>65535&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+w(t)}).join("")}function E(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:s}function C(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function P(t,e,r){var n=0;for(t=r?b(t/h):t>>1,t+=b(t/e);t>x*c>>1;n+=s)t=b(t/x);return b(n+(x+1)*t/(t+u))}function O(t){var e,r,n,i,o,u,h,m,v,g,y=[],x=t.length,w=0,S=p,T=d;for((r=t.lastIndexOf(f))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&_("not-basic"),y.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<x;){for(o=w,u=1,h=s;i>=x&&_("invalid-input"),((m=E(t.charCodeAt(i++)))>=s||m>b((a-w)/u))&&_("overflow"),w+=m*u,!(m<(v=h<=T?l:h>=T+c?c:h-T));h+=s)u>b(a/(g=s-v))&&_("overflow"),u*=g;T=P(w-o,e=y.length+1,0==o),b(w/e)>a-S&&_("overflow"),S+=b(w/e),w%=e,y.splice(w++,0,S)}return A(y)}function N(t){var e,r,n,i,o,u,h,m,v,g,y,x,S,T,A,E=[];for(x=(t=M(t)).length,e=p,r=0,o=d,u=0;u<x;++u)(y=t[u])<128&&E.push(w(y));for(n=i=E.length,i&&E.push(f);n<x;){for(h=a,u=0;u<x;++u)(y=t[u])>=e&&y<h&&(h=y);for(h-e>b((a-r)/(S=n+1))&&_("overflow"),r+=(h-e)*S,e=h,u=0;u<x;++u)if((y=t[u])<e&&++r>a&&_("overflow"),y==e){for(m=r,v=s;!(m<(g=v<=o?l:v>=o+c?c:v-o));v+=s)E.push(w(C(g+(A=m-g)%(T=s-g),0))),m=b(A/T);E.push(w(C(m,0))),o=P(r,S,n==i),r=0,++n}++r,++e}return E.join("")}o={version:"1.3.2",ucs2:{decode:M,encode:A},decode:O,encode:N,toASCII:function(t){return T(t,function(t){return v.test(t)?"xn--"+N(t):t})},toUnicode:function(t){return T(t,function(t){return m.test(t)?O(t.slice(4).toLowerCase()):t})}},void 0===(n=(function(){return o}).call(e,r,e,t))||(t.exports=n)}()}).call(this,r("YuTi")(t))},rjcF:function(t,e){t.exports=function(t){function e(e,r){this.object=e,this.domElement=void 0!==r?r:document,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:t.MOUSE.LEFT,ZOOM:t.MOUSE.MIDDLE,PAN:t.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),l=s.NONE},this.update=function(){var r=new t.Vector3,o=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),a=o.clone().inverse(),m=new t.Vector3,v=new t.Quaternion;return function(){var t=n.object.position;return r.copy(t).sub(n.target),r.applyQuaternion(o),u.setFromVector3(r),n.autoRotate&&l===s.NONE&&M(2*Math.PI/60/60*n.autoRotateSpeed),u.theta+=h.theta,u.phi+=h.phi,u.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=d,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),n.target.add(p),r.setFromSpherical(u),r.applyQuaternion(a),t.copy(n.target).add(r),n.object.lookAt(n.target),!0===n.enableDamping?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor):h.set(0,0,0),d=1,p.set(0,0,0),!!(f||m.distanceToSquared(n.object.position)>c||8*(1-v.dot(n.object.quaternion))>c)&&(n.dispatchEvent(i),m.copy(n.object.position),v.copy(n.object.quaternion),f=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",j,!1),n.domElement.removeEventListener("mousedown",L,!1),n.domElement.removeEventListener("wheel",D,!1),n.domElement.removeEventListener("touchstart",U,!1),n.domElement.removeEventListener("touchend",B,!1),n.domElement.removeEventListener("touchmove",k,!1),document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",R,!1),window.removeEventListener("keydown",F,!1)};var n=this,i={type:"change"},o={type:"start"},a={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},l=s.NONE,c=1e-6,u=new t.Spherical,h=new t.Spherical,d=1,p=new t.Vector3,f=!1,m=new t.Vector2,v=new t.Vector2,g=new t.Vector2,y=new t.Vector2,x=new t.Vector2,b=new t.Vector2,w=new t.Vector2,_=new t.Vector2,S=new t.Vector2;function T(){return Math.pow(.95,n.zoomSpeed)}function M(t){h.theta-=t}function A(t){h.phi-=t}var E=function(){var e=new t.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),p.add(e)}}(),C=function(){var e=new t.Vector3;return function(t,r){e.setFromMatrixColumn(r,1),e.multiplyScalar(t),p.add(e)}}(),P=function(){var e=new t.Vector3;return function(r,i){var o=n.domElement===document?n.domElement.body:n.domElement;if(n.object instanceof t.PerspectiveCamera){e.copy(n.object.position).sub(n.target);var a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),E(2*r*a/o.clientHeight,n.object.matrix),C(2*i*a/o.clientHeight,n.object.matrix)}else n.object instanceof t.OrthographicCamera?(E(r*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),C(i*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function O(e){n.object instanceof t.PerspectiveCamera?d/=e:n.object instanceof t.OrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(e){n.object instanceof t.PerspectiveCamera?d*=e:n.object instanceof t.OrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(t){if(!1!==n.enabled){if(t.preventDefault(),t.button===n.mouseButtons.ORBIT){if(!1===n.enableRotate)return;!function(t){m.set(t.clientX,t.clientY)}(t),l=s.ROTATE}else if(t.button===n.mouseButtons.ZOOM){if(!1===n.enableZoom)return;!function(t){w.set(t.clientX,t.clientY)}(t),l=s.DOLLY}else if(t.button===n.mouseButtons.PAN){if(!1===n.enablePan)return;!function(t){y.set(t.clientX,t.clientY)}(t),l=s.PAN}l!==s.NONE&&(document.addEventListener("mousemove",I,!1),document.addEventListener("mouseup",R,!1),n.dispatchEvent(o))}}function I(t){if(!1!==n.enabled)if(t.preventDefault(),l===s.ROTATE){if(!1===n.enableRotate)return;!function(t){v.set(t.clientX,t.clientY),g.subVectors(v,m);var e=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*g.x/e.clientWidth*n.rotateSpeed),A(2*Math.PI*g.y/e.clientHeight*n.rotateSpeed),m.copy(v),n.update()}(t)}else if(l===s.DOLLY){if(!1===n.enableZoom)return;!function(t){_.set(t.clientX,t.clientY),S.subVectors(_,w),S.y>0?O(T()):S.y<0&&N(T()),w.copy(_),n.update()}(t)}else if(l===s.PAN){if(!1===n.enablePan)return;!function(t){x.set(t.clientX,t.clientY),b.subVectors(x,y),P(b.x,b.y),y.copy(x),n.update()}(t)}}function R(t){!1!==n.enabled&&(document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",R,!1),n.dispatchEvent(a),l=s.NONE)}function D(t){!1===n.enabled||!1===n.enableZoom||l!==s.NONE&&l!==s.ROTATE||(t.preventDefault(),t.stopPropagation(),function(t){t.deltaY<0?N(T()):t.deltaY>0&&O(T()),n.update()}(t),n.dispatchEvent(o),n.dispatchEvent(a))}function F(t){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n.enablePan&&function(t){switch(t.keyCode){case n.keys.UP:P(0,n.keyPanSpeed),n.update();break;case n.keys.BOTTOM:P(0,-n.keyPanSpeed),n.update();break;case n.keys.LEFT:P(n.keyPanSpeed,0),n.update();break;case n.keys.RIGHT:P(-n.keyPanSpeed,0),n.update()}}(t)}function U(t){if(!1!==n.enabled){switch(t.touches.length){case 1:if(!1===n.enableRotate)return;!function(t){m.set(t.touches[0].pageX,t.touches[0].pageY)}(t),l=s.TOUCH_ROTATE;break;case 2:if(!1===n.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+r*r);w.set(0,n)}(t),l=s.TOUCH_DOLLY;break;case 3:if(!1===n.enablePan)return;!function(t){y.set(t.touches[0].pageX,t.touches[0].pageY)}(t),l=s.TOUCH_PAN;break;default:l=s.NONE}l!==s.NONE&&n.dispatchEvent(o)}}function k(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===n.enableRotate)return;if(l!==s.TOUCH_ROTATE)return;!function(t){v.set(t.touches[0].pageX,t.touches[0].pageY),g.subVectors(v,m);var e=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*g.x/e.clientWidth*n.rotateSpeed),A(2*Math.PI*g.y/e.clientHeight*n.rotateSpeed),m.copy(v),n.update()}(t);break;case 2:if(!1===n.enableZoom)return;if(l!==s.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);_.set(0,i),S.subVectors(_,w),S.y>0?N(T()):S.y<0&&O(T()),w.copy(_),n.update()}(t);break;case 3:if(!1===n.enablePan)return;if(l!==s.TOUCH_PAN)return;!function(t){x.set(t.touches[0].pageX,t.touches[0].pageY),b.subVectors(x,y),P(b.x,b.y),y.copy(x),n.update()}(t);break;default:l=s.NONE}}function B(t){!1!==n.enabled&&(n.dispatchEvent(a),l=s.NONE)}function j(t){t.preventDefault()}n.domElement.addEventListener("contextmenu",j,!1),n.domElement.addEventListener("mousedown",L,!1),n.domElement.addEventListener("wheel",D,!1),n.domElement.addEventListener("touchstart",U,!1),n.domElement.addEventListener("touchend",B,!1),n.domElement.addEventListener("touchmove",k,!1),window.addEventListener("keydown",F,!1),this.update()}return(e.prototype=Object.create(t.EventDispatcher.prototype)).constructor=e,Object.defineProperties(e.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}}),e}},rvTR:function(t,e,r){"use strict";var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN"));n.DisplayObject.prototype.name=null,n.Container.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null}},s1PF:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=c(r("3Jm9")),o=r("qp2T"),a=r("8g3p"),s=r("pQYt"),l=c(r("ad8U"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(r,n){if(function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),!r)throw new Error("No video source element specified.");(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,n));return i.width=r.videoWidth,i.height=r.videoHeight,i._autoUpdate=!0,i._isAutoUpdating=!1,i.autoPlay=!0,i.update=i.update.bind(i),i._onCanPlay=i._onCanPlay.bind(i),r.addEventListener("play",i._onPlayStart.bind(i)),r.addEventListener("pause",i._onPlayStop.bind(i)),i.hasLoaded=!1,i.__loaded=!1,i._isSourceReady()?i._onCanPlay():(r.addEventListener("canplay",i._onCanPlay),r.addEventListener("canplaythrough",i._onCanPlay)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},e.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(a.shared.add(this.update,this,s.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0)},e.prototype._onPlayStop=function(){this._isAutoUpdating&&(a.shared.remove(this.update,this),this._isAutoUpdating=!1)},e.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.emit("loaded",this)),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.source.play())},e.prototype.destroy=function(){this._isAutoUpdating&&a.shared.remove(this.update,this),this.source&&this.source._pixiId&&(i.default.removeFromCache(this.source._pixiId),delete this.source._pixiId,this.source.pause(),this.source.src="",this.source.load()),t.prototype.destroy.call(this)},e.fromVideo=function(t,r){t._pixiId||(t._pixiId="video_"+(0,o.uid)());var n=o.BaseTextureCache[t._pixiId];return n||(n=new e(t,r),i.default.addToCache(n,t._pixiId)),n},e.fromUrl=function(t,r,n){var i=document.createElement("video");i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","");var o=Array.isArray(t)?t[0].src||t[0]:t.src||t;if(void 0===n&&0!==o.indexOf("data:")?i.crossOrigin=(0,l.default)(o):n&&(i.crossOrigin="string"==typeof n?n:"anonymous"),Array.isArray(t))for(var a=0;a<t.length;++a)i.appendChild(h(t[a].src||t[a],t[a].mime));else i.appendChild(h(o,t.mime));return i.load(),e.fromVideo(i,r)},n(e,[{key:"autoUpdate",get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(a.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(a.shared.add(this.update,this,s.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0))}}]),e}(i.default);function h(t,e){e||(e="video/"+t.substr(t.lastIndexOf(".")+1));var r=document.createElement("source");return r.src=t,r.type=e,r}e.default=u,u.fromUrls=u.fromUrl},s1jd:function(t,e,r){"use strict";e.__esModule=!0,e.encodeBinary=function(t){for(var e="",r=0;r<t.length;){for(var i=[0,0,0],o=[0,0,0,0],a=0;a<i.length;++a)i[a]=r<t.length?255&t.charCodeAt(r++):0;switch(o[0]=i[0]>>2,o[1]=(3&i[0])<<4|i[1]>>4,o[2]=(15&i[1])<<2|i[2]>>6,o[3]=63&i[2],r-(t.length-1)){case 2:o[3]=64,o[2]=64;break;case 1:o[3]=64}for(var s=0;s<o.length;++s)e+=n.charAt(o[s])}return e};var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},sAjT:function(t,e,r){"use strict";e.__esModule=!0;var n=r("d07J"),i=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?n.Rectangle.EMPTY:((t=t||new n.Rectangle(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addQuad=function(t){var e=this.minX,r=this.minY,n=this.maxX,i=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,i=a>i?a:i,a=t[3],e=(o=t[2])<e?o:e,r=a<r?a:r,n=o>n?o:n,i=a>i?a:i,a=t[5],e=(o=t[4])<e?o:e,r=a<r?a:r,n=o>n?o:n,i=a>i?a:i,a=t[7],e=(o=t[6])<e?o:e,r=a<r?a:r,n=o>n?o:n,i=a>i?a:i,this.minX=e,this.minY=r,this.maxX=n,this.maxY=i},t.prototype.addFrame=function(t,e,r,n,i){var o=t.worldTransform,a=o.a,s=o.b,l=o.c,c=o.d,u=o.tx,h=o.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,v=a*e+l*r+u,g=s*e+c*r+h;d=v<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=s*n+c*r+h,d=(v=a*n+l*r+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=s*e+c*i+h,d=(v=a*e+l*i+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=s*n+c*i+h,d=(v=a*n+l*i+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},t.prototype.addVertices=function(t,e,r,n){for(var i=t.worldTransform,o=i.a,a=i.b,s=i.c,l=i.d,c=i.tx,u=i.ty,h=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=r;m<n;m+=2){var v=e[m],g=e[m+1],y=o*v+s*g+c,x=l*g+a*v+u;h=y<h?y:h,d=x<d?x:d,p=y>p?y:p,f=x>f?x:f}this.minX=h,this.minY=d,this.maxX=p,this.maxY=f},t.prototype.addBounds=function(t){var e=this.minX,r=this.minY,n=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>i?t.maxY:i},t.prototype.addBoundsMask=function(t,e){var r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=i&&n<=o){var a=this.minX,s=this.minY,l=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=n<s?n:s,this.maxX=i>l?i:l,this.maxY=o>c?o:c}},t.prototype.addBoundsArea=function(t,e){var r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=i&&n<=o){var a=this.minX,s=this.minY,l=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=n<s?n:s,this.maxX=i>l?i:l,this.maxY=o>c?o:c}},t}();e.default=i},sBhT:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("3AcN")),o=function(t){return t&&t.__esModule?t:{default:t}}(r("xJsK")),a=new i.Point,s=new i.Polygon,l=function(t){function e(r,n,a,s,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return c._texture=r||o.default.EMPTY,c.uvs=a||new Float32Array([0,0,1,0,1,1,0,1]),c.vertices=n||new Float32Array([0,0,100,0,100,100,0,100]),c.indices=s||new Uint16Array([0,1,3,2]),c.dirty=0,c.indexDirty=0,c.blendMode=i.BLEND_MODES.NORMAL,c.canvasPadding=i.settings.MESH_CANVAS_PADDING,c.drawMode=l||e.DRAW_MODES.TRIANGLE_MESH,c.shader=null,c.tintRgb=new Float32Array([1,1,1]),c._glDatas={},c._uvTransform=new i.TextureMatrix(c._texture),c.uploadUvTransform=!1,c.pluginName="mesh",c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._renderWebGL=function(t){this.refresh(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._renderCanvas=function(t){this.refresh(),t.plugins[this.pluginName].render(this)},e.prototype._onTextureUpdate=function(){this._uvTransform.texture=this._texture,this.refresh()},e.prototype.multiplyUvs=function(){this.uploadUvTransform||this._uvTransform.multiplyUvs(this.uvs)},e.prototype.refresh=function(t){this._uvTransform.update(t)&&this._refresh()},e.prototype._refresh=function(){},e.prototype._calculateBounds=function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,a);for(var r=this.vertices,n=s.points,i=this.indices,o=this.indices.length,l=this.drawMode===e.DRAW_MODES.TRIANGLES?3:1,c=0;c+2<o;c+=l){var u=2*i[c],h=2*i[c+1],d=2*i[c+2];if(n[0]=r[u],n[1]=r[u+1],n[2]=r[h],n[3]=r[h+1],n[4]=r[d],n[5]=r[d+1],s.contains(a.x,a.y))return!0}return!1},n(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}},{key:"tint",get:function(){return i.utils.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=i.utils.hex2rgb(t,this.tintRgb)}}]),e}(i.Container);e.default=l,l.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},sEJ7:function(t,e,r){"use strict";if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!global.performance||!global.performance.now){var n=Date.now();global.performance||(global.performance={}),global.performance.now=function(){return Date.now()-n}}for(var i=Date.now(),o=["ms","moz","webkit","o"],a=0;a<o.length&&!global.requestAnimationFrame;++a){var s=o[a];global.requestAnimationFrame=global[s+"RequestAnimationFrame"],global.cancelAnimationFrame=global[s+"CancelAnimationFrame"]||global[s+"CancelRequestAnimationFrame"]}global.requestAnimationFrame||(global.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),r=16+i-e;return r<0&&(r=0),i=e,setTimeout(function(){i=Date.now(),t(performance.now())},r)}),global.cancelAnimationFrame||(global.cancelAnimationFrame=function(t){return clearTimeout(t)})},"t/7c":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("pVcz")),i=r("pQYt"),o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=this.renderer,r=e.context,n=t.worldAlpha,o=t.transform.worldTransform,a=e.resolution;this._prevTint!==this.tint&&(this.dirty=!0),r.setTransform(o.a*a,o.b*a,o.c*a,o.d*a,o.tx*a,o.ty*a),t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),e.setBlendMode(t.blendMode);for(var s=0;s<t.graphicsData.length;s++){var l=t.graphicsData[s],c=l.shape,u=l._fillTint,h=l._lineTint;if(r.lineWidth=l.lineWidth,l.type===i.SHAPES.POLY){r.beginPath(),this.renderPolygon(c.points,c.closed,r);for(var d=0;d<l.holes.length;d++)this.renderPolygon(l.holes[d].points,!0,r);l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}else if(l.type===i.SHAPES.RECT)(l.fillColor||0===l.fillColor)&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fillRect(c.x,c.y,c.width,c.height)),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.strokeRect(c.x,c.y,c.width,c.height));else if(l.type===i.SHAPES.CIRC)r.beginPath(),r.arc(c.x,c.y,c.radius,0,2*Math.PI),r.closePath(),l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke());else if(l.type===i.SHAPES.ELIP){var p=2*c.width,f=2*c.height,m=c.x-p/2,v=c.y-f/2;r.beginPath();var g=p/2*.5522848,y=f/2*.5522848,x=m+p,b=v+f,w=m+p/2,_=v+f/2;r.moveTo(m,_),r.bezierCurveTo(m,_-y,w-g,v,w,v),r.bezierCurveTo(w+g,v,x,_-y,x,_),r.bezierCurveTo(x,_+y,w+g,b,w,b),r.bezierCurveTo(w-g,b,m,_+y,m,_),r.closePath(),l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}else if(l.type===i.SHAPES.RREC){var S=c.x,T=c.y,M=c.width,A=c.height,E=c.radius,C=Math.min(M,A)/2|0;E=E>C?C:E,r.beginPath(),r.moveTo(S,T+E),r.lineTo(S,T+A-E),r.quadraticCurveTo(S,T+A,S+E,T+A),r.lineTo(S+M-E,T+A),r.quadraticCurveTo(S+M,T+A,S+M,T+A-E),r.lineTo(S+M,T+E),r.quadraticCurveTo(S+M,T,S+M-E,T),r.lineTo(S+E,T),r.quadraticCurveTo(S,T,S,T+E),r.closePath(),(l.fillColor||0===l.fillColor)&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}}},t.prototype.updateGraphicsTint=function(t){t._prevTint=t.tint;for(var e=(t.tint>>16&255)/255,r=(t.tint>>8&255)/255,n=(255&t.tint)/255,i=0;i<t.graphicsData.length;++i){var o=t.graphicsData[i],a=0|o.fillColor,s=0|o.lineColor;o._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*r*255<<8)+(255&a)/255*n*255,o._lineTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*r*255<<8)+(255&s)/255*n*255}},t.prototype.renderPolygon=function(t,e,r){r.moveTo(t[0],t[1]);for(var n=1;n<t.length/2;++n)r.lineTo(t[2*n],t[2*n+1]);e&&r.closePath()},t.prototype.destroy=function(){this.renderer=null},t}();e.default=o,n.default.registerPlugin("graphics",o)},u62O:function(t,e,r){"use strict";t.exports=function(t,e){for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[(e=e||{}).strictMode?"strict":"loose"].exec(t),i={},o=14;o--;)i[r.key[o]]=n[o]||"";return i[r.q.name]={},i[r.key[12]].replace(r.q.parser,function(t,e,n){e&&(i[r.q.name][e]=n)}),i}},uQ0E:function(t,e,r){"use strict";function n(t,e){if(t&&e)for(var r=Object.keys(e),n=0;n<r.length;++n){var i=r[n];Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}}e.__esModule=!0,e.mixin=n,e.delayMixin=function(t,e){i.push(t,e)},e.performMixins=function(){for(var t=0;t<i.length;t+=2)n(i[t],i[t+1]);i.length=0};var i=[]},"uc/I":function(t,e,r){"use strict";e.__esModule=!0,e.autoDetectRenderer=function(t,e,r,a){var s=t&&t.forceCanvas;return void 0!==a&&(s=a),!s&&n.isWebGLSupported()?new o.default(t,e,r):new i.default(t,e,r)};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("qp2T")),i=a(r("pVcz")),o=a(r("pV5o"));function a(t){return t&&t.__esModule?t:{default:t}}},uhBA:function(t,e,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),s.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)n.call(t,e)&&r.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},s.prototype.listeners=function(t,e){var r=this._events[i?i+t:t];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=new Array(o);n<o;n++)a[n]=r[n].fn;return a},s.prototype.emit=function(t,e,r,n,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var l,c,u=this._events[s],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,n),!0;case 5:return u.fn.call(u.context,e,r,n,o),!0;case 6:return u.fn.call(u.context,e,r,n,o,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,r);break;case 4:u[c].fn.call(u[c].context,e,r,n);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},s.prototype.on=function(t,e,r){var n=new a(e,r||this),o=i?i+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},s.prototype.once=function(t,e,r){var n=new a(e,r||this,!0),o=i?i+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},s.prototype.removeListener=function(t,e,r,n){var a=i?i+t:t;if(!this._events[a])return this;if(!e)return 0==--this._eventsCount?this._events=new o:delete this._events[a],this;var s=this._events[a];if(s.fn)s.fn!==e||n&&!s.once||r&&s.context!==r||(0==--this._eventsCount?this._events=new o:delete this._events[a]);else{for(var l=0,c=[],u=s.length;l<u;l++)(s[l].fn!==e||n&&!s[l].once||r&&s[l].context!==r)&&c.push(s[l]);c.length?this._events[a]=1===c.length?c[0]:c:0==--this._eventsCount?this._events=new o:delete this._events[a]}return this},s.prototype.removeAllListeners=function(t){var e;return t?this._events[e=i?i+t:t]&&(0==--this._eventsCount?this._events=new o:delete this._events[e]):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=i,s.EventEmitter=s,t.exports=s},ujOt:function(t,e){var r={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};t.exports=function(t){return r[t]}},vUM4:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("pQYt"),o=r("qp2T"),a={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:i.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,wordWrap:!1,wordWrapWidth:100,leading:0},s=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.styleID=0,this.reset(),u(this,e,e)}return t.prototype.clone=function(){var e={};return u(e,this,a),new t(e)},t.prototype.reset=function(){u(this,a,a)},t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var r=e.length-1;r>=0;r--){var n=e[r].trim();/([\"\'])[^\'\"]+\1/.test(n)||(n='"'+n+'"'),e[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},n(t,[{key:"align",get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)}},{key:"breakWords",get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}},{key:"dropShadow",get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}},{key:"dropShadowAlpha",get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}},{key:"dropShadowAngle",get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}},{key:"dropShadowBlur",get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}},{key:"dropShadowColor",get:function(){return this._dropShadowColor},set:function(t){var e=c(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}},{key:"dropShadowDistance",get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}},{key:"fill",get:function(){return this._fill},set:function(t){var e=c(t);this._fill!==e&&(this._fill=e,this.styleID++)}},{key:"fillGradientType",get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}},{key:"fillGradientStops",get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}},{key:"fontVariant",get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}},{key:"leading",get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)}},{key:"stroke",get:function(){return this._stroke},set:function(t){var e=c(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}},{key:"strokeThickness",get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}},{key:"textBaseline",get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}},{key:"trim",get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}},{key:"wordWrapWidth",get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}}]),t}();function l(t){return"number"==typeof t?(0,o.hex2string)(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function c(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=l(t[e]);return t}return l(t)}function u(t,e,r){for(var n in r)t[n]=Array.isArray(e[n])?e[n].slice():e[n]}e.default=s},"w0v+":function(t,e,r){"use strict";var n=r(null),i=r(null),o=r(null),a=r(null),s=r(null),l=r(null),c=r(null),u=r(null),h=r(null),d=r(null),p=r(null),f=r(null),m=r(null),v=r(null),g=(r(null),r(null)),y=(r(null),r(null),r(null),r(null)),x=r(null),b=r(null),w=r(null),_=r(null),S=r(null),T=r(null),M=r(null),A=r(null),E=r(null);function C(t,e){for(let r=0,n=e.length;r<n;r++){const n=e[r],i=Object.getOwnPropertyNames(n.prototype);for(let e=0,r=i.length;e<r;e++){const r=i[e];t.prototype[r]=n.prototype[r]}}}var P=r(null),O=r(null),N=r(null),L=r(null),I=r(null),R=r(null),D=r(null),F=r(null),U=r(null),k=r(null),B=r(null),j=r(null),z=r(null),V=r(null),G=r(null),H=r(null),W=r(null),X=r(null),Y=r(null),q=r(null),J=r(null),Z=r(null),Q=r(null),K=r(null),$=r(null);r.d(e,"config",function(){return n.a}),r.d(e,"InnerSubscriber",function(){return i.a}),r.d(e,"OuterSubscriber",function(){return o.a}),r.d(e,"Scheduler",function(){return a.a}),r.d(e,"AnonymousSubject",function(){return s.c}),r.d(e,"SubjectSubscription",function(){return l.a}),r.d(e,"Subscriber",function(){return c.a}),r.d(e,"fromPromise",function(){return u.a}),r.d(e,"fromIterable",function(){return h.a}),r.d(e,"ajax",function(){return d.a}),r.d(e,"webSocket",function(){return p.a}),r.d(e,"ajaxGet",function(){}),r.d(e,"ajaxPost",function(){}),r.d(e,"ajaxDelete",function(){}),r.d(e,"ajaxPut",function(){}),r.d(e,"ajaxPatch",function(){}),r.d(e,"ajaxGetJSON",function(){}),r.d(e,"AjaxObservable",function(){return f.a}),r.d(e,"AjaxSubscriber",function(){}),r.d(e,"AjaxResponse",function(){}),r.d(e,"AjaxError",function(){}),r.d(e,"AjaxTimeoutError",function(){}),r.d(e,"WebSocketSubject",function(){return m.a}),r.d(e,"CombineLatestOperator",function(){return v.a}),r.d(e,"dispatch",function(){}),r.d(e,"SubscribeOnObservable",function(){return g.a}),r.d(e,"Timestamp",function(){}),r.d(e,"TimeInterval",function(){}),r.d(e,"GroupedObservable",function(){}),r.d(e,"defaultThrottleConfig",function(){return y.b}),r.d(e,"rxSubscriber",function(){return x.a}),r.d(e,"iterator",function(){return b.a}),r.d(e,"observable",function(){return w.a}),r.d(e,"ArgumentOutOfRangeError",function(){return _.a}),r.d(e,"EmptyError",function(){return S.a}),r.d(e,"Immediate",function(){return T.a}),r.d(e,"ObjectUnsubscribedError",function(){return M.a}),r.d(e,"TimeoutError",function(){return A.a}),r.d(e,"UnsubscriptionError",function(){return E.a}),r.d(e,"applyMixins",function(){return C}),r.d(e,"errorObject",function(){return P.a}),r.d(e,"hostReportError",function(){return O.a}),r.d(e,"identity",function(){return N.a}),r.d(e,"isArray",function(){return L.a}),r.d(e,"isArrayLike",function(){return I.a}),r.d(e,"isDate",function(){return R.a}),r.d(e,"isFunction",function(){return D.a}),r.d(e,"isIterable",function(){return F.a}),r.d(e,"isNumeric",function(){return U.a}),r.d(e,"isObject",function(){return k.a}),r.d(e,"isObservable",function(){return B.a}),r.d(e,"isPromise",function(){return j.a}),r.d(e,"isScheduler",function(){return z.a}),r.d(e,"noop",function(){return V.a}),r.d(e,"not",function(){return G.a}),r.d(e,"pipe",function(){return H.b}),r.d(e,"root",function(){return W.a}),r.d(e,"subscribeTo",function(){return X.a}),r.d(e,"subscribeToArray",function(){return Y.a}),r.d(e,"subscribeToIterable",function(){return q.a}),r.d(e,"subscribeToObservable",function(){return J.a}),r.d(e,"subscribeToPromise",function(){return Z.a}),r.d(e,"subscribeToResult",function(){return Q.a}),r.d(e,"toSubscriber",function(){return K.a}),r.d(e,"tryCatch",function(){return $.a})},xD7H:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e){var r=i;r=(r=r.replace(/%count%/gi,e)).replace(/%forloop%/gi,function(t){var e="";e+="\n",e+="\n";for(var r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+="if(textureId == "+r+".0)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"}(e));for(var o=new n.default(t,"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n",r),a=[],s=0;s<e;s++)a[s]=s;return o.bind(),o.uniforms.uSamplers=a,o};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("N0WC"));r("2U8Y");var i=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","float textureId = floor(vTextureId+0.5);","%forloop%","gl_FragColor = color * vColor;","}"].join("\n")},xJsK:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=h(r("3Jm9")),o=h(r("s1PF")),a=h(r("963y")),s=h(r("uhBA")),l=r("d07J"),c=r("qp2T"),u=h(r("Yd/J"));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(r,n,i,o,a){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));if(s.noFrame=!1,n||(s.noFrame=!0,n=new l.Rectangle(0,0,1,1)),r instanceof e&&(r=r.baseTexture),s.baseTexture=r,s._frame=n,s.trim=o,s.valid=!1,s.requiresUpdate=!1,s._uvs=null,s.orig=i||n,s._rotate=Number(a||0),!0===a)s._rotate=2;else if(s._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return r.hasLoaded?(s.noFrame&&(n=new l.Rectangle(0,0,r.width,r.height),r.on("update",s.onBaseTextureUpdated,s)),s.frame=n):r.once("loaded",s.onBaseTextureLoaded,s),s._updateID=0,s.transform=null,s.textureCacheIds=[],s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.update=function(){this.baseTexture.update()},e.prototype.onBaseTextureLoaded=function(t){this._updateID++,this.frame=this.noFrame?new l.Rectangle(0,0,t.width,t.height):this._frame,this.baseTexture.on("update",this.onBaseTextureUpdated,this),this.emit("update",this)},e.prototype.onBaseTextureUpdated=function(t){this._updateID++,this._frame.width=t.width,this._frame.height=t.height,this.emit("update",this)},e.prototype.destroy=function(t){this.baseTexture&&(t&&(c.TextureCache[this.baseTexture.imageUrl]&&e.removeFromCache(this.baseTexture.imageUrl),this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)},e.prototype._updateUvs=function(){this._uvs||(this._uvs=new a.default),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.fromImage=function(t,r,n,o){var a=c.TextureCache[t];return a||(a=new e(i.default.fromImage(t,r,n,o)),e.addToCache(a,t)),a},e.fromFrame=function(t){var e=c.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return e},e.fromCanvas=function(t,r){return new e(i.default.fromCanvas(t,r,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas"))},e.fromVideo=function(t,r){return"string"==typeof t?e.fromVideoUrl(t,r):new e(o.default.fromVideo(t,r))},e.fromVideoUrl=function(t,r){return new e(o.default.fromUrl(t,r))},e.from=function(t){return"string"==typeof t?c.TextureCache[t]||(null!==t.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?e.fromVideoUrl(t):e.fromImage(t)):t instanceof HTMLImageElement?new e(i.default.from(t)):t instanceof HTMLCanvasElement?e.fromCanvas(t,u.default.SCALE_MODE,"HTMLCanvasElement"):t instanceof HTMLVideoElement?e.fromVideo(t):t instanceof i.default?new e(t):t},e.fromLoader=function(t,r,n){var o=new i.default(t,void 0,(0,c.getResolutionOfUrl)(r)),a=new e(o);return o.imageUrl=r,n||(n=r),i.default.addToCache(a.baseTexture,n),e.addToCache(a,n),n!==r&&(i.default.addToCache(a.baseTexture,r),e.addToCache(a,r)),a},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),c.TextureCache[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),c.TextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=c.TextureCache[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete c.TextureCache[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)c.TextureCache[t.textureCacheIds[n]]===t&&delete c.TextureCache[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},n(e,[{key:"frame",get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,r=t.y,n=t.width,i=t.height,o=e+n>this.baseTexture.width,a=r+i>this.baseTexture.height;if(o||a)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: X: "+e+" + "+n+" = "+(e+n)+" > "+this.baseTexture.width+" "+(o&&a?"and":"or")+" Y: "+r+" + "+i+" = "+(r+i)+" > "+this.baseTexture.height);this.valid=n&&i&&this.baseTexture.hasLoaded,this.trim||this.rotate||(this.orig=t),this.valid&&this._updateUvs()}},{key:"rotate",get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this._updateUvs()}},{key:"width",get:function(){return this.orig.width}},{key:"height",get:function(){return this.orig.height}}]),e}(s.default);function p(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}e.default=d,d.EMPTY=new d(new i.default),p(d.EMPTY),p(d.EMPTY.baseTexture),d.WHITE=function(){var t=document.createElement("canvas");t.width=10,t.height=10;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,10,10),new d(new i.default(t))}(),p(d.WHITE),p(d.WHITE.baseTexture)},"xXZ/":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.fn=e,this.context=r,this.priority=n,this.once=i,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return e=e||null,this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.previous;return this.next=t?null:e,this.previous=null,e},t}();e.default=n},xnYG:function(t,e,r){"use strict";Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1})},xqnD:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){return n.default.tablet||n.default.phone?4:t};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("G9Ht"))},"y/pH":function(t,e,r){"use strict";e.__esModule=!0;var n=r("JehY");Object.defineProperty(e,"FXAAFilter",{enumerable:!0,get:function(){return h(n).default}});var i=r("Is4P");Object.defineProperty(e,"NoiseFilter",{enumerable:!0,get:function(){return h(i).default}});var o=r("fS4Z");Object.defineProperty(e,"DisplacementFilter",{enumerable:!0,get:function(){return h(o).default}});var a=r("dyai");Object.defineProperty(e,"BlurFilter",{enumerable:!0,get:function(){return h(a).default}});var s=r("I42F");Object.defineProperty(e,"BlurXFilter",{enumerable:!0,get:function(){return h(s).default}});var l=r("ASAs");Object.defineProperty(e,"BlurYFilter",{enumerable:!0,get:function(){return h(l).default}});var c=r("Y8mV");Object.defineProperty(e,"ColorMatrixFilter",{enumerable:!0,get:function(){return h(c).default}});var u=r("jK9F");function h(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"AlphaFilter",{enumerable:!0,get:function(){return h(u).default}})},"yI/K":function(t,e,r){var n={createContext:r("K9TQ"),setVertexAttribArrays:r("JUUD"),GLBuffer:r("HNzc"),GLFramebuffer:r("FNZ9"),GLShader:r("P2LE"),GLTexture:r("B7f1"),VertexArrayObject:r("nd3L"),shader:r("l0yf")};void 0!==t&&t.exports&&(t.exports=n),"undefined"!=typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=n)},yY4z:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var a=t.shape,s=a.x,c=a.y,u=a.width,h=a.height,d=a.radius,p=[];if(p.push(s,c+d),l(s,c+h-d,s,c+h,s+d,c+h,p),l(s+u-d,c+h,s+u,c+h,s+u,c+h-d,p),l(s+u,c+d,s+u,c,s+u-d,c,p),l(s+d,c,s,c,s,c+d+1e-10,p),t.fill){for(var f=(0,o.hex2rgb)(t.fillColor),m=t.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,x=e.points,b=e.indices,w=x.length/6,_=(0,n.default)(p,null,2),S=0,T=_.length;S<T;S+=3)b.push(_[S]+w),b.push(_[S]+w),b.push(_[S+1]+w),b.push(_[S+2]+w),b.push(_[S+2]+w);for(var M=0,A=p.length;M<A;M++)x.push(p[M],p[++M],v,g,y,m)}if(t.lineWidth){var E=t.points;t.points=p,(0,i.default)(t,e,r),t.points=E}};var n=a(r("VmRL")),i=a(r("5OzF")),o=r("qp2T");function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e,r){return t+(e-t)*r}function l(t,e,r,n,i,o){for(var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0;f<=20;++f)l=s(t,r,m=f/20),c=s(e,n,m),u=s(r,i,m),h=s(n,o,m),d=s(l,u,m),p=s(c,h,m),a.push(d,p);return a}},yeub:function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},ypnn:function(t,e){t.exports=function(t,e,r){var n=t.byteLength;if(e=e||0,r=r||n,t.slice)return t.slice(e,r);if(e<0&&(e+=n),r<0&&(r+=n),r>n&&(r=n),e>=n||e>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(t),o=new Uint8Array(r-e),a=e,s=0;a<r;a++,s++)o[s]=i[a];return o.buffer}},"z+eP":function(t,e,r){"use strict";var n=r("JkEu").default,i=r("Xwh9").default,o=r("UdPh"),a=r("s1jd");n.Resource=i,n.async=o,n.base64=a,t.exports=n,t.exports.default=n},zJ60:function(t,e,r){var n=r("Uxeu"),i=r("NOtv")("socket.io-client:url");t.exports=function(t,e){var r=t;e=e||global.location,null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),i("parse %s",t),r=n(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port,r.href=r.protocol+"://"+o+(e&&e.port===r.port?"":":"+r.port),r}},zLIK:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("uc/I"),o=c(r("a/Ns")),a=r("8g3p"),s=c(r("Yd/J")),l=r("pQYt");function c(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,r,n,l,c){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),"number"==typeof e&&(e=Object.assign({width:e,height:r||s.default.RENDER_OPTIONS.height,forceCanvas:!!l,sharedTicker:!!c},n)),this._options=e=Object.assign({autoStart:!0,sharedTicker:!1,forceCanvas:!1,sharedLoader:!1},e),this.renderer=(0,i.autoDetectRenderer)(e),this.stage=new o.default,this._ticker=null,this.ticker=e.sharedTicker?a.shared:new a.Ticker,e.autoStart&&this.start()}return t.prototype.render=function(){this.renderer.render(this.stage)},t.prototype.stop=function(){this._ticker.stop()},t.prototype.start=function(){this._ticker.start()},t.prototype.destroy=function(t){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}this.stage.destroy(),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},n(t,[{key:"ticker",set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,l.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}},{key:"view",get:function(){return this.renderer.view}},{key:"screen",get:function(){return this.renderer.screen}}]),t}();e.default=u},zMFY:function(t,e){function r(){}t.exports=function(t,e,n){var i=!1;return n=n||r,o.count=t,0===t?e():o;function o(t,r){if(o.count<=0)throw new Error("after called too many times");--o.count,t?(i=!0,e(t),e=n):0!==o.count||i||e(null,r)}}},zUnb:function(t,e,r){"use strict";r.r(e);var n={};function i(t){return"function"==typeof t}r.d(n,"audit",function(){return AM}),r.d(n,"auditTime",function(){return PM}),r.d(n,"buffer",function(){return eT}),r.d(n,"bufferCount",function(){return iT}),r.d(n,"bufferTime",function(){return lT}),r.d(n,"bufferToggle",function(){return fT}),r.d(n,"bufferWhen",function(){return gT}),r.d(n,"catchError",function(){return Ai}),r.d(n,"combineAll",function(){return wT}),r.d(n,"combineLatest",function(){return XE}),r.d(n,"concat",function(){return YE}),r.d(n,"concatAll",function(){return ka}),r.d(n,"concatMap",function(){return Ri}),r.d(n,"concatMapTo",function(){return _T}),r.d(n,"count",function(){return ST}),r.d(n,"debounce",function(){return PT}),r.d(n,"debounceTime",function(){return LT}),r.d(n,"defaultIfEmpty",function(){return Sa}),r.d(n,"delay",function(){return UT}),r.d(n,"delayWhen",function(){return jT}),r.d(n,"dematerialize",function(){return AT}),r.d(n,"distinct",function(){return HT}),r.d(n,"distinctUntilChanged",function(){return YT}),r.d(n,"distinctUntilKeyChanged",function(){return ZT}),r.d(n,"elementAt",function(){return sM}),r.d(n,"every",function(){return Na}),r.d(n,"exhaust",function(){return KT}),r.d(n,"exhaustMap",function(){return eM}),r.d(n,"expand",function(){return iM}),r.d(n,"filter",function(){return Di}),r.d(n,"finalize",function(){return lM}),r.d(n,"find",function(){return dM}),r.d(n,"findIndex",function(){return mM}),r.d(n,"first",function(){return Oa}),r.d(n,"groupBy",function(){return vM}),r.d(n,"ignoreElements",function(){return bM}),r.d(n,"isEmpty",function(){return SM}),r.d(n,"last",function(){return Aa}),r.d(n,"map",function(){return G}),r.d(n,"mapTo",function(){return NM}),r.d(n,"materialize",function(){return RM}),r.d(n,"max",function(){return UM}),r.d(n,"merge",function(){return qE}),r.d(n,"mergeAll",function(){return K}),r.d(n,"mergeMap",function(){return q}),r.d(n,"flatMap",function(){return q}),r.d(n,"mergeMapTo",function(){return BM}),r.d(n,"mergeScan",function(){return zM}),r.d(n,"min",function(){return HM}),r.d(n,"multicast",function(){return ot}),r.d(n,"observeOn",function(){return JS}),r.d(n,"onErrorResumeNext",function(){return WM}),r.d(n,"pairwise",function(){return qM}),r.d(n,"partition",function(){return QM}),r.d(n,"pluck",function(){return KM}),r.d(n,"publish",function(){return $M}),r.d(n,"publishBehavior",function(){return tA}),r.d(n,"publishLast",function(){return rA}),r.d(n,"publishReplay",function(){return eA}),r.d(n,"race",function(){return nA}),r.d(n,"reduce",function(){return Ua}),r.d(n,"repeat",function(){return iA}),r.d(n,"repeatWhen",function(){return sA}),r.d(n,"retry",function(){return uA}),r.d(n,"retryWhen",function(){return pA}),r.d(n,"refCount",function(){return tt}),r.d(n,"sample",function(){return vA}),r.d(n,"sampleTime",function(){return xA}),r.d(n,"scan",function(){return Ra}),r.d(n,"sequenceEqual",function(){return _A}),r.d(n,"share",function(){return lt}),r.d(n,"shareReplay",function(){return MA}),r.d(n,"single",function(){return AA}),r.d(n,"skip",function(){return PA}),r.d(n,"skipLast",function(){return LA}),r.d(n,"skipUntil",function(){return DA}),r.d(n,"skipWhile",function(){return kA}),r.d(n,"startWith",function(){return zA}),r.d(n,"subscribeOn",function(){return YA}),r.d(n,"switchAll",function(){return KA}),r.d(n,"switchMap",function(){return JA}),r.d(n,"switchMapTo",function(){return tE}),r.d(n,"take",function(){return Ea}),r.d(n,"takeLast",function(){return va}),r.d(n,"takeUntil",function(){return eE}),r.d(n,"takeWhile",function(){return iE}),r.d(n,"tap",function(){return xa}),r.d(n,"throttle",function(){return lE}),r.d(n,"throttleTime",function(){return hE}),r.d(n,"throwIfEmpty",function(){return _a}),r.d(n,"timeInterval",function(){return mE}),r.d(n,"timeout",function(){return wE}),r.d(n,"timeoutWith",function(){return yE}),r.d(n,"timestamp",function(){return _E}),r.d(n,"toArray",function(){return ME}),r.d(n,"window",function(){return AE}),r.d(n,"windowCount",function(){return PE}),r.d(n,"windowTime",function(){return LE}),r.d(n,"windowToggle",function(){return FE}),r.d(n,"windowWhen",function(){return BE}),r.d(n,"withLatestFrom",function(){return VE}),r.d(n,"zip",function(){return JE}),r.d(n,"zipAll",function(){return WE});let o=!1;const a={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){o=t},get useDeprecatedSynchronousErrorHandling(){return o}},s={closed:!0,next(t){},error(t){if(a.useDeprecatedSynchronousErrorHandling)throw t},complete(){}},l=Array.isArray||(t=>t&&"number"==typeof t.length);function c(t){return null!=t&&"object"==typeof t}const u={e:{}};let h;function d(){try{return h.apply(this,arguments)}catch(t){return u.e=t,u}}function p(t){return h=t,d}class f extends Error{constructor(t){this.errors=t,this.name="UnsubscriptionError"}}class m{constructor(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}unsubscribe(){let t,e=!1;if(this.closed)return;let{_parent:r,_parents:n,_unsubscribe:o,_subscriptions:a}=this;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;let s=-1,h=n?n.length:0;for(;r;)r=++s<h&&n[s]||null;if(i(o)&&p(o).call(this)===u&&(e=!0,t=t||(u.e instanceof f?v(u.e.errors):[u.e])),l(a))for(s=-1,h=a.length;++s<h;){const r=a[s];if(c(r)&&p(r.unsubscribe).call(r)===u){e=!0,t=t||[];let r=u.e;r instanceof f&&(t=t.concat(v(r.errors)))}}if(e)throw new f(t)}add(t){if(!t||t===m.EMPTY)return m.EMPTY;if(t===this)return this;let e=t;switch(typeof t){case"function":e=new m(t);case"object":if(e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e;if("function"!=typeof e._addParent){const t=e;(e=new m)._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return this._subscriptions||(this._subscriptions=[]),e}remove(t){}_addParent(t){let{_parent:e,_parents:r}=this;e&&e!==t?r||(this._parents=[t]):this._parent=t}}function v(t){return t.reduce((t,e)=>t.concat(e instanceof f?e.errors:e),[])}m.EMPTY=function(t){return t.closed=!0,t}(new m);const g="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("rxSubscriber"):"@@rxSubscriber";class y extends m{constructor(t,e,r){switch(this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=s;break;case 1:if(!t){this.destination=s;break}if("object"==typeof t){if(function(e){return t instanceof y||"syncErrorThrowable"in t&&t[g]}()){const e=t[g]();this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e}else this.syncErrorThrowable=!0,this.destination=new x(this,t);break}default:this.syncErrorThrowable=!0,this.destination=new x(this,t,e,r)}}[g](){return this}static create(t,e,r){const n=new y(t,e,r);return n.syncErrorThrowable=!1,n}next(t){}error(t){this.isStopped||(this.isStopped=!0)}complete(){this.isStopped||(this.isStopped=!0)}unsubscribe(){this.closed||(this.isStopped=!0)}_next(t){}_error(t){}_complete(){}_unsubscribeAndRecycle(){const{_parent:t,_parents:e}=this;return this._parent=null,this._parents=null,this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this}}class x extends y{constructor(t,e,r,n){let o;this._parentSubscriber=t;let a=this;i(e)?o=e:e&&(o=e.next,r=e.error,n=e.complete,e!==s&&(i((a=Object.create(e)).unsubscribe),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=o,this._error=r,this._complete=n}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;a.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&this.__tryOrSetError(e,this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:r}=a;if(this._error);else if(e.syncErrorThrowable)r&&(e.syncErrorValue=t,e.syncErrorThrown=!0);else if(r)throw t}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this}}__tryOrUnsub(t,e){}__tryOrSetError(t,e,r){if(!a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null}}const b="function"==typeof Symbol&&Symbol.observable||"@@observable";function w(){}function _(...t){return S(t)}function S(t){return t?1===t.length?t[0]:function(e){return t.reduce((t,e)=>e(t),e)}:w}class T{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const e=new T;return e.source=this,e.operator=t,e}subscribe(t,e,r){const{operator:n}=this,i=function(t,e,r){if(t){if(t instanceof y)return t;if(t[g])return t[g]()}return t||e||r?new y(t,e,r):new y(s)}(t,e,r);if(a.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(t){try{return this._subscribe(t)}catch(e){a.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e)}}forEach(t,e){return new(e=M(e))((t,e)=>{let r;r=this.subscribe(t=>{},e,t)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[b](){return this}pipe(...t){return 0===t.length?this:S(t)(this)}toPromise(t){return new(t=M(t))((t,e)=>{})}}function M(t){if(t||(t=a.Promise||Promise),!t)throw new Error("no Promise impl found");return t}T.create=(t=>new T(t));class A extends Error{constructor(){this.name="ObjectUnsubscribedError"}}class E extends m{constructor(t,e){this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){this.closed||(this.closed=!0,this.subject=null)}}class C extends y{constructor(t){this.destination=t}}class P extends T{constructor(){this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[g](){return new C(this)}lift(t){const e=new O(this,this);return e.operator=t,e}next(t){if(this.closed)throw new A;if(!this.isStopped){const{observers:t}=this,e=t.length;for(let r=0;r<e;r++);}}error(t){if(this.closed)throw new A;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,r=e.length;for(let n=0;n<r;n++);this.observers.length=0}complete(){if(this.closed)throw new A;this.isStopped=!0;const{observers:t}=this,e=t.length;for(let r=0;r<e;r++);this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new A;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new A;return this.hasError?m.EMPTY:this.isStopped?m.EMPTY:new E(this,t)}asObservable(){const t=new T;return t.source=this,t}}P.create=((t,e)=>new O(t,e));class O extends P{constructor(t,e){this.destination=t,this.source=e}next(t){const{destination:e}=this}error(t){const{destination:e}=this}complete(){const{destination:t}=this}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):m.EMPTY}}function N(t){return t&&"function"==typeof t.schedule}class L extends y{constructor(t,e,r){this.parent=t,this.outerValue=e,this.outerIndex=r,this.index=0}_next(t){this.index++}_error(t){}_complete(){}}const I=t=>e=>{for(let r=0,n=t.length;r<n&&!e.closed;r++);},R=t=>t=>t,D=function(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),F=t=>e=>{const r=t[D]();for(;!r.next().done&&!e.closed;);return e},U=t=>e=>{const r=t[b]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(e)},k=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function B(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const j=t=>{if(t instanceof T)return e=>t._isScalar?void 0:t.subscribe(e);if(k(t))return I(t);if(B(t))return R(t);if(t&&"function"==typeof t[D])return F(t);if(t&&"function"==typeof t[b])return U(t);{const e=`You provided ${c(t)?"an invalid object":`'${t}'`} where a stream was expected.`+" You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(e)}};function z(t,e,r,n){const i=new L(t,r,n);return j(e)(i)}class V extends y{notifyNext(t,e,r,n,i){}notifyError(t,e){}notifyComplete(t){}}function G(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new H(t,e))}}class H{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new W(t,this.project,this.thisArg))}}class W extends y{constructor(t,e,r){this.project=e,this.count=0,this.thisArg=r||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return}}}function X(t,e){return new T(e?r=>{const n=new m;let i=0;return n.add(e.schedule(function(){i!==t.length?(r.next(t[i++]),r.closed||n.add(this.schedule())):r.complete()})),n}:I(t))}function Y(t,e){if(!e)return t instanceof T?t:new T(j(t));if(null!=t){if(function(t){return t&&"function"==typeof t[b]}(t))return function(t,e){return new T(e?r=>{const n=new m;return n.add(e.schedule(()=>{const i=t[b]();n.add(i.subscribe({next(t){n.add(e.schedule(()=>r.next(t)))},error(t){n.add(e.schedule(()=>r.error(t)))},complete(){n.add(e.schedule(()=>r.complete()))}}))})),n}:U(t))}(t,e);if(B(t))return function(t,e){return new T(e?r=>{const n=new m;return n.add(e.schedule(()=>t.then(t=>{n.add(e.schedule(()=>{r.next(t),n.add(e.schedule(()=>r.complete()))}))},t=>{n.add(e.schedule(()=>r.error(t)))}))),n}:R(t))}(t,e);if(k(t))return X(t,e);if(function(t){return t&&"function"==typeof t[D]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new T(e?r=>{const n=new m;let i;return n.add(()=>{i&&"function"==typeof i.return&&i.return()}),n.add(e.schedule(()=>{i=t[D](),n.add(e.schedule(function(){if(r.closed)return;let t,e;try{const n=i.next();t=n.value,e=n.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}))})),n}:F(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function q(t,e,r=Number.POSITIVE_INFINITY){return"function"==typeof e?n=>n.pipe(q((r,n)=>Y(t(r,n)).pipe(G((t,i)=>e(r,t,n,i))),r)):("number"==typeof e&&(r=e),e=>e.lift(new J(t,r)))}class J{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new Z(t,this.project,this.concurrent))}}class Z extends V{constructor(t,e,r=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){}_tryNext(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(t){return}this.active++}_innerSub(t,e,r){}_complete(){this.hasCompleted=!0}notifyNext(t,e,r,n,i){}notifyComplete(t){this.active--}}function Q(t){return t}function K(t=Number.POSITIVE_INFINITY){return q(Q,t)}function $(...t){let e=Number.POSITIVE_INFINITY,r=null,n=t[t.length-1];return N(n)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof n&&(e=t.pop()),null===r&&1===t.length&&t[0]instanceof T?t[0]:K(e)(X(t,r))}function tt(){return function(t){return t.lift(new et(t))}}class et{constructor(t){this.connectable=t}call(t,e){const{connectable:r}=this;r._refCount++;const n=new rt(t,r),i=e.subscribe(n);return n.closed||(n.connection=r.connect()),i}}class rt extends y{constructor(t,e){this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:r}=this;this.connection=null}}const nt=class extends T{constructor(t,e){this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new m).closed?(this._connection=null,t=m.EMPTY):this._connection=t),t}refCount(){return tt()(this)}}.prototype,it={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:nt._subscribe},_isComplete:{value:nt._isComplete,writable:!0},getSubject:{value:nt.getSubject},connect:{value:nt.connect},refCount:{value:nt.refCount}};function ot(t,e){return function(r){let n;if(n="function"==typeof t?t:function(){return t},"function"==typeof e)return r.lift(new at(n,e));const i=Object.create(r,it);return i.source=r,i.subjectFactory=n,i}}class at{constructor(t,e){this.subjectFactory=t,this.selector=e}call(t,e){const{selector:r}=this;return r(this.subjectFactory()).subscribe(t)}}function st(){return new P}function lt(){return t=>tt()(ot(st)(t))}function ct(t){return{providedIn:t.providedIn||null,factory:t.factory,value:void 0}}class ut{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0!==e?ct({providedIn:e.providedIn||"root",factory:e.factory}):void 0}toString(){return`InjectionToken ${this._desc}`}}const ht="__parameters__";function dt(t,e,r){const n=function(t){return function(...e){if(t){const r=t(...e);for(const t in r)this[t]=r[t]}}}(e);function i(...t){if(this instanceof i)return n.apply(this,t),this;const e=new i(...t);return r.annotation=e,r;function r(t,r,n){const i=t.hasOwnProperty(ht)?t[ht]:Object.defineProperty(t,ht,{value:[]})[ht];for(;i.length<=n;)i.push(null);return(i[n]=i[n]||[]).push(e),t}}return r&&(i.prototype=Object.create(r.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}const pt=new ut("AnalyzeForEntryComponents"),ft=Function;function mt(t){return"function"==typeof t}const vt="undefined"!=typeof window&&window,gt="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,yt="undefined"!=typeof global&&global,xt=vt||yt||gt;let bt=null;function wt(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function _t(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(_t).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const r=e.indexOf("\n");return-1===r?e:e.substring(0,r)}const St=/^function\s+\S+\(\)\s*{[\s\S]+\.apply\(this,\s*arguments\)/,Tt=/^class\s+[A-Za-z\d$_]*\s*extends\s+[A-Za-z\d$_]+\s*{/,Mt=/^class\s+[A-Za-z\d$_]*\s*extends\s+[A-Za-z\d$_]+\s*{[\s\S]*constructor\s*\(/;function At(t){return t?t.map(t=>new(0,t.type.annotationCls)(...t.args?t.args:[])):[]}function Et(t){const e=t.prototype?Object.getPrototypeOf(t.prototype):null;return(e?e.constructor:null)||Object}function Ct(t){return t.__forward_ref__=Ct,t.toString=function(){return _t(this())},t}function Pt(t){return"function"==typeof t&&t.hasOwnProperty("__forward_ref__")&&t.__forward_ref__===Ct?t():t}const Ot=dt("Inject",t=>({token:t})),Nt=dt("Optional"),Lt=dt("Self"),It=dt("SkipSelf"),Rt="__source",Dt=new Object,Ft=Dt,Ut=new ut("INJECTOR");class kt{static create(t,e){return Array.isArray(t)?new Xt(t,e):new Xt(t.providers,t.parent,t.name||null)}}kt.THROW_IF_NOT_FOUND=Dt,kt.NULL=new class{get(t,e=Dt){if(e===Dt)throw new Error(`NullInjectorError: No provider for ${_t(t)}!`);return e}},kt.ngInjectableDef=ct({providedIn:"any",factory:()=>(function(t,e=0){if(void 0===Yt)throw new Error("inject() must be called from an injection context");if(null===Yt){const e=t.ngInjectableDef;if(e&&"root"==e.providedIn)return void 0===e.value?e.value=e.factory():e.value;throw new Error(`Injector: NOT_FOUND [${_t(t)}]`)}return Yt.get(t,8&e?null:void 0,e)})(Ut)});const Bt=[],jt=function(t){return t},zt=(String,"ngTokenPath"),Vt="ngTempTokenPath",Gt=kt.NULL,Ht=/\n/gm,Wt="\u0275";class Xt{constructor(t,e=Gt,r=null){this.parent=e,this.source=r,this._records=new Map}get(t,e,r=0){const n=this._records.get(t);try{return function t(e,r,n,i,o,a){try{return function(e,r,n,i,o,a){let s;if(!r||4&a)2&a||(s=i.get(e,o,0));else{if((s=r.value)==jt)throw Error(Wt+"Circular dependency");if(s===Bt){r.value=jt;let e=void 0,o=r.useNew,a=r.fn,l=r.deps,c=Bt;if(l.length){c=[];for(let e=0;e<l.length;e++){const r=l[e],o=r.options,a=2&o?n.get(r.token):void 0;c.push(t(r.token,a,n,a||4&o?i:Gt,1&o?null:kt.THROW_IF_NOT_FOUND,0))}}r.value=s=o?new a(...c):a.apply(e,c)}}return s}(e,r,n,i,o,a)}catch(t){throw t instanceof Error||(t=new Error(t)),(t[Vt]=t[Vt]||[]).unshift(e),r&&r.value==jt&&(r.value=Bt),t}}(t,n,this._records,this.parent,e,r)}catch(t){const e=t[Vt];throw t.message=function(t,e,r=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==Wt?t.substr(2):t;let n=_t(e);if(e instanceof Array)n=e.map(_t).join(" -> ");else if("object"==typeof e){let t=[];for(let r in e)if(e.hasOwnProperty(r)){let n=e[r];t.push(r+":"+("string"==typeof n?JSON.stringify(n):_t(n)))}n=`{${t.join(", ")}}`}return`StaticInjectorError${r?"("+r+")":""}[${n}]: ${t.replace(Ht,"\n  ")}`}("\n"+t.message,e,this.source),t[zt]=e,t[Vt]=null,t}}toString(){return`StaticInjector[${[].join(", ")}]`}}let Yt=void 0;String;const qt=function(){var t={Emulated:0,Native:1,None:2};return t[t.Emulated]="Emulated",t[t.Native]="Native",t[t.None]="None",t}(),Jt="ngDebugContext",Zt="ngOriginalError";function Qt(t){return t[Jt]}function Kt(t){return t[Zt]}class $t{constructor(){this._console=console}handleError(t){}_findContext(t){return t?Qt(t)?Qt(t):this._findContext(Kt(t)):null}_findOriginalError(t){let e=Kt(t);for(;e&&Kt(e);)e=Kt(e);return e}}function te(t){return t.length>1?" ("+function(t){const e=[];for(let r=0;r<t.length;++r){if(e.indexOf(t[r])>-1)return e.push(t[r]),e;e.push(t[r])}return e}(t.slice().reverse()).map(t=>_t(t.token)).join(" -> ")+")":""}function ee(t,e,r,n){const i=[e],o=r(i),a=n?function(t,e){const r=`${o} caused by: ${e instanceof Error?e.message:e}`,n=Error(r);return n[Zt]=e,n}(0,n):Error(o);return a.addKey=re,a.keys=i,a.injectors=[t],a.constructResolvingMessage=r,a[Zt]=n,a}function re(t,e){this.injectors.push(t),this.keys.push(e),this.message=this.constructResolvingMessage(this.keys)}function ne(t,e){const r=[];for(let n=0,i=e.length;n<i;n++){const t=e[n];r.push(t&&0!=t.length?t.map(_t).join(" "):"?")}return Error("Cannot resolve all parameters for '"+_t(t)+"'("+r.join(", ")+"). Make sure that all the parameters are decorated with Inject or have valid type annotations and that '"+_t(t)+"' is decorated with Injectable.")}function ie(t,e){return Error(`Cannot mix multi providers and regular providers, got: ${t} ${e}`)}class ae{constructor(t,e){if(this.token=t,this.id=e,!t)throw new Error("Token must be defined!");this.displayName=_t(this.token)}static get(t){return se.get(Pt(t))}static get numberOfKeys(){return se.numberOfKeys}}const se=new class{constructor(){this._allKeys=new Map}get(t){return t instanceof ae?t:this._allKeys.has(t)?this._allKeys.get(t):new ae(t,ae.numberOfKeys)}get numberOfKeys(){return this._allKeys.size}},le=new class{constructor(t){this.reflectionCapabilities=t}updateCapabilities(t){this.reflectionCapabilities=t}factory(t){return this.reflectionCapabilities.factory(t)}parameters(t){return this.reflectionCapabilities.parameters(t)}annotations(t){return this.reflectionCapabilities.annotations(t)}propMetadata(t){return this.reflectionCapabilities.propMetadata(t)}hasLifecycleHook(t,e){return this.reflectionCapabilities.hasLifecycleHook(t,e)}getter(t){return this.reflectionCapabilities.getter(t)}setter(t){return this.reflectionCapabilities.setter(t)}method(t){return this.reflectionCapabilities.method(t)}importUri(t){return this.reflectionCapabilities.importUri(t)}resourceUri(t){return this.reflectionCapabilities.resourceUri(t)}resolveIdentifier(t,e,r,n){return this.reflectionCapabilities.resolveIdentifier(t,e,r,n)}resolveEnum(t,e){return this.reflectionCapabilities.resolveEnum(t,e)}}(new class{constructor(t){this._reflect=t||xt.Reflect}isReflectionEnabled(){return!0}factory(t){return(...e)=>new t(...e)}_zipTypesAndAnnotations(t,e){let r;r=void 0===t?new Array(e.length):new Array(t.length);for(let n=0;n<r.length;n++)r[n]=void 0===t?[]:t[n]!=Object?[t[n]]:[],e&&null!=e[n]&&(r[n]=r[n].concat(e[n]));return r}_ownParameters(t,e){const r=t.toString();if(St.exec(r)||Tt.exec(r)&&!Mt.exec(r))return null;if(t.parameters&&t.parameters!==e.parameters)return t.parameters;const n=t.ctorParameters;if(n&&n!==e.ctorParameters){const t="function"==typeof n?n():n;return this._zipTypesAndAnnotations(t.map(t=>t&&t.type),t.map(t=>t&&At(t.decorators)))}const i=t.hasOwnProperty(ht)&&t[ht],o=this._reflect&&this._reflect.getOwnMetadata&&this._reflect.getOwnMetadata("design:paramtypes",t);return o||i?this._zipTypesAndAnnotations(o,i):new Array(t.length).fill(void 0)}parameters(t){if(!mt(t))return[];const e=Et(t);let r=this._ownParameters(t,e);return r||e===Object||(r=this.parameters(e)),r||[]}_ownAnnotations(t,e){if(t.annotations&&t.annotations!==e.annotations){let e=t.annotations;return"function"==typeof e&&e.annotations&&(e=e.annotations),e}return t.decorators&&t.decorators!==e.decorators?At(t.decorators):t.hasOwnProperty("__annotations__")?t.__annotations__:null}annotations(t){if(!mt(t))return[];const e=Et(t),r=this._ownAnnotations(t,e)||[];return(e!==Object?this.annotations(e):[]).concat(r)}_ownPropMetadata(t,e){if(t.propMetadata&&t.propMetadata!==e.propMetadata){let e=t.propMetadata;return"function"==typeof e&&e.propMetadata&&(e=e.propMetadata),e}return t.propDecorators&&t.propDecorators!==e.propDecorators?{}:t.hasOwnProperty("__prop__metadata__")?t.__prop__metadata__:null}propMetadata(t){return mt(t)?(Object,{}):{}}hasLifecycleHook(t,e){return t instanceof ft&&e in t.prototype}guards(t){return{}}getter(t){return new Function("o","return o."+t+";")}setter(t){return new Function("o","v","return o."+t+" = v;")}method(t){const e=`if (!o.${t}) throw new Error('"${t}" is undefined');\n        return o.${t}.apply(o, args);`;return new Function("o","args",e)}importUri(t){return"object"==typeof t&&t.filePath?t.filePath:`./${_t(t)}`}resourceUri(t){return`./${_t(t)}`}resolveIdentifier(t,e,r,n){return n}resolveEnum(t,e){return t[e]}});class ce{constructor(t,e,r){this.key=t,this.optional=e,this.visibility=r}static fromKey(t){return new ce(t,!1,null)}}const ue=[];class he{constructor(t,e,r){this.key=t,this.resolvedFactories=e,this.multiProvider=r,this.resolvedFactory=this.resolvedFactories[0]}}class de{constructor(t,e){this.factory=t,this.dependencies=e}}function pe(t){return new he(ae.get(t.provide),[function(t){let e,r;if(t.useClass){const n=Pt(t.useClass);e=le.factory(n),r=fe(n)}else t.useExisting?(e=(t=>t),r=[ce.fromKey(ae.get(t.useExisting))]):t.useFactory?(e=t.useFactory,r=function(t,e){if(e){const r=e.map(t=>[t]);return e.map(e=>me(t,e,r))}return fe(t)}(t.useFactory,t.deps)):(e=(()=>t.useValue),r=ue);return new de(e,r)}(t)],t.multi||!1)}function fe(t){const e=le.parameters(t);if(!e)return[];if(e.some(t=>null==t))throw ne(t,e);return e.map(r=>me(t,r,e))}function me(t,e,r){let n=null,i=!1;if(!Array.isArray(e))return ve(e instanceof Ot?e.token:e,i,null);let o=null;for(let a=0;a<e.length;++a){const t=e[a];t instanceof ft?n=t:t instanceof Ot?n=t.token:t instanceof Nt?i=!0:t instanceof Lt||t instanceof It?o=t:t instanceof ut&&(n=t)}if(null!=(n=Pt(n)))return ve(n,i,o);throw ne(t,r)}function ve(t,e,r){return new ce(ae.get(t),e,r)}const ge=new Object;class ye{static resolve(t){return function(t){const e=function(t,e){for(let r=0;r<t.length;r++){const n=t[r],i=e.get(n.key.id);if(i){if(n.multiProvider!==i.multiProvider)throw ie(i,n);if(n.multiProvider)for(let t=0;t<n.resolvedFactories.length;t++)i.resolvedFactories.push(n.resolvedFactories[t]);else e.set(n.key.id,n)}else{let t;t=n.multiProvider?new he(n.key,n.resolvedFactories.slice(),n.multiProvider):n,e.set(n.key.id,t)}}return e}(function t(e,r){return e.forEach(e=>{if(e instanceof ft)r.push({provide:e,useClass:e});else if(e&&"object"==typeof e&&void 0!==e.provide)r.push(e);else{if(!(e instanceof Array))throw Error(`Invalid provider - only instances of Provider and Type are allowed, got: ${e}`);t(e,r)}}),r}(t,[]).map(pe),new Map);return Array.from(e.values())}(t)}static resolveAndCreate(t,e){return ye.fromResolvedProviders(ye.resolve(t),e)}static fromResolvedProviders(t,e){return new xe(t,e)}}class xe{constructor(t,e){this._constructionCounter=0,this._providers=t,this.parent=e||null;const r=t.length;this.keyIds=new Array(r),this.objs=new Array(r);for(let n=0;n<r;n++)this.keyIds[n]=t[n].key.id,this.objs[n]=ge}get(t,e=Ft){return this._getByKey(ae.get(t),null,e)}resolveAndCreateChild(t){return this.createChildFromResolved(ye.resolve(t))}createChildFromResolved(t){const e=new xe(t);return e.parent=this,e}resolveAndInstantiate(t){return this.instantiateResolved(ye.resolve([t])[0])}instantiateResolved(t){return this._instantiateProvider(t)}getProviderAtIndex(t){if(t<0||t>=this._providers.length)throw function(t){return Error(`Index ${t} is out-of-bounds.`)}(t);return this._providers[t]}_new(t){if(this._constructionCounter++>this._getMaxNumberOfObjects())throw function(e,r){return ee(e,t.key,function(t){return`Cannot instantiate cyclic dependency!${te(t)}`})}(this);return this._instantiateProvider(t)}_getMaxNumberOfObjects(){return this.objs.length}_instantiateProvider(t){if(t.multiProvider){const e=new Array(t.resolvedFactories.length);for(let r=0;r<t.resolvedFactories.length;++r)e[r]=this._instantiate(t,t.resolvedFactories[r]);return e}return this._instantiate(t,t.resolvedFactories[0])}_instantiate(t,e){const r=e.factory;let n,i;try{n=e.dependencies.map(t=>this._getByReflectiveDependency(t))}catch(t){throw t}try{i=r(...n)}catch(e){throw function(e,r,n,i){return ee(e,t.key,function(t){const e=_t(t[0].token);return`${r.message}: Error during instantiation of ${e}!${te(t)}.`},r)}(this,e)}return i}_getByReflectiveDependency(t){return this._getByKey(t.key,t.visibility,t.optional?null:Ft)}_getByKey(t,e,r){return t===xe.INJECTOR_KEY?this:e instanceof Lt?this._getByKeySelf(t,r):this._getByKeyDefault(t,r,e)}_getObjByKeyId(t){for(let e=0;e<this.keyIds.length;e++)if(this.keyIds[e]===t)return this.objs[e]===ge&&(this.objs[e]=this._new(this._providers[e])),this.objs[e];return ge}_throwOrNull(t,e){if(e!==Ft)return e;throw function(t,e){return ee(t,e,function(t){return`No provider for ${_t(t[0].token)}!${te(t)}`})}(this,t)}_getByKeySelf(t,e){const r=this._getObjByKeyId(t.id);return r!==ge?r:this._throwOrNull(t,e)}_getByKeyDefault(t,e,r){let n;for(n=r instanceof It?this.parent:this;n instanceof xe;){const e=n,r=e._getObjByKeyId(t.id);if(r!==ge)return r;n=e.parent}return null!==n?n.get(t.token,e):this._throwOrNull(t,e)}get displayName(){return`ReflectiveInjector(providers: [${function(t,e){const r=new Array(t._providers.length);for(let n=0;n<t._providers.length;++n)r[n]=e(t.getProviderAtIndex(n));return r}(this,t=>' "'+t.key.displayName+'" ').join(", ")}])`}toString(){return this.displayName}}xe.INJECTOR_KEY=ae.get(kt);const be=new ut("The presence of this token marks an injector as being the root injector.");function we(t){return!!t&&"function"==typeof t.then}const _e=new ut("Application Initializer");class Se{constructor(t){this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(!this.initialized){if(this.appInits)for(let t=0;t<this.appInits.length;t++)we(this.appInits[t]());this.initialized=!0}}}const Te=new ut("AppId");function Me(){return`${Ae()}${Ae()}${Ae()}`}function Ae(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Ee=new ut("Platform Initializer"),Ce=new ut("Platform ID"),Pe=new ut("appBootstrapListener");class Oe{log(t){}warn(t){}}function Ne(){throw new Error("Runtime compiler is not loaded")}Oe.ctorParameters=(()=>[]);class Le{compileModuleSync(t){throw Ne()}compileModuleAsync(t){throw Ne()}compileModuleAndAllComponentsSync(t){throw Ne()}compileModuleAndAllComponentsAsync(t){throw Ne()}clearCache(){}clearCacheFor(t){}}class Ie{}class Re{}class De{}function Fe(t){const e=Error(`No component factory found for ${_t(t)}. Did you add it to @NgModule.entryComponents?`);return e[Ue]=t,e}const Ue="ngComponent";class ke{}ke.NULL=new class{resolveComponentFactory(t){throw Fe(t)}};class Be{constructor(t,e,r){this._parent=e,this._ngModule=r,this._factories=new Map;for(let n=0;n<t.length;n++);}resolveComponentFactory(t){let e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw Fe(t);return new je(e,this._ngModule)}}class je extends De{constructor(t,e){this.factory=t,this.ngModule=e,this.selector=t.selector,this.componentType=t.componentType,this.ngContentSelectors=t.ngContentSelectors,this.inputs=t.inputs,this.outputs=t.outputs}create(t,e,r,n){return this.factory.create(t,e,r,n||this.ngModule)}}class ze{}class Ve{}let Ge,He;const We=function(){const t=xt.wtf;return!(!t||!(Ge=t.trace)||(He=Ge.events,0))}()?function(t,e=null){return He.createScope(t,e)}:(t,e)=>(function(t,e){return null});class Xe extends P{constructor(t=!1){this.__isAsync=t}emit(t){}subscribe(t,e,r){let n,i=t=>null,o=()=>null;return t&&"object"==typeof t?(n=(t=>{}),t.error&&(i=(t=>{})),t.complete&&(o=(()=>{}))):(n=(t=>{}),e&&(i=(t=>{})),r&&(o=(()=>{}))),super.subscribe(n,i,o)}}class Ye{constructor({enableLongStackTrace:t=!1}){if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Xe(!1),this.onMicrotaskEmpty=new Xe(!1),this.onStable=new Xe(!1),this.onError=new Xe(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec))}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ye.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Ye.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,r){return this._inner.run(t,e,r)}runTask(t,e,r,n){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+n,t,Je,qe,qe);try{return i.runTask(o,e,r)}finally{}}runGuarded(t,e,r){return this._inner.runGuarded(t,e,r)}runOutsideAngular(t){return this._outer.run(t)}}function qe(){}const Je={};class Ze{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Xe,this.onMicrotaskEmpty=new Xe,this.onStable=new Xe,this.onError=new Xe}run(t){return t()}runGuarded(t){return t()}runOutsideAngular(t){return t()}runTask(t){return t()}}class Qe{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[]}_watchAngularEvents(){}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable());else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(e=>!e.updateCb||!e.updateCb(t)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,isPeriodic:t.data.isPeriodic,delay:t.data.delay,creationLocation:t.creationLocation,xhr:t.data.target})):[]}addCallback(t,e,r){let n=-1;e&&e>0&&(n=setTimeout(()=>{this._callbacks=this._callbacks.filter(t=>t.timeoutId!==n)},e))}whenStable(t,e,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?')}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,r){return[]}}class Ke{constructor(){this._applications=new Map}registerApplication(t,e){}unregisterApplication(t){}unregisterAllApplications(){}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return tr.findTestabilityInTree(this,t,e)}}Ke.ctorParameters=(()=>[]);let $e,tr=new class{addToWindow(t){}findTestabilityInTree(t,e,r){return null}},er=!0,rr=!1;const nr=new ut("AllowMultipleToken");function ir(){return rr=!0,er}class or{constructor(t,e){this.name=t,this.token=e}}function ar(t,e,r=[]){const n=`Platform: ${e}`,i=new ut(n);return(e=[])=>{let o=sr();if(!o||o.injector.get(nr,!1))if(t)t(r.concat(e).concat({provide:i,useValue:!0}));else{const t=r.concat(e).concat({provide:i,useValue:!0});!function(t){if($e&&!$e.destroyed&&!$e.injector.get(nr,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");$e=t.get(lr);const e=t.get(Ee,null);e&&e.forEach(t=>t())}(kt.create({providers:t,name:n}))}return function(t){const e=sr();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function sr(){return $e&&!$e.destroyed?$e:null}class lr{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const r=function(t){return"noop"===t?new Ze:("zone.js"===t?void 0:t)||new Ye({enableLongStackTrace:ir()})}(e?e.ngZone:void 0),n=[{provide:Ye,useValue:r}];return r.run(()=>{const e=t.create(kt.create({providers:n,parent:this.injector,name:t.moduleType.name})),i=e.injector.get($t,null);if(!i)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return function(t,r,n){try{const n=e.injector.get(Se).donePromise.then(()=>e);return we(n)?n.catch(e=>{throw r.runOutsideAngular(()=>t.handleError(e)),e}):n}catch(e){throw r.runOutsideAngular(()=>t.handleError(e)),e}}(i,r)})}bootstrapModule(t,e=[]){const r=this.injector.get(Ie),n=cr({},e);return r.createCompiler([n]).compileModuleAsync(t).then(t=>this.bootstrapModuleFactory(t,n))}_moduleDoBootstrap(t){if(t._bootstrapComponents.length>0);else if(!t.instance.ngDoBootstrap)throw new Error(`The module ${_t(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. `+"Please define one of these.")}onDestroy(t){}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._destroyed=!0}get destroyed(){return this._destroyed}}function cr(t,e){return Array.isArray(e)?e.reduce(cr,t):Object.assign({},t,e)}class ur{constructor(t,e,r,n,i,o){this._zone=t,this._console=e,this._injector=r,this._exceptionHandler=n,this._componentFactoryResolver=i,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=ir(),this.isStable=$(new T(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks}),new T(t=>()=>{}).pipe(lt()))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let r;const n=(r=t instanceof De?t:this._componentFactoryResolver.resolveComponentFactory(t)).create(kt.NULL,[],e||r.selector,r instanceof je?null:this._injector.get(ze));return ir(),n}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0}catch(t){}finally{this._runningTick=!1}}attachView(t){}detachView(t){}_loadComponent(t){}_unloadComponent(t){}ngOnDestroy(){}get viewCount(){return this._views.length}}ur._tickScope=We("ApplicationRef#tick()");class hr{}const dr=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}();class pr{}class fr{constructor(t){this.nativeElement=t}}class mr{}const vr="#",gr="NgFactory";class yr{}const xr={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};class br{constructor(t,e){this._compiler=t,this._config=e||xr}load(t){return this._compiler instanceof Le?this.loadFactory(t):this.loadAndCompile(t)}loadAndCompile(t){let[e,n]=t.split(vr);return void 0===n&&(n="default"),r("crnd")(e).then(t=>t[n]).then(t=>wr(t,e,n)).then(t=>this._compiler.compileModuleAsync(t))}loadFactory(t){let[e,n]=t.split(vr),i=gr;return void 0===n&&(n="default",i=""),r("crnd")(this._config.factoryPathPrefix+e+this._config.factoryPathSuffix).then(t=>t[n+i]).then(t=>wr(t,e,n))}}function wr(t,e,r){if(!t)throw new Error(`Cannot find '${r}' in '${e}'`);return t}class _r{}class Sr{}class Tr{}const Mr=new Map;function Ar(t){return!!Er(t)&&(Array.isArray(t)||!(t instanceof Map)&&function(){if(!bt){const t=xt.Symbol;if(t&&t.iterator)bt=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const r=t[e];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(bt=r)}}}return bt}()in t)}function Er(t){return null!==t&&("function"==typeof t||"object"==typeof t)}class Cr{constructor(){}supports(t){return Ar(t)}create(t){return new Or(t)}}const Pr=(t,e)=>e;class Or{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Pr}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next);}forEachOperation(t){let e=this._itHead,r=this._removalsHead,n=0,i=null;for(;e||r;){const t=!r||e&&e.currentIndex<Rr(r,n,i)?e:r,o=Rr(t,n,i);if(t===r)n--,r=r._nextRemoved;else if(e=e._next,null==t.previousIndex)n++;else{i||(i=[]);const e=o-n,r=t.currentIndex-n;if(e!=r){for(let t=0;t<e;t++){const n=t<i.length?i[t]:i[t]=0,o=n+t;r<=o&&o<e&&(i[t]=n+1)}i[t.previousIndex]=r-e}}}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious);}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded);}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved);}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved);}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange);}diff(t){if(null==t&&(t=[]),!Ar(t))throw new Error(`Error trying to diff '${_t(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){let e,r,n,i=this._itHead,o=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)n=this._trackByFn(e,r=t[e]),null!==i&&wt(i.trackById,n)?o&&(i=this._verifyReinsertion(i,r,n,e)):(i=this._mismatch(i,r,n,e),o=!0),i=i._next}else this.length=e=0;return this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t,e;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,r,n){let i;return i=null===t?this._itTail:t._prev,null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,n))||null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))||(t=this._addAfter(new Nr(e,r),i,n)),t}_verifyReinsertion(t,e,r,n){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?t=this._reinsertAfter(i,t._prev,n):t.currentIndex!=n&&(t.currentIndex=n),t}_truncate(t){for(;null!==t;)t=t._next;null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,r){const n=t._prevRemoved,i=t._nextRemoved;return null===n?this._removalsHead=i:n._nextRemoved=i,null===i?this._removalsTail=n:i._prevRemoved=n,t}_moveAfter(t,e,r){return t}_addAfter(t,e,r){return this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,r){const n=null===e?this._itHead:e._next;return t._next=n,t._prev=e,null===n?this._itTail=t:n._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Ir),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){const e=t._prev,r=t._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,t}_addToMoves(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Ir),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Nr{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Lr{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&wt(r.trackById,t))return r;return null}remove(t){const e=t._prevDup,r=t._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class Ir{constructor(){this.map=new Map}put(t){let e=this.map.get(t.trackById);e||(e=new Lr)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){return this.map.get(t.trackById).remove(t),t}get isEmpty(){return 0===this.map.size}clear(){}}function Rr(t,e,r){const n=t.previousIndex;if(null===n)return n;let i=0;return r&&n<r.length&&(i=r[n]),n+e+i}class Dr{constructor(t){this.factories=t}static create(t,e){return null!=e&&(t=t.concat(e.factories.slice())),new Dr(t)}static extend(t){return{provide:Dr,useFactory:e=>{if(!e)throw new Error("Cannot extend IterableDiffers without a parent injector");return Dr.create(t,e)},deps:[[Dr,new It,new Nt]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(e){return t.name||typeof t}()}'`)}}Dr.ngInjectableDef=ct({providedIn:"root",factory:()=>new Dr([new Cr])});class Fr{constructor(t){this.factories=t}static create(t,e){return e&&(t=t.concat(e.factories.slice())),new Fr(t)}static extend(t){return{provide:Fr,useFactory:e=>{if(!e)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return Fr.create(t,e)},deps:[[Fr,new It,new Nt]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}const Ur=[new class{constructor(){}supports(t){return t instanceof Map||Er(t)}create(){return new class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next);}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious);}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged);}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded);}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved);}diff(t){if(t){if(!(t instanceof Map||Er(t)))throw new Error(`Error trying to diff '${_t(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){let e=this._mapHead;if(this._appendAfter=null,e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const r=t._prev;return e._next=t,e._prev=r,t._prev=e,r&&(r._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const e=this._records.get(t),r=e._prev,n=e._next;return r&&(r._next=n),n&&(n._prev=r),e._next=null,e._prev=null,e}const r=new class{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}(t);return r.currentValue=e,r}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){wt(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e)}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){Map}}}}],kr=new Dr([new Cr]),Br=new Fr(Ur),jr=ar(null,"core",[{provide:Ce,useValue:"unknown"},{provide:lr,deps:[kt]},{provide:Ke,deps:[]},{provide:Oe,deps:[]}]),zr=new ut("LocaleId");function Vr(){return kr}function Gr(){return Br}function Hr(t){return t||"en-US"}class Wr{constructor(t){}}class Xr{constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement&&(this.inertBodyElement=this.inertDocument.createElement("body")),this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}getInertBodyElement_XHR(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(t){return null}const e=new XMLHttpRequest;return e.responseType="document",e.response.body}getInertBodyElement_DOMParser(t){t="<body><remove></remove>"+t+"</body>";try{return(new window.DOMParser).parseFromString(t,"text/html").body}catch(t){return null}}getInertBodyElement_InertDocument(t){const e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.inertBodyElement)}stripCustomNsAttrs(t){for(let r=t.attributes.length-1;0<r;r--);let e=t.firstChild;for(;e;)Node,e=e.nextSibling}}const Yr=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,qr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Jr(t){return(t=String(t)).match(Yr)||t.match(qr)?t:(ir()&&console.warn(`WARNING: sanitizing unsafe URL value ${t} (see http://g.co/ng/security#xss)`),"unsafe:"+t)}function Zr(t){return(t=String(t)).split(",").map(t=>Jr(t.trim())).join(", ")}function Qr(t){const e={};for(const r of t.split(","))e[r]=!0;return e}function Kr(...t){const e={};for(const r of t)for(const t in r)r.hasOwnProperty(t)&&(e[t]=!0);return e}const $r=Qr("area,br,col,hr,img,wbr"),tn=Qr("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),en=Qr("rp,rt"),rn=Kr(en,tn),nn=Kr($r,Kr(tn,Qr("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Kr(en,Qr("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),rn),on=Qr("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),an=Qr("srcset"),sn=Kr(on,an,Qr("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"));class ln{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild;for(;e;)if(e.nodeType===Node.ELEMENT_NODE||e.nodeType===Node.TEXT_NODE||(this.sanitizedSomething=!0),e.firstChild)e=e.firstChild;else for(;e;){Node;let t=this.checkClobberedElement(e,e.nextSibling);if(t){e=t;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){if(!nn.hasOwnProperty(t.nodeName.toLowerCase()))return void(this.sanitizedSomething=!0);const e=t.attributes;for(let r=0;r<e.length;r++){const t=e.item(r),n=t.name.toLowerCase();if(!sn.hasOwnProperty(n)){this.sanitizedSomething=!0;continue}let i=t.value;on[n]&&(i=Jr(i)),an[n]&&(i=Zr(i))}}endElement(t){}chars(t){}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}let cn;function un(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}const hn=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),dn=/^url\(([^)]+)\)$/,pn=function(){var t={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return t[t.NONE]="NONE",t[t.HTML]="HTML",t[t.STYLE]="STYLE",t[t.SCRIPT]="SCRIPT",t[t.URL]="URL",t[t.RESOURCE_URL]="RESOURCE_URL",t}();class fn{}function mn(t,e){return t.nodes[e]}function vn(t,e){return t.nodes[e]}function gn(t,e){return t.nodes[e]}const yn={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},xn=()=>{},bn=new Map;function wn(t){let e=bn.get(t);return e||(e=_t(t)+"_"+bn.size,bn.set(t,e)),e}const _n="$$undefined",Sn="$$empty";function Tn(t){return{id:_n,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}let Mn=0;function An(t,e){switch(201347067&e.flags){case 1:return vn(t,e.nodeIndex).renderElement;case 2:return mn(t,e.nodeIndex).renderText}}function En(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function Cn(t){return 1<<t%32}function Pn(t){const e={};let r=0;const n={};return t&&t.forEach(([t,i])=>{"number"==typeof t?(e[t]=i,r|=Cn(t)):n[t]=i}),{matchedQueries:e,references:n,matchedQueryIds:r}}function On(t,e){return t.map(t=>{let r,n;return Array.isArray(t)?[n,r]=t:(n=0,r=t),r&&("function"==typeof r||"object"==typeof r)&&e&&Object.defineProperty(r,Rt,{value:e,configurable:!0}),{flags:n,token:r,tokenKey:wn(r)}})}const Nn=new WeakMap;function Ln(t){let e=Nn.get(t);return e||((e=t(()=>xn)).factory=t,Nn.set(t,e)),e}function In(t,e,r,n,i){3===e&&(r=t.renderer.parentNode(An(t,t.def.lastRenderRootNode))),Rn(t,e,0,t.def.nodes.length-1,r,n,i)}function Rn(t,e,r,n,i,o,a){for(let s=r;s<=n;s++){const r=t.def.nodes[s];11&r.flags&&Dn(t,r,e,i,o,a),s+=r.childCount}}function Dn(t,e,r,n,i,o){if(8&e.flags)!function(t,e,r,n,i,o){let a=t;for(;a&&!En(a);)a=a.parent;const s=a.parent,l=a.parent?a.parentNodeDef.parent:null,c=l.nodeIndex+l.childCount;for(let u=l.nodeIndex+1;u<=c;u++){const t=s.def.nodes[u];t.ngContentIndex===e&&Dn(s,t,r,n,i,o),u+=t.childCount}if(!s.parent){const a=t.root.projectableNodes[e];if(a)for(let e=0;e<a.length;e++)Fn(t,a[e],r,n,i,o)}}(t,e.ngContent.index,r,n,i,o);else{const a=An(t,e);if(3===r&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&Fn(t,a,r,n,i,o),32&e.bindingFlags&&Fn(vn(t,e.nodeIndex).componentView,a,r,n,i,o)):Fn(t,a,r,n,i,o),16777216&e.flags){const a=vn(t,e.nodeIndex).viewContainer._embeddedViews;for(let t=0;t<a.length;t++)In(a[t],r,n,i,o)}1&e.flags&&!e.element.name&&Rn(t,r,e.nodeIndex+1,e.nodeIndex+e.childCount,n,i,o)}}function Fn(t,e,r,n,i,o){const a=t.renderer;switch(r){case 1:a.appendChild(n,e);break;case 2:a.insertBefore(n,e,i);break;case 3:a.removeChild(n,e);break;case 0:o.push(e)}}const Un=/^:([^:]+):(.+)$/;function kn(t){if(":"===t[0]){const e=t.match(Un);return[e[1],e[2]]}return["",t]}function Bn(t){let e=0;for(let r=0;r<t.length;r++)e|=t[r].flags;return e}function jn(t,e,r,n,i,o){t|=1;const{matchedQueries:a,references:s,matchedQueryIds:l}=Pn(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a,matchedQueryIds:l,references:s,ngContentIndex:r,childCount:n,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?Ln(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||xn},provider:null,text:null,query:null,ngContent:null}}function zn(t,e,r,n,i,o,a=[],s,l,c,u,h){c||(c=xn);const{matchedQueries:d,references:p,matchedQueryIds:f}=Pn(r);let m=null,v=null;o&&([m,v]=kn(o)),s=s||[];const g=new Array(s.length);for(let b=0;b<s.length;b++){const[t,e,r]=s[b],[n,i]=kn(e);let o=void 0,a=void 0;switch(15&t){case 4:a=r;break;case 1:case 8:o=r}g[b]={flags:t,ns:n,name:i,nonMinifiedName:i,securityContext:o,suffix:a}}l=l||[];const y=new Array(l.length);for(let b=0;b<l.length;b++){const[t,e]=l[b];y[b]={type:0,target:t,eventName:e,propName:null}}const x=(a=a||[]).map(([t,e])=>{const[r,n]=kn(t);return[r,n,e]});return h=function(t){if(t&&t.id===_n){const e=null!=t.encapsulation&&t.encapsulation!==qt.None||t.styles.length||Object.keys(t.data).length;t.id=e?`c${Mn++}`:Sn}return t&&t.id===Sn&&(t=null),t||null}(h),u&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:d,matchedQueryIds:f,references:p,ngContentIndex:n,childCount:i,bindings:g,bindingFlags:Bn(g),outputs:y,element:{ns:m,name:v,attrs:x,template:null,componentProvider:null,componentView:u||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:c||xn},provider:null,text:null,query:null,ngContent:null}}function Vn(t,e,r,n){return r=Pt(r),{index:-1,deps:On(n,_t(e)),flags:t,token:e,value:r}}const Gn=new Object;function Hn(t,e,r,n,i,o){return new Wn(t,e,r,n,i,o)}class Wn extends De{constructor(t,e,r,n,i,o){this.selector=t,this.componentType=e,this._inputs=n,this._outputs=i,this.ngContentSelectors=o,this.viewDefFactory=r}get inputs(){const t=this._inputs;for(let e in t);return[]}get outputs(){for(let t in this._outputs);return[]}create(t,e,r,n){if(!n)throw new Error("ngModule should be provided");const i=Ln(this.viewDefFactory),o=i.nodes[0].element.componentProvider.nodeIndex,a=yn.createRootView(t,e||[],r,i,n,Gn),s=gn(a,o).instance;return new Xn(a,new Yn(a),s)}}class Xn extends Re{constructor(t,e,r){this._view=t,this._viewRef=e,this._component=r,this._elDef=this._view.def.nodes[0],this.hostView=e,this.changeDetectorRef=e,this.instance=r}get location(){return new fr(vn(this._view,this._elDef.nodeIndex).renderElement)}get injector(){return new qn(this._view,this._elDef)}get componentType(){return this._component.constructor}destroy(){}onDestroy(t){}}class Yn{constructor(t){this._view=t,this._viewContainerRef=null,this._appRef=null}get rootNodes(){return function(t){const e=[];return In(t,0,void 0,void 0,e),e}(this._view)}get context(){return this._view.context}get destroyed(){return 0!=(128&this._view.state)}markForCheck(){}detach(){this._view.state&=-5}detectChanges(){}checkNoChanges(){}reattach(){this._view.state|=4}onDestroy(t){this._view.disposables||(this._view.disposables=[])}destroy(){}detachFromAppRef(){this._appRef=null}attachToAppRef(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}attachToViewContainerRef(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t}}class qn{constructor(t,e){this.view=t,this.elDef=e}get(t,e=kt.THROW_IF_NOT_FOUND){return yn.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:wn(t)},e)}}function Jn(t,e){const r=t.def.nodes[e];if(1&r.flags){const e=vn(t,r.nodeIndex);return r.element.template?e.template:e.renderElement}if(2&r.flags)return mn(t,r.nodeIndex).renderText;if(20240&r.flags)return gn(t,r.nodeIndex).instance;throw new Error(`Illegal state: read nodeValue for node index ${e}`)}function Zn(t,e,r,n,i,o,a,s){const l=[];if(a)for(let u in a){const[t,e]=a[u];l[t]={flags:8,name:u,nonMinifiedName:e,ns:null,securityContext:null,suffix:null}}const c=[];if(s)for(let u in s)c.push({type:1,propName:u,target:null,eventName:s[u]});return function(t,e,r,n,i,o,a,s,l){const{matchedQueries:c,references:u,matchedQueryIds:h}=Pn(r);l||(l=[]),s||(s=[]),o=Pt(o);const d=On(a,_t(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:h,references:u,ngContentIndex:-1,childCount:n,bindings:s,bindingFlags:Bn(s),outputs:l,element:null,provider:{token:i,value:o,deps:d},text:null,query:null,ngContent:null}}(t,e|=16384,r,n,i,i,o,l,c)}function Qn(t,e,r){let n=[];for(let i in r)n.push({propName:i,bindingType:r[i]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:Cn(e),bindings:n},ngContent:null}}function Kn(t,e,r){const n=new Array(r.length-1);for(let i=1;i<r.length;i++)n[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:r[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:n,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:r[0]},query:null,ngContent:null}}function $n(t,e,r,n){let i=0,o=0,a=0,s=0,l=0,c=null,u=null,h=!1,d=!1,p=null;for(let f=0;f<e.length;f++){const t=e[f];if(t.nodeIndex=f,t.parent=c,t.bindingIndex=i,t.outputIndex=o,t.renderParent=u,a|=t.flags,l|=t.matchedQueryIds,t.element){const e=t.element;e.publicProviders=c?c.element.publicProviders:Object.create(null),e.allProviders=e.publicProviders,h=!1,d=!1,t.element.template&&(l|=t.element.template.nodeMatchedQueries)}if(ei(c,t,e.length),i+=t.bindings.length,o+=t.outputs.length,!u&&3&t.flags&&(p=t),20224&t.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);const e=0!=(32768&t.flags);0==(8192&t.flags)||e?c.element.publicProviders[wn(t.provider.token)]=t:(d||(d=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[wn(t.provider.token)]=t),e&&(c.element.componentProvider=t)}if(c?(c.childFlags|=t.flags,c.directChildFlags|=t.flags,c.childMatchedQueries|=t.matchedQueryIds,t.element&&t.element.template&&(c.childMatchedQueries|=t.element.template.nodeMatchedQueries)):s|=t.flags,t.childCount>0)c=t,ti(t)||(u=t);else for(;c&&f===c.nodeIndex+c.childCount;){const t=c.parent;t&&(t.childFlags|=c.childFlags,t.childMatchedQueries|=c.childMatchedQueries),u=(c=t)&&ti(c)?c.renderParent:c}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:l,flags:t,nodes:e,updateDirectives:r||xn,updateRenderer:n||xn,handleEvent:(t,r,n,i)=>e[r].element.handleEvent(t,n,i),bindingCount:i,outputCount:o,lastRenderRootNode:p}}function ti(t){return 0!=(1&t.flags)&&null===t.element.name}function ei(t,e,r){const n=e.element&&e.element.template;if(n){if(!n.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(n.lastRenderRootNode&&16777216&n.lastRenderRootNode.flags)throw new Error(`Illegal State: Last root node of a template can't have embedded views, at index ${e.nodeIndex}!`)}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error(`Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ${e.nodeIndex}!`);if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error(`Illegal State: Content Query nodes need to be children of directives, at index ${e.nodeIndex}!`);if(134217728&e.flags&&t)throw new Error(`Illegal State: View Query nodes have to be top level nodes, at index ${e.nodeIndex}!`)}if(e.childCount){const n=t?t.nodeIndex+t.childCount:r-1;if(e.nodeIndex<=n&&e.nodeIndex+e.childCount>n)throw new Error(`Illegal State: childCount of node leads outside of parent, at index ${e.nodeIndex}!`)}}"undefined"==typeof ngDevMode&&("undefined"!=typeof window&&(window.ngDevMode=!0),"undefined"!=typeof self&&(self.ngDevMode=!0),"undefined"!=typeof global&&(global.ngDevMode=!0));class ri{}var ni=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function ii(t,e){function r(){this.constructor=t}ni(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function oi(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a}function ai(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function si(t,e){var r=function(t){return"data-"+t.toString().replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()};Object.defineProperty(t,e,{set:function(t){t=t.toString(),this.setAttribute(r(e),t)},get:function(){return this.getAttribute(r(e))},enumerable:!0})}function li(t,e){return{enumerable:!0,value:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return this._instance?this._instance[e].apply(this._instance,t):(console.warn("ng2-facebook-sdk: tried calling instance method before component is ready."),null)}}}Object;var ci=function(){function t(t,e,r){this.el=t,this.rnd=e,this.fbClass=r,this.nativeElement=this.el.nativeElement,this.rnd.setElementClass(this.nativeElement,this.fbClass,!0)}return t.prototype.setAttribute=function(t,e){t&&e&&this.rnd.setElementAttribute(this.nativeElement,t,e)},t.prototype.getAttribute=function(t){if(t)return this.nativeElement.getAttribute(t)},t}(),ui=function(t){function e(e,r){return t.call(this,e,r,"fb-comment-embed")||this}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],ui.prototype,"href",void 0),oi([si,ai("design:type",String)],ui.prototype,"width",void 0),oi([si,ai("design:type",Boolean)],ui.prototype,"includeParent",void 0);var hi=function(t){function e(e,r){var n=t.call(this,e,r,"fb-comments")||this;return n.href=window.location.href,n}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],hi.prototype,"colorscheme",void 0),oi([si,ai("design:type",String)],hi.prototype,"href",void 0),oi([si,ai("design:type",Boolean)],hi.prototype,"mobile",void 0),oi([si,ai("design:type",Number)],hi.prototype,"numposts",void 0),oi([si,ai("design:type",String)],hi.prototype,"orderBy",void 0),oi([si,ai("design:type",String)],hi.prototype,"width",void 0);var di=function(t){function e(e,r){return t.call(this,e,r,"fb-follow")||this}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],di.prototype,"colorScheme",void 0),oi([si,ai("design:type",String)],di.prototype,"href",void 0),oi([si,ai("design:type",Boolean)],di.prototype,"kidDirectedSite",void 0),oi([si,ai("design:type",String)],di.prototype,"layout",void 0),oi([si,ai("design:type",String)],di.prototype,"showFaces",void 0),oi([si,ai("design:type",String)],di.prototype,"size",void 0),oi([si,ai("design:type",String)],di.prototype,"width",void 0);var pi=function(t){function e(e,r){var n=t.call(this,e,r,"fb-like")||this;return n.href=window.location.href,n}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],pi.prototype,"action",void 0),oi([si,ai("design:type",String)],pi.prototype,"colorScheme",void 0),oi([si,ai("design:type",String)],pi.prototype,"href",void 0),oi([si,ai("design:type",Boolean)],pi.prototype,"kidDirectedSite",void 0),oi([si,ai("design:type",String)],pi.prototype,"layout",void 0),oi([si,ai("design:type",String)],pi.prototype,"ref",void 0),oi([si,ai("design:type",Boolean)],pi.prototype,"share",void 0),oi([si,ai("design:type",Boolean)],pi.prototype,"showFaces",void 0),oi([si,ai("design:type",String)],pi.prototype,"size",void 0),oi([si,ai("design:type",String)],pi.prototype,"width",void 0);var fi=function(t){function e(e,r){return t.call(this,e,r,"fb-page")||this}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],fi.prototype,"href",void 0),oi([si,ai("design:type",Number)],fi.prototype,"width",void 0),oi([si,ai("design:type",Number)],fi.prototype,"height",void 0),oi([si,ai("design:type",String)],fi.prototype,"tabs",void 0),oi([si,ai("design:type",Boolean)],fi.prototype,"hideCover",void 0),oi([si,ai("design:type",Boolean)],fi.prototype,"showFacepile",void 0),oi([si,ai("design:type",Boolean)],fi.prototype,"hideCTA",void 0),oi([si,ai("design:type",Boolean)],fi.prototype,"smallHeader",void 0),oi([si,ai("design:type",Boolean)],fi.prototype,"adaptContainerWidth",void 0);var mi=function(t){function e(e,r){return t.call(this,e,r,"fb-post")||this}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],mi.prototype,"href",void 0),oi([si,ai("design:type",String)],mi.prototype,"width",void 0),oi([si,ai("design:type",Boolean)],mi.prototype,"showText",void 0);var vi=function(t){function e(e,r){return t.call(this,e,r,"fb-quote")||this}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],vi.prototype,"href",void 0),oi([si,ai("design:type",String)],vi.prototype,"layout",void 0);var gi=function(t){function e(e,r){var n=t.call(this,e,r,"fb-save")||this;return n.uri=window.location.href,n}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],gi.prototype,"uri",void 0);var yi=function(t){function e(e,r){var n=t.call(this,e,r,"fb-send")||this;return n.href=window.location.href,n}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],yi.prototype,"colorScheme",void 0),oi([si,ai("design:type",String)],yi.prototype,"href",void 0),oi([si,ai("design:type",Boolean)],yi.prototype,"kidDirectedSite",void 0),oi([si,ai("design:type",String)],yi.prototype,"ref",void 0),oi([si,ai("design:type",String)],yi.prototype,"size",void 0);var xi=function(t){function e(e,r){return t.call(this,e,r,"fb-share-button")||this}return ii(e,t),e}(ci);oi([si,ai("design:type",String)],xi.prototype,"href",void 0),oi([si,ai("design:type",String)],xi.prototype,"layout",void 0),oi([si,ai("design:type",Boolean)],xi.prototype,"mobileIframe",void 0),oi([si,ai("design:type",String)],xi.prototype,"size",void 0);var bi=function(t){function e(e,r){var n=t.call(this,e,r,"fb-video")||this;return n.startedPlaying=new Xe,n.paused=new Xe,n.finishedPlaying=new Xe,n.startedBuffering=new Xe,n.finishedBuffering=new Xe,n.error=new Xe,n._listeners=[],n.nativeElement.id=n._id="video-"+String(Math.floor(1e4*Math.random()+1)),n}return ii(e,t),e.prototype.ngOnInit=function(){var t=this;FB.Event.subscribe("xfbml.ready",function(e){"video"===e.type&&e.id===t._id&&(t._instance=e.instance,t._listeners.push(t._instance.subscribe("startedPlaying",function(e){return t.startedPlaying.emit(e)}),t._instance.subscribe("paused",function(e){return t.paused.emit(e)}),t._instance.subscribe("finishedPlaying",function(e){return t.finishedPlaying.emit(e)}),t._instance.subscribe("startedBuffering",function(e){return t.startedBuffering.emit(e)}),t._instance.subscribe("finishedBuffering",function(e){return t.finishedBuffering.emit(e)}),t._instance.subscribe("error",function(e){return t.error.emit(e)})))})},e.prototype.ngOnDestroy=function(){this._listeners.forEach(function(t){"function"==typeof t.release&&t.release()})},e.prototype.play=function(){},e.prototype.pause=function(){},e.prototype.seek=function(t){},e.prototype.mute=function(){},e.prototype.unmute=function(){},e.prototype.isMuted=function(){},e.prototype.setVolume=function(t){},e.prototype.getVolume=function(){},e.prototype.getCurrentPosition=function(){},e.prototype.getDuration=function(){},e}(ci);oi([si,ai("design:type",String)],bi.prototype,"href",void 0),oi([si,ai("design:type",Boolean)],bi.prototype,"allowfullscreen",void 0),oi([si,ai("design:type",Boolean)],bi.prototype,"autoplay",void 0),oi([si,ai("design:type",String)],bi.prototype,"width",void 0),oi([si,ai("design:type",Boolean)],bi.prototype,"showText",void 0),oi([si,ai("design:type",Boolean)],bi.prototype,"showCaptions",void 0),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",void 0)],bi.prototype,"play",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",void 0)],bi.prototype,"pause",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[Number]),ai("design:returntype",void 0)],bi.prototype,"seek",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",void 0)],bi.prototype,"mute",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",void 0)],bi.prototype,"unmute",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",Boolean)],bi.prototype,"isMuted",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[Number]),ai("design:returntype",void 0)],bi.prototype,"setVolume",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",Number)],bi.prototype,"getVolume",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",void 0)],bi.prototype,"getCurrentPosition",null),oi([li,ai("design:type",Function),ai("design:paramtypes",[]),ai("design:returntype",void 0)],bi.prototype,"getDuration",null);var wi=function(){function t(){}return t.prototype.init=function(t){try{return Promise.resolve(FB.init(t))}catch(t){return Promise.reject(t)}},t.prototype.api=function(t,e,r){return void 0===e&&(e="get"),void 0===r&&(r={}),new Promise(function(n,i){try{FB.api(t,e,r,function(t){t?t.error?i(t.error):n(t):i()})}catch(t){i(t)}})},t.prototype.ui=function(t){return new Promise(function(e,r){try{FB.ui(t,function(t){t?t.error?r(t.error):e(t):r()})}catch(t){r(t)}})},t.prototype.getLoginStatus=function(){return new Promise(function(t,e){try{FB.getLoginStatus(function(r){r?t(r):e()})}catch(t){e(t)}})},t.prototype.login=function(t){return new Promise(function(e,r){try{FB.login(function(t){t.authResponse?e(t):r()},t)}catch(t){r(t)}})},t.prototype.logout=function(){return new Promise(function(t,e){try{FB.logout(function(e){t(e)})}catch(t){e(t)}})},t.prototype.getAuthResponse=function(){try{return FB.getAuthResponse()}catch(t){console.error("ng2-facebook-sdk: ",t)}},t}(),_i=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[wi]}},t}();class Si{constructor(t){this.fb=t,t.init({appId:"396487237479561",xfbml:!0,version:"v2.8"})}}function Ti(t,e){return new T(e?r=>e.schedule(Mi,0,{error:t,subscriber:r}):e=>e.error(t))}function Mi({error:t,subscriber:e}){e.error(t)}function Ai(t){return function(e){const r=new Ei(t),n=e.lift(r);return r.caught=n}}class Ei{constructor(t){this.selector=t}call(t,e){return e.subscribe(new Ci(t,this.selector,this.caught))}}class Ci extends V{constructor(t,e,r){this.selector=e,this.caught=r}error(t){if(!this.isStopped){let e;try{e=this.selector(t,this.caught)}catch(t){return}}}}class Pi{}Pi.BACKEND_URL="https://racing-demo-dev.pp.ua",Pi.FPS=60,Pi.MOVE_TIMEOUT=7e3;const Oi=new T(t=>t.complete());function Ni(t){return t?function(t){return new T(e=>t.schedule(()=>e.complete()))}(t):Oi}function Li(t){const e=new T(e=>{e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}function Ii(...t){let e=t[t.length-1];switch(N(e)?t.pop():e=void 0,t.length){case 0:return Ni(e);case 1:return e?X(t,e):Li(t[0]);default:return X(t,e)}}function Ri(t,e){return q(t,e,1)}function Di(t,e){return function(r){return r.lift(new Fi(t,e))}}class Fi{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new Ui(t,this.predicate,this.thisArg))}}class Ui extends y{constructor(t,e,r){this.predicate=e,this.thisArg=r,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return}}}class ki{}const Bi=new ut("Location Initialized");class ji{}const zi=new ut("appBaseHref");class Vi{constructor(t){this._subject=new Xe,this._platformStrategy=t,this._baseHref=Vi.stripTrailingSlash(Gi(this._platformStrategy.getBaseHref()))}path(t=!1){return this.normalize(this._platformStrategy.path(t))}isCurrentPathEqualTo(t,e=""){return this.path()==this.normalize(t+Vi.normalizeQueryParams(e))}normalize(t){return Vi.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,Gi(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,e="",r=null){}replaceState(t,e="",r=null){}forward(){}back(){}subscribe(t,e,r){return this._subject.subscribe({next:t,error:e,complete:r})}static normalizeQueryParams(t){return t&&"?"!==t[0]?"?"+t:t}static joinWithSlash(t,e){if(0==t.length)return e;if(0==e.length)return t;let r=0;return t.endsWith("/")&&r++,e.startsWith("/")&&r++,2==r?t+e.substring(1):1==r?t+e:t+"/"+e}static stripTrailingSlash(t){const e=t.match(/#|\?|$/),r=e&&e.index||t.length;return t.slice(0,r-("/"===t[r-1]?1:0))+t.slice(r)}}function Gi(t){return t.replace(/\/index.html$/,"")}class Hi extends ji{constructor(t,e){this._platformLocation=t,this._baseHref="",null!=e&&(this._baseHref=e)}onPopState(t){}getBaseHref(){return this._baseHref}path(t=!1){let e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}prepareExternalUrl(t){const e=Vi.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e}pushState(t,e,r,n){let i=this.prepareExternalUrl(r+Vi.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname)}replaceState(t,e,r,n){let i=this.prepareExternalUrl(r+Vi.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname)}forward(){}back(){}}class Wi extends ji{constructor(t,e){if(this._platformLocation=t,null==e&&(e=this._platformLocation.getBaseHrefFromDOM()),null==e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=e}onPopState(t){}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Vi.joinWithSlash(this._baseHref,t)}path(t=!1){const e=this._platformLocation.pathname+Vi.normalizeQueryParams(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${e}${r}`:e}pushState(t,e,r,n){}replaceState(t,e,r,n){}forward(){}back(){}}const Xi=void 0;var Yi=["en",[["a","p"],["AM","PM"],Xi],[["AM","PM"],Xi,Xi],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Xi,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Xi,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Xi,"{1} 'at' {0}",Xi],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){let e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===r?1:5}];const qi={},Ji=function(){var t={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return t[t.Zero]="Zero",t[t.One]="One",t[t.Two]="Two",t[t.Few]="Few",t[t.Many]="Many",t[t.Other]="Other",t}(),Zi=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Qi=new ut("UseV4Plurals");class Ki{}class $i extends Ki{constructor(t,e){this.locale=t,this.deprecatedPluralFn=e}getPluralCategory(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){const e=t.toLowerCase().replace(/_/g,"-");let r=qi[e];if(r)return r;const n=e.split("-")[0];if(r=qi[n])return r;if("en"===n)return Yi;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[18]}(e||this.locale)(t)){case Ji.Zero:return"zero";case Ji.One:return"one";case Ji.Two:return"two";case Ji.Few:return"few";case Ji.Many:return"many";default:return"other"}}}function to(t,e){e=encodeURIComponent(e);for(const r of t.split(";")){const t=r.indexOf("="),[n,i]=-1==t?[r,""]:[r.slice(0,t),r.slice(t+1)];if(n.trim()===e)return decodeURIComponent(i)}return null}class eo{constructor(t,e,r){this._viewContainer=t,this._template=e,this._differs=r,this._differ=null}set ngForTrackBy(t){ir()&&null!=t&&"function"!=typeof t&&console&&console,this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngOnChanges(t){if("ngForOf"in t){const e=t.ngForOf.currentValue;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(t){throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(t){return e.name||typeof e}()}'. NgFor only supports binding to Iterables such as Arrays.`)}}}ngDoCheck(){}_applyChanges(t){const e=[];for(let r=0;r<e.length;r++);for(let r=0,n=this._viewContainer.length;r<n;r++){const t=this._viewContainer.get(r);t.context.index=r,t.context.count=n}}_perViewChange(t,e){t.context.$implicit=e.item}}class ro{constructor(t,e){this._viewContainer=t,this._context=new no,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}set ngIf(t){this._context.$implicit=this._context.ngIf=t}set ngIfThen(t){this._thenTemplateRef=t,this._thenViewRef=null}set ngIfElse(t){this._elseTemplateRef=t,this._elseViewRef=null}_updateView(){this._context.$implicit?this._thenViewRef||(this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}}class no{constructor(){this.$implicit=null,this.ngIf=null}}const io=/((?:[^yMLdHhmsazZEwGjJ']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|J+|j+|m+|s+|a|z|Z|G+|w+))(.*)/,oo={yMMMdjms:vo(mo([po("year",1),fo("month",3),po("day",1),po("hour",1),po("minute",1),po("second",1)])),yMdjm:vo(mo([po("year",1),po("month",1),po("day",1),po("hour",1),po("minute",1)])),yMMMMEEEEd:vo(mo([po("year",1),fo("month",4),fo("weekday",4),po("day",1)])),yMMMMd:vo(mo([po("year",1),fo("month",4),po("day",1)])),yMMMd:vo(mo([po("year",1),fo("month",3),po("day",1)])),yMd:vo(mo([po("year",1),po("month",1),po("day",1)])),jms:vo(mo([po("hour",1),po("second",1),po("minute",1)])),jm:vo(mo([po("hour",1),po("minute",1)]))},ao={yyyy:vo(po("year",4)),yy:vo(po("year",2)),y:vo(po("year",1)),MMMM:vo(fo("month",4)),MMM:vo(fo("month",3)),MM:vo(po("month",2)),M:vo(po("month",1)),LLLL:vo(fo("month",4)),L:vo(fo("month",1)),dd:vo(po("day",2)),d:vo(po("day",1)),HH:so(lo(vo(ho(po("hour",2),!1)))),H:lo(vo(ho(po("hour",1),!1))),hh:so(lo(vo(ho(po("hour",2),!0)))),h:lo(vo(ho(po("hour",1),!0))),jj:vo(po("hour",2)),j:vo(po("hour",1)),mm:so(vo(po("minute",2))),m:vo(po("minute",1)),ss:so(vo(po("second",2))),s:vo(po("second",1)),sss:vo(po("second",3)),EEEE:vo(fo("weekday",4)),EEE:vo(fo("weekday",3)),EE:vo(fo("weekday",2)),E:vo(fo("weekday",1)),a:function(t){return function(e,r){return t(e,r).split(" ")[1]}}(vo(ho(po("hour",1),!0))),Z:uo("short"),z:uo("long"),ww:vo({}),w:vo({}),G:vo(fo("era",1)),GG:vo(fo("era",2)),GGG:vo(fo("era",3)),GGGG:vo(fo("era",4))};function so(t){return function(e,r){const n=t(e,r);return 1==n.length?"0"+n:n}}function lo(t){return function(e,r){return t(e,r).split(" ")[0]}}function co(t,e,r){return new Intl.DateTimeFormat(e,r).format(t).replace(/[\u200e\u200f]/g,"")}function uo(t){const e={hour:"2-digit",hour12:!1,timeZoneName:t};return function(t,r){const n=co(t,r,e);return n?n.substring(3):""}}function ho(t,e){return t.hour12=e,t}function po(t,e){const r={};return r[t]=2===e?"2-digit":"numeric",r}function fo(t,e){const r={};return r[t]=e<4?e>1?"short":"narrow":"long",r}function mo(t){return t.reduce((t,e)=>Object.assign({},t,e),{})}function vo(t){return(e,r)=>co(e,r,t)}const go=new Map;class yo{static format(t,e,r){return function(t,e,r){const n=oo[t];if(n)return n(e,r);const i=t;let o=go.get(i);if(!o){let e;o=[],io.exec(t);let r=t;for(;r;)(e=io.exec(r))?r=(o=o.concat(e.slice(1))).pop():(o.push(r),r=null);go.set(i,o)}return o.reduce((t,n)=>{const i=ao[n];return t+(i?i(e,r):function(t){return"''"===t?"'":t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}(n))},"")}(r,t,e)}}class xo{constructor(t){this._locale=t}transform(t,e="mediumDate"){if(null==t||""===t||t!=t)return null;let r;if("string"==typeof t&&(t=t.trim()),bo(t))r=t;else if(isNaN(t-parseFloat(t)))if("string"==typeof t&&/^(\d{4}-\d{1,2}-\d{1,2})$/.test(t)){const[e,n,i]=t.split("-").map(t=>parseInt(t,10));r=new Date(e,n-1,i)}else r=new Date(t);else r=new Date(parseFloat(t));if(!bo(r)){let e;if("string"!=typeof t||!(e=t.match(Zi)))throw function(t,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${_t(xo)}'`)}(0,t);r=function(t){const e=new Date(0);let r=0,n=0;const i=t[8]?e.setUTCFullYear:e.setFullYear,o=t[8]?e.setUTCHours:e.setHours;t[9]&&(r=Number(t[9]+t[10]),n=Number(t[9]+t[11])),i.call(e,Number(t[1]),Number(t[2])-1,Number(t[3]));const a=Number(t[4]||0)-r,s=Number(t[5]||0)-n,l=Number(t[6]||0),c=Math.round(1e3*parseFloat("0."+(t[7]||0)));return o.call(e,a,s,l,c),e}(e)}return yo.format(r,this._locale,xo._ALIASES[e]||e)}}function bo(t){return t instanceof Date&&!isNaN(t.valueOf())}xo._ALIASES={medium:"yMMMdjms",short:"yMdjm",fullDate:"yMMMMEEEEd",longDate:"yMMMMd",mediumDate:"yMMMd",shortDate:"yMd",mediumTime:"jms",shortTime:"jm"};class wo{}const _o=new ut("DocumentToken");class So{}class To{}class Mo{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit=(()=>{this.headers=new Map}):this.headers=new Map}has(t){return this.headers.has(t.toLowerCase())}get(t){const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return Array.from(this.normalizedNames.values())}getAll(t){return this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){}init(){this.lazyInit&&(this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate=null))}copyFrom(t){}clone(t){const e=new Mo;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Mo?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if("string"==typeof r&&(r=[r]),0===r.length)return;break;case"d":const n=t.value;if(n){let t=this.headers.get(e);if(!t)return;t=t.filter(t=>-1===n.indexOf(t))}}}forEach(t){}}class Ao{encodeKey(t){return Eo(t)}encodeValue(t){return Eo(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}function Eo(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}class Co{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Ao,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,e){const r=new Map;return t.length>0&&t.split("&").forEach(t=>{const n=t.indexOf("="),[i,o]=-1==n?[e.decodeKey(t),""]:[e.decodeKey(t.slice(0,n)),e.decodeValue(t.slice(n+1))],a=r.get(i)||[];a.push(o),r.set(i,a)}),r}(t.fromString,this.encoder)}else this.map=t.fromObject?new Map:null}has(t){return this.map.has(t)}get(t){const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.map.get(t)||null}keys(){return Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(t=>e+"="+this.encoder.encodeValue(t)).join("&")}).join("&")}clone(t){const e=new Co({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat([t]),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom=null)}}function Po(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function Oo(t){return"undefined"!=typeof Blob&&t instanceof Blob}function No(t){return"undefined"!=typeof FormData&&t instanceof FormData}class Lo{constructor(t,e,r,n){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||n?(this.body=void 0!==r?r:null,i=n):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new Mo),this.params){const t=this.params.toString();if(0===t.length)this.urlWithParams=e;else{const r=e.indexOf("?");this.urlWithParams=e+(-1===r?"?":r<e.length-1?"&":"")+t}}else this.params=new Co,this.urlWithParams=e}serializeBody(){return null===this.body?null:Po(this.body)||Oo(this.body)||No(this.body)||"string"==typeof this.body?this.body:this.body instanceof Co?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body?null:No(this.body)?null:Oo(this.body)?this.body.type||null:Po(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Co?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}clone(t={}){const e=t.method||this.method,r=t.url||this.url,n=t.responseType||this.responseType,i=void 0!==t.body?t.body:this.body,o=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,a=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let s=t.headers||this.headers,l=t.params||this.params;return void 0!==t.setHeaders&&(s=Object.keys(t.setHeaders).reduce((e,r)=>e.set(r,t.setHeaders[r]),s)),t.setParams&&(l=Object.keys(t.setParams).reduce((e,r)=>e.set(r,t.setParams[r]),l)),new Lo(e,r,i,{params:l,headers:s,reportProgress:a,responseType:n,withCredentials:o})}}const Io=function(){var t={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};return t[t.Sent]="Sent",t[t.UploadProgress]="UploadProgress",t[t.ResponseHeader]="ResponseHeader",t[t.DownloadProgress]="DownloadProgress",t[t.Response]="Response",t[t.User]="User",t}();class Ro{constructor(t,e=200,r="OK"){this.headers=t.headers||new Mo,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Do extends Ro{constructor(t={}){this.type=Io.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Do({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}function Fo(t,e){return{body:e,headers:t.headers,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}class Uo{constructor(t){this.handler=t}request(t,e,r={}){let n;if(t instanceof Lo)n=t;else{let i=void 0;i=r.headers instanceof Mo?r.headers:new Mo(r.headers);let o=void 0;r.params&&(o=r.params instanceof Co?r.params:new Co({fromObject:r.params})),n=new Lo(t,e,void 0!==r.body?r.body:null,{headers:i,params:o,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const i=Ii(n).pipe(Ri(t=>this.handler.handle(t)));if(t instanceof Lo||"events"===r.observe)return i;const o=i.pipe(Di(t=>t instanceof Do));switch(r.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return o.pipe(G(t=>{if(null!==t.body&&!(t.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return t.body}));case"blob":return o.pipe(G(t=>{if(null!==t.body&&!(t.body instanceof Blob))throw new Error("Response is not a Blob.");return t.body}));case"text":return o.pipe(G(t=>{if(null!==t.body&&"string"!=typeof t.body)throw new Error("Response is not a string.");return t.body}));case"json":default:return o.pipe(G(t=>t.body))}case"response":return o;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,e={}){return this.request("DELETE",t,e)}get(t,e={}){return this.request("GET",t,e)}head(t,e={}){return this.request("HEAD",t,e)}jsonp(t,e){return this.request("JSONP",t,{params:(new Co).append(e,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,e={}){return this.request("OPTIONS",t,e)}patch(t,e,r={}){return this.request("PATCH",t,Fo(r,e))}post(t,e,r={}){return this.request("POST",t,Fo(r,e))}put(t,e,r={}){return this.request("PUT",t,Fo(r,e))}}class ko{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const Bo=new ut("HTTP_INTERCEPTORS");class jo{intercept(t,e){return e.handle(t)}}class zo{}class Vo{constructor(){}build(){return new XMLHttpRequest}}class Go{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without JsonpClientModule installed.");return new T(e=>{const r=this.xhrFactory.build();if(t.withCredentials&&(r.withCredentials=!0),t.responseType){const e=t.responseType.toLowerCase();r.responseType="json"!==e?e:"text"}return()=>{}})}}const Ho=new ut("XSRF_COOKIE_NAME"),Wo=new ut("XSRF_HEADER_NAME");class Xo{}class Yo{constructor(t,e,r){this.doc=t,this.platform=e,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=to(t,this.cookieName),this.lastCookieString=t),this.lastToken}}class qo{constructor(t,e){this.tokenService=t,this.headerName=e}intercept(t,e){const r=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||r.startsWith("http://")||r.startsWith("https://"))return e.handle(t);const n=this.tokenService.getToken();return null===n||t.headers.has(this.headerName)||(t=t.clone({headers:t.headers.set(this.headerName,n)})),e.handle(t)}}class Jo{constructor(t,e){this.backend=t,this.injector=e,this.chain=null}handle(t){return null===this.chain&&(this.chain=this.injector.get(Bo,[]).reduceRight((t,e)=>new ko(t,e),this.backend)),this.chain.handle(t)}}class Zo{static disable(){return{ngModule:Zo,providers:[{provide:qo,useClass:jo}]}}static withOptions(t={}){return{ngModule:Zo,providers:[t.cookieName?{provide:Ho,useValue:t.cookieName}:[],t.headerName?{provide:Wo,useValue:t.headerName}:[]]}}}class Qo{}class Ko{constructor(){this.showLoader=new P}}class $o{constructor(t,e,r){this.http=t,this.router=e,this.uiService=r,this.apiUrl=Pi.BACKEND_URL,this.apiHeaders=new Mo({"Content-type":"application/json"})}apiGet(t,e=null){return this.apiCall(ta.Get,t,e)}apiPost(t,e){return this.apiCall(ta.Post,t,e)}apiCall(t,e,r=null){let n=this.apiUrl;switch(e&&e.length>0&&(n+="/"+e),this.uiService.showLoader.next(!0),t){case ta.Get:case ta.Post:return this.http.request(t,n,{body:r&&JSON.stringify(r),headers:this.apiHeaders||new Mo,responseType:"json",withCredentials:!0,reportProgress:!0,observe:"body"}).pipe(G(t=>(this.uiService.showLoader.next(!1),t)),Ai(t=>{switch(t.status){case ea.Unauthorized:this.router.navigate(["login"]);break;default:console.log(`No specific handler for error with status = ${t.status}`)}return console.log(t),this.uiService.showLoader.next(!1),Ti(t.error)}));default:return this.uiService.showLoader.next(!1),Ti("Method "+ta[t]+"is not supported! See api-http service")}}}var ta;!function(t){t.Get="get",t.Head="head",t.Post="post",t.Put="put",t.Patch="patch",t.Delete="delete",t.Connect="connect",t.Options="options",t.Trace="trace"}(ta||(ta={}));var ea=function(t){return t[t.BadRequest=400]="BadRequest",t[t.Unauthorized=401]="Unauthorized",t}({});class ra{constructor(t){this.apiHttpService=t}login(t){return this.apiHttpService.apiPost("auth/login/",t)}register(t){return this.apiHttpService.apiPost("auth/register/",t)}}class na{constructor(t,e){this.authDelegate=t,this.router=e,this.currentUser=this.setUserFromLocalStorage()}setUserFromLocalStorage(){try{return JSON.parse(localStorage.getItem("currentUser"))}catch(t){console.warn("LocalStorage unavailable")}}login(t,e){return this.authDelegate.login({login:t,password:e}).pipe(G(t=>{try{localStorage.setItem("currentUser",JSON.stringify(t))}catch(t){console.warn("LocalStorage unavailable")}return this.currentUser=t}))}logout(){this.currentUser=null;try{localStorage.removeItem("currentUser"),this.router.navigate(["login"])}catch(t){console.warn("LocalStorage unavailable")}}createUser(t,e){return this.authDelegate.register({login:t,password:e}).pipe(G(t=>this.currentUser=t))}}var ia=r("gFX4"),oa=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})};class aa{static sleep(t){return oa(this,void 0,void 0,function*(){return new Promise(e=>{setTimeout(()=>{e()},t)})})}static wait(t,e=!0){return oa(this,void 0,void 0,function*(){return new Promise((r,n)=>{setTimeout(()=>{e?r():n("Rejected by timeout")},t)})})}static doWithFailTimeout(t,e){return oa(this,void 0,void 0,function*(){return Promise.race([t,aa.wait(e,!1)])})}}var sa=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})};class la{constructor(){this.host=Pi.BACKEND_URL,this.stepSubject=new P,this.finishSubject=new P}connectToLobby(t){return sa(this,void 0,void 0,function*(){if(t.startsWith("::")){const e=+t.substr(2);let r=Pi.BACKEND_URL;r.match(/:\d+\/?$/)&&(r=r.substr(0,r.lastIndexOf(":"))),t=`${r}:${e}`}try{return yield aa.doWithFailTimeout(new Promise((e,r)=>{const n=(...t)=>{console.log("$%%%%% conn "+this.socket.id)},i=(...t)=>{a(),r("disconnected")},o=(...t)=>{console.log("$%%%%% lobbydata "+JSON.stringify(t)),a(),e()},a=()=>{this.socket.off("connect",n),this.socket.off("disconnect",i),this.socket.off("addedToLobby",o)};console.log(`Connecting to lobby ${t}...`),this.socket=this.initSocket(t),(()=>{this.socket.on("connect",n),this.socket.on("disconnect",i),this.socket.on("addedToLobby",o)})(),this.socket.connect()}),1e4)}catch(t){if(this.socket)return this.socket.disconnect(),Promise.reject(t)}})}socketAvailable(){return!!this.socket}disconnect(){this.socket.disconnect(),this.socket=null}readyToStart(t){this.carId=t.id,this.socket.emit("readyToStart",t)}nextStep(t){this.socket.emit("nextStep",t)}finished(t){console.log("emitting finished",{id:this.carId,stepsCount:t}),this.socket.emit("finished",{id:this.carId,stepsCount:t})}onStepComplete(t){this.stepSubject.next(t)}onRaceFinished(t){console.log("raceComplete. winner?",t===this.carId),this.finishSubject.next(t===this.carId),this.disconnect()}initSocket(t){const e=ia(t);return e.on("connect",()=>{console.log("socket connected")}),e.on("disconnect",()=>{console.log("socket disconnected")}),e.on("error",t=>{console.log("ERROR: ",t)}),e.on("stepComplete",t=>this.onStepComplete(t)),e.on("raceFinished",t=>this.onRaceFinished(t)),e}}class ca{constructor(t){this.apiHttpService=t}createLobby(t){return this.apiHttpService.apiPost("lobby/createLobby",{playersCount:t})}getLobbies(){return this.apiHttpService.apiGet("lobby/getLobbies")}quickStart(){return this.apiHttpService.apiPost("lobby/quickStart")}}class ua{constructor(t){this.lobbyDelegate=t}createPracticeLobby(t=1){return this.lobbyDelegate.createLobby(t)}createLobby(t=2){return this.lobbyDelegate.createLobby(t)}getLobbies(){return this.lobbyDelegate.getLobbies()}quickStart(){return this.lobbyDelegate.quickStart()}}var ha=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})};class da{constructor(t,e,r,n){this.loginService=t,this.lobbyService=e,this.socketService=r,this.router=n}onPracticeClick(){this.lobbyService.createPracticeLobby().subscribe(t=>ha(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}onCreateLobby(t){+t<2?console.log("not creating lobby for 1 or less player"):this.lobbyService.createPracticeLobby(+t).subscribe(t=>ha(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}onPlayClick(){this.lobbyService.quickStart().subscribe(t=>ha(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}onSettingsClick(){}onExitClick(){this.loginService.logout()}}class pa extends P{constructor(t){this._value=t}get value(){return this.getValue()}_subscribe(t){return super._subscribe(t)}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new A;return this._value}next(t){this._value=t}}class fa extends Error{constructor(){this.name="EmptyError"}}class ma extends Error{constructor(){this.name="ArgumentOutOfRangeError"}}function va(t){return function(e){return 0===t?Ni():e.lift(new ga(t))}}class ga{constructor(t){if(this.total=t,this.total<0)throw new ma}call(t,e){return e.subscribe(new ya(t,this.total))}}class ya extends y{constructor(t,e){this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,r=this.total,n=this.count++;e.length<r||(e[n%r]=t)}_complete(){let t=this.count;if(t>0){const e=this.count>=this.total?this.total:this.count;for(let r=0;r<e;r++)t++}}}function xa(t,e,r){return function(n){return n.lift(new ba(t,e,r))}}class ba{constructor(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}call(t,e){return e.subscribe(new wa(t,this.nextOrObserver,this.error,this.complete))}}class wa extends y{constructor(t,e,r,n){this._tapNext=w,this._tapError=w,this._tapComplete=w,this._tapError=r||w,this._tapComplete=n||w,i(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||w,this._tapError=e.error||w,this._tapComplete=e.complete||w)}_next(t){}_error(t){}_complete(){return this.destination.complete()}}const _a=(t=function(){return new fa})=>xa({hasValue:!1,next(){this.hasValue=!0},complete(){if(!this.hasValue)throw t()}});function Sa(t=null){return e=>e.lift(new Ta(t))}class Ta{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new Ma(t,this.defaultValue))}}class Ma extends y{constructor(t,e){this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1}_complete(){}}function Aa(t,e){const r=arguments.length>=2;return n=>n.pipe(t?Di((e,r)=>t(e,r,n)):Q,va(1),r?Sa(e):_a(()=>new fa))}function Ea(t){return e=>0===t?Ni():e.lift(new Ca(t))}class Ca{constructor(t){if(this.total=t,this.total<0)throw new ma}call(t,e){return e.subscribe(new Pa(t,this.total))}}class Pa extends y{constructor(t,e){this.total=e,this.count=0}_next(t){++this.count}}function Oa(t,e){const r=arguments.length>=2;return n=>n.pipe(t?Di((e,r)=>t(e,r,n)):Q,Ea(1),r?Sa(e):_a(()=>new fa))}function Na(t,e){return r=>r.lift(new La(t,e,r))}class La{constructor(t,e,r){this.predicate=t,this.thisArg=e,this.source=r}call(t,e){return e.subscribe(new Ia(t,this.predicate,this.thisArg,this.source))}}class Ia extends y{constructor(t,e,r,n){this.predicate=e,this.thisArg=r,this.source=n,this.index=0,this.thisArg=r||this}notifyComplete(t){}_next(t){let e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return}}_complete(){}}function Ra(t,e){let r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new Da(t,e,r))}}class Da{constructor(t,e,r=!1){this.accumulator=t,this.seed=e,this.hasSeed=r}call(t,e){return e.subscribe(new Fa(t,this.accumulator,this.seed,this.hasSeed))}}class Fa extends y{constructor(t,e,r,n){this.accumulator=e,this._seed=r,this.hasSeed=n,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t}_tryNext(t){const e=this.index++;let r;try{r=this.accumulator(this.seed,t,e)}catch(t){}this.seed=r}}function Ua(t,e){return arguments.length>=2?function(r){return _(Ra(t,e),va(1),Sa(e))(r)}:function(e){return _(Ra((e,r,n)=>t(e,r,n+1)),va(1))(e)}}function ka(){return K(1)}let Ba=null;function ja(){return Ba}class za{constructor(){this.resourceLoaderType=null}get attrToPropMap(){return this._attrToPropMap}set attrToPropMap(t){this._attrToPropMap=t}}const Va={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},Ga={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ha={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};let Wa;xt.Node&&(Wa=xt.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))});let Xa,Ya=null;const qa=_o;function Ja(){return!!window.history.pushState}class Za extends ki{constructor(t){this._doc=t}_init(){this.location=ja().getLocation(),this._history=ja().getHistory()}getBaseHrefFromDOM(){return ja().getBaseHref(this._doc)}onPopState(t){}onHashChange(t){}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,r){Ja()||(this.location.hash=r)}replaceState(t,e,r){Ja()||(this.location.hash=r)}forward(){}back(){}}Za.ctorParameters=(()=>[{type:void 0,decorators:[{type:Ot,args:[qa]}]}]);class Qa{constructor(t){this._doc=t,this._dom=ja()}addTag(t,e=!1){return t?this._getOrCreateElement(t,e):null}addTags(t,e=!1){return t?t.reduce((t,e)=>t,[]):[]}getTag(t){return t&&this._dom.querySelector(this._doc,`meta[${t}]`)||null}getTags(t){if(!t)return[];const e=this._dom.querySelectorAll(this._doc,`meta[${t}]`);return e?[].slice.call(e):[]}updateTag(t,e){if(!t)return null;const r=this.getTag(e=e||this._parseSelector(t));return r?this._setMetaElementAttributes(t,r):this._getOrCreateElement(t,!0)}removeTag(t){}removeTagElement(t){}_getOrCreateElement(t,e=!1){if(!e){const e=this.getTag(this._parseSelector(t));if(e&&this._containsAttributes(t,e))return e}return this._dom.createElement("meta")}_setMetaElementAttributes(t,e){return e}_parseSelector(t){const e=t.name?"name":"property";return`${e}="${t[e]}"`}_containsAttributes(t,e){return Object.keys(t).every(r=>this._dom.getAttribute(e,r)===t[r])}}const Ka=new ut("TRANSITION_ID"),$a=[{provide:_e,useFactory:function(t,e,r){return()=>{r.get(Se).donePromise.then(()=>{const r=ja();Array.prototype.slice.apply(r.querySelectorAll(e,"style[ng-transition]")).filter(e=>r.getAttribute(e,"ng-transition")===t).forEach(t=>r.remove(t))})}},deps:[Ka,qa,kt],multi:!0}];class ts{constructor(t){this._doc=t}getTitle(){return ja().getTitle(this._doc)}setTitle(t){}}function es(t,e){"undefined"!=typeof COMPILED&&COMPILED||((xt.ng=xt.ng||{})[t]=e)}const rs={ApplicationRef:ur,NgZone:Ye};function ns(t){return Mr.get(t)||null}const is=new ut("EventManagerPlugins");class os{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,this._plugins=t.slice().reverse()}addEventListener(t,e,r){return this._findPluginFor(e).addEventListener(t,e,r)}addGlobalEventListener(t,e,r){return this._findPluginFor(e).addGlobalEventListener(t,e,r)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const r=this._plugins;for(let n=0;n<r.length;n++){const e=r[n];if(e.supports(t))return e}throw new Error(`No event manager plugin found for event ${t}`)}}class as{constructor(t){this._doc=t}addGlobalEventListener(t,e,r){const n=ja().getGlobalEventTarget(this._doc,t);if(!n)throw new Error(`Unsupported event target ${n} for event ${e}`);return this.addEventListener(n,e,r)}}class ss{constructor(){this._stylesSet=new Set}addStyles(t){}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}class ls extends ss{constructor(t){this._doc=t,this._hostNodes=new Set,this._styleNodes=new Set}_addStylesToHost(t,e){}addHost(t){}removeHost(t){}onStylesAdded(t){}ngOnDestroy(){}}const cs={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},us=/%COMP%/g,hs="_nghost-%COMP%",ds="_ngcontent-%COMP%";function ps(t){return e=>{!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}class fs{constructor(t,e){this.eventManager=t,this.sharedStylesHost=e,this.rendererByCompId=new Map,this.defaultRenderer=new ms(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case qt.Emulated:{let t=this.rendererByCompId.get(e.id);return t||(t=new vs(this.eventManager,this.sharedStylesHost,e)),t}case qt.Native:return new gs(this.eventManager,this.sharedStylesHost,t,e);default:return this.defaultRenderer}}begin(){}end(){}}class ms{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(cs[e],t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){}insertBefore(t,e,r){}removeChild(t,e){}selectRootElement(t){let e="string"==typeof t?document.querySelector(t):t;if(!e)throw new Error(`The selector "${t}" did not match any elements`);return e.textContent="",e}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,r,n){n&&(e=`${n}:${e}`)}removeAttribute(t,e,r){}addClass(t,e){}removeClass(t,e){}setStyle(t,e,r,n){n&dr.DashCase||(t.style[e]=r)}removeStyle(t,e,r){r&dr.DashCase||(t.style[e]="")}setProperty(t,e,r){t[e]=r}setValue(t,e){t.nodeValue=e}listen(t,e,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,ps(r)):this.eventManager.addEventListener(t,e,ps(r))}}class vs extends ms{constructor(t,e,r){this.component=r,this.contentAttr=function(t){return ds.replace(us,r.id)}(),this.hostAttr=function(t){return hs.replace(us,r.id)}()}applyToHost(t){}createElement(t,e){return super.createElement(t,e)}}class gs extends ms{constructor(t,e,r,n){this.sharedStylesHost=e,this.hostEl=r,this.component=n,this.shadowRoot=r.createShadowRoot();const i=function t(e,r,n){for(let i=0;i<r.length;i++){let o=r[i];Array.isArray(o)?t(e,o,n):(o=o.replace(us,e),n.push(o))}return n}(n.id,n.styles,[]);for(let o=0;o<i.length;o++)document.createElement("style").textContent=i[o]}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,r){return super.insertBefore(this.nodeOrShadowRoot(t),e,r)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}const ys="undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t},xs=ys("addEventListener"),bs=ys("removeEventListener"),ws={};let _s;"undefined"!=typeof Zone&&Zone[ys("BLACK_LISTED_EVENTS")]&&(_s={});const Ss=function(t){return!!_s&&_s.hasOwnProperty(t)},Ts={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Ms=new ut("HammerGestureConfig");class As{constructor(){this.events=[],this.overrides={}}buildHammer(t){const e=new Hammer(t,this.options);for(const r in this.overrides);return e}}class Es extends as{constructor(t){}supports(t){return null!=Es.parseEventName(t)}addEventListener(t,e,r){const n=Es.parseEventName(e),i=Es.eventCallback(n.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ja().onAndCancel(t,n.domEventName,i))}static parseEventName(t){const e=t.toLowerCase().split("."),r=e.shift();if(0===e.length||"keydown"!==r&&"keyup"!==r)return null;const n=Es._normalizeKey(e.pop());let i="";if(i+=n,0!=e.length||0===n.length)return null;const o={};return o.domEventName=r,o.fullKey=i,o}static getEventFullKey(t){let e=ja().getEventKey(t);return" "===(e=e.toLowerCase())?e="space":"."===e&&(e="dot"),""+e}static eventCallback(t,e,r){return t=>{}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}class Cs{}class Ps extends Cs{constructor(t){this._doc=t}sanitize(t,e){if(null==e)return null;switch(t){case pn.NONE:return e;case pn.HTML:return e instanceof Ns?e.changingThisBreaksApplicationSecurity:function(t,e){let r=null;try{cn=cn||new Xr(t);let n=e?String(e):"";r=cn.getInertBodyElement(n);let i=5,o=n;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,n=o,o=r.innerHTML,r=cn.getInertBodyElement(n)}while(n!==o);const a=new ln,s=a.sanitizeChildren(un(r)||r);return ir()&&a.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss)."),s}finally{if(r){const t=un(r)||r;for(;t.firstChild;)t.removeChild(t.firstChild)}}}(this._doc,String(e));case pn.STYLE:return e instanceof Ls?e.changingThisBreaksApplicationSecurity:function(t){if(!(t=String(t).trim()))return"";const e=t.match(dn);return e&&Jr(e[1])===e[1]||t.match(hn)&&function(t){let e=!0,r=!0;for(let n=0;n<t.length;n++){const i=t.charAt(n);"'"===i&&r?e=!e:'"'===i&&e&&(r=!r)}return e&&r}(t)?t:(ir()&&console.warn(`WARNING: sanitizing unsafe style value ${t} (see http://g.co/ng/security#xss).`),"unsafe")}(e);case pn.SCRIPT:if(e instanceof Is)return e.changingThisBreaksApplicationSecurity;throw new Error("unsafe value used in a script context");case pn.URL:return e instanceof Ds||e instanceof Rs?e.changingThisBreaksApplicationSecurity:Jr(String(e));case pn.RESOURCE_URL:if(e instanceof Ds)return e.changingThisBreaksApplicationSecurity;throw new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see http://g.co/ng/security#xss)`)}}checkNotSafeValue(t,e){if(t instanceof Os)throw new Error(`Required a safe ${e}, got a ${t.getTypeName()} `+"(see http://g.co/ng/security#xss)")}bypassSecurityTrustHtml(t){return new Ns(t)}bypassSecurityTrustStyle(t){return new Ls(t)}bypassSecurityTrustScript(t){return new Is(t)}bypassSecurityTrustUrl(t){return new Rs(t)}bypassSecurityTrustResourceUrl(t){return new Ds(t)}}class Os{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity}`+" (see http://g.co/ng/security#xss)"}}class Ns extends Os{getTypeName(){return"HTML"}}class Ls extends Os{getTypeName(){return"Style"}}class Is extends Os{getTypeName(){return"Script"}}class Rs extends Os{getTypeName(){return"URL"}}class Ds extends Os{getTypeName(){return"ResourceURL"}}const Fs=ar(jr,"browser",[{provide:Ce,useValue:"browser"},{provide:Ee,useValue:function(){(class extends class extends za{constructor(){this._animationPrefix=null,this._transitionEnd=null;try{const t=this.createElement("div",document);if(null!=this.getStyle(t,"animationName"))this._animationPrefix="";else{const e=["Webkit","Moz","O","ms"];for(let r=0;r<e.length;r++)if(null!=this.getStyle(t,e[r]+"AnimationName")){this._animationPrefix="-"+e[r].toLowerCase()+"-";break}}}catch(t){this._animationPrefix=null,this._transitionEnd=null}}getDistributedNodes(t){return t.getDistributedNodes()}resolveAndSetHref(t,e,r){t.href=null==r?e:e+"/../"+r}supportsDOMEvents(){return!0}supportsNativeShadowDOM(){return"function"==typeof document.body.createShadowRoot}getAnimationPrefix(){return this._animationPrefix?this._animationPrefix:""}getTransitionEnd(){return this._transitionEnd?this._transitionEnd:""}supportsAnimation(){return null!=this._animationPrefix&&null!=this._transitionEnd}}{parse(t){throw new Error("parse not implemented")}static makeCurrent(){}hasProperty(t,e){return e in t}setProperty(t,e,r){t[e]=r}getProperty(t,e){return t[e]}invoke(t,e,r){}logError(t){window.console&&console}log(t){window.console&&window}logGroup(t){window.console&&window}logGroupEnd(){window.console&&window}get attrToPropMap(){return Va}contains(t,e){return Wa.call(t,e)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return t.querySelectorAll(e)}on(t,e,r){}onAndCancel(t,e,r){return()=>{}}dispatchEvent(t,e){}createMouseEvent(t){return this.getDefaultDocument().createEvent("MouseEvent")}createEvent(t){return this.getDefaultDocument().createEvent("Event")}preventDefault(t){t.returnValue=!1}isPrevented(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue}getInnerHTML(t){return t.innerHTML}getTemplateContent(t){return"content"in t&&this.isTemplateElement(t)?t.content:null}getOuterHTML(t){return t.outerHTML}nodeName(t){return t.nodeName}nodeValue(t){return t.nodeValue}type(t){return t.type}content(t){return this.hasProperty(t,"content")?t.content:t}firstChild(t){return t.firstChild}nextSibling(t){return t.nextSibling}parentElement(t){return t.parentNode}childNodes(t){return t.childNodes}childNodesAsList(t){const e=t.childNodes,r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n];return r}clearNodes(t){for(;t.firstChild;);}appendChild(t,e){}removeChild(t,e){}replaceChild(t,e,r){}remove(t){return t}insertBefore(t,e,r){}insertAllBefore(t,e,r){}insertAfter(t,e,r){}setInnerHTML(t,e){t.innerHTML=e}getText(t){return t.textContent}setText(t,e){t.textContent=e}getValue(t){return t.value}setValue(t,e){t.value=e}getChecked(t){return t.checked}setChecked(t,e){t.checked=e}createComment(t){return this.getDefaultDocument().createComment(t)}createTemplate(t){const e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createElementNS(t,e,r){return(r=r||this.getDefaultDocument()).createElementNS(t,e)}createTextNode(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)}createScriptTag(t,e,r){return(r=r||this.getDefaultDocument()).createElement("SCRIPT")}createStyleElement(t,e){return(e=e||this.getDefaultDocument()).createElement("style")}createShadowRoot(t){return t.createShadowRoot()}getShadowRoot(t){return t.shadowRoot}getHost(t){return t.host}clone(t){return t.cloneNode(!0)}getElementsByClassName(t,e){return t.getElementsByClassName(e)}getElementsByTagName(t,e){return t.getElementsByTagName(e)}classList(t){return Array.prototype.slice.call(t.classList,0)}addClass(t,e){}removeClass(t,e){}hasClass(t,e){return t.classList.contains(e)}setStyle(t,e,r){t.style[e]=r}removeStyle(t,e){t.style[e]=""}getStyle(t,e){return t.style[e]}hasStyle(t,e,r){const n=this.getStyle(t,e)||"";return r?n==r:n.length>0}tagName(t){return t.tagName}attributeMap(t){const e=new Map,r=t.attributes;for(let n=0;n<r.length;n++);return e}hasAttribute(t,e){return t.hasAttribute(e)}hasAttributeNS(t,e,r){return t.hasAttributeNS(e,r)}getAttribute(t,e){return t.getAttribute(e)}getAttributeNS(t,e,r){return t.getAttributeNS(e,r)}setAttribute(t,e,r){}setAttributeNS(t,e,r,n){}removeAttribute(t,e){}removeAttributeNS(t,e,r){}templateAwareRoot(t){return this.isTemplateElement(t)?this.content(t):t}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}getBoundingClientRect(t){try{return t.getBoundingClientRect()}catch(t){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}getTitle(t){return t.title}setTitle(t,e){t.title=e||""}elementMatches(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))}isTemplateElement(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName}isTextNode(t){return t.nodeType===Node.TEXT_NODE}isCommentNode(t){return t.nodeType===Node.COMMENT_NODE}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}hasShadowRoot(t){return null!=t.shadowRoot&&t instanceof HTMLElement}isShadowRoot(t){return t instanceof DocumentFragment}importIntoDoc(t){return document.importNode(this.templateAwareRoot(t),!0)}adoptNode(t){return document.adoptNode(t)}getHref(t){return t.getAttribute("href")}getEventKey(t){let e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&Ha.hasOwnProperty(e)&&(e=Ha[e]))}return Ga[e]||e}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(t){const e=Ya||(Ya=document.querySelector("base"))?Ya.getAttribute("href"):null;return null==e?null:function(t){return Xa||(Xa=document.createElement("a")),Xa.setAttribute("href",t),"/"===Xa.pathname.charAt(0)?Xa.pathname:"/"+Xa.pathname}(e)}resetBaseElement(){Ya=null}getUserAgent(){return window.navigator.userAgent}setData(t,e,r){}getData(t,e){return this.getAttribute(t,"data-"+e)}getComputedStyle(t){return getComputedStyle(t)}supportsWebAnimation(){return"function"==typeof Element.prototype.animate}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(t){return to(document.cookie,t)}setCookie(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)}}).makeCurrent(),class{static init(){}addToWindow(t){xt.getAngularTestability=((e,r=!0)=>{const n=t.findTestabilityInTree(e,r);if(null==n)throw new Error("Could not find testability for element.");return n}),xt.getAllAngularTestabilities=(()=>t.getAllTestabilities()),xt.getAllAngularRootElements=(()=>t.getAllRootElements()),xt.frameworkStabilizers||(xt.frameworkStabilizers=[])}findTestabilityInTree(t,e,r){if(null==e)return null;const n=t.getTestability(e);return null!=n?n:r?this.findTestabilityInTree(t,ja().isShadowRoot(e)?ja().getHost(e):ja().parentElement(e),!0):null}}.init()},multi:!0},{provide:ki,useClass:Za,deps:[qa]},{provide:qa,useFactory:function(){return document},deps:[]}]);function Us(){return new $t}class ks{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:ks,providers:[{provide:Te,useValue:t.appId},{provide:Ka,useExisting:Te},$a]}}}"undefined"!=typeof window&&window;class Bs{constructor(t,e){this.id=t,this.url=e}}class js extends Bs{constructor(t,e,r){this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class zs{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Vs{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}const Gs="primary";class Hs{constructor(t){this.params=t||{}}has(t){return this.params.hasOwnProperty(t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Ws(t){return new Hs(t)}const Xs="ngNavigationCancelingError";function Ys(t,e,r){const n=r.path.split("/");if(n.length>t.length)return null;if("full"===r.pathMatch&&(e.hasChildren()||n.length<t.length))return null;const i={};for(let o=0;o<n.length;o++){const e=n[o],r=t[o];if(e.startsWith(":"))i[e.substring(1)]=r;else if(e!==r.path)return null}return{consumed:t.slice(0,n.length),posParams:i}}class qs{constructor(t,e){this.routes=t,this.module=e}}function Js(t){const e=t.children&&t.children.map(Js);return e?Object.assign({},t,{children:e}):Object.assign({},t)}function Zs(t,e){const r=Object.keys(t),n=Object.keys(e);if(r.length!=n.length)return!1;let i;for(let o=0;o<r.length;o++)if(t[i=r[o]]!==e[i])return!1;return!0}function Qs(t){return Array.prototype.concat.apply([],t)}function Ks(t){return t.length>0?t[t.length-1]:null}function $s(t,e){for(const r in t)t.hasOwnProperty(r)&&e(t[r],r)}function tl(t){return function(t){return!!t&&"function"==typeof t.subscribe}(t)?t:we(t)?Y(Promise.resolve(t)):Ii(t)}class el{constructor(t,e,r){this.root=t,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ws(this.queryParams)),this._queryParamMap}toString(){return ll.serialize(this)}}class rl{constructor(t,e){this.segments=t,this.children=e,this.parent=null}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return cl(this)}}class nl{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Ws(this.parameters)),this._parameterMap}toString(){return ml(this)}}function il(t,e){return t.length===e.length&&t.every((t,r)=>t.path===e[r].path)}function ol(t,e){let r=[];return $s(t.children,(t,n)=>{n===Gs&&(r=r.concat(e(t,n)))}),$s(t.children,(t,n)=>{n!==Gs&&(r=r.concat(e(t,n)))}),r}class al{}class sl{parse(t){const e=new bl(t);return new el(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){return`${`/${function t(e,r){if(!e.hasChildren())return cl(e);if(r){const r=e.children[Gs]?t(e.children[Gs],!1):"",n=[];return $s(e.children,(e,r)=>{r!==Gs&&n.push(`${r}:${t(e,!1)}`)}),n.length>0?`${r}(${n.join("//")})`:r}{const r=ol(e,(r,n)=>n===Gs?[t(e.children[Gs],!1)]:[`${n}:${t(r,!1)}`]);return`${cl(e)}/(${r.join("//")})`}}(t.root,!0)}`}${function(t){const e=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(t=>`${hl(e)}=${hl(t)}`).join("&"):`${hl(e)}=${hl(r)}`});return e.length?`?${e.join("&")}`:""}(t.queryParams)}${"string"==typeof t.fragment?`#${function(e){return encodeURI(t.fragment)}()}`:""}`}}const ll=new sl;function cl(t){return t.segments.map(t=>ml(t)).join("/")}function ul(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function hl(t){return ul(t).replace(/%3B/gi,";")}function dl(t){return ul(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function pl(t){return decodeURIComponent(t)}function fl(t){return pl(t.replace(/\+/g,"%20"))}function ml(t){return`${dl(t.path)}${function(t){return Object.keys(t).map(e=>`;${dl(e)}=${dl(t[e])}`).join("")}(t.parameters)}`}const vl=/^[^\/()?;=&#]+/;function gl(t){const e=t.match(vl);return e?e[0]:""}const yl=/^[^=?&#]+/,xl=/^[^?&#]+/;class bl{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return new rl([],""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?{}:this.parseChildren())}parseQueryParams(){if(this.consumeOptional("?"))do{}while(this.consumeOptional("&"));return{}}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};const t=[];for(;this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/("););let e={};this.peekStartsWith("/(")&&(e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(r[Gs]=new rl(t,e)),r}parseSegment(){const t=gl(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return new nl(pl(t),this.parseMatrixParams())}parseMatrixParams(){for(;this.consumeOptional(";"););return{}}parseParam(t){const e=gl(this.remaining);if(!e)return;let r="";if(this.consumeOptional("=")){const t=gl(this.remaining);t&&(r=t)}t[pl(e)]=pl(r)}parseQueryParam(t){const e=function(t){const e=t.match(yl);return e?e[0]:""}(this.remaining);if(!e)return;let r="";if(this.consumeOptional("=")){const t=function(t){const e=t.match(xl);return e?e[0]:""}(this.remaining);t&&(r=t)}const n=fl(e),i=fl(r);if(t.hasOwnProperty(n)){let e=t[n];Array.isArray(e)||(t[n]=e=[e])}else t[n]=i}parseParens(t){const e={};for(;!this.consumeOptional(")")&&this.remaining.length>0;){const r=gl(this.remaining),n=this.remaining[r.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;r.indexOf(":")>-1?i=r.substr(0,r.indexOf(":")):t&&(i=Gs);const o=this.parseChildren();e[i]=1===Object.keys(o).length?o[Gs]:new rl([],o)}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class wl{constructor(t){this.segmentGroup=t||null}}class _l{constructor(t){this.urlTree=t}}function Sl(t){return new T(e=>e.error(new wl(t)))}function Tl(t){return new T(e=>e.error(new _l(t)))}function Ml(t){return new T(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class Al{constructor(t,e,r,n,i){this.configLoader=e,this.urlSerializer=r,this.urlTree=n,this.config=i,this.allowRedirects=!0,this.ngModule=t.get(ze)}apply(){return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,Gs).pipe(G(t=>this.createUrlTree(t,this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ai(t=>{if(t instanceof _l)return this.allowRedirects=!1,this.match(t.urlTree);if(t instanceof wl)throw this.noMatchError(t);throw t}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,Gs).pipe(G(e=>this.createUrlTree(e,t.queryParams,t.fragment))).pipe(Ai(t=>{if(t instanceof wl)throw this.noMatchError(t);throw t}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,r){return new el(t.segments.length>0?new rl([],{[Gs]:t}):t,e,r)}expandSegmentGroup(t,e,r,n){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,e,r).pipe(G(t=>new rl([],t))):this.expandSegment(t,r,e,r.segments,n,!0)}expandChildren(t,e,r){return function(t,e){if(0===Object.keys(t).length)return Ii({});const r=[],n=[],i={};return $s(t,(t,o)=>{const a=e(o,t).pipe(G(t=>i[o]=t));o===Gs?r.push(a):n.push(a)}),Ii.apply(null,r.concat(n)).pipe(ka(),Aa(),G(()=>i))}(r.children,(r,n)=>this.expandSegmentGroup(t,e,n,r))}expandSegment(t,e,r,n,i,o){return Ii(...r).pipe(G(a=>this.expandSegmentAgainstRoute(t,e,r,a,n,i,o).pipe(Ai(t=>{if(t instanceof wl)return Ii(null);throw t}))),ka(),Oa(t=>!!t),Ai((t,r)=>{if(t instanceof fa||"EmptyError"===t.name){if(this.noLeftoversInUrl(e,n,i))return Ii(new rl([],{}));throw new wl(e)}throw t}))}noLeftoversInUrl(t,e,r){return 0===e.length&&!t.children[r]}expandSegmentAgainstRoute(t,e,r,n,i,o,a){return Ol(n)!==o?Sl(e):void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,e,n,i):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o):Sl(e)}expandSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o){return"**"===n.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,n,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,r,n){const i=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?Tl(i):this.lineralizeSegments(r,i).pipe(q(r=>this.expandSegment(t,new rl(r,{}),e,r,n,!1)))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o){const{matched:a,consumedSegments:s,lastChild:l,positionalParamSegments:c}=El(e,n,i);if(!a)return Sl(e);const u=this.applyRedirectCommands(s,n.redirectTo,c);return n.redirectTo.startsWith("/")?Tl(u):this.lineralizeSegments(n,u).pipe(q(n=>this.expandSegment(t,e,r,n.concat(i.slice(l)),o,!1)))}matchSegmentAgainstRoute(t,e,r,n){if("**"===r.path)return r.loadChildren?this.configLoader.load(t.injector,r).pipe(G(t=>(r._loadedConfig=t,new rl(n,{})))):Ii(new rl(n,{}));const{matched:i,consumedSegments:o,lastChild:a}=El(e,r,n);if(!i)return Sl(e);const s=n.slice(a);return this.getChildConfig(t,r).pipe(q(t=>{const r=t.module,n=t.routes,{segmentGroup:i,slicedSegments:a}=function(t,e,r,n){return r.length>0&&function(t,e,r){return n.some(r=>Pl(t,e,r)&&Ol(r)!==Gs)}(t,r)?{segmentGroup:Cl(new rl(e,function(t,e){const r={};r[Gs]=e;for(const n of t)""===n.path&&Ol(n)!==Gs&&(r[Ol(n)]=new rl([],{}));return r}(n,new rl(r,t.children)))),slicedSegments:[]}:0===r.length&&function(t,e,r){return n.some(r=>Pl(t,e,r))}(t,r)?{segmentGroup:Cl(new rl(t.segments,function(t,e,r,n){const i={};for(const o of r)Pl(t,e,o)&&!n[Ol(o)]&&(i[Ol(o)]=new rl([],{}));return Object.assign({},n,i)}(t,r,n,t.children))),slicedSegments:r}:{segmentGroup:t,slicedSegments:r}}(e,o,s,n);return 0===a.length&&i.hasChildren()?this.expandChildren(r,n,i).pipe(G(t=>new rl(o,t))):0===n.length&&0===a.length?Ii(new rl(o,{})):this.expandSegment(r,i,n,a,Gs,!0).pipe(G(t=>new rl(o.concat(t.segments),t.children)))}))}getChildConfig(t,e){return e.children?Ii(new qs(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?Ii(e._loadedConfig):function(t,e){const r=e.canLoad;return r&&0!==r.length?Y(r).pipe(G(r=>{const n=t.get(r);return tl(n.canLoad?n.canLoad(e):n(e))})).pipe(K(),Na(t=>!0===t)):Ii(!0)}(t.injector,e).pipe(q(r=>r?this.configLoader.load(t.injector,e).pipe(G(t=>(e._loadedConfig=t,t))):function(t){return new T(e=>e.error(function(t){const e=Error("NavigationCancelingError: "+t);return e[Xs]=!0,e}(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(e))):Ii(new qs([],t))}lineralizeSegments(t,e){let r=[],n=e.root;for(;;){if(r=r.concat(n.segments),0===n.numberOfChildren)return Ii(r);if(n.numberOfChildren>1||!n.children[Gs])return Ml(t.redirectTo);n=n.children[Gs]}}applyRedirectCommands(t,e,r){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,r)}applyRedirectCreatreUrlTree(t,e,r,n){return new el(this.createSegmentGroup(t,e.root,r,n),this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){return{}}createSegmentGroup(t,e,r,n){return new rl(this.createSegments(t,e.segments,r,n),{})}createSegments(t,e,r,n){return e.map(e=>e.path.startsWith(":")?this.findPosParam(t,e,n):this.findOrReturn(e,r))}findPosParam(t,e,r){const n=r[e.path.substring(1)];if(!n)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return n}findOrReturn(t,e){for(const r of e)if(r.path===t.path)return r;return t}}function El(t,e,r){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||r.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};const n=(e.matcher||Ys)(r,t,e);return n?{matched:!0,consumedSegments:n.consumed,lastChild:n.consumed.length,positionalParamSegments:n.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Cl(t){if(1===t.numberOfChildren&&t.children[Gs]){const e=t.children[Gs];return new rl(t.segments.concat(e.segments),e.children)}return t}function Pl(t,e,r){return(!(t.hasChildren()||e.length>0)||"full"!==r.pathMatch)&&""===r.path&&void 0!==r.redirectTo}function Ol(t){return t.outlet||Gs}class Nl{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=Ll(t,this._root);return e?e.children.map(t=>t.value):[]}firstChild(t){const e=Ll(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=Il(t,this._root);return e.length<2?[]:e[e.length-2].children.map(t=>t.value).filter(e=>e!==t)}pathFromRoot(t){return Il(t,this._root).map(t=>t.value)}}function Ll(t,e){if(t===e.value)return e;for(const r of e.children){const e=Ll(t,r);if(e)return e}return null}function Il(t,e){if(t===e.value)return[e];for(const r of e.children){const n=Il(t,r);if(n.length)return n.unshift(e),n}return[]}class Rl{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}class Dl extends Nl{constructor(t,e){this.snapshot=e}toString(){return this.snapshot.toString()}}class Fl{constructor(t,e,r,n,i,o,a,s){this.url=t,this.params=e,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=a,this._futureSnapshot=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(G(t=>Ws(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(G(t=>Ws(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}class Ul{constructor(t,e,r,n,i,o,a,s,l,c,u){this.url=t,this.params=e,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=a,this.routeConfig=s,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ws(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ws(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(t=>t.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class kl extends Nl{constructor(t,e){this.url=t}toString(){return Bl(this._root)}}function Bl(t){const e=t.children.length>0?` { ${t.children.map(Bl).join(", ")} } `:"";return`${t.value}${e}`}function jl(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function zl(t,e,r,n,i){let o={};return n&&$s(n,(t,e)=>{o[e]=Array.isArray(t)?t.map(t=>`${t}`):`${t}`}),new el(r.root===t?e:function t(e,r,n){const i={};return $s(e.children,(e,o)=>{i[o]=e===r?n:t(e,r,n)}),new rl(e.segments,i)}(r.root,t,e),o,i)}class Vl{constructor(t,e,r){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=r,t&&r.length>0&&jl(r[0]))throw new Error("Root segment cannot have matrix parameters");const n=r.find(t=>"object"==typeof t&&null!=t&&t.outlets);if(n&&n!==Ks(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Gl{constructor(t,e,r){this.segmentGroup=t,this.processChildren=e,this.index=r}}function Hl(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[Gs]:`${t}`}function Wl(t,e,r){if(t||(t=new rl([],{})),0===t.segments.length&&t.hasChildren())return Xl(t,e,r);const n=function(t,e,r){let n=0,i=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(n>=r.length)return o;const e=t.segments[i],a=Hl(r[n]),s=n<r.length-1?r[n+1]:null;if(i>0&&void 0===a)break;if(a&&s&&"object"==typeof s&&void 0===s.outlets){if(!Zl(a,s,e))return o;n+=2}else{if(!Zl(a,{},e))return o;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(t,e,r),i=r.slice(n.commandIndex);if(n.match&&n.pathIndex<t.segments.length){const e=new rl(t.segments.slice(0,n.pathIndex),{});return e.children[Gs]=new rl(t.segments.slice(n.pathIndex),t.children),Xl(e,0,i)}return n.match&&0===i.length?new rl(t.segments,{}):n.match&&!t.hasChildren()?Yl(t,e,r):n.match?Xl(t,0,i):Yl(t,e,r)}function Xl(t,e,r){if(0===r.length)return new rl(t.segments,{});{const n=function(t){return"object"!=typeof t[0]?{[Gs]:t}:void 0===t[0].outlets?{[Gs]:t}:t[0].outlets}(r),i={};return $s(n,(r,n)=>{null!==r&&(i[n]=Wl(t.children[n],e,r))}),$s(t.children,(t,e)=>{void 0===n[e]&&(i[e]=t)}),new rl(t.segments,i)}}function Yl(t,e,r){const n=t.segments.slice(0,e);let i=0;for(;i<r.length;){if("object"==typeof r[i]&&void 0!==r[i].outlets){const t=ql(r[i].outlets);return new rl(n,t)}if(0===i&&jl(r[0])){n.push(new nl(t.segments[e].path,r[0])),i++;continue}const o=Hl(r[i]),a=i<r.length-1?r[i+1]:null;o&&a&&jl(a)?(n.push(new nl(o,Jl(a))),i+=2):(n.push(new nl(o,{})),i++)}return new rl(n,{})}function ql(t){const e={};return $s(t,(t,r)=>{null!==t&&(e[r]=Yl(new rl([],{}),0,t))}),e}function Jl(t){const e={};return $s(t,(t,r)=>e[r]=`${t}`),e}function Zl(t,e,r){return t==r.path&&Zs(e,r.parameters)}class Ql{}class Kl{constructor(t,e,r,n,i){this.rootComponentType=t,this.config=e,this.urlTree=r,this.url=n,this.paramsInheritanceStrategy=i}recognize(){try{const t=this.processSegmentGroup(this.config,ec(this.urlTree.root,[],[],this.config).segmentGroup,Gs);return Ii(new kl(this.url,new Rl(new Ul([],Object.freeze({}),Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,{},Gs,this.rootComponentType,null,this.urlTree.root,-1,{}),t)))}catch(t){return new T(e=>e.error(t))}}inheritParamsAndData(t){const e=t.value,r=function(t,e="emptyOnly"){const r=t.pathFromRoot;let n=0;if("always"!==e)for(n=r.length-1;n>=1;){const t=r[n],e=r[n-1];if(t.routeConfig&&""===t.routeConfig.path)n--;else{if(e.component)break;n--}}return function(t){return t.reduce((t,e)=>({params:Object.assign({},t.params,e.params),data:Object.assign({},t.data,e.data),resolve:Object.assign({},t.resolve,e._resolvedData)}),{params:{},data:{},resolve:{}})}(r.slice(n))}(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data)}processSegmentGroup(t,e,r){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,r)}processChildren(t,e){return ol(e,(e,r)=>this.processSegmentGroup(t,e,r))}processSegment(t,e,r,n){for(const i of t)try{return this.processSegmentAgainstRoute(i,e,r,n)}catch(t){if(!(t instanceof Ql))throw t}if(this.noLeftoversInUrl(e,r,n))return[];throw new Ql}noLeftoversInUrl(t,e,r){return 0===e.length&&!t.children[r]}processSegmentAgainstRoute(t,e,r,n){if(t.redirectTo)throw new Ql;if((t.outlet||Gs)!==n)throw new Ql;let i,o=[],a=[];if("**"===t.path)i=new Ul(r,r.length>0?Ks(r).parameters:{},Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,ic(t),n,t.component,t,$l(e),tc(e)+r.length,oc(t));else{const s=function(t,e,r){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||r.length>0))throw new Ql;return{consumedSegments:[],lastChild:0,parameters:{}}}const n=(e.matcher||Ys)(r,t,e);if(!n)throw new Ql;const i={};$s(n.posParams,(t,e)=>{i[e]=t.path});const o=n.consumed.length>0?Object.assign({},i,n.consumed[n.consumed.length-1].parameters):i;return{consumedSegments:n.consumed,lastChild:n.consumed.length,parameters:o}}(e,t,r);o=s.consumedSegments,a=r.slice(s.lastChild),i=new Ul(o,s.parameters,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,ic(t),n,t.component,t,$l(e),tc(e)+o.length,oc(t))}const s=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),{segmentGroup:l,slicedSegments:c}=ec(e,o,a,s);return 0===c.length&&l.hasChildren()?[new Rl(i,this.processChildren(s,l))]:0===s.length&&0===c.length?[new Rl(i,[])]:[new Rl(i,this.processSegment(s,l,c,Gs))]}}function $l(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function tc(t){let e=t,r=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)r+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return r-1}function ec(t,e,r,n){if(r.length>0&&function(t,e,r){return n.some(r=>rc(t,e,r)&&nc(r)!==Gs)}(t,r)){const i=new rl(e,function(t,e,r,n){const i={};i[Gs]=n,n._sourceSegment=t,n._segmentIndexShift=e.length;for(const o of r)if(""===o.path&&nc(o)!==Gs){const r=new rl([],{});r._sourceSegment=t,r._segmentIndexShift=e.length,i[nc(o)]=r}return i}(t,e,n,new rl(r,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===r.length&&function(t,e,r){return n.some(r=>rc(t,e,r))}(t,r)){const i=new rl(t.segments,function(t,e,r,n){const i={};for(const o of r)if(rc(t,e,o)&&!n[nc(o)]){const e=new rl([],{});e._sourceSegment=t,e._segmentIndexShift=t.segments.length,i[nc(o)]=e}return Object.assign({},n,i)}(t,r,n,t.children));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:r}}const i=new rl(t.segments,t.children);return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:r}}function rc(t,e,r){return(!(t.hasChildren()||e.length>0)||"full"!==r.pathMatch)&&""===r.path&&void 0===r.redirectTo}function nc(t){return t.outlet||Gs}function ic(t){return t.data||{}}function oc(t){return t.resolve||{}}class ac{}class sc{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}const lc=new ut("ROUTES");class cc{constructor(t,e,r,n){this.loader=t,this.compiler=e,this.onLoadStartListener=r,this.onLoadEndListener=n}load(t,e){return this.loadModuleFactory(e.loadChildren).pipe(G(e=>{const r=e.create(t);return new qs(Qs(r.injector.get(lc)).map(Js),r)}))}loadModuleFactory(t){return"string"==typeof t?Y(this.loader.load(t)):tl(t()).pipe(q(t=>t instanceof Ve?Ii(t):Y(this.compiler.compileModuleAsync(t))))}}class uc{}class hc{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function dc(t){throw t}function pc(t){return Ii(null)}class fc{constructor(t,e,r,n,i,o,a,s){this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=r,this.location=n,this.config=s,this.navigations=new pa(null),this.navigationId=0,this.events=new P,this.errorHandler=dc,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:pc,afterPreactivation:pc},this.urlHandlingStrategy=new hc,this.routeReuseStrategy=new sc,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.ngModule=i.get(ze),this.currentUrlTree=function(){return new el(new rl([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.configLoader=new cc(o,a,t=>this.triggerEvent(new zs(t)),t=>this.triggerEvent(new Vs(t))),this.routerState=function(t,e){const r=function(t,e){const r=new Ul([],{},{},"",{},Gs,e,null,t.root,-1,{});return new kl("",new Rl(r,[]))}(t,e),n=new pa([new nl("",{})]),i=new pa({}),o=new pa({}),a=new pa({}),s=new pa(""),l=new Fl(n,i,a,s,o,Gs,e,r.root);return l.snapshot=r.root,new Dl(new Rl(l,[]),r)}(this.currentUrlTree,this.rootComponentType)}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}initialNavigation(){}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{}))}get url(){return this.serializeUrl(this.currentUrlTree)}triggerEvent(t){}resetConfig(t){this.config=t.map(Js),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){}dispose(){this.locationSubscription&&(this.locationSubscription=null)}createUrlTree(t,e={}){const{relativeTo:r,queryParams:n,fragment:i,preserveQueryParams:o,queryParamsHandling:a,preserveFragment:s}=e;ir()&&o&&console&&console;const l=r||this.routerState.root,c=s?this.currentUrlTree.fragment:i;let u=null;if(a)switch(a){case"merge":u=Object.assign({},this.currentUrlTree.queryParams,n);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=n||null}else u=o?this.currentUrlTree.queryParams:n||null;return null!==u&&(u=this.removeEmptyProps(u)),function(t,e,r,n,i){if(0===r.length)return zl(e.root,e.root,e,n,i);const o=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new Vl(!0,0,t);let e=0,r=!1;const n=t.reduce((t,n,i)=>{if("object"==typeof n&&null!=n){if(n.outlets){const e={};return $s(n.outlets,(t,r)=>{e[r]="string"==typeof t?t.split("/"):t}),[...t,{outlets:e}]}if(n.segmentPath)return[...t,n.segmentPath]}return"string"!=typeof n?[...t,n]:0===i?(n.split("/").forEach((n,i)=>{0==i&&"."===n||(0==i&&""===n?r=!0:".."===n?e++:""!=n&&t.push(n))}),t):[...t,n]},[]);return new Vl(r,e,n)}(r);if(o.toRoot())return zl(e.root,new rl([],{}),e,n,i);const a=function(t,r,n){if(t.isAbsolute)return new Gl(e.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new Gl(n.snapshot._urlSegment,!0,0);const i=jl(t.commands[0])?0:1;return function(e,r,o){let a=n.snapshot._urlSegment,s=n.snapshot._lastPathIndex+i,l=t.numberOfDoubleDots;for(;l>s;){if(l-=s,!(a=a.parent))throw new Error("Invalid number of '../'");s=a.segments.length}return new Gl(a,!1,s-l)}()}(o,0,t),s=a.processChildren?Xl(a.segmentGroup,a.index,o.commands):Wl(a.segmentGroup,a.index,o.commands);return zl(a.segmentGroup,s,e,n,i)}(l,this.currentUrlTree,t,u,c)}navigateByUrl(t,e={skipLocationChange:!1}){return this.scheduleNavigation(this.urlHandlingStrategy.merge(t instanceof el?t:this.parseUrl(t),this.rawUrlTree),"imperative",null,e)}navigate(t,e={skipLocationChange:!1}){return this.navigateByUrl(this.createUrlTree(t,e),e)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){return this.urlSerializer.parse(t)}isActive(t,e){return function(t,e,r){return r?function(t,e){return Zs(t,e)}(t.queryParams,e.queryParams)&&function t(e,r){if(!il(e.segments,r.segments))return!1;if(e.numberOfChildren!==r.numberOfChildren)return!1;for(const n in r.children){if(!e.children[n])return!1;if(!t(e.children[n],r.children[n]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(r=>e[r]===t[r])}(t.queryParams,e.queryParams)&&function t(e,r){return function e(r,n,i){if(r.segments.length>i.length)return!!il(r.segments.slice(0,i.length),i)&&!n.hasChildren();if(r.segments.length===i.length){if(!il(r.segments,i))return!1;for(const e in n.children){if(!r.children[e])return!1;if(!t(r.children[e],n.children[e]))return!1}return!0}{const t=i.slice(0,r.segments.length),o=i.slice(r.segments.length);return!!il(r.segments,t)&&!!r.children[Gs]&&e(r.children[Gs],n,o)}}(e,r,r.segments)}(t.root,e.root)}(this.currentUrlTree,t instanceof el?t:this.urlSerializer.parse(t),e)}removeEmptyProps(t){return Object.keys(t).reduce((e,r)=>{const n=t[r];return null!==n&&void 0!==n&&(e[r]=n),e},{})}processNavigations(){}scheduleNavigation(t,e,r,n){const i=this.navigations.value;if(i&&"imperative"!==e&&"imperative"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(i&&"hashchange"==e&&"popstate"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(i&&"popstate"==e&&"hashchange"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);let o=null,a=null;const s=new Promise((t,e)=>{o=t,a=e});return++this.navigationId,s.catch(t=>Promise.reject(t))}executeScheduledNavigation({id:t,rawUrl:e,extras:r,resolve:n,reject:i,source:o,state:a}){const s=!this.navigated||this.urlHandlingStrategy.extract(e).toString()!==this.currentUrlTree.toString();("reload"===this.onSameUrlNavigation||s)&&this.urlHandlingStrategy.shouldProcessUrl(e)||s&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)||(this.rawUrlTree=e)}runNavigate(t,e,r,n,i,o){return i!==this.navigationId?Promise.resolve(!1):new Promise((e,r)=>{let n;n=o?Ii({appliedUrl:t,snapshot:o}):function(e,r,n,i,o){return new Al(e,r,n,t,o).apply()}(this.ngModule.injector,this.configLoader,this.urlSerializer,0,this.config).pipe(q(t=>(function(t,e,r,n,i="emptyOnly"){return new Kl(t,e,r,n,i).recognize()})(this.rootComponentType,this.config,t,this.serializeUrl(t),this.paramsInheritanceStrategy).pipe(G(e=>({appliedUrl:t,snapshot:e})))))})}activateRoutes(t,e,r,n,i,o,a,s,l,c){}resetStateAndUrl(t,e,r){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r)}resetUrlToCurrentUrlTree(){}}class mc{constructor(t,e,r,n,i){this.router=t,this.route=e,this.commands=[]}set routerLink(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]}set preserveQueryParams(t){ir()&&console&&console,this.preserve=t}onClick(){return!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:vc(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:vc(this.preserveFragment)})}}function vc(t){return""===t||!!t}class gc{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new yc,this.attachRef=null}}class yc{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){this.getOrCreateContext(t).outlet=e}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new gc),e}getContext(t){return this.contexts.get(t)||null}}class xc{constructor(t,e,r,n,i){this.parentContexts=t,this.location=e,this.resolver=r,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new Xe,this.deactivateEvents=new Xe,this.name=n||Gs}ngOnDestroy(){}ngOnInit(){}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,e){this.activated=t,this._activatedRoute=e}deactivate(){this.activated&&(this.activated=null,this._activatedRoute=null)}activateWith(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t,this.activated=this.location.createComponent((e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),this.location.length,new bc(t,this.parentContexts.getOrCreateContext(this.name).children,this.location.injector))}}class bc{constructor(t,e,r){this.route=t,this.childContexts=e,this.parent=r}get(t,e){return t===Fl?this.route:t===yc?this.childContexts:this.parent.get(t,e)}}class wc{}class _c{preload(t,e){return e().pipe(Ai(()=>Ii(null)))}}class Sc{preload(t,e){return Ii(null)}}class Tc{constructor(t,e,r,n,i){this.router=t,this.injector=n,this.preloadingStrategy=i,this.loader=new cc(e,r,e=>t.triggerEvent(new zs(e)),e=>t.triggerEvent(new Vs(e)))}setUpPreloading(){this.subscription=this.router.events.pipe(Di(t=>t instanceof js),Ri(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector.get(ze),this.router.config)}ngOnDestroy(){}processRoutes(t,e){for(const r of e);return Y([]).pipe(K(),G(t=>void 0))}preloadConfig(t,e){return this.preloadingStrategy.preload(e,()=>this.loader.load(t.injector,e).pipe(q(t=>(e._loadedConfig=t,this.processRoutes(t.module,t.routes)))))}}const Mc=new ut("ROUTER_CONFIGURATION"),Ac=new ut("ROUTER_FORROOT_GUARD"),Ec=[Vi,{provide:al,useClass:sl},{provide:fc,useFactory:Ic,deps:[ur,al,yc,Vi,kt,mr,Le,lc,Mc,[uc,new Nt],[ac,new Nt]]},yc,{provide:Fl,useFactory:Rc,deps:[fc]},{provide:mr,useClass:br},Tc,Sc,_c,{provide:Mc,useValue:{enableTracing:!1}}];function Cc(){return new or("Router",fc)}class Pc{constructor(t,e){}static forRoot(t,e){return{ngModule:Pc,providers:[Ec,Lc(t),{provide:Ac,useFactory:Nc,deps:[[fc,new Nt,new It]]},{provide:Mc,useValue:e||{}},{provide:ji,useFactory:Oc,deps:[ki,[new Ot(zi),new Nt],Mc]},{provide:wc,useExisting:e&&e.preloadingStrategy?e.preloadingStrategy:Sc},{provide:or,multi:!0,useFactory:Cc},function(){return[Dc,{provide:_e,multi:!0,useFactory:Fc,deps:[Dc]},{provide:kc,useFactory:Uc,deps:[Dc]},{provide:Pe,multi:!0,useExisting:kc}]}()]}}static forChild(t){return{ngModule:Pc,providers:[Lc(t)]}}}function Oc(t,e,r={}){return r.useHash?new Hi(t,e):new Wi(t,e)}function Nc(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Lc(t){return[{provide:pt,multi:!0,useValue:t},{provide:lc,multi:!0,useValue:t}]}function Ic(t,e,r,n,i,o,a,s,l={},c,u){const h=new fc(null,e,r,n,i,o,a,Qs(s));if(c&&(h.urlHandlingStrategy=c),u&&(h.routeReuseStrategy=u),l.errorHandler&&(h.errorHandler=l.errorHandler),l.enableTracing){const t=ja();h.events.subscribe(e=>{t.logGroup(`Router Event: ${e.constructor.name}`),t.log(e.toString()),t.log(e),t.logGroupEnd()})}return l.onSameUrlNavigation&&(h.onSameUrlNavigation=l.onSameUrlNavigation),l.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=l.paramsInheritanceStrategy),h}function Rc(t){return t.routerState.root}class Dc{constructor(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new P}appInitializer(){return this.injector.get(Bi,Promise.resolve(null)).then(()=>{let t=null;const e=new Promise(e=>t=e),r=this.injector.get(fc),n=this.injector.get(Mc);if(this.isLegacyDisabled(n)||this.isLegacyEnabled(n));else if("disabled"===n.initialNavigation);else{if("enabled"!==n.initialNavigation)throw new Error(`Invalid initialNavigation options: '${n.initialNavigation}'`);r.hooks.afterPreactivation=(()=>this.initNavigation?Ii(null):(this.initNavigation=!0,this.resultOfPreactivationDone))}return e})}bootstrapListener(t){const e=this.injector.get(Mc);t===this.injector.get(ur).components[0]&&(this.isLegacyEnabled(e)||this.isLegacyDisabled(e))}isLegacyEnabled(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation}isLegacyDisabled(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation}}function Fc(t){return t.appInitializer.bind(t)}function Uc(t){return t.bootstrapListener.bind(t)}const kc=new ut("Router Initializer");var Bc=Tn({encapsulation:0,styles:[[".menu[_ngcontent-%COMP%]{height:100%;margin:0 auto;display:flex;justify-content:center;align-items:center;flex-direction:row}.btn-group[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;width:100%}.btn-group[_ngcontent-%COMP%]   #numberOfPlayers[_ngcontent-%COMP%]{width:-webkit-min-content;width:-moz-min-content;width:min-content;text-align:center}.menu-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.menu-list[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;width:350px;height:45px;background-color:#fff;border:2px solid #467daf;color:#467daf;border-radius:3px;font-size:large}.menu-list[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:0}"]],data:{}});function jc(t){return $n(0,[(t()(),zn(0,0,null,null,15,"div",[["class","menu"]],null,null,null,null,null)),(t()(),zn(1,0,null,null,14,"div",[["class","menu-list"]],null,null,null,null,null)),(t()(),zn(2,0,null,null,5,"div",[["class","btn-group"]],null,null,null,null,null)),(t()(),zn(3,0,null,null,1,"label",[["for","numberOfPlayers"]],null,null,null,null,null)),(t()(),Kn(-1,null,["Enter number of players"])),(t()(),zn(5,0,[["numberOfPlayers",1]],null,0,"input",[["id","numberOfPlayers"],["max","4"],["min","2"],["name","numberOfPlayers"],["step","1"],["type","number"],["value","2"]],null,null,null,null,null)),(t()(),zn(6,0,null,null,1,"button",[["class","button-login"]],[[8,"disabled",0]],[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onCreateLobby(Jn(t,5).value)&&n),n},null,null)),(t()(),Kn(-1,null,["Create Lobby"])),(t()(),zn(8,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onPlayClick()&&n),n},null,null)),(t()(),Kn(-1,null,["Quick Start"])),(t()(),zn(10,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onPracticeClick()&&n),n},null,null)),(t()(),Kn(-1,null,["Practice"])),(t()(),zn(12,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onSettingsClick()&&n),n},null,null)),(t()(),Kn(-1,null,["Settings"])),(t()(),zn(14,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onExitClick()&&n),n},null,null)),(t()(),Kn(-1,null,["Exit"]))],null,function(t,e){t(e,6,0,Jn(e,5).value<2)})}var zc=Hn("page-menu",da,function(t){return $n(0,[(t()(),zn(0,0,null,null,1,"page-menu",[],null,null,null,jc,Bc)),Zn(1,49152,null,0,da,[na,ua,la,fc],null,null)],null,null)},{},{},[]);class Vc{constructor(t){this.apiHttpService=t}getAllCars(){return this.apiHttpService.apiGet("car/")}}class Gc{constructor(t){this.carDelegate=t}loadCars(){return this.carDelegate.getAllCars()}}class Hc{constructor(t,e){this.carService=t,this.router=e,this.selectedCar=0,this.carsList=[]}ngOnInit(){this.getCars()}getCars(){this.carService.loadCars().subscribe(t=>{this.carService.cars=t,this.carsList=this.carService.cars},t=>{console.error(t)})}setSelectedCar(t){this.carService.selectedCar=t,this.router.navigate(["/game"])}}var Wc=Tn({encapsulation:0,styles:[["#canvasContainer[_ngcontent-%COMP%]{width:100%;height:100%}.container[_ngcontent-%COMP%]{display:flex;align-items:center}.car-container[_ngcontent-%COMP%]   .car-image[_ngcontent-%COMP%]{margin-left:1em;height:8em;width:auto}.selected-car[_ngcontent-%COMP%]{opacity:.7}span[_ngcontent-%COMP%]{font-size:.8em}.car-info-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}"]],data:{}});function Xc(t){return $n(0,[(t()(),zn(0,0,null,null,3,"div",[["class","image-container"]],null,null,null,null,null)),(t()(),zn(1,0,null,null,2,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.setSelectedCar(t.context.$implicit)&&n),n},null,null)),(t()(),zn(2,0,null,null,0,"img",[["height","99"],["width","150"]],[[8,"src",4]],null,null,null,null)),(t()(),Kn(3,null,[" "," "]))],null,function(t,e){t(e,2,0,""+function(t){return null!=t?t.toString():""}(e.context.$implicit.image)),t(e,3,0,e.context.$implicit.name)})}function Yc(t){return $n(0,[(t()(),zn(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),jn(16777216,null,null,1,null,Xc)),Zn(2,802816,null,0,eo,[Sr,_r,Dr],{ngForOf:[0,"ngForOf"]},null)],function(t,e){t(e,2,0,e.component.carsList)},null)}var qc=Hn("page-car-selection",Hc,function(t){return $n(0,[(t()(),zn(0,0,null,null,1,"page-car-selection",[],null,null,null,Yc,Wc)),Zn(1,114688,null,0,Hc,[Gc,fc],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]),Jc=r("Womt"),Zc=r("rjcF"),Qc=r("OKgQ"),Kc=r("kSzJ");class $c{static isInRange(t,e,r,n=!0){return t>e&&t<r||n&&[e,r].indexOf(t)>-1}static toRange(t,e,r){return Math.min(Math.max(t,e),r)}static toNearestPowerOfTwo(t){return Math.pow(2,Math.round(Math.log2(t)))}}var tu=r("cQc6"),eu=Kc.Point;class ru{static getAngleBetweenPoints(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}static getDistanceBetweenPoints(t,e){return Math.hypot(e.y-t.y,e.x-t.x)}static getMiddlePoint(t,e){return new eu((t.x+e.x)/2,(t.y+e.y)/2)}static isPointInsidePolygon(t,e){return tu([t.x,t.y],e)}}class nu{constructor(t,e){this.r=t,this.theta=e}get cartesianPoint(){return new eu(this.r*Math.cos(this.theta),this.r*Math.sin(this.theta))}static fromCartesian(t,e){const r=t.clone();return e&&(r.x-=e.x,r.y-=e.y),new nu(Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),Math.atan2(r.y,r.x))}}var iu=PIXI.Graphics;class ou extends iu{constructor(t=1,e=.2){super(),this.strokeColor=4357620,this.areaFillColor=4301812,this.areaFillColorAlpha=.3,this._pixelsInUnit=t,this.areaWidth=ou.BASE_TEXTURE_WIDTH,this.areaHeight=ou.BASE_TEXTURE_HEIGHT,this.relativeCarOffset=e,this.carOffset=ou.BASE_TEXTURE_WIDTH*e,this.outerStrokeWeight=Math.round(ou.BASE_OUTER_STROKE_WEIGHT),this.innerStrokeWeight=Math.round(ou.BASE_INNER_STROKE_WEIGHT)}get pixelsInUnit(){return this._pixelsInUnit}set pixelsInUnit(t){this._pixelsInUnit!==t&&(this._pixelsInUnit=t,this.visible&&this.redraw())}redraw(){}}ou.BASE_TEXTURE_WIDTH=1024,ou.BASE_TEXTURE_HEIGHT=512,ou.BASE_OUTER_STROKE_WEIGHT=3,ou.BASE_INNER_STROKE_WEIGHT=1;var au=PIXI.Point;class su{constructor(t,e){this.l=t,this.c=e}get arcRadius(){return 1/Math.abs(this.c)}get arcCenter(){return new au(0,this.c>0?this.arcRadius:-this.arcRadius)}get pointerRotation(){return this.l*this.c}get position(){return this.polarPosition.cartesianPoint}get polarPosition(){return new nu(0===this.c?this.l:2/this.c*Math.sin(this.l*this.c/2),this.l*this.c/2)}breakToSegments(t=Math.ceil(2*Math.abs(this.l))){if(0===this.l)return[new au];const e=[],r=this.l/t;for(let n=1;n<=t;n++)e.push(new su(n*r,this.c).position);return e}clone(){return new su(this.l,this.c)}equals(t){return!!t&&t.l===this.l&&t.c===this.c}static fromPolarPosition(t){return(t.theta>Math.PI/2||t.theta<-Math.PI/2)&&(t.theta-=Math.PI*Math.sign(t.theta),t.r=-t.r),new su(t.theta*t.r/Math.sin(t.theta),2*Math.sin(t.theta)/t.r)}static fromCartesianPosition(t){return su.fromPolarPosition(nu.fromCartesian(t))}}var lu=PIXI.Point;class cu extends ou{redraw(){super.redraw(),this.drawInner()}draw(t,e,r,n){this.currentData={minDistance:t,maxDistance:e,momentumDistance:r,maxCurvature:n},this.drawInner()}drawInner(){if(!this.currentData)return;let t=this.currentData.minDistance,e=this.currentData.maxDistance,r=this.currentData.momentumDistance,n=this.currentData.maxCurvature;e*=this.pixelsInUnit,r*=this.pixelsInUnit;const i=new su(t*=this.pixelsInUnit,n/=this.pixelsInUnit).position,o=new su(t,-n).position,a=new su(e,n).position,s=new su(e,-n).position;this.clear(),this.lineStyle(this.outerStrokeWeight,this.strokeColor,1),this.beginFill(this.areaFillColor,this.areaFillColorAlpha),this.moveTo(i.x+this.carOffset,i.y+this.areaHeight/2),i.equals(o)||this.drawCardioid(t,n,-n),this.arc(this.carOffset,-1/n+this.areaHeight/2,1/n,nu.fromCartesian(o,new lu(0,-1/n)).theta,nu.fromCartesian(s,new lu(0,-1/n)).theta,!0),this.drawCardioid(e,-n,n),this.arc(this.carOffset,1/n+this.areaHeight/2,1/n,nu.fromCartesian(a,new lu(0,1/n)).theta,nu.fromCartesian(i,new lu(0,1/n)).theta,!0),this.endFill(),this.lineStyle(this.innerStrokeWeight,this.strokeColor,1),this.drawCardioid(r,-n,n,!0)}drawCardioid(t,e,r,n=!1,i=new lu(this.carOffset,this.areaHeight/2)){this.getCardiodPathPoints(t,e,r,16).forEach((t,e)=>{0!==e?this.lineTo(t.x+i.x,t.y+i.y):n&&this.moveTo(t.x+i.x,t.y+i.y)})}getCardiodPathPoints(t,e,r,n=32){const i=[],o=(r-e)/n;for(let a=0;a<=n;a++)i.push(e+a*o);return i.map(e=>new su(t,e).position)}}var uu=PIXI.Point;class hu extends ou{draw(t){this.currentTrajectory=t,this.drawInner()}redraw(){super.redraw(),this.drawInner()}drawInner(){if(!this.currentTrajectory)return;const t=this.currentTrajectory.clone();t.l*=this.pixelsInUnit,t.c/=this.pixelsInUnit;const e=new uu(this.carOffset,this.areaHeight/2),r=new uu(t.position.x+this.carOffset,this.areaHeight/2-t.position.y);if(this.clear(),this.lineStyle(this.outerStrokeWeight,this.strokeColor),Math.abs(t.c)<1e-5)this.moveTo(e.x,e.y),this.lineTo(r.x,r.y);else{const n=new uu(this.carOffset,this.areaHeight/2-t.arcCenter.y);this.arc(n.x,n.y,t.arcRadius,nu.fromCartesian(e,n).theta,nu.fromCartesian(r,n).theta,t.l>0?t.c>0:t.c<0)}}}class du{static getDistanceInUniformlyAcceleratedMotion(t,e,r){return r*(t+e*r/2)}static getAccelerationInUniformlyAcceleratedMotion(t,e,r){return 2/Math.pow(r,2)*(e-t*r)}static getSpeedInUniformlyAcceleratedMotion(t,e,r){return t+e*r}static getSpeedInUniformlyAcceleratedMotionByDistance(t,e,r){return du.getSpeedInUniformlyAcceleratedMotion(t,du.getAccelerationInUniformlyAcceleratedMotion(t,e,r),r)}static getAccelerationToAchieveSpeed(t,e,r){return(e-t)/r}}var pu=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})},fu=Kc.Point;class mu{constructor(t){this.socketService=t,this.mousePosition=new fu,this.currentStepMinDistance=0,this.currentStepMaxDistance=0,this.currentStepMomentumDistance=0,this.currentStepMaxCurvature=0,this.cameraDistance=64,this.cameraDistanceSubject=new P,this.trajectorySelectionSubject=new P,this.trajectorySelected=new P,this.isInSelectionState=!1,this.nextStepArea=new cu(1024/this.controlPlaneLength),this.nextStepArc=new hu(1024/this.controlPlaneLength),this.controlPlaneTextureRenderer=Kc.autoDetectRenderer(this.nextStepArea.areaWidth,this.nextStepArea.areaHeight,{antialias:!0,resolution:1,transparent:!0}),this.controlPlaneTextureStage=new Kc.Container,this.controlPlaneTextureStage.addChild(this.nextStepArea),this.controlPlaneTextureStage.addChild(this.nextStepArc),this.controlPlaneTexture=new Jc.Texture(this.controlPlaneTextureRenderer.view),this.controlPlane=new Jc.Mesh(new Jc.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),new Jc.MeshBasicMaterial({map:this.controlPlaneTexture,side:Jc.DoubleSide,transparent:!0,depthWrite:!1})),this.controlPlane.geometry.applyMatrix((new Jc.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArc.relativeCarOffset),0,0)),this.controlSphere=new Jc.Mesh(new Jc.SphereGeometry(.5),new Jc.MeshBasicMaterial({color:this.nextStepArc.strokeColor,side:Jc.DoubleSide,transparent:!0,opacity:1})),this.controlSphere.visible=!1}get trajectorySelection(){return this._trajectorySelection}set trajectorySelection(t){(this._trajectorySelection||t)&&(this._trajectorySelection&&this._trajectorySelection.equals(t)||(this._trajectorySelection=t,this.trajectorySelectionSubject.next(this._trajectorySelection)))}get controlPlaneWidth(){return.6*this.cameraDistance}get controlPlaneLength(){return 1.2*this.cameraDistance}initControls(t,e){this.canvas=t.controlCanvas,this.stage3d=t,this.car=e,t.addControlElement(this.controlPlane),t.addControlElement(this.controlSphere),this.canvas.addEventListener("mousemove",t=>{this.onCanvasMouseMove(t)}),this.canvas.addEventListener("click",t=>{this.onCanvasMouseClick(t)}),this.updateTrajectorySelector(),this.updateCameraDistance()}adjustControlPositions(){this.car&&this.car.mesh&&this.controlPlane&&(this.controlPlane.position.set(this.car.mesh.position.x,this.car.mesh.position.y,this.car.mesh.position.z),this.controlPlane.rotation.set(this.car.mesh.rotation.x,this.car.mesh.rotation.y,this.car.mesh.rotation.z))}askForSelectedPosition(t,e,r,n){return new Promise(i=>pu(this,void 0,void 0,function*(){this.currentStepMinDistance=t,this.currentStepMaxDistance=e,this.currentStepMomentumDistance=r,this.currentStepMaxCurvature=n,this.isInSelectionState=!0,yield this.stage3d.renderControlsOnceSync(),this.showStepArea(),this.updateTrajectorySelector();const o=this.trajectorySelected.asObservable().subscribe(t=>{clearTimeout(a),o.unsubscribe(),this.isInSelectionState=!1,this.controlSphere.visible=!1,this.hideStepAreaAndCurve(),this.trajectorySelection=null,i(t)}),a=setTimeout(()=>{this.socketService.socketAvailable()?(o.unsubscribe(),this.isInSelectionState=!1,this.controlSphere.visible=!1,this.hideStepAreaAndCurve(),this.trajectorySelection=null,i(new su(Math.max(t,0),0))):clearInterval(a)},Pi.MOVE_TIMEOUT)}))}updateCameraDistance(){let t=Math.max(du.getDistanceInUniformlyAcceleratedMotion(0,this.car.characteristics.getMaxAcceleration(0),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/720),du.getDistanceInUniformlyAcceleratedMotion(Math.max(this.car.speed,0),this.car.characteristics.getMaxAcceleration(Math.max(this.car.speed,0)),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/360));t!==this.cameraDistance&&(this.cameraDistance=t,this.controlPlane.geometry=new Jc.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),this.controlPlane.geometry.applyMatrix((new Jc.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArc.relativeCarOffset),0,0)),this.nextStepArea.pixelsInUnit=1024/this.controlPlaneLength,this.nextStepArc.pixelsInUnit=1024/this.controlPlaneLength,(this.nextStepArc.visible||this.nextStepArea.visible)&&this.updateControlPlaneTexture(),this.cameraDistanceSubject.next(this.cameraDistance))}onCanvasMouseMove(t){const e=this.canvas.getBoundingClientRect();this.mousePosition=new fu(t.x-e.left,t.y-e.top),this.isInSelectionState&&this.updateTrajectorySelector()}onCanvasMouseClick(t){const e=this.canvas.getBoundingClientRect();if(this.mousePosition=new fu(t.x-e.left,t.y-e.top),this.isInSelectionState){const t=this.updateTrajectorySelector();t&&this.trajectorySelected.next(t)}}updateTrajectorySelector(){const t=this.canvas.getBoundingClientRect(),e=new Jc.Raycaster;e.setFromCamera({x:this.mousePosition.x/t.width*2-1,y:-this.mousePosition.y/t.height*2+1},this.stage3d.camera);const r=e.intersectObjects([this.controlPlane]);if(0===r.length)return this.controlSphere.visible=!1,this.hideStepCurve(),void(this.trajectorySelection=null);const n=this.getTrajectoryFromControlPlaneIntersection(r[0]);return $c.isInRange(n.l,this.currentStepMinDistance,this.currentStepMaxDistance)&&$c.isInRange(n.c,-this.currentStepMaxCurvature,this.currentStepMaxCurvature)?(this.controlSphere.visible=!0,this.controlSphere.position.set(r[0].point.x,r[0].point.y,r[0].point.z),this.showStepCurve(n),this.trajectorySelection=n,n):(this.controlSphere.visible=!1,this.hideStepCurve(),this.trajectorySelection=null,null)}getTrajectoryFromControlPlaneIntersection(t){return su.fromCartesianPosition(this.uvToLocalWorld(t.uv))}showStepArea(){this.nextStepArea.visible=!0,this.nextStepArea.draw(this.currentStepMinDistance,this.currentStepMaxDistance,this.currentStepMomentumDistance,this.currentStepMaxCurvature),this.updateControlPlaneTexture()}showStepCurve(t){this.nextStepArc.draw(t),this.nextStepArc.visible=!0,this.updateControlPlaneTexture()}hideStepAreaAndCurve(){(this.nextStepArea.visible||this.nextStepArc.visible)&&(this.nextStepArea.visible&&(this.nextStepArea.visible=!1),this.nextStepArc.visible&&(this.nextStepArc.visible=!1),this.updateControlPlaneTexture())}hideStepCurve(){this.nextStepArc.visible&&(this.nextStepArc.visible=!1,this.updateControlPlaneTexture())}updateControlPlaneTexture(){this.controlPlaneTextureRenderer.render(this.controlPlaneTextureStage),this.controlPlaneTexture.needsUpdate=!0,this.stage3d.renderControlsOnce()}uvToLocalWorld(t){return new fu((t.x-this.nextStepArc.relativeCarOffset)*this.controlPlaneLength,(t.y-.5)*this.controlPlaneWidth)}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){var e=arguments;if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var i=e[n];if(void 0!==i&&null!==i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}return r});var vu={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}(),clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*vu.DEG2RAD},radToDeg:function(t){return t*vu.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function gu(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead.")}function yu(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}function xu(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}function bu(){}function wu(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||wu.DefaultOrder}function _u(){this.mask=1}function Su(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(gu.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,o,a,s,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new gu).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new yu;return function(e){var r=this.elements,n=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),a=1/t.setFromMatrixColumn(e,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*a,r[9]=n[9]*a,r[10]=n[10]*a,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){var h=o*c,d=o*u,p=a*c,f=a*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=d+p*l,e[5]=h-f*l,e[9]=-a*s,e[2]=f-h*l,e[6]=p+d*l,e[10]=o*s}else if("YXZ"===t.order){var m=s*u,v=l*c;e[0]=(g=s*c)+(y=l*u)*a,e[4]=v*a-m,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-a,e[2]=m*a-v,e[6]=y+g*a,e[10]=o*s}else if("ZXY"===t.order){var g,y;m=s*u,v=l*c,e[0]=(g=s*c)-(y=l*u)*a,e[4]=-o*u,e[8]=v+m*a,e[1]=m+v*a,e[5]=o*c,e[9]=y-g*a,e[2]=-o*l,e[6]=a,e[10]=o*s}else if("ZYX"===t.order)h=o*c,d=o*u,p=a*c,f=a*u,e[0]=s*c,e[4]=p*l-d,e[8]=h*l+f,e[1]=s*u,e[5]=f*l+h,e[9]=d*l-p,e[2]=-l,e[6]=a*s,e[10]=o*s;else if("YZX"===t.order){var x=o*s,b=o*l,w=a*s,_=a*l;e[0]=s*c,e[4]=_-x*u,e[8]=w*u+b,e[1]=u,e[5]=o*c,e[9]=-a*c,e[2]=-l*c,e[6]=b*u+w,e[10]=x-_*u}else"XZY"===t.order&&(x=o*s,b=o*l,w=a*s,_=a*l,e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=x*u+_,e[5]=o*c,e[9]=b*u-w,e[2]=w*u-b,e[6]=a*c,e[10]=_*u+x);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,r=t._x,n=t._y,i=t._z,o=t._w,a=r+r,s=n+n,l=i+i,c=r*a,u=r*s,h=r*l,d=n*s,p=n*l,f=i*l,m=o*a,v=o*s,g=o*l;return e[0]=1-(d+f),e[4]=u-g,e[8]=h+v,e[1]=u+g,e[5]=1-(c+f),e[9]=p-m,e[2]=h-v,e[6]=p+m,e[10]=1-(c+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new yu,e=new yu,r=new yu;return function(n,i,o){var a=this.elements;return r.subVectors(n,i),0===r.lengthSq()&&(r.z=1),r.normalize(),t.crossVectors(o,r),0===t.lengthSq()&&(1===Math.abs(o.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),t.crossVectors(o,r)),t.normalize(),e.crossVectors(r,t),a[0]=t.x,a[4]=e.x,a[8]=r.x,a[1]=t.y,a[5]=e.y,a[9]=r.y,a[2]=t.z,a[6]=e.z,a[10]=r.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=n[0],_=n[4],S=n[8],T=n[12],M=n[1],A=n[5],E=n[9],C=n[13],P=n[2],O=n[6],N=n[10],L=n[14],I=n[3],R=n[7],D=n[11],F=n[15];return i[0]=o*w+a*M+s*P+l*I,i[4]=o*_+a*A+s*O+l*R,i[8]=o*S+a*E+s*N+l*D,i[12]=o*T+a*C+s*L+l*F,i[1]=c*w+u*M+h*P+d*I,i[5]=c*_+u*A+h*O+d*R,i[9]=c*S+u*E+h*N+d*D,i[13]=c*T+u*C+h*L+d*F,i[2]=p*w+f*M+m*P+v*I,i[6]=p*_+f*A+m*O+v*R,i[10]=p*S+f*E+m*N+v*D,i[14]=p*T+f*C+m*L+v*F,i[3]=g*w+y*M+x*P+b*I,i[7]=g*_+y*A+x*O+b*R,i[11]=g*S+y*E+x*N+b*D,i[15]=g*T+y*C+x*L+b*F,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new yu;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix4(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*s*u-n*l*u-i*a*h+r*l*h+n*a*d-r*s*d)+t[7]*(+e*s*d-e*l*h+i*o*h-n*o*d+n*l*c-i*s*c)+t[11]*(+e*l*u-e*a*d-i*o*u+r*o*d+i*a*c-r*l*c)+t[15]*(-n*a*c-e*s*u+e*a*h+n*o*u-r*o*h+r*s*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],b=p*y*h-g*f*h+g*u*m-c*y*m-p*u*x+c*f*x,w=v*f*h-d*y*h-v*u*m+l*y*m+d*u*x-l*f*x,_=d*g*h-v*p*h+v*c*m-l*g*m-d*c*x+l*p*x,S=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,T=i*b+o*w+a*_+s*S;if(0===T){var M="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return r[0]=b*A,r[1]=(g*f*s-p*y*s-g*a*m+o*y*m+p*a*x-o*f*x)*A,r[2]=(c*y*s-g*u*s+g*a*h-o*y*h-c*a*x+o*u*x)*A,r[3]=(p*u*s-c*f*s-p*a*h+o*f*h+c*a*m-o*u*m)*A,r[4]=w*A,r[5]=(d*y*s-v*f*s+v*a*m-i*y*m-d*a*x+i*f*x)*A,r[6]=(v*u*s-l*y*s-v*a*h+i*y*h+l*a*x-i*u*x)*A,r[7]=(l*f*s-d*u*s+d*a*h-i*f*h-l*a*m+i*u*m)*A,r[8]=_*A,r[9]=(v*p*s-d*g*s-v*o*m+i*g*m+d*o*x-i*p*x)*A,r[10]=(l*g*s-v*c*s+v*o*h-i*g*h-l*o*x+i*c*x)*A,r[11]=(d*c*s-l*p*s-d*o*h+i*p*h+l*o*m-i*c*m)*A,r[12]=S*A,r[13]=(d*g*a-v*p*a+v*o*f-i*g*f-d*o*y+i*p*y)*A,r[14]=(v*c*a-l*g*a-v*o*u+i*g*u+l*o*y-i*c*y)*A,r[15]=(l*p*a-d*c*a+d*o*u-i*p*u-l*o*f+i*c*f)*A,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,o=t.x,a=t.y,s=t.z,l=i*o,c=i*a;return this.set(l*o+r,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+r,c*s-n*o,0,l*s-n*a,c*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:function(){var t=new yu,e=new gu;return function(r,n,i){var o=this.elements,a=t.set(o[0],o[1],o[2]).length(),s=t.set(o[4],o[5],o[6]).length(),l=t.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),r.x=o[12],r.y=o[13],r.z=o[14],e.copy(this);var c=1/a,u=1/s,h=1/l;return e.elements[0]*=c,e.elements[1]*=c,e.elements[2]*=c,e.elements[4]*=u,e.elements[5]*=u,e.elements[6]*=u,e.elements[8]*=h,e.elements[9]*=h,e.elements[10]*=h,n.setFromRotationMatrix(e),i.x=a,i.y=s,i.z=l,this}}(),makePerspective:function(t,e,r,n,i,o){void 0===o&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(r-n),l=(e+t)/(e-t),c=(r+n)/(r-n),u=-(o+i)/(o-i),h=-2*o*i/(o-i);return a[0]=2*i/(e-t),a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=s,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,r,n,i,o){var a=this.elements,s=1/(e-t),l=1/(r-n),c=1/(o-i),u=(e+t)*s,h=(r+n)*l,d=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}),Object.assign(yu.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new xu;return function(e){return e&&e.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new xu;return function(e,r){return this.applyQuaternion(t.setFromAxisAngle(e,r))}}(),applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,o=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,s=t.w,l=s*e+o*n-a*r,c=s*r+a*e-i*n,u=s*n+i*r-o*e,h=-i*e-o*r-a*n;return this.x=l*s+h*-i+c*-a-u*-o,this.y=c*s+h*-o+u*-i-l*-a,this.z=u*s+h*-a+l*-o-c*-i,this},project:function(){var t=new gu;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new gu;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new yu,e=new yu;return function(r,n){return t.set(r,r,r),e.set(n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new yu;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new yu;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(vu.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(xu,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,o,a){var s=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||s!==h||l!==d||c!==p){var m=1-a,v=s*h+l*d+c*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,a=Math.sin(a*b)/x}var w=a*g;if(s=s*m+h*w,l=l*m+d*w,c=c*m+p*w,u=u*m+f*w,m===1-a){var _=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=_,l*=_,c*=_,u*=_}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u}}),Object.defineProperties(xu.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(xu.prototype,{set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,o=t.order,a=Math.cos,s=Math.sin,l=a(r/2),c=a(n/2),u=a(i/2),h=s(r/2),d=s(n/2),p=s(i/2);return"XYZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===o&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+s+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-l)*e,this._y=(o-c)*e,this._z=(a-i)*e):n>s&&n>h?(e=2*Math.sqrt(1+n-s-h),this._w=(u-l)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+c)/e):s>h?(e=2*Math.sqrt(1+s-n-h),this._w=(o-c)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(l+u)/e):(e=2*Math.sqrt(1+h-n-s),this._w=(a-i)/e,this._x=(o+c)/e,this._y=(l+u)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new yu;return function(r,n){return void 0===e&&(e=new yu),(t=r.dot(n)+1)<1e-6?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,o=t._w,a=e._x,s=e._y,l=e._z,c=e._w;return this._x=r*c+o*a+n*l-i*s,this._y=n*c+o*s+i*a-r*l,this._z=i*c+o*l+r*s-n*a,this._w=o*c-r*a-n*s-i*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*t._w+r*t._x+n*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var l=Math.atan2(s,a),c=Math.sin((1-e)*l)/s,u=Math.sin(e*l)/s;return this._w=o*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(bu.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}}),wu.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],wu.DefaultOrder="XYZ",Object.defineProperties(wu.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(wu.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=vu.clamp,i=t.elements,o=i[0],a=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===e?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new gu;return function(e,r,n){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,r,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new xu;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new yu(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(_u.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(Su.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,o,a,s,l){var c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new yu;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix3(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return i[0]=o*f+a*g+s*b,i[3]=o*m+a*y+s*w,i[6]=o*v+a*x+s*_,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*w,i[7]=l*v+c*x+u*_,i[2]=h*f+d*g+p*b,i[5]=h*m+d*y+p*w,i[8]=h*v+d*x+p*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8];return e*o*c-e*a*l-r*i*c+r*a*s+n*i*l-n*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,n=this.elements,i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,v=i*p+o*f+a*m;if(0===v){var g="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(a*h-d*o)*y,n[2]=(c*o-a*l)*y,n[3]=f*y,n[4]=(d*i-a*u)*y,n[5]=(a*s-c*i)*y,n[6]=m*y,n[7]=(o*u-h*i)*y,n[8]=(l*i-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,o,a){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*o+l*a)+o+t,-n*l,n*s,-n*(-l*o+s*a)+a+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],o=n[3],a=n[6],s=n[1],l=n[4],c=n[7];return n[0]=e*i+r*s,n[3]=e*o+r*l,n[6]=e*a+r*c,n[1]=-r*i+e*s,n[4]=-r*o+e*l,n[7]=-r*a+e*c,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var Tu=0;function Mu(){Object.defineProperty(this,"id",{value:Tu++}),this.uuid=vu.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Mu.DefaultUp.clone();var t=new yu,e=new wu,r=new xu,n=new yu(1,1,1);e.onChange(function(){r.setFromEuler(e,!1)}),r.onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new gu},normalMatrix:{value:new Su}}),this.matrix=new gu,this.matrixWorld=new gu,this.matrixAutoUpdate=Mu.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new _u,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Mu.DefaultUp=new yu(0,1,0),Mu.DefaultMatrixAutoUpdate=!0,Mu.prototype=Object.assign(Object.create(bu.prototype),{constructor:Mu,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new xu;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.multiply(t),this}}(),rotateOnWorldAxis:function(){var t=new xu;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new yu(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new yu(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new yu(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new yu;return function(e,r){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(r)),this}}(),translateX:function(){var t=new yu(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new yu(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new yu(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new gu;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new gu,e=new yu;return function(r,n,i){r.isVector3?e.copy(r):e.set(r,n,i),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){var e=arguments;if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(e[r]);return this}return t===this?(console.error("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("Object3D.add: object not an instance of Object3D.",t),this)},remove:function(t){var e=arguments;if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.remove(e[r]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("Object3D: .getWorldPosition() target is now required"),t=new yu),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new yu,e=new yu;return function(r){return void 0===r&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),r=new xu),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,e),r}}(),getWorldScale:function(){var t=new yu,e=new xu;return function(r){return void 0===r&&(console.warn("Object3D: .getWorldScale() target is now required"),r=new yu),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new xu;return function(e){return void 0===e&&(console.warn("Object3D: .getWorldDirection() target is now required"),e=new yu),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++)i(t.shapes,a[s]);else i(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(i(t.materials,this.material[s]));n.material=c}else n.material=i(t.materials,this.material);if(this.children.length>0)for(n.children=[],s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(t).object);if(e){var u=f(t.geometries),h=f(t.materials),d=f(t.textures),p=f(t.images);a=f(t.shapes),u.length>0&&(r.geometries=u),h.length>0&&(r.materials=h),d.length>0&&(r.textures=d),p.length>0&&(r.images=p),a.length>0&&(r.shapes=a)}return r.object=n,r;function f(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}});var Au={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Eu(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}function Cu(t,e,r,n,i,o){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new yu,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Eu,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}function Pu(t,e){this.min=void 0!==t?t:new yu(1/0,1/0,1/0),this.max=void 0!==e?e:new yu(-1/0,-1/0,-1/0)}function Ou(t,e){this.center=void 0!==t?t:new yu,this.radius=void 0!==e?e:0}function Nu(t,e){this.x=t||0,this.y=e||0}Object.assign(Eu.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(){function t(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}return function(e,r,n){if(e=vu.euclideanModulo(e,1),r=vu.clamp(r,0,1),n=vu.clamp(n,0,1),0===r)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+r):n+r-n*r,o=2*n-i;this.r=t(o,i,e+1/3),this.g=t(o,i,e),this.b=t(o,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[2];switch(r[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(n[1])/360,a=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(o,a,s)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,c=(l=r[1]).length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&t.length>0&&(void 0!==(l=Au[t])?this.setHex(l):console.warn("Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(){var t=this.r,e=this.g,r=this.b;return this.r=t*t,this.g=e*e,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,o=this.b,a=Math.max(n,i,o),s=Math.min(n,i,o),l=(s+a)/2;if(s===a)e=0,r=0;else{var c=a-s;switch(r=l<=.5?c/(a+s):c/(2-a-s),a){case n:e=(i-o)/c+(i<o?6:0);break;case i:e=(o-n)/c+2;break;case o:e=(n-i)/c+4}e/=6}return t.h=e,t.s=r,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var t={};return function(e,r,n){return this.getHSL(t),t.h+=e,t.s+=r,t.l+=n,this.setHSL(t.h,t.s,t.l),this}}(),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),Object.assign(Cu.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}),Object.assign(Pu.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var c=t[s],u=t[s+1],h=t[s+2];c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var c=t.getX(s),u=t.getY(s),h=t.getZ(s);c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new yu;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("Box3: .getCenter() target is now required"),t=new yu),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("Box3: .getSize() target is now required"),t=new yu),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,r,n=new yu;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(e=0,r=a.length;e<r;e++)n.copy(a[e]),n.applyMatrix4(i.matrixWorld),t.expandByPoint(n)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(e=0,r=s.count;e<r;e++)n.fromBufferAttribute(s,e).applyMatrix4(i.matrixWorld),t.expandByPoint(n)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(i),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("Box3: .getParameter() target is now required"),e=new yu),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new yu;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=t.constant&&r>=t.constant},intersectsTriangle:function(){var t=new yu,e=new yu,r=new yu,n=new yu,i=new yu,o=new yu,a=new yu,s=new yu,l=new yu,c=new yu;function u(n){var i,o;for(i=0,o=n.length-3;i<=o;i+=3){a.fromArray(n,i);var s=l.x*Math.abs(a.x)+l.y*Math.abs(a.y)+l.z*Math.abs(a.z),c=t.dot(a),u=e.dot(a),h=r.dot(a);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)return!1}return!0}return function(a){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),t.subVectors(a.a,s),e.subVectors(a.b,s),r.subVectors(a.c,s),n.subVectors(e,t),i.subVectors(r,e),o.subVectors(t,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-o.z,o.y,n.z,0,-n.x,i.z,0,-i.x,o.z,0,-o.x,-n.y,n.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!u(h)&&!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(n,i),u(h=[c.x,c.y,c.z]))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("Box3: .clampPoint() target is now required"),e=new yu),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new yu;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new yu;return function(e){return void 0===e&&(console.warn("Box3: .getBoundingSphere() target is now required"),e=new Ou),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new yu,new yu,new yu,new yu,new yu,new yu,new yu,new yu];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Ou.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new Pu;return function(e,r){var n=this.center;void 0!==r?n.copy(r):t.setFromPoints(e).getCenter(n);for(var i=0,o=0,a=e.length;o<a;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("Sphere: .clampPoint() target is now required"),e=new yu),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("Sphere: .getBoundingBox() target is now required"),t=new Pu),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.defineProperties(Nu.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Nu.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new Nu,e=new Nu;return function(r,n){return t.set(r,r),e.set(n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*r-o*n+t.x,this.y=i*n+o*r+t.y,this}});var Lu=0;function Iu(){Object.defineProperty(this,"id",{value:Lu+=2}),this.uuid=vu.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ru(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function Du(t,e,r){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Fu(t,e,r){Du.call(this,new Int8Array(t),e,r)}function Uu(t,e,r){Du.call(this,new Uint8Array(t),e,r)}function ku(t,e,r){Du.call(this,new Uint8ClampedArray(t),e,r)}function Bu(t,e,r){Du.call(this,new Int16Array(t),e,r)}function ju(t,e,r){Du.call(this,new Uint16Array(t),e,r)}function zu(t,e,r){Du.call(this,new Int32Array(t),e,r)}function Vu(t,e,r){Du.call(this,new Uint32Array(t),e,r)}function Gu(t,e,r){Du.call(this,new Float32Array(t),e,r)}function Hu(t,e,r){Du.call(this,new Float64Array(t),e,r)}function Wu(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Iu.prototype=Object.assign(Object.create(bu.prototype),{constructor:Iu,isGeometry:!0,applyMatrix:function(t){for(var e=(new Su).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(t);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new gu;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new gu;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new gu;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new gu;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new gu;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new Mu;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,n=t.attributes,i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)e.vertices.push(new yu(i[d],i[d+1],i[d+2])),void 0!==o&&c.push(new yu(o[d],o[d+1],o[d+2])),void 0!==a&&e.colors.push(new Eu(a[d],a[d+1],a[d+2])),void 0!==s&&u.push(new Nu(s[p],s[p+1])),void 0!==l&&h.push(new Nu(l[p],l[p+1]));function f(t,r,n,i){var d=new Cu(t,r,n,void 0!==o?[c[t].clone(),c[r].clone(),c[n].clone()]:[],void 0!==a?[e.colors[t].clone(),e.colors[r].clone(),e.colors[n].clone()]:[],i);e.faces.push(d),void 0!==s&&e.faceVertexUvs[0].push([u[t].clone(),u[r].clone(),u[n].clone()]),void 0!==l&&e.faceVertexUvs[1].push([h[t].clone(),h[r].clone(),h[n].clone()])}var m=t.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==r?f(r[p],r[p+1],r[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==r)for(d=0;d<r.length;d+=3)f(r[d],r[d+1],r[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){var t=new yu;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,n=new gu;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new yu,e=new yu,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)a[e]=new yu;if(t){var s,l,c=new yu,u=new yu;for(n=0,i=this.faces.length;n<i;n++)s=this.vertices[(o=this.faces[n]).a],c.subVectors(this.vertices[o.c],l=this.vertices[o.b]),u.subVectors(s,l),c.cross(u),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,r=this.vertices.length;e<r;e++)a[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var h=(o=this.faces[n]).vertexNormals;3===h.length?(h[0].copy(a[o.a]),h[1].copy(a[o.b]),h[2].copy(a[o.c])):(h[0]=a[o.a].clone(),h[1]=a[o.b].clone(),h[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new Iu;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new yu,c={a:new yu,b:new yu,c:new yu},a.push(l),s.push(c)}var l,c,u=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)c=u.vertexNormals[r],(l=u.faceNormals[r]).copy((i=this.faces[r]).normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Pu),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ou),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,l=t.faces,c=this.faceVertexUvs[0],u=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new Su).getNormalMatrix(e));for(var p=0,f=a.length;p<f;p++){var m=a[p].clone();void 0!==e&&m.applyMatrix4(e),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,g,y=l[p],x=y.vertexNormals,b=y.vertexColors;(v=new Cu(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var w=0,_=x.length;w<_;w++)g=x[w].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);for(v.color.copy(y.color),w=0,_=b.length;w<_;w++)v.vertexColors.push(b[w].clone());v.materialIndex=y.materialIndex+r,s.push(v)}for(p=0,f=u.length;p<f;p++){var S=u[p],T=[];if(void 0!==S){for(w=0,_=S.length;w<_;w++)T.push(S[w].clone());c.push(T)}}}else console.error("Geometry.merge(): geometry not an instance of Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("Geometry.mergeMesh(): mesh not an instance of Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],void 0===l[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(l[e]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[e]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new yu(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===e&&(n=[]),a&&a.length===e&&(i=[]),r=0;r<e;r++){var s=t[r]._id;n&&n.push(o[s]),i&&i.push(a[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),a.push(x),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var b=this.faceVertexUvs[0][i];a.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&a.push(T(p.normal)),v){var w=p.vertexNormals;a.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&a.push(M(p.color)),y){var _=p.vertexColors;a.push(M(_[0]),M(_[1]),M(_[2]))}}function S(t,e,r){return r?t|1<<e:t&~(1<<e)}function T(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]?l[e]:(l[e]=s.length/3,s.push(t.x,t.y,t.z),l[e])}function M(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==u[e]?u[e]:(u[e]=c.length,c.push(t.getHex()),u[e])}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=n,t.data.normals=s,c.length>0&&(t.data.colors=c),h.length>0&&(t.data.uvs=[h]),t.data.faces=a,t},clone:function(){return(new Iu).copy(this)},copy:function(t){var e,r,n,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var l=t.colors;for(e=0,r=l.length;e<r;e++)this.colors.push(l[e].clone());var c=t.faces;for(e=0,r=c.length;e<r;e++)this.faces.push(c[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var u=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(o=0,a=h.length;o<a;o++)d.push(h[o].clone());this.faceVertexUvs[e].push(d)}}var p=t.morphTargets;for(e=0,r=p.length;e<r;e++){var f={};if(f.name=p[e].name,void 0!==p[e].vertices)for(f.vertices=[],n=0,i=p[e].vertices.length;n<i;n++)f.vertices.push(p[e].vertices[n].clone());if(void 0!==p[e].normals)for(f.normals=[],n=0,i=p[e].normals.length;n<i;n++)f.normals.push(p[e].normals[n].clone());this.morphTargets.push(f)}var m=t.morphNormals;for(e=0,r=m.length;e<r;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],n=0,i=m[e].vertexNormals.length;n<i;n++){var g=m[e].vertexNormals[n],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],n=0,i=m[e].faceNormals.length;n<i;n++)v.faceNormals.push(m[e].faceNormals[n].clone());this.morphNormals.push(v)}var x=t.skinWeights;for(e=0,r=x.length;e<r;e++)this.skinWeights.push(x[e].clone());var b=t.skinIndices;for(e=0,r=b.length;e<r;e++)this.skinIndices.push(b[e].clone());var w=t.lineDistances;for(e=0,r=w.length;e<r;e++)this.lineDistances.push(w[e]);var _=t.boundingBox;null!==_&&(this.boundingBox=_.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(Ru.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,o=t.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(a+1)/2,v=(u+1)/2,g=(f+1)/2,y=(s+c)/4,x=(l+d)/4,b=(h+p)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=x/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(g)),n=b/i),this.set(r,n,i,e),this}var w=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-d)/w,this.z=(c-s)/w,this.w=Math.acos((a+u+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(r,n){return void 0===t&&(t=new Ru,e=new Ru),t.set(r,r,r,r),e.set(n,n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),Object.defineProperty(Du.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Du.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",n),o=new Eu),e[r++]=o.r,e[r++]=o.g,e[r++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Nu),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new yu),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Ru),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z,e[r++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(Fu.prototype=Object.create(Du.prototype)).constructor=Fu,(Uu.prototype=Object.create(Du.prototype)).constructor=Uu,(ku.prototype=Object.create(Du.prototype)).constructor=ku,(Bu.prototype=Object.create(Du.prototype)).constructor=Bu,(ju.prototype=Object.create(Du.prototype)).constructor=ju,(zu.prototype=Object.create(Du.prototype)).constructor=zu,(Vu.prototype=Object.create(Du.prototype)).constructor=Vu,(Gu.prototype=Object.create(Du.prototype)).constructor=Gu,(Hu.prototype=Object.create(Du.prototype)).constructor=Hu,Object.assign(Wu.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,r.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=t.morphTargets,l=s.length;if(l>0){e=[];for(var c=0;c<l;c++)e[c]=[];this.morphTargets.position=e}var u,h=t.morphNormals,d=h.length;if(d>0){for(u=[],c=0;c<d;c++)u[c]=[];this.morphTargets.normal=u}var p=t.skinIndices,f=t.skinWeights,m=p.length===n.length,v=f.length===n.length;for(c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}!0===o&&(void 0!==(b=i[0][c])?this.uvs.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Nu,new Nu,new Nu))),!0===a&&(void 0!==(b=i[1][c])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Nu,new Nu,new Nu)));for(var S=0;S<l;S++){var T=s[S].vertices;e[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[c];u[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Xu=1;function Yu(){Object.defineProperty(this,"id",{value:Xu+=2}),this.uuid=vu.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function qu(t,e,r,n,i,o,a){Iu.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Ju(t,e,r,n,i,o,a)),this.mergeVertices()}function Ju(t,e,r,n,i,o,a){Yu.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var s,l,c=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),u=0,h=[],d=new yu,p=new yu,f=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],x=l/r;for(s=0;s<=e;s++){var b=s/e;d.x=-t*Math.cos(n+b*i)*Math.sin(o+x*a),d.y=t*Math.cos(o+x*a),d.z=t*Math.sin(n+b*i)*Math.sin(o+x*a),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(b,1-x),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(s=0;s<e;s++){var w=h[l][s],_=h[l+1][s],S=h[l+1][s+1];(0!==l||o>0)&&f.push(h[l][s+1],w,S),(l!==r-1||c<Math.PI)&&f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new Gu(m,3)),this.addAttribute("normal",new Gu(v,3)),this.addAttribute("uv",new Gu(g,2))}Yu.prototype=Object.assign(Object.create(bu.prototype),{constructor:Yu,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){this.index=Array.isArray(t)?new(function(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}(t)>65535?Vu:ju)(t,1):t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new Du(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var r=this.attributes.normal;return void 0!==r&&((new Su).getNormalMatrix(t).applyToBufferAttribute(r),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new gu;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new gu;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new gu;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new gu;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new gu;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new Mu;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new yu;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new Gu(3*e.vertices.length,3),n=new Gu(3*e.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new Gu(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Gu(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Wu).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new Du(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.addAttribute("normal",new Du(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new Du(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new Du(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new Du(o,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var s=[],l=t.morphTargets[a],c=0,u=l.length;c<u;c++){var h=l[c],d=new Gu(3*h.length,3);s.push(d.copyVector3sArray(h))}this.morphAttributes[a]=s}if(t.skinIndices.length>0){var p=new Gu(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new Gu(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Pu);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new Pu,e=new yu;return function(){null===this.boundingSphere&&(this.boundingSphere=new Ou);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;t.setFromBufferAttribute(r),t.getCenter(n);for(var i=0,o=0,a=r.count;o<a;o++)e.x=r.getX(o),e.y=r.getY(o),e.z=r.getZ(o),i=Math.max(i,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,r=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new Du(new Float32Array(n.length),3));else for(var i=e.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;var s,l,c,u=e.normal.array,h=new yu,d=new yu,p=new yu,f=new yu,m=new yu;if(t){var v=t.array;0===r.length&&this.addGroup(0,v.length);for(var g=0,y=r.length;g<y;++g){var x=r[g],b=x.start;for(o=b,a=b+x.count;o<a;o+=3)l=3*v[o+1],c=3*v[o+2],h.fromArray(n,s=3*v[o+0]),d.fromArray(n,l),p.fromArray(n,c),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z}}else for(o=0,a=n.length;o<a;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==t.attributes[n])for(var i=r[n].array,o=t.attributes[n],a=o.array,s=0,l=o.itemSize*e;s<a.length;s++,l++)i[l]=a[s];return this}console.error("BufferGeometry.merge(): geometry not an instance of BufferGeometry.",t)},normalizeNormals:function(){var t=new yu;return function(){for(var e=this.attributes.normal,r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.normalize(),e.setXYZ(r,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Yu,e=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],o=i.array,a=i.itemSize,s=new o.constructor(e.length*a),l=0,c=0,u=0,h=e.length;u<h;u++){l=e[u]*a;for(var d=0;d<a;d++)s[c++]=o[l++]}t.addAttribute(n,new Du(s,a))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var a=o[r];i=Array.prototype.slice.call(a.array),t.data.attributes[r]={itemSize:a.itemSize,type:a.array.constructor.name,array:i,normalized:a.normalized}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),t},clone:function(){return(new Yu).copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o)this.addAttribute(e,o[e].clone());var a=t.morphAttributes;for(e in a){var s=[],l=a[e];for(r=0,n=l.length;r<n;r++)s.push(l[r].clone());this.morphAttributes[e]=s}var c=t.groups;for(r=0,n=c.length;r<n;r++){var u=c[r];this.addGroup(u.start,u.count,u.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(qu.prototype=Object.create(Iu.prototype)).constructor=qu,(Ju.prototype=Object.create(Yu.prototype)).constructor=Ju;var Zu=0,Qu=1,Ku=2,$u=0,th=1,eh=2,rh=1,nh=100,ih=204,oh=205,ah=3,sh=0,lh=301,ch=303,uh=305,hh=1e3,dh=1001,ph=1002,fh=1003,mh=1006,vh=1008,gh=1009,yh=1012,xh=1020,bh=1022,wh=1023,_h=wh,Sh=1026,Th=1027,Mh=2201,Ah=2300,Eh=2400,Ch=0,Ph=1,Oh=2,Nh=3e3,Lh=3200,Ih=0;function Rh(){Object.defineProperty(this,"id",{value:Ih++}),this.uuid=vu.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=rh,this.side=Zu,this.flatShading=!1,this.vertexColors=$u,this.opacity=1,this.transparent=!1,this.blendSrc=ih,this.blendDst=oh,this.blendEquation=nh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ah,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Dh(t){Rh.call(this),this.type="MeshBasicMaterial",this.color=new Eu(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=sh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Fh(t){Rh.call(this),this.type="LineBasicMaterial",this.color=new Eu(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function Uh(t,e){this.origin=void 0!==t?t:new yu,this.direction=void 0!==e?e:new yu}function kh(t,e){this.start=void 0!==t?t:new yu,this.end=void 0!==e?e:new yu}function Bh(t,e){this.normal=void 0!==t?t:new yu(1,0,0),this.constant=void 0!==e?e:0}function jh(t,e,r){this.a=void 0!==t?t:new yu,this.b=void 0!==e?e:new yu,this.c=void 0!==r?r:new yu}function zh(t,e){Mu.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Yu,this.material=void 0!==e?e:new Dh({color:16777215*Math.random()}),this.drawMode=Ch,this.updateMorphTargets()}function Vh(t,e,r){1===r&&console.error("Line: parameter LinePieces no longer supported. Created LineSegments instead."),Mu.call(this),this.type="Line",this.geometry=void 0!==t?t:new Yu,this.material=void 0!==e?e:new Fh({color:16777215*Math.random()})}Rh.prototype=Object.assign(Object.create(bu.prototype),{constructor:Rh,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]="overdraw"===e?Number(r):r:console.warn(this.type+": '"+e+"' is not a property of this material.")}else console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==rh&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==Zu&&(r.side=this.side),this.vertexColors!==$u&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var i=n(t.textures),o=n(t.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Dh.prototype=Object.create(Rh.prototype)).constructor=Dh,Dh.prototype.isMeshBasicMaterial=!0,Dh.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},(Fh.prototype=Object.create(Rh.prototype)).constructor=Fh,Fh.prototype.isLineBasicMaterial=!0,Fh.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},Object.assign(Uh.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("Ray: .at() target is now required"),e=new yu),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new yu;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("Ray: .closestPointToPoint() target is now required"),e=new yu),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new yu;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new yu,e=new yu,r=new yu;return function(n,i,o,a){t.copy(n).add(i).multiplyScalar(.5),e.copy(i).sub(n).normalize(),r.copy(this.origin).sub(t);var s,l,c,u,h=.5*n.distanceTo(i),d=-this.direction.dot(e),p=r.dot(this.direction),f=-r.dot(e),m=r.lengthSq(),v=Math.abs(1-d*d);if(v>0)if(l=d*p-f,u=h*v,(s=d*f-p)>=0)if(l>=-u)if(l<=u){var g=1/v;c=(s*=g)*(s+d*(l*=g)+2*p)+l*(d*s+l+2*f)+m}else l=h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l=-h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l<=-u?c=-(s=Math.max(0,-(-d*h+p)))*s+(l=s>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(s=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(s=Math.max(0,-(d*h+p)))*s+(l=s>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=d>0?-h:h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(e).multiplyScalar(l).add(t),c}}(),intersectSphere:function(){var t=new yu;return function(e,r){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),i=t.dot(t)-n*n,o=e.radius*e.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=n-a,l=n+a;return s<0&&l<0?null:this.at(s<0?l:s,r)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),u>=0?(a=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(a=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),r>s||a>n?null:((a>r||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(){var t=new yu;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new yu,e=new yu,r=new yu,n=new yu;return function(i,o,a,s,l){e.subVectors(o,i),r.subVectors(a,i),n.crossVectors(e,r);var c,u=this.direction.dot(n);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}t.subVectors(this.origin,i);var h=c*this.direction.dot(r.crossVectors(t,r));if(h<0)return null;var d=c*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>u)return null;var p=-c*t.dot(n);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(kh.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("Line3: .getCenter() target is now required"),t=new yu),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("Line3: .delta() target is now required"),t=new yu),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("Line3: .at() target is now required"),e=new yu),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new yu,e=new yu;return function(r,n){t.subVectors(r,this.start),e.subVectors(this.end,this.start);var i=e.dot(e),o=e.dot(t)/i;return n&&(o=vu.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("Line3: .closestPointToPoint() target is now required"),r=new yu),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(Bh.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new yu,e=new yu;return function(r,n,i){var o=t.subVectors(i,n).cross(e.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("Plane: .projectPoint() target is now required"),e=new yu),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new yu;return function(e,r){void 0===r&&(console.warn("Plane: .intersectLine() target is now required"),r=new yu);var n=e.delta(t),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:r.copy(n).multiplyScalar(o).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("Plane: .coplanarPoint() target is now required"),t=new yu),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new yu,e=new Su;return function(r,n){var i=n||e.getNormalMatrix(r),o=this.coplanarPoint(t).applyMatrix4(r),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(jh,{getNormal:function(){var t=new yu;return function(e,r,n,i){void 0===i&&(console.warn("Triangle: .getNormal() target is now required"),i=new yu),i.subVectors(n,r),t.subVectors(e,r),i.cross(t);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}}(),getBarycoord:function(){var t=new yu,e=new yu,r=new yu;return function(n,i,o,a,s){t.subVectors(a,i),e.subVectors(o,i),r.subVectors(n,i);var l=t.dot(t),c=t.dot(e),u=t.dot(r),h=e.dot(e),d=e.dot(r),p=l*h-c*c;if(void 0===s&&(console.warn("Triangle: .getBarycoord() target is now required"),s=new yu),0===p)return s.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,v=(l*d-c*u)*f;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var t=new yu;return function(e,r,n,i){return jh.getBarycoord(e,r,n,i,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}()}),Object.assign(jh.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new yu,e=new yu;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("Triangle: .getMidpoint() target is now required"),t=new yu),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return jh.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("Triangle: .getPlane() target is now required"),t=new yu),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return jh.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return jh.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new Bh,e=[new kh,new kh,new kh],r=new yu,n=new yu;return function(i,o){void 0===o&&(console.warn("Triangle: .closestPointToPoint() target is now required"),o=new yu);var a=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(i,r),!0===this.containsPoint(r))o.copy(r);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var s=0;s<e.length;s++){e[s].closestPointToPoint(r,!0,n);var l=r.distanceToSquared(n);l<a&&(a=l,o.copy(n))}}return o}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),zh.prototype=Object.assign(Object.create(Mu.prototype),{constructor:zh,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return Mu.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)r=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}},raycast:function(){var t=new gu,e=new Uh,r=new Ou,n=new yu,i=new yu,o=new yu,a=new yu,s=new yu,l=new yu,c=new Nu,u=new Nu,h=new Nu,d=new yu,p=new yu,f=new yu;function m(t,e,r,n,i,o,a){return jh.getBarycoord(t,e,r,n,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),a.multiplyScalar(d.z),i.add(o).add(a),i.clone()}function v(t,e,r,n,i,o,a,s){if(null===(e.side===Qu?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,e.side!==Ku,s)))return null;f.copy(s),f.applyMatrix4(t.matrixWorld);var l=r.ray.origin.distanceTo(f);return l<r.near||l>r.far?null:{distance:l,point:f.clone(),object:t}}function g(t,e,r,a,s,l,d,f){n.fromBufferAttribute(a,l),i.fromBufferAttribute(a,d),o.fromBufferAttribute(a,f);var g=v(t,t.material,e,r,n,i,o,p);if(g){s&&(c.fromBufferAttribute(s,l),u.fromBufferAttribute(s,d),h.fromBufferAttribute(s,f),g.uv=m(p,n,i,o,c,u,h));var y=new Cu(l,d,f);jh.getNormal(n,i,o,y.normal),g.face=y,g.faceIndex=l}return g}return function(d,f){var y,x=this.geometry,b=this.material,w=this.matrixWorld;if(void 0!==b&&(null===x.boundingSphere&&x.computeBoundingSphere(),r.copy(x.boundingSphere),r.applyMatrix4(w),!1!==d.ray.intersectsSphere(r)&&(t.getInverse(w),e.copy(d.ray).applyMatrix4(t),null===x.boundingBox||!1!==e.intersectsBox(x.boundingBox))))if(x.isBufferGeometry){var _,S,T,M,A,E=x.index,C=x.attributes.position,P=x.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(y=g(this,d,e,C,P,_,S,T))&&(y.faceIndex=Math.floor(M/3),f.push(y));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(y=g(this,d,e,C,P,_=M,S=M+1,T=M+2))&&(y.index=_,f.push(y))}else if(x.isGeometry){var O,N,L,I,R=Array.isArray(b),D=x.vertices,F=x.faces,U=x.faceVertexUvs[0];U.length>0&&(I=U);for(var k=0,B=F.length;k<B;k++){var j=F[k],z=R?b[j.materialIndex]:b;if(void 0!==z){if(O=D[j.a],N=D[j.b],L=D[j.c],!0===z.morphTargets){var V=x.morphTargets,G=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var Y=V[H].vertices;n.addScaledVector(a.subVectors(Y[j.a],O),X),i.addScaledVector(s.subVectors(Y[j.b],N),X),o.addScaledVector(l.subVectors(Y[j.c],L),X)}}n.add(O),i.add(N),o.add(L),O=n,N=i,L=o}if(y=v(this,z,d,e,O,N,L,p)){if(I&&I[k]){var q=I[k];c.copy(q[0]),u.copy(q[1]),h.copy(q[2]),y.uv=m(p,O,N,L,c,u,h)}y.face=j,y.faceIndex=k,f.push(y)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Vh.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Vh,isLine:!0,computeLineDistances:function(){var t=new yu,e=new yu;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[0],o=1,a=n.count;o<a;o++)t.fromBufferAttribute(n,o-1),e.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=t.distanceTo(e);r.addAttribute("lineDistance",new Gu(i,1))}else console.error("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for((i=r.lineDistances)[0]=0,o=1,a=s.length;o<a;o++)i[o]=i[o-1],i[o]+=s[o-1].distanceTo(s[o])}return this}}(),raycast:function(){var t=new gu,e=new Uh,r=new Ou;return function(n,i){var o=n.linePrecision,a=o*o,s=this.geometry,l=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)){t.getInverse(l),e.copy(n.ray).applyMatrix4(t);var c=new yu,u=new yu,h=new yu,d=new yu,p=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var f=s.index,m=s.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=p){var x=v[g+1];c.fromArray(m,3*v[g]),u.fromArray(m,3*x),e.distanceSqToSegment(c,u,d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,y=m.length/3-1;g<y;g+=p)c.fromArray(m,3*g),u.fromArray(m,3*g+3),e.distanceSqToSegment(c,u,d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(s.isGeometry){var b=s.vertices,w=b.length;for(g=0;g<w-1;g+=p){var _;e.distanceSqToSegment(b[g],b[g+1],d,h)>a||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Gh=function(t){this.mesh=t,this._valid()};Gh.prototype={constructor:Gh,_valid:function(){for(var t=this.mesh.geometry.iks,e=this.mesh.skeleton.bones,r=0,n=t.length;r<n;r++){var i,o,a=t[r],s=a.links;i=e[a.effector];for(var l=0,c=s.length;l<c;l++)i.parent!==(o=e[s[l].index])&&console.warn("CCDIKSolver: bone "+i.name+" is not the child of bone "+o.name),i=o}},_saveOriginalBonesInfo:function(){for(var t=this.mesh.skeleton.bones,e=0,r=t.length;e<r;e++){var n=t[e];void 0===n.userData.ik&&(n.userData.ik={}),n.userData.ik.originalMatrix=n.matrix.toArray()}},update:function(t){var e=new xu,r=new yu,n=new yu,i=new yu,o=new yu,a=new yu,s=new xu,l=new yu,c=new yu,u=this.mesh.skeleton.bones,h=this.mesh.geometry.iks,d=Math;this.mesh.updateMatrixWorld(!0),!0===t&&this._saveOriginalBonesInfo();for(var p=0,f=h.length;p<f;p++){var m=h[p],v=u[m.effector];r.setFromMatrixPosition(u[m.target].matrixWorld);for(var g=m.links,y=void 0!==m.iteration?m.iteration:1,x=0;x<y;x++){for(var b=!1,w=0,_=g.length;w<_;w++){var S=u[g[w].index];if(!1===g[w].enabled)break;var T=g[w].limitation;S.matrixWorld.decompose(a,s,l),s.inverse(),i.setFromMatrixPosition(v.matrixWorld),o.subVectors(i,a),o.applyQuaternion(s),o.normalize(),n.subVectors(r,a),n.applyQuaternion(s),n.normalize();var M=n.dot(o);if(M>1?M=1:M<-1&&(M=-1),!((M=d.acos(M))<1e-5)){if(void 0!==m.minAngle&&M<m.minAngle&&(M=m.minAngle),void 0!==m.maxAngle&&M>m.maxAngle&&(M=m.maxAngle),c.crossVectors(o,n),c.normalize(),e.setFromAxisAngle(c,M),S.quaternion.multiply(e),void 0!==T){var A=S.quaternion.w;A>1&&(A=1);var E=d.sqrt(1-A*A);S.quaternion.set(T.x*E,T.y*E,T.z*E,A)}S.updateMatrixWorld(!0),b=!0}}if(!b)break}}this.mesh.updateMatrixWorld(!0)}};var Hh=function(t){if(void 0===t.geometry.iks||void 0===t.skeleton)throw"CCDIKHelper requires iks in mesh.geometry and skeleton in mesh.";Mu.call(this),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.sphereGeometry=new Ju(.25,16,8),this.targetSphereMaterial=new Dh({color:new Eu(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new Dh({color:new Eu(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new Dh({color:new Eu(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new Fh({color:new Eu(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init(),this.update()};function Wh(){Mu.call(this),this.type="Bone"}function Xh(t,e,r,n,i,o){Iu.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Yh(t,e,r,n,i,o)),this.mergeVertices()}function Yh(t,e,r,n,i,o){Yu.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var a=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var s=[],l=[],c=[],u=[],h=0,d=0;function p(t,e,r,n,i,o,p,f,m,v,g){var y,x,b=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new yu;for(x=0;x<A;x++){var O=x*w-S;for(y=0;y<M;y++)P[t]=(y*b-_)*n,P[e]=O*i,P[r]=T,l.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[r]=f>0?1:-1,c.push(P.x,P.y,P.z),u.push(y/m),u.push(1-x/v),E+=1}for(x=0;x<v;x++)for(y=0;y<m;y++){var N=h+y+M*(x+1),L=h+(y+1)+M*(x+1),I=h+(y+1)+M*x;s.push(h+y+M*x,N,I),s.push(N,L,I),C+=6}a.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,r,e,t,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,r,e,-t,o,i,1),p("x","z","y",1,1,t,r,e,n,o,2),p("x","z","y",1,-1,t,r,-e,n,o,3),p("x","y","z",1,-1,t,e,r,n,i,4),p("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(s),this.addAttribute("position",new Gu(l,3)),this.addAttribute("normal",new Gu(c,3)),this.addAttribute("uv",new Gu(u,2))}function qh(t,e,r,n,i,o,a,s){Iu.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Jh(t,e,r,n,i,o,a,s)),this.mergeVertices()}function Jh(t,e,r,n,i,o,a,s){Yu.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var c=[],u=[],h=[],d=[],p=0,f=[],m=r/2,v=0;function g(r){var i,o,f,g=new Nu,y=new yu,x=0,b=!0===r?t:e,w=!0===r?1:-1;for(o=p,i=1;i<=n;i++)u.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=n;i++){var _=i/n*s+a,S=Math.cos(_),T=Math.sin(_);y.x=b*T,y.y=m*w,y.z=b*S,u.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<n;i++){var M=o+i,A=f+i;!0===r?c.push(A,A+1,M):c.push(A+1,A,M),x+=3}l.addGroup(v,x,!0===r?1:2),v+=x}!function(){var o,g,y=new yu,x=new yu,b=0,w=(e-t)/r;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(e-t)+t;for(o=0;o<=n;o++){var M=o/n,A=M*s+a,E=Math.sin(A),C=Math.cos(A);x.x=T*E,x.y=-S*r+m,x.z=T*C,u.push(x.x,x.y,x.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<n;o++)for(g=0;g<i;g++){var P=f[g+1][o],O=f[g+1][o+1],N=f[g][o+1];c.push(f[g][o],P,N),c.push(P,O,N),b+=6}l.addGroup(v,b,0),v+=b}(),!1===o&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(c),this.addAttribute("position",new Gu(u,3)),this.addAttribute("normal",new Gu(h,3)),this.addAttribute("uv",new Gu(d,2))}(Hh.prototype=Object.create(Mu.prototype)).constructor=Hh,Hh.prototype._init=function(){var t=this,e=this.root.geometry.iks;function r(e){return new Vh(function(t){var e=new Yu,r=new Float32Array(3*(2+t.links.length));return e.addAttribute("position",new Du(r,3)),e}(e),t.lineMaterial)}for(var n=0,i=e.length;n<i;n++){var o=e[n];this.add(new zh(t.sphereGeometry,t.targetSphereMaterial)),this.add(new zh(t.sphereGeometry,t.effectorSphereMaterial));for(var a=0,s=o.links.length;a<s;a++)this.add(new zh(t.sphereGeometry,t.linkSphereMaterial));this.add(r(o))}},Hh.prototype.update=function(){var t=0,e=this.root,r=e.geometry.iks,n=e.skeleton.bones,i=(new gu).getInverse(e.matrixWorld),o=new yu;function a(t){return o.setFromMatrixPosition(t.matrixWorld),o.applyMatrix4(i),o}function s(t,e,r){var n=a(r);t[3*e+0]=n.x,t[3*e+1]=n.y,t[3*e+2]=n.z}for(var l=0,c=r.length;l<c;l++){var u=r[l],h=n[u.target],d=n[u.effector],p=this.children[t++],f=this.children[t++];p.position.copy(a(h)),f.position.copy(a(d));for(var m=0,v=u.links.length;m<v;m++)this.children[t++].position.copy(a(n[u.links[m].index]));var g=this.children[t++],y=g.geometry.attributes.position.array;for(s(y,0,h),s(y,1,d),m=0,v=u.links.length;m<v;m++)s(y,m+2,n[u.links[m].index]);g.geometry.attributes.position.needsUpdate=!0}},Wh.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Wh,isBone:!0}),(Xh.prototype=Object.create(Iu.prototype)).constructor=Xh,(Yh.prototype=Object.create(Yu.prototype)).constructor=Yh,(qh.prototype=Object.create(Iu.prototype)).constructor=qh,(Jh.prototype=Object.create(Yu.prototype)).constructor=Jh;var Zh=function(t,e){void 0===e&&(e={}),this.mesh=t,this.helper=new Zh.ResourceHelper,this.unitStep=void 0!==e.unitStep?e.unitStep:1/65,this.maxStepNum=void 0!==e.maxStepNum?e.maxStepNum:3,this.world=void 0!==e.world?e.world:null,this.bodies=[],this.constraints=[],this.init(t)};Zh.prototype={constructor:Zh,init:function(t){var e=t.parent;null!==e&&e.remove(t);var r=this.helper,n=r.allocThreeVector3(),i=r.allocThreeEuler(),o=r.allocThreeVector3();n.copy(t.position),i.copy(t.rotation),o.copy(t.scale),t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrixWorld(!0),null===this.world&&this.initWorld(),this.initRigidBodies(),this.initConstraints(),null!==e&&e.add(t),t.position.copy(n),t.rotation.copy(i),t.scale.copy(o),t.updateMatrixWorld(!0),this.reset(),r.freeThreeVector3(n),r.freeThreeEuler(i),r.freeThreeVector3(o)},initWorld:function(){var t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver,i=new Ammo.btDiscreteDynamicsWorld(e,r,n,t);i.setGravity(new Ammo.btVector3(0,-98,0)),this.world=i},initRigidBodies:function(){for(var t=this.mesh.geometry.rigidBodies,e=0;e<t.length;e++){var r=new Zh.RigidBody(this.mesh,this.world,t[e],this.helper);this.bodies.push(r)}},initConstraints:function(){for(var t=this.mesh.geometry.constraints,e=0;e<t.length;e++){var r=t[e],n=new Zh.Constraint(this.mesh,this.world,this.bodies[r.rigidBodyIndex1],this.bodies[r.rigidBodyIndex2],r,this.helper);this.constraints.push(n)}},update:function(t){this.updateRigidBodies(),this.stepSimulation(t),this.updateBones()},stepSimulation:function(t){var e=this.unitStep,r=t,n=1+(t/e|0);r<e&&(r=e,n=1),n>this.maxStepNum&&(n=this.maxStepNum),this.world.stepSimulation(r,n,e)},updateRigidBodies:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].updateFromBone()},updateBones:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].updateBone()},reset:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].reset()},warmup:function(t){for(var e=0;e<t;e++)this.update(1/60)}},Zh.ResourceHelper=function(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]},Zh.ResourceHelper.prototype={allocThreeVector3:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new yu},freeThreeVector3:function(t){this.threeVector3s.push(t)},allocThreeMatrix4:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new gu},freeThreeMatrix4:function(t){this.threeMatrix4s.push(t)},allocThreeQuaternion:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new xu},freeThreeQuaternion:function(t){this.threeQuaternions.push(t)},allocThreeEuler:function(){return this.threeEulers.length>0?this.threeEulers.pop():new wu},freeThreeEuler:function(t){this.threeEulers.push(t)},allocTransform:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform},freeTransform:function(t){this.transforms.push(t)},allocQuaternion:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(t){this.quaternions.push(t)},allocVector3:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(t){this.vector3s.push(t)},setIdentity:function(t){t.setIdentity()},getBasis:function(t){var e=this.allocQuaternion();return t.getBasis().getRotation(e),e},getBasisAsMatrix3:function(t){var e=this.getBasis(t),r=this.quaternionToMatrix3(e);return this.freeQuaternion(e),r},getOrigin:function(t){return t.getOrigin()},setOrigin:function(t,e){t.getOrigin().setValue(e.x(),e.y(),e.z())},copyOrigin:function(t,e){var r=e.getOrigin();this.setOrigin(t,r)},setBasis:function(t,e){t.setRotation(e)},setBasisFromMatrix3:function(t,e){var r=this.matrix3ToQuaternion(e);this.setBasis(t,r),this.freeQuaternion(r)},setOriginFromArray3:function(t,e){t.getOrigin().setValue(e[0],e[1],e[2])},setOriginFromThreeVector3:function(t,e){t.getOrigin().setValue(e.x,e.y,e.z)},setBasisFromArray3:function(t,e){var r=this.allocThreeQuaternion(),n=this.allocThreeEuler();n.set(e[0],e[1],e[2]),this.setBasisFromThreeQuaternion(t,r.setFromEuler(n)),this.freeThreeEuler(n),this.freeThreeQuaternion(r)},setBasisFromThreeQuaternion:function(t,e){var r=this.allocQuaternion();r.setX(e.x),r.setY(e.y),r.setZ(e.z),r.setW(e.w),this.setBasis(t,r),this.freeQuaternion(r)},multiplyTransforms:function(t,e){var r=this.allocTransform();this.setIdentity(r);var n=this.getBasisAsMatrix3(t),i=this.getBasisAsMatrix3(e),o=this.getOrigin(t),a=this.getOrigin(e),s=this.multiplyMatrix3ByVector3(n,a),l=this.addVector3(s,o);this.setOrigin(r,l);var c=this.multiplyMatrices3(n,i);return this.setBasisFromMatrix3(r,c),this.freeVector3(s),this.freeVector3(l),r},inverseTransform:function(t){var e=this.allocTransform(),r=this.getBasisAsMatrix3(t),n=this.getOrigin(t),i=this.transposeMatrix3(r),o=this.negativeVector3(n),a=this.multiplyMatrix3ByVector3(i,o);return this.setOrigin(e,a),this.setBasisFromMatrix3(e,i),this.freeVector3(o),this.freeVector3(a),e},multiplyMatrices3:function(t,e){var r=[],n=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),a=this.columnOfMatrix3(e,0),s=this.columnOfMatrix3(e,1),l=this.columnOfMatrix3(e,2);return r[0]=this.dotVectors3(n,a),r[1]=this.dotVectors3(n,s),r[2]=this.dotVectors3(n,l),r[3]=this.dotVectors3(i,a),r[4]=this.dotVectors3(i,s),r[5]=this.dotVectors3(i,l),r[6]=this.dotVectors3(o,a),r[7]=this.dotVectors3(o,s),r[8]=this.dotVectors3(o,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),this.freeVector3(a),this.freeVector3(s),this.freeVector3(l),r},addVector3:function(t,e){var r=this.allocVector3();return r.setValue(t.x()+e.x(),t.y()+e.y(),t.z()+e.z()),r},dotVectors3:function(t,e){return t.x()*e.x()+t.y()*e.y()+t.z()*e.z()},rowOfMatrix3:function(t,e){var r=this.allocVector3();return r.setValue(t[3*e+0],t[3*e+1],t[3*e+2]),r},columnOfMatrix3:function(t,e){var r=this.allocVector3();return r.setValue(t[e+0],t[e+3],t[e+6]),r},negativeVector3:function(t){var e=this.allocVector3();return e.setValue(-t.x(),-t.y(),-t.z()),e},multiplyMatrix3ByVector3:function(t,e){var r=this.allocVector3(),n=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),a=this.dotVectors3(n,e),s=this.dotVectors3(i,e),l=this.dotVectors3(o,e);return r.setValue(a,s,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),r},transposeMatrix3:function(t){var e=[];return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},quaternionToMatrix3:function(t){var e=[],r=t.x(),n=t.y(),i=t.z(),o=t.w(),a=r*r,s=n*n,l=i*i,c=r*n,u=n*i,h=i*r,d=r*o,p=n*o,f=i*o;return e[0]=1-2*(s+l),e[1]=2*(c-f),e[2]=2*(h+p),e[3]=2*(c+f),e[4]=1-2*(l+a),e[5]=2*(u-d),e[6]=2*(h-p),e[7]=2*(u+d),e[8]=1-2*(a+s),e},matrix3ToQuaternion:function(t){var e,r,n,i,o,a=t[0]+t[4]+t[8];a>0?(o=.25*(e=2*Math.sqrt(a+1)),r=(t[7]-t[5])/e,n=(t[2]-t[6])/e,i=(t[3]-t[1])/e):t[0]>t[4]&&t[0]>t[8]?(e=2*Math.sqrt(1+t[0]-t[4]-t[8]),o=(t[7]-t[5])/e,r=.25*e,n=(t[1]+t[3])/e,i=(t[2]+t[6])/e):t[4]>t[8]?(e=2*Math.sqrt(1+t[4]-t[0]-t[8]),o=(t[2]-t[6])/e,r=(t[1]+t[3])/e,n=.25*e,i=(t[5]+t[7])/e):(e=2*Math.sqrt(1+t[8]-t[0]-t[4]),o=(t[3]-t[1])/e,r=(t[2]+t[6])/e,n=(t[5]+t[7])/e,i=.25*e);var s=this.allocQuaternion();return s.setX(r),s.setY(n),s.setZ(i),s.setW(o),s}},Zh.RigidBody=function(t,e,r,n){this.mesh=t,this.world=e,this.params=r,this.helper=n,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this.init()},Zh.RigidBody.prototype={constructor:Zh.RigidBody,init:function(){var t=this.helper,e=this.params,r=this.mesh.skeleton.bones,n=-1===e.boneIndex?new Wh:r[e.boneIndex],i=function(t){switch(t.shapeType){case 0:return new Ammo.btSphereShape(t.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(t.width,t.height,t.depth));case 2:return new Ammo.btCapsuleShape(t.width,t.height);default:throw"unknown shape type "+t.shapeType}}(e),o=0===e.type?0:e.weight,a=t.allocVector3();a.setValue(0,0,0),0!==o&&i.calculateLocalInertia(o,a);var s=t.allocTransform();t.setIdentity(s),t.setOriginFromArray3(s,e.position),t.setBasisFromArray3(s,e.rotation);var l=t.allocThreeVector3(),c=t.allocTransform();t.setIdentity(c),t.setOriginFromThreeVector3(c,n.getWorldPosition(l));var u=t.multiplyTransforms(c,s),h=new Ammo.btDefaultMotionState(u),d=new Ammo.btRigidBodyConstructionInfo(o,h,i,a);d.set_m_friction(e.friction),d.set_m_restitution(e.restitution);var p=new Ammo.btRigidBody(d);0===e.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(e.positionDamping,e.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<e.groupIndex,e.groupTarget),this.body=p,this.bone=n,this.boneOffsetForm=s,this.boneOffsetFormInverse=t.inverseTransform(s),t.freeVector3(a),t.freeTransform(u),t.freeTransform(c),t.freeThreeVector3(l)},reset:function(){this.setTransformFromBone()},updateFromBone:function(){-1!==this.params.boneIndex&&0===this.params.type&&this.setTransformFromBone()},updateBone:function(){0!==this.params.type&&-1!==this.params.boneIndex&&(this.updateBoneRotation(),1===this.params.type&&this.updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this.setPositionFromBone())},getBoneTransform:function(){var t=this.helper,e=t.allocThreeVector3(),r=t.allocThreeQuaternion();this.bone.getWorldPosition(e),this.bone.getWorldQuaternion(r);var n=t.allocTransform();t.setOriginFromThreeVector3(n,e),t.setBasisFromThreeQuaternion(n,r);var i=t.multiplyTransforms(n,this.boneOffsetForm);return t.freeTransform(n),t.freeThreeQuaternion(r),t.freeThreeVector3(e),i},getWorldTransformForBone:function(){var t=this.helper,e=t.allocTransform();this.body.getMotionState().getWorldTransform(e);var r=t.multiplyTransforms(e,this.boneOffsetFormInverse);return t.freeTransform(e),r},setTransformFromBone:function(){var t=this.helper,e=this.getBoneTransform();this.body.setCenterOfMassTransform(e),this.body.getMotionState().setWorldTransform(e),t.freeTransform(e)},setPositionFromBone:function(){var t=this.helper,e=this.getBoneTransform(),r=t.allocTransform();this.body.getMotionState().getWorldTransform(r),t.copyOrigin(r,e),this.body.setCenterOfMassTransform(r),this.body.getMotionState().setWorldTransform(r),t.freeTransform(r),t.freeTransform(e)},updateBoneRotation:function(){this.bone.updateMatrixWorld(!0);var t=this.helper,e=this.getWorldTransformForBone(),r=t.getBasis(e),n=t.allocThreeQuaternion(),i=t.allocThreeQuaternion(),o=t.allocThreeQuaternion();n.set(r.x(),r.y(),r.z(),r.w()),i.setFromRotationMatrix(this.bone.matrixWorld),i.conjugate(),i.multiply(n),o.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(i.multiply(o)),t.freeThreeQuaternion(n),t.freeThreeQuaternion(i),t.freeThreeQuaternion(o),t.freeQuaternion(r),t.freeTransform(e)},updateBonePosition:function(){var t=this.helper,e=this.getWorldTransformForBone(),r=t.allocThreeVector3(),n=t.getOrigin(e);r.set(n.x(),n.y(),n.z());var i=this.bone.worldToLocal(r);this.bone.position.add(i),t.freeThreeVector3(r),t.freeTransform(e)}},Zh.Constraint=function(t,e,r,n,i,o){this.mesh=t,this.world=e,this.bodyA=r,this.bodyB=n,this.params=i,this.helper=o,this.constraint=null,this.init()},Zh.Constraint.prototype={constructor:Zh.Constraint,init:function(){var t=this.helper,e=this.params,r=this.bodyA,n=this.bodyB,i=t.allocTransform();t.setIdentity(i),t.setOriginFromArray3(i,e.position),t.setBasisFromArray3(i,e.rotation);var o=t.allocTransform(),a=t.allocTransform();r.body.getMotionState().getWorldTransform(o),n.body.getMotionState().getWorldTransform(a);var s=t.inverseTransform(o),l=t.inverseTransform(a),c=t.multiplyTransforms(s,i),u=t.multiplyTransforms(l,i),h=new Ammo.btGeneric6DofSpringConstraint(r.body,n.body,c,u,!0),d=t.allocVector3(),p=t.allocVector3(),f=t.allocVector3(),m=t.allocVector3();d.setValue(e.translationLimitation1[0],e.translationLimitation1[1],e.translationLimitation1[2]),p.setValue(e.translationLimitation2[0],e.translationLimitation2[1],e.translationLimitation2[2]),f.setValue(e.rotationLimitation1[0],e.rotationLimitation1[1],e.rotationLimitation1[2]),m.setValue(e.rotationLimitation2[0],e.rotationLimitation2[1],e.rotationLimitation2[2]),h.setLinearLowerLimit(d),h.setLinearUpperLimit(p),h.setAngularLowerLimit(f),h.setAngularUpperLimit(m);for(var v=0;v<3;v++)0!==e.springPosition[v]&&(h.enableSpring(v,!0),h.setStiffness(v,e.springPosition[v]));for(v=0;v<3;v++)0!==e.springRotation[v]&&(h.enableSpring(v+3,!0),h.setStiffness(v+3,e.springRotation[v]));if(void 0!==h.setParam)for(v=0;v<6;v++)h.setParam(2,.475,v);this.world.addConstraint(h,!0),this.constraint=h,t.freeTransform(i),t.freeTransform(o),t.freeTransform(a),t.freeTransform(s),t.freeTransform(l),t.freeTransform(c),t.freeTransform(u),t.freeVector3(d),t.freeVector3(p),t.freeVector3(f),t.freeVector3(m)}};var Qh=function(t){if(void 0===t.physics||void 0===t.geometry.rigidBodies)throw"MMDPhysicsHelper requires physics in mesh and rigidBodies in mesh.geometry.";Mu.call(this),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new Dh({color:new Eu(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new Dh({color:new Eu(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new Dh({color:new Eu(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init(),this.update()};function Kh(t,e,r,n){cd.call(this,t,e,r,n)}function $h(t,e,r){cd.call(this,t,e,r)}function td(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function ed(t,e,r,n){td.call(this,t,e,r,n)}function rd(t,e,r,n){cd.call(this,t,e,r,n)}function nd(t,e,r,n){cd.call(this,t,e,r,n)}function id(t,e,r,n){cd.call(this,t,e,r,n)}function od(t,e,r,n){td.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ad(t,e,r,n){td.call(this,t,e,r,n)}function sd(t,e,r,n){td.call(this,t,e,r,n)}(Qh.prototype=Object.create(Mu.prototype)).constructor=Qh,Qh.prototype._init=function(){var t=this.root.geometry.rigidBodies;function e(t){switch(t.shapeType){case 0:return new Ju(t.width,16,8);case 1:return new Yh(2*t.width,2*t.height,2*t.depth,8,8,8);case 2:return new function(t,e,r,n){var i=new Jh(t,t,e,16,8,!0),o=new zh(new Ju(t,16,8,0,2*Math.PI,0,Math.PI/2)),a=new zh(new Ju(t,16,8,0,2*Math.PI,Math.PI/2,Math.PI/2));return o.position.set(0,e/2,0),a.position.set(0,-e/2,0),o.updateMatrix(),a.updateMatrix(),i.merge(o.geometry,o.matrix),i.merge(a.geometry,a.matrix),i}(t.width,t.height,16,8);default:return null}}for(var r=0,n=t.length;r<n;r++){var i=t[r];this.add(new zh(e(i),this.materials[i.type]))}},Qh.prototype.update=function(){var t=(u=this.root).geometry.rigidBodies,e=u.physics.bodies,r=(new gu).getInverse(u.matrixWorld),n=new yu,i=new xu,o=new xu;function a(t){return n.set(t.x(),t.y(),t.z()),n.applyMatrix4(r),n}function s(t){return i.set(t.x(),t.y(),t.z(),t.w()),o.setFromRotationMatrix(r),o.multiply(i),o}for(var l=0,c=t.length;l<c;l++){var u=this.children[l],h=e[l].body.getCenterOfMassTransform();u.position.copy(a(h.getOrigin())),u.quaternion.copy(s(h.getRotation()))}},Kh.prototype=Object.assign(Object.create(cd.prototype),{constructor:Kh,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Ah,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),$h.prototype=Object.assign(Object.create(cd.prototype),{constructor:$h,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Ah,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(td.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var o;r:{n:if(!(t<n)){for(var a=r+2;;){if(void 0===n){if(t<i)break n;return this._cachedIndex=r=e.length,this.afterEnd_(r-1,t,i)}if(r===a)break;if(i=n,t<(n=e[++r]))break e}o=e.length;break r}if(t>=i)break t;var s=e[1];for(t<s&&(r=2,i=s),a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===a)break;if(n=i,t>=(i=e[--r-1]))break e}o=r,r=0}for(;r<o;){var l=r+o>>>1;t<e[l]?o=l:r=l+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return this._cachedIndex=r=e.length,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,o=0;o!==n;++o)e[o]=r[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(td.prototype,{beforeStart_:td.prototype.copySampleValue_,afterEnd_:td.prototype.copySampleValue_}),ed.prototype=Object.assign(Object.create(td.prototype),{constructor:ed,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=(r-e)/(n-e),c=s+a;s!==c;s+=4)xu.slerpFlat(i,0,o,s-a,o,s,l);return i}}),rd.prototype=Object.assign(Object.create(cd.prototype),{constructor:rd,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new ed(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),nd.prototype=Object.assign(Object.create(cd.prototype),{constructor:nd,ValueTypeName:"color"}),id.prototype=Object.assign(Object.create(cd.prototype),{constructor:id,ValueTypeName:"vector"}),od.prototype=Object.assign(Object.create(td.prototype),{constructor:od,DefaultSettings_:{endingStart:Eh,endingEnd:Eh},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,o=t+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=t,a=2*e-r;break;case 2402:a=e+n[i=n.length-2]-n[i+1];break;default:i=t,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*r-e;break;case 2402:o=1,s=r+n[1]-n[0];break;default:o=t-1,s=e}var l=.5*(r-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(s-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-e)/(n-e),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==a;++b)i[b]=v*o[c+b]+g*o[l+b]+y*o[s+b]+x*o[u+b];return i}}),ad.prototype=Object.assign(Object.create(td.prototype),{constructor:ad,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=(r-e)/(n-e),u=1-c,h=0;h!==a;++h)i[h]=o[l+h]*u+o[s+h]*c;return i}}),sd.prototype=Object.assign(Object.create(td.prototype),{constructor:sd,interpolate_:function(t){return this.copySampleValue_(t-1)}});var ld={arraySlice:function(t,e,r){return ld.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort(function(e,r){return t[e]-t[r]}),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*e,l=0;l!==e;++l)i[a++]=t[s+l];return i},flattenJSON:function(t,e,r,n){for(var i=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(e.push(o.time),r.push.apply(r,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(e.push(o.time),a.toArray(r,r.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(e.push(o.time),r.push(a)),o=t[i++]}while(void 0!==o)}}};function cd(t,e,r,n){if(void 0===t)throw new Error("KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ld.convertArray(e,this.TimeBufferType),this.values=ld.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function ud(t,e,r,n){cd.call(this,t,e,r,n)}function hd(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=vu.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}Object.assign(cd,{parse:function(t){if(void 0===t.type)throw new Error("KeyframeTrack: track type undefined, can not parse");var e=cd._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var r=[],n=[];ld.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:ld.convertArray(t.times,Array),values:ld.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ud;case"vector":case"vector2":case"vector3":case"vector4":return id;case"color":return nd;case"quaternion":return rd;case"bool":case"boolean":return $h;case"string":return Kh}throw new Error("KeyframeTrack: Unsupported typeName: "+t)}}),Object.assign(cd.prototype,{constructor:cd,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new sd(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new ad(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new od(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Ah:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("KeyframeTrack:",r)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ah;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<t;)++i;for(;-1!==o&&r[o]>e;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=ld.arraySlice(r,i,o),this.values=ld.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==i;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==n&&ld.isTypedArray(n)){a=0;for(var l=n.length;a!==l;++a){var c=n[a];if(isNaN(c)){console.error("KeyframeTrack: Value is not a valid number.",this,a,c),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=t.length-1,a=1;a<o;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==l[0]))if(n)s=!0;else for(var c=a*r,u=c-r,h=c+r,d=0;d!==r;++d){var p=e[c+d];if(p!==e[u+d]||p!==e[h+d]){s=!0;break}}if(s){if(a!==i){t[i]=t[a];var f=a*r,m=i*r;for(d=0;d!==r;++d)e[m+d]=e[f+d]}++i}}if(o>0){for(t[i]=t[o],f=o*r,m=i*r,d=0;d!==r;++d)e[m+d]=e[f+d];++i}return i!==t.length&&(this.times=ld.arraySlice(t,0,i),this.values=ld.arraySlice(e,0,i*r)),this}}),ud.prototype=Object.assign(Object.create(cd.prototype),{constructor:ud,ValueTypeName:"number"}),Object.assign(hd,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,o=r.length;i!==o;++i)e.push(cd.parse(r[i]).scale(n));return new hd(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e},i=0,o=r.length;i!==o;++i)e.push(cd.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var c=ld.getKeyframeOrder(s);s=ld.sortedArray(s,1,c),l=ld.sortedArray(l,1,c),n||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new ud(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/r))}return new hd(t,-1,o)},findByName:function(t,e){var r=t;Array.isArray(t)||(r=t.geometry&&t.geometry.animations||t.animations);for(var n=0;n<r.length;n++)if(r[n].name===e)return r[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(i);if(l&&l.length>1){var c=n[h=l[1]];c||(n[h]=c=[]),c.push(s)}}var u=[];for(var h in n)u.push(hd.CreateFromMorphTargetSequence(h,n[h],e,r));return u},parseAnimation:function(t,e){if(!t)return console.error("AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var o=[],a=[];ld.flattenJSON(r,o,a,n),0!==o.length&&i.push(new t(e,o,a))}},n=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var v=c[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new ud(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(a||1)}else{var g=".bones["+e[l].name+"]";r(id,g+".position",c,"pos",n),r(rd,g+".quaternion",c,"rot",n),r(id,g+".scale",c,"scl",n)}}return 0===n.length?null:new hd(i,o,n)}}),Object.assign(hd.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}});var dd=function(){};function pd(){Mu.call(this),this.type="Camera",this.matrixWorldInverse=new gu,this.projectionMatrix=new gu}function fd(t,e,r,n){pd.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function md(t){Rh.call(this),this.type="MeshDepthMaterial",this.depthPacking=Lh,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function vd(){Mu.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function gd(t,e,r,n,i,o){pd.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}dd.CreateRotationAnimation=function(t,e){return new hd(null,t,[new ud(".rotation["+(e=e||"x")+"]",[0,t],[0,360])])},dd.CreateScaleAxisAnimation=function(t,e){return new hd(null,t,[new ud(".scale["+(e=e||"x")+"]",[0,t],[0,1])])},dd.CreateShakeAnimation=function(t,e){for(var r=[],n=[],i=new yu,o=0;o<10*t;o++)r.push(o/10),i.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(e).toArray(n,n.length);return new hd(null,t,[new id(".position",r,n)])},dd.CreatePulsationAnimation=function(t,e){for(var r=[],n=[],i=new yu,o=0;o<10*t;o++){r.push(o/10);var a=Math.random()*e;i.set(a,a,a).toArray(n,n.length)}return new hd(null,t,[new id(".scale",r,n)])},dd.CreateVisibilityAnimation=function(t){return new hd(null,t,[new $h(".visible",[0,t/2,t],[!0,!1,!0])])},dd.CreateMaterialColorAnimation=function(t,e){for(var r=[],n=[],i=t/e.length,o=0;o<=e.length;o++)r.push(o*i),n.push(e[o%e.length]);return new hd(null,t,[new nd(".material[0].color",r,n)])},pd.prototype=Object.assign(Object.create(Mu.prototype),{constructor:pd,isCamera:!0,copy:function(t,e){return Mu.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new xu;return function(e){return void 0===e&&(console.warn("Camera: .getWorldDirection() target is now required"),e=new yu),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){Mu.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),fd.prototype=Object.assign(Object.create(pd.prototype),{constructor:fd,isPerspectiveCamera:!0,copy:function(t,e){return pd.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*vu.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*vu.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*vu.RAD2DEG*Math.atan(Math.tan(.5*vu.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*vu.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a,e-=o.offsetY*r/s,n*=o.width/a,r*=o.height/s}var l=this.filmOffset;0!==l&&(i+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far)},toJSON:function(t){var e=Mu.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),(md.prototype=Object.create(Rh.prototype)).constructor=md,md.prototype.isMeshDepthMaterial=!0,md.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},vd.prototype=Object.assign(Object.create(Mu.prototype),{constructor:vd,copy:function(t,e){return Mu.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=Mu.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),gd.prototype=Object.assign(Object.create(pd.prototype),{constructor:gd,isOrthographicCamera:!0,copy:function(t,e){return pd.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,o=r+t,a=n+e,s=n-e;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(a-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far)},toJSON:function(t){var e=Mu.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}});var yd=0;function xd(t,e,r,n,i,o,a,s,l,c){Object.defineProperty(this,"id",{value:yd++}),this.uuid=vu.generateUUID(),this.name="",this.image=void 0!==t?t:xd.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:xd.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:dh,this.wrapT=void 0!==n?n:dh,this.magFilter=void 0!==i?i:mh,this.minFilter=void 0!==o?o:vh,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:wh,this.type=void 0!==s?s:gh,this.offset=new Nu(0,0),this.repeat=new Nu(1,1),this.center=new Nu(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Su,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Nh,this.version=0,this.onUpdate=null}function bd(t,e,r){this.width=t,this.height=e,this.scissor=new Ru(0,0,t,e),this.scissorTest=!1,this.viewport=new Ru(0,0,t,e),void 0===(r=r||{}).minFilter&&(r.minFilter=mh),this.texture=new xd(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}xd.DEFAULT_IMAGE=void 0,xd.DEFAULT_MAPPING=300,xd.prototype=Object.assign(Object.create(bu.prototype),{constructor:xd,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=vu.generateUUID()),e||void 0!==t.images[n.uuid]||(t.images[n.uuid]={uuid:n.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var r=e.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(n)}),r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case hh:t.x=t.x-Math.floor(t.x);break;case dh:t.x=t.x<0?0:1;break;case ph:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case hh:t.y=t.y-Math.floor(t.y);break;case dh:t.y=t.y<0?0:1;break;case ph:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(xd.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),bd.prototype=Object.assign(Object.create(bu.prototype),{constructor:bd,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var wd={merge:function(t){for(var e={},r=0;r<t.length;r++){var n=this.clone(t[r]);for(var i in n)e[i]=n[i]}return e},clone:function(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];e[r][n]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return e}};function _d(t){Rh.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("ShaderMaterial: attributes should now be defined in BufferGeometry instead."),this.setValues(t))}function Sd(t,e,r,n){Iu.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Td(t,e,r,n)),this.mergeVertices()}function Td(t,e,r,n){Yu.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,o,a=(t=t||1)/2,s=(e=e||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=t/l,p=e/c,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-s;for(i=0;i<u;i++)m.push(i*d-a,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/c)}for(o=0;o<c;o++)for(i=0;i<l;i++){var x=i+u*(o+1),b=i+1+u*(o+1),w=i+1+u*o;f.push(i+u*o,x,w),f.push(x,b,w)}this.setIndex(f),this.addAttribute("position",new Gu(m,3)),this.addAttribute("normal",new Gu(v,3)),this.addAttribute("uv",new Gu(g,2))}(_d.prototype=Object.create(Rh.prototype)).constructor=_d,_d.prototype.isShaderMaterial=!0,_d.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=wd.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},_d.prototype.toJSON=function(t){var e=Rh.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},(Sd.prototype=Object.create(Iu.prototype)).constructor=Sd,(Td.prototype=Object.create(Yu.prototype)).constructor=Td;var Md={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","float viewZ = getViewZ( getDepth( vUv ) );","float factor = ( focus + viewZ );","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},Ad=function(t,e,r,n){fd.call(this,t,e,r,n),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4},this.material_depth=new md,this.setLens(),this.initPostProcessing()};(Ad.prototype=Object.create(fd.prototype)).constructor=Ad,Ad.prototype.setLens=function(t,e,r,n){void 0===t&&(t=35),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t),void 0===r&&(r=8),void 0===n&&(n=.019),this.fNumber=r,this.coc=n,this.aperture=t/this.fNumber,this.hyperFocal=t*t/(this.aperture*this.coc)},Ad.prototype.linearize=function(t){var e=this.far,r=this.near;return-e*r/(t*(e-r)-e)},Ad.prototype.smoothstep=function(t,e,r){var n=this.saturate((r-t)/(e-t));return n*n*(3-2*n)},Ad.prototype.saturate=function(t){return Math.max(0,Math.min(1,t))},Ad.prototype.focusAt=function(t){void 0===t&&(t=20);var e=this.getFocalLength();this.focus=t,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-e)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-e)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance},Ad.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new vd,this.postprocessing.camera=new gd(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera);var t={minFilter:mh,magFilter:mh,format:bh};this.postprocessing.rtTextureDepth=new bd(window.innerWidth,window.innerHeight,t),this.postprocessing.rtTextureColor=new bd(window.innerWidth,window.innerHeight,t);var e=Md;this.postprocessing.bokeh_uniforms=wd.clone(e.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new _d({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples}}),this.postprocessing.quad=new zh(new Td(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)}},Ad.prototype.renderCinematic=function(t,e){this.postprocessing.enabled&&(e.clear(),t.overrideMaterial=null,e.render(t,camera,this.postprocessing.rtTextureColor,!0),t.overrideMaterial=this.material_depth,e.render(t,camera,this.postprocessing.rtTextureDepth,!0),e.render(this.postprocessing.scene,this.postprocessing.camera))};var Ed={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Cd(t,e,r){var n=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){a++,!1===i&&void 0!==n.onStart&&n.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this}}var Pd=new Cd,Od={};function Nd(t){this.manager=void 0!==t?t:Pd}function Ld(t){Fh.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Id(t){Rh.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new yu,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Rd(t){Rh.call(this),this.type="MeshLambertMaterial",this.color=new Eu(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Eu(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=sh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Dd(t){Rh.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Nu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Fd(t){Rh.call(this),this.type="MeshPhongMaterial",this.color=new Eu(16777215),this.specular=new Eu(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Eu(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Nu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=sh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ud(t){Rh.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Eu(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Eu(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Nu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function kd(t){Ud.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function Bd(t){Fd.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function jd(t){Rh.call(this),this.type="PointsMaterial",this.color=new Eu(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function zd(t){_d.call(this,t),this.type="RawShaderMaterial"}function Vd(t){Rh.call(this),this.type="ShadowMaterial",this.color=new Eu(0),this.transparent=!0,this.setValues(t)}function Gd(t){Rh.call(this),this.type="SpriteMaterial",this.color=new Eu(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Hd(t){this.manager=void 0!==t?t:Pd,this.textures={}}function Wd(t){this.manager=void 0!==t?t:Pd}function Xd(t){this.manager=void 0!==t?t:Pd}function Yd(){}Object.assign(Nd.prototype,{load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Ed.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===Od[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}window.setTimeout(function(){e&&e(u),i.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},0)}}else{Od[t]=[],Od[t].push({onLoad:e,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",t,!0),m.addEventListener("load",function(e){var r=this.response;Ed.add(t,r);var n=Od[t];if(delete Od[t],200===this.status){for(var o=0,a=n.length;o<a;o++)(s=n[o]).onLoad&&s.onLoad(r);i.manager.itemEnd(t)}else if(0===this.status){for(console.warn("FileLoader: HTTP Status 0 received."),o=0,a=n.length;o<a;o++)(s=n[o]).onLoad&&s.onLoad(r);i.manager.itemEnd(t)}else{for(o=0,a=n.length;o<a;o++){var s;(s=n[o]).onError&&s.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)}},!1),m.addEventListener("progress",function(e){for(var r=Od[t],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(e)}},!1),m.addEventListener("error",function(e){var r=Od[t];delete Od[t];for(var n=0,o=r.length;n<o;n++){var a=r[n];a.onError&&a.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(t),m}Od[t].push({onLoad:e,onProgress:r,onError:n})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),(Ld.prototype=Object.create(Fh.prototype)).constructor=Ld,Ld.prototype.isLineDashedMaterial=!0,Ld.prototype.copy=function(t){return Fh.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this},(Id.prototype=Object.create(Rh.prototype)).constructor=Id,Id.prototype.isMeshDistanceMaterial=!0,Id.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},(Rd.prototype=Object.create(Rh.prototype)).constructor=Rd,Rd.prototype.isMeshLambertMaterial=!0,Rd.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Dd.prototype=Object.create(Rh.prototype)).constructor=Dd,Dd.prototype.isMeshNormalMaterial=!0,Dd.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Fd.prototype=Object.create(Rh.prototype)).constructor=Fd,Fd.prototype.isMeshPhongMaterial=!0,Fd.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Ud.prototype=Object.create(Rh.prototype)).constructor=Ud,Ud.prototype.isMeshStandardMaterial=!0,Ud.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(kd.prototype=Object.create(Ud.prototype)).constructor=kd,kd.prototype.isMeshPhysicalMaterial=!0,kd.prototype.copy=function(t){return Ud.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},(Bd.prototype=Object.create(Fd.prototype)).constructor=Bd,Bd.prototype.isMeshToonMaterial=!0,Bd.prototype.copy=function(t){return Fd.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},(jd.prototype=Object.create(Rh.prototype)).constructor=jd,jd.prototype.isPointsMaterial=!0,jd.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},(zd.prototype=Object.create(_d.prototype)).constructor=zd,zd.prototype.isRawShaderMaterial=!0,(Vd.prototype=Object.create(Rh.prototype)).constructor=Vd,Vd.prototype.isShadowMaterial=!0,Vd.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.color.copy(t.color),this},(Gd.prototype=Object.create(Rh.prototype)).constructor=Gd,Gd.prototype.isSpriteMaterial=!0,Gd.prototype.copy=function(t){return Rh.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},Object.assign(Hd.prototype,{load:function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("MaterialLoader: Undefined texture",t),e[t]}var n=new{LineBasicMaterial:Fh,LineDashedMaterial:Ld,MeshBasicMaterial:Dh,MeshDepthMaterial:md,MeshDistanceMaterial:Id,MeshLambertMaterial:Rd,MeshNormalMaterial:Dd,MeshPhongMaterial:Fd,MeshPhysicalMaterial:kd,MeshStandardMaterial:Ud,MeshToonMaterial:Bd,PointsMaterial:jd,RawShaderMaterial:zd,ShaderMaterial:_d,ShadowMaterial:Vd,SpriteMaterial:Gd}[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new Nu).fromArray(i)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),n}}),Object.assign(Wd.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Ed.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){Ed.add(t,this),e&&e(this),i.manager.itemEnd(t)},!1),a.addEventListener("error",function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Xd.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new xd,o=new Wd(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(r){i.image=r;var n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);i.format=n?bh:wh,i.needsUpdate=!0,void 0!==e&&e(i)},r,n),i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Yd.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,r=0,n=e.length;r<n;r+=2){var i=e[r+1];if(e[r].test(t))return i}return null}},Object.assign(Yd.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,r){for(var n=[],i=0;i<t.length;++i)n[i]=this.createMaterial(t[i],e,r);return n},createMaterial:function(){var t={NoBlending:0,NormalBlending:rh,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},e=new Eu,r=new Xd,n=new Hd;return function(i,o,a){var s={};function l(t,e,n,i,l){var c,u=o+t,h=Yd.Handlers.get(u);null!==h?c=h.load(u):(r.setCrossOrigin(a),c=r.load(u)),void 0!==e&&(c.repeat.fromArray(e),1!==e[0]&&(c.wrapS=hh),1!==e[1]&&(c.wrapT=hh)),void 0!==n&&c.offset.fromArray(n),void 0!==i&&("repeat"===i[0]&&(c.wrapS=hh),"mirror"===i[0]&&(c.wrapS=ph),"repeat"===i[1]&&(c.wrapT=hh),"mirror"===i[1]&&(c.wrapT=ph)),void 0!==l&&(c.anisotropy=l);var d=vu.generateUUID();return s[d]=c,d}var c={uuid:vu.generateUUID(),type:"MeshLambertMaterial"};for(var u in i){var h=i[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=t[h];break;case"colorAmbient":case"mapAmbient":console.warn("Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=e.fromArray(h).getHex();break;case"colorSpecular":c.specular=e.fromArray(h).getHex();break;case"colorEmissive":c.emissive=e.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(h,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(h,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(h,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(h,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(h,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(h,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(h,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(h,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(h,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(h,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=Qu;break;case"doubleSided":c.side=Ku;break;case"transparency":console.warn("Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=eh),"face"===h&&(c.vertexColors=th);break;default:console.error("Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(s),n.parse(c)}}()});var qd={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")}};function Jd(t){"boolean"==typeof t&&(console.warn("JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Pd,this.withCredentials=!1}Object.assign(Jd.prototype,{load:function(t,e,r,n){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:qd.extractUrlBase(t),a=new Nd(this.manager);a.setWithCredentials(this.withCredentials),a.load(t,function(r){var n=JSON.parse(r),a=n.metadata;if(void 0!==a){var s=a.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("JSONLoader: "+t+" should be loaded with ObjectLoader instead.")}var l=i.parse(n,o);e(l.geometry,l.materials)},r,n)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){void 0!==t.data&&(t=t.data),t.scale=void 0!==t.scale?1/t.scale:1;var r=new Iu;return function(t,e){function r(t,e){return t&1<<e}var n,i,o,a,s,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C=t.faces,P=t.vertices,O=t.normals,N=t.colors,L=t.scale,I=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&I++;for(n=0;n<I;n++)e.faceVertexUvs[n]=[]}for(a=0,s=P.length;a<s;)(b=new yu).x=P[a++]*L,b.y=P[a++]*L,b.z=P[a++]*L,e.vertices.push(b);for(a=0,s=C.length;a<s;)if(p=r(d=C[a++],0),f=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),x=r(d,7),p){if((_=new Cu).a=C[a],_.b=C[a+1],_.c=C[a+3],(S=new Cu).a=C[a+1],S.b=C[a+2],S.c=C[a+3],a+=4,f&&(h=C[a++],_.materialIndex=h,S.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],e.faceVertexUvs[n][o+1]=[],i=0;i<4;i++)E=new Nu(A[2*(u=C[a++])],A[2*u+1]),2!==i&&e.faceVertexUvs[n][o].push(E),0!==i&&e.faceVertexUvs[n][o+1].push(E);if(v&&(c=3*C[a++],_.normal.set(O[c++],O[c++],O[c]),S.normal.copy(_.normal)),g)for(n=0;n<4;n++)c=3*C[a++],M=new yu(O[c++],O[c++],O[c]),2!==n&&_.vertexNormals.push(M),0!==n&&S.vertexNormals.push(M);if(y&&(l=C[a++],_.color.setHex(T=N[l]),S.color.setHex(T)),x)for(n=0;n<4;n++)T=N[l=C[a++]],2!==n&&_.vertexColors.push(new Eu(T)),0!==n&&S.vertexColors.push(new Eu(T));e.faces.push(_),e.faces.push(S)}else{if((w=new Cu).a=C[a++],w.b=C[a++],w.c=C[a++],f&&(h=C[a++],w.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],i=0;i<3;i++)E=new Nu(A[2*(u=C[a++])],A[2*u+1]),e.faceVertexUvs[n][o].push(E);if(v&&(c=3*C[a++],w.normal.set(O[c++],O[c++],O[c])),g)for(n=0;n<3;n++)c=3*C[a++],M=new yu(O[c++],O[c++],O[c]),w.vertexNormals.push(M);if(y&&(l=C[a++],w.color.setHex(N[l])),x)for(n=0;n<3;n++)l=C[a++],w.vertexColors.push(new Eu(N[l]));e.faces.push(w)}}(t,r),function(t,e){var r=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,i=t.skinWeights.length;n<i;n+=r)e.skinWeights.push(new Ru(t.skinWeights[n],r>1?t.skinWeights[n+1]:0,r>2?t.skinWeights[n+2]:0,r>3?t.skinWeights[n+3]:0));if(t.skinIndices)for(n=0,i=t.skinIndices.length;n<i;n+=r)e.skinIndices.push(new Ru(t.skinIndices[n],r>1?t.skinIndices[n+1]:0,r>2?t.skinIndices[n+2]:0,r>3?t.skinIndices[n+3]:0));e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,r),function(t,e){var r=t.scale;if(void 0!==t.morphTargets)for(var n=0,i=t.morphTargets.length;n<i;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var o=e.morphTargets[n].vertices,a=t.morphTargets[n].vertices,s=0,l=a.length;s<l;s+=3){var c=new yu;c.x=a[s]*r,c.y=a[s+1]*r,c.z=a[s+2]*r,o.push(c)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=e.faces,h=t.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(t,r),function(t,e){var r=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var i=0;i<n.length;i++){var o=hd.parseAnimation(n[i],e.bones);o&&r.push(o)}if(e.morphTargets){var a=hd.CreateClipsFromMorphTargetSequences(e.morphTargets,10);r=r.concat(a)}r.length>0&&(e.animations=r)}(t,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:r}:{geometry:r,materials:Yd.prototype.initMaterials(t.materials,e,this.crossOrigin)}}});var Zd=function(t){"boolean"==typeof t&&(console.warn("BinaryLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Pd};function Qd(t,e,r,n){this.ray=new Uh(t,e),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Kd(t,e){return t.distance-e.distance}function $d(t,e,r,n){if(!1!==t.visible&&(t.raycast(e,r),!0===n))for(var i=t.children,o=0,a=i.length;o<a;o++)$d(i[o],e,r,!0)}Zd.prototype={constructor:Zd,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this.texturePath||qd.extractUrlBase(t),o=this.binaryPath||qd.extractUrlBase(t),a=this;new Nd(this.manager).load(t,function(t){var s=JSON.parse(t),l=o+s.buffers,c=new Nd(a.manager);c.setResponseType("arraybuffer"),c.load(l,function(t){a.parse(t,e,i,s.materials)},r,n)},r,n)},setBinaryPath:function(t){this.binaryPath=t},setCrossOrigin:function(t){this.crossOrigin=t},setTexturePath:function(t){this.texturePath=t},parse:function(t,e,r,n){var i=function(){var e,r,n,i,o,a,s,l,c,u,h,d,p,f,m,v,g,y,x=this,b=0,w=[],_=[];function S(t){return t%4?4-t%4:0}function T(t,e){return new Uint8Array(t,e,1)[0]}function M(t,e){return new Uint32Array(t,e,1)[0]}function A(e,r){var n,i,o,a,s,l,c,u,h=new Uint32Array(t,r,3*e);for(n=0;n<e;n++)s=_[2*(o=h[3*n+1])],c=_[2*o+1],l=_[2*(a=h[3*n+2])],u=_[2*a+1],x.faceVertexUvs[0].push([new Nu(_[2*(i=h[3*n])],_[2*i+1]),new Nu(s,c),new Nu(l,u)])}function E(e,r){var n,i,o,a,s,l,c,u,h,d,p,f=new Uint32Array(t,r,4*e);for(n=0;n<e;n++)l=_[2*(o=f[4*n+1])],h=_[2*o+1],c=_[2*(a=f[4*n+2])],d=_[2*a+1],u=_[2*(s=f[4*n+3])],p=_[2*s+1],x.faceVertexUvs[0].push([new Nu(_[2*(i=f[4*n])],_[2*i+1]),new Nu(l,h),new Nu(u,p)]),x.faceVertexUvs[0].push([new Nu(l,h),new Nu(c,d),new Nu(u,p)])}function C(e,r,n){var i,o=new Uint32Array(t,r,3*e),a=new Uint16Array(t,n,e);for(i=0;i<e;i++)x.faces.push(new Cu(o[3*i],o[3*i+1],o[3*i+2],null,null,a[i]))}function P(e,r,n){var i,o,a,s,l,c=new Uint32Array(t,r,4*e),u=new Uint16Array(t,n,e);for(i=0;i<e;i++)a=c[4*i+2],x.faces.push(new Cu(c[4*i],o=c[4*i+1],s=c[4*i+3],null,null,l=u[i])),x.faces.push(new Cu(o,a,s,null,null,l))}function O(e,r,n,i){var o,a,s,l,c,u=new Uint32Array(t,r,3*e),h=new Uint32Array(t,n,3*e),d=new Uint16Array(t,i,e);for(o=0;o<e;o++){a=d[o];var p=w[3*(l=h[3*o+1])],f=w[3*l+1],m=w[3*l+2],v=w[3*(c=h[3*o+2])],g=w[3*c+1],y=w[3*c+2];x.faces.push(new Cu(u[3*o],u[3*o+1],u[3*o+2],[new yu(w[3*(s=h[3*o])],w[3*s+1],w[3*s+2]),new yu(p,f,m),new yu(v,g,y)],null,a))}}function N(e,r,n,i){var o,a,s,l,c,u,h,d,p,f=new Uint32Array(t,r,4*e),m=new Uint32Array(t,n,4*e),v=new Uint16Array(t,i,e);for(o=0;o<e;o++){s=f[4*o+2],c=v[o];var g=w[3*(h=m[4*o+1])],y=w[3*h+1],b=w[3*h+2],_=w[3*(d=m[4*o+2])],S=w[3*d+1],T=w[3*d+2],M=w[3*(p=m[4*o+3])],A=w[3*p+1],E=w[3*p+2];x.faces.push(new Cu(f[4*o],a=f[4*o+1],l=f[4*o+3],[new yu(w[3*(u=m[4*o])],w[3*u+1],w[3*u+2]),new yu(g,y,b),new yu(M,A,E)],null,c)),x.faces.push(new Cu(a,s,l,[new yu(g,y,b),new yu(_,S,T),new yu(M,A,E)],null,c))}}Iu.call(this),b+=(e=function(t,e){return{signature:function(t,e,r){return qd.decodeText(new Uint8Array(t,e,12))}(t,e),header_bytes:T(t,e+12),vertex_coordinate_bytes:T(t,e+13),normal_coordinate_bytes:T(t,e+14),uv_coordinate_bytes:T(t,e+15),vertex_index_bytes:T(t,e+16),normal_index_bytes:T(t,e+17),uv_index_bytes:T(t,e+18),material_index_bytes:T(t,e+19),nvertices:M(t,e+20),nnormals:M(t,e+20+4),nuvs:M(t,e+20+8),ntri_flat:M(t,e+20+12),ntri_smooth:M(t,e+20+16),ntri_flat_uv:M(t,e+20+20),ntri_smooth_uv:M(t,e+20+24),nquad_flat:M(t,e+20+28),nquad_smooth:M(t,e+20+32),nquad_flat_uv:M(t,e+20+36),nquad_smooth_uv:M(t,e+20+40)}}(t,b)).header_bytes,d=e.ntri_flat*(u=3*e.vertex_index_bytes+e.material_index_bytes),p=e.ntri_smooth*(u+3*e.normal_index_bytes),f=e.ntri_flat_uv*(u+3*e.uv_index_bytes),m=e.ntri_smooth_uv*(u+3*e.normal_index_bytes+3*e.uv_index_bytes),v=e.nquad_flat*(h=4*e.vertex_index_bytes+e.material_index_bytes),g=e.nquad_smooth*(h+4*e.normal_index_bytes),y=e.nquad_flat_uv*(h+4*e.uv_index_bytes),b+=function(r){var n,i=e.nvertices,o=new Float32Array(t,b,3*i);for(n=0;n<i;n++)x.vertices.push(new yu(o[3*n],o[3*n+1],o[3*n+2]));return 3*i*Float32Array.BYTES_PER_ELEMENT}(),b+=function(r){var n=e.nnormals;if(n){var i,o=new Int8Array(t,b,3*n);for(i=0;i<n;i++)w.push(o[3*i]/127,o[3*i+1]/127,o[3*i+2]/127)}return 3*n*Int8Array.BYTES_PER_ELEMENT}(),b+=S(3*e.nnormals),c=(l=(s=(a=(o=(i=(n=(r=b+=function(r){var n=e.nuvs;if(n){var i,o=new Float32Array(t,b,2*n);for(i=0;i<n;i++)_.push(o[2*i],o[2*i+1])}return 2*n*Float32Array.BYTES_PER_ELEMENT}())+d+S(2*e.ntri_flat))+p+S(2*e.ntri_smooth))+f+S(2*e.ntri_flat_uv))+m+S(2*e.ntri_smooth_uv))+v+S(2*e.nquad_flat))+g+S(2*e.nquad_smooth))+y+S(2*e.nquad_flat_uv),function(t){var r=e.ntri_flat_uv;if(r){var n=i+r*Uint32Array.BYTES_PER_ELEMENT*3;C(r,i,n+r*Uint32Array.BYTES_PER_ELEMENT*3),A(r,n)}}(),function(t){var r=e.ntri_smooth_uv;if(r){var n=o+r*Uint32Array.BYTES_PER_ELEMENT*3,i=n+r*Uint32Array.BYTES_PER_ELEMENT*3;O(r,o,n,i+r*Uint32Array.BYTES_PER_ELEMENT*3),A(r,i)}}(),function(t){var r=e.nquad_flat_uv;if(r){var n=l+r*Uint32Array.BYTES_PER_ELEMENT*4;P(r,l,n+r*Uint32Array.BYTES_PER_ELEMENT*4),E(r,n)}}(),function(t){var r=e.nquad_smooth_uv;if(r){var n=c+r*Uint32Array.BYTES_PER_ELEMENT*4,i=n+r*Uint32Array.BYTES_PER_ELEMENT*4;N(r,c,n,i+r*Uint32Array.BYTES_PER_ELEMENT*4),E(r,i)}}(),function(t){var n=e.ntri_flat;n&&C(n,r,r+n*Uint32Array.BYTES_PER_ELEMENT*3)}(),function(t){var r=e.ntri_smooth;if(r){var i=n+r*Uint32Array.BYTES_PER_ELEMENT*3;O(r,n,i,i+r*Uint32Array.BYTES_PER_ELEMENT*3)}}(),function(t){var r=e.nquad_flat;r&&P(r,a,a+r*Uint32Array.BYTES_PER_ELEMENT*4)}(),function(t){var r=e.nquad_smooth;if(r){var n=s+r*Uint32Array.BYTES_PER_ELEMENT*4;N(r,s,n,n+r*Uint32Array.BYTES_PER_ELEMENT*4)}}(),this.computeFaceNormals()};(i.prototype=Object.create(Iu.prototype)).constructor=i,e(new i,Yd.prototype.initMaterials(n,r,this.crossOrigin))}},Object.assign(Qd.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return $d(t,this,n,e),n.sort(Kd),n},intersectObjects:function(t,e,r){var n=r||[];if(!1===Array.isArray(t))return console.warn("Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=t.length;i<o;i++)$d(t[i],this,n,e);return n.sort(Kd),n}});var tp=function(t,e,r){if(t instanceof pd){console.warn("DragControls: Constructor now expects ( objects, camera, domElement )");var n=t;t=e,e=n}var i=new Bh,o=new Qd,a=new Nu,s=new yu,l=new yu,c=null,u=null,h=this;function d(){r.addEventListener("mousemove",f,!1),r.addEventListener("mousedown",m,!1),r.addEventListener("mouseup",v,!1),r.addEventListener("mouseleave",v,!1),r.addEventListener("touchmove",g,!1),r.addEventListener("touchstart",y,!1),r.addEventListener("touchend",x,!1)}function p(){r.removeEventListener("mousemove",f,!1),r.removeEventListener("mousedown",m,!1),r.removeEventListener("mouseup",v,!1),r.removeEventListener("mouseleave",v,!1),r.removeEventListener("touchmove",g,!1),r.removeEventListener("touchstart",y,!1),r.removeEventListener("touchend",x,!1)}function f(n){n.preventDefault();var d=r.getBoundingClientRect();if(a.x=(n.clientX-d.left)/d.width*2-1,a.y=-(n.clientY-d.top)/d.height*2+1,o.setFromCamera(a,e),c&&h.enabled)return o.ray.intersectPlane(i,l)&&c.position.copy(l.sub(s)),void h.dispatchEvent({type:"drag",object:c});o.setFromCamera(a,e);var p=o.intersectObjects(t);if(p.length>0){var f=p[0].object;i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),f.position),u!==f&&(h.dispatchEvent({type:"hoveron",object:f}),r.style.cursor="pointer",u=f)}else null!==u&&(h.dispatchEvent({type:"hoveroff",object:u}),r.style.cursor="auto",u=null)}function m(n){n.preventDefault(),o.setFromCamera(a,e);var u=o.intersectObjects(t);u.length>0&&(c=u[0].object,o.ray.intersectPlane(i,l)&&s.copy(l).sub(c.position),r.style.cursor="move",h.dispatchEvent({type:"dragstart",object:c}))}function v(t){t.preventDefault(),c&&(h.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor="auto"}function g(t){t.preventDefault(),t=t.changedTouches[0];var n=r.getBoundingClientRect();if(a.x=(t.clientX-n.left)/n.width*2-1,a.y=-(t.clientY-n.top)/n.height*2+1,o.setFromCamera(a,e),c&&h.enabled)return o.ray.intersectPlane(i,l)&&c.position.copy(l.sub(s)),void h.dispatchEvent({type:"drag",object:c})}function y(n){n.preventDefault(),n=n.changedTouches[0];var u=r.getBoundingClientRect();a.x=(n.clientX-u.left)/u.width*2-1,a.y=-(n.clientY-u.top)/u.height*2+1,o.setFromCamera(a,e);var d=o.intersectObjects(t);d.length>0&&(c=d[0].object,i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),c.position),o.ray.intersectPlane(i,l)&&s.copy(l).sub(c.position),r.style.cursor="move",h.dispatchEvent({type:"dragstart",object:c}))}function x(t){t.preventDefault(),c&&(h.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor="auto"}d(),this.enabled=!0,this.activate=d,this.deactivate=p,this.dispose=function(){p()},this.setObjects=function(){console.error("DragControls: setObjects() has been removed.")},this.on=function(t,e){console.warn("DragControls: on() has been deprecated. Use addEventListener() instead."),h.addEventListener(t,e)},this.off=function(t,e){console.warn("DragControls: off() has been deprecated. Use removeEventListener() instead."),h.removeEventListener(t,e)},this.notify=function(t){console.error("DragControls: notify() has been deprecated. Use dispatchEvent() instead."),h.dispatchEvent({type:t})}};function ep(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}(tp.prototype=Object.create(bu.prototype)).constructor=tp,Object.assign(ep.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(vu.clamp(t.y/this.radius,-1,1))),this}});var rp=function(t,e){e=void 0!==e?e:document,this.enabled=!0,this.center=new yu,this.panSpeed=.001,this.zoomSpeed=.001,this.rotationSpeed=.005;var r=this,n=new yu,i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},o=i.NONE,a=this.center,s=new Su,l=new Nu,c=new Nu,u=new ep,h={type:"change"};function d(t){!1!==r.enabled&&(0===t.button?o=i.ROTATE:1===t.button?o=i.ZOOM:2===t.button&&(o=i.PAN),c.set(t.clientX,t.clientY),e.addEventListener("mousemove",p,!1),e.addEventListener("mouseup",f,!1),e.addEventListener("mouseout",f,!1),e.addEventListener("dblclick",f,!1))}function p(t){if(!1!==r.enabled){l.set(t.clientX,t.clientY);var e=l.x-c.x,n=l.y-c.y;o===i.ROTATE?r.rotate(new yu(-e*r.rotationSpeed,-n*r.rotationSpeed,0)):o===i.ZOOM?r.zoom(new yu(0,0,n)):o===i.PAN&&r.pan(new yu(-e,n,0)),c.set(t.clientX,t.clientY)}}function f(t){e.removeEventListener("mousemove",p,!1),e.removeEventListener("mouseup",f,!1),e.removeEventListener("mouseout",f,!1),e.removeEventListener("dblclick",f,!1),o=i.NONE}function m(t){t.preventDefault(),r.zoom(new yu(0,0,t.deltaY))}function v(t){t.preventDefault()}this.focus=function(e){var n,i=(new Pu).setFromObject(e);!1===i.isEmpty()?(a.copy(i.getCenter()),n=i.getBoundingSphere().radius):(a.setFromMatrixPosition(e.matrixWorld),n=.1);var o=new yu(0,0,1);o.applyQuaternion(t.quaternion),o.multiplyScalar(4*n),t.position.copy(a).add(o),r.dispatchEvent(h)},this.pan=function(e){var n=t.position.distanceTo(a);e.multiplyScalar(n*r.panSpeed),e.applyMatrix3(s.getNormalMatrix(t.matrix)),t.position.add(e),a.add(e),r.dispatchEvent(h)},this.zoom=function(e){var n=t.position.distanceTo(a);e.multiplyScalar(n*r.zoomSpeed),e.length()>n||(e.applyMatrix3(s.getNormalMatrix(t.matrix)),t.position.add(e),r.dispatchEvent(h))},this.rotate=function(e){n.copy(t.position).sub(a),u.setFromVector3(n),u.theta+=e.x,u.phi+=e.y,u.makeSafe(),n.setFromSpherical(u),t.position.copy(a).add(n),t.lookAt(a),r.dispatchEvent(h)},this.dispose=function(){e.removeEventListener("contextmenu",v,!1),e.removeEventListener("mousedown",d,!1),e.removeEventListener("wheel",m,!1),e.removeEventListener("mousemove",p,!1),e.removeEventListener("mouseup",f,!1),e.removeEventListener("mouseout",f,!1),e.removeEventListener("dblclick",f,!1),e.removeEventListener("touchstart",b,!1),e.removeEventListener("touchmove",w,!1)},e.addEventListener("contextmenu",v,!1),e.addEventListener("mousedown",d,!1),e.addEventListener("wheel",m,!1);var g=[new yu,new yu,new yu],y=[new yu,new yu,new yu],x=null;function b(t){if(!1!==r.enabled){switch(t.touches.length){case 1:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[0].pageX,t.touches[0].pageY,0);break;case 2:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[1].pageX,t.touches[1].pageY,0),x=g[0].distanceTo(g[1])}y[0].copy(g[0]),y[1].copy(g[1])}}function w(t){if(!1!==r.enabled){switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[0].pageX,t.touches[0].pageY,0),r.rotate(g[0].sub(o(g[0],y)).multiplyScalar(-r.rotationSpeed));break;case 2:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[1].pageX,t.touches[1].pageY,0);var e=g[0].distanceTo(g[1]);r.zoom(new yu(0,0,x-e)),x=e;var n=g[0].clone().sub(o(g[0],y)),i=g[1].clone().sub(o(g[1],y));n.x=-n.x,i.x=-i.x,r.pan(n.add(i).multiplyScalar(.5))}y[0].copy(g[0]),y[1].copy(g[1])}function o(t,e){var r=e[0];for(var n in e)r.distanceTo(t)>e[n].distanceTo(t)&&(r=e[n]);return r}}e.addEventListener("touchstart",b,!1),e.addEventListener("touchmove",w,!1)};(rp.prototype=Object.create(bu.prototype)).constructor=rp;var np=function(t,e){this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new yu,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.panningMode=ip,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),s=a.NONE},this.update=function(){var e=new yu,i=(new xu).setFromUnitVectors(t.up,new yu(0,1,0)),o=i.clone().inverse(),f=new yu,m=new xu;return function(){var t=r.object.position;return e.copy(t).sub(r.target),e.applyQuaternion(i),c.setFromVector3(e),r.autoRotate&&s===a.NONE&&T(2*Math.PI/60/60*r.autoRotateSpeed),c.theta+=u.theta,c.phi+=u.phi,c.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(r.minDistance,Math.min(r.maxDistance,c.radius)),r.target.add(d),e.setFromSpherical(c),e.applyQuaternion(o),t.copy(r.target).add(e),r.object.lookAt(r.target),!0===r.enableDamping?(u.theta*=1-r.dampingFactor,u.phi*=1-r.dampingFactor,d.multiplyScalar(1-r.dampingFactor)):(u.set(0,0,0),d.set(0,0,0)),h=1,!!(p||f.distanceToSquared(r.object.position)>l||8*(1-m.dot(r.object.quaternion))>l)&&(r.dispatchEvent(n),f.copy(r.object.position),m.copy(r.object.quaternion),p=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",B,!1),r.domElement.removeEventListener("mousedown",N,!1),r.domElement.removeEventListener("wheel",R,!1),r.domElement.removeEventListener("touchstart",F,!1),r.domElement.removeEventListener("touchend",k,!1),r.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",I,!1),window.removeEventListener("keydown",D,!1)};var r=this,n={type:"change"},i={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},s=a.NONE,l=1e-6,c=new ep,u=new ep,h=1,d=new yu,p=!1,f=new Nu,m=new Nu,v=new Nu,g=new Nu,y=new Nu,x=new Nu,b=new Nu,w=new Nu,_=new Nu;function S(){return Math.pow(.95,r.zoomSpeed)}function T(t){u.theta-=t}function M(t){u.phi-=t}var A=function(){var t=new yu;return function(e,r){t.setFromMatrixColumn(r,0),t.multiplyScalar(-e),d.add(t)}}(),E=function(){var t=new yu;return function(e,n){switch(r.panningMode){case ip:t.setFromMatrixColumn(n,1);break;case op:t.setFromMatrixColumn(n,0),t.crossVectors(r.object.up,t)}t.multiplyScalar(e),d.add(t)}}(),C=function(){var t=new yu;return function(e,n){var i=r.domElement===document?r.domElement.body:r.domElement;if(r.object.isPerspectiveCamera){t.copy(r.object.position).sub(r.target);var o=t.length();o*=Math.tan(r.object.fov/2*Math.PI/180),A(2*e*o/i.clientHeight,r.object.matrix),E(2*n*o/i.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(A(e*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),E(n*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function P(t){r.object.isPerspectiveCamera?h/=t:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*t)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(t){r.object.isPerspectiveCamera?h*=t:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/t)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function N(t){if(!1!==r.enabled){switch(t.preventDefault(),t.button){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(t){f.set(t.clientX,t.clientY)}(t),s=a.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(t){b.set(t.clientX,t.clientY)}(t),s=a.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(t){g.set(t.clientX,t.clientY)}(t),s=a.PAN}s!==a.NONE&&(document.addEventListener("mousemove",L,!1),document.addEventListener("mouseup",I,!1),r.dispatchEvent(i))}}function L(t){if(!1!==r.enabled)switch(t.preventDefault(),s){case a.ROTATE:if(!1===r.enableRotate)return;!function(t){m.set(t.clientX,t.clientY),v.subVectors(m,f).multiplyScalar(r.rotateSpeed);var e=r.domElement===document?r.domElement.body:r.domElement;T(2*Math.PI*v.x/e.clientWidth),M(2*Math.PI*v.y/e.clientHeight),f.copy(m),r.update()}(t);break;case a.DOLLY:if(!1===r.enableZoom)return;!function(t){w.set(t.clientX,t.clientY),_.subVectors(w,b),_.y>0?P(S()):_.y<0&&O(S()),b.copy(w),r.update()}(t);break;case a.PAN:if(!1===r.enablePan)return;!function(t){y.set(t.clientX,t.clientY),x.subVectors(y,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(y),r.update()}(t)}}function I(t){!1!==r.enabled&&(document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",I,!1),r.dispatchEvent(o),s=a.NONE)}function R(t){!1===r.enabled||!1===r.enableZoom||s!==a.NONE&&s!==a.ROTATE||(t.preventDefault(),t.stopPropagation(),r.dispatchEvent(i),function(t){t.deltaY<0?O(S()):t.deltaY>0&&P(S()),r.update()}(t),r.dispatchEvent(o))}function D(t){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(t){switch(t.keyCode){case r.keys.UP:C(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:C(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:C(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:C(-r.keyPanSpeed,0),r.update()}}(t)}function F(t){if(!1!==r.enabled){switch(t.touches.length){case 1:if(!1===r.enableRotate)return;!function(t){f.set(t.touches[0].pageX,t.touches[0].pageY)}(t),s=a.TOUCH_ROTATE;break;case 2:if(!1===r.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+r*r);b.set(0,n)}(t),s=a.TOUCH_DOLLY;break;case 3:if(!1===r.enablePan)return;!function(t){g.set(t.touches[0].pageX,t.touches[0].pageY)}(t),s=a.TOUCH_PAN;break;default:s=a.NONE}s!==a.NONE&&r.dispatchEvent(i)}}function U(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===r.enableRotate)return;if(s!==a.TOUCH_ROTATE)return;!function(t){m.set(t.touches[0].pageX,t.touches[0].pageY),v.subVectors(m,f).multiplyScalar(r.rotateSpeed);var e=r.domElement===document?r.domElement.body:r.domElement;T(2*Math.PI*v.x/e.clientWidth),M(2*Math.PI*v.y/e.clientHeight),f.copy(m),r.update()}(t);break;case 2:if(!1===r.enableZoom)return;if(s!==a.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);w.set(0,i),_.subVectors(w,b),_.y>0?O(S()):_.y<0&&P(S()),b.copy(w),r.update()}(t);break;case 3:if(!1===r.enablePan)return;if(s!==a.TOUCH_PAN)return;!function(t){y.set(t.touches[0].pageX,t.touches[0].pageY),x.subVectors(y,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(y),r.update()}(t);break;default:s=a.NONE}}function k(t){!1!==r.enabled&&(r.dispatchEvent(o),s=a.NONE)}function B(t){!1!==r.enabled&&t.preventDefault()}r.domElement.addEventListener("contextmenu",B,!1),r.domElement.addEventListener("mousedown",N,!1),r.domElement.addEventListener("wheel",R,!1),r.domElement.addEventListener("touchstart",F,!1),r.domElement.addEventListener("touchend",k,!1),r.domElement.addEventListener("touchmove",U,!1),window.addEventListener("keydown",D,!1),this.update()};(np.prototype=Object.create(bu.prototype)).constructor=np,Object.defineProperties(np.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}});var ip=0,op=1,ap=function(t,e){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new yu;var i=!0,o=n.NONE,a=n.NONE,s=new yu,l=new yu,c=new yu,u=new Nu,h=new Nu,d=0,p=0,f=new Nu,m=new Nu;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var v={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};var x=function(){var t=new Nu;return function(e,n){return t.set((e-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),t}}(),b=function(){var t=new yu,e=new yu,n=new yu;return function(i,o){n.set((i-.5*r.screen.width-r.screen.left)/r.radius,(.5*r.screen.height+r.screen.top-o)/r.radius,0);var a=n.length();return r.noRoll?n.z=a<Math.SQRT1_2?Math.sqrt(1-a*a):.5/a:a>1?n.normalize():n.z=Math.sqrt(1-a*a),s.copy(r.object.position).sub(r.target),t.copy(r.object.up).setLength(n.y),t.add(e.copy(r.object.up).cross(s).setLength(n.x)),t.add(s.setLength(n.z)),t}}();function w(t){!1!==r.enabled&&(window.removeEventListener("keydown",w),a=o,o===n.NONE&&(t.keyCode!==r.keys[n.ROTATE]||r.noRotate?t.keyCode!==r.keys[n.ZOOM]||r.noZoom?t.keyCode!==r.keys[n.PAN]||r.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE))}function _(t){!1!==r.enabled&&(o=a,window.addEventListener("keydown",w,!1))}function S(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o===n.NONE&&(o=t.button),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||(f.copy(x(t.pageX,t.pageY)),m.copy(f)):(u.copy(x(t.pageX,t.pageY)),h.copy(u)):(l.copy(b(t.pageX,t.pageY)),c.copy(l)),document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",M,!1),r.dispatchEvent(g))}function T(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||m.copy(x(t.pageX,t.pageY)):h.copy(x(t.pageX,t.pageY)):c.copy(b(t.pageX,t.pageY)))}function M(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",M),r.dispatchEvent(y))}function A(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),u.y+=.01*t.deltaY,r.dispatchEvent(g),r.dispatchEvent(y))}function E(t){if(!1!==r.enabled){switch(t.touches.length){case 1:o=n.TOUCH_ROTATE,l.copy(b(t.touches[0].pageX,t.touches[0].pageY)),c.copy(l);break;case 2:o=n.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=d=Math.sqrt(e*e+i*i),f.copy(x((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),m.copy(f);break;default:o=n.NONE}r.dispatchEvent(g)}}function C(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:c.copy(b(t.touches[0].pageX,t.touches[0].pageY));break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=Math.sqrt(e*e+i*i),m.copy(x((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2));break;default:o=n.NONE}}function P(t){if(!1!==r.enabled){switch(t.touches.length){case 1:c.copy(b(t.touches[0].pageX,t.touches[0].pageY)),l.copy(c);break;case 2:d=p=0,m.copy(x((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),f.copy(m)}o=n.NONE,r.dispatchEvent(y)}}function O(t){t.preventDefault()}this.rotateCamera=function(){var t=new yu,e=new xu;return function(){var n=Math.acos(l.dot(c)/l.length()/c.length());n&&(t.crossVectors(l,c).normalize(),e.setFromAxisAngle(t,-(n*=r.rotateSpeed)),s.applyQuaternion(e),r.object.up.applyQuaternion(e),c.applyQuaternion(e),r.staticMoving?l.copy(c):(e.setFromAxisAngle(t,n*(r.dynamicDampingFactor-1)),l.applyQuaternion(e)),i=!0)}}(),this.zoomCamera=function(){if(o===n.TOUCH_ZOOM_PAN){var t=p/d;d=p,r.object.zoom*=t,i=!0}else t=1+(h.y-u.y)*r.zoomSpeed,Math.abs(t-1)>1e-6&&t>0&&(r.object.zoom/=t,r.staticMoving?u.copy(h):u.y+=(h.y-u.y)*this.dynamicDampingFactor,i=!0)},this.panCamera=function(){var t=new Nu,e=new yu,n=new yu;return function(){if(t.copy(m).sub(f),t.lengthSq()){var o=(r.object.top-r.object.bottom)/r.object.zoom;t.x*=(r.object.right-r.object.left)/r.object.zoom,t.y*=o,n.copy(s).cross(r.object.up).setLength(t.x),n.add(e.copy(r.object.up).setLength(t.y)),r.object.position.add(n),r.target.add(n),r.staticMoving?f.copy(m):f.add(t.subVectors(m,f).multiplyScalar(r.dynamicDampingFactor)),i=!0}}}(),this.update=function(){s.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||(r.zoomCamera(),i&&r.object.updateProjectionMatrix()),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,s),r.object.lookAt(r.target),i&&(r.dispatchEvent(v),i=!1)},this.reset=function(){o=n.NONE,a=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),s.subVectors(r.object.position,r.target),r.object.left=r.left0,r.object.right=r.right0,r.object.top=r.top0,r.object.bottom=r.bottom0,r.object.lookAt(r.target),r.dispatchEvent(v),i=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",O,!1),this.domElement.removeEventListener("mousedown",S,!1),this.domElement.removeEventListener("wheel",A,!1),this.domElement.removeEventListener("touchstart",E,!1),this.domElement.removeEventListener("touchend",P,!1),this.domElement.removeEventListener("touchmove",C,!1),document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",M,!1),window.removeEventListener("keydown",w,!1),window.removeEventListener("keyup",_,!1)},this.domElement.addEventListener("contextmenu",O,!1),this.domElement.addEventListener("mousedown",S,!1),this.domElement.addEventListener("wheel",A,!1),this.domElement.addEventListener("touchstart",E,!1),this.domElement.addEventListener("touchend",P,!1),this.domElement.addEventListener("touchmove",C,!1),window.addEventListener("keydown",w,!1),window.addEventListener("keyup",_,!1),this.handleResize(),this.update()};(ap.prototype=Object.create(bu.prototype)).constructor=ap;var sp=function(t,e){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new yu;var i=new yu,o=n.NONE,a=n.NONE,s=new yu,l=new Nu,c=new Nu,u=new yu,h=0,d=new Nu,p=new Nu,f=0,m=0,v=new Nu,g=new Nu;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},x={type:"start"},b={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};var w=function(){var t=new Nu;return function(e,n){return t.set((e-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),t}}(),_=function(){var t=new Nu;return function(e,n){return t.set((e-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),t}}();function S(t){!1!==r.enabled&&(window.removeEventListener("keydown",S),a=o,o===n.NONE&&(t.keyCode!==r.keys[n.ROTATE]||r.noRotate?t.keyCode!==r.keys[n.ZOOM]||r.noZoom?t.keyCode!==r.keys[n.PAN]||r.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE))}function T(t){!1!==r.enabled&&(o=a,window.addEventListener("keydown",S,!1))}function M(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o===n.NONE&&(o=t.button),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||(v.copy(w(t.pageX,t.pageY)),g.copy(v)):(d.copy(w(t.pageX,t.pageY)),p.copy(d)):(c.copy(_(t.pageX,t.pageY)),l.copy(c)),document.addEventListener("mousemove",A,!1),document.addEventListener("mouseup",E,!1),r.dispatchEvent(x))}function A(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||g.copy(w(t.pageX,t.pageY)):p.copy(w(t.pageX,t.pageY)):(l.copy(c),c.copy(_(t.pageX,t.pageY))))}function E(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",E),r.dispatchEvent(b))}function C(t){if(!1!==r.enabled&&!0!==r.noZoom){switch(t.preventDefault(),t.stopPropagation(),t.deltaMode){case 2:d.y-=.025*t.deltaY;break;case 1:d.y-=.01*t.deltaY;break;default:d.y-=25e-5*t.deltaY}r.dispatchEvent(x),r.dispatchEvent(b)}}function P(t){if(!1!==r.enabled){switch(t.touches.length){case 1:o=n.TOUCH_ROTATE,c.copy(_(t.touches[0].pageX,t.touches[0].pageY)),l.copy(c);break;default:o=n.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;m=f=Math.sqrt(e*e+i*i),v.copy(w((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),g.copy(v)}r.dispatchEvent(x)}}function O(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:l.copy(c),c.copy(_(t.touches[0].pageX,t.touches[0].pageY));break;default:var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;m=Math.sqrt(e*e+n*n),g.copy(w((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2))}}function N(t){if(!1!==r.enabled){switch(t.touches.length){case 0:o=n.NONE;break;case 1:o=n.TOUCH_ROTATE,c.copy(_(t.touches[0].pageX,t.touches[0].pageY)),l.copy(c)}r.dispatchEvent(b)}}function L(t){!1!==r.enabled&&t.preventDefault()}this.rotateCamera=function(){var t,e=new yu,n=new xu,i=new yu,o=new yu,a=new yu,d=new yu;return function(){d.set(c.x-l.x,c.y-l.y,0),(t=d.length())?(s.copy(r.object.position).sub(r.target),i.copy(s).normalize(),o.copy(r.object.up).normalize(),a.crossVectors(o,i).normalize(),o.setLength(c.y-l.y),a.setLength(c.x-l.x),d.copy(o.add(a)),e.crossVectors(d,s).normalize(),n.setFromAxisAngle(e,t*=r.rotateSpeed),s.applyQuaternion(n),r.object.up.applyQuaternion(n),u.copy(e),h=t):!r.staticMoving&&h&&(h*=Math.sqrt(1-r.dynamicDampingFactor),s.copy(r.object.position).sub(r.target),n.setFromAxisAngle(u,h),s.applyQuaternion(n),r.object.up.applyQuaternion(n)),l.copy(c)}}(),this.zoomCamera=function(){var t;o===n.TOUCH_ZOOM_PAN?(t=f/m,f=m,s.multiplyScalar(t)):(1!=(t=1+(p.y-d.y)*r.zoomSpeed)&&t>0&&s.multiplyScalar(t),r.staticMoving?d.copy(p):d.y+=(p.y-d.y)*this.dynamicDampingFactor)},this.panCamera=function(){var t=new Nu,e=new yu,n=new yu;return function(){t.copy(g).sub(v),t.lengthSq()&&(t.multiplyScalar(s.length()*r.panSpeed),n.copy(s).cross(r.object.up).setLength(t.x),n.add(e.copy(r.object.up).setLength(t.y)),r.object.position.add(n),r.target.add(n),r.staticMoving?v.copy(g):v.add(t.subVectors(g,v).multiplyScalar(r.dynamicDampingFactor)))}}(),this.checkDistances=function(){r.noZoom&&r.noPan||(s.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,s.setLength(r.maxDistance)),d.copy(p)),s.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,s.setLength(r.minDistance)),d.copy(p)))},this.update=function(){s.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,s),r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(y),i.copy(r.object.position))},this.reset=function(){o=n.NONE,a=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),s.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(y),i.copy(r.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",L,!1),this.domElement.removeEventListener("mousedown",M,!1),this.domElement.removeEventListener("wheel",C,!1),this.domElement.removeEventListener("touchstart",P,!1),this.domElement.removeEventListener("touchend",N,!1),this.domElement.removeEventListener("touchmove",O,!1),document.removeEventListener("mousemove",A,!1),document.removeEventListener("mouseup",E,!1),window.removeEventListener("keydown",S,!1),window.removeEventListener("keyup",T,!1)},this.domElement.addEventListener("contextmenu",L,!1),this.domElement.addEventListener("mousedown",M,!1),this.domElement.addEventListener("wheel",C,!1),this.domElement.addEventListener("touchstart",P,!1),this.domElement.addEventListener("touchend",N,!1),this.domElement.addEventListener("touchmove",O,!1),window.addEventListener("keydown",S,!1),window.addEventListener("keyup",T,!1),this.handleResize(),this.update()};function lp(t,e,r,n){Iu.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new cp(t,e,r,n)),this.mergeVertices()}function cp(t,e,r,n){Yu.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],o=[];function a(t,e,r,n){var i,o,a=Math.pow(2,n),l=[];for(i=0;i<=a;i++){l[i]=[];var c=t.clone().lerp(r,i/a),u=e.clone().lerp(r,i/a),h=a-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===a?c:c.clone().lerp(u,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var d=Math.floor(o/2);o%2==0?(s(l[i][d+1]),s(l[i+1][d]),s(l[i][d])):(s(l[i][d+1]),s(l[i+1][d+1]),s(l[i+1][d]))}}function s(t){i.push(t.x,t.y,t.z)}function l(e,r){var n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function c(t,e,r,n){n<0&&1===t.x&&(o[e]=t.x-1),0===r.x&&0===r.z&&(o[e]=n/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}function h(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){for(var r=new yu,n=new yu,i=new yu,o=0;o<e.length;o+=3)l(e[o+0],r),l(e[o+1],n),l(e[o+2],i),a(r,n,i,t)}(n=n||0),function(t){for(var e=new yu,r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){for(var t=new yu,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var r=u(t)/2/Math.PI+.5,n=h(t)/Math.PI+.5;o.push(r,1-n)}(function(){for(var t=new yu,e=new yu,r=new yu,n=new yu,a=new Nu,s=new Nu,l=new Nu,h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),n.copy(t).add(e).add(r).divideScalar(3);var p=u(n);c(a,d+0,t,p),c(s,d+2,e,p),c(l,d+4,r,p)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],r=o[t+2],n=o[t+4],i=Math.max(e,r,n),a=Math.min(e,r,n);i>.9&&a<.1&&(e<.2&&(o[t+0]+=1),r<.2&&(o[t+2]+=1),n<.2&&(o[t+4]+=1))}}()}(),this.addAttribute("position",new Gu(i,3)),this.addAttribute("normal",new Gu(i.slice(),3)),this.addAttribute("uv",new Gu(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function up(t,e){Iu.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new hp(t,e)),this.mergeVertices()}function hp(t,e){cp.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function dp(t,e,r,n,i){Iu.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new pp(t,e,r,n,i)),this.mergeVertices()}function pp(t,e,r,n,i){Yu.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,a,s=[],l=[],c=[],u=[],h=new yu,d=new yu,p=new yu;for(o=0;o<=r;o++)for(a=0;a<=n;a++){var f=a/n*i,m=o/r*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),l.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(a/n),u.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=n;a++){var v=(n+1)*(o-1)+a-1,g=(n+1)*(o-1)+a,y=(n+1)*o+a;s.push((n+1)*o+a-1,v,y),s.push(v,g,y)}this.setIndex(s),this.addAttribute("position",new Gu(l,3)),this.addAttribute("normal",new Gu(c,3)),this.addAttribute("uv",new Gu(u,2))}(sp.prototype=Object.create(bu.prototype)).constructor=sp,(lp.prototype=Object.create(Iu.prototype)).constructor=lp,(cp.prototype=Object.create(Yu.prototype)).constructor=cp,(up.prototype=Object.create(Iu.prototype)).constructor=up,(hp.prototype=Object.create(cp.prototype)).constructor=hp,(dp.prototype=Object.create(Iu.prototype)).constructor=dp,(pp.prototype=Object.create(Yu.prototype)).constructor=pp;var fp=function(t){Dh.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=Zu,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(fp.prototype=Object.create(Dh.prototype)).constructor=fp;var mp=function(t){Fh.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(mp.prototype=Object.create(Fh.prototype)).constructor=mp;var vp=new fp({visible:!1,transparent:!1}),gp=function(){this.init=function(){Mu.call(this),this.handles=new Mu,this.pickers=new Mu,this.planes=new Mu,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var t=new Td(50,50,2,2),e=new Dh({visible:!1,side:Ku}),r={XY:new zh(t,e),YZ:new zh(t,e),XZ:new zh(t,e),XYZE:new zh(t,e)};for(var n in this.activePlane=r.XYZE,r.YZ.rotation.set(0,Math.PI/2,0),r.XZ.rotation.set(-Math.PI/2,0,0),r)r[n].name=n,this.planes.add(r[n]),this.planes[n]=r[n];var i=function(t,e){for(var r in t)for(n=t[r].length;n--;){var i=t[r][n][0],o=t[r][n][1],a=t[r][n][2];i.name=r,i.renderOrder=1/0,o&&i.position.set(o[0],o[1],o[2]),a&&i.rotation.set(a[0],a[1],a[2]),e.add(i)}};i(this.handleGizmos,this.handles),i(this.pickerGizmos,this.pickers),this.traverse(function(t){if(t instanceof zh){t.updateMatrix();var e=t.geometry.clone();e.applyMatrix(t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}})},this.highlight=function(t){this.traverse(function(e){e.material&&e.material.highlight&&e.material.highlight(e.name===t)})}};(gp.prototype=Object.create(Mu.prototype)).constructor=gp,gp.prototype.update=function(t,e){var r=new yu(0,0,0),n=new yu(0,1,0),i=new gu;this.traverse(function(o){-1!==o.name.search("E")?o.quaternion.setFromRotationMatrix(i.lookAt(e,r,n)):-1===o.name.search("X")&&-1===o.name.search("Y")&&-1===o.name.search("Z")||o.quaternion.setFromEuler(t)})};var yp=function(){gp.call(this);var t=new Iu,e=new zh(new qh(0,.05,.2,12,1,!1));e.position.y=.5,e.updateMatrix(),t.merge(e.geometry,e.matrix);var r=new Yu;r.addAttribute("position",new Gu([0,0,0,1,0,0],3));var n=new Yu;n.addAttribute("position",new Gu([0,0,0,0,1,0],3));var i=new Yu;i.addAttribute("position",new Gu([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new zh(t,new fp({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new Vh(r,new mp({color:16711680}))]],Y:[[new zh(t,new fp({color:65280})),[0,.5,0]],[new Vh(n,new mp({color:65280}))]],Z:[[new zh(t,new fp({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new Vh(i,new mp({color:255}))]],XYZ:[[new zh(new up(.1,0),new fp({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new zh(new Td(.29,.29),new fp({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new zh(new Td(.29,.29),new fp({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new zh(new Td(.29,.29),new fp({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new zh(new Jh(.2,0,1,4,1,!1),vp),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new zh(new Jh(.2,0,1,4,1,!1),vp),[0,.6,0]]],Z:[[new zh(new Jh(.2,0,1,4,1,!1),vp),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new zh(new up(.2,0),vp)]],XY:[[new zh(new Td(.4,.4),vp),[.2,.2,0]]],YZ:[[new zh(new Td(.4,.4),vp),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new zh(new Td(.4,.4),vp),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(t,e){var r=new gu;e.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"===t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"===t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===t&&(this.activePlane=this.planes.XYZE),"XY"===t&&(this.activePlane=this.planes.XY),"YZ"===t&&(this.activePlane=this.planes.YZ),"XZ"===t&&(this.activePlane=this.planes.XZ)},this.init()};(yp.prototype=Object.create(gp.prototype)).constructor=yp;var xp=function(){gp.call(this);var t=function(t,e,r){var n=new Yu,i=[];r=r||1;for(var o=0;o<=64*r;++o)"x"===e&&i.push(0,Math.cos(o/32*Math.PI)*t,Math.sin(o/32*Math.PI)*t),"y"===e&&i.push(Math.cos(o/32*Math.PI)*t,0,Math.sin(o/32*Math.PI)*t),"z"===e&&i.push(Math.sin(o/32*Math.PI)*t,Math.cos(o/32*Math.PI)*t,0);return n.addAttribute("position",new Gu(i,3)),n};this.handleGizmos={X:[[new Vh(new t(1,"x",.5),new mp({color:16711680}))]],Y:[[new Vh(new t(1,"y",.5),new mp({color:65280}))]],Z:[[new Vh(new t(1,"z",.5),new mp({color:255}))]],E:[[new Vh(new t(1.25,"z",1),new mp({color:13421568}))]],XYZE:[[new Vh(new t(1,"z",1),new mp({color:7895160}))]]},this.pickerGizmos={X:[[new zh(new pp(1,.12,4,12,Math.PI),vp),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new zh(new pp(1,.12,4,12,Math.PI),vp),[0,0,0],[Math.PI/2,0,0]]],Z:[[new zh(new pp(1,.12,4,12,Math.PI),vp),[0,0,0],[0,0,-Math.PI/2]]],E:[[new zh(new pp(1.25,.12,2,24),vp)]],XYZE:[[new zh]]},this.setActivePlane=function(t){"E"===t&&(this.activePlane=this.planes.XYZE),"X"===t&&(this.activePlane=this.planes.YZ),"Y"===t&&(this.activePlane=this.planes.XZ),"Z"===t&&(this.activePlane=this.planes.XY)},this.update=function(t,e){gp.prototype.update.apply(this,arguments);var r=new gu,n=new wu(0,0,1),i=new xu,o=new yu(1,0,0),a=new yu(0,1,0),s=new yu(0,0,1),l=new xu,c=new xu,u=new xu,h=e.clone();n.copy(this.planes.XY.rotation),i.setFromEuler(n),r.makeRotationFromQuaternion(i).getInverse(r),h.applyMatrix4(r),this.traverse(function(t){i.setFromEuler(n),"X"===t.name&&(l.setFromAxisAngle(o,Math.atan2(-h.y,h.z)),i.multiplyQuaternions(i,l),t.quaternion.copy(i)),"Y"===t.name&&(c.setFromAxisAngle(a,Math.atan2(h.x,h.z)),i.multiplyQuaternions(i,c),t.quaternion.copy(i)),"Z"===t.name&&(u.setFromAxisAngle(s,Math.atan2(h.y,h.x)),i.multiplyQuaternions(i,u),t.quaternion.copy(i))})},this.init()};(xp.prototype=Object.create(gp.prototype)).constructor=xp;var bp=function(){gp.call(this);var t=new Iu,e=new zh(new Xh(.125,.125,.125));e.position.y=.5,e.updateMatrix(),t.merge(e.geometry,e.matrix);var r=new Yu;r.addAttribute("position",new Gu([0,0,0,1,0,0],3));var n=new Yu;n.addAttribute("position",new Gu([0,0,0,0,1,0],3));var i=new Yu;i.addAttribute("position",new Gu([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new zh(t,new fp({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new Vh(r,new mp({color:16711680}))]],Y:[[new zh(t,new fp({color:65280})),[0,.5,0]],[new Vh(n,new mp({color:65280}))]],Z:[[new zh(t,new fp({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new Vh(i,new mp({color:255}))]],XYZ:[[new zh(new Yh(.125,.125,.125),new fp({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new zh(new Jh(.2,0,1,4,1,!1),vp),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new zh(new Jh(.2,0,1,4,1,!1),vp),[0,.6,0]]],Z:[[new zh(new Jh(.2,0,1,4,1,!1),vp),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new zh(new Yh(.4,.4,.4),vp)]]},this.setActivePlane=function(t,e){var r=new gu;e.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"===t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"===t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===t&&(this.activePlane=this.planes.XYZE)},this.init()};(bp.prototype=Object.create(gp.prototype)).constructor=bp;var wp=function(t,e){Mu.call(this),e=void 0!==e?e:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var r=this,n="translate",i=!1,o={translate:new yp,rotate:new xp,scale:new bp};for(var a in o){var s=o[a];s.visible=a===n,this.add(s)}var l={type:"change"},c={type:"mouseDown"},u={type:"mouseUp",mode:n},h={type:"objectChange"},d=new Qd,p=new Nu,f=new yu,m=new yu,v=new yu,g=new yu,y=1,x=new gu,b=new yu,w=new gu,_=new yu,S=new xu,T=new yu(1,0,0),M=new yu(0,1,0),A=new yu(0,0,1),E=new xu,C=new xu,P=new xu,O=new xu,N=new xu,L=new yu,I=new yu,R=new gu,D=new gu,F=new yu,U=new yu,k=new wu,B=new gu,j=new yu,z=new wu;function V(t){if(void 0!==r.object&&!0!==i&&(void 0===t.button||0===t.button)){var e=X(t.changedTouches?t.changedTouches[0]:t,o[n].pickers.children),a=null;e&&(a=e.object.name,t.preventDefault()),r.axis!==a&&(r.axis=a,r.update(),r.dispatchEvent(l))}}function G(t){if(void 0!==r.object&&!0!==i&&(void 0===t.button||0===t.button)){var e=t.changedTouches?t.changedTouches[0]:t;if(0===e.button||void 0===e.button){var a=X(e,o[n].pickers.children);if(a){t.preventDefault(),t.stopPropagation(),r.axis=a.object.name,r.dispatchEvent(c),r.update(),b.copy(j).sub(U).normalize(),o[n].setActivePlane(r.axis,b);var s=X(e,[o[n].activePlane]);s&&(L.copy(r.object.position),I.copy(r.object.scale),R.extractRotation(r.object.matrix),B.extractRotation(r.object.matrixWorld),D.extractRotation(r.object.parent.matrixWorld),F.setFromMatrixScale(w.getInverse(r.object.parent.matrixWorld)),m.copy(s.point))}}i=!0}}function H(t){if(void 0!==r.object&&null!==r.axis&&!1!==i&&(void 0===t.button||0===t.button)){var e=X(t.changedTouches?t.changedTouches[0]:t,[o[n].activePlane]);!1!==e&&(t.preventDefault(),t.stopPropagation(),f.copy(e.point),"translate"===n?(f.sub(m),f.multiply(F),"local"===r.space&&(f.applyMatrix4(w.getInverse(B)),-1===r.axis.search("X")&&(f.x=0),-1===r.axis.search("Y")&&(f.y=0),-1===r.axis.search("Z")&&(f.z=0),f.applyMatrix4(R),r.object.position.copy(L),r.object.position.add(f)),"world"!==r.space&&-1===r.axis.search("XYZ")||(-1===r.axis.search("X")&&(f.x=0),-1===r.axis.search("Y")&&(f.y=0),-1===r.axis.search("Z")&&(f.z=0),f.applyMatrix4(w.getInverse(D)),r.object.position.copy(L),r.object.position.add(f)),null!==r.translationSnap&&("local"===r.space&&r.object.position.applyMatrix4(w.getInverse(B)),-1!==r.axis.search("X")&&(r.object.position.x=Math.round(r.object.position.x/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Y")&&(r.object.position.y=Math.round(r.object.position.y/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Z")&&(r.object.position.z=Math.round(r.object.position.z/r.translationSnap)*r.translationSnap),"local"===r.space&&r.object.position.applyMatrix4(B))):"scale"===n?(f.sub(m),f.multiply(F),"local"===r.space&&("XYZ"===r.axis?(y=1+f.y/Math.max(I.x,I.y,I.z),r.object.scale.x=I.x*y,r.object.scale.y=I.y*y,r.object.scale.z=I.z*y):(f.applyMatrix4(w.getInverse(B)),"X"===r.axis&&(r.object.scale.x=I.x*(1+f.x/I.x)),"Y"===r.axis&&(r.object.scale.y=I.y*(1+f.y/I.y)),"Z"===r.axis&&(r.object.scale.z=I.z*(1+f.z/I.z))))):"rotate"===n&&(f.sub(U),f.multiply(F),_.copy(m).sub(U),_.multiply(F),"E"===r.axis?(f.applyMatrix4(w.getInverse(x)),_.applyMatrix4(w.getInverse(x)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(D)),N.setFromAxisAngle(b,v.z-g.z),E.setFromRotationMatrix(B),S.multiplyQuaternions(S,N),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S)):"XYZE"===r.axis?(N.setFromEuler(f.clone().cross(_).normalize()),S.setFromRotationMatrix(w.getInverse(D)),C.setFromAxisAngle(N,-f.clone().angleTo(_)),E.setFromRotationMatrix(B),S.multiplyQuaternions(S,C),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S)):"local"===r.space?(f.applyMatrix4(w.getInverse(B)),_.applyMatrix4(w.getInverse(B)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),E.setFromRotationMatrix(R),null!==r.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/r.rotationSnap)*r.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/r.rotationSnap)*r.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/r.rotationSnap)*r.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),"X"===r.axis&&E.multiplyQuaternions(E,C),"Y"===r.axis&&E.multiplyQuaternions(E,P),"Z"===r.axis&&E.multiplyQuaternions(E,O),r.object.quaternion.copy(E)):"world"===r.space&&(v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(D)),null!==r.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/r.rotationSnap)*r.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/r.rotationSnap)*r.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/r.rotationSnap)*r.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),E.setFromRotationMatrix(B),"X"===r.axis&&S.multiplyQuaternions(S,C),"Y"===r.axis&&S.multiplyQuaternions(S,P),"Z"===r.axis&&S.multiplyQuaternions(S,O),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S))),r.update(),r.dispatchEvent(l),r.dispatchEvent(h))}}function W(t){t.preventDefault(),void 0!==t.button&&0!==t.button||(i&&null!==r.axis&&(u.mode=n,r.dispatchEvent(u)),i=!1,"TouchEvent"in window&&t instanceof TouchEvent?(r.axis=null,r.update(),r.dispatchEvent(l)):V(t))}function X(r,n){var i=e.getBoundingClientRect();p.set((r.clientX-i.left)/i.width*2-1,(r.clientY-i.top)/i.height*-2+1),d.setFromCamera(p,t);var o=d.intersectObjects(n,!0);return!!o[0]&&o[0]}e.addEventListener("mousedown",G,!1),e.addEventListener("touchstart",G,!1),e.addEventListener("mousemove",V,!1),e.addEventListener("touchmove",V,!1),e.addEventListener("mousemove",H,!1),e.addEventListener("touchmove",H,!1),e.addEventListener("mouseup",W,!1),e.addEventListener("mouseout",W,!1),e.addEventListener("touchend",W,!1),e.addEventListener("touchcancel",W,!1),e.addEventListener("touchleave",W,!1),this.dispose=function(){e.removeEventListener("mousedown",G),e.removeEventListener("touchstart",G),e.removeEventListener("mousemove",V),e.removeEventListener("touchmove",V),e.removeEventListener("mousemove",H),e.removeEventListener("touchmove",H),e.removeEventListener("mouseup",W),e.removeEventListener("mouseout",W),e.removeEventListener("touchend",W),e.removeEventListener("touchcancel",W),e.removeEventListener("touchleave",W)},this.attach=function(t){this.object=t,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return n},this.setMode=function(t){for(var e in"scale"===(n=t||n)&&(r.space="local"),o)o[e].visible=e===n;this.update(),r.dispatchEvent(l)},this.setTranslationSnap=function(t){r.translationSnap=t},this.setRotationSnap=function(t){r.rotationSnap=t},this.setSize=function(t){r.size=t,this.update(),r.dispatchEvent(l)},this.setSpace=function(t){r.space=t,this.update(),r.dispatchEvent(l)},this.update=function(){void 0!==r.object&&(r.object.updateMatrixWorld(),U.setFromMatrixPosition(r.object.matrixWorld),k.setFromRotationMatrix(w.extractRotation(r.object.matrixWorld)),t.updateMatrixWorld(),j.setFromMatrixPosition(t.matrixWorld),z.setFromRotationMatrix(w.extractRotation(t.matrixWorld)),y=U.distanceTo(j)/6*r.size,this.position.copy(U),this.scale.set(y,y,y),t instanceof fd?b.copy(j).sub(U).normalize():t instanceof gd&&b.copy(j).normalize(),"local"===r.space?o[n].update(k,b):"world"===r.space&&o[n].update(new wu,b),o[n].highlight(r.axis))}};(wp.prototype=Object.create(Mu.prototype)).constructor=wp;var _p=0;function Sp(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Ep,this.unassigned=new Ep,this.vertices=[]}function Tp(){this.normal=new yu,this.midpoint=new yu,this.area=0,this.constant=0,this.outside=null,this.mark=_p,this.edge=null}function Mp(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function Ap(t){this.point=t,this.prev=null,this.next=null,this.face=null}function Ep(){this.head=null,this.tail=null}function Cp(t){Iu.call(this),this.fromBufferGeometry(new Pp(t)),this.mergeVertices()}function Pp(t){Yu.call(this);var e=[],r=[];void 0===Sp&&console.error("ConvexBufferGeometry: ConvexBufferGeometry relies on QuickHull");for(var n=(new Sp).setFromPoints(t).faces,i=0;i<n.length;i++){var o=n[i],a=o.edge;do{var s=a.head().point;e.push(s.x,s.y,s.z),r.push(o.normal.x,o.normal.y,o.normal.z),a=a.next}while(a!==o.edge)}this.addAttribute("position",new Gu(e,3)),this.addAttribute("normal",new Gu(r,3))}Object.assign(Sp.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("QuickHull: Points parameter is not an array."),t.length<4&&console.error("QuickHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.vertices.push(new Ap(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse(function(t){var r,n,i,o=t.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(r=0,n=a.length;r<n;r++)(i=a[r].clone()).applyMatrix4(t.matrixWorld),e.push(i)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(r=0,n=s.count;r<n;r++)(i=new yu).fromBufferAttribute(s,r).applyMatrix4(t.matrixWorld),e.push(i)}}),this.setFromPoints(e)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(e.outside=null!==t.next&&t.next.face===e?t.next:null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,r=t.outside;null!==r.next&&r.next.face===t;)r=r.next;return this.assigned.removeSubList(e,r),e.prev=r.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var r=this.removeAllVerticesFromFace(t);if(void 0!==r)if(void 0===e)this.unassigned.appendChain(r);else{var n=r;do{var i=n.next;e.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,e):this.unassigned.append(n),n=i}while(null!==n)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var r=e.next,n=this.tolerance,i=null,o=0;o<t.length;o++){var a=t[o];if(a.mark===_p){var s=a.distanceToPoint(e.point);if(s>n&&(n=s,i=a),n>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(e,i),e=r}while(null!==e)}return this},computeExtremes:function(){var t,e,r,n=new yu,i=new yu,o=[],a=[];for(t=0;t<3;t++)o[t]=a[t]=this.vertices[0];for(n.copy(this.vertices[0].point),i.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var s=this.vertices[t],l=s.point;for(r=0;r<3;r++)l.getComponent(r)<n.getComponent(r)&&(n.setComponent(r,l.getComponent(r)),o[r]=s);for(r=0;r<3;r++)l.getComponent(r)>i.getComponent(r)&&(i.setComponent(r,l.getComponent(r)),a[r]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(i.x))+Math.max(Math.abs(n.y),Math.abs(i.y))+Math.max(Math.abs(n.z),Math.abs(i.z))),{min:o,max:a}},computeInitialHull:function(){var t,e,r;return function(){void 0===t&&(t=new kh,e=new Bh,r=new yu);var n,i,o,a,s,l,c,u,h,d=this.vertices,p=this.computeExtremes(),f=p.min,m=p.max,v=0,g=0;for(l=0;l<3;l++)(h=m[l].point.getComponent(l)-f[l].point.getComponent(l))>v&&(v=h,g=l);for(v=0,t.set((i=f[g]).point,(o=m[g]).point),l=0,c=this.vertices.length;l<c;l++)(n=d[l])!==i&&n!==o&&(t.closestPointToPoint(n.point,!0,r),(h=r.distanceToSquared(n.point))>v&&(v=h,a=n));for(v=-1,e.setFromCoplanarPoints(i.point,o.point,a.point),l=0,c=this.vertices.length;l<c;l++)(n=d[l])!==i&&n!==o&&n!==a&&(h=Math.abs(e.distanceToPoint(n.point)))>v&&(v=h,s=n);var y=[];if(e.distanceToPoint(s.point)<0)for(y.push(Tp.create(i,o,a),Tp.create(s,o,i),Tp.create(s,a,o),Tp.create(s,i,a)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge(u)),y[l+1].getEdge(1).setTwin(y[u+1].getEdge(0));else for(y.push(Tp.create(i,a,o),Tp.create(s,i,o),Tp.create(s,o,a),Tp.create(s,a,i)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge((3-l)%3)),y[l+1].getEdge(0).setTwin(y[u+1].getEdge(1));for(l=0;l<4;l++)this.faces.push(y[l]);for(l=0,c=d.length;l<c;l++)if((n=d[l])!==i&&n!==o&&n!==a&&n!==s){v=this.tolerance;var x=null;for(u=0;u<4;u++)(h=this.faces[u].distanceToPoint(n.point))>v&&(v=h,x=this.faces[u]);null!==x&&this.addVertexToFace(n,x)}return this}}(),reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var r=this.faces[e];r.mark===_p&&t.push(r)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,r=this.assigned.first().face,n=r.outside;do{var i=r.distanceToPoint(n.point);i>e&&(e=i,t=n),n=n.next}while(null!==n&&n.face===r);return t}},computeHorizon:function(t,e,r,n){var i;this.deleteFaceVertices(r),r.mark=1,i=null===e?e=r.getEdge(0):e.next;do{var o=i.twin,a=o.face;a.mark===_p&&(a.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,o,a,n):n.push(i)),i=i.next}while(i!==e);return this},addAdjoiningFace:function(t,e){var r=Tp.create(t,e.tail(),e.head());return this.faces.push(r),r.getEdge(-1).setTwin(e.twin),r.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var r=null,n=null,i=0;i<e.length;i++){var o=this.addAdjoiningFace(t,e[i]);null===r?r=o:o.next.setTwin(n),this.newFaces.push(o.face),n=o}return r.next.setTwin(n),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(Tp,{create:function(t,e,r){var n=new Tp,i=new Mp(t,n),o=new Mp(e,n),a=new Mp(r,n);return i.next=a.prev=o,o.next=i.prev=a,a.next=o.prev=i,n.edge=i,n.compute()}}),Object.assign(Tp.prototype,{getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){var t;return function(){void 0===t&&(t=new jh);var e=this.edge.tail(),r=this.edge.head(),n=this.edge.next.head();return t.set(e.point,r.point,n.point),t.getNormal(this.normal),t.getMidpoint(this.midpoint),this.area=t.getArea(),this.constant=this.normal.dot(this.midpoint),this}}(),distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(Mp.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(Ep.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),(Cp.prototype=Object.create(Iu.prototype)).constructor=Cp,(Pp.prototype=Object.create(Yu.prototype)).constructor=Pp;var Op=function(t,e){this.minSizeForBreak=t||1.4,this.smallDelta=e||1e-4,this.tempLine1=new kh,this.tempPlane1=new Bh,this.tempPlane2=new Bh,this.tempCM1=new yu,this.tempCM2=new yu,this.tempVector3=new yu,this.tempVector3_2=new yu,this.tempVector3_3=new yu,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var r=0;r<900;r++)this.segments[r]=!1};function Np(){this.type="Curve",this.arcLengthDivisions=200}function Lp(){Np.call(this)}function Ip(t){Np.call(this),this.scale=void 0===t?5:t}function Rp(t){Np.call(this),this.scale=void 0===t?70:t}function Dp(){Np.call(this)}function Fp(){Np.call(this)}function Up(t){Np.call(this),this.scale=void 0===t?10:t}function kp(t){Np.call(this),this.scale=void 0===t?10:t}function Bp(t){Np.call(this),this.scale=void 0===t?10:t}function jp(t){Np.call(this),this.scale=void 0===t?10:t}function zp(t){Np.call(this),this.scale=void 0===t?1:t}function Vp(t){Np.call(this),this.scale=void 0===t?40:t}function Gp(t){Np.call(this),this.scale=void 0===t?40:t}function Hp(t){Np.call(this),this.scale=void 0===t?40:t}function Wp(t){Np.call(this),this.scale=void 0===t?40:t}Op.prototype={constructor:Op,prepareBreakableObject:function(t,e,r,n,i){for(var o=t.geometry.vertices,a=0,s=o.length;a<s;a++)o[a].mark=0;var l=t.userData;l.mass=e,l.velocity=r.clone(),l.angularVelocity=n.clone(),l.breakable=i},subdivideByImpact:function(t,e,r,n,i,o){var a=[],s=this.tempPlane1,l=this.tempPlane2;this.tempVector3.addVectors(e,r),s.setFromCoplanarPoints(e,t.position,this.tempVector3);var c=i+n,u=this;return function i(o,h,d,p){if(Math.random()<.05*p||p>c)a.push(o);else{var f=Math.PI;0===p?(l.normal.copy(s.normal),l.constant=s.constant):p<=n?(f=(d-h)*(.2+.6*Math.random())+h,u.tempVector3_2.copy(t.position).sub(e).applyAxisAngle(r,f).add(e),l.setFromCoplanarPoints(e,u.tempVector3,u.tempVector3_2)):(f=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(e).sub(o.position).applyAxisAngle(r,f).add(o.position),u.tempVector3_3.copy(r).add(o.position),l.setFromCoplanarPoints(o.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(o,l,u.tempResultObjects);var m=u.tempResultObjects.object1,v=u.tempResultObjects.object2;m&&i(m,h,f,p+1),v&&i(v,f,d,p+1)}}(t,0,2*Math.PI,0),a},cutByPlane:function(t,e,r){for(var n=t.geometry,i=n.vertices,o=n.faces,a=i.length,s=[],l=[],c=this.smallDelta,u=0;u<a;u++)i[u].mark=0;var h=a*a;for(u=0;u<h;u++)this.segments[u]=!1;u=0;for(var d=o.length-1;u<d;u++)for(var p=o[u],f=u+1,m=o.length;f<m;f++){var v=o[f];if(1-p.normal.dot(v.normal)<c){var g=p.a,y=p.b,x=p.c,b=v.a,w=v.b,_=v.c;g===b||g===w||g===_?y===b||y===w||y===_?(this.segments[g*a+y]=!0,this.segments[y*a+g]=!0):(this.segments[x*a+g]=!0,this.segments[g*a+x]=!0):y!==b&&y!==w&&y!==_||(this.segments[x*a+y]=!0,this.segments[y*a+x]=!0)}}var S=this.tempPlane1;for(t.updateMatrix(),Op.transformPlaneToLocalSpace(e,t.matrix,S),u=0,d=o.length;u<d;u++)for(var T=o[u],M=0;M<3;M++){var A=0===M?T.a:1===M?T.b:T.c,E=0===M?T.b:1===M?T.c:T.a;if(!this.segments[A*a+E]){this.segments[A*a+E]=!0,this.segments[E*a+A]=!0;var C,P=i[A],O=i[E];if(0===P.mark)if((C=S.distanceToPoint(P))>c)P.mark=2,l.push(P);else if(C<-c)P.mark=1,s.push(P);else{P.mark=3,s.push(P);var N=P.clone();N.mark=3,l.push(N)}if(0===O.mark)if((C=S.distanceToPoint(O))>c)O.mark=2,l.push(O);else if(C<-c)O.mark=1,s.push(O);else{O.mark=3,s.push(O);var L=O.clone();L.mark=3,l.push(L)}var I=P.mark,R=O.mark;if(1===I&&2===R||2===I&&1===R){this.tempLine1.start.copy(P),this.tempLine1.end.copy(O);var D=S.intersectLine(this.tempLine1);if(void 0===D)return console.error("Internal error: segment does not intersect plane."),r.segmentedObject1=null,r.segmentedObject2=null,0;D.mark=1,s.push(D);var F=D.clone();F.mark=2,l.push(F)}}}var U=.5*t.userData.mass;this.tempCM1.set(0,0,0);var k=0,B=s.length;if(B>0){for(u=0;u<B;u++)this.tempCM1.add(s[u]);for(this.tempCM1.divideScalar(B),u=0;u<B;u++)(V=s[u]).sub(this.tempCM1),k=Math.max(k,V.x,V.y,V.z);this.tempCM1.add(t.position)}this.tempCM2.set(0,0,0);var j=0,z=l.length;if(z>0){for(u=0;u<z;u++)this.tempCM2.add(l[u]);for(this.tempCM2.divideScalar(z),u=0;u<z;u++){var V;(V=l[u]).sub(this.tempCM2),j=Math.max(j,V.x,V.y,V.z)}this.tempCM2.add(t.position)}var G=null,H=null,W=0;return B>4&&((G=new zh(new Cp(s),t.material)).position.copy(this.tempCM1),G.quaternion.copy(t.quaternion),this.prepareBreakableObject(G,U,t.userData.velocity,t.userData.angularVelocity,2*k>this.minSizeForBreak),W++),z>4&&((H=new zh(new Cp(l),t.material)).position.copy(this.tempCM2),H.quaternion.copy(t.quaternion),this.prepareBreakableObject(H,U,t.userData.velocity,t.userData.angularVelocity,2*j>this.minSizeForBreak),W++),r.object1=G,r.object2=H,W}},Op.transformFreeVector=function(t,e){var r=t.x,n=t.y,i=t.z,o=e.elements;return t.x=o[0]*r+o[4]*n+o[8]*i,t.y=o[1]*r+o[5]*n+o[9]*i,t.z=o[2]*r+o[6]*n+o[10]*i,t},Op.transformFreeVectorInverse=function(t,e){var r=t.x,n=t.y,i=t.z,o=e.elements;return t.x=o[0]*r+o[1]*n+o[2]*i,t.y=o[4]*r+o[5]*n+o[6]*i,t.z=o[8]*r+o[9]*n+o[10]*i,t},Op.transformTiedVectorInverse=function(t,e){var r=t.x,n=t.y,i=t.z,o=e.elements;return t.x=o[0]*r+o[1]*n+o[2]*i-o[12],t.y=o[4]*r+o[5]*n+o[6]*i-o[13],t.z=o[8]*r+o[9]*n+o[10]*i-o[14],t},Op.transformPlaneToLocalSpace=function(){var t=new yu;return new Su,function(e,r,n){n.normal.copy(e.normal),n.constant=e.constant;var i=Op.transformTiedVectorInverse(e.coplanarPoint(t),r);Op.transformFreeVectorInverse(n.normal,r),n.constant=-i.dot(n.normal)}}(),Object.assign(Np.prototype,{getPoint:function(){return console.warn("Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=t;r++)o+=(e=this.getPoint(r/t)).distanceTo(i),n.push(o),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,o=n.length;r=e||t*n[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=n[i=Math.floor(s+(l-s)/2)]-r)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(o-1);var c=n[i];return(i+(r-c)/(n[i+1]-c))/(o-1)},getTangent:function(t){var e=t-1e-4,r=t+1e-4;e<0&&(e=0),r>1&&(r=1);var n=this.getPoint(e);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,n,i=new yu,o=[],a=[],s=[],l=new yu,c=new gu;for(r=0;r<=t;r++)o[r]=this.getTangentAt(r/t),o[r].normalize();a[0]=new yu,s[0]=new yu;var u=Number.MAX_VALUE,h=Math.abs(o[0].x),d=Math.abs(o[0].y),p=Math.abs(o[0].z);for(h<=u&&(u=h,i.set(1,0,0)),d<=u&&(u=d,i.set(0,1,0)),p<=u&&i.set(0,0,1),l.crossVectors(o[0],i).normalize(),a[0].crossVectors(o[0],l),s[0].crossVectors(o[0],a[0]),r=1;r<=t;r++)a[r]=a[r-1].clone(),s[r]=s[r-1].clone(),l.crossVectors(o[r-1],o[r]),l.length()>Number.EPSILON&&(l.normalize(),n=Math.acos(vu.clamp(o[r-1].dot(o[r]),-1,1)),a[r].applyMatrix4(c.makeRotationAxis(l,n))),s[r].crossVectors(o[r],a[r]);if(!0===e)for(n=Math.acos(vu.clamp(a[0].dot(a[t]),-1,1)),n/=t,o[0].dot(l.crossVectors(a[0],a[t]))>0&&(n=-n),r=1;r<=t;r++)a[r].applyMatrix4(c.makeRotationAxis(o[r],n*r)),s[r].crossVectors(o[r],a[r]);return{tangents:o,normals:a,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),(Lp.prototype=Object.create(Np.prototype)).constructor=Lp,Lp.prototype.getPoint=function(t,e){var r=e||new yu;t=2*Math.PI*t;var n=-.22*Math.cos(t)-1.28*Math.sin(t)-.44*Math.cos(3*t)-.78*Math.sin(3*t),i=-.1*Math.cos(2*t)-.27*Math.sin(2*t)+.38*Math.cos(4*t)+.46*Math.sin(4*t),o=.7*Math.cos(3*t)-.4*Math.sin(3*t);return r.set(n,i,o).multiplyScalar(20)},(Ip.prototype=Object.create(Np.prototype)).constructor=Ip,Ip.prototype.getPoint=function(t,e){var r=e||new yu;t*=2*Math.PI;var n=16*Math.pow(Math.sin(t),3),i=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);return r.set(n,i,0).multiplyScalar(this.scale)},(Rp.prototype=Object.create(Np.prototype)).constructor=Rp,Rp.prototype.getPoint=function(t,e){var r=e||new yu;t=4*t*Math.PI;var n=this.scale/2,i=n*(1+Math.cos(t)),o=n*Math.sin(t),a=2*n*Math.sin(t/2);return r.set(i,o,a)},(Dp.prototype=Object.create(Np.prototype)).constructor=Dp,Dp.prototype.getPoint=function(t,e){var r=e||new yu;t*=2*Math.PI;var n=50*Math.sin(t),i=Math.cos(t)*(10+50*Math.cos(t)),o=Math.sin(t)*(10+50*Math.cos(t));return r.set(n,i,o)},(Fp.prototype=Object.create(Np.prototype)).constructor=Fp,Fp.prototype.getPoint=function(t,e){var r=e||new yu,n=2*Math.PI*t*150/30,i=30*Math.cos(n),o=30*Math.sin(n);return r.set(i,o,150*t)},(Up.prototype=Object.create(Np.prototype)).constructor=Up,Up.prototype.getPoint=function(t,e){var r=e||new yu;t*=2*Math.PI;var n=(2+Math.cos(3*t))*Math.cos(2*t),i=(2+Math.cos(3*t))*Math.sin(2*t),o=Math.sin(3*t);return r.set(n,i,o).multiplyScalar(this.scale)},(kp.prototype=Object.create(Np.prototype)).constructor=kp,kp.prototype.getPoint=function(t,e){var r=e||new yu;t*=2*Math.PI;var n=(2+Math.cos(4*t))*Math.cos(3*t),i=(2+Math.cos(4*t))*Math.sin(3*t),o=Math.sin(4*t);return r.set(n,i,o).multiplyScalar(this.scale)},(Bp.prototype=Object.create(Np.prototype)).constructor=Bp,Bp.prototype.getPoint=function(t,e){var r=e||new yu;t*=2*Math.PI;var n=(2+Math.cos(5*t))*Math.cos(2*t),i=(2+Math.cos(5*t))*Math.sin(2*t),o=Math.sin(5*t);return r.set(n,i,o).multiplyScalar(this.scale)},(jp.prototype=Object.create(Np.prototype)).constructor=jp,jp.prototype.getPoint=function(t,e){var r=e||new yu;t=4*t-2;var n=Math.pow(t,3)-3*t,i=Math.pow(t,4)-4*t*t,o=.2*Math.pow(t,5)-2*t;return r.set(n,i,o).multiplyScalar(this.scale)},(zp.prototype=Object.create(Np.prototype)).constructor=zp,zp.prototype.getPoint=function(t,e){var r=e||new yu,n=.4*(t=function(t,e,r){return 8*r-4}(0,0,t))*(t*t-7)*(t*t-10),i=Math.pow(t,4)-13*t*t;return r.set(n,i,.1*t*(t*t-4)*(t*t-9)*(t*t-12)).multiplyScalar(this.scale)},(Vp.prototype=Object.create(Np.prototype)).constructor=Vp,Vp.prototype.getPoint=function(t,e){var r=e||new yu;t*=2*Math.PI;var n=Math.cos(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),i=Math.sin(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),o=.35*Math.sin(5*t);return r.set(n,i,o).multiplyScalar(this.scale)},(Gp.prototype=Object.create(Np.prototype)).constructor=Gp,Gp.prototype.getPoint=function(t,e){var r=e||new yu,n=t*Math.PI*2,i=Math.cos(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),o=Math.sin(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),a=.2*Math.sin(9*n);return r.set(i,o,a).multiplyScalar(this.scale)},(Hp.prototype=Object.create(Np.prototype)).constructor=Hp,Hp.prototype.getPoint=function(t,e){var r=e||new yu,n=t*Math.PI*2,i=Math.cos(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),o=Math.sin(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),a=.2*Math.sin(20*n);return r.set(i,o,a).multiplyScalar(this.scale)},(Wp.prototype=Object.create(Np.prototype)).constructor=Wp,Wp.prototype.getPoint=function(t,e){var r=e||new yu,n=t*Math.PI*2,i=Math.cos(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),o=Math.sin(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),a=.35*Math.sin(15*n);return r.set(i,o,a).multiplyScalar(this.scale)};var Xp={findSpan:function(t,e,r){var n=r.length-t-1;if(e>=r[n])return n-1;if(e<=r[t])return t;for(var i=t,o=n,a=Math.floor((i+o)/2);e<r[a]||e>=r[a+1];)e<r[a]?o=a:i=a,a=Math.floor((i+o)/2);return a},calcBasisFunctions:function(t,e,r,n){var i=[],o=[],a=[];i[0]=1;for(var s=1;s<=r;++s){o[s]=e-n[t+1-s],a[s]=n[t+s]-e;for(var l=0,c=0;c<s;++c){var u=a[c+1],h=o[s-c],d=i[c]/(u+h);i[c]=l+u*d,l=h*d}i[s]=l}return i},calcBSplinePoint:function(t,e,r,n){for(var i=this.findSpan(t,n,e),o=this.calcBasisFunctions(i,n,t,e),a=new Ru(0,0,0,0),s=0;s<=t;++s){var l=r[i-t+s],c=o[s],u=l.w*c;a.x+=l.x*u,a.y+=l.y*u,a.z+=l.z*u,a.w+=l.w*c}return a},calcBasisFunctionDerivatives:function(t,e,r,n,i){for(var o=[],a=0;a<=r;++a)o[a]=0;var s=[];for(a=0;a<=n;++a)s[a]=o.slice(0);var l=[];for(a=0;a<=r;++a)l[a]=o.slice(0);l[0][0]=1;for(var c=o.slice(0),u=o.slice(0),h=1;h<=r;++h){c[h]=e-i[t+1-h],u[h]=i[t+h]-e;for(var d=0,p=0;p<h;++p){var f=u[p+1],m=c[h-p];l[h][p]=f+m;var v=l[p][h-1]/l[h][p];l[p][h]=d+f*v,d=m*v}l[h][h]=d}for(h=0;h<=r;++h)s[0][h]=l[h][r];for(p=0;p<=r;++p){var g=0,y=1,x=[];for(a=0;a<=r;++a)x[a]=o.slice(0);x[0][0]=1;for(var b=1;b<=n;++b){var w=0,_=p-b,S=r-b;p>=b&&(x[y][0]=x[g][0]/l[S+1][_],w=x[y][0]*l[_][S]);var T=p-1<=S?b-1:r-p;for(h=_>=-1?1:-_;h<=T;++h)x[y][h]=(x[g][h]-x[g][h-1])/l[S+1][_+h],w+=x[y][h]*l[_+h][S];p<=S&&(x[y][b]=-x[g][b-1]/l[S+1][p],w+=x[y][b]*l[p][S]),s[b][p]=w,h=g,g=y,y=h}}for(p=r,b=1;b<=n;++b){for(h=0;h<=r;++h)s[b][h]*=p;p*=r-b}return s},calcBSplineDerivatives:function(t,e,r,n,i){for(var o=i<t?i:t,a=[],s=this.findSpan(t,n,e),l=this.calcBasisFunctionDerivatives(s,n,t,o,e),c=[],u=0;u<r.length;++u){var h=(p=r[u].clone()).w;p.x*=h,p.y*=h,p.z*=h,c[u]=p}for(var d=0;d<=o;++d){for(var p=c[s-t].clone().multiplyScalar(l[d][0]),f=1;f<=t;++f)p.add(c[s-t+f].clone().multiplyScalar(l[d][f]));a[d]=p}for(d=o+1;d<=i+1;++d)a[d]=new Ru(0,0,0);return a},calcKoverI:function(t,e){for(var r=1,n=2;n<=t;++n)r*=n;var i=1;for(n=2;n<=e;++n)i*=n;for(n=2;n<=t-e;++n)i*=n;return r/i},calcRationalCurveDerivatives:function(t){for(var e=t.length,r=[],n=[],i=0;i<e;++i){var o=t[i];r[i]=new yu(o.x,o.y,o.z),n[i]=o.w}for(var a=[],s=0;s<e;++s){var l=r[s].clone();for(i=1;i<=s;++i)l.sub(a[s-i].clone().multiplyScalar(this.calcKoverI(s,i)*n[i]));a[s]=l.divideScalar(n[0])}return a},calcNURBSDerivatives:function(t,e,r,n,i){var o=this.calcBSplineDerivatives(t,e,r,n,i);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(t,e,r,n,i,o,a){for(var s=this.findSpan(t,o,r),l=this.findSpan(e,a,n),c=this.calcBasisFunctions(s,o,t,r),u=this.calcBasisFunctions(l,a,e,n),h=[],d=0;d<=e;++d){h[d]=new Ru(0,0,0,0);for(var p=0;p<=t;++p){var f=i[s-t+p][l-e+d].clone(),m=f.w;f.x*=m,f.y*=m,f.z*=m,h[d].add(f.multiplyScalar(c[p]))}}var v=new Ru(0,0,0,0);for(d=0;d<=e;++d)v.add(h[d].multiplyScalar(u[d]));return v.divideScalar(v.w),new yu(v.x,v.y,v.z)}},Yp=function(t,e,r,n,i){Np.call(this),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=n||0,this.endKnot=i||this.knots.length-1;for(var o=0;o<r.length;++o){var a=r[o];this.controlPoints[o]=new Ru(a.x,a.y,a.z,a.w)}};Yp.prototype=Object.create(Np.prototype),Yp.prototype.constructor=Yp,Yp.prototype.getPoint=function(t){var e=Xp.calcBSplinePoint(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!=e.w&&e.divideScalar(e.w),new yu(e.x,e.y,e.z)},Yp.prototype.getTangent=function(t){var e=Xp.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),1)[1].clone();return e.normalize(),e};var qp=function(t,e,r,n,i){this.degree1=t,this.degree2=e,this.knots1=r,this.knots2=n,this.controlPoints=[];for(var o=r.length-t-1,a=n.length-e-1,s=0;s<o;++s){this.controlPoints[s]=[];for(var l=0;l<a;++l){var c=i[s][l];this.controlPoints[s][l]=new Ru(c.x,c.y,c.z,c.w)}}};qp.prototype={constructor:qp,getPoint:function(t,e){return Xp.calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,this.knots1[0]+t*(this.knots1[this.knots1.length-1]-this.knots1[0]),this.knots2[0]+e*(this.knots2[this.knots2.length-1]-this.knots2[0]))}};var Jp={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(t){var e,r,n;e=void 0!==(t=t||{}).parent?t.parent:document.body,r=void 0!==t.id?t.id:"oldie",(n=Jp.getWebGLErrorMessage()).id=r,e.appendChild(n)}};Object.assign((function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new fd,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new fd,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}).prototype,{update:function(){var t,e,r,n,i,o,a,s,l=new gu,c=new gu;return function(u){if(t!==this||e!==u.focus||r!==u.fov||n!==u.aspect*this.aspect||i!==u.near||o!==u.far||a!==u.zoom||s!==this.eyeSep){t=this,e=u.focus,r=u.fov,n=u.aspect*this.aspect,i=u.near,o=u.far,a=u.zoom;var h,d,p=u.projectionMatrix.clone(),f=(s=this.eyeSep/2)*i/e,m=i*Math.tan(vu.DEG2RAD*r*.5)/a;c.elements[12]=-s,l.elements[12]=s,p.elements[0]=2*i/((d=m*n+f)-(h=-m*n+f)),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),p.elements[0]=2*i/((d=m*n-f)-(h=-m*n-f)),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()});var Zp={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit(  ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit(  );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance(  const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance(  const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance(  geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance(  geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance(  geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},Qp={common:{diffuse:{value:new Eu(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Su},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Nu(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Eu(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Eu(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Su}}},Kp={basic:{uniforms:wd.merge([Qp.common,Qp.specularmap,Qp.envmap,Qp.aomap,Qp.lightmap,Qp.fog]),vertexShader:Zp.meshbasic_vert,fragmentShader:Zp.meshbasic_frag},lambert:{uniforms:wd.merge([Qp.common,Qp.specularmap,Qp.envmap,Qp.aomap,Qp.lightmap,Qp.emissivemap,Qp.fog,Qp.lights,{emissive:{value:new Eu(0)}}]),vertexShader:Zp.meshlambert_vert,fragmentShader:Zp.meshlambert_frag},phong:{uniforms:wd.merge([Qp.common,Qp.specularmap,Qp.envmap,Qp.aomap,Qp.lightmap,Qp.emissivemap,Qp.bumpmap,Qp.normalmap,Qp.displacementmap,Qp.gradientmap,Qp.fog,Qp.lights,{emissive:{value:new Eu(0)},specular:{value:new Eu(1118481)},shininess:{value:30}}]),vertexShader:Zp.meshphong_vert,fragmentShader:Zp.meshphong_frag},standard:{uniforms:wd.merge([Qp.common,Qp.envmap,Qp.aomap,Qp.lightmap,Qp.emissivemap,Qp.bumpmap,Qp.normalmap,Qp.displacementmap,Qp.roughnessmap,Qp.metalnessmap,Qp.fog,Qp.lights,{emissive:{value:new Eu(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Zp.meshphysical_vert,fragmentShader:Zp.meshphysical_frag},points:{uniforms:wd.merge([Qp.points,Qp.fog]),vertexShader:Zp.points_vert,fragmentShader:Zp.points_frag},dashed:{uniforms:wd.merge([Qp.common,Qp.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Zp.linedashed_vert,fragmentShader:Zp.linedashed_frag},depth:{uniforms:wd.merge([Qp.common,Qp.displacementmap]),vertexShader:Zp.depth_vert,fragmentShader:Zp.depth_frag},normal:{uniforms:wd.merge([Qp.common,Qp.bumpmap,Qp.normalmap,Qp.displacementmap,{opacity:{value:1}}]),vertexShader:Zp.normal_vert,fragmentShader:Zp.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Zp.cube_vert,fragmentShader:Zp.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Zp.equirect_vert,fragmentShader:Zp.equirect_frag},distanceRGBA:{uniforms:wd.merge([Qp.common,Qp.displacementmap,{referencePosition:{value:new yu},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Zp.distanceRGBA_vert,fragmentShader:Zp.distanceRGBA_frag},shadow:{uniforms:wd.merge([Qp.lights,Qp.fog,{color:{value:new Eu(0)},opacity:{value:1}}]),vertexShader:Zp.shadow_vert,fragmentShader:Zp.shadow_frag}};function $p(t,e,r){var n=r||tf.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function tf(t,e,r){this.path=e,this.parsedPath=r||tf.parseTrackName(e),this.node=tf.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Kp.physical={uniforms:wd.merge([Kp.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Zp.meshphysical_vert,fragmentShader:Zp.meshphysical_frag},Object.assign($p.prototype,{getValue:function(t,e){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(tf,{Composite:$p,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new tf.Composite(t,e,r):new tf(t,e,r)},sanitizeNodeName:function(){var t=new RegExp("[\\[\\]\\.:\\/]","g");return function(e){return e.replace(/\s/g,"_").replace(t,"")}}(),parseTrackName:function(){var t="[^\\[\\]\\.:\\/]",e="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",t),n=/(WCOD+)?/.source.replace("WCOD",e),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t),a=new RegExp("^"+r+n+i+o+"$"),s=["material","materials","bones"];return function(t){var e=a.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==s.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}}(),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var o=n(i.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(tf.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=tf.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[r])return void console.error("PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var s=t[n];if(void 0!==s){var l=this.Versioning.None;void 0!==t.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!t.geometry.morphTargets)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===i){i=a;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else console.error("PropertyBinding: Trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t)}else console.error("PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(tf.prototype,{_getValue_unbound:tf.prototype.getValue,_setValue_unbound:tf.prototype.setValue});var ef={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},rf={1003:ef.NEAREST,1004:ef.NEAREST_MIPMAP_NEAREST,1005:ef.NEAREST_MIPMAP_LINEAR,1006:ef.LINEAR,1007:ef.LINEAR_MIPMAP_NEAREST,1008:ef.LINEAR_MIPMAP_LINEAR},nf={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},of=function(){};of.prototype={constructor:of,parse:function(t,e,r){(r=Object.assign({},{trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1},r)).animations.length>0&&(r.trs=!0);var n,i={asset:{version:"2.0",generator:"GLTFExporter"}},o=0,a=[],s=[],l=new Map,c=[],u={},h={materials:new Map,textures:new Map};function d(t,e){return t.length===e.length&&t.every(function(t,r){return t===e[r]})}function p(t){return 4*Math.ceil(t/4)}function f(t,e){e=e||0;var r=p(t.byteLength);if(r!==t.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(t)),0!==e)for(var i=t.byteLength;i<r;i++)n[i]=e;return n.buffer}return t}function m(t){return i.buffers||(i.buffers=[{byteLength:0}]),a.push(t),0}function v(t,e,n,a){var s;if(i.accessors||(i.accessors=[]),t.array.constructor===Float32Array)s=ef.FLOAT;else if(t.array.constructor===Uint32Array)s=ef.UNSIGNED_INT;else{if(t.array.constructor!==Uint16Array)throw new Error("GLTFExporter: Unsupported bufferAttribute component type.");s=ef.UNSIGNED_SHORT}if(void 0===n&&(n=0),void 0===a&&(a=t.count),r.truncateDrawRange&&void 0!==e&&null===e.index){var l=n+a,c=e.drawRange.count===1/0?t.count:e.drawRange.start+e.drawRange.count;n=Math.max(n,e.drawRange.start),(a=Math.min(l,c)-n)<0&&(a=0)}var u,h=function(t,e,r){for(var n={min:new Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)},i=e;i<e+r;i++)for(var o=0;o<t.itemSize;o++){var a=t.array[i*t.itemSize+o];n.min[o]=Math.min(n.min[o],a),n.max[o]=Math.max(n.max[o],a)}return n}(t,n,a);void 0!==e&&(u=t===e.index?ef.ELEMENT_ARRAY_BUFFER:ef.ARRAY_BUFFER);var d=function(t,e,r,n,a){i.bufferViews||(i.bufferViews=[]);for(var s=e===ef.UNSIGNED_SHORT?2:4,l=p(n*t.itemSize*s),c=new DataView(new ArrayBuffer(l)),u=0,h=r;h<r+n;h++)for(var d=0;d<t.itemSize;d++){var f=t.array[h*t.itemSize+d];e===ef.FLOAT?c.setFloat32(u,f,!0):e===ef.UNSIGNED_INT?c.setUint32(u,f,!0):e===ef.UNSIGNED_SHORT&&c.setUint16(u,f,!0),u+=s}var v={buffer:m(c.buffer),byteOffset:o,byteLength:l};return void 0!==a&&(v.target=a),a===ef.ARRAY_BUFFER&&(v.byteStride=t.itemSize*s),o+=l,i.bufferViews.push(v),{id:i.bufferViews.length-1,byteLength:0}}(t,s,n,a,u);return i.accessors.push({bufferView:d.id,byteOffset:d.byteOffset,componentType:s,count:a,max:h.max,min:h.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[t.itemSize]}),i.accessors.length-1}function g(t){if(h.textures.has(t))return h.textures.get(t);i.textures||(i.textures=[]);var e={sampler:function(t){return i.samplers||(i.samplers=[]),i.samplers.push({magFilter:rf[t.magFilter],minFilter:rf[t.minFilter],wrapS:rf[t.wrapS],wrapT:rf[t.wrapT]}),i.samplers.length-1}(t),source:function(t){i.images||(i.images=[]);var e=t.format===wh?"image/png":"image/jpeg",a={mimeType:e};if(r.embedImages){var l=n=n||document.createElement("canvas");l.width=t.image.width,l.height=t.image.height,r.forcePowerOfTwoTextures&&!function(t){return vu.isPowerOfTwo(t.width)&&vu.isPowerOfTwo(t.height)}(t.image)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",t.image),l.width=vu.floorPowerOfTwo(l.width),l.height=vu.floorPowerOfTwo(l.height));var c=l.getContext("2d");!0===t.flipY&&(c.translate(0,l.height),c.scale(1,-1)),c.drawImage(t.image,0,0,l.width,l.height),!0===r.binary?s.push(new Promise(function(t){l.toBlob(function(e){(function(t){return i.bufferViews||(i.bufferViews=[]),new Promise(function(e){var r=new window.FileReader;r.readAsArrayBuffer(t),r.onloadend=function(){var t=f(r.result),n={buffer:m(t),byteOffset:o,byteLength:t.byteLength};o+=t.byteLength,i.bufferViews.push(n),e(i.bufferViews.length-1)}})})(e).then(function(e){a.bufferView=e,t()})},e)})):a.uri=l.toDataURL(e)}else a.uri=t.image.src;return i.images.push(a),i.images.length-1}(t)};i.textures.push(e);var a=i.textures.length-1;return h.textures.set(t,a),a}function y(t){if(h.materials.has(t))return h.materials.get(t);if(i.materials||(i.materials=[]),t.isShaderMaterial)return console.warn("GLTFExporter: ShaderMaterial not supported."),null;var e={pbrMetallicRoughness:{}};t.isMeshBasicMaterial?(e.extensions={KHR_materials_unlit:{}},u.KHR_materials_unlit=!0):t.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=t.color.toArray().concat([t.opacity]);if(d(r,[1,1,1,1])||(e.pbrMetallicRoughness.baseColorFactor=r),t.isMeshStandardMaterial?(e.pbrMetallicRoughness.metallicFactor=t.metalness,e.pbrMetallicRoughness.roughnessFactor=t.roughness):t.isMeshBasicMaterial?(e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9):(e.pbrMetallicRoughness.metallicFactor=.5,e.pbrMetallicRoughness.roughnessFactor=.5),(t.metalnessMap||t.roughnessMap)&&(t.metalnessMap===t.roughnessMap?e.pbrMetallicRoughness.metallicRoughnessTexture={index:g(t.metalnessMap)}:console.warn("GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.")),t.map&&(e.pbrMetallicRoughness.baseColorTexture={index:g(t.map)}),t.isMeshBasicMaterial||t.isLineBasicMaterial||t.isPointsMaterial);else{var n=t.emissive.clone().multiplyScalar(t.emissiveIntensity).toArray();d(n,[0,0,0])||(e.emissiveFactor=n),t.emissiveMap&&(e.emissiveTexture={index:g(t.emissiveMap)})}t.normalMap&&(e.normalTexture={index:g(t.normalMap)},-1!==t.normalScale.x&&(t.normalScale.x!==t.normalScale.y&&console.warn("GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),e.normalTexture.scale=t.normalScale.x)),t.aoMap&&(e.occlusionTexture={index:g(t.aoMap)},1!==t.aoMapIntensity&&(e.occlusionTexture.strength=t.aoMapIntensity)),(t.transparent||t.alphaTest>0)&&(e.alphaMode=t.opacity<1?"BLEND":"MASK",t.alphaTest>0&&.5!==t.alphaTest&&(e.alphaCutoff=t.alphaTest)),t.side===Ku&&(e.doubleSided=!0),""!==t.name&&(e.name=t.name),i.materials.push(e);var o=i.materials.length-1;return h.materials.set(t,o),o}function x(t,e){i.animations||(i.animations=[]);for(var r=[],n=[],o=0;o<t.tracks.length;++o){var a=t.tracks[o],s=tf.parseTrackName(a.name),c=tf.findNode(e,s.nodeName),u=nf[s.propertyName];if("bones"===s.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(s.objectIndex):void 0),!c||!u)return console.warn('GLTFExporter: Could not export animation track "%s".',a.name),null;var h,d=a.values.length/a.times.length;u===nf.morphTargetInfluences&&(d/=c.morphTargetInfluences.length),!0===a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=a.getInterpolation()===Ah?"STEP":"LINEAR",n.push({input:v(new Du(a.times,1)),output:v(new Du(a.values,d)),interpolation:h}),r.push({sampler:n.length-1,target:{node:l.get(c),path:u}})}return i.animations.push({name:t.name||"clip_"+i.animations.length,samplers:n,channels:r}),i.animations.length-1}function b(t){var e=i.nodes[l.get(t)],r=t.skeleton,n=t.skeleton.bones[0];if(void 0===n)return null;for(var o=[],a=new Float32Array(16*r.bones.length),s=0;s<r.bones.length;++s)o.push(l.get(r.bones[s])),r.boneInverses[s].toArray(a,16*s);return void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:v(new Du(a,16)),joints:o,skeleton:l.get(n)}),e.skin=i.skins.length-1}function w(t){if(t.isLight)return console.warn("GLTFExporter: Unsupported node type:",t.constructor.name),null;i.nodes||(i.nodes=[]);var e={};if(r.trs){var n=t.quaternion.toArray(),o=t.position.toArray(),a=t.scale.toArray();d(n,[0,0,0,1])||(e.rotation=n),d(o,[0,0,0])||(e.translation=o),d(a,[1,1,1])||(e.scale=a)}else t.updateMatrix(),d(t.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(e.matrix=t.matrix.elements);if(""!==t.name&&(e.name=String(t.name)),t.userData&&Object.keys(t.userData).length>0)try{e.extras=JSON.parse(JSON.stringify(t.userData))}catch(t){throw new Error("GLTFExporter: userData can't be serialized")}if(t.isMesh||t.isLine||t.isPoints?e.mesh=function(t){i.meshes||(i.meshes=[]);var e,n=t.geometry;if(t.isLineSegments)e=ef.LINES;else if(t.isLineLoop)e=ef.LINE_LOOP;else if(t.isLine)e=ef.LINE_STRIP;else if(t.isPoints)e=ef.POINTS;else{if(!n.isBufferGeometry){var o=new Yu;o.fromGeometry(n),n=o}t.drawMode===Oh?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),e=ef.TRIANGLE_FAN):e=t.drawMode===Ph?t.material.wireframe?ef.LINE_STRIP:ef.TRIANGLE_STRIP:t.material.wireframe?ef.LINES:ef.TRIANGLES}var a={},s={},l=[],c=[],u={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"};for(var h in n.attributes){var d=n.attributes[h];"MORPH"!==(h=u[h]||h.toUpperCase()).substr(0,5)&&(s[h]=v(d,n))}if(void 0!==t.morphTargetInfluences&&t.morphTargetInfluences.length>0){var p=[],f=[],m={};if(void 0!==t.morphTargetDictionary)for(var g in t.morphTargetDictionary)m[t.morphTargetDictionary[g]]=g;for(var x=0;x<t.morphTargetInfluences.length;++x){var b={},w=!1;for(var h in n.morphAttributes)if("position"===h||"normal"===h){for(var _=n.attributes[h],S=(d=n.morphAttributes[h][x]).clone(),T=0,M=d.count;T<M;T++)S.setXYZ(T,d.getX(T)-_.getX(T),d.getY(T)-_.getY(T),d.getZ(T)-_.getZ(T));b[h.toUpperCase()]=v(S,n)}else w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);c.push(b),p.push(t.morphTargetInfluences[x]),void 0!==t.morphTargetDictionary&&f.push(m[x])}a.weights=p,f.length>0&&(a.extras={},a.extras.targetNames=f)}var A=r.forceIndices,E=Array.isArray(t.material);!A&&null===n.index&&E&&(console.warn("GLTFExporter: Creating index for non-indexed multi-material mesh."),A=!0);var C=!1;if(null===n.index&&A){for(var P=[],O=(x=0,n.attributes.position.count);x<O;x++)P[x]=x;n.setIndex(P),C=!0}var N=E?t.material:[t.material],L=E?t.geometry.groups:[{materialIndex:0,start:void 0,count:void 0}];for(x=0,O=L.length;x<O;x++){var I={mode:e,attributes:s};c.length>0&&(I.targets=c);var R=y(N[L[x].materialIndex]);null!==R&&(I.material=R),null!==n.index&&(I.indices=v(n.index,n,L[x].start,L[x].count)),l.push(I)}return C&&n.setIndex(null),a.primitives=l,i.meshes.push(a),i.meshes.length-1}(t):t.isCamera&&(e.camera=function(t){i.cameras||(i.cameras=[]);var e=t.isOrthographicCamera,r={type:e?"orthographic":"perspective"};return e?r.orthographic={xmag:2*t.right,ymag:2*t.top,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:r.perspective={aspectRatio:t.aspect,yfov:vu.degToRad(t.fov)/t.aspect,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},""!==t.name&&(r.name=t.type),i.cameras.push(r),i.cameras.length-1}(t)),t.isSkinnedMesh&&c.push(t),t.children.length>0){for(var s=[],u=0,h=t.children.length;u<h;u++){var p=t.children[u];if(p.visible||!1===r.onlyVisible){var f=w(p);null!==f&&s.push(f)}}s.length>0&&(e.children=s)}i.nodes.push(e);var m=i.nodes.length-1;return l.set(t,m),m}function _(t){i.scenes||(i.scenes=[],i.scene=0);var e={nodes:[]};""!==t.name&&(e.name=t.name),i.scenes.push(e);for(var n=[],o=0,a=t.children.length;o<a;o++){var s=t.children[o];if(s.visible||!1===r.onlyVisible){var l=w(s);null!==l&&n.push(l)}}n.length>0&&(e.nodes=n)}!function(t){t=t instanceof Array?t:[t];for(var e=[],n=0;n<t.length;n++)t[n]instanceof vd?_(t[n]):e.push(t[n]);for(e.length>0&&function(t){var e=new vd;e.name="AuxScene";for(var r=0;r<t.length;r++)e.children.push(t[r]);_(e)}(e),n=0;n<c.length;++n)b(c[n]);for(n=0;n<r.animations.length;++n)x(r.animations[n],t[0])}(t),Promise.all(s).then(function(){var t=new Blob(a,{type:"application/octet-stream"}),n=Object.keys(u);if(n.length>0&&(i.extensionsUsed=n),i.buffers&&i.buffers.length>0){i.buffers[0].byteLength=t.size;var o=new window.FileReader;!0===r.binary?(o.readAsArrayBuffer(t),o.onloadend=function(){var t=f(o.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,t.byteLength,!0),r.setUint32(4,5130562,!0);var n=f(function(t){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(t).buffer;for(var e=new Uint8Array(new ArrayBuffer(t.length)),r=0,n=t.length;r<n;r++){var i=t.charCodeAt(r);e[r]=i>255?32:i}return e.buffer}(JSON.stringify(i)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,n.byteLength,!0),a.setUint32(4,1313821514,!0);var s=new ArrayBuffer(12),l=new DataView(s);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0),l.setUint32(8,12+a.byteLength+n.byteLength+r.byteLength+t.byteLength,!0);var c=new Blob([s,a,n,r,t],{type:"application/octet-stream"}),u=new window.FileReader;u.readAsArrayBuffer(c),u.onloadend=function(){e(u.result)}}):(o.readAsDataURL(t),o.onloadend=function(){i.buffers[0].uri=o.result,e(i)})}else e(i)})}};var af=function(){};af.prototype={constructor:af,parse:function(t){var e,r,n,i,o,a="",s=0,l=0,c=0,u=new yu,h=new yu,d=new Nu,p=[];return t.traverse(function(t){t instanceof zh&&function(t){var n=0,f=0,m=0,v=t.geometry,g=new Su;if(v instanceof Iu&&(v=(new Yu).setFromObject(t)),v instanceof Yu){var y=v.getAttribute("position"),x=v.getAttribute("normal"),b=v.getAttribute("uv"),w=v.getIndex();if(a+="o "+t.name+"\n",t.material&&t.material.name&&(a+="usemtl "+t.material.name+"\n"),void 0!==y)for(e=0,i=y.count;e<i;e++,n++)u.x=y.getX(e),u.y=y.getY(e),u.z=y.getZ(e),u.applyMatrix4(t.matrixWorld),a+="v "+u.x+" "+u.y+" "+u.z+"\n";if(void 0!==b)for(e=0,i=b.count;e<i;e++,m++)d.x=b.getX(e),d.y=b.getY(e),a+="vt "+d.x+" "+d.y+"\n";if(void 0!==x)for(g.getNormalMatrix(t.matrixWorld),e=0,i=x.count;e<i;e++,f++)h.x=x.getX(e),h.y=x.getY(e),h.z=x.getZ(e),h.applyMatrix3(g),a+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==w)for(e=0,i=w.count;e<i;e+=3){for(o=0;o<3;o++)r=w.getX(e+o)+1,p[o]=s+r+(x||b?"/"+(b?l+r:"")+(x?"/"+(c+r):""):"");a+="f "+p.join(" ")+"\n"}else for(e=0,i=y.count;e<i;e+=3){for(o=0;o<3;o++)p[o]=s+(r=e+o+1)+(x||b?"/"+(b?l+r:"")+(x?"/"+(c+r):""):"");a+="f "+p.join(" ")+"\n"}}else console.warn("OBJExporter.parseMesh(): geometry type unsupported",v);s+=n,l+=m,c+=f}(t),t instanceof Vh&&function(t){var o=0,l=t.geometry,c=t.type;if(l instanceof Iu&&(l=(new Yu).setFromObject(t)),l instanceof Yu){var h=l.getAttribute("position");if(a+="o "+t.name+"\n",void 0!==h)for(e=0,i=h.count;e<i;e++,o++)u.x=h.getX(e),u.y=h.getY(e),u.z=h.getZ(e),u.applyMatrix4(t.matrixWorld),a+="v "+u.x+" "+u.y+" "+u.z+"\n";if("Line"===c){for(a+="l ",r=1,i=h.count;r<=i;r++)a+=s+r+" ";a+="\n"}if("LineSegments"===c)for(n=1+(r=1),i=h.count;r<i;n=(r+=2)+1)a+="l "+(s+r)+" "+(s+n)+"\n"}else console.warn("OBJExporter.parseLine(): geometry type unsupported",l);s+=o}(t)}),a}};var sf=function(){};sf.prototype={constructor:sf,parse:function(t,e){!0!==Array.isArray(e)&&(e=[]);var r=-1===e.indexOf("normal"),n=-1===e.indexOf("color"),i=-1===e.indexOf("uv"),o=0,a=0,s="",l="",c=new yu,u=new Su;t.traverse(function(t){if(t instanceof zh){var e=t,h=e.geometry;if(h instanceof Iu&&(h=(new Yu).setFromObject(e)),h instanceof Yu){var d=h.getAttribute("position"),p=h.getAttribute("normal"),f=h.getAttribute("uv"),m=h.getAttribute("color"),v=h.getIndex();if(u.getNormalMatrix(e.matrixWorld),void 0===d)return;for(y=0,x=d.count;y<x;y++){c.x=d.getX(y),c.y=d.getY(y),c.z=d.getZ(y),c.applyMatrix4(e.matrixWorld);var g=c.x+" "+c.y+" "+c.z;!0===r&&(void 0!==p?(c.x=p.getX(y),c.y=p.getY(y),c.z=p.getZ(y),c.applyMatrix3(u),g+=" "+c.x+" "+c.y+" "+c.z):g+=" 0 0 0"),!0===i&&(void 0!==f?g+=" "+f.getX(y)+" "+f.getY(y):!1!==i&&(g+=" 0 0")),!0===n&&(g+=void 0!==m?" "+Math.floor(m.getX(y))+" "+Math.floor(m.getY(y))+" "+Math.floor(m.getZ(y)):" 255 255 255"),s+=g+"\n"}if(null!==v)for(y=0,x=v.count;y<x;y+=3)l+="3 "+(v.getX(y+0)+o),l+=" "+(v.getX(y+1)+o),l+=" "+(v.getX(y+2)+o)+"\n";else for(var y=0,x=d.count;y<x;y+=3)l+="3 "+(o+y)+" "+(o+y+1)+" "+(o+y+2)+"\n";o+=d.count,a+=v?v.count/3:d.count/3}}});var h="ply\nformat ascii 1.0\nelement vertex "+o+"\nproperty float x\nproperty float y\nproperty float z\n";return!0===r&&(h+="property float nx\nproperty float ny\nproperty float nz\n"),!0===i&&(h+="property float s\nproperty float t\n"),!0===n&&(h+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),h+"element face "+a+"\nproperty list uchar int vertex_index\nend_header\n"+s+"\n"+l+"\n"}};var lf=function(){};lf.prototype={constructor:lf,parse:function(){var t=new yu,e=new Su;return function(r){var n=[],i=0;r.traverse(function(t){if(t instanceof zh){var e=t.geometry;e instanceof Yu&&(e=(new Iu).fromBufferGeometry(e)),e instanceof Iu&&(i+=e.faces.length,n.push({geometry:e,matrix:t.matrixWorld}))}});var o=80,a=new ArrayBuffer(2*i+3*i*4*4+80+4),s=new DataView(a);return s.setUint32(o,i,!0),o+=4,n.forEach(function(r){var n=r.geometry.vertices,i=r.geometry.faces;e.getNormalMatrix(r.matrix);for(var a=0,l=i.length;a<l;a++){var c=i[a];t.copy(c.normal).applyMatrix3(e).normalize(),s.setFloat32(o,t.x,!0),s.setFloat32(o+=4,t.y,!0),s.setFloat32(o+=4,t.z,!0),o+=4;for(var u=[c.a,c.b,c.c],h=0;h<3;h++)t.copy(n[u[h]]).applyMatrix4(r.matrix),s.setFloat32(o,t.x,!0),s.setFloat32(o+=4,t.y,!0),s.setFloat32(o+=4,t.z,!0),o+=4;s.setUint16(o,0,!0),o+=2}}),s}}()};var cf=function(){};cf.prototype={constructor:cf,parse:function(){var t=new yu,e=new Su;return function(r){var n="";return n+="solid exported\n",r.traverse(function(r){if(r instanceof zh){var i=r.geometry,o=r.matrixWorld;if(i instanceof Yu&&(i=(new Iu).fromBufferGeometry(i)),i instanceof Iu){var a=i.vertices,s=i.faces;e.getNormalMatrix(o);for(var l=0,c=s.length;l<c;l++){var u=s[l];t.copy(u.normal).applyMatrix3(e).normalize(),n+="\tfacet normal "+t.x+" "+t.y+" "+t.z+"\n",n+="\t\touter loop\n";for(var h=[u.a,u.b,u.c],d=0;d<3;d++)t.copy(a[h[d]]).applyMatrix4(o),n+="\t\t\tvertex "+t.x+" "+t.y+" "+t.z+"\n";n+="\t\tendloop\n",n+="\tendfacet\n"}}}}),n+="endsolid exported\n"}}()};var uf=function(){};function hf(t,e,r,n){Yu.call(this);var i=[],o=[],a=[],s=new yu,l=new gu;l.makeRotationFromEuler(r),l.setPosition(e);var c=(new gu).getInverse(l);function u(e,r,n){r.applyMatrix4(t.matrix),r.applyMatrix4(c),e.push(new df(r.clone(),n.clone()))}function h(t,e){for(var r=[],i=.5*Math.abs(n.dot(e)),o=0;o<t.length;o+=3){var a,s,l,c,u,h,p,f=t[o+0].position.dot(e)-i;switch(s=t[o+1].position.dot(e)-i>0,l=t[o+2].position.dot(e)-i>0,((a=f>0)?1:0)+(s?1:0)+(l?1:0)){case 0:r.push(t[o]),r.push(t[o+1]),r.push(t[o+2]);break;case 1:if(a&&(u=t[o+2],h=d(t[o],c=t[o+1],e,i),p=d(t[o],u,e,i)),s){u=t[o+2],h=d(t[o+1],c=t[o],e,i),p=d(t[o+1],u,e,i),r.push(h),r.push(u.clone()),r.push(c.clone()),r.push(u.clone()),r.push(h.clone()),r.push(p);break}l&&(u=t[o+1],h=d(t[o+2],c=t[o],e,i),p=d(t[o+2],u,e,i)),r.push(c.clone()),r.push(u.clone()),r.push(h),r.push(p),r.push(h.clone()),r.push(u.clone());break;case 2:a||(u=d(c=t[o].clone(),t[o+1],e,i),h=d(c,t[o+2],e,i),r.push(c),r.push(u),r.push(h)),s||(u=d(c=t[o+1].clone(),t[o+2],e,i),h=d(c,t[o],e,i),r.push(c),r.push(u),r.push(h)),l||(u=d(c=t[o+2].clone(),t[o],e,i),h=d(c,t[o+1],e,i),r.push(c),r.push(u),r.push(h))}}return r}function d(t,e,r,n){var i=t.position.dot(r)-n,o=i/(i-(e.position.dot(r)-n));return new df(new yu(t.position.x+o*(e.position.x-t.position.x),t.position.y+o*(e.position.y-t.position.y),t.position.z+o*(e.position.z-t.position.z)),new yu(t.normal.x+o*(e.normal.x-t.normal.x),t.normal.y+o*(e.normal.y-t.normal.y),t.normal.z+o*(e.normal.z-t.normal.z)))}!function(){var e,r=new Yu,c=[],d=new yu,p=new yu;t.geometry.isGeometry?r.fromGeometry(t.geometry):r.copy(t.geometry);var f=r.attributes.position,m=r.attributes.normal;if(null!==r.index){var v=r.index;for(e=0;e<v.count;e++)d.fromBufferAttribute(f,v.getX(e)),p.fromBufferAttribute(m,v.getX(e)),u(c,d,p)}else for(e=0;e<f.count;e++)d.fromBufferAttribute(f,e),p.fromBufferAttribute(m,e),u(c,d,p);for(c=h(c=h(c=h(c=h(c=h(c=h(c,s.set(1,0,0)),s.set(-1,0,0)),s.set(0,1,0)),s.set(0,-1,0)),s.set(0,0,1)),s.set(0,0,-1)),e=0;e<c.length;e++){var g=c[e];a.push(.5+g.position.x/n.x,.5+g.position.y/n.y),g.position.applyMatrix4(l),i.push(g.position.x,g.position.y,g.position.z),o.push(g.normal.x,g.normal.y,g.normal.z)}}(),this.addAttribute("position",new Gu(i,3)),this.addAttribute("normal",new Gu(o,3)),this.addAttribute("uv",new Gu(a,2))}function df(t,e){this.position=t,this.normal=e}uf.prototype={constructor:uf,parse:function(t){var e={metadata:{version:4,type:"TypedGeometry",generator:"TypedGeometryExporter"}},r=["vertices","normals","uvs"];for(var n in r){for(var i=r[n],o=t[i],a=[],s=0,l=o.length;s<l;s++)a[s]=o[s];e[i]=a}var c=t.boundingSphere;return null!==c&&(e.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}},(hf.prototype=Object.create(Yu.prototype)).constructor=hf,df.prototype.clone=function(){return new df(this.position.clone(),this.normal.clone())};var pf=function(t,e,r,n,i,o,a){var s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],l=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];Yu.call(this),t=t||50,e=void 0!==e?Math.max(2,Math.floor(e)||10):10,r=void 0===r||r,n=void 0===n||n,i=void 0===i||i,o=void 0===o||o;var c=3.15*((a=void 0===a||a)?1:1.3)/2,u=t/c,h=r?(8*e-4)*e:0;h+=n?(16*e-4)*e:0,h+=i?40*e*e:0;var d=new Uint32Array(3*h),p=r?4:0;p+=n?8:0,p+=i?20:0,p*=(e+1)*(e+1);var f=new Float32Array(3*p),m=new Float32Array(3*p),v=new Float32Array(2*p),g=new gu;g.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var y,x,b,w,_,S,T,M,A,E,C,P,O,N,L,I,R=[],D=[],F=[],U=[],k=[],B=[],j=[],z=[],V=[],G=new yu,H=0,W=0,X=new yu,Y=new gu,q=new gu,J=new Ru,Z=new Ru,Q=new Ru,K=new Ru,$=new yu,tt=new yu,et=g.clone();et.transpose();var rt=function(t,e,r){return!(f[3*t]===f[3*e]&&f[3*t+1]===f[3*e+1]&&f[3*t+2]===f[3*e+2]||f[3*t]===f[3*r]&&f[3*t+1]===f[3*r+1]&&f[3*t+2]===f[3*r+2]||f[3*e]===f[3*r]&&f[3*e+1]===f[3*r+1]&&f[3*e+2]===f[3*r+2])};for(y=0;y<3;y++)B[y]=new gu;var nt=r?32:28;T=e+1;for(var it=0,ot=0,at=0,st=0,lt=0,ct=i?0:20;ct<nt;ct++)if(n||ct<20||ct>=28){for(y=0;y<3;y++){for(x=0;x<4;x++)for(b=0;b<4;b++)R[4*b+x]=l[3*s[16*ct+4*x+b]+y],o&&ct>=20&&ct<28&&2!==y&&(R[4*b+x]*=1.077),a||2!==y||(R[4*b+x]*=1.3);Y.set(R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7],R[8],R[9],R[10],R[11],R[12],R[13],R[14],R[15]),q.multiplyMatrices(Y,g),B[y].multiplyMatrices(et,q)}for(_=0;_<=e;_++)for(M=_/e,S=0;S<=e;S++){for(A=S/e,P=4,E=C=1;P--;)D[P]=E,F[P]=C,E*=M,C*=A,3===P?(U[P]=k[P]=0,H=W=1):(U[P]=H*(3-P),k[P]=W*(3-P),H*=M,W*=A);for(J.fromArray(D),Z.fromArray(F),Q.fromArray(U),K.fromArray(k),y=0;y<3;y++)(w=J.clone()).applyMatrix4(B[y]),j[y]=w.dot(Z),(w=Q.clone()).applyMatrix4(B[y]),z[y]=w.dot(Z),(w=J.clone()).applyMatrix4(B[y]),V[y]=w.dot(K);$.fromArray(z),tt.fromArray(V),G.crossVectors(tt,$),G.normalize(),0===j[0]&&0===j[1]?X.set(0,j[2]>c?1:-1,0):X.set(G.x,G.z,-G.y),f[ot++]=u*j[0],f[ot++]=u*(j[2]-c),f[ot++]=-u*j[1],m[at++]=X.x,m[at++]=X.y,m[at++]=X.z,v[st++]=1-A,v[st++]=1-M}for(_=0;_<e;_++)for(S=0;S<e;S++)I=(O=it*T*T+_*T+S)+T,rt(O,N=O+1,L=N+T)&&(d[lt++]=O,d[lt++]=N,d[lt++]=L),rt(O,L,I)&&(d[lt++]=O,d[lt++]=L,d[lt++]=I);it++}this.setIndex(new Du(d,1)),this.addAttribute("position",new Du(f,3)),this.addAttribute("normal",new Du(m,3)),this.addAttribute("uv",new Du(v,2)),this.computeBoundingSphere()};function ff(t,e,r,n,i,o,a,s,l,c,u,h){xd.call(this,null,o,a,s,l,c,n,i,u,h),this.image={data:t,width:e,height:r},this.magFilter=void 0!==l?l:fh,this.minFilter=void 0!==c?c:fh,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function mf(t,e){Mu.call(this),this.type="Points",this.geometry=void 0!==t?t:new Yu,this.material=void 0!==e?e:new jd({color:16777215*Math.random()})}(pf.prototype=Object.create(Yu.prototype)).constructor=pf,(ff.prototype=Object.create(xd.prototype)).constructor=ff,ff.prototype.isDataTexture=!0,mf.prototype=Object.assign(Object.create(Mu.prototype),{constructor:mf,isPoints:!0,raycast:function(){var t=new gu,e=new Uh,r=new Ou;return function(n,i){var o=this,a=this.geometry,s=this.matrixWorld,l=n.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(s),r.radius+=l,!1!==n.ray.intersectsSphere(r)){t.getInverse(s),e.copy(n.ray).applyMatrix4(t);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new yu,d=new yu;if(a.isBufferGeometry){var p=a.index,f=a.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var x=f.length/3;v<x;v++)h.fromArray(f,3*v),w(h,v)}}else{var b=a.vertices;for(v=0,x=b.length;v<x;v++)w(b[v],v)}}function w(t,r){var a=e.distanceSqToPoint(t);if(a<u){e.closestPointToPoint(t,d),d.applyMatrix4(s);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(a),point:d.clone(),index:r,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var vf=function(t){Mu.apply(this,arguments),this.PARTICLE_COUNT=(t=t||{}).maxParticles||1e6,this.PARTICLE_CONTAINERS=t.containerCount||1,this.PARTICLE_NOISE_TEXTURE=t.particleNoiseTex||null,this.PARTICLE_SPRITE_TEXTURE=t.particleSpriteTex||null,this.PARTICLES_PER_CONTAINER=Math.ceil(this.PARTICLE_COUNT/this.PARTICLE_CONTAINERS),this.PARTICLE_CURSOR=0,this.time=0,this.particleContainers=[],this.rand=[];var e,r={vertexShader:["uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec3 positionStart;","attribute float startTime;","attribute vec3 velocity;","attribute float turbulence;","attribute vec3 color;","attribute float size;","attribute float lifeTime;","varying vec4 vColor;","varying float lifeLeft;","void main() {","\tvColor = vec4( color, 1.0 );","\tvec3 newPosition;","\tvec3 v;","\tfloat timeElapsed = uTime - startTime;","\tlifeLeft = 1.0 - ( timeElapsed / lifeTime );","\tgl_PointSize = ( uScale * size ) * lifeLeft;","\tv.x = ( velocity.x - 0.5 ) * 3.0;","\tv.y = ( velocity.y - 0.5 ) * 3.0;","\tv.z = ( velocity.z - 0.5 ) * 3.0;","\tnewPosition = positionStart + ( v * 10.0 ) * timeElapsed;","\tvec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;","\tvec3 noiseVel = ( noise.rgb - 0.5 ) * 30.0;","\tnewPosition = mix( newPosition, newPosition + vec3( noiseVel * ( turbulence * 5.0 ) ), ( timeElapsed / lifeTime ) );","\tif( v.y > 0. && v.y < .05 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( v.x < - 1.45 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( timeElapsed > 0.0 ) {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","\t} else {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\t\tlifeLeft = 0.0;","\t\tgl_PointSize = 0.;","\t}","}"].join("\n"),fragmentShader:["float scaleLinear( float value, vec2 valueDomain ) {","\treturn ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );","}","float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {","\treturn mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","\tfloat alpha = 0.;","\tif( lifeLeft > 0.995 ) {","\t\talpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );","\t} else {","\t\talpha = lifeLeft * 0.75;","\t}","\tvec4 tex = texture2D( tSprite, gl_PointCoord );","\tgl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")};for(e=1e5;e>0;e--)this.rand.push(Math.random()-.5);this.random=function(){return++e>=this.rand.length?this.rand[e=1]:this.rand[e]};var n=new Xd;this.particleNoiseTex=this.PARTICLE_NOISE_TEXTURE||n.load("textures/perlin-512.png"),this.particleNoiseTex.wrapS=this.particleNoiseTex.wrapT=hh,this.particleSpriteTex=this.PARTICLE_SPRITE_TEXTURE||n.load("textures/particle2.png"),this.particleSpriteTex.wrapS=this.particleSpriteTex.wrapT=hh,this.particleShaderMat=new _d({transparent:!0,depthWrite:!1,uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:this.particleNoiseTex},tSprite:{value:this.particleSpriteTex}},blending:2,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.particleShaderMat.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0],this.particleShaderMat.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0],this.init=function(){for(var t=0;t<this.PARTICLE_CONTAINERS;t++){var e=new gf(this.PARTICLES_PER_CONTAINER,this);this.particleContainers.push(e),this.add(e)}},this.spawnParticle=function(t){this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=1),this.particleContainers[Math.floor(this.PARTICLE_CURSOR/this.PARTICLES_PER_CONTAINER)].spawnParticle(t)},this.update=function(t){for(var e=0;e<this.PARTICLE_CONTAINERS;e++)this.particleContainers[e].update(t)},this.dispose=function(){this.particleShaderMat.dispose(),this.particleNoiseTex.dispose(),this.particleSpriteTex.dispose();for(var t=0;t<this.PARTICLE_CONTAINERS;t++)this.particleContainers[t].dispose()},this.init()};(vf.prototype=Object.create(Mu.prototype)).constructor=vf;var gf=function(t,e){Mu.apply(this,arguments),this.PARTICLE_COUNT=t||1e5,this.PARTICLE_CURSOR=0,this.time=0,this.offset=0,this.count=0,this.DPR=window.devicePixelRatio,this.GPUParticleSystem=e,this.particleUpdate=!1,this.particleShaderGeo=new Yu,this.particleShaderGeo.addAttribute("position",new Du(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("positionStart",new Du(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("startTime",new Du(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("velocity",new Du(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("turbulence",new Du(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("color",new Du(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("size",new Du(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("lifeTime",new Du(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderMat=this.GPUParticleSystem.particleShaderMat;var r=new yu,n=new yu,i=new Eu;this.spawnParticle=function(t){var o=this.particleShaderGeo.getAttribute("positionStart"),a=this.particleShaderGeo.getAttribute("startTime"),s=this.particleShaderGeo.getAttribute("velocity"),l=this.particleShaderGeo.getAttribute("turbulence"),c=this.particleShaderGeo.getAttribute("color"),u=this.particleShaderGeo.getAttribute("size"),h=this.particleShaderGeo.getAttribute("lifeTime");r=void 0!==(t=t||{}).position?r.copy(t.position):r.set(0,0,0),n=void 0!==t.velocity?n.copy(t.velocity):n.set(0,0,0),i=i.set(void 0!==t.color?t.color:16777215);var d=void 0!==t.positionRandomness?t.positionRandomness:0,p=void 0!==t.velocityRandomness?t.velocityRandomness:0,f=void 0!==t.colorRandomness?t.colorRandomness:1,m=void 0!==t.turbulence?t.turbulence:1,v=void 0!==t.lifetime?t.lifetime:5,g=void 0!==t.size?t.size:10,y=void 0!==t.sizeRandomness?t.sizeRandomness:0,x=void 0!==t.smoothPosition&&t.smoothPosition;void 0!==this.DPR&&(g*=this.DPR);var b=this.PARTICLE_CURSOR;o.array[3*b+0]=r.x+e.random()*d,o.array[3*b+1]=r.y+e.random()*d,o.array[3*b+2]=r.z+e.random()*d,!0===x&&(o.array[3*b+0]+=-n.x*e.random(),o.array[3*b+1]+=-n.y*e.random(),o.array[3*b+2]+=-n.z*e.random());var w=n.x+e.random()*p,_=n.y+e.random()*p,S=n.z+e.random()*p;w=vu.clamp((w- -2)/4,0,1),_=vu.clamp((_- -2)/4,0,1),S=vu.clamp((S- -2)/4,0,1),s.array[3*b+0]=w,s.array[3*b+1]=_,s.array[3*b+2]=S,i.r=vu.clamp(i.r+e.random()*f,0,1),i.g=vu.clamp(i.g+e.random()*f,0,1),i.b=vu.clamp(i.b+e.random()*f,0,1),c.array[3*b+0]=i.r,c.array[3*b+1]=i.g,c.array[3*b+2]=i.b,l.array[b]=m,u.array[b]=g+e.random()*y,h.array[b]=v,a.array[b]=this.time+.02*e.random(),0===this.offset&&(this.offset=this.PARTICLE_CURSOR),this.count++,this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=0),this.particleUpdate=!0},this.init=function(){this.particleSystem=new mf(this.particleShaderGeo,this.particleShaderMat),this.particleSystem.frustumCulled=!1,this.add(this.particleSystem)},this.update=function(t){this.time=t,this.particleShaderMat.uniforms.uTime.value=t,this.geometryUpdate()},this.geometryUpdate=function(){if(!0===this.particleUpdate){this.particleUpdate=!1;var t=this.particleShaderGeo.getAttribute("positionStart"),e=this.particleShaderGeo.getAttribute("startTime"),r=this.particleShaderGeo.getAttribute("velocity"),n=this.particleShaderGeo.getAttribute("turbulence"),i=this.particleShaderGeo.getAttribute("color"),o=this.particleShaderGeo.getAttribute("size"),a=this.particleShaderGeo.getAttribute("lifeTime");this.offset+this.count<this.PARTICLE_COUNT?(t.updateRange.offset=this.offset*t.itemSize,e.updateRange.offset=this.offset*e.itemSize,r.updateRange.offset=this.offset*r.itemSize,n.updateRange.offset=this.offset*n.itemSize,i.updateRange.offset=this.offset*i.itemSize,o.updateRange.offset=this.offset*o.itemSize,a.updateRange.offset=this.offset*a.itemSize,t.updateRange.count=this.count*t.itemSize,e.updateRange.count=this.count*e.itemSize,r.updateRange.count=this.count*r.itemSize,n.updateRange.count=this.count*n.itemSize,i.updateRange.count=this.count*i.itemSize,o.updateRange.count=this.count*o.itemSize,a.updateRange.count=this.count*a.itemSize):(t.updateRange.offset=0,e.updateRange.offset=0,r.updateRange.offset=0,n.updateRange.offset=0,i.updateRange.offset=0,o.updateRange.offset=0,a.updateRange.offset=0,t.updateRange.count=-1,e.updateRange.count=-1,r.updateRange.count=-1,n.updateRange.count=-1,i.updateRange.count=-1,o.updateRange.count=-1,a.updateRange.count=-1),t.needsUpdate=!0,e.needsUpdate=!0,r.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0,o.needsUpdate=!0,a.needsUpdate=!0,this.offset=0,this.count=0}},this.dispose=function(){this.particleShaderGeo.dispose()},this.init()};gf.prototype=Object.create(Mu.prototype),gf.prototype.constructor=gf;var yf=function(){Mu.call(this)};function xf(){Yu.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function bf(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function wf(t,e,r){bf.call(this,t,e),this.meshPerAttribute=r||1}function _f(t,e,r,n){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function Sf(t){Yu.call(this),this.type="WireframeGeometry";var e,r,n,i,o,a,s,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var v=m[e];for(r=0;r<3;r++)s=v[f[r]],l=v[f[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)h.push((u=t.vertices[(a=p[c]).index1]).x,u.y,u.z),h.push((u=t.vertices[a.index2]).x,u.y,u.z)}else if(t&&t.isBufferGeometry){var g,y,x,b,w;if(u=new yu,null!==t.index){for(g=t.attributes.position,y=t.index,0===(x=t.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(e=w=(b=x[i]).start,n=w+b.count;e<n;e+=3)for(r=0;r<3;r++)s=y.getX(e+r),l=y.getX(e+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)u.fromBufferAttribute(g,(a=p[c]).index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,a.index2),h.push(u.x,u.y,u.z)}else for(e=0,n=(g=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)u.fromBufferAttribute(g,3*e+r),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,3*e+(r+1)%3),h.push(u.x,u.y,u.z)}this.addAttribute("position",new Gu(h,3))}(yf.prototype=Object.create(Mu.prototype)).constructor=yf,yf.prototype.updateMatrixWorld=function(){var t=new yu,e=new xu,r=new yu,n=new yu,i=new xu,o=new yu;return function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(n,i,o),this.matrix.decompose(t,e,r),this.matrixWorld.compose(n,e,o)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var s=0,l=this.children.length;s<l;s++)this.children[s].updateMatrixWorld(a)}}(),xf.prototype=Object.assign(Object.create(Yu.prototype),{constructor:xf,isInstancedBufferGeometry:!0,copy:function(t){return Yu.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperty(bf.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(bf.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),wf.prototype=Object.assign(Object.create(bf.prototype),{constructor:wf,isInstancedInterleavedBuffer:!0,copy:function(t){return bf.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.defineProperties(_f.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(_f.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),(Sf.prototype=Object.create(Yu.prototype)).constructor=Sf;var Tf=function(){xf.call(this),this.type="LineSegmentsGeometry",new Yu,this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.addAttribute("position",new Gu([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.addAttribute("uv",new Gu([0,1,1,1,0,.5,1,.5,0,.5,1,.5,0,0,1,0],2))};Tf.prototype=Object.assign(Object.create(xf.prototype),{constructor:Tf,isLineSegmentsGeometry:!0,applyMatrix:function(t){var e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==e&&(t.applyToBufferAttribute(e),t.applyToBufferAttribute(r),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var r=new wf(e,6,1);return this.addAttribute("instanceStart",new _f(r,3,0)),this.addAttribute("instanceEnd",new _f(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var r=new wf(e,6,1);return this.addAttribute("instanceColorStart",new _f(r,3,0)),this.addAttribute("instanceColorEnd",new _f(r,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new Sf(t.geometry)),this},fromLineSegements:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},computeBoundingBox:function(){var t=new Pu;return function(){null===this.boundingBox&&(this.boundingBox=new Pu);var e=this.attributes.instanceStart,r=this.attributes.instanceEnd;void 0!==e&&void 0!==r&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(r),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new yu;return function(){null===this.boundingSphere&&(this.boundingSphere=new Ou),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(void 0!==e&&void 0!==r){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var i=0,o=0,a=e.count;o<a;o++)t.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(t)),t.fromBufferAttribute(r,o),i=Math.max(i,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},clone:function(){},copy:function(t){return this}}),Qp.line={linewidth:{value:1},resolution:{value:new Nu(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Kp.line={uniforms:wd.merge([Qp.common,Qp.fog,Qp.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) {\n\n\t\t\t\tfloat a = vUv.x - 0.5;\n\t\t\t\tfloat b = vUv.y - 0.5;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 0.25 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var Mf=function(t){_d.call(this,{type:"LineMaterial",uniforms:wd.clone(Kp.line.uniforms),vertexShader:Kp.line.vertexShader,fragmentShader:Kp.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};(Mf.prototype=Object.create(_d.prototype)).constructor=Mf,Mf.prototype.isLineMaterial=!0,Mf.prototype.copy=function(t){return _d.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.resolution=t.resolution,this};var Af=function(t,e){zh.call(this),this.type="LineSegments2",this.geometry=void 0!==t?t:new Tf,this.material=void 0!==e?e:new Mf({color:16777215*Math.random()})};Af.prototype=Object.assign(Object.create(zh.prototype),{constructor:Af,isLineSegments2:!0,computeLineDistances:function(){var t=new yu,e=new yu;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=new Float32Array(2*n.data.count),a=0,s=0,l=n.data.count;a<l;a++,s+=2)t.fromBufferAttribute(n,a),e.fromBufferAttribute(i,a),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+t.distanceTo(e);var c=new wf(o,2,1);return r.addAttribute("instanceDistanceStart",new _f(c,1,0)),r.addAttribute("instanceDistanceEnd",new _f(c,1,1)),this}}(),copy:function(t){return this}});var Ef=function(){Tf.call(this),this.type="LineGeometry"};Ef.prototype=Object.assign(Object.create(Tf.prototype),{constructor:Ef,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,r=new Float32Array(2*e),n=0;n<e;n+=3)r[2*n]=t[n],r[2*n+1]=t[n+1],r[2*n+2]=t[n+2],r[2*n+3]=t[n+3],r[2*n+4]=t[n+4],r[2*n+5]=t[n+5];return Tf.prototype.setPositions.call(this,r),this},setColors:function(t){for(var e=t.length-3,r=new Float32Array(2*e),n=0;n<e;n+=3)r[2*n]=t[n],r[2*n+1]=t[n+1],r[2*n+2]=t[n+2],r[2*n+3]=t[n+3],r[2*n+4]=t[n+4],r[2*n+5]=t[n+5];return Tf.prototype.setColors.call(this,r),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},copy:function(t){return this}});var Cf=function(t,e){Af.call(this),this.type="Line2",this.geometry=void 0!==t?t:new Ef,this.material=void 0!==e?e:new Mf({color:16777215*Math.random()})};Cf.prototype=Object.assign(Object.create(Af.prototype),{constructor:Cf,isLine2:!0,copy:function(t){return this}});var Pf=function(t,e){zh.call(this),this.type="Wireframe",this.geometry=void 0!==t?t:new Tf,this.material=void 0!==e?e:new Mf({color:16777215*Math.random()})};Pf.prototype=Object.assign(Object.create(zh.prototype),{constructor:Pf,isWireframe:!0,computeLineDistances:function(){var t=new yu,e=new yu;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=new Float32Array(2*n.data.count),a=0,s=0,l=n.data.count;a<l;a++,s+=2)t.fromBufferAttribute(n,a),e.fromBufferAttribute(i,a),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+t.distanceTo(e);var c=new wf(o,2,1);return r.addAttribute("instanceDistanceStart",new _f(c,1,0)),r.addAttribute("instanceDistanceEnd",new _f(c,1,1)),this}}(),copy:function(t){return this}});var Of=function(t){Tf.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new Sf(t))};function Nf(){Mu.call(this),this.type="Group"}Of.prototype=Object.assign(Object.create(Tf.prototype),{constructor:Of,isWireframeGeometry2:!0,copy:function(t){return this}}),Nf.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Nf,isGroup:!0});var Lf=function(t){this.manager=void 0!==t?t:Pd,this.availableExtensions=[]};Lf.prototype={constructor:Lf,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){var e=this;function r(t){var e={type:t.getAttribute("type")},r=t.getAttribute("id");r&&(e.id=r);var n=t.getAttribute("pid");n&&(e.pid=n);var i=t.getAttribute("pindex");i&&(e.pindex=i);var o=t.getAttribute("thumbnail");o&&(e.thumbnail=o);var a=t.getAttribute("partnumber");a&&(e.partnumber=a);var s=t.getAttribute("name");s&&(e.name=s);var l=t.querySelector("mesh");return l&&(e.mesh=function(t,e){for(var r={},n=[],i=t.querySelectorAll("vertices vertex"),o=0;o<i.length;o++){var a=i[o],s=a.getAttribute("x"),l=a.getAttribute("y"),c=a.getAttribute("z");n.push(parseFloat(s),parseFloat(l),parseFloat(c))}for(r.vertices=new Float32Array(n.length),o=0;o<n.length;o++)r.vertices[o]=n[o];var u=[],h=[],d=t.querySelectorAll("triangles triangle");for(o=0;o<d.length;o++){var p=d[o],f=p.getAttribute("v1"),m=p.getAttribute("v2"),v=p.getAttribute("v3"),g=p.getAttribute("p1"),y=p.getAttribute("p2"),x=p.getAttribute("p3"),b=p.getAttribute("pid");h.push(parseInt(f,10),parseInt(m,10),parseInt(v,10));var w={};g&&(w.p1=parseInt(g,10)),y&&(w.p2=parseInt(y,10)),x&&(w.p3=parseInt(x,10)),b&&(w.pid=b),0<Object.keys(w).length&&u.push(w)}for(r.triangleProperties=u,r.triangles=new Uint32Array(h.length),o=0;o<h.length;o++)r.triangles[o]=h[o];return r}(l)),t.querySelector("components")&&(e.components=void 0),e}function n(t){var e={unit:t.getAttribute("unit")||"millimeter"},n=t.querySelectorAll("metadata");n&&(e.metadata=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(e[i]=n.textContent)}return e}(n));var i=t.querySelector("resources");i&&(e.resources=function(t){var e={};t.querySelector("basematerials")&&(e.basematerial=void 0),e.object={};for(var n=t.querySelectorAll("object"),i=0;i<n.length;i++){var o=r(n[i]);e.object[o.id]=o}return e}(i));var o=t.querySelector("build");return o&&(e.build=function(t){for(var e=[],r=t.querySelectorAll("item"),n=0;n<r.length;n++){var i=r[n],o={objectid:i.getAttribute("objectid")},a=i.getAttribute("transform");if(a){var s=[];a.split(" ").forEach(function(t){s.push(parseFloat(t))});var l=new gu;o.transform=l.set(s[0],s[3],s[6],s[9],s[1],s[4],s[7],s[10],s[2],s[5],s[8],s[11],0,0,0,1)}e.push(o)}return e}(o)),e}function i(t,e){var r=new Yu;r.setIndex(new Du(t.triangles,1)),r.addAttribute("position",new Du(t.vertices,3)),t.colors&&r.addAttribute("color",new Du(t.colors,3)),r.computeBoundingSphere();var n={flatShading:!0};return t.colors&&0<t.colors.length?n.vertexColors=eh:n.color=11184895,new zh(r,new Fd(n))}function o(t,r,n,i){if(t){for(var o=[],a=Object.keys(t),s=0;s<a.length;s++)for(var l=a[s],c=0;c<e.availableExtensions.length;c++)(u=e.availableExtensions[c]).ns===l&&o.push(u);for(s=0;s<o.length;s++){var u;(u=o[s]).apply(n,t[u.ns],r)}}}var a=function(t){var e,r,i=null,o=null,a=[],s=[],l={},c={};try{i=new JSZip(t)}catch(t){if(t instanceof ReferenceError)return console.error("ThreeMFLoader: jszip missing and file is compressed."),null}for(o in i.files)o.match(/\.rels$/)?e=o:o.match(/^3D\/.*\.model$/)?a.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)||(o.match(/^3D\/Textures\/.*/)?s.push(o):o.match(/^3D\/Other\/.*/));var u=new Uint8Array(i.file(e).asArrayBuffer());r=function(t){var e=(new DOMParser).parseFromString(t,"application/xml").querySelector("Relationship");return{target:e.getAttribute("Target"),id:e.getAttribute("Id"),type:e.getAttribute("Type")}}(qd.decodeText(u));for(var h=0;h<a.length;h++){var d=a[h],p=new Uint8Array(i.file(d).asArrayBuffer()),f=qd.decodeText(p),m=(new DOMParser).parseFromString(f,"application/xml");"model"!==m.documentElement.nodeName.toLowerCase()&&console.error("ThreeMFLoader: Error loading 3MF - no 3MF document found: ",d);var v=m.querySelector("model"),g={};for(h=0;h<v.attributes.length;h++){var y=v.attributes[h];y.name.match(/^xmlns:(.+)$/)&&(g[y.value]=RegExp.$1)}var x=n(v);x.xml=v,0<Object.keys(g).length&&(x.extensions=g),l[d]=x}for(h=0;h<s.length;h++){var b=s[h];c[b]=i.file(b).asBinary()}return{rels:r,model:l,printTicket:{},texture:c,other:{}}}(t);return function(t,e,r){for(var n=new Nf,i=r.model[e.target.substring(1)].build,o=0;o<i.length;o++){var a=i[o],s=t[a.objectid];a.transform&&s.geometry.applyMatrix(a.transform),n.add(s)}return n}(function(t){for(var e=t.model,r={},n=Object.keys(e),a=0;a<n.length;a++)for(var s=e[n[a]],l=s.xml,c=s.extensions,u=Object.keys(s.resources.object),h=0;h<u.length;h++){var d=u[h],p=s.resources.object[d].mesh;o(c,p,l),r[d]=i(p)}return r}(a),a.rels,a)},addExtension:function(t){this.availableExtensions.push(t)}};var If=function(t){this.manager=void 0!==t?t:Pd};If.prototype={constructor:If,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t){for(var e="AMF Material",n=t.attributes.id.textContent,i={r:1,g:1,b:1,a:1},o=null,a=0;a<t.childNodes.length;a++){var s=t.childNodes[a];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(e=s.textContent):"color"===s.nodeName&&(i=r(s))}return o=new Fd({flatShading:!0,color:new Eu(i.r,i.g,i.b),name:e}),1!==i.a&&(o.transparent=!0,o.opacity=i.a),{id:n,material:o}}function r(t){for(var e={r:1,g:1,b:1,a:1},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];"r"===n.nodeName?e.r=n.textContent:"g"===n.nodeName?e.g=n.textContent:"b"===n.nodeName?e.b=n.textContent:"a"===n.nodeName&&(e.a=n.textContent)}return e}function n(t){var e={name:"",triangles:[],materialid:null},r=t.firstElementChild;for(void 0!==t.attributes.materialid&&(e.materialId=t.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(e.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,i=r.getElementsByTagName("v2")[0].textContent,o=r.getElementsByTagName("v3")[0].textContent;e.triangles.push(n,i,o)}r=r.nextElementSibling}return e}function i(t){for(var e=[],r=[],n=t.firstElementChild;n;){if("vertex"===n.nodeName)for(var i=n.firstElementChild;i;){if("coordinates"===i.nodeName){var o=i.getElementsByTagName("x")[0].textContent,a=i.getElementsByTagName("y")[0].textContent,s=i.getElementsByTagName("z")[0].textContent;e.push(o,a,s)}else if("normal"===i.nodeName){var l=i.getElementsByTagName("nx")[0].textContent,c=i.getElementsByTagName("ny")[0].textContent,u=i.getElementsByTagName("nz")[0].textContent;r.push(l,c,u)}i=i.nextElementSibling}n=n.nextElementSibling}return{vertices:e,normals:r}}function o(t){for(var e=t.attributes.id.textContent,o={name:"amfobject",meshes:[]},a=null,s=t.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(o.name=s.textContent);else if("color"===s.nodeName)a=r(s);else if("mesh"===s.nodeName){for(var l=s.firstElementChild,c={vertices:[],normals:[],volumes:[],color:a};l;){if("vertices"===l.nodeName){var u=i(l);c.normals=c.normals.concat(u.normals),c.vertices=c.vertices.concat(u.vertices)}else"volume"===l.nodeName&&c.volumes.push(n(l));l=l.nextElementSibling}o.meshes.push(c)}s=s.nextElementSibling}return{id:e,obj:o}}var a,s,l=function(t){var e=new DataView(t);if("PK"===String.fromCharCode(e.getUint8(0),e.getUint8(1))){var r=null,n=null;console.log("AMFLoader: Loading Zip");try{r=new JSZip(t)}catch(t){if(t instanceof ReferenceError)return console.log("AMFLoader: jszip missing and file is compressed."),null}for(n in r.files)if(".amf"===n.toLowerCase().substr(-4))break;console.log("AMFLoader: Trying to load file asset: "+n),e=new DataView(r.file(n).asArrayBuffer())}var i=qd.decodeText(e),o=(new DOMParser).parseFromString(i,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("AMFLoader: Error loading AMF - no AMF document found."),null):o}(t),c="",u="",h=function(t){var e=1,r="millimeter";void 0!==l.documentElement.attributes.unit&&(r=l.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(e=n[r]),console.log("AMFLoader: Unit scale: "+e),e}(),d={},p={},f=l.documentElement.childNodes;for(a=0;a<f.length;a++){var m=f[a];if("metadata"===m.nodeName)void 0!==m.attributes.type&&("name"===m.attributes.type.value?c=m.textContent:"author"===m.attributes.type.value&&(u=m.textContent));else if("material"===m.nodeName){var v=e(m);d[v.id]=v.material}else if("object"===m.nodeName){var g=o(m);p[g.id]=g.obj}}var y=new Nf,x=new Fd({color:11184895,flatShading:!0});for(var b in y.name=c,y.userData.author=u,y.userData.loader="AMF",p){var w=p[b],_=w.meshes,S=new Nf;for(S.name=w.name||"",a=0;a<_.length;a++){var T=x,M=_[a],A=new Gu(M.vertices,3),E=null;if(M.normals.length&&(E=new Gu(M.normals,3)),M.color){var C=M.color;(T=x.clone()).color=new Eu(C.r,C.g,C.b),1!==C.a&&(T.transparent=!0,T.opacity=C.a)}var P=M.volumes;for(s=0;s<P.length;s++){var O=P[s],N=new Yu,L=T;N.setIndex(O.triangles),N.addAttribute("position",A.clone()),E&&N.addAttribute("normal",E.clone()),void 0!==d[O.materialId]&&(L=d[O.materialId]),N.scale(h,h,h),S.add(new zh(N,L.clone()))}}y.add(S)}return y}};var Rf=function(t){this.manager=void 0!==t?t:Pd};function Df(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new gu)}}function Ff(t,e){zh.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new gu,this.bindMatrixInverse=new gu;var r=new Df(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}Rf.prototype={constructor:Rf,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=qd.extractUrlBase(t);new Nd(this.manager).load(t,function(t){var r=JSON.parse(t),a=r.__metadata__;if(void 0!==a){if("assimp2json"!==a.format)return void n("AssimpJSONLoader: Not an assimp2json scene.");if(a.version<100&&a.version>=200)return void n("AssimpJSONLoader: Unsupported assimp2json file format version.")}e(i.parse(r,o))},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){function r(t,e){for(var r=new Array(t.length),n=0;n<t.length;++n)r[n]=e.call(this,t[n]);return r}var n=new Xd(this.manager);n.setPath(e).setCrossOrigin(this.crossOrigin);var i=r(t.meshes,function(t){var e,r,n,i=new Yu,o=[],a=t.vertices||[],s=t.normals||[],l=t.texturecoords||[],c=t.colors||[];for(l=l[0]||[],e=0,r=t.faces.length;e<r;e++)o.push((n=t.faces[e])[0],n[1],n[2]);return i.setIndex(o),i.addAttribute("position",new Gu(a,3)),s.length>0&&i.addAttribute("normal",new Gu(s,3)),l.length>0&&i.addAttribute("uv",new Gu(l,2)),c.length>0&&i.addAttribute("color",new Gu(c,3)),i.computeBoundingSphere(),i}),o=r(t.materials,function(t){var e=new Fd;for(var r in t.properties){var i=t.properties[r],o=i.value;switch(i.key){case"$tex.file":var a=i.semantic;if(1===a||2===a||5===a||6===a){var s;switch(a){case 1:s="map";break;case 2:s="specularMap";break;case 5:s="bumpMap";break;case 6:s="normalMap"}var l=n.load(o);l.wrapS=l.wrapT=hh,e[s]=l}break;case"?mat.name":e.name=o;break;case"$clr.diffuse":e.color.fromArray(o);break;case"$clr.specular":e.specular.fromArray(o);break;case"$clr.emissive":e.emissive.fromArray(o);break;case"$mat.shininess":e.shininess=o;break;case"$mat.shadingm":e.flatShading=1===o;break;case"$mat.opacity":o<1&&(e.opacity=o,e.transparent=!0)}}return e});return function t(e,r,n,i){var o,a,s=new Mu;for(s.name=r.name||"",s.matrix=(new gu).fromArray(r.transformation).transpose(),s.matrix.decompose(s.position,s.quaternion,s.scale),o=0;r.meshes&&o<r.meshes.length;o++)s.add(new zh(n[a=r.meshes[o]],i[e.meshes[a].materialindex]));for(o=0;r.children&&o<r.children.length;o++)s.add(t(e,r.children[o],n,i));return s}(t,t.rootnode,i,o)}},Object.assign(Df.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new gu;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new gu,e=new gu;return function(){for(var r=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture,a=0,s=r.length;a<s;a++)t.multiplyMatrices(r[a]?r[a].matrixWorld:e,n[a]),t.toArray(i,16*a);void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new Df(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}}}),Ff.prototype=Object.assign(Object.create(zh.prototype),{constructor:Ff,isSkinnedMesh:!0,initBones:function(){var t,e,r,n,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(r=0,n=this.geometry.bones.length;r<n;r++)e=this.geometry.bones[r],t=new Wh,i.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(r=0,n=this.geometry.bones.length;r<n;r++)-1!==(e=this.geometry.bones[r]).parent&&null!==e.parent&&void 0!==i[e.parent]?i[e.parent].add(i[r]):this.add(i[r])}return this.updateMatrixWorld(!0),i},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var r=this.geometry.skinWeights[e];(t=1/r.manhattanLength())!=1/0?r.multiplyScalar(t):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new Ru,i=this.geometry.attributes.skinWeight;for(e=0;e<i.count;e++)n.x=i.getX(e),n.y=i.getY(e),n.z=i.getZ(e),n.w=i.getW(e),(t=1/n.manhattanLength())!=1/0?n.multiplyScalar(t):n.set(1,0,0,0),i.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){zh.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Uf=function(t){this.manager=void 0!==t?t:Pd};function kf(){this.id=0,this.data=null}function Bf(){}Uf.prototype={constructor:Uf,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=qd.extractUrlBase(t),a=new Nd(this.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){e(i.parse(t,o))},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=new Xd(this.manager);r.setPath(e).setCrossOrigin(this.crossOrigin);var n={KeyFrame:function(t,e){this.time=t,this.matrix=e.clone(),this.position=new yu,this.quaternion=new xu,this.scale=new yu(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new n.KeyFrame(this.time,this.matrix)},this.lerp=function(t,e){var r=(e-=this.time)/(t.time-this.time),i=1-r,o=this.position,a=this.quaternion,s=t.position,l=t.quaternion;return n.KeyFrame.tempAniPos.x=o.x*i+s.x*r,n.KeyFrame.tempAniPos.y=o.y*i+s.y*r,n.KeyFrame.tempAniPos.z=o.z*i+s.z*r,n.KeyFrame.tempAniQuat.set(a.x,a.y,a.z,a.w),n.KeyFrame.tempAniQuat.slerp(l,r),n.KeyFrame.tempAniMatrix.compose(n.KeyFrame.tempAniPos,n.KeyFrame.tempAniQuat,n.KeyFrame.tempAniScale)}}};n.KeyFrame.tempAniPos=new yu,n.KeyFrame.tempAniQuat=new xu,n.KeyFrame.tempAniScale=new yu(1,1,1),n.KeyFrame.tempAniMatrix=new gu,n.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(t){this.keys.push(t)},this.init=function(){if(this.sortKeys(),this.length=this.keys.length>0?this.keys[this.keys.length-1].time:0,this.fps)for(var t=0;t<this.length*this.fps;t++)for(var e=0;e<this.keys.length;e++){if(this.keys[e].time==t){this._accelTable[t]=e;break}if(this.keys[e].time<t/this.fps&&this.keys[e+1]&&this.keys[e+1].time>=t/this.fps){this._accelTable[t]=e;break}}},this.parseFromThree=function(t){var e=t.fps;this.target=t.node;for(var r=t.hierarchy[0].keys,i=0;i<r.length;i++)this.addKey(new n.KeyFrame(i/e||r[i].time,r[i].targets[0].data));this.init()},this.parseFromCollada=function(t){for(var e=t.keys,r=this.fps,i=0;i<e.length;i++)this.addKey(new n.KeyFrame(i/r||e[i].time,e[i].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(t,e){return t.time-e.time},this.clone=function(){var t=new n.KeyFrameTrack;t.target=this.target,t.time=this.time,t.length=this.length;for(var e=0;e<this.keys.length;e++)t.addKey(this.keys[e].clone());return t.init(),t},this.reTarget=function(t,e){e||(e=n.TrackTargetNodeNameCompare),this.target=e(t,this.target)},this.keySearchAccel=function(t){return t*=this.fps,t=Math.floor(t),this._accelTable[t]||0},this.setTime=function(t){t=Math.abs(t),this.length&&(t=t%this.length+.05);for(var e=null,r=null,n=this.keySearchAccel(t);n<this.keys.length;n++){if(this.keys[n].time==t){e=this.keys[n],r=this.keys[n];break}if(this.keys[n].time<t&&this.keys[n+1]&&this.keys[n+1].time>t){e=this.keys[n],r=this.keys[n+1];break}if(this.keys[n].time<t&&n==this.keys.length-1){e=this.keys[n],(r=this.keys[0].clone()).time+=this.length+.05;break}}return e&&r&&e!==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.lerp(r,t)),void(this.target.matrixWorldNeedsUpdate=!0)):e&&r&&e==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},n.TrackTargetNodeNameCompare=function(t,e){return function t(e,r){if(e.name==r)return e;for(var n=0;n<e.children.length;n++){var i=t(e.children[n],r);if(i)return i}return null}(t,e.name)},n.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(t){this.tracks.push(t),this.length=Math.max(t.length,this.length)},this.setTime=function(t){this.time=t;for(var e=0;e<this.tracks.length;e++)this.tracks[e].setTime(t)},this.clone=function(t,e){e||(e=n.TrackTargetNodeNameCompare);var r=new n.Animation;r.target=t;for(var i=0;i<this.tracks.length;i++){var o=this.tracks[i].clone();o.reTarget(t,e),r.addTrack(o)}return r}};var i=4660,o=4661,a=4662,s=4663,l=4664,c=4665,u=4666,h=4667,d=4668,p=4669,f=4670,m=1,v=2,g=4,y=256,x=65536,b=1,w=4,_=1,S=3,T=1,M=6,A=8,E=10,C=4;function P(t){return y<<t}function O(t){return x<<t}function N(t,e){var r=new Wh;for(var n in r.matrix.copy(t.matrix),r.matrixWorld.copy(t.matrixWorld),r.position.copy(t.position),r.quaternion.copy(t.quaternion),r.scale.copy(t.scale),e.nodeCount++,r.name="bone_"+t.name+e.nodeCount.toString(),e.nodeToBoneMap[t.name]||(e.nodeToBoneMap[t.name]=[]),e.nodeToBoneMap[t.name].push(r),t.children){var i=N(t.children[n],e);i&&r.add(i)}return r}function L(t,e){for(var r=[],n=0;n<t.length;n++)r.push({i:t[n],w:e[n]});for(r.sort(function(t,e){return e.w-t.w});r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);var i=0;for(n=0;n<4;n++)i+=r[n].w*r[n].w;for(i=Math.sqrt(i),n=0;n<4;n++)r[n].w=r[n].w/i,t[n]=r[n].i,e[n]=r[n].w}function I(t,e){if(0==t.name.indexOf("bone_"+e))return t;for(var r in t.children){var n=I(t.children[r],e);if(n)return n}}function R(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(t,e){if(0!=this.mBones.length){for(var r=[],n=[],i=t.findNode(this.mBones[0].mName);i.mParent&&i.mParent.isBone;)i=i.mParent;var o=N(i.toTHREE(t),t);this.threeNode.add(o);for(var a=0;a<this.mBones.length;a++)if(s=I(o,this.mBones[a].mName))r.push(s),n.push(this.mBones[a].mOffsetMatrix.toTHREE());else{if(!(i=t.findNode(this.mBones[a].mName)))return;o=N(i.toTHREE(t),t),this.threeNode.add(o);var s=I(o,this.mBones[a].mName);r.push(s),n.push(this.mBones[a].mOffsetMatrix.toTHREE())}var l=new Df(r,n);this.threeNode.bind(l,new gu),this.threeNode.material.skinning=!0}},this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var e,r,n=new Yu;if(e=t.mMaterials[this.mMaterialIndex]?t.mMaterials[this.mMaterialIndex].toTHREE(t):new Rd,n.setIndex(new Du(new Uint32Array(this.mIndexArray),1)),n.addAttribute("position",new Du(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&n.addAttribute("normal",new Du(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&n.addAttribute("color",new Du(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&n.addAttribute("uv",new Du(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&n.addAttribute("uv1",new Du(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&n.addAttribute("tangents",new Du(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&n.addAttribute("bitangents",new Du(this.mBitangentBuffer,3)),this.mBones.length>0){for(var i=[],o=[],a=0;a<this.mBones.length;a++)for(var s=0;s<this.mBones[a].mWeights.length;s++){var l=this.mBones[a].mWeights[s];l&&(i[l.mVertexId]||(i[l.mVertexId]=[]),o[l.mVertexId]||(o[l.mVertexId]=[]),i[l.mVertexId].push(l.mWeight),o[l.mVertexId].push(parseInt(a)))}for(var a in o)L(o[a],i[a]);var c=[],u=[];for(a=0;a<i.length;a++)for(s=0;s<4;s++)i[a]&&o[a]?(c.push(i[a][s]),u.push(o[a][s])):(c.push(0),u.push(0));n.addAttribute("skinWeight",new Du(new Float32Array(c),C)),n.addAttribute("skinIndex",new Du(new Float32Array(u),C))}return 0==this.mBones.length&&(r=new zh(n,e)),this.mBones.length>0&&(r=new Ff(n,e)),this.threeNode=r,r}}function D(){this.mNumIndices=0,this.mIndices=[]}function F(){this.data=[],this.toString=function(){var t="";return this.data.forEach(function(e){t+=String.fromCharCode(e)}),t.replace(/[^\x20-\x7E]+/g,"")}}function U(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var e=new Mu;e.name=this.mName,e.matrix=this.mTransformation.toTHREE();for(var r=0;r<this.mChildren.length;r++)e.add(this.mChildren[r].toTHREE(t));for(r=0;r<this.mMeshes.length;r++)e.add(t.mMeshes[this.mMeshes[r]].toTHREE(t));return this.threeNode=e,e.matrix.decompose(e.position,e.quaternion,e.scale),e}}function k(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function B(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var t=new Uint8Array(this.mData).buffer,e=new DataView(t);return new Eu(e.getFloat32(0,!0),e.getFloat32(4,!0),e.getFloat32(8,!0))},this.dataAsFloat=function(){var t=new Uint8Array(this.mData).buffer;return new DataView(t).getFloat32(0,!0)},this.dataAsBool=function(){var t=new Uint8Array(this.mData).buffer;return!!new DataView(t).getFloat32(0,!0)},this.dataAsString=function(){var t=new F;return t.data=this.mData,t.toString()},this.dataAsMap=function(){var t=new F;t.data=this.mData;var e=t.toString();return-1!=(e=e.replace(/\\/g,"/")).indexOf("/")&&(e=e.substr(e.lastIndexOf("/")+1)),r.load(e)}}var j={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},z={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function V(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(t){this.mProperties[0].dataAsString();for(var e=new Fd,r=0;r<this.mProperties.length;r++)if("float"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsFloat()),"color"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsColor()),"bool"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsBool()),"string"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsString()),"map"==z[this.mProperties[r].mKey]){var n=this.mProperties[r];n.mSemantic==T&&(e.map=this.mProperties[r].dataAsMap()),n.mSemantic==M&&(e.normalMap=this.mProperties[r].dataAsMap()),n.mSemantic==E&&(e.lightMap=this.mProperties[r].dataAsMap()),n.mSemantic==A&&(e.alphaMap=this.mProperties[r].dataAsMap())}return e.ambient.r=.53,e.ambient.g=.53,e.ambient.b=.53,e.color.r=1,e.color.g=1,e.color.b=1,e}}function G(t,e,r){var n=new yu,i=1-r;return n.x=t.x*r+e.x*i,n.y=t.y*r+e.y*i,n.z=t.z*r+e.z*i,n}function H(t,e,r){return t.clone().slerp(e,1-r)}function W(t,e,r,n){if(1==t.length)return t[0].mValue.toTHREE();for(var i=1/0,o=null,a=null,s=0;s<t.length;s++){var l=Math.abs(t[s].mTime-e);l<i&&t[s].mTime<=e&&(i=l,o=t[s],a=t[s+1])}if(o){if(a){var c=(o.mTime-e)/(a.mTime-o.mTime);return n(o.mValue.toTHREE(),a.mValue.toTHREE(),c)}return(a=t[0].clone()).mTime+=r,c=(o.mTime-e)/(a.mTime-o.mTime),n(o.mValue.toTHREE(),a.mValue.toTHREE(),c)}return null}function X(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(t){function e(e){e.mTime/=t}t||(t=1),this.mPositionKeys.forEach(e),this.mRotationKeys.forEach(e),this.mScalingKeys.forEach(e)},this.sortKeys=function(){function t(t,e){return t.mTime-e.mTime}this.mPositionKeys.sort(t),this.mRotationKeys.sort(t),this.mScalingKeys.sort(t)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(t){return t.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(t){return t.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(t){return t.mTime})))},this.toTHREE=function(t,e){this.sortKeys();for(var r=this.getLength(),i=new n.KeyFrameTrack,o=0;o<r;o+=.05){var a=new gu,s=o,l=W(this.mPositionKeys,s,r,G),c=W(this.mScalingKeys,s,r,G),u=W(this.mRotationKeys,s,r,H);a.compose(l,u,c);var h=new n.KeyFrame(s,a);i.addKey(h)}i.target=t.findNode(this.mNodeName).toTHREE();var d=[i];if(t.nodeToBoneMap[this.mNodeName])for(o=0;o<t.nodeToBoneMap[this.mNodeName].length;o++){var p=i.clone();p.target=t.nodeToBoneMap[this.mNodeName][o],d.push(p)}return d}}function Y(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(t){var e=new n.Animation;for(var r in this.mChannels){this.mChannels[r].init(this.mTicksPerSecond);var i=this.mChannels[r].toTHREE(t);for(var o in i)i[o].init(),e.addTrack(i[o])}return e.length=Math.max.apply(null,e.tracks.map(function(t){return t.length})),e}}function q(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function J(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function Z(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}var Q=!0;function K(t){var e=t.getFloat32(t.readOffset,Q);return t.readOffset+=4,e}function $(t){var e=t.getFloat64(t.readOffset,Q);return t.readOffset+=8,e}function tt(t){var e=t.getUint8(t.readOffset);return t.readOffset+=1,e}function et(t){var e=t.getUint16(t.readOffset,Q);return t.readOffset+=2,e}function rt(t){var e=t.getUint32(t.readOffset,Q);return t.readOffset+=4,e}function nt(t){var e=t.getUint32(t.readOffset,Q);return t.readOffset+=4,e}function it(t){var e=new function(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new yu(this.x,this.y,this.z)}};return e.x=K(t),e.y=K(t),e.z=K(t),e}function ot(t){var e=new function(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new Eu(this.r,this.g,this.b,1)}};return e.r=K(t),e.g=K(t),e.b=K(t),e}function at(t){var e=new F,r=rt(t);return t.ReadBytes(e.data,1,r),e.toString()}function st(t){var e=new function(){this.mVertexId=0,this.mWeight=0};return e.mVertexId=rt(t),e.mWeight=K(t),e}function lt(t){for(var e=new function(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var t=new gu,e=0;e<4;++e)for(var r=0;r<4;++r)t.elements[4*e+r]=this.elements[r][e];return t}},r=0;r<4;++r)for(var n=0;n<4;++n)e.elements[r][n]=K(t);return e}function ct(t){var e=new function(){this.mTime=0,this.mValue=null};return e.mTime=$(t),e.mValue=it(t),e}function ut(t){var e=new function(){this.mTime=0,this.mValue=null};return e.mTime=$(t),e.mValue=function(t){var e=new function(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new xu(this.x,this.y,this.z,this.w)}};return e.w=K(t),e.x=K(t),e.y=K(t),e.z=K(t),e}(t),e}function ht(t,e,r){for(var n=0;n<r;n++)e[n]=ct(t)}function dt(t,e,r){return t.Seek(sizeof(e)*r,At)}function pt(t){if(!t)throw"asset failed"}function ft(t,e){return pt(nt(t)==u),nt(t),e.mName=at(t),e.mNumWeights=rt(t),e.mOffsetMatrix=lt(t),Tt?dt(t,e.mWeights,e.mNumWeights):(e.mWeights=[],function(t,e,r){for(var n=0;n<r;n++)e[n]=st(t)}(t,e.mWeights,e.mNumWeights)),e}function mt(t,e){pt(nt(t)==s),nt(t),e.mPrimitiveTypes=rt(t),e.mNumVertices=rt(t),e.mNumFaces=rt(t),e.mNumBones=rt(t),e.mMaterialIndex=rt(t),e.mNumUVComponents=[];var r=rt(t);r&m&&(Tt?dt(t,e.mVertices,e.mNumVertices):(e.mVertices=[],e.mVertexBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At))),r&v&&(Tt?dt(t,e.mNormals,e.mNumVertices):(e.mNormals=[],e.mNormalBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At))),r&g&&(Tt?(dt(t,e.mTangents,e.mNumVertices),dt(t,e.mBitangents,e.mNumVertices)):(e.mTangents=[],e.mTangentBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At),e.mBitangents=[],e.mBitangentBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At)));for(var n=0;n<b&&r&O(n);++n)Tt?dt(t,e.mColors[n],e.mNumVertices):(e.mColors[n]=[],e.mColorBuffer=t.subArray32(t.readOffset,t.readOffset+4*e.mNumVertices*4),t.Seek(4*e.mNumVertices*4,At));for(e.mTexCoordsBuffers=[],n=0;n<w&&r&P(n);++n)if(e.mNumUVComponents[n]=rt(t),Tt)dt(t,e.mTextureCoords[n],e.mNumVertices);else{e.mTextureCoords[n]=[],e.mTexCoordsBuffers[n]=[];for(var i=0;i<e.mNumVertices;i++)e.mTexCoordsBuffers[n].push(K(t)),e.mTexCoordsBuffers[n].push(K(t)),K(t)}if(Tt)rt(t);else{e.mFaces=[],e.mIndexArray=[];for(var o=0;o<e.mNumFaces;++o){var a=e.mFaces[o]=new D;a.mNumIndices=et(t),a.mIndices=[];for(var l=0;l<a.mNumIndices;++l)a.mIndices[l]=e.mNumVertices<65536?et(t):rt(t);if(3===a.mNumIndices)e.mIndexArray.push(a.mIndices[0]),e.mIndexArray.push(a.mIndices[1]),e.mIndexArray.push(a.mIndices[2]);else{if(4!==a.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");e.mIndexArray.push(a.mIndices[0]),e.mIndexArray.push(a.mIndices[1]),e.mIndexArray.push(a.mIndices[2]),e.mIndexArray.push(a.mIndices[2]),e.mIndexArray.push(a.mIndices[3]),e.mIndexArray.push(a.mIndices[0])}}}if(e.mNumBones)for(e.mBones=[],l=0;l<e.mNumBones;++l)e.mBones[l]=new k,ft(t,e.mBones[l])}function vt(t,e){pt(nt(t)==f),nt(t),e.mKey=at(t),e.mSemantic=rt(t),e.mIndex=rt(t),e.mDataLength=rt(t),e.mType=rt(t),e.mData=[],t.ReadBytes(e.mData,1,e.mDataLength)}function gt(t,e){if(pt(nt(t)==p),nt(t),e.mNumAllocated=e.mNumProperties=rt(t),e.mNumProperties){e.mProperties&&delete e.mProperties,e.mProperties=[];for(var r=0;r<e.mNumProperties;++r)e.mProperties[r]=new B,vt(t,e.mProperties[r])}}function yt(t,e){pt(nt(t)==l),nt(t),e.mNodeName=at(t),e.mNumPositionKeys=rt(t),e.mNumRotationKeys=rt(t),e.mNumScalingKeys=rt(t),e.mPreState=rt(t),e.mPostState=rt(t),e.mNumPositionKeys&&(Tt?dt(t,e.mPositionKeys,e.mNumPositionKeys):(e.mPositionKeys=[],ht(t,e.mPositionKeys,e.mNumPositionKeys))),e.mNumRotationKeys&&(Tt?dt(t,e.mRotationKeys,e.mNumRotationKeys):(e.mRotationKeys=[],function(t,e,r){for(var n=0;n<r;n++)e[n]=ut(t)}(t,e.mRotationKeys,e.mNumRotationKeys))),e.mNumScalingKeys&&(Tt?dt(t,e.mScalingKeys,e.mNumScalingKeys):(e.mScalingKeys=[],ht(t,e.mScalingKeys,e.mNumScalingKeys)))}function xt(t,e){if(pt(nt(t)==h),nt(t),e.mName=at(t),e.mDuration=$(t),e.mTicksPerSecond=$(t),e.mNumChannels=rt(t),e.mNumChannels){e.mChannels=[];for(var r=0;r<e.mNumChannels;++r)e.mChannels[r]=new X,yt(t,e.mChannels[r])}}function bt(t,e){pt(nt(t)==a),nt(t),e.mWidth=rt(t),e.mHeight=rt(t),t.ReadBytes(e.achFormatHint,1,4),Tt||(e.mHeight?(e.pcData=[],t.ReadBytes(e.pcData,1,e.mWidth*e.mHeight*4)):(e.pcData=[],t.ReadBytes(e.pcData,1,e.mWidth)))}function wt(t,e){pt(nt(t)==o),nt(t),e.mName=at(t),e.mType=rt(t),e.mType!=_&&(e.mAttenuationConstant=K(t),e.mAttenuationLinear=K(t),e.mAttenuationQuadratic=K(t)),e.mColorDiffuse=ot(t),e.mColorSpecular=ot(t),e.mColorAmbient=ot(t),e.mType==S&&(e.mAngleInnerCone=K(t),e.mAngleOuterCone=K(t))}function _t(t,e){pt(nt(t)==i),nt(t),e.mName=at(t),e.mPosition=it(t),e.mLookAt=it(t),e.mUp=it(t),e.mHorizontalFOV=K(t),e.mClipPlaneNear=K(t),e.mClipPlaneFar=K(t),e.mAspect=K(t)}function St(t,e){if(pt(nt(t)==c),nt(t),e.mFlags=rt(t),e.mNumMeshes=rt(t),e.mNumMaterials=rt(t),e.mNumAnimations=rt(t),e.mNumTextures=rt(t),e.mNumLights=rt(t),e.mNumCameras=rt(t),e.mRootNode=new U,e.mRootNode=function t(e,r,n){pt(nt(e)==d),nt(e);var i=new U;if(i.mParent=r,i.mDepth=n,i.mName=at(e),i.mTransformation=lt(e),i.mNumChildren=rt(e),i.mNumMeshes=rt(e),i.mNumMeshes){i.mMeshes=[];for(var o=0;o<i.mNumMeshes;++o)i.mMeshes[o]=rt(e)}if(i.mNumChildren)for(i.mChildren=[],o=0;o<i.mNumChildren;++o){var a=t(e,i,n++);i.mChildren[o]=a}return i}(t,null,0),e.mNumMeshes){e.mMeshes=[];for(var r=0;r<e.mNumMeshes;++r)e.mMeshes[r]=new R,mt(t,e.mMeshes[r])}if(e.mNumMaterials)for(e.mMaterials=[],r=0;r<e.mNumMaterials;++r)e.mMaterials[r]=new V,gt(t,e.mMaterials[r]);if(e.mNumAnimations)for(e.mAnimations=[],r=0;r<e.mNumAnimations;++r)e.mAnimations[r]=new Y,xt(t,e.mAnimations[r]);if(e.mNumTextures)for(e.mTextures=[],r=0;r<e.mNumTextures;++r)e.mTextures[r]=new q,bt(t,e.mTextures[r]);if(e.mNumLights)for(e.mLights=[],r=0;r<e.mNumLights;++r)e.mLights[r]=new J,wt(t,e.mLights[r]);if(e.mNumCameras)for(e.mCameras=[],r=0;r<e.mNumCameras;++r)e.mCameras[r]=new Z,_t(t,e.mCameras[r])}var Tt,Mt,At=0;return function(t){var e=new function(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(t,e){if(e||(e=this.mRootNode),e.mName==t)return e;for(var r=0;r<e.mChildren.length;r++){var n=this.findNode(t,e.mChildren[r]);if(n)return n}return null},this.toTHREE=function(){this.nodeCount=0,function(t){for(var e in t.mMeshes){var r=t.mMeshes[e];for(var n in r.mBones){var i=t.findNode(r.mBones[n].mName);i&&(i.isBone=!0)}}}(this);var t=this.mRootNode.toTHREE(this);for(var e in this.mMeshes)this.mMeshes[e].hookupSkeletons(this,t);if(this.mAnimations.length>0)var r=this.mAnimations[0].toTHREE(this);return{object:t,animation:r}}},r=new DataView(t);if(function(t){t.readOffset=0,t.Seek=function(e,r){r==At&&(t.readOffset+=e),1==r&&(t.readOffset=e)},t.ReadBytes=function(t,e,r){for(var n=e*r,i=0;i<n;i++)t[i]=tt(this)},t.subArray32=function(t,e){var r=this.buffer.slice(t,e);return new Float32Array(r)},t.subArrayUint16=function(t,e){var r=this.buffer.slice(t,e);return new Uint16Array(r)},t.subArrayUint8=function(t,e){var r=this.buffer.slice(t,e);return new Uint8Array(r)},t.subArrayUint32=function(t,e){var r=this.buffer.slice(t,e);return new Uint32Array(r)}}(r),r.Seek(44,At),rt(r),rt(r),rt(r),rt(r),Tt=et(r)>0,Mt=et(r)>0,Tt)throw"Shortened binaries are not supported!";if(r.Seek(256,At),r.Seek(128,At),r.Seek(64,At),!Mt)return St(r,e),e.toTHREE();var n=nt(r),i=r.FileSize()-r.Tell(),o=[];r.Read(o,1,i);var a=[];uncompress(a,n,o,i),St(new ArrayBuffer(a),e)}(t)}},Bf.prototype={set:function(t,e){this[t]=e},get:function(t,e){return this.hasOwnProperty(t)?this[t]:e}};var jf=function(t){this.manager=void 0!==t?t:Pd,this.trunk=new Mu,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new kf],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1};function zf(t,e){Mu.call(this),this.type="Light",this.color=new Eu(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Vf(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Nu(512,512),this.map=null,this.matrix=new gu}function Gf(t,e,r,n){zf.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new Vf(new fd(90,1,.5,500))}function Hf(){Vf.call(this,new gd(-5,5,5,-5,.5,500))}function Wf(t,e){zf.call(this,t,e),this.type="DirectionalLight",this.position.copy(Mu.DefaultUp),this.updateMatrix(),this.target=new Mu,this.shadow=new Hf}function Xf(){Vf.call(this,new fd(50,1,.5,500))}function Yf(t,e,r,n,i,o){zf.call(this,t,e),this.type="SpotLight",this.position.copy(Mu.DefaultUp),this.updateMatrix(),this.target=new Mu,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Xf}function qf(t,e,r){zf.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Mu.DefaultUp),this.updateMatrix(),this.groundColor=new Eu(e)}jf.prototype={constructor:jf,load:function(t,e,r,n){var i=this;this._url=t,this._baseDir=t.substr(0,t.lastIndexOf("/")+1);var o=new Nd(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){var e=t.byteLength;for(this._ptr=0,this._data=new DataView(t),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==t.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,e-this._ptr);this._ptr<e;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var t,e,r=this.readU32(),n=(this.readU8(),this.readU8()),i=(this.readU8(),this.readU32());switch(n){case 1:t=this.parseMeshData(i);break;case 22:t=this.parseContainer(i);break;case 23:t=this.parseMeshInstance(i);break;case 81:t=this.parseMaterial(i);break;case 82:t=this.parseTexture(i);break;case 101:t=this.parseSkeleton(i);break;case 112:t=this.parseMeshPoseAnimation(i,!1);break;case 113:t=this.parseVertexAnimationSet(i);break;case 102:t=this.parseSkeletonPose(i);break;case 103:t=this.parseSkeletonAnimation(i);break;case 122:t=this.parseAnimatorSet(i);break;default:this._ptr+=i}this._blocks[r]=e=new kf,e.data=t,e.id=r},_parseHeader:function(){var t=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");t[0]=this.readU8(),t[1]=this.readU8();var e=this.readU16();this._streaming=1==(1&e),2===t[0]&&1===t[1]&&(this._accuracyMatrix=2==(2&e),this._accuracyGeo=4==(4&e),this._accuracyProps=8==(8&e)),this._geoNrType=this._accuracyGeo?8:7,this._matrixNrType=this._accuracyMatrix?8:7,this._propsNrType=this._accuracyProps?8:7,this._optimized_for_accuracy=2==(2&e),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(t){var e=new Mu,r=this.readU32(),n=this.parseMatrix4();return e.name=this.readUTF(),e.applyMatrix(n),(this._blocks[r].data||this.trunk).add(e),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:4}),e.extra=this.parseUserAttributes(),e},parseMeshInstance:function(t){var e,r,n,i,o,a,s,l,c,u,h,d,p;for(a=this.readU32(),l=this.parseMatrix4(),e=this.readUTF(),s=this.readU32(),d=this.readU16(),n=this.getBlock(s),c=[],p=0;p<d;p++)h=this.readU32(),u=this.getBlock(h),c.push(u);if(o=[],(i=n.length)>1)for(r=new Mu,p=0;p<i;p++){var f=new zh(n[p]);o.push(f),r.add(f)}else r=new zh(n[0]),o.push(r);r.applyMatrix(l),r.name=e,(this.getBlock(a)||this.trunk).add(r);var m=c.length,v=Math.max(i,m);for(p=0;p<v;p++)o[p%i].material=c[p%m];return this.parseProperties(null),r.extra=this.parseUserAttributes(),r},parseMaterial:function(t){var e,r,n,i,o,a;for(e=this.readUTF(),r=this.readU8(),a=this.readU8(),n=this.parseProperties({1:3,2:23,11:21,12:7,13:21});0<a;)this.readU16(),this.parseProperties(null),this.parseUserAttributes();if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(i=this.materialFactory(e)))return i;if(i=new Fd,1===r)i.color.setHex(n.get(1,13421772));else if(2===r){var s=n.get(2,0);i.map=this.getBlock(s)}return i.extra=o,i.alphaThreshold=n.get(12,0),i.repeat=n.get(13,!1),i},parseTexture:function(t){var e,r;if(this.readUTF(),0===this.readU8()){r=this.readU32();var n=this.readUTFBytes(r);console.log(n),e=this.loadTexture(n)}return this.parseProperties(null),this.parseUserAttributes(),e},loadTexture:function(t){var e=new xd;return new Wd(this.manager).load(this._baseDir+t,function(t){e.image=t,e.needsUpdate=!0}),e},parseSkeleton:function(t){this.readUTF();var e=this.readU16(),r=[],n=0;for(this.parseProperties(null);n<e;){var i,o;this.readU16(),(i=new Wh).parent=this.readU16()-1,i.name=this.readUTF(),o=this.parseMatrix4(),i.skinMatrix=o,this.parseProperties(null),this.parseUserAttributes(),r.push(i),n++}return this.parseUserAttributes(),r},parseSkeletonPose:function(t){this.readUTF();var e=this.readU16();this.parseProperties(null);for(var r=[],n=0;n<e;){var i;i=1===this.readU8()?this.parseMatrix4():new gu,r[n]=i,n++}return this.parseUserAttributes(),r},parseSkeletonAnimation:function(t){this.readUTF();var e,r,n=[],i=this.readU16();this.parseProperties(null);for(var o=0;o<i;)r=this.readU32(),e=this.readU16(),n.push({pose:this._blocks[r].data,duration:e}),o++;if(0!==n.length)return this.parseUserAttributes(),n},parseVertexAnimationSet:function(t){this.readUTF();for(var e,r=this.readU16(),n=(this.parseProperties({1:5}),0),i=[];n<r;)e=this.readU32(),i.push(this._blocks[e].data),n++;return this.parseUserAttributes(),i},parseAnimatorSet:function(t){this.readUTF();var e,r=this.readU16(),n=this.parseProperties({1:23});e=this.readU32();for(var i=this.readU16(),o=[],a=0;a<i;a++)o.push(this.readU32());this.readU16(),Boolean(this.readU8()),this.parseUserAttributes(),this.parseUserAttributes();var s,l=[];for(a=0;a<o.length;a++)l.push(this._blocks[o[a]].data);for(1==r&&(s={animationSet:this._blocks[e].data,skeleton:this._blocks[n.get(1,0)].data}),a=0;a<l.length;a++)l[a].animator=s;return s},parseMeshData:function(t){var e,r,n=this.readUTF(),i=this.readU16(),o=0,a=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});o<i;){var s,l,c;for((e=new Yu).name=n,a.push(e),s=this.readU32(),l=this._ptr+s,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<l;){var u=0,h=this.readU8(),d=(this.readU8(),this.readU32()),p=d+this._ptr;if(1===h)for(c=new Du(r=new Float32Array(d/12*3),3),e.addAttribute("position",c),u=0;this._ptr<p;)r[u]=-this.readF32(),r[u+1]=this.readF32(),r[u+2]=this.readF32(),u+=3;else if(2===h)for(c=new Du(r=new Uint16Array(d/2),1),e.setIndex(c),u=0;this._ptr<p;)r[u+1]=this.readU16(),r[u]=this.readU16(),r[u+2]=this.readU16(),u+=3;else if(3===h)for(c=new Du(r=new Float32Array(d/8*2),2),e.addAttribute("uv",c),u=0;this._ptr<p;)r[u]=this.readF32(),r[u+1]=1-this.readF32(),u+=2;else if(4===h)for(c=new Du(r=new Float32Array(d/12*3),3),e.addAttribute("normal",c),u=0;this._ptr<p;)r[u]=-this.readF32(),r[u+1]=this.readF32(),r[u+2]=this.readF32(),u+=3;else this._ptr=p}this.parseUserAttributes(),e.computeBoundingSphere(),o++}return this.parseUserAttributes(),a},parseMeshPoseAnimation:function(t,e){var r,n,i,o,a,s,l,c,u,h=1,d=0,p={},f=[],m=(this.readUTF(),this.readU32()),v=this.getBlock(m);if(null!==v){for((s=v.geometry).morphTargets=[],e||(h=this.readU16()),r=this.readU16(),l=this.readU16(),c=0;c<l;)f.push(this.readU16()),c++;for(u=this.parseProperties({1:21,2:21}),p.looping=u.get(1,!0),p.stitchFinalFrame=u.get(2,!1),n=0;n<h;){for(this.readU16(),i=0;i<r;)for(c=0,o=this.readU32(),a=this._ptr+o;c<l;){if(1===f[c]){var g=new Float32Array(o/4);for(s.morphTargets.push({array:g}),d=0;this._ptr<a;)g[d]=this.readF32(),g[d+1]=this.readF32(),g[d+2]=this.readF32(),d+=3;i++}else this._ptr=a;c++}n++}return this.parseUserAttributes(),null}console.log("parseMeshPoseAnimation target mesh not found at:",m)},getBlock:function(t){return this._blocks[t].data},parseMatrix4:function(){var t=new gu,e=t.elements;return e[0]=this.readF32(),e[1]=this.readF32(),e[2]=this.readF32(),e[3]=0,e[4]=this.readF32(),e[5]=this.readF32(),e[6]=this.readF32(),e[7]=0,e[8]=this.readF32(),e[9]=this.readF32(),e[10]=this.readF32(),e[11]=0,e[12]=-this.readF32(),e[13]=this.readF32(),e[14]=this.readF32(),e[15]=1,t},parseProperties:function(t){var e=this.readU32(),r=this._ptr+e,n=new Bf;if(t)for(;this._ptr<r;){var i=this.readU16(),o=this.readU32();t.hasOwnProperty(i)?n.set(i,this.parseAttrValue(t[i],o)):this._ptr+=o}return n},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(t,e){var r,n;switch(t){case 1:r=1,n=this.readI8;break;case 2:r=2,n=this.readI16;break;case 3:r=4,n=this.readI32;break;case 21:case 4:r=1,n=this.readU8;break;case 5:r=2,n=this.readU16;break;case 6:case 23:r=4,n=this.readU32;break;case 7:r=4,n=this.readF32;break;case 8:r=8,n=this.readF64;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:r=8,n=this.readF64}if(r<e){var i,o,a;for(i=[],o=0,a=e/r;o<a;)i.push(n.call(this)),o++;return i}return n.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var t=this._data.getUint16(this._ptr,!0);return this._ptr+=2,t},readI16:function(){var t=this._data.getInt16(this._ptr,!0);return this._ptr+=2,t},readU32:function(){var t=this._data.getUint32(this._ptr,!0);return this._ptr+=4,t},readI32:function(){var t=this._data.getInt32(this._ptr,!0);return this._ptr+=4,t},readF32:function(){var t=this._data.getFloat32(this._ptr,!0);return this._ptr+=4,t},readF64:function(){var t=this._data.getFloat64(this._ptr,!0);return this._ptr+=8,t},readUTF:function(){var t=this.readU16();return this.readUTFBytes(t)},readUTFBytes:function(t){for(var e=[],r=0;e.length<t;){var n=this._data.getUint8(this._ptr++,!0);if(n<128)e[r++]=String.fromCharCode(n);else if(n>191&&n<224){var i=this._data.getUint8(this._ptr++,!0);e[r++]=String.fromCharCode((31&n)<<6|63&i)}else{i=this._data.getUint8(this._ptr++,!0);var o=this._data.getUint8(this._ptr++,!0);e[r++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&o)}}return e.join("")}},zf.prototype=Object.assign(Object.create(Mu.prototype),{constructor:zf,isLight:!0,copy:function(t){return Mu.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=Mu.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Object.assign(Vf.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Gf.prototype=Object.assign(Object.create(zf.prototype),{constructor:Gf,isPointLight:!0,copy:function(t){return zf.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Hf.prototype=Object.assign(Object.create(Vf.prototype),{constructor:Hf}),Wf.prototype=Object.assign(Object.create(zf.prototype),{constructor:Wf,isDirectionalLight:!0,copy:function(t){return zf.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Xf.prototype=Object.assign(Object.create(Vf.prototype),{constructor:Xf,isSpotLightShadow:!0,update:function(t){var e=this.camera,r=2*vu.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix())}}),Yf.prototype=Object.assign(Object.create(zf.prototype),{constructor:Yf,isSpotLight:!0,copy:function(t){return zf.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),qf.prototype=Object.assign(Object.create(zf.prototype),{constructor:qf,isHemisphereLight:!0,copy:function(t){return zf.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}});var Jf=function(t){this.manager=void 0!==t?t:Pd};Jf.prototype={constructor:Jf,load:function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){function e(t){var e=new Yu,r=t.positions,n=t.normals,i=t.uvs;e.setIndex(t.indices);for(var o=2,a=r.length;o<a;o+=3)r[o]=-r[o];if(e.addAttribute("position",new Gu(r,3)),n){for(o=2,a=n.length;o<a;o+=3)n[o]=-n[o];e.addAttribute("normal",new Gu(n,3))}i&&e.addAttribute("uv",new Gu(i,2));var s=t.subMeshes;if(s)for(o=0,a=s.length;o<a;o++){var l=s[o];e.addGroup(l.indexStart,l.indexCount)}return e}return function(t,r){for(var n={},i=new vd,o=t.cameras,a=0,s=o.length;a<s;a++){var l=new fd((d=o[a]).fov/Math.PI*180,1.33,d.minZ,d.maxZ);l.name=d.name,l.position.fromArray(d.position),d.rotation&&l.rotation.fromArray(d.rotation),n[d.id]=l}var c=t.lights;for(a=0,s=c.length;a<s;a++){var u;switch((d=c[a]).type){case 0:u=new Gf;break;case 1:u=new Wf;break;case 2:u=new Yf;break;case 3:u=new qf}u.name=d.name,d.position&&u.position.set(d.position[0],d.position[1],-d.position[2]),u.color.fromArray(d.diffuse),d.groundColor&&u.groundColor.fromArray(d.groundColor),d.intensity&&(u.intensity=d.intensity),n[d.id]=u,i.add(u)}var h=t.meshes;for(a=0,s=h.length;a<s;a++){var d,p;(p=(d=h[a]).indices?new zh(e(d),r[d.materialId]):new Nf).name=d.name,p.position.set(d.position[0],d.position[1],-d.position[2]),p.rotation.fromArray(d.rotation),d.rotationQuaternion&&p.quaternion.fromArray(d.rotationQuaternion),p.scale.fromArray(d.scaling),d.parentId?n[d.parentId].add(p):i.add(p),n[d.id]=p}return i}(t,function(t){for(var e={},r=0,n=t.materials.length;r<n;r++){var i=t.materials[r],o=new Fd;o.name=i.name,o.color.fromArray(i.diffuse),o.emissive.fromArray(i.emissive),o.specular.fromArray(i.specular),o.shininess=i.specularPower,o.opacity=i.alpha,e[i.id]=o}if(t.multiMaterials)for(r=0,n=t.multiMaterials.length;r<n;r++)i=t.multiMaterials[r],console.warn("BabylonLoader: Multi materials not yet supported."),e[i.id]=new Fd;return e}(t))}};var Zf=function(t){this.manager=void 0!==t?t:Pd,this.animateBonePositions=!0,this.animateBoneRotations=!0};function Qf(t,e){zf.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Kf(t,e){Vh.call(this,t,e),this.type="LineSegments"}Zf.prototype={constructor:Zf,load:function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t,r,n){if("ENDSITE"!==n.type){var i={time:r,position:new yu,rotation:new xu};n.frames.push(i);for(var o=new xu,a=new yu(1,0,0),s=new yu(0,1,0),l=new yu(0,0,1),c=0;c<n.channels.length;c++)switch(n.channels[c]){case"Xposition":i.position.x=parseFloat(t.shift().trim());break;case"Yposition":i.position.y=parseFloat(t.shift().trim());break;case"Zposition":i.position.z=parseFloat(t.shift().trim());break;case"Xrotation":o.setFromAxisAngle(a,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(s,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(l,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;default:console.warn("BVHLoader: Invalid channel type.")}for(c=0;c<n.children.length;c++)e(t,r,n.children[c])}}function r(t){for(var e;0===(e=t.shift().trim()).length;);return e}var n=this,i=function(t){"HIERARCHY"!==r(t)&&console.error("BVHLoader: HIERARCHY expected.");var n=[],i=function t(e,n,i){var o={name:"",type:"",frames:[]};i.push(o);var a=n.split(/[\s]+/);"END"===a[0].toUpperCase()&&"SITE"===a[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=a[1],o.type=a[0].toUpperCase()),"{"!==r(e)&&console.error("BVHLoader: Expected opening { after type & name"),"OFFSET"!==(a=r(e).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected OFFSET but got: "+a[0]),4!==a.length&&console.error("BVHLoader: Invalid number of values for OFFSET.");var s=new yu(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));if((isNaN(s.x)||isNaN(s.y)||isNaN(s.z))&&console.error("BVHLoader: Invalid values of OFFSET."),o.offset=s,"ENDSITE"!==o.type){"CHANNELS"!==(a=r(e).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected CHANNELS definition.");var l=parseInt(a[1]);o.channels=a.splice(2,l),o.children=[]}for(;;){var c=r(e);if("}"===c)return o;o.children.push(t(e,c,i))}}(t,r(t),n);"MOTION"!==r(t)&&console.error("BVHLoader: MOTION expected.");var o=r(t).split(/[\s]+/),a=parseInt(o[1]);isNaN(a)&&console.error("BVHLoader: Failed to read number of frames."),o=r(t).split(/[\s]+/);var s=parseFloat(o[2]);isNaN(s)&&console.error("BVHLoader: Failed to read frame time.");for(var l=0;l<a;l++)e(o=r(t).split(/[\s]+/),l*s,i);return n}(t.split(/[\r\n]+/g)),o=[];!function t(e,r){var n=new Wh;if(r.push(n),n.position.add(e.offset),n.name=e.name,"ENDSITE"!==e.type)for(var i=0;i<e.children.length;i++)n.add(t(e.children[i],r));return n}(i[0],o);var a=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];if("ENDSITE"!==i.type){for(var o=[],a=[],s=[],l=0;l<i.frames.length;l++){var c=i.frames[l];o.push(c.time),a.push(c.position.x+i.offset.x),a.push(c.position.y+i.offset.y),a.push(c.position.z+i.offset.z),s.push(c.rotation.x),s.push(c.rotation.y),s.push(c.rotation.z),s.push(c.rotation.w)}n.animateBonePositions&&e.push(new id(".bones["+i.name+"].position",o,a)),n.animateBoneRotations&&e.push(new rd(".bones["+i.name+"].quaternion",o,s))}}return new hd("animation",-1,e)}(i);return{skeleton:new Df(o),clip:a}}},Qf.prototype=Object.assign(Object.create(zf.prototype),{constructor:Qf,isAmbientLight:!0}),Kf.prototype=Object.assign(Object.create(Vh.prototype),{constructor:Kf,isLineSegments:!0,computeLineDistances:function(){var t=new yu,e=new yu;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],o=0,a=n.count;o<a;o+=2)t.fromBufferAttribute(n,o),e.fromBufferAttribute(n,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e);r.addAttribute("lineDistance",new Gu(i,1))}else console.warn("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for(i=r.lineDistances,o=0,a=s.length;o<a;o+=2)t.copy(s[o]),e.copy(s[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e)}return this}}()});var $f=function(t){this.manager=void 0!==t?t:Pd};function tm(t,e,r,n,i,o,a,s,l,c,u,h){xd.call(this,null,o,a,s,l,c,n,i,u,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function em(t){this.manager=void 0!==t?t:Pd,this._parser=null}$f.prototype={constructor:$f,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=void 0===i.path?qd.extractUrlBase(t):i.path;new Nd(i.manager).load(t,function(t){e(i.parse(t,o))},r,n)},setPath:function(t){this.path=t},options:{set convertUpAxis(t){console.warn("ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){function r(t,e){for(var r=[],n=t.childNodes,i=0,o=n.length;i<o;i++){var a=n[i];a.nodeName===e&&r.push(a)}return r}function n(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),n=0,i=e.length;n<i;n++)r[n]=e[n];return r}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),n=0,i=e.length;n<i;n++)r[n]=parseFloat(e[n]);return r}function o(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),n=0,i=e.length;n<i;n++)r[n]=parseInt(e[n]);return r}function a(t){return t.substring(1)}function s(t){return 0===Object.keys(t).length}function l(t,e,n,i){var o=r(t,e)[0];if(void 0!==o)for(var a=r(o,n),s=0;s<a.length;s++)i(a[s])}function c(t,e){for(var r in t)t[r].build=e(t[r])}function u(t,e){return void 0!==t.build?t.build:(t.build=e(t),t.build)}function h(t){for(var e={inputs:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=a(i.getAttribute("source")),s=i.getAttribute("semantic");e.inputs[s]=o}}return e}function d(t){var e={},r=t.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),o=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)i=(r=i.split(".")).shift(),e.member=r.shift();else if(o){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));e.indices=l}return e.id=n,e.sid=i,e.arraySyntax=o,e.memberSyntax=s,e.sampler=a(t.getAttribute("source")),e}function p(t){var e=[],r=t.channels,n=t.samplers,i=t.sources;for(var o in r)if(r.hasOwnProperty(o)){var a=r[o],s=n[a.sampler];x(m(a,i[s.inputs.INPUT],i[s.inputs.OUTPUT]),e)}return e}function f(t){return u(Vt.animations[t],p)}function m(t,e,r){var n,i,o,a,s,l,c=Vt.nodes[t.id],u=Ot(c.id),h=c.transforms[t.sid],d=c.matrix.clone().transpose(),p={};switch(h){case"matrix":for(o=0,a=e.array.length;o<a;o++)if(i=o*r.stride,void 0===p[n=e.array[o]]&&(p[n]={}),!0===t.arraySyntax)p[n][t.indices[0]+4*t.indices[1]]=r.array[i];else for(s=0,l=r.stride;s<l;s++)p[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var f=function(t,e){var r=[];for(var n in t)r.push({time:parseFloat(n),value:t[n]});r.sort(function(t,e){return t.time-e.time});for(var i=0;i<16;i++)b(r,i,e.elements[i]);return r}(p,d);return{name:u.uuid,keyframes:f}}var v=new yu,g=new yu,y=new xu;function x(t,e){for(var r=t.keyframes,n=t.name,i=[],o=[],a=[],s=[],l=0,c=r.length;l<c;l++){var u=r[l],h=u.time;bt.fromArray(u.value).transpose(),bt.decompose(v,y,g),i.push(h),o.push(v.x,v.y,v.z),a.push(y.x,y.y,y.z,y.w),s.push(g.x,g.y,g.z)}return o.length>0&&e.push(new id(n+".position",i,o)),a.length>0&&e.push(new rd(n+".quaternion",i,a)),s.length>0&&e.push(new id(n+".scale",i,s)),e}function b(t,e,r){var n,i,o,a=!0;for(i=0,o=t.length;i<o;i++)void 0===(n=t[i]).value[e]?n.value[e]=null:a=!1;if(!0===a)for(i=0,o=t.length;i<o;i++)(n=t[i]).value[e]=r;else!function(t,e){for(var r,n,i=0,o=t.length;i<o;i++){var a=t[i];if(null===a.value[e]){if(r=w(t,i,e),n=_(t,i,e),null===r){a.value[e]=n.value[e];continue}if(null===n){a.value[e]=r.value[e];continue}S(a,r,n,e)}}}(t,e)}function w(t,e,r){for(;e>=0;){var n=t[e];if(null!==n.value[r])return n;e--}return null}function _(t,e,r){for(;e<t.length;){var n=t[e];if(null!==n.value[r])return n;e++}return null}function S(t,e,r,n){t.value[n]=r.time-e.time!=0?(t.time-e.time)*(r.value[n]-e.value[n])/(r.time-e.time)+e.value[n]:e.value[n]}function T(t){for(var e=[],r=t.name,n=t.end-t.start||-1,i=t.animations,o=0,a=i.length;o<a;o++)for(var s=f(i[o]),l=0,c=s.length;l<c;l++)e.push(s[l]);return new hd(r,n,e)}function M(t){return u(Vt.clips[t],T)}function A(t){for(var e={sources:{}},r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=i(o.textContent);break;case"source":var a=o.getAttribute("id");e.sources[a]=nt(o);break;case"joints":e.joints=E(o);break;case"vertex_weights":e.vertexWeights=C(o)}}return e}function E(t){for(var e={inputs:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),s=a(i.getAttribute("source"));e.inputs[o]=s}}return e}function C(t){for(var e={inputs:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=a(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));e.inputs[s]={id:l,offset:c};break;case"vcount":e.vcount=o(i.textContent);break;case"v":e.v=o(i.textContent)}}return e}function P(t){var e={id:t.id},r=Vt.geometries[e.id];return void 0!==t.skin&&(e.skin=function(t){var e,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=t.vertexWeights,a=o.vcount,s=o.v,l=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,u=t.sources[t.joints.inputs.JOINT],h=t.sources[t.joints.inputs.INV_BIND_MATRIX],d=t.sources[o.inputs.WEIGHT.id].array,p=0;for(e=0,n=a.length;e<n;e++){var f=a[e],m=[];for(r=0;r<f;r++)m.push({index:s[p+l],weight:d[s[p+c]]}),p+=2;for(m.sort(x),r=0;r<4;r++){var v=m[r];void 0!==v?(i.indices.array.push(v.index),i.weights.array.push(v.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(i.bindMatrix=(new gu).fromArray(t.bindShapeMatrix).transpose(),e=0,n=u.array.length;e<n;e++){var g=u.array[e],y=(new gu).fromArray(h.array,e*h.stride).transpose();i.joints.push({name:g,boneInverse:y})}return i;function x(t,e){return e.weight-t.weight}}(t.skin),r.sources.skinIndices=e.skin.indices,r.sources.skinWeights=e.skin.weights),e}function O(t){return u(Vt.controllers[t],P)}function N(t){return void 0!==t.build?t.build:t.init_from}function L(t){return u(Vt.images[t],N)}function I(t){for(var e={surfaces:{},samplers:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":R(i,e);break;case"technique":e.technique=U(i);break;case"extra":e.extra=G(i)}}return e}function R(t,e){for(var r=t.getAttribute("sid"),n=0,i=t.childNodes.length;n<i;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":e.surfaces[r]=D(o);break;case"sampler2D":e.samplers[r]=F(o)}}}function D(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":e.init_from=i.textContent}}return e}function F(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":e.source=i.textContent}}return e}function U(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=i.nodeName,e.parameters=k(i)}}return e}function k(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":e[i.nodeName]=B(i);break;case"transparent":e[i.nodeName]={opaque:i.getAttribute("opaque"),data:B(i)}}}return e}function B(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":e[o.nodeName]=i(o.textContent);break;case"float":e[o.nodeName]=parseFloat(o.textContent);break;case"texture":e[o.nodeName]={id:o.getAttribute("texture"),extra:j(o)}}}return e}function j(t){for(var e={technique:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":z(i,e)}}return e}function z(t,e){for(var r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":V(i,e)}}}function V(t,e){for(var r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":e.technique[i.nodeName]="TRUE"===i.textContent.toUpperCase()?1:"FALSE"===i.textContent.toUpperCase()?0:parseInt(i.textContent)}}}function G(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":e.technique=H(i)}}return e}function H(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":e[i.nodeName]=parseInt(i.textContent)}}return e}function W(t){return t}function X(t){var e,r=u(Vt.effects[t.url],W),n=r.profile.technique,i=r.profile.extra;switch(n.type){case"phong":case"blinn":e=new Fd;break;case"lambert":e=new Rd;break;default:e=new Dh}function o(t){var e,n=r.profile.samplers[t.id];if(void 0!==n?e=L(r.profile.surfaces[n.source].init_from):(console.warn("ColladaLoader: Undefined sampler. Access image directly (see #12530)."),e=L(t.id)),void 0!==e){var i=kt.load(e),o=t.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var a=o.technique;i.wrapS=a.wrapU?hh:dh,i.wrapT=a.wrapV?hh:dh,i.offset.set(a.offsetU||0,a.offsetV||0),i.repeat.set(a.repeatU||1,a.repeatV||1)}else i.wrapS=hh,i.wrapT=hh;return i}return console.error("ColladaLoader: Unable to load texture with ID:",t.id),null}e.name=t.name;var a=n.parameters;for(var l in a){var c=a[l];switch(l){case"diffuse":c.color&&e.color.fromArray(c.color),c.texture&&(e.map=o(c.texture));break;case"specular":c.color&&e.specular&&e.specular.fromArray(c.color),c.texture&&(e.specularMap=o(c.texture));break;case"shininess":c.float&&e.shininess&&(e.shininess=c.float);break;case"emission":c.color&&e.emissive&&e.emissive.fromArray(c.color)}}var h=a.transparent,d=a.transparency;if(void 0===d&&h&&(d={float:1}),void 0===h&&d&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&d)if(h.data.texture)e.alphaMap=o(h.data.texture),e.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":e.opacity=p[3]*d.float;break;case"RGB_ZERO":e.opacity=1-p[0]*d.float;break;case"A_ZERO":e.opacity=1-p[3]*d.float;break;case"RGB_ONE":e.opacity=p[0]*d.float;break;default:console.warn('ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}e.opacity<1&&(e.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(e.side=Ku),e}function Y(t){return u(Vt.materials[t],X)}function q(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"technique_common":return J(r)}}return{}}function J(t){for(var e={},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":e.technique=n.nodeName,e.parameters=Z(n)}}return e}function Z(t){for(var e={},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[n.nodeName]=parseFloat(n.textContent)}}return e}function Q(t){var e;switch(t.optics.technique){case"perspective":e=new fd(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var r=t.optics.parameters.ymag,n=t.optics.parameters.xmag,i=t.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,e=new gd(-(n*=.5),n,r*=.5,-r,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new fd}return e.name=t.name,e}function K(t){var e=Vt.cameras[t];return void 0!==e?u(e,Q):(console.warn("ColladaLoader: Couldn't find camera with ID:",t),null)}function $(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=i.nodeName,e.parameters=tt(i)}}return e}function tt(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":var a=i(o.textContent);e.color=(new Eu).fromArray(a);break;case"falloff_angle":e.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);e.distance=s?Math.sqrt(1/s):0}}return e}function et(t){var e;switch(t.technique){case"directional":e=new Wf;break;case"point":e=new Gf;break;case"spot":e=new Yf;break;case"ambient":e=new Qf}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function rt(t){var e=Vt.lights[t];return void 0!==e?u(e,et):(console.warn("ColladaLoader: Couldn't find light with ID:",t),null)}function nt(t){for(var e={array:[],stride:3},o=0;o<t.childNodes.length;o++){var a=t.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"float_array":e.array=i(a.textContent);break;case"Name_array":e.array=n(a.textContent);break;case"technique_common":var s=r(a,"accessor")[0];void 0!==s&&(e.stride=parseInt(s.getAttribute("stride")))}}return e}function it(t){for(var e={},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];1===n.nodeType&&(e[n.getAttribute("semantic")]=a(n.getAttribute("source")))}return e}function ot(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=a(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset"));e.inputs[l]={id:s,offset:c},e.stride=Math.max(e.stride,c+1),"TEXCOORD"===l&&(e.hasUV=!0);break;case"vcount":e.vcount=o(i.textContent);break;case"p":e.p=o(i.textContent)}}return e}function at(t){for(var e=0,r=0,n=t.length;r<n;r++)!0===t[r].hasUV&&e++;e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function st(t){var e={},r=t.sources,n=t.vertices,i=t.primitives;if(0===i.length)return{};var o=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r];void 0===e[n.type]&&(e[n.type]=[]),e[n.type].push(n)}return e}(i);for(var a in o){var s=o[a];at(s),e[a]=lt(s,r,n)}return e}function lt(t,e,r){for(var n={},i={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l=[],c=[],u=new Yu,h=[],d=0,p=0,f=0;f<t.length;f++){var m=t[f],v=m.inputs,g=1;for(var y in m.vcount&&4===m.vcount[0]&&(g=2),u.addGroup(d,p="lines"===m.type||"linestrips"===m.type?2*m.count:3*m.count*g,f),d+=p,m.material&&h.push(m.material),v){var x=v[y];switch(y){case"VERTEX":for(var b in r){var w=r[b];switch(b){case"POSITION":var _=i.array.length;if(ct(m,e[w],x.offset,i.array),i.stride=e[w].stride,e.skinWeights&&e.skinIndices&&(ct(m,e.skinIndices,x.offset,l),ct(m,e.skinWeights,x.offset,c)),!1===m.hasUV&&!0===t.uvsNeedsFix){p=(i.array.length-_)/i.stride;for(var S=0;S<p;S++)a.array.push(0,0)}break;case"NORMAL":ct(m,e[w],x.offset,o.array),o.stride=e[w].stride;break;case"COLOR":ct(m,e[w],x.offset,s.array),s.stride=e[w].stride;break;case"TEXCOORD":ct(m,e[w],x.offset,a.array),a.stride=e[w].stride;break;default:console.warn('ColladaLoader: Semantic "%s" not handled in geometry build process.',b)}}break;case"NORMAL":ct(m,e[x.id],x.offset,o.array),o.stride=e[x.id].stride;break;case"COLOR":ct(m,e[x.id],x.offset,s.array),s.stride=e[x.id].stride;break;case"TEXCOORD":ct(m,e[x.id],x.offset,a.array),a.stride=e[x.id].stride}}}return i.array.length>0&&u.addAttribute("position",new Gu(i.array,i.stride)),o.array.length>0&&u.addAttribute("normal",new Gu(o.array,o.stride)),s.array.length>0&&u.addAttribute("color",new Gu(s.array,s.stride)),a.array.length>0&&u.addAttribute("uv",new Gu(a.array,a.stride)),l.length>0&&u.addAttribute("skinIndex",new Gu(l,4)),c.length>0&&u.addAttribute("skinWeight",new Gu(c,4)),n.data=u,n.type=t[0].type,n.materialKeys=h,n}function ct(t,e,r,n){var i=t.p,o=t.stride,a=t.vcount;function s(t){for(var e=i[t+r]*u,o=e+u;e<o;e++)n.push(c[e])}var l=0,c=e.array,u=e.stride;if(void 0!==t.vcount){for(var h=0,d=0,p=a.length;d<p;d++){var f=a[d];if(4===f){var m=h+1*o,v=h+2*o,g=h+3*o;s(h+0*o),s(m),s(g),s(m),s(v),s(g)}else 3===f?(m=h+1*o,v=h+2*o,s(h+0*o),s(m),s(v)):l=Math.max(l,f);h+=o*f}l>0&&console.log("ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(d=0,p=i.length;d<p;d+=o)s(d)}function ut(t){return u(Vt.geometries[t],st)}function ht(t){return void 0!==t.build?t.build:t}function dt(t,e){for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":e.joints[n.getAttribute("sid")]=pt(n);break;case"link":e.links.push(mt(n))}}}function pt(t){for(var e,r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":e=ft(n)}}return e}function ft(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new yu,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=i(n.textContent);e.axis.fromArray(o);break;case"limits":var a=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];e.limits.max=parseFloat(a.textContent),e.limits.min=parseFloat(s.textContent)}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function mt(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":e.attachments.push(vt(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(gt(n))}}return e}function vt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":e.links.push(mt(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(gt(n))}}return e}function gt(t){var e={type:t.nodeName},r=i(t.textContent);switch(e.type){case"matrix":e.obj=new gu,e.obj.fromArray(r).transpose();break;case"translate":e.obj=new yu,e.obj.fromArray(r);break;case"rotate":e.obj=new yu,e.obj.fromArray(r),e.angle=vu.degToRad(r[3])}return e}function yt(t){for(var e={target:t.getAttribute("target").split("/").pop()},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];e.axis=i.textContent;var o=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=o.substr(0,o.length-1)}}return e}function xt(t){return void 0!==t.build?t.build:t}var bt=new gu,wt=new yu;function _t(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new gu,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":e.nodes.push(n.getAttribute("id")),_t(n);break;case"instance_camera":e.instanceCameras.push(a(n.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(St(n));break;case"instance_light":e.instanceLights.push(a(n.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(St(n));break;case"instance_node":e.instanceNodes.push(a(n.getAttribute("url")));break;case"matrix":var o=i(n.textContent);e.matrix.multiply(bt.fromArray(o).transpose()),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=i(n.textContent),wt.fromArray(o),e.matrix.multiply(bt.makeTranslation(wt.x,wt.y,wt.z)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=i(n.textContent);var s=vu.degToRad(o[3]);e.matrix.multiply(bt.makeRotationAxis(wt.fromArray(o),s)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=i(n.textContent),e.matrix.scale(wt.fromArray(o)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Vt.nodes[e.id]=e,e}function St(t){for(var e={id:a(t.getAttribute("url")),materials:{},skeletons:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var s=i[o],l=s.getAttribute("symbol"),c=s.getAttribute("target");e.materials[l]=a(c)}break;case"skeleton":e.skeletons.push(a(n.textContent))}}return e}function Tt(t,e){var r,n,i=[],o=[];for(r=0;r<t.length;r++){var a=t[r];if(Pt(a))Mt(Ot(a),e,i);else if(Lt(a))for(var s=Vt.visualScenes[a].children,l=0;l<s.length;l++){var c=s[l];"JOINT"===c.type&&Mt(Ot(c.id),e,i)}else console.error("ColladaLoader: Unable to find root bone of skeleton with ID:",a)}for(r=0;r<e.length;r++)for(l=0;l<i.length;l++)if((n=i[l]).bone.name===e[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<i.length;r++)!1===(n=i[r]).processed&&(o.push(n),n.processed=!0);var u=[],h=[];for(r=0;r<o.length;r++)u.push((n=o[r]).bone),h.push(n.boneInverse);return new Df(u,h)}function Mt(t,e,r){t.traverse(function(t){if(!0===t.isBone){for(var n,i=0;i<e.length;i++){var o=e[i];if(o.name===t.name){n=o.boneInverse;break}}void 0===n&&(n=new gu),r.push({bone:t,boneInverse:n,processed:!1})}})}function At(t){for(var e=[],r=t.matrix,n=t.nodes,i=t.type,o=t.instanceCameras,a=t.instanceControllers,s=t.instanceLights,l=t.instanceGeometries,c=t.instanceNodes,u=0,h=n.length;u<h;u++)e.push(Ot(n[u]));for(u=0,h=o.length;u<h;u++){var d=K(o[u]);null!==d&&e.push(d.clone())}for(u=0,h=a.length;u<h;u++)for(var p=O((b=a[u]).id),f=Ct(ut(p.id),b.materials),m=Tt(b.skeletons,p.skin.joints),v=0,g=f.length;v<g;v++){var y;(y=f[v]).isSkinnedMesh&&(y.bind(m,p.skin.bindMatrix),y.normalizeSkinWeights()),e.push(y)}for(u=0,h=s.length;u<h;u++){var x=rt(s[u]);null!==x&&e.push(x.clone())}for(u=0,h=l.length;u<h;u++){var b;for(v=0,g=(f=Ct(ut((b=l[u]).id),b.materials)).length;v<g;v++)e.push(f[v])}for(u=0,h=c.length;u<h;u++)e.push(Ot(c[u]).clone());if(0===n.length&&1===e.length)y=e[0];else for(y="JOINT"===i?new Wh:new Nf,u=0;u<e.length;u++)y.add(e[u]);return""===y.name&&(y.name="JOINT"===i?t.sid:t.name),y.matrix.copy(r),y.matrix.decompose(y.position,y.quaternion,y.scale),y}function Et(t,e){for(var r=[],n=0,i=t.length;n<i;n++)r.push(Y(e[t[n]]));return r}function Ct(t,e){var r=[];for(var n in t){var i=t[n],o=Et(i.materialKeys,e);0===o.length&&o.push("lines"===n||"linestrips"===n?new Fh:new Fd);var a=void 0!==i.data.attributes.skinIndex;if(a)for(var s=0,l=o.length;s<l;s++)o[s].skinning=!0;var c,u=1===o.length?o[0]:o;switch(n){case"lines":c=new Kf(i.data,u);break;case"linestrips":c=new Vh(i.data,u);break;case"triangles":case"polylist":c=a?new Ff(i.data,u):new zh(i.data,u)}r.push(c)}return r}function Pt(t){return void 0!==Vt.nodes[t]}function Ot(t){return u(Vt.nodes[t],At)}function Nt(t){var e=new Nf;e.name=t.name;for(var r=t.children,n=0;n<r.length;n++)e.add(Ot(r[n].id));return e}function Lt(t){return void 0!==Vt.visualScenes[t]}function It(t){return u(Vt.visualScenes[t],Nt)}if(console.time("ColladaLoader"),0===t.length)return{scene:new vd};console.time("ColladaLoader: DOMParser");var Rt=(new DOMParser).parseFromString(t,"application/xml");console.timeEnd("ColladaLoader: DOMParser");var Dt=r(Rt,"COLLADA")[0],Ft=Dt.getAttribute("version");console.log("ColladaLoader: File version",Ft);var Ut=function(t){return{unit:function(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}(r(t,"unit")[0]),upAxis:function(t){return void 0!==t?t.textContent:"Y_UP"}(r(t,"up_axis")[0])}}(r(Dt,"asset")[0]),kt=new Xd(this.manager);kt.setPath(e).setCrossOrigin(this.crossOrigin);var Bt=[],jt={},zt=0,Vt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("ColladaLoader: Parse"),l(Dt,"library_animations","animation",function(t){for(var e={sources:{},samplers:{},channels:{}},r=0,n=t.childNodes.length;r<n;r++){var i,o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"source":i=o.getAttribute("id"),e.sources[i]=nt(o);break;case"sampler":i=o.getAttribute("id"),e.samplers[i]=h(o);break;case"channel":i=o.getAttribute("target"),e.channels[i]=d(o);break;default:console.log(o)}}Vt.animations[t.getAttribute("id")]=e}),l(Dt,"library_animation_clips","animation_clip",function(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":e.animations.push(a(i.getAttribute("url")))}}Vt.clips[t.getAttribute("id")]=e}),l(Dt,"library_controllers","controller",function(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":e.id=a(i.getAttribute("source")),e.skin=A(i);break;case"morph":e.id=a(i.getAttribute("source")),console.warn("ColladaLoader: Morph target animation not supported yet.")}}Vt.controllers[t.getAttribute("id")]=e}),l(Dt,"library_images","image",function(t){var e={init_from:r(t,"init_from")[0].textContent};Vt.images[t.getAttribute("id")]=e}),l(Dt,"library_effects","effect",function(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":e.profile=I(i)}}Vt.effects[t.getAttribute("id")]=e}),l(Dt,"library_materials","material",function(t){for(var e={name:t.getAttribute("name")},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":e.url=a(i.getAttribute("url"))}}Vt.materials[t.getAttribute("id")]=e}),l(Dt,"library_cameras","camera",function(t){for(var e={name:t.getAttribute("name")},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":e.optics=q(i)}}Vt.cameras[t.getAttribute("id")]=e}),l(Dt,"library_lights","light",function(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":e=$(i)}}Vt.lights[t.getAttribute("id")]=e}),l(Dt,"library_geometries","geometry",function(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(t,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":e.sources[a]=nt(o);break;case"vertices":e.vertices=it(o);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(ot(o));break;default:console.log(o)}}}Vt.geometries[t.getAttribute("id")]=e}}),l(Dt,"library_nodes","node",_t),l(Dt,"library_visual_scenes","visual_scene",function(t){var e={name:t.getAttribute("name"),children:[]};!function(t){for(var e=t.getElementsByTagName("node"),r=0;r<e.length;r++){var n=e[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+zt++)}}(t);for(var n=r(t,"node"),i=0;i<n.length;i++)e.children.push(_t(n[i]));Vt.visualScenes[t.getAttribute("id")]=e}),l(Dt,"library_kinematics_models","kinematics_model",function(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":dt(n,e)}}Vt.kinematicsModels[t.getAttribute("id")]=e}),l(Dt,"scene","instance_kinematics_scene",function(t){for(var e={bindJointAxis:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":e.bindJointAxis.push(yt(n))}}Vt.kinematicsScenes[a(t.getAttribute("url"))]=e}),console.timeEnd("ColladaLoader: Parse"),console.time("ColladaLoader: Build"),c(Vt.animations,p),c(Vt.clips,T),c(Vt.controllers,P),c(Vt.images,N),c(Vt.effects,W),c(Vt.materials,X),c(Vt.cameras,Q),c(Vt.lights,et),c(Vt.geometries,st),c(Vt.visualScenes,Nt),console.timeEnd("ColladaLoader: Build"),function(){var t=Vt.clips;if(!0===s(t)){if(!1===s(Vt.animations)){var e=[];for(var r in Vt.animations)for(var n=f(r),i=0,o=n.length;i<o;i++)e.push(n[i]);Bt.push(new hd("default",-1,e))}}else for(var r in t)Bt.push(M(r))}(),function(){var t=Object.keys(Vt.kinematicsModels)[0],e=Object.keys(Vt.kinematicsScenes)[0],r=Object.keys(Vt.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var n=u(Vt.kinematicsModels[t],ht),o=u(Vt.kinematicsScenes[e],xt),a=It(r),s=o.bindJointAxis,l={},c=0,h=s.length;c<h;c++){var d=s[c],p=Dt.querySelector('[sid="'+d.target+'"]');p&&m(d.jointIndex,p.parentElement)}var f=new gu;jt={joints:n&&n.joints,getJointValue:function(t){var e=l[t];if(e)return e.position;console.warn("ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var r=l[t];if(r){var n=r.joint;if(e>n.limits.max||e<n.limits.min)console.warn("ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("ColladaLoader: Joint "+t+" is static.");else{var i=r.object,o=n.axis,a=r.transforms;bt.identity();for(var s=0;s<a.length;s++){var c=a[s];if(c.sid&&-1!==c.sid.indexOf(t))switch(n.type){case"revolute":bt.multiply(f.makeRotationAxis(o,vu.degToRad(e)));break;case"prismatic":bt.multiply(f.makeTranslation(o.x*e,o.y*e,o.z*e));break;default:console.warn("ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":bt.multiply(c.obj);break;case"translate":bt.multiply(f.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":bt.scale(c.obj);break;case"rotate":bt.multiply(f.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(bt),i.matrix.decompose(i.position,i.quaternion,i.scale),l[t].position=e}}else console.log("ColladaLoader: "+t+" does not exist.")}}}function m(t,e){var r=e.getAttribute("name"),o=n.joints[t];a.traverse(function(n){n.name===r&&(l[t]={object:n,transforms:function(t){for(var r=[],n=Dt.querySelector('[id="'+e.id+'"]'),o=0;o<n.childNodes.length;o++){var a=n.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"matrix":var s=i(a.textContent),l=(new gu).fromArray(s).transpose();r.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"translate":case"scale":s=i(a.textContent);var c=(new yu).fromArray(s);r.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:c});break;case"rotate":s=i(a.textContent),c=(new yu).fromArray(s);var u=vu.degToRad(s[3]);r.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:c,angle:u})}}return r}(),joint:o,position:o.zeroPosition})})}}();var Gt=It(a(r(r(Dt,"scene")[0],"instance_visual_scene")[0].getAttribute("url")));return"Z_UP"===Ut.upAxis&&Gt.quaternion.setFromEuler(new wu(-Math.PI/2,0,0)),Gt.scale.multiplyScalar(Ut.unit),console.timeEnd("ColladaLoader"),{animations:Bt,kinematics:jt,library:Vt,scene:Gt}}},(tm.prototype=Object.create(xd.prototype)).constructor=tm,tm.prototype.isCompressedTexture=!0,Object.assign(em.prototype,{load:function(t,e,r,n){var i=this,o=[],a=new tm;a.image=o;var s=new Nd(this.manager);function l(l){s.load(t[l],function(t){var r=i._parser(t,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(a.minFilter=mh),a.format=r.format,a.needsUpdate=!0,e&&e(a))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)l(u);else s.load(t,function(t){var r=i._parser(t,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){o[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),o[s].format=r.format,o[s].width=r.width,o[s].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=mh),a.format=r.format,a.needsUpdate=!0,e&&e(a)},r,n);return a},setPath:function(t){return this.path=t,this}});var rm=function(){this._parser=rm.parse};function nm(t,e){Vh.call(this,t,e),this.type="LineLoop"}rm.prototype=Object.create(em.prototype),rm.prototype.constructor=rm,rm.parse=function(t,e){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function i(t,e,r,n){for(var i=r*n*4,o=new Uint8Array(t,e,i),a=new Uint8Array(i),s=0,l=0,c=0;c<n;c++)for(var u=0;u<r;u++){var h=o[l],d=o[++l],p=o[++l],f=o[++l];l++,a[s]=p,a[++s]=d,a[++s]=h,a[++s]=f,s++}return a}var o,a=n("DXT1"),s=n("DXT3"),l=n("DXT5"),c=n("ETC1"),u=new Int32Array(t,0,31);if(542327876!==u[0])return console.error("DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!u[20])return console.error("DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var h=u[21],d=!1;switch(h){case a:o=8,r.format=33776;break;case s:o=16,r.format=33778;break;case l:o=16,r.format=33779;break;case c:o=8,r.format=36196;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("DDSLoader.parse: Unsupported FourCC code ",String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255)),r;d=!0,o=64,r.format=wh}r.mipmapCount=1,131072&u[2]&&!1!==e&&(r.mipmapCount=Math.max(1,u[7]));var p=u[28];if(r.isCubemap=!!(512&p),r.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("DDSLoader.parse: Incomplete cubemap faces"),r;r.width=u[4],r.height=u[3];for(var f=u[1]+4,m=r.isCubemap?6:1,v=0;v<m;v++)for(var g=r.width,y=r.height,x=0;x<r.mipmapCount;x++){if(d)var b=(w=i(t,f,g,y)).length;else{b=Math.max(4,g)/4*Math.max(4,y)/4*o;var w=new Uint8Array(t,f,b)}r.mipmaps.push({data:w,width:g,height:y}),f+=b,g=Math.max(g>>1,1),y=Math.max(y>>1,1)}return r},nm.prototype=Object.assign(Object.create(Vh.prototype),{constructor:nm,isLineLoop:!0}),function(){function t(t){this.manager=void 0!==t?t:Pd}function e(t,e){var r={},n=t.material.uniforms;for(var i in n){var o=n[i];if(o.semantic){var a=o.node,s=t;a&&(s=e[a]),r[i]={semantic:o.semantic,sourceNode:s,targetNode:t,uniform:o}}}this.boundUniforms=r,this._m4=new gu}t.prototype={constructor:t,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=this.path&&"string"==typeof this.path?this.path:qd.extractUrlBase(t),a=new Nd(i.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){i.parse(t,o,e)},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},setPath:function(t){this.path=t},parse:function(t,e,i){var a,s={};qd.decodeText(new Uint8Array(t,0,4))===n.magic?(s[r.KHR_BINARY_GLTF]=new o(t),a=s[r.KHR_BINARY_GLTF].content):a=qd.decodeText(new Uint8Array(t));var l=JSON.parse(a);l.extensionsUsed&&l.extensionsUsed.indexOf(r.KHR_MATERIALS_COMMON)>=0&&(s[r.KHR_MATERIALS_COMMON]=new function(t){this.name=r.KHR_MATERIALS_COMMON,this.lights={};var e=(t.extensions&&t.extensions[r.KHR_MATERIALS_COMMON]||{}).lights||{};for(var n in e){var i,o=e[n],a=o[o.type],s=(new Eu).fromArray(a.color);switch(o.type){case"directional":(i=new Wf(s)).position.set(0,0,1);break;case"point":i=new Gf(s);break;case"spot":(i=new Yf(s)).position.set(0,0,1);break;case"ambient":i=new Qf(s)}i&&(this.lights[n]=i)}}(l)),console.time("LegacyGLTFLoader"),new T(l,s,{path:e||this.path,crossOrigin:this.crossOrigin}).parse(function(t,e,r,n){console.timeEnd("LegacyGLTFLoader"),i({scene:t,scenes:e,cameras:r,animations:n})})}},t.Shaders={update:function(){console.warn("LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},e.prototype.update=function(t,e){var r=this.boundUniforms;for(var n in r){var i=r[n];switch(i.semantic){case"MODELVIEW":i.uniform.value.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var o=i.uniform.value;this._m4.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld),o.getNormalMatrix(this._m4);break;case"PROJECTION":i.uniform.value.copy(e.projectionMatrix);break;case"JOINTMATRIX":for(var a=i.uniform.value,s=0;s<a.length;s++)a[s].getInverse(i.sourceNode.matrixWorld).multiply(i.targetNode.skeleton.bones[s].matrixWorld).multiply(i.targetNode.skeleton.boneInverses[s]).multiply(i.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+i.semantic)}}},t.Animations={update:function(){console.warn("LegacyGLTFLoader.Animation has been deprecated. Use AnimationMixer instead.")}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"},n={magic:"glTF",version:1,contentFormat:0},i=20;function o(t){this.name=r.KHR_BINARY_GLTF;var e=new DataView(t,0,i),o={magic:qd.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0),contentLength:e.getUint32(12,!0),contentFormat:e.getUint32(16,!0)};for(var a in n){var s=n[a];if(o[a]!==s)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',a,s)}var l=new Uint8Array(t,i,o.contentLength);this.header=o,this.content=qd.decodeText(l),this.body=t.slice(i+o.contentLength,o.length)}o.prototype.loadShader=function(t,e){var n=new Uint8Array(e[t.extensions[r.KHR_BINARY_GLTF].bufferView]);return qd.decodeText(n)};var a={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},s={5126:Number,35675:Su,35676:gu,35664:Nu,35665:yu,35666:Ru,35678:xd},l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:fh,9729:mh,9984:1004,9985:1007,9986:1005,9987:vh},u={33071:dh,33648:ph,10497:hh},h={6406:1021,6407:bh,6408:wh,6409:1024,6410:1025},d={5121:gh,32819:1017,32820:1018,33635:1019},p={1028:Qu,1029:Zu},f={512:0,513:2,514:4,515:ah,516:5,517:7,518:5,519:1},m={32774:nh,32778:101,32779:102},v={0:200,1:201,768:202,769:203,770:ih,771:oh,772:206,773:207,774:208,775:209,776:210},g={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={scale:"scale",translation:"position",rotation:"quaternion"},x={LINEAR:2301,STEP:Ah},b={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function w(t,e,r){var n;if(!t)return Promise.resolve();var i=[];if("[object Array]"===Object.prototype.toString.call(t)){n=[];for(var o=t.length,a=0;a<o;a++)(l=e.call(r||this,t[a],a))&&(i.push(l),l instanceof Promise?l.then((function(t,e){n[t]=e}).bind(this,a)):n[a]=l)}else for(var s in n={},t){var l;t.hasOwnProperty(s)&&(l=e.call(r||this,t[s],s))&&(i.push(l),l instanceof Promise?l.then((function(t,e){n[t]=e}).bind(this,s)):n[s]=l)}return Promise.all(i).then(function(){return n})}function _(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:(e||"")+t}function S(t){this.isDeferredShaderMaterial=!0,this.params=t}function T(t,e,r){this.json=t||{},this.extensions=e||{},this.options=r||{},this.cache=new function(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}},update:function(e,r){for(var n in t){var i=t[n];i.update&&i.update(e,r)}}}}}S.prototype.create=function(){var t=wd.clone(this.params.uniforms);for(var e in this.params.uniforms){var r=this.params.uniforms[e];r.value instanceof xd&&(t[e].value=r.value,t[e].value.needsUpdate=!0),t[e].semantic=r.semantic,t[e].node=r.node}return this.params.uniforms=t,new zd(this.params)},T.prototype._withDependencies=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r],i="load"+n.charAt(0).toUpperCase()+n.slice(1),o=this.cache.get(n);if(void 0!==o)e[n]=o;else if(this[i]){var a=this[i]();this.cache.add(n,a),e[n]=a}}return w(e,function(t){return t})},T.prototype.parse=function(t){var e=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(r){var n=[];for(var i in r.scenes)n.push(r.scenes[i]);var o=void 0!==e.scene?r.scenes[e.scene]:n[0],a=[];for(var i in r.cameras)a.push(r.cameras[i]);var s=[];for(var i in r.animations)s.push(r.animations[i]);t(o,n,a,s)})},T.prototype.loadShaders=function(){var t=this.json,e=this.extensions,n=this.options;return this._withDependencies(["bufferViews"]).then(function(i){return w(t.shaders,function(t){return t.extensions&&t.extensions[r.KHR_BINARY_GLTF]?e[r.KHR_BINARY_GLTF].loadShader(t,i.bufferViews):new Promise(function(e){var r=new Nd;r.setResponseType("text"),r.load(_(t.uri,n.path),function(t){e(t)})})})})},T.prototype.loadBuffers=function(){var t=this.extensions,e=this.options;return w(this.json.buffers,function(n,i){return"binary_glTF"===i?t[r.KHR_BINARY_GLTF].body:"arraybuffer"===n.type||void 0===n.type?new Promise(function(t){var r=new Nd;r.setResponseType("arraybuffer"),r.load(_(n.uri,e.path),function(e){t(e)})}):void console.warn("LegacyGLTFLoader: "+n.type+" buffer type is not supported")})},T.prototype.loadBufferViews=function(){var t=this.json;return this._withDependencies(["buffers"]).then(function(e){return w(t.bufferViews,function(t){return e.buffers[t.buffer].slice(t.byteOffset,t.byteOffset+(void 0!==t.byteLength?t.byteLength:0))})})},T.prototype.loadAccessors=function(){var t=this.json;return this._withDependencies(["bufferViews"]).then(function(e){return w(t.accessors,function(t){var r=e.bufferViews[t.bufferView],n=g[t.type],i=l[t.componentType],o=i.BYTES_PER_ELEMENT;if(t.byteStride&&t.byteStride!==o*n){var a=new i(r);return new _f(new bf(a,t.byteStride/o),n,t.byteOffset/o)}return new Du(a=new i(r,t.byteOffset,t.count*n),n)})})},T.prototype.loadTextures=function(){var t=this.json,e=this.options;return this._withDependencies(["bufferViews"]).then(function(n){return w(t.textures,function(i){if(i.source)return new Promise(function(o){var a=t.images[i.source],s=a.uri,l=!1;if(a.extensions&&a.extensions[r.KHR_BINARY_GLTF]){var p=a.extensions[r.KHR_BINARY_GLTF],f=new Blob([n.bufferViews[p.bufferView]],{type:p.mimeType});s=URL.createObjectURL(f),l=!0}var m=Yd.Handlers.get(s);null===m&&(m=new Xd),m.setCrossOrigin(e.crossOrigin),m.load(_(s,e.path),function(e){if(l&&URL.revokeObjectURL(s),e.flipY=!1,void 0!==i.name&&(e.name=i.name),e.format=void 0!==i.format?h[i.format]:wh,void 0!==i.internalFormat&&e.format!==h[i.internalFormat]&&console.warn("LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==i.type?d[i.type]:gh,i.sampler){var r=t.samplers[i.sampler];e.magFilter=c[r.magFilter]||mh,e.minFilter=c[r.minFilter]||1005,e.wrapS=u[r.wrapS]||hh,e.wrapT=u[r.wrapT]||hh}o(e)},void 0,function(){l&&URL.revokeObjectURL(s),o()})})})})},T.prototype.loadMaterials=function(){var t=this.json;return this._withDependencies(["shaders","textures"]).then(function(e){return w(t.materials,function(n){var i,o,l={},c={};if(n.extensions&&n.extensions[r.KHR_MATERIALS_COMMON]&&(o=n.extensions[r.KHR_MATERIALS_COMMON]),o){var u=["ambient","emission","transparent","transparency","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":i=Fd,u.push("diffuse","specular","shininess");break;case"LAMBERT":i=Rd,u.push("diffuse");break;case"CONSTANT":default:i=Dh}u.forEach(function(t){void 0!==o.values[t]&&(l[t]=o.values[t])}),(o.doubleSided||l.doubleSided)&&(c.side=Ku),(o.transparent||l.transparent)&&(c.transparent=!0,c.opacity=void 0!==l.transparency?l.transparency:1)}else if(void 0===n.technique)i=Fd,Object.assign(l,n.values);else{i=S;var h=t.techniques[n.technique];c.uniforms={};var d=t.programs[h.program];if(d){c.fragmentShader=e.shaders[d.fragmentShader],c.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",d.fragmentShader),i=Fd);var g=e.shaders[d.vertexShader];g||(console.warn("ERROR: Missing vertex shader definition:",d.vertexShader),i=Fd),c.vertexShader=function(t,e){var r={};for(var n in e.attributes)r[n]={type:(c=e.parameters[l=e.attributes[n]]).type,semantic:u=c.semantic};var i=e.parameters,o=e.attributes,a={};for(var n in r){var s=i[l=o[n]];(u=s.semantic)&&(a[n]=s)}for(var l in a){var c,u=(c=a[l]).semantic,h=new RegExp("\\b"+l+"\\b","g");switch(u){case"POSITION":t=t.replace(h,"position");break;case"NORMAL":t=t.replace(h,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":t=t.replace(h,"uv");break;case"TEXCOORD_1":t=t.replace(h,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":t=t.replace(h,"color");break;case"WEIGHT":t=t.replace(h,"skinWeight");break;case"JOINT":t=t.replace(h,"skinIndex")}}return t}(g,h);var y=h.uniforms;for(var x in y){var w=y[x],_=h.parameters[w],T=_.type;if(!s[T])throw new Error("Unknown shader uniform param type: "+T);var M,A=_.count;void 0!==n.values&&(M=n.values[w]);var E=new s[T],C=_.semantic,P=_.node;switch(T){case a.FLOAT:E=_.value,"transparency"==w&&(c.transparent=!0),void 0!==M&&(E=M);break;case a.FLOAT_VEC2:case a.FLOAT_VEC3:case a.FLOAT_VEC4:case a.FLOAT_MAT3:_&&_.value&&E.fromArray(_.value),M&&E.fromArray(M);break;case a.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case a.FLOAT_MAT4:if(A){E=new Array(A);for(var O=0;O<A;O++)E[O]=new s[T];_&&_.value&&E.fromArray(_.value),M&&E.fromArray(M)}else _&&_.value&&E.fromArray(_.value),M&&E.fromArray(M);break;case a.SAMPLER_2D:E=void 0!==M?e.textures[M]:void 0!==_.value?e.textures[_.value]:null}c.uniforms[x]={value:E,semantic:C,node:P}}for(var N=h.states||{},L=N.enable||[],I=N.functions||{},R=!1,D=!1,F=!1,U=0,k=L.length;U<k;U++){var B=L[U];switch(b[B]){case"CULL_FACE":R=!0;break;case"DEPTH_TEST":D=!0;break;case"BLEND":F=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+B)}}c.side=R?void 0!==I.cullFace?p[I.cullFace]:Zu:Ku,c.depthTest=D,c.depthFunc=void 0!==I.depthFunc?f[I.depthFunc]:2,c.depthWrite=void 0===I.depthMask||I.depthMask[0],c.blending=F?5:0,c.transparent=F;var j=I.blendEquationSeparate;void 0!==j?(c.blendEquation=m[j[0]],c.blendEquationAlpha=m[j[1]]):(c.blendEquation=nh,c.blendEquationAlpha=nh);var z=I.blendFuncSeparate;void 0!==z?(c.blendSrc=v[z[0]],c.blendDst=v[z[1]],c.blendSrcAlpha=v[z[2]],c.blendDstAlpha=v[z[3]]):(c.blendSrc=201,c.blendDst=200,c.blendSrcAlpha=201,c.blendDstAlpha=200)}}Array.isArray(l.diffuse)?c.color=(new Eu).fromArray(l.diffuse):"string"==typeof l.diffuse&&(c.map=e.textures[l.diffuse]),delete c.diffuse,"string"==typeof l.reflective&&(c.envMap=e.textures[l.reflective]),"string"==typeof l.bump&&(c.bumpMap=e.textures[l.bump]),Array.isArray(l.emission)?i===Dh?c.color=(new Eu).fromArray(l.emission):c.emissive=(new Eu).fromArray(l.emission):"string"==typeof l.emission&&(i===Dh?c.map=e.textures[l.emission]:c.emissiveMap=e.textures[l.emission]),Array.isArray(l.specular)?c.specular=(new Eu).fromArray(l.specular):"string"==typeof l.specular&&(c.specularMap=e.textures[l.specular]),void 0!==l.shininess&&(c.shininess=l.shininess);var V=new i(c);return void 0!==n.name&&(V.name=n.name),V})})},T.prototype.loadMeshes=function(){var t=this.json;return this._withDependencies(["accessors","materials"]).then(function(e){return w(t.meshes,function(r){var n=new Nf;void 0!==r.name&&(n.name=r.name),r.extras&&(n.userData=r.extras);var i=r.primitives||[];for(var o in i){var s=i[o];if(s.mode===a.TRIANGLES||void 0===s.mode){var l=new Yu,c=s.attributes;for(var u in c){if(!(f=c[u]))return;var h=e.accessors[f];switch(u){case"POSITION":l.addAttribute("position",h);break;case"NORMAL":l.addAttribute("normal",h);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":l.addAttribute("uv",h);break;case"TEXCOORD_1":l.addAttribute("uv2",h);break;case"COLOR_0":case"COLOR0":case"COLOR":l.addAttribute("color",h);break;case"WEIGHT":l.addAttribute("skinWeight",h);break;case"JOINT":l.addAttribute("skinIndex",h);break;default:if(!s.material)break;if(!(v=t.materials[s.material]).technique)break;var d=t.techniques[v.technique].parameters||{};for(var p in d)d[p].semantic===u&&l.addAttribute(p,h)}}s.indices&&l.setIndex(e.accessors[s.indices]),(m=new zh(l,v=void 0!==e.materials?e.materials[s.material]:new Fd({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:Zu}))).castShadow=!0,m.name="0"===o?n.name:n.name+o,s.extras&&(m.userData=s.extras),n.add(m)}else if(s.mode===a.LINES){for(var u in l=new Yu,c=s.attributes){var f;if(!(f=c[u]))return;switch(h=e.accessors[f],u){case"POSITION":l.addAttribute("position",h);break;case"COLOR_0":case"COLOR0":case"COLOR":l.addAttribute("color",h)}}var m,v=e.materials[s.material];s.indices?(l.setIndex(e.accessors[s.indices]),m=new Kf(l,v)):m=new Vh(l,v),m.name="0"===o?n.name:n.name+o,s.extras&&(m.userData=s.extras),n.add(m)}else console.warn("Only triangular and line primitives are supported")}return n})})},T.prototype.loadCameras=function(){return w(this.json.cameras,function(t){if("perspective"==t.type&&t.perspective){var e=void 0!==t.perspective.aspectRatio?t.perspective.aspectRatio:1,r=new fd(vu.radToDeg(t.perspective.yfov*e),e,t.perspective.znear||1,t.perspective.zfar||2e6);return void 0!==t.name&&(r.name=t.name),t.extras&&(r.userData=t.extras),r}if("orthographic"==t.type&&t.orthographic)return r=new gd(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,t.orthographic.znear,t.orthographic.zfar),void 0!==t.name&&(r.name=t.name),t.extras&&(r.userData=t.extras),r})},T.prototype.loadSkins=function(){var t=this.json;return this._withDependencies(["accessors"]).then(function(e){return w(t.skins,function(t){var r=new gu;return void 0!==t.bindShapeMatrix&&r.fromArray(t.bindShapeMatrix),{bindShapeMatrix:r,jointNames:t.jointNames,inverseBindMatrices:e.accessors[t.inverseBindMatrices]}})})},T.prototype.loadAnimations=function(){var t=this.json;return this._withDependencies(["accessors","nodes"]).then(function(e){return w(t.animations,function(t,r){var n=[];for(var i in t.channels){var o=t.channels[i],a=t.samplers[o.sampler];if(a){var s=o.target,l=s.id,c=e.accessors[void 0!==t.parameters?t.parameters[a.input]:a.input],u=e.accessors[void 0!==t.parameters?t.parameters[a.output]:a.output],h=e.nodes[l];if(h){h.updateMatrix(),h.matrixAutoUpdate=!0;var d=void 0!==a.interpolation?x[a.interpolation]:2301;n.push(new(y[s.path]===y.rotation?rd:id)((h.name?h.name:h.uuid)+"."+y[s.path],ld.arraySlice(c.array,0),ld.arraySlice(u.array,0),d))}}}return new hd(l=void 0!==t.name?t.name:"animation_"+r,void 0,n)})})},T.prototype.loadNodes=function(){var t=this.json,e=this.extensions,n=this;return w(t.nodes,function(t){var e,r=new gu;return t.jointName?((e=new Wh).name=void 0!==t.name?t.name:t.jointName,e.jointName=t.jointName):(e=new Mu,void 0!==t.name&&(e.name=t.name)),t.extras&&(e.userData=t.extras),void 0!==t.matrix?(r.fromArray(t.matrix),e.applyMatrix(r)):(void 0!==t.translation&&e.position.fromArray(t.translation),void 0!==t.rotation&&e.quaternion.fromArray(t.rotation),void 0!==t.scale&&e.scale.fromArray(t.scale)),e}).then(function(i){return n._withDependencies(["meshes","skins","cameras"]).then(function(n){return w(i,function(o,a){var s=t.nodes[a];if(void 0!==s.meshes)for(var l in s.meshes){var c=s.meshes[l],u=n.meshes[c];if(void 0!==u)for(var h in u.children){var d,p=u.children[h],f=p.material,m=p.geometry,v=p.userData,g=p.name;switch(f.isDeferredShaderMaterial?f=y=f.create():y=f,p.type){case"LineSegments":p=new Kf(m,y);break;case"LineLoop":p=new nm(m,y);break;case"Line":p=new Vh(m,y);break;default:p=new zh(m,y)}if(p.castShadow=!0,p.userData=v,p.name=g,s.skin&&(d=n.skins[s.skin]),d){var y,x=function(t){for(var e=Object.keys(i),r=0,n=e.length;r<n;r++){var o=i[e[r]];if(o.jointName===t)return o}return null},b=m;(y=f).skinning=!0,(p=new Ff(b,y)).castShadow=!0,p.userData=v,p.name=g;for(var w=[],_=[],S=0,T=d.jointNames.length;S<T;S++){var M=d.jointNames[S],A=x(M);if(A){w.push(A);var E=d.inverseBindMatrices.array,C=(new gu).fromArray(E,16*S);_.push(C)}else console.warn("WARNING: joint: '"+M+"' could not be found")}p.bind(new Df(w,_),d.bindShapeMatrix);var P=function(e,r,n){var o=e[n];if(void 0!==o)for(var a=0,s=o.length;a<s;a++){var l=o[a],c=i[l],u=t.nodes[l];void 0!==c&&!0===c.isBone&&void 0!==u&&(r.add(c),P(u,c,"children"))}};P(s,p,"skeletons")}o.add(p)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+c+'".')}return void 0!==s.camera&&o.add(n.cameras[s.camera]),s.extensions&&s.extensions[r.KHR_MATERIALS_COMMON]&&s.extensions[r.KHR_MATERIALS_COMMON].light&&o.add(e[r.KHR_MATERIALS_COMMON].lights[s.extensions[r.KHR_MATERIALS_COMMON].light]),o})})})},T.prototype.loadScenes=function(){var t=this.json;function r(e,n,i){var o=i[e];n.add(o);var a=t.nodes[e];if(a.children)for(var s=a.children,l=0,c=s.length;l<c;l++)r(s[l],o,i)}return this._withDependencies(["nodes"]).then(function(n){return w(t.scenes,function(t){var i=new vd;void 0!==t.name&&(i.name=t.name),t.extras&&(i.userData=t.extras);for(var o=t.nodes||[],a=0,s=o.length;a<s;a++)r(o[a],i,n.nodes);return i.traverse(function(t){t.material&&t.material.isRawShaderMaterial&&(t.gltfShader=new e(t,n.nodes),t.onBeforeRender=function(t,e,r){this.gltfShader.update(e,r)})}),i})})}}();var im=function(t){this.timeLoaded=0,this.manager=t||Pd,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=Ch,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}};function om(t){this.manager=void 0!==t?t:Pd,this._parser=null}function am(t){var e,r=t.Content,n=t.RelativeFilename||t.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+e+";base64,"+r;var o=new Uint8Array(r);return window.URL.createObjectURL(new Blob([o],{type:e}))}function sm(t,e,r,n){var i=function(t,e,r,n){var i,o=e.path,a=n.get(t.id).children;void 0!==a&&a.length>0&&void 0!==r[a[0].ID]&&(0!==(i=r[a[0].ID]).indexOf("blob:")&&0!==i.indexOf("data:")||e.setPath(void 0));var s=e.load(i);return e.setPath(o),s}(t,e,r,n);i.ID=t.id,i.name=t.attrName;var o=t.WrapModeU,a=t.WrapModeV,s=void 0!==a?a.value:0;if(i.wrapS=0===(void 0!==o?o.value:0)?hh:dh,i.wrapT=0===s?hh:dh,"Scaling"in t){var l=t.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}return i}function lm(t,e,r,n){var i=e.id,o=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!n.has(i))return null;var s,l=function(t,e,r,n,i){var o={};return e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new Eu).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(o.color=(new Eu).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Specular?o.specular=(new Eu).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.emissive=(new Eu).fromArray(e.SpecularColor.value)),e.Shininess&&(o.shininess=e.Shininess.value),e.Emissive?o.emissive=(new Eu).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(o.emissive=(new Eu).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),i.get(n).children.forEach(function(e){var n=e.relationship;switch(n){case"Bump":o.bumpMap=r.get(e.ID);break;case"DiffuseColor":o.map=cm(t,r,e.ID,i);break;case"DisplacementColor":o.displacementMap=cm(t,r,e.ID,i);break;case"EmissiveColor":o.emissiveMap=cm(t,r,e.ID,i);break;case"NormalMap":o.normalMap=cm(t,r,e.ID,i);break;case"ReflectionColor":o.envMap=cm(t,r,e.ID,i),o.envMap.mapping=ch;break;case"SpecularColor":o.specularMap=cm(t,r,e.ID,i);break;case"TransparentColor":o.alphaMap=cm(t,r,e.ID,i),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",n)}}),o}(t,e,r,i,n);switch(a.toLowerCase()){case"phong":s=new Fd;break;case"lambert":s=new Rd;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),s=new Fd({color:3342591})}return s.setValues(l),s.name=o,s}function cm(t,e,r,n){return"LayeredTexture"in t.Objects&&r in t.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=n.get(r).children[0].ID),e.get(r)}function um(t,e){var r=[];return t.children.forEach(function(t){var n=e[t.ID];if("Cluster"===n.attrType){var i={ID:t.ID,indices:[],weights:[],transform:(new gu).fromArray(n.Transform.a),transformLink:(new gu).fromArray(n.TransformLink.a),linkMode:n.Mode};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}}),{rawBones:r,bones:[]}}function hm(t,e,r,n){switch(r.attrType){case"Mesh":return function(t,e,r,n){var i=e.parents.map(function(e){return t.Objects.Model[e.ID]});if(0!==i.length){var o=e.children.reduce(function(t,e){return void 0!==n[e.ID]&&(t=n[e.ID]),t},null),a=new gu,s=i[0];if("GeometricRotation"in s){var l=s.GeometricRotation.value.map(vu.degToRad);l[3]="ZYX",a.makeRotationFromEuler((new wu).fromArray(l))}return"GeometricTranslation"in s&&a.setPosition((new yu).fromArray(s.GeometricTranslation.value)),"GeometricScaling"in s&&a.scale((new yu).fromArray(s.GeometricScaling.value)),function(t,e,r,n,i){var o=r.Vertices.a,a=r.PolygonVertexIndex.a,s=[],l=[],c=[],u=[],h=[],d=[],p=[];if(r.LayerElementColor)var f=function(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&(r=t.ColorIndex.a),{dataSize:4,buffer:t.Colors.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}}(r.LayerElementColor[0]);if(r.LayerElementMaterial)var m=function(t){var e=t.MappingInformationType,r=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=t.Materials.a,i=[],o=0;o<n.length;++o)i.push(o);return{dataSize:1,buffer:n,indices:i,mappingType:e,referenceType:r}}(r.LayerElementMaterial[0]);if(r.LayerElementNormal)var v=function(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:t.Normals.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}}(r.LayerElementNormal[0]);if(r.LayerElementUV)for(var g=[],y=0;r.LayerElementUV[y];)g.push(dm(r.LayerElementUV[y])),y++;var x={};null!==n&&n.rawBones.forEach(function(t,e){t.indices.forEach(function(r,n){void 0===x[r]&&(x[r]=[]),x[r].push({id:e,weight:t.weights[n]})})});var b=0,w=0,_=!1,S=[],T=[],M=[],A=[],E=[],C=[];a.forEach(function(t,e){var r=!1;t<0&&(a[e]=t^=-1,r=!0);var i=[],y=[];if(S.push(3*t,3*t+1,3*t+2),f){var P=mm(e,b,t,f);M.push(P[0],P[1],P[2])}if(n){if(void 0!==x[t]&&x[t].forEach(function(t){y.push(t.weight),i.push(t.id)}),y.length>4){_||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),_=!0);var O=[0,0,0,0],N=[0,0,0,0];y.forEach(function(t,e){var r=t,n=i[e];N.forEach(function(t,e,i){if(r>t){i[e]=r,r=t;var o=O[e];O[e]=n,n=o}})}),i=O,y=N}for(;y.length<4;)y.push(0),i.push(0);for(var L=0;L<4;++L)E.push(y[L]),C.push(i[L])}if(v&&(P=mm(e,b,t,v),T.push(P[0],P[1],P[2])),m&&"AllSame"!==m.mappingType)var I=mm(e,b,t,m)[0];if(g&&g.forEach(function(r,n){var i=mm(e,b,t,r);void 0===A[n]&&(A[n]=[]),A[n].push(i[0]),A[n].push(i[1])}),w++,r){for(L=2;L<w;L++)s.push(o[S[0]]),s.push(o[S[1]]),s.push(o[S[2]]),s.push(o[S[3*(L-1)]]),s.push(o[S[3*(L-1)+1]]),s.push(o[S[3*(L-1)+2]]),s.push(o[S[3*L]]),s.push(o[S[3*L+1]]),s.push(o[S[3*L+2]]),n&&(d.push(E[0]),d.push(E[1]),d.push(E[2]),d.push(E[3]),d.push(E[4*(L-1)]),d.push(E[4*(L-1)+1]),d.push(E[4*(L-1)+2]),d.push(E[4*(L-1)+3]),d.push(E[4*L]),d.push(E[4*L+1]),d.push(E[4*L+2]),d.push(E[4*L+3]),p.push(C[0]),p.push(C[1]),p.push(C[2]),p.push(C[3]),p.push(C[4*(L-1)]),p.push(C[4*(L-1)+1]),p.push(C[4*(L-1)+2]),p.push(C[4*(L-1)+3]),p.push(C[4*L]),p.push(C[4*L+1]),p.push(C[4*L+2]),p.push(C[4*L+3])),f&&(c.push(M[0]),c.push(M[1]),c.push(M[2]),c.push(M[3*(L-1)]),c.push(M[3*(L-1)+1]),c.push(M[3*(L-1)+2]),c.push(M[3*L]),c.push(M[3*L+1]),c.push(M[3*L+2])),m&&"AllSame"!==m.mappingType&&(h.push(I),h.push(I),h.push(I)),v&&(l.push(T[0]),l.push(T[1]),l.push(T[2]),l.push(T[3*(L-1)]),l.push(T[3*(L-1)+1]),l.push(T[3*(L-1)+2]),l.push(T[3*L]),l.push(T[3*L+1]),l.push(T[3*L+2])),g&&g.forEach(function(t,e){void 0===u[e]&&(u[e]=[]),u[e].push(A[e][0]),u[e].push(A[e][1]),u[e].push(A[e][2*(L-1)]),u[e].push(A[e][2*(L-1)+1]),u[e].push(A[e][2*L]),u[e].push(A[e][2*L+1])});b++,w=0,S=[],T=[],M=[],A=[],E=[],C=[]}});var P=new Yu;P.name=r.name;var O=new Gu(s,3);if(i.applyToBufferAttribute(O),P.addAttribute("position",O),c.length>0&&P.addAttribute("color",new Gu(c,3)),n&&(P.addAttribute("skinIndex",new Gu(p,4)),P.addAttribute("skinWeight",new Gu(d,4)),P.FBX_Deformer=n),l.length>0){var N=new Gu(l,3);(new Su).getNormalMatrix(i).applyToBufferAttribute(N),P.addAttribute("normal",N)}if(u.forEach(function(t,e){var r="uv"+(e+1).toString();0===e&&(r="uv"),P.addAttribute(r,new Gu(u[e],2))}),m&&"AllSame"!==m.mappingType){var L=h[0],I=0;if(h.forEach(function(t,e){t!==L&&(P.addGroup(I,e-I,L),L=t,I=e)}),P.groups.length>0){var R=P.groups[P.groups.length-1],D=R.start+R.count;D!==h.length&&P.addGroup(D,h.length-D,L)}0===P.groups.length&&P.addGroup(0,h.length,h[0])}return P}(0,0,r,o,a)}}(t,e,r,n);case"NurbsCurve":return function(t){if(void 0===Yp)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Yu;var e=parseInt(t.Order);if(isNaN(e))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new Yu;for(var r,n,i=e-1,o=t.KnotVector.a,a=[],s=t.Points.a,l=0,c=s.length;l<c;l+=4)a.push((new Ru).fromArray(s,l));if("Closed"===t.Form)a.push(a[0]);else if("Periodic"===t.Form)for(n=o.length-1-(r=i),l=0;l<i;++l)a.push(a[l]);var u=new Yp(i,o,a,r,n).getPoints(7*a.length),h=new Float32Array(3*u.length);u.forEach(function(t,e){t.toArray(h,3*e)});var d=new Yu;return d.addAttribute("position",new Du(h,3)),d}(r)}}function dm(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&(r=t.UVIndex.a),{dataSize:2,buffer:t.UV.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}}im.prototype={constructor:im,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.load(t,function(t){i.decodeDracoFile(t,e)},r,n)},setPath:function(t){this.path=t},setCrossOrigin:function(t){this.crossOrigin=t},setVerbosity:function(t){this.verbosity=t},setDrawMode:function(t){this.drawMode=t},setSkipDequantization:function(t,e){var r=!0;void 0!==e&&(r=e),this.getAttributeOptions(t).skipDequantization=r},decodeDracoFile:function(t,e,r){var n=this;im.getDecoderModule().then(function(i){n.decodeDracoFileInternal(t,i.decoder,e,r||{})})},decodeDracoFileInternal:function(t,e,r,n){var i=new e.DecoderBuffer;i.Init(new Int8Array(t),t.byteLength);var o=new e.Decoder,a=o.GetEncodedGeometryType(i);if(a==e.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(a!=e.POINT_CLOUD){var s="DRACOLoader: Unknown geometry type.";throw console.error(s),new Error(s)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(e,o,a,i,n))},addAttributeToGeometry:function(t,e,r,n,i,o,a){if(0===i.ptr){var s="DRACOLoader: No attribute "+n;throw console.error(s),new Error(s)}var l=i.num_components(),c=new t.DracoFloat32Array;e.GetAttributeFloatForAllPoints(r,i,c);var u=r.num_points()*l;a[n]=new Float32Array(u);for(var h=0;h<u;h++)a[n][h]=c.GetValue(h);o.addAttribute(n,new Gu(a[n],l)),t.destroy(c)},convertDracoGeometryTo3JS:function(t,e,r,n,i){var o,a;!0===this.getAttributeOptions("position").skipDequantization&&e.SkipAttributeTransform(t.POSITION);var s=performance.now();if(r===t.TRIANGULAR_MESH?(o=new t.Mesh,a=e.DecodeBufferToMesh(n,o)):(o=new t.PointCloud,a=e.DecodeBufferToPointCloud(n,o)),!a.ok()||0==o.ptr){var l="DRACOLoader: Decoding failed: ";throw l+=a.error_msg(),console.error(l),t.destroy(e),t.destroy(o),new Error(l)}var c,u=performance.now();t.destroy(n),r==t.TRIANGULAR_MESH?(c=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+c.toString())):c=0;var h=o.num_points(),d=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+h.toString()),console.log("Number of attributes loaded: "+d.toString()));var p=e.GetAttributeId(o,t.POSITION);if(-1==p)throw l="DRACOLoader: No position attribute found.",console.error(l),t.destroy(e),t.destroy(o),new Error(l);var f=e.GetAttribute(o,p),m={},v=new Yu;for(var g in this.nativeAttributeMap)if(void 0===i[g]){var y=e.GetAttributeId(o,t[this.nativeAttributeMap[g]]);if(-1!==y){this.verbosity>0&&console.log("Loaded "+g+" attribute.");var x=e.GetAttribute(o,y);this.addAttributeToGeometry(t,e,o,g,x,v,m)}}for(var g in i)x=e.GetAttributeByUniqueId(o,i[g]),this.addAttributeToGeometry(t,e,o,g,x,v,m);if(r==t.TRIANGULAR_MESH)if(this.drawMode===Ph){var b=new t.DracoInt32Array;e.GetTriangleStripsFromMesh(o,b),m.indices=new Uint32Array(b.size());for(var w=0;w<b.size();++w)m.indices[w]=b.GetValue(w);t.destroy(b)}else{m.indices=new Uint32Array(3*c);var _=new t.DracoInt32Array;for(w=0;w<c;++w){e.GetFaceFromMesh(o,w,_);var S=3*w;m.indices[S]=_.GetValue(0),m.indices[S+1]=_.GetValue(1),m.indices[S+2]=_.GetValue(2)}t.destroy(_)}v.drawMode=this.drawMode,r==t.TRIANGULAR_MESH&&v.setIndex(new(m.indices.length>65535?Vu:ju)(m.indices,1));var T=new t.AttributeQuantizationTransform;if(T.InitFromAttribute(f))for(v.attributes.position.isQuantized=!0,v.attributes.position.maxRange=T.range(),v.attributes.position.numQuantizationBits=T.quantization_bits(),v.attributes.position.minValues=new Float32Array(3),w=0;w<3;++w)v.attributes.position.minValues[w]=T.min_value(w);return t.destroy(T),t.destroy(e),t.destroy(o),this.decode_time=u-s,this.import_time=performance.now()-u,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),v},isVersionSupported:function(t,e){im.getDecoderModule().then(function(r){e(r.decoder.isVersionSupported(t))})},getAttributeOptions:function(t){return void 0===this.attributeOptions[t]&&(this.attributeOptions[t]={}),this.attributeOptions[t]}},im.decoderPath="./",im.decoderConfig={},im.decoderModulePromise=null,im.setDecoderPath=function(t){im.decoderPath=t},im.setDecoderConfig=function(t){var e=im.decoderConfig.wasmBinary;im.decoderConfig=t||{},im.releaseDecoderModule(),e&&(im.decoderConfig.wasmBinary=e)},im.releaseDecoderModule=function(){im.decoderModulePromise=null},im.getDecoderModule=function(){var t=this,e=im.decoderPath,r=im.decoderConfig,n=im.decoderModulePromise;return n||("undefined"!=typeof DracoDecoderModule?n=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?n=im._loadScript(e+"draco_decoder.js"):(r.wasmBinaryFile=e+"draco_decoder.wasm",n=im._loadScript(e+"draco_wasm_wrapper.js").then(function(){return im._loadArrayBuffer(r.wasmBinaryFile)}).then(function(t){r.wasmBinary=t})),n=n.then(function(){return new Promise(function(e){r.onModuleLoaded=function(r){t.timeLoaded=performance.now(),e({decoder:r})},DracoDecoderModule(r)})}),im.decoderModulePromise=n,n)},im._loadScript=function(t){var e=document.getElementById("decoder_script");null!==e&&e.parentNode.removeChild(e);var r=document.getElementsByTagName("head")[0],n=document.createElement("script");return n.id="decoder_script",n.type="text/javascript",n.src=t,new Promise(function(t){n.onload=t,r.appendChild(n)})},im._loadArrayBuffer=function(t){var e=new Nd;return e.setResponseType("arraybuffer"),new Promise(function(r,n){e.load(t,r,void 0,n)})},Object.assign(om.prototype,{load:function(t,e,r,n){var i=this,o=new ff,a=new Nd(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){var r=i._parser(t);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:dh,o.wrapT=void 0!==r.wrapT?r.wrapT:dh,o.magFilter=void 0!==r.magFilter?r.magFilter:mh,o.minFilter=void 0!==r.minFilter?r.minFilter:vh,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=mh),o.needsUpdate=!0,e&&e(o,r))},r,n),o}}),((function(t){this.manager=void 0!==t?t:Pd}).prototype=Object.create(om.prototype))._parser=function(t){var e=65536,r=e>>3,n=14,i=65537,o=1<<n,a=o-1,s=59,l=63,c=2+l-s,u=8,h=4,d=4,p=2,f=1,m={l:0,c:0,lc:0};function v(t,e,r,n,i){for(;r<t;)e=e<<8|L(n,i),r+=8;m.l=e>>(r-=t)&(1<<t)-1,m.c=e,m.lc=r}var g=new Array(59);function y(t){return 63&t}function x(t){return t>>6}var b={c:0,lc:0};function w(t,e,r,n){t=t<<8|L(r,n),e+=8,b.c=t,b.lc=e}var _={c:0,lc:0};function S(t,e,r,n,i,o,a,s,l,c){if(t==e){n<8&&(w(r,n,i,a),r=b.c,n=b.lc);var u=r>>(n-=8);if(out+u>oe)throw"Issue with getCode";for(var h=out[-1];u-- >0;)s[l.value++]=h}else{if(!(l.value<c))throw"Issue with getCode";s[l.value++]=t}_.c=r,_.lc=n}function T(t){var e=function(t){return 65535&t}(t);return e>32767?e-65536:e}var M={a:0,b:0};function A(t,e){var r=T(t),n=T(e),i=r+(1&n)+(n>>1),o=i-n;M.a=i,M.b=o}function E(t,e,r,n,i,o,a){for(var s,l=r>i?i:r,c=1;c<=l;)c<<=1;for(s=c>>=1,c>>=1;c>=1;){for(var u,h,d,p=0,f=p+o*(i-s),m=o*c,v=o*s,g=n*c,y=n*s;p<=f;p+=v){for(var x=p,b=p+n*(r-s);x<=b;x+=y){var w,_=x+g,S=(w=x+m)+g;A(e[x+t],e[w+t]),u=M.a,h=M.b,A(e[_+t],e[S+t]),d=M.b,A(u,M.a),e[x+t]=M.a,e[_+t]=M.b,A(h,d),e[w+t]=M.a,e[S+t]=M.b}r&c&&(A(e[x+t],e[(w=x+m)+t]),u=M.a,e[w+t]=M.b,e[x+t]=u)}if(i&c)for(x=p,b=p+n*(r-s);x<=b;x+=y)A(e[x+t],e[(_=x+g)+t]),u=M.a,e[_+t]=M.b,e[x+t]=u;s=c,c>>=1}return p}function C(t,u,h,d,p,f,T,M,A,C){var P=new Uint8Array(r),O=F(d,p),L=F(d,p);if(L>=r)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(O<=L)for(var R=0;R<L-O+1;R++)P[R+O]=I(d,p);var D=new Uint16Array(e);!function(t,r){for(var n=0,i=0;i<e;++i)(0==i||t[i>>3]&1<<(7&i))&&(r[n++]=i);for(;n<e;)r[n++]=0}(P,D),function(t,e,r,u,h,d,p){var f=r.value,T=N(e,r),M=N(e,r);r.value+=4;var A=N(e,r);if(r.value+=4,T<0||T>=i||M<0||M>=i)throw"Something wrong with HUF_ENCSIZE";var E=new Array(i),C=new Array(o);if(function(t){for(var e=0;e<o;e++)t[e]={},t[e].len=0,t[e].lit=0,t[e].p=null}(C),function(t,e,r,n,o,a,u){for(var h=r,d=0,p=0;o<=a;o++){if(h.value-r.value>n)return!1;v(6,d,p,t,h);var f=m.l;if(d=m.c,p=m.lc,u[o]=f,f==l){if(h.value-r.value>n)throw"Something wrong with hufUnpackEncTable";if(v(8,d,p,t,h),d=m.c,p=m.lc,o+(y=m.l+c)>a+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)u[o++]=0;o--}else if(f>=s){var y;if(o+(y=f-s+2)>a+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)u[o++]=0;o--}}!function(t){for(var e=0;e<=58;++e)g[e]=0;for(e=0;e<i;++e)g[t[e]]+=1;var r=0;for(e=58;e>0;--e){var n=r+g[e]>>1;g[e]=r,r=n}for(e=0;e<i;++e){var o=t[e];o>0&&(t[e]=o|g[o]++<<6)}}(u)}(t,0,r,u-(r.value-f),T,M,E),A>8*(u-(r.value-f)))throw"Something wrong with hufUncompress";!function(t,e,r,i){for(;e<=r;e++){var o=x(t[e]),a=y(t[e]);if(o>>a)throw"Invalid table entry";if(a>n){if((u=i[o>>a-n]).len)throw"Invalid table entry";if(u.lit++,u.p){var s=u.p;u.p=new Array(u.lit);for(var l=0;l<u.lit-1;++l)u.p[l]=s[l]}else u.p=new Array(1);u.p[u.lit-1]=e}else if(a){var c=0;for(l=1<<n-a;l>0;l--){var u;if((u=i[(o<<n-a)+c]).len||u.p)throw"Invalid table entry";u.len=a,u.lit=e,c++}}}}(E,T,M,C),function(t,e,r,i,o,s,l,c,u,h){for(var d=0,f=0,m=p,v=Math.trunc(o.value+(s+7)/8);o.value<v;)for(w(d,f,r,o),d=b.c,f=b.lc;f>=n;)if((A=e[d>>f-n&a]).len)S(A.lit,l,d,f-=A.len,r,0,o,u,h,m),d=_.c,f=_.lc;else{if(!A.p)throw"hufDecode issues";var g;for(g=0;g<A.lit;g++){for(var T=y(t[A.p[g]]);f<T&&o.value<v;)w(d,f,r,o),d=b.c,f=b.lc;if(f>=T&&x(t[A.p[g]])==(d>>f-T&(1<<T)-1)){S(A.p[g],l,d,f-=T,r,0,o,u,h,m),d=_.c,f=_.lc;break}}if(g==A.lit)throw"hufDecode issues"}var M=8-s&7;for(d>>=M,f-=M;f>0;){var A;if(!(A=e[d<<n-f&a]).len)throw"hufDecode issues";S(A.lit,l,d,f-=A.len,r,0,o,u,h,m),d=_.c,f=_.lc}}(E,C,t,0,r,A,M,0,h,d)}(h,d,p,N(d,p),t,u,f);var U=new Array(T),k=0;for(R=0;R<T;R++)U[R]={},U[R].start=k,U[R].end=U[R].start,U[R].nx=A,U[R].ny=C,U[R].size=1,k+=U[R].nx*U[R].ny*U[R].size;var B=0;for(R=0;R<T;R++)for(var j=0;j<U[R].size;++j)B+=E(j+B,t,U[R].nx,U[R].size,U[R].ny,U[R].nx*U[R].size);return function(t,e,r){for(var n=0;n<r;++n)e[n]=t[e[n]]}(D,t,k),!0}function P(t,e){for(var r=new Uint8Array(t),n=0;0!=r[e.value+n];)n+=1;var i=(new TextDecoder).decode(r.slice(e.value,e.value+n));return e.value=e.value+n+1,i}function O(t,e){var r=t.getUint32(0,!0);return e.value=e.value+u,r}function N(t,e){var r=t.getUint32(e.value,!0);return e.value=e.value+d,r}function L(t,e){var r=t[e.value];return e.value=e.value+f,r}function I(t,e){var r=t.getUint8(e.value);return e.value=e.value+f,r}function R(t,e){var r=t.getFloat32(e.value,!0);return e.value+=h,r}function D(t){var e=(31744&t)>>10,r=1023&t;return(t>>15?-1:1)*(e?31===e?r?NaN:1/0:Math.pow(2,e-15)*(1+r/1024):r/1024*6103515625e-14)}function F(t,e){var r=t.getUint16(e.value,!0);return e.value+=p,r}function U(t,e){return D(F(t,e))}function k(t,e,r,n,i){if("string"==n||"iccProfile"==n)return function(t,e,r){var n=(new TextDecoder).decode(new Uint8Array(t).slice(e.value,e.value+r));return e.value=e.value+r,n}(e,r,i);if("chlist"==n)return function(t,e,r,n){for(var i=r.value,o=[];r.value<i+n-1;){var a=P(e,r),s=N(t,r),l=I(t,r);r.value+=3;var c=N(t,r),u=N(t,r);o.push({name:a,pixelType:s,pLinear:l,xSampling:c,ySampling:u})}return r.value+=1,o}(t,e,r,i);if("chromaticities"==n)return function(t,e){return{redX:R(t,e),redY:R(t,e),greenX:R(t,e),greenY:R(t,e),blueX:R(t,e),blueY:R(t,e),whiteX:R(t,e),whiteY:R(t,e)}}(e,r);if("compression"==n)return function(t,e){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION"][I(t,e)]}(t,r);if("box2i"==n)return function(t,e){return{xMin:N(t,e),yMin:N(t,e),xMax:N(t,e),yMax:N(t,e)}}(t,r);if("lineOrder"==n)return function(t,e){return["INCREASING_Y"][I(t,e)]}(t,r);if("float"==n)return R(t,r);if("v2f"==n)return function(t,e){return[R(t,e),R(t,e)]}(t,r);throw"Cannot parse value for unsupported type: "+n}for(var B=new DataView(t),j=new Uint8Array(t),z={},V=(B.getUint32(0,!0),B.getUint8(4,!0),B.getUint8(5,!0),{value:8}),G=!0;G;){var H=P(t,V);if(0==H)G=!1;else{var W=k(B,t,V,P(t,V),N(B,V));z[H]=W}}var X=1;"PIZ_COMPRESSION"==z.compression&&(X=32);for(var Y=(z.dataWindow.yMax+1)/X,q=0;q<Y;q++)O(B,V);var J=z.dataWindow.xMax-z.dataWindow.xMin+1,Z=z.dataWindow.yMax-z.dataWindow.yMin+1,Q=z.channels.length,K=new Float32Array(J*Z*Q),$={R:0,G:1,B:2,A:3};if("NO_COMPRESSION"==z.compression)for(var tt=0;tt<Z;tt++)for(var et=N(t,V),rt=(N(t,V),0);rt<z.channels.length;rt++){var nt=$[z.channels[rt].name];if(1!=z.channels[rt].pixelType)throw"Only supported pixel format is HALF";for(var it=0;it<J;it++){var ot=U(t,V);K[Z*Q*(J-et)+it*Q+nt]=ot}}else{if("PIZ_COMPRESSION"!=z.compression)throw"Cannot decompress unsupported compression";for(var at=0;at<Z/X;at++){N(B,V),N(B,V);var st=J*X*(2*z.channels.length),lt=new Uint16Array(st);C(lt,{value:0},j,B,V,st,Q,0,J,X);for(var ct=0;ct<X;ct++)for(rt=0;rt<z.channels.length;rt++){if(nt=$[z.channels[rt].name],1!=z.channels[rt].pixelType)throw"Only supported pixel format is HALF";for(it=0;it<J;it++)ot=D(lt[rt*(X*J)+ct*J+it]),K[J*Q*(Z-(ct+at*X))+it*Q+nt]=ot}}}return{header:z,width:J,height:Z,data:K,format:bh,type:1015}},Object.assign((function(t){this.manager=void 0!==t?t:Pd}).prototype,{load:function(t,e,r,n){var i=this,o=qd.extractUrlBase(t),a=new Nd(this.manager);a.setResponseType("arraybuffer"),a.load(t,function(r){try{var a=i.parse(r,o);e(a)}catch(e){window.setTimeout(function(){n&&n(e),i.manager.itemError(t)},0)}},r,n)},parse:function(t,e){var r;if(function(e){var r="Kaydara FBX Binary  \0";return t.byteLength>=r.length&&r===Im(t,0,r.length)}())r=(new Em).parse(t);else{var n=Im(t);if(!function(t){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(e){var n=t[e-1];return t=t.slice(r+e),r++,n}for(var i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}(n))throw new Error("FBXLoader: Unknown format.");if(Om(n)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+Om(n));r=(new Am).parse(n)}var i=function(t){var e=new Map;return"Connections"in t&&t.Connections.connections.forEach(function(t){var r=t[0],n=t[1],i=t[2];e.has(r)||e.set(r,{parents:[],children:[]});var o={ID:n,relationship:i};e.get(r).parents.push(o),e.has(n)||e.set(n,{parents:[],children:[]});var a={ID:r,relationship:i};e.get(n).children.push(a)}),e}(r),o=function(t){var e={},r={};if("Video"in t.Objects){var n=t.Objects.Video;for(var i in n){var o=n[i];if(e[s=parseInt(i)]=o.Filename,"Content"in o&&(o.Content instanceof ArrayBuffer&&o.Content.byteLength>0||"string"==typeof o.Content&&""!==o.Content)){var a=am(n[i]);r[o.Filename]=a}}}for(var s in e){var l=e[s];e[s]=void 0!==r[l]?r[l]:e[s].split("\\").pop()}return e}(r),a=function(t,e,r){var n=new Map;if("Material"in t.Objects){var i=t.Objects.Material;for(var o in i){var a=lm(t,i[o],e,r);null!==a&&n.set(parseInt(o),a)}}return n}(r,function(t,e,r,n){var i=new Map;if("Texture"in t.Objects){var o=t.Objects.Texture;for(var a in o){var s=sm(o[a],e,r,n);i.set(parseInt(a),s)}}return i}(r,new Xd(this.manager).setPath(e),o,i),i),s=function(t,e){var r={};if("Deformer"in t.Objects){var n=t.Objects.Deformer;for(var i in n)if("Skin"===n[i].attrType){var o=e.get(parseInt(i)),a=um(o,n);a.ID=i,o.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,r[i]=a}}return r}(r,i);return function(t,e,r,n,i){var o=new Nf,a=function(t,e,r,n,i){var o=new Map,a=t.Objects.Model;for(var s in a){var l=parseInt(s),c=a[s],u=i.get(l),h=vm(u,e,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=gm(t,u);break;case"Light":h=ym(t,u);break;case"Mesh":h=xm(0,u,r,n);break;case"NurbsCurve":h=bm(u,r);break;case"LimbNode":case"Null":default:h=new Nf}h.name=tf.sanitizeNodeName(c.attrName),h.ID=l}wm(0,h,c),o.set(l,h)}return o}(t,r,n,i,e),s=t.Objects.Model;return a.forEach(function(r){!function(t,e,r,n,i){"LookAtProperty"in r&&n.get(e.ID).children.forEach(function(r){if("LookAtProperty"===r.relationship){var n=t.Objects.Model[r.ID];if("Lcl_Translation"in n){var o=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(o),i.add(e.target)):e.lookAt((new yu).fromArray(o))}}})}(t,r,s[r.ID],e,o),e.get(r.ID).parents.forEach(function(t){var e=a.get(t.ID);void 0!==e&&e.add(r)}),null===r.parent&&o.add(r)}),function(t,e,r,n,i){var o=function(t){var e={};if("Pose"in t.Objects){var r=t.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=(new gu).fromArray(t.Matrix.a)}):e[i.Node]=(new gu).fromArray(i.Matrix.a)}}return e}(t);for(var a in e){var s=e[a];i.get(parseInt(s.ID)).parents.forEach(function(t){r.has(t.ID)&&i.get(t.ID).parents.forEach(function(t){n.has(t.ID)&&n.get(t.ID).bind(new Df(s.bones),o[t.ID])})})}}(t,r,n,a,e),function(t,e,r){r.animations=[];var n=function(t,e){if(void 0!==t.Objects.AnimationCurve){var r=function(t){var e=t.Objects.AnimationCurveNode,r=new Map;for(var n in e){var i=e[n];if(null!==i.attrName.match(/S|R|T/)){var o={id:i.id,attr:i.attrName,curves:{}};r.set(o.id,o)}}return r}(t);return function(t,e,r){var n=t.Objects.AnimationCurve;for(var i in n){var o={id:n[i].id,times:n[i].KeyTime.a.map(Nm),values:n[i].KeyValueFloat.a},a=e.get(o.id);if(void 0!==a){var s=a.parents[0].ID,l=a.parents[0].relationship,c="";if(l.match(/X/))c="x";else if(l.match(/Y/))c="y";else{if(!l.match(/Z/))continue;c="z"}r.get(s).curves[c]=o}}}(t,e,r),function(t,e,r){var n=t.Objects.AnimationStack,i={};for(var o in n){var a=e.get(parseInt(o)).children;a.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(a[0].ID);i[o]={name:n[o].attrName,layer:s}}return i}(t,e,function(t,e,r){var n=t.Objects.AnimationLayer,i=new Map;for(var o in n){var a=[],s=e.get(parseInt(o));void 0!==s&&(s.children.forEach(function(n,i){if(r.has(n.ID)){var o=r.get(n.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===a[i]){var s;e.get(n.ID).parents.forEach(function(t){void 0!==t.relationship&&(s=t.ID)});var l=t.Objects.Model[s.toString()],c={modelName:tf.sanitizeNodeName(l.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in l&&(c.initialPosition=l.Lcl_Translation.value),"Lcl_Rotation"in l&&(c.initialRotation=l.Lcl_Rotation.value),"Lcl_Scaling"in l&&(c.initialScale=l.Lcl_Scaling.value),"PreRotation"in l&&(c.preRotations=l.PreRotation.value),a[i]=c}a[i][o.attr]=o}}}),i.set(parseInt(o),a))}return i}(t,e,r))}}(t,e);if(void 0!==n)for(var i in n){var o=_m(n[i]);r.animations.push(o)}}(t,e,o),function(t,e){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var r=t.GlobalSettings.AmbientColor.value,n=r[0],i=r[1],o=r[2];if(0!==n||0!==i||0!==o){var a=new Eu(n,i,o);e.add(new Qf(a,1))}}}(t,o),o}(r,i,s,function(t,e,r){var n=new Map;if("Geometry"in t.Objects){var i=t.Objects.Geometry;for(var o in i){var a=hm(t,e.get(parseInt(o)),i[o],r);n.set(parseInt(o),a)}}return n}(r,i,s),a)}});var pm=[],fm={ByPolygonVertex:{Direct:function(t,e,r,n){return Rm(pm,n.buffer,t*n.dataSize,t*n.dataSize+n.dataSize)},IndexToDirect:function(t,e,r,n){var i=n.indices[t];return Rm(pm,n.buffer,i*n.dataSize,i*n.dataSize+n.dataSize)}},ByPolygon:{Direct:function(t,e,r,n){return Rm(pm,n.buffer,e*n.dataSize,e*n.dataSize+n.dataSize)},IndexToDirect:function(t,e,r,n){var i=n.indices[e];return Rm(pm,n.buffer,i*n.dataSize,i*n.dataSize+n.dataSize)}},ByVertice:{Direct:function(t,e,r,n){return Rm(pm,n.buffer,r*n.dataSize,r*n.dataSize+n.dataSize)}},AllSame:{IndexToDirect:function(t,e,r,n){return Rm(pm,n.buffer,n.indices[0]*n.dataSize,n.indices[0]*n.dataSize+n.dataSize)}}};function mm(t,e,r,n){return fm[n.mappingType][n.referenceType](t,e,r,n)}function vm(t,e,r,n){var i=null;return t.parents.forEach(function(t){for(var o in e){var a=e[o];a.rawBones.forEach(function(e,o){if(e.ID===t.ID){var s=i;(i=new Wh).matrixWorld.copy(e.transformLink),i.name=tf.sanitizeNodeName(n),i.ID=r,a.bones[o]=i,null!==s&&i.add(s)}})}}),i}function gm(t,e){var r,n;if(e.children.forEach(function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)}),void 0===n)r=new Mu;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var a=1e3;void 0!==n.FarPlane&&(a=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var c=s/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new fd(u,c,o,a),null!==h&&r.setFocalLength(h);break;case 1:r=new gd(-s/2,s/2,l/2,-l/2,o,a);break;default:console.warn("FBXLoader: Unknown camera type "+i+"."),r=new Mu}}return r}function ym(t,e){var r,n;if(e.children.forEach(function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)}),void 0===n)r=new Mu;else{var i;i=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new Eu).fromArray(n.Color.value));var a=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(a=0);var s=0;switch(void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),i){case 0:r=new Gf(o,a,s,1);break;case 1:r=new Wf(o,a);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=vu.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=vu.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new Yf(o,a,s,l,c,1);break;default:console.warn("FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new Gf(o,a)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r}function xm(t,e,r,n){var i,o=null,a=null,s=[];return e.children.forEach(function(t){r.has(t.ID)&&(o=r.get(t.ID)),n.has(t.ID)&&s.push(n.get(t.ID))}),s.length>1?a=s:s.length>0?a=s[0]:(a=new Fd({color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach(function(t){t.vertexColors=eh}),o.FBX_Deformer?(s.forEach(function(t){t.skinning=!0}),i=new Ff(o,a)):i=new zh(o,a),i}function bm(t,e){return new Vh(t.children.reduce(function(t,r){return e.has(r.ID)&&(t=e.get(r.ID)),t},null),new Fh({color:3342591,linewidth:1}))}function wm(t,e,r){if("RotationOrder"in r){var n=parseInt(r.RotationOrder.value,10);n>0&&n<6?console.warn("FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"][n]):6===n&&console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in r&&e.position.fromArray(r.Lcl_Translation.value),"Lcl_Rotation"in r){var i=r.Lcl_Rotation.value.map(vu.degToRad);i.push("ZYX"),e.quaternion.setFromEuler((new wu).fromArray(i))}if("Lcl_Scaling"in r&&e.scale.fromArray(r.Lcl_Scaling.value),"PreRotation"in r){var o=r.PreRotation.value.map(vu.degToRad);o[3]="ZYX";var a=(new wu).fromArray(o);a=(new xu).setFromEuler(a),e.quaternion.premultiply(a)}}function _m(t){var e=[];return t.layer.forEach(function(t){e=e.concat(function(t){var e=[];if(void 0!==t.T&&Object.keys(t.T.curves).length>0){var r=Sm(t.modelName,t.T.curves,t.initialPosition,"position");void 0!==r&&e.push(r)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var n=function(t,e,r,n){void 0!==e.x&&(e.x.values=e.x.values.map(vu.degToRad)),void 0!==e.y&&(e.y.values=e.y.values.map(vu.degToRad)),void 0!==e.z&&(e.z.values=e.z.values.map(vu.degToRad));var i=Mm(e),o=Tm(i,e,r);void 0!==n&&((n=n.map(vu.degToRad)).push("ZYX"),n=(new wu).fromArray(n),n=(new xu).setFromEuler(n));for(var a=new xu,s=new wu,l=[],c=0;c<o.length;c+=3)s.set(o[c],o[c+1],o[c+2],"ZYX"),a.setFromEuler(s),void 0!==n&&a.premultiply(n),a.toArray(l,c/3*4);return new rd(t+".quaternion",i,l)}(t.modelName,t.R.curves,t.initialRotation,t.preRotations);void 0!==n&&e.push(n)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var i=Sm(t.modelName,t.S.curves,t.initialScale,"scale");void 0!==i&&e.push(i)}return e}(t))}),new hd(t.name,-1,e)}function Sm(t,e,r,n){var i=Mm(e);return new id(t+"."+n,i,Tm(i,e,r))}function Tm(t,e,r){var n=r,i=[],o=-1,a=-1,s=-1;return t.forEach(function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==o){var r=e.x.values[o];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==a){var l=e.y.values[a];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==s){var c=e.z.values[s];i.push(c),n[2]=c}else i.push(n[2])}),i}function Mm(t){var e=[];return void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e.sort(function(t,e){return t-e}).filter(function(t,e,r){return r.indexOf(t)==e})}function Am(){}function Em(){}function Cm(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function Pm(){}function Om(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function Nm(t){return t/46186158e3}function Lm(t){return t.split(",").map(function(t){return parseFloat(t)})}function Im(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=t.byteLength),qd.decodeText(new Uint8Array(t,e,r))}function Rm(t,e,r,n){for(var i=r,o=0;i<n;i++,o++)t[o]=e[i];return t}Object.assign(Am.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new Pm,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,r=t.split("\n");return r.forEach(function(t,n){var i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!i&&!o){var a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,r[++n]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}}),this.allNodes},parseNodeBegin:function(t,e){var r=e[1].trim().replace(/^"/,"").replace(/"$/,""),n=e[2].split(",").map(function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:r},o=this.parseNodeAttr(n),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in a?("PoseNode"===r?a.PoseNode.push(i):void 0!==a[r].id&&(a[r]={},a[r][a[r].id]=a[r]),""!==o.id&&(a[r][o.id]=i)):"number"==typeof o.id?(a[r]={},a[r][o.id]=i):"Properties70"!==r&&(a[r]="PoseNode"===r?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var r="",n="";return t.length>1&&(r=t[1].replace(/^(\w+)::/,""),n=t[2]),{id:e,name:r,type:n}},parseNodeProperty:function(t,e,r){var n=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){var a=i.split(",").slice(1),s=parseInt(a[0]),l=parseInt(a[1]),c=i.split(",").slice(3);n="connections",function(t,e){for(var r=0,n=t.length,i=e.length;r<i;r++,n++)t[n]=e[r]}(i=[s,l],c=c.map(function(t){return t.trim().replace(/^"/,"")})),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=i),n in o&&Array.isArray(o[n])?o[n].push(i):"a"!==n?o[n]=i:o.a=i,this.setCurrentProp(o,n),"a"===n&&","!==i.slice(-1)&&(o.a=Lm(i))}else this.parseNodeSpecialProperty(t,n,i)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=Lm(e.a))},parseNodeSpecialProperty:function(t,e,r){var n=r.split('",').map(function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=n[0],o=n[1],a=n[2],s=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Lm(l)}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}}),Object.assign(Em.prototype,{parse:function(t){var e=new Cm(t);e.skip(23);var r=e.getUint32();console.log("FBXLoader: FBX binary version: "+r);for(var n=new Pm;!this.endOfContent(e);){var i=this.parseNode(e,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var r={},n=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32(),o=(e>=7500?t.getUint64():t.getUint32(),t.getUint8()),a=t.getString(o);if(0===n)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(t));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===i&&t.getOffset()===n;n>t.getOffset();){var d=this.parseNode(t,e);null!==d&&this.parseSubNode(a,r,d)}return r.propertyList=s,"number"==typeof c&&(r.id=c),""!==u&&(r.attrName=u),""!==h&&(r.attrType=h),""!==a&&(r.name=a),r},parseSubNode:function(t,e,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(e[r.name]=r,r.a=n):e[r.name]=n}else if("Connections"===t&&"C"===r.name){var i=[];r.propertyList.forEach(function(t,e){0!==e&&i.push(t)}),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===r.name)Object.keys(r).forEach(function(t){e[t]=r[t]});else if("Properties70"===t&&"P"===r.name){var o,a=r.propertyList[0],s=r.propertyList[1],l=r.propertyList[2],c=r.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],e[a]={type:s,type2:l,flag:c,value:o}}else void 0===e[r.name]?"number"==typeof r.id?(e[r.name]={},e[r.name][r.id]=r):e[r.name]=r:"PoseNode"===r.name?(Array.isArray(e[r.name])||(e[r.name]=[e[r.name]]),e[r.name].push(r)):void 0===e[r.name][r.id]&&(e[r.name][r.id]=r)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var r=t.getUint32();return t.getArrayBuffer(r);case"S":return r=t.getUint32(),t.getString(r);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=t.getUint32(),i=t.getUint32(),o=t.getUint32();if(0===i)switch(e){case"b":case"c":return t.getBooleanArray(n);case"d":return t.getFloat64Array(n);case"f":return t.getFloat32Array(n);case"i":return t.getInt32Array(n);case"l":return t.getInt64Array(n)}void 0===window.Zlib&&console.error("FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new Cm(new Zlib.Inflate(new Uint8Array(t.getArrayBuffer(o))).decompress().buffer);switch(e){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}default:throw new Error("FBXLoader: Unknown property type "+e)}}}),Object.assign(Cm.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295==(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t},getInt64Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.getUint8();var n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),qd.decodeText(e)}}),Object.assign(Pm.prototype,{add:function(t,e){this[t]=e}});var Dm=function(t){this.manager=void 0!==t?t:Pd,this.splitLayer=!1};function Fm(t,e,r,n,i,o,a,s,l,c){xd.call(this,t=void 0!==t?t:[],e=void 0!==e?e:lh,r,n,i,o,a,s,l,c),this.flipY=!1}Dm.prototype.load=function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(t))},r,n)},Dm.prototype.parse=function(t){var e={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},r=[],n=void 0,i=new Fh({color:16711680});i.name="path";var o=new Fh({color:65280});function a(t){r.push(n={vertex:[],pathVertex:[],z:t.z})}function s(t,e){void 0===n&&a(t),m.extruding?(n.vertex.push(t.x,t.y,t.z),n.vertex.push(e.x,e.y,e.z)):(n.pathVertex.push(t.x,t.y,t.z),n.pathVertex.push(e.x,e.y,e.z))}function l(t,r){return e.relative?r:r-t}function c(t,r){return e.relative?t+r:r}o.name="extruded";for(var u=t.replace(/;.+/g,"").split("\n"),h=0;h<u.length;h++){var d=u[h].split(" "),p=d[0].toUpperCase(),f={};if(d.splice(1).forEach(function(t){if(void 0!==t[0]){var e=t[0].toLowerCase(),r=parseFloat(t.substring(1));f[e]=r}}),"G0"===p||"G1"===p){var m={x:void 0!==f.x?c(e.x,f.x):e.x,y:void 0!==f.y?c(e.y,f.y):e.y,z:void 0!==f.z?c(e.z,f.z):e.z,e:void 0!==f.e?c(e.e,f.e):e.e,f:void 0!==f.f?c(e.f,f.f):e.f};l(e.e,m.e)>0&&(m.extruding=l(e.e,m.e)>0,void 0!=n&&m.z==n.z||a(m)),s(e,m),e=m}else"G2"===p||"G3"===p?console.warn("GCodeLoader: Arc command not supported"):"G90"===p?e.relative=!1:"G91"===p?e.relative=!0:"G92"===p?((m=e).x=void 0!==f.x?f.x:m.x,m.y=void 0!==f.y?f.y:m.y,m.z=void 0!==f.z?f.z:m.z,m.e=void 0!==f.e?f.e:m.e,e=m):console.warn("GCodeLoader: Command not supported:"+p)}function v(t,e){var r=new Yu;r.addAttribute("position",new Gu(t,3));var n=new Kf(r,e?o:i);n.name="layer"+h,g.add(n)}var g=new Nf;if(g.name="gcode",this.splitLayer)for(h=0;h<r.length;h++)v((b=r[h]).vertex,!0),v(b.pathVertex,!1);else{var y=[],x=[];for(h=0;h<r.length;h++){var b;y=y.concat((b=r[h]).vertex),x=x.concat(b.pathVertex)}v(y,!0),v(x,!1)}return g.quaternion.setFromEuler(new wu(-Math.PI/2,0,0)),g},function(){function t(t){this.manager=void 0!==t?t:Pd,this.dracoLoader=null}t.prototype={constructor:t,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=void 0!==this.path?this.path:qd.extractUrlBase(t),a=new Nd(i.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){try{i.parse(t,o,e,n)}catch(t){if(void 0===n)throw t;n(t)}},r,n)},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setDRACOLoader:function(t){return this.dracoLoader=t,this},parse:function(t,s,l,c){var u,h={};if("string"==typeof t)u=t;else if(qd.decodeText(new Uint8Array(t,0,4))===n){try{h[e.KHR_BINARY_GLTF]=new function(t){this.name=e.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(t,0,i);if(this.header={magic:qd.decodeText(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==n)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var a=new DataView(t,i),s=0;s<a.byteLength;){var l=a.getUint32(s,!0),c=a.getUint32(s+=4,!0);if(s+=4,c===o.JSON){var u=new Uint8Array(t,i+s,l);this.content=qd.decodeText(u)}else if(c===o.BIN){var h=i+s;this.body=t.slice(h,h+l)}s+=l}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")}(t)}catch(t){return void(c&&c(t))}u=h[e.KHR_BINARY_GLTF].content}else u=qd.decodeText(new Uint8Array(t));var d=JSON.parse(u);void 0===d.asset||d.asset.version[0]<2?c&&c(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")):(d.extensionsUsed&&(d.extensionsUsed.indexOf(e.KHR_LIGHTS)>=0&&(h[e.KHR_LIGHTS]=new function(t){this.name=e.KHR_LIGHTS,this.lights={};var r=(t.extensions&&t.extensions[e.KHR_LIGHTS]||{}).lights||{};for(var n in r){var i,o=r[n],a=(new Eu).fromArray(o.color);switch(o.type){case"directional":(i=new Wf(a)).position.set(0,0,1);break;case"point":i=new Gf(a);break;case"spot":(i=new Yf(a)).position.set(0,0,1);break;case"ambient":i=new Qf(a)}i&&(void 0!==o.constantAttenuation&&(i.intensity=o.constantAttenuation),void 0!==o.linearAttenuation&&(i.distance=1/o.linearAttenuation),void 0!==o.quadraticAttenuation&&(i.decay=o.quadraticAttenuation),void 0!==o.fallOffAngle&&(i.angle=o.fallOffAngle),void 0!==o.fallOffExponent&&console.warn("GLTFLoader:: light.fallOffExponent not currently supported."),i.name=o.name||"light_"+n,this.lights[n]=i)}}(d)),d.extensionsUsed.indexOf(e.KHR_MATERIALS_UNLIT)>=0&&(h[e.KHR_MATERIALS_UNLIT]=new r(d)),d.extensionsUsed.indexOf(e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(h[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new function(){return{name:e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return _d},extendParams:function(t,e,r){var n=e.extensions[this.name],i=Kp.standard,o=wd.clone(i.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=i.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new Eu).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},t.vertexShader=i.vertexShader,t.fragmentShader=h,t.uniforms=o,t.defines={STANDARD:""},t.color=new Eu(1,1,1),t.opacity=1;var d=[];if(Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;t.color.fromArray(p),t.opacity=p[3]}if(void 0!==n.diffuseTexture&&d.push(r.assignTexture(t,"map",n.diffuseTexture.index)),t.emissive=new Eu(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new Eu(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var f=n.specularGlossinessTexture.index;d.push(r.assignTexture(t,"glossinessMap",f)),d.push(r.assignTexture(t,"specularMap",f))}return Promise.all(d)},createMaterial:function(t){var e=new _d({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return e.isGLTFSpecularGlossinessMaterial=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e.extensions.derivatives=!0,e},cloneMaterial:function(t){var e=t.clone();e.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,n=0,i=r.length;n<i;n++)e[r[n]]=t[r[n]];return e},refreshUniforms:function(t,e,r,n,i,o){if(!0===i.isGLTFSpecularGlossinessMaterial){var a,s,l,c=i.uniforms,u=i.defines;if(c.opacity.value=i.opacity,c.diffuse.value.copy(i.color),c.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),c.map.value=i.map,c.specularMap.value=i.specularMap,c.alphaMap.value=i.alphaMap,c.lightMap.value=i.lightMap,c.lightMapIntensity.value=i.lightMapIntensity,c.aoMap.value=i.aoMap,c.aoMapIntensity.value=i.aoMapIntensity,i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.glossinessMap?a=i.glossinessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap&&(a=i.emissiveMap),void 0!==a)if(a.isWebGLRenderTarget&&(a=a.texture),void 0!==a.matrix){if(!0===a.matrixAutoUpdate){var h=a.center;a.matrix.setUvTransform((s=a.offset).x,s.y,(l=a.repeat).x,l.y,a.rotation,h.x,h.y)}c.uvTransform.value.copy(a.matrix)}else c.offsetRepeat.value.set((s=a.offset).x,s.y,(l=a.repeat).x,l.y);c.envMap.value=i.envMap,c.envMapIntensity.value=i.envMapIntensity,c.flipEnvMap.value=i.envMap&&i.envMap.isCubeTexture?-1:1,c.refractionRatio.value=i.refractionRatio,c.specular.value.copy(i.specular),c.glossiness.value=i.glossiness,c.glossinessMap.value=i.glossinessMap,c.emissiveMap.value=i.emissiveMap,c.bumpMap.value=i.bumpMap,c.normalMap.value=i.normalMap,c.displacementMap.value=i.displacementMap,c.displacementScale.value=i.displacementScale,c.displacementBias.value=i.displacementBias,null!==c.glossinessMap.value&&void 0===u.USE_GLOSSINESSMAP&&(u.USE_GLOSSINESSMAP="",u.USE_ROUGHNESSMAP=""),null===c.glossinessMap.value&&void 0!==u.USE_GLOSSINESSMAP&&(delete u.USE_GLOSSINESSMAP,delete u.USE_ROUGHNESSMAP)}}}}),d.extensionsUsed.indexOf(e.KHR_DRACO_MESH_COMPRESSION)>=0&&(h[e.KHR_DRACO_MESH_COMPRESSION]=new a(this.dracoLoader))),console.time("GLTFLoader"),new _(d,h,{path:s||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(t,e,r,n,i){console.timeEnd("GLTFLoader"),l({scene:t,scenes:e,cameras:r,animations:n,asset:i})},c))}};var e={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit"};function r(t){this.name=e.KHR_MATERIALS_UNLIT}r.prototype.getMaterialType=function(t){return Dh},r.prototype.extendParams=function(t,e,r){var n=[];t.color=new Eu(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(t,"map",i.baseColorTexture.index))}return Promise.all(n)};var n="glTF",i=12,o={JSON:1313821514,BIN:5130562};function a(t){if(!t)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=e.KHR_DRACO_MESH_COMPRESSION,this.dracoLoader=t}function s(t,e,r,n){td.call(this,t,e,r,n)}a.prototype.decodePrimitive=function(t,e){var r=this.dracoLoader,n=t.extensions[this.name].bufferView,i=t.extensions[this.name].attributes,o={};for(var a in i)a in f&&(o[f[a]]=i[a]);return e.getDependency("bufferView",n).then(function(t){return new Promise(function(e){r.decodeDracoFile(t,e,o)})})},(s.prototype=Object.create(td.prototype)).constructor=s,s.prototype.interpolate_=function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=n-e,u=(r-e)/c,h=u*u,d=h*u,p=t*l,f=p-l,m=2*d-3*h+1,v=d-2*h+u,g=-2*d+3*h,y=d-h,x=0;x!==a;x++)i[x]=m*o[f+x+a]+v*(o[f+x+s]*c)+g*o[p+x+a]+y*(o[p+x]*c);return i};var l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:fh,9729:mh,9984:1004,9985:1007,9986:1005,9987:vh},u={33071:dh,33648:ph,10497:hh},h={6406:1021,6407:bh,6408:wh,6409:1024,6410:1025},d={5121:gh,32819:1017,32820:1018,33635:1019},p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},f={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},m={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},v={CUBICSPLINE:2302,LINEAR:2301,STEP:Ah};function g(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:/^blob:.*$/i.test(t)?t:e+t}function y(t,e,r,n){var i=t.geometry,o=t.material,a=r.targets,s=i.morphAttributes;s.position=[],s.normal=[],o.morphTargets=!0;for(var l=0,c=a.length;l<c;l++){var u,h,d=a[l],p="morphTarget"+l;if(void 0!==d.POSITION){u=w(n[d.POSITION]);for(var f=i.attributes.position,m=0,v=u.count;m<v;m++)u.setXYZ(m,u.getX(m)+f.getX(m),u.getY(m)+f.getY(m),u.getZ(m)+f.getZ(m))}else i.attributes.position&&(u=w(i.attributes.position));if(void 0!==u&&(u.name=p,s.position.push(u)),void 0!==d.NORMAL){o.morphNormals=!0,h=w(n[d.NORMAL]);var g=i.attributes.normal;for(m=0,v=h.count;m<v;m++)h.setXYZ(m,h.getX(m)+g.getX(m),h.getY(m)+g.getY(m),h.getZ(m)+g.getZ(m))}else void 0!==i.attributes.normal&&(h=w(i.attributes.normal));void 0!==h&&(h.name=p,s.normal.push(h))}if(t.updateMorphTargets(),void 0!==e.weights)for(l=0,c=e.weights.length;l<c;l++)t.morphTargetInfluences[l]=e.weights[l];if(e.extras&&Array.isArray(e.extras.targetNames))for(l=0,c=e.extras.targetNames.length;l<c;l++)t.morphTargetDictionary[e.extras.targetNames[l]]=l}function x(t,e){if(t.indices!==e.indices)return!1;var r=t.attributes||{},n=e.attributes||{},i=Object.keys(r),o=Object.keys(n);if(i.length!==o.length)return!1;for(var a=0,s=i.length;a<s;a++){var l=i[a];if(r[l]!==n[l])return!1}return!0}function b(t,e){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(x(i.primitive,e))return i.promise}return null}function w(t){if(t.isInterleavedBufferAttribute){for(var e=t.count,r=t.itemSize,n=t.array.slice(0,e*r),i=0;i<e;++i)n[i]=t.getX(i),r>=2&&(n[i+1]=t.getY(i)),r>=3&&(n[i+2]=t.getZ(i)),r>=4&&(n[i+3]=t.getW(i));return new Du(n,r,t.normalized)}return t.clone()}function _(t,e,r){this.json=t||{},this.extensions=e||{},this.options=r||{},this.cache=new function(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}}}},this.primitiveCache=[],this.textureLoader=new Xd(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new Nd(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function S(t,e,r){var n=e.attributes;for(var i in n){var o=f[i];o&&(o in t.attributes||t.addAttribute(o,r[n[i]]))}void 0===e.indices||t.index||t.setIndex(r[e.indices])}_.prototype.parse=function(t,e){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(e){var n=e.scenes||[];t(n[r.scene||0],n,e.cameras||[],e.animations||[],r.asset)}).catch(e)},_.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[],n={},i={},o=0,a=e.length;o<a;o++)for(var s=e[o].joints,l=0,c=s.length;l<c;l++)t[s[l]].isBone=!0;for(var u=0,h=t.length;u<h;u++){var d=t[u];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},_.prototype.getDependency=function(t,e){var r=t+":"+e,n=this.cache.get(r);return n||(n=this["load"+t.charAt(0).toUpperCase()+t.slice(1)](e),this.cache.add(r,n)),n},_.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var r=this;e=Promise.all((this.json[t+("mesh"===t?"es":"s")]||[]).map(function(e,n){return r.getDependency(t,n)})),this.cache.add(t,e)}return e},_.prototype.getMultiDependencies=function(t){for(var e={},r=[],n=0,i=t.length;n<i;n++){var o=t[n],a=this.getDependencies(o);a=a.then((function(t,r){e[t]=r}).bind(this,o+("mesh"===o?"es":"s"))),r.push(a)}return Promise.all(r).then(function(){return e})},_.prototype.loadBuffer=function(t){var r=this.json.buffers[t],n=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===t)return Promise.resolve(this.extensions[e.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(t,e){n.load(g(r.uri,i.path),t,void 0,function(){e(new Error('GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})},_.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){var r=e.byteOffset||0;return t.slice(r,r+(e.byteLength||0))})},_.prototype.loadAccessor=function(t){var e=this,r=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return null;var i=[];return i.push(void 0!==n.bufferView?this.getDependency("bufferView",n.bufferView):null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(t){var i,o=t[0],a=p[n.type],s=l[n.componentType],c=s.BYTES_PER_ELEMENT,u=n.byteOffset||0,h=r.bufferViews[n.bufferView].byteStride,d=!0===n.normalized;if(h&&h!==c*a){var f="InterleavedBuffer:"+n.bufferView+":"+n.componentType,m=e.cache.get(f);m||(m=new bf(new s(o),h/c),e.cache.add(f,m)),i=new _f(m,a,u/c,d)}else i=new Du(null===o?new s(n.count*a):new s(o,u,n.count*a),a,d);if(void 0!==n.sparse){var v=n.sparse.values.byteOffset||0,g=new(0,l[n.sparse.indices.componentType])(t[1],n.sparse.indices.byteOffset||0,n.sparse.count*p.SCALAR),y=new s(t[2],v,n.sparse.count*a);null!==o&&i.setArray(i.array.slice());for(var x=0,b=g.length;x<b;x++){var w=g[x];if(i.setX(w,y[x*a]),a>=2&&i.setY(w,y[x*a+1]),a>=3&&i.setZ(w,y[x*a+2]),a>=4&&i.setW(w,y[x*a+3]),a>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},_.prototype.loadTexture=function(t){var e=this.json,r=this.options,n=this.textureLoader,i=window.URL||window.webkitURL,o=e.textures[t],a=e.images[o.source],s=a.uri,l=!1;return void 0!==a.bufferView&&(s=this.getDependency("bufferView",a.bufferView).then(function(t){l=!0;var e=new Blob([t],{type:a.mimeType});return s=i.createObjectURL(e)})),Promise.resolve(s).then(function(t){var e=Yd.Handlers.get(t)||n;return new Promise(function(n,i){e.load(g(t,r.path),n,void 0,i)})}).then(function(t){!0===l&&i.revokeObjectURL(s),t.flipY=!1,void 0!==o.name&&(t.name=o.name),t.format=void 0!==o.format?h[o.format]:wh,void 0!==o.internalFormat&&t.format!==h[o.internalFormat]&&console.warn("GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==o.type?d[o.type]:gh;var r=(e.samplers||{})[o.sampler]||{};return t.magFilter=c[r.magFilter]||mh,t.minFilter=c[r.minFilter]||vh,t.wrapS=u[r.wrapS]||hh,t.wrapT=u[r.wrapT]||hh,t})},_.prototype.assignTexture=function(t,e,r){return this.getDependency("texture",r).then(function(r){t[e]=r})},_.prototype.loadMaterial=function(t){var r,n=this.extensions,i=this.json.materials[t],o={},a=i.extensions||{},s=[];if(a[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=l.getMaterialType(i),s.push(l.extendParams(o,i,this))}else if(a[e.KHR_MATERIALS_UNLIT]){var c=n[e.KHR_MATERIALS_UNLIT];r=c.getMaterialType(i),s.push(c.extendParams(o,i,this))}else if(void 0!==i.pbrMetallicRoughness){r=Ud;var u=i.pbrMetallicRoughness;if(o.color=new Eu(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){var h=u.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}if(void 0!==u.baseColorTexture&&s.push(this.assignTexture(o,"map",u.baseColorTexture.index)),o.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,o.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture){var d=u.metallicRoughnessTexture.index;s.push(this.assignTexture(o,"metalnessMap",d)),s.push(this.assignTexture(o,"roughnessMap",d))}}else r=Fd;!0===i.doubleSided&&(o.side=Ku);var p=i.alphaMode||"OPAQUE";return"BLEND"===p?o.transparent=!0:(o.transparent=!1,"MASK"===p&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&r!==Dh&&(s.push(this.assignTexture(o,"normalMap",i.normalTexture.index)),o.normalScale=new Nu(1,1),void 0!==i.normalTexture.scale&&o.normalScale.set(i.normalTexture.scale,i.normalTexture.scale)),void 0!==i.occlusionTexture&&r!==Dh&&(s.push(this.assignTexture(o,"aoMap",i.occlusionTexture.index)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&r!==Dh&&(o.emissive=(new Eu).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&r!==Dh&&s.push(this.assignTexture(o,"emissiveMap",i.emissiveTexture.index)),Promise.all(s).then(function(){var t;return t=r===_d?n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),void 0!==i.name&&(t.name=i.name),t.normalScale&&(t.normalScale.x=-t.normalScale.x),t.map&&(t.map.encoding=3001),t.emissiveMap&&(t.emissiveMap.encoding=3001),i.extras&&(t.userData=i.extras),t})},_.prototype.loadGeometries=function(t){var r=this,n=this.extensions,i=this.primitiveCache;return this.getDependencies("accessor").then(function(o){for(var a=[],s=[],l=0,c=t.length;l<c;l++){var u,h=t[l],d=b(i,h);if(d)s.push(d.then(function(t){a.push(t)}));else if(h.extensions&&h.extensions[e.KHR_DRACO_MESH_COMPRESSION]){var p=n[e.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(h,r).then(function(t){return S(t,h,o),a.push(t),t});i.push({primitive:h,promise:p}),s.push(p)}else S(u=new Yu,h,o),i.push({primitive:h,promise:Promise.resolve(u)}),a.push(u)}return Promise.all(s).then(function(){return a})})},_.prototype.loadMesh=function(t){var r=this,n=this.extensions,i=this.json.meshes[t];return this.getMultiDependencies(["accessor","material"]).then(function(o){var a=new Nf,s=i.primitives;return r.loadGeometries(s).then(function(l){for(var c=0,u=s.length;c<u;c++){var h=s[c],d=l[c],p=void 0===h.material?new Ud({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Zu}):o.materials[h.material];p.aoMap&&void 0===d.attributes.uv2&&void 0!==d.attributes.uv&&(console.log("GLTFLoader: Duplicating UVs to support aoMap."),d.addAttribute("uv2",new Du(d.attributes.uv.array,2)));var f,m=void 0!==d.attributes.color,v=void 0===d.attributes.normal,g=!0===i.isSkinnedMesh,x=void 0!==h.targets;if((m||v||g||x)&&(p=p.isGLTFSpecularGlossinessMaterial?n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(p):p.clone()),m&&(p.vertexColors=eh,p.needsUpdate=!0),v&&(p.flatShading=!0),4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)g?(f=new Ff(d,p),p.skinning=!0):f=new zh(d,p),5===h.mode?f.drawMode=Ph:6===h.mode&&(f.drawMode=Oh);else if(1===h.mode||3===h.mode||2===h.mode){var b=r.cache.get(w="LineBasicMaterial:"+p.uuid);b||(b=new Fh,Rh.prototype.copy.call(b,p),b.color.copy(p.color),b.lights=!1,r.cache.add(w,b)),p=b,f=1===h.mode?new Kf(d,p):3===h.mode?new Vh(d,p):new nm(d,p)}else{if(0!==h.mode)throw new Error("GLTFLoader: Primitive mode unsupported: "+h.mode);var w,_=r.cache.get(w="PointsMaterial:"+p.uuid);_||(_=new jd,Rh.prototype.copy.call(_,p),_.color.copy(p.color),_.map=p.map,_.lights=!1,r.cache.add(w,_)),f=new mf(d,p=_)}if(f.name=i.name||"mesh_"+t,x&&y(f,i,h,o.accessors),void 0!==i.extras&&(f.userData=i.extras),void 0!==h.extras&&(f.geometry.userData=h.extras),!0===p.isGLTFSpecularGlossinessMaterial&&(f.onBeforeRender=n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),!(s.length>1))return f;f.name+="_"+c,a.add(f)}return a})})},_.prototype.loadCamera=function(t){var e,r=this.json.cameras[t],n=r[r.type];if(n){if("perspective"===r.type){var i=n.aspectRatio||1;e=new fd(vu.radToDeg(n.yfov*i),i,n.znear||1,n.zfar||2e6)}else"orthographic"===r.type&&(e=new gd(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar));return void 0!==r.name&&(e.name=r.name),r.extras&&(e.userData=r.extras),Promise.resolve(e)}console.warn("GLTFLoader: Missing camera parameters.")},_.prototype.loadSkin=function(t){var e=this.json.skins[t],r={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then(function(t){return r.inverseBindMatrices=t,r})},_.prototype.loadAnimation=function(t){var e=this.json.animations[t];return this.getMultiDependencies(["accessor","node"]).then(function(r){for(var n=[],i=0,o=e.channels.length;i<o;i++){var a=e.channels[i],l=e.samplers[a.sampler];if(l){var c=a.target,u=void 0!==c.node?c.node:c.id,h=r.accessors[void 0!==e.parameters?e.parameters[l.input]:l.input],d=r.accessors[void 0!==e.parameters?e.parameters[l.output]:l.output],p=r.nodes[u];if(p){var f;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,m[c.path]){case m.weights:f=ud;break;case m.rotation:f=rd;break;case m.position:case m.scale:default:f=id}var g=p.name?p.name:p.uuid,y=void 0!==l.interpolation?v[l.interpolation]:2301,x=[];m[c.path]===m.weights?p.traverse(function(t){!0===t.isMesh&&!0===t.material.morphTargets&&x.push(t.name?t.name:t.uuid)}):x.push(g);for(var b=0,w=x.length;b<w;b++){var _=new f(x[b]+"."+m[c.path],ld.arraySlice(h.array,0),ld.arraySlice(d.array,0),y);"CUBICSPLINE"===l.interpolation&&(_.createInterpolant=function(t){return new s(this.times,this.values,this.getValueSize()/3,t)},_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),n.push(_)}}}}return new hd(u=void 0!==e.name?e.name:"animation_"+t,void 0,n)})},_.prototype.loadNode=function(t){var r=this.extensions,n=this.json.meshReferences,i=this.json.meshUses,o=this.json.nodes[t];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(t){var a;if(!0===o.isBone)a=new Wh;else if(void 0!==o.mesh){var s=t.meshes[o.mesh];if(a=s.clone(),!0===s.isGroup)for(var l=0,c=s.children.length;l<c;l++){var u=s.children[l];u.material&&!0===u.material.isGLTFSpecularGlossinessMaterial&&(a.children[l].onBeforeRender=u.onBeforeRender)}else s.material&&!0===s.material.isGLTFSpecularGlossinessMaterial&&(a.onBeforeRender=s.onBeforeRender);n[o.mesh]>1&&(a.name+="_instance_"+i[o.mesh]++)}else a=void 0!==o.camera?t.cameras[o.camera]:o.extensions&&o.extensions[e.KHR_LIGHTS]&&void 0!==o.extensions[e.KHR_LIGHTS].light?r[e.KHR_LIGHTS].lights[o.extensions[e.KHR_LIGHTS].light]:new Mu;if(void 0!==o.name&&(a.name=tf.sanitizeNodeName(o.name)),o.extras&&(a.userData=o.extras),void 0!==o.matrix){var h=new gu;h.fromArray(o.matrix),a.applyMatrix(h)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return a})},_.prototype.loadScene=function(){function t(e,r,n,i,o){var a=i[e],s=n.nodes[e];if(void 0!==s.skin)for(var l=!0===a.isGroup?a.children:[a],c=0,u=l.length;c<u;c++){for(var h=l[c],d=o[s.skin],p=[],f=[],m=0,v=d.joints.length;m<v;m++){var g=d.joints[m],y=i[g];if(y){p.push(y);var x=new gu;void 0!==d.inverseBindMatrices&&x.fromArray(d.inverseBindMatrices.array,16*m),f.push(x)}else console.warn('GLTFLoader: Joint "%s" could not be found.',g)}h.bind(new Df(p,f),h.matrixWorld)}if(r.add(a),s.children){var b=s.children;for(c=0,u=b.length;c<u;c++)t(b[c],a,n,i,o)}}return function(r){var n=this.json,i=this.extensions,o=this.json.scenes[r];return this.getMultiDependencies(["node","skin"]).then(function(r){var a=new vd;void 0!==o.name&&(a.name=o.name),o.extras&&(a.userData=o.extras);for(var s=o.nodes||[],l=0,c=s.length;l<c;l++)t(s[l],a,n,r.nodes,r.skins);return o.extensions&&o.extensions[e.KHR_LIGHTS]&&void 0!==o.extensions[e.KHR_LIGHTS].light&&a.add(i[e.KHR_LIGHTS].lights[o.extensions[e.KHR_LIGHTS].light]),a})}}()}(),((function(t){this.manager=void 0!==t?t:Pd}).prototype=Object.create(om.prototype))._parser=function(t){var e=function(t,e){switch(t){case 1:console.error("RGBELoader Read Error: "+(e||""));break;case 2:console.error("RGBELoader Write Error: "+(e||""));break;case 3:console.error("RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("RGBELoader: Error: "+(e||""))}return-1},r=function(t,e,r){e=e||1024;for(var n=t.pos,i=-1,o=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));0>(i=s.indexOf("\n"))&&o<e&&n<t.byteLength;)a+=s,o+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));return-1<i&&(!1!==r&&(t.pos+=o+i+1),a+s.slice(0,i))},n=new Uint8Array(t);n.pos=0;var i=function(t){var n,i,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(t.pos>=t.byteLength||!(n=r(t)))return e(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return e(3,"bad initial token");for(c.valid|=1,c.programtype=i[1],c.string+=n+"\n";!1!==(n=r(t));)if(c.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(o))&&(c.gamma=parseFloat(i[1],10)),(i=n.match(a))&&(c.exposure=parseFloat(i[1],10)),(i=n.match(s))&&(c.valid|=2,c.format=i[1]),(i=n.match(l))&&(c.valid|=4,c.height=parseInt(i[1],10),c.width=parseInt(i[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=n+"\n";return 2&c.valid?4&c.valid?c:e(3,"missing image size specifier"):e(3,"missing format specifier")}(n);if(-1!==i){var o=i.width,a=i.height,s=function(t,r,n){var i,o,a,s,l,c,u,h,d,p,f,m,v,g=r,y=n;if(g<8||g>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(g!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return e(4,"unable to allocate buffer space");for(o=0,a=0,h=4*g,v=new Uint8Array(4),c=new Uint8Array(h);y>0&&a<t.byteLength;){if(a+4>t.byteLength)return e(1);if(v[0]=t[a++],v[1]=t[a++],v[2]=t[a++],v[3]=t[a++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return e(3,"bad rgbe scanline format");for(u=0;u<h&&a<t.byteLength;){if((m=(s=t[a++])>128)&&(s-=128),0===s||u+s>h)return e(3,"bad scanline data");if(m)for(l=t[a++],d=0;d<s;d++)c[u++]=l;else c.set(t.subarray(a,a+s),u),u+=s,a+=s}for(p=g,d=0;d<p;d++)i[o]=c[d+(f=0)],i[o+1]=c[d+(f+=g)],i[o+2]=c[d+(f+=g)],i[o+3]=c[d+(f+=g)],o+=4;y--}return i}(n.subarray(n.pos),o,a);if(-1!==s)return{width:o,height:a,data:s,header:i.string,gamma:i.gamma,exposure:i.exposure,format:_h,type:gh}}return null},(Fm.prototype=Object.create(xd.prototype)).constructor=Fm,Fm.prototype.isCubeTexture=!0,Object.defineProperty(Fm.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var Um=function(t){this.manager=void 0!==t?t:Pd};Um.prototype={constructor:Um,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){var e=new JSZip(t);function r(t){var r=decodeURI(t.init_from);r=r.replace("../","");var n=new RegExp(r+"$"),i=e.file(n);if(i.length){var o=new Blob([i[0].asArrayBuffer()],{type:"application/octet-binary"});t.build.src=URL.createObjectURL(o)}}var n=e.file(/dae$/i);if(n.length){var i=n[0],o=(new $f).parse(i.asText()),a=o.library.images;for(var s in a)r(a[s]);return o}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new Nf}}};var km=function(){this._parser=km.parse};km.prototype=Object.create(em.prototype),km.prototype.constructor=km,km.parse=function(t,e){var r=new Bm(t,1);return{mipmaps:r.mipmaps(e),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}};var Bm=function(){function t(e,r,n,i){this.arrayBuffer=e;var o=new Uint8Array(this.arrayBuffer,0,12);if(171===o[0]&&75===o[1]&&84===o[2]&&88===o[3]&&32===o[4]&&49===o[5]&&49===o[6]&&187===o[7]&&13===o[8]&&10===o[9]&&26===o[10]&&10===o[11]){var a=new Int32Array(this.arrayBuffer,12,13),s=16909060===a[0];this.glType=s?this.switchEndainness(a[1]):a[1],this.glTypeSize=s?this.switchEndainness(a[2]):a[2],this.glFormat=s?this.switchEndainness(a[3]):a[3],this.glInternalFormat=s?this.switchEndainness(a[4]):a[4],this.glBaseInternalFormat=s?this.switchEndainness(a[5]):a[5],this.pixelWidth=s?this.switchEndainness(a[6]):a[6],this.pixelHeight=s?this.switchEndainness(a[7]):a[7],this.pixelDepth=s?this.switchEndainness(a[8]):a[8],this.numberOfArrayElements=s?this.switchEndainness(a[9]):a[9],this.numberOfFaces=s?this.switchEndainness(a[10]):a[10],this.numberOfMipmapLevels=s?this.switchEndainness(a[11]):a[11],this.bytesOfKeyValueData=s?this.switchEndainness(a[12]):a[12],0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===r?this.loadType=t.COMPRESSED_2D:console.warn("number of faces expected"+r+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}else console.error("texture missing KTX identifier")}return t.prototype.switchEndainness=function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255},t.prototype.mipmaps=function(e){for(var r=[],n=t.HEADER_LEN+this.bytesOfKeyValueData,i=this.pixelWidth,o=this.pixelHeight,a=e?this.numberOfMipmapLevels:1,s=0;s<a;s++){for(var l=new Int32Array(this.arrayBuffer,n,1)[0],c=0;c<this.numberOfFaces;c++){var u=new Uint8Array(this.arrayBuffer,n+4,l);r.push({data:u,width:i,height:o}),n+=l+4,n+=3-(l+3)%4}i=Math.max(1,.5*i),o=Math.max(1,.5*o)}return r},t.HEADER_LEN=64,t.COMPRESSED_2D=0,t.COMPRESSED_3D=1,t.TEX_2D=2,t.TEX_3D=3,t}(),jm={Validator:{isValid:function(t){return null!==t&&void 0!==t},verifyInput:function(t,e){return null===t||void 0===t?e:t}}};jm.Callbacks=function(){var t=jm.Validator;function e(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}return e.prototype.setCallbackOnProgress=function(e){this.onProgress=t.verifyInput(e,this.onProgress)},e.prototype.setCallbackOnMeshAlter=function(e){this.onMeshAlter=t.verifyInput(e,this.onMeshAlter)},e.prototype.setCallbackOnLoad=function(e){this.onLoad=t.verifyInput(e,this.onLoad)},e.prototype.setCallbackOnLoadMaterials=function(e){this.onLoadMaterials=t.verifyInput(e,this.onLoadMaterials)},e}(),jm.LoadedMeshUserOverride=function(){function t(t,e){this.disregardMesh=!0===t,this.alteredMesh=!0===e,this.meshes=[]}return t.prototype.addMesh=function(t){this.meshes.push(t),this.alteredMesh=!0},t.prototype.isDisregardMesh=function(){return this.disregardMesh},t.prototype.providesAlteredMeshes=function(){return this.alteredMesh},t}(),jm.ResourceDescriptor=function(){var t=jm.Validator;function e(e,r){var n=e.split("/");n.length<2?(this.path=null,this.name=e,this.url=e):(this.path=t.verifyInput(n.slice(0,n.length-1).join("/")+"/",null),this.name=t.verifyInput(n[n.length-1],null),this.url=e),this.extension=t.verifyInput(r,"default"),this.extension=this.extension.trim(),this.content=null}return e.prototype.setContent=function(e){this.content=t.verifyInput(e,null)},e}(),jm.PrepData=function(){var t=jm.Validator;function e(e){this.logging={enabled:!0,debug:!1},this.modelName=t.verifyInput(e,""),this.resources=[],this.callbacks=new jm.Callbacks}return e.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},e.prototype.getCallbacks=function(){return this.callbacks},e.prototype.addResource=function(t){this.resources.push(t)},e.prototype.clone=function(){var t,e,r=new jm.PrepData(this.modelName);for(t in r.logging.enabled=this.logging.enabled,r.logging.debug=this.logging.debug,r.resources=this.resources,r.callbacks=this.callbacks,this)e=this[t],r.hasOwnProperty(t)||"function"==typeof this[t]||(r[t]=e);return r},e.prototype.checkResourceDescriptorFiles=function(e,r){var n,i,o,a,s={};for(var l in e)if(a=!1,t.isValid((n=e[l]).name))if(t.isValid(n.content)){for(o=0;o<r.length&&!a;o++)if(i=r[o],n.extension.toLowerCase()===i.ext.toLowerCase())if(i.ignore)a=!0;else if("ArrayBuffer"===i.type){if(!(n.content instanceof ArrayBuffer||n.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";s[i.ext]=n,a=!0}else if("String"===i.type){if(!("string"==typeof n.content||n.content instanceof String))throw"Provided  content is not of type String! Aborting...";s[i.ext]=n,a=!0}if(!a)throw'Unidentified resource "'+n.name+'": '+n.url}else{if(!("string"==typeof n.name||n.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(o=0;o<r.length&&!a;o++)i=r[o],n.extension.toLowerCase()===i.ext.toLowerCase()&&(i.ignore||(s[i.ext]=n),a=!0);if(!a)throw'Unidentified resource "'+n.name+'": '+n.url}return s},e}(),jm.MeshBuilder=function(){var t="1.2.0",e=jm.Validator;function r(){console.info("Using LoaderSupport.MeshBuilder version: "+t),this.logging={enabled:!0,debug:!1},this.callbacks=new jm.Callbacks,this.materials=[]}return r.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},r.prototype.init=function(){var t=new Ud({color:14479871});t.name="defaultMaterial";var e=new Ud({color:14479871});e.name="defaultVertexColorMaterial",e.vertexColors=eh;var r=new Fh;r.name="defaultLineMaterial";var n=new jd({size:1});n.name="defaultPointMaterial";var i={};i[t.name]=t,i[e.name]=e,i[r.name]=r,i[n.name]=n,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:i}})},r.prototype.setMaterials=function(t){var r={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:e.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(t):t}};this.updateMaterials(r)},r.prototype._setCallbacks=function(t){e.isValid(t.onProgress)&&this.callbacks.setCallbackOnProgress(t.onProgress),e.isValid(t.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(t.onMeshAlter),e.isValid(t.onLoad)&&this.callbacks.setCallbackOnLoad(t.onLoad),e.isValid(t.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(t.onLoadMaterials)},r.prototype.processPayload=function(t){return"meshData"===t.cmd?this.buildMeshes(t):"materialData"===t.cmd?(this.updateMaterials(t),null):void 0},r.prototype.buildMeshes=function(t){var r,n,i=t.params.meshName,o=new Yu;o.addAttribute("position",new Du(new Float32Array(t.buffers.vertices),3)),e.isValid(t.buffers.indices)&&o.setIndex(new Du(new Uint32Array(t.buffers.indices),1)),e.isValid(t.buffers.colors)&&o.addAttribute("color",new Du(new Float32Array(t.buffers.colors),3)),e.isValid(t.buffers.normals)?o.addAttribute("normal",new Du(new Float32Array(t.buffers.normals),3)):o.computeVertexNormals(),e.isValid(t.buffers.uvs)&&o.addAttribute("uv",new Du(new Float32Array(t.buffers.uvs),2));var a=t.materials.materialNames,s=t.materials.multiMaterial,l=[];for(n in a)r=this.materials[a[n]],s&&l.push(r);if(s){r=l;var c,u=t.materials.materialGroups;for(n in u)o.addGroup((c=u[n]).start,c.count,c.index)}var h,d,p,f=[],m=this.callbacks.onMeshAlter,v=!0,g=e.verifyInput(t.geometryType,0);if(e.isValid(m)&&(d=m({detail:{meshName:i,bufferGeometry:o,material:r,geometryType:g}}),e.isValid(d))){if(!d.isDisregardMesh()&&d.providesAlteredMeshes())for(var y in d.meshes)f.push(d.meshes[y]);v=!1}if(v&&(t.computeBoundingSphere&&o.computeBoundingSphere(),(h=0===g?new zh(o,r):1===g?new Kf(o,r):new mf(o,r)).name=i,f.push(h)),e.isValid(f)&&f.length>0){var x=[];for(var y in f)x[y]=(h=f[y]).name;p="Adding mesh(es) ("+x.length+": "+x+") from input mesh: "+i,p+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)"}else p="Not adding mesh: "+i,p+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)";var b=this.callbacks.onProgress;return e.isValid(b)&&b(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:t.params.meshName,text:p,numericalValue:t.progress.numericalValue}})),f},r.prototype.updateMaterials=function(t){var r,n,i=t.materials.materialCloneInstructions;if(e.isValid(i)){var o=i.materialNameOrg,a=this.materials[o];if(e.isValid(o)){(r=a.clone()).name=n=i.materialName;var s=i.materialProperties;for(var l in s)r.hasOwnProperty(l)&&s.hasOwnProperty(l)&&(r[l]=s[l]);this.materials[n]=r}else console.warn('Requested material "'+o+'" is not available!')}var c=t.materials.serializedMaterials;if(e.isValid(c)&&Object.keys(c).length>0){var u,h=new Hd;for(n in c)e.isValid(u=c[n])&&(r=h.parse(u),this.logging.enabled&&console.info('De-serialized material with name "'+n+'" will be added.'),this.materials[n]=r)}if(e.isValid(c=t.materials.runtimeMaterials)&&Object.keys(c).length>0)for(n in c)r=c[n],this.logging.enabled&&console.info('Material with name "'+n+'" will be added.'),this.materials[n]=r},r.prototype.getMaterialsJSON=function(){var t={};for(var e in this.materials)t[e]=this.materials[e].toJSON();return t},r.prototype.getMaterials=function(){return this.materials},r}(),jm.WorkerRunnerRefImpl=function(){function t(){var t=this;self.addEventListener("message",function(e){t.processMessage(e.data)},!1)}return t.prototype.applyProperties=function(t,e){var r,n,i;for(r in e)n="set"+r.substring(0,1).toLocaleUpperCase()+r.substring(1),i=e[r],"function"==typeof t[n]?t[n](i):t.hasOwnProperty(r)&&(t[r]=i)},t.prototype.processMessage=function(t){if("run"===t.cmd){var e={callbackMeshBuilder:function(t){self.postMessage(t)},callbackProgress:function(e){t.logging.enabled&&t.logging.debug&&console.debug("WorkerRunner: progress: "+e)}},r=new Parser;"function"==typeof r.setLogging&&r.setLogging(t.logging.enabled,t.logging.debug),this.applyProperties(r,t.params),this.applyProperties(r,t.materials),this.applyProperties(r,e),r.workerScope=self,r.parse(t.data.input,t.data.options),t.logging.enabled&&console.log("WorkerRunner: Run complete!"),e.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+t.cmd)},t}(),jm.WorkerSupport=function(){var t="2.2.0",e=jm.Validator,r=function(){function t(){this._reset()}return t.prototype._reset=function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},t.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},t.prototype.setForceCopy=function(t){this.forceCopy=!0===t},t.prototype.initWorker=function(t,e){this.runnerImplName=e;var r=new Blob([t],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},t.prototype._receiveWorkerMessage=function(t){var e=t.data;switch(e.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(e);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(e.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+e.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(e.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+e.cmd)}},t.prototype.setCallbacks=function(t,r){this.callbacks.meshBuilder=e.verifyInput(t,this.callbacks.meshBuilder),this.callbacks.onLoad=e.verifyInput(r,this.callbacks.onLoad)},t.prototype.run=function(t){if(e.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=t,this.started=!0,!e.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!e.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==t.cmd&&(t.cmd="run"),e.isValid(t.logging)?(t.logging.enabled=!0===t.logging.enabled,t.logging.debug=!0===t.logging.debug):t.logging={enabled:!0,debug:!1},this._postMessage()}},t.prototype._postMessage=function(){var t;e.isValid(this.queuedMessage)&&e.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(t=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[t])):this.worker.postMessage(this.queuedMessage))},t.prototype.setTerminateRequested=function(t){this.terminateRequested=!0===t,this.terminateRequested&&e.isValid(this.worker)&&!e.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},t.prototype._terminate=function(){this.worker.terminate(),this._reset()},t}();function n(){if(console.info("Using LoaderSupport.WorkerSupport version: "+t),this.logging={enabled:!0,debug:!1},void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this.loaderWorker=new r}n.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},n.prototype.setForceWorkerDataCopy=function(t){this.loaderWorker.setForceCopy(t)},n.prototype.validate=function(t,r,n,a,s){if(!e.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),e.isValid(s)?this.logging.enabled&&console.info('WorkerSupport: Using "'+s.name+'" as Runner class for worker.'):(s=jm.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.'));var l=t(i,o);l+="var Parser = "+r+";\n\n",l+=o(s.name,s),l+="new "+s.name+"();\n\n";var c=this;if(e.isValid(n)&&n.length>0){var u="",h=function(t,e){if(0===e.length)c.loaderWorker.initWorker(u+l,s.name),c.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var r=new Nd;r.setPath(t),r.setResponseType("text"),r.load(e[0],function(r){u+=r,h(t,e)}),e.shift()}};h(a,n)}else this.loaderWorker.initWorker(l,s.name),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},n.prototype.setCallbacks=function(t,e){this.loaderWorker.setCallbacks(t,e)},n.prototype.run=function(t){this.loaderWorker.run(t)},n.prototype.setTerminateRequested=function(t){this.loaderWorker.setTerminateRequested(t)};var i=function(t,e){var r,n=t+" = {\n";for(var i in e)"string"==typeof(r=e[i])||r instanceof String?n+="\t"+i+': "'+(r=(r=r.replace("\n","\\n")).replace("\r","\\r"))+'",\n':r instanceof Array?n+="\t"+i+": ["+r+"],\n":Number.isInteger(r)?n+="\t"+i+": "+r+",\n":"function"==typeof r&&(n+="\t"+i+": "+r+",\n");return n+"}\n\n"},o=function(t,r,n,i,o){var a,s,l="",c=e.isValid(n)?n:r.name;for(var u in o=e.verifyInput(o,[]),r.prototype)a=r.prototype[u],"constructor"===u?s="\tfunction "+c+a.toString().replace("function","")+";\n\n":"function"==typeof a&&o.indexOf(u)<0&&(l+="\t"+c+".prototype."+u+" = "+a.toString()+";\n\n");l+="\treturn "+c+";\n",l+="})();\n\n";var h="";return e.isValid(i)&&(h+="\n",h+=c+".prototype = Object.create( "+i+".prototype );\n",h+=c+".constructor = "+c+";\n",h+="\n"),e.isValid(s)?l=t+" = (function () {\n\n"+h+s+l:(s=t+" = (function () {\n\n",l=(s+=h+"\t"+r.prototype.constructor.toString()+"\n\n")+l),l};return n}(),jm.WorkerDirector=function(){var t="2.2.0",e=jm.Validator,r=16,n=8192;function i(i){if(console.info("Using LoaderSupport.WorkerDirector version: "+t),this.logging={enabled:!0,debug:!1},this.maxQueueSize=n,this.maxWebWorkers=r,this.crossOrigin=null,!e.isValid(i))throw"Provided invalid classDef: "+i;this.workerDescription={classDef:i,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}return i.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},i.prototype.getMaxQueueSize=function(){return this.maxQueueSize},i.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},i.prototype.setCrossOrigin=function(t){this.crossOrigin=t},i.prototype.setForceWorkerDataCopy=function(t){this.workerDescription.forceWorkerDataCopy=!0===t},i.prototype.prepareWorkers=function(t,i,o){e.isValid(t)&&(this.workerDescription.globalCallbacks=t),this.maxQueueSize=Math.min(i,n),this.maxWebWorkers=Math.min(o,r),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var a=0;a<this.maxWebWorkers;a++){var s=new jm.WorkerSupport;s.setLogging(this.logging.enabled,this.logging.debug),s.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[a]={instanceNo:a,inUse:!1,terminateRequested:!1,workerSupport:s,loader:null}}},i.prototype.enqueueForRun=function(t){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(t)},i.prototype.isRunning=function(){var t=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||t.length>0},i.prototype.processQueue=function(){var t;for(var e in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[e]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(this._kickWorkerRun(this.instructionQueue[this.instructionQueuePointer],t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},i.prototype._kickWorkerRun=function(t,r){r.inUse=!0,r.workerSupport.setTerminateRequested(r.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var n=this,i=t.getCallbacks(),o=this.workerDescription.globalCallbacks;r.loader=this._buildLoader(r.instanceNo);var a=new jm.Callbacks;a.setCallbackOnLoad(function(t){e.isValid(o.onLoad)&&o.onLoad(t),e.isValid(i.onLoad)&&i.onLoad(t),n.objectsCompleted++,r.inUse=!1,n.processQueue()}),a.setCallbackOnProgress(function(t){e.isValid(o.onProgress)&&o.onProgress(t),e.isValid(i.onProgress)&&i.onProgress(t)}),a.setCallbackOnMeshAlter(function(t){e.isValid(o.onMeshAlter)&&o.onMeshAlter(t),e.isValid(i.onMeshAlter)&&i.onMeshAlter(t)}),t.callbacks=a,r.loader.run(t,r.workerSupport)},i.prototype._buildLoader=function(t){var r=this.workerDescription.classDef,n=Object.create(r.prototype);if(r.call(n,Pd),!n.hasOwnProperty("instanceNo"))throw r.name+' has no property "instanceNo".';if(n.instanceNo=t,!n.hasOwnProperty("workerSupport"))throw r.name+' has no property "workerSupport".';if("function"!=typeof n.run)throw r.name+' has no function "run".';return n.hasOwnProperty("callbacks")&&e.isValid(n.callbacks)||(console.warn(r.name+' has an invalid property "callbacks". Will change to "LoaderSupport.Callbacks"'),n.callbacks=new jm.Callbacks),n},i.prototype._deregister=function(t){if(e.isValid(t)){t.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+t.instanceNo+".");var r=t.loader.callbacks;e.isValid(r.onProgress)&&r.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[t.instanceNo]}},i.prototype.tearDown=function(t){for(var r in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=e.verifyInput(t,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[r].terminateRequested=!0},i}();var zm,Vm=function(t){this.manager=void 0!==t?t:Pd};Vm.prototype={constructor:Vm,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(){var t=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];return function(e){console.time("MD2Loader");for(var r=new DataView(e),n={},i=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],o=0;o<i.length;o++)n[i[o]]=r.getInt32(4*o,!0);if(844121161===n.ident&&8===n.version){if(n.offset_end===r.byteLength){for(var a=new Iu,s=[],l=n.offset_st,c=(o=0,n.num_st);o<c;o++){var u=r.getInt16(l+0,!0),h=r.getInt16(l+2,!0);s.push(new Nu(u/n.skinwidth,1-h/n.skinheight)),l+=4}for(l=n.offset_tris,o=0,c=n.num_tris;o<c;o++){var d=r.getUint16(l+0,!0),p=r.getUint16(l+2,!0),f=r.getUint16(l+4,!0);a.faces.push(new Cu(d,p,f)),a.faceVertexUvs[0].push([s[r.getUint16(l+6,!0)],s[r.getUint16(l+8,!0)],s[r.getUint16(l+10,!0)]]),l+=12}var m=new yu,v=new yu,g=[];for(l=n.offset_frames,o=0,c=n.num_frames;o<c;o++){v.set(r.getFloat32(l+0,!0),r.getFloat32(l+4,!0),r.getFloat32(l+8,!0)),m.set(r.getFloat32(l+12,!0),r.getFloat32(l+16,!0),r.getFloat32(l+20,!0)),l+=24;for(var y=0;y<16;y++){var x=r.getUint8(l+y,!0);if(0===x)break;g[y]=x}var b={name:String.fromCharCode.apply(null,g),vertices:[],normals:[]};for(l+=16,y=0;y<n.num_vertices;y++){var w=r.getUint8(l++,!0),_=r.getUint8(l++,!0),S=r.getUint8(l++,!0),T=t[r.getUint8(l++,!0)],M=new yu(w*v.x+m.x,S*v.z+m.z,_*v.y+m.y),A=new yu(T[0],T[2],T[1]);b.vertices.push(M),b.normals.push(A)}a.morphTargets.push(b)}a.vertices=a.morphTargets[0].vertices;for(var E=a.morphTargets[0],C=(y=0,a.faces.length);y<C;y++)(O=a.faces[y]).vertexNormals=[E.normals[O.a],E.normals[O.b],E.normals[O.c]];for(o=0,c=a.morphTargets.length;o<c;o++){E=a.morphTargets[o];var P=[];for(y=0,C=a.faces.length;y<C;y++){var O;P.push({a:E.normals[(O=a.faces[y]).a],b:E.normals[O.b],c:E.normals[O.c]})}a.morphNormals.push({vertexNormals:P})}return a.animations=hd.CreateClipsFromMorphTargetSequences(a.morphTargets,10),console.timeEnd("MD2Loader"),a}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")}}()};var Gm={getContext:function(){return void 0===zm&&(zm=new(window.AudioContext||window.webkitAudioContext)),zm},setContext:function(t){zm=t}};function Hm(){Mu.call(this),this.type="AudioListener",this.context=Gm.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Wm(t){Mu.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Xm(t){this.manager=void 0!==t?t:Pd}Hm.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Hm,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new yu,e=new xu,r=new yu,n=new yu;return function(i){Mu.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(t,e,r),n.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(n.x,n.y,n.z,a.x,a.y,a.z))}}()}),Wm.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Wm,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}console.warn("Audio: this Audio has no playback control.")}else console.warn("Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),Object.assign(Xm.prototype,{load:function(t,e,r,n){var i=new Nd(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){Gm.getContext().decodeAudioData(t,function(t){e(t)})},r,n)}});var Ym=function(t){this.manager=void 0!==t?t:Pd};function qm(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var n=e.tracks,i=n.length,o=new Array(i),a={endingStart:Eh,endingEnd:Eh},s=0;s!==i;++s){var l=n[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Mh,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Jm(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Zm(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Ym.prototype={constructor:Ym,load:function(t,e,r,n){var i=this,o=new xd,a=new Nd(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){o.image=i.parse(t),o.needsUpdate=!0,void 0!==e&&e(o)},r,n),o},parse:function(t){t.length<19&&console.error("TGALoader: Not enough data to contain header.");var e=new Uint8Array(t),r=0,n={id_length:e[r++],colormap_type:e[r++],image_type:e[r++],colormap_index:e[r++]|e[r++]<<8,colormap_length:e[r++]|e[r++]<<8,colormap_size:e[r++],origin:[e[r++]|e[r++]<<8,e[r++]|e[r++]<<8],width:e[r++]|e[r++]<<8,height:e[r++]|e[r++]<<8,pixel_size:e[r++],flags:e[r++]};!function(t){switch(t.image_type){case 1:case 9:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:t.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',t.image_type)}(t.width<=0||t.height<=0)&&console.error("TGALoader: Invalid image size."),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',t.pixel_size)}(n),n.id_length+r>t.length&&console.error("TGALoader: No data."),r+=n.id_length;var i=!1,o=!1,a=!1;switch(n.image_type){case 9:i=!0,o=!0;break;case 1:o=!0;break;case 10:i=!0;break;case 2:break;case 11:i=!0,a=!0;break;case 3:a=!0}var s=document.createElement("canvas");s.width=n.width,s.height=n.height;var l=s.getContext("2d"),c=l.createImageData(n.width,n.height),u=function(t,e,r,n,i){var o,a,s,l;if(s=r.width*r.height*(a=r.pixel_size>>3),e&&(l=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),t){var c,u,h;o=new Uint8Array(s);for(var d=0,p=new Uint8Array(a);d<s;)if(u=1+(127&(c=i[n++])),128&c){for(h=0;h<a;++h)p[h]=i[n++];for(h=0;h<u;++h)o.set(p,d+h*a);d+=a*u}else{for(u*=a,h=0;h<u;++h)o[d+h]=i[n++];d+=u}}else o=i.subarray(n,n+=e?r.width*r.height:s);return{pixel_data:o,palettes:l}}(i,o,n,r,e);return function(t,e,r,i,o){var s,l,c,u,h,d;switch((48&n.flags)>>4){default:case 2:s=0,c=1,h=e,l=0,u=1,d=r;break;case 0:s=0,c=1,h=e,l=r-1,u=-1,d=-1;break;case 3:s=e-1,c=-1,h=-1,l=0,u=1,d=r;break;case 1:s=e-1,c=-1,h=-1,l=r-1,u=-1,d=-1}if(a)switch(n.pixel_size){case 8:!function(t,e,r,i,o,a,s,l){var c,u,h,d=0,p=n.width;for(h=e;h!==i;h+=r)for(u=o;u!==s;u+=a,d++)t[4*(u+p*h)+0]=c=l[d],t[4*(u+p*h)+1]=c,t[4*(u+p*h)+2]=c,t[4*(u+p*h)+3]=255}(t,l,u,d,s,c,h,i);break;case 16:!function(t,e,r,i,o,a,s,l){var c,u,h=0,d=n.width;for(u=e;u!==i;u+=r)for(c=o;c!==s;c+=a,h+=2)t[4*(c+d*u)+0]=l[h+0],t[4*(c+d*u)+1]=l[h+0],t[4*(c+d*u)+2]=l[h+0],t[4*(c+d*u)+3]=l[h+1]}(t,l,u,d,s,c,h,i);break;default:console.error("TGALoader: Format not supported.")}else switch(n.pixel_size){case 8:!function(t,e,r,i,a,s,l,c,u){var h,d,p,f=o,m=0,v=n.width;for(p=e;p!==i;p+=r)for(d=a;d!==l;d+=s,m++)h=c[m],t[4*(d+v*p)+3]=255,t[4*(d+v*p)+2]=f[3*h+0],t[4*(d+v*p)+1]=f[3*h+1],t[4*(d+v*p)+0]=f[3*h+2]}(t,l,u,d,s,c,h,i);break;case 16:!function(t,e,r,i,o,a,s,l){var c,u,h,d=0,p=n.width;for(h=e;h!==i;h+=r)for(u=o;u!==s;u+=a,d+=2)t[4*(u+p*h)+0]=(31744&(c=l[d+0]+(l[d+1]<<8)))>>7,t[4*(u+p*h)+1]=(992&c)>>2,t[4*(u+p*h)+2]=(31&c)>>3,t[4*(u+p*h)+3]=32768&c?0:255}(t,l,u,d,s,c,h,i);break;case 24:!function(t,e,r,i,o,a,s,l){var c,u,h=0,d=n.width;for(u=e;u!==i;u+=r)for(c=o;c!==s;c+=a,h+=3)t[4*(c+d*u)+3]=255,t[4*(c+d*u)+2]=l[h+0],t[4*(c+d*u)+1]=l[h+1],t[4*(c+d*u)+0]=l[h+2]}(t,l,u,d,s,c,h,i);break;case 32:!function(t,e,r,i,o,a,s,l){var c,u,h=0,d=n.width;for(u=e;u!==i;u+=r)for(c=o;c!==s;c+=a,h+=4)t[4*(c+d*u)+2]=l[h+0],t[4*(c+d*u)+1]=l[h+1],t[4*(c+d*u)+0]=l[h+2],t[4*(c+d*u)+3]=l[h+3]}(t,l,u,d,s,c,h,i);break;default:console.error("TGALoader: Format not supported.")}}(c.data,n.width,n.height,u.pixel_data,u.palettes),l.putImageData(c,0,0),s}},Object.assign(qm.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,o=n/i;t.warp(1,i/n,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+r,l[0]=t/a,l[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*r;if(o<0||0===r)return;this._startTime=null,e=r*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;null!==r&&(e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var r=this._clip.duration,n=this.loop,i=this._loopCount;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=2202===n;if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=r||e<0){var a=Math.floor(e/r);e-=r*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&i))return this.time=e,r-e}return this.time=e,e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=t?this.zeroSlopeAtStart?2401:Eh:2402,n.endingEnd=e?this.zeroSlopeAtEnd?2401:Eh:2402)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=r,this}}),Object.assign(Jm.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)r[i+a]=r[a];o=e}else this._mixBufferRegion(r,i,0,e/(o+=e),n);this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,o=this.binding;this.cumulativeWeight=0,i<1&&this._mixBufferRegion(r,n,3*e,1-i,e);for(var a=e,s=e+e;a!==s;++a)if(r[a]!==r[a+e]){o.setValue(r,n);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,r=3*e;this.binding.getValue(t,r);for(var n=e,i=r;n!==i;++n)t[n]=t[r+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)t[e+o]=t[r+o]},_slerp:function(t,e,r,n){xu.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[r+a]*n}}}),Zm.prototype=Object.assign(Object.create(bu.prototype),{constructor:Zm,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,o=t._propertyBindings,a=t._interpolants,s=r.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(l[s]=c={});for(var u=0;u!==i;++u){var h=n[u],d=h.name,p=c[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}++(p=new Jm(tf.create(r,d,e&&e._propertyBindings[u].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[u]=p}a[u].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],o=this._bindings;void 0===i&&(n[e]=i={}),i[r]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,a=o[n],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete a[i];t:{for(var c in a)break t;delete o[n]}},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new ad(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?hd.findByName(r,t):t,o=null!==i?i.uuid:t,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[n];if(void 0!==l)return l;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var c=new qm(this,i,e);return this._bindAction(c,s),this._addInactiveAction(c,o,n),c},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?hd.findByName(r,t):t,o=this._actionsByClip[i?i.uuid:t];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){for(var e=this._actions,r=this._nActiveActions,n=this.time+=t*=this.timeScale,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==r;++a)e[a]._update(n,t,i,o);var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}});var Qm=function(t){Yd.call(this),this.manager=void 0!==t?t:Pd,this.parser=new MMDParser.Parser,this.textureCrossOrigin=null};(Qm.prototype=Object.create(Yd.prototype)).constructor=Qm,Qm.prototype.defaultToonTextures=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],Qm.prototype.setTextureCrossOrigin=function(t){this.textureCrossOrigin=t},Qm.prototype.load=function(t,e,r,n,i){var o=this;this.loadModel(t,function(t){o.loadVmds(e,function(e){o.pourVmdIntoModel(t,e),r(t)},n,i)},n,i)},Qm.prototype.loadModel=function(t,e,r,n){var i=this,o=qd.extractUrlBase(t),a=this.extractExtension(t);this.loadFileAsBuffer(t,function(t){e(i.createModel(t,a,o,r,n))},r,n)},Qm.prototype.createModel=function(t,e,r,n,i){return this.createMesh(this.parseModel(t,e),r,n,i)},Qm.prototype.loadVmd=function(t,e,r,n){var i=this;this.loadFileAsBuffer(t,function(t){e(i.parseVmd(t))},r,n)},Qm.prototype.loadVmds=function(t,e,r,n){var i=this,o=[];t=t.slice(),function a(){var s=t.shift();i.loadVmd(s,function(r){o.push(r),t.length>0?a():e(i.mergeVmds(o))},r,n)}()},Qm.prototype.loadAudio=function(t,e,r,n){var i=new Hm,o=new Wm(i);new Xm(this.manager).load(t,function(t){o.setBuffer(t),e(o,i)},r,n)},Qm.prototype.loadVpd=function(t,e,r,n,i){var o=this;(i&&"unicode"===i.charcode?this.loadFileAsText:this.loadFileAsShiftJISText).bind(this)(t,function(t){e(o.parseVpd(t))},r,n)},Qm.prototype.parseModel=function(t,e){switch(e.toLowerCase()){case"pmd":return this.parsePmd(t);case"pmx":return this.parsePmx(t);default:throw"extension "+e+" is not supported."}},Qm.prototype.parsePmd=function(t){return this.parser.parsePmd(t,!0)},Qm.prototype.parsePmx=function(t){return this.parser.parsePmx(t,!0)},Qm.prototype.parseVmd=function(t){return this.parser.parseVmd(t,!0)},Qm.prototype.parseVpd=function(t){return this.parser.parseVpd(t,!0)},Qm.prototype.mergeVmds=function(t){return this.parser.mergeVmds(t)},Qm.prototype.pourVmdIntoModel=function(t,e,r){this.createAnimation(t,e,r)},Qm.prototype.pourVmdIntoCamera=function(t,e,r){var n=new Qm.DataCreationHelper;!function(){for(var i=n.createOrderedMotionArray(e.cameras),o=[],a=[],s=[],l=[],c=[],u=[],h=[],d=[],p=[],f=new xu,m=new wu,v=new yu,g=new yu,y=function(t,e){t.push(e.x),t.push(e.y),t.push(e.z)},x=function(t,e){t.push(e.x),t.push(e.y),t.push(e.z),t.push(e.w)},b=function(t,e,r){t.push(e[4*r+0]/127),t.push(e[4*r+1]/127),t.push(e[4*r+2]/127),t.push(e[4*r+3]/127)},w=function(t,e,r,n,i){if(r.length>2){r=r.slice(),n=n.slice(),i=i.slice();for(var o=n.length/r.length,a=3===o?12:4,s=1,l=2,c=r.length;l<c;l++){for(var u=0;u<o;u++)if(n[s*o+u]!==n[(s-1)*o+u]||n[s*o+u]!==n[l*o+u]){s++;break}if(l>s){for(r[s]=r[l],u=0;u<o;u++)n[s*o+u]=n[l*o+u];for(u=0;u<a;u++)i[s*a+u]=i[l*a+u]}}r.length=s+1,n.length=(s+1)*o,i.length=(s+1)*a}return new Qm[e](t,r,n,i)},_=0;_<i.length;_++){var S=i[_],T=S.frameNum/30,M=S.position,A=S.rotation,E=S.fov,C=S.interpolation;v.set(0,0,-S.distance),g.set(M[0],M[1],M[2]),m.set(-A[0],-A[1],-A[2]),f.setFromEuler(m),v.add(g),v.applyQuaternion(f),o.length>0&&T<o[o.length-1]+.05&&(o[o.length-1]=T-1e-13),o.push(T),y(a,g),x(s,f),y(l,v),c.push(E);for(var P=0;P<3;P++)b(u,C,P);for(b(h,C,3),P=0;P<3;P++)b(d,C,4);b(p,C,5)}if(0!==o.length){var O=[];O.push(w(".center","VectorKeyframeTrackEx",o,a,u)),O.push(w(".quaternion","QuaternionKeyframeTrackEx",o,s,h)),O.push(w(".position","VectorKeyframeTrackEx",o,l,d)),O.push(w(".fov","NumberKeyframeTrackEx",o,c,p));var N=new hd(void 0===r?vu.generateUUID():r,-1,O);void 0===t.center&&(t.center=new yu(0,0,0)),void 0===t.animations&&(t.animations=[]),t.animations.push(N)}}()},Qm.prototype.extractExtension=function(t){var e=t.lastIndexOf(".");return e<0?null:t.slice(e+1)},Qm.prototype.loadFile=function(t,e,r,n,i,o){var a=new Nd(this.manager);return void 0!==o&&a.setMimeType(o),a.setResponseType(i),a.load(t,function(t){e(t)},r,n)},Qm.prototype.loadFileAsBuffer=function(t,e,r,n){this.loadFile(t,e,r,n,"arraybuffer")},Qm.prototype.loadFileAsText=function(t,e,r,n){this.loadFile(t,e,r,n,"text")},Qm.prototype.loadFileAsShiftJISText=function(t,e,r,n){this.loadFile(t,e,r,n,"text","text/plain; charset=shift_jis")},Qm.prototype.createMesh=function(t,e,r,n){var i=this,o=new Yu,a=[],s={vertices:[],uvs:[],normals:[],skinIndices:[],skinWeights:[],indices:[]};return function(){for(var e=0;e<t.metadata.vertexCount;e++){for(var r=t.vertices[e],n=0,i=r.position.length;n<i;n++)s.vertices.push(r.position[n]);for(n=0,i=r.normal.length;n<i;n++)s.normals.push(r.normal[n]);for(n=0,i=r.uv.length;n<i;n++)s.uvs.push(r.uv[n]);for(n=0;n<4;n++)s.skinIndices.push(r.skinIndices.length-1>=n?r.skinIndices[n]:0);for(n=0;n<4;n++)s.skinWeights.push(r.skinWeights.length-1>=n?r.skinWeights[n]:0)}}(),function(){for(var e=0;e<t.metadata.faceCount;e++)for(var r=t.faces[e],n=0,i=r.indices.length;n<i;n++)s.indices.push(r.indices[n])}(),function(){for(var e=[],r=t.rigidBodies,n={},i=0,a=r.length;i<a;i++){var s=r[i],l=n[s.boneIndex];l=void 0===l?s.type:Math.max(s.type,l),n[s.boneIndex]=l}for(i=0;i<t.metadata.boneCount;i++){var c={},u=t.bones[i];c.parent=u.parentIndex,c.name=u.name,c.pos=[u.position[0],u.position[1],u.position[2]],c.rotq=[0,0,0,1],c.scl=[1,1,1],-1!==c.parent&&(c.pos[0]-=t.bones[c.parent].position[0],c.pos[1]-=t.bones[c.parent].position[1],c.pos[2]-=t.bones[c.parent].position[2]),c.rigidBodyType=void 0!==n[i]?n[i]:-1,e.push(c)}o.bones=e}(),function(){var e=[];if("pmd"===t.metadata.format)for(var r=0;r<t.metadata.ikCount;r++){(a={}).target=(i=t.iks[r]).target,a.effector=i.effector,a.iteration=i.iteration,a.maxAngle=4*i.maxAngle,a.links=[];for(var n=0;n<i.links.length;n++)(s={}).index=i.links[n].index,t.bones[s.index].name.indexOf("\u3072\u3056")>=0&&(s.limitation=new yu(1,0,0)),a.links.push(s);e.push(a)}else for(r=0;r<t.metadata.boneCount;r++){var i;if(void 0!==(i=t.bones[r].ik)){var a;for((a={}).target=r,a.effector=i.effector,a.iteration=i.iteration,a.maxAngle=i.maxAngle,a.links=[],n=0;n<i.links.length;n++){var s;(s={}).index=i.links[n].index,s.enabled=!0,1===i.links[n].angleLimitation&&(s.limitation=new yu(1,0,0)),a.links.push(s)}e.push(a)}}o.iks=e}(),function(){if("pmd"!==t.metadata.format){for(var e=[],r=0;r<t.metadata.boneCount;r++){var n=t.bones[r],i=n.grant;if(void 0!==i){var a={};a.index=r,a.parentIndex=i.parentIndex,a.ratio=i.ratio,a.isLocal=i.isLocal,a.affectRotation=i.affectRotation,a.affectPosition=i.affectPosition,a.transformationClass=n.transformationClass,e.push(a)}}e.sort(function(t,e){return t.transformationClass-e.transformationClass}),o.grants=e}}(),function(){function e(t,e,r,n){t.array[3*e+0]+=r.position[0]*n,t.array[3*e+1]+=r.position[1]*n,t.array[3*e+2]+=r.position[2]*n}function r(r,n,i){for(var o=0;o<n.elementCount;o++){var a=n.elements[o];e(r,"pmd"===t.metadata.format?t.morphs[0].elements[a.index].index:a.index,a,i)}}for(var n=[],i=[],a=0;a<t.metadata.morphCount;a++){var l=t.morphs[a],c={name:l.name},u=new Gu(3*t.metadata.vertexCount,3);u.name=l.name;for(var h=0;h<3*t.metadata.vertexCount;h++)u.array[h]=s.vertices[h];if("pmd"===t.metadata.format)0!==a&&r(u,l,1);else if(0===l.type)for(h=0;h<l.elementCount;h++){var d=t.morphs[l.elements[h].index];1===d.type&&r(u,d,l.elements[h].ratio)}else 1===l.type&&r(u,l,1);n.push(c),i.push(u)}o.morphTargets=n,o.morphAttributes.position=i}(),function(){var s={},l=new Xd(i.manager),c=new Ym(i.manager),u=document.createElement("canvas"),h=u.getContext("2d"),d=0,p=[];function f(t,o){var a;if(void 0===o&&(o={}),!0===o.defaultTexturePath)try{a=i.defaultToonTextures[parseInt(t.match("toon([0-9]{2}).bmp$")[1])]}catch(e){console.warn("MMDLoader: "+t+" seems like not right default texture path. Using toon00.bmp instead."),a=i.defaultToonTextures[0]}else a=e+t;if(void 0!==s[a])return a;var d=Yd.Handlers.get(a);null===d&&(d=t.indexOf(".tga")>=0?c:l);var p=d.load(a,function(t){if(!0===o.isToonTexture){var e=t.image,r=e.width,n=e.height;u.width=r,u.height=n,h.clearRect(0,0,r,n),h.translate(r/2,n/2),h.rotate(.5*Math.PI),h.translate(-r/2,-n/2),h.drawImage(e,0,0),t.image=h.getImageData(0,0,r,n)}t.flipY=!1,t.wrapS=hh,t.wrapT=hh;for(var i=0;i<p.readyCallbacks.length;i++)p.readyCallbacks[i](p);delete p.readyCallbacks},r,n);return!0===o.sphericalReflectionMapping&&(p.mapping=uh),p.readyCallbacks=[],s[a]=p,a}function m(t,e){return void 0===e[t]&&console.warn("MMDLoader: Undefined texture",t),e[t]}null!==i.textureCrossOrigin&&l.setCrossOrigin(i.textureCrossOrigin);for(var v=0;v<t.metadata.materialCount;v++){var g,y=t.materials[v],x={};if(x.faceOffset=d,x.faceNum=y.faceCount,d+=y.faceCount,x.name=y.name,x.color=new Eu(y.diffuse[0],y.diffuse[1],y.diffuse[2]),x.opacity=y.diffuse[3],x.specular=new Eu(y.specular[0],y.specular[1],y.specular[2]),x.shininess=y.shininess,1===x.opacity?(x.side=Zu,x.transparent=!1):(x.side=Ku,x.transparent=!0),"pmd"===t.metadata.format){if(y.fileName){var b=y.fileName,w=[],_=b.lastIndexOf("*");_>=0?(w.push(b.slice(0,_)),w.push(b.slice(_+1))):w.push(b);for(var S=0;S<w.length;S++)(g=w[S]).indexOf(".sph")>=0||g.indexOf(".spa")>=0?(x.envMap=f(g,{sphericalReflectionMapping:!0}),x.envMapType=g.indexOf(".sph")>=0?sh:2):x.map=f(g)}}else-1!==y.textureIndex&&(x.map=f(g=t.textures[y.textureIndex])),-1===y.envTextureIndex||1!==y.envFlag&&2!=y.envFlag||(x.envMap=f(g=t.textures[y.envTextureIndex],{sphericalReflectionMapping:!0}),x.envMapType=1===y.envFlag?sh:2);var T=void 0===x.map?1:.2;x.emissive=new Eu(y.ambient[0]*T,y.ambient[1]*T,y.ambient[2]*T),p.push(x)}for(v=0;v<p.length;v++){var M=p[v],A=t.materials[v];if(y=new Bd,o.addGroup(3*M.faceOffset,3*M.faceNum,v),void 0!==M.name&&(y.name=M.name),y.skinning=o.bones.length>0,y.morphTargets=o.morphTargets.length>0,y.lights=!0,y.side="pmx"===t.metadata.format&&1==(1&A.flag)?Ku:M.side,y.transparent=M.transparent,y.fog=!0,y.blending=5,y.blendSrc=ih,y.blendDst=oh,y.blendSrcAlpha=ih,y.blendDstAlpha=206,void 0!==M.map){function E(t){t.map.readyCallbacks.push(function(e){function r(t,e){var r=t.width,n=t.height,i=Math.round(e.x*r)%r,o=Math.round(e.y*n)%n;return i<0&&(i+=r),o<0&&(o+=n),t.data[4*(o*r+i)+3]}var n=void 0!==e.image.data?e.image:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var r=e.getContext("2d");return r.drawImage(t,0,0),r.getImageData(0,0,e.width,e.height)}(e.image),i=o.index.array.slice(3*t.faceOffset,3*t.faceOffset+3*t.faceNum);(function(t,e,n){if(t.data.length/(t.width*t.height)!=4)return!1;for(var i=0;i<n.length;i+=3){for(var o={x:0,y:0},a=0;a<3;a++){var s=n[3*i+a],l={x:e[2*s+0],y:e[2*s+1]};if(r(t,l)<253)return!0;o.x+=l.x,o.y+=l.y}if(o.x/=3,o.y/=3,r(t,o)<253)return!0}return!1})(n,o.attributes.uv.array,i)&&(t.transparent=!0),delete t.faceOffset,delete t.faceNum})}y.faceOffset=M.faceOffset,y.faceNum=M.faceNum,y.map=m(M.map,s),E(y)}if(void 0!==M.envMap&&(y.envMap=m(M.envMap,s),y.combine=M.envMapType),y.opacity=M.opacity,y.color=M.color,void 0!==M.emissive&&(y.emissive=M.emissive),y.specular=M.specular,y.shininess=Math.max(M.shininess,1e-4),"pmd"===t.metadata.format){function C(t){return 10===t.length&&null!==t.match(/toon(10|0[0-9]).bmp/)}y.outlineParameters={thickness:1===A.edgeFlag?.003:0,color:new Eu(0,0,0),alpha:1},0===y.outlineParameters.thickness&&(y.outlineParameters.visible=!1);var P=f(O=-1===A.toonIndex?"toon00.bmp":t.toonTextures[A.toonIndex].fileName,{isToonTexture:!0,defaultTexturePath:C(O)});y.gradientMap=m(P,s)}else{var O,N;if(y.outlineParameters={thickness:A.edgeSize/300,color:new Eu(A.edgeColor[0],A.edgeColor[1],A.edgeColor[2]),alpha:A.edgeColor[3]},0!=(16&A.flag)&&0!==y.outlineParameters.thickness||(y.outlineParameters.visible=!1),-1===A.toonIndex||0!==A.toonFlag){var L=A.toonIndex+1;O="toon"+(L<10?"0"+L:L)+".bmp",N=!0}else O=t.textures[A.toonIndex],N=!1;P=f(O,{isToonTexture:!0,defaultTexturePath:N}),y.gradientMap=m(P,s)}a.push(y)}if("pmx"===t.metadata.format){function I(t,e){if(8===t.type)for(var r=0;r<e.length;r++){var n=e[r];if(-1!==n.index){var i=a[n.index];i.opacity!==n.diffuse[3]&&(i.transparent=!0)}}}for(v=0;v<t.morphs.length;v++){var R=t.morphs[v],D=R.elements;if(0===R.type)for(S=0;S<D.length;S++){var F=t.morphs[D[S].index];I(F,F.elements)}else I(R,D)}}}(),function(){for(var e=[],r=[],n=0;n<t.metadata.rigidBodyCount;n++){for(var i=t.rigidBodies[n],a=Object.keys(i),s={},l=0;l<a.length;l++)s[h=a[l]]=i[h];if("pmx"===t.metadata.format&&-1!==s.boneIndex){var c=t.bones[s.boneIndex];s.position[0]-=c.position[0],s.position[1]-=c.position[1],s.position[2]-=c.position[2]}e.push(s)}for(n=0;n<t.metadata.constraintCount;n++){var u=t.constraints[n];for(a=Object.keys(u),s={},l=0;l<a.length;l++){var h;s[h=a[l]]=u[h]}var d=e[s.rigidBodyIndex1],p=e[s.rigidBodyIndex2];0!==d.type&&2===p.type&&-1!==d.boneIndex&&-1!==p.boneIndex&&t.bones[p.boneIndex].parentIndex===d.boneIndex&&(p.type=1),r.push(s)}o.rigidBodies=e,o.constraints=r}(),o.setIndex(s.indices),o.addAttribute("position",new Gu(s.vertices,3)),o.addAttribute("normal",new Gu(s.normals,3)),o.addAttribute("uv",new Gu(s.uvs,2)),o.addAttribute("skinIndex",new ju(s.skinIndices,4)),o.addAttribute("skinWeight",new Gu(s.skinWeights,4)),o.computeBoundingSphere(),o.mmdFormat=t.metadata.format,new Ff(o,a)},Qm.prototype.createAnimation=function(t,e,r){var n=new Qm.DataCreationHelper;!function(){if(0!==e.metadata.motionCount){for(var i=t.geometry.bones,o=n.createOrderedMotionArrays(i,e.motions,"boneName"),a=[],s=function(t,e,r){t.push(e[r+0]/127),t.push(e[r+8]/127),t.push(e[r+4]/127),t.push(e[r+12]/127)},l=0;l<o.length;l++){for(var c=[],u=[],h=[],d=[],p=[],f=i[l],m=o[l],v=0;v<m.length;v++){var g=m[v].position,y=m[v].rotation,x=m[v].interpolation;c.push(m[v].frameNum/30);for(var b=0;b<3;b++)u.push(f.pos[b]+g[b]);for(b=0;b<4;b++)h.push(y[b]);for(b=0;b<3;b++)s(d,x,b);s(p,x,3)}if(0!==c.length){var w=".bones["+f.name+"]";a.push(new Qm.VectorKeyframeTrackEx(w+".position",c,u,d)),a.push(new Qm.QuaternionKeyframeTrackEx(w+".quaternion",c,h,p))}}var _=new hd(void 0===r?vu.generateUUID():r,-1,a);void 0===t.geometry.animations&&(t.geometry.animations=[]),t.geometry.animations.push(_)}}(),function(){if(0!==e.metadata.morphCount){for(var i=n.createOrderedMotionArrays(t.geometry.morphTargets,e.morphs,"morphName"),o=[],a=0;a<i.length;a++){for(var s=[],l=[],c=i[a],u=0;u<c.length;u++)s.push(c[u].frameNum/30),l.push(c[u].weight);0!==s.length&&o.push(new ud(".morphTargetInfluences["+a+"]",s,l))}var h=new hd(void 0===r?vu.generateUUID():r+"Morph",-1,o);void 0===t.geometry.animations&&(t.geometry.animations=[]),t.geometry.animations.push(h)}}()},(Qm.DataCreationHelper=function(){}).prototype={constructor:Qm.DataCreationHelper,toCharcodeStrings:function(t){for(var e="",r=0;r<t.length;r++)e+="0x"+("0000"+t[r].charCodeAt().toString(16)).substr(-4);return e},createDictionary:function(t){for(var e={},r=0;r<t.length;r++)e[t[r].name]=r;return e},initializeMotionArrays:function(t){for(var e=[],r=0;r<t.length;r++)e[r]=[];return e},sortMotionArray:function(t){t.sort(function(t,e){return t.frameNum-e.frameNum})},sortMotionArrays:function(t){for(var e=0;e<t.length;e++)this.sortMotionArray(t[e])},createMotionArray:function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r]);return e},createMotionArrays:function(t,e,r,n){for(var i=0;i<t.length;i++){var o=t[i],a=r[o[n]];void 0!==a&&e[a].push(o)}},createOrderedMotionArray:function(t){var e=this.createMotionArray(t);return this.sortMotionArray(e),e},createOrderedMotionArrays:function(t,e,r){var n=this.createDictionary(t),i=this.initializeMotionArrays(t);return this.createMotionArrays(e,i,n,r),this.sortMotionArrays(i),i}},((Qm.VectorKeyframeTrackEx=function(t,e,r,n){this.interpolationParameters=new Float32Array(n),id.call(this,t,e,r)}).prototype=Object.create(id.prototype)).constructor=Qm.VectorKeyframeTrackEx,Qm.VectorKeyframeTrackEx.prototype.TimeBufferType=Float64Array,Qm.VectorKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new Qm.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},Qm.VectorKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((Qm.QuaternionKeyframeTrackEx=function(t,e,r,n){this.interpolationParameters=new Float32Array(n),rd.call(this,t,e,r)}).prototype=Object.create(rd.prototype)).constructor=Qm.QuaternionKeyframeTrackEx,Qm.QuaternionKeyframeTrackEx.prototype.TimeBufferType=Float64Array,Qm.QuaternionKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new Qm.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},Qm.QuaternionKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((Qm.NumberKeyframeTrackEx=function(t,e,r,n){this.interpolationParameters=new Float32Array(n),ud.call(this,t,e,r)}).prototype=Object.create(ud.prototype)).constructor=Qm.NumberKeyframeTrackEx,Qm.NumberKeyframeTrackEx.prototype.TimeBufferType=Float64Array,Qm.NumberKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new Qm.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},Qm.NumberKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((Qm.CubicBezierInterpolation=function(t,e,r,n,i){td.call(this,t,e,r,n),this.params=i}).prototype=Object.create(ad.prototype)).constructor=Qm.CubicBezierInterpolation,Qm.CubicBezierInterpolation.prototype.interpolate_=function(t,e,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=(r-e)/(n-e);if(4===a){var u=this._calculate(this.params[4*t+0],this.params[4*t+1],this.params[4*t+2],this.params[4*t+3],c);xu.slerpFlat(i,0,o,l,o,s,u)}else if(3===a)for(var h=0;h!==a;++h)u=this._calculate(this.params[12*t+4*h+0],this.params[12*t+4*h+1],this.params[12*t+4*h+2],this.params[12*t+4*h+3],c),i[h]=o[l+h]*(1-u)+o[s+h]*u;else u=this._calculate(this.params[4*t+0],this.params[4*t+1],this.params[4*t+2],this.params[4*t+3],c),i[0]=o[l]*(1-u)+o[s]*u;return i},Qm.CubicBezierInterpolation.prototype._calculate=function(t,e,r,n,i){for(var o,a,s,l=.5,c=l,u=1-c,h=Math,d=0;d<15;d++){var p=(o=3*u*u*c)*t+(a=3*u*c*c)*e+(s=c*c*c)-i;if(h.abs(p)<1e-5)break;l/=2,u=1-(c+=p<0?l:-l)}return o*r+a*n+s};var Km=function(t,e,r){var n=null===r||void 0===r?{}:r;this.audio=t,this.listener=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==n.delayTime?n.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime};Km.prototype={constructor:Km,control:function(t){this.elapsed+=t,this.currentTime+=t,this.checkIfStopAudio()&&this.audio.stop(),this.checkIfStartAudio()&&this.audio.play()},checkIfStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime||(this.audio.startTime=this.currentTime-this.delayTime,0))},checkIfStopAudio:function(){return!!this.audio.isPlaying&&this.currentTime>=this.duration}};var $m=function(t){this.mesh=t};$m.prototype={constructor:$m,update:function(){var t=new xu;return function(){for(var e=0;e<this.mesh.geometry.grants.length;e++){var r=this.mesh.geometry.grants[e],n=this.mesh.skeleton.bones[r.index],i=this.mesh.skeleton.bones[r.parentIndex];r.isLocal||r.affectRotation&&(t.set(0,0,0,1),t.slerp(i.quaternion,r.ratio),n.quaternion.multiply(t))}}}()};var tv=function(){this.meshes=[],this.doAnimation=!0,this.doIk=!0,this.doGrant=!0,this.doPhysics=!0,this.doCameraAnimation=!0,this.sharedPhysics=!1,this.masterPhysics=null,this.audioManager=null,this.camera=null};tv.prototype={constructor:tv,add:function(t){if(!(t instanceof Ff))throw new Error("MMDHelper.add() accepts only SkinnedMesh instance.");void 0===t.mixer&&(t.mixer=null),void 0===t.ikSolver&&(t.ikSolver=null),void 0===t.grantSolver&&(t.grantSolver=null),void 0===t.physics&&(t.physics=null),void 0===t.looped&&(t.looped=!1),this.meshes.push(t),this.initBackupBones(t)},setAudio:function(t,e,r){this.audioManager=new Km(t,e,r)},setCamera:function(t){t.mixer=null,this.camera=t},setPhysicses:function(t){for(var e=0;e<this.meshes.length;e++)this.setPhysics(this.meshes[e],t)},setPhysics:function(t,e){if(void 0===(e=void 0===e?{}:Object.assign({},e)).world&&this.sharedPhysics){var r=this.getMasterPhysics();null!==r&&(e.world=r.world)}var n=void 0!==e.warmup?e.warmup:60,i=new Zh(t,e);null!==t.mixer&&void 0!==t.mixer&&!0!==e.preventAnimationWarmup&&(this.animateOneMesh(0,t),i.reset()),i.warmup(n),this.updateIKParametersDependingOnPhysicsEnabled(t,!0),t.physics=i},getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var t=0,e=this.meshes.length;t<e;t++){var r=this.meshes[t].physics;if(void 0!==r&&null!==r)return this.masterPhysics=r,this.masterPhysics}return null},enablePhysics:function(t){this.doPhysics=!0===t;for(var e=0,r=this.meshes.length;e<r;e++)this.updateIKParametersDependingOnPhysicsEnabled(this.meshes[e],t)},updateIKParametersDependingOnPhysicsEnabled:function(t,e){for(var r=t.geometry.iks,n=t.geometry.bones,i=0,o=r.length;i<o;i++)for(var a=r[i].links,s=0,l=a.length;s<l;s++){var c=a[s];c.enabled=!0!==e||!(n[c.index].rigidBodyType>0)}},setAnimations:function(){for(var t=0;t<this.meshes.length;t++)this.setAnimation(this.meshes[t])},setAnimation:function(t){if(void 0!==t.geometry.animations){t.mixer=new Zm(t),t.mixer.addEventListener("loop",function(t){t.action._clip.tracks.length>0&&0!==t.action._clip.tracks[0].name.indexOf(".bones")||(t.target._root.looped=!0)});for(var e=!1,r=!1,n=0;n<t.geometry.animations.length;n++){var i=t.geometry.animations[n],o=t.mixer.clipAction(i);i.tracks.length>0&&0===i.tracks[0].name.indexOf(".morphTargetInfluences")?r||(o.play(),r=!0):e||(o.play(),e=!0)}e&&(t.ikSolver=new Gh(t),void 0!==t.geometry.grants&&(t.grantSolver=new $m(t)))}},setCameraAnimation:function(t){void 0!==t.animations&&(t.mixer=new Zm(t),t.mixer.clipAction(t.animations[0]).play())},unifyAnimationDuration:function(t){t=void 0===t?{}:t;for(var e=0,r=this.camera,n=this.audioManager,i=0;i<this.meshes.length;i++)if(null!==(s=this.meshes[i].mixer))for(var o=0;o<s._actions.length;o++){var a=s._actions[o];e=Math.max(e,a._clip.duration)}if(null!==r&&null!==r.mixer){var s=r.mixer;for(i=0;i<s._actions.length;i++)a=s._actions[i],e=Math.max(e,a._clip.duration)}for(null!==n&&(e=Math.max(e,n.duration)),void 0!==t.afterglow&&(e+=t.afterglow),i=0;i<this.meshes.length;i++)if(null!==(s=this.meshes[i].mixer))for(o=0;o<s._actions.length;o++)(a=s._actions[o])._clip.duration=e;if(null!==r&&null!==r.mixer)for(s=r.mixer,i=0;i<s._actions.length;i++)(a=s._actions[i])._clip.duration=e;null!==n&&(n.duration=e)},controlAudio:function(t){null!==this.audioManager&&this.audioManager.control(t)},animate:function(t){this.controlAudio(t);for(var e=0;e<this.meshes.length;e++)this.animateOneMesh(t,this.meshes[e]);this.sharedPhysics&&this.updateSharedPhysics(t),this.animateCamera(t)},animateOneMesh:function(t,e){var r=e.mixer,n=e.ikSolver,i=e.grantSolver,o=e.physics;null!==r&&!0===this.doAnimation&&(this.restoreBones(e),r.update(t),this.backupBones(e)),null!==n&&!0===this.doIk&&n.update(),null!==i&&!0===this.doGrant&&i.update(),!0===e.looped&&(null!==o&&o.reset(),e.looped=!1),null!==o&&this.doPhysics&&!this.sharedPhysics&&o.update(t)},updateSharedPhysics:function(t){if(0!==this.meshes.length&&this.doPhysics&&this.sharedPhysics){var e=this.getMasterPhysics();if(null!==e){for(var r=0,n=this.meshes.length;r<n;r++)null!==(i=this.meshes[r].physics)&&void 0!==i&&i.updateRigidBodies();for(e.stepSimulation(t),r=0,n=this.meshes.length;r<n;r++){var i;null!==(i=this.meshes[r].physics)&&void 0!==i&&i.updateBones()}}}},animateCamera:function(t){if(null!==this.camera){var e=this.camera.mixer;null!==e&&void 0!==this.camera.center&&!0===this.doCameraAnimation&&(e.update(t),this.camera.updateProjectionMatrix(),this.camera.up.set(0,1,0),this.camera.up.applyQuaternion(this.camera.quaternion),this.camera.lookAt(this.camera.center))}},poseAsVpd:function(t,e,r){void 0===r&&(r={}),!0!==r.preventResetPose&&t.pose();for(var n=t.skeleton.bones,i=e.bones,o={},a=0;a<n.length;a++)o[n[a].name]=a;var s=new yu,l=new xu;for(a=0;a<i.length;a++){var c=i[a],u=o[c.name];if(void 0!==u){var h=n[u],d=c.translation,p=c.quaternion;s.set(d[0],d[1],d[2]),l.set(p[0],p[1],p[2],p[3]),h.position.add(s),h.quaternion.multiply(l)}}t.updateMatrixWorld(!0),!0!==r.preventIk&&new Gh(t).update(r.saveOriginalBonesBeforeIK),!0!==r.preventGrant&&void 0!==t.geometry.grants&&new $m(t).update()},initBackupBones:function(t){t.skeleton.backupBones=[];for(var e=0;e<t.skeleton.bones.length;e++)t.skeleton.backupBones.push(t.skeleton.bones[e].clone())},backupBones:function(t){t.skeleton.backupBoneIsSaved=!0;for(var e=0;e<t.skeleton.bones.length;e++){var r=t.skeleton.backupBones[e],n=t.skeleton.bones[e];r.position.copy(n.position),r.quaternion.copy(n.quaternion)}},restoreBones:function(t){if(!0===t.skeleton.backupBoneIsSaved){t.skeleton.backupBoneIsSaved=!1;for(var e=0;e<t.skeleton.bones.length;e++){var r=t.skeleton.bones[e],n=t.skeleton.backupBones[e];r.position.copy(n.position),r.quaternion.copy(n.quaternion)}}}};var ev=function(t){this.manager=void 0!==t?t:Pd};ev.prototype={constructor:ev,load:function(t,e,r,n){var i=this,o=new Nd(this.manager);o.setPath(this.path),o.load(t,function(t){e(i.parse(t))},r,n)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn("MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split("\n"),r={},n=/\s+/,i={},o=0;o<e.length;o++){var a=e[o];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var s=a.indexOf(" "),l=s>=0?a.substring(0,s):a;l=l.toLowerCase();var c=s>=0?a.substring(s+1):"";if(c=c.trim(),"newmtl"===l)i[c]=r={name:c};else if(r)if("ka"===l||"kd"===l||"ks"===l){var u=c.split(n,3);r[l]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else r[l]=c}}var h=new ev.MaterialCreator(this.texturePath||this.path,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(i),h}},(ev.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:Zu,this.wrap=this.options&&this.options.wrap?this.options.wrap:hh}).prototype={constructor:ev.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var r in t){var n=t[r],i={};for(var o in e[r]=i,n){var a=!0,s=n[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1)}a&&(i[l]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,r=this.materialsInfo[t],n={name:t,side:this.side};function i(t,r){if(!n[t]){var i=e.getTextureParams(r,n),o=e.loadTexture(function(t,e){return"string"!=typeof e||""===e?"":/^https?:\/\//i.test(e)?e:t+e}(e.baseUrl,i.url));o.repeat.copy(i.scale),o.offset.copy(i.offset),o.wrapS=e.wrap,o.wrapT=e.wrap,n[t]=o}}for(var o in r){var a,s=r[o];if(""!==s)switch(o.toLowerCase()){case"kd":n.color=(new Eu).fromArray(s);break;case"ks":n.specular=(new Eu).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"ns":n.shininess=parseFloat(s);break;case"d":(a=parseFloat(s))<1&&(n.opacity=a,n.transparent=!0);break;case"tr":a=parseFloat(s),this.options&&this.options.invertTrProperty&&(a=1-a),a<1&&(n.opacity=a,n.transparent=!0)}}return this.materials[t]=new Fd(n),this.materials[t]},getTextureParams:function(t,e){var r,n={scale:new Nu(1,1),offset:new Nu(0,0)},i=t.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(e.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(t,e,r,n,i){var o,a=Yd.Handlers.get(t);return null===a&&(a=new Xd(void 0!==this.manager?this.manager:Pd)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin),o=a.load(t,r,n,i),void 0!==e&&(o.mapping=e),o}};var rv=function(t){this.uuid=vu.generateUUID(),this.name="",this.allows={},this.type=t,this.userData={}};rv.prototype.isNode=!0,rv.prototype.parse=function(t,e){e=e||{},t.parsing=!0;var r=t.material;this.build(t.addCache(e.cache,e.requires).addSlot(e.slot),"v4"),r.clearVertexNode(),r.clearFragmentNode(),t.removeCache().removeSlot(),t.parsing=!1},rv.prototype.parseAndBuildCode=function(t,e,r){return this.parse(t,r=r||{}),this.buildCode(t,e,r)},rv.prototype.buildCode=function(t,e,r){var n=t.material,i={result:this.build(t.addCache((r=r||{}).cache,r.requires).addSlot(r.slot),e)};return i.code=t.isShader("vertex")?n.clearVertexNode():n.clearFragmentNode(),t.removeCache().removeSlot(),i},rv.prototype.build=function(t,e,r){e=e||this.getType(t,e);var n=t.material,i=n.getDataNode(r||this.uuid);if(t.parsing&&this.appendDepsNode(t,i,e),!1===this.allows[t.shader])throw new Error("Shader "+shader+" is not compatible with this node.");return-1===n.nodes.indexOf(this)&&n.nodes.push(this),void 0!==this.updateFrame&&-1===n.updaters.indexOf(this)&&n.updaters.push(this),this.generate(t,e,r)},rv.prototype.appendDepsNode=function(t,e,r){e.deps=(e.deps||0)+1;var n=t.getFormatLength(r);(n>(e.outputMax||0)||this.getType(t,r))&&(e.outputMax=n,e.output=r)},rv.prototype.getType=function(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type},rv.prototype.getJSONNode=function(t){if(void 0!==t&&"string"!=typeof t&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]},rv.prototype.createJSONNode=function(t){var e=void 0===t||"string"==typeof t,r={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return r.uuid=this.uuid,r.type=this.nodeType+"Node",""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e||(t.nodes[this.uuid]=r),r},rv.prototype.toJSON=function(t){return this.getJSONNode(t)||this.createJSONNode(t)};var nv=function(t,e){rv.call(this,t),this.shared=void 0===(e=e||{}).shared||e.shared,this.unique=void 0!==e.unique&&e.unique};(nv.prototype=Object.create(rv.prototype)).constructor=nv,nv.prototype.build=function(t,e,r,n){e=e||this.getType(t);var i=t.material;if(this.isShared(t,e)){var o=this.isUnique(t,e);o&&void 0===this.constructor.uuid&&(this.constructor.uuid=vu.generateUUID()),r=t.getUuid(r||this.getUuid(),!o);var a=i.getDataNode(r);if(t.parsing)return a.deps?(this.appendDepsNode(t,a,e),this.generate(t,l,r)):rv.prototype.build.call(this,t,e,r);if(o)return a.name=a.name||rv.prototype.build.call(this,t,e,r),a.name;if(!t.optimize||1==a.deps)return rv.prototype.build.call(this,t,e,r);r=this.getUuid(!1);var s=this.getTemp(t,r),l=a.output||this.getType(t);if(s)return t.format(s,l,e);s=nv.prototype.generate.call(this,t,e,r,a.output,n);var c=this.generate(t,l,r);return t.isShader("vertex")?i.addVertexNode(s+"="+c+";"):i.addFragmentNode(s+"="+c+";"),t.format(s,l,e)}return rv.prototype.build.call(this,t,e,r)},nv.prototype.isShared=function(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared},nv.prototype.isUnique=function(t,e){return this.unique},nv.prototype.getUuid=function(t){var e=(t||void 0==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e},nv.prototype.getTemp=function(t,e){e=e||this.uuid;var r=t.material;return t.isShader("vertex")&&r.vertexTemps[e]?r.vertexTemps[e].name:r.fragmentTemps[e]?r.fragmentTemps[e].name:void 0},nv.prototype.generate=function(t,e,r,n,i){return this.isShared(t,e)||console.error("TempNode is not shared!"),r=r||this.uuid,t.isShader("vertex")?t.material.getVertexTemp(r,n||this.getType(t),i).name:t.material.getFragmentTemp(r,n||this.getType(t),i).name};var iv=function(t,e,r,n){t=t||"",this.isMethod="string"!=typeof e,this.useKeywords=!0,nv.call(this,this.isMethod?null:e),this.isMethod?this.eval(t,e,r,n):this.eval(t,r,n)};iv.rDeclaration=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\((.*?)\)/i,iv.rProperties=/[a-z_0-9]+/gi,(iv.prototype=Object.create(nv.prototype)).constructor=iv,iv.prototype.eval=function(t,e,r,n){if(t=(t||"").trim(),this.includes=e||[],this.extensions=r||{},this.keywords=n||{},this.isMethod){var i=t.match(iv.rDeclaration);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var o=i[3].match(iv.rProperties);if(o)for(var a=0;a<o.length;){var s,l,c=o[a++];"in"==c||"out"==c||"inout"==c?s=o[a++]:(s=c,c=""),l=o[a++],this.inputs.push({name:l,type:s,qualifier:c})}}else this.type="",this.name=""}this.value=t};var ov={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,e,r){this.keywords[t]={callback:e,cache:r=void 0===r||r}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,e){return this.keywords[t].callback.call(this,e)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!=this.nodes[t]},containsKeyword:function(t){return void 0!=this.keywords[t]}},av=function(t){nv.call(this,"v2",{shared:!1}),this.index=t||0};av.vertexDict=["uv","uv2"],av.fragmentDict=["vUv","vUv2"],(av.prototype=Object.create(nv.prototype)).constructor=av,av.prototype.nodeType="UV",av.prototype.generate=function(t,e){var r;return t.material.requires.uv[this.index]=!0,r=t.isShader("vertex")?av.vertexDict[this.index]:av.fragmentDict[this.index],t.format(r,this.getType(t),e)},av.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e};var sv=function(t){nv.call(this,"v3"),this.scope=t||sv.LOCAL};sv.LOCAL="local",sv.WORLD="world",sv.VIEW="view",sv.PROJECTION="projection",sv.prototype=Object.create(nv.prototype),sv.prototype.constructor=sv,sv.prototype.nodeType="Position",sv.prototype.getType=function(t){switch(this.scope){case sv.PROJECTION:return"v4"}return this.type},sv.prototype.isShared=function(t){switch(this.scope){case sv.LOCAL:case sv.WORLD:return!1}return!0},sv.prototype.generate=function(t,e){var r,n=t.material;switch(this.scope){case sv.LOCAL:n.requires.position=!0,r=t.isShader("vertex")?"transformed":"vPosition";break;case sv.WORLD:n.requires.worldPosition=!0,t.isShader("vertex"),r="vWPosition";break;case sv.VIEW:r=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case sv.PROJECTION:r=t.isShader("vertex")?"(projectionMatrix * modelViewMatrix * vec4( position, 1.0 ))":"vec4( 0.0 )"}return t.format(r,this.getType(t),e)},sv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var lv=function(t){nv.call(this,"v3"),this.scope=t||lv.LOCAL};lv.LOCAL="local",lv.WORLD="world",lv.VIEW="view",lv.prototype=Object.create(nv.prototype),lv.prototype.constructor=lv,lv.prototype.nodeType="Normal",lv.prototype.isShared=function(t){switch(this.scope){case lv.WORLD:return!0}return!1},lv.prototype.generate=function(t,e){var r,n=t.material;switch(this.scope){case lv.LOCAL:n.requires.normal=!0,r=t.isShader("vertex")?"normal":"vObjectNormal";break;case lv.WORLD:n.requires.worldNormal=!0,r=t.isShader("vertex")?"( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz":"vWNormal";break;case lv.VIEW:r="vNormal"}return t.format(r,this.getType(t),e)},lv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var cv=function(t,e){(e=e||{}).shared=void 0!==e.shared&&e.shared,nv.call(this,t,e),this.readonly=!1};(cv.prototype=Object.create(nv.prototype)).constructor=cv,cv.prototype.isReadonly=function(t){return this.readonly},cv.prototype.generate=function(t,e,r,n,i,o){var a=t.material;r=t.getUuid(r||this.getUuid()),n=n||this.getType(t);var s=a.getDataNode(r);return this.isReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,e,r,n,i,o):t.isShader("vertex")?(s.vertex||(s.vertex=a.createVertexUniform(n,this.value,i,o)),t.format(s.vertex.name,n,e)):(s.fragment||(s.fragment=a.createFragmentUniform(n,this.value,i,o)),t.format(s.fragment.name,n,e))};var uv=function(t){cv.call(this,"fv1"),this.value=[t||0]};(uv.prototype=Object.create(cv.prototype)).constructor=uv,uv.prototype.nodeType="Float",Object.defineProperties(uv.prototype,{number:{get:function(){return this.value[0]},set:function(t){this.value[0]=t}}}),uv.prototype.generateReadonly=function(t,e,r,n,i,o){var a=this.number;return t.format(Math.floor(a)!==a?a:a+".0",n,e)},uv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).number=this.number,!0===this.readonly&&(e.readonly=!0)),e};var hv=function(t,e){uv.call(this),this.scale=void 0!==t?t:1,this.scope=e||hv.GLOBAL,this.timeScale=1!==this.scale};hv.GLOBAL="global",hv.LOCAL="local",hv.DELTA="delta",hv.prototype=Object.create(uv.prototype),hv.prototype.constructor=hv,hv.prototype.nodeType="Timer",hv.prototype.isReadonly=function(t){return!1},hv.prototype.isUnique=function(t){return this.timeScale&&(this.scope===hv.GLOBAL||this.scope===hv.DELTA)},hv.prototype.updateFrame=function(t){var e=this.timeScale?this.scale:1;switch(this.scope){case hv.LOCAL:this.number+=t.delta*e;break;case hv.DELTA:this.number=t.delta*e;break;default:this.number=t.time*e}},hv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale),e};var dv=function(t,e){nv.call(this),this.eval(t||dv.PI,e)};dv.PI="PI",dv.PI2="PI2",dv.RECIPROCAL_PI="RECIPROCAL_PI",dv.RECIPROCAL_PI2="RECIPROCAL_PI2",dv.LOG2="LOG2",dv.EPSILON="EPSILON",dv.prototype=Object.create(nv.prototype),dv.prototype.constructor=dv,dv.prototype.nodeType="Const",dv.prototype.getType=function(t){return t.getTypeByFormat(this.type)},dv.prototype.eval=function(t,e){var r,n,i="",o=(t=(t||"").trim()).match(/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i);this.useDefine=e,o&&o.length>1?(n=o[1],r=o[2],i=o[3]):(r=t,n="fv1"),this.name=r,this.type=n,this.value=i},dv.prototype.build=function(t,e){return"source"!==e?(t.include(this),t.format(this.name,this.getType(t),e)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":void 0},dv.prototype.generate=function(t,e){return t.format(this.name,this.getType(t),e)},dv.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).name=this.name,e.out=this.type,this.value&&(e.value=this.value),!0===e.useDefine&&(e.useDefine=!0)),e},ov.addKeyword("uv",function(){return new av}),ov.addKeyword("uv2",function(){return new av(1)}),ov.addKeyword("position",function(){return new sv}),ov.addKeyword("worldPosition",function(){return new sv(sv.WORLD)}),ov.addKeyword("normal",function(){return new lv}),ov.addKeyword("worldNormal",function(){return new lv(lv.WORLD)}),ov.addKeyword("viewPosition",function(){return new sv(lv.VIEW)}),ov.addKeyword("viewNormal",function(){return new lv(lv.VIEW)}),ov.addKeyword("time",function(){return new hv}),ov.add(new dv("vec3 LUMA vec3(0.2125, 0.7154, 0.0721)")),ov.add(new iv(["vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 mUv, vec2 scale ) {","\tvec3 q0 = dFdx( eye_pos );","\tvec3 q1 = dFdy( eye_pos );","\tvec2 st0 = dFdx( mUv.st );","\tvec2 st1 = dFdy( mUv.st );","\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );","\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );","\tvec3 N = normalize( surf_norm );","\tvec3 mapN = map * 2.0 - 1.0;","\tmapN.xy = scale * mapN.xy;","\tmat3 tsn = mat3( S, T, N );","\treturn normalize( tsn * mapN );","}"].join("\n"),null,{derivatives:!0})),ov.add(new iv(["float snoise(vec2 co) {","\treturn fract( sin( dot(co.xy, vec2(12.9898,78.233) ) ) * 43758.5453 );","}"].join("\n"))),ov.add(new iv(["vec3 hue_rgb(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n"))),ov.add(new iv(["vec3 saturation_rgb(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3(dot(rgb, LUMA));","\treturn mix(intensity, rgb, adjustment);","}"].join("\n"))),ov.add(new iv(["float luminance_rgb(vec3 rgb) {","\treturn dot(rgb, LUMA);","}"].join("\n"))),ov.add(new iv(["vec3 vibrance_rgb(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))),iv.prototype.isShared=function(t,e){return!this.isMethod},iv.prototype.getType=function(t){return t.getTypeByFormat(this.type)},iv.prototype.getInputByName=function(t){for(var e=this.inputs.length;e--;)if(this.inputs[e].name===t)return this.inputs[e]},iv.prototype.getIncludeByName=function(t){for(var e=this.includes.length;e--;)if(this.includes[e].name===t)return this.includes[e]},iv.prototype.generate=function(t,e){for(var r,n=0,i=this.value,o=0;o<this.includes.length;o++)t.include(this.includes[o],this);for(var a in this.extensions)t.material.extensions[a]=!0;for(;r=iv.rProperties.exec(this.value);){var s=r[0],l=!this.isMethod||!this.getInputByName(s),c=s;if(this.keywords[s]||this.useKeywords&&l&&ov.containsKeyword(s)){var u=this.keywords[s];if(!u){var h=ov.getKeywordData(s);h.cache&&(u=t.keywords[s]),u=u||ov.getKeyword(s,t),h.cache&&(t.keywords[s]=u)}c=u.build(t)}s!=c&&(i=i.substring(0,r.index+n)+c+i.substring(r.index+s.length+n),n+=c.length-s.length),void 0===this.getIncludeByName(c)&&ov.contains(c)&&t.include(ov.get(c))}return"source"===e?i:this.isMethod?(t.include(this,!1,i),this.name):t.format("("+i+")",this.getType(t),e)};var pv=function(t,e){nv.call(this,"v3"),this.setScope(t||pv.POSITION),this.setCamera(e)};pv.fDepthColor=new iv(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n")),pv.POSITION="position",pv.DEPTH="depth",pv.TO_VERTEX="toVertex",pv.prototype=Object.create(nv.prototype),pv.prototype.constructor=pv,pv.prototype.nodeType="Camera",pv.prototype.setCamera=function(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0},pv.prototype.setScope=function(t){switch(this.scope){case pv.DEPTH:delete this.near,delete this.far}switch(this.scope=t,t){case pv.DEPTH:var e=this.camera;this.near=new uv(e?e.near:1),this.far=new uv(e?e.far:1200)}},pv.prototype.getType=function(t){switch(this.scope){case pv.DEPTH:return"fv1"}return this.type},pv.prototype.isUnique=function(t){switch(this.scope){case pv.DEPTH:case pv.TO_VERTEX:return!0}return!1},pv.prototype.isShared=function(t){switch(this.scope){case pv.POSITION:return!1}return!0},pv.prototype.generate=function(t,e){var r;switch(this.scope){case pv.POSITION:r="cameraPosition";break;case pv.DEPTH:var n=pv.fDepthColor;t.include(n),r=n.name+"("+this.near.build(t,"fv1")+","+this.far.build(t,"fv1")+")";break;case pv.TO_VERTEX:r="normalize( "+new sv(sv.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(r,this.getType(t),e)},pv.prototype.onUpdateFrame=function(t){switch(this.scope){case pv.DEPTH:var e=this.camera;this.near.number=e.near,this.far.number=e.far}},pv.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e)switch((e=this.createJSONNode(t)).scope=this.scope,this.camera&&(e.camera=this.camera.uuid),this.scope){case pv.DEPTH:e.near=this.near.number,e.far=this.far.number}return e},Object.assign((function(t,e){this.manager=void 0!==t?t:Pd,this.nodes={},this.materials={},this.passes={},this.names={},this.library=e||{}}).prototype,{load:function(t,e,r,n){var i=this;return new Nd(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n),this},getObjectByName:function(t){return this.names[t]},getObjectById:function(t){return this.library[t]||this.nodes[t]||this.names[t]},getNode:function(t){var e=this.getObjectById(t);return e||console.warn('Node "'+t+'" not found.'),e},parse:function(t){var e,r,n,i,o;for(e in t.nodes)r=t.nodes[e],n=new THREE[r.type],r.name?(n.name=r.name,this.names[n.name]=n):n.readonly=!0,void 0!==r.readonly&&(n.readonly=r.readonly),this.nodes[e]=n;for(e in t.materials)r=t.materials[e],n=new THREE[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.materials[e]=n;for(e in t.passes)r=t.passes[e],n=new THREE[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.passes[e]=n;for(e in t.material&&(this.material=this.materials[e]),t.pass&&(this.pass=this.passes[e]),t.nodes)switch(n=this.nodes[e],(r=t.nodes[e]).type){case"FloatNode":n.number=r.number;break;case"ColorNode":n.value.copy(r);break;case"Vector2Node":n.x=r.x,n.y=r.y;break;case"Vector3Node":n.x=r.x,n.y=r.y,n.z=r.z;break;case"Vector4Node":n.x=r.x,n.y=r.y,n.z=r.z,n.w=r.w;break;case"Matrix3Node":case"Matrix4Node":n.value.fromArray(r.elements);break;case"OperatorNode":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.op=r.op;break;case"Math1Node":n.a=this.getNode(r.a),n.method=r.method;break;case"Math2Node":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.method=r.method;break;case"Math3Node":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.c=this.getNode(r.c),n.method=r.method;break;case"UVNode":case"ColorsNode":n.index=r.index;break;case"LuminanceNode":n.rgb=this.getNode(r.rgb);break;case"PositionNode":case"NormalNode":case"ReflectNode":case"LightNode":n.scope=r.scope;break;case"SwitchNode":n.node=this.getNode(r.node),n.components=r.components;break;case"JoinNode":for(i in r.inputs)n[i]=this.getNode(r.inputs[i]);break;case"CameraNode":switch(n.setScope(r.scope),r.camera&&n.setCamera(this.getNode(r.camera)),r.scope){case pv.DEPTH:n.near.number=r.near,n.far.number=r.far}break;case"ColorAdjustmentNode":n.rgb=this.getNode(r.rgb),n.adjustment=this.getNode(r.adjustment),n.method=r.method;break;case"UVTransformNode":n.uv=this.getNode(r.uv),n.transform=this.getNode(r.transform);break;case"BumpNode":n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.scale=this.getNode(r.scale);break;case"BlurNode":n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.scale=this.getNode(r.scale),n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.radius=this.getNode(r.radius),void 0!==r.size&&(n.size=new Nu(r.size.x,r.size.y)),n.blurX=r.blurX,n.blurY=r.blurY;break;case"ResolutionNode":n.renderer=this.getNode(r.renderer);break;case"ScreenUVNode":n.resolution=this.getNode(r.resolution);break;case"VelocityNode":r.target&&n.setTarget(this.getNode(r.target)),n.setParams(r.params);break;case"TimerNode":n.scope=r.scope,n.scale=r.scale;break;case"ConstNode":n.name=r.name,n.type=r.out,n.value=r.value,n.useDefine=!0===r.useDefine;break;case"AttributeNode":case"VarNode":n.type=r.out;break;case"ReflectorNode":n.setMirror(this.getNode(r.mirror)),r.offset&&(n.offset=this.getNode(r.offset));break;case"NoiseNode":n.coord=this.getNode(r.coord);break;case"FunctionNode":for(i in n.isMethod=r.isMethod,n.useKeywords=r.useKeywords,n.extensions=r.extensions,n.keywords={},r.keywords)n.keywords[i]=this.getNode(r.keywords[i]);if(r.includes)for(o=0;o<r.includes.length;o++)n.includes.push(this.getNode(r.includes[o]));n.eval(r.src,n.includes,n.extensions,n.keywords),n.isMethod||(n.type=r.out);break;case"FunctionCallNode":for(i in r.inputs)n.inputs[i]=this.getNode(r.inputs[i]);n.value=this.getNode(r.value);break;case"TextureNode":case"CubeTextureNode":case"ScreenNode":r.value&&(n.value=this.getNode(r.value)),n.coord=this.getNode(r.coord),r.bias&&(n.bias=this.getNode(r.bias)),void 0!==n.project&&(n.project=r.project);break;case"RoughnessToBlinnExponentNode":break;case"RawNode":n.value=this.getNode(r.value);break;case"StandardNode":case"PhongNode":case"SpriteNode":n.color=this.getNode(r.color),r.alpha&&(n.alpha=this.getNode(r.alpha)),r.specular&&(n.specular=this.getNode(r.specular)),r.shininess&&(n.shininess=this.getNode(r.shininess)),r.roughness&&(n.roughness=this.getNode(r.roughness)),r.metalness&&(n.metalness=this.getNode(r.metalness)),r.reflectivity&&(n.reflectivity=this.getNode(r.reflectivity)),r.clearCoat&&(n.clearCoat=this.getNode(r.clearCoat)),r.clearCoatRoughness&&(n.clearCoatRoughness=this.getNode(r.clearCoatRoughness)),r.normal&&(n.normal=this.getNode(r.normal)),r.normalScale&&(n.normalScale=this.getNode(r.normalScale)),r.emissive&&(n.emissive=this.getNode(r.emissive)),r.ambient&&(n.ambient=this.getNode(r.ambient)),r.shadow&&(n.shadow=this.getNode(r.shadow)),r.light&&(n.light=this.getNode(r.light)),r.ao&&(n.ao=this.getNode(r.ao)),r.environment&&(n.environment=this.getNode(r.environment)),r.environmentAlpha&&(n.environmentAlpha=this.getNode(r.environmentAlpha)),r.transform&&(n.transform=this.getNode(r.transform)),!1===r.spherical&&(n.spherical=!1);break;default:console.warn(r.type,"not supported.")}for(e in t.materials)n=this.materials[e],void 0!==(r=t.materials[e]).name&&(n.name=r.name),void 0!==r.blending&&(n.blending=r.blending),void 0!==r.flatShading&&(n.flatShading=r.flatShading),void 0!==r.side&&(n.side=r.side),n.depthFunc=r.depthFunc,n.depthTest=r.depthTest,n.depthWrite=r.depthWrite,void 0!==r.wireframe&&(n.wireframe=r.wireframe),void 0!==r.wireframeLinewidth&&(n.wireframeLinewidth=r.wireframeLinewidth),void 0!==r.wireframeLinecap&&(n.wireframeLinecap=r.wireframeLinecap),void 0!==r.wireframeLinejoin&&(n.wireframeLinejoin=r.wireframeLinejoin),void 0!==r.skinning&&(n.skinning=r.skinning),void 0!==r.morphTargets&&(n.morphTargets=r.morphTargets),void 0!==r.visible&&(n.visible=r.visible),void 0!==r.userData&&(n.userData=r.userData),n.vertex=this.getNode(r.vertex),n.fragment=this.getNode(r.fragment),n.vertex===n.fragment&&(n.node=n.vertex),n.build(),void 0!==r.fog&&(n.fog=r.fog),void 0!==r.lights&&(n.lights=r.lights),void 0!==r.transparent&&(n.transparent=r.transparent);for(e in t.passes)(n=this.passes[e]).value=this.getNode((r=t.passes[e]).value),n.build();return this.material||this.pass||this}}),function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,r=/^usemtl /;function n(t){this.manager=void 0!==t?t:Pd,this.materials=null}n.prototype={constructor:n,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setPath(this.path),o.load(t,function(t){e(i.parse(t))},r,n)},setPath:function(t){this.path=t},setMaterials:function(t){return this.materials=t,this},parse:function(n){console.time("OBJLoader");var i=new function(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseNormalIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseUVIndex:function(t,e){var r=parseInt(t,10);return 2*(r>=0?r-1:r+e/2)},addVertex:function(t,e,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(t,e,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(t,e,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[t+0],n[t+1]),i.push(n[e+0],n[e+1]),i.push(n[r+0],n[r+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,r,n,i,o,a,s,l){var c=this.vertices.length,u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(e,c),d=this.parseVertexIndex(r,c);if(this.addVertex(u,h,d),void 0!==n&&""!==n){var p=this.uvs.length;u=this.parseUVIndex(n,p),h=this.parseUVIndex(i,p),d=this.parseUVIndex(o,p),this.addUV(u,h,d)}if(void 0!==a&&""!==a){var f=this.normals.length;u=this.parseNormalIndex(a,f),h=a===s?u:this.parseNormalIndex(s,f),d=a===l?u:this.parseNormalIndex(l,f),this.addNormal(u,h,d)}this.colors.length>0&&this.addColor(u,h,d)},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,r=0,n=t.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(t[r],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,o=t.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(t[i],r));var a=0;for(o=e.length;a<o;a++)this.addUVLine(this.parseUVIndex(e[a],n))}};return t.startObject("",!1),t};-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var o=n.split("\n"),a="",s="",l=[],c="function"==typeof"".trimLeft,u=0,h=o.length;u<h;u++)if(a=o[u],0!==(a=c?a.trimLeft():a.trim()).length&&"#"!==(s=a.charAt(0)))if("v"===s){var d=a.split(/\s+/);switch(d[0]){case"v":i.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&i.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":i.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":i.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===s){for(var p=a.substr(1).trim().split(/\s+/),f=[],m=0,v=p.length;m<v;m++){var g=p[m];if(g.length>0){var y=g.split("/");f.push(y)}}var x=f[0];for(m=1,v=f.length-1;m<v;m++){var b=f[m],w=f[m+1];i.addFace(x[0],b[0],w[0],x[1],b[1],w[1],x[2],b[2],w[2])}}else if("l"===s){var _=a.substring(1).trim().split(" "),S=[],T=[];if(-1===a.indexOf("/"))S=_;else for(var M=0,A=_.length;M<A;M++){var E=_[M].split("/");""!==E[0]&&S.push(E[0]),""!==E[1]&&T.push(E[1])}i.addLineGeometry(S,T)}else if("p"===s){var C=a.substr(1).trim().split(" ");i.addPointGeometry(C)}else if(null!==(l=t.exec(a))){var P=(" "+l[0].substr(1).trim()).substr(1);i.startObject(P)}else if(r.test(a))i.object.startMaterial(a.substring(7).trim(),i.materialLibraries);else if(e.test(a))i.materialLibraries.push(a.substring(7).trim());else{if("s"!==s){if("\0"===a)continue;throw new Error('OBJLoader: Unexpected line: "'+a+'"')}if((l=a.split(" ")).length>1){var O=l[1].trim().toLowerCase();i.object.smooth="0"!==O&&"off"!==O}else i.object.smooth=!0;(H=i.object.currentMaterial())&&(H.smooth=i.object.smooth)}i.finalize();var N=new Nf;for(N.materialLibraries=[].concat(i.materialLibraries),u=0,h=i.objects.length;u<h;u++){var L=i.objects[u],I=L.geometry,R=L.materials,D="Line"===I.type,F="Points"===I.type,U=!1;if(0!==I.vertices.length){var k=new Yu;k.addAttribute("position",new Gu(I.vertices,3)),I.normals.length>0?k.addAttribute("normal",new Gu(I.normals,3)):k.computeVertexNormals(),I.colors.length>0&&(U=!0,k.addAttribute("color",new Gu(I.colors,3))),I.uvs.length>0&&k.addAttribute("uv",new Gu(I.uvs,2));for(var B,j=[],z=0,V=R.length;z<V;z++){var G=R[z],H=void 0;if(null!==this.materials)if(H=this.materials.create(G.name),!D||!H||H instanceof Fh){if(F&&H&&!(H instanceof jd)){var W=new jd({size:10,sizeAttenuation:!1});X.copy(H),H=W}}else{var X=new Fh;X.copy(H),X.lights=!1,H=X}H||((H=D?new Fh:F?new jd({size:1,sizeAttenuation:!1}):new Fd).name=G.name),H.flatShading=!G.smooth,H.vertexColors=U?eh:$u,j.push(H)}if(j.length>1){for(z=0,V=R.length;z<V;z++)k.addGroup((G=R[z]).groupStart,G.groupCount,z);B=D?new Kf(k,j):F?new mf(k,j):new zh(k,j)}else B=D?new Kf(k,j[0]):F?new mf(k,j[0]):new zh(k,j[0]);B.name=L.name,N.add(B)}}return console.timeEnd("OBJLoader"),N}}}(),void 0===jm&&console.error('"LoaderSupport" is not available. "OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.'),function(){var t="2.4.0",e=jm.Validator;function r(r){console.info("Using OBJLoader2 version: "+t),this.manager=e.verifyInput(r,Pd),this.logging={enabled:!0,debug:!1},this.modelName="",this.instanceNo=0,this.path="",this.useIndices=!1,this.disregardNormals=!1,this.materialPerSmoothingGroup=!1,this.loaderRootNode=new Nf,this.meshBuilder=new jm.MeshBuilder,this.callbacks=new jm.Callbacks,this.workerSupport=new jm.WorkerSupport,this.terminateWorkerOnLoad=!0}r.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e,this.meshBuilder.setLogging(this.logging.enabled,this.logging.debug)},r.prototype.setModelName=function(t){this.modelName=e.verifyInput(t,this.modelName)},r.prototype.setPath=function(t){this.path=e.verifyInput(t,this.path)},r.prototype.setStreamMeshesTo=function(t){this.loaderRootNode=e.verifyInput(t,this.loaderRootNode)},r.prototype.setMaterials=function(t){this.meshBuilder.setMaterials(t)},r.prototype.setUseIndices=function(t){this.useIndices=!0===t},r.prototype.setDisregardNormals=function(t){this.disregardNormals=!0===t},r.prototype.setMaterialPerSmoothingGroup=function(t){this.materialPerSmoothingGroup=!0===t},r.prototype._setCallbacks=function(t){e.isValid(t.onProgress)&&this.callbacks.setCallbackOnProgress(t.onProgress),e.isValid(t.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(t.onMeshAlter),e.isValid(t.onLoad)&&this.callbacks.setCallbackOnLoad(t.onLoad),e.isValid(t.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(t.onLoadMaterials),this.meshBuilder._setCallbacks(this.callbacks)},r.prototype.onProgress=function(t,r,n){var i=e.isValid(r)?r:"",o={detail:{type:t,modelName:this.modelName,instanceNo:this.instanceNo,text:i,numericalValue:n}};e.isValid(this.callbacks.onProgress)&&this.callbacks.onProgress(o),this.logging.enabled&&this.logging.debug&&console.debug(i)},r.prototype._onError=function(t){var e="Error occurred while downloading!";throw t.currentTarget&&null!==t.currentTarget.statusText&&(e+="\nurl: "+t.currentTarget.responseURL+"\nstatus: "+t.currentTarget.statusText),this.onProgress("error",e,-1),e},r.prototype.load=function(t,e,r,n,i,o){var a=new jm.ResourceDescriptor(t,"OBJ");this._loadObj(a,e,r,n,i,o)},r.prototype._loadObj=function(t,r,n,i,o,a){e.isValid(i)||(i=this._onError),e.isValid(t)||i("An invalid ResourceDescriptor was provided. Unable to continue!");var s=this,l=function(e){if(t.content=e,a)s.parseAsync(e,r);else{var n=new jm.Callbacks;n.setCallbackOnMeshAlter(o),s._setCallbacks(n),r({detail:{loaderRootNode:s.parse(e),modelName:s.modelName,instanceNo:s.instanceNo}})}};if(!e.isValid(t.url)||e.isValid(t.content))l(e.isValid(t.content)?t.content:null);else{if(!e.isValid(n)){var c=0,u=0;n=function(e){if(e.lengthComputable&&(u=e.loaded/e.total)>c){c=u;var r='Download of "'+t.url+'": '+(100*u).toFixed(2)+"%";s.onProgress("progressLoad",r,u)}}}var h=new Nd(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(t.url,l,n,i)}},r.prototype.run=function(t,r){this._applyPrepData(t);var n=t.checkResourceDescriptorFiles(t.resources,[{ext:"obj",type:"ArrayBuffer",ignore:!1},{ext:"mtl",type:"String",ignore:!1},{ext:"zip",type:"String",ignore:!0}]);e.isValid(r)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=r,this.logging.enabled=this.workerSupport.logging.enabled,this.logging.debug=this.workerSupport.logging.debug);var i=this;this._loadMtl(n.mtl,function(e){null!==e&&i.meshBuilder.setMaterials(e),i._loadObj(n.obj,i.callbacks.onLoad,null,null,i.callbacks.onMeshAlter,t.useAsync)},t.crossOrigin,t.materialOptions)},r.prototype._applyPrepData=function(t){e.isValid(t)&&(this.setLogging(t.logging.enabled,t.logging.debug),this.setModelName(t.modelName),this.setStreamMeshesTo(t.streamMeshesTo),this.meshBuilder.setMaterials(t.materials),this.setUseIndices(t.useIndices),this.setDisregardNormals(t.disregardNormals),this.setMaterialPerSmoothingGroup(t.materialPerSmoothingGroup),this._setCallbacks(t.getCallbacks()))},r.prototype.parse=function(t){if(!e.isValid(t))return console.warn("Provided content is not a valid ArrayBuffer or String."),this.loaderRootNode;this.logging.enabled&&console.time("OBJLoader2 parse: "+this.modelName),this.meshBuilder.init();var r=new n;r.setLogging(this.logging.enabled,this.logging.debug),r.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),r.setUseIndices(this.useIndices),r.setDisregardNormals(this.disregardNormals),r.setMaterials(this.meshBuilder.getMaterials());var i=this;if(r.setCallbackMeshBuilder(function(t){var e=i.meshBuilder.processPayload(t);for(var r in e)i.loaderRootNode.add(e[r])}),r.setCallbackProgress(function(t,e){i.onProgress("progressParse",t,e)}),t instanceof ArrayBuffer||t instanceof Uint8Array)this.logging.enabled&&console.info("Parsing arrayBuffer..."),r.parse(t);else{if(!("string"==typeof t||t instanceof String))throw"Provided content was neither of type String nor Uint8Array! Aborting...";this.logging.enabled&&console.info("Parsing text..."),r.parseText(t)}return this.logging.enabled&&console.timeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},r.prototype.parseAsync=function(t,r){var i=this,o=!1,a=function(){r({detail:{loaderRootNode:i.loaderRootNode,modelName:i.modelName,instanceNo:i.instanceNo}}),o&&i.logging.enabled&&console.timeEnd("OBJLoader2 parseAsync: "+i.modelName)};e.isValid(t)?o=!0:(console.warn("Provided content is not a valid ArrayBuffer."),a()),o&&this.logging.enabled&&console.time("OBJLoader2 parseAsync: "+this.modelName),this.meshBuilder.init(),this.workerSupport.validate(function(t,r){var i="";return i+="\n\n",i+="var LoaderSupport = {};\n\n",(i+=t("LoaderSupport.Validator",e))+r("Parser",n)},"Parser"),this.workerSupport.setCallbacks(function(t){var e=i.meshBuilder.processPayload(t);for(var r in e)i.loaderRootNode.add(e[r])},a),i.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var s={},l=this.meshBuilder.getMaterials();for(var c in l)s[c]=c;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logging:{enabled:this.logging.enabled,debug:this.logging.debug},materials:{materials:s},data:{input:t,options:null}})};var n=function(){function t(){this.callbackProgress=null,this.callbackMeshBuilder=null,this.contentRef=null,this.legacyMode=!1,this.materials={},this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0},this.logging={enabled:!0,debug:!1}}return t.prototype.resetRawMesh=function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this.pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},t.prototype.setUseAsync=function(t){this.useAsync=t},t.prototype.setMaterialPerSmoothingGroup=function(t){this.materialPerSmoothingGroup=t},t.prototype.setUseIndices=function(t){this.useIndices=t},t.prototype.setDisregardNormals=function(t){this.disregardNormals=t},t.prototype.setMaterials=function(t){this.materials=jm.Validator.verifyInput(t,this.materials),this.materials=jm.Validator.verifyInput(this.materials,{})},t.prototype.setCallbackMeshBuilder=function(t){if(!jm.Validator.isValid(t))throw'Unable to run as no "MeshBuilder" callback is set.';this.callbackMeshBuilder=t},t.prototype.setCallbackProgress=function(t){this.callbackProgress=t},t.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},t.prototype.configure=function(){if(this.pushSmoothingGroup(1),this.logging.enabled){var t=Object.keys(this.materials),e=t.length>0?"\n\tmaterialNames:\n\t\t- "+t.join("\n\t\t- "):"\n\tmaterialNames: None";console.info("OBJLoader2.Parser configuration:"+e+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackMeshBuilderName: "+this.callbackMeshBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name)}},t.prototype.parse=function(t){this.logging.enabled&&console.time("OBJLoader2.Parser.parse"),this.configure();var e=new Uint8Array(t);this.contentRef=e;var r=e.byteLength;this.globalCounts.totalBytes=r;for(var n,i=new Array(128),o="",a=0,s=0,l=0;l<r;l++)switch(n=e[l]){case 32:o.length>0&&(i[a++]=o),o="";break;case 47:o.length>0&&(i[a++]=o),s++,o="";break;case 10:o.length>0&&(i[a++]=o),o="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=l,this.processLine(i,a,s),a=0,s=0;break;case 13:break;default:o+=String.fromCharCode(n)}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parse")},t.prototype.parseText=function(t){this.logging.enabled&&console.time("OBJLoader2.Parser.parseText"),this.configure(),this.legacyMode=!0,this.contentRef=t;var e=t.length;this.globalCounts.totalBytes=e;for(var r,n=new Array(128),i="",o=0,a=0,s=0;s<e;s++)switch(r=t[s]){case" ":i.length>0&&(n[o++]=i),i="";break;case"/":i.length>0&&(n[o++]=i),a++,i="";break;case"\n":i.length>0&&(n[o++]=i),i="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=s,this.processLine(n,o,a),o=0,a=0;break;case"\r":break;default:i+=r}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parseText")},t.prototype.processLine=function(t,e,r){if(!(e<1)){var n,i,o,a,s=function(t,e,r,n){var i="";if(n>r){var o;if(e)for(o=r;o<n;o++)i+=t[o];else for(o=r;o<n;o++)i+=String.fromCharCode(t[o]);i=i.trim()}return i};switch(a=t[0]){case"v":this.vertices.push(parseFloat(t[1])),this.vertices.push(parseFloat(t[2])),this.vertices.push(parseFloat(t[3])),e>4&&(this.colors.push(parseFloat(t[4])),this.colors.push(parseFloat(t[5])),this.colors.push(parseFloat(t[6])));break;case"vt":this.uvs.push(parseFloat(t[1])),this.uvs.push(parseFloat(t[2]));break;case"vn":this.normals.push(parseFloat(t[1])),this.normals.push(parseFloat(t[2])),this.normals.push(parseFloat(t[3]));break;case"f":if(n=e-1,0===r)for(this.checkFaceType(0),o=2,i=n;o<i;o++)this.buildFace(t[1]),this.buildFace(t[o]),this.buildFace(t[o+1]);else if(n===2*r)for(this.checkFaceType(1),o=3,i=n-2;o<i;o+=2)this.buildFace(t[1],t[2]),this.buildFace(t[o],t[o+1]),this.buildFace(t[o+2],t[o+3]);else if(2*n==3*r)for(this.checkFaceType(2),o=4,i=n-3;o<i;o+=3)this.buildFace(t[1],t[2],t[3]),this.buildFace(t[o],t[o+1],t[o+2]),this.buildFace(t[o+3],t[o+4],t[o+5]);else for(this.checkFaceType(3),o=3,i=n-2;o<i;o+=2)this.buildFace(t[1],void 0,t[2]),this.buildFace(t[o],void 0,t[o+1]),this.buildFace(t[o+2],void 0,t[o+3]);break;case"l":case"p":if((n=e-1)==2*r)for(this.checkFaceType(4),o=1,i=n+1;o<i;o+=2)this.buildFace(t[o],t[o+1]);else for(this.checkFaceType("l"===a?5:6),o=1,i=n+1;o<i;o++)this.buildFace(t[o]);break;case"s":this.pushSmoothingGroup(t[1]);break;case"g":this.processCompletedMesh(),this.rawMesh.groupName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.rawMesh.objectName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var l=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==l&&this.rawMesh.activeMtlName!==l&&(this.rawMesh.activeMtlName=l,this.rawMesh.counts.mtlCount++,this.checkSubGroup())}}},t.prototype.pushSmoothingGroup=function(t){var e=parseInt(t);isNaN(e)&&(e="off"===t?0:1);var r=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?e:0===e?0:1,this.rawMesh.smoothingGroup.real=e,r!==e&&(this.rawMesh.counts.smoothingGroupCount++,this.checkSubGroup())},t.prototype.checkFaceType=function(t){this.rawMesh.faceType!==t&&(this.processCompletedMesh(),this.rawMesh.faceType=t,this.checkSubGroup())},t.prototype.checkSubGroup=function(){var t=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[t],jm.Validator.isValid(this.rawMesh.subGroupInUse)||(this.rawMesh.subGroupInUse={index:t,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[t]=this.rawMesh.subGroupInUse)},t.prototype.buildFace=function(t,e,r){this.disregardNormals&&(r=void 0);var n=this,i=function(){var i=parseInt(t),o=3*(i>0?i-1:i+n.vertices.length/3),a=n.rawMesh.subGroupInUse.vertices;a.push(n.vertices[o++]),a.push(n.vertices[o++]),a.push(n.vertices[o]);var s=n.colors.length>0?o:null;if(null!==s){var l=n.rawMesh.subGroupInUse.colors;l.push(n.colors[s++]),l.push(n.colors[s++]),l.push(n.colors[s])}if(e){var c=parseInt(e),u=2*(c>0?c-1:c+n.uvs.length/2),h=n.rawMesh.subGroupInUse.uvs;h.push(n.uvs[u++]),h.push(n.uvs[u])}if(r){var d=parseInt(r),p=3*(d>0?d-1:d+n.normals.length/3),f=n.rawMesh.subGroupInUse.normals;f.push(n.normals[p++]),f.push(n.normals[p++]),f.push(n.normals[p])}};if(this.useIndices){var o=t+(e?"_"+e:"_n")+(r?"_"+r:"_n"),a=this.rawMesh.subGroupInUse.indexMappings[o];jm.Validator.isValid(a)?this.rawMesh.counts.doubleIndicesCount++:(a=this.rawMesh.subGroupInUse.vertices.length/3,i(),this.rawMesh.subGroupInUse.indexMappings[o]=a,this.rawMesh.subGroupInUse.indexMappingsCount++),this.rawMesh.subGroupInUse.indices.push(a)}else i();this.rawMesh.counts.faceCount++},t.prototype.createRawMeshReport=function(t){return"Input Object number: "+t+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},t.prototype.finalizeRawMesh=function(){var t,e,r=[],n=0,i=0,o=0,a=0,s=0,l=0;for(var c in this.rawMesh.subGroups)if((t=this.rawMesh.subGroups[c]).vertices.length>0){if((e=t.indices).length>0&&i>0)for(var u in e)e[u]=e[u]+i;r.push(t),n+=t.vertices.length,i+=t.indexMappingsCount,o+=t.indices.length,a+=t.colors.length,l+=t.uvs.length,s+=t.normals.length}var h=null;return r.length>0&&(h={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:r,absoluteVertexCount:n,absoluteIndexCount:o,absoluteColorCount:a,absoluteNormalCount:s,absoluteUvCount:l,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),h},t.prototype.processCompletedMesh=function(){var t=this.finalizeRawMesh();if(jm.Validator.isValid(t)){if(this.colors.length>0&&this.colors.length!==this.vertices.length)throw"Vertex Colors were detected, but vertex count and color count do not match!";this.logging.enabled&&this.logging.debug&&console.debug(this.createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(t);var e=this.globalCounts.currentByte/this.globalCounts.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*e).toFixed(2)+"%",e),this.resetRawMesh(),!0}return!1},t.prototype.buildMesh=function(t){var e=t.subGroups,r=new Float32Array(t.absoluteVertexCount);this.globalCounts.vertices+=t.absoluteVertexCount/3,this.globalCounts.faces+=t.faceCount,this.globalCounts.doubleIndicesCount+=t.doubleIndicesCount;var n,i,o,a,s,l,c=t.absoluteIndexCount>0?new Uint32Array(t.absoluteIndexCount):null,u=t.absoluteColorCount>0?new Float32Array(t.absoluteColorCount):null,h=t.absoluteNormalCount>0?new Float32Array(t.absoluteNormalCount):null,d=t.absoluteUvCount>0?new Float32Array(t.absoluteUvCount):null,p=jm.Validator.isValid(u),f=[],m=e.length>1,v=0,g=[],y=[],x=0,b=0,w=0,_=0,S=0,T=0,M=0;for(var A in e)if(e.hasOwnProperty(A)){if(l=(n=e[A]).materialName,a=this.materials[s=this.rawMesh.faceType<4?l+(p?"_vertexColor":"")+(0===n.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial"],!jm.Validator.isValid(o=this.materials[l])&&!jm.Validator.isValid(a)){var E=p?"defaultVertexColorMaterial":"defaultMaterial";o=this.materials[E],this.logging.enabled&&console.warn('object_group "'+n.objectName+"_"+n.groupName+'" was defined with unresolvable material "'+l+'"! Assigning "'+E+'".'),(l=E)===s&&(a=o,s=E)}if(!jm.Validator.isValid(a)){var C={materialNameOrg:l,materialName:s,materialProperties:{vertexColors:p?2:0,flatShading:0===n.smoothingGroup}};this.callbackMeshBuilder({cmd:"materialData",materials:{materialCloneInstructions:C}}),this.useAsync&&(this.materials[s]=C)}if(m?((i=g[s])||(i=v,g[s]=v,f.push(s),v++),y.push({start:T,count:M=this.useIndices?n.indices.length:n.vertices.length/3,index:i}),T+=M):f.push(s),r.set(n.vertices,x),x+=n.vertices.length,c&&(c.set(n.indices,b),b+=n.indices.length),u&&(u.set(n.colors,w),w+=n.colors.length),h&&(h.set(n.normals,_),_+=n.normals.length),d&&(d.set(n.uvs,S),S+=n.uvs.length),this.logging.enabled&&this.logging.debug){var P=jm.Validator.isValid(i)?"\n\t\tmaterialIndex: "+i:"";console.debug("\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+n.groupName+"\n\t\tIndex: "+n.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+n.materialName+"\n\t\tsmoothingGroup: "+n.smoothingGroup+P+"\n\t\tobjectName: "+n.objectName+"\n\t\t#vertices: "+n.vertices.length/3+"\n\t\t#indices: "+n.indices.length+"\n\t\t#colors: "+n.colors.length/3+"\n\t\t#uvs: "+n.uvs.length/2+"\n\t\t#normals: "+n.normals.length/3)}}this.outputObjectCount++,this.callbackMeshBuilder({cmd:"meshData",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:t.name},materials:{multiMaterial:m,materialNames:f,materialGroups:y},buffers:{vertices:r,indices:c,colors:u,normals:h,uvs:d},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[r.buffer],jm.Validator.isValid(c)?[c.buffer]:null,jm.Validator.isValid(u)?[u.buffer]:null,jm.Validator.isValid(h)?[h.buffer]:null,jm.Validator.isValid(d)?[d.buffer]:null)},t.prototype.finalizeParsing=function(){this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this.processCompletedMesh()&&this.logging.enabled&&console.info("Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount)},t}();r.prototype.loadMtl=function(t,e,r,n,i){var o=new jm.ResourceDescriptor(t,"MTL");o.setContent(e),this._loadMtl(o,r,n,i)},r.prototype._loadMtl=function(t,r,n,i){void 0===ev&&console.error('"MTLLoader" is not available. "OBJLoader2" requires it for loading MTL files.'),e.isValid(t)&&this.logging.enabled&&console.time("Loading MTL: "+t.name);var o=[],a=this,s=function(n){var i=[];if(e.isValid(n))for(var s in n.preload(),i=n.materials)i.hasOwnProperty(s)&&(o[s]=i[s]);e.isValid(t)&&a.logging.enabled&&console.timeEnd("Loading MTL: "+t.name),r(o,n)};if(e.isValid(t)&&(e.isValid(t.content)||e.isValid(t.url))){var l=new ev(this.manager);n=e.verifyInput(n,"anonymous"),l.setCrossOrigin(n),l.setPath(t.path),e.isValid(i)&&l.setMaterialOptions(i),e.isValid(t.content)?s(e.isValid(t.content)?l.parse(t.content):null):e.isValid(t.url)&&new Nd(this.manager).load(t.url,function(e){t.content=e,s(l.parse(e))},this._onProgress,this._onError)}else s()}}();var fv=function(t){this.manager=void 0!==t?t:Pd,this.littleEndian=!0};fv.prototype={constructor:fv,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(r){e(i.parse(r,t))},r,n)},parse:function(t,e){var r=qd.decodeText(t),n=function(t){var e={},r=t.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(t.substr(r-1));if(e.data=n[1],e.headerLen=n[0].length+r,e.str=t.substr(0,e.headerLen),e.str=e.str.replace(/\#.*/gi,""),e.version=/VERSION (.*)/i.exec(e.str),e.fields=/FIELDS (.*)/i.exec(e.str),e.size=/SIZE (.*)/i.exec(e.str),e.type=/TYPE (.*)/i.exec(e.str),e.count=/COUNT (.*)/i.exec(e.str),e.width=/WIDTH (.*)/i.exec(e.str),e.height=/HEIGHT (.*)/i.exec(e.str),e.viewpoint=/VIEWPOINT (.*)/i.exec(e.str),e.points=/POINTS (.*)/i.exec(e.str),null!==e.version&&(e.version=parseFloat(e.version[1])),null!==e.fields&&(e.fields=e.fields[1].split(" ")),null!==e.type&&(e.type=e.type[1].split(" ")),null!==e.width&&(e.width=parseInt(e.width[1])),null!==e.height&&(e.height=parseInt(e.height[1])),null!==e.viewpoint&&(e.viewpoint=e.viewpoint[1]),null!==e.points&&(e.points=parseInt(e.points[1],10)),null===e.points&&(e.points=e.width*e.height),null!==e.size&&(e.size=e.size[1].split(" ").map(function(t){return parseInt(t,10)})),null!==e.count)e.count=e.count[1].split(" ").map(function(t){return parseInt(t,10)});else{e.count=[];for(var i=0,o=e.fields.length;i<o;i++)e.count.push(1)}e.offset={};var a=0;for(i=0,o=e.fields.length;i<o;i++)"ascii"===e.data?e.offset[e.fields[i]]=i:(e.offset[e.fields[i]]=a,a+=e.size[i]);return e.rowSize=a,e}(r),i=[],o=[],a=[];if("ascii"===n.data)for(var s=n.offset,l=r.substr(n.headerLen).split("\n"),c=0,u=l.length;c<u;c++){var h=l[c].split(" ");if(void 0!==s.x&&(i.push(parseFloat(h[s.x])),i.push(parseFloat(h[s.y])),i.push(parseFloat(h[s.z]))),void 0!==s.rgb){var d=new Float32Array([parseFloat(h[s.rgb])]),p=new DataView(d.buffer,0);a.push(p.getUint8(0)/255),a.push(p.getUint8(1)/255),a.push(p.getUint8(2)/255)}void 0!==s.normal_x&&(o.push(parseFloat(h[s.normal_x])),o.push(parseFloat(h[s.normal_y])),o.push(parseFloat(h[s.normal_z])))}if("binary_compressed"!==n.data){if("binary"===n.data){p=new DataView(t,n.headerLen),s=n.offset,c=0;for(var f=0;c<n.points;c++,f+=n.rowSize)void 0!==s.x&&(i.push(p.getFloat32(f+s.x,this.littleEndian)),i.push(p.getFloat32(f+s.y,this.littleEndian)),i.push(p.getFloat32(f+s.z,this.littleEndian))),void 0!==s.rgb&&(a.push(p.getUint8(f+s.rgb+0)/255),a.push(p.getUint8(f+s.rgb+1)/255),a.push(p.getUint8(f+s.rgb+2)/255)),void 0!==s.normal_x&&(o.push(p.getFloat32(f+s.normal_x,this.littleEndian)),o.push(p.getFloat32(f+s.normal_y,this.littleEndian)),o.push(p.getFloat32(f+s.normal_z,this.littleEndian)))}var m=new Yu;i.length>0&&m.addAttribute("position",new Gu(i,3)),o.length>0&&m.addAttribute("normal",new Gu(o,3)),a.length>0&&m.addAttribute("color",new Gu(a,3)),m.computeBoundingSphere();var v=new jd({size:.005});a.length>0?v.vertexColors=!0:v.color.setHex(16777215*Math.random());var g=new mf(m,v),y=e.split("").reverse().join("");return y=(y=/([^\/]*)/.exec(y))[1].split("").reverse().join(""),g.name=y,g}console.error("PCDLoader: binary_compressed files are not supported")}};var mv=function(t){this.manager=void 0!==t?t:Pd};mv.prototype={constructor:mv,load:function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}function n(t,e){var r=parseInt(p[f].substr(t,e));if(r){var n=function(t,e){return"s"+Math.min(t,e)+"e"+Math.max(t,e)}(v,r);void 0===d[n]&&(h.push([v-1,r-1,1]),d[n]=h.length-1)}}for(var i,o,a,s,l,c={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},u=[],h=[],d={},p=t.split("\n"),f=0,m=p.length;f<m;f++)if("ATOM"===p[f].substr(0,4)||"HETATM"===p[f].substr(0,6))i=parseFloat(p[f].substr(30,7)),o=parseFloat(p[f].substr(38,7)),a=parseFloat(p[f].substr(46,7)),s=parseInt(p[f].substr(6,5))-1,""===(l=e(p[f].substr(76,2)).toLowerCase())&&(l=e(p[f].substr(12,2)).toLowerCase()),u[s]=[i,o,a,c[l],r(l)];else if("CONECT"===p[f].substr(0,6)){var v=parseInt(p[f].substr(6,5));n(11,5),n(16,5),n(21,5),n(26,5)}return function(){var t,e,r={geometryAtoms:new Yu,geometryBonds:new Yu,json:{atoms:u,bonds:h}},n=r.geometryAtoms,i=r.geometryBonds,o=[],a=[],s=[];for(t=0,e=u.length;t<e;t++){var l=u[t];o.push(l[0],l[1],l[2]),a.push(l[3][0]/255,l[3][1]/255,l[3][2]/255)}for(t=0,e=h.length;t<e;t++){var c=h[t],d=c[0],p=c[1];s.push(o[3*d+0]),s.push(o[3*d+1]),s.push(o[3*d+2]),s.push(o[3*p+0]),s.push(o[3*p+1]),s.push(o[3*p+2])}return n.addAttribute("position",new Gu(o,3)),n.addAttribute("color",new Gu(a,3)),i.addAttribute("position",new Gu(s,3)),r}()}};var vv=function(t){this.manager=void 0!==t?t:Pd};vv.prototype={constructor:vv,load:function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){function e(t){var e={};for(var r in t){var n,i=t[r],o=i.type,a=i.components;switch(o){case"float32":n=new Gu(i.data,a);break;case"uint8":n=new Uu(i.data,a);break;case"uint16":n=new ju(i.data,a);break;default:console.log('PlayCanvasLoader: Array type "%s" not yet supported.',o)}e[r]=n}t._attributes=e}function r(t){var e=new Yu;e.setIndex(t.indices);var r=o.vertices[t.vertices]._attributes;for(var n in r){var i=r[n];"texCoord0"===n&&(n="uv"),e.addAttribute(n,i)}t._geometry=e}function n(t){var e=o.nodes[t.node],r=o.meshes[t.mesh];void 0===e._geometries&&(e._geometries=[]),e._geometries.push(r._geometry)}function i(t){var e=new Nf,r=t._geometries;if(void 0!==r)for(var n=new Fd,i=0,o=r.length;i<o;i++)e.add(new zh(r[i],n));for(i=0,o=t.rotation.length;i<o;i++)t.rotation[i]*=Math.PI/180;e.name=t.name,e.position.fromArray(t.position),e.quaternion.setFromEuler((new wu).fromArray(t.rotation)),e.scale.fromArray(t.scale),t._object=e}for(var o=t.model,a=0,s=o.vertices.length;a<s;a++)e(o.vertices[a]);for(a=0,s=o.meshes.length;a<s;a++)r(o.meshes[a]);for(a=0,s=o.meshInstances.length;a<s;a++)n(o.meshInstances[a]);for(a=0,s=o.nodes.length;a<s;a++)i(o.nodes[a]);for(a=0,s=o.parents.length;a<s;a++){var l=o.parents[a];-1!==l&&o.nodes[l]._object.add(o.nodes[a]._object)}return o.nodes[0]._object}};var gv=function(t){this.manager=void 0!==t?t:Pd,this.propertyNameMapping={}};gv.prototype={constructor:gv,load:function(t,e,r,n){var i=this,o=new Nd(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},setPropertyNameMapping:function(t){this.propertyNameMapping=t},parse:function(t){function e(t){var e="",r=0,n=/ply([\s\S]*)end_header\s/.exec(t);null!==n&&(e=n[1],r=n[0].length);var i,o,a,s={comments:[],elements:[],headerLength:r},l=e.split("\n");function c(t,e){var r={type:t[0]};return"list"===r.type?(r.name=t[3],r.countType=t[1],r.itemType=t[2]):r.name=t[1],r.name in e&&(r.name=e[r.name]),r}for(var h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim()))switch(o=(a=d.split(/\s+/)).shift(),d=a.join(" "),o){case"format":s.format=a[0],s.version=a[1];break;case"comment":s.comments.push(d);break;case"element":void 0!==i&&s.elements.push(i),(i={}).name=a[0],i.count=parseInt(a[1]),i.properties=[];break;case"property":i.properties.push(c(a,u.propertyNameMapping));break;default:console.log("unhandled",o,a)}}return void 0!==i&&s.elements.push(i),s}function r(t,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(t);case"float":case"double":case"float32":case"float64":return parseFloat(t)}}function n(t,e){for(var n=e.split(/\s+/),i={},o=0;o<t.length;o++)if("list"===t[o].type){for(var a=[],s=r(n.shift(),t[o].countType),l=0;l<s;l++)a.push(r(n.shift(),t[o].itemType));i[t[o].name]=a}else i[t[o].name]=r(n.shift(),t[o].type);return i}function i(t,e){var r,i={indices:[],vertices:[],normals:[],uvs:[],colors:[]},s="";null!==(r=/end_header\s([\s\S]*)$/.exec(t))&&(s=r[1]);for(var l=s.split("\n"),c=0,u=0,h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim())){u>=e.elements[c].count&&(c++,u=0);var p=n(e.elements[c].properties,d);a(i,e.elements[c].name,p),u++}}return o(i)}function o(t){var e=new Yu;return t.indices.length>0&&e.setIndex(t.indices),e.addAttribute("position",new Gu(t.vertices,3)),t.normals.length>0&&e.addAttribute("normal",new Gu(t.normals,3)),t.uvs.length>0&&e.addAttribute("uv",new Gu(t.uvs,2)),t.colors.length>0&&e.addAttribute("color",new Gu(t.colors,3)),e.computeBoundingSphere(),e}function a(t,e,r){if("vertex"===e)t.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&t.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&t.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&t.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===e){var n=r.vertex_indices||r.vertex_index;3===n.length?t.indices.push(n[0],n[1],n[2]):4===n.length&&(t.indices.push(n[0],n[1],n[3]),t.indices.push(n[1],n[2],n[3]))}}function s(t,e,r,n){switch(r){case"int8":case"char":return[t.getInt8(e),1];case"uint8":case"uchar":return[t.getUint8(e),1];case"int16":case"short":return[t.getInt16(e,n),2];case"uint16":case"ushort":return[t.getUint16(e,n),2];case"int32":case"int":return[t.getInt32(e,n),4];case"uint32":case"uint":return[t.getUint32(e,n),4];case"float32":case"float":return[t.getFloat32(e,n),4];case"float64":case"double":return[t.getFloat64(e,n),8]}}function l(t,e,r,n){for(var i,o={},a=0,l=0;l<r.length;l++)if("list"===r[l].type){var c=[],u=(i=s(t,e+a,r[l].countType,n))[0];a+=i[1];for(var h=0;h<u;h++)i=s(t,e+a,r[l].itemType,n),c.push(i[0]),a+=i[1];o[r[l].name]=c}else i=s(t,e+a,r[l].type,n),o[r[l].name]=i[0],a+=i[1];return[o,a]}var c,u=this;if(t instanceof ArrayBuffer){var h=qd.decodeText(new Uint8Array(t)),d=e(h);c="ascii"===d.format?i(h,d):function(t,e){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],colors:[]},i="binary_little_endian"===e.format,s=new DataView(t,e.headerLength),c=0,u=0;u<e.elements.length;u++)for(var h=0;h<e.elements[u].count;h++)c+=(r=l(s,c,e.elements[u].properties,i))[1],a(n,e.elements[u].name,r[0]);return o(n)}(t,d)}else c=i(t,e(t));return c}};var yv=null;function xv(){if(null===yv){var t=new ArrayBuffer(2),e=new Uint8Array(t),r=new Uint16Array(t);e[0]=170,e[1]=187,yv=43707===r[0]}return yv}var bv=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],wv={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function _v(t,e,r,n,i){var o,a=e.BYTES_PER_ELEMENT;if(i===xv()||1===a)o=new e(t,r,n);else{var s=new DataView(t,r,n*a),l=wv[e.name],c=!i,u=0;for(o=new e(n);u<n;u++)o[u]=s[l](u*a,c)}return o}var Sv=function(t){this.manager=void 0!==t?t:Pd};Sv.prototype={constructor:Sv,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),t=t.replace(/\*/g,xv()?"be":"le"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){console.time("PRWMLoader");var e,r,n=function(t){var e=new Uint8Array(t),r=e[0],n=e[1],i=!!(n>>7&1),o=n>>6&1,a=1==(n>>5&1),s=31&n,l=0,c=0;if(a?(l=(e[2]<<16)+(e[3]<<8)+e[4],c=(e[5]<<16)+(e[6]<<8)+e[7]):(l=e[2]+(e[3]<<8)+(e[4]<<16),c=e[5]+(e[6]<<8)+(e[7]<<16)),0===r)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==r)throw new Error("PRWM decoder: Unsupported format version: "+r);if(!i){if(0!==o)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==c)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var u,h,d,p,f,m,v,g,y=8,x={};for(g=0;g<s;g++){for(u="";y<e.length&&(h=e[y],y++,0!==h);)u+=String.fromCharCode(h);d=(n=e[y])>>7&1,p=1+(n>>4&3),y++,m=_v(t,f=bv[15&n],y=4*Math.ceil(y/4),p*l,a),y+=f.BYTES_PER_ELEMENT*p*l,x[u]={type:d,cardinality:p,values:m}}return y=4*Math.ceil(y/4),v=null,i&&(v=_v(t,1===o?Uint32Array:Uint16Array,y,c,a)),{version:r,attributes:x,indices:v}}(t),i=Object.keys(n.attributes),o=new Yu;for(r=0;r<i.length;r++)o.addAttribute(i[r],new Du((e=n.attributes[i[r]]).values,e.cardinality,e.normalized));return null!==n.indices&&o.setIndex(new Du(n.indices,1)),console.timeEnd("PRWMLoader"),o}},Sv.isBigEndianPlatform=function(){return xv()};var Tv=function(t){this.manager=void 0!==t?t:Pd,this._parser=Tv.parse};Tv.prototype=Object.create(em.prototype),Tv.prototype.constructor=Tv,Tv.parse=function(t,e){var r=new Uint32Array(t,0,13),n={buffer:t,header:r,loadMipmaps:e};return 55727696===r[0]?Tv._parseV3(n):559044176===r[11]?Tv._parseV2(n):void console.error("PVRLoader: Unknown PVR format.")},Tv._parseV3=function(t){var e,r,n=t.header,i=n[12],o=n[2],a=n[6],s=n[7],l=n[10],c=n[11];switch(o){case 0:e=2,r=35841;break;case 1:e=2,r=35843;break;case 2:e=4,r=35840;break;case 3:e=4,r=35842;break;default:console.error("PVRLoader: Unsupported PVR format:",o)}return t.dataPtr=52+i,t.bpp=e,t.format=r,t.width=s,t.height=a,t.numSurfaces=l,t.numMipmaps=c,t.isCubemap=6===l,Tv._extract(t)},Tv._parseV2=function(t){var e,r,n=t.header,i=n[0],o=n[1],a=n[2],s=n[3],l=n[12],c=255&n[4],u=n[10]>0;return 25===c?(r=u?35842:35840,e=4):24===c?(r=u?35843:35841,e=2):console.error("PVRLoader: Unknown PVR format:",c),t.dataPtr=i,t.bpp=e,t.format=r,t.width=a,t.height=o,t.numSurfaces=l,t.numMipmaps=s+1,t.isCubemap=6===l,Tv._extract(t)},Tv._extract=function(t){var e,r={mipmaps:[],width:t.width,height:t.height,format:t.format,mipmapCount:t.numMipmaps,isCubemap:t.isCubemap},n=t.buffer,i=t.dataPtr,o=t.bpp,a=t.numSurfaces,s=0,l=0,c=0,u=0,h=0;2===o?(l=8,c=4):(l=4,c=4),e=l*c*o/8,r.mipmaps.length=t.numMipmaps*a;for(var d=0;d<t.numMipmaps;){var p=t.width>>d,f=t.height>>d;h=f/c,(u=p/l)<2&&(u=2),h<2&&(h=2),s=u*h*e;for(var m=0;m<a;m++){var v=new Uint8Array(n,i,s);r.mipmaps[m*t.numMipmaps+d]={data:v,width:p,height:f},i+=s}d++}return r};var Mv=function(t){this.manager=void 0!==t?t:Pd};Mv.prototype={constructor:Mv,load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){try{e(i.parse(t))}catch(t){n&&n(t)}},r,n)},parse:function(t){var e=function(t){if("string"==typeof t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=255&t.charCodeAt(r);return e.buffer||e}return t}(t);return function(t){var r;if(84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(n[i]!=r.getUint8(i,!1))return!0;return!1}()?function(t){for(var r,n,i,o,a,s,l,c,u=new DataView(e),h=u.getUint32(80,!0),d=!1,p=0;p<70;p++)1129270351==u.getUint32(p,!1)&&82==u.getUint8(p+4)&&61==u.getUint8(p+5)&&(d=!0,o=[],a=u.getUint8(p+6)/255,s=u.getUint8(p+7)/255,l=u.getUint8(p+8)/255,c=u.getUint8(p+9)/255);for(var f=new Yu,m=[],v=[],g=0;g<h;g++){var y=84+50*g,x=u.getFloat32(y,!0),b=u.getFloat32(y+4,!0),w=u.getFloat32(y+8,!0);if(d){var _=u.getUint16(y+48,!0);0==(32768&_)?(r=(31&_)/31,n=(_>>5&31)/31,i=(_>>10&31)/31):(r=a,n=s,i=l)}for(var S=1;S<=3;S++){var T=y+12*S;m.push(u.getFloat32(T,!0)),m.push(u.getFloat32(T+4,!0)),m.push(u.getFloat32(T+8,!0)),v.push(x,b,w),d&&o.push(r,n,i)}}return f.addAttribute("position",new Du(new Float32Array(m),3)),f.addAttribute("normal",new Du(new Float32Array(v),3)),d&&(f.addAttribute("color",new Du(new Float32Array(o),3)),f.hasColors=!0,f.alpha=c),f}():function(t){for(var e,r=new Yu,n=/facet([\s\S]*?)endfacet/g,i=0,o=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+o+o+o,"g"),s=new RegExp("normal"+o+o+o,"g"),l=[],c=[],u=new yu;null!==(e=n.exec(t));){for(var h=0,d=0,p=e[0];null!==(e=s.exec(p));)u.x=parseFloat(e[1]),u.y=parseFloat(e[2]),u.z=parseFloat(e[3]),d++;for(;null!==(e=a.exec(p));)l.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),c.push(u.x,u.y,u.z),h++;1!==d&&console.error("STLLoader: Something isn't right with the normal of face number "+i),3!==h&&console.error("STLLoader: Something isn't right with the vertices of face number "+i),i++}return r.addAttribute("position",new Gu(l,3)),r.addAttribute("normal",new Gu(c,3)),r}(function(t){return"string"!=typeof t?qd.decodeText(new Uint8Array(t)):t}(t))}};var Av=function(t){this.manager=void 0!==t?t:Pd};Av.prototype={constructor:Av,load:function(t,e,r,n){var i=new DOMParser;new Nd(this.manager).load(t,function(t){var r=i.parseFromString(t,"image/svg+xml");e(r.documentElement)},r,n)}};var Ev=function(t){this.manager=void 0!==t?t:Pd,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]};Ev.prototype={constructor:Ev,load:function(t,e,r,n){var i=this,o=void 0!==this.path?this.path:qd.extractUrlBase(t),a=new Nd(this.manager);a.setResponseType("arraybuffer"),a.load(t,function(t){e(i.parse(t,o))},r,n)},parse:function(t,e){this.group=new Nf,this.position=0,this.materials=[],this.meshes=[],this.readFile(t,e);for(var r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group},readFile:function(t,e){var r=new DataView(t),n=this.readChunk(r);if(n.id===Pv||n.id===Ov||n.id===Cv)for(var i=this.nextChunk(r,n);0!==i;){if(i===Nv){var o=this.readDWord(r);this.debugMessage("3DS file version: "+o)}else i===Fv?(this.resetPosition(r),this.readMeshData(r,e)):this.debugMessage("Unknown main chunk: "+i.toString(16));i=this.nextChunk(r,n)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(t,e){for(var r=this.readChunk(t),n=this.nextChunk(t,r);0!==n;){if(n===Uv){var i=+this.readDWord(t);this.debugMessage("Mesh Version: "+i)}else if(n===kv){var o=this.readFloat(t);this.debugMessage("Master scale: "+o),this.group.scale.set(o,o,o)}else n===ig?(this.debugMessage("Named Object"),this.resetPosition(t),this.readNamedObject(t)):n===Bv?(this.debugMessage("Material"),this.resetPosition(t),this.readMaterialEntry(t,e)):this.debugMessage("Unknown MDATA chunk: "+n.toString(16));n=this.nextChunk(t,r)}},readNamedObject:function(t){var e=this.readChunk(t),r=this.readString(t,64);e.cur=this.position;for(var n=this.nextChunk(t,e);0!==n;){if(n===og){this.resetPosition(t);var i=this.readMesh(t);i.name=r,this.meshes.push(i)}else this.debugMessage("Unknown named object chunk: "+n.toString(16));n=this.nextChunk(t,e)}this.endChunk(e)},readMaterialEntry:function(t,e){for(var r=this.readChunk(t),n=this.nextChunk(t,r),i=new Fd;0!==n;){if(n===jv)i.name=this.readString(t,64),this.debugMessage("   Name: "+i.name);else if(n===Yv)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(n===qv){var o=this.readByte(t);i.wireframeLinewidth=o,this.debugMessage("   Wireframe Thickness: "+o)}else if(n===Wv)i.side=Ku,this.debugMessage("   DoubleSided");else if(n===Xv)this.debugMessage("   Additive Blending"),i.blending=2;else if(n===Vv)this.debugMessage("   Diffuse Color"),i.color=this.readColor(t);else if(n===Gv)this.debugMessage("   Specular Color"),i.specular=this.readColor(t);else if(n===zv)this.debugMessage("   Ambient color"),i.color=this.readColor(t);else if(n===Hv){var a=this.readWord(t);i.shininess=a,this.debugMessage("   Shininess : "+a)}else n===Jv?(this.debugMessage("   ColorMap"),this.resetPosition(t),i.map=this.readMap(t,e)):n===Qv?(this.debugMessage("   BumpMap"),this.resetPosition(t),i.bumpMap=this.readMap(t,e)):n===Zv?(this.debugMessage("   OpacityMap"),this.resetPosition(t),i.alphaMap=this.readMap(t,e)):n===Kv?(this.debugMessage("   SpecularMap"),this.resetPosition(t),i.specularMap=this.readMap(t,e)):this.debugMessage("   Unknown material chunk: "+n.toString(16));n=this.nextChunk(t,r)}this.endChunk(r),this.materials[i.name]=i},readMesh:function(t){var e=this.readChunk(t),r=this.nextChunk(t,e),n=null,i=[],o=new zh(n=new Iu,new Fd);for(o.name="mesh";0!==r;){if(r===ag){var a=this.readWord(t);this.debugMessage("   Vertex: "+a);for(var s=0;s<a;s++)n.vertices.push(new yu(this.readFloat(t),this.readFloat(t),this.readFloat(t)))}else if(r===sg)this.resetPosition(t),this.readFaceArray(t,o);else if(r===cg){var l=this.readWord(t);for(this.debugMessage("   UV: "+l),i=[],s=0;s<l;s++)i.push(new Nu(this.readFloat(t),this.readFloat(t)))}else if(r===ug){this.debugMessage("   Tranformation Matrix (TODO)");var c=[];for(s=0;s<12;s++)c[s]=this.readFloat(t);var u=new gu;u.elements[0]=c[0],u.elements[1]=c[6],u.elements[2]=c[3],u.elements[3]=c[9],u.elements[4]=c[2],u.elements[5]=c[8],u.elements[6]=c[5],u.elements[7]=c[11],u.elements[8]=c[1],u.elements[9]=c[7],u.elements[10]=c[4],u.elements[11]=c[10],u.elements[12]=0,u.elements[13]=0,u.elements[14]=0,u.elements[15]=1,u.transpose();var h=new gu;h.getInverse(u,!0),n.applyMatrix(h),u.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(t,e)}if(this.endChunk(e),i.length>0){var d=[];for(s=0;s<n.faces.length;s++)d.push([i[n.faces[s].a],i[n.faces[s].b],i[n.faces[s].c]]);n.faceVertexUvs[0]=d}return n.computeVertexNormals(),o},readFaceArray:function(t,e){var r=this.readChunk(t),n=this.readWord(t);this.debugMessage("   Faces: "+n);for(var i=0;i<n;++i)e.geometry.faces.push(new Cu(this.readWord(t),this.readWord(t),this.readWord(t))),this.readWord(t);for(;this.position<r.end;){if((r=this.readChunk(t)).id===lg){this.debugMessage("      Material Group"),this.resetPosition(t);var o=this.readMaterialGroup(t),a=this.materials[o.name];void 0!==a&&(e.material=a,""===a.name&&(a.name=e.name))}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}this.endChunk(r)},readMap:function(t,e){var r=this.readChunk(t),n=this.nextChunk(t,r),i={},o=new Xd(this.manager);for(o.setPath(e);0!==n;){if(n===$v){var a=this.readString(t,128);i=o.load(a),this.debugMessage("      File: "+e+a)}else n===rg?(i.offset.x=this.readFloat(t),this.debugMessage("      OffsetX: "+i.offset.x)):n===ng?(i.offset.y=this.readFloat(t),this.debugMessage("      OffsetY: "+i.offset.y)):n===tg?(i.repeat.x=this.readFloat(t),this.debugMessage("      RepeatX: "+i.repeat.x)):n===eg?(i.repeat.y=this.readFloat(t),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.toString(16));n=this.nextChunk(t,r)}return this.endChunk(r),i},readMaterialGroup:function(t){this.readChunk(t);var e=this.readString(t,64),r=this.readWord(t);this.debugMessage("         Name: "+e),this.debugMessage("         Faces: "+r);for(var n=[],i=0;i<r;++i)n.push(this.readWord(t));return{name:e,index:n}},readColor:function(t){var e=this.readChunk(t),r=new Eu;if(e.id===Iv||e.id===Rv){var n=this.readByte(t),i=this.readByte(t),o=this.readByte(t);r.setRGB(n/255,i/255,o/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else e.id===Lv||e.id===Dv?(n=this.readFloat(t),i=this.readFloat(t),o=this.readFloat(t),r.setRGB(n,i,o),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)):this.debugMessage("      Unknown color chunk: "+e.toString(16));return this.endChunk(e),r},readChunk:function(t){var e={};return e.cur=this.position,e.id=this.readWord(t),e.size=this.readDWord(t),e.end=e.cur+e.size,e.cur+=6,e},endChunk:function(t){this.position=t.end},nextChunk:function(t,e){if(e.cur>=e.end)return 0;this.position=e.cur;try{var r=this.readChunk(t);return e.cur+=r.size,r.id}catch(t){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(t){var e=t.getUint8(this.position,!0);return this.position+=1,e},readFloat:function(t){try{var e=t.getFloat32(this.position,!0);return this.position+=4,e}catch(e){this.debugMessage(e+" "+this.position+" "+t.byteLength)}},readInt:function(t){var e=t.getInt32(this.position,!0);return this.position+=4,e},readShort:function(t){var e=t.getInt16(this.position,!0);return this.position+=2,e},readDWord:function(t){var e=t.getUint32(this.position,!0);return this.position+=4,e},readWord:function(t){var e=t.getUint16(this.position,!0);return this.position+=2,e},readString:function(t,e){for(var r="",n=0;n<e;n++){var i=this.readByte(t);if(!i)break;r+=String.fromCharCode(i)}return r},setPath:function(t){return this.path=t,this},debugMessage:function(t){this.debug&&console.log(t)}};var Cv=19789,Pv=15786,Ov=49725,Nv=2,Lv=16,Iv=17,Rv=18,Dv=19,Fv=15677,Uv=15678,kv=256,Bv=45055,jv=40960,zv=40976,Vv=40992,Gv=41008,Hv=41024,Wv=41089,Xv=41091,Yv=41093,qv=41095,Jv=41472,Zv=41488,Qv=41520,Kv=41476,$v=41728,tg=41812,eg=41814,rg=41816,ng=41818,ig=16384,og=16640,ag=16656,sg=16672,lg=16688,cg=16704,ug=16736,hg=function(t){this.manager=void 0!==t?t:Pd,this.reversed=!1};hg.prototype={constructor:hg,load:function(t,e,r,n){var i=this,o=new Nd(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t){var e,r=[];t.forEach(function(t){"m"===t.type.toLowerCase()?r.push(e=[t]):"z"!==t.type.toLowerCase()&&e.push(t)});var n=[];return r.forEach(function(t){n.push(i={type:"m",x:t[t.length-1].x,y:t[t.length-1].y});for(var e=t.length-1;e>0;e--){var r=t[e],i={type:r.type};void 0!==r.x2&&void 0!==r.y2?(i.x1=r.x2,i.y1=r.y2,i.x2=r.x1,i.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(i.x1=r.x1,i.y1=r.y1),i.x=t[e-1].x,i.y=t[e-1].y,n.push(i)}}),n}return"undefined"==typeof opentype?(console.warn("TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(t,r){for(var n=Math.round,i={},o=1e5/(72*(t.unitsPerEm||2048)),a=0;a<t.glyphs.length;a++){var s=t.glyphs.glyphs[a];if(void 0!==s.unicode){var l={ha:n(s.advanceWidth*o),x_min:n(s.xMin*o),x_max:n(s.xMax*o),o:""};r&&(s.path.commands=e(s.path.commands)),s.path.commands.forEach(function(t,e){"c"===t.type.toLowerCase()&&(t.type="b"),l.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(l.o+=n(t.x*o)+" "+n(t.y*o)+" "),void 0!==t.x1&&void 0!==t.y1&&(l.o+=n(t.x1*o)+" "+n(t.y1*o)+" "),void 0!==t.x2&&void 0!==t.y2&&(l.o+=n(t.x2*o)+" "+n(t.y2*o)+" ")}),i[String.fromCharCode(s.unicode)]=l}}return{glyphs:i,familyName:t.familyName,ascender:n(t.ascender*o),descender:n(t.descender*o),underlinePosition:t.tables.post.underlinePosition,underlineThickness:t.tables.post.underlineThickness,boundingBox:{xMin:t.tables.head.xMin,xMax:t.tables.head.xMax,yMin:t.tables.head.yMin,yMax:t.tables.head.yMax},resolution:1e3,original_font_information:t.tables.name}}(opentype.parse(t),this.reversed)}};var dg=function(){};dg.prototype.load=function(t,e,r){this.downloadModelJson(t,e,r)},(dg.BufferGeometryCreator=function(){}).prototype.create=function(t,e){var r,n,i=e.length/3,o=new Yu,a=new Float32Array(3*i*3),s=new Float32Array(3*i*3),l=new Float32Array(3*i*2),c=t.length;for(n=0,r=0;r<c;r+=8)a[n++]=t[r],a[n++]=t[r+1],a[n++]=t[r+2];for(n=0,r=3;r<c;r+=8)l[n++]=t[r],l[n++]=t[r+1];for(n=0,r=5;r<c;r+=8)s[n++]=t[r],s[n++]=t[r+1],s[n++]=t[r+2];return o.setIndex(new Du(e,1)),o.addAttribute("position",new Du(a,3)),o.addAttribute("normal",new Du(s,3)),o.addAttribute("uv",new Du(l,2)),o.computeBoundingSphere(),o};var pg={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};function fg(t,e,r){(new Nd).load(t,e,r)}dg.prototype.decompressAttribsInner_=function(t,e,r,n,i,o,a,s){for(var l=0,c=e;c<r;c++){var u=t.charCodeAt(c);n[i]=s*((l+=u>>1^-(1&u))+a),i+=o}},dg.prototype.decompressIndices_=function(t,e,r,n,i){for(var o=0,a=0;a<r;a++){var s=t.charCodeAt(e++);n[i++]=o-s,0===s&&o++}},dg.prototype.decompressAABBs_=function(t,e,r,n,i){for(var o=6*r,a=e+o,s=0,l=new Float32Array(o),c=e;c<a;c+=6){var u=t.charCodeAt(c+0)+n[0],h=t.charCodeAt(c+1)+n[1],d=t.charCodeAt(c+2)+n[2],p=t.charCodeAt(c+3)+1>>1,f=t.charCodeAt(c+4)+1>>1,m=t.charCodeAt(c+5)+1>>1;l[s++]=i[0]*(u+p),l[s++]=i[1]*(h+f),l[s++]=i[2]*(d+m),l[s++]=i[0]*p,l[s++]=i[1]*f,l[s++]=i[2]*m}return l},dg.prototype.decompressMesh=function(t,e,r,n,i,o){for(var a=r.decodeScales.length,s=r.decodeOffsets,l=r.decodeScales,c=e.attribRange[1],u=e.attribRange[0],h=new Float32Array(a*c),d=0;d<a;d++){var p=u+c,f=l[d];f&&this.decompressAttribsInner_(t,u,p,h,d,a,s[d],f),u=p}var m=3*e.indexRange[1],v=new Uint16Array(m);this.decompressIndices_(t,u,m,v,0);var g=void 0,y=e.bboxes;y&&(g=this.decompressAABBs_(t,y,e.names.length,s,l)),o(n,i,h,v,g,e)},dg.prototype.copyAttrib=function(t,e,r,n){for(var i=0;i<t;i++)r[i]=e[t*n+i]},dg.prototype.decodeAttrib2=function(t,e,r,n,i,o,a,s,l,c){for(var u=0;u<5;u++){var h=t.charCodeAt(i+o*u+c);l[u]+=h>>1^-(1&h),s[e*c+u]=l[u],a[e*c+u]=n[u]*(l[u]+r[u])}},dg.prototype.accumulateNormal=function(t,e,r,n,i){var o=n[8*t],a=n[8*t+1],s=n[8*t+2],l=n[8*e],c=n[8*e+1],u=n[8*e+2],h=n[8*r],d=n[8*r+1],p=n[8*r+2];c-=a,d-=a,a=(u-=s)*(h-=o)-(l-=o)*(p-=s),s=l*d-c*h,i[3*t]+=o=c*p-u*d,i[3*t+1]+=a,i[3*t+2]+=s,i[3*e]+=o,i[3*e+1]+=a,i[3*e+2]+=s,i[3*r]+=o,i[3*r+1]+=a,i[3*r+2]+=s},dg.prototype.decompressMesh2=function(t,e,r,n,i,o){for(var a=r.decodeScales.length,s=r.decodeOffsets,l=r.decodeScales,c=e.attribRange[0],u=e.attribRange[1],h=e.codeRange[0],d=3*e.codeRange[2],p=new Uint16Array(d),f=new Int32Array(3*u),m=new Uint16Array(a),v=new Uint16Array(a*u),g=new Float32Array(a*u),y=0,x=0,b=0;b<d;b+=3){var w=t.charCodeAt(h++),_=Math.min(b,96);if(w<_){var S,T,M,A=w%3,E=b-(w-A);switch(A){case 0:S=p[E+2],T=p[E+1],M=p[E+0];break;case 1:S=p[E+0],T=p[E+2],M=p[E+1];break;case 2:S=p[E+1],T=p[E+0],M=p[E+2]}p[x++]=S,p[x++]=T;var C=y-(w=t.charCodeAt(h++));if(p[x++]=C,0===w){for(var P=0;P<5;P++){var O=t.charCodeAt(c+u*P+y),N=(O>>1^-(1&O))+v[a*S+P]+v[a*T+P]-v[a*M+P];m[P]=N,v[a*y+P]=N,g[a*y+P]=l[P]*(N+s[P])}y++}else this.copyAttrib(a,v,m,C);this.accumulateNormal(S,T,C,v,f)}else{var L=y-(w-_);p[x++]=L,w===_?this.decodeAttrib2(t,a,s,l,c,u,g,v,m,y++):this.copyAttrib(a,v,m,L);var I=y-(w=t.charCodeAt(h++));p[x++]=I,0===w?this.decodeAttrib2(t,a,s,l,c,u,g,v,m,y++):this.copyAttrib(a,v,m,I);var R=y-(w=t.charCodeAt(h++));if(p[x++]=R,0===w){for(P=0;P<5;P++)m[P]=(v[a*L+P]+v[a*I+P])/2;this.decodeAttrib2(t,a,s,l,c,u,g,v,m,y++)}else this.copyAttrib(a,v,m,R);this.accumulateNormal(L,I,R,v,f)}}for(b=0;b<u;b++){var D=f[3*b],F=f[3*b+1],U=f[3*b+2],k=511/Math.sqrt(D*D+F*F+U*U),B=t.charCodeAt(c+5*u+b),j=t.charCodeAt(c+6*u+b),z=t.charCodeAt(c+7*u+b);g[a*b+5]=k*D+(B>>1^-(1&B)),g[a*b+6]=k*F+(j>>1^-(1&j)),g[a*b+7]=k*U+(z>>1^-(1&z))}o(n,i,g,p,void 0,e)},dg.prototype.downloadMesh=function(t,e,r,n,i){var o=this,a=0;fg(t,function(t){!function(t){for(;a<r.length;){var s=r[a],l=s.indexRange;if(l){if(t.length<l[0]+3*l[1])break;o.decompressMesh(t,s,n,e,a,i)}else{var c=s.codeRange;if(t.length<c[0]+c[1])break;o.decompressMesh2(t,s,n,e,a,i)}++a}}(t)})},dg.prototype.downloadMeshes=function(t,e,r,n){for(var i in e)this.downloadMesh(t+i,i,e[i],r,n)},dg.prototype.createMeshCallback=function(t,e,r){var n=0,i=0,o={},a={},s={},l=e.urls;for(var c in l)o[c]=l[c].length,a[c]=0,i++,s[c]=new Mu;var u=new Mu,h=new ev.MaterialCreator(t,e.options);h.setMaterials(e.materials),h.preload();var d=new dg.BufferGeometryCreator;return function(t,e,l,c,p,f){var m=new zh(d.create(l,c),h.create(f.material));s[t].add(m),a[t]++,a[t]===o[t]&&(n++,u.add(s[t]),n===i&&r(u))}},dg.prototype.downloadModel=function(t,e,r,n){var i=this.createMeshCallback(e,r,n);this.downloadMeshes(t,r.urls,r.decodeParams,i)},dg.prototype.downloadModelJson=function(t,e,r){!function(t,e){fg(t,function(t){e(JSON.parse(t))},function(){})}(t,(function(n){n.decodeParams||(n.decodeParams=r&&r.decodeParams?r.decodeParams:pg),n.options=r;var i=t.substr(0,t.lastIndexOf("/")+1),o=i;r&&r.geometryBase&&"/"!==(i=r.geometryBase).charAt(i.length-1)&&(i+="/"),r&&r.materialBase&&"/"!==(o=r.materialBase).charAt(o.length-1)&&(o+="/"),this.downloadModel(i,o,n,e)}).bind(this))};var mg=function(t){this.manager=void 0!==t?t:Pd};function vg(t){Mu.call(this),this.material=t,this.render=function(){}}mg.prototype={constructor:mg,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this;new Nd(this.manager).load(t,function(t){e(i.parse(t))},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=this.texturePath||"",r=new Xd(this.manager);r.setCrossOrigin(this.crossOrigin);for(var n=new vd,i=t.split("\n"),o=i.length-1;o>-1;o--){var a=i[o];if(/{.*[{\[]/.test(a))(s=a.split("{").join("{\n").split("\n")).unshift(1),s.unshift(o),i.splice.apply(i,s);else if(/\].*}/.test(a)){var s;(s=a.split("]").join("]\n").split("\n")).unshift(1),s.unshift(o),i.splice.apply(i,s)}/}.*}/.test(a)&&((s=a.split("}").join("}\n").split("\n")).unshift(1),s.unshift(o),i.splice.apply(i,s)),/^\b[^\s]+\b$/.test(a.trim())?(i[o+1]=a+" "+i[o+1].trim(),i.splice(o,1)):a.indexOf("coord")>-1&&a.indexOf("[")<0&&a.indexOf("{")<0&&(i[o]+=" Coordinate {}")}var l=i.shift();return/V1.0/.exec(l)?console.warn("VRMLLoader: V1.0 not supported yet."):/V2.0/.exec(l)&&function(t,n){var i={},o=/(\b|\-|\+)([\d\.e]+)/,a=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,s=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g;function l(t,e,r,n,i){for(var o=!0===i?1:-1,a=[],s={},l={},c=0;c<r.length;c++){var u={x:o*(Math.cos(r[c])*e),y:o*(Math.sin(r[c])*e)};a.push(u)}for(var h=t.index,d=t.attributes.position,p=new Du(new Float32Array(3*t.attributes.position.count),3),f=new yu,m=new Eu,v=0;v<h.count;v++){var g=h.getX(v);f.fromBufferAttribute(d,g);for(var y=0;y<n.length;y++)if(0===y?(s.x=0,s.y=!0===i?e:-1*e):(s.x=a[y-1].x,s.y=a[y-1].y),void 0!==(l=a[y]))if(1==(!0===i?f.y<=s.y&&f.y>l.y:f.y>=s.y&&f.y<l.y)){var x=n[y],b=n[y+1],w=Math.abs(f.y-s.y)/(s.y-l.y);m.copy(x).lerp(b,w),p.setXYZ(g,m.r,m.g,m.b)}else{var _=n[!0===i?n.length-1:0];p.setXYZ(g,_.r,_.g,_.b)}}t.addAttribute("color",p)}var c=[];function u(t,e){for(var r,n,i,l=[],u={},h=/[^\s,\[\]]+/g;null!==(r=h.exec(e));)l.push(r[0]);switch(n=l[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=n,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=n,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=n,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":case"texCoordIndex":this.recordingFieldname=n,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(l.length>0)for(var d=0;d<l.length;d++)/(-?\d+)/.test(l[d])&&("-1"===l[d]?(c.length>0&&this.indexes.push(c),c=[]):c.push(parseInt(l[d])));/]/.exec(e)&&(c.length>0&&this.indexes.push(c),c=[],this.isRecordingFaces=!1,t[this.recordingFieldname]=this.indexes)}else if(this.isRecordingPoints){if("Coordinate"==t.nodeType)for(;null!==(l=s.exec(e));)i={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])},this.points.push(i);if("TextureCoordinate"==t.nodeType)for(;null!==(l=a.exec(e));)i={x:parseFloat(l[1]),y:parseFloat(l[2])},this.points.push(i);/]/.exec(e)&&(this.isRecordingPoints=!1,t.points=this.points)}else if(this.isRecordingAngles){if(l.length>0)for(d=0;d<l.length;d++)o.test(l[d])&&this.angles.push(parseFloat(l[d]));/]/.exec(e)&&(this.isRecordingAngles=!1,t[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(;null!==(l=s.exec(e));){var p={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])};this.colors.push(p)}/]/.exec(e)&&(this.isRecordingColors=!1,t[this.recordingFieldname]=this.colors)}else if("NULL"!==l[l.length-1]&&"children"!==n){switch(n){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!==l.length){console.warn("VRMLLoader: Invalid color format detected for %s.",n);break}u={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])};break;case"location":case"direction":case"translation":case"scale":case"size":if(4!==l.length){console.warn("VRMLLoader: Invalid vector format detected for %s.",n);break}u={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])};break;case"intensity":case"cutOffAngle":case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!==l.length){console.warn("VRMLLoader: Invalid single float value specification detected for %s.",n);break}u=parseFloat(l[1]);break;case"rotation":if(5!==l.length){console.warn("VRMLLoader: Invalid quaternion format detected for %s.",n);break}u={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3]),w:parseFloat(l[4])};break;case"on":case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!==l.length){console.warn("VRMLLoader: Invalid format detected for %s.",n);break}u="TRUE"===l[1]}t[n]=u}return u}!function t(o,a){var s;if("string"!=typeof o){s=a,o.string.indexOf("AmbientLight")>-1&&"PointLight"===o.nodeType&&(o.nodeType="AmbientLight");var c=void 0===o.on||o.on,u=void 0!==o.intensity?o.intensity:1,h=new Eu;if(o.color&&h.copy(o.color),"AmbientLight"===o.nodeType)(s=new Qf(h,u)).visible=c,a.add(s);else if("PointLight"===o.nodeType){var d=0;void 0!==o.radius&&o.radius<1e3&&(d=o.radius),(s=new Gf(h,u,d)).visible=c,a.add(s)}else if("SpotLight"===o.nodeType){u=1,d=0;var p=Math.PI/3;c=!0,void 0!==o.radius&&o.radius<1e3&&(d=o.radius),void 0!==o.cutOffAngle&&(p=o.cutOffAngle),(s=new Yf(h,u,d,p,0)).visible=c,a.add(s)}else if("Transform"===o.nodeType||"Group"===o.nodeType){if(s=new Mu,/DEF/.exec(o.string)&&(s.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[s.name]=s),void 0!==o.translation&&s.position.set((G=o.translation).x,G.y,G.z),void 0!==o.rotation){var f=o.rotation;s.quaternion.setFromAxisAngle(new yu(f.x,f.y,f.z),f.w)}void 0!==o.scale&&s.scale.set((B=o.scale).x,B.y,B.z),a.add(s)}else if("Shape"===o.nodeType)s=new zh,/DEF/.exec(o.string)&&(s.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[s.name]=s),a.add(s);else if("Background"===o.nodeType){var m=2e4,v=new Ju(m,20,20),g=new Dh({fog:!1,side:Qu});if(o.skyColor.length>1)l(v,m,o.skyAngle,o.skyColor,!0),g.vertexColors=eh;else{var y=o.skyColor[0];g.color.setRGB(y.r,y.b,y.g)}if(n.add(new zh(v,g)),void 0!==o.groundColor){var x=new Ju(m=12e3,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),b=new Dh({fog:!1,side:Qu,vertexColors:eh});l(x,m,o.groundAngle,o.groundColor,!1),n.add(new zh(x,b))}}else{if(/geometry/.exec(o.string)){if("Box"===o.nodeType)a.geometry=new Yh((B=o.size).x,B.y,B.z);else if("Cylinder"===o.nodeType)a.geometry=new Jh(o.radius,o.radius,o.height);else if("Cone"===o.nodeType)a.geometry=new Jh(o.topRadius,o.bottomRadius,o.height);else if("Sphere"===o.nodeType)a.geometry=new Ju(o.radius);else if("IndexedFaceSet"===o.nodeType){var w,_,S,T,M,A=new Yu,E=[],C=[];for(U=0,S=o.children.length;U<S;U++){if("TextureCoordinate"===(k=o.children[U]).nodeType&&k.points)for(T=0,M=k.points.length;T<M;T++)C.push((_=k.points[T]).x,_.y);if("Coordinate"===k.nodeType){if(k.points)for(T=0,M=k.points.length;T<M;T++)E.push((w=k.points[T]).x,w.y,w.z);if(k.string.indexOf("DEF")>-1){var P=/DEF\s+([^\s]+)/.exec(k.string)[1];i[P]=E.slice(0)}k.string.indexOf("USE")>-1&&(X=/USE\s+([^\s]+)/.exec(k.string)[1],E=i[X])}}var O=0;if(o.coordIndex){var N=[],L=[];for(w=new yu,_=new Nu,U=0,S=o.coordIndex.length;U<S;U++){var I=o.coordIndex[U];for(O=0;I.length>=3&&O<I.length-2;){void 0===o.ccw&&(o.ccw=!0);var R=I[0],D=I[O+(o.ccw?1:2)],F=I[O+(o.ccw?2:1)];w.fromArray(E,3*R),_.fromArray(C,2*R),N.push(w.x,w.y,w.z),L.push(_.x,_.y),w.fromArray(E,3*D),_.fromArray(C,2*D),N.push(w.x,w.y,w.z),L.push(_.x,_.y),w.fromArray(E,3*F),_.fromArray(C,2*F),N.push(w.x,w.y,w.z),L.push(_.x,_.y),O++}}E=N,C=L}else a.parent.remove(a);!1===o.solid&&(a.material.side=Ku),A.solid=o.solid,A.addAttribute("position",new Gu(E,3)),C.length>0&&A.addAttribute("uv",new Gu(C,2)),A.computeVertexNormals(),A.computeBoundingSphere(),/DEF/.exec(o.string)&&(A.name=/DEF ([^\s]+)/.exec(o.string)[1],i[A.name]=A),a.geometry=A}return}if(/appearance/.exec(o.string)){for(var U=0;U<o.children.length;U++){var k;if("Material"===(k=o.children[U]).nodeType){var B,j=new Fd;if(void 0!==k.diffuseColor){var z=k.diffuseColor;j.color.setRGB(z.r,z.g,z.b)}if(void 0!==k.emissiveColor){var V=k.emissiveColor;j.emissive.setRGB(V.r,V.g,V.b)}if(void 0!==k.specularColor&&j.specular.setRGB((B=k.specularColor).r,B.g,B.b),void 0!==k.transparency){var G=k.transparency;j.opacity=Math.abs(1-G),j.transparent=!0}/DEF/.exec(o.string)&&(j.name=/DEF ([^\s]+)/.exec(o.string)[1],i[j.name]=j),a.material=j}if("ImageTexture"===k.nodeType){var H=/"([^"]+)"/.exec(k.children[0]);H&&(a.material.name=H[1],a.material.map=r.load(e+H[1]))}}return}}U=0;for(var W=o.children.length;U<W;U++)t(o.children[U],s)}else if(/USE/.exec(o)){var X=/USE\s+?([^\s]+)/.exec(o)[1];void 0==i[X]?console.warn("VRMLLoader: %s is not defined.",X):/appearance/.exec(o)&&X?a.material=i[X].clone():/geometry/.exec(o)&&X?(a.geometry=i[X].clone(),void 0!==i[X].solid&&!1===i[X].solid&&(a.geometry.solid=!1,a.material.side=Ku)):X&&(s=i[X].clone(),a.add(s))}}(function(t){for(var e,r,n={string:"Scene",children:[]},i=n,o=0;o<t.length;o++){var a="",s=t[o];if(null===/^\s+?$/g.exec(s)&&""!==(s=s.trim())){if(/#/.exec(s)){var l=s.split("#");s=l[0],a=l[1]}if(e=/([^\s]*){1}(?:\s+)?{/.exec(s)){var c={nodeType:e[1],string:s,parent:i,children:[],comment:a};i.children.push(c),i=c,/}/.exec(s)&&(r=/{(.*)}/.exec(s)[1],c.children.push(r),u(i,r),i=i.parent)}else/}/.exec(s)?i=i.parent:""!==s&&(u(i,s),i.children.push(s))}}return n}(t),n)}(i,n),n}},Object.assign((function(t){this.manager=void 0!==t?t:Pd}).prototype,bu.prototype,{load:function(t,e,r,n){var i=this,o=new Nd(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t,e){var r=t.length,n=new Float32Array(r+e.length);return n.set(t),n.set(e,r),n}function r(t,e){var r=t.length,n=new Int32Array(r+e.length);return n.set(t),n.set(e,r),n}function n(t){for(var e="",r=new Uint8Array(t),n=0,i=r.length;i--;)e+=String.fromCharCode(r[n++]);return e}var i=qd.decodeText(new Uint8Array(t,0,250)).split("\n");return-1!==i[0].indexOf("xml")?function(t){function n(t){var e,r,n,i,o,a,s="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],c=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=u.length;for(e=0;e<h;e++)l[e]=u[e];for(e=0;e<h;++e)c[u.charCodeAt(e)]=e;if(c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63,(h=t.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a=new s(3*h/4-(o="="===t[h-2]?2:"="===t[h-1]?1:0)),n=o>0?h-4:h;var d=0;for(e=0,r=0;e<n;e+=4,r+=3)i=c[t.charCodeAt(e)]<<18|c[t.charCodeAt(e+1)]<<12|c[t.charCodeAt(e+2)]<<6|c[t.charCodeAt(e+3)],a[d++]=(16711680&i)>>16,a[d++]=(65280&i)>>8,a[d++]=255&i;return 2===o?(i=c[t.charCodeAt(e)]<<2|c[t.charCodeAt(e+1)]>>4,a[d++]=255&i):1===o&&(i=c[t.charCodeAt(e)]<<10|c[t.charCodeAt(e+1)]<<4|c[t.charCodeAt(e+2)]>>2,a[d++]=i>>8&255,a[d++]=255&i),a}function i(t,i){var o=0;if("UInt64"===a.attributes.header_type?o=8:"UInt32"===a.attributes.header_type&&(o=4),"binary"===t.attributes.format&&i){var s,l,c,u,h,d;if("Float32"===t.attributes.type)var p=new Float32Array;else"Int64"===t.attributes.type&&(p=new Int32Array);l=(s=n(t["#text"]))[0];for(var f=1;f<o-1;f++)l|=s[f]<<f*o;for(u=(l+3)*o,(h=[]).push(d=u+=u%3>0?3-u%3:0),c=3*o,f=0;f<l;f++){for(var m=s[f*o+c],v=1;v<o-1;v++)m|=s[f*o+c+v]<<8*v;h.push(d+=m)}for(f=0;f<h.length-1;f++)g=(g=new Zlib.Inflate(s.slice(h[f],h[f+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===t.attributes.type?p=e(p,g=new Float32Array(g)):"Int64"===t.attributes.type&&(p=r(p,g=new Int32Array(g)));delete t["#text"],"Float32"===t.attributes.type?"binary"===t.attributes.format&&(i||(p=p.filter(function(t,e){if(0!==e)return!0}))):"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(i||(p=p.filter(function(t,e){if(0!==e)return!0})),p=p.filter(function(t,e){if(e%2!=1)return!0}))}else{if("binary"!==t.attributes.format||i)if(t["#text"])var g=t["#text"].split(/\s+/).filter(function(t){if(""!==t)return t});else g=new Int32Array(0).buffer;else g=(g=n(t["#text"])).slice(o).buffer;delete t["#text"],"Float32"===t.attributes.type?p=new Float32Array(g):"Int32"===t.attributes.type?p=new Int32Array(g):"Int64"===t.attributes.type&&(p=new Int32Array(g),"binary"===t.attributes.format&&(p=p.filter(function(t,e){if(e%2!=1)return!0})))}return p}var o=null;if(window.DOMParser)try{o=(new DOMParser).parseFromString(t,"text/xml")}catch(t){o=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!o.loadXML())throw new Error(o.parseError.reason+o.parseError.srcText)}catch(t){o=null}}var a=function t(e){var r={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){r.attributes={};for(var n=0;n<e.attributes.length;n++){var i=e.attributes.item(n);r.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===e.nodeType&&(r=e.nodeValue.trim());if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var a,s=e.childNodes.item(o),l=s.nodeName;void 0===r[l]?""!==(a=t(s))&&(r[l]=a):(void 0===r[l].push&&(r[l]=[r[l]]),""!==(a=t(s))&&r[l].push(a))}return r}(o.documentElement),s=[],l=[],c=[];if(a.PolyData){for(var u=a.PolyData.Piece,h=a.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],p=0,f=d.length;p<f;){var m=u[d[p]];if(m&&m.DataArray){if("[object Array]"===Object.prototype.toString.call(m.DataArray))var v=m.DataArray;else v=[m.DataArray];for(var g=0,y=v.length;g<y;)"#text"in v[g]&&v[g]["#text"].length>0&&(v[g].text=i(v[g],h)),g++;switch(d[p]){case"PointData":var x=parseInt(u.attributes.NumberOfPoints),b=m.attributes.Normals;if(x>0)for(var w=0,_=v.length;w<_;w++)if(b===v[w].attributes.Name){var S=v[w].attributes.NumberOfComponents;(l=new Float32Array(x*S)).set(v[w].text,0)}break;case"Points":(x=parseInt(u.attributes.NumberOfPoints))>0&&(S=m.DataArray.attributes.NumberOfComponents,(s=new Float32Array(x*S)).set(m.DataArray.text,0));break;case"Strips":var T=parseInt(u.attributes.NumberOfStrips);if(T>0){var M=new Int32Array(m.DataArray[0].text.length),A=new Int32Array(m.DataArray[1].text.length);M.set(m.DataArray[0].text,0),A.set(m.DataArray[1].text,0);var E=T+M.length;c=new Uint32Array(3*E-9*T);var C=0;for(w=0,_=T;w<_;w++){for(var P=[],O=0,N=A[w],L=0;O<N-L;O++)P.push(M[O]),w>0&&(L=A[w-1]);var I=0;for(N=A[w],L=0;I<N-L-2;I++)I%2?(c[C++]=P[I],c[C++]=P[I+2],c[C++]=P[I+1]):(c[C++]=P[I],c[C++]=P[I+1],c[C++]=P[I+2]),w>0&&(L=A[w-1])}}break;case"Polys":var R=parseInt(u.attributes.NumberOfPolys);if(R>0){M=new Int32Array(m.DataArray[0].text.length),A=new Int32Array(m.DataArray[1].text.length),M.set(m.DataArray[0].text,0),A.set(m.DataArray[1].text,0),E=R+M.length,c=new Uint32Array(3*E-9*R),C=0;var D=0;for(w=0,_=R,L=0;w<_;){var F=[];for(O=0,N=A[w];O<N-L;)F.push(M[D++]),O++;for(I=1;I<N-L-1;)c[C++]=F[0],c[C++]=F[I],c[C++]=F[I+1],I++;L=A[++w-1]}}}}p++}var U=new Yu;return U.setIndex(new Du(c,1)),U.addAttribute("position",new Du(s,3)),l.length===s.length&&U.addAttribute("normal",new Du(l,3)),U}}(n(t)):i[2].includes("ASCII")?function(t){var e,r,n=[],i=[],o=[],a=[],s=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,c=/^POINTS /,u=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,p=/^CELL_DATA[ ]+(\d+)/,f=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,g=!1,y=!1,x=!1,b=!1,w=!1,_=!1,S=t.split("\n");for(var T in S){var M=S[T];if(v)for(;null!==(e=s.exec(M));){var A=parseFloat(e[1]),E=parseFloat(e[2]),C=parseFloat(e[3]);i.push(A,E,C)}else if(g){if(null!==(e=l.exec(M))){var P=parseInt(e[1]),O=e[2].split(/\s+/);if(P>=3)for(var N=parseInt(O[0]),L=1,I=0;I<P-2;++I)R=parseInt(O[L]),D=parseInt(O[L+1]),n.push(N,R,D),L++}}else if(y){if(null!==(e=l.exec(M))){var R,D;if(P=parseInt(e[1]),O=e[2].split(/\s+/),P>=3)for(I=0;I<P-2;I++)I%2==1?(N=parseInt(O[I]),R=parseInt(O[I+2]),D=parseInt(O[I+1]),n.push(N,R,D)):(N=parseInt(O[I]),R=parseInt(O[I+1]),D=parseInt(O[I+2]),n.push(N,R,D))}}else if(x||b)if(w)for(;null!==(e=s.exec(M));){var F=parseFloat(e[1]),U=parseFloat(e[2]),k=parseFloat(e[3]);o.push(F,U,k)}else if(_)for(;null!==(e=s.exec(M));){var B=parseFloat(e[1]),j=parseFloat(e[2]),z=parseFloat(e[3]);a.push(B,j,z)}null!==u.exec(M)?(g=!0,v=!1,y=!1):null!==c.exec(M)?(g=!1,v=!0,y=!1):null!==h.exec(M)?(g=!1,v=!1,y=!0):null!==d.exec(M)?(x=!0,v=!1,g=!1,y=!1):null!==p.exec(M)?(b=!0,v=!1,g=!1,y=!1):null!==f.exec(M)?(w=!0,_=!1,v=!1,g=!1,y=!1):null!==m.exec(M)&&(_=!0,w=!1,v=!1,g=!1,y=!1)}var V="point";if(o.length===n.length&&(V="cell"),"point"===V)(r=new Yu).setIndex(new Du(new Uint32Array(n),1)),r.addAttribute("position",new Du(new Float32Array(i),3)),o.length===i.length&&r.addAttribute("color",new Du(new Float32Array(o),3)),a.length===i.length&&r.addAttribute("normal",new Du(new Float32Array(a),3));else{r=new Iu;var G=n.length/3,H=i.length/3;for(I=0;I<H;++I)r.vertices.push(new yu(A=i[3*I+0],E=i[3*I+1],C=i[3*I+2]));for(T=0;T<G;++T)r.faces.push(new Cu(n[3*T+0],n[3*T+1],n[3*T+2]));if(o.length===3*G)for(T=0;T<G;++T)F=o[3*T+0],U=o[3*T+1],k=o[3*T+2],r.faces[T].color=(new Eu).setRGB(F,U,k)}return r}(n(t)):function(t){var e,r,n,i,o,a,s,l=new Uint8Array(t),c=new DataView(t),u=[],h=[],d=[],p=0;function f(t,e){for(var r=e,n=t[r],i=[];10!==n;)i.push(String.fromCharCode(n)),n=t[++r];return{start:e,end:r,next:r+1,parsedString:i.join("")}}for(;;){if(0===(s=(a=f(l,p)).parsedString).indexOf("POINTS")){for(e=4*(i=parseInt(s.split(" ")[1],10))*3,u=new Float32Array(3*i),r=a.next,n=0;n<i;n++)u[3*n]=c.getFloat32(r,!1),u[3*n+1]=c.getFloat32(r+4,!1),u[3*n+2]=c.getFloat32(r+8,!1),r+=12;a.next=a.next+e+1}else if(0===s.indexOf("TRIANGLE_STRIPS")){var m=parseInt(s.split(" ")[1],10);e=4*(b=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*b-9*m);var v=0;for(r=a.next,n=0;n<m;n++){var g=c.getInt32(r,!1),y=[];for(r+=4,o=0;o<g;o++)y.push(c.getInt32(r,!1)),r+=4;for(var x=0;x<g-2;x++)x%2?(d[v++]=y[x],d[v++]=y[x+2],d[v++]=y[x+1]):(d[v++]=y[x],d[v++]=y[x+1],d[v++]=y[x+2])}a.next=a.next+e+1}else if(0===s.indexOf("POLYGONS")){var b;for(m=parseInt(s.split(" ")[1],10),e=4*(b=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*b-9*m),v=0,r=a.next,n=0;n<m;n++){for(g=c.getInt32(r,!1),y=[],r+=4,o=0;o<g;o++)y.push(c.getInt32(r,!1)),r+=4;for(x=1;x<g-1;x++)d[v++]=y[0],d[v++]=y[x],d[v++]=y[x+1]}a.next=a.next+e+1}else if(0===s.indexOf("POINT_DATA")){for(i=parseInt(s.split(" ")[1],10),a=f(l,a.next),e=4*i*3,h=new Float32Array(3*i),r=a.next,n=0;n<i;n++)h[3*n]=c.getFloat32(r,!1),h[3*n+1]=c.getFloat32(r+4,!1),h[3*n+2]=c.getFloat32(r+8,!1),r+=12;a.next=a.next+e}if((p=a.next)>=l.byteLength)break}var w=new Yu;return w.setIndex(new Du(d,1)),w.addAttribute("position",new Du(u,3)),h.length===u.length&&w.addAttribute("normal",new Du(h,3)),w}(t)}}),(vg.prototype=Object.create(Mu.prototype)).constructor=vg,vg.prototype.isImmediateRenderObject=!0;var gg=function(t,e,r,n){vg.call(this,e);var i=this,o=new Float32Array(36),a=new Float32Array(36);function s(t,e,r){return t+(e-t)*r}function l(t,e,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[e+0]=n+d*i.delta,o[e+1]=l,o[e+2]=c,a[e+0]=s(p[t+0],p[t+3],d),a[e+1]=s(p[t+1],p[t+4],d),a[e+2]=s(p[t+2],p[t+5],d)}function c(t,e,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[e+0]=n,o[e+1]=l+d*i.delta,o[e+2]=c;var f=t+3*i.yd;a[e+0]=s(p[t+0],p[f+0],d),a[e+1]=s(p[t+1],p[f+1],d),a[e+2]=s(p[t+2],p[f+2],d)}function u(t,e,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[e+0]=n,o[e+1]=l,o[e+2]=c+d*i.delta;var f=t+3*i.zd;a[e+0]=s(p[t+0],p[f+0],d),a[e+1]=s(p[t+1],p[f+1],d),a[e+2]=s(p[t+2],p[f+2],d)}function h(t){var e=3*t;0===i.normal_cache[e]&&(i.normal_cache[e+0]=i.field[t-1]-i.field[t+1],i.normal_cache[e+1]=i.field[t-i.yd]-i.field[t+i.yd],i.normal_cache[e+2]=i.field[t-i.zd]-i.field[t+i.zd])}function d(t,e,r,n,s,d){var f=n+1,m=n+i.yd,v=n+i.zd,g=f+i.yd,y=f+i.zd,x=n+i.yd+i.zd,b=f+i.yd+i.zd,w=0,_=i.field[n],S=i.field[f],T=i.field[m],M=i.field[g],A=i.field[v],E=i.field[y],C=i.field[x],P=i.field[b];_<s&&(w|=1),S<s&&(w|=2),T<s&&(w|=8),M<s&&(w|=4),A<s&&(w|=16),E<s&&(w|=32),C<s&&(w|=128),P<s&&(w|=64);var O=yg[w];if(0===O)return 0;var N=i.delta,L=t+N,I=e+N,R=r+N;1&O&&(h(n),h(f),l(3*n,0,s,t,e,r,_,S)),2&O&&(h(f),h(g),c(3*f,3,s,L,e,r,S,M)),4&O&&(h(m),h(g),l(3*m,6,s,t,I,r,T,M)),8&O&&(h(n),h(m),c(3*n,9,s,t,e,r,_,T)),16&O&&(h(v),h(y),l(3*v,12,s,t,e,R,A,E)),32&O&&(h(y),h(b),c(3*y,15,s,L,e,R,E,P)),64&O&&(h(x),h(b),l(3*x,18,s,t,I,R,C,P)),128&O&&(h(v),h(x),c(3*v,21,s,t,e,R,A,C)),256&O&&(h(n),h(v),u(3*n,24,s,t,e,r,_,A)),512&O&&(h(f),h(y),u(3*f,27,s,L,e,r,S,E)),1024&O&&(h(g),h(b),u(3*g,30,s,L,I,r,M,P)),2048&O&&(h(m),h(x),u(3*m,33,s,t,I,r,T,C)),w<<=4;for(var D,F=0,U=0;-1!=xg[w+U];)p(o,a,3*xg[D=w+U],3*xg[D+1],3*xg[D+2],d),U+=3,F++;return F}function p(t,e,r,n,o,a){var s=3*i.count;if(i.positionArray[s+0]=t[r],i.positionArray[s+1]=t[r+1],i.positionArray[s+2]=t[r+2],i.positionArray[s+3]=t[n],i.positionArray[s+4]=t[n+1],i.positionArray[s+5]=t[n+2],i.positionArray[s+6]=t[o],i.positionArray[s+7]=t[o+1],i.positionArray[s+8]=t[o+2],i.normalArray[s+0]=e[r],i.normalArray[s+1]=e[r+1],i.normalArray[s+2]=e[r+2],i.normalArray[s+3]=e[n],i.normalArray[s+4]=e[n+1],i.normalArray[s+5]=e[n+2],i.normalArray[s+6]=e[o],i.normalArray[s+7]=e[o+1],i.normalArray[s+8]=e[o+2],i.enableUvs){var l=2*i.count;i.uvArray[l+0]=t[r],i.uvArray[l+1]=t[r+2],i.uvArray[l+2]=t[n],i.uvArray[l+3]=t[n+2],i.uvArray[l+4]=t[o],i.uvArray[l+5]=t[o+2]}i.enableColors&&(i.colorArray[s+0]=t[r],i.colorArray[s+1]=t[r+1],i.colorArray[s+2]=t[r+2],i.colorArray[s+3]=t[n],i.colorArray[s+4]=t[n+1],i.colorArray[s+5]=t[n+2],i.colorArray[s+6]=t[o],i.colorArray[s+7]=t[o+1],i.colorArray[s+8]=t[o+2]),i.count+=3,i.count>=i.maxCount-3&&(i.hasPositions=!0,i.hasNormals=!0,i.enableUvs&&(i.hasUvs=!0),i.enableColors&&(i.hasColors=!0),a(i))}this.enableUvs=void 0!==r&&r,this.enableColors=void 0!==n&&n,this.init=function(t){this.resolution=t,this.isolation=80,this.size=t,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(t){if(0!==this.count){for(var e=3*this.count;e<this.positionArray.length;e++)this.positionArray[e]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),t(this)}},this.addBall=function(t,e,r,n,i){var o=Math.sign(n);n=Math.abs(n);var a=this.size*Math.sqrt(n/i),s=r*this.size,l=e*this.size,c=t*this.size,u=Math.floor(s-a);u<1&&(u=1);var h=Math.floor(s+a);h>this.size-1&&(h=this.size-1);var d=Math.floor(l-a);d<1&&(d=1);var p=Math.floor(l+a);p>this.size-1&&(p=this.size-1);var f=Math.floor(c-a);f<1&&(f=1);var m,v,g,y,x,b,w,_,S,T,M,A=Math.floor(c+a);for(A>this.size-1&&(A=this.size-1),g=u;g<h;g++)for(x=this.size2*g,S=(_=g/this.size-r)*_,v=d;v<p;v++)for(y=x+this.size*v,T=(w=v/this.size-e)*w,m=f;m<A;m++)(M=n/(1e-6+(b=m/this.size-t)*b+T+S)-i)>0&&(this.field[y+m]+=M*o)},this.addPlaneX=function(t,e){var r,n,i,o,a,s,l=this.size,c=this.yd,u=this.zd,h=this.field,d=l*Math.sqrt(t/e);for(d>l&&(d=l),r=0;r<d;r++)if((o=t/(1e-4+(a=r/l)*a)-e)>0)for(n=0;n<l;n++)for(s=r+n*c,i=0;i<l;i++)h[u*i+s]+=o},this.addPlaneY=function(t,e){var r,n,i,o,a,s,l,c=this.size,u=this.yd,h=this.zd,d=this.field,p=c*Math.sqrt(t/e);for(p>c&&(p=c),n=0;n<p;n++)if((o=t/(1e-4+(a=n/c)*a)-e)>0)for(s=n*u,r=0;r<c;r++)for(l=s+r,i=0;i<c;i++)d[h*i+l]+=o},this.addPlaneZ=function(t,e){var r,n,i,o,a,s,l,c=this.size,u=this.yd,h=this.zd,d=this.field,p=c*Math.sqrt(t/e);for(p>c&&(p=c),i=0;i<p;i++)if((o=t/(1e-4+(a=i/c)*a)-e)>0)for(s=h*i,n=0;n<c;n++)for(l=s+n*u,r=0;r<c;r++)d[l+r]+=o},this.reset=function(){var t;for(t=0;t<this.size3;t++)this.normal_cache[3*t]=0,this.field[t]=0},this.render=function(t){this.begin();for(var e=this.size-2,r=1;r<e;r++)for(var n=this.size2*r,i=(r-this.halfsize)/this.halfsize,o=1;o<e;o++)for(var a=n+this.size*o,s=(o-this.halfsize)/this.halfsize,l=1;l<e;l++)d((l-this.halfsize)/this.halfsize,s,i,a+l,this.isolation,t);this.end(t)},this.generateGeometry=function(){var t=0,e=new Iu,r=[];return this.render(function(n){for(var i=0;i<n.count;i++){var o=(new yu).fromArray(n.positionArray,3*i),a=(new yu).fromArray(n.normalArray,3*i);e.vertices.push(o),r.push(a)}var s=n.count/3;for(i=0;i<s;i++){var l=3*(t+i),c=l+1,u=l+2,h=new Cu(l,c,u,[r[l],r[c],r[u]]);e.faces.push(h)}t+=s,n.count=0}),e},this.init(t)};(gg.prototype=Object.create(vg.prototype)).constructor=gg;var yg=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),xg=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);function bg(t,e,r,n,i,o,a,s,l){xd.call(this,t,e,r,n,i,o,a,s,l),this.needsUpdate=!0}function wg(t){Mu.call(this),this.type="Sprite",this.material=void 0!==t?t:new Gd,this.center=new Nu(.5,.5)}(bg.prototype=Object.create(xd.prototype)).constructor=bg,wg.prototype=Object.assign(Object.create(Mu.prototype),{constructor:wg,isSprite:!0,raycast:function(){var t=new yu,e=new yu,r=new yu;return function(n,i){e.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(e,t),r.setFromMatrixScale(this.matrixWorld);var o=r.x*r.y/4;if(!(e.distanceToSquared(t)>o)){var a=n.ray.origin.distanceTo(t);a<n.near||a>n.far||i.push({distance:a,point:t.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Mu.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var _g=function(t,e){this.lut=[],this.map=Sg[t],this.n=e,this.mapname=t;for(var r=1/this.n,n=0;n<=1;n+=r)for(var i=0;i<this.map.length-1;i++)if(n>=this.map[i][0]&&n<this.map[i+1][0]){var o=this.map[i][0],a=this.map[i+1][0],s=new Eu(16777215).setHex(this.map[i][1]),l=new Eu(16777215).setHex(this.map[i+1][1]),c=s.lerp(l,(n-o)/(a-o));this.lut.push(c)}return this.set(this)};_g.prototype={constructor:_g,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(t){return t instanceof _g&&this.copy(t),this},setMin:function(t){return this.minV=t,this},setMax:function(t){return this.maxV=t,this},changeNumberOfColors:function(t){return this.n=t,new _g(this.mapname,this.n)},changeColorMap:function(t){return this.mapname=t,new _g(this.mapname,this.n)},copy:function(t){return this.lut=t.lut,this.mapname=t.mapname,this.map=t.map,this.n=t.n,this.minV=t.minV,this.maxV=t.maxV,this},getColor:function(t){t<=this.minV?t=this.minV:t>=this.maxV&&(t=this.maxV),t=(t-this.minV)/(this.maxV-this.minV);var e=Math.round(t*this.n);return e==this.n&&(e-=1),this.lut[e]},addColorMap:function(t,e){Sg[t]=e},setLegendOn:function(t){void 0===t&&(t={}),this.legend={},this.legend.layout=t.hasOwnProperty("layout")?t.layout:"vertical",this.legend.position=t.hasOwnProperty("position")?t.position:{x:21.5,y:8,z:5},this.legend.dimensions=t.hasOwnProperty("dimensions")?t.dimensions:{width:.5,height:3},this.legend.canvas=document.createElement("canvas"),this.legend.canvas.setAttribute("id","legend"),this.legend.canvas.setAttribute("hidden",!0),document.body.appendChild(this.legend.canvas),this.legend.ctx=this.legend.canvas.getContext("2d"),this.legend.canvas.setAttribute("width",1),this.legend.canvas.setAttribute("height",this.n),this.legend.texture=new xd(this.legend.canvas);var e=this.legend.ctx.getImageData(0,0,1,this.n),r=e.data;this.map=Sg[this.mapname];for(var n=0,i=1/this.n,o=1;o>=0;o-=i)for(var a=this.map.length-1;a>=0;a--)if(o<this.map[a][0]&&o>=this.map[a-1][0]){var s=this.map[a-1][0],l=this.map[a][0],c=new Eu(16777215).setHex(this.map[a-1][1]),u=new Eu(16777215).setHex(this.map[a][1]),h=c.lerp(u,(o-s)/(l-s));r[4*n]=Math.round(255*h.r),r[4*n+1]=Math.round(255*h.g),r[4*n+2]=Math.round(255*h.b),r[4*n+3]=255,n+=1}return this.legend.ctx.putImageData(e,0,0),this.legend.texture.needsUpdate=!0,this.legend.legendGeometry=new Td(this.legend.dimensions.width,this.legend.dimensions.height),this.legend.legendMaterial=new Dh({map:this.legend.texture,side:Ku}),this.legend.mesh=new zh(this.legend.legendGeometry,this.legend.legendMaterial),"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh.position.copy(this.legend.position),this.legend.mesh},setLegendOff:function(){return this.legend=null,this.legend},setLegendLayout:function(t){return!!this.legend&&this.legend.layout!=t&&("horizontal"==t||"vertical"==t)&&(this.layout=t,"horizontal"==t&&(this.legend.mesh.rotation.z=Math.PI/180*90),"vertical"==t&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh)},setLegendPosition:function(t){return this.legend.position=new yu(t.x,t.y,t.z),this.legend},setLegendLabels:function(t,e){if(!this.legend)return!1;"function"==typeof t&&(e=t),void 0===t&&(t={}),this.legend.labels={},this.legend.labels.fontsize=t.hasOwnProperty("fontsize")?t.fontsize:24,this.legend.labels.fontface=t.hasOwnProperty("fontface")?t.fontface:"Arial",this.legend.labels.title=t.hasOwnProperty("title")?t.title:"",this.legend.labels.um=t.hasOwnProperty("um")?" [ "+t.um+" ]":"",this.legend.labels.ticks=t.hasOwnProperty("ticks")?t.ticks:0,this.legend.labels.decimal=t.hasOwnProperty("decimal")?t.decimal:2,this.legend.labels.notation=t.hasOwnProperty("notation")?t.notation:"standard";var r=document.createElement("canvas"),n=r.getContext("2d");n.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface,n.measureText(this.legend.labels.title.toString()+this.legend.labels.um.toString()),n.fillStyle="rgba(255,100,100,0.8)",n.strokeStyle="rgba(255,0,0,1)",n.lineWidth=4,n.fillStyle="rgba( 0, 0, 0, 1.0 )",n.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);var i=new bg(r);i.minFilter=mh;var o=new wg(new Gd({map:i}));if(o.scale.set(2,1,1),"vertical"==this.legend.layout&&o.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z),"horizontal"==this.legend.layout&&o.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z),this.legend.labels.ticks>0){var a={},s={};if("vertical"==this.legend.layout)var l=this.legend.position.y+.36*this.legend.dimensions.height,c=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var u=this.legend.position.x+.75*this.legend.dimensions.height,h=this.legend.position.x-1.2*this.legend.dimensions.width;for(var d=0;d<this.legend.labels.ticks;d++){var p=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*d+this.minV;p=e?e(p):"scientific"==this.legend.labels.notation?p.toExponential(this.legend.labels.decimal):p.toFixed(this.legend.labels.decimal);var f=document.createElement("canvas"),m=f.getContext("2d");m.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface,m.measureText(p.toString()),m.fillStyle="rgba(255,100,100,0.8)",m.strokeStyle="rgba(255,0,0,1)",m.lineWidth=4,m.fillStyle="rgba( 0, 0, 0, 1.0 )",m.fillText(p.toString(),4,this.legend.labels.fontsize+4);var v=new bg(f);v.minFilter=mh;var g=new wg(new Gd({map:v}));if(g.scale.set(2,1,1),"vertical"==this.legend.layout&&g.position.set(this.legend.position.x+2.7*this.legend.dimensions.width,y=c+(p-this.minV)/(this.maxV-this.minV)*(l-c),this.legend.position.z),"horizontal"==this.legend.layout){var y=h+(p-this.minV)/(this.maxV-this.minV)*(u-h);if(this.legend.labels.ticks>5)if(d%2==0)var x=1.7;else x=2.1;else x=1.7;g.position.set(y,this.legend.position.y-this.legend.dimensions.width*x,this.legend.position.z)}var b,w=new Fh({color:0,linewidth:2}),_=[];"vertical"==this.legend.layout&&(_.push(new yu(this.legend.position.x+.55*this.legend.dimensions.width,b=this.legend.position.y-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((p-this.minV)/(this.maxV-this.minV)*.99),this.legend.position.z)),_.push(new yu(this.legend.position.x+.7*this.legend.dimensions.width,b,this.legend.position.z))),"horizontal"==this.legend.layout&&(_.push(new yu(b=this.legend.position.x-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((p-this.minV)/(this.maxV-this.minV)*.99),this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),_.push(new yu(b,this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z)));var S=new Vh((new Yu).setFromPoints(_),w);s[d]=S,a[d]=g}}return{title:o,ticks:a,lines:s}}};var Sg={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]},Tg=function(t,e){zh.call(this,t,e),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length;this.createAnimation("__default",0,r-1,r/1),this.setAnimationWeight("__default",1)};Tg.prototype=Object.assign(Object.create(zh.prototype),{constructor:Tg,createAnimation:function(t,e,r,n){var i={start:e,end:r,length:r-e+1,fps:n,duration:(r-e)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=i,this.animationsList.push(i)},autoCreateAnimations:function(t){for(var e,r=/([a-z]+)_?(\d+)/i,n={},i=this.geometry,o=0,a=i.morphTargets.length;o<a;o++){var s=i.morphTargets[o].name.match(r);s&&s.length>1&&(n[l=s[1]]||(n[l]={start:1/0,end:-1/0}),o<(c=n[l]).start&&(c.start=o),o>c.end&&(c.end=o),e||(e=l))}for(var l in n){var c;this.createAnimation(l,(c=n[l]).start,c.end,t)}this.firstAnimation=e},setAnimationDirectionForward:function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},setAnimationDirectionBackward:function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},setAnimationFPS:function(t,e){var r=this.animationsMap[t];r&&(r.fps=e,r.duration=(r.end-r.start)/r.fps)},setAnimationDuration:function(t,e){var r=this.animationsMap[t];r&&(r.duration=e,r.fps=(r.end-r.start)/r.duration)},setAnimationWeight:function(t,e){var r=this.animationsMap[t];r&&(r.weight=e)},setAnimationTime:function(t,e){var r=this.animationsMap[t];r&&(r.time=e)},getAnimationTime:function(t){var e=0,r=this.animationsMap[t];return r&&(e=r.time),e},getAnimationDuration:function(t){var e=-1,r=this.animationsMap[t];return r&&(e=r.duration),e},playAnimation:function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},stopAnimation:function(t){var e=this.animationsMap[t];e&&(e.active=!1)},update:function(t){for(var e=0,r=this.animationsList.length;e<r;e++){var n=this.animationsList[e];if(n.active){var i=n.duration/n.length;n.time+=n.direction*t,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.start+vu.clamp(Math.floor(n.time/i),0,n.length-1),a=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var s=n.time%i/i;n.directionBackwards&&(s=1-s),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=s*a,this.morphTargetInfluences[n.lastFrame]=(1-s)*a):this.morphTargetInfluences[n.currentFrame]=a}}}}),Cu.prototype.set=function(t,e,r){this.a=t,this.b=e,this.c=r};var Mg=function(t,e,r,n,i,o){this.array_type=n,this.register_type=r,this.unit_size=i,this.accessors=o,this.buffer=new n(t*i),this.register=[],this.length=0,this.real_length=t,this.available_registers=e;for(var a=0;a<e;a++)this.register.push(new r)};Mg.prototype={constructor:Mg,index_to_register:function(t,e,r){var n=t*this.unit_size;if(e>=this.available_registers)throw new Error("BufferSubdivisionModifier: Not enough registers in TypedArrayHelper.");if(t>this.length)throw new Error("BufferSubdivisionModifier: Index is out of range in TypedArrayHelper.");for(var i=0;i<this.unit_size;i++)this.register[e][this.accessors[i]]=this.buffer[n+i]},resize:function(t){var e;0===t&&(t=8),t<this.length?this.buffer=this.buffer.subarray(0,this.length*this.unit_size):this.buffer.length<t*this.unit_size?((e=new this.array_type(t*this.unit_size)).set(this.buffer),this.buffer=e,this.real_length=t):((e=new this.array_type(t*this.unit_size)).set(this.buffer.subarray(0,this.length*this.unit_size)),this.buffer=e,this.real_length=t)},from_existing:function(t){this.buffer=new this.array_type(t.length),this.buffer.set(t),this.length=t.length/this.unit_size,this.real_length=this.length},push_element:function(t){this.length+1>this.real_length&&this.resize(2*this.real_length);for(var e=this.length*this.unit_size,r=0;r<this.unit_size;r++)this.buffer[e+r]=t[this.accessors[r]];this.length++},trim_size:function(){this.length<this.real_length&&this.resize(this.length)}};var Ag=function(t){this.subdivisions=void 0===t?1:t};Ag.prototype.modify=function(t){t instanceof Iu?(t.mergeVertices(),void 0===t.normals&&(t.normals=[]),t=function(t){for(var e=new Yu,r=new Mg(t.vertices.length,0,yu,Float32Array,3,["x","y","z"]),n=new Mg(t.faces.length,0,Cu,Uint32Array,3,["a","b","c"]),i=new Mg(3*t.faceVertexUvs[0].length*3,0,Nu,Float32Array,2,["x","y"]),o=0,a=t.vertices.length;o<a;o++)r.push_element(t.vertices[o]);for(o=0,a=t.faces.length;o<a;o++)n.push_element(t.faces[o]);for(o=0,a=t.faceVertexUvs[0].length;o<a;o++)i.push_element(t.faceVertexUvs[0][o][0]),i.push_element(t.faceVertexUvs[0][o][1]),i.push_element(t.faceVertexUvs[0][o][2]);return n.trim_size(),r.trim_size(),i.trim_size(),e.setIndex(new Du(n.buffer,3)),e.addAttribute("position",new Du(r.buffer,3)),e.addAttribute("uv",new Du(i.buffer,2)),e}(t)):t instanceof Yu||console.error("BufferSubdivisionModifier: Geometry is not an instance of BufferGeometry or Geometry");for(var e=this.subdivisions;e-- >0;)this.smooth(t);return function(t){var e=["x","y","z"],r=["x","y"],n=new Mg(0,3,yu,Float32Array,3,e),i=new Mg(0,3,Cu,Uint32Array,3,["a","b","c"]),o=new Mg(0,3,Nu,Float32Array,2,r),a=new Mg(0,3,yu,Float32Array,3,e);n.from_existing(t.getAttribute("position").array),i.from_existing(t.index.array),o.from_existing(t.getAttribute("uv").array),function(t){var e=["x","y","z"],r=new Mg(0,5,yu,Float32Array,3,e),n=new Mg(0,3,Cu,Uint32Array,3,["a","b","c"]);r.from_existing(t.getAttribute("position").array);var i,o=new Mg(3*r.length,4,yu,Float32Array,3,e),a=new Mg(r.length,1,function(){this.x=0},Float32Array,1,["x"]);o.length=r.length,n.from_existing(t.index.array);for(var s=[0,0,0],l=0,c=n.length;l<c;l++)n.index_to_register(l,0),r.index_to_register(n.register[0].a,0),r.index_to_register(n.register[0].b,1),r.index_to_register(n.register[0].c,2),o.register[0].subVectors(r.register[1],r.register[0]),o.register[1].subVectors(r.register[2],r.register[1]),o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),a.buffer[n.register[0].a]+=i,a.buffer[n.register[0].b]+=i,a.buffer[n.register[0].c]+=i;for(l=0,c=n.length;l<c;l++)n.index_to_register(l,0),r.index_to_register(n.register[0].a,0),r.index_to_register(n.register[0].b,1),r.index_to_register(n.register[0].c,2),o.register[0].subVectors(r.register[1],r.register[0]),o.register[1].subVectors(r.register[2],r.register[0]),o.register[3].set(0,0,0),o.register[3].x=o.register[0].y*o.register[1].z-o.register[0].z*o.register[1].y,o.register[3].y=o.register[0].z*o.register[1].x-o.register[0].x*o.register[1].z,o.register[3].z=o.register[0].x*o.register[1].y-o.register[0].y*o.register[1].x,o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),s[0]=i/a.buffer[n.register[0].a],s[1]=i/a.buffer[n.register[0].b],s[2]=i/a.buffer[n.register[0].c],o.buffer[3*n.register[0].a+0]+=o.register[3].x*s[0],o.buffer[3*n.register[0].a+1]+=o.register[3].y*s[0],o.buffer[3*n.register[0].a+2]+=o.register[3].z*s[0],o.buffer[3*n.register[0].b+0]+=o.register[3].x*s[1],o.buffer[3*n.register[0].b+1]+=o.register[3].y*s[1],o.buffer[3*n.register[0].b+2]+=o.register[3].z*s[1],o.buffer[3*n.register[0].c+0]+=o.register[3].x*s[2],o.buffer[3*n.register[0].c+1]+=o.register[3].y*s[2],o.buffer[3*n.register[0].c+2]+=o.register[3].z*s[2];o.trim_size(),t.addAttribute("normal",new Du(o.buffer,3))}(t),a.from_existing(t.getAttribute("normal").array);for(var s=new Mg(3*i.length,3,yu,Float32Array,3,e),l=new Mg(3*i.length,3,yu,Float32Array,3,e),c=new Mg(3*i.length,3,Nu,Float32Array,2,r),u=0,h=i.length;u<h;u++)i.index_to_register(u,0),n.index_to_register(i.register[0].a,0),n.index_to_register(i.register[0].b,1),n.index_to_register(i.register[0].c,2),s.push_element(n.register[0]),s.push_element(n.register[1]),s.push_element(n.register[2]),0!==o.length&&(o.index_to_register(3*u+0,0),o.index_to_register(3*u+1,1),o.index_to_register(3*u+2,2),c.push_element(o.register[0]),c.push_element(o.register[1]),c.push_element(o.register[2])),a.index_to_register(i.register[0].a,0),a.index_to_register(i.register[0].b,1),a.index_to_register(i.register[0].c,2),l.push_element(a.register[0]),l.push_element(a.register[1]),l.push_element(a.register[2]);return s.trim_size(),c.trim_size(),l.trim_size(),t.index=null,t.addAttribute("position",new Du(s.buffer,3)),t.addAttribute("normal",new Du(l.buffer,3)),0!==c.length&&t.addAttribute("uv",new Du(c.buffer,2)),t}(t)};var Eg=function(t,e){this.a=t,this.b=e,this.faces=[],this.newEdge=null};!function(){var t=["a","b","c"],e=["x","y","z"],r=["x","y"];function n(t,e,r){return r[Math.min(t,e)+"_"+Math.max(t,e)]}function i(t,e,r,n,i,o){var a,s=Math.min(t,e),l=Math.max(t,e),c=s+"_"+l;c in n?a=n[c]:(a=new Eg(s,l),n[c]=a),a.faces.push(i),o[t].edges.push(a),o[e].edges.push(a)}function o(t,e){t.push_element(e)}function a(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function s(t,e,r,n){t.push_element(e),t.push_element(r),t.push_element(n)}Ag.prototype.smooth=function(l){var c,u,h,d,p,f,m,v,g,y,x,b,w;c=new Mg(0,3,yu,Float32Array,3,e),u=new Mg(0,3,Cu,Uint32Array,3,t),h=new Mg(0,3,Nu,Float32Array,2,r),c.from_existing(l.getAttribute("position").array),u.from_existing(l.index.array),h.from_existing(l.getAttribute("uv").array);var _,S,T,M,A,E,C,P=!1;void 0!==h&&0!==h.length&&(P=!0),function(t,e,r,n){var o,a,s;for(o=0,a=t.length;o<a;o++)r[o]={edges:[]};for(o=0,a=e.length;o<a;o++)e.index_to_register(o,0),i((s=e.register[0]).a,s.b,0,n,o,r),i(s.b,s.c,0,n,o,r),i(s.c,s.a,0,n,o,r)}(c,u,b=new Array(c.length),w={});var O=(d=new Mg(2*l.getAttribute("position").array.length/3,2,yu,Float32Array,3,e)).register[1];for(v in w){for(T=d.register[0],A=3/8,E=1/8,2!==(C=(S=w[v]).faces.length)&&(A=.5,E=0),c.index_to_register(S.a,0),c.index_to_register(S.b,1),T.addVectors(c.register[0],c.register[1]).multiplyScalar(A),O.set(0,0,0),y=0;y<C;y++){for(u.index_to_register(S.faces[y],0),M=u.register[0],x=0;x<3&&(c.index_to_register(M[t[x]],2),_=c.register[2],M[t[x]]===S.a||M[t[x]]===S.b);x++);O.add(_)}O.multiplyScalar(E),T.add(O),S.newEdge=d.length,d.push_element(T)}var N,L,I,R,D,F,U,k,B,j=d.length;for(v=0,g=c.length;v<g;v++){for(c.index_to_register(v,0,e),3===(m=(D=b[v].edges).length)?N=3/16:m>3&&(N=3/(8*m)),L=1-m*N,I=N,m<=2&&2===m&&(L=.75,I=1/8),F=c.register[0].multiplyScalar(L),O.set(0,0,0),y=0;y<m;y++)c.index_to_register(_=(R=D[y]).a!==v?R.a:R.b,1,e),O.add(c.register[1]);O.multiplyScalar(I),F.add(O),d.push_element(F,e)}p=new Mg(4*l.index.array.length/3,1,Cu,Float32Array,3,t);var z=(f=new Mg(4*l.getAttribute("uv").array.length/2,3,Nu,Float32Array,2,r)).register[0],V=f.register[1],G=f.register[2],H=p.register[0];for(v=0,g=u.length;v<g;v++)if(u.index_to_register(v,0),U=n((M=u.register[0]).a,M.b,w).newEdge,k=n(M.b,M.c,w).newEdge,B=n(M.c,M.a,w).newEdge,H.set(U,k,B),o(p,H),H.set(M.a+j,U,B),o(p,H),H.set(M.b+j,k,U),o(p,H),H.set(M.c+j,B,k),o(p,H),!0===P){h.index_to_register(3*v+0,0),h.index_to_register(3*v+1,1),h.index_to_register(3*v+2,2);var W=h.register[0],X=h.register[1],Y=h.register[2];z.set(a(W.x,X.x),a(W.y,X.y)),V.set(a(X.x,Y.x),a(X.y,Y.y)),G.set(a(W.x,Y.x),a(W.y,Y.y)),s(f,z,V,G),s(f,W,z,G),s(f,X,V,z),s(f,Y,G,V)}p.trim_size(),d.trim_size(),f.trim_size(),l.setIndex(new Du(p.buffer,3)),l.addAttribute("position",new Du(d.buffer,3)),l.addAttribute("uv",new Du(f.buffer,2))}}(),function(){var t=new yu,e=new yu;function r(t,e,r,n,i,o){this.a=n,this.b=i,this.c=o,this.v1=t,this.v2=e,this.v3=r,this.normal=new yu,this.computeNormal(),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(t),r.addUniqueNeighbor(e)}function n(t,e){this.position=t,this.id=e,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}r.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position;t.subVectors(this.v3.position,n),e.subVectors(r,n),t.cross(e).normalize(),this.normal.copy(t)},r.prototype.hasVertex=function(t){return t===this.v1||t===this.v2||t===this.v3},r.prototype.replaceVertex=function(t,e){t===this.v1?this.v1=e:t===this.v2?this.v2=e:t===this.v3&&(this.v3=e),function(t,e){var r=t.indexOf(e);r>-1&&t.splice(r,1)}(t.faces,this),e.faces.push(this),t.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(t),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},n.prototype.addUniqueNeighbor=function(t){!function(t,e){-1===t.indexOf(e)&&t.push(e)}(this.neighbors,t)},n.prototype.removeIfNonNeighbor=function(t){var e=this.neighbors,r=this.faces,n=e.indexOf(t);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(t))return;e.splice(n,1)}}}();var Cg=function(t){this.subdivisions=void 0===t?1:t};Cg.prototype.modify=function(t){for(var e=this.subdivisions;e-- >0;)this.smooth(t);t.computeFaceNormals(),t.computeVertexNormals()},function(){var t=["a","b","c"];function e(t,e,r){return r[Math.min(t,e)+"_"+Math.max(t,e)]}function r(t,e,r,n,i,o){var a,s=Math.min(t,e),l=Math.max(t,e),c=s+"_"+l;c in n?a=n[c]:n[c]=a={a:r[s],b:r[l],newEdge:null,faces:[]},a.faces.push(i),o[t].edges.push(a),o[e].edges.push(a)}function n(t,e,r,n){t.push(new Cu(e,r,n))}function i(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function o(t,e,r,n){t.push([e.clone(),r.clone(),n.clone()])}Cg.prototype.smooth=function(a){var s,l,c,u,h,d,p,f,m,v,g,y,x,b,w=new yu,_=[];s=a.vertices,l=a.faces;var S,T,M,A,E,C,P,O,N,L,I,R,D,F,U=void 0!==(c=a.faceVertexUvs[0])&&c.length>0;for(p in function(t,e,n,i){var o,a,s;for(o=0,a=t.length;o<a;o++)n[o]={edges:[]};for(o=0,a=e.length;o<a;o++)r((s=e[o]).a,s.b,t,i,s,n),r(s.b,s.c,t,i,s,n),r(s.c,s.a,t,i,s,n)}(s,l,g=new Array(s.length),y={}),x=[],y){for(T=y[p],M=new yu,E=3/8,C=1/8,2!=(P=T.faces.length)&&(E=.5,C=0),M.addVectors(T.a,T.b).multiplyScalar(E),w.set(0,0,0),m=0;m<P;m++){for(A=T.faces[m],v=0;v<3&&((S=s[A[t[v]]])===T.a||S===T.b);v++);w.add(S)}w.multiplyScalar(C),M.add(w),T.newEdge=x.length,x.push(M)}for(b=[],p=0,f=s.length;p<f;p++){for(D=s[p],3==(d=(R=g[p].edges).length)?O=3/16:d>3&&(O=3/(8*d)),N=1-d*O,L=O,d<=2&&2==d&&(N=.75,L=1/8),F=D.clone().multiplyScalar(N),w.set(0,0,0),m=0;m<d;m++)w.add(S=(I=R[m]).a!==D?I.a:I.b);w.multiplyScalar(L),F.add(w),b.push(F)}u=b.concat(x);var k,B,j,z,V,G,H,W=b.length;h=[];var X=new Nu,Y=new Nu,q=new Nu;for(p=0,f=l.length;p<f;p++)n(h,k=e((A=l[p]).a,A.b,y).newEdge+W,B=e(A.b,A.c,y).newEdge+W,j=e(A.c,A.a,y).newEdge+W),n(h,A.a,k,j),n(h,A.b,B,k),n(h,A.c,j,B),U&&(H=(z=c[p])[2],X.set(i((V=z[0]).x,(G=z[1]).x),i(V.y,G.y)),Y.set(i(G.x,H.x),i(G.y,H.y)),q.set(i(V.x,H.x),i(V.y,H.y)),o(_,X,Y,q),o(_,V,X,q),o(_,G,Y,X),o(_,H,q,Y));a.vertices=u,a.faces=h,U&&(a.faceVertexUvs[0]=_)}}();var Pg=function(t,e){zh.call(this,t,e),this.type="MorphAnimMesh",this.mixer=new Zm(this),this.activeAction=null};(Pg.prototype=Object.create(zh.prototype)).constructor=Pg,Pg.prototype.setDirectionForward=function(){this.mixer.timeScale=1},Pg.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},Pg.prototype.playAnimation=function(t,e){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var r=hd.findByName(this,t);if(!r)throw new Error("MorphAnimMesh: animations["+t+"] undefined in .playAnimation()");var n=this.mixer.clipAction(r);n.timeScale=r.tracks.length*e/r.duration,this.activeAction=n.play()},Pg.prototype.updateAnimation=function(t){this.mixer.update(t)},Pg.prototype.copy=function(t){return zh.prototype.copy.call(this,t),this.mixer=new Zm(this),this};var Og=function(t){nv.call(this,"v4",{shared:!1}),this.index=t||0};Og.vertexDict=["color","color2"],Og.fragmentDict=["vColor","vColor2"],(Og.prototype=Object.create(nv.prototype)).constructor=Og,Og.prototype.generate=function(t,e){var r;return t.material.requires.color[this.index]=!0,r=t.isShader("vertex")?Og.vertexDict[this.index]:Og.fragmentDict[this.index],t.format(r,this.getType(t),e)},Og.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e};var Ng=function(t){nv.call(this,"v3",{shared:!1}),this.scope=t||Ng.TOTAL};Ng.TOTAL="total",Ng.prototype=Object.create(nv.prototype),Ng.prototype.constructor=Ng,Ng.prototype.nodeType="Light",Ng.prototype.generate=function(t,e){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.getType(t),e):(console.warn('LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.getType(t),e))},Ng.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Lg=function(t){nv.call(this,"v3",{unique:!0}),this.scope=t||Lg.CUBE};Lg.CUBE="cube",Lg.SPHERE="sphere",Lg.VECTOR="vector",Lg.prototype=Object.create(nv.prototype),Lg.prototype.constructor=Lg,Lg.prototype.nodeType="Reflect",Lg.prototype.getType=function(t){switch(this.scope){case Lg.SPHERE:return"v2"}return this.type},Lg.prototype.generate=function(t,e){var r;switch(this.scope){case Lg.VECTOR:t.material.addFragmentNode("vec3 reflectVec = inverseTransformDirection( reflect( -normalize( vViewPosition ), normal ), viewMatrix );"),r="reflectVec";break;case Lg.CUBE:var n=new Lg(Lg.VECTOR).build(t,"v3");t.material.addFragmentNode("vec3 reflectCubeVec = vec3( -1.0 * "+n+".x, "+n+".yz );"),r="reflectCubeVec";break;case Lg.SPHERE:n=new Lg(Lg.VECTOR).build(t,"v3"),t.material.addFragmentNode("vec2 reflectSphereVec = normalize((viewMatrix * vec4("+n+", 0.0 )).xyz + vec3(0.0,0.0,1.0)).xy * 0.5 + 0.5;"),r="reflectSphereVec"}return t.format(r,this.getType(this.type),e)},Lg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Ig=function(t){nv.call(this,"v2"),this.resolution=t};(Ig.prototype=Object.create(nv.prototype)).constructor=Ig,Ig.prototype.nodeType="ScreenUV",Ig.prototype.generate=function(t,e){var r;return t.isShader("fragment")?r="(gl_FragCoord.xy/"+this.resolution.build(t,"v2")+")":(console.warn("ScreenUVNode is not compatible with "+t.shader+" shader."),r="vec2( 0.0 )"),t.format(r,this.getType(t),e)},Ig.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).resolution=this.resolution.toJSON(t).uuid),e};var Rg=function(t,e){rv.call(this,e),this.name=t};(Rg.prototype=Object.create(rv.prototype)).constructor=Rg,Rg.prototype.nodeType="Attribute",Rg.prototype.getAttributeType=function(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type},Rg.prototype.getType=function(t){var e=this.getAttributeType(t);return t.getTypeByFormat(e)},Rg.prototype.generate=function(t,e){var r=this.getAttributeType(t),n=t.material.getAttribute(this.name,r);return t.format(t.isShader("vertex")?this.name:n.varying.name,this.getType(t),e)},Rg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).out=this.type),e};var Dg=function(t,e){nv.call(this),this.setFunction(t,e)};(Dg.prototype=Object.create(nv.prototype)).constructor=Dg,Dg.prototype.nodeType="FunctionCall",Dg.prototype.setFunction=function(t,e){this.value=t,this.inputs=e||[]},Dg.prototype.getFunction=function(){return this.value},Dg.prototype.getType=function(t){return this.value.getType(t)},Dg.prototype.generate=function(t,e){for(var r=this.getType(t),n=this.value,i=n.build(t,e)+"(",o=[],a=0;a<n.inputs.length;a++){var s=n.inputs[a];o.push((this.inputs[a]||this.inputs[s.name]).build(t,t.getTypeByFormat(s.type)))}return i+=o.join(",")+")",t.format(i,r,e)},Dg.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){var r=this.value;if((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,r.inputs.length){e.inputs={};for(var n=0;n<r.inputs.length;n++){var i=r.inputs[n];e.inputs[i.name]=(this.inputs[n]||this.inputs[i.name]).toJSON(t).uuid}}}return e};var Fg=function(t){rv.call(this,"v4"),this.value=t};(Fg.prototype=Object.create(rv.prototype)).constructor=Fg,Fg.prototype.nodeType="Raw",Fg.prototype.generate=function(t){var e=this.value.parseAndBuildCode(t,this.type);return e.code+"\n"+("vertex"==t.shader?"gl_Position = "+e.result+";":"gl_FragColor = "+e.result+";")},Fg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),e};var Ug=function(t){this.material=t,this.caches=[],this.slots=[],this.keywords={},this.parsing=!1,this.optimize=!0,this.update()};Ug.type={float:"fv1",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"iv1"},Ug.constructors=["float","vec2","vec3","vec4"],Ug.elements=["x","y","z","w"],Ug.prototype={constructor:Ug,addCache:function(t,e){return this.caches.push({name:t||"",requires:e||{}}),this.update()},removeCache:function(){return this.caches.pop(),this.update()},addSlot:function(t){return this.slots.push({name:t||""}),this.update()},removeSlot:function(){return this.slots.pop(),this.update()},isCache:function(t){for(var e=this.caches.length;e--;)if(this.caches[e].name==t)return!0;return!1},isSlot:function(t){for(var e=this.slots.length;e--;)if(this.slots[e].name==t)return!0;return!1},update:function(){var t=this.caches[this.caches.length-1],e=this.slots[this.slots.length-1];return this.slot=e?e.name:"",this.cache=t?t.name:"",this.requires=t?t.requires:{},this},require:function(t,e){return this.requires[t]=e,this},include:function(t,e,r){return this.material.include(this,t,e,r),this},colorToVector:function(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},getConstructorFromLength:function(t){return Ug.constructors[t-1]},getFormatName:function(t){return t.replace(/c/g,"v3").replace(/fv1/g,"v1").replace(/iv1/g,"i")},isFormatMatrix:function(t){return/^m/.test(t)},getFormatLength:function(t){return parseInt(this.getFormatName(t).substr(1))},getFormatFromLength:function(t){return 1==t?"fv1":"v"+t},format:function(t,e,r){switch(this.getFormatName(r+"="+e)){case"v1=v2":case"v1=v3":case"v1=v4":return t+".x";case"v1=i":return"float("+t+")";case"v2=v1":return"vec2("+t+")";case"v2=v3":case"v2=v4":return t+".xy";case"v2=i":return"vec2(float("+t+"))";case"v3=v1":return"vec3("+t+")";case"v3=v2":return"vec3("+t+",0.0)";case"v3=v4":return t+".xyz";case"v3=i":return"vec2(float("+t+"))";case"v4=v1":return"vec4("+t+")";case"v4=v2":return"vec4("+t+",0.0,1.0)";case"v4=v3":return"vec4("+t+",1.0)";case"v4=i":return"vec4(float("+t+"))";case"i=v1":return"int("+t+")";case"i=v2":case"i=v3":case"i=v4":return"int("+t+".x)"}return t},getTypeByFormat:function(t){return Ug.type[t]||t},getUuid:function(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t},getElementByIndex:function(t){return Ug.elements[t]},getIndexByElement:function(t){return Ug.elements.indexOf(t)},isShader:function(t){return this.shader==t},setShader:function(t){return this.shader=t,this}};var kg=function(t,e){_d.call(this),this.vertex=t||new Fg(new sv(sv.PROJECTION)),this.fragment=e||new Fg(new Bg(16711680)),this.updaters=[]};kg.types={t:"sampler2D",tc:"samplerCube",bv1:"bool",iv1:"int",fv1:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"},kg.addShortcuts=function(t,e,r){function n(t,e){return{get:function(){return this[t][e]},set:function(r){this[t][e]=r}}}return function(){for(var i={},o=0;o<r.length;++o){var a=r[o];i[a]=n(e,a)}Object.defineProperties(t,i)}()},(kg.prototype=Object.create(_d.prototype)).constructor=kg,kg.prototype.type="NodeMaterial",kg.prototype.updateFrame=function(t){for(var e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])},kg.prototype.build=function(){var t,e;this.nodes=[],this.defines={},this.uniforms={},this.attributes={},this.extensions={},this.nodeData={},this.vertexUniform=[],this.fragmentUniform=[],this.vars=[],this.vertexTemps=[],this.fragmentTemps=[],this.uniformList=[],this.consts=[],this.functions=[],this.updaters=[],this.requires={uv:[],color:[],lights:this.lights,fog:this.fog},this.vertexPars="",this.fragmentPars="",this.vertexCode="",this.fragmentCode="",this.vertexNode="",this.fragmentNode="",this.prefixCode=["#ifdef GL_EXT_shader_texture_lod","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>"].join("\n");var r=new Ug(this);return t=this.vertex.build(r.setShader("vertex"),"v4"),e=this.fragment.build(r.setShader("fragment"),"v4"),this.requires.uv[0]&&(this.addVertexPars("varying vec2 vUv;"),this.addFragmentPars("varying vec2 vUv;"),this.addVertexCode("vUv = uv;")),this.requires.uv[1]&&(this.addVertexPars("varying vec2 vUv2; attribute vec2 uv2;"),this.addFragmentPars("varying vec2 vUv2;"),this.addVertexCode("vUv2 = uv2;")),this.requires.color[0]&&(this.addVertexPars("varying vec4 vColor; attribute vec4 color;"),this.addFragmentPars("varying vec4 vColor;"),this.addVertexCode("vColor = color;")),this.requires.color[1]&&(this.addVertexPars("varying vec4 vColor2; attribute vec4 color2;"),this.addFragmentPars("varying vec4 vColor2;"),this.addVertexCode("vColor2 = color2;")),this.requires.position&&(this.addVertexPars("varying vec3 vPosition;"),this.addFragmentPars("varying vec3 vPosition;"),this.addVertexCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVertexPars("varying vec3 vWPosition;"),this.addFragmentPars("varying vec3 vWPosition;"),this.addVertexCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVertexPars("varying vec3 vObjectNormal;"),this.addFragmentPars("varying vec3 vObjectNormal;"),this.addVertexCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVertexPars("varying vec3 vWNormal;"),this.addFragmentPars("varying vec3 vWNormal;"),this.addVertexCode("vWNormal = ( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz;")),this.fog=this.requires.fog,this.lights=this.requires.lights,this.transparent=this.requires.transparent||this.blending>rh,this.vertexShader=[this.prefixCode,this.vertexPars,this.getCodePars(this.vertexUniform,"uniform"),this.getIncludes(this.consts.vertex),this.getIncludes(this.functions.vertex),"void main(){",this.getCodePars(this.vertexTemps),t,this.vertexCode,"}"].join("\n"),this.fragmentShader=[this.prefixCode,this.fragmentPars,this.getCodePars(this.fragmentUniform,"uniform"),this.getIncludes(this.consts.fragment),this.getIncludes(this.functions.fragment),"void main(){",this.getCodePars(this.fragmentTemps),this.fragmentCode,e,"}"].join("\n"),this.needsUpdate=!0,this.dispose(),this},kg.prototype.define=function(t,e){this.defines[t]=void 0==e?1:e},kg.prototype.isDefined=function(t){return void 0!=this.defines[t]},kg.prototype.mergeUniform=function(t){for(var e in t)this.uniforms[e]=t[e]},kg.prototype.createUniform=function(t,e,r,n){var i={type:t,value:e,name:r||"nVu"+this.uniformList.length,needsUpdate:n};return this.uniformList.push(i),i},kg.prototype.getVertexTemp=function(t,e,r){var n=this.vertexTemps[t];return n||(this.vertexTemps.push(n={name:r||"nVt"+this.vertexTemps.length,type:e}),this.vertexTemps[t]=n),n},kg.prototype.getFragmentTemp=function(t,e,r){var n=this.fragmentTemps[t];return n||(this.fragmentTemps.push(n={name:r||"nVt"+this.fragmentTemps.length,type:e}),this.fragmentTemps[t]=n),n},kg.prototype.getVar=function(t,e,r){var n=this.vars[t];if(!n){var i=r||"nVv"+this.vars.length;this.vars.push(n={name:i,type:e}),this.vars[t]=n,this.addVertexPars("varying "+e+" "+i+";"),this.addFragmentPars("varying "+e+" "+i+";")}return n},kg.prototype.getAttribute=function(t,e){if(!this.attributes[t]){var r=this.getVar(t,e);this.addVertexPars("attribute "+e+" "+t+";"),this.addVertexCode(r.name+" = "+t+";"),this.attributes[t]={varying:r,name:t,type:e}}return this.attributes[t]},kg.prototype.getIncludes=function(){function t(t,e){return t.deps.length-e.deps.length}return function(e){if(!e)return"";for(var r="",n=(e=e.sort(t),0);n<e.length;n++)e[n].src&&(r+=e[n].src+"\n");return r}}(),kg.prototype.addVertexPars=function(t){this.vertexPars+=t+"\n"},kg.prototype.addFragmentPars=function(t){this.fragmentPars+=t+"\n"},kg.prototype.addVertexCode=function(t){this.vertexCode+=t+"\n"},kg.prototype.addFragmentCode=function(t){this.fragmentCode+=t+"\n"},kg.prototype.addVertexNode=function(t){this.vertexNode+=t+"\n"},kg.prototype.clearVertexNode=function(){var t=this.vertexNode;return this.vertexNode="",t},kg.prototype.addFragmentNode=function(t){this.fragmentNode+=t+"\n"},kg.prototype.clearFragmentNode=function(){var t=this.fragmentNode;return this.fragmentNode="",t},kg.prototype.getCodePars=function(t,e){e=e||"";for(var r="",n=0,i=t.length;n<i;++n){var o=t[n].type,a=t[n].name;"t"==o&&t[n].value instanceof Fm&&(o="tc");var s=kg.types[o];if(void 0==s)throw new Error("Node pars "+o+" not found.");r+=e+" "+s+" "+a+";\n"}return r},kg.prototype.createVertexUniform=function(t,e,r,n){var i=this.createUniform(t,e,r,n);return this.vertexUniform.push(i),this.vertexUniform[i.name]=i,this.uniforms[i.name]=i,i},kg.prototype.createFragmentUniform=function(t,e,r,n){var i=this.createUniform(t,e,r,n);return this.fragmentUniform.push(i),this.fragmentUniform[i.name]=i,this.uniforms[i.name]=i,i},kg.prototype.getDataNode=function(t){return this.nodeData[t]=this.nodeData[t]||{}},kg.prototype.include=function(t,e,r,n){var i;(e="string"==typeof e?ov.get(e):e)instanceof iv?i=this.functions[t.shader]=this.functions[t.shader]||[]:e instanceof dv&&(i=this.consts[t.shader]=this.consts[t.shader]||[]);var o=i[e.name];if(o||(o=i[e.name]={node:e,deps:[]},i.push(o),o.src=e.build(t,"source")),e instanceof iv&&r&&i[r.name]&&-1==i[r.name].deps.indexOf(e)&&(i[r.name].deps.push(e),e.includes&&e.includes.length)){var a=0;do{this.include(t,e.includes[a++],r)}while(a<e.includes.length)}n&&(o.src=n)},kg.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var e={};e.uuid=this.uuid,e.type=this.type,t.materials[e.uuid]=e,""!==this.name&&(e.name=this.name),this.blending!==rh&&(e.blending=this.blending),!0===this.flatShading&&(e.flatShading=this.flatShading),this.side!==Zu&&(e.side=this.side),!0===this.transparent&&(e.transparent=this.transparent),e.depthFunc=this.depthFunc,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(e.morphTargets=!0),!0===this.skinning&&(e.skinning=!0),e.fog=this.fog,e.lights=this.lights,!1===this.visible&&(e.visible=!1),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.vertex=this.vertex.toJSON(t).uuid,e.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t};var Bg=function(t){cv.call(this,"c"),this.value=new Eu(t||0)};Bg.prototype=Object.create(cv.prototype),Bg.prototype.constructor=Bg,Bg.prototype.nodeType="Color",kg.addShortcuts(Bg.prototype,"value",["r","g","b"]),Bg.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",n,e)},Bg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).r=this.r,e.g=this.g,e.b=this.b,!0===this.readonly&&(e.readonly=!0)),e};var jg=function(t,e,r){cv.call(this,"v4",{shared:!0}),this.value=t,this.coord=e||new Lg,this.bias=r};(jg.prototype=Object.create(cv.prototype)).constructor=jg,jg.prototype.nodeType="CubeTexture",jg.prototype.getTexture=function(t,e){return cv.prototype.generate.call(this,t,e,this.value.uuid,"t")},jg.prototype.generate=function(t,e){if("samplerCube"===e)return this.getTexture(t,e);var r,n=this.getTexture(t,e),i=this.coord.build(t,"v3"),o=this.bias?this.bias.build(t,"fv1"):void 0;return void 0==o&&t.requires.bias&&(o=t.requires.bias.build(t,"fv1")),r=o?"texCubeBias("+n+","+i+","+o+")":"texCube("+n+","+i+")",t.isSlot("color")?r="mapTexelToLinear("+r+")":t.isSlot("emissive")?r="emissiveMapTexelToLinear("+r+")":t.isSlot("environment")&&(r="envMapTexelToLinear("+r+")"),t.format(r,this.type,e)},jg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.coord=this.coord.toJSON(t).uuid,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e};var zg=function(t){cv.call(this,"iv1"),this.value=[Math.floor(t||0)]};(zg.prototype=Object.create(cv.prototype)).constructor=zg,zg.prototype.nodeType="Int",Object.defineProperties(zg.prototype,{number:{get:function(){return this.value[0]},set:function(t){this.value[0]=Math.floor(t)}}}),zg.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format(this.number,n,e)},zg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).number=this.number,!0===this.readonly&&(e.readonly=!0)),e};var Vg=function(t){cv.call(this,"m3"),this.value=t||new Su};(Vg.prototype=Object.create(cv.prototype)).constructor=Vg,Vg.prototype.nodeType="Matrix3",Vg.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("mat3( "+this.value.elements.join(", ")+" )",n,e)},Vg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat(),!0===this.readonly&&(e.readonly=!0)),e};var Gg=function(t){cv.call(this,"m4"),this.value=t||new gu};(Gg.prototype=Object.create(cv.prototype)).constructor=Gg,Gg.prototype.nodeType="Matrix4",Gg.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("mat4( "+this.value.elements.join(", ")+" )",n,e)},Gg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat(),!0===this.readonly&&(e.readonly=!0)),e};var Hg=function(t,e,r){nv.call(this),this.a=t,this.b=e,this.op=r||Hg.ADD};Hg.ADD="+",Hg.SUB="-",Hg.MUL="*",Hg.DIV="/",Hg.prototype=Object.create(nv.prototype),Hg.prototype.constructor=Hg,Hg.prototype.nodeType="Operator",Hg.prototype.getType=function(t){var e=this.a.getType(t),r=this.b.getType(t);return t.isFormatMatrix(e)?"v4":t.getFormatLength(r)>t.getFormatLength(e)?r:e},Hg.prototype.generate=function(t,e){t.material.getDataNode(this.uuid);var r=this.getType(t),n=this.a.build(t,r),i=this.b.build(t,r);return t.format("("+n+this.op+i+")",r,e)},Hg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op),e};var Wg=function(t,e,r,n){cv.call(this,"v4",{shared:!0}),this.value=t,this.coord=e||new av,this.bias=r,this.project=void 0!==n&&n};(Wg.prototype=Object.create(cv.prototype)).constructor=Wg,Wg.prototype.nodeType="Texture",Wg.prototype.getTexture=function(t,e){return cv.prototype.generate.call(this,t,e,this.value.uuid,"t")},Wg.prototype.generate=function(t,e){if("sampler2D"===e)return this.getTexture(t,e);var r,n,i=this.getTexture(t,e),o=this.coord.build(t,this.project?"v4":"v2"),a=this.bias?this.bias.build(t,"fv1"):void 0;return void 0==a&&t.requires.bias&&(a=t.requires.bias.build(t,"fv1")),r=this.project?"texture2DProj":a?"tex2DBias":"tex2D",n=a?r+"("+i+","+o+","+a+")":r+"("+i+","+o+")",t.isSlot("color")?n="mapTexelToLinear("+n+")":t.isSlot("emissive")?n="emissiveMapTexelToLinear("+n+")":t.isSlot("environment")&&(n="envMapTexelToLinear("+n+")"),t.format(n,this.type,e)},Wg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.value&&(e.value=this.value.uuid),e.coord=this.coord.toJSON(t).uuid,e.project=this.project,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e};var Xg=function(t){nv.call(this,"v4"),t&&this.setMirror(t)};(Xg.prototype=Object.create(nv.prototype)).constructor=Xg,Xg.prototype.nodeType="Reflector",Xg.prototype.setMirror=function(t){this.mirror=t,this.textureMatrix=new Gg(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new sv(sv.LOCAL),this.coord=new Hg(this.textureMatrix,this.localPosition,Hg.MUL),this.coordResult=new Hg(null,this.coord,Hg.ADD),this.texture=new Wg(this.mirror.material.uniforms.tDiffuse.value,this.coord,null,!0)},Xg.prototype.generate=function(t,e){return t.isShader("fragment")?(this.coordResult.a=this.offset,this.texture.coord=this.offset?this.coordResult:this.coord,"sampler2D"===e?this.texture.build(t,e):t.format(this.texture.build(t,this.type),this.type,e)):(console.warn("ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4(0.0)",this.type,e))},Xg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).mirror=this.mirror.uuid,this.offset&&(e.offset=this.offset.toJSON(t).uuid)),e};var Yg=function(t){Wg.call(this,void 0,t)};(Yg.prototype=Object.create(Wg.prototype)).constructor=Yg,Yg.prototype.nodeType="Screen",Yg.prototype.isUnique=function(){return!0},Yg.prototype.getTexture=function(t,e){return cv.prototype.generate.call(this,t,e,this.getUuid(),"t","renderTexture")};var qg=function(t,e){cv.call(this,"v2"),this.value=new Nu(t,e)};(qg.prototype=Object.create(cv.prototype)).constructor=qg,qg.prototype.nodeType="Vector2",kg.addShortcuts(qg.prototype,"value",["x","y"]),qg.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec2( "+this.x+", "+this.y+" )",n,e)},qg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,!0===this.readonly&&(e.readonly=!0)),e};var Jg=function(t,e,r){cv.call(this,"v3"),this.type="v3",this.value=new yu(t,e,r)};(Jg.prototype=Object.create(cv.prototype)).constructor=Jg,Jg.prototype.nodeType="Vector3",kg.addShortcuts(Jg.prototype,"value",["x","y","z"]),Jg.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",n,e)},Jg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,!0===this.readonly&&(e.readonly=!0)),e};var Zg=function(t,e,r,n){cv.call(this,"v4"),this.value=new Ru(t,e,r,n)};(Zg.prototype=Object.create(cv.prototype)).constructor=Zg,Zg.prototype.nodeType="Vector4",kg.addShortcuts(Zg.prototype,"value",["x","y","z","w"]),Zg.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",n,e)},Zg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,!0===this.readonly&&(e.readonly=!0)),e};var Qg=function(){rv.call(this),this.color=new Bg(15658734),this.specular=new Bg(1118481),this.shininess=new uv(30)};(Qg.prototype=Object.create(rv.prototype)).constructor=Qg,Qg.prototype.nodeType="Phong",Qg.prototype.build=function(t){var e,r=t.material;if(r.define("PHONG"),r.define("ALPHATEST","0.0"),r.requires.lights=!0,t.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;r.mergeUniform(wd.merge([Qp.fog,Qp.lights])),r.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&i.push(n.code,"transformed = "+n.result+";"),i.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>"),e=i.join("\n")}else{this.color.parse(t,{slot:"color"}),this.specular.parse(t),this.shininess.parse(t),this.alpha&&this.alpha.parse(t),this.normal&&this.normal.parse(t),this.normalScale&&this.normal&&this.normalScale.parse(t),this.light&&this.light.parse(t,{cache:"light"}),this.ao&&this.ao.parse(t),this.ambient&&this.ambient.parse(t),this.shadow&&this.shadow.parse(t),this.emissive&&this.emissive.parse(t,{slot:"emissive"}),this.environment&&this.environment.parse(t,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.parse(t);var o=this.color.buildCode(t,"c",{slot:"color"}),a=this.specular.buildCode(t,"c"),s=this.shininess.buildCode(t,"fv1"),l=this.alpha?this.alpha.buildCode(t,"fv1"):void 0,c=this.normal?this.normal.buildCode(t,"v3"):void 0,u=this.normalScale&&this.normal?this.normalScale.buildCode(t,"v2"):void 0,h=this.light?this.light.buildCode(t,"v3",{cache:"light"}):void 0,d=this.ao?this.ao.buildCode(t,"fv1"):void 0,p=this.ambient?this.ambient.buildCode(t,"c"):void 0,f=this.shadow?this.shadow.buildCode(t,"c"):void 0,m=this.emissive?this.emissive.buildCode(t,"c",{slot:"emissive"}):void 0,v=this.environment?this.environment.buildCode(t,"c",{slot:"environment"}):void 0,g=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(t,"fv1"):void 0;r.requires.transparent=void 0!=l,r.addFragmentPars(["#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n")),i=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;",o.code,"\tvec3 diffuseColor = "+o.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",a.code,"\tvec3 specular = "+a.result+";",s.code,"\tfloat shininess = max(0.0001,"+s.result+");","\tfloat specularStrength = 1.0;"],l&&i.push(l.code,"if ( "+l.result+" <= ALPHATEST ) discard;"),c&&(t.include("perturbNormal2Arb"),i.push(c.code),u&&i.push(u.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+c.result+","+(new av).build(t,"v2")+","+(u?u.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(h?"vec3( 1.0 )":"diffuseColor")+";"),i.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h&&(i.push(h.code,"reflectedLight.directDiffuse = "+h.result+";"),i.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),d&&i.push(d.code,"reflectedLight.indirectDiffuse *= "+d.result+";"),p&&i.push(p.code,"reflectedLight.indirectDiffuse += "+p.result+";"),f&&i.push(f.code,"reflectedLight.directDiffuse *= "+f.result+";","reflectedLight.directSpecular *= "+f.result+";"),m&&i.push(m.code,"reflectedLight.directDiffuse += "+m.result+";"),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),v&&(i.push(v.code),g?i.push(g.code,"outgoingLight = mix( outgoingLight, "+v.result+", "+g.result+" );"):i.push("outgoingLight = "+v.result+";")),i.push(l?"gl_FragColor = vec4( outgoingLight, "+l.result+" );":"gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),e=i.join("\n")}return e},Qg.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.specular=this.specular.toJSON(t).uuid,e.shininess=this.shininess.toJSON(t).uuid,this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.normalScale&&(e.normalScale=this.normalScale.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(e.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),e};var Kg=function(){this.node=new Qg,kg.call(this,this.node,this.node),this.type="PhongNodeMaterial"};(Kg.prototype=Object.create(kg.prototype)).constructor=Kg,kg.addShortcuts(Kg.prototype,"node",["color","alpha","specular","shininess","normal","normalScale","emissive","ambient","light","shadow","ao","environment","environmentAlpha","transform"]);var $g=function(){rv.call(this),this.color=new Bg(15658734),this.spherical=!0};($g.prototype=Object.create(rv.prototype)).constructor=$g,$g.prototype.nodeType="Sprite",$g.prototype.build=function(t){var e,r=t.material;if(r.define("SPRITE"),r.requires.lights=!1,r.requires.transparent=void 0!=this.alpha,t.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;r.mergeUniform(wd.merge([Qp.fog])),r.addVertexPars(["#include <fog_pars_vertex>"].join("\n")),e=["#include <begin_vertex>"],n&&e.push(n.code,"transformed = "+n.result+";"),e.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||e.push("modelMtx[1][1] = 1.0;"),e.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&e.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),e.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );")}else{r.addFragmentPars(["#include <fog_pars_fragment>"].join("\n")),this.color.parse(t,{slot:"color"}),this.alpha&&this.alpha.parse(t);var i=this.color.buildCode(t,"c",{slot:"color"}),o=this.alpha?this.alpha.buildCode(t,"fv1"):void 0;e=[i.code],o?e.push(o.code,"gl_FragColor = vec4( "+i.result+", "+o.result+" );"):e.push("gl_FragColor = vec4( "+i.result+", 1.0 );"),e.push("#include <fog_fragment>")}return e.join("\n")},$g.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,!1===this.spherical&&(e.spherical=!1),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid)),e};var ty=function(){this.node=new $g,kg.call(this,this.node,this.node),this.type="SpriteNodeMaterial"};(ty.prototype=Object.create(kg.prototype)).constructor=ty,kg.addShortcuts(ty.prototype,"node",["color","alpha","transform","spherical"]);var ey=function(){nv.call(this,"fv1")};ey.getSpecularMIPLevel=new iv(["float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {","\tfloat maxMIPLevelScalar = float( maxMIPLevel );","\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n")),(ey.prototype=Object.create(nv.prototype)).constructor=ey,ey.prototype.nodeType="RoughnessToBlinnExponent",ey.prototype.generate=function(t,e){var r=t.material;return t.isShader("fragment")?r.isDefined("PHYSICAL")?(t.include(ey.getSpecularMIPLevel),t.isCache("clearCoat")?t.format("getSpecularMIPLevel( Material_ClearCoat_BlinnShininessExponent( material ), 8 )",this.type,e):t.format("getSpecularMIPLevel( Material_BlinnShininessExponent( material ), 8 )",this.type,e)):(console.warn("RoughnessToBlinnExponentNode is only compatible with PhysicalMaterial."),t.format("0.0",this.type,e)):(console.warn("RoughnessToBlinnExponentNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,e))};var ry=function(){rv.call(this),this.color=new Bg(15658734),this.roughness=new uv(.5),this.metalness=new uv(.5)};(ry.prototype=Object.create(rv.prototype)).constructor=ry,ry.prototype.nodeType="Standard",ry.prototype.build=function(t){var e,r=t.material;if(r.define("PHYSICAL"),this.clearCoat||this.clearCoatRoughness||r.define("STANDARD"),r.define("ALPHATEST","0.0"),r.requires.lights=!0,r.extensions.shaderTextureLOD=!0,t.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;r.mergeUniform(wd.merge([Qp.fog,Qp.lights])),r.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&i.push(n.code,"transformed = "+n.result+";"),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),e=i.join("\n")}else{var o={bias:new ey,offsetU:0,offsetV:0},a=!r.isDefined("STANDARD");this.color.parse(t,{slot:"color"}),this.roughness.parse(t),this.metalness.parse(t),this.alpha&&this.alpha.parse(t),this.normal&&this.normal.parse(t),this.normalScale&&this.normal&&this.normalScale.parse(t),this.clearCoat&&this.clearCoat.parse(t),this.clearCoatRoughness&&this.clearCoatRoughness.parse(t),this.reflectivity&&this.reflectivity.parse(t),this.light&&this.light.parse(t,{cache:"light"}),this.ao&&this.ao.parse(t),this.ambient&&this.ambient.parse(t),this.shadow&&this.shadow.parse(t),this.emissive&&this.emissive.parse(t,{slot:"emissive"}),this.environment&&this.environment.parse(t,{cache:"env",requires:o,slot:"environment"});var s=this.color.buildCode(t,"c",{slot:"color"}),l=this.roughness.buildCode(t,"fv1"),c=this.metalness.buildCode(t,"fv1"),u=this.alpha?this.alpha.buildCode(t,"fv1"):void 0,h=this.normal?this.normal.buildCode(t,"v3"):void 0,d=this.normalScale&&this.normal?this.normalScale.buildCode(t,"v2"):void 0,p=this.clearCoat?this.clearCoat.buildCode(t,"fv1"):void 0,f=this.clearCoatRoughness?this.clearCoatRoughness.buildCode(t,"fv1"):void 0,m=this.reflectivity?this.reflectivity.buildCode(t,"fv1"):void 0,v=this.light?this.light.buildCode(t,"v3",{cache:"light"}):void 0,g=this.ao?this.ao.buildCode(t,"fv1"):void 0,y=this.ambient?this.ambient.buildCode(t,"c"):void 0,x=this.shadow?this.shadow.buildCode(t,"c"):void 0,b=this.emissive?this.emissive.buildCode(t,"c",{slot:"emissive"}):void 0,w=this.environment?this.environment.buildCode(t,"c",{cache:"env",requires:o,slot:"environment"}):void 0,_=a&&w?this.environment.buildCode(t,"c",{cache:"clearCoat",requires:o,slot:"environment"}):void 0;r.requires.transparent=void 0!=u,r.addFragmentPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_vertex>"].join("\n")),i=["\t#include <normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );",s.code,"\tvec3 diffuseColor = "+s.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",l.code,"\tfloat roughnessFactor = "+l.result+";",c.code,"\tfloat metalnessFactor = "+c.result+";"],u&&i.push(u.code,"if ( "+u.result+" <= ALPHATEST ) discard;"),h&&(t.include("perturbNormal2Arb"),i.push(h.code),d&&i.push(d.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+h.result+","+(new av).build(t,"v2")+","+(d?d.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(v?"vec3( 1.0 )":"diffuseColor * (1.0 - metalnessFactor)")+";"),i.push("material.specularRoughness = clamp( roughnessFactor, DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"),p?i.push(p.code,"material.clearCoat = saturate( "+p.result+" );"):a&&i.push("material.clearCoat = 0.0;"),f?i.push(f.code,"material.clearCoatRoughness = clamp( "+f.result+", DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"):a&&i.push("material.clearCoatRoughness = 0.0;"),m?i.push(m.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+m.result+" ) ), diffuseColor, metalnessFactor );"):i.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),i.push("#include <lights_fragment_begin>","#include <lights_fragment_end>"),v&&(i.push(v.code,"reflectedLight.directDiffuse = "+v.result+";"),i.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),g&&i.push(g.code,"reflectedLight.indirectDiffuse *= "+g.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+g.result+", material.specularRoughness );"),y&&i.push(y.code,"reflectedLight.indirectDiffuse += "+y.result+";"),x&&i.push(x.code,"reflectedLight.directDiffuse *= "+x.result+";","reflectedLight.directSpecular *= "+x.result+";"),b&&i.push(b.code,"reflectedLight.directDiffuse += "+b.result+";"),w&&(i.push(w.code),_&&i.push(_.code,"clearCoatRadiance += "+_.result+";"),i.push("RE_IndirectSpecular("+w.result+", clearCoatRadiance, geometry, material, reflectedLight );")),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),i.push(u?"gl_FragColor = vec4( outgoingLight, "+u.result+" );":"gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),e=i.join("\n")}return e},ry.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.roughness=this.roughness.toJSON(t).uuid,e.metalness=this.metalness.toJSON(t).uuid,this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.normalScale&&(e.normalScale=this.normalScale.toJSON(t).uuid),this.clearCoat&&(e.clearCoat=this.clearCoat.toJSON(t).uuid),this.clearCoatRoughness&&(e.clearCoatRoughness=this.clearCoatRoughness.toJSON(t).uuid),this.reflectivity&&(e.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid)),e};var ny=function(){this.node=new ry,kg.call(this,this.node,this.node),this.type="StandardNodeMaterial"};(ny.prototype=Object.create(kg.prototype)).constructor=ny,kg.addShortcuts(ny.prototype,"node",["color","alpha","roughness","metalness","reflectivity","clearCoat","clearCoatRoughness","normal","normalScale","emissive","ambient","light","shadow","ao","environment","transform"]);var iy=function(t,e){nv.call(this),this.a=t,this.method=e||iy.SIN};iy.RAD="radians",iy.DEG="degrees",iy.EXP="exp",iy.EXP2="exp2",iy.LOG="log",iy.LOG2="log2",iy.SQRT="sqrt",iy.INV_SQRT="inversesqrt",iy.FLOOR="floor",iy.CEIL="ceil",iy.NORMALIZE="normalize",iy.FRACT="fract",iy.SAT="saturate",iy.SIN="sin",iy.COS="cos",iy.TAN="tan",iy.ASIN="asin",iy.ACOS="acos",iy.ARCTAN="atan",iy.ABS="abs",iy.SIGN="sign",iy.LENGTH="length",iy.NEGATE="negate",iy.INVERT="invert",iy.prototype=Object.create(nv.prototype),iy.prototype.constructor=iy,iy.prototype.nodeType="Math1",iy.prototype.getType=function(t){switch(this.method){case iy.LENGTH:return"fv1"}return this.a.getType(t)},iy.prototype.generate=function(t,e){var r=this.getType(t),n=this.a.build(t,r);switch(this.method){case iy.NEGATE:n="(-"+n+")";break;case iy.INVERT:n="(1.0-"+n+")";break;default:n=this.method+"("+n+")"}return t.format(n,r,e)},iy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.method=this.method),e};var oy=function(t,e,r){nv.call(this),this.a=t,this.b=e,this.method=r||oy.DISTANCE};oy.MIN="min",oy.MAX="max",oy.MOD="mod",oy.STEP="step",oy.REFLECT="reflect",oy.DISTANCE="distance",oy.DOT="dot",oy.CROSS="cross",oy.POW="pow",oy.prototype=Object.create(nv.prototype),oy.prototype.constructor=oy,oy.prototype.nodeType="Math2",oy.prototype.getInputType=function(t){return t.getFormatLength(this.b.getType(t))>t.getFormatLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)},oy.prototype.getType=function(t){switch(this.method){case oy.DISTANCE:case oy.DOT:return"fv1";case oy.CROSS:return"v3"}return this.getInputType(t)},oy.prototype.generate=function(t,e){var r,n,i=this.getInputType(t),o=t.getFormatLength(this.a.getType(t)),a=t.getFormatLength(this.b.getType(t));switch(this.method){case oy.CROSS:r=this.a.build(t,"v3"),n=this.b.build(t,"v3");break;case oy.STEP:r=this.a.build(t,1==o?"fv1":i),n=this.b.build(t,i);break;case oy.MIN:case oy.MAX:case oy.MOD:r=this.a.build(t,i),n=this.b.build(t,1==a?"fv1":i);break;default:r=this.a.build(t,i),n=this.b.build(t,i)}return t.format(this.method+"("+r+","+n+")",this.getType(t),e)},oy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.method=this.method),e};var ay=function(t,e,r,n){nv.call(this),this.a=t,this.b=e,this.c=r,this.method=n||ay.MIX};ay.MIX="mix",ay.REFRACT="refract",ay.SMOOTHSTEP="smoothstep",ay.FACEFORWARD="faceforward",ay.prototype=Object.create(nv.prototype),ay.prototype.constructor=ay,ay.prototype.nodeType="Math3",ay.prototype.getType=function(t){var e=t.getFormatLength(this.a.getType(t)),r=t.getFormatLength(this.b.getType(t)),n=t.getFormatLength(this.c.getType(t));return e>r&&e>n?this.a.getType(t):r>n?this.b.getType(t):this.c.getType(t)},ay.prototype.generate=function(t,e){var r,n,i,o=this.getType(t),a=(t.getFormatLength(this.a.getType(t)),t.getFormatLength(this.b.getType(t)),t.getFormatLength(this.c.getType(t)));switch(this.method){case ay.REFRACT:r=this.a.build(t,o),n=this.b.build(t,o),i=this.c.build(t,"fv1");break;case ay.MIX:r=this.a.build(t,o),n=this.b.build(t,o),i=this.c.build(t,1==a?"fv1":o);break;default:r=this.a.build(t,o),n=this.b.build(t,o),i=this.c.build(t,o)}return t.format(this.method+"("+r+","+n+","+i+")",o,e)},ay.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.c=this.c.toJSON(t).uuid,e.method=this.method),e};var sy=function(t){this.time=void 0!==t?t:0,this.frameId=0};sy.prototype.update=function(t){return++this.frameId,this.time+=t,this.delta=t,this},sy.prototype.updateNode=function(t){return t.frameId===this.frameId?this:(t.updateFrame(this),t.frameId=this.frameId,this)};var ly=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(ly.prototype,{setSize:function(t,e){},render:function(t,e,r,n,i){console.error("Pass: .render() must be implemented in derived pass.")}});var cy=function(t,e){ly.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof _d?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=wd.clone(t.uniforms),this.material=new _d({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};cy.prototype=Object.assign(Object.create(ly.prototype),{constructor:cy,render:function(t,e,r,n,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var uy=function(){cy.call(this),this.name="",this.uuid=vu.generateUUID(),this.userData={},this.textureID="renderTexture",this.fragment=new Fg(new Yg),this.node=new kg,this.node.fragment=this.fragment,this.build()};(uy.prototype=Object.create(cy.prototype)).constructor=uy,kg.addShortcuts(uy.prototype,"fragment",["value"]),uy.prototype.build=function(){this.node.build(),this.uniforms=this.node.uniforms,this.material=this.node},uy.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.passes&&(t.passes={}),!t.passes[this.uuid]){var e={};e.uuid=this.uuid,e.type="NodePass",t.passes[this.uuid]=e,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.value=this.value.toJSON(t).uuid}return t.pass=this.uuid,t};var hy=function(t,e,r,n){nv.call(this,"v4"),this.value=t,this.coord=e||new av,this.radius=new qg(1,1),this.size=n,this.blurX=!0,this.blurY=!0,this.horizontal=new uv(1/64),this.vertical=new uv(1/64)};hy.fBlurX=new iv(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum;","}"].join("\n")),hy.fBlurY=new iv(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum;","}"].join("\n")),(hy.prototype=Object.create(nv.prototype)).constructor=hy,hy.prototype.nodeType="Blur",hy.prototype.updateFrame=function(t){if(this.size)this.horizontal.number=this.radius.x/this.size.x,this.vertical.number=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var e=this.value.value.image;this.horizontal.number=this.radius.x/e.width,this.vertical.number=this.radius.y/e.height}},hy.prototype.generate=function(t,e){var r=hy.fBlurX,n=hy.fBlurY;if(t.include(r),t.include(n),t.isShader("fragment")){var i,o=[];return this.blurX&&o.push(r.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.horizontal.build(t,"fv1")+")"),this.blurY&&o.push(n.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.vertical.build(t,"fv1")+")"),i=2==o.length?"("+o.join("+")+"/2.0)":o.length?"("+o[0]+")":"vec4( 0.0 )",t.format(i,this.getType(t),e)}return console.warn("BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)},hy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.coord=this.coord.toJSON(t).uuid,e.radius=this.radius.toJSON(t).uuid,this.size&&(e.size={x:this.size.x,y:this.size.y}),e.blurX=this.blurX,e.blurY=this.blurY),e};var dy=function(t,e,r){nv.call(this,"v3"),this.value=t,this.coord=e||new av,this.scale=r||new qg(1,1)};dy.fBumpToNormal=new iv(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, vec2 scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 + ( dBx * scale.x ), .5 + ( dBy * scale.y ), 1.0 );","}"].join("\n"),null,{derivatives:!0}),(dy.prototype=Object.create(nv.prototype)).constructor=dy,dy.prototype.nodeType="Bump",dy.prototype.generate=function(t,e){var r=dy.fBumpToNormal;return t.include(r),t.isShader("fragment")?t.format(r.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.scale.build(t,"v2")+")",this.getType(t),e):(console.warn("BumpNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e))},dy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.coord=this.coord.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e};var py=function(t,e,r){nv.call(this,"v3"),this.rgb=t,this.adjustment=e,this.method=r||py.SATURATION};py.SATURATION="saturation",py.HUE="hue",py.VIBRANCE="vibrance",py.BRIGHTNESS="brightness",py.CONTRAST="contrast",py.prototype=Object.create(nv.prototype),py.prototype.constructor=py,py.prototype.nodeType="ColorAdjustment",py.prototype.generate=function(t,e){var r,n=this.rgb.build(t,"v3"),i=this.adjustment.build(t,"fv1");switch(this.method){case py.SATURATION:r="saturation_rgb";break;case py.HUE:r="hue_rgb";break;case py.VIBRANCE:r="vibrance_rgb";break;case py.BRIGHTNESS:return t.format("("+n+"+"+i+")",this.getType(t),e);case py.CONTRAST:return t.format("("+n+"*"+i+")",this.getType(t),e)}return t.include(r),t.format(r+"("+n+","+i+")",this.getType(t),e)},py.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e};var fy=function(t,e,r,n){nv.call(this,"fv1"),this.x=t,this.y=e,this.z=r,this.w=n};fy.inputs=["x","y","z","w"],(fy.prototype=Object.create(nv.prototype)).constructor=fy,fy.prototype.nodeType="Join",fy.prototype.getNumElements=function(){for(var t=fy.inputs,e=t.length;e--;)if(void 0!==this[t[e]]){++e;break}return Math.max(e,2)},fy.prototype.getType=function(t){return t.getFormatFromLength(this.getNumElements())},fy.prototype.generate=function(t,e){for(var r=this.getType(t),n=this.getNumElements(),i=fy.inputs,o=[],a=0;a<n;a++){var s=this[i[a]];o.push(s?s.build(t,"fv1"):"0.")}var l=(n>1?t.getConstructorFromLength(n):"")+"("+o.join(",")+")";return t.format(l,r,e)},fy.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){(e=this.createJSONNode(t)).inputs={};for(var r=this.getNumElements(),n=fy.inputs,i=0;i<r;i++){var o=this[n[i]];o&&(e.inputs[n[i]]=o.toJSON(t).uuid)}}return e};var my=function(t){nv.call(this,"fv1"),this.rgb=t};(my.prototype=Object.create(nv.prototype)).constructor=my,my.prototype.nodeType="Luminance",my.prototype.generate=function(t,e){return t.include("luminance_rgb"),t.format("luminance_rgb("+this.rgb.build(t,"v3")+")",this.getType(t),e)},my.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid),e};var vy=function(t){nv.call(this,"fv1"),this.coord=t};(vy.prototype=Object.create(nv.prototype)).constructor=vy,vy.prototype.nodeType="Noise",vy.prototype.generate=function(t,e){return t.include("snoise"),t.format("snoise("+this.coord.build(t,"v2")+")",this.getType(t),e)},vy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).coord=this.coord.toJSON(t).uuid),e};var gy=function(t,e,r,n,i){nv.call(this,"v3"),this.value=t,this.scale=r||new uv(1),this.normal=n||new lv(lv.LOCAL),this.position=i||new sv(lv.VIEW)};(gy.prototype=Object.create(nv.prototype)).constructor=gy,gy.prototype.nodeType="NormalMap",gy.prototype.generate=function(t,e){return t.include("perturbNormal2Arb"),t.isShader("fragment")?t.format("perturbNormal2Arb(-"+this.position.build(t,"v3")+","+this.normal.build(t,"v3")+","+this.value.build(t,"v3")+","+this.value.coord.build(t,"v2")+","+this.scale.build(t,"v2")+")",this.getType(t),e):(console.warn("NormalMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e))},gy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.scale=this.scale.toJSON(t).uuid,e.normal=this.normal.toJSON(t).uuid,e.position=this.position.toJSON(t).uuid),e};var yy=function(t){qg.call(this),this.renderer=t};(yy.prototype=Object.create(qg.prototype)).constructor=yy,yy.prototype.nodeType="Resolution",yy.prototype.updateFrame=function(t){var e=this.renderer.getSize(),r=this.renderer.getPixelRatio();this.x=e.width*r,this.y=e.height*r},yy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).renderer=this.renderer.uuid),e};var xy=function(t,e){rv.call(this),this.node=t,this.components=e||"x"};(xy.prototype=Object.create(rv.prototype)).constructor=xy,xy.prototype.nodeType="Switch",xy.prototype.getType=function(t){return t.getFormatFromLength(this.components.length)},xy.prototype.generate=function(t,e){var r=this.node.getType(t),n=t.getFormatLength(r)-1,i=this.node.build(t,r);if(n>0){var o,a=0,s=t.colorToVector(this.components),l=s.length;for(o=0;o<l;o++)a=Math.max(a,t.getIndexByElement(s.charAt(o)));for(a>n&&(a=n),i+=".",o=0;o<l;o++){s.charAt(o);var c=t.getIndexByElement(s.charAt(o));c>a&&(c=a),i+=t.getElementByIndex(c)}return t.format(i,this.getType(t),e)}return t.format(i,r,e)},xy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).node=this.node.toJSON(t).uuid,e.components=this.components),e};var by=function(){iv.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=new av,this.transform=new Vg};(by.prototype=Object.create(iv.prototype)).constructor=by,by.prototype.nodeType="UVTransform",by.prototype.generate=function(t,e){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.transform,iv.prototype.generate.call(this,t,e)},by.prototype.setUvTransform=function(t,e,r,n,i,o,a){this.transform.value.setUvTransform(t,e,r,n,i,o=void 0!==o?o:.5,a=void 0!==a?a:.5)},by.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.transform=this.transform.toJSON(t).uuid),e};var wy=function(t,e){Jg.call(this),this.params={},this.velocity=new yu,this.setTarget(t),this.setParams(e)};(wy.prototype=Object.create(Jg.prototype)).constructor=wy,wy.prototype.nodeType="Velocity",wy.prototype.isReadonly=function(t){return!1},wy.prototype.setParams=function(t){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=t||{},this.params.type){case"elastic":this.moment=new yu,this.speed=new yu,this.springVelocity=new yu,this.lastVelocity=new yu}},wy.prototype.setTarget=function(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(),this.oldPosition=this.position.clone())},wy.prototype.updateFrameVelocity=function(t){this.target&&(this.position=this.target.getWorldPosition(),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},wy.prototype.updateFrame=function(t){switch(this.updateFrameVelocity(t),this.params.type){case"elastic":var e=t.delta*(this.params.fps||60),r=Math.pow(this.params.spring,e),n=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(n).multiplyScalar(1-r)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(r),this.moment.add(this.springVelocity),this.moment.multiplyScalar(n),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},wy.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params))),e};var _y=function(t){rv.call(this,t)};function Sy(t,e){this.min=void 0!==t?t:new Nu(1/0,1/0),this.max=void 0!==e?e:new Nu(-1/0,-1/0)}(_y.prototype=Object.create(rv.prototype)).constructor=_y,_y.prototype.nodeType="Var",_y.prototype.getType=function(t){return t.getTypeByFormat(this.type)},_y.prototype.generate=function(t,e){var r=t.material.getVar(this.uuid,this.type);return t.format(r.name,this.getType(t),e)},_y.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).out=this.type),e},Object.assign(Sy.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Nu;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("Box2: .getCenter() target is now required"),t=new Nu),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("Box2: .getSize() target is now required"),t=new Nu),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("Box2: .getParameter() target is now required"),e=new Nu),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("Box2: .clampPoint() target is now required"),e=new Nu),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Nu;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Ty=function(){zh.call(this,Ty.Geometry,new Dh({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var t=new yu,e=new ff(new Uint8Array(768),16,16,bh);e.minFilter=fh,e.magFilter=fh,e.wrapS=dh,e.wrapT=dh,e.needsUpdate=!0;var r=new ff(new Uint8Array(768),16,16,bh);r.minFilter=fh,r.magFilter=fh,r.wrapS=dh,r.wrapT=dh,r.needsUpdate=!0;var n=Ty.Geometry,i=new zd({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),o=new zd({uniforms:{map:{value:e},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),a=new zh(n,i),s=[],l=My.Shader,c=new zd({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new Eu(16777215)},scale:{value:new Nu},screenPosition:{value:new yu}},vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:2,transparent:!0,depthWrite:!1}),u=new zh(n,c);this.addElement=function(t){s.push(t)};var h=new Nu,d=new Nu,p=new Sy,f=new Ru;this.onBeforeRender=function(l,m,v){f.copy(l.getCurrentViewport());var g=f.z/2,y=f.w/2;if(h.set((T=16/f.w)*(f.w/f.z),T),p.min.set(f.x,f.y),p.max.set(f.x+(f.z-16),f.y+(f.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(v.matrixWorldInverse),t.applyMatrix4(v.projectionMatrix),d.x=f.x+t.x*g+g-8,d.y=f.y+t.y*y+y-8,p.containsPoint(d)){l.copyFramebufferToTexture(d,e),(S=i.uniforms).scale.value=h,S.screenPosition.value=t,l.renderBufferDirect(v,null,n,i,a,null),l.copyFramebufferToTexture(d,r),(S=o.uniforms).scale.value=h,S.screenPosition.value=t,l.renderBufferDirect(v,null,n,o,a,null);for(var x=2*-t.x,b=2*-t.y,w=0,_=s.length;w<_;w++){var S,T,M=s[w];(S=c.uniforms).color.value.copy(M.color),S.map.value=M.texture,S.screenPosition.value.x=t.x+x*M.distance,S.screenPosition.value.y=t.y+b*M.distance,S.scale.value.set((T=M.size/f.w)*(f.w/f.z),T),c.uniformsNeedUpdate=!0,l.renderBufferDirect(v,null,n,c,u,null)}}},this.dispose=function(){i.dispose(),o.dispose(),c.dispose(),e.dispose(),r.dispose();for(var t=0,n=s.length;t<n;t++)s[t].texture.dispose()}};Ty.prototype=Object.create(zh.prototype),Ty.prototype.constructor=Ty,Ty.prototype.isLensflare=!0;var My=function(t,e,r,n){this.texture=t,this.size=e||1,this.distance=r||0,this.color=n||new Eu(16777215)};My.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},Ty.Geometry=function(){var t=new Yu,e=new bf(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5);return t.setIndex([0,1,2,0,2,3]),t.addAttribute("position",new _f(e,3,0,!1)),t.addAttribute("uv",new _f(e,2,3,!1)),t}();var Ay=function(t,e){zh.call(this,t),this.type="Reflector";var r=this,n=new Eu(void 0!==(e=e||{}).color?e.color:8355711),i=e.textureWidth||512,o=e.textureHeight||512,a=e.clipBias||0,s=e.shader||Ay.ReflectorShader,l=void 0!==e.recursion?e.recursion:0,c=new Bh,u=new yu,h=new yu,d=new yu,p=new gu,f=new yu(0,0,-1),m=new Ru,v=new Ru,g=new yu,y=new yu,x=new Ru,b=new gu,w=new fd,_=new bd(i,o,{minFilter:mh,magFilter:mh,format:bh,stencilBuffer:!1});vu.isPowerOfTwo(i)&&vu.isPowerOfTwo(o)||(_.texture.generateMipmaps=!1);var S=new _d({uniforms:wd.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});S.uniforms.tDiffuse.value=_.texture,S.uniforms.color.value=n,S.uniforms.textureMatrix.value=b,this.material=S,this.onBeforeRender=function(t,e,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),p.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(p),g.subVectors(h,d),!(g.dot(u)>0)){g.reflect(u).negate(),g.add(h),p.extractRotation(n.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),y.subVectors(h,f),y.reflect(u).negate(),y.add(h),w.position.copy(g),w.up.set(0,1,0),w.up.applyMatrix4(p),w.up.reflect(u),w.lookAt(y),w.far=n.far,w.updateMatrixWorld(),w.projectionMatrix.copy(n.projectionMatrix),w.userData.recursion=0,b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(w.projectionMatrix),b.multiply(w.matrixWorldInverse),b.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(w.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var i=w.projectionMatrix;x.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],x.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],x.z=-1,x.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(x)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-a,i.elements[14]=m.w,r.visible=!1;var o=t.getRenderTarget(),s=t.vr.enabled,S=t.shadowMap.autoUpdate;t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(e,w,_,!0),t.vr.enabled=s,t.shadowMap.autoUpdate=S,t.setRenderTarget(o);var T=n.bounds;if(void 0!==T){var M=t.getSize(),A=t.getPixelRatio();v.x=T.x*M.width*A,v.y=T.y*M.height*A,v.z=T.z*M.width*A,v.w=T.w*M.height*A,t.state.viewport(v)}r.visible=!0}},this.getRenderTarget=function(){return _}};Ay.prototype=Object.create(zh.prototype),Ay.prototype.constructor=Ay,Ay.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},Object.create(Ay.prototype);var Ey=function(t,e){zh.call(this,t),this.type="Refractor";var r=this,n=new Eu(void 0!==(e=e||{}).color?e.color:8355711),i=e.textureWidth||512,o=e.textureHeight||512,a=e.clipBias||0,s=e.shader||Ey.RefractorShader,l=new fd;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var c=new Bh,u=new gu,h=new bd(i,o,{minFilter:mh,magFilter:mh,format:bh,stencilBuffer:!1});vu.isPowerOfTwo(i)&&vu.isPowerOfTwo(o)||(h.texture.generateMipmaps=!1),this.material=new _d({uniforms:wd.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=h.texture,this.material.uniforms.textureMatrix.value=u;var d=function(){var t=new yu,e=new yu,n=new gu,i=new yu,o=new yu;return function(a){return t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(a.matrixWorld),i.subVectors(t,e),n.extractRotation(r.matrixWorld),o.set(0,0,1),o.applyMatrix4(n),i.dot(o)<0}}(),p=function(){var t=new yu,e=new yu,n=new xu,i=new yu;return function(){r.matrixWorld.decompose(e,n,i),t.set(0,0,1).applyQuaternion(n).normalize(),t.negate(),c.setFromNormalAndCoplanarPoint(t,e)}}(),f=function(){var t=new Bh,e=new Ru,r=new Ru;return function(n){l.matrixWorld.copy(n.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(n.projectionMatrix),l.far=n.far,t.copy(c),t.applyMatrix4(l.matrixWorldInverse),e.set(t.normal.x,t.normal.y,t.normal.z,t.constant);var i=l.projectionMatrix;r.x=(Math.sign(e.x)+i.elements[8])/i.elements[0],r.y=(Math.sign(e.y)+i.elements[9])/i.elements[5],r.z=-1,r.w=(1+i.elements[10])/i.elements[14],e.multiplyScalar(2/e.dot(r)),i.elements[2]=e.x,i.elements[6]=e.y,i.elements[10]=e.z+1-a,i.elements[14]=e.w}}(),m=function(){var t=new Ru;return function(e,n,i){r.visible=!1;var o=e.getRenderTarget(),a=e.vr.enabled,s=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(n,l,h,!0),e.vr.enabled=a,e.shadowMap.autoUpdate=s,e.setRenderTarget(o);var c=i.bounds;if(void 0!==c){var u=e.getSize(),d=e.getPixelRatio();t.x=c.x*u.width*d,t.y=c.y*u.height*d,t.z=c.z*u.width*d,t.w=c.w*u.height*d,e.state.viewport(t)}r.visible=!0}}();this.onBeforeRender=function(t,e,n){!0!==n.userData.refractor&&1!=!d(n)&&(p(),function(t){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(t.projectionMatrix),u.multiply(t.matrixWorldInverse),u.multiply(r.matrixWorld)}(n),f(n),m(t,e,n))},this.getRenderTarget=function(){return h}};Ey.prototype=Object.create(zh.prototype),Ey.prototype.constructor=Ey,Ey.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Cy=function(t){var e=new Dh({color:0,transparent:!0,opacity:.6,depthWrite:!1});zh.call(this,t.geometry,e),this.meshMatrix=t.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1};(Cy.prototype=Object.create(zh.prototype)).constructor=Cy,Cy.prototype.update=function(){var t=new gu;return function(e,r){var n=e.normal.x*r.x+e.normal.y*r.y+e.normal.z*r.z+-e.constant*r.w,i=t.elements;i[0]=n-r.x*e.normal.x,i[4]=-r.x*e.normal.y,i[8]=-r.x*e.normal.z,i[12]=-r.x*-e.constant,i[1]=-r.y*e.normal.x,i[5]=n-r.y*e.normal.y,i[9]=-r.y*e.normal.z,i[13]=-r.y*-e.constant,i[2]=-r.z*e.normal.x,i[6]=-r.z*e.normal.y,i[10]=n-r.z*e.normal.z,i[14]=-r.z*-e.constant,i[3]=-r.w*e.normal.x,i[7]=-r.w*e.normal.y,i[11]=-r.w*e.normal.z,i[15]=n-r.w*-e.constant,this.matrix.multiplyMatrices(t,this.meshMatrix)}}();var Py=function(){var t=Py.SkyShader,e=new _d({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:wd.clone(t.uniforms),side:Qu});zh.call(this,new Yh(1,1,1),e)};Py.prototype=Object.create(zh.prototype),Py.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new yu}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var Oy=function(t,e){zh.call(this,t);var r=this,n=void 0!==(e=e||{}).textureWidth?e.textureWidth:512,i=void 0!==e.textureHeight?e.textureHeight:512,o=void 0!==e.clipBias?e.clipBias:0,a=void 0!==e.alpha?e.alpha:1,s=void 0!==e.time?e.time:0,l=void 0!==e.waterNormals?e.waterNormals:null,c=void 0!==e.sunDirection?e.sunDirection:new yu(.70707,.70707,0),u=new Eu(void 0!==e.sunColor?e.sunColor:16777215),h=new Eu(void 0!==e.waterColor?e.waterColor:8355711),d=void 0!==e.eye?e.eye:new yu(0,0,0),p=void 0!==e.distortionScale?e.distortionScale:20,f=void 0!==e.side?e.side:Zu,m=void 0!==e.fog&&e.fog,v=new Bh,g=new yu,y=new yu,x=new yu,b=new gu,w=new yu(0,0,-1),_=new Ru,S=new yu,T=new yu,M=new Ru,A=new gu,E=new fd,C=new bd(n,i,{minFilter:mh,magFilter:mh,format:bh,stencilBuffer:!1});vu.isPowerOfTwo(n)&&vu.isPowerOfTwo(i)||(C.texture.generateMipmaps=!1);var P={uniforms:wd.merge([Qp.fog,Qp.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new gu},sunColor:{value:new Eu(8355711)},sunDirection:{value:new yu(.70707,.70707,0)},eye:{value:new yu},waterColor:{value:new Eu(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",Zp.fog_pars_vertex,Zp.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Zp.fog_vertex,Zp.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",Zp.common,Zp.packing,Zp.bsdfs,Zp.fog_pars_fragment,Zp.lights_pars_begin,Zp.shadowmap_pars_fragment,Zp.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",Zp.tonemapping_fragment,Zp.fog_fragment,"}"].join("\n")},O=new _d({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:wd.clone(P.uniforms),transparent:!0,lights:!0,side:f,fog:m});O.uniforms.mirrorSampler.value=C.texture,O.uniforms.textureMatrix.value=A,O.uniforms.alpha.value=a,O.uniforms.time.value=s,O.uniforms.normalSampler.value=l,O.uniforms.sunColor.value=u,O.uniforms.waterColor.value=h,O.uniforms.sunDirection.value=c,O.uniforms.distortionScale.value=p,O.uniforms.eye.value=d,r.material=O,r.onBeforeRender=function(t,e,n){if(y.setFromMatrixPosition(r.matrixWorld),x.setFromMatrixPosition(n.matrixWorld),b.extractRotation(r.matrixWorld),g.set(0,0,1),g.applyMatrix4(b),S.subVectors(y,x),!(S.dot(g)>0)){S.reflect(g).negate(),S.add(y),b.extractRotation(n.matrixWorld),w.set(0,0,-1),w.applyMatrix4(b),w.add(x),T.subVectors(y,w),T.reflect(g).negate(),T.add(y),E.position.copy(S),E.up.set(0,1,0),E.up.applyMatrix4(b),E.up.reflect(g),E.lookAt(T),E.far=n.far,E.updateMatrixWorld(),E.projectionMatrix.copy(n.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(E.projectionMatrix),A.multiply(E.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(g,y),v.applyMatrix4(E.matrixWorldInverse),_.set(v.normal.x,v.normal.y,v.normal.z,v.constant);var i=E.projectionMatrix;M.x=(Math.sign(_.x)+i.elements[8])/i.elements[0],M.y=(Math.sign(_.y)+i.elements[9])/i.elements[5],M.z=-1,M.w=(1+i.elements[10])/i.elements[14],_.multiplyScalar(2/_.dot(M)),i.elements[2]=_.x,i.elements[6]=_.y,i.elements[10]=_.z+1-o,i.elements[14]=_.w,d.setFromMatrixPosition(n.matrixWorld);var a=t.getRenderTarget(),s=t.vr.enabled,l=t.shadowMap.autoUpdate;r.visible=!1,t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(e,E,C,!0),r.visible=!0,t.vr.enabled=s,t.shadowMap.autoUpdate=l,t.setRenderTarget(a)}}};function Ny(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Ly(t,e){zh.call(this,t),this.type="Water2";var r=this,n=new Eu(void 0!==(e=e||{}).color?e.color:16777215),i=e.textureWidth||512,o=e.textureHeight||512,a=e.clipBias||0,s=e.flowDirection||new Nu(1,0),l=e.flowSpeed||.03,c=e.reflectivity||.02,u=e.scale||1,h=e.shader||Ly.Water2Shader,d=new Xd,p=e.flowMap||void 0,f=e.normalMap0||d.load("textures/water/Water2_1_M_Normal.jpg"),m=e.normalMap1||d.load("textures/water/Water2_2_M_Normal.jpg"),v=new gu,g=new Ny;if(void 0!==Ay)if(void 0!==Ey){var y=new Ay(t,{textureWidth:i,textureHeight:o,clipBias:a}),x=new Ey(t,{textureWidth:i,textureHeight:o,clipBias:a});y.matrixAutoUpdate=!1,x.matrixAutoUpdate=!1,this.material=new _d({uniforms:wd.merge([Qp.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==p?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:p}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=hh,m.wrapS=m.wrapT=hh,this.material.uniforms.tReflectionMap.value=y.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=x.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=n,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=v,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=u,this.onBeforeRender=function(t,e,n){!function(t){v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(t.projectionMatrix),v.multiply(t.matrixWorldInverse),v.multiply(r.matrixWorld)}(n),function(){var t=g.getDelta(),e=r.material.uniforms.config;e.value.x+=l*t,e.value.y=e.value.x+.075,e.value.x>=.15?(e.value.x=0,e.value.y=.075):e.value.y>=.15&&(e.value.y=e.value.y-.15)}(),r.visible=!1,y.matrixWorld.copy(r.matrixWorld),x.matrixWorld.copy(r.matrixWorld),y.onBeforeRender(t,e,n),x.onBeforeRender(t,e,n),r.visible=!0}}else console.error("Water2: Required component Refractor not found.");else console.error("Water2: Required component Reflector not found.")}Oy.prototype=Object.create(zh.prototype),Oy.prototype.constructor=Oy,Object.assign(Ny.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),(Ly.prototype=Object.create(zh.prototype)).constructor=Ly,Ly.Water2Shader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new Ru}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")};var Iy=function(t,e,r,n){function i(t,e){return void 0!==t?t:e}this.changed=!0,this.initial=!0,this.oceanCamera=new gd,this.oceanCamera.position.z=1,this.renderer=t,this.renderer.clearColor(16777215),this.scene=new vd,this.clearColor=i((n=n||{}).CLEAR_COLOR,[1,1,1,0]),this.geometryOrigin=i(n.GEOMETRY_ORIGIN,[-1e3,-1e3]),this.sunDirectionX=i(n.SUN_DIRECTION[0],-1),this.sunDirectionY=i(n.SUN_DIRECTION[1],1),this.sunDirectionZ=i(n.SUN_DIRECTION[2],1),this.oceanColor=i(n.OCEAN_COLOR,new yu(.004,.016,.047)),this.skyColor=i(n.SKY_COLOR,new yu(3.2,9.6,12.8)),this.exposure=i(n.EXPOSURE,.35),this.geometryResolution=i(n.GEOMETRY_RESOLUTION,32),this.geometrySize=i(n.GEOMETRY_SIZE,2e3),this.resolution=i(n.RESOLUTION,64),this.floatSize=i(n.SIZE_OF_FLOAT,4),this.windX=i(n.INITIAL_WIND[0],10),this.windY=i(n.INITIAL_WIND[1],10),this.size=i(n.INITIAL_SIZE,250),this.choppiness=i(n.INITIAL_CHOPPINESS,1.5),this.matrixNeedsUpdate=!1;var o=i(n.USE_HALF_FLOAT,!1)?1016:1015,a={minFilter:mh,magFilter:mh,wrapS:dh,wrapT:dh,format:wh,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o},s={minFilter:fh,magFilter:fh,wrapS:dh,wrapT:dh,format:wh,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o};this.initialSpectrumFramebuffer=new bd(this.resolution,this.resolution,{minFilter:fh,magFilter:fh,wrapS:hh,wrapT:hh,format:wh,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o}),this.spectrumFramebuffer=new bd(this.resolution,this.resolution,s),this.pingPhaseFramebuffer=new bd(this.resolution,this.resolution,s),this.pongPhaseFramebuffer=new bd(this.resolution,this.resolution,s),this.pingTransformFramebuffer=new bd(this.resolution,this.resolution,s),this.pongTransformFramebuffer=new bd(this.resolution,this.resolution,s),this.displacementMapFramebuffer=new bd(this.resolution,this.resolution,a),this.normalMapFramebuffer=new bd(this.resolution,this.resolution,a);var l=Kp.ocean_sim_vertex,c=Kp.ocean_subtransform,u=wd.clone(c.uniforms);this.materialOceanHorizontal=new _d({uniforms:u,vertexShader:l.vertexShader,fragmentShader:"#define HORIZONTAL \n"+c.fragmentShader}),this.materialOceanHorizontal.uniforms.u_transformSize={value:this.resolution},this.materialOceanHorizontal.uniforms.u_subtransformSize={value:null},this.materialOceanHorizontal.uniforms.u_input={value:null},this.materialOceanHorizontal.depthTest=!1;var h=Kp.ocean_subtransform,d=wd.clone(h.uniforms);this.materialOceanVertical=new _d({uniforms:d,vertexShader:l.vertexShader,fragmentShader:h.fragmentShader}),this.materialOceanVertical.uniforms.u_transformSize={value:this.resolution},this.materialOceanVertical.uniforms.u_subtransformSize={value:null},this.materialOceanVertical.uniforms.u_input={value:null},this.materialOceanVertical.depthTest=!1;var p=Kp.ocean_initial_spectrum,f=wd.clone(p.uniforms);this.materialInitialSpectrum=new _d({uniforms:f,vertexShader:l.vertexShader,fragmentShader:p.fragmentShader}),this.materialInitialSpectrum.uniforms.u_wind={value:new Nu},this.materialInitialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialInitialSpectrum.depthTest=!1;var m=Kp.ocean_phase,v=wd.clone(m.uniforms);this.materialPhase=new _d({uniforms:v,vertexShader:l.vertexShader,fragmentShader:m.fragmentShader}),this.materialPhase.uniforms.u_resolution={value:this.resolution},this.materialPhase.depthTest=!1;var g=Kp.ocean_spectrum,y=wd.clone(g.uniforms);this.materialSpectrum=new _d({uniforms:y,vertexShader:l.vertexShader,fragmentShader:g.fragmentShader}),this.materialSpectrum.uniforms.u_initialSpectrum={value:null},this.materialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialSpectrum.depthTest=!1;var x=Kp.ocean_normals,b=wd.clone(x.uniforms);this.materialNormal=new _d({uniforms:b,vertexShader:l.vertexShader,fragmentShader:x.fragmentShader}),this.materialNormal.uniforms.u_displacementMap={value:null},this.materialNormal.uniforms.u_resolution={value:this.resolution},this.materialNormal.depthTest=!1;var w=Kp.ocean_main,_=wd.clone(w.uniforms);this.materialOcean=new _d({uniforms:_,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}),this.materialOcean.uniforms.u_geometrySize={value:this.resolution},this.materialOcean.uniforms.u_displacementMap={value:this.displacementMapFramebuffer.texture},this.materialOcean.uniforms.u_normalMap={value:this.normalMapFramebuffer.texture},this.materialOcean.uniforms.u_oceanColor={value:this.oceanColor},this.materialOcean.uniforms.u_skyColor={value:this.skyColor},this.materialOcean.uniforms.u_sunDirection={value:new yu(this.sunDirectionX,this.sunDirectionY,this.sunDirectionZ)},this.materialOcean.uniforms.u_exposure={value:this.exposure},this.materialOceanHorizontal.blending=0,this.materialOceanVertical.blending=0,this.materialInitialSpectrum.blending=0,this.materialPhase.blending=0,this.materialSpectrum.blending=0,this.materialNormal.blending=0,this.materialOcean.blending=0,this.screenQuad=new zh(new Td(2,2)),this.scene.add(this.screenQuad),this.generateSeedPhaseTexture(),this.generateMesh()};function Ry(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new Yu;i.setIndex(new Du(r,1)),i.addAttribute("position",new Du(n,3)),Kf.call(this,i,new Fh({color:e})),this.matrixAutoUpdate=!1,this.update()}function Dy(t){return!isNaN(t)&&isFinite(t)}function Fy(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}Iy.prototype.generateMesh=function(){var t=new Td(this.geometrySize,this.geometrySize,this.geometryResolution,this.geometryResolution);t.rotateX(-Math.PI/2),this.oceanMesh=new zh(t,this.materialOcean)},Iy.prototype.render=function(){this.scene.overrideMaterial=null,this.changed&&this.renderInitialSpectrum(),this.renderWavePhase(),this.renderSpectrum(),this.renderSpectrumFFT(),this.renderNormalMap(),this.scene.overrideMaterial=null},Iy.prototype.generateSeedPhaseTexture=function(){this.pingPhase=!0;for(var t=new window.Float32Array(this.resolution*this.resolution*4),e=0;e<this.resolution;e++)for(var r=0;r<this.resolution;r++)t[e*this.resolution*4+4*r]=2*Math.random()*Math.PI,t[e*this.resolution*4+4*r+1]=0,t[e*this.resolution*4+4*r+2]=0,t[e*this.resolution*4+4*r+3]=0;this.pingPhaseTexture=new ff(t,this.resolution,this.resolution,wh),this.pingPhaseTexture.wrapS=dh,this.pingPhaseTexture.wrapT=dh,this.pingPhaseTexture.type=1015,this.pingPhaseTexture.needsUpdate=!0},Iy.prototype.renderInitialSpectrum=function(){this.scene.overrideMaterial=this.materialInitialSpectrum,this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX,this.windY),this.materialInitialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.initialSpectrumFramebuffer,!0)},Iy.prototype.renderWavePhase=function(){this.scene.overrideMaterial=this.materialPhase,this.screenQuad.material=this.materialPhase,this.initial?(this.materialPhase.uniforms.u_phases.value=this.pingPhaseTexture,this.initial=!1):this.materialPhase.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialPhase.uniforms.u_deltaTime.value=this.deltaTime,this.materialPhase.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.pingPhase?this.pongPhaseFramebuffer:this.pingPhaseFramebuffer),this.pingPhase=!this.pingPhase},Iy.prototype.renderSpectrum=function(){this.scene.overrideMaterial=this.materialSpectrum,this.materialSpectrum.uniforms.u_initialSpectrum.value=this.initialSpectrumFramebuffer.texture,this.materialSpectrum.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialSpectrum.uniforms.u_choppiness.value=this.choppiness,this.materialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.spectrumFramebuffer)},Iy.prototype.renderSpectrumFFT=function(){var t=Math.log(this.resolution)/Math.log(2);this.scene.overrideMaterial=this.materialOceanHorizontal;for(var e=0;e<t;e++)0===e?(this.materialOceanHorizontal.uniforms.u_input.value=this.spectrumFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer)):e%2==1?(this.materialOceanHorizontal.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanHorizontal.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer));for(this.scene.overrideMaterial=this.materialOceanVertical,e=t;e<2*t;e++)e===2*t-1?(this.materialOceanVertical.uniforms.u_input.value=t%2==0?this.pingTransformFramebuffer.texture:this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.displacementMapFramebuffer)):e%2==1?(this.materialOceanVertical.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanVertical.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer))},Iy.prototype.renderNormalMap=function(){this.scene.overrideMaterial=this.materialNormal,this.changed&&(this.materialNormal.uniforms.u_size.value=this.size),this.materialNormal.uniforms.u_displacementMap.value=this.displacementMapFramebuffer.texture,this.renderer.render(this.scene,this.oceanCamera,this.normalMapFramebuffer,!0)},(Ry.prototype=Object.create(Kf.prototype)).constructor=Ry,Ry.prototype.update=function(){var t=new Pu;return function(e){if(void 0!==e&&console.warn("BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var r=t.min,n=t.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Ry.prototype.setFromObject=function(t){return this.object=t,this.update(),this};var Uy=function(t){if((t=t||{}).tree=this,this.nodeCount=0,this.INDEX_INSIDE_CROSS=-1,this.INDEX_OUTSIDE_OFFSET=2,this.INDEX_OUTSIDE_POS_X=Dy(t.INDEX_OUTSIDE_POS_X)?t.INDEX_OUTSIDE_POS_X:0,this.INDEX_OUTSIDE_NEG_X=Dy(t.INDEX_OUTSIDE_NEG_X)?t.INDEX_OUTSIDE_NEG_X:1,this.INDEX_OUTSIDE_POS_Y=Dy(t.INDEX_OUTSIDE_POS_Y)?t.INDEX_OUTSIDE_POS_Y:2,this.INDEX_OUTSIDE_NEG_Y=Dy(t.INDEX_OUTSIDE_NEG_Y)?t.INDEX_OUTSIDE_NEG_Y:3,this.INDEX_OUTSIDE_POS_Z=Dy(t.INDEX_OUTSIDE_POS_Z)?t.INDEX_OUTSIDE_POS_Z:4,this.INDEX_OUTSIDE_NEG_Z=Dy(t.INDEX_OUTSIDE_NEG_Z)?t.INDEX_OUTSIDE_NEG_Z:5,this.INDEX_OUTSIDE_MAP=[],this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1},this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1,this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1,this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1,this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1,this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1,this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1,this.utilVec31Search=new yu,this.utilVec32Search=new yu,this.scene=t.scene,this.scene){var e=new Ry(new zh(new Xh(1,1,1)),16711782);this.visualGeometry=e.geometry,this.visualMaterial=e.material}this.objects=[],this.objectsMap={},this.objectsData=[],this.objectsDeferred=[],this.depthMax=Dy(t.depthMax)?t.depthMax:1/0,this.objectsThreshold=Dy(t.objectsThreshold)?t.objectsThreshold:8,this.overlapPct=Dy(t.overlapPct)?t.overlapPct:.15,this.undeferred=t.undeferred||!1,this.root=t.root instanceof By?t.root:new By(t)};Uy.prototype={update:function(){if(this.objectsDeferred.length>0){for(var t=0,e=this.objectsDeferred.length;t<e;t++){var r=this.objectsDeferred[t];this.addDeferred(r.object,r.options)}this.objectsDeferred.length=0}},add:function(t,e){this.undeferred?(this.updateObject(t),this.addDeferred(t,e)):this.objectsDeferred.push({object:t,options:e})},addDeferred:function(t,e){var r,n,i,o,a,s;if(t instanceof ky&&(t=t.object),t.uuid||(t.uuid=vu.generateUUID()),!this.objectsMap[t.uuid])if(this.objects.push(t),this.objectsMap[t.uuid]=t,e&&(o=e.useFaces,s=e.useVertices),!0===s)for(r=0,n=(a=t.geometry.vertices).length;r<n;r++)this.addObjectData(t,a[r]);else if(!0===o)for(r=0,n=(i=t.geometry.faces).length;r<n;r++)this.addObjectData(t,i[r]);else this.addObjectData(t)},addObjectData:function(t,e){var r=new ky(t,e);this.objectsData.push(r),this.root.addObject(r)},remove:function(t){var e,r,n,i,o=t;if(t instanceof ky&&(t=t.object),this.objectsMap[t.uuid]){if(this.objectsMap[t.uuid]=void 0,-1!==(n=Fy(this.objects,t)))for(this.objects.splice(n,1),e=0,r=(i=this.root.removeObject(o)).length;e<r;e++)-1!==(n=Fy(this.objectsData,o=i[e]))&&this.objectsData.splice(n,1)}else this.objectsDeferred.length>0&&-1!==(n=function(t,e,r){for(var n=0,i=t.length;n<i;n++)if(t[n].object===r)return n;return-1}(this.objectsDeferred,0,t))&&this.objectsDeferred.splice(n,1)},extend:function(t){var e,r,n,i;if(t instanceof Uy)for(e=0,r=(n=t.objectsData).length;e<r;e++)this.add(i=n[e],{useFaces:i.faces,useVertices:i.vertices})},rebuild:function(){var t,e,r,n,i,o=[];for(t=0,e=this.objectsData.length;t<e;t++)r=(n=this.objectsData[t]).node,n.update(),r instanceof By&&!n.positionLast.equals(n.position)&&(i=n.indexOctant,r.getOctantIndex(n)!==i&&o.push(n));for(t=0,e=o.length;t<e;t++)(n=o[t]).node.removeObject(n),this.root.addObject(n)},updateObject:function(t){var e,r,n,i,o=[t];for(n=t.parent;n;)o.push(n),n=n.parent;for(e=0,r=o.length;e<r;e++)!0===(n=o[e]).matrixWorldNeedsUpdate&&(i=n);void 0!==i&&i.updateMatrixWorld()},search:function(t,e,r,n){var i,o,a,s,l,c,u,h,d,p;for(a=[].concat(this.root.objects),e>0||(e=Number.MAX_VALUE),n instanceof yu&&(n=this.utilVec31Search.copy(n).normalize(),p=this.utilVec32Search.set(1,1,1).divide(n)),i=0,o=this.root.nodesIndices.length;i<o;i++)a=this.root.nodesByIndex[this.root.nodesIndices[i]].search(t,e,a,n,p);if(!0===r)for(c=[],h=[],i=0,o=a.length;i<o;i++)-1===(d=Fy(h,l=(s=a[i]).object))?(c.push(u={object:l,faces:[],vertices:[]}),h.push(l)):u=c[d],s.faces?u.faces.push(s.faces):s.vertices&&u.vertices.push(s.vertices);else c=a;return c},setRoot:function(t){t instanceof By&&(this.root=t,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};var ky=function(t,e){this.object=t,e instanceof Cu?(this.faces=e,this.face3=!0,this.utilVec31FaceBounds=new yu):e instanceof yu&&(this.vertices=e),this.radius=0,this.position=new yu,this.object instanceof Mu&&this.update(),this.positionLast=this.position.clone()};ky.prototype={update:function(){this.face3?(this.radius=this.getFace3BoundingRadius(this.object,this.faces),this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.vertices?(this.radius=this.object.material.size||1,this.position.copy(this.vertices).applyMatrix4(this.object.matrixWorld)):this.object.geometry?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius,this.position.copy(this.object.geometry.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):(this.radius=this.object.boundRadius,this.position.setFromMatrixPosition(this.object.matrixWorld)),this.radius=this.radius*Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)},getFace3BoundingRadius:function(t,e){void 0===e.centroid&&(e.centroid=new yu);var r=(t.geometry||t).vertices,n=e.centroid,i=r[e.a],o=r[e.b],a=r[e.c],s=this.utilVec31FaceBounds;return n.addVectors(i,o).add(a).divideScalar(3),Math.max(s.subVectors(n,i).length(),s.subVectors(n,o).length(),s.subVectors(n,a).length())}};var By=function(t){this.utilVec31Branch=new yu,this.utilVec31Expand=new yu,this.utilVec31Ray=new yu,(t=t||{}).tree instanceof Uy?this.tree=t.tree:t.parent instanceof By!=1&&(t.root=this,this.tree=new Uy(t)),this.id=this.tree.nodeCount++,this.position=t.position instanceof yu?t.position:new yu,this.radius=t.radius>0?t.radius:1,this.indexOctant=t.indexOctant,this.depth=0,this.reset(),this.setParent(t.parent),this.overlap=this.radius*this.tree.overlapPct,this.radiusOverlap=this.radius+this.overlap,this.left=this.position.x-this.radiusOverlap,this.right=this.position.x+this.radiusOverlap,this.bottom=this.position.y-this.radiusOverlap,this.top=this.position.y+this.radiusOverlap,this.back=this.position.z-this.radiusOverlap,this.front=this.position.z+this.radiusOverlap,this.tree.scene&&(this.visual=new Kf(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual))};By.prototype={setParent:function(t){t!==this&&this.parent!==t&&(this.parent=t,this.updateProperties())},updateProperties:function(){var t,e;for(this.parent instanceof By?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0,t=0,e=this.nodesIndices.length;t<e;t++)this.nodesByIndex[this.nodesIndices[t]].updateProperties()},reset:function(t,e){var r,n,i,o=this.nodesIndices||[],a=this.nodesByIndex;for(this.objects=[],this.nodesIndices=[],this.nodesByIndex={},r=0,n=o.length;r<n;r++)(i=a[o[r]]).setParent(void 0),!0===t&&i.reset(t,e);!0===e&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(t,e){t.indexOctant=e,-1===Fy(this.nodesIndices,e)&&this.nodesIndices.push(e),this.nodesByIndex[e]=t,t.parent!==this&&t.setParent(this)},removeNode:function(t){var e,r;e=Fy(this.nodesIndices,t),this.nodesIndices.splice(e,1),r=r||this.nodesByIndex[t],delete this.nodesByIndex[t],r.parent===this&&r.setParent(void 0)},addObject:function(t){var e;(e=this.getOctantIndex(t))>-1&&this.nodesIndices.length>0?this.branch(e).addObject(t):e<-1&&this.parent instanceof By?this.parent.addObject(t):(-1===Fy(this.objects,t)&&this.objects.push(t),t.node=this,this.checkGrow())},addObjectWithoutCheck:function(t){var e,r,n;for(e=0,r=t.length;e<r;e++)this.objects.push(n=t[e]),n.node=this},removeObject:function(t){var e,r,n,i;if((n=(i=this.removeObjectRecursive(t,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]})).nodesRemovedFrom).length>0)for(e=0,r=n.length;e<r;e++)n[e].shrink();return i.objectsDataRemoved},removeObjectRecursive:function(t,e){var r,n,i,o,a=-1;if(t instanceof ky)-1!==(a=Fy(this.objects,t))&&(this.objects.splice(a,1),t.node=void 0,e.objectsDataRemoved.push(t),e.searchComplete=o=!0);else for(r=this.objects.length-1;r>=0;r--)if((i=this.objects[r]).object===t&&(this.objects.splice(r,1),i.node=void 0,e.objectsDataRemoved.push(i),o=!0,!i.faces&&!i.vertices)){e.searchComplete=!0;break}if(!0===o&&e.nodesRemovedFrom.push(this),!0!==e.searchComplete)for(r=0,n=this.nodesIndices.length;r<n&&!0!==(e=this.nodesByIndex[this.nodesIndices[r]].removeObjectRecursive(t,e)).searchComplete;r++);return e},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&this.tree.objectsThreshold>0&&this.grow()},grow:function(){var t,e,r,n,i=[],o=[],a=[],s=[],l=[];for(r=0,n=this.objects.length;r<n;r++)(t=this.getOctantIndex(e=this.objects[r]))>-1?(a.push(e),s.push(t)):t<-1?(i.push(e),o.push(t)):l.push(e);a.length>0&&(l=l.concat(this.split(a,s))),i.length>0&&(l=l.concat(this.expand(i,o))),this.objects=l,this.checkMerge()},split:function(t,e){var r,n,i,o,a;if(this.depth<this.tree.depthMax){for(t=t||this.objects,e=e||[],a=[],r=0,n=t.length;r<n;r++)o=t[r],(i=e[r])>-1?this.branch(i).addObject(o):a.push(o);t===this.objects&&(this.objects=a)}else a=this.objects;return a},branch:function(t){var e,r,n,i,o;return this.nodesByIndex[t]instanceof By?e=this.nodesByIndex[t]:(n=(r=.5*this.radiusOverlap)-r*this.tree.overlapPct,i=this.utilVec31Branch.set(1&t?n:-n,2&t?n:-n,4&t?n:-n),o=(new yu).addVectors(this.position,i),e=new By({tree:this.tree,parent:this,position:o,radius:r,indexOctant:t}),this.addNode(e,t)),e},expand:function(t,e){var r,n,i,o,a,s,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C,P=this.tree.INDEX_OUTSIDE_MAP,O=this.utilVec31Expand;if(this.tree.root.getDepthEnd()<this.tree.depthMax){for(t=t||this.objects,e=e||[],o=[],a=[],r=0,n=P.length;r<n;r++)P[r].count=0;for(r=0,n=t.length;r<n;r++)i=t[r],(s=e[r])<-1?((l=-s-this.tree.INDEX_OUTSIDE_OFFSET)&this.tree.FLAG_POS_X?P[this.tree.INDEX_OUTSIDE_POS_X].count++:l&this.tree.FLAG_NEG_X&&P[this.tree.INDEX_OUTSIDE_NEG_X].count++,l&this.tree.FLAG_POS_Y?P[this.tree.INDEX_OUTSIDE_POS_Y].count++:l&this.tree.FLAG_NEG_Y&&P[this.tree.INDEX_OUTSIDE_NEG_Y].count++,l&this.tree.FLAG_POS_Z?P[this.tree.INDEX_OUTSIDE_POS_Z].count++:l&this.tree.FLAG_NEG_Z&&P[this.tree.INDEX_OUTSIDE_NEG_Z].count++,a.push(i)):o.push(i);if(a.length>0)for((u=P.slice(0)).sort(function(t,e){return e.count-t.count}),g=u[2],m=1|(d=(1|(v=u[1]).index)!=(f=1|(h=u[0]).index)?v:g).index,x=1|(g=u[3]).index,s=this.getOctantIndexFromPosition(b=h.x+d.x+(p=(y=1|(v=u[2]).index)!==f&&y!==m?v:x!==f&&x!==m?g:u[4]).x,w=h.y+d.y+p.y,_=h.z+d.z+p.z),c=this.getOctantIndexFromPosition(-b,-w,-_),S=this.overlap,T=this.radius,M=(A=this.tree.overlapPct>0?S/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*T)+A*this.tree.overlapPct-(T+S),O.set(1&s?M:-M,2&s?M:-M,4&s?M:-M),E=(new yu).addVectors(this.position,O),(C=new By({tree:this.tree,position:E,radius:A})).addNode(this,c),this.tree.setRoot(C),r=0,n=a.length;r<n;r++)this.tree.root.addObject(a[r]);t===this.objects&&(this.objects=o)}else o=t;return o},shrink:function(){this.checkMerge(),this.tree.root.checkContract()},checkMerge:function(){for(var t,e=this;e.parent instanceof By&&e.getObjectCountEnd()<this.tree.objectsThreshold;)t=e,e=e.parent;e!==this&&e.merge(t)},merge:function(t){var e,r,n;for(e=0,r=(t=function(t){return t?!0!==function(t){return"[object Array]"===Object.prototype.toString.call(t)}(t)?[t]:t:[]}(t)).length;e<r;e++)this.addObjectWithoutCheck((n=t[e]).getObjectsEnd()),n.reset(!0,!0),this.removeNode(n.indexOctant,n);this.checkMerge()},checkContract:function(){var t,e,r,n,i,o,a;if(this.nodesIndices.length>0){for(o=0,a=this.objects.length,t=0,e=this.nodesIndices.length;t<e;t++)a+=n=(r=this.nodesByIndex[this.nodesIndices[t]]).getObjectCountEnd(),(i instanceof By==0||n>o)&&(i=r,o=n);(a-=o)<this.tree.objectsThreshold&&i instanceof By&&this.contract(i)}},contract:function(t){var e,r,n;for(e=0,r=this.nodesIndices.length;e<r;e++)(n=this.nodesByIndex[this.nodesIndices[e]])!==t&&(t.addObjectWithoutCheck(n.getObjectsEnd()),n.reset(!0,!0));t.addObjectWithoutCheck(this.objects),this.reset(!1,!0),this.tree.setRoot(t),t.checkContract()},getOctantIndex:function(t){var e,r,n,i,o,a,s,l,c=this.position,u=this.radiusOverlap,h=this.overlap,d=0;if(t instanceof ky?(r=t.radius,t.positionLast.copy(e=t.position)):t instanceof By&&(e=t.position,r=0),n=e.x-c.x,i=e.y-c.y,o=e.z-c.z,a=Math.abs(n),s=Math.abs(i),l=Math.abs(o),Math.max(a,s,l)+r>u)return a+r>u&&(d^=n>0?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),s+r>u&&(d^=i>0?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),l+r>u&&(d^=o>0?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),t.indexOctant=-d-this.tree.INDEX_OUTSIDE_OFFSET,t.indexOctant;if(n-r>-h)d|=1;else if(!(n+r<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;if(i-r>-h)d|=2;else if(!(i+r<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;if(o-r>-h)d|=4;else if(!(o+r<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;return t.indexOctant=d,t.indexOctant},getOctantIndexFromPosition:function(t,e,r){var n=0;return t>0&&(n|=1),e>0&&(n|=2),r>0&&(n|=4),n},search:function(t,e,r,n,i){var o,a;if(!0===(n?this.intersectRay(t,n,e,i):this.intersectSphere(t,e)))for(r=r.concat(this.objects),o=0,a=this.nodesIndices.length;o<a;o++)r=this.nodesByIndex[this.nodesIndices[o]].search(t,e,r,n);return r},intersectSphere:function(t,e){var r=e*e,n=t.x,i=t.y,o=t.z;return n<this.left?r-=Math.pow(n-this.left,2):n>this.right&&(r-=Math.pow(n-this.right,2)),i<this.bottom?r-=Math.pow(i-this.bottom,2):i>this.top&&(r-=Math.pow(i-this.top,2)),o<this.back?r-=Math.pow(o-this.back,2):o>this.front&&(r-=Math.pow(o-this.front,2)),r>=0},intersectRay:function(t,e,r,n){void 0===n&&(n=this.utilVec31Ray.set(1,1,1).divide(e));var i,o=(this.left-t.x)*n.x,a=(this.right-t.x)*n.x,s=(this.bottom-t.y)*n.y,l=(this.top-t.y)*n.y,c=(this.back-t.z)*n.z,u=(this.front-t.z)*n.z,h=Math.min(Math.min(Math.max(o,a),Math.max(s,l)),Math.max(c,u));return!(h<0||(i=Math.max(Math.max(Math.min(o,a),Math.min(s,l)),Math.min(c,u)))>h||i>r)},getDepthEnd:function(t){var e,r;if(this.nodesIndices.length>0)for(e=0,r=this.nodesIndices.length;e<r;e++)t=this.nodesByIndex[this.nodesIndices[e]].getDepthEnd(t);else t=!t||this.depth>t?this.depth:t;return t},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var t,e,r=this.nodesIndices.length;for(t=0,e=this.nodesIndices.length;t<e;t++)r+=this.nodesByIndex[this.nodesIndices[t]].getNodeCountRecursive();return r},getObjectsEnd:function(t){var e,r;for(t=(t||[]).concat(this.objects),e=0,r=this.nodesIndices.length;e<r;e++)t=this.nodesByIndex[this.nodesIndices[e]].getObjectsEnd(t);return t},getObjectCountEnd:function(){var t,e,r=this.objects.length;for(t=0,e=this.nodesIndices.length;t<e;t++)r+=this.nodesByIndex[this.nodesIndices[t]].getObjectCountEnd();return r},getObjectCountStart:function(){for(var t=this.objects.length,e=this.parent;e instanceof By;)t+=e.objects.length,e=e.parent;return t},toConsole:function(t){var e,r;for(t="string"==typeof t?t:"   ",console.log(this.parent?t+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth),console.log(this.parent?t+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects),console.log(this.parent?t+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex),e=0,r=this.nodesIndices.length;e<r;e++)this.nodesByIndex[this.nodesIndices[e]].toConsole(t+"   ")}},Qd.prototype.intersectOctreeObject=function(t,e){var r,n,i,o;return t.object instanceof Mu?(i=(t=(n=t).object).geometry.faces,(o=n.faces).length>0&&(t.geometry.faces=o),r=this.intersectObject(t,e),o.length>0&&(t.geometry.faces=i)):r=this.intersectObject(t,e),r},Qd.prototype.intersectOctreeObjects=function(t,e){var r,n,i=[];for(r=0,n=t.length;r<n;r++)i=i.concat(this.intersectOctreeObject(t[r],e));return i};var jy=function(t,e){this.cubeLods=t,this.numLods=e;var r=4*t[0].width,n=t[0].texture,i={format:n.format,magFilter:n.magFilter,minFilter:n.minFilter,type:n.type,generateMipmaps:n.generateMipmaps,anisotropy:n.anisotropy,encoding:3002===n.encoding?3005:n.encoding};3005===i.encoding&&(i.magFilter=mh,i.minFilter=mh),this.CubeUVRenderTarget=new bd(r,r,i),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=306,this.camera=new gd(.5*-r,.5*r,.5*-r,.5*r,0,1e3),this.scene=new vd,this.scene.add(this.camera),this.objects=[];var o=[];o.push(new Nu(0,0)),o.push(new Nu(1,0)),o.push(new Nu(2,0)),o.push(new Nu(0,1)),o.push(new Nu(1,1)),o.push(new Nu(2,1));var a=r;r=t[0].width;var s=0,l=4;this.numLods=Math.log(t[0].width)/Math.log(2)-2;for(var c=0;c<this.numLods;c++){var u=.5*(a-a/l);r>16&&(l*=2);for(var h=r>16?6:1,d=0,p=0,f=r,m=0;m<h;m++){for(var v=0;v<6;v++){var g=this.getShader();g.uniforms.envMap.value=this.cubeLods[c].texture,g.envMap=this.cubeLods[c].texture,g.uniforms.faceIndex.value=v,g.uniforms.mapSize.value=f;var y=new zh(new Sd(f,f,0),g);y.position.x=o[v].x*f-u+d,y.position.y=o[v].y*f-u+s+p,y.material.side=Ku,this.scene.add(y),this.objects.push(y)}p+=1.75*f,d+=1.25*f,f/=2}s+=2*r,r>16&&(r/=2)}};function zy(t,e,r){bd.call(this,t,e,r),this.activeCubeFace=0,this.activeMipMapLevel=0}jy.prototype={constructor:jy,update:function(t){var e=t.gammaInput,r=t.gammaOutput,n=t.toneMapping,i=t.toneMappingExposure,o=t.getRenderTarget();t.gammaInput=!1,t.gammaOutput=!1,t.toneMapping=1,t.toneMappingExposure=1,t.render(this.scene,this.camera,this.CubeUVRenderTarget,!1),t.setRenderTarget(o),t.toneMapping=n,t.toneMappingExposure=i,t.gammaInput=e,t.gammaOutput=r},getShader:function(){return new _d({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new yu(1,1,1)}},vertexShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tvoid main() {\t\t\t\t\tvUv = uv;\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\t\t\t\t}",fragmentShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform samplerCube envMap;\t\t\t\tuniform float mapSize;\t\t\t\tuniform vec3 testColor;\t\t\t\tuniform int faceIndex;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec3 sampleDirection;\t\t\t\t\tvec2 uv = vUv;\t\t\t\t\tuv = uv * 2.0 - 1.0;\t\t\t\t\tuv.y *= -1.0;\t\t\t\t\tif(faceIndex == 0) {\t\t\t\t\t\tsampleDirection = normalize(vec3(1.0, uv.y, -uv.x));\t\t\t\t\t} else if(faceIndex == 1) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, 1.0, uv.y));\t\t\t\t\t} else if(faceIndex == 2) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, uv.y, 1.0));\t\t\t\t\t} else if(faceIndex == 3) {\t\t\t\t\t\tsampleDirection = normalize(vec3(-1.0, uv.y, uv.x));\t\t\t\t\t} else if(faceIndex == 4) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));\t\t\t\t\t} else {\t\t\t\t\t\tsampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));\t\t\t\t\t}\t\t\t\t\tvec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );\t\t\t\t\tgl_FragColor = linearToOutputTexel( color );\t\t\t\t}",blending:5,premultipliedAlpha:!1,blendSrc:201,blendDst:200,blendSrcAlpha:201,blendDstAlpha:200,blendEquation:nh})}},(zy.prototype=Object.create(bd.prototype)).constructor=zy,zy.prototype.isWebGLRenderTargetCube=!0;var Vy=function(t,e,r){this.sourceTexture=t,this.resolution=void 0!==r?r:256,this.samplesPerLevel=void 0!==e?e:16;var n=t.encoding===Nh||3007===t.encoding||3001===t.encoding;this.sourceTexture.minFilter=n?mh:fh,this.sourceTexture.magFilter=n?mh:fh,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&n,this.cubeLods=[];var i=this.resolution,o={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(i)/Math.log(2)-2;for(var a=0;a<this.numLods;a++){var s=new zy(i,i,o);s.texture.name="PMREMGenerator.cube"+a,this.cubeLods.push(s),i=Math.max(16,i/2)}this.camera=new gd(-1,1,1,-1,0,1e3),this.shader=this.getShader(),this.shader.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,this.planeMesh=new zh(new Sd(2,2,0),this.shader),this.planeMesh.material.side=Ku,this.scene=new vd,this.scene.add(this.planeMesh),this.scene.add(this.camera),this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture};Vy.prototype={constructor:Vy,update:function(t){this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture;var e=t.gammaInput,r=t.gammaOutput,n=t.toneMapping,i=t.toneMappingExposure,o=t.getRenderTarget();t.toneMapping=1,t.toneMappingExposure=1,t.gammaInput=!1,t.gammaOutput=!1;for(var a=0;a<this.numLods;a++)this.shader.uniforms.roughness.value=a/(this.numLods-1)*.9,this.shader.uniforms.queryScale.value.x=0==a?-1:1,this.shader.uniforms.mapSize.value=this.cubeLods[a].width,this.renderToCubeMapTarget(t,this.cubeLods[a]),a<5&&(this.shader.uniforms.envMap.value=this.cubeLods[a].texture);t.setRenderTarget(o),t.toneMapping=n,t.toneMappingExposure=i,t.gammaInput=e,t.gammaOutput=r},renderToCubeMapTarget:function(t,e){for(var r=0;r<6;r++)this.renderToCubeMapTargetFace(t,e,r)},renderToCubeMapTargetFace:function(t,e,r){e.activeCubeFace=r,this.shader.uniforms.faceIndex.value=r,t.render(this.scene,this.camera,e,!0)},getShader:function(){return new _d({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},queryScale:{value:new yu(1,1,1)},testColor:{value:new yu(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform vec3 testColor;\n\t\t\t\tuniform vec3 queryScale;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tmat3 vecSpace = matrixFromVector(normalize(sampleDirection * queryScale));\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap,vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:5,blendSrc:201,blendDst:200,blendSrcAlpha:201,blendDstAlpha:200,blendEquation:nh})}};var Gy={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},Hy={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float l = linearToRelativeLuminance( texel.rgb );","gl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},Wy={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","uniform sampler2D luminanceMap;","#else","uniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","#ifdef ADAPTED_LUMINANCE","float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","#else","float fLumAvg = averageLuminance;","#endif","float fLumPixel = linearToRelativeLuminance( vColor );","float fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","return fLumCompressed * vColor;","}","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")},Xy=function(t,e){ly.call(this),this.resolution=void 0!==e?e:256,this.needsInit=!0,this.adaptive=void 0===t||!!t,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,void 0===Gy&&console.error("AdaptiveToneMappingPass relies on CopyShader");var r=Gy;this.copyUniforms=wd.clone(r.uniforms),this.materialCopy=new _d({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,blending:0,depthTest:!1}),void 0===Hy&&console.error("AdaptiveToneMappingPass relies on LuminosityShader"),this.materialLuminance=new _d({uniforms:wd.clone(Hy.uniforms),vertexShader:Hy.vertexShader,fragmentShader:Hy.fragmentShader,blending:0}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","float fLastLum = max( minLuminance, lastLum.r );","float fCurrentLum = max( minLuminance, currentLum.r );","fCurrentLum *= fCurrentLum;","float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));","gl_FragColor.r = fAdaptedLum;","}"].join("\n")},this.materialAdaptiveLum=new _d({uniforms:wd.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:0}),void 0===Wy&&console.error("AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new _d({uniforms:wd.clone(Wy.uniforms),vertexShader:Wy.vertexShader,fragmentShader:Wy.fragmentShader,blending:0}),this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};Xy.prototype=Object.assign(Object.create(ly.prototype),{constructor:Xy,render:function(t,e,r,n,i){this.needsInit&&(this.reset(t),this.luminanceRT.texture.type=r.texture.type,this.previousLuminanceRT.texture.type=r.texture.type,this.currentLuminanceRT.texture.type=r.texture.type,this.needsInit=!1),this.adaptive&&(this.quad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=r.texture,t.render(this.scene,this.camera,this.currentLuminanceRT),this.quad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=n,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,t.render(this.scene,this.camera,this.luminanceRT),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,t.render(this.scene,this.camera,this.previousLuminanceRT)),this.quad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=r.texture,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},reset:function(t){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var e={minFilter:mh,magFilter:mh,format:wh};this.luminanceRT=new bd(this.resolution,this.resolution,e),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new bd(this.resolution,this.resolution,e),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1,e.minFilter=vh,this.currentLuminanceRT=new bd(this.resolution,this.resolution,e),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.quad.material=new Dh({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},setAdaptive:function(t){t?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0},setAdaptionRate:function(t){t&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(t))},setMinLuminance:function(t){t&&(this.materialToneMap.uniforms.minLuminance.value=t,this.materialAdaptiveLum.uniforms.minLuminance.value=t)},setMaxLuminance:function(t){t&&(this.materialToneMap.uniforms.maxLuminance.value=t)},setAverageLuminance:function(t){t&&(this.materialToneMap.uniforms.averageLuminance.value=t)},setMiddleGrey:function(t){t&&(this.materialToneMap.uniforms.middleGrey.value=t)},dispose:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}});var Yy={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new Nu(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(t){function e(t,e){return Math.exp(-t*t/(2*e*e))}var r,n,i,o,a=2*Math.ceil(3*t)+1;for(a>25&&(a=25),o=.5*(a-1),n=new Array(a),i=0,r=0;r<a;++r)n[r]=e(r-o,t),i+=n[r];for(r=0;r<a;++r)n[r]/=i;return n}},qy=function(t,e,r,n){ly.call(this),t=void 0!==t?t:1,e=void 0!==e?e:25,r=void 0!==r?r:4;var i={minFilter:mh,magFilter:mh,format:wh};this.renderTargetX=new bd(n=void 0!==n?n:256,n,i),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new bd(n,n,i),this.renderTargetY.texture.name="BloomPass.y",void 0===Gy&&console.error("BloomPass relies on CopyShader");var o=Gy;this.copyUniforms=wd.clone(o.uniforms),this.copyUniforms.opacity.value=t,this.materialCopy=new _d({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:2,transparent:!0}),void 0===Yy&&console.error("BloomPass relies on ConvolutionShader");var a=Yy;this.convolutionUniforms=wd.clone(a.uniforms),this.convolutionUniforms.uImageIncrement.value=qy.blurX,this.convolutionUniforms.cKernel.value=Yy.buildKernel(r),this.materialConvolution=new _d({uniforms:this.convolutionUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:{KERNEL_SIZE_FLOAT:e.toFixed(1),KERNEL_SIZE_INT:e.toFixed(0)}}),this.needsSwap=!1,this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};qy.prototype=Object.assign(Object.create(ly.prototype),{constructor:qy,render:function(t,e,r,n,i){i&&t.context.disable(t.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=qy.blurX,t.render(this.scene,this.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=qy.blurY,t.render(this.scene,this.camera,this.renderTargetY,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,r,this.clear)}}),qy.blurX=new Nu(.001953125,0),qy.blurY=new Nu(0,.001953125);var Jy=function(t,e,r){ly.call(this),this.scene=t,this.camera=e;var n=void 0!==r.focus?r.focus:1,i=void 0!==r.aspect?r.aspect:e.aspect,o=void 0!==r.aperture?r.aperture:.025,a=void 0!==r.maxblur?r.maxblur:1,s=r.width||window.innerWidth||1,l=r.height||window.innerHeight||1;this.renderTargetColor=new bd(s,l,{minFilter:mh,magFilter:mh,format:bh}),this.renderTargetColor.texture.name="BokehPass.color",this.renderTargetDepth=this.renderTargetColor.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new md,this.materialDepth.depthPacking=3201,this.materialDepth.blending=0,void 0===Md&&console.error("BokehPass relies on BokehShader");var c=Md,u=wd.clone(c.uniforms);u.tDepth.value=this.renderTargetDepth.texture,u.focus.value=n,u.aspect.value=i,u.aperture.value=o,u.maxblur.value=a,u.nearClip.value=e.near,u.farClip.value=e.far,this.materialBokeh=new _d({defines:Object.assign({},c.defines),uniforms:u,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),this.uniforms=u,this.needsSwap=!1,this.camera2=new gd(-1,1,1,-1,0,1),this.scene2=new vd,this.quad2=new zh(new Td(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new Eu,this.oldClearAlpha=1};Jy.prototype=Object.assign(Object.create(ly.prototype),{constructor:Jy,render:function(t,e,r,n,i){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha(),t.autoClear=!1,t.setClearColor(16777215),t.setClearAlpha(1),t.render(this.scene,this.camera,this.renderTargetDepth,!0),this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?t.render(this.scene2,this.camera2):t.render(this.scene2,this.camera2,e,this.clear),this.scene.overrideMaterial=null,t.setClearColor(this.oldClearColor),t.setClearAlpha(this.oldClearAlpha),t.autoClear=this.oldAutoClear}});var Zy=function(t,e){ly.call(this),this.needsSwap=!1,this.clearColor=void 0!==t?t:0,this.clearAlpha=void 0!==e?e:0};Zy.prototype=Object.assign(Object.create(ly.prototype),{constructor:Zy,render:function(t,e,r,n,i){var o,a;this.clearColor&&(o=t.getClearColor().getHex(),a=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),t.setRenderTarget(this.renderToScreen?null:r),t.clear(),this.clearColor&&t.setClearColor(o,a)}});var Qy=function(t,e,r){ly.call(this),this.camera=t,this.needsSwap=!1,this.cubeShader=Kp.cube,this.cubeMesh=new zh(new Yh(10,10,10),new _d({uniforms:this.cubeShader.uniforms,vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:Qu})),this.envMap=e,this.opacity=void 0!==r?r:1,this.cubeScene=new vd,this.cubeCamera=new fd,this.cubeScene.add(this.cubeMesh)};Qy.prototype=Object.assign(Object.create(ly.prototype),{constructor:Qy,render:function(t,e,r,n,i){var o=t.autoClear;t.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.envMap,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,t.render(this.cubeScene,this.cubeCamera,this.renderToScreen?null:r,this.clear),t.autoClear=o}});var Ky={uniforms:{tDiffuse:{value:null},tSize:{value:new Nu(256,256)},center:{value:new Nu(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},$y=function(t,e,r){ly.call(this),void 0===Ky&&console.error("DotScreenPass relies on DotScreenShader");var n=Ky;this.uniforms=wd.clone(n.uniforms),void 0!==t&&this.uniforms.center.value.copy(t),void 0!==e&&(this.uniforms.angle.value=e),void 0!==r&&(this.uniforms.scale.value=r),this.material=new _d({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};$y.prototype=Object.assign(Object.create(ly.prototype),{constructor:$y,render:function(t,e,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.tSize.value.set(r.width,r.height),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var tx=function(t,e){ly.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};tx.prototype=Object.assign(Object.create(ly.prototype),{constructor:tx,render:function(t,e,r,n,i){var o,a,s=t.context,l=t.state;l.buffers.color.setMask(!1),l.buffers.depth.setMask(!1),l.buffers.color.setLocked(!0),l.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),l.buffers.stencil.setTest(!0),l.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),l.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),l.buffers.stencil.setClear(a),t.render(this.scene,this.camera,r,this.clear),t.render(this.scene,this.camera,e,this.clear),l.buffers.color.setLocked(!1),l.buffers.depth.setLocked(!1),l.buffers.stencil.setFunc(s.EQUAL,1,4294967295),l.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP)}});var ex=function(){ly.call(this),this.needsSwap=!1};ex.prototype=Object.create(ly.prototype),Object.assign(ex.prototype,{render:function(t,e,r,n,i){t.state.buffers.stencil.setTest(!1)}}),Object.assign((function(t,e){if(this.renderer=t,void 0===e){var r={minFilter:mh,magFilter:mh,format:wh,stencilBuffer:!1},n=t.getDrawingBufferSize();(e=new bd(n.width,n.height,r)).texture.name="EffectComposer.rt1"}this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===Gy&&console.error("EffectComposer relies on CopyShader"),void 0===cy&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new cy(Gy)}).prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t);var e=this.renderer.getDrawingBufferSize();t.setSize(e.width,e.height)},insertPass:function(t,e){this.passes.splice(e,0,t)},render:function(t){var e,r,n=!1,i=this.passes.length;for(r=0;r<i;r++)if(!1!==(e=this.passes[r]).enabled){if(e.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),e.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==tx&&(e instanceof tx?n=!0:e instanceof ex&&(n=!1))}},reset:function(t){if(void 0===t){var e=this.renderer.getDrawingBufferSize();(t=this.renderTarget1.clone()).setSize(e.width,e.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this.renderTarget1.setSize(t,e),this.renderTarget2.setSize(t,e);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(t,e)}});var rx={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},nx=function(t,e,r,n){ly.call(this),void 0===rx&&console.error("FilmPass relies on FilmShader");var i=rx;this.uniforms=wd.clone(i.uniforms),this.material=new _d({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==t&&(this.uniforms.nIntensity.value=t),void 0!==e&&(this.uniforms.sIntensity.value=e),void 0!==r&&(this.uniforms.sCount.value=r),this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};nx.prototype=Object.assign(Object.create(ly.prototype),{constructor:nx,render:function(t,e,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.time.value+=n,this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var ix={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")},ox=function(t){ly.call(this),void 0===ix&&console.error("GlitchPass relies on DigitalGlitch");var e=ix;this.uniforms=wd.clone(e.uniforms),void 0==t&&(t=64),this.uniforms.tDisp.value=this.generateHeightmap(t),this.material=new _d({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.goWild=!1,this.curF=0,this.generateTrigger()};ox.prototype=Object.assign(Object.create(ly.prototype),{constructor:ox,render:function(t,e,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=vu.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=vu.randFloat(-1,1),this.uniforms.seed_y.value=vu.randFloat(-1,1),this.uniforms.distortion_x.value=vu.randFloat(0,1),this.uniforms.distortion_y.value=vu.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=vu.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=vu.randFloat(0,1),this.uniforms.distortion_y.value=vu.randFloat(0,1),this.uniforms.seed_x.value=vu.randFloat(-.3,.3),this.uniforms.seed_y.value=vu.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},generateTrigger:function(){this.randX=vu.randInt(120,240)},generateHeightmap:function(t){for(var e=new Float32Array(t*t*3),r=t*t,n=0;n<r;n++){var i=vu.randFloat(0,1);e[3*n+0]=i,e[3*n+1]=i,e[3*n+2]=i}var o=new ff(e,t,t,bh,1015);return o.needsUpdate=!0,o}});var ax=function(t,e,r,n){this.renderScene=e,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new Eu(1,1,1),this.hiddenEdgeColor=new Eu(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,ly.call(this),this.resolution=void 0!==t?new Nu(t.x,t.y):new Nu(256,256);var i={minFilter:mh,magFilter:mh,format:wh},o=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new Dh({color:16777215}),this.maskBufferMaterial.side=Ku,this.renderTargetMaskBuffer=new bd(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new md,this.depthMaterial.side=Ku,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Ku,this.prepareMaskMaterial.fragmentShader=function(t,e){return t.replace(/DEPTH_TO_VIEW_Z/g,(e.isPerspectiveCamera?"perspective":"orthographic")+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new bd(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new bd(o,a,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new bd(o,a,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new bd(Math.round(o/2),Math.round(a/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new bd(o,a,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new bd(Math.round(o/2),Math.round(a/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Nu(o,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Nu(Math.round(o/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===Gy&&console.error("OutlinePass relies on CopyShader");var s=Gy;this.copyUniforms=wd.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new _d({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Eu,this.oldClearAlpha=1,this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new Eu,this.tempPulseColor2=new Eu,this.textureMatrix=new gu};ax.prototype=Object.assign(Object.create(ly.prototype),{constructor:ax,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,e){this.renderTargetMaskBuffer.setSize(t,e);var r=Math.round(t/this.downSampleRatio),n=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value=new Nu(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value=new Nu(r,n)},changeVisibilityOfSelectedObjects:function(t){function e(e){e instanceof zh&&(e.visible=t)}for(var r=0;r<this.selectedObjects.length;r++)this.selectedObjects[r].traverse(e)},changeVisibilityOfNonSelectedObjects:function(t){var e=[];function r(t){t instanceof zh&&e.push(t)}for(var n=0;n<this.selectedObjects.length;n++)this.selectedObjects[n].traverse(r);this.renderScene.traverse(function(r){if(r instanceof zh||r instanceof Vh||r instanceof wg){for(var n=!1,i=0;i<e.length;i++)if(e[i].id===r.id){n=!0;break}if(!n){var o=r.visible;t&&!r.bVisible||(r.visible=t),r.bVisible=o}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,e,r,n,i){if(0!==this.selectedObjects.length){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,i&&t.context.disable(t.context.STENCIL_TEST),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.render(this.renderScene,this.renderCamera,this.renderTargetDepthBuffer,!0),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new Nu(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.render(this.renderScene,this.renderCamera,this.renderTargetMaskBuffer,!0),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=a,this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,!0),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Nu(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ax.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.render(this.scene,this.camera,this.renderTargetBlurBuffer1,!0),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ax.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=ax.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetBlurBuffer2,!0),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=ax.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,!0),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,r,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}},getPrepareMaskMaterial:function(){return new _d({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Nu(.5,.5)},textureMatrix:{value:new gu}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new _d({uniforms:{maskTexture:{value:null},texSize:{value:new Nu(.5,.5)},visibleEdgeColor:{value:new yu(1,1,1)},hiddenEdgeColor:{value:new yu(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new _d({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new Nu(.5,.5)},direction:{value:new Nu(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\t\t\t\t}"})},getOverlayMaterial:function(){return new _d({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:2,depthTest:!1,depthWrite:!1,transparent:!0})}}),ax.BlurDirectionX=new Nu(1,0),ax.BlurDirectionY=new Nu(0,1);var sx=function(t,e,r,n,i){ly.call(this),this.scene=t,this.camera=e,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};function lx(t,e,r,n,i,o,a,s,l,c){if((c=void 0!==c?c:Sh)!==Sh&&c!==Th)throw new Error("DepthTexture format must be either DepthFormat or DepthStencilFormat");void 0===r&&c===Sh&&(r=yh),void 0===r&&c===Th&&(r=xh),xd.call(this,null,n,i,o,a,s,c,r,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:fh,this.minFilter=void 0!==s?s:fh,this.flipY=!1,this.generateMipmaps=!1}sx.prototype=Object.assign(Object.create(ly.prototype),{constructor:sx,render:function(t,e,r,n,i){var o,a,s=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(o=t.getClearColor().getHex(),a=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),this.clearColor&&t.setClearColor(o,a),this.scene.overrideMaterial=null,t.autoClear=s}}),(lx.prototype=Object.create(xd.prototype)).constructor=lx,lx.prototype.isDepthTexture=!0;var cx={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},size:{type:"v2",value:new Nu(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},cameraProjectionMatrix:{type:"m4",value:new gu},cameraInverseProjectionMatrix:{type:"m4",value:new gu},scale:{type:"f",value:1},intensity:{type:"f",value:.1},bias:{type:"f",value:.5},minResolution:{type:"f",value:0},kernelRadius:{type:"f",value:100},randomSeed:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},ux={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new Nu(512,512)},sampleUvOffsets:{type:"v2v",value:[new Nu(0,0)]},sampleWeights:{type:"1fv",value:[1]},tDepth:{type:"t",value:null},cameraNear:{type:"f",value:10},cameraFar:{type:"f",value:1e3},depthCutoff:{type:"f",value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},hx={createSampleWeights:function(t,e){for(var r=function(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)},n=[],i=0;i<=t;i++)n.push(r(i,e));return n},createSampleOffsets:function(t,e){for(var r=[],n=0;n<=t;n++)r.push(e.clone().multiplyScalar(n));return r},configure:function(t,e,r,n){t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=hx.createSampleOffsets(e,n),t.uniforms.sampleWeights.value=hx.createSampleWeights(e,r),t.needsUpdate=!0}},dx={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},px=function(t,e,r,n,i){ly.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==r&&r,this.supportsNormalTexture=void 0!==n&&n,this.oldClearColor=new Eu,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==i?new Nu(i.x,i.y):new Nu(256,256),this.saoRenderTarget=new bd(this.resolution.x,this.resolution.y,{minFilter:mh,magFilter:mh,format:wh}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new bd(this.resolution.x,this.resolution.y,{minFilter:fh,magFilter:fh,format:wh}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension&&((r=new lx).type=yh,r.minFilter=fh,r.maxFilter=fh,this.beautyRenderTarget.depthTexture=r,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new md,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.normalMaterial=new Dd,this.normalMaterial.blending=0,void 0===cx&&console.error("SAOPass relies on SAOShader"),this.saoMaterial=new _d({defines:Object.assign({},cx.defines),fragmentShader:cx.fragmentShader,vertexShader:cx.vertexShader,uniforms:wd.clone(cx.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=0,void 0===ux&&console.error("SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new _d({uniforms:wd.clone(ux.uniforms),defines:Object.assign({},ux.defines),vertexShader:ux.vertexShader,fragmentShader:ux.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=0,this.hBlurMaterial=new _d({uniforms:wd.clone(ux.uniforms),defines:Object.assign({},ux.defines),vertexShader:ux.vertexShader,fragmentShader:ux.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=0,void 0===Gy&&console.error("SAOPass relies on CopyShader"),this.materialCopy=new _d({uniforms:wd.clone(Gy.uniforms),vertexShader:Gy.vertexShader,fragmentShader:Gy.fragmentShader,blending:0}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=5,this.materialCopy.blendSrc=208,this.materialCopy.blendDst=200,this.materialCopy.blendEquation=nh,this.materialCopy.blendSrcAlpha=206,this.materialCopy.blendDstAlpha=200,this.materialCopy.blendEquationAlpha=nh,void 0===Gy&&console.error("SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new _d({uniforms:wd.clone(dx.uniforms),vertexShader:dx.vertexShader,fragmentShader:dx.fragmentShader,blending:0}),this.quadCamera=new gd(-1,1,1,-1,0,1),this.quadScene=new vd,this.quad=new zh(new Sd(2,2),null),this.quadScene.add(this.quad)};px.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},px.prototype=Object.assign(Object.create(ly.prototype),{constructor:px,render:function(t,e,r,n,i){if(this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(t,this.materialCopy,null)),1!==this.params.output){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.clearTarget(this.depthRenderTarget),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var a=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=a,this.hBlurMaterial.uniforms.depthCutoff.value=a,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(hx.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Nu(0,1)),hx.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Nu(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),t.setClearColor(0),t.render(this.scene,this.camera,this.beautyRenderTarget,!0),this.supportsDepthTextureExtension||this.renderOverride(t,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(t,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(t,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(t,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var s=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,s=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),s.blending=0===this.params.output?5:0,this.renderPass(t,s,this.renderToScreen?null:r),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}},renderPass:function(t,e,r,n,i){var o=t.getClearColor(),a=t.getClearAlpha(),s=t.autoClear;t.autoClear=!1;var l=void 0!==n&&null!==n;l&&(t.setClearColor(n),t.setClearAlpha(i||0)),this.quad.material=e,t.render(this.quadScene,this.quadCamera,r,l),t.autoClear=s,t.setClearColor(o),t.setClearAlpha(a)},renderOverride:function(t,e,r,n,i){var o=t.getClearColor(),a=t.getClearAlpha(),s=t.autoClear;t.autoClear=!1,n=e.clearColor||n,i=e.clearAlpha||i;var l=void 0!==n&&null!==n;l&&(t.setClearColor(n),t.setClearAlpha(i||0)),this.scene.overrideMaterial=e,t.render(this.scene,this.camera,r,l),this.scene.overrideMaterial=null,t.autoClear=s,t.setClearColor(o),t.setClearAlpha(a)},setSize:function(t,e){this.beautyRenderTarget.setSize(t,e),this.saoRenderTarget.setSize(t,e),this.blurIntermediateRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.depthRenderTarget.setSize(t,e),this.saoMaterial.uniforms.size.value.set(t,e),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(t,e),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(t,e),this.hBlurMaterial.needsUpdate=!0}});var fx=function(t){ly.call(this),void 0===Gy&&console.error("SavePass relies on CopyShader");var e=Gy;this.textureID="tDiffuse",this.uniforms=wd.clone(e.uniforms),this.material=new _d({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderTarget=t,void 0===this.renderTarget&&(this.renderTarget=new bd(window.innerWidth,window.innerHeight,{minFilter:mh,magFilter:mh,format:bh,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};fx.prototype=Object.assign(Object.create(ly.prototype),{constructor:fx,render:function(t,e,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,t.render(this.scene,this.camera,this.renderTarget,this.clear)}});var mx=[{defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Nu(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","vUv = uv;","SMAAEdgeDetectionVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","vec4 delta;","vec3 C = texture2D( colorTex, texcoord ).rgb;","vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","vec3 t = abs( C - Cleft );","delta.x = max( max( t.r, t.g ), t.b );","vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","t = abs( C - Ctop );","delta.y = max( max( t.r, t.g ), t.b );","vec2 edges = step( threshold, delta.xy );","if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","discard;","vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","t = abs( C - Cright );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","t = abs( C - Cbottom );","delta.w = max( max( t.r, t.g ), t.b );","float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","t = abs( C - Cleftleft );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","t = abs( C - Ctoptop );","delta.w = max( max( t.r, t.g ), t.b );","maxDelta = max( max( maxDelta, delta.z ), delta.w );","edges.xy *= step( 0.5 * maxDelta, delta.xy );","return vec4( edges, 0.0, 0.0 );","}","void main() {","gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},{defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Nu(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","vPixcoord = texcoord / resolution;","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","vUv = uv;","SMAABlendingWeightCalculationVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","vec2 round( vec2 x ) {","return sign( x ) * floor( abs( x ) + 0.5 );","}","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","e.r = bias + e.r * scale;","return 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x += 0.25 * resolution.x;","texcoord.x += resolution.x;","texcoord.x += 2.0 * resolution.x;","texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","return texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x -= 0.25 * resolution.x;","texcoord.x -= resolution.x;","texcoord.x -= 2.0 * resolution.x;","texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","return texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y -= 0.25 * resolution.y;","texcoord.y -= resolution.y;","texcoord.y -= 2.0 * resolution.y;","texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","return texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y += 0.25 * resolution.y;","texcoord.y += resolution.y;","texcoord.y += 2.0 * resolution.y;","texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","return texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","return texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","vec2 e = texture2D( edgesTex, texcoord ).rg;","if ( e.g > 0.0 ) {","vec2 d;","vec2 coords;","coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","coords.y = offset[ 1 ].y;","d.x = coords.x;","float e1 = texture2D( edgesTex, coords, 0.0 ).r;","coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","d.y = coords.x;","d = d / resolution.x - pixcoord.x;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","}","if ( e.r > 0.0 ) {","vec2 d;","vec2 coords;","coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","coords.x = offset[ 0 ].x;","d.x = coords.y;","float e1 = texture2D( edgesTex, coords, 0.0 ).g;","coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","d.y = coords.y;","d = d / resolution.y - pixcoord.y;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","}","return weights;","}","void main() {","gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},{uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Nu(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","vUv = uv;","SMAANeighborhoodBlendingVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","vec4 a;","a.xz = texture2D( blendTex, texcoord ).xz;","a.y = texture2D( blendTex, offset[ 1 ].zw ).g;","a.w = texture2D( blendTex, offset[ 1 ].xy ).a;","if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","return texture2D( colorTex, texcoord, 0.0 );","} else {","vec2 offset;","offset.x = a.a > a.b ? a.a : -a.b;","offset.y = a.g > a.r ? -a.g : a.r;","if ( abs( offset.x ) > abs( offset.y )) {","offset.y = 0.0;","} else {","offset.x = 0.0;","}","vec4 C = texture2D( colorTex, texcoord, 0.0 );","texcoord += sign( offset ) * resolution;","vec4 Cop = texture2D( colorTex, texcoord, 0.0 );","float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","C.xyz = pow(C.xyz, vec3(2.2));","Cop.xyz = pow(Cop.xyz, vec3(2.2));","vec4 mixed = mix(C, Cop, s);","mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","return mixed;","}","}","void main() {","gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")}],vx=function(t,e){ly.call(this),this.edgesRT=new bd(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:mh,format:bh}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new bd(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:mh,format:wh}),this.weightsRT.texture.name="SMAAPass.weights";var r=new Image;r.src=this.getAreaTexture(),this.areaTexture=new xd,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=r,this.areaTexture.format=bh,this.areaTexture.minFilter=mh,this.areaTexture.generateMipmaps=!1,this.areaTexture.needsUpdate=!0,this.areaTexture.flipY=!1;var n=new Image;n.src=this.getSearchTexture(),this.searchTexture=new xd,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=n,this.searchTexture.magFilter=fh,this.searchTexture.minFilter=fh,this.searchTexture.generateMipmaps=!1,this.searchTexture.needsUpdate=!0,this.searchTexture.flipY=!1,void 0===mx&&console.error("SMAAPass relies on SMAAShader"),this.uniformsEdges=wd.clone(mx[0].uniforms),this.uniformsEdges.resolution.value.set(1/t,1/e),this.materialEdges=new _d({defines:Object.assign({},mx[0].defines),uniforms:this.uniformsEdges,vertexShader:mx[0].vertexShader,fragmentShader:mx[0].fragmentShader}),this.uniformsWeights=wd.clone(mx[1].uniforms),this.uniformsWeights.resolution.value.set(1/t,1/e),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new _d({defines:Object.assign({},mx[1].defines),uniforms:this.uniformsWeights,vertexShader:mx[1].vertexShader,fragmentShader:mx[1].fragmentShader}),this.uniformsBlend=wd.clone(mx[2].uniforms),this.uniformsBlend.resolution.value.set(1/t,1/e),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new _d({uniforms:this.uniformsBlend,vertexShader:mx[2].vertexShader,fragmentShader:mx[2].fragmentShader}),this.needsSwap=!1,this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};vx.prototype=Object.assign(Object.create(ly.prototype),{constructor:vx,render:function(t,e,r,n,i){this.uniformsEdges.tDiffuse.value=r.texture,this.quad.material=this.materialEdges,t.render(this.scene,this.camera,this.edgesRT,this.clear),this.quad.material=this.materialWeights,t.render(this.scene,this.camera,this.weightsRT,this.clear),this.uniformsBlend.tColor.value=r.texture,this.quad.material=this.materialBlend,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},setSize:function(t,e){this.edgesRT.setSize(t,e),this.weightsRT.setSize(t,e),this.materialEdges.uniforms.resolution.value.set(1/t,1/e),this.materialWeights.uniforms.resolution.value.set(1/t,1/e),this.materialBlend.uniforms.resolution.value.set(1/t,1/e)},getAreaTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var gx=function(t,e,r,n){ly.call(this),this.scene=t,this.camera=e,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==n?n:0,void 0===Gy&&console.error("SSAARenderPass relies on CopyShader");var i=Gy;this.copyUniforms=wd.clone(i.uniforms),this.copyMaterial=new _d({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.camera2=new gd(-1,1,1,-1,0,1),this.scene2=new vd,this.quad2=new zh(new Sd(2,2),this.copyMaterial),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2)};gx.prototype=Object.assign(Object.create(ly.prototype),{constructor:gx,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(t,e){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(t,e)},render:function(t,e,r){this.sampleRenderTarget||(this.sampleRenderTarget=new bd(r.width,r.height,{minFilter:mh,magFilter:mh,format:wh}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var n=gx.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=t.autoClear;t.autoClear=!1;var o=t.getClearColor().getHex(),a=t.getClearAlpha(),s=1/n.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var l=r.width,c=r.height,u=0;u<n.length;u++){var h=n[u];this.camera.setViewOffset&&this.camera.setViewOffset(l,c,.0625*h[0],.0625*h[1],l,c);var d=s;this.unbiased&&(d+=1/32*((u+.5)/n.length-.5)),this.copyUniforms.opacity.value=d,t.setClearColor(this.clearColor,this.clearAlpha),t.render(this.scene,this.camera,this.sampleRenderTarget,!0),0===u&&t.setClearColor(0,0),t.render(this.scene2,this.camera2,this.renderToScreen?null:e,0===u)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),t.autoClear=i,t.setClearColor(o,a)}}),gx.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var yx={uniforms:{tDiffuse:{value:null},tDepth:{value:null},size:{value:new Nu(512,512)},cameraNear:{value:1},cameraFar:{value:100},radius:{value:32},onlyAO:{value:0},aoClamp:{value:.25},lumInfluence:{value:.7}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","#ifdef USE_LOGDEPTHBUF","uniform float logDepthBufFC;","#endif","uniform float radius;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","const int samples = 64;","const bool useNoise = true;","const float noiseAmount = 0.0004;","const float diffArea = 0.4;","const float gDisplace = 0.4;","#include <packing>","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );","float gg = fract( coord.t * ( size.y / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float readDepth( const in vec2 coord ) {","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","#ifdef USE_LOGDEPTHBUF","float logz = unpackRGBAToDepth( texture2D( tDepth, coord ) );","float w = pow(2.0, (logz / logDepthBufFC)) - 1.0;","float z = (logz / w) + 1.0;","#else","float z = unpackRGBAToDepth( texture2D( tDepth, coord ) );","#endif","return cameraCoef / ( cameraFarPlusNear - z * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 8.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * ( dd * dd ) / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + radius * vv;","vec2 coord2 = vUv - radius * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / size.x ) / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float ao = 0.0;","float dz = 1.0 / float( samples );","float l = 0.0;","float z = 1.0 - dz / 2.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","float pw = cos( l ) * r;","float ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},xx=function(t,e,r,n){if(void 0===yx)return console.warn("SSAOPass depends on SSAOShader"),new cy;cy.call(this,yx),this.width=void 0!==r?r:512,this.height=void 0!==n?n:256,this.renderToScreen=!1,this.camera2=e,this.scene2=t,this.depthMaterial=new md,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.depthRenderTarget=new bd(this.width,this.height,{minFilter:mh,magFilter:mh}),this.uniforms.tDepth.value=this.depthRenderTarget.texture,this.uniforms.size.value.set(this.width,this.height),this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far,this.uniforms.radius.value=4,this.uniforms.onlyAO.value=!1,this.uniforms.aoClamp.value=.25,this.uniforms.lumInfluence.value=.7,Object.defineProperties(this,{radius:{get:function(){return this.uniforms.radius.value},set:function(t){this.uniforms.radius.value=t}},onlyAO:{get:function(){return this.uniforms.onlyAO.value},set:function(t){this.uniforms.onlyAO.value=t}},aoClamp:{get:function(){return this.uniforms.aoClamp.value},set:function(t){this.uniforms.aoClamp.value=t}},lumInfluence:{get:function(){return this.uniforms.lumInfluence.value},set:function(t){this.uniforms.lumInfluence.value=t}}})};(xx.prototype=Object.create(cy.prototype)).render=function(t,e,r,n,i){this.scene2.overrideMaterial=this.depthMaterial,t.render(this.scene2,this.camera2,this.depthRenderTarget,!0),this.scene2.overrideMaterial=null,cy.prototype.render.call(this,t,e,r,n,i)},xx.prototype.setScene=function(t){this.scene2=t},xx.prototype.setCamera=function(t){this.camera2=t,this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far},xx.prototype.setSize=function(t,e){this.width=t,this.height=e,this.uniforms.size.value.set(this.width,this.height),this.depthRenderTarget.setSize(this.width,this.height)};var bx=function(t,e,r){void 0===gx&&console.error("TAARenderPass relies on SSAARenderPass"),gx.call(this,t,e,r),this.sampleLevel=0,this.accumulate=!1};bx.JitterVectors=gx.JitterVectors,bx.prototype=Object.assign(Object.create(gx.prototype),{constructor:bx,render:function(t,e,r,n){if(!this.accumulate)return gx.prototype.render.call(this,t,e,r,n),void(this.accumulateIndex=-1);var i=bx.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new bd(r.width,r.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new bd(r.width,r.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(gx.prototype.render.call(this,t,this.holdRenderTarget,r,n),this.accumulateIndex=0);var o=t.autoClear;t.autoClear=!1;var a=1/i.length;if(this.accumulateIndex>=0&&this.accumulateIndex<i.length){this.copyUniforms.opacity.value=a,this.copyUniforms.tDiffuse.value=e.texture;for(var s=Math.pow(2,this.sampleLevel),l=0;l<s;l++){var c=i[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,.0625*c[0],.0625*c[1],r.width,r.height),t.render(this.scene,this.camera,e,!0),t.render(this.scene2,this.camera2,this.sampleRenderTarget,0===this.accumulateIndex),this.accumulateIndex++,this.accumulateIndex>=i.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var u=this.accumulateIndex*a;u>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,t.render(this.scene2,this.camera2,e,!0)),u<1&&(this.copyUniforms.opacity.value=1-u,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,t.render(this.scene2,this.camera2,e,0===u)),t.autoClear=o}});var wx=function(t,e){ly.call(this),void 0===Gy&&console.error("TexturePass relies on CopyShader");var r=Gy;this.map=t,this.opacity=void 0!==e?e:1,this.uniforms=wd.clone(r.uniforms),this.material=new _d({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};wx.prototype=Object.assign(Object.create(ly.prototype),{constructor:wx,render:function(t,e,r,n,i){var o=t.autoClear;t.autoClear=!1,this.quad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,t.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),t.autoClear=o}});var _x={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new Eu(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},Sx=function(t,e,r,n){ly.call(this),this.strength=void 0!==e?e:1,this.radius=r,this.threshold=n,this.resolution=void 0!==t?new Nu(t.x,t.y):new Nu(256,256);var i={minFilter:mh,magFilter:mh,format:wh};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new bd(o,a,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l;(l=new bd(o,a,i)).texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l),(l=new bd(o,a,i)).texture.name="UnrealBloomPass.v"+s,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),o=Math.round(o/2),a=Math.round(a/2)}void 0===_x&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var c=_x;this.highPassUniforms=wd.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new _d({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var u=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new Nu(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new yu(1,1,1),new yu(1,1,1),new yu(1,1,1),new yu(1,1,1),new yu(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===Gy&&console.error("BloomPass relies on CopyShader");var h=Gy;this.copyUniforms=wd.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new _d({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Eu,this.oldClearAlpha=1,this.camera=new gd(-1,1,1,-1,0,1),this.scene=new vd,this.basic=new Dh,this.quad=new zh(new Td(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};function Tx(t,e,r,n,i,o){this.planes=[void 0!==t?t:new Bh,void 0!==e?e:new Bh,void 0!==r?r:new Bh,void 0!==n?n:new Bh,void 0!==i?i:new Bh,void 0!==o?o:new Bh]}Sx.prototype=Object.assign(Object.create(ly.prototype),{constructor:Sx,dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,e){var r=Math.round(t/2),n=Math.round(e/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new Nu(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(t,e,r,n,i){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.setClearColor(new Eu(0,0,0),0),i&&t.context.disable(t.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=r.texture,t.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,t.render(this.scene,this.camera,this.renderTargetBright,!0);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=Sx.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetsHorizontal[s],!0),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=Sx.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetsVertical[s],!0),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,this.renderToScreen?void 0:r,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o},getSeperableBlurMaterial:function(t){return new _d({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new Nu(.5,.5)},direction:{value:new Nu(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(t){return new _d({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),Sx.BlurDirectionX=new Nu(1,0),Sx.BlurDirectionY=new Nu(0,1),Object.assign(Tx.prototype,{set:function(t,e,r,n,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return e[0].setComponents(a-n,u-s,f-h,y-m).normalize(),e[1].setComponents(a+n,u+s,f+h,y+m).normalize(),e[2].setComponents(a+i,u+l,f+d,y+v).normalize(),e[3].setComponents(a-i,u-l,f-d,y-v).normalize(),e[4].setComponents(a-o,u-c,f-p,y-g).normalize(),e[5].setComponents(a+o,u+c,f+p,y+g).normalize(),this},intersectsObject:function(){var t=new Ou;return function(e){var r=e.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),t.copy(r.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new Ou;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:function(){var t=new yu,e=new yu;return function(r){for(var n=this.planes,i=0;i<6;i++){var o=n[i];t.x=o.normal.x>0?r.min.x:r.max.x,e.x=o.normal.x>0?r.max.x:r.min.x,t.y=o.normal.y>0?r.min.y:r.max.y,e.y=o.normal.y>0?r.max.y:r.min.y,t.z=o.normal.z>0?r.min.z:r.max.z,e.z=o.normal.z>0?r.max.z:r.min.z;var a=o.distanceToPoint(t),s=o.distanceToPoint(e);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var Mx=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},Ax=function(){this.id=0,this.v1=new Ex,this.v2=new Ex,this.v3=new Ex,this.normalModel=new yu,this.vertexNormalsModel=[new yu,new yu,new yu],this.vertexNormalsLength=0,this.color=new Eu,this.material=null,this.uvs=[new Nu,new Nu,new Nu],this.z=0,this.renderOrder=0},Ex=function(){this.position=new yu,this.positionWorld=new yu,this.positionScreen=new Ru,this.visible=!0};Ex.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)};var Cx=function(){this.id=0,this.v1=new Ex,this.v2=new Ex,this.vertexColors=[new Eu,new Eu],this.material=null,this.z=0,this.renderOrder=0},Px=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Nu,this.material=null,this.renderOrder=0},Ox=function(t){Rh.call(this),this.type="SpriteCanvasMaterial",this.color=new Eu(16777215),this.program=function(){},this.setValues(t)};(Ox.prototype=Object.create(Rh.prototype)).constructor=Ox,Ox.prototype.isSpriteCanvasMaterial=!0,Ox.prototype.clone=function(){var t=new Ox;return t.copy(this),t.color.copy(this.color),t.program=this.program,t};var Nx=function(t){Mu.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",function(t){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};(Nx.prototype=Object.create(Mu.prototype)).constructor=Nx;var Lx=function(t){Mu.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};(Lx.prototype=Object.create(Mu.prototype)).constructor=Lx;var Ix=function(t){Lx.call(this,t)};(Ix.prototype=Object.create(Lx.prototype)).constructor=Ix,Object.assign((function(t){console.log("RaytracingRenderer","91"),t=t||{};var e,r,n=this,i=[],o=!1,a=document.createElement("canvas"),s=a.getContext("2d",{alpha:!0===t.alpha}),l=new Eu(0);this.domElement=a,this.autoClear=!0;var c=t.workers,u=t.blockSize||64;this.randomize=t.randomize;var h,d,p,f=[],m=0,v=0;function g(t){t.postMessage({init:[e,r],worker:t.id,blockSize:u})}function y(t){if(!f.length)return o=!1,n.dispatchEvent({type:"complete"});var e=f.pop(),r=e%d*u,i=(e/d|0)*u;t.postMessage({render:!0,x:r,y:i,sceneId:v}),s.fillStyle="#"+t.color,s.fillRect(r,i,u,u)}console.log("%cSpinning off "+c+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(e){for(c=e||navigator.hardwareConcurrency||4;i.length<c;){var r=new Worker(t.workerPath);r.id=m++,r.onmessage=function(t){var e=t.data;if(e&&e.blockSize&&v==e.sceneId){var r=new ImageData(new Uint8ClampedArray(e.data),e.blockSize,e.blockSize);if(s.putImageData(r,e.blockX,e.blockY),console.log("Worker "+this.id,e.time/1e3,(Date.now()-w)/1e3+" s"),i.length>c)return i.splice(i.indexOf(this),1),this.terminate();y(this)}},r.color=(new Eu).setHSL(Math.random(),.8,.8).getHexString(),i.push(r),g(r),o&&(r.postMessage({scene:x,camera:b,annex:_,sceneId:v}),y(r))}if(!o)for(;i.length>c;)i.pop().terminate()},this.setWorkers(c),this.setClearColor=function(t,e){l.set(t)},this.setPixelRatio=function(){},this.setSize=function(t,n){a.width=t,a.height=n,e=a.width,r=a.height,s.fillStyle="white",i.forEach(g)},this.setSize(a.width,a.height),this.clear=function(){};var x,b,w,_={},S={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function T(t){var e=t.material;if(e&&!(e.uuid in _)){var r={};for(var n in S)void 0!==e[n]&&(r[n]=e[n]);_[e.uuid]=r}}this.render=function(t,a){o=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===a.parent&&a.updateMatrixWorld(),x=t.toJSON(),b=a.toJSON(),++v,t.traverse(T),i.forEach(function(t){t.postMessage({scene:x,camera:b,annex:_,sceneId:v})}),s.clearRect(0,0,e,r),w=Date.now(),d=Math.ceil(e/u),p=Math.ceil(r/u),h=d*p,f=[];for(var l=0;l<h;l++)f.push(l);if(n.randomize)for(l=0;l<h;l++){var c=Math.random()*h|0,m=f[c];f[c]=f[l],f[l]=m}i.forEach(y)}}).prototype,bu.prototype);var Rx=function(t){console.log("SoftwareRenderer","91");var e,r,n,i,o,a,s,l,c,u,h,d,p,f,m,v,g=void 0!==(t=t||{}).canvas?t.canvas:document.createElement("canvas"),y=g.getContext("2d",{alpha:!0===t.alpha}),x=t.alpha,b={},w={},_=new Eu(0),S=1,T=2,M=4,A=(1<<M)-1,E=3,C=1<<E,P=1<<24,O=!1,N=new yu(0,0,1),L=new yu,I=1/0,R=1/0,D=0,F=0,U=1/0,k=1/0,B=0,j=0,z=new function(){var t,e,r,n,i,o,a,s,l,c,u,h=[],d=0,p=[],f=0,m=[],v=0,g=[],y=0,x=[],b=0,w={objects:[],lights:[],elements:[]},_=new yu,S=new Ru,T=new Pu(new yu(-1,-1,-1),new yu(1,1,1)),M=new Pu,A=new Array(3),E=new gu,C=new gu,P=new gu,O=new Su,N=new Tx,L=new Ru,I=new Ru;this.projectVector=function(t,e){console.warn("Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("Projector: .pickingRay() is now raycaster.setFromCamera().")};var R=new function(){var t=[],e=[],n=[],o=null,s=null,l=new Su;function c(t){var e=t.positionWorld,r=t.positionScreen;e.copy(t.position).applyMatrix4(u),r.copy(e).applyMatrix4(C);var n=1/r.w;r.x*=n,r.y*=n,r.z*=n,t.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1}function h(t,e,r){return!0===t.visible||!0===e.visible||!0===r.visible||(A[0]=t.positionScreen,A[1]=e.positionScreen,A[2]=r.positionScreen,T.intersectsBox(M.setFromPoints(A)))}function d(t,e,r){return(r.positionScreen.x-t.positionScreen.x)*(e.positionScreen.y-t.positionScreen.y)-(r.positionScreen.y-t.positionScreen.y)*(e.positionScreen.x-t.positionScreen.x)<0}return{setObject:function(r){s=(o=r).material,l.getNormalMatrix(o.matrixWorld),t.length=0,e.length=0,n.length=0},projectVertex:c,checkTriangleVisibility:h,checkBackfaceCulling:d,pushVertex:function(t,e,n){(r=U()).position.set(t,e,n),c(r)},pushNormal:function(e,r,n){t.push(e,r,n)},pushColor:function(t,r,n){e.push(t,r,n)},pushUv:function(t,e){n.push(t,e)},pushLine:function(t,r){var n=p[t],i=p[r];n.positionScreen.copy(n.position).applyMatrix4(P),i.positionScreen.copy(i.position).applyMatrix4(P),!0===z(n.positionScreen,i.positionScreen)&&(n.positionScreen.multiplyScalar(1/n.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(a=B()).id=o.id,a.v1.copy(n),a.v2.copy(i),a.z=Math.max(n.positionScreen.z,i.positionScreen.z),a.renderOrder=o.renderOrder,a.material=o.material,o.material.vertexColors===eh&&(a.vertexColors[0].fromArray(e,3*t),a.vertexColors[1].fromArray(e,3*r)),w.elements.push(a))},pushTriangle:function(e,r,a){var c=arguments,u=p[e],f=p[r],m=p[a];if(!1!==h(u,f,m)&&(s.side===Ku||!0===d(u,f,m))){(i=k()).id=o.id,i.v1.copy(u),i.v2.copy(f),i.v3.copy(m),i.z=(u.positionScreen.z+f.positionScreen.z+m.positionScreen.z)/3,i.renderOrder=o.renderOrder,i.normalModel.fromArray(t,3*e),i.normalModel.applyMatrix3(l).normalize();for(var v=0;v<3;v++){var g=i.vertexNormalsModel[v];g.fromArray(t,3*c[v]),g.applyMatrix3(l).normalize(),i.uvs[v].fromArray(n,2*c[v])}i.vertexNormalsLength=3,i.material=o.material,w.elements.push(i)}}}};function D(r){(t=function(){if(e===d){var t=new Mx;return h.push(t),d++,e++,t}return h[e++]}()).id=r.id,t.object=r,_.setFromMatrixPosition(r.matrixWorld),_.applyMatrix4(C),t.z=_.z,t.renderOrder=r.renderOrder,w.objects.push(t)}function F(t,e,r){var n=1/t.w;t.z*=n,t.z>=-1&&t.z<=1&&((l=function(){if(c===b){var t=new Px;return x.push(t),b++,c++,t}return x[c++]}()).id=e.id,l.x=t.x*n,l.y=t.y*n,l.z=t.z,l.renderOrder=e.renderOrder,l.object=e,l.rotation=e.rotation,l.scale.x=e.scale.x*Math.abs(l.x-(t.x+r.projectionMatrix.elements[0])/(t.w+r.projectionMatrix.elements[12])),l.scale.y=e.scale.y*Math.abs(l.y-(t.y+r.projectionMatrix.elements[5])/(t.w+r.projectionMatrix.elements[13])),l.material=e.material,w.elements.push(l))}function U(){if(n===f){var t=new Ex;return p.push(t),f++,n++,t}return p[n++]}function k(){if(o===v){var t=new Ax;return m.push(t),v++,o++,t}return m[o++]}function B(){if(s===y){var t=new Cx;return g.push(t),y++,s++,t}return g[s++]}function j(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id!==e.id?t.id-e.id:0}function z(t,e){var r=0,n=1,i=t.z+t.w,o=e.z+e.w,a=-t.z+t.w,s=-e.z+e.w;return i>=0&&o>=0&&a>=0&&s>=0||!(i<0&&o<0||a<0&&s<0)&&(i<0?r=Math.max(r,i/(i-o)):o<0&&(n=Math.min(n,i/(i-o))),a<0?r=Math.max(r,a/(a-s)):s<0&&(n=Math.min(n,a/(a-s))),!(n<r||(t.lerp(e,r),e.lerp(t,1-n),0)))}this.projectScene=function(t,r,l,h){o=0,s=0,c=0,w.elements.length=0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),E.copy(r.matrixWorldInverse),C.multiplyMatrices(r.projectionMatrix,E),N.setFromMatrix(C),e=0,w.objects.length=0,w.lights.length=0,function t(e){if(!1!==e.visible){if(e instanceof zf)w.lights.push(e);else if(e instanceof zh||e instanceof Vh||e instanceof mf){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===N.intersectsObject(e))return;D(e)}else if(e instanceof wg){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===N.intersectsSprite(e))return;D(e)}for(var r=e.children,n=0,i=r.length;n<i;n++)t(r[n])}}(t),!0===l&&w.objects.sort(j);for(var d=w.objects,f=0,m=d.length;f<m;f++){var v=d[f].object,g=v.geometry;if(R.setObject(v),u=v.matrixWorld,n=0,v instanceof zh){if(g instanceof Yu){var y=g.groups;if(void 0===(bt=g.attributes).position)continue;for(var x=0,b=(wt=bt.position.array).length;x<b;x+=3)R.pushVertex(wt[x],wt[x+1],wt[x+2]);if(void 0!==bt.normal){var T=bt.normal.array;for(x=0,b=T.length;x<b;x+=3)R.pushNormal(T[x],T[x+1],T[x+2])}if(void 0!==bt.uv){var M=bt.uv.array;for(x=0,b=M.length;x<b;x+=2)R.pushUv(M[x],M[x+1])}if(null!==g.index){var A=g.index.array;if(y.length>0)for(var V=0;V<y.length;V++){var G=y[V];for(x=G.start,b=G.start+G.count;x<b;x+=3)R.pushTriangle(A[x],A[x+1],A[x+2])}else for(x=0,b=A.length;x<b;x+=3)R.pushTriangle(A[x],A[x+1],A[x+2])}else for(x=0,b=wt.length/3;x<b;x+=3)R.pushTriangle(x,x+1,x+2)}else if(g instanceof Iu){var H=g.vertices,W=g.faces,X=g.faceVertexUvs[0];O.getNormalMatrix(u);for(var Y=v.material,q=Array.isArray(Y),J=0,Z=H.length;J<Z;J++){if(_.copy(xt=H[J]),!0===Y.morphTargets)for(var Q=g.morphTargets,K=v.morphTargetInfluences,$=0,tt=Q.length;$<tt;$++){var et=K[$];if(0!==et){var rt=Q[$].vertices[J];_.x+=(rt.x-xt.x)*et,_.y+=(rt.y-xt.y)*et,_.z+=(rt.z-xt.z)*et}}R.pushVertex(_.x,_.y,_.z)}for(var nt=0,it=W.length;nt<it;nt++){var ot=W[nt];if(void 0!==(Y=!0===q?v.material[ot.materialIndex]:v.material)){var at=Y.side,st=p[ot.a],lt=p[ot.b],ct=p[ot.c];if(!1!==R.checkTriangleVisibility(st,lt,ct)){var ut=R.checkBackfaceCulling(st,lt,ct);if(at!==Ku){if(at===Zu&&!1===ut)continue;if(at===Qu&&!0===ut)continue}(i=k()).id=v.id,i.v1.copy(st),i.v2.copy(lt),i.v3.copy(ct),i.normalModel.copy(ot.normal),!1!==ut||at!==Qu&&at!==Ku||i.normalModel.negate(),i.normalModel.applyMatrix3(O).normalize();for(var ht=ot.vertexNormals,dt=0,pt=Math.min(ht.length,3);dt<pt;dt++){var ft=i.vertexNormalsModel[dt];ft.copy(ht[dt]),!1!==ut||at!==Qu&&at!==Ku||ft.negate(),ft.applyMatrix3(O).normalize()}i.vertexNormalsLength=ht.length;var mt=X[nt];if(void 0!==mt)for(var vt=0;vt<3;vt++)i.uvs[vt].copy(mt[vt]);i.color=ot.color,i.material=Y,i.z=(st.positionScreen.z+lt.positionScreen.z+ct.positionScreen.z)/3,i.renderOrder=v.renderOrder,w.elements.push(i)}}}}}else if(v instanceof Vh){if(P.multiplyMatrices(C,u),g instanceof Yu){if(void 0!==(bt=g.attributes).position){for(x=0,b=(wt=bt.position.array).length;x<b;x+=3)R.pushVertex(wt[x],wt[x+1],wt[x+2]);if(void 0!==bt.color){var gt=bt.color.array;for(x=0,b=gt.length;x<b;x+=3)R.pushColor(gt[x],gt[x+1],gt[x+2])}if(null!==g.index)for(x=0,b=(A=g.index.array).length;x<b;x+=2)R.pushLine(A[x],A[x+1]);else{var yt=v instanceof Kf?2:1;for(x=0,b=wt.length/3-1;x<b;x+=yt)R.pushLine(x,x+1)}}}else if(g instanceof Iu){if(0===(H=v.geometry.vertices).length)continue;for((st=U()).positionScreen.copy(H[0]).applyMatrix4(P),yt=v instanceof Kf?2:1,J=1,Z=H.length;J<Z;J++)(st=U()).positionScreen.copy(H[J]).applyMatrix4(P),(J+1)%yt>0||(lt=p[n-2],L.copy(st.positionScreen),I.copy(lt.positionScreen),!0===z(L,I)&&(L.multiplyScalar(1/L.w),I.multiplyScalar(1/I.w),(a=B()).id=v.id,a.v1.positionScreen.copy(L),a.v2.positionScreen.copy(I),a.z=Math.max(L.z,I.z),a.renderOrder=v.renderOrder,a.material=v.material,v.material.vertexColors===eh&&(a.vertexColors[0].copy(v.geometry.colors[J]),a.vertexColors[1].copy(v.geometry.colors[J-1])),w.elements.push(a)))}}else if(v instanceof mf){if(P.multiplyMatrices(C,u),g instanceof Iu)for(J=0,Z=(H=v.geometry.vertices).length;J<Z;J++){var xt;S.set((xt=H[J]).x,xt.y,xt.z,1),S.applyMatrix4(P),F(S,v,r)}else if(g instanceof Yu){var bt,wt;if(void 0!==(bt=g.attributes).position)for(x=0,b=(wt=bt.position.array).length;x<b;x+=3)S.set(wt[x],wt[x+1],wt[x+2],1),S.applyMatrix4(P),F(S,v,r)}}else v instanceof wg&&(S.set(u.elements[12],u.elements[13],u.elements[14],1),S.applyMatrix4(C),F(S,v,r))}return!0===h&&w.elements.sort(j),w}},V=new Ru,G=new Ru,H=new Ru,W=new Nu,X=new Nu,Y=new Nu,q=[],J=0,Z=[],Q=0,K=[],$=0;function tt(t){for(var n=e*r*4,i=0;i<n;i+=4)d[i]=255*t.r|0,d[i+1]=255*t.g|0,d[i+2]=255*t.b|0,d[i+3]=x?0:255;y.fillStyle=x?"rgba(0, 0, 0, 0)":t.getStyle(),y.fillRect(0,0,e,r)}function et(t,e){var r=0,n=0,i=255*t.color.r,o=255*t.color.g,a=255*t.color.b,s=new Uint8Array(768);if(e){for(;r<204;)s[n++]=Math.min(r*i/204,255),s[n++]=Math.min(r*o/204,255),s[n++]=Math.min(r*a/204,255),++r;for(;r<256;)s[n++]=Math.min(i+(r-204)*(255-i)/82,255),s[n++]=Math.min(o+(r-204)*(255-o)/82,255),s[n++]=Math.min(a+(r-204)*(255-a)/82,255),++r}else for(;r<256;)s[n++]=Math.min(r*i/255,255),s[n++]=Math.min(r*o/255,255),s[n++]=Math.min(r*a/255,255),++r;return s}function rt(t,e,r,n,i,o,a,s,l){var c=4*r,u=w[l.map.id];if(u.data){var h=u.width,d=h-1,p=u.data,f=4*((o*h&d)*h+(i*h&d));if(l.transparent){var m=p[f+1],v=p[f+2],g=p[f+3]*l.opacity/255,y=t[c+1],x=t[c+2];t[c]=p[f]*g+t[c]*(1-g),t[c+1]=m*g+y*(1-g),t[c+2]=v*g+x*(1-g),t[c+3]=(l.opacity<<8)-1,255==t[c+3]&&(e[r]=n)}else t[c]=p[f],t[c+1]=p[f+1],t[c+2]=p[f+2],t[c+3]=(l.opacity<<8)-1,e[r]=n}}function nt(t,e,r,n,i,o,a,s,l){var c=4*r,u=w[l.map.id];if(u.data){var h=u.width,d=3*(a>0?~~a:0),p=h-1,f=u.data,m=4*((o*h&p)*h+(i*h&p));if(l.transparent){var v=l.palette[d+1]*f[m+1],g=l.palette[d+2]*f[m+2],y=f[m+3]*l.opacity/256,x=t[c+1],b=t[c+2];t[c]=l.palette[d]*f[m]*y+t[c]*(1-y),t[c+1]=v*y+x*(1-y),t[c+2]=g*y+b*(1-y),t[c+3]=(l.opacity<<8)-1,255==t[c+3]&&(e[r]=n)}else t[c]=l.palette[d]*f[m]>>8,t[c+1]=l.palette[d+1]*f[m+1]>>8,t[c+2]=l.palette[d+2]*f[m+2]>>8,t[c+3]=(l.opacity<<8)-1,e[r]=n}}function it(t){var e=t.id,r=b[e];if(r&&t.map&&!w[t.map.id]&&delete b[e],void 0===b[e]||!0===t.needsUpdate){if(t instanceof Dh||t instanceof Rd||t instanceof Fd||t instanceof Gd)if(t instanceof Rd?t.palette||(t.palette=et(t,!1)):t instanceof Fd&&(t.palette||(t.palette=et(t,!0))),t.map){var n=new Rx.Texture;if(n.fromImage(t.map.image),!n.data)return;w[t.map.id]=n,r=t instanceof Dh||t instanceof Gd?rt:nt}else i=t.vertexColors===th?["var colorOffset = offset * 4;","buffer[ colorOffset ] = face.color.r * 255;","buffer[ colorOffset + 1 ] = face.color.g * 255;","buffer[ colorOffset + 2 ] = face.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"):["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * 255;","buffer[ colorOffset + 1 ] = material.color.g * 255;","buffer[ colorOffset + 2 ] = material.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"),r=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i);else if(t instanceof Fh){var i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * (color1.r+color2.r) * 0.5 * 255;","buffer[ colorOffset + 1 ] = material.color.g * (color1.g+color2.g) * 0.5 * 255;","buffer[ colorOffset + 2 ] = material.color.b * (color1.b+color2.b) * 0.5 * 255;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n");r=new Function("buffer, depthBuf, offset, depth, color1, color2, material",i)}else i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = u * 255;","buffer[ colorOffset + 1 ] = v * 255;","buffer[ colorOffset + 2 ] = 0;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n"),r=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i);b[e]=r,t.needsUpdate=!1}return r}function ot(t,i,h,f,g,y,x,b,w){if(!(t.z<-1||t.z>1||i.z<-1||i.z>1||h.z<-1||h.z>1)){var _=1<<M,P=t.x*o+l|0,O=i.x*o+l|0,N=h.x*o+l|0,L=t.y*a+c|0,U=i.y*a+c|0,k=h.y*a+c|0,B=b.vertexNormalsModel&&b.vertexNormalsModel.length,j=f&&g&&y,z=Math.max(Math.sqrt((P-O)*(P-O)+(L-U)*(L-U)),Math.sqrt((O-N)*(O-N)+(U-k)*(U-k)),Math.sqrt((N-P)*(N-P)+(k-L)*(k-L)));if(!(b instanceof Px)&&z>100*_){var V,G,H,W,X,Y,tt,et,rt,nt,it={vertexNormalsModel:[],color:b.color};return j&&($===K.length?(V=new Nu,K.push(V),++$,G=new Nu,K.push(G),++$,H=new Nu,K.push(H),++$):(V=K[$],G=K[++$],H=K[++$],++$),W=(1+i.z)*(i.w/t.w)/(1+t.z),V.copy(f).multiplyScalar(W).add(g).multiplyScalar(1/(W+1)),W=(1+h.z)*(h.w/i.w)/(1+i.z),G.copy(g).multiplyScalar(W).add(y).multiplyScalar(1/(W+1)),W=(1+t.z)*(t.w/h.w)/(1+h.z),H.copy(y).multiplyScalar(W).add(f).multiplyScalar(1/(W+1))),J===q.length?(X=new Ru,q.push(X),++J,Y=new Ru,q.push(Y),++J,tt=new Ru,q.push(tt),++J):(X=q[J],Y=q[++J],tt=q[++J],++J),X.copy(t).add(i).multiplyScalar(.5),Y.copy(i).add(h).multiplyScalar(.5),tt.copy(h).add(t).multiplyScalar(.5),B&&(Q===Z.length?(et=new yu,Z.push(et),++Q,rt=new yu,Z.push(rt),++Q,nt=new yu,Z.push(nt),++Q):(et=Z[Q],rt=Z[++Q],nt=Z[++Q],++Q),et.copy(b.vertexNormalsModel[0]).add(b.vertexNormalsModel[1]).normalize(),rt.copy(b.vertexNormalsModel[1]).add(b.vertexNormalsModel[2]).normalize(),nt.copy(b.vertexNormalsModel[2]).add(b.vertexNormalsModel[0]).normalize()),B&&(it.vertexNormalsModel[0]=b.vertexNormalsModel[0],it.vertexNormalsModel[1]=et,it.vertexNormalsModel[2]=nt),ot(t,X,tt,f,V,H,x,it,w),B&&(it.vertexNormalsModel[0]=b.vertexNormalsModel[1],it.vertexNormalsModel[1]=rt,it.vertexNormalsModel[2]=et),ot(i,Y,X,g,G,V,x,it,w),B&&(it.vertexNormalsModel[0]=et,it.vertexNormalsModel[1]=rt,it.vertexNormalsModel[2]=nt),ot(X,Y,tt,V,G,H,x,it,w),B&&(it.vertexNormalsModel[0]=b.vertexNormalsModel[2],it.vertexNormalsModel[1]=nt,it.vertexNormalsModel[2]=rt),void ot(h,tt,Y,y,H,G,x,it,w)}var at,lt,ct,ut,ht,dt,pt,ft,mt,vt=t.z*s+u|0,gt=i.z*s+u|0,yt=h.z*s+u|0;j=!1,f&&g&&y&&(j=!0,at=f.x,lt=1-f.y,ct=g.x,ut=1-g.y,ht=y.x,dt=1-y.y),B&&(pt=255*b.vertexNormalsModel[0].z,ft=255*b.vertexNormalsModel[1].z,mt=255*b.vertexNormalsModel[2].z);var xt=P-O,bt=U-L,wt=O-N,_t=k-U,St=N-P,Tt=L-k,Mt=Math.max(Math.min(P,O,N)+A>>M,0),At=Math.min(Math.max(P,O,N)+A>>M,e),Et=Math.max(Math.min(L,U,k)+A>>M,0),Ct=Math.min(Math.max(L,U,k)+A>>M,r);I=Math.min(Mt,I),D=Math.max(At,D),R=Math.min(Et,R),F=Math.max(Ct,F);var Pt=C,Ot=(Mt&=~(Pt-1))<<M,Nt=(Et&=~(Pt-1))<<M,Lt=bt*(Ot-P)+xt*(Nt-L),It=_t*(Ot-O)+wt*(Nt-U),Rt=Tt*(Ot-N)+St*(Nt-k);(bt>0||0==bt&&xt>0)&&Lt++,(_t>0||0==_t&&wt>0)&&It++,(Tt>0||0==Tt&&St>0)&&Rt++,Lt=Lt-1>>M,It=It-1>>M,Rt=Rt-1>>M;var Dt,Ft,Ut,kt,Bt,jt=vt-gt,zt=yt-vt,Vt=1/(xt*Tt-St*bt),Gt=Vt*(jt*Tt-zt*bt),Ht=Vt*(jt*St-xt*zt),Wt=vt+(Ot-P)*Gt+(Nt-L)*Ht|0;if(Gt=Gt*_|0,Ht=Ht*_|0,j){var Xt=at-ct,Yt=ht-at,qt=Vt*(Xt*Tt-Yt*bt),Jt=Vt*(Xt*St-xt*Yt),Zt=lt-ut,Qt=dt-lt;Ut=at+(Ot-P)*qt+(Nt-L)*Jt,kt=lt+(Ot-P)*(Dt=Vt*(Zt*Tt-Qt*bt))+(Nt-L)*(Ft=Vt*(Zt*St-xt*Qt)),qt*=_,Jt*=_,Dt*=_,Ft*=_}if(B){var Kt,$t=pt-ft,te=mt-pt,ee=Vt*($t*Tt-te*bt);Bt=pt+(Ot-P)*ee+(Nt-L)*(Kt=Vt*($t*St-xt*te)),ee*=_,Kt*=_}var re=Pt-1,ne=0,ie=0,oe=0,ae=0,se=0,le=0,ce=0,ue=0;xt>=0?ie-=re*xt:ne-=re*xt,bt>=0?ie-=re*bt:ne-=re*bt,wt>=0?ae-=re*wt:oe-=re*wt,_t>=0?ae-=re*_t:oe-=re*_t,St>=0?le-=re*St:se-=re*St,Tt>=0?le-=re*Tt:se-=re*Tt,Gt>=0?ue+=re*Gt:ce+=re*Gt,Ht>=0?ue+=re*Ht:ce+=re*Ht;var he,de,pe,fe=e-Pt,me=Lt,ve=It,ge=Rt,ye=Wt,xe=-Pt,be=xe*bt,we=xe*_t,_e=xe*Tt,Se=xe*Gt;j&&(he=xe*qt,de=xe*Dt),B&&(pe=xe*ee);for(var Te=Mt,Me=Et;Me<Ct;Me+=Pt){for(;Te>=Mt&&Te<At&&me>=ie&&ve>=ae&&ge>=le;)Te+=xe,me+=be,ve+=we,ge+=_e,ye+=Se,j&&(Ut+=he,kt+=de),B&&(Bt+=pe);for(xe=-xe,be=-be,we=-we,_e=-_e,Se=-Se,j&&(he=-he,de=-de),B&&(pe=-pe);Te+=xe,me+=be,ve+=we,ge+=_e,ye+=Se,j&&(Ut+=he,kt+=de),B&&(Bt+=pe),!(Te<Mt||Te>=At);)if(me<ie){if(be<0)break}else if(ve<ae){if(we<0)break}else if(ge<le){if(_e<0)break}else{var Ae=Te>>E,Ee=Me>>E,Ce=Ae+Ee*n;if(!(m[Ce]<ye+ce)){var Pe=v[Ce];Pe&T&&st(Ae,Ee),v[Ce]=Pe&~(S|T);var Oe=Te+Me*e;if(me>=ne&&ve>=oe&&ge>=se){m[Ce]=Math.min(m[Ce],ye+ue);var Ne=me,Le=ve,Ie=ye;j&&(Be=Ut,je=kt),B&&(ze=Bt);for(var Re=0;Re<Pt;Re++){var De=Ne,Fe=Le,Ue=Ie;j&&(Ge=Be,He=je),B&&(We=ze);for(var ke=0;ke<Pt;ke++)(Ye=Ue)<p[Oe]&&x(d,p,Oe,Ye,Ge,He,We,b,w),De+=bt,Fe+=_t,Ue+=Gt,j&&(Ge+=qt,He+=Dt),B&&(We+=ee),Oe++;Ne+=xt,Le+=wt,Ie+=Ht,j&&(Be+=Jt,je+=Ft),B&&(ze+=Kt),Oe+=fe}}else{Ne=me,Le=ve;var Be,je,ze,Ve=ge;for(Ie=ye,j&&(Be=Ut,je=kt),B&&(ze=Bt),Re=0;Re<Pt;Re++){De=Ne,Fe=Le;var Ge,He,We,Xe=Ve;for(Ue=Ie,j&&(Ge=Be,He=je),B&&(We=ze),ke=0;ke<Pt;ke++){var Ye;(De|Fe|Xe)>=0&&(Ye=Ue)<p[Oe]&&x(d,p,Oe,Ye,Ge,He,We,b,w),De+=bt,Fe+=_t,Xe+=Tt,Ue+=Gt,j&&(Ge+=qt,He+=Dt),B&&(We+=ee),Oe++}Ne+=xt,Le+=wt,Ve+=St,Ie+=Ht,j&&(Be+=Jt,je+=Ft),B&&(ze+=Kt),Oe+=fe}}}}me+=Pt*xt,ve+=Pt*wt,ge+=Pt*St,ye+=Pt*Ht,j&&(Ut+=Pt*Jt,kt+=Pt*Ft),B&&(Bt+=Pt*Kt)}}}function at(t,b,w,U,k,B){if(O||(O=!0,C=1<<(E=0),function(t,b){n=Math.floor(g.width/C),i=Math.floor(b/C);var w=1<<M;o=w*(e=n*C)/2,a=-w*(r=i*C)/2,s=P/2,l=w*e/2+.5,c=w*r/2+.5,u=P/2+.5,g.width=e,g.height=r,y.fillStyle=x?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,e,r),h=y.getImageData(0,0,e,r),d=h.data,p=new Int32Array(d.length/4),f=n*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;tt(_)}(0,g.height)),!(t.z<-1||t.z>1||b.z<-1||b.z>1)){var j=Math.floor(.5*(B.linewidth-1)),z=t.x*o+l|0,V=b.x*o+l|0,G=t.y*a+c|0,H=b.y*a+c|0,W=t.z*s+u|0,X=b.z*s+u|0,Y=z-V,q=G-H,J=W-X,Z=Math.max(Math.min(z,V)+A>>M,0),Q=Math.min(Math.max(z,V)+A>>M,e),K=Math.max(Math.min(G,H)+A>>M,0),$=Math.min(Math.max(G,H)+A>>M,r),et=Math.max(Math.min(W,X)+A>>M,0),rt=Math.max(W,X)+A>>M;I=Math.min(Z,I),D=Math.max(Q,D),R=Math.min(K,R),F=Math.max($,F);var nt,it,ot,at,lt,ct=Math.sqrt(q*q+Y*Y),ut=Y/ct,ht=q/ct,dt=J/ct;for(L.set(ut,ht,dt),L.cross(N),L.normalize();ct>0;){nt=(nt=V+ct*ut)+A>>M,it=(it=H+ct*ht)+A>>M,lt=X+ct*dt+A>>M;for(var pt=-j;pt<=j;++pt)if(ot=Math.floor(nt+L.x*pt),at=Math.floor(it+L.y*pt),!(I>=ot||D<=ot||R>=at||F<=at)){var ft=ot>>E,mt=at>>E,vt=ft+mt*n;if(!(m[vt]<et)){m[vt]=Math.min(m[vt],rt);var gt=v[vt];gt&T&&st(ft,mt),v[vt]=gt&~(S|T);var yt=ot+at*e;lt<p[yt]&&k(d,p,yt,lt,w,U,B)}}--ct}}}function st(t,r){for(var n=t*C+r*C*e,i=4*n,o=e-C,a=4*o,s=0;s<C;s++){for(var l=0;l<C;l++)p[n++]=P,d[i++]=255*_.r|0,d[i++]=255*_.g|0,d[i++]=255*_.b|0,d[i++]=x?0:255;n+=o,i+=a}}this.domElement=g,this.autoClear=!0,this.setClearColor=function(t){_.set(t),tt(_)},this.setPixelRatio=function(){},this.setSize=function(t,b){n=Math.floor(t/C),i=Math.floor(b/C);var w=1<<M;o=w*(e=n*C)/2,a=-w*(r=i*C)/2,s=P/2,l=w*e/2+.5,c=w*r/2+.5,u=P/2+.5,g.width=e,g.height=r,y.fillStyle=x?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,e,r),h=y.getImageData(0,0,e,r),d=h.data,p=new Int32Array(d.length/4),f=n*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;tt(_)},this.setSize(g.width,g.height),this.clear=function(){I=1/0,R=1/0,D=0,F=0,J=0,Q=0,$=0;for(var t=0;t<f;t++)m[t]=P,v[t]=v[t]&S?S:T},this.render=function(t,e){this.clear();var r=t.background;r&&r.isColor&&tt(r);for(var o=z.projectScene(t,e,!1,!1).elements,a=0,s=o.length;a<s;a++){var l=o[a],c=l.material;if(p=it(c))if(l instanceof Ax)l.uvs?ot(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,l.uvs[0],l.uvs[1],l.uvs[2],p,l,c):ot(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,null,null,null,p,l,c);else if(l instanceof Px){var u=.5*l.scale.x,d=.5*l.scale.y;V.copy(l),V.x-=u,V.y+=d,G.copy(l),G.x-=u,G.y-=d,H.copy(l),H.x+=u,H.y+=d,c.map?(W.set(0,1),X.set(0,0),Y.set(1,1),ot(V,G,H,W,X,Y,p,l,c)):ot(V,G,H,null,null,null,p,l,c),V.copy(l),V.x+=u,V.y+=d,G.copy(l),G.x-=u,G.y-=d,H.copy(l),H.x+=u,H.y-=d,c.map?(W.set(1,1),X.set(0,0),Y.set(1,0),ot(V,G,H,W,X,Y,p,l,c)):ot(V,G,H,null,null,null,p,l,c)}else if(l instanceof Cx){var p=it(c);at(l.v1.positionScreen,l.v2.positionScreen,l.vertexColors[0],l.vertexColors[1],p,c)}}!function(){for(var t=0,e=0;e<i;e++)for(var r=0;r<n;r++)v[t]&T&&(st(r,e),v[t]=S),t++}();var f=Math.min(I,U),m=Math.min(R,k),g=Math.max(D,B)-f,x=Math.max(F,j)-m;f!==1/0&&y.putImageData(h,0,0,f,m,g,x),U=I,k=R,B=D,j=F}};Rx.Texture=function(){var t;this.fromImage=function(e){if(!(!e||e.width<=0||e.height<=0)){void 0===t&&(t=document.createElement("canvas"));var r=e.width>e.height?e.width:e.height;r=vu.ceilPowerOfTwo(r),t.width==r&&t.height==r||(t.width=r,t.height=r);var n=t.getContext("2d");n.clearRect(0,0,r,r),n.drawImage(e,0,0,r,r);var i=n.getImageData(0,0,r,r);this.data=i.data,this.width=r,this.height=r,this.srcUrl=e.src}}};var Dx=function(t){Mu.call(this),this.node=t};(Dx.prototype=Object.create(Mu.prototype)).constructor=Dx;var Fx=new xd,Ux=new Fm;function kx(){this.seq=[],this.map={}}var Bx=[],jx=[],zx=new Float32Array(16),Vx=new Float32Array(9);function Gx(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,o=Bx[i];if(void 0===o&&(o=new Float32Array(i),Bx[i]=o),0!==e){n.toArray(o,0);for(var a=1,s=0;a!==e;++a)t[a].toArray(o,s+=r)}return o}function Hx(t,e){var r=jx[e];void 0===r&&(r=new Int32Array(e),jx[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocTextureUnit();return r}function Wx(t,e){t.uniform1f(this.addr,e)}function Xx(t,e){t.uniform1i(this.addr,e)}function Yx(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function qx(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function Jx(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function Zx(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function Qx(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(Vx.set(e.elements),t.uniformMatrix3fv(this.addr,!1,Vx))}function Kx(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(zx.set(e.elements),t.uniformMatrix4fv(this.addr,!1,zx))}function $x(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTexture2D(e||Fx,n)}function tb(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTextureCube(e||Ux,n)}function eb(t,e){t.uniform2iv(this.addr,e)}function rb(t,e){t.uniform3iv(this.addr,e)}function nb(t,e){t.uniform4iv(this.addr,e)}function ib(t,e){t.uniform1fv(this.addr,e)}function ob(t,e){t.uniform1iv(this.addr,e)}function ab(t,e){t.uniform2fv(this.addr,Gx(e,this.size,2))}function sb(t,e){t.uniform3fv(this.addr,Gx(e,this.size,3))}function lb(t,e){t.uniform4fv(this.addr,Gx(e,this.size,4))}function cb(t,e){t.uniformMatrix2fv(this.addr,!1,Gx(e,this.size,4))}function ub(t,e){t.uniformMatrix3fv(this.addr,!1,Gx(e,this.size,9))}function hb(t,e){t.uniformMatrix4fv(this.addr,!1,Gx(e,this.size,16))}function db(t,e,r){var n=e.length,i=Hx(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTexture2D(e[o]||Fx,i[o])}function pb(t,e,r){var n=e.length,i=Hx(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTextureCube(e[o]||Ux,i[o])}function fb(t,e,r){this.id=t,this.addr=r,this.setValue=function(t){switch(e.type){case 5126:return Wx;case 35664:return Yx;case 35665:return qx;case 35666:return Jx;case 35674:return Zx;case 35675:return Qx;case 35676:return Kx;case 35678:case 36198:return $x;case 35680:return tb;case 5124:case 35670:return Xx;case 35667:case 35671:return eb;case 35668:case 35672:return rb;case 35669:case 35673:return nb}}()}function mb(t,e,r){this.id=t,this.addr=r,this.size=e.size,this.setValue=function(t){switch(e.type){case 5126:return ib;case 35664:return ab;case 35665:return sb;case 35666:return lb;case 35674:return cb;case 35675:return ub;case 35676:return hb;case 35678:return db;case 35680:return pb;case 5124:case 35670:return ob;case 35667:case 35671:return eb;case 35668:case 35672:return rb;case 35669:case 35673:return nb}}()}function vb(t){this.id=t,kx.call(this)}vb.prototype.setValue=function(t,e){for(var r=this.seq,n=0,i=r.length;n!==i;++n){var o=r[n];o.setValue(t,e[o.id])}};var gb=/([\w\d_]+)(\])?(\[|\.)?/g;function yb(t,e){t.seq.push(e),t.map[e.id]=e}function xb(t,e,r){var n=t.name,i=n.length;for(gb.lastIndex=0;;){var o=gb.exec(n),a=o[1],s=o[3];if("]"===o[2]&&(a|=0),void 0===s||"["===s&&gb.lastIndex+2===i){yb(r,void 0===s?new fb(a,t,e):new mb(a,t,e));break}var l=r.map[a];void 0===l&&yb(r,l=new vb(a)),r=l}}function bb(t,e,r){kx.call(this),this.renderer=r;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<n;++i){var o=t.getActiveUniform(e,i);xb(o,t.getUniformLocation(e,o.name),this)}}function wb(t){fd.call(this),this.cameras=t||[]}function _b(t){"string"==typeof t&&(console.warn("Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}bb.prototype.setValue=function(t,e,r){var n=this.map[e];void 0!==n&&n.setValue(t,r,this.renderer)},bb.prototype.setOptional=function(t,e,r){var n=e[r];void 0!==n&&this.setValue(t,r,n)},bb.upload=function(t,e,r,n){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,n)}},bb.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var o=t[n];o.id in e&&r.push(o)}return r},wb.prototype=Object.assign(Object.create(fd.prototype),{constructor:wb,isArrayCamera:!0}),_b.prototype.clone=function(){return new _b(void 0===this.value.clone?this.value:this.value.clone())},new Nu(1/1024,1/512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","","","","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","","#if (FXAA_PC == 1)","","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","    #endif","","                        }","                        #endif","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n");var Sb={packVector3:["float vec3_to_float( vec3 data ) {","\tconst float unit = 255.0/256.0;","\thighp float compressed = fract( data.x * unit ) + floor( data.y * unit * 255.0 ) + floor( data.z * unit * 255.0 ) * 255.0;","\treturn compressed;","}"].join("\n"),unpackFloat:["vec3 float_to_vec3( float data ) {","\tconst float unit = 255.0;","\tvec3 uncompressed;","\tuncompressed.x = fract( data );","\tfloat zInt = floor( data / unit );","\tuncompressed.z = fract( zInt / unit );","\tuncompressed.y = fract( floor( data - ( zInt * unit ) ) / unit );","\treturn uncompressed;","}"].join("\n"),packNormal:["vec2 normal_to_vec2( vec3 normal ) {","\treturn normal.xy / sqrt( normal.z * 8.0 + 8.0 ) + 0.5;","}"].join("\n"),unpackVector2:["vec3 vec2_to_normal( vec2 data ) {","\tvec2 fenc = data * 4.0 - 2.0;","\tfloat f = dot( fenc, fenc );","\tfloat g = sqrt( 1.0 - f / 4.0 );","\tvec3 normal;","\tnormal.xy = fenc * g;","\tnormal.z = 1.0 - f / 2.0;","\treturn normal;","}"].join("\n"),computeTextureCoord:["vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );"].join("\n"),packNormalDepth:["vec4 packedNormalDepth;","packedNormalDepth.xyz = normal * 0.5 + 0.5;","packedNormalDepth.w = position.z / position.w;"].join("\n"),unpackNormalDepth:["vec4 normalDepthMap = texture2D( samplerNormalDepth, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = normalDepthMap.xyz * 2.0 - 1.0;"].join("\n"),packNormalDepthShininess:["vec4 packedNormalDepthShininess;","packedNormalDepthShininess.xy = normal_to_vec2( normal );","packedNormalDepthShininess.z = shininess;","packedNormalDepthShininess.w = position.z / position.w;"].join("\n"),unpackNormalDepthShininess:["vec4 normalDepthMap = texture2D( samplerNormalDepthShininess, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = vec2_to_normal( normalDepthMap.xy );","float shininess = normalDepthMap.z;"].join("\n"),packColor:["vec4 packedColor;","packedColor.x = vec3_to_float( diffuseColor.rgb );","packedColor.y = vec3_to_float( emissiveColor );","packedColor.z = vec3_to_float( specularColor );","packedColor.w = shininess;"].join("\n"),unpackColor:["vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 diffuseColor = float_to_vec3( colorMap.x );","vec3 emissiveColor = float_to_vec3( colorMap.y );","vec3 specularColor = float_to_vec3( colorMap.z );","float shininess = colorMap.w;"].join("\n"),packLight:["vec4 packedLight;","packedLight.xyz = lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * attenuation;","packedLight.w = lightIntensity * specular * max( dot( lightVector, normal ), 0.0 ) * attenuation;"].join("\n"),computeVertexPositionVS:["vec2 xy = texCoord * 2.0 - 1.0;","vec4 vertexPositionProjected = vec4( xy, depth, 1.0 );","vec4 vertexPositionVS = matProjInverse * vertexPositionProjected;","vertexPositionVS.xyz /= vertexPositionVS.w;","vertexPositionVS.w = 1.0;"].join("\n"),computeSpecular:["vec3 halfVector = normalize( lightVector - normalize( vertexPositionVS.xyz ) );","float dotNormalHalf = max( dot( normal, halfVector ), 0.0 );","float specular = 0.31830988618 * ( shininess * 0.5 + 1.0 ) * pow( dotNormalHalf, shininess );"].join("\n"),combine:["gl_FragColor = vec4( lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * ( diffuseColor + specular * specularColor ) * attenuation, 1.0 );"].join("\n")},Tb={commonUniforms:{matProjInverse:new _b(new gu),viewWidth:new _b(800),viewHeight:new _b(600)}};["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",Sb.packNormalDepth,"\tgl_FragColor = packedNormalDepth;","}"].join("\n"),new _b(null),new _b(new Ru(0,0,1,1)),new _b(new Eu(0)),new _b(new Eu(0)),new _b(new Eu(0)),new _b(30),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","#include <uv_pars_fragment>","#include <map_pars_fragment>",Sb.packVector3,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;","#include <map_fragment>",Sb.packColor,"\tgl_FragColor = packedColor;","}"].join("\n"),Object.assign({samplerColor:new _b(null)},Tb.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;",Sb.unpackFloat,"void main() {",Sb.computeTextureCoord,Sb.unpackColor,"\tgl_FragColor = vec4( emissiveColor, 1.0 );","}"].join("\n"),Object.assign({samplerNormalDepth:new _b(null),samplerColor:new _b(null),lightColor:new _b(new Eu(0)),lightPositionVS:new _b(new yu(0,1,0)),lightIntensity:new _b(1),lightRadius:new _b(1)},Tb.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",Sb.unpackFloat,"void main() {",Sb.computeTextureCoord,Sb.unpackNormalDepth,Sb.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",Sb.unpackColor,Sb.computeSpecular,"\t//float cutoff = 0.3;","\t//float denom = distance / lightRadius + 1.0;","\t//float attenuation = 1.0 / ( denom * denom );","\t//attenuation = ( attenuation - cutoff ) / ( 1.0 - cutoff );","\t//attenuation = max( attenuation, 0.0 );","\t//attenuation *= attenuation;","\t//diffuseColor *= saturate( -distance / lightRadius + 1.0 );","\t//float attenuation = 1.0;","\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",Sb.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new _b(null),samplerColor:new _b(null),lightColor:new _b(new Eu(0)),lightDirectionVS:new _b(new yu(0,1,0)),lightPositionVS:new _b(new yu(0,1,0)),lightAngle:new _b(1),lightIntensity:new _b(1)},Tb.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Sb.unpackFloat,"void main() {",Sb.computeTextureCoord,Sb.unpackNormalDepth,Sb.computeVertexPositionVS,Sb.unpackColor,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}","\tdiffuseColor *= spot;",Sb.computeSpecular,"\tconst float attenuation = 1.0;",Sb.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new _b(null),samplerColor:new _b(null),lightColor:new _b(new Eu(0)),lightDirectionVS:new _b(new yu(0,1,0)),lightIntensity:new _b(1)},Tb.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Sb.unpackFloat,"void main() {",Sb.computeTextureCoord,Sb.unpackNormalDepth,Sb.computeVertexPositionVS,Sb.unpackColor,"\tvec3 lightVector = normalize( lightDirectionVS );",Sb.computeSpecular,"\tconst float attenuation = 1.0;",Sb.combine,"}"].join("\n"),new _b(30),["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","uniform float shininess;",Sb.packNormal,"void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",Sb.packNormalDepthShininess,"\tgl_FragColor = packedNormalDepthShininess;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new _b(null),lightColor:new _b(new Eu(0)),lightPositionVS:new _b(new yu(0,1,0)),lightIntensity:new _b(1),lightRadius:new _b(1)},Tb.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",Sb.unpackFloat,Sb.unpackVector2,"void main() {",Sb.computeTextureCoord,Sb.unpackNormalDepthShininess,Sb.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",Sb.computeSpecular,"\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",Sb.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new _b(null),lightColor:new _b(new Eu(0)),lightDirectionVS:new _b(new yu(0,1,0)),lightPositionVS:new _b(new yu(0,1,0)),lightAngle:new _b(1),lightIntensity:new _b(1)},Tb.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Sb.unpackFloat,Sb.unpackVector2,"void main() {",Sb.computeTextureCoord,Sb.unpackNormalDepthShininess,Sb.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}",Sb.computeSpecular,"\tconst float attenuation = 1.0;",Sb.packLight,"\tgl_FragColor = spot * packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new _b(null),lightColor:new _b(new Eu(0)),lightDirectionVS:new _b(new yu(0,1,0)),lightIntensity:new _b(1)},Tb.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Sb.unpackFloat,Sb.unpackVector2,"void main() {",Sb.computeTextureCoord,Sb.unpackNormalDepthShininess,Sb.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightDirectionVS );",Sb.computeSpecular,"\tconst float attenuation = 1.0;",Sb.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerLight:new _b(null),map:new _b(null),offsetRepeat:new _b(new Ru(0,0,1,1)),diffuse:new _b(new Eu(0)),emissive:new _b(new Eu(0)),specular:new _b(new Eu(0)),shininess:new _b(30)},Tb.commonUniforms),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform sampler2D samplerLight;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float viewHeight;","uniform float viewWidth;","#include <uv_pars_fragment>","#include <map_pars_fragment>",Sb.unpackFloat,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;",Sb.computeTextureCoord,"\tvec4 light = texture2D( samplerLight, texCoord );","#include <map_fragment>","\tvec3 diffuseFinal = diffuseColor.rgb * light.rgb;","\tvec3 emissiveFinal = emissiveColor;","\tvec3 specularFinal = specularColor * light.rgb * light.a;","\tgl_FragColor = vec4( diffuseFinal + emissiveFinal + specularFinal, 1.0 );","}"].join("\n"),new _b(null),["varying vec2 texCoord;","void main() {","\tvec4 pos = vec4( sign( position.xy ), 0.0, 1.0 );","\ttexCoord = pos.xy * vec2( 0.5 ) + 0.5;","\tgl_Position = pos;","}"].join("\n"),["varying vec2 texCoord;","uniform sampler2D samplerResult;","void main() {","\tgl_FragColor = texture2D( samplerResult, texCoord );","}"].join("\n"),Object.create(Yu.prototype),Object.create(Yu.prototype),Object.create(Yu.prototype),Object.create(Yu.prototype),Object.create(Yu.prototype),new Nu(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n"),new Nu(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n"),new Nu(.5,.5),new Eu(16772608),new Eu(0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n"),["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n"),new Nu,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if (depthblur) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n"),new yu(2,2,2),new yu(1,1,1),new yu(0,0,0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n"),new Eu(16777215),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n"),new Nu(512,512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n"),["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float angle = hue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (saturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","}","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","vec2 p = vUv;","if (side == 0){","if (p.x > 0.5) p.x = 1.0 - p.x;","}else if (side == 1){","if (p.x < 0.5) p.x = 1.0 - p.x;","}else if (side == 2){","if (p.y < 0.5) p.y = 1.0 - p.y;","}else if (side == 3){","if (p.y > 0.5) p.y = 1.0 - p.y;","} ","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n"),new Nu(512,512),new Nu(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n"),["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","vec2 parallaxMap( in vec3 V ) {","float initialHeight = texture2D( bumpMap, vUv ).r;","vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","return vUv - texCoordOffset;","}","#else","vec2 parallaxMap( in vec3 V ) {","float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","float layerHeight = 1.0 / numLayers;","float currentLayerHeight = 0.0;","vec2 dtex = parallaxScale * V.xy / V.z / numLayers;","vec2 currentTextureCoords = vUv;","float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","for ( int i = 0; i < 30; i += 1 ) {","if ( heightFromTexture <= currentLayerHeight ) {","break;","}","currentLayerHeight += layerHeight;","currentTextureCoords -= dtex;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","}","#ifdef USE_STEEP_PARALLAX","return currentTextureCoords;","#elif defined( USE_RELIEF_PARALLAX )","vec2 deltaTexCoord = dtex / 2.0;","float deltaHeight = layerHeight / 2.0;","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","const int numSearches = 5;","for ( int i = 0; i < numSearches; i += 1 ) {","deltaTexCoord /= 2.0;","deltaHeight /= 2.0;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","if( heightFromTexture > currentLayerHeight ) {","currentTextureCoords -= deltaTexCoord;","currentLayerHeight += deltaHeight;","} else {","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","}","}","return currentTextureCoords;","#elif defined( USE_OCLUSION_PARALLAX )","vec2 prevTCoords = currentTextureCoords + dtex;","float nextH = heightFromTexture - currentLayerHeight;","float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;","float weight = nextH / ( nextH - prevH );","return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","#else","return vUv;","#endif","}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","vec2 texDx = dFdx( vUv );","vec2 texDy = dFdy( vUv );","vec3 vSigmaX = dFdx( surfPosition );","vec3 vSigmaY = dFdy( surfPosition );","vec3 vR1 = cross( vSigmaY, surfNormal );","vec3 vR2 = cross( surfNormal, vSigmaX );","float fDet = dot( vSigmaX, vR1 );","vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","vec3 vProjVtex;","vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","vProjVtex.z = dot( surfNormal, viewPosition );","return parallaxMap( vProjVtex );","}","void main() {","vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","gl_FragColor = texture2D( map, mapUv );","}"].join("\n"),["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float pixelSize;","uniform vec2 resolution;","varying highp vec2 vUv;","void main(){","vec2 dxy = pixelSize / resolution;","vec2 coord = dxy * floor( vUv / dxy );","gl_FragColor = texture2D(tDiffuse, coord);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n"),new Nu,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","gl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","gl_FragColor = newTex;","}"].join("\n"),new Nu(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = rand( vUv );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n"),["uniform mat4 textureMatrix;","varying vec2 vUv;","varying vec4 vUvRefraction;","void main() {","\tvUv = uv;","\tvUvRefraction = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform float time;","uniform sampler2D tDiffuse;","uniform sampler2D tDudv;","varying vec2 vUv;","varying vec4 vUvRefraction;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );","}","void main() {"," float waveStrength = 0.1;"," float waveSpeed = 0.03;","\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;","\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );","\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;"," vec4 uv = vec4( vUvRefraction );"," uv.xy += distortion;","\tvec4 base = texture2DProj( tDiffuse, uv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n"),wd.merge([Qp.fog,Qp.lights,{enableBump:{value:0},enableSpecular:{value:0},tDiffuse:{value:null},tBeckmann:{value:null},diffuse:{value:new Eu(15658734)},specular:{value:new Eu(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75},bumpMap:{value:null},bumpScale:{value:1},specularMap:{value:null},offsetRepeat:{value:new Ru(0,0,1,1)},uWrapRGB:{value:new yu(.75,.375,.1875)}}]),["#define USE_BUMPMAP","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Zp.common,Zp.bsdfs,Zp.packing,Zp.lights_pars_begin,Zp.shadowmap_pars_fragment,Zp.fog_pars_fragment,Zp.bumpmap_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","diffuseColor = diffuseColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewerDirection = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 totalSpecularLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += pointLight[ i ].color * ( pointDiffuseWeight * attenuation );","totalSpecularLight += pointLight[ i ].color * specular * ( pointSpecularWeight * specularStrength * attenuation );","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * ( dirSpecularWeight * specularStrength );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewerDirection, uRoughness, uSpecularBrightness );","vec3 hemiSpecularColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","totalSpecularLight += hemiSpecularColor * specular * ( hemiSpecularWeight * specularStrength );","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor * diffuse ) + totalSpecularLight;","gl_FragColor = linearToOutputTexel( vec4( outgoingLight, diffuseColor.a ) );",Zp.fog_fragment,"}"].join("\n"),["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Zp.common,Zp.lights_pars_begin,Zp.shadowmap_pars_vertex,Zp.fog_pars_vertex,"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",Zp.shadowmap_vertex,Zp.fog_vertex,"}"].join("\n"),wd.merge([Qp.fog,Qp.lights,{passID:{value:0},tDiffuse:{value:null},tNormal:{value:null},tBlur1:{value:null},tBlur2:{value:null},tBlur3:{value:null},tBlur4:{value:null},tBeckmann:{value:null},uNormalScale:{value:1},diffuse:{value:new Eu(15658734)},specular:{value:new Eu(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Zp.common,Zp.lights_pars_begin,Zp.fog_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 mSpecular = vec4( specular, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","diffuseColor *= colDiffuse;","vec4 posAndU = vec4( -vViewPosition, vUv.x );","vec4 posAndU_dx = dFdx( posAndU ),  posAndU_dy = dFdy( posAndU );","vec3 tangent = posAndU_dx.w * posAndU_dx.xyz + posAndU_dy.w * posAndU_dy.xyz;","vec3 normal = normalize( vNormal );","vec3 binormal = normalize( cross( tangent, normal ) );","tangent = cross( normal, binormal );","mat3 tsb = mat3( tangent, binormal, normal );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec3 finalNormal = tsb * normalTex;","normal = normalize( finalNormal );","vec3 viewerDirection = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( pointLights[ i ].direction );","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","totalDiffuseLight += pointLightColor[ i ] * ( pointDiffuseWeight * attenuation );","if ( passID == 1 ) {","float pointSpecularWeight = KS_Skin_Specular( normal, pointVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += pointLightColor[ i ] * mSpecular.xyz * ( pointSpecularWeight * attenuation );","}","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","if ( passID == 1 ) {","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += directionalLights[ i ].color * mSpecular.xyz * dirSpecularWeight;","}","}","#endif","outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalSpecularLight );","if ( passID == 0 ) {","outgoingLight = sqrt( outgoingLight );","} else if ( passID == 1 ) {","#ifdef VERSION1","vec3 nonblurColor = sqrt(outgoingLight );","#else","vec3 nonblurColor = outgoingLight;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;","outgoingLight = vec3( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color );","outgoingLight *= sqrt( colDiffuse.xyz );","outgoingLight += ambientLightColor * diffuse * colDiffuse.xyz + totalSpecularLight;","#ifndef VERSION1","outgoingLight = sqrt( outgoingLight );","#endif","}","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",Zp.fog_fragment,"}"].join("\n"),["#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Zp.common,Zp.fog_pars_vertex,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif",Zp.fog_vertex,"}"].join("\n"),["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Zp.common,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {","return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n"),wd.merge([Qp.fog,Qp.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new Eu(15658734)},specular:{value:new Eu(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new Nu(1,1)},uRepeatOverlay:{value:new Nu(1,1)},uOffset:{value:new Nu(0,0)}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Zp.common,Zp.bsdfs,Zp.lights_pars_begin,Zp.shadowmap_pars_fragment,Zp.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",Zp.fog_fragment,"}"].join("\n"),["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",Zp.shadowmap_pars_vertex,Zp.fog_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",Zp.shadowmap_vertex,Zp.fog_vertex,"}"].join("\n"),new yu,new Eu(15658734),new Eu(328965),new Eu(16777215),["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n"),new yu,new Eu(15658734),new Eu(328965),new Eu(15658734),new Eu(8421504),new Eu(0),new Eu(0),new Eu(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n"),new yu,new Eu(15658734),new Eu(328965),new Eu(16777215),new Eu(0),new Eu(0),new Eu(0),new Eu(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n"),new yu,new Eu(15658734),new Eu(328965),new Eu(16777215),new Eu(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n");var Mb=function(t){void 0==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());for(this.perm=[],e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};Mb.prototype.dot=function(t,e,r){return t[0]*e+t[1]*r},Mb.prototype.dot3=function(t,e,r,n){return t[0]*e+t[1]*r+t[2]*n},Mb.prototype.dot4=function(t,e,r,n,i){return t[0]*e+t[1]*r+t[2]*n+t[3]*i},Mb.prototype.noise=function(t,e){var r,n,i=(t+e)*(.5*(Math.sqrt(3)-1)),o=Math.floor(t+i),a=Math.floor(e+i),s=(3-Math.sqrt(3))/6,l=(o+a)*s,c=t-(o-l),u=e-(a-l);c>u?(r=1,n=0):(r=0,n=1);var h=c-r+s,d=u-n+s,p=c-1+2*s,f=u-1+2*s,m=255&o,v=255&a,g=this.perm[m+r+this.perm[v+n]]%12,y=this.perm[m+1+this.perm[v+1]]%12,x=.5-c*c-u*u,b=.5-h*h-d*d,w=.5-p*p-f*f;return 70*((x<0?0:(x*=x)*x*this.dot(this.grad3[this.perm[m+this.perm[v]]%12],c,u))+(b<0?0:(b*=b)*b*this.dot(this.grad3[g],h,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[y],p,f)))},Mb.prototype.noise3d=function(t,e,r){var n,i,o,a,s,l,c=(t+e+r)*(1/3),u=Math.floor(t+c),h=Math.floor(e+c),d=Math.floor(r+c),p=(u+h+d)*(1/6),f=t-(u-p),m=e-(h-p),v=r-(d-p);f>=m?m>=v?(n=1,i=0,o=0,a=1,s=1,l=0):f>=v?(n=1,i=0,o=0,a=1,s=0,l=1):(n=0,i=0,o=1,a=1,s=0,l=1):m<v?(n=0,i=0,o=1,a=0,s=1,l=1):f<v?(n=0,i=1,o=0,a=0,s=1,l=1):(n=0,i=1,o=0,a=1,s=1,l=0);var g=f-n+1/6,y=m-i+1/6,x=v-o+1/6,b=f-a+1/6*2,w=m-s+1/6*2,_=v-l+1/6*2,S=f-1+.5,T=m-1+.5,M=v-1+.5,A=255&u,E=255&h,C=255&d,P=this.perm[A+n+this.perm[E+i+this.perm[C+o]]]%12,O=this.perm[A+a+this.perm[E+s+this.perm[C+l]]]%12,N=this.perm[A+1+this.perm[E+1+this.perm[C+1]]]%12,L=.6-f*f-m*m-v*v,I=.6-g*g-y*y-x*x,R=.6-b*b-w*w-_*_,D=.6-S*S-T*T-M*M;return 32*((L<0?0:(L*=L)*L*this.dot3(this.grad3[this.perm[A+this.perm[E+this.perm[C]]]%12],f,m,v))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[P],g,y,x))+(R<0?0:(R*=R)*R*this.dot3(this.grad3[O],b,w,_))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[N],S,T,M)))},Mb.prototype.noise4d=function(t,e,r,n){var i,o,a,s,l,c,u,h,d,p,f,m,v=this.grad4,g=this.simplex,y=this.perm,x=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,w=(t+e+r+n)*x,_=Math.floor(t+w),S=Math.floor(e+w),T=Math.floor(r+w),M=Math.floor(n+w),A=(_+S+T+M)*b,E=t-(_-A),C=e-(S-A),P=r-(T-A),O=n-(M-A),N=(E>C?32:0)+(E>P?16:0)+(C>P?8:0)+(E>O?4:0)+(C>O?2:0)+(P>O?1:0),L=E-(i=g[N][0]>=3?1:0)+b,I=C-(o=g[N][1]>=3?1:0)+b,R=P-(a=g[N][2]>=3?1:0)+b,D=O-(s=g[N][3]>=3?1:0)+b,F=E-(l=g[N][0]>=2?1:0)+2*b,U=C-(c=g[N][1]>=2?1:0)+2*b,k=P-(u=g[N][2]>=2?1:0)+2*b,B=O-(h=g[N][3]>=2?1:0)+2*b,j=E-(d=g[N][0]>=1?1:0)+3*b,z=C-(p=g[N][1]>=1?1:0)+3*b,V=P-(f=g[N][2]>=1?1:0)+3*b,G=O-(m=g[N][3]>=1?1:0)+3*b,H=E-1+4*b,W=C-1+4*b,X=P-1+4*b,Y=O-1+4*b,q=255&_,J=255&S,Z=255&T,Q=255&M,K=y[q+i+y[J+o+y[Z+a+y[Q+s]]]]%32,$=y[q+l+y[J+c+y[Z+u+y[Q+h]]]]%32,tt=y[q+d+y[J+p+y[Z+f+y[Q+m]]]]%32,et=y[q+1+y[J+1+y[Z+1+y[Q+1]]]]%32,rt=.6-E*E-C*C-P*P-O*O,nt=.6-L*L-I*I-R*R-D*D,it=.6-F*F-U*U-k*k-B*B,ot=.6-j*j-z*z-V*V-G*G,at=.6-H*H-W*W-X*X-Y*Y;return 27*((rt<0?0:(rt*=rt)*rt*this.dot4(v[y[q+y[J+y[Z+y[Q]]]]%32],E,C,P,O))+(nt<0?0:(nt*=nt)*nt*this.dot4(v[K],L,I,R,D))+(it<0?0:(it*=it)*it*this.dot4(v[$],F,U,k,B))+(ot<0?0:(ot*=ot)*ot*this.dot4(v[tt],j,z,V,G))+(at<0?0:(at*=at)*at*this.dot4(v[et],H,W,X,Y)))};var Ab=function(t,e,r){this._scene=t,this._trackInfo=e,this._onUpdate=r,this._mixer=new Zm(t),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]};Ab.prototype={constructor:Ab,init:function(t){for(var e=[],r=this._trackInfo,n=0,i=r.length;n!==i;++n){var o=r[n];e.push(this._addTrack(o.type,o.propertyPath,o.initialValue,o.interpolation))}this._clip=new hd("editclip",0,e),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(t){this._action.time=t,this._mixer.update(0),this._onUpdate()},setDuration:function(t){this._clip.duration=t},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(t){return this._tracks[t].times},setKeyframe:function(t,e){var r=this._tracks[t],n=r.times,i=Timeliner.binarySearch(n,e),o=r.values,a=r.getValueSize(),s=i*a;if(i<0){s=(i=~i)*a;for(var l=o.length+a,c=n.length+1-1;c!==i;--c)n[c]=n[c-1];c=l-1;for(var u=s+a-1;c!==u;--c)o[c]=o[c-a]}n[i]=e,this._propRefs[t].getValue(o,s)},delKeyframe:function(t,e){var r=this._tracks[t],n=r.times,i=Timeliner.binarySearch(n,e);if(n.length>1&&i>=0){for(var o=n.length-1,a=r.values,s=r.getValueSize(),l=a.length-s,c=i;c!==o;++c)n[c]=n[c+1];n.pop();for(var u=i*s;u!==l;++u)a[u]=a[u+s];a.length=l}},moveKeyframe:function(t,e,r,n){var i=this._tracks[t],o=i.times,a=Timeliner.binarySearch(o,e);if(a>=0){for(var s=n?o.length:a+1,l=o[a-1]<=e||!n&&e>=o[a+1];a!==s;)o[a++]+=r;l&&this._sort(i)}},serialize:function(){for(var t={duration:this._clip.duration,channels:{}},e=this._channelNames,r=this._tracks,n=t.channels,i=0,o=e.length;i!==o;++i){var a=e[i],s=r[a];n[a]={times:s.times,values:s.values}}return t},deserialize:function(t){var e=this._channelNames,r=this._tracks,n=t.channels;this.setDuration(t.duration);for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=r[a],l=n[a];this._setArray(s.times,l.times),this._setArray(s.values,l.values)}this.setDisplayTime(this._mixer.time)},_sort:function(t){var e=t.times,r=ld.getKeyframeOrder(e);this._setArray(e,ld.sortedArray(e,1,r));var n=t.values,i=t.getValueSize();this._setArray(n,ld.sortedArray(n,i,r))},_setArray:function(t,e){t.length=0,t.push.apply(t,e)},_addTrack:function(t,e,r,n){var i=new t(e,[0],r,n);return i.times=Array.prototype.slice.call(i.times),i.values=Array.prototype.slice.call(i.values),this._channelNames.push(e),this._tracks[e]=i,this._propRefs[e]=new tf(this._scene,e),i}};var Eb={quicksortIP:function(t,e,r){for(var n,i,o=[],a=-1,s=0,l=t.length/e-1,c=0,u=0,h=0,d=function(r,n){for(r*=e,n*=e,h=0;h<e;h++)c=t[r+h],t[r+h]=t[n+h],t[n+h]=c},p=new Float32Array(e),f=new Float32Array(e);;)if(l-s<=25){for(i=s+1;i<=l;i++){for(u=0;u<e;u++)p[u]=t[i*e+u];for(n=i-1;n>=s&&t[n*e+r]>p[r];){for(u=0;u<e;u++)t[(n+1)*e+u]=t[n*e+u];n--}for(u=0;u<e;u++)t[(n+1)*e+u]=p[u]}if(-1==a)break;l=o[a--],s=o[a--]}else{for(i=l,d(s+l>>1,n=s+1),t[s*e+r]>t[l*e+r]&&d(s,l),t[n*e+r]>t[l*e+r]&&d(n,l),t[s*e+r]>t[n*e+r]&&d(s,n),u=0;u<e;u++)f[u]=t[n*e+u];for(;;){do{n++}while(t[n*e+r]<f[r]);do{i--}while(t[i*e+r]>f[r]);if(i<n)break;d(n,i)}for(u=0;u<e;u++)t[(s+1)*e+u]=t[i*e+u],t[i*e+u]=f[u];l-n+1>=i-s?(o[++a]=n,o[++a]=l,l=i-1):(o[++a]=s,o[++a]=i-1,s=n)}return t},Kdtree:function(t,e,r){var n=this,i=0,o=function(t,e){return t.subarray(e*r,e*r+r)};this.root=function t(e,a,s,l){var c,u,h=a%r,d=e.length/r;return a>i&&(i=a),0===d?null:1===d?new n.Node(o(e,0),a,s,l):(Eb.quicksortIP(e,r,h),c=Math.floor(d/2),(u=new n.Node(o(e,c),a,s,c+l)).left=t(e.subarray(0,c*r),a+1,u,l),u.right=t(e.subarray((c+1)*r,e.length),a+1,u,l+c+1),u)}(t,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(t,i,o){var a,s,l;if(l=new Eb.Kdtree.BinaryHeap(function(t){return-t[1]}),o)for(a=0;a<i;a+=1)l.push([null,o]);for(function n(o){var a,s,c,u,h=o.depth%r,d=e(t,o.obj),p=[];function f(t,e){l.push([t,e]),l.size()>i&&l.pop()}for(u=0;u<r;u+=1)p[u]=u===o.depth%r?t[u]:o.obj[u];s=e(p,o.obj),null!==o.right||null!==o.left?(n(a=null===o.right?o.left:null===o.left?o.right:t[h]<o.obj[h]?o.left:o.right),(l.size()<i||d<l.peek()[1])&&f(o,d),(l.size()<i||Math.abs(s)<l.peek()[1])&&null!==(c=a===o.left?o.right:o.left)&&n(c)):(l.size()<i||d<l.peek()[1])&&f(o,d)}(n.root),s=[],a=0;a<i;a+=1)l.content[a][0]&&s.push([l.content[a][0],l.content[a][1]]);return s}}};Eb.Kdtree.prototype.Node=function(t,e,r,n){this.obj=t,this.left=null,this.right=null,this.parent=r,this.depth=e,this.pos=n},Eb.Kdtree.BinaryHeap=function(t){this.content=[],this.scoreFunction=t},Eb.Kdtree.BinaryHeap.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,r=0;r<e;r++)if(this.content[r]==t){var n=this.content.pop();return void(r!=e-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var r=Math.floor((t+1)/2)-1,n=this.content[r];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[r]=e,this.content[t]=n,t=r}},sinkDown:function(t){for(var e=this.content.length,r=this.content[t],n=this.scoreFunction(r);;){var i=2*(t+1),o=i-1,a=null;if(o<e){var s=this.scoreFunction(this.content[o]);s<n&&(a=o)}if(i<e&&this.scoreFunction(this.content[i])<(null===a?n:s)&&(a=i),null===a)break;this.content[t]=this.content[a],this.content[a]=r,t=a}}};var Cb={merge:function(t,e,r){var n;console.warn("GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e instanceof zh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,r)},randomPointInTriangle:function(){var t=new yu;return function(e,r,n){var i=new yu,o=Math.random(),a=Math.random();o+a>1&&(o=1-o,a=1-a);var s=1-o-a;return i.copy(e),i.multiplyScalar(o),t.copy(r),t.multiplyScalar(a),i.add(t),t.copy(n),t.multiplyScalar(s),i.add(t),i}}(),randomPointInFace:function(t,e){return Cb.randomPointInTriangle(e.vertices[t.a],e.vertices[t.b],e.vertices[t.c])},randomPointsInGeometry:function(t,e){var r,n,i=t.faces,o=t.vertices,a=i.length,s=0,l=[];for(n=0;n<a;n++)(r=i[n])._area=Cb.triangleArea(o[r.a],o[r.b],o[r.c]),l[n]=s+=r._area;function c(t){return function e(r,n){if(n<r)return r;var i=r+Math.floor((n-r)/2);return l[i]>t?e(r,i-1):l[i]<t?e(i+1,n):i}(0,l.length-1)}var u,h=[];for(n=0;n<e;n++)u=c(Math.random()*s),h[n]=Cb.randomPointInFace(i[u],t);return h},randomPointsInBufferGeometry:function(t,e){var r,n,i,o,a=t.attributes.position.array,s=0,l=[];n=new yu,i=new yu,o=new yu;var c=a.length/9;for(r=0;r<c;r++)n.set(a[9*r+0],a[9*r+1],a[9*r+2]),i.set(a[9*r+3],a[9*r+4],a[9*r+5]),o.set(a[9*r+6],a[9*r+7],a[9*r+8]),s+=Cb.triangleArea(n,i,o),l.push(s);function u(t){return function e(r,n){if(n<r)return r;var i=r+Math.floor((n-r)/2);return l[i]>t?e(r,i-1):l[i]<t?e(i+1,n):i}(0,l.length-1)}var h,d=[];for(r=0;r<e;r++)h=u(Math.random()*s),n.set(a[9*h+0],a[9*h+1],a[9*h+2]),i.set(a[9*h+3],a[9*h+4],a[9*h+5]),o.set(a[9*h+6],a[9*h+7],a[9*h+8]),d[r]=Cb.randomPointInTriangle(n,i,o);return d},triangleArea:function(){var t=new yu,e=new yu;return function(r,n,i){return t.subVectors(n,r),e.subVectors(i,r),t.cross(e),.5*t.length()}}(),center:function(t){return console.warn("GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},Pb=function(t){var e,r=this,n=void 0!==t.name&&""!==t.name,i=new gd(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);i.position.set(0,0,2);var o,a,s=new vd,l=dx,c=new wd.clone(l.uniforms),u=new _d({uniforms:c,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}),h=new zh(new Td(256,256),u);if(s.add(h),n){var d=(o=document.createElement("canvas")).getContext("2d");d.font="Bold 20px Arial";var p=d.measureText(t.name).width;o.width=p,o.height=25,d.font="Bold 20px Arial",d.fillStyle="rgba( 255, 0, 0, 1 )",d.fillText(t.name,0,20);var f=new xd(o);f.magFilter=mh,f.minFilter=mh,f.needsUpdate=!0;var m=new Dh({map:f,side:Ku});m.transparent=!0;var v=new Td(o.width,o.height);a=new zh(v,m),s.add(a)}this.enabled=!0,this.size={width:256,height:256,set:function(t,e){this.width=t,this.height=e,h.scale.set(this.width/256,this.height/256,1),r.position.set(r.position.x,r.position.y)}},this.position={x:10,y:10,set:function(t,e){this.x=t,this.y=e,h.position.set(-window.innerWidth/2+r.size.width/2+this.x,window.innerHeight/2-r.size.height/2-this.y,0),n&&a.position.set(h.position.x,h.position.y-r.size.height/2+o.height/2,0)}},this.render=function(r){this.enabled&&(c.tDiffuse.value=t.shadow.map.texture,e=r.autoClear,r.autoClear=!1,r.clearDepth(),r.render(s,i),r.autoClear=e)},this.updateForWindowResize=function(){this.enabled&&(i.left=window.innerWidth/-2,i.right=window.innerWidth/2,i.top=window.innerHeight/2,i.bottom=window.innerHeight/-2,i.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()};Pb.prototype.constructor=Pb;var Ob=function(t,e,r){var n=this;this.volume=t,e=e||0,Object.defineProperty(this,"index",{get:function(){return e},set:function(t){return e=t,n.geometryNeedsUpdate=!0,e}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new xd(this.canvas);i.minFilter=mh,i.wrapS=i.wrapT=dh;var o=new Dh({map:i,side:Ku,transparent:!0});this.mesh=new zh(this.geometry,o),this.geometryNeedsUpdate=!0,this.repaint()};Ob.prototype={constructor:Ob,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var t=this.iLength,e=this.jLength,r=this.sliceAccess,n=this.volume,i=this.canvasBuffer,o=this.ctxBuffer,a=o.getImageData(0,0,t,e),s=a.data,l=n.data,c=n.upperThreshold,u=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,p=0;if("label"===n.dataType)for(var f=0;f<e;f++)for(var m=0;m<t;m++){var v=l[r(m,f)],g=this.colorMap[v=v>=this.colorMap.length?v%this.colorMap.length+1:v];s[4*p]=g>>24&255,s[4*p+1]=g>>16&255,s[4*p+2]=g>>8&255,s[4*p+3]=255&g,p++}else for(f=0;f<e;f++)for(m=0;m<t;m++){var y=l[r(m,f)],x=255;x=c>=y&&u<=y?x:0,y=Math.floor(255*(y-h)/(d-h)),s[4*p]=y=y>255?255:y<0?0:0|y,s[4*p+1]=y,s[4*p+2]=y,s[4*p+3]=x,p++}o.putImageData(a,0,0),this.ctx.drawImage(i,0,0,t,e,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var t=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=t.sliceAccess,this.jLength=t.jLength,this.iLength=t.iLength,this.matrix=t.matrix,this.canvas.width=t.planeWidth,this.canvas.height=t.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry=new Sd(t.planeWidth,t.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix=(new gu).identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}};var Nb=function(){Mu.call(this);var t,e=this,r=[0,0],n=!1,i=new yu;this.matrixAutoUpdate=!1,this.getGamepad=function(){return t},this.getTouchpadState=function(){return n},this.update=function(){if(void 0!==(t=function(){for(var t=navigator.getGamepads&&navigator.getGamepads(),e=0;e<4;e++){var r=t[e];if(r&&"Daydream Controller"===r.id)return r}}())&&void 0!==t.pose){var o=t.pose;if(null===o)return;null!==o.orientation&&e.quaternion.fromArray(o.orientation),e.updateMatrix(),e.visible=!0,null===o.angularVelocity||i.equals(o.angularVelocity)||(i.fromArray(o.angularVelocity),e.dispatchEvent({type:"angularvelocitychanged",angularVelocity:i})),r[0]===t.axes[0]&&r[1]===t.axes[1]||(r[0]=t.axes[0],r[1]=t.axes[1],e.dispatchEvent({type:"axischanged",axes:r})),n!==t.buttons[0].pressed&&e.dispatchEvent({type:(n=t.buttons[0].pressed)?"touchpaddown":"touchpadup"})}else e.visible=!1},this.getTouchPadState=function(){return console.warn("DaydreamController: getTouchPadState() is now getTouchpadState()"),n}};(Nb.prototype=Object.create(Mu.prototype)).constructor=Nb;var Lb=function(){Mu.call(this);var t,e=this,r=[0,0],n=!1,i=!1,o=new yu;this.matrixAutoUpdate=!0,this.getGamepad=function(){return t},this.getTouchpadState=function(){return n},this.update=function(){if(void 0!==(t=function(){for(var t=navigator.getGamepads&&navigator.getGamepads(),e=0;e<4;e++){var r=t[e];if(r&&"Gear VR Controller"===r.id)return r}}())&&void 0!==t.pose){var a=t.pose;if(null===a)return;null!==a.orientation&&e.quaternion.fromArray(a.orientation),e.updateMatrix(),e.visible=!0,null===a.angularVelocity||o.equals(a.angularVelocity)||(o.fromArray(a.angularVelocity),e.dispatchEvent({type:"angularvelocitychanged",angularVelocity:o})),r[0]===t.axes[0]&&r[1]===t.axes[1]||(r[0]=t.axes[0],r[1]=t.axes[1],e.dispatchEvent({type:"axischanged",axes:r})),n!==t.buttons[0].pressed&&e.dispatchEvent({type:(n=t.buttons[0].pressed)?"touchpaddown":"touchpadup",axes:r}),i!==t.buttons[1].pressed&&e.dispatchEvent({type:(i=t.buttons[1].pressed)?"triggerdown":"triggerup"})}else e.visible=!1},this.getTouchPadState=function(){return console.warn("GearVRController: getTouchPadState() is now getTouchpadState()"),n},this.setHand=function(){console.warn("GearVRController: setHand() has been removed.")}};(Lb.prototype=Object.create(Mu.prototype)).constructor=Lb;var Ib=function(t){Mu.call(this);var e,r=this,n=[0,0],i=!1,o=!1,a=!1,s=!1;this.matrixAutoUpdate=!1,this.standingMatrix=new gu,this.getGamepad=function(){return e},this.getButtonState=function(t){return"thumbpad"===t?i:"trigger"===t?o:"grips"===t?a:"menu"===t?s:void 0},this.update=function(){if(void 0!==(e=function(t){for(var e=navigator.getGamepads&&navigator.getGamepads(),r=0,n=0;r<e.length;r++){var i=e[r];if(i&&("OpenVR Gamepad"===i.id||i.id.startsWith("Oculus Touch")||i.id.startsWith("Spatial Controller"))){if(n===t)return i;n++}}}(t))&&void 0!==e.pose){if(null===e.pose)return;var l=e.pose;null!==l.position&&r.position.fromArray(l.position),null!==l.orientation&&r.quaternion.fromArray(l.orientation),r.matrix.compose(r.position,r.quaternion,r.scale),r.matrix.premultiply(r.standingMatrix),r.matrixWorldNeedsUpdate=!0,r.visible=!0,n[0]===e.axes[0]&&n[1]===e.axes[1]||(n[0]=e.axes[0],n[1]=e.axes[1],r.dispatchEvent({type:"axischanged",axes:n})),i!==e.buttons[0].pressed&&r.dispatchEvent({type:(i=e.buttons[0].pressed)?"thumbpaddown":"thumbpadup",axes:n}),o!==e.buttons[1].pressed&&r.dispatchEvent({type:(o=e.buttons[1].pressed)?"triggerdown":"triggerup"}),a!==e.buttons[2].pressed&&r.dispatchEvent({type:(a=e.buttons[2].pressed)?"gripsdown":"gripsup"}),s!==e.buttons[3].pressed&&r.dispatchEvent({type:(s=e.buttons[3].pressed)?"menudown":"menuup"})}else r.visible=!1}};function Rb(t,e,r,n){Iu.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new Db(t,e,r,n)),this.mergeVertices()}function Db(t,e,r,n){Yu.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,a=[],s=[],l=[],c=[],u=new yu,h=new Nu;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var d=r+o/e*n;u.x=t*Math.cos(d),u.y=t*Math.sin(d),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[i]/t+1)/2,h.y=(s[i+1]/t+1)/2,c.push(h.x,h.y)}for(i=1;i<=e;i++)a.push(i,i+1,0);this.setIndex(a),this.addAttribute("position",new Gu(s,3)),this.addAttribute("normal",new Gu(l,3)),this.addAttribute("uv",new Gu(c,2))}function Fb(t,e){Iu.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ub(t,e)),this.mergeVertices()}function Ub(t,e){var r=(1+Math.sqrt(5))/2;cp.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function kb(t,e,r,n,i,o,a,s){Np.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Bb(t,e,r,n,i,o){kb.call(this,t,e,r,r,n,i,o),this.type="ArcCurve"}function jb(){var t=0,e=0,r=0,n=0;function i(i,o,a,s){t=i,e=a,r=-3*i+3*o-2*a-s,n=2*i-2*o+a+s}return{initCatmullRom:function(t,e,r,n,o){i(e,r,o*(r-t),o*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,o,a,s){var l=(e-t)/o-(r-t)/(o+a)+(r-e)/a,c=(r-e)/a-(n-e)/(a+s)+(n-r)/s;i(e,r,l*=a,c*=a)},calc:function(i){var o=i*i;return t+e*i+r*o+n*(o*i)}}}(Ib.prototype=Object.create(Mu.prototype)).constructor=Ib,(Rb.prototype=Object.create(Iu.prototype)).constructor=Rb,(Db.prototype=Object.create(Yu.prototype)).constructor=Db,(Fb.prototype=Object.create(Iu.prototype)).constructor=Fb,(Ub.prototype=Object.create(cp.prototype)).constructor=Ub,(kb.prototype=Object.create(Np.prototype)).constructor=kb,kb.prototype.isEllipseCurve=!0,kb.prototype.getPoint=function(t,e){for(var r=e||new Nu,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(s,l)},kb.prototype.copy=function(t){return Np.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},kb.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},kb.prototype.fromJSON=function(t){return Np.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},(Bb.prototype=Object.create(kb.prototype)).constructor=Bb,Bb.prototype.isArcCurve=!0;var zb=new yu,Vb=new jb,Gb=new jb,Hb=new jb;function Wb(t,e,r,n){Np.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function Xb(t,e,r,n,i){var o=.5*(n-e),a=.5*(i-r),s=t*t;return(2*r-2*n+o+a)*(t*s)+(-3*r+3*n-2*o-a)*s+o*t+r}function Yb(t,e,r,n){return function(t,r){var n=1-t;return n*n*e}(t)+function(t,e){return 2*(1-t)*t*r}(t)+function(t,e){return t*t*n}(t)}function qb(t,e,r,n,i){return function(t,r){var n=1-t;return n*n*n*e}(t)+function(t,e){var n=1-t;return 3*n*n*t*r}(t)+function(t,e){return 3*(1-t)*t*t*n}(t)+function(t,e){return t*t*t*i}(t)}function Jb(t,e,r,n){Np.call(this),this.type="CubicBezierCurve",this.v0=t||new Nu,this.v1=e||new Nu,this.v2=r||new Nu,this.v3=n||new Nu}function Zb(t,e,r,n){Np.call(this),this.type="CubicBezierCurve3",this.v0=t||new yu,this.v1=e||new yu,this.v2=r||new yu,this.v3=n||new yu}function Qb(t,e){Np.call(this),this.type="LineCurve",this.v1=t||new Nu,this.v2=e||new Nu}function Kb(t,e){Np.call(this),this.type="LineCurve3",this.v1=t||new yu,this.v2=e||new yu}function $b(t,e,r){Np.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Nu,this.v1=e||new Nu,this.v2=r||new Nu}function tw(t,e,r){Np.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new yu,this.v1=e||new yu,this.v2=r||new yu}function ew(t){Np.call(this),this.type="SplineCurve",this.points=t||[]}(Wb.prototype=Object.create(Np.prototype)).constructor=Wb,Wb.prototype.isCatmullRomCurve3=!0,Wb.prototype.getPoint=function(t,e){var r,n,i,o,a=e||new yu,s=this.points,l=s.length,c=(l-(this.closed?0:1))*t,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/s.length)+1)*s.length:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=s[(u-1)%l]:(zb.subVectors(s[0],s[1]).add(s[0]),r=zb),n=s[u%l],i=s[(u+1)%l],this.closed||u+2<l?o=s[(u+2)%l]:(zb.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=zb),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Vb.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,p,f,m),Gb.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,p,f,m),Hb.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(Vb.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),Gb.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),Hb.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return a.set(Vb.calc(h),Gb.calc(h),Hb.calc(h)),a},Wb.prototype.copy=function(t){Np.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Wb.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Wb.prototype.fromJSON=function(t){Np.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new yu).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},(Jb.prototype=Object.create(Np.prototype)).constructor=Jb,Jb.prototype.isCubicBezierCurve=!0,Jb.prototype.getPoint=function(t,e){var r=e||new Nu,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(qb(t,n.x,i.x,o.x,a.x),qb(t,n.y,i.y,o.y,a.y)),r},Jb.prototype.copy=function(t){return Np.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Jb.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Jb.prototype.fromJSON=function(t){return Np.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(Zb.prototype=Object.create(Np.prototype)).constructor=Zb,Zb.prototype.isCubicBezierCurve3=!0,Zb.prototype.getPoint=function(t,e){var r=e||new yu,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(qb(t,n.x,i.x,o.x,a.x),qb(t,n.y,i.y,o.y,a.y),qb(t,n.z,i.z,o.z,a.z)),r},Zb.prototype.copy=function(t){return Np.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Zb.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Zb.prototype.fromJSON=function(t){return Np.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(Qb.prototype=Object.create(Np.prototype)).constructor=Qb,Qb.prototype.isLineCurve=!0,Qb.prototype.getPoint=function(t,e){var r=e||new Nu;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},Qb.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Qb.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Qb.prototype.copy=function(t){return Np.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Qb.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Qb.prototype.fromJSON=function(t){return Np.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(Kb.prototype=Object.create(Np.prototype)).constructor=Kb,Kb.prototype.isLineCurve3=!0,Kb.prototype.getPoint=function(t,e){var r=e||new yu;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},Kb.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Kb.prototype.copy=function(t){return Np.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Kb.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Kb.prototype.fromJSON=function(t){return Np.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},($b.prototype=Object.create(Np.prototype)).constructor=$b,$b.prototype.isQuadraticBezierCurve=!0,$b.prototype.getPoint=function(t,e){var r=e||new Nu,n=this.v0,i=this.v1,o=this.v2;return r.set(Yb(t,n.x,i.x,o.x),Yb(t,n.y,i.y,o.y)),r},$b.prototype.copy=function(t){return Np.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},$b.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},$b.prototype.fromJSON=function(t){return Np.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(tw.prototype=Object.create(Np.prototype)).constructor=tw,tw.prototype.isQuadraticBezierCurve3=!0,tw.prototype.getPoint=function(t,e){var r=e||new yu,n=this.v0,i=this.v1,o=this.v2;return r.set(Yb(t,n.x,i.x,o.x),Yb(t,n.y,i.y,o.y),Yb(t,n.z,i.z,o.z)),r},tw.prototype.copy=function(t){return Np.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},tw.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},tw.prototype.fromJSON=function(t){return Np.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(ew.prototype=Object.create(Np.prototype)).constructor=ew,ew.prototype.isSplineCurve=!0,ew.prototype.getPoint=function(t,e){var r=e||new Nu,n=this.points,i=(n.length-1)*t,o=Math.floor(i),a=i-o,s=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set(Xb(a,s.x,l.x,c.x,u.x),Xb(a,s.y,l.y,c.y,u.y)),r},ew.prototype.copy=function(t){Np.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this},ew.prototype.toJSON=function(){var t=Np.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t},ew.prototype.fromJSON=function(t){Np.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Nu).fromArray(n))}return this};var rw={ArcCurve:Bb,CatmullRomCurve3:Wb,CubicBezierCurve:Jb,CubicBezierCurve3:Zb,EllipseCurve:kb,LineCurve:Qb,LineCurve3:Kb,QuadraticBezierCurve:$b,QuadraticBezierCurve3:tw,SplineCurve:ew};function nw(){Np.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function iw(t){nw.call(this),this.type="Path",this.currentPoint=new Nu,t&&this.setFromPoints(t)}function ow(t){iw.call(this,t),this.uuid=vu.generateUUID(),this.type="Shape",this.holes=[]}function aw(t,e,r,n,i){var o,a;if(i===function(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,r,n)>0)for(o=e;o<r;o+=n)a=Tw(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=Tw(o,t[o],t[o+1],a);return a&&bw(a,a.next)&&(Mw(a),a=a.next),a}function sw(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!bw(n,n.next)&&0!==xw(n.prev,n,n.next))n=n.next;else{if(Mw(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function lw(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=mw(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,c=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(a>1)}(i)}(t,n,i,o);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?uw(t,n,i,o):cw(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),Mw(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?lw(t=hw(t,e,r),e,r,n,i,o,2):2===a&&dw(t,e,r,n,i,o):lw(sw(t),e,r,n,i,o,1);break}}}function cw(t){var e=t.prev,r=t,n=t.next;if(xw(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(gw(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&xw(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function uw(t,e,r,n){var i=t.prev,o=t,a=t.next;if(xw(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=mw(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),u=mw(s,l,e,r,n),h=t.nextZ;h&&h.z<=u;){if(h!==t.prev&&h!==t.next&&gw(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&xw(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(h=t.prevZ;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&gw(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&xw(h.prev,h,h.next)>=0)return!1;h=h.prevZ}return!0}function hw(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!bw(i,o)&&ww(i,n,n.next,o)&&_w(i,o)&&_w(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Mw(n),Mw(n.next),n=t=o),n=n.next}while(n!==t);return n}function dw(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&yw(a,s)){var l=Sw(a,s);return a=sw(a,a.next),l=sw(l,l.next),lw(a,e,r,n,i,o),void lw(l,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function pw(t,e){return t.x-e.x}function fw(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&gw(o<h?i:a,o,u,h,o<h?a:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&_w(n,t)&&(r=n,d=l),n=n.next;return r}(t,e)){var r=Sw(e,t);sw(r,r.next)}}function mw(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vw(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function gw(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function yw(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ww(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&_w(t,e)&&_w(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function xw(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function bw(t,e){return t.x===e.x&&t.y===e.y}function ww(t,e,r,n){return!!(bw(t,e)&&bw(r,n)||bw(t,n)&&bw(r,e))||xw(t,e,r)>0!=xw(t,e,n)>0&&xw(r,n,t)>0!=xw(r,n,e)>0}function _w(t,e){return xw(t.prev,t,t.next)<0?xw(t,e,t.next)>=0&&xw(t,t.prev,e)>=0:xw(t,e,t.prev)<0||xw(t,t.next,e)<0}function Sw(t,e){var r=new Aw(t.i,t.x,t.y),n=new Aw(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Tw(t,e,r,n){var i=new Aw(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Mw(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Aw(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}nw.prototype=Object.assign(Object.create(Np.prototype),{constructor:nw,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new rw.LineCurve(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,o=this.curves[n],a=o.getLength();return o.getPointAt(0===a?0:1-i/a)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],a=o.getPoints(o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t),s=0;s<a.length;s++){var l=a[s];e&&e.equals(l)||(r.push(l),e=l)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Np.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=Np.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){Np.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new rw[n.type]).fromJSON(n))}return this}}),iw.prototype=Object.assign(Object.create(nw.prototype),{constructor:iw,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var r=new Qb(this.currentPoint.clone(),new Nu(t,e));this.curves.push(r),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,r,n){var i=new $b(this.currentPoint.clone(),new Nu(t,e),new Nu(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(t,e,r,n,i,o){var a=new Jb(this.currentPoint.clone(),new Nu(t,e),new Nu(r,n),new Nu(i,o));this.curves.push(a),this.currentPoint.set(i,o)},splineThru:function(t){var e=new ew([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,r,n,i,o){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o)},absarc:function(t,e,r,n,i,o){this.absellipse(t,e,r,r,n,i,o)},ellipse:function(t,e,r,n,i,o,a,s){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o,a,s)},absellipse:function(t,e,r,n,i,o,a,s){var l=new kb(t,e,r,n,i,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(t){return nw.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=nw.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return nw.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),ow.prototype=Object.assign(Object.create(iw.prototype),{constructor:ow,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){iw.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=iw.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){iw.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new iw).fromJSON(n))}return this}});var Ew={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return Ew.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];Cw(t),Pw(r,t);var o=t.length;e.forEach(Cw);for(var a=0;a<e.length;a++)n.push(o),o+=e[a].length,Pw(r,e[a]);var s=function(t,e,r){r=r||2;var n,i,o,a,s,l,c,u=e&&e.length,h=u?e[0]*r:t.length,d=aw(t,0,h,r,!0),p=[];if(!d)return p;if(u&&(d=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=aw(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(vw(a));for(s.sort(pw),i=0;i<s.length;i++)fw(s[i],r),r=sw(r,r.next);return r}(t,e,d,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)l=t[f+1],(s=t[f])<n&&(n=s),l<i&&(i=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return lw(d,p,r,n,i,c),p}(r,n);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function Cw(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Pw(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function Ow(t,e){Iu.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Nw(t,e)),this.mergeVertices()}function Nw(t,e){Yu.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(t))c(t);else for(var l=0;l<t.length;l++)c(t[l]),this.addGroup(a,s,l),a+=s,s=0;function c(t){var a,l,c,u=n.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;if(!1===Ew.isClockWise(d))for(d=d.reverse(),a=0,l=p.length;a<l;a++)!0===Ew.isClockWise(c=p[a])&&(p[a]=c.reverse());var f=Ew.triangulateShape(d,p);for(a=0,l=p.length;a<l;a++)d=d.concat(c=p[a]);for(a=0,l=d.length;a<l;a++){var m=d[a];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var v=f[a];r.push(v[0]+u,v[1]+u,v[2]+u),s+=3}}this.setIndex(r),this.addAttribute("position",new Gu(n,3)),this.addAttribute("normal",new Gu(i,3)),this.addAttribute("uv",new Gu(o,2))}function Lw(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++)e.shapes.push(t[r].uuid);else e.shapes.push(t.uuid);return e}(Ow.prototype=Object.create(Iu.prototype)).constructor=Ow,Ow.prototype.toJSON=function(){var t=Iu.prototype.toJSON.call(this);return Lw(this.parameters.shapes,t)},(Nw.prototype=Object.create(Yu.prototype)).constructor=Nw,Nw.prototype.toJSON=function(){var t=Yu.prototype.toJSON.call(this);return Lw(this.parameters.shapes,t)};var Iw,Rw,Dw=function(t){Ib.call(this,t);var e=2*Math.PI,r=0,n=new Eu(1,1,1),i=1,o=new zh(a=new Rb(1,32),u=new Dh({map:function(){var t=document.createElement("canvas");t.width=256,t.height=256;for(var r=t.getContext("2d"),n=r.getImageData(0,0,256,256),i=n.data,o=new Eu,a=0,s=0;a<i.length;a+=4,s++){var l=s%256/256-.5,c=Math.floor(s/256)/256-.5;o.setHSL(Math.atan2(c,l)/e,1,2*(.5-Math.sqrt(l*l+c*c))),i[a+0]=256*o.r,i[a+1]=256*o.g,i[a+2]=256*o.b,i[a+3]=256}return r.putImageData(n,0,0),new bg(t)}()}));o.position.set(0,.005,.0495),o.rotation.x=-1.45,o.scale.setScalar(.02),this.add(o);var a=new Fb(.1,2);(u=new Dh).color=n;var s=new zh(a,u);o.add(s);var l=new Nf;l.position.set(0,.005,.0495),l.rotation.x=-1.45,l.scale.setScalar(.02),this.add(l);var c=new ow;c.moveTo(0,-1),c.lineTo(1,1),c.lineTo(-1,1);var u,h=new zh(a=new Ow(c),u=new Dh({color:2236962,wireframe:!0}));h.position.z=.001,p(h.geometry,1),l.add(h),a=new Ow(c),(u=new Dh({side:Ku})).color=n;var d=new zh(a,u);function p(t,e){var r=Math.atan(.25),n=1.5*e,i=Math.tan(r)*n*2;t.vertices[0].set(0,-.75,0),t.vertices[1].set(0+i/2,-.75+n,0),t.vertices[2].set(0-i/2,-.75+n,0),t.verticesNeedUpdate=!0}d.position.z=.0011,p(d.geometry,.5),l.add(d),l.visible=!1,this.getColor=function(){return n},this.getSize=function(){return i},this.addEventListener("axischanged",function(t){if(!1!==this.getButtonState("thumbpad")){var o=t.axes[0]/2,a=-t.axes[1]/2;if(0===r&&(n.setHSL(Math.atan2(a,o)/e,1,2*(.5-Math.sqrt(o*o+a*a))),s.position.set(t.axes[0],t.axes[1],0)),1===r){var l=.5-a;i=2*l,p(d.geometry,l)}}}),this.addEventListener("gripsdown",function(t){return 0===r?(r=1,o.visible=!1,void(l.visible=!0)):1===r?(r=0,o.visible=!0,void(l.visible=!1)):void 0})};function Fw(t){Wm.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Uw(t,e,r){Mu.call(this),this.type="CubeCamera";var n=new fd(90,1,t,e);n.up.set(0,-1,0),n.lookAt(new yu(1,0,0)),this.add(n);var i=new fd(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new yu(-1,0,0)),this.add(i);var o=new fd(90,1,t,e);o.up.set(0,0,1),o.lookAt(new yu(0,1,0)),this.add(o);var a=new fd(90,1,t,e);a.up.set(0,0,-1),a.lookAt(new yu(0,-1,0)),this.add(a);var s=new fd(90,1,t,e);s.up.set(0,-1,0),s.lookAt(new yu(0,0,1)),this.add(s);var l=new fd(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new yu(0,0,-1)),this.add(l),this.renderTarget=new zy(r,r,{format:bh,magFilter:mh,minFilter:mh}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,t.render(e,n,r),r.activeCubeFace=1,t.render(e,i,r),r.activeCubeFace=2,t.render(e,o,r),r.activeCubeFace=3,t.render(e,a,r),r.activeCubeFace=4,t.render(e,s,r),r.texture.generateMipmaps=c,r.activeCubeFace=5,t.render(e,l,r),t.setRenderTarget(null)},this.clear=function(t,e,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,t.setRenderTarget(i),t.clear(e,r,n);t.setRenderTarget(null)}}function kw(t,e,r){Du.call(this,t,e),this.meshPerAttribute=r||1}function Bw(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function jw(t){this.type="Font",this.data=t}function zw(t,e,r,n,i,o){var a=o.glyphs[t]||o.glyphs["?"];if(a){var s,l,c,u,h,d,p,f,m=new Bw;if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,y=v.length;g<y;)switch(v[g++]){case"m":s=v[g++]*r+n,l=v[g++]*r+i,m.moveTo(s,l);break;case"l":s=v[g++]*r+n,l=v[g++]*r+i,m.lineTo(s,l);break;case"q":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,m.quadraticCurveTo(h,d,c,u);break;case"b":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,p=v[g++]*r+n,f=v[g++]*r+i,m.bezierCurveTo(h,d,p,f,c,u)}return{offsetX:a.ha*r,path:m}}}function Vw(t,e,r,n,i,o,a){qh.call(this,0,t,e,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function Gw(t,e,r,n,i,o,a){Jh.call(this,0,t,e,r,n,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function Hw(t,e){Iu.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ww(t,e)),this.mergeVertices()}function Ww(t,e){var r=(1+Math.sqrt(5))/2,n=1/r;cp.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Xw(t,e){Yu.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,n,i,o,a=[],s=Math.cos(vu.DEG2RAD*e),l=[0,0],c={},u=["a","b","c"];t.isBufferGeometry?(o=new Iu).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];a.push(y.x,y.y,y.z),a.push((y=h[g.index2]).x,y.y,y.z)}}this.addAttribute("position",new Gu(a,3))}function Yw(t,e){Iu.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new qw(t,e)),this.mergeVertices()}function qw(t,e){void 0!==t&&(Yu.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function Jw(t,e,r,n){Iu.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new Zw(t,e,r,n)),this.mergeVertices()}function Zw(t,e,r,n){Yu.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=vu.clamp(n,0,2*Math.PI);var i,o,a,s=[],l=[],c=[],u=1/e,h=new yu,d=new Nu;for(o=0;o<=e;o++){var p=r+o*u*n,f=Math.sin(p),m=Math.cos(p);for(a=0;a<=t.length-1;a++)h.x=t[a].x*f,h.y=t[a].y,h.z=t[a].x*m,l.push(h.x,h.y,h.z),d.x=o/e,d.y=a/(t.length-1),c.push(d.x,d.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var v=(i=a+o*t.length)+t.length,g=i+t.length+1,y=i+1;s.push(i,v,y),s.push(v,g,y)}if(this.setIndex(s),this.addAttribute("position",new Gu(l,3)),this.addAttribute("uv",new Gu(c,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,b=new yu,w=new yu,_=new yu;for(i=e*t.length*3,o=0,a=0;o<t.length;o++,a+=3)b.x=x[a+0],b.y=x[a+1],b.z=x[a+2],w.x=x[i+a+0],w.y=x[i+a+1],w.z=x[i+a+2],_.addVectors(b,w).normalize(),x[a+0]=x[i+a+0]=_.x,x[a+1]=x[i+a+1]=_.y,x[a+2]=x[i+a+2]=_.z}}function Qw(t,e,r){Iu.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new Kw(t,e,r)),this.mergeVertices()}function Kw(t,e,r){Yu.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,o=[],a=[],s=[],l=[],c=new yu,u=new yu,h=new yu,d=new yu,p=new yu,f=e+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=e;i++){var v=i/e;t(v,m,u),a.push(u.x,u.y,u.z),v-1e-5>=0?(t(v-1e-5,m,h),d.subVectors(u,h)):(t(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(t(v,m-1e-5,h),p.subVectors(u,h)):(t(v,m+1e-5,h),p.subVectors(h,u)),c.crossVectors(d,p).normalize(),s.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var g=n*f+i+1,y=(n+1)*f+i+1,x=(n+1)*f+i;o.push(n*f+i,g,x),o.push(g,y,x)}this.setIndex(o),this.addAttribute("position",new Gu(a,3)),this.addAttribute("normal",new Gu(s,3)),this.addAttribute("uv",new Gu(l,2))}function $w(t,e,r,n,i,o){Iu.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new t_(t,e,r,n,i,o)),this.mergeVertices()}function t_(t,e,r,n,i,o){Yu.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,l,c=[],u=[],h=[],d=[],p=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new yu,v=new Nu;for(s=0;s<=n;s++){for(l=0;l<=r;l++)a=i+l/r*o,m.x=p*Math.cos(a),m.y=p*Math.sin(a),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/e+1)/2,v.y=(m.y/e+1)/2,d.push(v.x,v.y);p+=f}for(s=0;s<n;s++){var g=s*(r+1);for(l=0;l<r;l++){var y=(a=l+g)+r+1,x=a+r+2,b=a+1;c.push(a,y,b),c.push(y,x,b)}}this.setIndex(c),this.addAttribute("position",new Gu(u,3)),this.addAttribute("normal",new Gu(h,3)),this.addAttribute("uv",new Gu(d,2))}function e_(t,e){Iu.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new r_(t,e)),this.mergeVertices()}function r_(t,e){cp.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function n_(t,e){Iu.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new i_(t,e)),this.mergeVertices()}function i_(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("TextGeometry: font parameter is not an instance of Font."),new Iu;var n=r.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),qw.call(this,n,e),this.type="TextBufferGeometry"}function o_(t,e,r,n,i,o,a){Iu.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==a&&console.warn("TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new a_(t,e,r,n,i,o)),this.mergeVertices()}function a_(t,e,r,n,i,o){Yu.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var a,s,l=[],c=[],u=[],h=[],d=new yu,p=new yu,f=new yu,m=new yu,v=new yu,g=new yu,y=new yu;for(a=0;a<=r;++a){var x=a/r*i*Math.PI*2;for(A(x,i,o,t,f),A(x+.01,i,o,t,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,w=-e*Math.cos(b),_=e*Math.sin(b);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(a/r),h.push(s/n)}}for(s=1;s<=r;s++)for(a=1;a<=n;a++){var S=(n+1)*s+(a-1),T=(n+1)*s+a,M=(n+1)*(s-1)+a;l.push((n+1)*(s-1)+(a-1),S,M),l.push(S,T,M)}function A(t,e,r,n,i){var o=Math.cos(t),a=Math.sin(t),s=r/e*t,l=Math.cos(s);i.x=n*(2+l)*.5*o,i.y=n*(2+l)*a*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new Gu(c,3)),this.addAttribute("normal",new Gu(u,3)),this.addAttribute("uv",new Gu(h,2))}function s_(t,e,r,n,i,o){Iu.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("TubeGeometry: taper has been removed.");var a=new l_(t,e,r,n,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function l_(t,e,r,n,i){Yu.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},e=e||64,r=r||1,n=n||8;var o=t.computeFrenetFrames(e,i=i||!1);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new yu,c=new yu,u=new Nu,h=new yu,d=[],p=[],f=[],m=[];function v(i){h=t.getPointAt(i/e,h);var a=o.normals[i],u=o.binormals[i];for(s=0;s<=n;s++){var f=s/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*a.x+m*u.x,c.y=v*a.y+m*u.y,c.z=v*a.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(a=0;a<e;a++)v(a);v(!1===i?e:0),function(){for(a=0;a<=e;a++)for(s=0;s<=n;s++)u.x=a/e,u.y=s/n,f.push(u.x,u.y)}(),function(){for(s=1;s<=e;s++)for(a=1;a<=n;a++){var t=(n+1)*s+(a-1),r=(n+1)*s+a,i=(n+1)*(s-1)+a;m.push((n+1)*(s-1)+(a-1),t,i),m.push(t,r,i)}}()}(),this.setIndex(m),this.addAttribute("position",new Gu(d,3)),this.addAttribute("normal",new Gu(p,3)),this.addAttribute("uv",new Gu(f,2))}function c_(t,e,r,n,i,o){Mu.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===Iw&&((Iw=new Yu).addAttribute("position",new Gu([0,0,0,0,1,0],3)),(Rw=new Jh(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Vh(Iw,new Fh({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new zh(Rw,new Dh({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,o)}function u_(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new Yu;r.addAttribute("position",new Gu(e,3)),r.addAttribute("color",new Gu([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Fh({vertexColors:eh});Kf.call(this,r,n)}function h_(t,e){this.type="Box3Helper",this.box=t;var r=void 0!==e?e:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Yu;i.setIndex(new Du(n,1)),i.addAttribute("position",new Gu([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Kf.call(this,i,new Fh({color:r})),this.geometry.computeBoundingSphere()}function d_(t){var e=new Yu,r=new Fh({color:16777215,vertexColors:th}),n=[],i=[],o={},a=new Eu(16755200),s=new Eu(16711680),l=new Eu(43775),c=new Eu(16777215),u=new Eu(3355443);function h(t,e,r){d(t,r),d(e,r)}function d(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(n.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.addAttribute("position",new Gu(n,3)),e.addAttribute("color",new Gu(i,3)),Kf.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function p_(t,e,r){Mu.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var n=new Yu;n.addAttribute("position",new Gu([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new Fh({fog:!1});this.lightPlane=new Vh(n,i),this.add(this.lightPlane),(n=new Yu).addAttribute("position",new Gu([0,0,0,0,0,1],3)),this.targetLine=new Vh(n,i),this.add(this.targetLine),this.update()}function f_(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("FaceNormalsHelper: only Geometry is supported. Use VertexNormalsHelper, instead.");var l=new Yu,c=new Gu(2*a*3,3);l.addAttribute("position",c),Kf.call(this,l,new Fh({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function m_(t,e,r,n){t=t||10,e=e||10,r=new Eu(void 0!==r?r:4473924),n=new Eu(void 0!==n?n:8947848);for(var i=e/2,o=t/e,a=t/2,s=[],l=[],c=0,u=0,h=-a;c<=e;c++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var d=c===i?r:n;d.toArray(l,u),d.toArray(l,u+=3),d.toArray(l,u+=3),d.toArray(l,u+=3),u+=3}var p=new Yu;p.addAttribute("position",new Gu(s,3)),p.addAttribute("color",new Gu(l,3));var f=new Fh({vertexColors:eh});Kf.call(this,p,f)}function v_(t,e,r){Mu.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new hp(e);n.rotateY(.5*Math.PI),this.material=new Dh({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=eh);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new Du(o,3)),this.add(new zh(n,this.material)),this.update()}function g_(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==r?r:16776960,i=new Yu;i.addAttribute("position",new Gu([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Vh.call(this,i,new Fh({color:n}));var o=new Yu;o.addAttribute("position",new Gu([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new zh(o,new Dh({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function y_(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new Ju(e,4,2),i=new Dh({wireframe:!0,fog:!1});zh.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function x_(t,e,r,n,i,o){t=t||10,e=e||16,r=r||8,n=n||64,i=new Eu(void 0!==i?i:4473924),o=new Eu(void 0!==o?o:8947848);var a,s,l,c,u,h,d,p=[],f=[];for(c=0;c<=e;c++)l=c/e*(2*Math.PI),a=Math.sin(l)*t,s=Math.cos(l)*t,p.push(0,0,0),p.push(a,0,s),f.push((d=1&c?i:o).r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:o,h=t-t/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,p.push(a,0,s),f.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,p.push(a,0,s),f.push(d.r,d.g,d.b);var m=new Yu;m.addAttribute("position",new Gu(p,3)),m.addAttribute("color",new Gu(f,3));var v=new Fh({vertexColors:eh});Kf.call(this,m,v)}function b_(t,e){Mu.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var r=new Fh({fog:!1}),n=new Yu;n.addAttribute("position",new Du(new Float32Array(15),3)),this.line=new Vh(n,r),this.add(this.line),this.update()}function w_(t){for(var e=function t(e){var r=[];e&&e.isBone&&r.push(e);for(var n=0;n<e.children.length;n++)r.push.apply(r,t(e.children[n]));return r}(t),r=new Yu,n=[],i=[],o=new Eu(0,0,1),a=new Eu(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.addAttribute("position",new Gu(n,3)),r.addAttribute("color",new Gu(i,3));var c=new Fh({vertexColors:eh,depthTest:!1,depthWrite:!1,transparent:!0});Kf.call(this,r,c),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function __(t,e){Mu.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new Yu,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new Gu(n,3));var l=new Fh({fog:!1});this.cone=new Kf(r,l),this.add(this.cone),this.update()}function S_(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new Yu,c=new Gu(2*a*3,3);l.addAttribute("position",c),Kf.call(this,l,new Fh({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function T_(t,e,r,n){zf.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function M_(t){this.manager=void 0!==t?t:Pd}(Dw.prototype=Object.create(Ib.prototype)).constructor=Dw,Object.assign((function(){var t=arguments;this.uuid=vu.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var r=0,n=arguments.length;r!==n;++r)e[t[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}).prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=arguments,e=this._objects,r=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,o=this._paths,a=this._parsedPaths,s=this._bindings,l=s.length,c=void 0,u=0,h=arguments.length;u!==h;++u){var d=t[u],p=d.uuid,f=i[p];if(void 0===f){f=r++,i[p]=f,e.push(d);for(var m=0,v=l;m!==v;++m)s[m].push(new tf(d,o[m],a[m]))}else if(f<n){c=e[f];var g=--n,y=e[g];for(i[y.uuid]=f,e[f]=y,i[p]=g,e[g]=d,m=0,v=l;m!==v;++m){var x=s[m],b=x[f];x[f]=x[g],void 0===b&&(b=new tf(d,o[m],a[m])),x[g]=b}}else e[f]!==c&&console.error("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=arguments,e=this._objects,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var l=t[a],c=l.uuid,u=n[c];if(void 0!==u&&u>=r){var h=r++,d=e[h];n[d.uuid]=u,e[u]=d,n[c]=h,e[h]=l;for(var p=0,f=o;p!==f;++p){var m=i[p],v=m[u];m[u]=m[h],m[h]=v}}}this.nCachedObjects_=r},uncache:function(){for(var t=arguments,e=this._objects,r=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,o=this._bindings,a=o.length,s=0,l=arguments.length;s!==l;++s){var c=t[s].uuid,u=i[c];if(void 0!==u)if(delete i[c],u<n){var h=--n,d=e[h],p=e[g=--r];i[d.uuid]=u,e[u]=d,i[p.uuid]=h,e[h]=p,e.pop();for(var f=0,m=a;f!==m;++f){var v=(y=o[f])[g];y[u]=y[h],y[h]=v,y.pop()}}else{var g;for(i[(p=e[g=--r]).uuid]=u,e[u]=p,e.pop(),f=0,m=a;f!==m;++f){var y;(y=o[f])[u]=y[g],y.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,c=new Array(s.length);r[t]=n=i.length,o.push(t),a.push(e),i.push(c);for(var u=l,h=s.length;u!==h;++u)c[u]=new tf(s[u],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=r,o[r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}),Object.assign((function(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}).prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Fw.prototype=Object.assign(Object.create(Wm.prototype),{constructor:Fw,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new yu;return function(e){Mu.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),(Uw.prototype=Object.create(Mu.prototype)).constructor=Uw,kw.prototype=Object.assign(Object.create(Du.prototype),{constructor:kw,isInstancedBufferAttribute:!0,copy:function(t){return Du.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Bw.prototype,{moveTo:function(t,e){this.currentPath=new iw,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,r,n){this.currentPath.quadraticCurveTo(t,e,r,n)},bezierCurveTo:function(t,e,r,n,i,o){this.currentPath.bezierCurveTo(t,e,r,n,i,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],o=new ow;o.curves=i.curves,e.push(o)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=e[i],s=e[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=e[o],l=-l,s=e[i],c=-c),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var u=c*(t.x-a.x)-l*(t.y-a.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return n}var i=Ew.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return r(o);var a,s,l,c=[];if(1===o.length)return s=o[0],(l=new ow).curves=s.curves,c.push(l),c;var u=!i(o[0].getPoints());u=t?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(h=(s=o[g]).getPoints()),(a=t?!a:a)?(!u&&f[v]&&v++,f[v]={s:new ow,p:h},f[v].s.curves=s.curves,u&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var x=!1,b=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)n(M.p,f[E].p)&&(w!==E&&b.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):x=!0);A&&p[w].push(M)}b.length>0&&(x||(m=p))}g=0;for(var C=f.length;g<C;g++){c.push(l=f[g].s);for(var P=0,O=(d=m[g]).length;P<O;P++)l.holes.push(d[P].h)}return c}}),Object.assign(jw.prototype,{isFont:!0,generateShapes:function(t,e,r){void 0===e&&(e=100),void 0===r&&(r=4);for(var n=[],i=function(t,e,r,n){for(var i=String(t).split(""),o=e/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,s=[],l=0,c=0,u=0;u<i.length;u++){var h=i[u];if("\n"===h)l=0,c-=a;else{var d=zw(h,0,o,l,c,n);l+=d.offsetX,s.push(d.path)}}return s}(t,e,0,this.data),o=0,a=i.length;o<a;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}),(Vw.prototype=Object.create(qh.prototype)).constructor=Vw,(Gw.prototype=Object.create(Jh.prototype)).constructor=Gw,(Hw.prototype=Object.create(Iu.prototype)).constructor=Hw,(Ww.prototype=Object.create(cp.prototype)).constructor=Ww,(Xw.prototype=Object.create(Yu.prototype)).constructor=Xw,(Yw.prototype=Object.create(Iu.prototype)).constructor=Yw,(qw.prototype=Object.create(Yu.prototype)).constructor=qw,qw.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],r=this.getAttribute("uv"),n=r?Array.prototype.slice.call(r.array):[],i=this.index;return{position:e,uv:n,index:i?Array.prototype.slice.call(i.array):[]}},qw.prototype.addShapeList=function(t,e){var r=t.length;e.arrays=this.getArrays();for(var n=0;n<r;n++)this.addShape(t[n],e);this.setIndex(e.arrays.index),this.addAttribute("position",new Gu(e.arrays.position,3)),this.addAttribute("uv",new Gu(e.arrays.uv,2))},qw.prototype.addShape=function(t,e){var r,n,i,o,a,s,l,c,u=e.arrays?e.arrays:this.getArrays(),h=u.position,d=u.index,p=u.uv,f=[],m=void 0!==e.amount?e.amount:100,v=void 0!==e.bevelThickness?e.bevelThickness:6,g=void 0!==e.bevelSize?e.bevelSize:v-2,y=void 0!==e.bevelSegments?e.bevelSegments:3,x=void 0===e.bevelEnabled||e.bevelEnabled,b=void 0!==e.curveSegments?e.curveSegments:12,w=void 0!==e.steps?e.steps:1,_=e.extrudePath,S=!1,T=void 0!==e.UVGenerator?e.UVGenerator:Yw.WorldUVGenerator;_&&(r=_.getSpacedPoints(w),S=!0,x=!1,n=void 0!==e.frames?e.frames:_.computeFrenetFrames(w,!1),i=new yu,o=new yu,a=new yu),x||(y=0,v=0,g=0);var M=this,A=t.extractPoints(b),E=A.shape,C=A.holes;if(!Ew.isClockWise(E))for(E=E.reverse(),l=0,c=C.length;l<c;l++)Ew.isClockWise(s=C[l])&&(C[l]=s.reverse());var P=Ew.triangulateShape(E,C),O=E;for(l=0,c=C.length;l<c;l++)E=E.concat(s=C[l]);function N(t,e,r){return e||console.error("ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var L,I,R,D,F,U,k=E.length,B=P.length;function j(t,e,r){var n,i,o,a=t.x-e.x,s=t.y-e.y,l=r.x-t.x,c=r.y-t.y,u=a*a+s*s;if(Math.abs(a*c-s*l)>Number.EPSILON){var h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-s/h,f=e.y+a/h,m=((r.x-c/d-p)*c-(r.y+l/d-f)*l)/(a*c-s*l),v=(n=p+a*m-t.x)*n+(i=f+s*m-t.y)*i;if(v<=2)return new Nu(n,i);o=Math.sqrt(v/2)}else{var g=!1;a>Number.EPSILON?l>Number.EPSILON&&(g=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(c)&&(g=!0),g?(n=-s,i=a,o=Math.sqrt(u)):(n=a,i=s,o=Math.sqrt(u/2))}return new Nu(n/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=j(O[V],O[H],O[W]);var X,Y,q=[],J=z.concat();for(l=0,c=C.length;l<c;l++){for(X=[],H=(G=(s=C[l]).length)-1,W=1+(V=0);V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=j(s[V],s[H],s[W]);q.push(X),J=J.concat(X)}for(L=0;L<y;L++){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,-D);for(l=0,c=C.length;l<c;l++)for(X=q[l],V=0,G=(s=C[l]).length;V<G;V++)Q((F=N(s[V],X[V],I)).x,F.y,-D)}for(I=g,V=0;V<k;V++)F=x?N(E[V],J[V],I):E[V],S?(o.copy(n.normals[0]).multiplyScalar(F.x),i.copy(n.binormals[0]).multiplyScalar(F.y),a.copy(r[0]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,0);for(Y=1;Y<=w;Y++)for(V=0;V<k;V++)F=x?N(E[V],J[V],I):E[V],S?(o.copy(n.normals[Y]).multiplyScalar(F.x),i.copy(n.binormals[Y]).multiplyScalar(F.y),a.copy(r[Y]).add(o).add(i),Q(a.x,a.y,a.z)):Q(F.x,F.y,m/w*Y);for(L=y-1;L>=0;L--){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,m+D);for(l=0,c=C.length;l<c;l++)for(X=q[l],V=0,G=(s=C[l]).length;V<G;V++)F=N(s[V],X[V],I),S?Q(F.x,F.y+r[w-1].y,r[w-1].x+D):Q(F.x,F.y,m+D)}function Z(t,e){var r,n;for(V=t.length;--V>=0;){r=V,(n=V-1)<0&&(n=t.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var a=k*i,s=k*(i+1);$(e+r+a,e+n+a,e+n+s,e+r+s)}}}function Q(t,e,r){f.push(t),f.push(e),f.push(r)}function K(t,e,r){tt(t),tt(e),tt(r);var n=h.length/3,i=T.generateTopUV(M,h,n-3,n-2,n-1);et(i[0]),et(i[1]),et(i[2])}function $(t,e,r,n){tt(t),tt(e),tt(n),tt(e),tt(r),tt(n);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);et(o[0]),et(o[1]),et(o[3]),et(o[1]),et(o[2]),et(o[3])}function tt(t){d.push(h.length/3),h.push(f[3*t+0]),h.push(f[3*t+1]),h.push(f[3*t+2])}function et(t){p.push(t.x),p.push(t.y)}!function(){var t=h.length/3;if(x){var e=0,r=k*e;for(V=0;V<B;V++)K((U=P[V])[2]+r,U[1]+r,U[0]+r);for(r=k*(e=w+2*y),V=0;V<B;V++)K((U=P[V])[0]+r,U[1]+r,U[2]+r)}else{for(V=0;V<B;V++)K((U=P[V])[2],U[1],U[0]);for(V=0;V<B;V++)K((U=P[V])[0]+k*w,U[1]+k*w,U[2]+k*w)}M.addGroup(t,h.length/3-t,0)}(),function(){var t=h.length/3,e=0;for(Z(O,e),e+=O.length,l=0,c=C.length;l<c;l++)Z(s=C[l],e),e+=s.length;M.addGroup(t,h.length/3-t,1)}(),e.arrays||(this.setIndex(d),this.addAttribute("position",new Gu(h,3)),this.addAttribute("uv",new Gu(p,2)))},Yw.WorldUVGenerator={generateTopUV:function(t,e,r,n,i){var o=e[3*n],a=e[3*n+1],s=e[3*i],l=e[3*i+1];return[new Nu(e[3*r],e[3*r+1]),new Nu(o,a),new Nu(s,l)]},generateSideWallUV:function(t,e,r,n,i,o){var a=e[3*r],s=e[3*r+1],l=e[3*r+2],c=e[3*n],u=e[3*n+1],h=e[3*n+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],v=e[3*o+1],g=e[3*o+2];return Math.abs(s-u)<.01?[new Nu(a,1-l),new Nu(c,1-h),new Nu(d,1-f),new Nu(m,1-g)]:[new Nu(s,1-l),new Nu(u,1-h),new Nu(p,1-f),new Nu(v,1-g)]}},(Jw.prototype=Object.create(Iu.prototype)).constructor=Jw,(Zw.prototype=Object.create(Yu.prototype)).constructor=Zw,(Qw.prototype=Object.create(Iu.prototype)).constructor=Qw,(Kw.prototype=Object.create(Yu.prototype)).constructor=Kw,($w.prototype=Object.create(Iu.prototype)).constructor=$w,(t_.prototype=Object.create(Yu.prototype)).constructor=t_,(e_.prototype=Object.create(Iu.prototype)).constructor=e_,(r_.prototype=Object.create(cp.prototype)).constructor=r_,(n_.prototype=Object.create(Iu.prototype)).constructor=n_,(i_.prototype=Object.create(qw.prototype)).constructor=i_,(o_.prototype=Object.create(Iu.prototype)).constructor=o_,(a_.prototype=Object.create(Yu.prototype)).constructor=a_,(s_.prototype=Object.create(Iu.prototype)).constructor=s_,(l_.prototype=Object.create(Yu.prototype)).constructor=l_,(c_.prototype=Object.create(Mu.prototype)).constructor=c_,c_.prototype.setDirection=function(){var t,e=new yu;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Math.acos(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),c_.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},c_.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(u_.prototype=Object.create(Kf.prototype)).constructor=u_,(h_.prototype=Object.create(Kf.prototype)).constructor=h_,h_.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),Mu.prototype.updateMatrixWorld.call(this,t))},(d_.prototype=Object.create(Kf.prototype)).constructor=d_,d_.prototype.update=function(){var t,e,r=new yu,n=new pd;function i(i,o,a,s){r.set(o,a,s).unproject(n);var l=e[i];if(void 0!==l)for(var c=t.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],r.x,r.y,r.z)}return function(){t=this.geometry,e=this.pointMap,n.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(p_.prototype=Object.create(Mu.prototype)).constructor=p_,p_.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},p_.prototype.update=function(){var t=new yu,e=new yu,r=new yu;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(e,t),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),(f_.prototype=Object.create(Kf.prototype)).constructor=f_,f_.prototype.update=function(){var t=new yu,e=new yu,r=new Su;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,l=0,c=0,u=s.length;c<u;c++){var h=s[c],d=h.normal;t.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(n),e.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),i.setXYZ(l,t.x,t.y,t.z),i.setXYZ(l+=1,e.x,e.y,e.z),l+=1}i.needsUpdate=!0}}(),(m_.prototype=Object.create(Kf.prototype)).constructor=m_,(v_.prototype=Object.create(Mu.prototype)).constructor=v_,v_.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},v_.prototype.update=function(){var t=new yu,e=new Eu,r=new Eu;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");e.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,a=i.count;o<a;o++){var s=o<a/2?e:r;i.setXYZ(o,s.r,s.g,s.b)}i.needsUpdate=!0}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(g_.prototype=Object.create(Vh.prototype)).constructor=g_,g_.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),Mu.prototype.updateMatrixWorld.call(this,t)},(y_.prototype=Object.create(zh.prototype)).constructor=y_,y_.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},y_.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(x_.prototype=Object.create(Kf.prototype)).constructor=x_,(b_.prototype=Object.create(Mu.prototype)).constructor=b_,b_.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},b_.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=t,n[1]=-e,n[2]=0,n[3]=t,n[4]=e,n[5]=0,n[6]=-t,n[7]=e,n[8]=0,n[9]=-t,n[10]=-e,n[11]=0,n[12]=t,n[13]=-e,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(w_.prototype=Object.create(Kf.prototype)).constructor=w_,w_.prototype.updateMatrixWorld=function(){var t=new yu,e=new gu,r=new gu;return function(n){var i=this.bones,o=this.geometry,a=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<i.length;s++){var c=i[s];c.parent&&c.parent.isBone&&(e.multiplyMatrices(r,c.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(l,t.x,t.y,t.z),e.multiplyMatrices(r,c.parent.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(l+1,t.x,t.y,t.z),l+=2)}o.getAttribute("position").needsUpdate=!0,Mu.prototype.updateMatrixWorld.call(this,n)}}(),(__.prototype=Object.create(Mu.prototype)).constructor=__,__.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},__.prototype.update=function(){var t=new yu,e=new yu;return function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(S_.prototype=Object.create(Kf.prototype)).constructor=S_,S_.prototype.update=function(){var t=new yu,e=new yu,r=new Su;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=d.vertexNormals[p];t.copy(s[d[n[p]]]).applyMatrix4(i),e.copy(m).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}else if(a&&a.isBufferGeometry){var v=a.attributes.position,g=a.attributes.normal;for(c=0,p=0,f=v.count;p<f;p++)t.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),e.set(g.getX(p),g.getY(p),g.getZ(p)),e.applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}o.needsUpdate=!0}}(),T_.prototype=Object.assign(Object.create(zf.prototype),{constructor:T_,isRectAreaLight:!0,copy:function(t){return zf.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=zf.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign((function(t){this.manager=void 0!==t?t:Pd}).prototype,{load:function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t,e){for(var r=[],n=0;n<t.length;n++){var i=hd.parse(t[n]);r.push(i)}e(r)}}),Object.assign(M_.prototype,{load:function(t,e,r,n){var i=this;new Nd(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){var e=new Yu,r=t.data.index;if(void 0!==r){var n=new A_[r.type](r.array);e.setIndex(new Du(n,1))}var i=t.data.attributes;for(var o in i){var a=i[o];n=new A_[a.type](a.array),e.addAttribute(o,new Du(n,a.itemSize,a.normalized))}var s=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==s)for(var l=0,c=s.length;l!==c;++l){var u=s[l];e.addGroup(u.start,u.count,u.materialIndex)}var h=t.data.boundingSphere;if(void 0!==h){var d=new yu;void 0!==h.center&&d.fromArray(h.center),e.boundingSphere=new Ou(d,h.radius)}return e}});var A_={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function E_(t){"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:Pd,this.options=void 0}function C_(){Mu.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function P_(t,e,r){this.name="",this.color=new Eu(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function O_(t,e){this.name="",this.color=new Eu(t),this.density=void 0!==e?e:25e-5}Object.assign((function(t){this.manager=void 0!==t?t:Pd}).prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new Fm,o=new Wd(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(r){o.load(t[r],function(t){i.images[r]=t,6==++a&&(i.needsUpdate=!0,e&&e(i))},void 0,n)}for(var l=0;l<t.length;++l)s(l);return i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign((function(t){this.manager=void 0!==t?t:Pd}).prototype,{load:function(t,e,r,n){var i=this,o=new Nd(this.manager);o.setPath(this.path),o.load(t,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(r);e&&e(n)},r,n)},parse:function(t){return new jw(t)},setPath:function(t){return this.path=t,this}}),E_.prototype={constructor:E_,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var i=this,o=Ed.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,i.options)}).then(function(r){Ed.add(t,r),e&&e(r),i.manager.itemEnd(t)}).catch(function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},C_.prototype=Object.assign(Object.create(Mu.prototype),{constructor:C_,copy:function(t){Mu.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);r.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object},raycast:function(){var t=new yu;return function(e,r){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,r)}}(),update:function(){var t=new yu,e=new yu;return function(r){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var i=t.distanceTo(e);n[0].object.visible=!0;for(var o=1,a=n.length;o<a&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<a;o++)n[o].object.visible=!1}}}(),toJSON:function(t){var e=Mu.prototype.toJSON.call(this,t);e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),P_.prototype.isFog=!0,P_.prototype.clone=function(){return new P_(this.color.getHex(),this.near,this.far)},P_.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},O_.prototype.isFogExp2=!0,O_.prototype.clone=function(){return new O_(this.color.getHex(),this.density)},O_.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};var N_={WireframeGeometry:Sf,TetrahedronGeometry:e_,TetrahedronBufferGeometry:r_,OctahedronGeometry:up,OctahedronBufferGeometry:hp,IcosahedronGeometry:Fb,IcosahedronBufferGeometry:Ub,DodecahedronGeometry:Hw,DodecahedronBufferGeometry:Ww,PolyhedronGeometry:lp,PolyhedronBufferGeometry:cp,TubeGeometry:s_,TubeBufferGeometry:l_,TorusKnotGeometry:o_,TorusGeometry:dp,TorusBufferGeometry:pp,TextGeometry:n_,TextBufferGeometry:i_,SphereGeometry:qu,SphereBufferGeometry:Ju,RingGeometry:$w,RingBufferGeometry:t_,PlaneGeometry:Sd,PlaneBufferGeometry:Td,LatheGeometry:Jw,LatheBufferGeometry:Zw,ShapeGeometry:Ow,ShapeBufferGeometry:Nw,ExtrudeGeometry:Yw,ExtrudeBufferGeometry:qw,EdgesGeometry:Xw,ConeGeometry:Vw,ConeBufferGeometry:Gw,CylinderGeometry:qh,CylinderBufferGeometry:Jh,CircleGeometry:Rb,CircleBufferGeometry:Db,BoxGeometry:Xh,BoxBufferGeometry:Yh};Object.assign((function(t){this.manager=void 0!==t?t:Pd,this.texturePath=""}).prototype,{load:function(t,e,r,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var i=this;new Nd(i.manager).load(t,function(r){var o=null;try{o=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,e):console.error("ObjectLoader: Can't load "+t+". Use JSONLoader instead.")},r,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,function(){void 0!==e&&e(s)}),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,n,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new ow).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new Jd,i=new M_,o=0,a=t.length;o<a;o++){var s,l=t[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new N_[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new N_[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new N_[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new N_[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new N_[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new N_[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new N_[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new N_[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new N_[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new N_[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new N_[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new N_[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var c=[];for(o=0,a=l.shapes.length;o<a;o++)c.push(e[l.shapes[o]]);s=new N_[l.type](c,l.curveSegments);break;case"BufferGeometry":s=i.parse(l);break;case"Geometry":s=n.parse(l,this.texturePath).geometry;break;default:console.warn('ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}s.uuid=l.uuid,void 0!==l.name&&(s.name=l.name),r[l.uuid]=s}return r},parseMaterials:function(t,e){var r={};if(void 0!==t){var n=new Hd;n.setTextures(e);for(var i=0,o=t.length;i<o;i++){var a=t[i];if("MultiMaterial"===a.type){for(var s=[],l=0;l<a.materials.length;l++)s.push(n.parse(a.materials[l]));r[a.uuid]=s}else r[a.uuid]=n.parse(a)}}return r},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=hd.parse(t[r]);e.push(n)}return e},parseImages:function(t,e){var r=this,n={};function i(t){return r.manager.itemStart(t),o.load(t,function(){r.manager.itemEnd(t)},void 0,function(){r.manager.itemEnd(t),r.manager.itemError(t)})}if(void 0!==t&&t.length>0){var o=new Wd(new Cd(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var l=t[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=i(c)}}return n},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];void 0===a.image&&console.warn('ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("ObjectLoader: Undefined image",a.image);var s=new xd(e[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=r(a.mapping,L_)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=r(a.wrap[0],I_),s.wrapT=r(a.wrap[1],I_)),void 0!==a.format&&(s.format=a.format),void 0!==a.minFilter&&(s.minFilter=r(a.minFilter,R_)),void 0!==a.magFilter&&(s.magFilter=r(a.magFilter,R_)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),n[a.uuid]=s}return n},parseObject:function(t,e,r){var n;function i(t){return void 0===e[t]&&console.warn("ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var o=t[n];void 0===r[o]&&console.warn("ObjectLoader: Undefined material",o),e.push(r[o])}return e}return void 0===r[t]&&console.warn("ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":n=new vd,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new Eu(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new P_(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new O_(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new fd(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new gd(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new Qf(t.color,t.intensity);break;case"DirectionalLight":n=new Wf(t.color,t.intensity);break;case"PointLight":n=new Gf(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new T_(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new Yf(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new qf(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(t.geometry),s=o(t.material);n=a.bones&&a.bones.length>0?new Ff(a,s):new zh(a,s);break;case"LOD":n=new C_;break;case"Line":n=new Vh(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":n=new nm(i(t.geometry),o(t.material));break;case"LineSegments":n=new Kf(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new mf(i(t.geometry),o(t.material));break;case"Sprite":n=new wg(o(t.material));break;case"Group":n=new Nf;break;default:n=new Mu}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var l=t.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],e,r));if("LOD"===t.type)for(var u=t.levels,h=0;h<u.length;h++){var d=u[h],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}return n}});var L_={UVMapping:300,CubeReflectionMapping:lh,CubeRefractionMapping:302,EquirectangularReflectionMapping:ch,EquirectangularRefractionMapping:304,SphericalReflectionMapping:uh,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},I_={RepeatWrapping:hh,ClampToEdgeWrapping:dh,MirroredRepeatWrapping:ph},R_={NearestFilter:fh,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:mh,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:vh};function D_(t,e,r,n,i,o,a,s,l){xd.call(this,t,e,r,n,i,o,a,s,l),this.generateMipmaps=!1}Object.assign((function(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}).prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),D_.prototype=Object.assign(Object.create(xd.prototype),{constructor:D_,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});var F_=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})};const U_=Zc(Jc);class k_{constructor(t){this.controlService=t,this.isOrbitControlEnabled=!1,this.beforeWorldRenderSubject=new P,this.afterWorldRenderSubject=new P,this.beforeControlRenderSubject=new P,this.afterControlRenderSubject=new P,this.renderWorldLoopEnabled=!1,this.fieldOfView=45,this.nearClippingPane=1,this.farClippingPane=1e4,this.cameraDistance=64,this.sunLightPhi=.9,this.sunLightTheta=2.5,this.seaLevel=58,t.cameraDistanceSubject.subscribe(t=>{if(this.cameraDistance=t,this.sunDirectLight){let t=(this.cameraDistance*Math.tan(this.fieldOfView*Math.PI/360)+this.seaLevel*Math.tan(this.sunLightPhi))*Math.sin(Math.PI/2-this.sunLightPhi);t*=Math.sqrt(3),this.sunDirectLight.shadow.camera.bottom=-(t*=1.1),this.sunDirectLight.shadow.camera.top=t,this.sunDirectLight.shadow.camera.left=-t,this.sunDirectLight.shadow.camera.right=t,this.sunDirectLight.shadow.camera.near=0,this.sunDirectLight.shadow.camera.far=4*this.cameraDistance,this.sunDirectLight.shadow.map&&(this.sunDirectLight.shadow.map.dispose(),this.sunDirectLight.shadow.map=null)}})}get worldCanvas(){return this.worldCanvasRef.nativeElement}get controlCanvas(){return this.controlCanvasRef.nativeElement}animateCamera(){this.camera&&this.car&&this.car.mesh&&(this.camera.position.x=this.car.mesh.position.x+Math.cos(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.y=this.car.mesh.position.y+Math.sin(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.z=this.cameraDistance,this.isOrbitControlEnabled&&(this.camera.position.y-=.5),this.camera.up=this.isOrbitControlEnabled?new Jc.Vector3(0,0,1):new Jc.Vector3(0,1,0),this.camera.lookAt(new Jc.Vector3(this.car.mesh.position.x+Math.cos(this.car.rotation)*this.car.speed/2,this.car.mesh.position.y+Math.sin(this.car.rotation)*this.car.speed/2,this.car.mesh.position.z)),this.sunDirectLight.position.set(this.camera.position.x+this.cameraDistance*Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.camera.position.y+this.cameraDistance*Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.car.mesh.position.z+this.cameraDistance*Math.cos(this.sunLightPhi)),this.sunDirectLight.target.position.set(this.camera.position.x,this.camera.position.y,this.car.mesh.position.z),this.isOrbitControlEnabled&&this.orbitControls&&this.orbitControls.update())}resizeCanvas(t,e){this.worldCanvas.width=t,this.worldCanvas.height=e,this.controlCanvas.width=t,this.controlCanvas.height=e,this.camera.aspect=this.worldCanvas.width/this.worldCanvas.height,this.camera.updateProjectionMatrix(),this.worldRenderer&&this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer&&this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height),this.isOrbitControlEnabled&&this.orbitControls&&this.orbitControls.update(),this.renderWorldLoopEnabled||this.renderWorldOnce(),this.renderControlsOnce()}addCar(t,e=!1){e&&(this.car=t),this.scene.add(t.mesh)}addMap(t,e){t.traverse(function(t){t instanceof Jc.Mesh&&(t.castShadow=e,t.receiveShadow=e)}),this.scene.add(t)}addControlElement(t){this.controlScene.add(t)}createScene(){this.scene=new Jc.Scene,this.controlScene=new Jc.Scene,this.camera=new Jc.PerspectiveCamera(this.fieldOfView,this.worldCanvas.width/this.worldCanvas.height,this.nearClippingPane,this.farClippingPane),this.isOrbitControlEnabled&&(this.orbitControls=new U_(this.camera)),this.sunAmbientLight=new Jc.HemisphereLight(12303359,8949920,.85),this.sunAmbientLight.position.set(0,0,1),this.scene.add(this.sunAmbientLight),this.sunDirectLight=new Jc.DirectionalLight(16777215,1.5),this.sunDirectLight.castShadow=!0,this.sunDirectLight.shadow.mapSize.width=2048,this.sunDirectLight.shadow.mapSize.height=2048,this.scene.add(this.sunDirectLight),this.scene.add(this.sunDirectLight.target),console.log(this.sunDirectLight);const t=new Jc.Vector3(Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.cos(this.sunLightPhi));this.sky=new Qc,this.sky.scale.setScalar(8e3),this.sky.up=new Jc.Vector3(0,0,1),this.sky.material.fragmentShader=this.sky.material.fragmentShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.vertexShader=this.sky.material.vertexShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.uniforms.turbidity.value=10,this.sky.material.uniforms.rayleigh.value=2,this.sky.material.uniforms.luminance.value=1,this.sky.material.uniforms.mieCoefficient.value=.005,this.sky.material.uniforms.mieDirectionalG.value=.8,this.sky.material.uniforms.sunPosition.value=t.clone(),this.scene.add(this.sky),this.water=new Oy(new Jc.PlaneBufferGeometry(1e4,1e4),{textureWidth:128,textureHeight:128,waterNormals:(new Jc.TextureLoader).load("assets/models/maps/common/textures/waternormals.jpg",function(t){t.wrapS=t.wrapT=Jc.RepeatWrapping}),alpha:1,sunDirection:t.clone(),sunColor:16777215,waterColor:13365,distortionScale:3.7}),this.water.material.uniforms.size.value=3,this.water.position.z=-this.seaLevel,this.water.material.fragmentShader=this.water.material.fragmentShader.replace("getNoise( worldPosition.xz * size );","getNoise( worldPosition.xy * size );"),this.water.material.fragmentShader=this.water.material.fragmentShader.replace("vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","vec3 surfaceNormal = normalize( noise.xyz * vec3( 1.5, 1.0, 1.5 ) );"),this.water.material.fragmentShader=this.water.material.fragmentShader.replace("vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","vec2 distortion = surfaceNormal.xy * ( 0.001 + 1.0 / distance ) * distortionScale;"),this.scene.add(this.water),this.beforeWorldRenderSubject.subscribe(()=>{this.water.material.uniforms.time.value+=1/60})}initCanvases(){this.worldRenderer=new Jc.WebGLRenderer({canvas:this.worldCanvas,antialias:!0,transparent:!0}),this.worldRenderer.shadowMap.enabled=!0,this.worldRenderer.shadowMapType=Jc.PCFSoftShadowMap,this.worldRenderer.setPixelRatio(devicePixelRatio),this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer=new Jc.WebGLRenderer({canvas:this.controlCanvas,antialias:!0,alpha:!0}),this.controlRenderer.setPixelRatio(devicePixelRatio),this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height)}ngAfterViewInit(){this.resizeCanvas(window.innerWidth,window.innerHeight),this.initCanvases()}ngOnInit(){this.createScene()}renderWorldOnce(){requestAnimationFrame(this._renderWorldSceneRoutine.bind(this))}startWorldRenderingLoop(){this.renderWorldLoopEnabled=!0,this.renderWorldOnce()}stopWorldRenderingLoop(){this.renderWorldLoopEnabled=!1}renderControlsOnce(){requestAnimationFrame(this._renderControlSceneRoutine.bind(this))}renderControlsOnceSync(){return F_(this,void 0,void 0,function*(){return new Promise(t=>{const e=this.afterControlRenderSubject.subscribe(()=>{e.unsubscribe(),t()});this.renderControlsOnce()})})}_renderWorldSceneRoutine(){this.renderWorldLoopEnabled&&requestAnimationFrame(this._renderWorldSceneRoutine.bind(this)),this.beforeWorldRenderSubject.next(),this.worldRenderer.clear(),this.worldRenderer.render(this.scene,this.camera),this.afterWorldRenderSubject.next()}_renderControlSceneRoutine(){this.beforeControlRenderSubject.next(),this.controlRenderer.clear(),this.controlRenderer.render(this.controlScene,this.camera),this.afterControlRenderSubject.next()}}var B_=Tn({encapsulation:0,styles:[["stage-3d[_ngcontent-%COMP%]{width:100%;height:100%}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}"]],data:{}});function j_(t){return $n(0,[Qn(402653184,1,{worldCanvasRef:0}),Qn(402653184,2,{controlCanvasRef:0}),(t()(),zn(2,0,[[1,0],["worldCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null)),(t()(),zn(3,0,[[2,0],["controlCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null))],null,null)}var z_=r("3hGs");class V_{constructor(t,e,r,n,i){this.scene=t,this.checkpoints=e,this.polygon=r,this.roadSpline=n,this.startPositions=i}}var G_=PIXI.Point;class H_{getPosition(){return new G_(this.x,this.y)}static fromDummyObject(t){const e=new H_,r=t.colladaId.match(this.NODE_NAME_REGEX);if(!r)throw new Error("Invalid checkpoint dummy");return e.x=t.position.x,e.y=t.position.y,e.radius=+r[2],e}}H_.NODE_NAME_REGEX=/^node-maphelper_checkpoint_(\d+)_r(\d+)$/;class W_{constructor(){this.outerPolygon=[[-2048,-2048],[2048,-2048],[2048,2048],[-2048,2048]],this.innerPolygons=[]}isContainingPoint(t){if(!ru.isPointInsidePolygon(t,this.outerPolygon))return!1;for(let e of this.innerPolygons)if(ru.isPointInsidePolygon(t,e))return!1;return!0}getLinePolygonIntersection(t,e){let r=this.isContainingPoint(t)?t:e,n=r===t?e:t;for(;ru.getDistanceBetweenPoints(r,n)>.05;){let t=ru.getMiddlePoint(r,n);this.isContainingPoint(t)?r=t:n=t}return ru.getMiddlePoint(r,n)}static fromDummyObject(t){return new W_}}var X_=PIXI.Point;class Y_{constructor(t=new PIXI.Point,e=0,r=0){this.position=new X_,this.rotation=0,this.speed=0,this.position=t,this.rotation=e,this.speed=r}}class q_ extends Jc.Vector3{constructor(t,e,r){super(t,e,0),this.distanceFromStart=r}}class J_{constructor(t,e){this.pointOnSpline=t,this.lineIndex=e}}class Z_{constructor(t,e){this.distanceFromStart=t,this.lapPercent=e}}class Q_{constructor(t){this.minSegmentLength=Number.MAX_SAFE_INTEGER,this.roadLength=0,this.points=[],this.lines=[];for(let r=0;r<t.length;r++){if(r>0){const e=t[r].distanceTo(t[r-1]);this.roadLength+=e,this.minSegmentLength=Math.min(this.minSegmentLength,e),this.lines.push(new Jc.Line3(t[r-1],t[r]))}this.points.push(new q_(t[r].x,t[r].y,this.roadLength))}const e=t[t.length-1].distanceTo(t[0]);this.roadLength+=e,this.minSegmentLength=Math.min(this.minSegmentLength,e),this.lines.push(new Jc.Line3(t[t.length-1],t[0]))}getNearestPointOnSpline(t,e=-1,r=Number.MAX_SAFE_INTEGER){let n;if(-1===e)n=this.lines.map((t,e)=>({line:t,originalIndex:e}));else{n=[];for(let t=e-r;t<=e+r;t++){const e=(t+this.lines.length)%this.lines.length;n.push({line:this.lines[e],originalIndex:e})}}return n.map(e=>new J_(e.line.closestPointToPoint(t,!0,new Jc.Vector3),e.originalIndex)).reduce((e,r)=>e?r.pointOnSpline.distanceTo(t)<e.pointOnSpline.distanceTo(t)?r:e:r,null)}getLapProgress(t){const e=this.points[t.lineIndex].distanceFromStart+this.lines[t.lineIndex].start.distanceTo(t.pointOnSpline);return new Z_(e,100*e/this.roadLength)}}var K_=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})},$_=PIXI.Point;class tS{constructor(){}loadCar(t){return K_(this,void 0,void 0,function*(){const e=tS.CARS_CACHE.get(t);if(e)return console.log("Car loaded from cache"),e.clone();const r=yield this.loadColladaScene(`cars/${t}/`,"body");return tS.CARS_CACHE.set(t,r.scene),r.scene})}loadMap(t){return K_(this,void 0,void 0,function*(){const e=yield this.loadColladaScene(`maps/${t}/`,"scene"),r=[],n=new W_,i=[];let o;for(let t=0;t<e.scene.children.length;t++){let a=!1;const s=e.scene.children[t];if(s.colladaId){const t=s.colladaId.match(H_.NODE_NAME_REGEX);t&&(r[+t[1]]=H_.fromDummyObject(s),a=!0);const e=s.colladaId.match(tS.POSITION_NODE_REGEX);e&&(i[+e[1]]=new Y_(new $_(s.position.x,s.position.y),s.rotation.z),a=!0),s.colladaId.match(tS.ROAD_CENTER_NODE_REGEX)&&(o=this.parseSpline(s),a=!0);const l=s.colladaId.match(tS.POLYGON_NODE_REGEX);l&&("outer"===l[1]?n.outerPolygon=this.parseSpline(s).map(t=>[t.x,t.y]):"inner"===l[1]&&n.innerPolygons.push(this.parseSpline(s).map(t=>[t.x,t.y])),a=!0)}else a=!0;a&&(e.scene.remove(s),t--)}return e.scene.traverse(function(t){t instanceof Jc.Mesh&&(t.parent&&"cliffs"===t.parent.name?(t.material.color=new Jc.Color(.68,.67,.65),t.material.bumpScale=.3):t.parent&&"tonnels_arc"===t.parent.name?(t.material.color=new Jc.Color(.68,.67,.65),t.material.bumpScale=.25):t.parent&&"bridge01"===t.parent.name&&(t.material.color=new Jc.Color(.76,.76,.66),t.material.specular=new Jc.Color(0,0,0),t.material.bumpScale=.1))}),new V_(e.scene,r,n,new Q_(o),i)})}parseSpline(t){const e=new Jc.Vector3;let r=t;for(;r&&!r.geometry;)r.position&&e.add(r.position),r=r.children[0];return r.position&&e.add(r.position),r.geometry.vertices.map(t=>{const r=t.clone();return r.add(e),r})}loadColladaScene(t,e="scene"){return K_(this,void 0,void 0,function*(){return new Promise((r,n)=>{setTimeout(()=>K_(this,void 0,void 0,function*(){z_().load(`${tS.PREFIX}${t}${e}.dae`,t=>K_(this,void 0,void 0,function*(){yield this.waitForAllContentLoaded(),r(t)}))}),15)})})}waitForAllContentLoaded(){return K_(this,void 0,void 0,function*(){return new Promise((t,e)=>{Jc.DefaultLoadingManager.onProgress=function(e,r,n){r===n&&t()},Jc.DefaultLoadingManager.onError=function(t,r,n){e()}})})}}tS.PREFIX="assets/models/",tS.CARS_CACHE=new Map,tS.POLYGON_NODE_REGEX=/^node-maphelper_polygon_(outer|inner)$/,tS.POSITION_NODE_REGEX=/^node-maphelper_player-position_(\d+)$/,tS.ROAD_CENTER_NODE_REGEX=/^node-maphelper_road-center$/;class eS extends P{constructor(){this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(t){return this.hasError?m.EMPTY:this.hasCompleted&&this.hasNext?m.EMPTY:super._subscribe(t)}next(t){this.hasCompleted||(this.value=t,this.hasNext=!0)}error(t){}complete(){this.hasCompleted=!0}}function rS(t){const{args:e,subscriber:r,params:n}=t,{callbackFunc:i,context:o,scheduler:a}=n;let{subject:s}=n;if(!s){s=n.subject=new eS;const t=(...t)=>{this.add(a.schedule(nS,0,{value:t.length<=1?t[0]:t,subject:s}))};try{i.apply(o,[...e,t])}catch(t){s.error(t)}}this.add(s.subscribe(r))}function nS(t){const{value:e,subject:r}=t;r.next(e),r.complete()}function iS(t){const{params:e,subscriber:r,context:n}=t,{callbackFunc:i,args:o,scheduler:a}=e;let s=e.subject;if(!s){s=e.subject=new eS;const t=(...t)=>{const e=t.shift();this.add(e?a.schedule(aS,0,{err:e,subject:s}):a.schedule(oS,0,{value:t.length<=1?t[0]:t,subject:s}))};try{i.apply(n,[...o,t])}catch(t){this.add(a.schedule(aS,0,{err:t,subject:s}))}}this.add(s.subscribe(r))}function oS(t){const{value:e,subject:r}=t;r.next(e),r.complete()}function aS(t){const{err:e,subject:r}=t;r.error(e)}T.bindCallback=function t(e,r,n){if(r){if(!N(r))return(...i)=>t(e,n)(...i).pipe(G(t=>l(t)?r(...t):r(t)));n=r}return function(...t){const r=this;let i;const o={context:r,subject:i,callbackFunc:e,scheduler:n};return new T(a=>{if(n)return n.schedule(rS,0,{args:t,subscriber:a,params:o});if(!i){i=new eS;const n=(...t)=>{i.next(t.length<=1?t[0]:t),i.complete()};try{e.apply(r,[...t,n])}catch(t){i.error(t)}}return i.subscribe(a)})}},T.bindNodeCallback=function t(e,r,n){if(r){if(!N(r))return(...i)=>t(e,n)(...i).pipe(G(t=>l(t)?r(...t):r(t)));n=r}return function(...t){const r={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new T(i=>{const{context:o}=r;let{subject:a}=r;if(n)return n.schedule(iS,0,{params:r,subscriber:i,context:o});if(!a){a=r.subject=new eS;const n=(...t)=>{const e=t.shift();e?a.error(e):(a.next(t.length<=1?t[0]:t),a.complete())};try{e.apply(o,[...t,n])}catch(t){a.error(t)}}return a.subscribe(i)})}};const sS={};class lS{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new cS(t,this.resultSelector))}}class cS extends V{constructor(t,e){this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){}_complete(){const t=this.observables.length;if(0===t);else{this.active=t,this.toRespond=t;for(let e=0;e<t;e++);}}notifyComplete(t){this.active-=1}notifyNext(t,e,r,n,i){const o=this.values;this.toRespond&&o[r]===sS&&--this.toRespond,o[r]=e}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(t){return}}}function uS(...t){return 1===t.length||2===t.length&&N(t[1])?Y(t[0]):ka()(Ii(...t))}function hS(t){return new T(e=>{let r;try{r=t()}catch(t){return void e.error(t)}return(r?Y(r):Ni()).subscribe(e)})}T.combineLatest=function(...t){let e=null,r=null;return N(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&l(t[0])&&(t=t[0]),X(t,r).lift(new lS(e))},T.concat=uS,T.defer=hS,T.empty=Ni;class dS extends V{constructor(t,e){this.sources=e,this.completed=0,this.haveValues=0;const r=e.length;this.values=new Array(r);for(let n=0;n<r;n++);}notifyNext(t,e,r,n,i){this.values[r]=e,i._hasValue||(i._hasValue=!0,this.haveValues++)}notifyComplete(t){const{destination:e,haveValues:r,values:n}=this;t._hasValue&&this.completed++}}function pS(t){const{subscriber:e,condition:r}=t;if(e.closed)return;if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(r){let n;try{n=r(t.state)}catch(t){return void e.error(t)}if(!n)return void e.complete();if(e.closed)return}let n;try{n=t.resultSelector(t.state)}catch(t){return void e.error(t)}return e.closed||(e.next(n),e.closed)?void 0:this.schedule(t)}T.forkJoin=function t(...e){let r;return"function"==typeof e[e.length-1]&&(r=e.pop()),1===e.length&&l(e[0])&&(e=e[0]),0===e.length?Oi:r?t(e).pipe(G(t=>r(...t))):new T(t=>new dS(t,e))},T.from=Y,Object,T.fromEvent=function t(e,r,n,o){return i(n)&&(o=n,n=void 0),o?t(e,r,n).pipe(G(t=>l(t)?o(...t):o(t))):new T(t=>{!function t(e,r,n,i,o){let a;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(e)){const t=e;e.addEventListener(r,n,o),a=(()=>t.removeEventListener(r,n,o))}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(e)){const t=e;e.on(r,n),a=(()=>t.off(r,n))}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(e)){const t=e;e.addListener(r,n),a=(()=>t.removeListener(r,n))}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(let a=0,s=e.length;a<s;a++)t(e[a],r,n,i,o)}i.add(a)}(e,r,function(e){t.next(arguments.length>1?Array.prototype.slice.call(arguments):e)},t,n)})},T.fromEventPattern=function t(e,r,n){return n?t(e,r).pipe(G(t=>l(t)?n(...t):n(t))):new T(t=>{const n=(...e)=>t.next(1===e.length?e[0]:e);let o;try{o=e(n)}catch(e){return void t.error(e)}if(i(r))return()=>r(n,o)})},T.fromPromise=Y,T.generate=function(t,e,r,n,i){let o,a;return 1==arguments.length?(a=t.initialState,e=t.condition,r=t.iterate,o=t.resultSelector||Q,i=t.scheduler):void 0===n||N(n)?(a=t,o=Q,i=n):(a=t,o=n),new T(t=>{let n=a;if(i)return i.schedule(pS,0,{subscriber:t,iterate:r,condition:e,resultSelector:o,state:n});for(;;){if(e){let r;try{r=e(n)}catch(e){return void t.error(e)}if(!r){t.complete();break}}let i;try{i=o(n)}catch(e){return void t.error(e)}if(t.next(i),t.closed)break;try{n=r(n)}catch(e){return void t.error(e)}}})},T.if=function(t,e=Oi,r=Oi){return hS(()=>t()?e:r)};class fS extends m{constructor(t,e){}schedule(t,e=0){return this}}class mS extends fS{constructor(t,e){this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this}requestAsyncId(t,e,r=0){return setInterval(t.flush.bind(t,this),r)}recycleAsyncId(t,e,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return e}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){}_unsubscribe(){const t=this.id,e=this.scheduler;this.work=null,this.state=null,this.pending=!1,this.scheduler=null,null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}class vS{constructor(t,e=vS.now){this.SchedulerAction=t,this.now=e}schedule(t,e=0,r){return new this.SchedulerAction(this,t).schedule(r,e)}}vS.now=Date.now?Date.now:()=>+new Date;class gS extends vS{constructor(t,e=vS.now){this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,r){return gS.delegate&&gS.delegate!==this?gS.delegate.schedule(t,e,r):super.schedule(t,e,r)}flush(t){const{actions:e}=this;if(this.active)return;let r;this.active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,r){for(;t=e.shift(););throw r}}}const yS=new gS(mS);function xS(t){return!l(t)&&t-parseFloat(t)+1>=0}function bS(t){const{subscriber:e,counter:r,period:n}=t;e.next(r),this.schedule({subscriber:e,counter:r+1,period:n},n)}function wS(...t){if(1===t.length){if(!l(t[0]))return t[0];t=t[0]}return X(t,void 0).lift(new _S)}T.interval=function(t=0,e=yS){return(!xS(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=yS),new T(r=>(r.add(e.schedule(bS,t,{subscriber:r,counter:0,period:t})),r))},T.merge=$;class _S{call(t,e){return e.subscribe(new SS(t))}}class SS extends V{constructor(t){this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(t){}_complete(){const t=this.observables.length;if(0===t);else{for(let e=0;e<t&&!this.hasFirst;e++);this.observables=null}}notifyNext(t,e,r,n,i){if(!this.hasFirst){this.hasFirst=!0;for(let t=0;t<this.subscriptions.length;t++);this.subscriptions=null}}}T.race=wS;const TS=new T(w);function MS(t){const{keys:e,index:r,subscriber:n,subscription:i,obj:o}=t;if(!n.closed)if(r<e.length){const t=e[r];n.next([t,o[t]]),i.add(this.schedule({keys:e,index:r+1,subscriber:n,subscription:i,obj:o}))}else n.complete()}function AS(t){const{start:e,index:r,count:n,subscriber:i}=t;r>=n?i.complete():(i.next(e),i.closed||(t.index=r+1,t.start=e+1,this.schedule(t)))}function ES(t=0,e,r){let n=-1;return xS(e)?n=Number(e)<1?1:Number(e):N(e)&&(r=e),N(r)||(r=yS),new T(e=>{const i=xS(t)?t:+t-r.now();return r.schedule(CS,i,{index:0,period:n,subscriber:e})})}function CS(t){const{index:e,period:r,subscriber:n}=t;if(n.next(e),!n.closed){if(-1===r)return n.complete();t.index=e+1,this.schedule(t,r)}}function PS(...t){const e=t[t.length-1];return"function"==typeof e&&t.pop(),X(t,void 0).lift(new OS(e))}T.never=function(){return TS},T.of=Ii,T.onErrorResumeNext=function t(...e){if(0===e.length)return Oi;const[r,...n]=e;return 1===e.length&&l(r)?t(...r):new T(e=>{const i=()=>e.add(t(...n).subscribe(e));return Y(r).subscribe({next(t){e.next(t)},error:i,complete:i})})},T.pairs=function(t,e){return new T(e?r=>{const n=Object.keys(t),i=new m;return i.add(e.schedule(MS,0,{keys:n,index:0,subscriber:r,subscription:i,obj:t})),i}:e=>{const r=Object.keys(t);for(let n=0;n<r.length&&!e.closed;n++){const i=r[n];t.hasOwnProperty(i)&&e.next([i,t[i]])}e.complete()})},T.range=function(t=0,e=0,r){return new T(n=>{let i=0;if(r)return r.schedule(AS,0,{index:i,count:e,start:t,subscriber:n});for(;;){if(i++>=e){n.complete();break}if(n.next(t++),n.closed)break}})},T.using=function(t,e){return new T(r=>{let n,i;try{n=t()}catch(t){return void r.error(t)}try{i=e(n)}catch(t){return void r.error(t)}const o=(i?Y(i):Oi).subscribe(r);return()=>{o.unsubscribe(),n&&n.unsubscribe()}})},T.throw=Ti,T.throwError=Ti,T.timer=ES;class OS{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new NS(t,this.resultSelector))}}class NS extends y{constructor(t,e,r=Object.create(null)){this.iterators=[],this.active=0,this.resultSelector="function"==typeof e?e:null,this.values=r}_next(t){l(t)}_complete(){const t=this.iterators,e=t.length;if(0!==e){this.active=e;for(let r=0;r<e;r++)t[r].stillUnsubscribed||this.active--}}notifyInactive(){this.active--}checkIterators(){const t=this.iterators,e=t.length;for(let n=0;n<e;n++){let e=t[n];if("function"==typeof e.hasValue&&!e.hasValue())return}let r=!1;for(let n=0;n<e;n++){let e=t[n],i=e.next();if(e.hasCompleted()&&(r=!0),i.done)return}}_tryresultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(t){return}}}T.zip=PS;const LS="undefined"!=typeof window&&window,IS="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,RS="undefined"!=typeof global&&global,DS=LS||RS||IS;function FS(t,e=null){return new GS({method:"GET",url:t,headers:e})}function US(t,e,r){return new GS({method:"POST",url:t,body:e,headers:r})}function kS(t,e){return new GS({method:"DELETE",url:t,headers:e})}function BS(t,e,r){return new GS({method:"PUT",url:t,body:e,headers:r})}function jS(t,e,r){return new GS({method:"PATCH",url:t,body:e,headers:r})}const zS=G((t,e)=>t.response);function VS(t,e){return zS(new GS({method:"GET",url:t,responseType:"json",headers:e}))}class GS extends T{constructor(t){const e={async:!0,createXHR:function(){return this.crossDomain?function(){if(DS.XMLHttpRequest)return new DS.XMLHttpRequest;if(DS.XDomainRequest)return new DS.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(DS.XMLHttpRequest)return new DS.XMLHttpRequest;{let t;try{const e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(let r=0;r<3;r++)try{if(new DS.ActiveXObject(t=e[r]))break}catch(t){}return new DS.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)e.url=t;else for(const r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);this.request=e}_subscribe(t){return new HS(t,this.request)}}GS.create=(()=>{const t=t=>new GS(t);return t.get=FS,t.post=US,t.delete=kS,t.put=BS,t.patch=jS,t.getJSON=VS,t})();class HS extends y{constructor(t,e){this.request=e,this.done=!1;const r=e.headers=e.headers||{};e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in r||DS.FormData&&e.body instanceof DS.FormData||void 0===e.body||(r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),e.body=this.serializeBody(e.body,e.headers["Content-Type"])}next(t){this.done=!0;const{xhr:e,request:r,destination:n}=this}send(){const{request:t,request:{user:e,method:r,url:n,async:i,password:o,headers:a,body:s}}=this,l=p(t.createXHR).call(t);if(l===u);else{let a;if(this.xhr=l,(a=e?p(l.open).call(l,r,n,i,e,o):p(l.open).call(l,r,n,i))===u)return null;if(i&&(l.timeout=t.timeout,l.responseType=t.responseType),"withCredentials"in l&&(l.withCredentials=!!t.withCredentials),(a=s?p(l.send).call(l,s):p(l.send).call(l))===u)return null}return l}serializeBody(t,e){if(!t||"string"==typeof t)return t;if(DS.FormData&&t instanceof DS.FormData)return t;if(e){const t=e.indexOf(";");-1!==t&&(e=e.substring(0,t))}switch(e){case"application/x-www-form-urlencoded":return Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&");case"application/json":return JSON.stringify(t);default:return t}}setHeaders(t,e){for(let r in e)e.hasOwnProperty(r)}setupEvents(t,e){const r=e.progressSubscriber;function n(t){const{subscriber:e,progressSubscriber:r,request:i}=n;r&&r.error(t),e.error(new XS(this,i))}if(t.ontimeout=n,n.request=e,n.subscriber=this,n.progressSubscriber=r,t.upload&&"withCredentials"in t){if(r){let e;e=function(t){const{progressSubscriber:r}=e;r.next(t)},DS.XDomainRequest?t.onprogress=e:t.upload.onprogress=e,e.progressSubscriber=r}let n;t.onerror=n=function(t){const{progressSubscriber:e,subscriber:r,request:i}=n;e&&e.error(t),r.error(new WS("ajax error",this,i))},n.request=e,n.subscriber=this,n.progressSubscriber=r}function i(t){const{subscriber:e,progressSubscriber:r,request:n}=i;if(4===this.readyState){let i=1223===this.status?204:this.status;0===i&&(i=("text"===this.responseType?this.response||this.responseText:this.response)?200:0),i<400?(r&&r.complete(),e.next(t),e.complete()):(r&&r.error(t),e.error(new WS("ajax error "+i,this,n)))}}t.onreadystatechange=i,i.subscriber=this,i.progressSubscriber=r,i.request=e}unsubscribe(){const{done:t,xhr:e}=this}}class WS extends Error{constructor(t,e,r){this.message=t,this.xhr=e,this.request=r,this.status=e.status,this.responseType=e.responseType||r.responseType,this.response=function(t,e){switch(t){case"json":return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null");case"xml":return e.responseXML;case"text":default:return"response"in e?e.response:e.responseText}}(this.responseType,e),this.name="AjaxError"}}class XS extends WS{constructor(t,e){}}T.ajax=GS.create;const YS=new class extends gS{}(class extends mS{constructor(t,e){this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(t,e,r):t.flush(this)}});class qS{constructor(t,e,r){this.kind=t,this.value=e,this.error=r,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,r){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return r&&r()}}accept(t,e,r){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,r)}toObservable(){switch(this.kind){case"N":return Ii(this.value);case"E":return Ti(this.error);case"C":return Ni()}throw new Error("unexpected notification kind value")}static createNext(t){return void 0!==t?new qS("N",t):qS.undefinedValueNotification}static createError(t){return new qS("E",void 0,t)}static createComplete(){return qS.completeNotification}}function JS(t,e=0){return function(r){return r.lift(new ZS(t,e))}}qS.completeNotification=new qS("C"),qS.undefinedValueNotification=new qS("N",void 0);class ZS{constructor(t,e=0){this.scheduler=t,this.delay=e}call(t,e){return e.subscribe(new QS(t,this.scheduler,this.delay))}}class QS extends y{constructor(t,e,r=0){this.scheduler=e,this.delay=r}static dispatch(t){const{notification:e,destination:r}=t}scheduleMessage(t){}_next(t){}_error(t){}_complete(){}}class KS extends P{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,r){this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){}nextTimeWindow(t){}_subscribe(t){const e=this._infiniteTimeWindow,r=this.scheduler,n=(e?this._events:this._trimBufferThenGetEvents()).length;let i;if(this.closed)throw new A;if(i=this.isStopped||this.hasError?m.EMPTY:new E(this,t),r&&(t=new QS(t,r)),e)for(let o=0;o<n&&!t.closed;o++);else for(let o=0;o<n&&!t.closed;o++);return i}_getNow(){return(this.scheduler||YS).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,r=this._windowTime,n=this._events,i=n.length;let o=0;for(;o<i&&!(t-n[o].time<r);)o++;return i>e&&(o=Math.max(o,i-e)),n}}const $S={url:"",deserializer:t=>JSON.parse(t.data),serializer:t=>JSON.stringify(t)};class tT extends O{constructor(t,e){if(t instanceof T)this.destination=e,this.source=t;else{const e=this._config=Object.assign({},$S);if(e.WebSocketCtor=WebSocket,this._output=new P,"string"==typeof t)e.url=t;else for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);if(!e.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new KS}}lift(t){const e=new tT(this._config,this.destination);return e.operator=t,e.source=this,e}_resetState(){this._socket=null,this.source||(this.destination=new KS),this._output=new P}multiplex(t,e,r){return new T(t=>()=>{})}_connectSocket(){const{WebSocketCtor:t,protocol:e,url:r,binaryType:n}=this._config;let i=null;try{this._socket=i=e?new t(r,e):new t(r),n&&(this._socket.binaryType=n)}catch(t){return}i.onopen=(t=>{const{openObserver:e}=this._config;this.destination=y.create(t=>{if(1===i.readyState){const{serializer:e}=this._config;if(p(e)(t)===u)return}},t=>{const{closingObserver:e}=this._config},()=>{const{closingObserver:t}=this._config})}),i.onerror=(t=>{}),i.onclose=(t=>{const{closeObserver:e}=this._config}),i.onmessage=(t=>{const{deserializer:e}=this._config})}_subscribe(t){const{source:e}=this;return e?e.subscribe(t):new m}unsubscribe(){const{source:t,_socket:e}=this;t||(this.destination=new KS)}}function eT(t){return function(e){return e.lift(new rT(t))}}T.webSocket=function(t){return new tT(t)};class rT{constructor(t){this.closingNotifier=t}call(t,e){return e.subscribe(new nT(t,this.closingNotifier))}}class nT extends V{constructor(t,e){this.buffer=[]}_next(t){}notifyNext(t,e,r,n,i){this.buffer=[]}}function iT(t,e=null){return function(r){return r.lift(new oT(t,e))}}T.prototype.buffer=function(t){return eT(t)(this)};class oT{constructor(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?sT:aT}call(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))}}class aT extends y{constructor(t,e){this.bufferSize=e,this.buffer=[]}_next(t){this.buffer.length==this.bufferSize&&(this.buffer=[])}_complete(){}}class sT extends y{constructor(t,e,r){this.bufferSize=e,this.startBufferEvery=r,this.buffers=[],this.count=0}_next(t){const{bufferSize:e,startBufferEvery:r,buffers:n,count:i}=this;this.count++;for(let o=n.length;o--;);}_complete(){const{buffers:t,destination:e}=this;for(;t.length>0;);}}function lT(t){let e=arguments.length,r=yS;N(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],e--);let n=null;e>=2&&(n=arguments[1]);let i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),function(e){return e.lift(new cT(t,n,i,r))}}T.prototype.bufferCount=function(t,e=null){return iT(t,e)(this)};class cT{constructor(t,e,r,n){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=r,this.scheduler=n}call(t,e){return e.subscribe(new hT(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))}}class uT{constructor(){this.buffer=[]}}class hT extends y{constructor(t,e,r,n,i){this.bufferTimeSpan=e,this.bufferCreationInterval=r,this.maxBufferSize=n,this.scheduler=i,this.contexts=[];const o=this.openContext();this.timespanOnly=null==r||r<0,o.closeAction=this.timespanOnly?i.schedule(dT,e,{subscriber:this,context:o,bufferTimeSpan:e}):i.schedule(pT,e,{subscriber:this,context:o})}_next(t){const e=this.contexts,r=e.length;let n;for(let i=0;i<r;i++){const t=e[i];t.buffer.length==this.maxBufferSize&&(n=t)}}_error(t){this.contexts.length=0}_complete(){const{contexts:t,destination:e}=this;for(;t.length>0;);}_unsubscribe(){this.contexts=null}onBufferFull(t){if(!this.closed&&this.timespanOnly){const e=this.bufferTimeSpan;(t=this.openContext()).closeAction=this.scheduler.schedule(dT,e,{subscriber:this,context:t,bufferTimeSpan:e})}}openContext(){return new uT}closeContext(t){}}function dT(t){const e=t.subscriber,r=t.context;r&&e.closeContext(r),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function pT(t){const{subscriber:e,context:r}=t;e.closeContext(r)}function fT(t,e){return function(r){return r.lift(new mT(t,e))}}T.prototype.bufferTime=function(t){let e=arguments.length,r=yS;N(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],e--);let n=null;e>=2&&(n=arguments[1]);let i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),lT(t,n,i,r)(this)};class mT{constructor(t,e){this.openings=t,this.closingSelector=e}call(t,e){return e.subscribe(new vT(t,this.openings,this.closingSelector))}}class vT extends V{constructor(t,e,r){this.openings=e,this.closingSelector=r,this.contexts=[]}_next(t){const e=this.contexts.length;for(let r=0;r<e;r++);}_error(t){const e=this.contexts;for(;e.length>0;){const t=e.shift();t.buffer=null,t.subscription=null}this.contexts=null}_complete(){const t=this.contexts;for(;t.length>0;){const e=t.shift();e.buffer=null,e.subscription=null}this.contexts=null}notifyNext(t,e,r,n,i){}notifyComplete(t){}openBuffer(t){}closeBuffer(t){if(this.contexts&&t){const{buffer:e,subscription:r}=t}}trySubscribe(t){const e={buffer:[],subscription:new m},r=z(this,t,e);!r||r.closed||(r.context=e)}}function gT(t){return function(e){return e.lift(new yT(t))}}T.prototype.bufferToggle=function(t,e){return fT(t,e)(this)};class yT{constructor(t){this.closingSelector=t}call(t,e){return e.subscribe(new xT(t,this.closingSelector))}}class xT extends V{constructor(t,e){this.closingSelector=e,this.subscribing=!1}_next(t){}_complete(){}_unsubscribe(){this.buffer=null,this.subscribing=!1}notifyNext(t,e,r,n,i){}notifyComplete(){}openBuffer(){let{closingSubscription:t}=this;this.buffer=[],p(this.closingSelector)()===u||(this.closingSubscription=t=new m,this.subscribing=!0,this.subscribing=!1)}}function bT(t){return Ai(t)(this)}function wT(t){return e=>e.lift(new lS(t))}function _T(t,e){return Ri(()=>t,e)}function ST(t){return e=>e.lift(new TT(t,e))}T.prototype.bufferWhen=function(t){return gT(t)(this)},T.prototype.catch=bT,T.prototype._catch=bT,T.prototype.combineAll=function(t){return wT(t)(this)},T.prototype.combineLatest=function(...t){let e=null;return"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&l(t[0])&&(t=t[0].slice()),this.lift.call(Ii(this,...t),new lS(e))},T.prototype.concat=function(...t){return this.lift.call(uS(this,...t))},T.prototype.concatAll=function(){return ka()(this)},T.prototype.concatMap=function(t){return Ri(t)(this)},T.prototype.concatMapTo=function(t){return _T(t)(this)};class TT{constructor(t,e){this.predicate=t,this.source=e}call(t,e){return e.subscribe(new MT(t,this.predicate,this.source))}}class MT extends y{constructor(t,e,r){this.predicate=e,this.source=r,this.count=0,this.index=0}_next(t){this.predicate||this.count++}_tryPredicate(t){let e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return}e&&this.count++}_complete(){}}function AT(){return function(t){return t.lift(new ET)}}T.prototype.count=function(t){return ST(t)(this)};class ET{call(t,e){return e.subscribe(new CT(t))}}class CT extends y{constructor(t){}_next(t){}}function PT(t){return e=>e.lift(new OT(t))}T.prototype.dematerialize=function(){return AT()(this)};class OT{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new NT(t,this.durationSelector))}}class NT extends V{constructor(t,e){this.durationSelector=e,this.hasValue=!1,this.durationSubscription=null}_next(t){}_complete(){}_tryNext(t,e){let r=this.durationSubscription;this.value=t,this.hasValue=!0,(r=z(this,e))&&!r.closed&&(this.durationSubscription=r)}notifyNext(t,e,r,n,i){}notifyComplete(){}emitValue(){this.hasValue&&(this.durationSubscription&&(this.durationSubscription=null),this.value=null,this.hasValue=!1)}}function LT(t,e=yS){return r=>r.lift(new IT(t,e))}T.prototype.debounce=function(t){return PT(t)(this)};class IT{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new RT(t,this.dueTime,this.scheduler))}}class RT extends y{constructor(t,e,r){this.dueTime=e,this.scheduler=r,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.lastValue=t,this.hasValue=!0,this.debouncedSubscription=this.scheduler.schedule(DT,this.dueTime,this)}_complete(){}debouncedNext(){if(this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1}}clearDebounce(){null!==this.debouncedSubscription&&(this.debouncedSubscription=null)}}function DT(t){t.debouncedNext()}function FT(t){return t instanceof Date&&!isNaN(+t)}function UT(t,e=yS){const r=FT(t)?+t-e.now():Math.abs(t);return t=>t.lift(new kT(r,e))}T.prototype.debounceTime=function(t,e=yS){return LT(t,e)(this)},T.prototype.defaultIfEmpty=function(t=null){return Sa(t)(this)};class kT{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new BT(t,this.delay,this.scheduler))}}class BT extends y{constructor(t,e,r){this.delay=e,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,r=e.queue,n=t.scheduler;for(;r.length>0&&r[0].time-n.now()<=0;);r.length>0||(e.active=!1)}_schedule(t){this.active=!0}scheduleNotification(t){}_next(t){}_error(t){this.errored=!0,this.queue=[]}_complete(){}}function jT(t,e){return e?r=>new GT(r,e).lift(new zT(t)):e=>e.lift(new zT(t))}T.prototype.delay=function(t,e=yS){return UT(t,e)(this)};class zT{constructor(t){this.delayDurationSelector=t}call(t,e){return e.subscribe(new VT(t,this.delayDurationSelector))}}class VT extends V{constructor(t,e){this.delayDurationSelector=e,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}notifyNext(t,e,r,n,i){}notifyError(t,e){}notifyComplete(t){}_next(t){}_complete(){this.completed=!0}removeSubscription(t){const e=this.delayNotifierSubscriptions.indexOf(t);let r=null;return-1!==e&&(r=this.values[e]),r}tryDelay(t,e){}tryComplete(){}}class GT extends T{constructor(t,e){this.source=t,this.subscriptionDelay=e}_subscribe(t){}}function HT(t,e){return r=>r.lift(new WT(t,e))}T.prototype.delayWhen=function(t,e){return jT(t,e)(this)};class WT{constructor(t,e){this.keySelector=t,this.flushes=e}call(t,e){return e.subscribe(new XT(t,this.keySelector,this.flushes))}}class XT extends V{constructor(t,e,r){this.keySelector=e,this.values=new Set}notifyNext(t,e,r,n,i){}notifyError(t,e){}_next(t){}_useKeySelector(t){let e;const{destination:r}=this;try{e=this.keySelector(t)}catch(t){return}}_finalizeNext(t,e){const{values:r}=this}}function YT(t,e){return r=>r.lift(new qT(t,e))}T.prototype.distinct=function(t,e){return HT(t,e)(this)};class qT{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new JT(t,this.compare,this.keySelector))}}class JT extends y{constructor(t,e,r){this.keySelector=r,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e=t;if(this.keySelector&&(e=p(this.keySelector)(t))===u)return this.destination.error(u.e);let r=!1;if(this.hasKey){if((r=p(this.compare)(this.key,e))===u)return this.destination.error(u.e)}else this.hasKey=!0;!1===Boolean(r)&&(this.key=e)}}function ZT(t,e){return YT((r,n)=>e?e(r[t],n[t]):r[t]===n[t])}function QT(t,e,r){return xa(t,e,r)(this)}function KT(){return t=>t.lift(new $T)}T.prototype.distinctUntilChanged=function(t,e){return YT(t,e)(this)},T.prototype.distinctUntilKeyChanged=function(t,e){return ZT(t,e)(this)},T.prototype.do=QT,T.prototype._do=QT;class $T{call(t,e){return e.subscribe(new tM(t))}}class tM extends V{constructor(t){this.hasCompleted=!1,this.hasSubscription=!1}_next(t){this.hasSubscription||(this.hasSubscription=!0)}_complete(){this.hasCompleted=!0}notifyComplete(t){this.hasSubscription=!1}}function eM(t,e){return e?r=>r.pipe(eM((r,n)=>Y(t(r,n)).pipe(G((t,i)=>e(r,t,n,i))))):e=>e.lift(new rM(t))}T.prototype.exhaust=function(){return KT()(this)};class rM{constructor(t){this.project=t}call(t,e){return e.subscribe(new nM(t,this.project))}}class nM extends V{constructor(t,e){this.project=e,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}_next(t){}tryNext(t){this.index++;try{this.hasSubscription=!0}catch(t){}}_complete(){this.hasCompleted=!0}notifyNext(t,e,r,n,i){}notifyError(t){}notifyComplete(t){this.hasSubscription=!1}}function iM(t,e=Number.POSITIVE_INFINITY,r){return e=(e||0)<1?Number.POSITIVE_INFINITY:e,n=>n.lift(new oM(t,e,r))}T.prototype.exhaustMap=function(t){return eM(t)(this)};class oM{constructor(t,e,r){this.project=t,this.concurrent=e,this.scheduler=r}call(t,e){return e.subscribe(new aM(t,this.project,this.concurrent,this.scheduler))}}class aM extends V{constructor(t,e,r,n){this.project=e,this.concurrent=r,this.scheduler=n,this.index=0,this.active=0,this.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(this.buffer=[])}static dispatch(t){const{subscriber:e,result:r,value:n,index:i}=t}_next(t){this.destination.closed||this.index++}subscribeToProjection(t,e,r){this.active++}_complete(){this.hasCompleted=!0}notifyNext(t,e,r,n,i){}notifyComplete(t){this.active--}}function sM(t,e){if(t<0)throw new ma;const r=arguments.length>=2;return n=>n.pipe(Di((e,r)=>r===t),Ea(1),r?Sa(e):_a(()=>new ma))}function lM(t){return e=>e.lift(new cM(t))}T.prototype.expand=function(t,e=Number.POSITIVE_INFINITY,r){return iM(t,e=(e||0)<1?Number.POSITIVE_INFINITY:e,r)(this)},T.prototype.elementAt=function(t,e){return sM.apply(void 0,arguments)(this)},T.prototype.filter=function(t,e){return Di(t,e)(this)};class cM{constructor(t){this.callback=t}call(t,e){return e.subscribe(new uM(t,this.callback))}}class uM extends y{constructor(t,e){}}function hM(t){return lM(t)(this)}function dM(t,e){if("function"!=typeof t)throw new TypeError("predicate is not a function");return r=>r.lift(new pM(t,r,!1,e))}T.prototype.finally=hM,T.prototype._finally=hM;class pM{constructor(t,e,r,n){this.predicate=t,this.source=e,this.yieldIndex=r,this.thisArg=n}call(t,e){return e.subscribe(new fM(t,this.predicate,this.source,this.yieldIndex,this.thisArg))}}class fM extends y{constructor(t,e,r,n,i){this.predicate=e,this.source=r,this.yieldIndex=n,this.thisArg=i,this.index=0}notifyComplete(t){}_next(t){const{predicate:e,thisArg:r}=this;this.index++}_complete(){}}function mM(t,e){return r=>r.lift(new pM(t,r,!0,e))}function vM(t,e,r,n){return i=>i.lift(new gM(t,e,r,n))}T.prototype.find=function(t,e){return dM(t,e)(this)},T.prototype.findIndex=function(t,e){return mM(t,e)(this)},T.prototype.first=function(...t){return Oa(...t)(this)};class gM{constructor(t,e,r,n){this.keySelector=t,this.elementSelector=e,this.durationSelector=r,this.subjectSelector=n}call(t,e){return e.subscribe(new yM(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))}}class yM extends y{constructor(t,e,r,n,i){this.keySelector=e,this.elementSelector=r,this.durationSelector=n,this.subjectSelector=i,this.groups=null,this.attemptedToUnsubscribe=!1,this.count=0}_next(t){let e;try{e=this.keySelector(t)}catch(t){return}}_group(t,e){let r=this.groups;r||(r=this.groups=new Map);let n,i=r.get(e);if(this.elementSelector)try{n=this.elementSelector(t)}catch(t){}else n=t;if(!i&&(i=this.subjectSelector?this.subjectSelector():new P,this.durationSelector)){let t;try{t=this.durationSelector(new xM(e,i))}catch(t){return}}}_error(t){}_complete(){}removeGroup(t){}unsubscribe(){this.closed||(this.attemptedToUnsubscribe=!0)}}class xM extends T{constructor(t,e,r){this.key=t,this.groupSubject=e,this.refCountSubscription=r}_subscribe(t){const e=new m,{refCountSubscription:r,groupSubject:n}=this;return e}}function bM(){return function(t){return t.lift(new wM)}}T.prototype.groupBy=function(t,e,r,n){return vM(t,e,r,n)(this)};class wM{call(t,e){return e.subscribe(new _M(t))}}class _M extends y{_next(t){}}function SM(){return t=>t.lift(new TM)}T.prototype.ignoreElements=function(){return bM()(this)};class TM{call(t,e){return e.subscribe(new MM(t))}}class MM extends y{constructor(t){}notifyComplete(t){}_next(t){}_complete(){}}function AM(t){return function(e){return e.lift(new EM(t))}}T.prototype.isEmpty=function(){return SM()(this)};class EM{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new CM(t,this.durationSelector))}}class CM extends V{constructor(t,e){this.durationSelector=e,this.hasValue=!1}_next(t){if(this.value=t,this.hasValue=!0,!this.throttled){const e=p(this.durationSelector)(t);if(e===u);else{const t=z(this,e);!t||t.closed||(this.throttled=t)}}}clearThrottle(){const{value:t,hasValue:e,throttled:r}=this;r&&(this.throttled=null),e&&(this.value=null,this.hasValue=!1)}notifyNext(t,e,r,n){}notifyComplete(){}}function PM(t,e=yS){return AM(()=>ES(t,e))}function OM(t){return t(this)}function NM(t){return e=>e.lift(new LM(t))}T.prototype.audit=function(t){return AM(t)(this)},T.prototype.auditTime=function(t,e=yS){return PM(t,e)(this)},T.prototype.last=function(...t){return Aa(...t)(this)},T.prototype.let=OM,T.prototype.letBind=OM,T.prototype.every=function(t,e){return Na(t,e)(this)},T.prototype.map=function(t,e){return G(t,e)(this)};class LM{constructor(t){this.value=t}call(t,e){return e.subscribe(new IM(t,this.value))}}class IM extends y{constructor(t,e){this.value=e}_next(t){}}function RM(){return function(t){return t.lift(new DM)}}T.prototype.mapTo=function(t){return NM(t)(this)};class DM{call(t,e){return e.subscribe(new FM(t))}}class FM extends y{constructor(t){}_next(t){}_error(t){}_complete(){}}function UM(t){return Ua("function"==typeof t?(e,r)=>t(e,r)>0?e:r:(t,e)=>t>e?t:e)}function kM(t,e=Number.POSITIVE_INFINITY){return q(t,e)(this)}function BM(t,e,r=Number.POSITIVE_INFINITY){return"function"==typeof e?q(()=>t,e,r):("number"==typeof e&&(r=e),q(()=>t,r))}function jM(t,e=Number.POSITIVE_INFINITY){return BM(t,e)(this)}function zM(t,e,r=Number.POSITIVE_INFINITY){return n=>n.lift(new VM(t,e,r))}T.prototype.materialize=function(){return RM()(this)},T.prototype.max=function(t){return UM(t)(this)},T.prototype.merge=function(...t){return this.lift.call($(this,...t))},T.prototype.mergeAll=function(t=Number.POSITIVE_INFINITY){return K(t)(this)},T.prototype.mergeMap=kM,T.prototype.flatMap=kM,T.prototype.flatMapTo=jM,T.prototype.mergeMapTo=jM;class VM{constructor(t,e,r){this.accumulator=t,this.seed=e,this.concurrent=r}call(t,e){return e.subscribe(new GM(t,this.accumulator,this.seed,this.concurrent))}}class GM extends V{constructor(t,e,r,n){this.accumulator=e,this.acc=r,this.concurrent=n,this.hasValue=!1,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent&&(this.index++,p(this.accumulator)(this.acc,t)===u||this.active++)}_innerSub(t,e,r){}_complete(){this.hasCompleted=!0}notifyNext(t,e,r,n,i){const{destination:o}=this;this.acc=e,this.hasValue=!0}notifyComplete(t){this.active--}}function HM(t){return Ua("function"==typeof t?(e,r)=>t(e,r)<0?e:r:(t,e)=>t<e?t:e)}function WM(...t){return 1===t.length&&l(t[0])&&(t=t[0]),e=>e.lift(new XM(t))}T.prototype.mergeScan=function(t,e,r=Number.POSITIVE_INFINITY){return zM(t,e,r)(this)},T.prototype.min=function(t){return HM(t)(this)},T.prototype.multicast=function(t,e){return ot(t,e)(this)},T.prototype.observeOn=function(t,e=0){return JS(t,e)(this)};class XM{constructor(t){this.nextSources=t}call(t,e){return e.subscribe(new YM(t,this.nextSources))}}class YM extends V{constructor(t,e){this.destination=t,this.nextSources=e}notifyError(t,e){}notifyComplete(t){}_error(t){}_complete(){}subscribeToNextSource(){}}function qM(){return t=>t.lift(new JM)}T.prototype.onErrorResumeNext=function(...t){return WM(...t)(this)};class JM{call(t,e){return e.subscribe(new ZM(t))}}class ZM extends y{constructor(t){this.hasPrev=!1}_next(t){this.hasPrev||(this.hasPrev=!0),this.prev=t}}function QM(t,e){return r=>[Di(t,e)(r),Di(function(e,r){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=r,n}(0,e))(r)]}function KM(...t){const e=t.length;if(0===e)throw new Error("list of properties cannot be empty.");return r=>G(function(t,e){return r=>{let n=r;for(let i=0;i<e;i++){const e=n[t[i]];if(void 0===e)return;n=e}return n}}(t,e))(r)}function $M(t){return t?ot(()=>new P,t):ot(new P)}function tA(t){return e=>ot(new pa(t))(e)}function eA(t,e,r,n){r&&"function"!=typeof r&&(n=r);const i="function"==typeof r?r:void 0,o=new KS(t,e,n);return t=>ot(()=>o,i)(t)}function rA(){return t=>ot(new eS)(t)}function nA(...t){return function(e){return 1===t.length&&l(t[0])&&(t=t[0]),e.lift.call(wS(e,...t))}}function iA(t=-1){return e=>0===t?Ni():e.lift(new oA(t<0?-1:t-1,e))}T.prototype.pairwise=function(){return qM()(this)},T.prototype.partition=function(t,e){return QM(t,e)(this)},T.prototype.pluck=function(...t){return KM(...t)(this)},T.prototype.publish=function(t){return $M(t)(this)},T.prototype.publishBehavior=function(t){return tA(t)(this)},T.prototype.publishReplay=function(t,e,r,n){return eA(t,e,r,n)(this)},T.prototype.publishLast=function(){return rA()(this)},T.prototype.race=function(...t){return nA(...t)(this)},T.prototype.reduce=function(t,e){return arguments.length>=2?Ua(t,e)(this):Ua(t)(this)};class oA{constructor(t,e){this.count=t,this.source=e}call(t,e){return e.subscribe(new aA(t,this.count,this.source))}}class aA extends y{constructor(t,e,r){this.count=e,this.source=r}complete(){if(!this.isStopped){const{source:t,count:e}=this;if(0===e)return super.complete();e>-1&&(this.count=e-1)}}}function sA(t){return e=>e.lift(new lA(t))}T.prototype.repeat=function(t=-1){return iA(t)(this)};class lA{constructor(t){this.notifier=t}call(t,e){return e.subscribe(new cA(t,this.notifier,e))}}class cA extends V{constructor(t,e,r){this.notifier=e,this.source=r,this.sourceIsBeingSubscribedTo=!0}notifyNext(t,e,r,n,i){this.sourceIsBeingSubscribedTo=!0}notifyComplete(t){if(!1===this.sourceIsBeingSubscribedTo)return super.complete()}complete(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped&&(!this.retriesSubscription||this.retriesSubscription.closed))return super.complete()}_unsubscribe(){const{notifications:t,retriesSubscription:e}=this;t&&(this.notifications=null),e&&(this.retriesSubscription=null),this.retries=null}_unsubscribeAndRecycle(){const{_unsubscribe:t}=this;return this._unsubscribe=null,this._unsubscribe=t,this}subscribeToRetries(){this.notifications=new P;const t=p(this.notifier)(this.notifications);if(t===u)return super.complete();this.retries=t,this.retriesSubscription=z(this,t)}}function uA(t=-1){return e=>e.lift(new hA(t,e))}T.prototype.repeatWhen=function(t){return sA(t)(this)};class hA{constructor(t,e){this.count=t,this.source=e}call(t,e){return e.subscribe(new dA(t,this.count,this.source))}}class dA extends y{constructor(t,e,r){this.count=e,this.source=r}error(t){if(!this.isStopped){const{source:e,count:r}=this;if(0===r)return super.error(t);r>-1&&(this.count=r-1)}}}function pA(t){return e=>e.lift(new fA(t,e))}T.prototype.retry=function(t=-1){return uA(t)(this)};class fA{constructor(t,e){this.notifier=t,this.source=e}call(t,e){return e.subscribe(new mA(t,this.notifier,this.source))}}class mA extends V{constructor(t,e,r){this.notifier=e,this.source=r}error(t){if(!this.isStopped){let t=this.errors,e=this.retries,r=this.retriesSubscription;if(e)this.errors=null,this.retriesSubscription=null;else{if(t=new P,(e=p(this.notifier)(t))===u)return super.error(u.e);r=z(this,e)}this.errors=t,this.retries=e,this.retriesSubscription=r}}_unsubscribe(){const{errors:t,retriesSubscription:e}=this;t&&(this.errors=null),e&&(this.retriesSubscription=null),this.retries=null}notifyNext(t,e,r,n,i){const{_unsubscribe:o}=this;this._unsubscribe=null,this._unsubscribe=o}}function vA(t){return e=>e.lift(new gA(t))}T.prototype.retryWhen=function(t){return pA(t)(this)};class gA{constructor(t){this.notifier=t}call(t,e){return e.subscribe(new yA(t))}}class yA extends V{constructor(){this.hasValue=!1}_next(t){this.value=t,this.hasValue=!0}notifyNext(t,e,r,n,i){}notifyComplete(){}emitValue(){this.hasValue&&(this.hasValue=!1)}}function xA(t,e=yS){return r=>r.lift(new bA(t,e))}T.prototype.sample=function(t){return vA(t)(this)};class bA{constructor(t,e){this.period=t,this.scheduler=e}call(t,e){return e.subscribe(new wA(t,this.period,this.scheduler))}}class wA extends y{constructor(t,e,r){this.period=e,this.scheduler=r,this.hasValue=!1}_next(t){this.lastValue=t,this.hasValue=!0}notifyNext(){this.hasValue&&(this.hasValue=!1)}}function _A(t,e){return r=>r.lift(new SA(t,e))}T.prototype.sampleTime=function(t,e=yS){return xA(t,e)(this)},T.prototype.scan=function(t,e){return arguments.length>=2?Ra(t,e)(this):Ra(t)(this)};class SA{constructor(t,e){this.compareTo=t,this.comparor=e}call(t,e){return e.subscribe(new TA(t,this.compareTo,this.comparor))}}class TA extends y{constructor(t,e,r){this.compareTo=e,this.comparor=r,this._a=[],this._b=[],this._oneComplete=!1}_next(t){}_complete(){this._oneComplete||(this._oneComplete=!0)}checkValues(){const{_a:t,_b:e,comparor:r}=this;for(;t.length>0&&e.length>0;){let n=t.shift(),i=e.shift(),o=!1;o=r?p(r)(n,i):n===i}}emit(t){const{destination:e}=this}nextB(t){}}function MA(t,e,r){return n=>n.lift(function(t,e,r){let n,i,o=0,a=!1,s=!1;return function(l){o++,n&&!a||(a=!1,n=new KS(t,e,r),i=l.subscribe({next(t){n.next(t)},error(t){a=!0,n.error(t)},complete(){s=!0,n.complete()}}));const c=n.subscribe(this);return()=>{o--,c.unsubscribe(),i&&0===o&&s&&i.unsubscribe()}}}(t,e,r))}function AA(t){return e=>e.lift(new EA(t,e))}T.prototype.sequenceEqual=function(t,e){return _A(t,e)(this)},T.prototype.share=function(){return lt()(this)},T.prototype.shareReplay=function(t,e,r){return MA(t,e,r)(this)};class EA{constructor(t,e){this.predicate=t,this.source=e}call(t,e){return e.subscribe(new CA(t,this.predicate,this.source))}}class CA extends y{constructor(t,e,r){this.predicate=e,this.source=r,this.seenValue=!1,this.index=0}applySingleValue(t){this.seenValue||(this.seenValue=!0,this.singleValue=t)}_next(t){this.index++}tryNext(t,e){try{this.predicate(t,e,this.source)}catch(t){}}_complete(){}}function PA(t){return e=>e.lift(new OA(t))}T.prototype.single=function(t){return AA(t)(this)};class OA{constructor(t){this.total=t}call(t,e){return e.subscribe(new NA(t,this.total))}}class NA extends y{constructor(t,e){this.total=e,this.count=0}_next(t){++this.count}}function LA(t){return e=>e.lift(new IA(t))}T.prototype.skip=function(t){return PA(t)(this)};class IA{constructor(t){if(this._skipCount=t,this._skipCount<0)throw new ma}call(t,e){return e.subscribe(0===this._skipCount?new y(t):new RA(t,this._skipCount))}}class RA extends y{constructor(t,e){this._skipCount=e,this._count=0,this._ring=new Array(e)}_next(t){const e=this._skipCount,r=this._count++;r<e?this._ring[r]=t:this._ring[r%e]=t}}function DA(t){return e=>e.lift(new FA(t))}T.prototype.skipLast=function(t){return LA(t)(this)};class FA{constructor(t){this.notifier=t}call(t,e){return e.subscribe(new UA(t,this.notifier))}}class UA extends V{constructor(t,e){this.hasValue=!1,this.innerSubscription=z(this,e)}_next(t){}notifyNext(t,e,r,n,i){this.hasValue=!0}notifyComplete(){}}function kA(t){return e=>e.lift(new BA(t))}T.prototype.skipUntil=function(t){return DA(t)(this)};class BA{constructor(t){this.predicate=t}call(t,e){return e.subscribe(new jA(t,this.predicate))}}class jA extends y{constructor(t,e){this.predicate=e,this.skipping=!0,this.index=0}_next(t){}tryCallPredicate(t){try{const e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){}}}function zA(...t){return e=>{let r=t[t.length-1];N(r)?t.pop():r=null;const n=t.length;return uS(1!==n||r?n>0?X(t,r):Ni(r):Li(t[0]),e)}}T.prototype.skipWhile=function(t){return kA(t)(this)},T.prototype.startWith=function(...t){return zA(...t)(this)};let VA=1;const GA={},HA={setImmediate(t){const e=VA++;return GA[e]=t,e},clearImmediate(t){delete GA[t]}},WA=new class extends gS{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let r,n=-1,i=e.length;t=t||e.shift();do{if(r=t.execute(t.state,t.delay))break}while(++n<i&&(t=e.shift()));if(this.active=!1,r){for(;++n<i&&(t=e.shift()););throw r}}}(class extends mS{constructor(t,e){this.scheduler=t,this.work=e}requestAsyncId(t,e,r=0){return null!==r&&r>0?super.requestAsyncId(t,e,r):t.scheduled||(t.scheduled=HA.setImmediate(t.flush.bind(t,null)))}recycleAsyncId(t,e,r=0){if(null!==r&&r>0||null===r&&this.delay>0)return super.recycleAsyncId(t,e,r);0===t.actions.length&&(t.scheduled=void 0)}});class XA extends T{constructor(t,e=0,r=WA){this.source=t,this.delayTime=e,this.scheduler=r,(!xS(e)||e<0)&&(this.delayTime=0),r&&"function"==typeof r.schedule||(this.scheduler=WA)}static create(t,e=0,r=WA){return new XA(t,e,r)}static dispatch(t){const{source:e,subscriber:r}=t;return this.add(e.subscribe(r))}_subscribe(t){return this.scheduler.schedule(XA.dispatch,this.delayTime,{source:this.source,subscriber:t})}}function YA(t,e=0){return function(r){return r.lift(new qA(t,e))}}class qA{constructor(t,e){this.scheduler=t,this.delay=e}call(t,e){return new XA(e,this.delay,this.scheduler).subscribe(t)}}function JA(t,e){return"function"==typeof e?r=>r.pipe(JA((r,n)=>Y(t(r,n)).pipe(G((t,i)=>e(r,t,n,i))))):e=>e.lift(new ZA(t))}T.prototype.subscribeOn=function(t,e=0){return YA(t,e)(this)};class ZA{constructor(t){this.project=t}call(t,e){return e.subscribe(new QA(t,this.project))}}class QA extends V{constructor(t,e){this.project=e,this.index=0}_next(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(t){return}}_innerSub(t,e,r){this.innerSubscription=z(this,t,e,r)}_complete(){const{innerSubscription:t}=this}_unsubscribe(){this.innerSubscription=null}notifyComplete(t){this.innerSubscription=null}notifyNext(t,e,r,n,i){}}function KA(){return JA(Q)}function $A(){return KA()(this)}function tE(t,e){return e?JA(()=>t,e):JA(()=>t)}function eE(t){return e=>e.lift(new rE(t))}T.prototype.switch=$A,T.prototype._switch=$A,T.prototype.switchMap=function(t){return JA(t)(this)},T.prototype.switchMapTo=function(t){return tE(t)(this)},T.prototype.take=function(t){return Ea(t)(this)},T.prototype.takeLast=function(t){return va(t)(this)};class rE{constructor(t){this.notifier=t}call(t,e){const r=new nE(t),n=z(r,this.notifier);return n&&!n.closed?e.subscribe(r):r}}class nE extends V{constructor(t){}notifyNext(t,e,r,n,i){}notifyComplete(){}}function iE(t){return e=>e.lift(new oE(t))}T.prototype.takeUntil=function(t){return eE(t)(this)};class oE{constructor(t){this.predicate=t}call(t,e){return e.subscribe(new aE(t,this.predicate))}}class aE extends y{constructor(t,e){this.predicate=e,this.index=0}_next(t){let e;try{e=this.predicate(t,this.index++)}catch(t){return}}nextOrComplete(t,e){Boolean(e)}}T.prototype.takeWhile=function(t){return iE(t)(this)};const sE={leading:!0,trailing:!1};function lE(t,e=sE){return r=>r.lift(new cE(t,e.leading,e.trailing))}class cE{constructor(t,e,r){this.durationSelector=t,this.leading=e,this.trailing=r}call(t,e){return e.subscribe(new uE(t,this.durationSelector,this.leading,this.trailing))}}class uE extends V{constructor(t,e,r,n){this.destination=t,this.durationSelector=e,this._leading=r,this._trailing=n,this._hasValue=!1}_next(t){this._hasValue=!0,this._sendValue=t}send(){const{_hasValue:t,_sendValue:e}=this;this._hasValue=!1,this._sendValue=null}throttle(t){const e=this.tryDurationSelector(t);e&&(this._throttled=z(this,e))}tryDurationSelector(t){try{return this.durationSelector(t)}catch(t){return null}}throttlingDone(){const{_throttled:t,_trailing:e}=this;this._throttled=null}notifyNext(t,e,r,n,i){}notifyComplete(){}}function hE(t,e=yS,r=sE){return n=>n.lift(new dE(t,e,r.leading,r.trailing))}T.prototype.throttle=function(t,e=sE){return lE(t,e)(this)};class dE{constructor(t,e,r,n){this.duration=t,this.scheduler=e,this.leading=r,this.trailing=n}call(t,e){return e.subscribe(new pE(t,this.duration,this.scheduler,this.leading,this.trailing))}}class pE extends y{constructor(t,e,r,n,i){this.duration=e,this.scheduler=r,this.leading=n,this.trailing=i,this._hasTrailingValue=!1,this._trailingValue=null}_next(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):this.throttled=this.scheduler.schedule(fE,this.duration,{subscriber:this})}_complete(){}clearThrottle(){this.throttled&&(this.trailing&&this._hasTrailingValue&&(this._trailingValue=null,this._hasTrailingValue=!1),this.throttled=null)}}function fE(t){const{subscriber:e}=t;e.clearThrottle()}function mE(t=yS){return e=>hS(()=>e.pipe(Ra(({current:e},r)=>({value:r,current:t.now(),last:e}),{current:t.now(),value:void 0,last:void 0}),G(({current:t,last:e,value:r})=>new vE(r,t-e))))}T.prototype.throttleTime=function(t,e=yS,r=sE){return hE(t,e,r)(this)};class vE{constructor(t,e){this.value=t,this.interval=e}}T.prototype.timeInterval=function(t=yS){return mE(t)(this)};class gE extends Error{constructor(){}}function yE(t,e,r=yS){return n=>{let i=FT(t),o=i?+t-r.now():Math.abs(t);return n.lift(new xE(o,i,e,r))}}class xE{constructor(t,e,r,n){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=r,this.scheduler=n}call(t,e){return e.subscribe(new bE(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}class bE extends V{constructor(t,e,r,n,i){this.absoluteTimeout=e,this.waitFor=r,this.withObservable=n,this.scheduler=i,this.action=null}static dispatchTimeout(t){const{withObservable:e}=t}scheduleTimeout(){const{action:t}=this;this.action=t?t.schedule(this,this.waitFor):this.scheduler.schedule(bE.dispatchTimeout,this.waitFor,this)}_next(t){}_unsubscribe(){this.action=null,this.scheduler=null,this.withObservable=null}}function wE(t,e=yS){return yE(t,Ti(new gE),e)}function _E(t=yS){return G(e=>new SE(e,t.now()))}T.prototype.timeout=function(t,e=yS){return wE(t,e)(this)},T.prototype.timeoutWith=function(t,e,r=yS){return yE(t,e,r)(this)};class SE{constructor(t,e){this.value=t,this.timestamp=e}}function TE(t,e,r){return 0===r?[e]:(t.push(e),t)}function ME(){return Ua(TE,[])}function AE(t){return function(e){return e.lift(new EE(t))}}T.prototype.timestamp=function(t=yS){return _E(t)(this)},T.prototype.toArray=function(){return ME()(this)},r("XypG");class EE{constructor(t){this.windowBoundaries=t}call(t,e){return e.subscribe(new CE(t))}}class CE extends V{constructor(t){this.window=new P}notifyNext(t,e,r,n,i){}notifyError(t,e){}notifyComplete(t){}_next(t){}_error(t){}_complete(){}_unsubscribe(){this.window=null}openWindow(){this.window=new P}}function PE(t,e=0){return function(r){return r.lift(new OE(t,e))}}T.prototype.window=function(t){return AE(t)(this)};class OE{constructor(t,e){this.windowSize=t,this.startWindowEvery=e}call(t,e){return e.subscribe(new NE(t,this.windowSize,this.startWindowEvery))}}class NE extends y{constructor(t,e,r){this.destination=t,this.windowSize=e,this.startWindowEvery=r,this.windows=[new P],this.count=0}_next(t){const e=this.windows.length;for(let r=0;r<e&&!this.closed;r++);++this.count}_error(t){const e=this.windows;if(e)for(;e.length>0&&!this.closed;);}_complete(){const t=this.windows;if(t)for(;t.length>0&&!this.closed;);}_unsubscribe(){this.count=0,this.windows=null}}function LE(t){let e=yS,r=null,n=Number.POSITIVE_INFINITY;return N(arguments[3])&&(e=arguments[3]),N(arguments[2])?e=arguments[2]:xS(arguments[2])&&(n=arguments[2]),N(arguments[1])?e=arguments[1]:xS(arguments[1])&&(r=arguments[1]),function(i){return i.lift(new IE(t,r,n,e))}}T.prototype.windowCount=function(t,e=0){return PE(t,e)(this)};class IE{constructor(t,e,r,n){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=r,this.scheduler=n}call(t,e){return e.subscribe(new DE(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))}}class RE extends P{constructor(){this._numberOfNextedValues=0}next(t){this._numberOfNextedValues++}get numberOfNextedValues(){return this._numberOfNextedValues}}class DE extends y{constructor(t,e,r,n,i){this.destination=t,this.windowTimeSpan=e,this.windowCreationInterval=r,this.maxWindowSize=n,this.scheduler=i,this.windows=[]}_next(t){const e=this.windows.length;for(let r=0;r<e;r++);}_error(t){const e=this.windows;for(;e.length>0;);}_complete(){const t=this.windows;for(;t.length>0;);}openWindow(){return new RE}closeWindow(t){}}function FE(t,e){return r=>r.lift(new UE(t,e))}T.prototype.windowTime=function(t){let e=yS,r=null,n=Number.POSITIVE_INFINITY;return N(arguments[3])&&(e=arguments[3]),N(arguments[2])?e=arguments[2]:xS(arguments[2])&&(n=arguments[2]),N(arguments[1])?e=arguments[1]:xS(arguments[1])&&(r=arguments[1]),LE(t,r,n,e)(this)};class UE{constructor(t,e){this.openings=t,this.closingSelector=e}call(t,e){return e.subscribe(new kE(t,this.openings,this.closingSelector))}}class kE extends V{constructor(t,e,r){this.openings=e,this.closingSelector=r,this.contexts=[],this.openSubscription=z(this,e,e)}_next(t){const{contexts:e}=this;if(e){const t=e.length;for(let e=0;e<t;e++);}}_error(t){const{contexts:e}=this;if(this.contexts=null,e){const t=e.length;let r=-1;for(;++r<t;);}}_complete(){const{contexts:t}=this;if(this.contexts=null,t){const e=t.length;let r=-1;for(;++r<e;);}}_unsubscribe(){const{contexts:t}=this;if(this.contexts=null,t){const e=t.length;let r=-1;for(;++r<e;);}}notifyNext(t,e,r,n,i){if(t===this.openings){const{closingSelector:t}=this,r=p(t)(e);if(r===u)return this.error(u.e);{const t={window:new P,subscription:new m},e=z(this,r,t);e.closed||(e.context=t)}}}notifyError(t){}notifyComplete(t){}closeWindow(t){if(-1===t)return;const{contexts:e}=this,r=e[t],{window:n,subscription:i}=r}}function BE(t){return function(e){return e.lift(new jE(t))}}T.prototype.windowToggle=function(t,e){return FE(t,e)(this)};class jE{constructor(t){this.closingSelector=t}call(t,e){return e.subscribe(new zE(t,this.closingSelector))}}class zE extends V{constructor(t,e){this.destination=t,this.closingSelector=e}notifyNext(t,e,r,n,i){}notifyError(t,e){}notifyComplete(t){}_next(t){}_error(t){}_complete(){}unsubscribeClosingNotification(){}openWindow(t=null){this.window=new P;const e=p(this.closingSelector)();e===u||(this.closingNotification=z(this,e))}}function VE(...t){return e=>{let r;return"function"==typeof t[t.length-1]&&(r=t.pop()),e.lift(new GE(t,r))}}T.prototype.windowWhen=function(t){return BE(t)(this)};class GE{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new HE(t,this.observables,this.project))}}class HE extends V{constructor(t,e,r){this.observables=e,this.project=r,this.toRespond=[];const n=e.length;this.values=new Array(n);for(let i=0;i<n;i++);for(let i=0;i<n;i++);}notifyNext(t,e,r,n,i){this.values[r]=e}notifyComplete(){}_next(t){}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(t){return}}}function WE(t){return e=>e.lift(new OS(t))}function XE(...t){let e=null;return"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&l(t[0])&&(t=t[0].slice()),r=>r.lift.call(Y([r,...t]),new lS(e))}function YE(...t){return e=>e.lift.call(uS(e,...t))}function qE(...t){return e=>e.lift.call($(e,...t))}function JE(...t){return function(e){return e.lift.call(PS(e,...t))}}function ZE(t){return class extends t{constructor(...t){super(...t),this.displayListValid=!1,this._unscaledWidth=0,this._unscaledHeight=0}getUnscaledWidth(){return this._unscaledWidth}setUnscaledWidth(t){this._unscaledWidth!==t&&(this._unscaledWidth=t,this.invalidateDisplayList())}getUnscaledHeight(){return this._unscaledHeight}setUnscaledHeight(t){this._unscaledHeight!==t&&(this._unscaledHeight=t,this.invalidateDisplayList())}getSmallSide(){return Math.min(this.getUnscaledWidth(),this.getUnscaledHeight())}invalidateDisplayList(){this.displayListValid=!1}validateDisplayList(){return!this.displayListValid&&(this.updateDisplayList(),this.displayListValid=!0,!0)}updateDisplayList(){}on(t,e,r){return super.on(t,e,r)}off(t,e,r){return super.off(t,e,r)}set x(t){super.x!==t&&(super.x=t,this.emit("moved"))}set y(t){super.y!==t&&(super.y=t,this.emit("moved"))}set rotation(t){super.rotation!==t&&(super.rotation=t,this.emit("rotated"))}}}T.prototype.withLatestFrom=function(...t){return VE(...t)(this)},T.prototype.zip=function(...t){return this.lift.call(PS(this,...t))},T.prototype.zipAll=function(t){return WE(t)(this)};const QE=ZE(PIXI.Container);class KE extends QE{constructor(){super()}validateDisplayList(){if(!this.children||0===this.children.length)return!1;let t=super.validateDisplayList();for(const e of this.children)t=e.validateDisplayList()||t;return t}updateDisplayList(){}addChild(t){const e=super.addChild(t);return this.onChildAdded(e),e}addChildAt(t,e){const r=super.addChildAt(t,e);return this.onChildAdded(r),r}removeChild(t){const e=super.removeChild(t);return this.onChildRemoved(e),e}removeChildAt(t){const e=super.removeChildAt(t);return this.onChildRemoved(e),e}removeChildren(t,e){const r=super.removeChildren(t,e);return r.forEach(t=>this.onChildRemoved(t)),r}onChildAdded(t){t.on("moved",this.invalidateDisplayList,this),t.on("rotated",this.invalidateDisplayList,this)}onChildRemoved(t){t.off("moved",this.invalidateDisplayList,this),t.off("rotated",this.invalidateDisplayList,this)}}const $E=ZE(PIXI.Graphics);class tC extends $E{}var eC=PIXI.Point;class rC extends tC{set mapData(t){this._mapData=t,this.invalidateDisplayList()}set scalingSquare(t){this._scalingSquare=t,this.invalidateDisplayList()}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(8,16777215);const t=this._mapData.roadSpline.points.map(t=>new eC((t.x-this._scalingSquare.x)*this.getUnscaledWidth()/this._scalingSquare.width,(this._scalingSquare.y-t.y)*this.getUnscaledHeight()/this._scalingSquare.height+this.getUnscaledHeight()));t.push(t[0]),this.drawPolygon(t);const e=(ru.getAngleBetweenPoints(t[0],t[1])+ru.getAngleBetweenPoints(t[t.length-2],t[0]))/2;this.lineStyle(4,16777215),this.moveTo(t[0].x+16*Math.cos(e+Math.PI/2),t[0].y+16*Math.sin(e+Math.PI/2)),this.lineTo(t[0].x-16*Math.cos(e+Math.PI/2),t[0].y-16*Math.sin(e+Math.PI/2))}}class nC extends tC{updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(2,16777215),this.beginFill(0,.3),this.drawRect(0,0,this.getUnscaledWidth(),this.getUnscaledHeight()),this.endFill()}}class iC extends tC{set color(t){this._color!==t&&(this._color=t,this.invalidateDisplayList())}set size(t){this._size!==t&&(this._size=t,this.invalidateDisplayList())}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(1,0),this.beginFill(this._color),this.drawCircle(0,0,this._size),this.endFill()}}var oC=PIXI.Rectangle,aC=PIXI.Point;class sC extends KE{constructor(t){super(),this.cars=[],this.carListeners=new Map,this.mapData=t,this.background=new nC,this.background.setUnscaledWidth(this.getUnscaledWidth()),this.background.setUnscaledHeight(this.getUnscaledHeight()),this.addChild(this.background),this.calculateScalingSquare(),this.trackSpline=new rC,this.trackSpline.setUnscaledWidth(this.getUnscaledWidth()),this.trackSpline.setUnscaledHeight(this.getUnscaledHeight()),this.trackSpline.mapData=this.mapData,this.trackSpline.scalingSquare=this.scalingSquare,this.addChild(this.trackSpline)}setUnscaledWidth(t){super.setUnscaledWidth(t),this.background.setUnscaledWidth(t),this.trackSpline.setUnscaledWidth(t)}setUnscaledHeight(t){super.setUnscaledHeight(t),this.background.setUnscaledHeight(t),this.trackSpline.setUnscaledHeight(t)}calculateScalingSquare(){const t=new aC(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),e=new aC(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);this.mapData.roadSpline.points.forEach(r=>{t.x=Math.min(t.x,r.x),t.y=Math.min(t.y,r.y),e.x=Math.max(e.x,r.x),e.y=Math.max(e.y,r.y)});const r=new aC(e.x-t.x,e.y-t.y);this.scalingSquare=new oC(t.x-.1*r.x,t.y-.1*r.y,1.2*r.x,1.2*r.y),this.scalingSquare.width/this.scalingSquare.height>1?(this.scalingSquare.y-=(this.scalingSquare.width-this.scalingSquare.height)/2,this.scalingSquare.height+=this.scalingSquare.width-this.scalingSquare.height):(this.scalingSquare.x-=(this.scalingSquare.height-this.scalingSquare.width)/2,this.scalingSquare.width+=this.scalingSquare.height-this.scalingSquare.width)}addCar(t,e=!1){const r=new iC;r.color=sC.CAR_COLORS[Math.floor(Math.random()*sC.CAR_COLORS.length)],r.size=e?8:5;const n=t.getPosition();r.x=(n.x-this.scalingSquare.x)*this.getUnscaledWidth()/this.scalingSquare.width,r.y=(this.scalingSquare.y-n.y)*this.getUnscaledHeight()/this.scalingSquare.height+this.getUnscaledHeight(),this.addChild(r);const i=t.positionChangedSubject.subscribe(t=>{r.x=(t.x-this.scalingSquare.x)*this.getUnscaledWidth()/this.scalingSquare.width,r.y=(this.scalingSquare.y-t.y)*this.getUnscaledHeight()/this.scalingSquare.height+this.getUnscaledHeight()});this.cars.push(t),this.carListeners.set(t.id,{indicator:r,positionChangedSub:i})}dispose(){for(const t of this.cars)this.removeChild(this.carListeners.get(t.id).indicator),this.carListeners.get(t.id).positionChangedSub.unsubscribe(),this.carListeners.delete(t.id);this.cars=[]}}sC.CAR_COLORS=[4357620,12465647,14679099,14679099,14679099,49775,16583698,8375620];class lC extends tC{updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(2,16777215),this.beginFill(0,.3),this.drawCircle(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,this.getSmallSide()/2),this.endFill()}}var cC=PIXI.Text;class uC extends tC{constructor(t=320){super(),this.startAngle=3*Math.PI/4,this.endAngle=9*Math.PI/4,this.maxSpeed=t}get maxSpeed(){return this._maxSpeed}set maxSpeed(t){t=20*Math.ceil(t/20),this._maxSpeed!==t&&(this._maxSpeed=t,this._divisionsCount=t/20+1,this.updateChildren(),this.invalidateDisplayList())}set currentSpeed(t){t=Math.min(this.maxSpeed,t),this._currentSpeed!==t&&(this._currentSpeed=t,this.invalidateDisplayList())}setUnscaledWidth(t){super.setUnscaledWidth(t),this.updateChildren()}setUnscaledHeight(t){super.setUnscaledHeight(t),this.updateChildren()}updateChildren(){this.removeChildren();for(let t=0;t<this._divisionsCount;t++){const e=this.startAngle+t*(this.endAngle-this.startAngle)/(this._divisionsCount-1),r=20*t,n=new nu(.875*this.getSmallSide()/2,e).cartesianPoint,i=new cC(r.toString(),{fontFamily:"Lucida Console",fontSize:18,fontWeight:"bold",fill:r<=this._currentSpeed?uC.CURRENT_SPEED_COLOR:16777215,align:"center"});i.anchor.x=i.anchor.y=.5,i.x=n.x+this.getUnscaledWidth()/2,i.y=n.y+this.getUnscaledHeight()/2,this.addChild(i)}}updateDisplayList(){super.updateDisplayList();const t=this.startAngle+this._currentSpeed/this.maxSpeed*(this.endAngle-this.startAngle);this.clear(),this.lineStyle(2,uC.CURRENT_SPEED_COLOR),this.arc(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,.65*this.getSmallSide()/2,this.startAngle,t),this.lineStyle(2,16777215),this.arc(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,.65*this.getSmallSide()/2,t,this.endAngle);for(let e=0;e<=4*(this._divisionsCount-1);e++){const r=e%4==0,n=e%2==0,i=this.startAngle+e*(this.endAngle-this.startAngle)/(this._divisionsCount-1)/4,o=new nu(.65*this.getSmallSide()/2,i).cartesianPoint,a=new nu((r?.75:n?.72:.69)*this.getSmallSide()/2,i).cartesianPoint;this.lineStyle(2,i>t?16777215:uC.CURRENT_SPEED_COLOR),this.moveTo(o.x+this.getUnscaledWidth()/2,o.y+this.getUnscaledHeight()/2),this.lineTo(a.x+this.getUnscaledWidth()/2,a.y+this.getUnscaledHeight()/2)}for(let e of this.children)e.style.fill=+e.text<=this._currentSpeed?uC.CURRENT_SPEED_COLOR:16777215}}uC.CURRENT_SPEED_COLOR=16738137;var hC=PIXI.Point;class dC extends tC{constructor(t=320){super(),this.startAngle=3*Math.PI/4,this.endAngle=9*Math.PI/4,this.maxSpeed=t}get maxSpeed(){return this._maxSpeed}set maxSpeed(t){t=20*Math.ceil(t/20),this._maxSpeed!==t&&(this._maxSpeed=t,this.rotation=this.startAngle+this._currentSpeed/this.maxSpeed*(this.endAngle-this.startAngle))}set currentSpeed(t){t=Math.min(1.05*this.maxSpeed,t),this._currentSpeed!==t&&(this._currentSpeed=t,this.rotation=this.startAngle+this._currentSpeed/this.maxSpeed*(this.endAngle-this.startAngle))}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(1,3355443),this.beginFill(4357620,1),this.drawPolygon([new hC(-.05*this.getSmallSide(),0),new hC(0,.02*this.getSmallSide()),new hC(.35*this.getSmallSide(),.005*this.getSmallSide()),new hC(.4*this.getSmallSide(),0),new hC(.35*this.getSmallSide(),-.005*this.getSmallSide()),new hC(0,-.02*this.getSmallSide()),new hC(-.05*this.getSmallSide(),0)]),this.endFill()}}class pC extends KE{get selectionSpeed(){return this._selectionSpeed}set selectionSpeed(t){this._selectionSpeed!==t&&(this._selectionSpeed=t,t>=0?(this.selectionArrow.currentSpeed=3.6*t,this.selectionArrow.visible=!0):this.selectionArrow.visible=!1,this.invalidateDisplayList())}setUnscaledWidth(t){super.setUnscaledWidth(t),this.background.setUnscaledWidth(t),this.dials.setUnscaledWidth(t),this.arrow.setUnscaledWidth(t),this.selectionArrow.setUnscaledWidth(t),this.arrow.x=t/2,this.selectionArrow.x=t/2}setUnscaledHeight(t){super.setUnscaledHeight(t),this.background.setUnscaledHeight(t),this.dials.setUnscaledHeight(t),this.arrow.setUnscaledHeight(t),this.selectionArrow.setUnscaledHeight(t),this.arrow.y=t/2,this.selectionArrow.y=t/2}constructor(t){super(),this.car=t,this.background=new lC,this.background.setUnscaledWidth(this.getUnscaledWidth()),this.background.setUnscaledHeight(this.getUnscaledHeight()),this.addChild(this.background),this.dials=new uC,this.dials.setUnscaledWidth(this.getUnscaledWidth()),this.dials.setUnscaledHeight(this.getUnscaledHeight()),this.dials.currentSpeed=3.6*t.speed,this.addChild(this.dials),this.arrow=new dC,this.arrow.setUnscaledWidth(this.getUnscaledWidth()),this.arrow.setUnscaledHeight(this.getUnscaledHeight()),this.arrow.currentSpeed=3.6*t.speed,this.arrow.x=this.getUnscaledWidth()/2,this.arrow.y=this.getUnscaledHeight()/2,this.addChild(this.arrow),this.selectionArrow=new dC,this.selectionArrow.setUnscaledWidth(this.getUnscaledWidth()),this.selectionArrow.setUnscaledHeight(this.getUnscaledHeight()),this.selectionArrow.x=this.getUnscaledWidth()/2,this.selectionArrow.y=this.getUnscaledHeight()/2,this.selectionArrow.alpha=.7,this.addChild(this.selectionArrow),t.speedChangedSubject.subscribe(t=>{this.dials.currentSpeed=3.6*t,this.arrow.currentSpeed=3.6*t})}}class fC{constructor(t){this.controlService=t}addCar(t){this.cars.push(t),this.miniMap.addCar(t)}initHud(t,e,r){this.renderer=Kc.autoDetectRenderer(window.innerWidth,window.innerHeight,{antialias:!0,resolution:1,transparent:!0}),this.canvasWidth=window.innerWidth,this.canvasHeight=window.innerHeight,this.renderer.view.style.position="absolute",this.renderer.view.style.display="block",t.nativeElement.appendChild(this.renderer.view),this.myCar=e,this.cars=[e],this.canvasStage=new KE,this.miniMap=new sC(r),this.miniMap.setUnscaledWidth(300),this.miniMap.setUnscaledHeight(300),this.miniMap.x=20,this.miniMap.y=this.canvasHeight-320,this.miniMap.addCar(e,!0),this.canvasStage.addChild(this.miniMap),this.speedometer=new pC(e),this.speedometer.setUnscaledWidth(300),this.speedometer.setUnscaledHeight(300),this.speedometer.x=this.canvasWidth-320,this.speedometer.y=this.canvasHeight-320,this.canvasStage.addChild(this.speedometer),this.controlService.trajectorySelectionSubject.subscribe(t=>{const r=t?Math.max(0,du.getSpeedInUniformlyAcceleratedMotionByDistance(e.speed,t.l,1)):-1;this.speedometer.selectionSpeed=r}),requestAnimationFrame(this._renderPixiStageRoutine.bind(this))}_renderPixiStageRoutine(){requestAnimationFrame(this._renderPixiStageRoutine.bind(this)),this.canvasStage.validateDisplayList()&&this.renderer.render(this.canvasStage)}resizeCanvas(t,e){this.canvasStage&&this.renderer&&(this.canvasWidth!=t||this.canvasHeight!=e)&&(this.renderer.resize(t,e),this.canvasWidth=t,this.canvasHeight=e,this.miniMap.y=e-320,this.speedometer.x=t-320,this.speedometer.y=e-320,this.canvasStage.invalidateDisplayList())}}class mC{constructor(t,e){this.carId=t,this.progress=e}}class vC{getEngineForce(){return this.engineForce}getBrakingForce(){return this.brakingForce}getSteeringMaxCurvature(t){return 1/(vC.DORMANT_TURN_RADIUS+Math.pow(t,2)/this.steeringFactor)}getDragForce(t){return this.dragConstant*Math.pow(t,2)}getWheelFrictionForce(t){return this.wheelFrictionConstant*Math.abs(t)}getMaxAcceleration(t){return(this.getEngineForce()-this.getDragForce(t)-this.getWheelFrictionForce(t))/this.mass}getMaxDeceleration(t){const e=-du.getAccelerationToAchieveSpeed(t,0,1);return Math.min(e,(this.getBrakingForce()+this.getDragForce(t)+this.getWheelFrictionForce(t))/this.mass)}static fromDTO(t){const e=new vC;return e.steeringFactor=t.steering,e.dragConstant=t.dragConstant,e.wheelFrictionConstant=t.wheelFrictionConstant,e.engineForce=t.engineForce,e.brakingForce=t.brakingForce,e.mass=t.mass,e}}vC.DORMANT_TURN_RADIUS=5.5;var gC=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})},yC=Kc.Point;class xC{constructor(t,e,r,n=0,i=0,o=0,a=0){this.id=t,this.model=e,this.characteristics=r,this.x=n,this.y=i,this.rotation=o,this._speed=a,this.ready=!1,this.positionChangedSubject=new P,this.speedChangedSubject=new P}get speed(){return this._speed}set speed(t){t!==this._speed&&(this._speed=t,this.speedChangedSubject.next(t))}initMesh(t,e=!0){return gC(this,void 0,void 0,function*(){this.mesh=yield t.loadCar("BMW_M3_MW"),this.mesh.position.x=this.x,this.mesh.position.y=this.y,this.mesh.position.z=0,this.mesh.rotation.z=this.rotation,this.mesh.traverse(function(t){t instanceof Jc.Mesh&&(t.castShadow=e,t.receiveShadow=e)}),this.ready=!0})}setX(t){t!=this.x&&(this.x=t,this.ready&&(this.mesh.position.x=this.x),this.positionChangedSubject.next(this.getPosition()))}setY(t){t!=this.y&&(this.y=t,this.ready&&(this.mesh.position.y=this.y),this.positionChangedSubject.next(this.getPosition()))}getPosition(){return new yC(this.x,this.y)}setPosition(t){this.x==t.x&&this.y==t.y||(this.x=t.x,this.y=t.y,this.ready&&this.mesh.position.set(t.x,t.y,0),this.positionChangedSubject.next(this.getPosition()))}setRotation(t){t!=this.rotation&&(this.rotation=t,this.ready&&(this.mesh.rotation.z=this.rotation))}clone(){return new xC(5*(this.id+1),this.model,this.characteristics,this.x,this.y,this.rotation)}static fromDTO(t){return new xC(Math.round(1e3*Math.random()),"BMW_M3_MW",vC.fromDTO(t))}}var bC=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})};class wC{constructor(t,e,r,n,i,o,a,s){this.hudService=t,this.socketService=e,this.loginService=r,this.carService=n,this.ngZone=i,this.modelLoaderService=o,this.controlService=a,this.router=s,window.onresize=(t=>{this.ngZone.run(()=>{this.resizeCanvas(window.innerWidth,window.innerHeight)})})}get raceTimestamp(){return this.stepsCount}resizeCanvas(t,e){this.hudService.resizeCanvas(t,e),this.stage3d.resizeCanvas(t,e)}initGameplay(t,e,r){return bC(this,void 0,void 0,function*(){this.isWaitingPlayers=!0,this.isLoadingMap=!0,this.stage3d=e,this.cars=new Map,this.lastCarPositionsOnRoadSpline=new Map,this.myCarId=r.id,this.stepsCount=0,r.ready||(yield r.initMesh(this.modelLoaderService,!0)),this.mapData=yield this.modelLoaderService.loadMap("default-map"),console.log(this.mapData),this.cars.set(r.id,r),this.hudService.initHud(t,r,this.mapData),this.stage3d.addCar(r,!0),this.stage3d.addMap(this.mapData.scene,!0),this.controlService.initControls(this.stage3d,r),this.isLoadingMap=!1})}startGame(){return bC(this,void 0,void 0,function*(){const t=this.loginService.currentUser;if(!t)return this.socketService.socketAvailable()&&this.socketService.disconnect(),console.warn("no user on game start"),this.router.navigate(["login"]);this.socketService.stepSubject.subscribe(t=>this.onStepComplete(t.map(t=>(t.trajectory&&(t.trajectory=new su(t.trajectory.l,t.trajectory.c)),t)))),this.socketService.readyToStart({id:this.myCarId,name:t.login})})}onStepComplete(t){return bC(this,void 0,void 0,function*(){this.stepsCount++,this.stepsCount>1&&(this.stage3d.startWorldRenderingLoop(),yield this.playAnimations(t),this.stage3d.stopWorldRenderingLoop()),this.startNewIteration(t).then()})}calculateCarPositionsOnRoad(t=0){const e=[];for(const r of this.cars.values()){const n=r.getPosition(),i=this.lastCarPositionsOnRoadSpline.get(r.id);let o=-1,a=0;i&&(a=Math.max(2,Math.ceil((i.speed+20)*(this.raceTimestamp+t-i.calculatedAt)/this.mapData.roadSpline.minSegmentLength)),o=i.pos.lineIndex);const s=this.mapData.roadSpline.getNearestPointOnSpline(new Jc.Vector3(n.x,n.y,0),o,a);this.lastCarPositionsOnRoadSpline.set(r.id,{calculatedAt:this.raceTimestamp+t,speed:r.speed,pos:s}),e.push(new mC(r.id,this.mapData.roadSpline.getLapProgress(s)))}e.sort((t,e)=>e.progress.lapPercent-t.progress.lapPercent),console.log(`You have a ${e.findIndex(t=>t.carId===this.myCarId)+1} place with passed ${e.find(t=>t.carId===this.myCarId).progress.lapPercent}%`)}playAnimations(t){return bC(this,void 0,void 0,function*(){const e=new Map,r=new Map;for(let i of t){let t=this.cars.get(i.id);t&&i.trajectory&&e.set(i.id,{rotation:t.rotation,position:t.getPosition(),speed:t.speed})}const n=(new Date).getTime();return new Promise(i=>{const o=this.stage3d.beforeWorldRenderSubject.subscribe(()=>{const a=((new Date).getTime()-n)/1e3;if(a>=1)o.unsubscribe(),i();else{for(let n of t){if(r.has(n.id))continue;let t=this.cars.get(n.id),i=e.get(n.id);if(t&&n.trajectory&&i){const e=new su(du.getDistanceInUniformlyAcceleratedMotion(i.speed,n.acceleration,a),n.trajectory.c);if(Math.abs(e.l)>=Math.abs(n.trajectory.l))r.set(n.id,!0),t.setPosition(n.finalCarProperties.position),t.setRotation(n.finalCarProperties.rotation),t.speed=n.finalCarProperties.speed;else{const r=e.polarPosition;r.theta+=i.rotation;const o=r.cartesianPoint;o.x+=i.position.x,o.y+=i.position.y,t.setPosition(o),t.setRotation(i.rotation+e.pointerRotation),t.speed=n.trajectory.l<0?0:du.getSpeedInUniformlyAcceleratedMotion(i.speed,n.acceleration,a)}}}this.calculateCarPositionsOnRoad(a),this.controlService.updateCameraDistance()}this.stage3d.animateCamera()})})})}startNewIteration(t){return bC(this,void 0,void 0,function*(){if(!this.myCarId&&0!==this.myCarId||!this.cars.get(this.myCarId))return void console.log('Don\'t have "myCar" for arc functionality :(');this.isWaitingPlayers&&(this.isWaitingPlayers=!1);for(let a of t){let t=this.cars.get(a.id);t?(t.setPosition(a.finalCarProperties.position),t.setRotation(a.finalCarProperties.rotation),t.speed=a.finalCarProperties.speed):(yield(t=new xC(a.id,"lambo",new vC,a.finalCarProperties.position.x,a.finalCarProperties.position.y,a.finalCarProperties.rotation,a.finalCarProperties.speed)).initMesh(this.modelLoaderService,!0),this.stage3d.addCar(t),this.hudService.addCar(t),this.cars.set(t.id,t))}this.calculateCarPositionsOnRoad();let e,r,n,i=this.cars.get(this.myCarId),o=0;this.mapData.polygon.isContainingPoint(i.getPosition())?(e=Math.max(0,this.getMinDistanceOnNextStep(i)),r=this.getMaxDistanceOnNextStep(i),o=i.speed,n=i.characteristics.getSteeringMaxCurvature(i.speed)):(e=0,r=this.getMaxDistanceOnNextStep(i,0),o=0,n=i.characteristics.getSteeringMaxCurvature(0)),Math.abs(o)<.25&&(e=-r+Math.abs(o)),this.controlService.updateCameraDistance(),this.controlService.adjustControlPositions(),this.stage3d.animateCamera(),this.stage3d.renderWorldOnce(),this.controlService.askForSelectedPosition(e,r,o,n).then(t=>{const e=t.polarPosition;e.theta+=i.rotation;const r=e.cartesianPoint;r.x+=i.x,r.y+=i.y;const n={id:i.id,finalCarProperties:{position:i.getPosition(),rotation:i.rotation,speed:i.speed},trajectory:t,acceleration:du.getAccelerationInUniformlyAcceleratedMotion(i.speed,t.l,1)};let o=t.breakToSegments().map(t=>{const e=nu.fromCartesian(t);return e.theta+=i.rotation,(t=e.cartesianPoint).x+=i.x,t.y+=i.y,t});for(let a=0;a<o.length;a++){const e=o[a];if(!this.mapData.polygon.isContainingPoint(e)){let e=this.mapData.polygon.getLinePolygonIntersection(a>0?o[a-1]:i.getPosition(),o[a]),r=Math.min(.1,ru.getDistanceBetweenPoints(i.getPosition(),e)),s=ru.getAngleBetweenPoints(e,i.getPosition());return n.finalCarProperties.speed=0,n.finalCarProperties.position.x=e.x+Math.cos(s)*r,n.finalCarProperties.position.y=e.y+Math.sin(s)*r,ru.getDistanceBetweenPoints(i.getPosition(),n.finalCarProperties.position)>.01?(n.finalCarProperties.rotation+=a*(t.pointerRotation/o.length),n.trajectory=new su(t.l*a/o.length,t.c)):n.trajectory=new su(0,0),void this.socketService.nextStep(n)}if(this.mapData.checkpoints&&this.mapData.checkpoints.length>0&&ru.getDistanceBetweenPoints(e,this.mapData.checkpoints[0].getPosition())<this.mapData.checkpoints[0].radius&&(this.mapData.checkpoints.shift(),0==this.mapData.checkpoints.length))return void this.socketService.finished(this.stepsCount)}n.finalCarProperties.speed=Math.max(0,du.getSpeedInUniformlyAcceleratedMotionByDistance(i.speed,t.l,1)),n.finalCarProperties.rotation+=t.pointerRotation,n.finalCarProperties.position=r,this.socketService.nextStep(n)})})}getMinDistanceOnNextStep(t,e=t.speed){return du.getDistanceInUniformlyAcceleratedMotion(e,-t.characteristics.getMaxDeceleration(e),1)}getMaxDistanceOnNextStep(t,e=t.speed){return du.getDistanceInUniformlyAcceleratedMotion(e,t.characteristics.getMaxAcceleration(e),1)}setRaceResults(t){this.raceResults=t}getLastRaceResults(){return this.raceResults}}class _C{constructor(t,e,r,n){this.gameplayService=t,this.router=e,this.socketService=r,this.carService=n}ngOnInit(){const t=this.carService.selectedCar;if(!t)return console.warn("car is not selected"),this.router.navigate(["selectCars"]);if(!this.socketService.socketAvailable())return console.warn("No socket is open on game start"),this.router.navigate(["menu"]);const e=xC.fromDTO(t);this.gameplayService.initGameplay(this.canvasContainer,this.stage3d,e).then(()=>{this.gameplayService.startGame(),this.socketService.finishSubject.subscribe(t=>{this.gameplayService.setRaceResults(t),this.router.navigate(["finish"])})})}checkIfLoadingMap(){return this.gameplayService.isLoadingMap}chechIfWaitingPlayers(){return this.gameplayService.isWaitingPlayers}}var SC=Tn({encapsulation:0,styles:[[".screen-centered-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:absolute;top:0;left:0;right:0;bottom:0}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}.click-through[_ngcontent-%COMP%]{pointer-events:none}.loading-h[_ngcontent-%COMP%]{text-align:center}.invisible[_ngcontent-%COMP%]{display:none}"]],data:{}});function TC(t){return $n(0,[(t()(),zn(0,0,null,null,3,"div",[["class","screen-centered-container"]],null,null,null,null,null)),(t()(),zn(1,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),zn(2,0,null,null,1,"h1",[["class","loading-h"]],null,null,null,null,null)),(t()(),Kn(3,null,[" "," "]))],null,function(t,e){t(e,3,0,e.component.checkIfLoadingMap()?"Loading map":"Waiting other players")})}function MC(t){return $n(0,[Qn(402653184,1,{canvasContainer:0}),Qn(402653184,2,{stage3d:0}),(t()(),zn(2,0,null,null,5,"div",[],null,null,null,null,null)),(t()(),zn(3,0,null,null,1,"stage-3d",[["class","full-screen"]],[[2,"invisible",null]],null,null,j_,B_)),Zn(4,4308992,[[2,4],["stage3d",4]],0,k_,[mu],null,null),(t()(),zn(5,0,[[1,0],["canvasContainer",1]],null,0,"div",[["class","full-screen click-through"]],[[2,"invisible",null]],null,null,null,null)),(t()(),jn(16777216,null,null,1,null,TC)),Zn(7,16384,null,0,ro,[Sr,_r],{ngIf:[0,"ngIf"]},null)],function(t,e){var r=e.component;t(e,4,0),t(e,7,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers())},function(t,e){var r=e.component;t(e,3,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers()),t(e,5,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers())})}var AC=Hn("page-gameplay",_C,function(t){return $n(0,[(t()(),zn(0,0,null,null,1,"page-gameplay",[],null,null,null,MC,SC)),Zn(1,114688,null,0,_C,[wC,fc,la,Gc],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]),EC=function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})};class CC{constructor(t,e,r,n){this.router=t,this.gameplayService=e,this.lobbyService=r,this.socketService=n,this.messageText=e.getLastRaceResults()?"Congratulations! You won the race!":"Good luck next time!"}tryAgain(){this.lobbyService.quickStart().subscribe(t=>EC(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}}var PC=Tn({encapsulation:0,styles:[["finish-screen[_ngcontent-%COMP%]{background-color:#fff}.finish-content[_ngcontent-%COMP%]{width:500px;height:70%;margin:0 auto;display:flex;justify-content:space-around;flex-direction:column}.finish-message[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center}.finish-text[_ngcontent-%COMP%]{color:gray}.finish-button[_ngcontent-%COMP%]{width:60%;margin:20px auto!important;justify-content:space-around;align-self:center;display:flex}"]],data:{}});function OC(t){return $n(0,[(t()(),zn(0,0,null,null,10,"div",[],null,null,null,null,null)),(t()(),zn(1,0,null,null,9,"div",[["class","finish-content"]],null,null,null,null,null)),(t()(),zn(2,0,null,null,8,"div",[["class","finish-message"]],null,null,null,null,null)),(t()(),zn(3,0,null,null,1,"h1",[["class","finish-text"]],null,null,null,null,null)),(t()(),Kn(4,null,["",""])),(t()(),zn(5,0,null,null,1,"button",[["class","finish-button"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.tryAgain()&&n),n},null,null)),(t()(),Kn(-1,null,["Race again"])),(t()(),zn(7,0,null,null,3,"button",[["class","finish-button"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==Jn(t,8).onClick()&&n),n},null,null)),Zn(8,16384,null,0,mc,[fc,Fl,[8,null],pr,fr],{routerLink:[0,"routerLink"]},null),function(t,e,r){const n=new Array(r.length);for(let i=0;i<r.length;i++){const t=r[i];n[i]={flags:8,name:t,ns:null,nonMinifiedName:t,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:9,flags:32,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:n,bindingFlags:Bn(n),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}(0,0,new Array(1)),(t()(),Kn(-1,null,["Go to menu"]))],function(t,e){t(e,8,0,t(e,9,0,"menu"))},function(t,e){t(e,4,0,e.component.messageText)})}var NC=Hn("finish-screen",CC,function(t){return $n(0,[(t()(),zn(0,0,null,null,1,"finish-screen",[],null,null,null,OC,PC)),Zn(1,49152,null,0,CC,[fc,wC,ua,la],null,null)],null,null)},{},{},[]);class LC{constructor(t,e,r,n){this.loginService=t,this.carService=e,this.fb=r,this.router=n}onLoginClick(t,e){this.loginService.login(t,e).subscribe(t=>{this.router.navigate(["/menu"])},t=>{console.error(t)})}onFacebookLoginClick(){this.fb.login().then(t=>console.log(t)).catch(t=>console.error(t))}onSignupClick(t,e){console.log(t,e),this.loginService.createUser(t,e).subscribe(t=>{console.log(JSON.stringify(t))},t=>{console.error(t)})}}var IC=Tn({encapsulation:0,styles:[[".login[_ngcontent-%COMP%]{height:100%;margin:0 auto}.background[_ngcontent-%COMP%]{height:100%;width:100%;position:absolute;display:flex;justify-content:space-between;flex-direction:column;z-index:-1}.title[_ngcontent-%COMP%]{color:#467daf;font-size:82px;font-family:Arial;position:absolute;bottom:200px;right:200px}.title-end[_ngcontent-%COMP%]{color:grey}.background-part[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.left-top-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/left-top-line.svg);height:130px;width:165px;zoom:150%}.right-top-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/right-top-line.svg);height:95px;width:190px;zoom:120%;margin-right:200px}.right-bottom-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/right-bottom-line.svg);height:160px;width:155px;zoom:150%}.left-bottom-lines[_ngcontent-%COMP%]{background-image:url(/assets/images/login/left-bottom-line.svg);height:140px;width:210px;align-self:flex-end;zoom:150%}.car[_ngcontent-%COMP%]{background-image:url(/assets/images/login/car.svg);height:220px;width:434px;zoom:120%;position:absolute;top:40px;right:350px;z-index:-1}.car-lines[_ngcontent-%COMP%]{width:60%;background-image:url(/assets/images/login/car-line.svg);background-size:cover;height:50%;position:absolute;right:0;z-index:-1}button[_ngcontent-%COMP%]{margin-top:10px;width:350px;height:45px;background-color:#fff;border:2px solid #467daf;color:#467daf;border-radius:3px;font-size:large}button[_ngcontent-%COMP%]:focus{outline:0}.content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;justify-content:center}.content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill{-webkit-box-shadow:0 0 0 30px #fff inset}.content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:0;outline:0;background:0 0;border-bottom:2px solid #467daf;margin-top:10px;width:350px;height:45px;font-size:large}.login-form[_ngcontent-%COMP%]{padding-left:180px;padding-bottom:60px;display:flex;flex-direction:column}.login-button[_ngcontent-%COMP%]{width:300px}.fb-button[_ngcontent-%COMP%]{width:45px;background-color:#467daf;color:#fff}.button-panel[_ngcontent-%COMP%]{padding-top:30px}"]],data:{}});function RC(t){return $n(0,[(t()(),zn(0,0,null,null,25,"div",[["class","login"]],null,null,null,null,null)),(t()(),zn(1,0,null,null,6,"div",[["class","background"]],null,null,null,null,null)),(t()(),zn(2,0,null,null,2,"div",[["class","background-part"]],null,null,null,null,null)),(t()(),zn(3,0,null,null,0,"div",[["class","left-top-lines"]],null,null,null,null,null)),(t()(),zn(4,0,null,null,0,"div",[["class","right-top-lines"]],null,null,null,null,null)),(t()(),zn(5,0,null,null,2,"div",[["class","background-part"]],null,null,null,null,null)),(t()(),zn(6,0,null,null,0,"div",[["class","left-bottom-lines"]],null,null,null,null,null)),(t()(),zn(7,0,null,null,0,"div",[["class","right-bottom-lines"]],null,null,null,null,null)),(t()(),zn(8,0,null,null,0,"div",[["class","car"]],null,null,null,null,null)),(t()(),zn(9,0,null,null,0,"div",[["class","car-lines"]],null,null,null,null,null)),(t()(),zn(10,0,null,null,3,"div",[["class","title"]],null,null,null,null,null)),(t()(),Kn(-1,null,[" NONAME "])),(t()(),zn(12,0,null,null,1,"span",[["class","title-end"]],null,null,null,null,null)),(t()(),Kn(-1,null,["RACING"])),(t()(),zn(14,0,null,null,11,"div",[["class","content"]],null,null,null,null,null)),(t()(),zn(15,0,null,null,10,"div",[["class","login-form"]],null,null,null,null,null)),(t()(),zn(16,0,[["username",1]],null,0,"input",[["id","username"],["placeholder","Username"],["type","text"]],null,null,null,null,null)),(t()(),zn(17,0,[["pass",1]],null,0,"input",[["id","pass"],["placeholder","Password"],["type","password"]],null,null,null,null,null)),(t()(),zn(18,0,null,null,7,"div",[["class","button-panel"]],null,null,null,null,null)),(t()(),zn(19,0,null,null,4,"div",[],null,null,null,null,null)),(t()(),zn(20,0,null,null,1,"button",[["class","login-button"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onLoginClick(Jn(t,16).value,Jn(t,17).value)&&n),n},null,null)),(t()(),Kn(-1,null,[" Log in "])),(t()(),zn(22,0,null,null,1,"button",[["class","fb-button"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onFacebookLoginClick()&&n),n},null,null)),(t()(),Kn(-1,null,[" Fb "])),(t()(),zn(24,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onSignupClick(Jn(t,16).value,Jn(t,17).value)&&n),n},null,null)),(t()(),Kn(-1,null,[" Sign Up "]))],null,null)}var DC=Hn("page-login",LC,function(t){return $n(0,[(t()(),zn(0,0,null,null,1,"page-login",[],null,null,null,RC,IC)),Zn(1,49152,null,0,LC,[na,Gc,wi,fc],null,null)],null,null)},{},{},[]);class FC{constructor(t){this.uiService=t}ngOnInit(){this.uiService.showLoader.subscribe(t=>this.visible=t)}}var UC=Tn({encapsulation:0,styles:[[".loader-layer[_ngcontent-%COMP%]{background-color:grey;opacity:.5;height:100%;width:100%;position:absolute;display:flex;align-items:center;flex-direction:column;justify-content:space-around}.loader[_ngcontent-%COMP%], .loader[_ngcontent-%COMP%]:after, .loader[_ngcontent-%COMP%]:before{border-radius:50%}.loader[_ngcontent-%COMP%]{color:#fff;font-size:11px;text-indent:-99999em;margin:55px auto;position:relative;width:10em;height:10em;box-shadow:inset 0 0 0 1em;-webkit-transform:translateZ(0);transform:translateZ(0)}.loader[_ngcontent-%COMP%]:after, .loader[_ngcontent-%COMP%]:before{position:absolute;content:''}.loader[_ngcontent-%COMP%]:before{width:5.2em;height:10.2em;background:grey;border-radius:10.2em 0 0 10.2em;top:-.1em;left:-.1em;-webkit-transform-origin:5.2em 5.1em;transform-origin:5.2em 5.1em;-webkit-animation:2s 1.5s infinite load2;animation:2s 1.5s infinite load2}.loader[_ngcontent-%COMP%]:after{width:5.2em;height:10.2em;background:grey;border-radius:0 10.2em 10.2em 0;top:-.1em;left:5.1em;-webkit-transform-origin:0 5.1em;transform-origin:0 5.1em;-webkit-animation:2s infinite load2;animation:2s infinite load2}@-webkit-keyframes load2{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes load2{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}"]],data:{}});function kC(t){return $n(0,[(t()(),zn(0,0,null,null,2,"div",[["class","loader-layer"]],null,null,null,null,null)),(t()(),zn(1,0,null,null,1,"div",[["class","loader"]],null,null,null,null,null)),(t()(),Kn(-1,null,["Loading..."]))],null,null)}function BC(t){return $n(0,[(t()(),jn(16777216,null,null,1,null,kC)),Zn(1,16384,null,0,ro,[Sr,_r],{ngIf:[0,"ngIf"]},null)],function(t,e){t(e,1,0,e.component.visible)},null)}var jC=Tn({encapsulation:0,styles:[[""]],data:{}});function zC(t){return $n(0,[(t()(),zn(0,0,null,null,1,"loader-layer",[],null,null,null,BC,UC)),Zn(1,114688,null,0,FC,[Ko],null,null),(t()(),zn(2,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),Zn(3,212992,null,0,xc,[yc,Sr,ke,[8,null],Tr],null,null)],function(t,e){t(e,1,0),t(e,3,0)},null)}var VC=Hn("app-root",Si,function(t){return $n(0,[(t()(),zn(0,0,null,null,1,"app-root",[],null,null,null,zC,jC)),Zn(1,49152,null,0,Si,[wi],null,null)],null,null)},{},{},[]);class GC{constructor(){this._accessors=[]}add(t,e){}remove(t){for(let e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return}select(t){}_isSameGroup(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name}}class HC{}class WC{}var XC=function(t,e,r){return new class extends Ve{constructor(t,e,r){this.moduleType=t,this._bootstrapComponents=e,this._ngModuleDefFactory=r}create(t){return yn.createNgModuleRef(this.moduleType,t||kt.NULL,this._bootstrapComponents,Ln(this._ngModuleDefFactory))}}(ri,[Si],function(t){return function(t){const e={},r=[];let n=!1;for(let i=0;i<t.length;i++){const o=t[i];o.token===be&&(n=!0),1073741824&o.flags&&r.push(o.token),o.index=i,e[wn(o.token)]=o}return{factory:null,providersByKey:e,providers:t,modules:r,isRoot:n}}([Vn(512,ke,Be,[[8,[zc,qc,AC,NC,DC,VC]],[3,ke],ze]),Vn(5120,zr,Hr,[[3,zr]]),Vn(4608,Ki,$i,[zr,[2,Qi]]),Vn(5120,Te,Me,[]),Vn(5120,Dr,Vr,[]),Vn(5120,Fr,Gr,[]),Vn(4608,Cs,Ps,[_o]),Vn(6144,fn,null,[Cs]),Vn(4608,Ms,As,[]),Vn(5120,is,function(t,e,r,n,i,o){return[new class extends as{constructor(t,e){this.ngZone=e}patchEvent(){if(!Event||!Event.prototype)return;if(Event.prototype.__zone_symbol__stopImmediatePropagation)return;const t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this.__zone_symbol__propagationStopped=!0),t&&t.apply(this,arguments)}}supports(t){return!0}addEventListener(t,e,r){let n=r;if(t[xs]&&(!Ye.isInAngularZone()||Ss(e))){let r=ws[e];r||(r=ws[e]=ys("ANGULAR"+e+"FALSE"));let i=t[r];if(i||(i=t[r]=[]),Ss(e),Zone,0===i.length);else{let t=!1;for(let e=0;e<i.length;e++)if(i[e].handler===n){t=!0;break}}}return()=>this.removeEventListener(t,e,n)}removeEventListener(t,e,r){if(!t[bs])return t.removeEventListener.apply(t,[e,r,!1]);let n=ws[e],i=n&&t[n];if(!i)return t.removeEventListener.apply(t,[e,r,!1]);let o=!1;for(let a=0;a<i.length;a++)if(i[a].handler===r){o=!0;break}}}(t,e),new Es(r),new class extends as{constructor(t,e,r){this._config=e,this.console=r}supports(t){return!(!Ts.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer)}addEventListener(t,e,r){const n=this.manager.getZone();return e=e.toLowerCase(),n.runOutsideAngular(()=>{const i=this._config.buildHammer(t),o=function(t){n.runGuarded(function(){r(t)})};return()=>i.off(e,o)})}isCustomEvent(t){return this._config.events.indexOf(t)>-1}}(n,i,o)]},[_o,Ye,_o,_o,Ms,Oe]),Vn(4608,os,os,[is,Ye]),Vn(135680,ls,ls,[_o]),Vn(4608,fs,fs,[os,ls]),Vn(6144,hr,null,[fs]),Vn(6144,ss,null,[ls]),Vn(4608,Qe,Qe,[Ye]),Vn(4608,Qa,Qa,[_o]),Vn(4608,ts,ts,[_o]),Vn(4608,GC,GC,[]),Vn(4608,Xo,Yo,[_o,Ce,Ho]),Vn(4608,qo,qo,[Xo,Wo]),Vn(5120,Bo,function(t){return[t]},[qo]),Vn(4608,Vo,Vo,[]),Vn(6144,zo,null,[Vo]),Vn(4608,Go,Go,[zo]),Vn(6144,To,null,[Go]),Vn(4608,So,Jo,[To,kt]),Vn(4608,Uo,Uo,[So]),Vn(5120,Fl,Rc,[fc]),Vn(4608,Sc,Sc,[]),Vn(6144,wc,null,[Sc]),Vn(135680,Tc,Tc,[fc,mr,Le,kt,wc]),Vn(4608,_c,_c,[]),Vn(5120,kc,Uc,[Dc]),Vn(5120,Pe,function(t){return[t]},[kc]),Vn(4608,wi,wi,[]),Vn(4608,Ko,Ko,[]),Vn(4608,$o,$o,[Uo,fc,Ko]),Vn(4608,ra,ra,[$o]),Vn(4608,na,na,[ra,fc]),Vn(4608,Vc,Vc,[$o]),Vn(4608,Gc,Gc,[Vc]),Vn(4608,la,la,[]),Vn(4608,mu,mu,[la]),Vn(4608,fC,fC,[mu]),Vn(4608,tS,tS,[]),Vn(4608,wC,wC,[fC,la,na,Gc,Ye,tS,mu,fc]),Vn(4608,ca,ca,[$o]),Vn(4608,ua,ua,[ca]),Vn(1024,Ac,Nc,[[3,fc]]),Vn(1024,$t,Us,[]),Vn(1024,or,function(){return[Cc()]},[]),Vn(512,Dc,Dc,[kt]),Vn(1024,_e,function(t,e){return[function(t){return es("probe",ns),es("coreTokens",Object.assign({},rs,(t||[]).reduce((t,e)=>(t[e.name]=e.token,t),{}))),()=>ns}(t),Fc(e)]},[[2,or],Dc]),Vn(512,Se,Se,[[2,_e]]),Vn(131584,ur,ur,[Ye,Oe,kt,$t,ke,Se]),Vn(512,al,sl,[]),Vn(512,yc,yc,[]),Vn(256,Mc,{},[]),Vn(1024,ji,Oc,[ki,[2,zi],Mc]),Vn(512,Vi,Vi,[ji]),Vn(512,Le,Le,[]),Vn(512,mr,br,[Le,[2,yr]]),Vn(1024,lc,function(){return[[{path:"menu",component:da},{path:"selectCars",component:Hc},{path:"game",component:_C},{path:"finish",component:CC},{path:"login",component:LC},{path:"**",redirectTo:"login"}]]},[]),Vn(1024,fc,Ic,[ur,al,yc,Vi,kt,mr,Le,lc,Mc,[2,uc],[2,ac]]),Vn(1073742336,Pc,Pc,[[2,Ac],[2,fc]]),Vn(1073742336,_i,_i,[]),Vn(1073742336,wo,wo,[]),Vn(1073742336,Wr,Wr,[ur]),Vn(1073742336,ks,ks,[[3,ks]]),Vn(1073742336,HC,HC,[]),Vn(1073742336,WC,WC,[]),Vn(1073742336,Zo,Zo,[]),Vn(1073742336,Qo,Qo,[]),Vn(1073742336,ri,ri,[]),Vn(256,be,!0,[]),Vn(256,Ho,"XSRF-TOKEN",[]),Vn(256,Wo,"X-XSRF-TOKEN",[])])})}();(function(){if(rr)throw new Error("Cannot enable prod mode after platform setup.");er=!1})(),Fs().bootstrapModuleFactory(XC)}},[[4,0]]]);